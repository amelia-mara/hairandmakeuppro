<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Continuity - Hair & Makeup Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/script-breakdown.css">
  <link rel="stylesheet" href="css/continuity.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="top-bar-left">
      <a href="dashboard.html" class="back-link">‚Üê Dashboard</a>
      <div class="page-title-group">
        <h1 class="page-title">LIVE CONTINUITY</h1>
        <span class="project-name" id="project-name">Loading...</span>
      </div>
    </div>
    <div class="top-bar-right">
      <button class="toolbar-btn" onclick="openSearchModal()">
        <span class="btn-icon">üîç</span>
        <span class="btn-text">Search</span>
      </button>
      <button class="toolbar-btn btn-primary" onclick="exportLookbookPDF()">
        <span class="btn-icon">üìÑ</span>
        <span class="btn-text">Export Lookbook</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="continuity-main-content">
    <!-- Tab Navigation -->
    <div class="center-tabs">
      <div class="center-tab active" data-tab="today" onclick="switchTab('today')">Today's Shoot</div>
      <div class="center-tab" data-tab="character" onclick="switchTab('character')">By Character</div>
      <div class="center-tab" data-tab="scene" onclick="switchTab('scene')">By Scene</div>
      <div class="center-tab" data-tab="lookbook" onclick="switchTab('lookbook')">Lookbook</div>
    </div>

    <!-- Tab Content Area -->
    <div class="tab-contents">

      <!-- TAB 1: TODAY'S SHOOT -->
      <div class="tab-content today-tab active" id="today-tab">
        <div class="today-header">
          <div class="shoot-day-info">
            <h2 id="shoot-day-title">SHOOT DAY 1</h2>
            <span class="date" id="shoot-date">Loading...</span>
            <span class="location" id="shoot-location"></span>
          </div>
          <div class="day-selector">
            <button class="day-nav-btn" onclick="goToPreviousDay()">‚Üê</button>
            <select id="shoot-day-select" onchange="changeShootDay(this.value)">
              <!-- Populated from shooting schedule -->
            </select>
            <button class="day-nav-btn" onclick="goToNextDay()">‚Üí</button>
          </div>
        </div>

        <div class="scenes-timeline" id="scenes-timeline">
          <!-- Current scene, up next, completed - populated by JS -->
          <div class="empty-state">
            <p>No shooting schedule loaded. Set up the shooting schedule in the dashboard.</p>
          </div>
        </div>
      </div>

      <!-- TAB 2: BY CHARACTER -->
      <div class="tab-content character-tab" id="character-tab">
        <div class="character-selector">
          <label>Character:</label>
          <select id="character-select" onchange="loadCharacterContinuity(this.value)">
            <option value="">Select character...</option>
            <!-- Populated from confirmed characters -->
          </select>
        </div>

        <div class="character-continuity-view" id="character-continuity-view">
          <div class="empty-state">
            <p>Select a character to view their continuity records.</p>
          </div>
        </div>
      </div>

      <!-- TAB 3: BY SCENE -->
      <div class="tab-content scene-tab" id="scene-tab">
        <div class="scene-selector">
          <label>Scene:</label>
          <select id="scene-select" onchange="loadSceneContinuity(this.value)">
            <option value="">Select scene...</option>
            <!-- Populated from scenes -->
          </select>
          <span class="scene-info-display" id="scene-info-display"></span>
        </div>

        <div class="scene-continuity-view" id="scene-continuity-view">
          <div class="empty-state">
            <p>Select a scene to view continuity for all characters.</p>
          </div>
        </div>
      </div>

      <!-- TAB 4: LOOKBOOK -->
      <div class="tab-content lookbook-tab" id="lookbook-tab">
        <div class="lookbook-controls">
          <div class="filter-controls">
            <select id="lookbook-character-filter" onchange="filterLookbook()">
              <option value="all">All Characters</option>
              <!-- Characters list -->
            </select>
            <select id="lookbook-look-filter" onchange="filterLookbook()">
              <option value="all">All Looks</option>
            </select>
          </div>
          <div class="export-controls">
            <button class="btn-secondary" onclick="printLookbook()">Print</button>
            <button class="btn-primary" onclick="exportLookbookPDF()">Export PDF</button>
          </div>
        </div>

        <div class="lookbook-preview" id="lookbook-preview">
          <!-- Paginated preview, one character per page -->
        </div>
      </div>

    </div>
  </div>

  <!-- CONTINUITY CARD MODAL -->
  <div class="modal continuity-card-modal" id="continuity-card-modal" style="display: none;">
    <div class="modal-content modal-fullscreen">

      <div class="modal-header">
        <div class="header-left">
          <button class="back-btn" onclick="closeContinuityCard()">‚Üê Back</button>
          <div class="card-title">
            <span class="character-name" id="card-character-name">CHARACTER NAME</span>
            <span class="scene-info" id="card-scene-info">Scene X ¬∑ Location</span>
          </div>
        </div>
        <div class="header-right">
          <span class="look-badge" id="card-look-badge">Look: Name</span>
          <button class="btn-primary" onclick="saveContinuityCard()">Save & Close</button>
        </div>
      </div>

      <div class="modal-body">

        <!-- References Row -->
        <div class="references-row">
          <div class="reference-panel test-ref">
            <div class="panel-header">
              <span class="panel-label">TEST REFERENCE</span>
              <button class="view-btn" onclick="viewFullImage('test')">View Full</button>
            </div>
            <div class="panel-collage" id="test-ref-collage">
              <div class="placeholder-collage">No test reference</div>
            </div>
            <div class="panel-meta" id="test-ref-meta">
              <span>Camera Test</span>
            </div>
          </div>

          <div class="reference-panel master-ref">
            <div class="panel-header">
              <span class="panel-label">MASTER</span>
              <span class="master-scene" id="master-scene-info"></span>
            </div>
            <div class="panel-collage" id="master-ref-collage">
              <div class="placeholder-collage">Not yet captured</div>
            </div>
            <div class="panel-meta" id="master-ref-meta">
              <span></span>
            </div>
          </div>
        </div>

        <!-- Surrounding Scenes Row -->
        <div class="surrounding-scenes-row">

          <div class="surrounding-scene previous" id="previous-scene-panel" onclick="navigateToPreviousScene()">
            <div class="surround-label">‚Üê PREVIOUS</div>
            <div class="surround-collage" id="previous-scene-collage">
              <div class="placeholder-collage">No previous</div>
            </div>
            <div class="surround-meta" id="previous-scene-meta"></div>
          </div>

          <div class="current-scene-capture">
            <div class="capture-label">THIS SCENE ¬∑ <span id="current-scene-label">Scene X</span></div>

            <!-- Photo Upload Area -->
            <div class="photo-capture-area" id="photo-capture-area">

              <!-- 4-Panel Grid -->
              <div class="four-panel-grid">

                <div class="panel-slot" data-view="front" onclick="uploadToSlot('front')">
                  <div class="slot-placeholder" id="slot-front-placeholder">
                    <span class="slot-label">FRONT</span>
                    <span class="slot-icon">+</span>
                  </div>
                  <img src="" alt="Front" id="slot-front-image" class="slot-image hidden">
                  <button class="remove-slot-btn hidden" id="slot-front-remove" onclick="removeFromSlot(event, 'front')">√ó</button>
                </div>

                <div class="panel-slot" data-view="left" onclick="uploadToSlot('left')">
                  <div class="slot-placeholder" id="slot-left-placeholder">
                    <span class="slot-label">LEFT</span>
                    <span class="slot-icon">+</span>
                  </div>
                  <img src="" alt="Left" id="slot-left-image" class="slot-image hidden">
                  <button class="remove-slot-btn hidden" id="slot-left-remove" onclick="removeFromSlot(event, 'left')">√ó</button>
                </div>

                <div class="panel-slot" data-view="right" onclick="uploadToSlot('right')">
                  <div class="slot-placeholder" id="slot-right-placeholder">
                    <span class="slot-label">RIGHT</span>
                    <span class="slot-icon">+</span>
                  </div>
                  <img src="" alt="Right" id="slot-right-image" class="slot-image hidden">
                  <button class="remove-slot-btn hidden" id="slot-right-remove" onclick="removeFromSlot(event, 'right')">√ó</button>
                </div>

                <div class="panel-slot" data-view="back" onclick="uploadToSlot('back')">
                  <div class="slot-placeholder" id="slot-back-placeholder">
                    <span class="slot-label">BACK</span>
                    <span class="slot-icon">+</span>
                  </div>
                  <img src="" alt="Back" id="slot-back-image" class="slot-image hidden">
                  <button class="remove-slot-btn hidden" id="slot-back-remove" onclick="removeFromSlot(event, 'back')">√ó</button>
                </div>

              </div>

              <!-- Additional Photos -->
              <div class="additional-photos">
                <div class="additional-label">Additional Photos (hands, feet, body, close-ups, monitor grabs)</div>
                <div class="additional-grid" id="additional-photos-grid">
                  <!-- Thumbnails of additional photos -->
                </div>
                <button class="add-additional-btn" onclick="uploadAdditionalPhoto()">
                  + Add Photo
                </button>
              </div>

              <!-- Generated Collage Preview -->
              <div class="collage-preview hidden" id="collage-preview">
                <div class="preview-label">Generated Collage</div>
                <canvas id="collage-canvas" width="800" height="800"></canvas>
              </div>

            </div>
          </div>

          <div class="surrounding-scene next" id="next-scene-panel" onclick="navigateToNextScene()">
            <div class="surround-label">NEXT ‚Üí</div>
            <div class="surround-collage" id="next-scene-collage">
              <div class="placeholder-collage">Pending</div>
            </div>
            <div class="surround-meta" id="next-scene-meta"></div>
          </div>

        </div>

        <!-- Match Status -->
        <div class="match-status-section">
          <div class="section-label">MATCH STATUS</div>
          <div class="match-options">
            <label class="match-option">
              <input type="radio" name="match-status" value="matches" checked>
              <span class="option-label">Matches master</span>
            </label>
            <label class="match-option">
              <input type="radio" name="match-status" value="adjusted">
              <span class="option-label">Minor adjustments</span>
            </label>
            <label class="match-option">
              <input type="radio" name="match-status" value="different">
              <span class="option-label">Significant change</span>
            </label>
          </div>
          <div class="variance-notes-container" id="variance-notes-container" style="display: none;">
            <label>Describe changes:</label>
            <textarea id="variance-notes" rows="2" placeholder="What changed from master..."></textarea>
          </div>
        </div>

        <!-- Continuity Alerts -->
        <div class="alerts-section" id="alerts-section">
          <div class="section-label">CONTINUITY ALERTS</div>
          <div class="alerts-list" id="alerts-list">
            <!-- Populated if there are active continuity events -->
          </div>
        </div>

        <!-- Products -->
        <div class="products-section">
          <div class="section-header">
            <span class="section-label">PRODUCTS</span>
            <span class="products-source" id="products-source">From Look</span>
            <button class="edit-products-btn" onclick="toggleProductsEdit()">Edit</button>
          </div>
          <div class="products-display" id="products-display">
            <div class="product-row">
              <span class="product-category">Face:</span>
              <span class="product-list" id="products-face">-</span>
            </div>
            <div class="product-row">
              <span class="product-category">Eyes:</span>
              <span class="product-list" id="products-eyes">-</span>
            </div>
            <div class="product-row">
              <span class="product-category">Lips:</span>
              <span class="product-list" id="products-lips">-</span>
            </div>
            <div class="product-row">
              <span class="product-category">Hair:</span>
              <span class="product-list" id="products-hair">-</span>
            </div>
            <div class="product-row sfx" id="products-sfx-row" style="display: none;">
              <span class="product-category">SFX:</span>
              <span class="product-list" id="products-sfx">-</span>
            </div>
          </div>
          <div class="products-edit hidden" id="products-edit">
            <div class="product-edit-row">
              <label>Face:</label>
              <input type="text" id="edit-products-face" placeholder="Foundation, concealer, powder...">
            </div>
            <div class="product-edit-row">
              <label>Eyes:</label>
              <input type="text" id="edit-products-eyes" placeholder="Eyeshadow, liner, mascara...">
            </div>
            <div class="product-edit-row">
              <label>Lips:</label>
              <input type="text" id="edit-products-lips" placeholder="Lip products...">
            </div>
            <div class="product-edit-row">
              <label>Hair:</label>
              <input type="text" id="edit-products-hair" placeholder="Styling products...">
            </div>
            <div class="product-edit-row">
              <label>SFX:</label>
              <input type="text" id="edit-products-sfx" placeholder="Special effects products...">
            </div>
            <button class="btn-secondary" onclick="saveProductsEdit()">Save Products</button>
          </div>
        </div>

        <!-- Notes -->
        <div class="notes-section">
          <div class="section-label">NOTES</div>
          <textarea id="scene-notes" rows="3" placeholder="Any notes for this scene..."></textarea>
        </div>

        <!-- Capture Info -->
        <div class="capture-info" id="capture-info">
          <span class="captured-by" id="captured-by"></span>
          <span class="captured-at" id="captured-at"></span>
        </div>

      </div>

      <div class="modal-footer">
        <button class="btn-secondary" onclick="openCompareView()">
          Compare to Other Scenes
        </button>
        <div class="footer-actions">
          <button class="btn-secondary" onclick="closeContinuityCard()">Cancel</button>
          <button class="btn-primary" onclick="saveContinuityCard()">Save & Close</button>
        </div>
      </div>

    </div>
  </div>

  <!-- COMPARE VIEW MODAL -->
  <div class="modal compare-modal" id="compare-modal" style="display: none;">
    <div class="modal-content modal-large">

      <div class="modal-header">
        <h2 id="compare-modal-title">COMPARE ¬∑ CHARACTER ¬∑ Look</h2>
        <button class="modal-close" onclick="closeCompareModal()">√ó</button>
      </div>

      <div class="modal-body">

        <div class="compare-panels">

          <div class="compare-panel left-panel">
            <div class="panel-selector">
              <select id="compare-left-select" onchange="updateCompareLeft(this.value)">
                <option value="master">Master</option>
                <option value="test">Test Reference</option>
                <!-- Scene options populated dynamically -->
              </select>
            </div>
            <div class="panel-image" id="compare-left-image-container">
              <img src="" alt="Left comparison" id="compare-left-image">
            </div>
            <div class="panel-details" id="compare-left-details">
              <span class="detail-date"></span>
              <span class="detail-notes"></span>
            </div>
          </div>

          <div class="compare-panel right-panel">
            <div class="panel-selector">
              <select id="compare-right-select" onchange="updateCompareRight(this.value)">
                <option value="master">Master</option>
                <option value="test">Test Reference</option>
                <!-- Scene options populated dynamically -->
              </select>
            </div>
            <div class="panel-image" id="compare-right-image-container">
              <img src="" alt="Right comparison" id="compare-right-image">
            </div>
            <div class="panel-details" id="compare-right-details">
              <span class="detail-date"></span>
              <span class="detail-notes"></span>
            </div>
          </div>

        </div>

        <div class="compare-view-options">
          <span>View:</span>
          <button class="view-btn active" onclick="setCompareView('collage')">Collage</button>
          <button class="view-btn" onclick="setCompareView('front')">Front</button>
          <button class="view-btn" onclick="setCompareView('left')">Left</button>
          <button class="view-btn" onclick="setCompareView('right')">Right</button>
          <button class="view-btn" onclick="setCompareView('back')">Back</button>
        </div>

      </div>

    </div>
  </div>

  <!-- SEARCH MODAL -->
  <div class="modal search-modal" id="search-modal" style="display: none;">
    <div class="modal-content modal-medium">

      <div class="search-header">
        <input type="text" id="search-input" placeholder="Search by scene number or character..."
               oninput="performSearch(this.value)" autofocus>
        <button class="modal-close" onclick="closeSearchModal()">√ó</button>
      </div>

      <div class="search-filters">
        <button class="filter-chip active" data-filter="all" onclick="setSearchFilter('all')">All</button>
        <button class="filter-chip" data-filter="scenes" onclick="setSearchFilter('scenes')">Scenes</button>
        <button class="filter-chip" data-filter="characters" onclick="setSearchFilter('characters')">Characters</button>
      </div>

      <div class="search-results" id="search-results">
        <!-- Populated by search -->
      </div>

      <div class="recent-searches" id="recent-searches">
        <div class="recent-label">Recent</div>
        <div class="recent-items" id="recent-search-items">
          <!-- Populated from localStorage -->
        </div>
      </div>

    </div>
  </div>

  <!-- IMAGE VIEWER MODAL -->
  <div class="modal image-viewer-modal" id="image-viewer-modal" style="display: none;">
    <div class="modal-content modal-fullscreen image-viewer">
      <button class="modal-close" onclick="closeImageViewer()">√ó</button>
      <img src="" alt="Full size image" id="viewer-image">
    </div>
  </div>

  <!-- Hidden file input for photo uploads -->
  <input type="file" id="photo-upload-input" accept="image/*" multiple hidden>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loading-text">Loading...</div>
  </div>

  <!-- Notification Toast -->
  <div class="notification-toast" id="notification-toast"></div>

  <!-- JavaScript Modules -->
  <script type="module" src="js/continuity/continuity-main.js"></script>
</body>
</html>
