var ju=Object.defineProperty;var Il=es=>{throw TypeError(es)};var vu=(es,ts,ss)=>ts in es?ju(es,ts,{enumerable:!0,configurable:!0,writable:!0,value:ss}):es[ts]=ss;var eo=(es,ts,ss)=>vu(es,typeof ts!="symbol"?ts+"":ts,ss),Fo=(es,ts,ss)=>ts.has(es)||Il("Cannot "+ss);var As=(es,ts,ss)=>(Fo(es,ts,"read from private field"),ss?ss.call(es):ts.get(es)),fr=(es,ts,ss)=>ts.has(es)?Il("Cannot add the same private member more than once"):ts instanceof WeakSet?ts.add(es):ts.set(es,ss),jr=(es,ts,ss,rs)=>(Fo(es,ts,"write to private field"),rs?rs.call(es,ss):ts.set(es,ss),ss),pr=(es,ts,ss)=>(Fo(es,ts,"access private method"),ss);var go=(es,ts,ss,rs)=>({set _(ns){jr(es,ts,ns,ss)},get _(){return As(es,ts,rs)}});(function(){const ts=document.createElement("link").relList;if(ts&&ts.supports&&ts.supports("modulepreload"))return;for(const ns of document.querySelectorAll('link[rel="modulepreload"]'))rs(ns);new MutationObserver(ns=>{for(const os of ns)if(os.type==="childList")for(const as of os.addedNodes)as.tagName==="LINK"&&as.rel==="modulepreload"&&rs(as)}).observe(document,{childList:!0,subtree:!0});function ss(ns){const os={};return ns.integrity&&(os.integrity=ns.integrity),ns.referrerPolicy&&(os.referrerPolicy=ns.referrerPolicy),ns.crossOrigin==="use-credentials"?os.credentials="include":ns.crossOrigin==="anonymous"?os.credentials="omit":os.credentials="same-origin",os}function rs(ns){if(ns.ep)return;ns.ep=!0;const os=ss(ns);fetch(ns.href,os)}})();function getDefaultExportFromCjs(es){return es&&es.__esModule&&Object.prototype.hasOwnProperty.call(es,"default")?es.default:es}function getAugmentedNamespace(es){if(es.__esModule)return es;var ts=es.default;if(typeof ts=="function"){var ss=function rs(){return this instanceof rs?Reflect.construct(ts,arguments,this.constructor):ts.apply(this,arguments)};ss.prototype=ts.prototype}else ss={};return Object.defineProperty(ss,"__esModule",{value:!0}),Object.keys(es).forEach(function(rs){var ns=Object.getOwnPropertyDescriptor(es,rs);Object.defineProperty(ss,rs,ns.get?ns:{enumerable:!0,get:function(){return es[rs]}})}),ss}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$2=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$2=Symbol.for("react.strict_mode"),r$2=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$2=Symbol.iterator;function A$2(es){return es===null||typeof es!="object"?null:(es=z$2&&es[z$2]||es["@@iterator"],typeof es=="function"?es:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$2={};function E$2(es,ts,ss){this.props=es,this.context=ts,this.refs=D$2,this.updater=ss||B$2}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(es,ts){if(typeof es!="object"&&typeof es!="function"&&es!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,es,ts,"setState")};E$2.prototype.forceUpdate=function(es){this.updater.enqueueForceUpdate(this,es,"forceUpdate")};function F$1(){}F$1.prototype=E$2.prototype;function G$2(es,ts,ss){this.props=es,this.context=ts,this.refs=D$2,this.updater=ss||B$2}var H$2=G$2.prototype=new F$1;H$2.constructor=G$2;C$2(H$2,E$2.prototype);H$2.isPureReactComponent=!0;var I$2=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$2={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(es,ts,ss){var rs,ns={},os=null,as=null;if(ts!=null)for(rs in ts.ref!==void 0&&(as=ts.ref),ts.key!==void 0&&(os=""+ts.key),ts)J$1.call(ts,rs)&&!L$2.hasOwnProperty(rs)&&(ns[rs]=ts[rs]);var ls=arguments.length-2;if(ls===1)ns.children=ss;else if(1<ls){for(var cs=Array(ls),us=0;us<ls;us++)cs[us]=arguments[us+2];ns.children=cs}if(es&&es.defaultProps)for(rs in ls=es.defaultProps,ls)ns[rs]===void 0&&(ns[rs]=ls[rs]);return{$$typeof:l$2,type:es,key:os,ref:as,props:ns,_owner:K$2.current}}function N$2(es,ts){return{$$typeof:l$2,type:es.type,key:ts,ref:es.ref,props:es.props,_owner:es._owner}}function O$2(es){return typeof es=="object"&&es!==null&&es.$$typeof===l$2}function escape$1(es){var ts={"=":"=0",":":"=2"};return"$"+es.replace(/[=:]/g,function(ss){return ts[ss]})}var P$2=/\/+/g;function Q$2(es,ts){return typeof es=="object"&&es!==null&&es.key!=null?escape$1(""+es.key):ts.toString(36)}function R$2(es,ts,ss,rs,ns){var os=typeof es;(os==="undefined"||os==="boolean")&&(es=null);var as=!1;if(es===null)as=!0;else switch(os){case"string":case"number":as=!0;break;case"object":switch(es.$$typeof){case l$2:case n$2:as=!0}}if(as)return as=es,ns=ns(as),es=rs===""?"."+Q$2(as,0):rs,I$2(ns)?(ss="",es!=null&&(ss=es.replace(P$2,"$&/")+"/"),R$2(ns,ts,ss,"",function(us){return us})):ns!=null&&(O$2(ns)&&(ns=N$2(ns,ss+(!ns.key||as&&as.key===ns.key?"":(""+ns.key).replace(P$2,"$&/")+"/")+es)),ts.push(ns)),1;if(as=0,rs=rs===""?".":rs+":",I$2(es))for(var ls=0;ls<es.length;ls++){os=es[ls];var cs=rs+Q$2(os,ls);as+=R$2(os,ts,ss,cs,ns)}else if(cs=A$2(es),typeof cs=="function")for(es=cs.call(es),ls=0;!(os=es.next()).done;)os=os.value,cs=rs+Q$2(os,ls++),as+=R$2(os,ts,ss,cs,ns);else if(os==="object")throw ts=String(es),Error("Objects are not valid as a React child (found: "+(ts==="[object Object]"?"object with keys {"+Object.keys(es).join(", ")+"}":ts)+"). If you meant to render a collection of children, use an array instead.");return as}function S$2(es,ts,ss){if(es==null)return es;var rs=[],ns=0;return R$2(es,rs,"","",function(os){return ts.call(ss,os,ns++)}),rs}function T$2(es){if(es._status===-1){var ts=es._result;ts=ts(),ts.then(function(ss){(es._status===0||es._status===-1)&&(es._status=1,es._result=ss)},function(ss){(es._status===0||es._status===-1)&&(es._status=2,es._result=ss)}),es._status===-1&&(es._status=0,es._result=ts)}if(es._status===1)return es._result.default;throw es._result}var U$2={current:null},V$2={transition:null},W$2={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$2};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(es,ts,ss){S$2(es,function(){ts.apply(this,arguments)},ss)},count:function(es){var ts=0;return S$2(es,function(){ts++}),ts},toArray:function(es){return S$2(es,function(ts){return ts})||[]},only:function(es){if(!O$2(es))throw Error("React.Children.only expected to receive a single React element child.");return es}};react_production_min.Component=E$2;react_production_min.Fragment=p$3;react_production_min.Profiler=r$2;react_production_min.PureComponent=G$2;react_production_min.StrictMode=q$2;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$2;react_production_min.act=X$2;react_production_min.cloneElement=function(es,ts,ss){if(es==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+es+".");var rs=C$2({},es.props),ns=es.key,os=es.ref,as=es._owner;if(ts!=null){if(ts.ref!==void 0&&(os=ts.ref,as=K$2.current),ts.key!==void 0&&(ns=""+ts.key),es.type&&es.type.defaultProps)var ls=es.type.defaultProps;for(cs in ts)J$1.call(ts,cs)&&!L$2.hasOwnProperty(cs)&&(rs[cs]=ts[cs]===void 0&&ls!==void 0?ls[cs]:ts[cs])}var cs=arguments.length-2;if(cs===1)rs.children=ss;else if(1<cs){ls=Array(cs);for(var us=0;us<cs;us++)ls[us]=arguments[us+2];rs.children=ls}return{$$typeof:l$2,type:es.type,key:ns,ref:os,props:rs,_owner:as}};react_production_min.createContext=function(es){return es={$$typeof:u$1,_currentValue:es,_currentValue2:es,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},es.Provider={$$typeof:t$1,_context:es},es.Consumer=es};react_production_min.createElement=M$2;react_production_min.createFactory=function(es){var ts=M$2.bind(null,es);return ts.type=es,ts};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(es){return{$$typeof:v$2,render:es}};react_production_min.isValidElement=O$2;react_production_min.lazy=function(es){return{$$typeof:y$1,_payload:{_status:-1,_result:es},_init:T$2}};react_production_min.memo=function(es,ts){return{$$typeof:x$1,type:es,compare:ts===void 0?null:ts}};react_production_min.startTransition=function(es){var ts=V$2.transition;V$2.transition={};try{es()}finally{V$2.transition=ts}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(es,ts){return U$2.current.useCallback(es,ts)};react_production_min.useContext=function(es){return U$2.current.useContext(es)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(es){return U$2.current.useDeferredValue(es)};react_production_min.useEffect=function(es,ts){return U$2.current.useEffect(es,ts)};react_production_min.useId=function(){return U$2.current.useId()};react_production_min.useImperativeHandle=function(es,ts,ss){return U$2.current.useImperativeHandle(es,ts,ss)};react_production_min.useInsertionEffect=function(es,ts){return U$2.current.useInsertionEffect(es,ts)};react_production_min.useLayoutEffect=function(es,ts){return U$2.current.useLayoutEffect(es,ts)};react_production_min.useMemo=function(es,ts){return U$2.current.useMemo(es,ts)};react_production_min.useReducer=function(es,ts,ss){return U$2.current.useReducer(es,ts,ss)};react_production_min.useRef=function(es){return U$2.current.useRef(es)};react_production_min.useState=function(es){return U$2.current.useState(es)};react_production_min.useSyncExternalStore=function(es,ts,ss){return U$2.current.useSyncExternalStore(es,ts,ss)};react_production_min.useTransition=function(){return U$2.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React$2=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$1=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q$1(es,ts,ss){var rs,ns={},os=null,as=null;ss!==void 0&&(os=""+ss),ts.key!==void 0&&(os=""+ts.key),ts.ref!==void 0&&(as=ts.ref);for(rs in ts)m$2.call(ts,rs)&&!p$2.hasOwnProperty(rs)&&(ns[rs]=ts[rs]);if(es&&es.defaultProps)for(rs in ts=es.defaultProps,ts)ns[rs]===void 0&&(ns[rs]=ts[rs]);return{$$typeof:k$1,type:es,key:os,ref:as,props:ns,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1;reactJsxRuntime_production_min.jsx=q$1;reactJsxRuntime_production_min.jsxs=q$1;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(es){function ts(Ws,Is){var Bs=Ws.length;Ws.push(Is);e:for(;0<Bs;){var Vs=Bs-1>>>1,Ds=Ws[Vs];if(0<ns(Ds,Is))Ws[Vs]=Is,Ws[Bs]=Ds,Bs=Vs;else break e}}function ss(Ws){return Ws.length===0?null:Ws[0]}function rs(Ws){if(Ws.length===0)return null;var Is=Ws[0],Bs=Ws.pop();if(Bs!==Is){Ws[0]=Bs;e:for(var Vs=0,Ds=Ws.length,Cs=Ds>>>1;Vs<Cs;){var Ts=2*(Vs+1)-1,$s=Ws[Ts],Ps=Ts+1,Fs=Ws[Ps];if(0>ns($s,Bs))Ps<Ds&&0>ns(Fs,$s)?(Ws[Vs]=Fs,Ws[Ps]=Bs,Vs=Ps):(Ws[Vs]=$s,Ws[Ts]=Bs,Vs=Ts);else if(Ps<Ds&&0>ns(Fs,Bs))Ws[Vs]=Fs,Ws[Ps]=Bs,Vs=Ps;else break e}}return Is}function ns(Ws,Is){var Bs=Ws.sortIndex-Is.sortIndex;return Bs!==0?Bs:Ws.id-Is.id}if(typeof performance=="object"&&typeof performance.now=="function"){var os=performance;es.unstable_now=function(){return os.now()}}else{var as=Date,ls=as.now();es.unstable_now=function(){return as.now()-ls}}var cs=[],us=[],ds=1,ms=null,ps=3,hs=!1,xs=!1,ys=!1,vs=typeof setTimeout=="function"?setTimeout:null,gs=typeof clearTimeout=="function"?clearTimeout:null,fs=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function js(Ws){for(var Is=ss(us);Is!==null;){if(Is.callback===null)rs(us);else if(Is.startTime<=Ws)rs(us),Is.sortIndex=Is.expirationTime,ts(cs,Is);else break;Is=ss(us)}}function Ss(Ws){if(ys=!1,js(Ws),!xs)if(ss(cs)!==null)xs=!0,Qs(bs);else{var Is=ss(us);Is!==null&&Ys(Ss,Is.startTime-Ws)}}function bs(Ws,Is){xs=!1,ys&&(ys=!1,gs(ws),ws=-1),hs=!0;var Bs=ps;try{for(js(Is),ms=ss(cs);ms!==null&&(!(ms.expirationTime>Is)||Ws&&!_s());){var Vs=ms.callback;if(typeof Vs=="function"){ms.callback=null,ps=ms.priorityLevel;var Ds=Vs(ms.expirationTime<=Is);Is=es.unstable_now(),typeof Ds=="function"?ms.callback=Ds:ms===ss(cs)&&rs(cs),js(Is)}else rs(cs);ms=ss(cs)}if(ms!==null)var Cs=!0;else{var Ts=ss(us);Ts!==null&&Ys(Ss,Ts.startTime-Is),Cs=!1}return Cs}finally{ms=null,ps=Bs,hs=!1}}var Es=!1,Rs=null,ws=-1,Ns=5,ks=-1;function _s(){return!(es.unstable_now()-ks<Ns)}function Ls(){if(Rs!==null){var Ws=es.unstable_now();ks=Ws;var Is=!0;try{Is=Rs(!0,Ws)}finally{Is?Os():(Es=!1,Rs=null)}}else Es=!1}var Os;if(typeof fs=="function")Os=function(){fs(Ls)};else if(typeof MessageChannel<"u"){var zs=new MessageChannel,qs=zs.port2;zs.port1.onmessage=Ls,Os=function(){qs.postMessage(null)}}else Os=function(){vs(Ls,0)};function Qs(Ws){Rs=Ws,Es||(Es=!0,Os())}function Ys(Ws,Is){ws=vs(function(){Ws(es.unstable_now())},Is)}es.unstable_IdlePriority=5,es.unstable_ImmediatePriority=1,es.unstable_LowPriority=4,es.unstable_NormalPriority=3,es.unstable_Profiling=null,es.unstable_UserBlockingPriority=2,es.unstable_cancelCallback=function(Ws){Ws.callback=null},es.unstable_continueExecution=function(){xs||hs||(xs=!0,Qs(bs))},es.unstable_forceFrameRate=function(Ws){0>Ws||125<Ws?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ns=0<Ws?Math.floor(1e3/Ws):5},es.unstable_getCurrentPriorityLevel=function(){return ps},es.unstable_getFirstCallbackNode=function(){return ss(cs)},es.unstable_next=function(Ws){switch(ps){case 1:case 2:case 3:var Is=3;break;default:Is=ps}var Bs=ps;ps=Is;try{return Ws()}finally{ps=Bs}},es.unstable_pauseExecution=function(){},es.unstable_requestPaint=function(){},es.unstable_runWithPriority=function(Ws,Is){switch(Ws){case 1:case 2:case 3:case 4:case 5:break;default:Ws=3}var Bs=ps;ps=Ws;try{return Is()}finally{ps=Bs}},es.unstable_scheduleCallback=function(Ws,Is,Bs){var Vs=es.unstable_now();switch(typeof Bs=="object"&&Bs!==null?(Bs=Bs.delay,Bs=typeof Bs=="number"&&0<Bs?Vs+Bs:Vs):Bs=Vs,Ws){case 1:var Ds=-1;break;case 2:Ds=250;break;case 5:Ds=1073741823;break;case 4:Ds=1e4;break;default:Ds=5e3}return Ds=Bs+Ds,Ws={id:ds++,callback:Is,priorityLevel:Ws,startTime:Bs,expirationTime:Ds,sortIndex:-1},Bs>Vs?(Ws.sortIndex=Bs,ts(us,Ws),ss(cs)===null&&Ws===ss(us)&&(ys?(gs(ws),ws=-1):ys=!0,Ys(Ss,Bs-Vs))):(Ws.sortIndex=Ds,ts(cs,Ws),xs||hs||(xs=!0,Qs(bs))),Ws},es.unstable_shouldYield=_s,es.unstable_wrapCallback=function(Ws){var Is=ps;return function(){var Bs=ps;ps=Is;try{return Ws.apply(this,arguments)}finally{ps=Bs}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(es){for(var ts="https://reactjs.org/docs/error-decoder.html?invariant="+es,ss=1;ss<arguments.length;ss++)ts+="&args[]="+encodeURIComponent(arguments[ss]);return"Minified React error #"+es+"; visit "+ts+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(es,ts){ha(es,ts),ha(es+"Capture",ts)}function ha(es,ts){for(ea[es]=ts,es=0;es<ts.length;es++)da.add(ts[es])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(es){return ja.call(ma,es)?!0:ja.call(la,es)?!1:ka.test(es)?ma[es]=!0:(la[es]=!0,!1)}function pa(es,ts,ss,rs){if(ss!==null&&ss.type===0)return!1;switch(typeof ts){case"function":case"symbol":return!0;case"boolean":return rs?!1:ss!==null?!ss.acceptsBooleans:(es=es.toLowerCase().slice(0,5),es!=="data-"&&es!=="aria-");default:return!1}}function qa(es,ts,ss,rs){if(ts===null||typeof ts>"u"||pa(es,ts,ss,rs))return!0;if(rs)return!1;if(ss!==null)switch(ss.type){case 3:return!ts;case 4:return ts===!1;case 5:return isNaN(ts);case 6:return isNaN(ts)||1>ts}return!1}function v$1(es,ts,ss,rs,ns,os,as){this.acceptsBooleans=ts===2||ts===3||ts===4,this.attributeName=rs,this.attributeNamespace=ns,this.mustUseProperty=ss,this.propertyName=es,this.type=ts,this.sanitizeURL=os,this.removeEmptyString=as}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(es){z$1[es]=new v$1(es,0,!1,es,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(es){var ts=es[0];z$1[ts]=new v$1(ts,1,!1,es[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(es){z$1[es]=new v$1(es,2,!1,es.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(es){z$1[es]=new v$1(es,2,!1,es,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(es){z$1[es]=new v$1(es,3,!1,es.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(es){z$1[es]=new v$1(es,3,!0,es,null,!1,!1)});["capture","download"].forEach(function(es){z$1[es]=new v$1(es,4,!1,es,null,!1,!1)});["cols","rows","size","span"].forEach(function(es){z$1[es]=new v$1(es,6,!1,es,null,!1,!1)});["rowSpan","start"].forEach(function(es){z$1[es]=new v$1(es,5,!1,es.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(es){return es[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(es){var ts=es.replace(ra,sa);z$1[ts]=new v$1(ts,1,!1,es,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(es){var ts=es.replace(ra,sa);z$1[ts]=new v$1(ts,1,!1,es,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(es){var ts=es.replace(ra,sa);z$1[ts]=new v$1(ts,1,!1,es,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(es){z$1[es]=new v$1(es,1,!1,es.toLowerCase(),null,!1,!1)});z$1.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(es){z$1[es]=new v$1(es,1,!1,es.toLowerCase(),null,!0,!0)});function ta(es,ts,ss,rs){var ns=z$1.hasOwnProperty(ts)?z$1[ts]:null;(ns!==null?ns.type!==0:rs||!(2<ts.length)||ts[0]!=="o"&&ts[0]!=="O"||ts[1]!=="n"&&ts[1]!=="N")&&(qa(ts,ss,ns,rs)&&(ss=null),rs||ns===null?oa(ts)&&(ss===null?es.removeAttribute(ts):es.setAttribute(ts,""+ss)):ns.mustUseProperty?es[ns.propertyName]=ss===null?ns.type===3?!1:"":ss:(ts=ns.attributeName,rs=ns.attributeNamespace,ss===null?es.removeAttribute(ts):(ns=ns.type,ss=ns===3||ns===4&&ss===!0?"":""+ss,rs?es.setAttributeNS(rs,ts,ss):es.setAttribute(ts,ss))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(es){return es===null||typeof es!="object"?null:(es=Ja&&es[Ja]||es["@@iterator"],typeof es=="function"?es:null)}var A$1=Object.assign,La;function Ma(es){if(La===void 0)try{throw Error()}catch(ss){var ts=ss.stack.trim().match(/\n( *(at )?)/);La=ts&&ts[1]||""}return`
`+La+es}var Na=!1;function Oa(es,ts){if(!es||Na)return"";Na=!0;var ss=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(ts)if(ts=function(){throw Error()},Object.defineProperty(ts.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ts,[])}catch(us){var rs=us}Reflect.construct(es,[],ts)}else{try{ts.call()}catch(us){rs=us}es.call(ts.prototype)}else{try{throw Error()}catch(us){rs=us}es()}}catch(us){if(us&&rs&&typeof us.stack=="string"){for(var ns=us.stack.split(`
`),os=rs.stack.split(`
`),as=ns.length-1,ls=os.length-1;1<=as&&0<=ls&&ns[as]!==os[ls];)ls--;for(;1<=as&&0<=ls;as--,ls--)if(ns[as]!==os[ls]){if(as!==1||ls!==1)do if(as--,ls--,0>ls||ns[as]!==os[ls]){var cs=`
`+ns[as].replace(" at new "," at ");return es.displayName&&cs.includes("<anonymous>")&&(cs=cs.replace("<anonymous>",es.displayName)),cs}while(1<=as&&0<=ls);break}}}finally{Na=!1,Error.prepareStackTrace=ss}return(es=es?es.displayName||es.name:"")?Ma(es):""}function Pa(es){switch(es.tag){case 5:return Ma(es.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return es=Oa(es.type,!1),es;case 11:return es=Oa(es.type.render,!1),es;case 1:return es=Oa(es.type,!0),es;default:return""}}function Qa(es){if(es==null)return null;if(typeof es=="function")return es.displayName||es.name||null;if(typeof es=="string")return es;switch(es){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof es=="object")switch(es.$$typeof){case Ca:return(es.displayName||"Context")+".Consumer";case Ba:return(es._context.displayName||"Context")+".Provider";case Da:var ts=es.render;return es=es.displayName,es||(es=ts.displayName||ts.name||"",es=es!==""?"ForwardRef("+es+")":"ForwardRef"),es;case Ga:return ts=es.displayName||null,ts!==null?ts:Qa(es.type)||"Memo";case Ha:ts=es._payload,es=es._init;try{return Qa(es(ts))}catch{}}return null}function Ra(es){var ts=es.type;switch(es.tag){case 24:return"Cache";case 9:return(ts.displayName||"Context")+".Consumer";case 10:return(ts._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return es=ts.render,es=es.displayName||es.name||"",ts.displayName||(es!==""?"ForwardRef("+es+")":"ForwardRef");case 7:return"Fragment";case 5:return ts;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(ts);case 8:return ts===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof ts=="function")return ts.displayName||ts.name||null;if(typeof ts=="string")return ts}return null}function Sa(es){switch(typeof es){case"boolean":case"number":case"string":case"undefined":return es;case"object":return es;default:return""}}function Ta(es){var ts=es.type;return(es=es.nodeName)&&es.toLowerCase()==="input"&&(ts==="checkbox"||ts==="radio")}function Ua(es){var ts=Ta(es)?"checked":"value",ss=Object.getOwnPropertyDescriptor(es.constructor.prototype,ts),rs=""+es[ts];if(!es.hasOwnProperty(ts)&&typeof ss<"u"&&typeof ss.get=="function"&&typeof ss.set=="function"){var ns=ss.get,os=ss.set;return Object.defineProperty(es,ts,{configurable:!0,get:function(){return ns.call(this)},set:function(as){rs=""+as,os.call(this,as)}}),Object.defineProperty(es,ts,{enumerable:ss.enumerable}),{getValue:function(){return rs},setValue:function(as){rs=""+as},stopTracking:function(){es._valueTracker=null,delete es[ts]}}}}function Va(es){es._valueTracker||(es._valueTracker=Ua(es))}function Wa(es){if(!es)return!1;var ts=es._valueTracker;if(!ts)return!0;var ss=ts.getValue(),rs="";return es&&(rs=Ta(es)?es.checked?"true":"false":es.value),es=rs,es!==ss?(ts.setValue(es),!0):!1}function Xa(es){if(es=es||(typeof document<"u"?document:void 0),typeof es>"u")return null;try{return es.activeElement||es.body}catch{return es.body}}function Ya(es,ts){var ss=ts.checked;return A$1({},ts,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:ss??es._wrapperState.initialChecked})}function Za(es,ts){var ss=ts.defaultValue==null?"":ts.defaultValue,rs=ts.checked!=null?ts.checked:ts.defaultChecked;ss=Sa(ts.value!=null?ts.value:ss),es._wrapperState={initialChecked:rs,initialValue:ss,controlled:ts.type==="checkbox"||ts.type==="radio"?ts.checked!=null:ts.value!=null}}function ab(es,ts){ts=ts.checked,ts!=null&&ta(es,"checked",ts,!1)}function bb(es,ts){ab(es,ts);var ss=Sa(ts.value),rs=ts.type;if(ss!=null)rs==="number"?(ss===0&&es.value===""||es.value!=ss)&&(es.value=""+ss):es.value!==""+ss&&(es.value=""+ss);else if(rs==="submit"||rs==="reset"){es.removeAttribute("value");return}ts.hasOwnProperty("value")?cb(es,ts.type,ss):ts.hasOwnProperty("defaultValue")&&cb(es,ts.type,Sa(ts.defaultValue)),ts.checked==null&&ts.defaultChecked!=null&&(es.defaultChecked=!!ts.defaultChecked)}function db$1(es,ts,ss){if(ts.hasOwnProperty("value")||ts.hasOwnProperty("defaultValue")){var rs=ts.type;if(!(rs!=="submit"&&rs!=="reset"||ts.value!==void 0&&ts.value!==null))return;ts=""+es._wrapperState.initialValue,ss||ts===es.value||(es.value=ts),es.defaultValue=ts}ss=es.name,ss!==""&&(es.name=""),es.defaultChecked=!!es._wrapperState.initialChecked,ss!==""&&(es.name=ss)}function cb(es,ts,ss){(ts!=="number"||Xa(es.ownerDocument)!==es)&&(ss==null?es.defaultValue=""+es._wrapperState.initialValue:es.defaultValue!==""+ss&&(es.defaultValue=""+ss))}var eb=Array.isArray;function fb(es,ts,ss,rs){if(es=es.options,ts){ts={};for(var ns=0;ns<ss.length;ns++)ts["$"+ss[ns]]=!0;for(ss=0;ss<es.length;ss++)ns=ts.hasOwnProperty("$"+es[ss].value),es[ss].selected!==ns&&(es[ss].selected=ns),ns&&rs&&(es[ss].defaultSelected=!0)}else{for(ss=""+Sa(ss),ts=null,ns=0;ns<es.length;ns++){if(es[ns].value===ss){es[ns].selected=!0,rs&&(es[ns].defaultSelected=!0);return}ts!==null||es[ns].disabled||(ts=es[ns])}ts!==null&&(ts.selected=!0)}}function gb(es,ts){if(ts.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},ts,{value:void 0,defaultValue:void 0,children:""+es._wrapperState.initialValue})}function hb(es,ts){var ss=ts.value;if(ss==null){if(ss=ts.children,ts=ts.defaultValue,ss!=null){if(ts!=null)throw Error(p$1(92));if(eb(ss)){if(1<ss.length)throw Error(p$1(93));ss=ss[0]}ts=ss}ts==null&&(ts=""),ss=ts}es._wrapperState={initialValue:Sa(ss)}}function ib(es,ts){var ss=Sa(ts.value),rs=Sa(ts.defaultValue);ss!=null&&(ss=""+ss,ss!==es.value&&(es.value=ss),ts.defaultValue==null&&es.defaultValue!==ss&&(es.defaultValue=ss)),rs!=null&&(es.defaultValue=""+rs)}function jb(es){var ts=es.textContent;ts===es._wrapperState.initialValue&&ts!==""&&ts!==null&&(es.value=ts)}function kb(es){switch(es){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(es,ts){return es==null||es==="http://www.w3.org/1999/xhtml"?kb(ts):es==="http://www.w3.org/2000/svg"&&ts==="foreignObject"?"http://www.w3.org/1999/xhtml":es}var mb,nb=function(es){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(ts,ss,rs,ns){MSApp.execUnsafeLocalFunction(function(){return es(ts,ss,rs,ns)})}:es}(function(es,ts){if(es.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in es)es.innerHTML=ts;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+ts.valueOf().toString()+"</svg>",ts=mb.firstChild;es.firstChild;)es.removeChild(es.firstChild);for(;ts.firstChild;)es.appendChild(ts.firstChild)}});function ob(es,ts){if(ts){var ss=es.firstChild;if(ss&&ss===es.lastChild&&ss.nodeType===3){ss.nodeValue=ts;return}}es.textContent=ts}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(es){qb.forEach(function(ts){ts=ts+es.charAt(0).toUpperCase()+es.substring(1),pb[ts]=pb[es]})});function rb(es,ts,ss){return ts==null||typeof ts=="boolean"||ts===""?"":ss||typeof ts!="number"||ts===0||pb.hasOwnProperty(es)&&pb[es]?(""+ts).trim():ts+"px"}function sb(es,ts){es=es.style;for(var ss in ts)if(ts.hasOwnProperty(ss)){var rs=ss.indexOf("--")===0,ns=rb(ss,ts[ss],rs);ss==="float"&&(ss="cssFloat"),rs?es.setProperty(ss,ns):es[ss]=ns}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(es,ts){if(ts){if(tb[es]&&(ts.children!=null||ts.dangerouslySetInnerHTML!=null))throw Error(p$1(137,es));if(ts.dangerouslySetInnerHTML!=null){if(ts.children!=null)throw Error(p$1(60));if(typeof ts.dangerouslySetInnerHTML!="object"||!("__html"in ts.dangerouslySetInnerHTML))throw Error(p$1(61))}if(ts.style!=null&&typeof ts.style!="object")throw Error(p$1(62))}}function vb(es,ts){if(es.indexOf("-")===-1)return typeof ts.is=="string";switch(es){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(es){return es=es.target||es.srcElement||window,es.correspondingUseElement&&(es=es.correspondingUseElement),es.nodeType===3?es.parentNode:es}var yb=null,zb=null,Ab=null;function Bb(es){if(es=Cb(es)){if(typeof yb!="function")throw Error(p$1(280));var ts=es.stateNode;ts&&(ts=Db(ts),yb(es.stateNode,es.type,ts))}}function Eb(es){zb?Ab?Ab.push(es):Ab=[es]:zb=es}function Fb(){if(zb){var es=zb,ts=Ab;if(Ab=zb=null,Bb(es),ts)for(es=0;es<ts.length;es++)Bb(ts[es])}}function Gb(es,ts){return es(ts)}function Hb(){}var Ib=!1;function Jb(es,ts,ss){if(Ib)return es(ts,ss);Ib=!0;try{return Gb(es,ts,ss)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(es,ts){var ss=es.stateNode;if(ss===null)return null;var rs=Db(ss);if(rs===null)return null;ss=rs[ts];e:switch(ts){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(rs=!rs.disabled)||(es=es.type,rs=!(es==="button"||es==="input"||es==="select"||es==="textarea")),es=!rs;break e;default:es=!1}if(es)return null;if(ss&&typeof ss!="function")throw Error(p$1(231,ts,typeof ss));return ss}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(es,ts,ss,rs,ns,os,as,ls,cs){var us=Array.prototype.slice.call(arguments,3);try{ts.apply(ss,us)}catch(ds){this.onError(ds)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(es){Ob=!0,Pb=es}};function Tb(es,ts,ss,rs,ns,os,as,ls,cs){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(es,ts,ss,rs,ns,os,as,ls,cs){if(Tb.apply(this,arguments),Ob){if(Ob){var us=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=us)}}function Vb(es){var ts=es,ss=es;if(es.alternate)for(;ts.return;)ts=ts.return;else{es=ts;do ts=es,ts.flags&4098&&(ss=ts.return),es=ts.return;while(es)}return ts.tag===3?ss:null}function Wb(es){if(es.tag===13){var ts=es.memoizedState;if(ts===null&&(es=es.alternate,es!==null&&(ts=es.memoizedState)),ts!==null)return ts.dehydrated}return null}function Xb(es){if(Vb(es)!==es)throw Error(p$1(188))}function Yb(es){var ts=es.alternate;if(!ts){if(ts=Vb(es),ts===null)throw Error(p$1(188));return ts!==es?null:es}for(var ss=es,rs=ts;;){var ns=ss.return;if(ns===null)break;var os=ns.alternate;if(os===null){if(rs=ns.return,rs!==null){ss=rs;continue}break}if(ns.child===os.child){for(os=ns.child;os;){if(os===ss)return Xb(ns),es;if(os===rs)return Xb(ns),ts;os=os.sibling}throw Error(p$1(188))}if(ss.return!==rs.return)ss=ns,rs=os;else{for(var as=!1,ls=ns.child;ls;){if(ls===ss){as=!0,ss=ns,rs=os;break}if(ls===rs){as=!0,rs=ns,ss=os;break}ls=ls.sibling}if(!as){for(ls=os.child;ls;){if(ls===ss){as=!0,ss=os,rs=ns;break}if(ls===rs){as=!0,rs=os,ss=ns;break}ls=ls.sibling}if(!as)throw Error(p$1(189))}}if(ss.alternate!==rs)throw Error(p$1(190))}if(ss.tag!==3)throw Error(p$1(188));return ss.stateNode.current===ss?es:ts}function Zb(es){return es=Yb(es),es!==null?$b(es):null}function $b(es){if(es.tag===5||es.tag===6)return es;for(es=es.child;es!==null;){var ts=$b(es);if(ts!==null)return ts;es=es.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(es){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,es,void 0,(es.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(es){return es>>>=0,es===0?32:31-(pc(es)/qc|0)|0}var rc=64,sc=4194304;function tc(es){switch(es&-es){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return es&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return es&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return es}}function uc(es,ts){var ss=es.pendingLanes;if(ss===0)return 0;var rs=0,ns=es.suspendedLanes,os=es.pingedLanes,as=ss&268435455;if(as!==0){var ls=as&~ns;ls!==0?rs=tc(ls):(os&=as,os!==0&&(rs=tc(os)))}else as=ss&~ns,as!==0?rs=tc(as):os!==0&&(rs=tc(os));if(rs===0)return 0;if(ts!==0&&ts!==rs&&!(ts&ns)&&(ns=rs&-rs,os=ts&-ts,ns>=os||ns===16&&(os&4194240)!==0))return ts;if(rs&4&&(rs|=ss&16),ts=es.entangledLanes,ts!==0)for(es=es.entanglements,ts&=rs;0<ts;)ss=31-oc(ts),ns=1<<ss,rs|=es[ss],ts&=~ns;return rs}function vc(es,ts){switch(es){case 1:case 2:case 4:return ts+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return ts+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(es,ts){for(var ss=es.suspendedLanes,rs=es.pingedLanes,ns=es.expirationTimes,os=es.pendingLanes;0<os;){var as=31-oc(os),ls=1<<as,cs=ns[as];cs===-1?(!(ls&ss)||ls&rs)&&(ns[as]=vc(ls,ts)):cs<=ts&&(es.expiredLanes|=ls),os&=~ls}}function xc(es){return es=es.pendingLanes&-1073741825,es!==0?es:es&1073741824?1073741824:0}function yc(){var es=rc;return rc<<=1,!(rc&4194240)&&(rc=64),es}function zc(es){for(var ts=[],ss=0;31>ss;ss++)ts.push(es);return ts}function Ac(es,ts,ss){es.pendingLanes|=ts,ts!==536870912&&(es.suspendedLanes=0,es.pingedLanes=0),es=es.eventTimes,ts=31-oc(ts),es[ts]=ss}function Bc(es,ts){var ss=es.pendingLanes&~ts;es.pendingLanes=ts,es.suspendedLanes=0,es.pingedLanes=0,es.expiredLanes&=ts,es.mutableReadLanes&=ts,es.entangledLanes&=ts,ts=es.entanglements;var rs=es.eventTimes;for(es=es.expirationTimes;0<ss;){var ns=31-oc(ss),os=1<<ns;ts[ns]=0,rs[ns]=-1,es[ns]=-1,ss&=~os}}function Cc(es,ts){var ss=es.entangledLanes|=ts;for(es=es.entanglements;ss;){var rs=31-oc(ss),ns=1<<rs;ns&ts|es[rs]&ts&&(es[rs]|=ts),ss&=~ns}}var C$1=0;function Dc(es){return es&=-es,1<es?4<es?es&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(es,ts){switch(es){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(ts.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(ts.pointerId)}}function Tc(es,ts,ss,rs,ns,os){return es===null||es.nativeEvent!==os?(es={blockedOn:ts,domEventName:ss,eventSystemFlags:rs,nativeEvent:os,targetContainers:[ns]},ts!==null&&(ts=Cb(ts),ts!==null&&Fc(ts)),es):(es.eventSystemFlags|=rs,ts=es.targetContainers,ns!==null&&ts.indexOf(ns)===-1&&ts.push(ns),es)}function Uc(es,ts,ss,rs,ns){switch(ts){case"focusin":return Lc=Tc(Lc,es,ts,ss,rs,ns),!0;case"dragenter":return Mc=Tc(Mc,es,ts,ss,rs,ns),!0;case"mouseover":return Nc=Tc(Nc,es,ts,ss,rs,ns),!0;case"pointerover":var os=ns.pointerId;return Oc.set(os,Tc(Oc.get(os)||null,es,ts,ss,rs,ns)),!0;case"gotpointercapture":return os=ns.pointerId,Pc.set(os,Tc(Pc.get(os)||null,es,ts,ss,rs,ns)),!0}return!1}function Vc(es){var ts=Wc(es.target);if(ts!==null){var ss=Vb(ts);if(ss!==null){if(ts=ss.tag,ts===13){if(ts=Wb(ss),ts!==null){es.blockedOn=ts,Ic(es.priority,function(){Gc(ss)});return}}else if(ts===3&&ss.stateNode.current.memoizedState.isDehydrated){es.blockedOn=ss.tag===3?ss.stateNode.containerInfo:null;return}}}es.blockedOn=null}function Xc(es){if(es.blockedOn!==null)return!1;for(var ts=es.targetContainers;0<ts.length;){var ss=Yc(es.domEventName,es.eventSystemFlags,ts[0],es.nativeEvent);if(ss===null){ss=es.nativeEvent;var rs=new ss.constructor(ss.type,ss);wb=rs,ss.target.dispatchEvent(rs),wb=null}else return ts=Cb(ss),ts!==null&&Fc(ts),es.blockedOn=ss,!1;ts.shift()}return!0}function Zc(es,ts,ss){Xc(es)&&ss.delete(ts)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(es,ts){es.blockedOn===ts&&(es.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(es){function ts(ns){return ad(ns,es)}if(0<Kc.length){ad(Kc[0],es);for(var ss=1;ss<Kc.length;ss++){var rs=Kc[ss];rs.blockedOn===es&&(rs.blockedOn=null)}}for(Lc!==null&&ad(Lc,es),Mc!==null&&ad(Mc,es),Nc!==null&&ad(Nc,es),Oc.forEach(ts),Pc.forEach(ts),ss=0;ss<Qc.length;ss++)rs=Qc[ss],rs.blockedOn===es&&(rs.blockedOn=null);for(;0<Qc.length&&(ss=Qc[0],ss.blockedOn===null);)Vc(ss),ss.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(es,ts,ss,rs){var ns=C$1,os=cd.transition;cd.transition=null;try{C$1=1,fd(es,ts,ss,rs)}finally{C$1=ns,cd.transition=os}}function gd(es,ts,ss,rs){var ns=C$1,os=cd.transition;cd.transition=null;try{C$1=4,fd(es,ts,ss,rs)}finally{C$1=ns,cd.transition=os}}function fd(es,ts,ss,rs){if(dd){var ns=Yc(es,ts,ss,rs);if(ns===null)hd(es,ts,rs,id,ss),Sc(es,rs);else if(Uc(ns,es,ts,ss,rs))rs.stopPropagation();else if(Sc(es,rs),ts&4&&-1<Rc.indexOf(es)){for(;ns!==null;){var os=Cb(ns);if(os!==null&&Ec(os),os=Yc(es,ts,ss,rs),os===null&&hd(es,ts,rs,id,ss),os===ns)break;ns=os}ns!==null&&rs.stopPropagation()}else hd(es,ts,rs,null,ss)}}var id=null;function Yc(es,ts,ss,rs){if(id=null,es=xb(rs),es=Wc(es),es!==null)if(ts=Vb(es),ts===null)es=null;else if(ss=ts.tag,ss===13){if(es=Wb(ts),es!==null)return es;es=null}else if(ss===3){if(ts.stateNode.current.memoizedState.isDehydrated)return ts.tag===3?ts.stateNode.containerInfo:null;es=null}else ts!==es&&(es=null);return id=es,null}function jd(es){switch(es){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var es,ts=ld,ss=ts.length,rs,ns="value"in kd?kd.value:kd.textContent,os=ns.length;for(es=0;es<ss&&ts[es]===ns[es];es++);var as=ss-es;for(rs=1;rs<=as&&ts[ss-rs]===ns[os-rs];rs++);return md=ns.slice(es,1<rs?1-rs:void 0)}function od(es){var ts=es.keyCode;return"charCode"in es?(es=es.charCode,es===0&&ts===13&&(es=13)):es=ts,es===10&&(es=13),32<=es||es===13?es:0}function pd(){return!0}function qd(){return!1}function rd(es){function ts(ss,rs,ns,os,as){this._reactName=ss,this._targetInst=ns,this.type=rs,this.nativeEvent=os,this.target=as,this.currentTarget=null;for(var ls in es)es.hasOwnProperty(ls)&&(ss=es[ls],this[ls]=ss?ss(os):os[ls]);return this.isDefaultPrevented=(os.defaultPrevented!=null?os.defaultPrevented:os.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(ts.prototype,{preventDefault:function(){this.defaultPrevented=!0;var ss=this.nativeEvent;ss&&(ss.preventDefault?ss.preventDefault():typeof ss.returnValue!="unknown"&&(ss.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var ss=this.nativeEvent;ss&&(ss.stopPropagation?ss.stopPropagation():typeof ss.cancelBubble!="unknown"&&(ss.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),ts}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(es){return es.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(es){return es.relatedTarget===void 0?es.fromElement===es.srcElement?es.toElement:es.fromElement:es.relatedTarget},movementX:function(es){return"movementX"in es?es.movementX:(es!==yd&&(yd&&es.type==="mousemove"?(wd=es.screenX-yd.screenX,xd=es.screenY-yd.screenY):xd=wd=0,yd=es),wd)},movementY:function(es){return"movementY"in es?es.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(es){return"clipboardData"in es?es.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(es){var ts=this.nativeEvent;return ts.getModifierState?ts.getModifierState(es):(es=Od[es])?!!ts[es]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(es){if(es.key){var ts=Md[es.key]||es.key;if(ts!=="Unidentified")return ts}return es.type==="keypress"?(es=od(es),es===13?"Enter":String.fromCharCode(es)):es.type==="keydown"||es.type==="keyup"?Nd[es.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(es){return es.type==="keypress"?od(es):0},keyCode:function(es){return es.type==="keydown"||es.type==="keyup"?es.keyCode:0},which:function(es){return es.type==="keypress"?od(es):es.type==="keydown"||es.type==="keyup"?es.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(es){return"deltaX"in es?es.deltaX:"wheelDeltaX"in es?-es.wheelDeltaX:0},deltaY:function(es){return"deltaY"in es?es.deltaY:"wheelDeltaY"in es?-es.wheelDeltaY:"wheelDelta"in es?-es.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe$1=!1;function ge$1(es,ts){switch(es){case"keyup":return $d.indexOf(ts.keyCode)!==-1;case"keydown":return ts.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(es){return es=es.detail,typeof es=="object"&&"data"in es?es.data:null}var ie$1=!1;function je$1(es,ts){switch(es){case"compositionend":return he$1(ts);case"keypress":return ts.which!==32?null:(fe$1=!0,ee$1);case"textInput":return es=ts.data,es===ee$1&&fe$1?null:es;default:return null}}function ke$1(es,ts){if(ie$1)return es==="compositionend"||!ae$1&&ge$1(es,ts)?(es=nd(),md=ld=kd=null,ie$1=!1,es):null;switch(es){case"paste":return null;case"keypress":if(!(ts.ctrlKey||ts.altKey||ts.metaKey)||ts.ctrlKey&&ts.altKey){if(ts.char&&1<ts.char.length)return ts.char;if(ts.which)return String.fromCharCode(ts.which)}return null;case"compositionend":return de$1&&ts.locale!=="ko"?null:ts.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(es){var ts=es&&es.nodeName&&es.nodeName.toLowerCase();return ts==="input"?!!le$1[es.type]:ts==="textarea"}function ne$1(es,ts,ss,rs){Eb(rs),ts=oe$1(ts,"onChange"),0<ts.length&&(ss=new td("onChange","change",null,ss,rs),es.push({event:ss,listeners:ts}))}var pe$1=null,qe$1=null;function re$1(es){se$1(es,0)}function te$1(es){var ts=ue$1(es);if(Wa(ts))return es}function ve$1(es,ts){if(es==="change")return ts}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye$1=typeof ze$1.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(es){if(es.propertyName==="value"&&te$1(qe$1)){var ts=[];ne$1(ts,qe$1,es,xb(es)),Jb(re$1,ts)}}function Ce$1(es,ts,ss){es==="focusin"?(Ae$1(),pe$1=ts,qe$1=ss,pe$1.attachEvent("onpropertychange",Be$1)):es==="focusout"&&Ae$1()}function De$1(es){if(es==="selectionchange"||es==="keyup"||es==="keydown")return te$1(qe$1)}function Ee$1(es,ts){if(es==="click")return te$1(ts)}function Fe$1(es,ts){if(es==="input"||es==="change")return te$1(ts)}function Ge$1(es,ts){return es===ts&&(es!==0||1/es===1/ts)||es!==es&&ts!==ts}var He$1=typeof Object.is=="function"?Object.is:Ge$1;function Ie$1(es,ts){if(He$1(es,ts))return!0;if(typeof es!="object"||es===null||typeof ts!="object"||ts===null)return!1;var ss=Object.keys(es),rs=Object.keys(ts);if(ss.length!==rs.length)return!1;for(rs=0;rs<ss.length;rs++){var ns=ss[rs];if(!ja.call(ts,ns)||!He$1(es[ns],ts[ns]))return!1}return!0}function Je$1(es){for(;es&&es.firstChild;)es=es.firstChild;return es}function Ke$1(es,ts){var ss=Je$1(es);es=0;for(var rs;ss;){if(ss.nodeType===3){if(rs=es+ss.textContent.length,es<=ts&&rs>=ts)return{node:ss,offset:ts-es};es=rs}e:{for(;ss;){if(ss.nextSibling){ss=ss.nextSibling;break e}ss=ss.parentNode}ss=void 0}ss=Je$1(ss)}}function Le$1(es,ts){return es&&ts?es===ts?!0:es&&es.nodeType===3?!1:ts&&ts.nodeType===3?Le$1(es,ts.parentNode):"contains"in es?es.contains(ts):es.compareDocumentPosition?!!(es.compareDocumentPosition(ts)&16):!1:!1}function Me$1(){for(var es=window,ts=Xa();ts instanceof es.HTMLIFrameElement;){try{var ss=typeof ts.contentWindow.location.href=="string"}catch{ss=!1}if(ss)es=ts.contentWindow;else break;ts=Xa(es.document)}return ts}function Ne$1(es){var ts=es&&es.nodeName&&es.nodeName.toLowerCase();return ts&&(ts==="input"&&(es.type==="text"||es.type==="search"||es.type==="tel"||es.type==="url"||es.type==="password")||ts==="textarea"||es.contentEditable==="true")}function Oe$1(es){var ts=Me$1(),ss=es.focusedElem,rs=es.selectionRange;if(ts!==ss&&ss&&ss.ownerDocument&&Le$1(ss.ownerDocument.documentElement,ss)){if(rs!==null&&Ne$1(ss)){if(ts=rs.start,es=rs.end,es===void 0&&(es=ts),"selectionStart"in ss)ss.selectionStart=ts,ss.selectionEnd=Math.min(es,ss.value.length);else if(es=(ts=ss.ownerDocument||document)&&ts.defaultView||window,es.getSelection){es=es.getSelection();var ns=ss.textContent.length,os=Math.min(rs.start,ns);rs=rs.end===void 0?os:Math.min(rs.end,ns),!es.extend&&os>rs&&(ns=rs,rs=os,os=ns),ns=Ke$1(ss,os);var as=Ke$1(ss,rs);ns&&as&&(es.rangeCount!==1||es.anchorNode!==ns.node||es.anchorOffset!==ns.offset||es.focusNode!==as.node||es.focusOffset!==as.offset)&&(ts=ts.createRange(),ts.setStart(ns.node,ns.offset),es.removeAllRanges(),os>rs?(es.addRange(ts),es.extend(as.node,as.offset)):(ts.setEnd(as.node,as.offset),es.addRange(ts)))}}for(ts=[],es=ss;es=es.parentNode;)es.nodeType===1&&ts.push({element:es,left:es.scrollLeft,top:es.scrollTop});for(typeof ss.focus=="function"&&ss.focus(),ss=0;ss<ts.length;ss++)es=ts[ss],es.element.scrollLeft=es.left,es.element.scrollTop=es.top}}var Pe$1=ia&&"documentMode"in document&&11>=document.documentMode,Qe$1=null,Re$1=null,Se$1=null,Te$1=!1;function Ue$1(es,ts,ss){var rs=ss.window===ss?ss.document:ss.nodeType===9?ss:ss.ownerDocument;Te$1||Qe$1==null||Qe$1!==Xa(rs)||(rs=Qe$1,"selectionStart"in rs&&Ne$1(rs)?rs={start:rs.selectionStart,end:rs.selectionEnd}:(rs=(rs.ownerDocument&&rs.ownerDocument.defaultView||window).getSelection(),rs={anchorNode:rs.anchorNode,anchorOffset:rs.anchorOffset,focusNode:rs.focusNode,focusOffset:rs.focusOffset}),Se$1&&Ie$1(Se$1,rs)||(Se$1=rs,rs=oe$1(Re$1,"onSelect"),0<rs.length&&(ts=new td("onSelect","select",null,ts,ss),es.push({event:ts,listeners:rs}),ts.target=Qe$1)))}function Ve$1(es,ts){var ss={};return ss[es.toLowerCase()]=ts.toLowerCase(),ss["Webkit"+es]="webkit"+ts,ss["Moz"+es]="moz"+ts,ss}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe$1={},Ye$1={};ia&&(Ye$1=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);function Ze$1(es){if(Xe$1[es])return Xe$1[es];if(!We$1[es])return es;var ts=We$1[es],ss;for(ss in ts)if(ts.hasOwnProperty(ss)&&ss in Ye$1)return Xe$1[es]=ts[ss];return es}var $e$1=Ze$1("animationend"),af=Ze$1("animationiteration"),bf=Ze$1("animationstart"),cf=Ze$1("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(es,ts){df.set(es,ts),fa(ts,[es])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(es,ts,ss){var rs=es.type||"unknown-event";es.currentTarget=ss,Ub(rs,ts,void 0,es),es.currentTarget=null}function se$1(es,ts){ts=(ts&4)!==0;for(var ss=0;ss<es.length;ss++){var rs=es[ss],ns=rs.event;rs=rs.listeners;e:{var os=void 0;if(ts)for(var as=rs.length-1;0<=as;as--){var ls=rs[as],cs=ls.instance,us=ls.currentTarget;if(ls=ls.listener,cs!==os&&ns.isPropagationStopped())break e;nf(ns,ls,us),os=cs}else for(as=0;as<rs.length;as++){if(ls=rs[as],cs=ls.instance,us=ls.currentTarget,ls=ls.listener,cs!==os&&ns.isPropagationStopped())break e;nf(ns,ls,us),os=cs}}}if(Qb)throw es=Rb,Qb=!1,Rb=null,es}function D$1(es,ts){var ss=ts[of];ss===void 0&&(ss=ts[of]=new Set);var rs=es+"__bubble";ss.has(rs)||(pf(ts,es,2,!1),ss.add(rs))}function qf(es,ts,ss){var rs=0;ts&&(rs|=4),pf(ss,es,rs,ts)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(es){if(!es[rf]){es[rf]=!0,da.forEach(function(ss){ss!=="selectionchange"&&(mf.has(ss)||qf(ss,!1,es),qf(ss,!0,es))});var ts=es.nodeType===9?es:es.ownerDocument;ts===null||ts[rf]||(ts[rf]=!0,qf("selectionchange",!1,ts))}}function pf(es,ts,ss,rs){switch(jd(ts)){case 1:var ns=ed;break;case 4:ns=gd;break;default:ns=fd}ss=ns.bind(null,ts,ss,es),ns=void 0,!Lb||ts!=="touchstart"&&ts!=="touchmove"&&ts!=="wheel"||(ns=!0),rs?ns!==void 0?es.addEventListener(ts,ss,{capture:!0,passive:ns}):es.addEventListener(ts,ss,!0):ns!==void 0?es.addEventListener(ts,ss,{passive:ns}):es.addEventListener(ts,ss,!1)}function hd(es,ts,ss,rs,ns){var os=rs;if(!(ts&1)&&!(ts&2)&&rs!==null)e:for(;;){if(rs===null)return;var as=rs.tag;if(as===3||as===4){var ls=rs.stateNode.containerInfo;if(ls===ns||ls.nodeType===8&&ls.parentNode===ns)break;if(as===4)for(as=rs.return;as!==null;){var cs=as.tag;if((cs===3||cs===4)&&(cs=as.stateNode.containerInfo,cs===ns||cs.nodeType===8&&cs.parentNode===ns))return;as=as.return}for(;ls!==null;){if(as=Wc(ls),as===null)return;if(cs=as.tag,cs===5||cs===6){rs=os=as;continue e}ls=ls.parentNode}}rs=rs.return}Jb(function(){var us=os,ds=xb(ss),ms=[];e:{var ps=df.get(es);if(ps!==void 0){var hs=td,xs=es;switch(es){case"keypress":if(od(ss)===0)break e;case"keydown":case"keyup":hs=Rd;break;case"focusin":xs="focus",hs=Fd;break;case"focusout":xs="blur",hs=Fd;break;case"beforeblur":case"afterblur":hs=Fd;break;case"click":if(ss.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":hs=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":hs=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":hs=Vd;break;case $e$1:case af:case bf:hs=Hd;break;case cf:hs=Xd;break;case"scroll":hs=vd;break;case"wheel":hs=Zd;break;case"copy":case"cut":case"paste":hs=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":hs=Td}var ys=(ts&4)!==0,vs=!ys&&es==="scroll",gs=ys?ps!==null?ps+"Capture":null:ps;ys=[];for(var fs=us,js;fs!==null;){js=fs;var Ss=js.stateNode;if(js.tag===5&&Ss!==null&&(js=Ss,gs!==null&&(Ss=Kb(fs,gs),Ss!=null&&ys.push(tf(fs,Ss,js)))),vs)break;fs=fs.return}0<ys.length&&(ps=new hs(ps,xs,null,ss,ds),ms.push({event:ps,listeners:ys}))}}if(!(ts&7)){e:{if(ps=es==="mouseover"||es==="pointerover",hs=es==="mouseout"||es==="pointerout",ps&&ss!==wb&&(xs=ss.relatedTarget||ss.fromElement)&&(Wc(xs)||xs[uf]))break e;if((hs||ps)&&(ps=ds.window===ds?ds:(ps=ds.ownerDocument)?ps.defaultView||ps.parentWindow:window,hs?(xs=ss.relatedTarget||ss.toElement,hs=us,xs=xs?Wc(xs):null,xs!==null&&(vs=Vb(xs),xs!==vs||xs.tag!==5&&xs.tag!==6)&&(xs=null)):(hs=null,xs=us),hs!==xs)){if(ys=Bd,Ss="onMouseLeave",gs="onMouseEnter",fs="mouse",(es==="pointerout"||es==="pointerover")&&(ys=Td,Ss="onPointerLeave",gs="onPointerEnter",fs="pointer"),vs=hs==null?ps:ue$1(hs),js=xs==null?ps:ue$1(xs),ps=new ys(Ss,fs+"leave",hs,ss,ds),ps.target=vs,ps.relatedTarget=js,Ss=null,Wc(ds)===us&&(ys=new ys(gs,fs+"enter",xs,ss,ds),ys.target=js,ys.relatedTarget=vs,Ss=ys),vs=Ss,hs&&xs)t:{for(ys=hs,gs=xs,fs=0,js=ys;js;js=vf(js))fs++;for(js=0,Ss=gs;Ss;Ss=vf(Ss))js++;for(;0<fs-js;)ys=vf(ys),fs--;for(;0<js-fs;)gs=vf(gs),js--;for(;fs--;){if(ys===gs||gs!==null&&ys===gs.alternate)break t;ys=vf(ys),gs=vf(gs)}ys=null}else ys=null;hs!==null&&wf(ms,ps,hs,ys,!1),xs!==null&&vs!==null&&wf(ms,vs,xs,ys,!0)}}e:{if(ps=us?ue$1(us):window,hs=ps.nodeName&&ps.nodeName.toLowerCase(),hs==="select"||hs==="input"&&ps.type==="file")var bs=ve$1;else if(me$1(ps))if(we$1)bs=Fe$1;else{bs=De$1;var Es=Ce$1}else(hs=ps.nodeName)&&hs.toLowerCase()==="input"&&(ps.type==="checkbox"||ps.type==="radio")&&(bs=Ee$1);if(bs&&(bs=bs(es,us))){ne$1(ms,bs,ss,ds);break e}Es&&Es(es,ps,us),es==="focusout"&&(Es=ps._wrapperState)&&Es.controlled&&ps.type==="number"&&cb(ps,"number",ps.value)}switch(Es=us?ue$1(us):window,es){case"focusin":(me$1(Es)||Es.contentEditable==="true")&&(Qe$1=Es,Re$1=us,Se$1=null);break;case"focusout":Se$1=Re$1=Qe$1=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue$1(ms,ss,ds);break;case"selectionchange":if(Pe$1)break;case"keydown":case"keyup":Ue$1(ms,ss,ds)}var Rs;if(ae$1)e:{switch(es){case"compositionstart":var ws="onCompositionStart";break e;case"compositionend":ws="onCompositionEnd";break e;case"compositionupdate":ws="onCompositionUpdate";break e}ws=void 0}else ie$1?ge$1(es,ss)&&(ws="onCompositionEnd"):es==="keydown"&&ss.keyCode===229&&(ws="onCompositionStart");ws&&(de$1&&ss.locale!=="ko"&&(ie$1||ws!=="onCompositionStart"?ws==="onCompositionEnd"&&ie$1&&(Rs=nd()):(kd=ds,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),Es=oe$1(us,ws),0<Es.length&&(ws=new Ld(ws,es,null,ss,ds),ms.push({event:ws,listeners:Es}),Rs?ws.data=Rs:(Rs=he$1(ss),Rs!==null&&(ws.data=Rs)))),(Rs=ce$1?je$1(es,ss):ke$1(es,ss))&&(us=oe$1(us,"onBeforeInput"),0<us.length&&(ds=new Ld("onBeforeInput","beforeinput",null,ss,ds),ms.push({event:ds,listeners:us}),ds.data=Rs))}se$1(ms,ts)})}function tf(es,ts,ss){return{instance:es,listener:ts,currentTarget:ss}}function oe$1(es,ts){for(var ss=ts+"Capture",rs=[];es!==null;){var ns=es,os=ns.stateNode;ns.tag===5&&os!==null&&(ns=os,os=Kb(es,ss),os!=null&&rs.unshift(tf(es,os,ns)),os=Kb(es,ts),os!=null&&rs.push(tf(es,os,ns))),es=es.return}return rs}function vf(es){if(es===null)return null;do es=es.return;while(es&&es.tag!==5);return es||null}function wf(es,ts,ss,rs,ns){for(var os=ts._reactName,as=[];ss!==null&&ss!==rs;){var ls=ss,cs=ls.alternate,us=ls.stateNode;if(cs!==null&&cs===rs)break;ls.tag===5&&us!==null&&(ls=us,ns?(cs=Kb(ss,os),cs!=null&&as.unshift(tf(ss,cs,ls))):ns||(cs=Kb(ss,os),cs!=null&&as.push(tf(ss,cs,ls)))),ss=ss.return}as.length!==0&&es.push({event:ts,listeners:as})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(es){return(typeof es=="string"?es:""+es).replace(xf,`
`).replace(yf,"")}function Af(es,ts,ss){if(ts=zf(ts),zf(es)!==ts&&ss)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(es,ts){return es==="textarea"||es==="noscript"||typeof ts.children=="string"||typeof ts.children=="number"||typeof ts.dangerouslySetInnerHTML=="object"&&ts.dangerouslySetInnerHTML!==null&&ts.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(es){return Hf.resolve(null).then(es).catch(If)}:Ff;function If(es){setTimeout(function(){throw es})}function Kf(es,ts){var ss=ts,rs=0;do{var ns=ss.nextSibling;if(es.removeChild(ss),ns&&ns.nodeType===8)if(ss=ns.data,ss==="/$"){if(rs===0){es.removeChild(ns),bd(ts);return}rs--}else ss!=="$"&&ss!=="$?"&&ss!=="$!"||rs++;ss=ns}while(ss);bd(ts)}function Lf(es){for(;es!=null;es=es.nextSibling){var ts=es.nodeType;if(ts===1||ts===3)break;if(ts===8){if(ts=es.data,ts==="$"||ts==="$!"||ts==="$?")break;if(ts==="/$")return null}}return es}function Mf(es){es=es.previousSibling;for(var ts=0;es;){if(es.nodeType===8){var ss=es.data;if(ss==="$"||ss==="$!"||ss==="$?"){if(ts===0)return es;ts--}else ss==="/$"&&ts++}es=es.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(es){var ts=es[Of];if(ts)return ts;for(var ss=es.parentNode;ss;){if(ts=ss[uf]||ss[Of]){if(ss=ts.alternate,ts.child!==null||ss!==null&&ss.child!==null)for(es=Mf(es);es!==null;){if(ss=es[Of])return ss;es=Mf(es)}return ts}es=ss,ss=es.parentNode}return null}function Cb(es){return es=es[Of]||es[uf],!es||es.tag!==5&&es.tag!==6&&es.tag!==13&&es.tag!==3?null:es}function ue$1(es){if(es.tag===5||es.tag===6)return es.stateNode;throw Error(p$1(33))}function Db(es){return es[Pf]||null}var Sf=[],Tf=-1;function Uf(es){return{current:es}}function E$1(es){0>Tf||(es.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(es,ts){Tf++,Sf[Tf]=es.current,es.current=ts}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(es,ts){var ss=es.type.contextTypes;if(!ss)return Vf;var rs=es.stateNode;if(rs&&rs.__reactInternalMemoizedUnmaskedChildContext===ts)return rs.__reactInternalMemoizedMaskedChildContext;var ns={},os;for(os in ss)ns[os]=ts[os];return rs&&(es=es.stateNode,es.__reactInternalMemoizedUnmaskedChildContext=ts,es.__reactInternalMemoizedMaskedChildContext=ns),ns}function Zf(es){return es=es.childContextTypes,es!=null}function $f(){E$1(Wf),E$1(H$1)}function ag(es,ts,ss){if(H$1.current!==Vf)throw Error(p$1(168));G$1(H$1,ts),G$1(Wf,ss)}function bg(es,ts,ss){var rs=es.stateNode;if(ts=ts.childContextTypes,typeof rs.getChildContext!="function")return ss;rs=rs.getChildContext();for(var ns in rs)if(!(ns in ts))throw Error(p$1(108,Ra(es)||"Unknown",ns));return A$1({},ss,rs)}function cg(es){return es=(es=es.stateNode)&&es.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G$1(H$1,es),G$1(Wf,Wf.current),!0}function dg(es,ts,ss){var rs=es.stateNode;if(!rs)throw Error(p$1(169));ss?(es=bg(es,ts,Xf),rs.__reactInternalMemoizedMergedChildContext=es,E$1(Wf),E$1(H$1),G$1(H$1,es)):E$1(Wf),G$1(Wf,ss)}var eg=null,fg=!1,gg=!1;function hg(es){eg===null?eg=[es]:eg.push(es)}function ig(es){fg=!0,hg(es)}function jg(){if(!gg&&eg!==null){gg=!0;var es=0,ts=C$1;try{var ss=eg;for(C$1=1;es<ss.length;es++){var rs=ss[es];do rs=rs(!0);while(rs!==null)}eg=null,fg=!1}catch(ns){throw eg!==null&&(eg=eg.slice(es+1)),ac(fc,jg),ns}finally{C$1=ts,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(es,ts){kg[lg++]=ng,kg[lg++]=mg,mg=es,ng=ts}function ug(es,ts,ss){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=es;var rs=rg;es=sg;var ns=32-oc(rs)-1;rs&=~(1<<ns),ss+=1;var os=32-oc(ts)+ns;if(30<os){var as=ns-ns%5;os=(rs&(1<<as)-1).toString(32),rs>>=as,ns-=as,rg=1<<32-oc(ts)+ns|ss<<ns|rs,sg=os+es}else rg=1<<os|ss<<ns|rs,sg=es}function vg(es){es.return!==null&&(tg(es,1),ug(es,1,0))}function wg(es){for(;es===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;es===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$1=!1,zg=null;function Ag(es,ts){var ss=Bg(5,null,null,0);ss.elementType="DELETED",ss.stateNode=ts,ss.return=es,ts=es.deletions,ts===null?(es.deletions=[ss],es.flags|=16):ts.push(ss)}function Cg(es,ts){switch(es.tag){case 5:var ss=es.type;return ts=ts.nodeType!==1||ss.toLowerCase()!==ts.nodeName.toLowerCase()?null:ts,ts!==null?(es.stateNode=ts,xg=es,yg=Lf(ts.firstChild),!0):!1;case 6:return ts=es.pendingProps===""||ts.nodeType!==3?null:ts,ts!==null?(es.stateNode=ts,xg=es,yg=null,!0):!1;case 13:return ts=ts.nodeType!==8?null:ts,ts!==null?(ss=qg!==null?{id:rg,overflow:sg}:null,es.memoizedState={dehydrated:ts,treeContext:ss,retryLane:1073741824},ss=Bg(18,null,null,0),ss.stateNode=ts,ss.return=es,es.child=ss,xg=es,yg=null,!0):!1;default:return!1}}function Dg(es){return(es.mode&1)!==0&&(es.flags&128)===0}function Eg(es){if(I$1){var ts=yg;if(ts){var ss=ts;if(!Cg(es,ts)){if(Dg(es))throw Error(p$1(418));ts=Lf(ss.nextSibling);var rs=xg;ts&&Cg(es,ts)?Ag(rs,ss):(es.flags=es.flags&-4097|2,I$1=!1,xg=es)}}else{if(Dg(es))throw Error(p$1(418));es.flags=es.flags&-4097|2,I$1=!1,xg=es}}}function Fg(es){for(es=es.return;es!==null&&es.tag!==5&&es.tag!==3&&es.tag!==13;)es=es.return;xg=es}function Gg(es){if(es!==xg)return!1;if(!I$1)return Fg(es),I$1=!0,!1;var ts;if((ts=es.tag!==3)&&!(ts=es.tag!==5)&&(ts=es.type,ts=ts!=="head"&&ts!=="body"&&!Ef(es.type,es.memoizedProps)),ts&&(ts=yg)){if(Dg(es))throw Hg(),Error(p$1(418));for(;ts;)Ag(es,ts),ts=Lf(ts.nextSibling)}if(Fg(es),es.tag===13){if(es=es.memoizedState,es=es!==null?es.dehydrated:null,!es)throw Error(p$1(317));e:{for(es=es.nextSibling,ts=0;es;){if(es.nodeType===8){var ss=es.data;if(ss==="/$"){if(ts===0){yg=Lf(es.nextSibling);break e}ts--}else ss!=="$"&&ss!=="$!"&&ss!=="$?"||ts++}es=es.nextSibling}yg=null}}else yg=xg?Lf(es.stateNode.nextSibling):null;return!0}function Hg(){for(var es=yg;es;)es=Lf(es.nextSibling)}function Ig(){yg=xg=null,I$1=!1}function Jg(es){zg===null?zg=[es]:zg.push(es)}var Kg=ua.ReactCurrentBatchConfig;function Lg(es,ts,ss){if(es=ss.ref,es!==null&&typeof es!="function"&&typeof es!="object"){if(ss._owner){if(ss=ss._owner,ss){if(ss.tag!==1)throw Error(p$1(309));var rs=ss.stateNode}if(!rs)throw Error(p$1(147,es));var ns=rs,os=""+es;return ts!==null&&ts.ref!==null&&typeof ts.ref=="function"&&ts.ref._stringRef===os?ts.ref:(ts=function(as){var ls=ns.refs;as===null?delete ls[os]:ls[os]=as},ts._stringRef=os,ts)}if(typeof es!="string")throw Error(p$1(284));if(!ss._owner)throw Error(p$1(290,es))}return es}function Mg(es,ts){throw es=Object.prototype.toString.call(ts),Error(p$1(31,es==="[object Object]"?"object with keys {"+Object.keys(ts).join(", ")+"}":es))}function Ng(es){var ts=es._init;return ts(es._payload)}function Og(es){function ts(gs,fs){if(es){var js=gs.deletions;js===null?(gs.deletions=[fs],gs.flags|=16):js.push(fs)}}function ss(gs,fs){if(!es)return null;for(;fs!==null;)ts(gs,fs),fs=fs.sibling;return null}function rs(gs,fs){for(gs=new Map;fs!==null;)fs.key!==null?gs.set(fs.key,fs):gs.set(fs.index,fs),fs=fs.sibling;return gs}function ns(gs,fs){return gs=Pg(gs,fs),gs.index=0,gs.sibling=null,gs}function os(gs,fs,js){return gs.index=js,es?(js=gs.alternate,js!==null?(js=js.index,js<fs?(gs.flags|=2,fs):js):(gs.flags|=2,fs)):(gs.flags|=1048576,fs)}function as(gs){return es&&gs.alternate===null&&(gs.flags|=2),gs}function ls(gs,fs,js,Ss){return fs===null||fs.tag!==6?(fs=Qg(js,gs.mode,Ss),fs.return=gs,fs):(fs=ns(fs,js),fs.return=gs,fs)}function cs(gs,fs,js,Ss){var bs=js.type;return bs===ya?ds(gs,fs,js.props.children,Ss,js.key):fs!==null&&(fs.elementType===bs||typeof bs=="object"&&bs!==null&&bs.$$typeof===Ha&&Ng(bs)===fs.type)?(Ss=ns(fs,js.props),Ss.ref=Lg(gs,fs,js),Ss.return=gs,Ss):(Ss=Rg(js.type,js.key,js.props,null,gs.mode,Ss),Ss.ref=Lg(gs,fs,js),Ss.return=gs,Ss)}function us(gs,fs,js,Ss){return fs===null||fs.tag!==4||fs.stateNode.containerInfo!==js.containerInfo||fs.stateNode.implementation!==js.implementation?(fs=Sg(js,gs.mode,Ss),fs.return=gs,fs):(fs=ns(fs,js.children||[]),fs.return=gs,fs)}function ds(gs,fs,js,Ss,bs){return fs===null||fs.tag!==7?(fs=Tg(js,gs.mode,Ss,bs),fs.return=gs,fs):(fs=ns(fs,js),fs.return=gs,fs)}function ms(gs,fs,js){if(typeof fs=="string"&&fs!==""||typeof fs=="number")return fs=Qg(""+fs,gs.mode,js),fs.return=gs,fs;if(typeof fs=="object"&&fs!==null){switch(fs.$$typeof){case va:return js=Rg(fs.type,fs.key,fs.props,null,gs.mode,js),js.ref=Lg(gs,null,fs),js.return=gs,js;case wa:return fs=Sg(fs,gs.mode,js),fs.return=gs,fs;case Ha:var Ss=fs._init;return ms(gs,Ss(fs._payload),js)}if(eb(fs)||Ka(fs))return fs=Tg(fs,gs.mode,js,null),fs.return=gs,fs;Mg(gs,fs)}return null}function ps(gs,fs,js,Ss){var bs=fs!==null?fs.key:null;if(typeof js=="string"&&js!==""||typeof js=="number")return bs!==null?null:ls(gs,fs,""+js,Ss);if(typeof js=="object"&&js!==null){switch(js.$$typeof){case va:return js.key===bs?cs(gs,fs,js,Ss):null;case wa:return js.key===bs?us(gs,fs,js,Ss):null;case Ha:return bs=js._init,ps(gs,fs,bs(js._payload),Ss)}if(eb(js)||Ka(js))return bs!==null?null:ds(gs,fs,js,Ss,null);Mg(gs,js)}return null}function hs(gs,fs,js,Ss,bs){if(typeof Ss=="string"&&Ss!==""||typeof Ss=="number")return gs=gs.get(js)||null,ls(fs,gs,""+Ss,bs);if(typeof Ss=="object"&&Ss!==null){switch(Ss.$$typeof){case va:return gs=gs.get(Ss.key===null?js:Ss.key)||null,cs(fs,gs,Ss,bs);case wa:return gs=gs.get(Ss.key===null?js:Ss.key)||null,us(fs,gs,Ss,bs);case Ha:var Es=Ss._init;return hs(gs,fs,js,Es(Ss._payload),bs)}if(eb(Ss)||Ka(Ss))return gs=gs.get(js)||null,ds(fs,gs,Ss,bs,null);Mg(fs,Ss)}return null}function xs(gs,fs,js,Ss){for(var bs=null,Es=null,Rs=fs,ws=fs=0,Ns=null;Rs!==null&&ws<js.length;ws++){Rs.index>ws?(Ns=Rs,Rs=null):Ns=Rs.sibling;var ks=ps(gs,Rs,js[ws],Ss);if(ks===null){Rs===null&&(Rs=Ns);break}es&&Rs&&ks.alternate===null&&ts(gs,Rs),fs=os(ks,fs,ws),Es===null?bs=ks:Es.sibling=ks,Es=ks,Rs=Ns}if(ws===js.length)return ss(gs,Rs),I$1&&tg(gs,ws),bs;if(Rs===null){for(;ws<js.length;ws++)Rs=ms(gs,js[ws],Ss),Rs!==null&&(fs=os(Rs,fs,ws),Es===null?bs=Rs:Es.sibling=Rs,Es=Rs);return I$1&&tg(gs,ws),bs}for(Rs=rs(gs,Rs);ws<js.length;ws++)Ns=hs(Rs,gs,ws,js[ws],Ss),Ns!==null&&(es&&Ns.alternate!==null&&Rs.delete(Ns.key===null?ws:Ns.key),fs=os(Ns,fs,ws),Es===null?bs=Ns:Es.sibling=Ns,Es=Ns);return es&&Rs.forEach(function(_s){return ts(gs,_s)}),I$1&&tg(gs,ws),bs}function ys(gs,fs,js,Ss){var bs=Ka(js);if(typeof bs!="function")throw Error(p$1(150));if(js=bs.call(js),js==null)throw Error(p$1(151));for(var Es=bs=null,Rs=fs,ws=fs=0,Ns=null,ks=js.next();Rs!==null&&!ks.done;ws++,ks=js.next()){Rs.index>ws?(Ns=Rs,Rs=null):Ns=Rs.sibling;var _s=ps(gs,Rs,ks.value,Ss);if(_s===null){Rs===null&&(Rs=Ns);break}es&&Rs&&_s.alternate===null&&ts(gs,Rs),fs=os(_s,fs,ws),Es===null?bs=_s:Es.sibling=_s,Es=_s,Rs=Ns}if(ks.done)return ss(gs,Rs),I$1&&tg(gs,ws),bs;if(Rs===null){for(;!ks.done;ws++,ks=js.next())ks=ms(gs,ks.value,Ss),ks!==null&&(fs=os(ks,fs,ws),Es===null?bs=ks:Es.sibling=ks,Es=ks);return I$1&&tg(gs,ws),bs}for(Rs=rs(gs,Rs);!ks.done;ws++,ks=js.next())ks=hs(Rs,gs,ws,ks.value,Ss),ks!==null&&(es&&ks.alternate!==null&&Rs.delete(ks.key===null?ws:ks.key),fs=os(ks,fs,ws),Es===null?bs=ks:Es.sibling=ks,Es=ks);return es&&Rs.forEach(function(Ls){return ts(gs,Ls)}),I$1&&tg(gs,ws),bs}function vs(gs,fs,js,Ss){if(typeof js=="object"&&js!==null&&js.type===ya&&js.key===null&&(js=js.props.children),typeof js=="object"&&js!==null){switch(js.$$typeof){case va:e:{for(var bs=js.key,Es=fs;Es!==null;){if(Es.key===bs){if(bs=js.type,bs===ya){if(Es.tag===7){ss(gs,Es.sibling),fs=ns(Es,js.props.children),fs.return=gs,gs=fs;break e}}else if(Es.elementType===bs||typeof bs=="object"&&bs!==null&&bs.$$typeof===Ha&&Ng(bs)===Es.type){ss(gs,Es.sibling),fs=ns(Es,js.props),fs.ref=Lg(gs,Es,js),fs.return=gs,gs=fs;break e}ss(gs,Es);break}else ts(gs,Es);Es=Es.sibling}js.type===ya?(fs=Tg(js.props.children,gs.mode,Ss,js.key),fs.return=gs,gs=fs):(Ss=Rg(js.type,js.key,js.props,null,gs.mode,Ss),Ss.ref=Lg(gs,fs,js),Ss.return=gs,gs=Ss)}return as(gs);case wa:e:{for(Es=js.key;fs!==null;){if(fs.key===Es)if(fs.tag===4&&fs.stateNode.containerInfo===js.containerInfo&&fs.stateNode.implementation===js.implementation){ss(gs,fs.sibling),fs=ns(fs,js.children||[]),fs.return=gs,gs=fs;break e}else{ss(gs,fs);break}else ts(gs,fs);fs=fs.sibling}fs=Sg(js,gs.mode,Ss),fs.return=gs,gs=fs}return as(gs);case Ha:return Es=js._init,vs(gs,fs,Es(js._payload),Ss)}if(eb(js))return xs(gs,fs,js,Ss);if(Ka(js))return ys(gs,fs,js,Ss);Mg(gs,js)}return typeof js=="string"&&js!==""||typeof js=="number"?(js=""+js,fs!==null&&fs.tag===6?(ss(gs,fs.sibling),fs=ns(fs,js),fs.return=gs,gs=fs):(ss(gs,fs),fs=Qg(js,gs.mode,Ss),fs.return=gs,gs=fs),as(gs)):ss(gs,fs)}return vs}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(es){var ts=Wg.current;E$1(Wg),es._currentValue=ts}function bh(es,ts,ss){for(;es!==null;){var rs=es.alternate;if((es.childLanes&ts)!==ts?(es.childLanes|=ts,rs!==null&&(rs.childLanes|=ts)):rs!==null&&(rs.childLanes&ts)!==ts&&(rs.childLanes|=ts),es===ss)break;es=es.return}}function ch(es,ts){Xg=es,Zg=Yg=null,es=es.dependencies,es!==null&&es.firstContext!==null&&(es.lanes&ts&&(dh=!0),es.firstContext=null)}function eh(es){var ts=es._currentValue;if(Zg!==es)if(es={context:es,memoizedValue:ts,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=es,Xg.dependencies={lanes:0,firstContext:es}}else Yg=Yg.next=es;return ts}var fh=null;function gh(es){fh===null?fh=[es]:fh.push(es)}function hh(es,ts,ss,rs){var ns=ts.interleaved;return ns===null?(ss.next=ss,gh(ts)):(ss.next=ns.next,ns.next=ss),ts.interleaved=ss,ih(es,rs)}function ih(es,ts){es.lanes|=ts;var ss=es.alternate;for(ss!==null&&(ss.lanes|=ts),ss=es,es=es.return;es!==null;)es.childLanes|=ts,ss=es.alternate,ss!==null&&(ss.childLanes|=ts),ss=es,es=es.return;return ss.tag===3?ss.stateNode:null}var jh=!1;function kh(es){es.updateQueue={baseState:es.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(es,ts){es=es.updateQueue,ts.updateQueue===es&&(ts.updateQueue={baseState:es.baseState,firstBaseUpdate:es.firstBaseUpdate,lastBaseUpdate:es.lastBaseUpdate,shared:es.shared,effects:es.effects})}function mh(es,ts){return{eventTime:es,lane:ts,tag:0,payload:null,callback:null,next:null}}function nh(es,ts,ss){var rs=es.updateQueue;if(rs===null)return null;if(rs=rs.shared,K$1&2){var ns=rs.pending;return ns===null?ts.next=ts:(ts.next=ns.next,ns.next=ts),rs.pending=ts,ih(es,ss)}return ns=rs.interleaved,ns===null?(ts.next=ts,gh(rs)):(ts.next=ns.next,ns.next=ts),rs.interleaved=ts,ih(es,ss)}function oh(es,ts,ss){if(ts=ts.updateQueue,ts!==null&&(ts=ts.shared,(ss&4194240)!==0)){var rs=ts.lanes;rs&=es.pendingLanes,ss|=rs,ts.lanes=ss,Cc(es,ss)}}function ph(es,ts){var ss=es.updateQueue,rs=es.alternate;if(rs!==null&&(rs=rs.updateQueue,ss===rs)){var ns=null,os=null;if(ss=ss.firstBaseUpdate,ss!==null){do{var as={eventTime:ss.eventTime,lane:ss.lane,tag:ss.tag,payload:ss.payload,callback:ss.callback,next:null};os===null?ns=os=as:os=os.next=as,ss=ss.next}while(ss!==null);os===null?ns=os=ts:os=os.next=ts}else ns=os=ts;ss={baseState:rs.baseState,firstBaseUpdate:ns,lastBaseUpdate:os,shared:rs.shared,effects:rs.effects},es.updateQueue=ss;return}es=ss.lastBaseUpdate,es===null?ss.firstBaseUpdate=ts:es.next=ts,ss.lastBaseUpdate=ts}function qh(es,ts,ss,rs){var ns=es.updateQueue;jh=!1;var os=ns.firstBaseUpdate,as=ns.lastBaseUpdate,ls=ns.shared.pending;if(ls!==null){ns.shared.pending=null;var cs=ls,us=cs.next;cs.next=null,as===null?os=us:as.next=us,as=cs;var ds=es.alternate;ds!==null&&(ds=ds.updateQueue,ls=ds.lastBaseUpdate,ls!==as&&(ls===null?ds.firstBaseUpdate=us:ls.next=us,ds.lastBaseUpdate=cs))}if(os!==null){var ms=ns.baseState;as=0,ds=us=cs=null,ls=os;do{var ps=ls.lane,hs=ls.eventTime;if((rs&ps)===ps){ds!==null&&(ds=ds.next={eventTime:hs,lane:0,tag:ls.tag,payload:ls.payload,callback:ls.callback,next:null});e:{var xs=es,ys=ls;switch(ps=ts,hs=ss,ys.tag){case 1:if(xs=ys.payload,typeof xs=="function"){ms=xs.call(hs,ms,ps);break e}ms=xs;break e;case 3:xs.flags=xs.flags&-65537|128;case 0:if(xs=ys.payload,ps=typeof xs=="function"?xs.call(hs,ms,ps):xs,ps==null)break e;ms=A$1({},ms,ps);break e;case 2:jh=!0}}ls.callback!==null&&ls.lane!==0&&(es.flags|=64,ps=ns.effects,ps===null?ns.effects=[ls]:ps.push(ls))}else hs={eventTime:hs,lane:ps,tag:ls.tag,payload:ls.payload,callback:ls.callback,next:null},ds===null?(us=ds=hs,cs=ms):ds=ds.next=hs,as|=ps;if(ls=ls.next,ls===null){if(ls=ns.shared.pending,ls===null)break;ps=ls,ls=ps.next,ps.next=null,ns.lastBaseUpdate=ps,ns.shared.pending=null}}while(!0);if(ds===null&&(cs=ms),ns.baseState=cs,ns.firstBaseUpdate=us,ns.lastBaseUpdate=ds,ts=ns.shared.interleaved,ts!==null){ns=ts;do as|=ns.lane,ns=ns.next;while(ns!==ts)}else os===null&&(ns.shared.lanes=0);rh|=as,es.lanes=as,es.memoizedState=ms}}function sh(es,ts,ss){if(es=ts.effects,ts.effects=null,es!==null)for(ts=0;ts<es.length;ts++){var rs=es[ts],ns=rs.callback;if(ns!==null){if(rs.callback=null,rs=ss,typeof ns!="function")throw Error(p$1(191,ns));ns.call(rs)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(es){if(es===th)throw Error(p$1(174));return es}function yh(es,ts){switch(G$1(wh,ts),G$1(vh,es),G$1(uh,th),es=ts.nodeType,es){case 9:case 11:ts=(ts=ts.documentElement)?ts.namespaceURI:lb(null,"");break;default:es=es===8?ts.parentNode:ts,ts=es.namespaceURI||null,es=es.tagName,ts=lb(ts,es)}E$1(uh),G$1(uh,ts)}function zh(){E$1(uh),E$1(vh),E$1(wh)}function Ah(es){xh(wh.current);var ts=xh(uh.current),ss=lb(ts,es.type);ts!==ss&&(G$1(vh,es),G$1(uh,ss))}function Bh(es){vh.current===es&&(E$1(uh),E$1(vh))}var L$1=Uf(0);function Ch(es){for(var ts=es;ts!==null;){if(ts.tag===13){var ss=ts.memoizedState;if(ss!==null&&(ss=ss.dehydrated,ss===null||ss.data==="$?"||ss.data==="$!"))return ts}else if(ts.tag===19&&ts.memoizedProps.revealOrder!==void 0){if(ts.flags&128)return ts}else if(ts.child!==null){ts.child.return=ts,ts=ts.child;continue}if(ts===es)break;for(;ts.sibling===null;){if(ts.return===null||ts.return===es)return null;ts=ts.return}ts.sibling.return=ts.return,ts=ts.sibling}return null}var Dh=[];function Eh(){for(var es=0;es<Dh.length;es++)Dh[es]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N$1=null,O$1=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P$1(){throw Error(p$1(321))}function Mh(es,ts){if(ts===null)return!1;for(var ss=0;ss<ts.length&&ss<es.length;ss++)if(!He$1(es[ss],ts[ss]))return!1;return!0}function Nh(es,ts,ss,rs,ns,os){if(Hh=os,M$1=ts,ts.memoizedState=null,ts.updateQueue=null,ts.lanes=0,Fh.current=es===null||es.memoizedState===null?Oh:Ph,es=ss(rs,ns),Jh){os=0;do{if(Jh=!1,Kh=0,25<=os)throw Error(p$1(301));os+=1,O$1=N$1=null,ts.updateQueue=null,Fh.current=Qh,es=ss(rs,ns)}while(Jh)}if(Fh.current=Rh,ts=N$1!==null&&N$1.next!==null,Hh=0,O$1=N$1=M$1=null,Ih=!1,ts)throw Error(p$1(300));return es}function Sh(){var es=Kh!==0;return Kh=0,es}function Th(){var es={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O$1===null?M$1.memoizedState=O$1=es:O$1=O$1.next=es,O$1}function Uh(){if(N$1===null){var es=M$1.alternate;es=es!==null?es.memoizedState:null}else es=N$1.next;var ts=O$1===null?M$1.memoizedState:O$1.next;if(ts!==null)O$1=ts,N$1=es;else{if(es===null)throw Error(p$1(310));N$1=es,es={memoizedState:N$1.memoizedState,baseState:N$1.baseState,baseQueue:N$1.baseQueue,queue:N$1.queue,next:null},O$1===null?M$1.memoizedState=O$1=es:O$1=O$1.next=es}return O$1}function Vh(es,ts){return typeof ts=="function"?ts(es):ts}function Wh(es){var ts=Uh(),ss=ts.queue;if(ss===null)throw Error(p$1(311));ss.lastRenderedReducer=es;var rs=N$1,ns=rs.baseQueue,os=ss.pending;if(os!==null){if(ns!==null){var as=ns.next;ns.next=os.next,os.next=as}rs.baseQueue=ns=os,ss.pending=null}if(ns!==null){os=ns.next,rs=rs.baseState;var ls=as=null,cs=null,us=os;do{var ds=us.lane;if((Hh&ds)===ds)cs!==null&&(cs=cs.next={lane:0,action:us.action,hasEagerState:us.hasEagerState,eagerState:us.eagerState,next:null}),rs=us.hasEagerState?us.eagerState:es(rs,us.action);else{var ms={lane:ds,action:us.action,hasEagerState:us.hasEagerState,eagerState:us.eagerState,next:null};cs===null?(ls=cs=ms,as=rs):cs=cs.next=ms,M$1.lanes|=ds,rh|=ds}us=us.next}while(us!==null&&us!==os);cs===null?as=rs:cs.next=ls,He$1(rs,ts.memoizedState)||(dh=!0),ts.memoizedState=rs,ts.baseState=as,ts.baseQueue=cs,ss.lastRenderedState=rs}if(es=ss.interleaved,es!==null){ns=es;do os=ns.lane,M$1.lanes|=os,rh|=os,ns=ns.next;while(ns!==es)}else ns===null&&(ss.lanes=0);return[ts.memoizedState,ss.dispatch]}function Xh(es){var ts=Uh(),ss=ts.queue;if(ss===null)throw Error(p$1(311));ss.lastRenderedReducer=es;var rs=ss.dispatch,ns=ss.pending,os=ts.memoizedState;if(ns!==null){ss.pending=null;var as=ns=ns.next;do os=es(os,as.action),as=as.next;while(as!==ns);He$1(os,ts.memoizedState)||(dh=!0),ts.memoizedState=os,ts.baseQueue===null&&(ts.baseState=os),ss.lastRenderedState=os}return[os,rs]}function Yh(){}function Zh(es,ts){var ss=M$1,rs=Uh(),ns=ts(),os=!He$1(rs.memoizedState,ns);if(os&&(rs.memoizedState=ns,dh=!0),rs=rs.queue,$h(ai.bind(null,ss,rs,es),[es]),rs.getSnapshot!==ts||os||O$1!==null&&O$1.memoizedState.tag&1){if(ss.flags|=2048,bi(9,ci.bind(null,ss,rs,ns,ts),void 0,null),Q$1===null)throw Error(p$1(349));Hh&30||di(ss,ts,ns)}return ns}function di(es,ts,ss){es.flags|=16384,es={getSnapshot:ts,value:ss},ts=M$1.updateQueue,ts===null?(ts={lastEffect:null,stores:null},M$1.updateQueue=ts,ts.stores=[es]):(ss=ts.stores,ss===null?ts.stores=[es]:ss.push(es))}function ci(es,ts,ss,rs){ts.value=ss,ts.getSnapshot=rs,ei(ts)&&fi(es)}function ai(es,ts,ss){return ss(function(){ei(ts)&&fi(es)})}function ei(es){var ts=es.getSnapshot;es=es.value;try{var ss=ts();return!He$1(es,ss)}catch{return!0}}function fi(es){var ts=ih(es,1);ts!==null&&gi(ts,es,1,-1)}function hi(es){var ts=Th();return typeof es=="function"&&(es=es()),ts.memoizedState=ts.baseState=es,es={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:es},ts.queue=es,es=es.dispatch=ii.bind(null,M$1,es),[ts.memoizedState,es]}function bi(es,ts,ss,rs){return es={tag:es,create:ts,destroy:ss,deps:rs,next:null},ts=M$1.updateQueue,ts===null?(ts={lastEffect:null,stores:null},M$1.updateQueue=ts,ts.lastEffect=es.next=es):(ss=ts.lastEffect,ss===null?ts.lastEffect=es.next=es:(rs=ss.next,ss.next=es,es.next=rs,ts.lastEffect=es)),es}function ji(){return Uh().memoizedState}function ki(es,ts,ss,rs){var ns=Th();M$1.flags|=es,ns.memoizedState=bi(1|ts,ss,void 0,rs===void 0?null:rs)}function li(es,ts,ss,rs){var ns=Uh();rs=rs===void 0?null:rs;var os=void 0;if(N$1!==null){var as=N$1.memoizedState;if(os=as.destroy,rs!==null&&Mh(rs,as.deps)){ns.memoizedState=bi(ts,ss,os,rs);return}}M$1.flags|=es,ns.memoizedState=bi(1|ts,ss,os,rs)}function mi(es,ts){return ki(8390656,8,es,ts)}function $h(es,ts){return li(2048,8,es,ts)}function ni(es,ts){return li(4,2,es,ts)}function oi(es,ts){return li(4,4,es,ts)}function pi(es,ts){if(typeof ts=="function")return es=es(),ts(es),function(){ts(null)};if(ts!=null)return es=es(),ts.current=es,function(){ts.current=null}}function qi(es,ts,ss){return ss=ss!=null?ss.concat([es]):null,li(4,4,pi.bind(null,ts,es),ss)}function ri(){}function si(es,ts){var ss=Uh();ts=ts===void 0?null:ts;var rs=ss.memoizedState;return rs!==null&&ts!==null&&Mh(ts,rs[1])?rs[0]:(ss.memoizedState=[es,ts],es)}function ti(es,ts){var ss=Uh();ts=ts===void 0?null:ts;var rs=ss.memoizedState;return rs!==null&&ts!==null&&Mh(ts,rs[1])?rs[0]:(es=es(),ss.memoizedState=[es,ts],es)}function ui(es,ts,ss){return Hh&21?(He$1(ss,ts)||(ss=yc(),M$1.lanes|=ss,rh|=ss,es.baseState=!0),ts):(es.baseState&&(es.baseState=!1,dh=!0),es.memoizedState=ss)}function vi(es,ts){var ss=C$1;C$1=ss!==0&&4>ss?ss:4,es(!0);var rs=Gh.transition;Gh.transition={};try{es(!1),ts()}finally{C$1=ss,Gh.transition=rs}}function wi(){return Uh().memoizedState}function xi(es,ts,ss){var rs=yi(es);if(ss={lane:rs,action:ss,hasEagerState:!1,eagerState:null,next:null},zi(es))Ai(ts,ss);else if(ss=hh(es,ts,ss,rs),ss!==null){var ns=R$1();gi(ss,es,rs,ns),Bi(ss,ts,rs)}}function ii(es,ts,ss){var rs=yi(es),ns={lane:rs,action:ss,hasEagerState:!1,eagerState:null,next:null};if(zi(es))Ai(ts,ns);else{var os=es.alternate;if(es.lanes===0&&(os===null||os.lanes===0)&&(os=ts.lastRenderedReducer,os!==null))try{var as=ts.lastRenderedState,ls=os(as,ss);if(ns.hasEagerState=!0,ns.eagerState=ls,He$1(ls,as)){var cs=ts.interleaved;cs===null?(ns.next=ns,gh(ts)):(ns.next=cs.next,cs.next=ns),ts.interleaved=ns;return}}catch{}finally{}ss=hh(es,ts,ns,rs),ss!==null&&(ns=R$1(),gi(ss,es,rs,ns),Bi(ss,ts,rs))}}function zi(es){var ts=es.alternate;return es===M$1||ts!==null&&ts===M$1}function Ai(es,ts){Jh=Ih=!0;var ss=es.pending;ss===null?ts.next=ts:(ts.next=ss.next,ss.next=ts),es.pending=ts}function Bi(es,ts,ss){if(ss&4194240){var rs=ts.lanes;rs&=es.pendingLanes,ss|=rs,ts.lanes=ss,Cc(es,ss)}}var Rh={readContext:eh,useCallback:P$1,useContext:P$1,useEffect:P$1,useImperativeHandle:P$1,useInsertionEffect:P$1,useLayoutEffect:P$1,useMemo:P$1,useReducer:P$1,useRef:P$1,useState:P$1,useDebugValue:P$1,useDeferredValue:P$1,useTransition:P$1,useMutableSource:P$1,useSyncExternalStore:P$1,useId:P$1,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(es,ts){return Th().memoizedState=[es,ts===void 0?null:ts],es},useContext:eh,useEffect:mi,useImperativeHandle:function(es,ts,ss){return ss=ss!=null?ss.concat([es]):null,ki(4194308,4,pi.bind(null,ts,es),ss)},useLayoutEffect:function(es,ts){return ki(4194308,4,es,ts)},useInsertionEffect:function(es,ts){return ki(4,2,es,ts)},useMemo:function(es,ts){var ss=Th();return ts=ts===void 0?null:ts,es=es(),ss.memoizedState=[es,ts],es},useReducer:function(es,ts,ss){var rs=Th();return ts=ss!==void 0?ss(ts):ts,rs.memoizedState=rs.baseState=ts,es={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:es,lastRenderedState:ts},rs.queue=es,es=es.dispatch=xi.bind(null,M$1,es),[rs.memoizedState,es]},useRef:function(es){var ts=Th();return es={current:es},ts.memoizedState=es},useState:hi,useDebugValue:ri,useDeferredValue:function(es){return Th().memoizedState=es},useTransition:function(){var es=hi(!1),ts=es[0];return es=vi.bind(null,es[1]),Th().memoizedState=es,[ts,es]},useMutableSource:function(){},useSyncExternalStore:function(es,ts,ss){var rs=M$1,ns=Th();if(I$1){if(ss===void 0)throw Error(p$1(407));ss=ss()}else{if(ss=ts(),Q$1===null)throw Error(p$1(349));Hh&30||di(rs,ts,ss)}ns.memoizedState=ss;var os={value:ss,getSnapshot:ts};return ns.queue=os,mi(ai.bind(null,rs,os,es),[es]),rs.flags|=2048,bi(9,ci.bind(null,rs,os,ss,ts),void 0,null),ss},useId:function(){var es=Th(),ts=Q$1.identifierPrefix;if(I$1){var ss=sg,rs=rg;ss=(rs&~(1<<32-oc(rs)-1)).toString(32)+ss,ts=":"+ts+"R"+ss,ss=Kh++,0<ss&&(ts+="H"+ss.toString(32)),ts+=":"}else ss=Lh++,ts=":"+ts+"r"+ss.toString(32)+":";return es.memoizedState=ts},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(es){var ts=Uh();return ui(ts,N$1.memoizedState,es)},useTransition:function(){var es=Wh(Vh)[0],ts=Uh().memoizedState;return[es,ts]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(es){var ts=Uh();return N$1===null?ts.memoizedState=es:ui(ts,N$1.memoizedState,es)},useTransition:function(){var es=Xh(Vh)[0],ts=Uh().memoizedState;return[es,ts]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(es,ts){if(es&&es.defaultProps){ts=A$1({},ts),es=es.defaultProps;for(var ss in es)ts[ss]===void 0&&(ts[ss]=es[ss]);return ts}return ts}function Di(es,ts,ss,rs){ts=es.memoizedState,ss=ss(rs,ts),ss=ss==null?ts:A$1({},ts,ss),es.memoizedState=ss,es.lanes===0&&(es.updateQueue.baseState=ss)}var Ei={isMounted:function(es){return(es=es._reactInternals)?Vb(es)===es:!1},enqueueSetState:function(es,ts,ss){es=es._reactInternals;var rs=R$1(),ns=yi(es),os=mh(rs,ns);os.payload=ts,ss!=null&&(os.callback=ss),ts=nh(es,os,ns),ts!==null&&(gi(ts,es,ns,rs),oh(ts,es,ns))},enqueueReplaceState:function(es,ts,ss){es=es._reactInternals;var rs=R$1(),ns=yi(es),os=mh(rs,ns);os.tag=1,os.payload=ts,ss!=null&&(os.callback=ss),ts=nh(es,os,ns),ts!==null&&(gi(ts,es,ns,rs),oh(ts,es,ns))},enqueueForceUpdate:function(es,ts){es=es._reactInternals;var ss=R$1(),rs=yi(es),ns=mh(ss,rs);ns.tag=2,ts!=null&&(ns.callback=ts),ts=nh(es,ns,rs),ts!==null&&(gi(ts,es,rs,ss),oh(ts,es,rs))}};function Fi(es,ts,ss,rs,ns,os,as){return es=es.stateNode,typeof es.shouldComponentUpdate=="function"?es.shouldComponentUpdate(rs,os,as):ts.prototype&&ts.prototype.isPureReactComponent?!Ie$1(ss,rs)||!Ie$1(ns,os):!0}function Gi(es,ts,ss){var rs=!1,ns=Vf,os=ts.contextType;return typeof os=="object"&&os!==null?os=eh(os):(ns=Zf(ts)?Xf:H$1.current,rs=ts.contextTypes,os=(rs=rs!=null)?Yf(es,ns):Vf),ts=new ts(ss,os),es.memoizedState=ts.state!==null&&ts.state!==void 0?ts.state:null,ts.updater=Ei,es.stateNode=ts,ts._reactInternals=es,rs&&(es=es.stateNode,es.__reactInternalMemoizedUnmaskedChildContext=ns,es.__reactInternalMemoizedMaskedChildContext=os),ts}function Hi(es,ts,ss,rs){es=ts.state,typeof ts.componentWillReceiveProps=="function"&&ts.componentWillReceiveProps(ss,rs),typeof ts.UNSAFE_componentWillReceiveProps=="function"&&ts.UNSAFE_componentWillReceiveProps(ss,rs),ts.state!==es&&Ei.enqueueReplaceState(ts,ts.state,null)}function Ii(es,ts,ss,rs){var ns=es.stateNode;ns.props=ss,ns.state=es.memoizedState,ns.refs={},kh(es);var os=ts.contextType;typeof os=="object"&&os!==null?ns.context=eh(os):(os=Zf(ts)?Xf:H$1.current,ns.context=Yf(es,os)),ns.state=es.memoizedState,os=ts.getDerivedStateFromProps,typeof os=="function"&&(Di(es,ts,os,ss),ns.state=es.memoizedState),typeof ts.getDerivedStateFromProps=="function"||typeof ns.getSnapshotBeforeUpdate=="function"||typeof ns.UNSAFE_componentWillMount!="function"&&typeof ns.componentWillMount!="function"||(ts=ns.state,typeof ns.componentWillMount=="function"&&ns.componentWillMount(),typeof ns.UNSAFE_componentWillMount=="function"&&ns.UNSAFE_componentWillMount(),ts!==ns.state&&Ei.enqueueReplaceState(ns,ns.state,null),qh(es,ss,ns,rs),ns.state=es.memoizedState),typeof ns.componentDidMount=="function"&&(es.flags|=4194308)}function Ji(es,ts){try{var ss="",rs=ts;do ss+=Pa(rs),rs=rs.return;while(rs);var ns=ss}catch(os){ns=`
Error generating stack: `+os.message+`
`+os.stack}return{value:es,source:ts,stack:ns,digest:null}}function Ki(es,ts,ss){return{value:es,source:null,stack:ss??null,digest:ts??null}}function Li(es,ts){try{console.error(ts.value)}catch(ss){setTimeout(function(){throw ss})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(es,ts,ss){ss=mh(-1,ss),ss.tag=3,ss.payload={element:null};var rs=ts.value;return ss.callback=function(){Oi||(Oi=!0,Pi=rs),Li(es,ts)},ss}function Qi(es,ts,ss){ss=mh(-1,ss),ss.tag=3;var rs=es.type.getDerivedStateFromError;if(typeof rs=="function"){var ns=ts.value;ss.payload=function(){return rs(ns)},ss.callback=function(){Li(es,ts)}}var os=es.stateNode;return os!==null&&typeof os.componentDidCatch=="function"&&(ss.callback=function(){Li(es,ts),typeof rs!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var as=ts.stack;this.componentDidCatch(ts.value,{componentStack:as!==null?as:""})}),ss}function Si(es,ts,ss){var rs=es.pingCache;if(rs===null){rs=es.pingCache=new Mi;var ns=new Set;rs.set(ts,ns)}else ns=rs.get(ts),ns===void 0&&(ns=new Set,rs.set(ts,ns));ns.has(ss)||(ns.add(ss),es=Ti.bind(null,es,ts,ss),ts.then(es,es))}function Ui(es){do{var ts;if((ts=es.tag===13)&&(ts=es.memoizedState,ts=ts!==null?ts.dehydrated!==null:!0),ts)return es;es=es.return}while(es!==null);return null}function Vi(es,ts,ss,rs,ns){return es.mode&1?(es.flags|=65536,es.lanes=ns,es):(es===ts?es.flags|=65536:(es.flags|=128,ss.flags|=131072,ss.flags&=-52805,ss.tag===1&&(ss.alternate===null?ss.tag=17:(ts=mh(-1,1),ts.tag=2,nh(ss,ts,1))),ss.lanes|=1),es)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(es,ts,ss,rs){ts.child=es===null?Vg(ts,null,ss,rs):Ug(ts,es.child,ss,rs)}function Yi(es,ts,ss,rs,ns){ss=ss.render;var os=ts.ref;return ch(ts,ns),rs=Nh(es,ts,ss,rs,os,ns),ss=Sh(),es!==null&&!dh?(ts.updateQueue=es.updateQueue,ts.flags&=-2053,es.lanes&=~ns,Zi(es,ts,ns)):(I$1&&ss&&vg(ts),ts.flags|=1,Xi(es,ts,rs,ns),ts.child)}function $i(es,ts,ss,rs,ns){if(es===null){var os=ss.type;return typeof os=="function"&&!aj(os)&&os.defaultProps===void 0&&ss.compare===null&&ss.defaultProps===void 0?(ts.tag=15,ts.type=os,bj(es,ts,os,rs,ns)):(es=Rg(ss.type,null,rs,ts,ts.mode,ns),es.ref=ts.ref,es.return=ts,ts.child=es)}if(os=es.child,!(es.lanes&ns)){var as=os.memoizedProps;if(ss=ss.compare,ss=ss!==null?ss:Ie$1,ss(as,rs)&&es.ref===ts.ref)return Zi(es,ts,ns)}return ts.flags|=1,es=Pg(os,rs),es.ref=ts.ref,es.return=ts,ts.child=es}function bj(es,ts,ss,rs,ns){if(es!==null){var os=es.memoizedProps;if(Ie$1(os,rs)&&es.ref===ts.ref)if(dh=!1,ts.pendingProps=rs=os,(es.lanes&ns)!==0)es.flags&131072&&(dh=!0);else return ts.lanes=es.lanes,Zi(es,ts,ns)}return cj(es,ts,ss,rs,ns)}function dj(es,ts,ss){var rs=ts.pendingProps,ns=rs.children,os=es!==null?es.memoizedState:null;if(rs.mode==="hidden")if(!(ts.mode&1))ts.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(ej,fj),fj|=ss;else{if(!(ss&1073741824))return es=os!==null?os.baseLanes|ss:ss,ts.lanes=ts.childLanes=1073741824,ts.memoizedState={baseLanes:es,cachePool:null,transitions:null},ts.updateQueue=null,G$1(ej,fj),fj|=es,null;ts.memoizedState={baseLanes:0,cachePool:null,transitions:null},rs=os!==null?os.baseLanes:ss,G$1(ej,fj),fj|=rs}else os!==null?(rs=os.baseLanes|ss,ts.memoizedState=null):rs=ss,G$1(ej,fj),fj|=rs;return Xi(es,ts,ns,ss),ts.child}function gj(es,ts){var ss=ts.ref;(es===null&&ss!==null||es!==null&&es.ref!==ss)&&(ts.flags|=512,ts.flags|=2097152)}function cj(es,ts,ss,rs,ns){var os=Zf(ss)?Xf:H$1.current;return os=Yf(ts,os),ch(ts,ns),ss=Nh(es,ts,ss,rs,os,ns),rs=Sh(),es!==null&&!dh?(ts.updateQueue=es.updateQueue,ts.flags&=-2053,es.lanes&=~ns,Zi(es,ts,ns)):(I$1&&rs&&vg(ts),ts.flags|=1,Xi(es,ts,ss,ns),ts.child)}function hj(es,ts,ss,rs,ns){if(Zf(ss)){var os=!0;cg(ts)}else os=!1;if(ch(ts,ns),ts.stateNode===null)ij(es,ts),Gi(ts,ss,rs),Ii(ts,ss,rs,ns),rs=!0;else if(es===null){var as=ts.stateNode,ls=ts.memoizedProps;as.props=ls;var cs=as.context,us=ss.contextType;typeof us=="object"&&us!==null?us=eh(us):(us=Zf(ss)?Xf:H$1.current,us=Yf(ts,us));var ds=ss.getDerivedStateFromProps,ms=typeof ds=="function"||typeof as.getSnapshotBeforeUpdate=="function";ms||typeof as.UNSAFE_componentWillReceiveProps!="function"&&typeof as.componentWillReceiveProps!="function"||(ls!==rs||cs!==us)&&Hi(ts,as,rs,us),jh=!1;var ps=ts.memoizedState;as.state=ps,qh(ts,rs,as,ns),cs=ts.memoizedState,ls!==rs||ps!==cs||Wf.current||jh?(typeof ds=="function"&&(Di(ts,ss,ds,rs),cs=ts.memoizedState),(ls=jh||Fi(ts,ss,ls,rs,ps,cs,us))?(ms||typeof as.UNSAFE_componentWillMount!="function"&&typeof as.componentWillMount!="function"||(typeof as.componentWillMount=="function"&&as.componentWillMount(),typeof as.UNSAFE_componentWillMount=="function"&&as.UNSAFE_componentWillMount()),typeof as.componentDidMount=="function"&&(ts.flags|=4194308)):(typeof as.componentDidMount=="function"&&(ts.flags|=4194308),ts.memoizedProps=rs,ts.memoizedState=cs),as.props=rs,as.state=cs,as.context=us,rs=ls):(typeof as.componentDidMount=="function"&&(ts.flags|=4194308),rs=!1)}else{as=ts.stateNode,lh(es,ts),ls=ts.memoizedProps,us=ts.type===ts.elementType?ls:Ci(ts.type,ls),as.props=us,ms=ts.pendingProps,ps=as.context,cs=ss.contextType,typeof cs=="object"&&cs!==null?cs=eh(cs):(cs=Zf(ss)?Xf:H$1.current,cs=Yf(ts,cs));var hs=ss.getDerivedStateFromProps;(ds=typeof hs=="function"||typeof as.getSnapshotBeforeUpdate=="function")||typeof as.UNSAFE_componentWillReceiveProps!="function"&&typeof as.componentWillReceiveProps!="function"||(ls!==ms||ps!==cs)&&Hi(ts,as,rs,cs),jh=!1,ps=ts.memoizedState,as.state=ps,qh(ts,rs,as,ns);var xs=ts.memoizedState;ls!==ms||ps!==xs||Wf.current||jh?(typeof hs=="function"&&(Di(ts,ss,hs,rs),xs=ts.memoizedState),(us=jh||Fi(ts,ss,us,rs,ps,xs,cs)||!1)?(ds||typeof as.UNSAFE_componentWillUpdate!="function"&&typeof as.componentWillUpdate!="function"||(typeof as.componentWillUpdate=="function"&&as.componentWillUpdate(rs,xs,cs),typeof as.UNSAFE_componentWillUpdate=="function"&&as.UNSAFE_componentWillUpdate(rs,xs,cs)),typeof as.componentDidUpdate=="function"&&(ts.flags|=4),typeof as.getSnapshotBeforeUpdate=="function"&&(ts.flags|=1024)):(typeof as.componentDidUpdate!="function"||ls===es.memoizedProps&&ps===es.memoizedState||(ts.flags|=4),typeof as.getSnapshotBeforeUpdate!="function"||ls===es.memoizedProps&&ps===es.memoizedState||(ts.flags|=1024),ts.memoizedProps=rs,ts.memoizedState=xs),as.props=rs,as.state=xs,as.context=cs,rs=us):(typeof as.componentDidUpdate!="function"||ls===es.memoizedProps&&ps===es.memoizedState||(ts.flags|=4),typeof as.getSnapshotBeforeUpdate!="function"||ls===es.memoizedProps&&ps===es.memoizedState||(ts.flags|=1024),rs=!1)}return jj(es,ts,ss,rs,os,ns)}function jj(es,ts,ss,rs,ns,os){gj(es,ts);var as=(ts.flags&128)!==0;if(!rs&&!as)return ns&&dg(ts,ss,!1),Zi(es,ts,os);rs=ts.stateNode,Wi.current=ts;var ls=as&&typeof ss.getDerivedStateFromError!="function"?null:rs.render();return ts.flags|=1,es!==null&&as?(ts.child=Ug(ts,es.child,null,os),ts.child=Ug(ts,null,ls,os)):Xi(es,ts,ls,os),ts.memoizedState=rs.state,ns&&dg(ts,ss,!0),ts.child}function kj(es){var ts=es.stateNode;ts.pendingContext?ag(es,ts.pendingContext,ts.pendingContext!==ts.context):ts.context&&ag(es,ts.context,!1),yh(es,ts.containerInfo)}function lj(es,ts,ss,rs,ns){return Ig(),Jg(ns),ts.flags|=256,Xi(es,ts,ss,rs),ts.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(es){return{baseLanes:es,cachePool:null,transitions:null}}function oj(es,ts,ss){var rs=ts.pendingProps,ns=L$1.current,os=!1,as=(ts.flags&128)!==0,ls;if((ls=as)||(ls=es!==null&&es.memoizedState===null?!1:(ns&2)!==0),ls?(os=!0,ts.flags&=-129):(es===null||es.memoizedState!==null)&&(ns|=1),G$1(L$1,ns&1),es===null)return Eg(ts),es=ts.memoizedState,es!==null&&(es=es.dehydrated,es!==null)?(ts.mode&1?es.data==="$!"?ts.lanes=8:ts.lanes=1073741824:ts.lanes=1,null):(as=rs.children,es=rs.fallback,os?(rs=ts.mode,os=ts.child,as={mode:"hidden",children:as},!(rs&1)&&os!==null?(os.childLanes=0,os.pendingProps=as):os=pj(as,rs,0,null),es=Tg(es,rs,ss,null),os.return=ts,es.return=ts,os.sibling=es,ts.child=os,ts.child.memoizedState=nj(ss),ts.memoizedState=mj,es):qj(ts,as));if(ns=es.memoizedState,ns!==null&&(ls=ns.dehydrated,ls!==null))return rj(es,ts,as,rs,ls,ns,ss);if(os){os=rs.fallback,as=ts.mode,ns=es.child,ls=ns.sibling;var cs={mode:"hidden",children:rs.children};return!(as&1)&&ts.child!==ns?(rs=ts.child,rs.childLanes=0,rs.pendingProps=cs,ts.deletions=null):(rs=Pg(ns,cs),rs.subtreeFlags=ns.subtreeFlags&14680064),ls!==null?os=Pg(ls,os):(os=Tg(os,as,ss,null),os.flags|=2),os.return=ts,rs.return=ts,rs.sibling=os,ts.child=rs,rs=os,os=ts.child,as=es.child.memoizedState,as=as===null?nj(ss):{baseLanes:as.baseLanes|ss,cachePool:null,transitions:as.transitions},os.memoizedState=as,os.childLanes=es.childLanes&~ss,ts.memoizedState=mj,rs}return os=es.child,es=os.sibling,rs=Pg(os,{mode:"visible",children:rs.children}),!(ts.mode&1)&&(rs.lanes=ss),rs.return=ts,rs.sibling=null,es!==null&&(ss=ts.deletions,ss===null?(ts.deletions=[es],ts.flags|=16):ss.push(es)),ts.child=rs,ts.memoizedState=null,rs}function qj(es,ts){return ts=pj({mode:"visible",children:ts},es.mode,0,null),ts.return=es,es.child=ts}function sj(es,ts,ss,rs){return rs!==null&&Jg(rs),Ug(ts,es.child,null,ss),es=qj(ts,ts.pendingProps.children),es.flags|=2,ts.memoizedState=null,es}function rj(es,ts,ss,rs,ns,os,as){if(ss)return ts.flags&256?(ts.flags&=-257,rs=Ki(Error(p$1(422))),sj(es,ts,as,rs)):ts.memoizedState!==null?(ts.child=es.child,ts.flags|=128,null):(os=rs.fallback,ns=ts.mode,rs=pj({mode:"visible",children:rs.children},ns,0,null),os=Tg(os,ns,as,null),os.flags|=2,rs.return=ts,os.return=ts,rs.sibling=os,ts.child=rs,ts.mode&1&&Ug(ts,es.child,null,as),ts.child.memoizedState=nj(as),ts.memoizedState=mj,os);if(!(ts.mode&1))return sj(es,ts,as,null);if(ns.data==="$!"){if(rs=ns.nextSibling&&ns.nextSibling.dataset,rs)var ls=rs.dgst;return rs=ls,os=Error(p$1(419)),rs=Ki(os,rs,void 0),sj(es,ts,as,rs)}if(ls=(as&es.childLanes)!==0,dh||ls){if(rs=Q$1,rs!==null){switch(as&-as){case 4:ns=2;break;case 16:ns=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ns=32;break;case 536870912:ns=268435456;break;default:ns=0}ns=ns&(rs.suspendedLanes|as)?0:ns,ns!==0&&ns!==os.retryLane&&(os.retryLane=ns,ih(es,ns),gi(rs,es,ns,-1))}return tj(),rs=Ki(Error(p$1(421))),sj(es,ts,as,rs)}return ns.data==="$?"?(ts.flags|=128,ts.child=es.child,ts=uj.bind(null,es),ns._reactRetry=ts,null):(es=os.treeContext,yg=Lf(ns.nextSibling),xg=ts,I$1=!0,zg=null,es!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=es.id,sg=es.overflow,qg=ts),ts=qj(ts,rs.children),ts.flags|=4096,ts)}function vj(es,ts,ss){es.lanes|=ts;var rs=es.alternate;rs!==null&&(rs.lanes|=ts),bh(es.return,ts,ss)}function wj(es,ts,ss,rs,ns){var os=es.memoizedState;os===null?es.memoizedState={isBackwards:ts,rendering:null,renderingStartTime:0,last:rs,tail:ss,tailMode:ns}:(os.isBackwards=ts,os.rendering=null,os.renderingStartTime=0,os.last=rs,os.tail=ss,os.tailMode=ns)}function xj(es,ts,ss){var rs=ts.pendingProps,ns=rs.revealOrder,os=rs.tail;if(Xi(es,ts,rs.children,ss),rs=L$1.current,rs&2)rs=rs&1|2,ts.flags|=128;else{if(es!==null&&es.flags&128)e:for(es=ts.child;es!==null;){if(es.tag===13)es.memoizedState!==null&&vj(es,ss,ts);else if(es.tag===19)vj(es,ss,ts);else if(es.child!==null){es.child.return=es,es=es.child;continue}if(es===ts)break e;for(;es.sibling===null;){if(es.return===null||es.return===ts)break e;es=es.return}es.sibling.return=es.return,es=es.sibling}rs&=1}if(G$1(L$1,rs),!(ts.mode&1))ts.memoizedState=null;else switch(ns){case"forwards":for(ss=ts.child,ns=null;ss!==null;)es=ss.alternate,es!==null&&Ch(es)===null&&(ns=ss),ss=ss.sibling;ss=ns,ss===null?(ns=ts.child,ts.child=null):(ns=ss.sibling,ss.sibling=null),wj(ts,!1,ns,ss,os);break;case"backwards":for(ss=null,ns=ts.child,ts.child=null;ns!==null;){if(es=ns.alternate,es!==null&&Ch(es)===null){ts.child=ns;break}es=ns.sibling,ns.sibling=ss,ss=ns,ns=es}wj(ts,!0,ss,null,os);break;case"together":wj(ts,!1,null,null,void 0);break;default:ts.memoizedState=null}return ts.child}function ij(es,ts){!(ts.mode&1)&&es!==null&&(es.alternate=null,ts.alternate=null,ts.flags|=2)}function Zi(es,ts,ss){if(es!==null&&(ts.dependencies=es.dependencies),rh|=ts.lanes,!(ss&ts.childLanes))return null;if(es!==null&&ts.child!==es.child)throw Error(p$1(153));if(ts.child!==null){for(es=ts.child,ss=Pg(es,es.pendingProps),ts.child=ss,ss.return=ts;es.sibling!==null;)es=es.sibling,ss=ss.sibling=Pg(es,es.pendingProps),ss.return=ts;ss.sibling=null}return ts.child}function yj(es,ts,ss){switch(ts.tag){case 3:kj(ts),Ig();break;case 5:Ah(ts);break;case 1:Zf(ts.type)&&cg(ts);break;case 4:yh(ts,ts.stateNode.containerInfo);break;case 10:var rs=ts.type._context,ns=ts.memoizedProps.value;G$1(Wg,rs._currentValue),rs._currentValue=ns;break;case 13:if(rs=ts.memoizedState,rs!==null)return rs.dehydrated!==null?(G$1(L$1,L$1.current&1),ts.flags|=128,null):ss&ts.child.childLanes?oj(es,ts,ss):(G$1(L$1,L$1.current&1),es=Zi(es,ts,ss),es!==null?es.sibling:null);G$1(L$1,L$1.current&1);break;case 19:if(rs=(ss&ts.childLanes)!==0,es.flags&128){if(rs)return xj(es,ts,ss);ts.flags|=128}if(ns=ts.memoizedState,ns!==null&&(ns.rendering=null,ns.tail=null,ns.lastEffect=null),G$1(L$1,L$1.current),rs)break;return null;case 22:case 23:return ts.lanes=0,dj(es,ts,ss)}return Zi(es,ts,ss)}var zj,Aj,Bj,Cj;zj=function(es,ts){for(var ss=ts.child;ss!==null;){if(ss.tag===5||ss.tag===6)es.appendChild(ss.stateNode);else if(ss.tag!==4&&ss.child!==null){ss.child.return=ss,ss=ss.child;continue}if(ss===ts)break;for(;ss.sibling===null;){if(ss.return===null||ss.return===ts)return;ss=ss.return}ss.sibling.return=ss.return,ss=ss.sibling}};Aj=function(){};Bj=function(es,ts,ss,rs){var ns=es.memoizedProps;if(ns!==rs){es=ts.stateNode,xh(uh.current);var os=null;switch(ss){case"input":ns=Ya(es,ns),rs=Ya(es,rs),os=[];break;case"select":ns=A$1({},ns,{value:void 0}),rs=A$1({},rs,{value:void 0}),os=[];break;case"textarea":ns=gb(es,ns),rs=gb(es,rs),os=[];break;default:typeof ns.onClick!="function"&&typeof rs.onClick=="function"&&(es.onclick=Bf)}ub(ss,rs);var as;ss=null;for(us in ns)if(!rs.hasOwnProperty(us)&&ns.hasOwnProperty(us)&&ns[us]!=null)if(us==="style"){var ls=ns[us];for(as in ls)ls.hasOwnProperty(as)&&(ss||(ss={}),ss[as]="")}else us!=="dangerouslySetInnerHTML"&&us!=="children"&&us!=="suppressContentEditableWarning"&&us!=="suppressHydrationWarning"&&us!=="autoFocus"&&(ea.hasOwnProperty(us)?os||(os=[]):(os=os||[]).push(us,null));for(us in rs){var cs=rs[us];if(ls=ns!=null?ns[us]:void 0,rs.hasOwnProperty(us)&&cs!==ls&&(cs!=null||ls!=null))if(us==="style")if(ls){for(as in ls)!ls.hasOwnProperty(as)||cs&&cs.hasOwnProperty(as)||(ss||(ss={}),ss[as]="");for(as in cs)cs.hasOwnProperty(as)&&ls[as]!==cs[as]&&(ss||(ss={}),ss[as]=cs[as])}else ss||(os||(os=[]),os.push(us,ss)),ss=cs;else us==="dangerouslySetInnerHTML"?(cs=cs?cs.__html:void 0,ls=ls?ls.__html:void 0,cs!=null&&ls!==cs&&(os=os||[]).push(us,cs)):us==="children"?typeof cs!="string"&&typeof cs!="number"||(os=os||[]).push(us,""+cs):us!=="suppressContentEditableWarning"&&us!=="suppressHydrationWarning"&&(ea.hasOwnProperty(us)?(cs!=null&&us==="onScroll"&&D$1("scroll",es),os||ls===cs||(os=[])):(os=os||[]).push(us,cs))}ss&&(os=os||[]).push("style",ss);var us=os;(ts.updateQueue=us)&&(ts.flags|=4)}};Cj=function(es,ts,ss,rs){ss!==rs&&(ts.flags|=4)};function Dj(es,ts){if(!I$1)switch(es.tailMode){case"hidden":ts=es.tail;for(var ss=null;ts!==null;)ts.alternate!==null&&(ss=ts),ts=ts.sibling;ss===null?es.tail=null:ss.sibling=null;break;case"collapsed":ss=es.tail;for(var rs=null;ss!==null;)ss.alternate!==null&&(rs=ss),ss=ss.sibling;rs===null?ts||es.tail===null?es.tail=null:es.tail.sibling=null:rs.sibling=null}}function S$1(es){var ts=es.alternate!==null&&es.alternate.child===es.child,ss=0,rs=0;if(ts)for(var ns=es.child;ns!==null;)ss|=ns.lanes|ns.childLanes,rs|=ns.subtreeFlags&14680064,rs|=ns.flags&14680064,ns.return=es,ns=ns.sibling;else for(ns=es.child;ns!==null;)ss|=ns.lanes|ns.childLanes,rs|=ns.subtreeFlags,rs|=ns.flags,ns.return=es,ns=ns.sibling;return es.subtreeFlags|=rs,es.childLanes=ss,ts}function Ej(es,ts,ss){var rs=ts.pendingProps;switch(wg(ts),ts.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(ts),null;case 1:return Zf(ts.type)&&$f(),S$1(ts),null;case 3:return rs=ts.stateNode,zh(),E$1(Wf),E$1(H$1),Eh(),rs.pendingContext&&(rs.context=rs.pendingContext,rs.pendingContext=null),(es===null||es.child===null)&&(Gg(ts)?ts.flags|=4:es===null||es.memoizedState.isDehydrated&&!(ts.flags&256)||(ts.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(es,ts),S$1(ts),null;case 5:Bh(ts);var ns=xh(wh.current);if(ss=ts.type,es!==null&&ts.stateNode!=null)Bj(es,ts,ss,rs,ns),es.ref!==ts.ref&&(ts.flags|=512,ts.flags|=2097152);else{if(!rs){if(ts.stateNode===null)throw Error(p$1(166));return S$1(ts),null}if(es=xh(uh.current),Gg(ts)){rs=ts.stateNode,ss=ts.type;var os=ts.memoizedProps;switch(rs[Of]=ts,rs[Pf]=os,es=(ts.mode&1)!==0,ss){case"dialog":D$1("cancel",rs),D$1("close",rs);break;case"iframe":case"object":case"embed":D$1("load",rs);break;case"video":case"audio":for(ns=0;ns<lf.length;ns++)D$1(lf[ns],rs);break;case"source":D$1("error",rs);break;case"img":case"image":case"link":D$1("error",rs),D$1("load",rs);break;case"details":D$1("toggle",rs);break;case"input":Za(rs,os),D$1("invalid",rs);break;case"select":rs._wrapperState={wasMultiple:!!os.multiple},D$1("invalid",rs);break;case"textarea":hb(rs,os),D$1("invalid",rs)}ub(ss,os),ns=null;for(var as in os)if(os.hasOwnProperty(as)){var ls=os[as];as==="children"?typeof ls=="string"?rs.textContent!==ls&&(os.suppressHydrationWarning!==!0&&Af(rs.textContent,ls,es),ns=["children",ls]):typeof ls=="number"&&rs.textContent!==""+ls&&(os.suppressHydrationWarning!==!0&&Af(rs.textContent,ls,es),ns=["children",""+ls]):ea.hasOwnProperty(as)&&ls!=null&&as==="onScroll"&&D$1("scroll",rs)}switch(ss){case"input":Va(rs),db$1(rs,os,!0);break;case"textarea":Va(rs),jb(rs);break;case"select":case"option":break;default:typeof os.onClick=="function"&&(rs.onclick=Bf)}rs=ns,ts.updateQueue=rs,rs!==null&&(ts.flags|=4)}else{as=ns.nodeType===9?ns:ns.ownerDocument,es==="http://www.w3.org/1999/xhtml"&&(es=kb(ss)),es==="http://www.w3.org/1999/xhtml"?ss==="script"?(es=as.createElement("div"),es.innerHTML="<script><\/script>",es=es.removeChild(es.firstChild)):typeof rs.is=="string"?es=as.createElement(ss,{is:rs.is}):(es=as.createElement(ss),ss==="select"&&(as=es,rs.multiple?as.multiple=!0:rs.size&&(as.size=rs.size))):es=as.createElementNS(es,ss),es[Of]=ts,es[Pf]=rs,zj(es,ts,!1,!1),ts.stateNode=es;e:{switch(as=vb(ss,rs),ss){case"dialog":D$1("cancel",es),D$1("close",es),ns=rs;break;case"iframe":case"object":case"embed":D$1("load",es),ns=rs;break;case"video":case"audio":for(ns=0;ns<lf.length;ns++)D$1(lf[ns],es);ns=rs;break;case"source":D$1("error",es),ns=rs;break;case"img":case"image":case"link":D$1("error",es),D$1("load",es),ns=rs;break;case"details":D$1("toggle",es),ns=rs;break;case"input":Za(es,rs),ns=Ya(es,rs),D$1("invalid",es);break;case"option":ns=rs;break;case"select":es._wrapperState={wasMultiple:!!rs.multiple},ns=A$1({},rs,{value:void 0}),D$1("invalid",es);break;case"textarea":hb(es,rs),ns=gb(es,rs),D$1("invalid",es);break;default:ns=rs}ub(ss,ns),ls=ns;for(os in ls)if(ls.hasOwnProperty(os)){var cs=ls[os];os==="style"?sb(es,cs):os==="dangerouslySetInnerHTML"?(cs=cs?cs.__html:void 0,cs!=null&&nb(es,cs)):os==="children"?typeof cs=="string"?(ss!=="textarea"||cs!=="")&&ob(es,cs):typeof cs=="number"&&ob(es,""+cs):os!=="suppressContentEditableWarning"&&os!=="suppressHydrationWarning"&&os!=="autoFocus"&&(ea.hasOwnProperty(os)?cs!=null&&os==="onScroll"&&D$1("scroll",es):cs!=null&&ta(es,os,cs,as))}switch(ss){case"input":Va(es),db$1(es,rs,!1);break;case"textarea":Va(es),jb(es);break;case"option":rs.value!=null&&es.setAttribute("value",""+Sa(rs.value));break;case"select":es.multiple=!!rs.multiple,os=rs.value,os!=null?fb(es,!!rs.multiple,os,!1):rs.defaultValue!=null&&fb(es,!!rs.multiple,rs.defaultValue,!0);break;default:typeof ns.onClick=="function"&&(es.onclick=Bf)}switch(ss){case"button":case"input":case"select":case"textarea":rs=!!rs.autoFocus;break e;case"img":rs=!0;break e;default:rs=!1}}rs&&(ts.flags|=4)}ts.ref!==null&&(ts.flags|=512,ts.flags|=2097152)}return S$1(ts),null;case 6:if(es&&ts.stateNode!=null)Cj(es,ts,es.memoizedProps,rs);else{if(typeof rs!="string"&&ts.stateNode===null)throw Error(p$1(166));if(ss=xh(wh.current),xh(uh.current),Gg(ts)){if(rs=ts.stateNode,ss=ts.memoizedProps,rs[Of]=ts,(os=rs.nodeValue!==ss)&&(es=xg,es!==null))switch(es.tag){case 3:Af(rs.nodeValue,ss,(es.mode&1)!==0);break;case 5:es.memoizedProps.suppressHydrationWarning!==!0&&Af(rs.nodeValue,ss,(es.mode&1)!==0)}os&&(ts.flags|=4)}else rs=(ss.nodeType===9?ss:ss.ownerDocument).createTextNode(rs),rs[Of]=ts,ts.stateNode=rs}return S$1(ts),null;case 13:if(E$1(L$1),rs=ts.memoizedState,es===null||es.memoizedState!==null&&es.memoizedState.dehydrated!==null){if(I$1&&yg!==null&&ts.mode&1&&!(ts.flags&128))Hg(),Ig(),ts.flags|=98560,os=!1;else if(os=Gg(ts),rs!==null&&rs.dehydrated!==null){if(es===null){if(!os)throw Error(p$1(318));if(os=ts.memoizedState,os=os!==null?os.dehydrated:null,!os)throw Error(p$1(317));os[Of]=ts}else Ig(),!(ts.flags&128)&&(ts.memoizedState=null),ts.flags|=4;S$1(ts),os=!1}else zg!==null&&(Fj(zg),zg=null),os=!0;if(!os)return ts.flags&65536?ts:null}return ts.flags&128?(ts.lanes=ss,ts):(rs=rs!==null,rs!==(es!==null&&es.memoizedState!==null)&&rs&&(ts.child.flags|=8192,ts.mode&1&&(es===null||L$1.current&1?T$1===0&&(T$1=3):tj())),ts.updateQueue!==null&&(ts.flags|=4),S$1(ts),null);case 4:return zh(),Aj(es,ts),es===null&&sf(ts.stateNode.containerInfo),S$1(ts),null;case 10:return ah(ts.type._context),S$1(ts),null;case 17:return Zf(ts.type)&&$f(),S$1(ts),null;case 19:if(E$1(L$1),os=ts.memoizedState,os===null)return S$1(ts),null;if(rs=(ts.flags&128)!==0,as=os.rendering,as===null)if(rs)Dj(os,!1);else{if(T$1!==0||es!==null&&es.flags&128)for(es=ts.child;es!==null;){if(as=Ch(es),as!==null){for(ts.flags|=128,Dj(os,!1),rs=as.updateQueue,rs!==null&&(ts.updateQueue=rs,ts.flags|=4),ts.subtreeFlags=0,rs=ss,ss=ts.child;ss!==null;)os=ss,es=rs,os.flags&=14680066,as=os.alternate,as===null?(os.childLanes=0,os.lanes=es,os.child=null,os.subtreeFlags=0,os.memoizedProps=null,os.memoizedState=null,os.updateQueue=null,os.dependencies=null,os.stateNode=null):(os.childLanes=as.childLanes,os.lanes=as.lanes,os.child=as.child,os.subtreeFlags=0,os.deletions=null,os.memoizedProps=as.memoizedProps,os.memoizedState=as.memoizedState,os.updateQueue=as.updateQueue,os.type=as.type,es=as.dependencies,os.dependencies=es===null?null:{lanes:es.lanes,firstContext:es.firstContext}),ss=ss.sibling;return G$1(L$1,L$1.current&1|2),ts.child}es=es.sibling}os.tail!==null&&B$1()>Gj&&(ts.flags|=128,rs=!0,Dj(os,!1),ts.lanes=4194304)}else{if(!rs)if(es=Ch(as),es!==null){if(ts.flags|=128,rs=!0,ss=es.updateQueue,ss!==null&&(ts.updateQueue=ss,ts.flags|=4),Dj(os,!0),os.tail===null&&os.tailMode==="hidden"&&!as.alternate&&!I$1)return S$1(ts),null}else 2*B$1()-os.renderingStartTime>Gj&&ss!==1073741824&&(ts.flags|=128,rs=!0,Dj(os,!1),ts.lanes=4194304);os.isBackwards?(as.sibling=ts.child,ts.child=as):(ss=os.last,ss!==null?ss.sibling=as:ts.child=as,os.last=as)}return os.tail!==null?(ts=os.tail,os.rendering=ts,os.tail=ts.sibling,os.renderingStartTime=B$1(),ts.sibling=null,ss=L$1.current,G$1(L$1,rs?ss&1|2:ss&1),ts):(S$1(ts),null);case 22:case 23:return Hj(),rs=ts.memoizedState!==null,es!==null&&es.memoizedState!==null!==rs&&(ts.flags|=8192),rs&&ts.mode&1?fj&1073741824&&(S$1(ts),ts.subtreeFlags&6&&(ts.flags|=8192)):S$1(ts),null;case 24:return null;case 25:return null}throw Error(p$1(156,ts.tag))}function Ij(es,ts){switch(wg(ts),ts.tag){case 1:return Zf(ts.type)&&$f(),es=ts.flags,es&65536?(ts.flags=es&-65537|128,ts):null;case 3:return zh(),E$1(Wf),E$1(H$1),Eh(),es=ts.flags,es&65536&&!(es&128)?(ts.flags=es&-65537|128,ts):null;case 5:return Bh(ts),null;case 13:if(E$1(L$1),es=ts.memoizedState,es!==null&&es.dehydrated!==null){if(ts.alternate===null)throw Error(p$1(340));Ig()}return es=ts.flags,es&65536?(ts.flags=es&-65537|128,ts):null;case 19:return E$1(L$1),null;case 4:return zh(),null;case 10:return ah(ts.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U$1=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Lj(es,ts){var ss=es.ref;if(ss!==null)if(typeof ss=="function")try{ss(null)}catch(rs){W$1(es,ts,rs)}else ss.current=null}function Mj(es,ts,ss){try{ss()}catch(rs){W$1(es,ts,rs)}}var Nj=!1;function Oj(es,ts){if(Cf=dd,es=Me$1(),Ne$1(es)){if("selectionStart"in es)var ss={start:es.selectionStart,end:es.selectionEnd};else e:{ss=(ss=es.ownerDocument)&&ss.defaultView||window;var rs=ss.getSelection&&ss.getSelection();if(rs&&rs.rangeCount!==0){ss=rs.anchorNode;var ns=rs.anchorOffset,os=rs.focusNode;rs=rs.focusOffset;try{ss.nodeType,os.nodeType}catch{ss=null;break e}var as=0,ls=-1,cs=-1,us=0,ds=0,ms=es,ps=null;t:for(;;){for(var hs;ms!==ss||ns!==0&&ms.nodeType!==3||(ls=as+ns),ms!==os||rs!==0&&ms.nodeType!==3||(cs=as+rs),ms.nodeType===3&&(as+=ms.nodeValue.length),(hs=ms.firstChild)!==null;)ps=ms,ms=hs;for(;;){if(ms===es)break t;if(ps===ss&&++us===ns&&(ls=as),ps===os&&++ds===rs&&(cs=as),(hs=ms.nextSibling)!==null)break;ms=ps,ps=ms.parentNode}ms=hs}ss=ls===-1||cs===-1?null:{start:ls,end:cs}}else ss=null}ss=ss||{start:0,end:0}}else ss=null;for(Df={focusedElem:es,selectionRange:ss},dd=!1,V$1=ts;V$1!==null;)if(ts=V$1,es=ts.child,(ts.subtreeFlags&1028)!==0&&es!==null)es.return=ts,V$1=es;else for(;V$1!==null;){ts=V$1;try{var xs=ts.alternate;if(ts.flags&1024)switch(ts.tag){case 0:case 11:case 15:break;case 1:if(xs!==null){var ys=xs.memoizedProps,vs=xs.memoizedState,gs=ts.stateNode,fs=gs.getSnapshotBeforeUpdate(ts.elementType===ts.type?ys:Ci(ts.type,ys),vs);gs.__reactInternalSnapshotBeforeUpdate=fs}break;case 3:var js=ts.stateNode.containerInfo;js.nodeType===1?js.textContent="":js.nodeType===9&&js.documentElement&&js.removeChild(js.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(Ss){W$1(ts,ts.return,Ss)}if(es=ts.sibling,es!==null){es.return=ts.return,V$1=es;break}V$1=ts.return}return xs=Nj,Nj=!1,xs}function Pj(es,ts,ss){var rs=ts.updateQueue;if(rs=rs!==null?rs.lastEffect:null,rs!==null){var ns=rs=rs.next;do{if((ns.tag&es)===es){var os=ns.destroy;ns.destroy=void 0,os!==void 0&&Mj(ts,ss,os)}ns=ns.next}while(ns!==rs)}}function Qj(es,ts){if(ts=ts.updateQueue,ts=ts!==null?ts.lastEffect:null,ts!==null){var ss=ts=ts.next;do{if((ss.tag&es)===es){var rs=ss.create;ss.destroy=rs()}ss=ss.next}while(ss!==ts)}}function Rj(es){var ts=es.ref;if(ts!==null){var ss=es.stateNode;switch(es.tag){case 5:es=ss;break;default:es=ss}typeof ts=="function"?ts(es):ts.current=es}}function Sj(es){var ts=es.alternate;ts!==null&&(es.alternate=null,Sj(ts)),es.child=null,es.deletions=null,es.sibling=null,es.tag===5&&(ts=es.stateNode,ts!==null&&(delete ts[Of],delete ts[Pf],delete ts[of],delete ts[Qf],delete ts[Rf])),es.stateNode=null,es.return=null,es.dependencies=null,es.memoizedProps=null,es.memoizedState=null,es.pendingProps=null,es.stateNode=null,es.updateQueue=null}function Tj(es){return es.tag===5||es.tag===3||es.tag===4}function Uj(es){e:for(;;){for(;es.sibling===null;){if(es.return===null||Tj(es.return))return null;es=es.return}for(es.sibling.return=es.return,es=es.sibling;es.tag!==5&&es.tag!==6&&es.tag!==18;){if(es.flags&2||es.child===null||es.tag===4)continue e;es.child.return=es,es=es.child}if(!(es.flags&2))return es.stateNode}}function Vj(es,ts,ss){var rs=es.tag;if(rs===5||rs===6)es=es.stateNode,ts?ss.nodeType===8?ss.parentNode.insertBefore(es,ts):ss.insertBefore(es,ts):(ss.nodeType===8?(ts=ss.parentNode,ts.insertBefore(es,ss)):(ts=ss,ts.appendChild(es)),ss=ss._reactRootContainer,ss!=null||ts.onclick!==null||(ts.onclick=Bf));else if(rs!==4&&(es=es.child,es!==null))for(Vj(es,ts,ss),es=es.sibling;es!==null;)Vj(es,ts,ss),es=es.sibling}function Wj(es,ts,ss){var rs=es.tag;if(rs===5||rs===6)es=es.stateNode,ts?ss.insertBefore(es,ts):ss.appendChild(es);else if(rs!==4&&(es=es.child,es!==null))for(Wj(es,ts,ss),es=es.sibling;es!==null;)Wj(es,ts,ss),es=es.sibling}var X$1=null,Xj=!1;function Yj(es,ts,ss){for(ss=ss.child;ss!==null;)Zj(es,ts,ss),ss=ss.sibling}function Zj(es,ts,ss){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,ss)}catch{}switch(ss.tag){case 5:U$1||Lj(ss,ts);case 6:var rs=X$1,ns=Xj;X$1=null,Yj(es,ts,ss),X$1=rs,Xj=ns,X$1!==null&&(Xj?(es=X$1,ss=ss.stateNode,es.nodeType===8?es.parentNode.removeChild(ss):es.removeChild(ss)):X$1.removeChild(ss.stateNode));break;case 18:X$1!==null&&(Xj?(es=X$1,ss=ss.stateNode,es.nodeType===8?Kf(es.parentNode,ss):es.nodeType===1&&Kf(es,ss),bd(es)):Kf(X$1,ss.stateNode));break;case 4:rs=X$1,ns=Xj,X$1=ss.stateNode.containerInfo,Xj=!0,Yj(es,ts,ss),X$1=rs,Xj=ns;break;case 0:case 11:case 14:case 15:if(!U$1&&(rs=ss.updateQueue,rs!==null&&(rs=rs.lastEffect,rs!==null))){ns=rs=rs.next;do{var os=ns,as=os.destroy;os=os.tag,as!==void 0&&(os&2||os&4)&&Mj(ss,ts,as),ns=ns.next}while(ns!==rs)}Yj(es,ts,ss);break;case 1:if(!U$1&&(Lj(ss,ts),rs=ss.stateNode,typeof rs.componentWillUnmount=="function"))try{rs.props=ss.memoizedProps,rs.state=ss.memoizedState,rs.componentWillUnmount()}catch(ls){W$1(ss,ts,ls)}Yj(es,ts,ss);break;case 21:Yj(es,ts,ss);break;case 22:ss.mode&1?(U$1=(rs=U$1)||ss.memoizedState!==null,Yj(es,ts,ss),U$1=rs):Yj(es,ts,ss);break;default:Yj(es,ts,ss)}}function ak(es){var ts=es.updateQueue;if(ts!==null){es.updateQueue=null;var ss=es.stateNode;ss===null&&(ss=es.stateNode=new Kj),ts.forEach(function(rs){var ns=bk.bind(null,es,rs);ss.has(rs)||(ss.add(rs),rs.then(ns,ns))})}}function ck(es,ts){var ss=ts.deletions;if(ss!==null)for(var rs=0;rs<ss.length;rs++){var ns=ss[rs];try{var os=es,as=ts,ls=as;e:for(;ls!==null;){switch(ls.tag){case 5:X$1=ls.stateNode,Xj=!1;break e;case 3:X$1=ls.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=ls.stateNode.containerInfo,Xj=!0;break e}ls=ls.return}if(X$1===null)throw Error(p$1(160));Zj(os,as,ns),X$1=null,Xj=!1;var cs=ns.alternate;cs!==null&&(cs.return=null),ns.return=null}catch(us){W$1(ns,ts,us)}}if(ts.subtreeFlags&12854)for(ts=ts.child;ts!==null;)dk(ts,es),ts=ts.sibling}function dk(es,ts){var ss=es.alternate,rs=es.flags;switch(es.tag){case 0:case 11:case 14:case 15:if(ck(ts,es),ek(es),rs&4){try{Pj(3,es,es.return),Qj(3,es)}catch(ys){W$1(es,es.return,ys)}try{Pj(5,es,es.return)}catch(ys){W$1(es,es.return,ys)}}break;case 1:ck(ts,es),ek(es),rs&512&&ss!==null&&Lj(ss,ss.return);break;case 5:if(ck(ts,es),ek(es),rs&512&&ss!==null&&Lj(ss,ss.return),es.flags&32){var ns=es.stateNode;try{ob(ns,"")}catch(ys){W$1(es,es.return,ys)}}if(rs&4&&(ns=es.stateNode,ns!=null)){var os=es.memoizedProps,as=ss!==null?ss.memoizedProps:os,ls=es.type,cs=es.updateQueue;if(es.updateQueue=null,cs!==null)try{ls==="input"&&os.type==="radio"&&os.name!=null&&ab(ns,os),vb(ls,as);var us=vb(ls,os);for(as=0;as<cs.length;as+=2){var ds=cs[as],ms=cs[as+1];ds==="style"?sb(ns,ms):ds==="dangerouslySetInnerHTML"?nb(ns,ms):ds==="children"?ob(ns,ms):ta(ns,ds,ms,us)}switch(ls){case"input":bb(ns,os);break;case"textarea":ib(ns,os);break;case"select":var ps=ns._wrapperState.wasMultiple;ns._wrapperState.wasMultiple=!!os.multiple;var hs=os.value;hs!=null?fb(ns,!!os.multiple,hs,!1):ps!==!!os.multiple&&(os.defaultValue!=null?fb(ns,!!os.multiple,os.defaultValue,!0):fb(ns,!!os.multiple,os.multiple?[]:"",!1))}ns[Pf]=os}catch(ys){W$1(es,es.return,ys)}}break;case 6:if(ck(ts,es),ek(es),rs&4){if(es.stateNode===null)throw Error(p$1(162));ns=es.stateNode,os=es.memoizedProps;try{ns.nodeValue=os}catch(ys){W$1(es,es.return,ys)}}break;case 3:if(ck(ts,es),ek(es),rs&4&&ss!==null&&ss.memoizedState.isDehydrated)try{bd(ts.containerInfo)}catch(ys){W$1(es,es.return,ys)}break;case 4:ck(ts,es),ek(es);break;case 13:ck(ts,es),ek(es),ns=es.child,ns.flags&8192&&(os=ns.memoizedState!==null,ns.stateNode.isHidden=os,!os||ns.alternate!==null&&ns.alternate.memoizedState!==null||(fk=B$1())),rs&4&&ak(es);break;case 22:if(ds=ss!==null&&ss.memoizedState!==null,es.mode&1?(U$1=(us=U$1)||ds,ck(ts,es),U$1=us):ck(ts,es),ek(es),rs&8192){if(us=es.memoizedState!==null,(es.stateNode.isHidden=us)&&!ds&&es.mode&1)for(V$1=es,ds=es.child;ds!==null;){for(ms=V$1=ds;V$1!==null;){switch(ps=V$1,hs=ps.child,ps.tag){case 0:case 11:case 14:case 15:Pj(4,ps,ps.return);break;case 1:Lj(ps,ps.return);var xs=ps.stateNode;if(typeof xs.componentWillUnmount=="function"){rs=ps,ss=ps.return;try{ts=rs,xs.props=ts.memoizedProps,xs.state=ts.memoizedState,xs.componentWillUnmount()}catch(ys){W$1(rs,ss,ys)}}break;case 5:Lj(ps,ps.return);break;case 22:if(ps.memoizedState!==null){gk(ms);continue}}hs!==null?(hs.return=ps,V$1=hs):gk(ms)}ds=ds.sibling}e:for(ds=null,ms=es;;){if(ms.tag===5){if(ds===null){ds=ms;try{ns=ms.stateNode,us?(os=ns.style,typeof os.setProperty=="function"?os.setProperty("display","none","important"):os.display="none"):(ls=ms.stateNode,cs=ms.memoizedProps.style,as=cs!=null&&cs.hasOwnProperty("display")?cs.display:null,ls.style.display=rb("display",as))}catch(ys){W$1(es,es.return,ys)}}}else if(ms.tag===6){if(ds===null)try{ms.stateNode.nodeValue=us?"":ms.memoizedProps}catch(ys){W$1(es,es.return,ys)}}else if((ms.tag!==22&&ms.tag!==23||ms.memoizedState===null||ms===es)&&ms.child!==null){ms.child.return=ms,ms=ms.child;continue}if(ms===es)break e;for(;ms.sibling===null;){if(ms.return===null||ms.return===es)break e;ds===ms&&(ds=null),ms=ms.return}ds===ms&&(ds=null),ms.sibling.return=ms.return,ms=ms.sibling}}break;case 19:ck(ts,es),ek(es),rs&4&&ak(es);break;case 21:break;default:ck(ts,es),ek(es)}}function ek(es){var ts=es.flags;if(ts&2){try{e:{for(var ss=es.return;ss!==null;){if(Tj(ss)){var rs=ss;break e}ss=ss.return}throw Error(p$1(160))}switch(rs.tag){case 5:var ns=rs.stateNode;rs.flags&32&&(ob(ns,""),rs.flags&=-33);var os=Uj(es);Wj(es,os,ns);break;case 3:case 4:var as=rs.stateNode.containerInfo,ls=Uj(es);Vj(es,ls,as);break;default:throw Error(p$1(161))}}catch(cs){W$1(es,es.return,cs)}es.flags&=-3}ts&4096&&(es.flags&=-4097)}function hk(es,ts,ss){V$1=es,ik(es)}function ik(es,ts,ss){for(var rs=(es.mode&1)!==0;V$1!==null;){var ns=V$1,os=ns.child;if(ns.tag===22&&rs){var as=ns.memoizedState!==null||Jj;if(!as){var ls=ns.alternate,cs=ls!==null&&ls.memoizedState!==null||U$1;ls=Jj;var us=U$1;if(Jj=as,(U$1=cs)&&!us)for(V$1=ns;V$1!==null;)as=V$1,cs=as.child,as.tag===22&&as.memoizedState!==null?jk(ns):cs!==null?(cs.return=as,V$1=cs):jk(ns);for(;os!==null;)V$1=os,ik(os),os=os.sibling;V$1=ns,Jj=ls,U$1=us}kk(es)}else ns.subtreeFlags&8772&&os!==null?(os.return=ns,V$1=os):kk(es)}}function kk(es){for(;V$1!==null;){var ts=V$1;if(ts.flags&8772){var ss=ts.alternate;try{if(ts.flags&8772)switch(ts.tag){case 0:case 11:case 15:U$1||Qj(5,ts);break;case 1:var rs=ts.stateNode;if(ts.flags&4&&!U$1)if(ss===null)rs.componentDidMount();else{var ns=ts.elementType===ts.type?ss.memoizedProps:Ci(ts.type,ss.memoizedProps);rs.componentDidUpdate(ns,ss.memoizedState,rs.__reactInternalSnapshotBeforeUpdate)}var os=ts.updateQueue;os!==null&&sh(ts,os,rs);break;case 3:var as=ts.updateQueue;if(as!==null){if(ss=null,ts.child!==null)switch(ts.child.tag){case 5:ss=ts.child.stateNode;break;case 1:ss=ts.child.stateNode}sh(ts,as,ss)}break;case 5:var ls=ts.stateNode;if(ss===null&&ts.flags&4){ss=ls;var cs=ts.memoizedProps;switch(ts.type){case"button":case"input":case"select":case"textarea":cs.autoFocus&&ss.focus();break;case"img":cs.src&&(ss.src=cs.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(ts.memoizedState===null){var us=ts.alternate;if(us!==null){var ds=us.memoizedState;if(ds!==null){var ms=ds.dehydrated;ms!==null&&bd(ms)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U$1||ts.flags&512&&Rj(ts)}catch(ps){W$1(ts,ts.return,ps)}}if(ts===es){V$1=null;break}if(ss=ts.sibling,ss!==null){ss.return=ts.return,V$1=ss;break}V$1=ts.return}}function gk(es){for(;V$1!==null;){var ts=V$1;if(ts===es){V$1=null;break}var ss=ts.sibling;if(ss!==null){ss.return=ts.return,V$1=ss;break}V$1=ts.return}}function jk(es){for(;V$1!==null;){var ts=V$1;try{switch(ts.tag){case 0:case 11:case 15:var ss=ts.return;try{Qj(4,ts)}catch(cs){W$1(ts,ss,cs)}break;case 1:var rs=ts.stateNode;if(typeof rs.componentDidMount=="function"){var ns=ts.return;try{rs.componentDidMount()}catch(cs){W$1(ts,ns,cs)}}var os=ts.return;try{Rj(ts)}catch(cs){W$1(ts,os,cs)}break;case 5:var as=ts.return;try{Rj(ts)}catch(cs){W$1(ts,as,cs)}}}catch(cs){W$1(ts,ts.return,cs)}if(ts===es){V$1=null;break}var ls=ts.sibling;if(ls!==null){ls.return=ts.return,V$1=ls;break}V$1=ts.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K$1=0,Q$1=null,Y$1=null,Z$1=0,fj=0,ej=Uf(0),T$1=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R$1(){return K$1&6?B$1():Ak!==-1?Ak:Ak=B$1()}function yi(es){return es.mode&1?K$1&2&&Z$1!==0?Z$1&-Z$1:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(es=C$1,es!==0||(es=window.event,es=es===void 0?16:jd(es.type)),es):1}function gi(es,ts,ss,rs){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(es,ss,rs),(!(K$1&2)||es!==Q$1)&&(es===Q$1&&(!(K$1&2)&&(qk|=ss),T$1===4&&Ck(es,Z$1)),Dk(es,rs),ss===1&&K$1===0&&!(ts.mode&1)&&(Gj=B$1()+500,fg&&jg()))}function Dk(es,ts){var ss=es.callbackNode;wc(es,ts);var rs=uc(es,es===Q$1?Z$1:0);if(rs===0)ss!==null&&bc(ss),es.callbackNode=null,es.callbackPriority=0;else if(ts=rs&-rs,es.callbackPriority!==ts){if(ss!=null&&bc(ss),ts===1)es.tag===0?ig(Ek.bind(null,es)):hg(Ek.bind(null,es)),Jf(function(){!(K$1&6)&&jg()}),ss=null;else{switch(Dc(rs)){case 1:ss=fc;break;case 4:ss=gc;break;case 16:ss=hc;break;case 536870912:ss=jc;break;default:ss=hc}ss=Fk(ss,Gk.bind(null,es))}es.callbackPriority=ts,es.callbackNode=ss}}function Gk(es,ts){if(Ak=-1,Bk=0,K$1&6)throw Error(p$1(327));var ss=es.callbackNode;if(Hk()&&es.callbackNode!==ss)return null;var rs=uc(es,es===Q$1?Z$1:0);if(rs===0)return null;if(rs&30||rs&es.expiredLanes||ts)ts=Ik(es,rs);else{ts=rs;var ns=K$1;K$1|=2;var os=Jk();(Q$1!==es||Z$1!==ts)&&(uk=null,Gj=B$1()+500,Kk(es,ts));do try{Lk();break}catch(ls){Mk(es,ls)}while(!0);$g(),mk.current=os,K$1=ns,Y$1!==null?ts=0:(Q$1=null,Z$1=0,ts=T$1)}if(ts!==0){if(ts===2&&(ns=xc(es),ns!==0&&(rs=ns,ts=Nk(es,ns))),ts===1)throw ss=pk,Kk(es,0),Ck(es,rs),Dk(es,B$1()),ss;if(ts===6)Ck(es,rs);else{if(ns=es.current.alternate,!(rs&30)&&!Ok(ns)&&(ts=Ik(es,rs),ts===2&&(os=xc(es),os!==0&&(rs=os,ts=Nk(es,os))),ts===1))throw ss=pk,Kk(es,0),Ck(es,rs),Dk(es,B$1()),ss;switch(es.finishedWork=ns,es.finishedLanes=rs,ts){case 0:case 1:throw Error(p$1(345));case 2:Pk(es,tk,uk);break;case 3:if(Ck(es,rs),(rs&130023424)===rs&&(ts=fk+500-B$1(),10<ts)){if(uc(es,0)!==0)break;if(ns=es.suspendedLanes,(ns&rs)!==rs){R$1(),es.pingedLanes|=es.suspendedLanes&ns;break}es.timeoutHandle=Ff(Pk.bind(null,es,tk,uk),ts);break}Pk(es,tk,uk);break;case 4:if(Ck(es,rs),(rs&4194240)===rs)break;for(ts=es.eventTimes,ns=-1;0<rs;){var as=31-oc(rs);os=1<<as,as=ts[as],as>ns&&(ns=as),rs&=~os}if(rs=ns,rs=B$1()-rs,rs=(120>rs?120:480>rs?480:1080>rs?1080:1920>rs?1920:3e3>rs?3e3:4320>rs?4320:1960*lk(rs/1960))-rs,10<rs){es.timeoutHandle=Ff(Pk.bind(null,es,tk,uk),rs);break}Pk(es,tk,uk);break;case 5:Pk(es,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(es,B$1()),es.callbackNode===ss?Gk.bind(null,es):null}function Nk(es,ts){var ss=sk;return es.current.memoizedState.isDehydrated&&(Kk(es,ts).flags|=256),es=Ik(es,ts),es!==2&&(ts=tk,tk=ss,ts!==null&&Fj(ts)),es}function Fj(es){tk===null?tk=es:tk.push.apply(tk,es)}function Ok(es){for(var ts=es;;){if(ts.flags&16384){var ss=ts.updateQueue;if(ss!==null&&(ss=ss.stores,ss!==null))for(var rs=0;rs<ss.length;rs++){var ns=ss[rs],os=ns.getSnapshot;ns=ns.value;try{if(!He$1(os(),ns))return!1}catch{return!1}}}if(ss=ts.child,ts.subtreeFlags&16384&&ss!==null)ss.return=ts,ts=ss;else{if(ts===es)break;for(;ts.sibling===null;){if(ts.return===null||ts.return===es)return!0;ts=ts.return}ts.sibling.return=ts.return,ts=ts.sibling}}return!0}function Ck(es,ts){for(ts&=~rk,ts&=~qk,es.suspendedLanes|=ts,es.pingedLanes&=~ts,es=es.expirationTimes;0<ts;){var ss=31-oc(ts),rs=1<<ss;es[ss]=-1,ts&=~rs}}function Ek(es){if(K$1&6)throw Error(p$1(327));Hk();var ts=uc(es,0);if(!(ts&1))return Dk(es,B$1()),null;var ss=Ik(es,ts);if(es.tag!==0&&ss===2){var rs=xc(es);rs!==0&&(ts=rs,ss=Nk(es,rs))}if(ss===1)throw ss=pk,Kk(es,0),Ck(es,ts),Dk(es,B$1()),ss;if(ss===6)throw Error(p$1(345));return es.finishedWork=es.current.alternate,es.finishedLanes=ts,Pk(es,tk,uk),Dk(es,B$1()),null}function Qk(es,ts){var ss=K$1;K$1|=1;try{return es(ts)}finally{K$1=ss,K$1===0&&(Gj=B$1()+500,fg&&jg())}}function Rk(es){wk!==null&&wk.tag===0&&!(K$1&6)&&Hk();var ts=K$1;K$1|=1;var ss=ok.transition,rs=C$1;try{if(ok.transition=null,C$1=1,es)return es()}finally{C$1=rs,ok.transition=ss,K$1=ts,!(K$1&6)&&jg()}}function Hj(){fj=ej.current,E$1(ej)}function Kk(es,ts){es.finishedWork=null,es.finishedLanes=0;var ss=es.timeoutHandle;if(ss!==-1&&(es.timeoutHandle=-1,Gf(ss)),Y$1!==null)for(ss=Y$1.return;ss!==null;){var rs=ss;switch(wg(rs),rs.tag){case 1:rs=rs.type.childContextTypes,rs!=null&&$f();break;case 3:zh(),E$1(Wf),E$1(H$1),Eh();break;case 5:Bh(rs);break;case 4:zh();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah(rs.type._context);break;case 22:case 23:Hj()}ss=ss.return}if(Q$1=es,Y$1=es=Pg(es.current,null),Z$1=fj=ts,T$1=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(ts=0;ts<fh.length;ts++)if(ss=fh[ts],rs=ss.interleaved,rs!==null){ss.interleaved=null;var ns=rs.next,os=ss.pending;if(os!==null){var as=os.next;os.next=ns,rs.next=as}ss.pending=rs}fh=null}return es}function Mk(es,ts){do{var ss=Y$1;try{if($g(),Fh.current=Rh,Ih){for(var rs=M$1.memoizedState;rs!==null;){var ns=rs.queue;ns!==null&&(ns.pending=null),rs=rs.next}Ih=!1}if(Hh=0,O$1=N$1=M$1=null,Jh=!1,Kh=0,nk.current=null,ss===null||ss.return===null){T$1=1,pk=ts,Y$1=null;break}e:{var os=es,as=ss.return,ls=ss,cs=ts;if(ts=Z$1,ls.flags|=32768,cs!==null&&typeof cs=="object"&&typeof cs.then=="function"){var us=cs,ds=ls,ms=ds.tag;if(!(ds.mode&1)&&(ms===0||ms===11||ms===15)){var ps=ds.alternate;ps?(ds.updateQueue=ps.updateQueue,ds.memoizedState=ps.memoizedState,ds.lanes=ps.lanes):(ds.updateQueue=null,ds.memoizedState=null)}var hs=Ui(as);if(hs!==null){hs.flags&=-257,Vi(hs,as,ls,os,ts),hs.mode&1&&Si(os,us,ts),ts=hs,cs=us;var xs=ts.updateQueue;if(xs===null){var ys=new Set;ys.add(cs),ts.updateQueue=ys}else xs.add(cs);break e}else{if(!(ts&1)){Si(os,us,ts),tj();break e}cs=Error(p$1(426))}}else if(I$1&&ls.mode&1){var vs=Ui(as);if(vs!==null){!(vs.flags&65536)&&(vs.flags|=256),Vi(vs,as,ls,os,ts),Jg(Ji(cs,ls));break e}}os=cs=Ji(cs,ls),T$1!==4&&(T$1=2),sk===null?sk=[os]:sk.push(os),os=as;do{switch(os.tag){case 3:os.flags|=65536,ts&=-ts,os.lanes|=ts;var gs=Ni(os,cs,ts);ph(os,gs);break e;case 1:ls=cs;var fs=os.type,js=os.stateNode;if(!(os.flags&128)&&(typeof fs.getDerivedStateFromError=="function"||js!==null&&typeof js.componentDidCatch=="function"&&(Ri===null||!Ri.has(js)))){os.flags|=65536,ts&=-ts,os.lanes|=ts;var Ss=Qi(os,ls,ts);ph(os,Ss);break e}}os=os.return}while(os!==null)}Sk(ss)}catch(bs){ts=bs,Y$1===ss&&ss!==null&&(Y$1=ss=ss.return);continue}break}while(!0)}function Jk(){var es=mk.current;return mk.current=Rh,es===null?Rh:es}function tj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),Q$1===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q$1,Z$1)}function Ik(es,ts){var ss=K$1;K$1|=2;var rs=Jk();(Q$1!==es||Z$1!==ts)&&(uk=null,Kk(es,ts));do try{Tk();break}catch(ns){Mk(es,ns)}while(!0);if($g(),K$1=ss,mk.current=rs,Y$1!==null)throw Error(p$1(261));return Q$1=null,Z$1=0,T$1}function Tk(){for(;Y$1!==null;)Uk(Y$1)}function Lk(){for(;Y$1!==null&&!cc();)Uk(Y$1)}function Uk(es){var ts=Vk(es.alternate,es,fj);es.memoizedProps=es.pendingProps,ts===null?Sk(es):Y$1=ts,nk.current=null}function Sk(es){var ts=es;do{var ss=ts.alternate;if(es=ts.return,ts.flags&32768){if(ss=Ij(ss,ts),ss!==null){ss.flags&=32767,Y$1=ss;return}if(es!==null)es.flags|=32768,es.subtreeFlags=0,es.deletions=null;else{T$1=6,Y$1=null;return}}else if(ss=Ej(ss,ts,fj),ss!==null){Y$1=ss;return}if(ts=ts.sibling,ts!==null){Y$1=ts;return}Y$1=ts=es}while(ts!==null);T$1===0&&(T$1=5)}function Pk(es,ts,ss){var rs=C$1,ns=ok.transition;try{ok.transition=null,C$1=1,Wk(es,ts,ss,rs)}finally{ok.transition=ns,C$1=rs}return null}function Wk(es,ts,ss,rs){do Hk();while(wk!==null);if(K$1&6)throw Error(p$1(327));ss=es.finishedWork;var ns=es.finishedLanes;if(ss===null)return null;if(es.finishedWork=null,es.finishedLanes=0,ss===es.current)throw Error(p$1(177));es.callbackNode=null,es.callbackPriority=0;var os=ss.lanes|ss.childLanes;if(Bc(es,os),es===Q$1&&(Y$1=Q$1=null,Z$1=0),!(ss.subtreeFlags&2064)&&!(ss.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),os=(ss.flags&15990)!==0,ss.subtreeFlags&15990||os){os=ok.transition,ok.transition=null;var as=C$1;C$1=1;var ls=K$1;K$1|=4,nk.current=null,Oj(es,ss),dk(ss,es),Oe$1(Df),dd=!!Cf,Df=Cf=null,es.current=ss,hk(ss),dc(),K$1=ls,C$1=as,ok.transition=os}else es.current=ss;if(vk&&(vk=!1,wk=es,xk=ns),os=es.pendingLanes,os===0&&(Ri=null),mc(ss.stateNode),Dk(es,B$1()),ts!==null)for(rs=es.onRecoverableError,ss=0;ss<ts.length;ss++)ns=ts[ss],rs(ns.value,{componentStack:ns.stack,digest:ns.digest});if(Oi)throw Oi=!1,es=Pi,Pi=null,es;return xk&1&&es.tag!==0&&Hk(),os=es.pendingLanes,os&1?es===zk?yk++:(yk=0,zk=es):yk=0,jg(),null}function Hk(){if(wk!==null){var es=Dc(xk),ts=ok.transition,ss=C$1;try{if(ok.transition=null,C$1=16>es?16:es,wk===null)var rs=!1;else{if(es=wk,wk=null,xk=0,K$1&6)throw Error(p$1(331));var ns=K$1;for(K$1|=4,V$1=es.current;V$1!==null;){var os=V$1,as=os.child;if(V$1.flags&16){var ls=os.deletions;if(ls!==null){for(var cs=0;cs<ls.length;cs++){var us=ls[cs];for(V$1=us;V$1!==null;){var ds=V$1;switch(ds.tag){case 0:case 11:case 15:Pj(8,ds,os)}var ms=ds.child;if(ms!==null)ms.return=ds,V$1=ms;else for(;V$1!==null;){ds=V$1;var ps=ds.sibling,hs=ds.return;if(Sj(ds),ds===us){V$1=null;break}if(ps!==null){ps.return=hs,V$1=ps;break}V$1=hs}}}var xs=os.alternate;if(xs!==null){var ys=xs.child;if(ys!==null){xs.child=null;do{var vs=ys.sibling;ys.sibling=null,ys=vs}while(ys!==null)}}V$1=os}}if(os.subtreeFlags&2064&&as!==null)as.return=os,V$1=as;else e:for(;V$1!==null;){if(os=V$1,os.flags&2048)switch(os.tag){case 0:case 11:case 15:Pj(9,os,os.return)}var gs=os.sibling;if(gs!==null){gs.return=os.return,V$1=gs;break e}V$1=os.return}}var fs=es.current;for(V$1=fs;V$1!==null;){as=V$1;var js=as.child;if(as.subtreeFlags&2064&&js!==null)js.return=as,V$1=js;else e:for(as=fs;V$1!==null;){if(ls=V$1,ls.flags&2048)try{switch(ls.tag){case 0:case 11:case 15:Qj(9,ls)}}catch(bs){W$1(ls,ls.return,bs)}if(ls===as){V$1=null;break e}var Ss=ls.sibling;if(Ss!==null){Ss.return=ls.return,V$1=Ss;break e}V$1=ls.return}}if(K$1=ns,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,es)}catch{}rs=!0}return rs}finally{C$1=ss,ok.transition=ts}}return!1}function Xk(es,ts,ss){ts=Ji(ss,ts),ts=Ni(es,ts,1),es=nh(es,ts,1),ts=R$1(),es!==null&&(Ac(es,1,ts),Dk(es,ts))}function W$1(es,ts,ss){if(es.tag===3)Xk(es,es,ss);else for(;ts!==null;){if(ts.tag===3){Xk(ts,es,ss);break}else if(ts.tag===1){var rs=ts.stateNode;if(typeof ts.type.getDerivedStateFromError=="function"||typeof rs.componentDidCatch=="function"&&(Ri===null||!Ri.has(rs))){es=Ji(ss,es),es=Qi(ts,es,1),ts=nh(ts,es,1),es=R$1(),ts!==null&&(Ac(ts,1,es),Dk(ts,es));break}}ts=ts.return}}function Ti(es,ts,ss){var rs=es.pingCache;rs!==null&&rs.delete(ts),ts=R$1(),es.pingedLanes|=es.suspendedLanes&ss,Q$1===es&&(Z$1&ss)===ss&&(T$1===4||T$1===3&&(Z$1&130023424)===Z$1&&500>B$1()-fk?Kk(es,0):rk|=ss),Dk(es,ts)}function Yk(es,ts){ts===0&&(es.mode&1?(ts=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):ts=1);var ss=R$1();es=ih(es,ts),es!==null&&(Ac(es,ts,ss),Dk(es,ss))}function uj(es){var ts=es.memoizedState,ss=0;ts!==null&&(ss=ts.retryLane),Yk(es,ss)}function bk(es,ts){var ss=0;switch(es.tag){case 13:var rs=es.stateNode,ns=es.memoizedState;ns!==null&&(ss=ns.retryLane);break;case 19:rs=es.stateNode;break;default:throw Error(p$1(314))}rs!==null&&rs.delete(ts),Yk(es,ss)}var Vk;Vk=function(es,ts,ss){if(es!==null)if(es.memoizedProps!==ts.pendingProps||Wf.current)dh=!0;else{if(!(es.lanes&ss)&&!(ts.flags&128))return dh=!1,yj(es,ts,ss);dh=!!(es.flags&131072)}else dh=!1,I$1&&ts.flags&1048576&&ug(ts,ng,ts.index);switch(ts.lanes=0,ts.tag){case 2:var rs=ts.type;ij(es,ts),es=ts.pendingProps;var ns=Yf(ts,H$1.current);ch(ts,ss),ns=Nh(null,ts,rs,es,ns,ss);var os=Sh();return ts.flags|=1,typeof ns=="object"&&ns!==null&&typeof ns.render=="function"&&ns.$$typeof===void 0?(ts.tag=1,ts.memoizedState=null,ts.updateQueue=null,Zf(rs)?(os=!0,cg(ts)):os=!1,ts.memoizedState=ns.state!==null&&ns.state!==void 0?ns.state:null,kh(ts),ns.updater=Ei,ts.stateNode=ns,ns._reactInternals=ts,Ii(ts,rs,es,ss),ts=jj(null,ts,rs,!0,os,ss)):(ts.tag=0,I$1&&os&&vg(ts),Xi(null,ts,ns,ss),ts=ts.child),ts;case 16:rs=ts.elementType;e:{switch(ij(es,ts),es=ts.pendingProps,ns=rs._init,rs=ns(rs._payload),ts.type=rs,ns=ts.tag=Zk(rs),es=Ci(rs,es),ns){case 0:ts=cj(null,ts,rs,es,ss);break e;case 1:ts=hj(null,ts,rs,es,ss);break e;case 11:ts=Yi(null,ts,rs,es,ss);break e;case 14:ts=$i(null,ts,rs,Ci(rs.type,es),ss);break e}throw Error(p$1(306,rs,""))}return ts;case 0:return rs=ts.type,ns=ts.pendingProps,ns=ts.elementType===rs?ns:Ci(rs,ns),cj(es,ts,rs,ns,ss);case 1:return rs=ts.type,ns=ts.pendingProps,ns=ts.elementType===rs?ns:Ci(rs,ns),hj(es,ts,rs,ns,ss);case 3:e:{if(kj(ts),es===null)throw Error(p$1(387));rs=ts.pendingProps,os=ts.memoizedState,ns=os.element,lh(es,ts),qh(ts,rs,null,ss);var as=ts.memoizedState;if(rs=as.element,os.isDehydrated)if(os={element:rs,isDehydrated:!1,cache:as.cache,pendingSuspenseBoundaries:as.pendingSuspenseBoundaries,transitions:as.transitions},ts.updateQueue.baseState=os,ts.memoizedState=os,ts.flags&256){ns=Ji(Error(p$1(423)),ts),ts=lj(es,ts,rs,ss,ns);break e}else if(rs!==ns){ns=Ji(Error(p$1(424)),ts),ts=lj(es,ts,rs,ss,ns);break e}else for(yg=Lf(ts.stateNode.containerInfo.firstChild),xg=ts,I$1=!0,zg=null,ss=Vg(ts,null,rs,ss),ts.child=ss;ss;)ss.flags=ss.flags&-3|4096,ss=ss.sibling;else{if(Ig(),rs===ns){ts=Zi(es,ts,ss);break e}Xi(es,ts,rs,ss)}ts=ts.child}return ts;case 5:return Ah(ts),es===null&&Eg(ts),rs=ts.type,ns=ts.pendingProps,os=es!==null?es.memoizedProps:null,as=ns.children,Ef(rs,ns)?as=null:os!==null&&Ef(rs,os)&&(ts.flags|=32),gj(es,ts),Xi(es,ts,as,ss),ts.child;case 6:return es===null&&Eg(ts),null;case 13:return oj(es,ts,ss);case 4:return yh(ts,ts.stateNode.containerInfo),rs=ts.pendingProps,es===null?ts.child=Ug(ts,null,rs,ss):Xi(es,ts,rs,ss),ts.child;case 11:return rs=ts.type,ns=ts.pendingProps,ns=ts.elementType===rs?ns:Ci(rs,ns),Yi(es,ts,rs,ns,ss);case 7:return Xi(es,ts,ts.pendingProps,ss),ts.child;case 8:return Xi(es,ts,ts.pendingProps.children,ss),ts.child;case 12:return Xi(es,ts,ts.pendingProps.children,ss),ts.child;case 10:e:{if(rs=ts.type._context,ns=ts.pendingProps,os=ts.memoizedProps,as=ns.value,G$1(Wg,rs._currentValue),rs._currentValue=as,os!==null)if(He$1(os.value,as)){if(os.children===ns.children&&!Wf.current){ts=Zi(es,ts,ss);break e}}else for(os=ts.child,os!==null&&(os.return=ts);os!==null;){var ls=os.dependencies;if(ls!==null){as=os.child;for(var cs=ls.firstContext;cs!==null;){if(cs.context===rs){if(os.tag===1){cs=mh(-1,ss&-ss),cs.tag=2;var us=os.updateQueue;if(us!==null){us=us.shared;var ds=us.pending;ds===null?cs.next=cs:(cs.next=ds.next,ds.next=cs),us.pending=cs}}os.lanes|=ss,cs=os.alternate,cs!==null&&(cs.lanes|=ss),bh(os.return,ss,ts),ls.lanes|=ss;break}cs=cs.next}}else if(os.tag===10)as=os.type===ts.type?null:os.child;else if(os.tag===18){if(as=os.return,as===null)throw Error(p$1(341));as.lanes|=ss,ls=as.alternate,ls!==null&&(ls.lanes|=ss),bh(as,ss,ts),as=os.sibling}else as=os.child;if(as!==null)as.return=os;else for(as=os;as!==null;){if(as===ts){as=null;break}if(os=as.sibling,os!==null){os.return=as.return,as=os;break}as=as.return}os=as}Xi(es,ts,ns.children,ss),ts=ts.child}return ts;case 9:return ns=ts.type,rs=ts.pendingProps.children,ch(ts,ss),ns=eh(ns),rs=rs(ns),ts.flags|=1,Xi(es,ts,rs,ss),ts.child;case 14:return rs=ts.type,ns=Ci(rs,ts.pendingProps),ns=Ci(rs.type,ns),$i(es,ts,rs,ns,ss);case 15:return bj(es,ts,ts.type,ts.pendingProps,ss);case 17:return rs=ts.type,ns=ts.pendingProps,ns=ts.elementType===rs?ns:Ci(rs,ns),ij(es,ts),ts.tag=1,Zf(rs)?(es=!0,cg(ts)):es=!1,ch(ts,ss),Gi(ts,rs,ns),Ii(ts,rs,ns,ss),jj(null,ts,rs,!0,es,ss);case 19:return xj(es,ts,ss);case 22:return dj(es,ts,ss)}throw Error(p$1(156,ts.tag))};function Fk(es,ts){return ac(es,ts)}function $k(es,ts,ss,rs){this.tag=es,this.key=ss,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=ts,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=rs,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(es,ts,ss,rs){return new $k(es,ts,ss,rs)}function aj(es){return es=es.prototype,!(!es||!es.isReactComponent)}function Zk(es){if(typeof es=="function")return aj(es)?1:0;if(es!=null){if(es=es.$$typeof,es===Da)return 11;if(es===Ga)return 14}return 2}function Pg(es,ts){var ss=es.alternate;return ss===null?(ss=Bg(es.tag,ts,es.key,es.mode),ss.elementType=es.elementType,ss.type=es.type,ss.stateNode=es.stateNode,ss.alternate=es,es.alternate=ss):(ss.pendingProps=ts,ss.type=es.type,ss.flags=0,ss.subtreeFlags=0,ss.deletions=null),ss.flags=es.flags&14680064,ss.childLanes=es.childLanes,ss.lanes=es.lanes,ss.child=es.child,ss.memoizedProps=es.memoizedProps,ss.memoizedState=es.memoizedState,ss.updateQueue=es.updateQueue,ts=es.dependencies,ss.dependencies=ts===null?null:{lanes:ts.lanes,firstContext:ts.firstContext},ss.sibling=es.sibling,ss.index=es.index,ss.ref=es.ref,ss}function Rg(es,ts,ss,rs,ns,os){var as=2;if(rs=es,typeof es=="function")aj(es)&&(as=1);else if(typeof es=="string")as=5;else e:switch(es){case ya:return Tg(ss.children,ns,os,ts);case za:as=8,ns|=8;break;case Aa:return es=Bg(12,ss,ts,ns|2),es.elementType=Aa,es.lanes=os,es;case Ea:return es=Bg(13,ss,ts,ns),es.elementType=Ea,es.lanes=os,es;case Fa:return es=Bg(19,ss,ts,ns),es.elementType=Fa,es.lanes=os,es;case Ia:return pj(ss,ns,os,ts);default:if(typeof es=="object"&&es!==null)switch(es.$$typeof){case Ba:as=10;break e;case Ca:as=9;break e;case Da:as=11;break e;case Ga:as=14;break e;case Ha:as=16,rs=null;break e}throw Error(p$1(130,es==null?es:typeof es,""))}return ts=Bg(as,ss,ts,ns),ts.elementType=es,ts.type=rs,ts.lanes=os,ts}function Tg(es,ts,ss,rs){return es=Bg(7,es,rs,ts),es.lanes=ss,es}function pj(es,ts,ss,rs){return es=Bg(22,es,rs,ts),es.elementType=Ia,es.lanes=ss,es.stateNode={isHidden:!1},es}function Qg(es,ts,ss){return es=Bg(6,es,null,ts),es.lanes=ss,es}function Sg(es,ts,ss){return ts=Bg(4,es.children!==null?es.children:[],es.key,ts),ts.lanes=ss,ts.stateNode={containerInfo:es.containerInfo,pendingChildren:null,implementation:es.implementation},ts}function al(es,ts,ss,rs,ns){this.tag=ts,this.containerInfo=es,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=rs,this.onRecoverableError=ns,this.mutableSourceEagerHydrationData=null}function bl(es,ts,ss,rs,ns,os,as,ls,cs){return es=new al(es,ts,ss,ls,cs),ts===1?(ts=1,os===!0&&(ts|=8)):ts=0,os=Bg(3,null,null,ts),es.current=os,os.stateNode=es,os.memoizedState={element:rs,isDehydrated:ss,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(os),es}function cl(es,ts,ss){var rs=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:rs==null?null:""+rs,children:es,containerInfo:ts,implementation:ss}}function dl(es){if(!es)return Vf;es=es._reactInternals;e:{if(Vb(es)!==es||es.tag!==1)throw Error(p$1(170));var ts=es;do{switch(ts.tag){case 3:ts=ts.stateNode.context;break e;case 1:if(Zf(ts.type)){ts=ts.stateNode.__reactInternalMemoizedMergedChildContext;break e}}ts=ts.return}while(ts!==null);throw Error(p$1(171))}if(es.tag===1){var ss=es.type;if(Zf(ss))return bg(es,ss,ts)}return ts}function el(es,ts,ss,rs,ns,os,as,ls,cs){return es=bl(ss,rs,!0,es,ns,os,as,ls,cs),es.context=dl(null),ss=es.current,rs=R$1(),ns=yi(ss),os=mh(rs,ns),os.callback=ts??null,nh(ss,os,ns),es.current.lanes=ns,Ac(es,ns,rs),Dk(es,rs),es}function fl(es,ts,ss,rs){var ns=ts.current,os=R$1(),as=yi(ns);return ss=dl(ss),ts.context===null?ts.context=ss:ts.pendingContext=ss,ts=mh(os,as),ts.payload={element:es},rs=rs===void 0?null:rs,rs!==null&&(ts.callback=rs),es=nh(ns,ts,as),es!==null&&(gi(es,ns,as,os),oh(es,ns,as)),as}function gl(es){if(es=es.current,!es.child)return null;switch(es.child.tag){case 5:return es.child.stateNode;default:return es.child.stateNode}}function hl(es,ts){if(es=es.memoizedState,es!==null&&es.dehydrated!==null){var ss=es.retryLane;es.retryLane=ss!==0&&ss<ts?ss:ts}}function il(es,ts){hl(es,ts),(es=es.alternate)&&hl(es,ts)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(es){console.error(es)};function ll(es){this._internalRoot=es}ml.prototype.render=ll.prototype.render=function(es){var ts=this._internalRoot;if(ts===null)throw Error(p$1(409));fl(es,ts,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var es=this._internalRoot;if(es!==null){this._internalRoot=null;var ts=es.containerInfo;Rk(function(){fl(null,es,null,null)}),ts[uf]=null}};function ml(es){this._internalRoot=es}ml.prototype.unstable_scheduleHydration=function(es){if(es){var ts=Hc();es={blockedOn:null,target:es,priority:ts};for(var ss=0;ss<Qc.length&&ts!==0&&ts<Qc[ss].priority;ss++);Qc.splice(ss,0,es),ss===0&&Vc(es)}};function nl(es){return!(!es||es.nodeType!==1&&es.nodeType!==9&&es.nodeType!==11)}function ol(es){return!(!es||es.nodeType!==1&&es.nodeType!==9&&es.nodeType!==11&&(es.nodeType!==8||es.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(es,ts,ss,rs,ns){if(ns){if(typeof rs=="function"){var os=rs;rs=function(){var us=gl(as);os.call(us)}}var as=el(ts,rs,es,0,null,!1,!1,"",pl);return es._reactRootContainer=as,es[uf]=as.current,sf(es.nodeType===8?es.parentNode:es),Rk(),as}for(;ns=es.lastChild;)es.removeChild(ns);if(typeof rs=="function"){var ls=rs;rs=function(){var us=gl(cs);ls.call(us)}}var cs=bl(es,0,!1,null,null,!1,!1,"",pl);return es._reactRootContainer=cs,es[uf]=cs.current,sf(es.nodeType===8?es.parentNode:es),Rk(function(){fl(ts,cs,ss,rs)}),cs}function rl(es,ts,ss,rs,ns){var os=ss._reactRootContainer;if(os){var as=os;if(typeof ns=="function"){var ls=ns;ns=function(){var cs=gl(as);ls.call(cs)}}fl(ts,as,es,ns)}else as=ql(ss,ts,es,ns,rs);return gl(as)}Ec=function(es){switch(es.tag){case 3:var ts=es.stateNode;if(ts.current.memoizedState.isDehydrated){var ss=tc(ts.pendingLanes);ss!==0&&(Cc(ts,ss|1),Dk(ts,B$1()),!(K$1&6)&&(Gj=B$1()+500,jg()))}break;case 13:Rk(function(){var rs=ih(es,1);if(rs!==null){var ns=R$1();gi(rs,es,1,ns)}}),il(es,1)}};Fc=function(es){if(es.tag===13){var ts=ih(es,134217728);if(ts!==null){var ss=R$1();gi(ts,es,134217728,ss)}il(es,134217728)}};Gc=function(es){if(es.tag===13){var ts=yi(es),ss=ih(es,ts);if(ss!==null){var rs=R$1();gi(ss,es,ts,rs)}il(es,ts)}};Hc=function(){return C$1};Ic=function(es,ts){var ss=C$1;try{return C$1=es,ts()}finally{C$1=ss}};yb=function(es,ts,ss){switch(ts){case"input":if(bb(es,ss),ts=ss.name,ss.type==="radio"&&ts!=null){for(ss=es;ss.parentNode;)ss=ss.parentNode;for(ss=ss.querySelectorAll("input[name="+JSON.stringify(""+ts)+'][type="radio"]'),ts=0;ts<ss.length;ts++){var rs=ss[ts];if(rs!==es&&rs.form===es.form){var ns=Db(rs);if(!ns)throw Error(p$1(90));Wa(rs),bb(rs,ns)}}}break;case"textarea":ib(es,ss);break;case"select":ts=ss.value,ts!=null&&fb(es,!!ss.multiple,ts,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(es){return es=Zb(es),es===null?null:es.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(es,ts){var ss=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(ts))throw Error(p$1(200));return cl(es,ts,null,ss)};reactDom_production_min.createRoot=function(es,ts){if(!nl(es))throw Error(p$1(299));var ss=!1,rs="",ns=kl;return ts!=null&&(ts.unstable_strictMode===!0&&(ss=!0),ts.identifierPrefix!==void 0&&(rs=ts.identifierPrefix),ts.onRecoverableError!==void 0&&(ns=ts.onRecoverableError)),ts=bl(es,1,!1,null,null,ss,!1,rs,ns),es[uf]=ts.current,sf(es.nodeType===8?es.parentNode:es),new ll(ts)};reactDom_production_min.findDOMNode=function(es){if(es==null)return null;if(es.nodeType===1)return es;var ts=es._reactInternals;if(ts===void 0)throw typeof es.render=="function"?Error(p$1(188)):(es=Object.keys(es).join(","),Error(p$1(268,es)));return es=Zb(ts),es=es===null?null:es.stateNode,es};reactDom_production_min.flushSync=function(es){return Rk(es)};reactDom_production_min.hydrate=function(es,ts,ss){if(!ol(ts))throw Error(p$1(200));return rl(null,es,ts,!0,ss)};reactDom_production_min.hydrateRoot=function(es,ts,ss){if(!nl(es))throw Error(p$1(405));var rs=ss!=null&&ss.hydratedSources||null,ns=!1,os="",as=kl;if(ss!=null&&(ss.unstable_strictMode===!0&&(ns=!0),ss.identifierPrefix!==void 0&&(os=ss.identifierPrefix),ss.onRecoverableError!==void 0&&(as=ss.onRecoverableError)),ts=el(ts,null,es,1,ss??null,ns,!1,os,as),es[uf]=ts.current,sf(es),rs)for(es=0;es<rs.length;es++)ss=rs[es],ns=ss._getVersion,ns=ns(ss._source),ts.mutableSourceEagerHydrationData==null?ts.mutableSourceEagerHydrationData=[ss,ns]:ts.mutableSourceEagerHydrationData.push(ss,ns);return new ml(ts)};reactDom_production_min.render=function(es,ts,ss){if(!ol(ts))throw Error(p$1(200));return rl(null,es,ts,!1,ss)};reactDom_production_min.unmountComponentAtNode=function(es){if(!ol(es))throw Error(p$1(40));return es._reactRootContainer?(Rk(function(){rl(null,null,es,!1,function(){es._reactRootContainer=null,es[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(es,ts,ss,rs){if(!ol(ss))throw Error(p$1(200));if(es==null||es._reactInternals===void 0)throw Error(p$1(38));return rl(es,ts,ss,!1,rs)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(es){console.error(es)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m$1=reactDomExports;client.createRoot=m$1.createRoot,client.hydrateRoot=m$1.hydrateRoot;const __vite_import_meta_env__$2={},createStoreImpl=es=>{let ts;const ss=new Set,rs=(ds,ms)=>{const ps=typeof ds=="function"?ds(ts):ds;if(!Object.is(ps,ts)){const hs=ts;ts=ms??(typeof ps!="object"||ps===null)?ps:Object.assign({},ts,ps),ss.forEach(xs=>xs(ts,hs))}},ns=()=>ts,cs={setState:rs,getState:ns,getInitialState:()=>us,subscribe:ds=>(ss.add(ds),()=>ss.delete(ds)),destroy:()=>{(__vite_import_meta_env__$2?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),ss.clear()}},us=ts=es(rs,ns,cs);return cs},createStore=es=>es?createStoreImpl(es):createStoreImpl;var withSelector={exports:{}},withSelector_production={},shim$2={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React$1=reactExports;function is$1(es,ts){return es===ts&&(es!==0||1/es===1/ts)||es!==es&&ts!==ts}var objectIs$1=typeof Object.is=="function"?Object.is:is$1,useState=React$1.useState,useEffect$1=React$1.useEffect,useLayoutEffect=React$1.useLayoutEffect,useDebugValue$2=React$1.useDebugValue;function useSyncExternalStore$2(es,ts){var ss=ts(),rs=useState({inst:{value:ss,getSnapshot:ts}}),ns=rs[0].inst,os=rs[1];return useLayoutEffect(function(){ns.value=ss,ns.getSnapshot=ts,checkIfSnapshotChanged(ns)&&os({inst:ns})},[es,ss,ts]),useEffect$1(function(){return checkIfSnapshotChanged(ns)&&os({inst:ns}),es(function(){checkIfSnapshotChanged(ns)&&os({inst:ns})})},[es]),useDebugValue$2(ss),ss}function checkIfSnapshotChanged(es){var ts=es.getSnapshot;es=es.value;try{var ss=ts();return!objectIs$1(es,ss)}catch{return!0}}function useSyncExternalStore$1(es,ts){return ts()}var shim$1=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?useSyncExternalStore$1:useSyncExternalStore$2;useSyncExternalStoreShim_production.useSyncExternalStore=React$1.useSyncExternalStore!==void 0?React$1.useSyncExternalStore:shim$1;shim$2.exports=useSyncExternalStoreShim_production;var shimExports=shim$2.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React=reactExports,shim=shimExports;function is(es,ts){return es===ts&&(es!==0||1/es===1/ts)||es!==es&&ts!==ts}var objectIs=typeof Object.is=="function"?Object.is:is,useSyncExternalStore=shim.useSyncExternalStore,useRef=React.useRef,useEffect=React.useEffect,useMemo=React.useMemo,useDebugValue$1=React.useDebugValue;withSelector_production.useSyncExternalStoreWithSelector=function(es,ts,ss,rs,ns){var os=useRef(null);if(os.current===null){var as={hasValue:!1,value:null};os.current=as}else as=os.current;os=useMemo(function(){function cs(hs){if(!us){if(us=!0,ds=hs,hs=rs(hs),ns!==void 0&&as.hasValue){var xs=as.value;if(ns(xs,hs))return ms=xs}return ms=hs}if(xs=ms,objectIs(ds,hs))return xs;var ys=rs(hs);return ns!==void 0&&ns(xs,ys)?(ds=hs,xs):(ds=hs,ms=ys)}var us=!1,ds,ms,ps=ss===void 0?null:ss;return[function(){return cs(ts())},ps===null?void 0:function(){return cs(ps())}]},[ts,ss,rs,ns]);var ls=useSyncExternalStore(es,os[0],os[1]);return useEffect(function(){as.hasValue=!0,as.value=ls},[ls]),useDebugValue$1(ls),ls};withSelector.exports=withSelector_production;var withSelectorExports=withSelector.exports;const useSyncExternalStoreExports=getDefaultExportFromCjs(withSelectorExports),__vite_import_meta_env__$1={},{useDebugValue}=React$2,{useSyncExternalStoreWithSelector}=useSyncExternalStoreExports;let didWarnAboutEqualityFn=!1;const identity=es=>es;function useStore(es,ts=identity,ss){(__vite_import_meta_env__$1?"production":void 0)!=="production"&&ss&&!didWarnAboutEqualityFn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),didWarnAboutEqualityFn=!0);const rs=useSyncExternalStoreWithSelector(es.subscribe,es.getState,es.getServerState||es.getInitialState,ts,ss);return useDebugValue(rs),rs}const createImpl=es=>{(__vite_import_meta_env__$1?"production":void 0)!=="production"&&typeof es!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const ts=typeof es=="function"?createStore(es):es,ss=(rs,ns)=>useStore(ts,rs,ns);return Object.assign(ss,ts),ss},create=es=>es?createImpl(es):createImpl,__vite_import_meta_env__={};function createJSONStorage(es,ts){let ss;try{ss=es()}catch{return}return{getItem:ns=>{var os;const as=cs=>cs===null?null:JSON.parse(cs,void 0),ls=(os=ss.getItem(ns))!=null?os:null;return ls instanceof Promise?ls.then(as):as(ls)},setItem:(ns,os)=>ss.setItem(ns,JSON.stringify(os,void 0)),removeItem:ns=>ss.removeItem(ns)}}const toThenable=es=>ts=>{try{const ss=es(ts);return ss instanceof Promise?ss:{then(rs){return toThenable(rs)(ss)},catch(rs){return this}}}catch(ss){return{then(rs){return this},catch(rs){return toThenable(rs)(ss)}}}},oldImpl=(es,ts)=>(ss,rs,ns)=>{let os={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:vs=>vs,version:0,merge:(vs,gs)=>({...gs,...vs}),...ts},as=!1;const ls=new Set,cs=new Set;let us;try{us=os.getStorage()}catch{}if(!us)return es((...vs)=>{console.warn(`[zustand persist middleware] Unable to update item '${os.name}', the given storage is currently unavailable.`),ss(...vs)},rs,ns);const ds=toThenable(os.serialize),ms=()=>{const vs=os.partialize({...rs()});let gs;const fs=ds({state:vs,version:os.version}).then(js=>us.setItem(os.name,js)).catch(js=>{gs=js});if(gs)throw gs;return fs},ps=ns.setState;ns.setState=(vs,gs)=>{ps(vs,gs),ms()};const hs=es((...vs)=>{ss(...vs),ms()},rs,ns);let xs;const ys=()=>{var vs;if(!us)return;as=!1,ls.forEach(fs=>fs(rs()));const gs=((vs=os.onRehydrateStorage)==null?void 0:vs.call(os,rs()))||void 0;return toThenable(us.getItem.bind(us))(os.name).then(fs=>{if(fs)return os.deserialize(fs)}).then(fs=>{if(fs)if(typeof fs.version=="number"&&fs.version!==os.version){if(os.migrate)return os.migrate(fs.state,fs.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return fs.state}).then(fs=>{var js;return xs=os.merge(fs,(js=rs())!=null?js:hs),ss(xs,!0),ms()}).then(()=>{gs==null||gs(xs,void 0),as=!0,cs.forEach(fs=>fs(xs))}).catch(fs=>{gs==null||gs(void 0,fs)})};return ns.persist={setOptions:vs=>{os={...os,...vs},vs.getStorage&&(us=vs.getStorage())},clearStorage:()=>{us==null||us.removeItem(os.name)},getOptions:()=>os,rehydrate:()=>ys(),hasHydrated:()=>as,onHydrate:vs=>(ls.add(vs),()=>{ls.delete(vs)}),onFinishHydration:vs=>(cs.add(vs),()=>{cs.delete(vs)})},ys(),xs||hs},newImpl=(es,ts)=>(ss,rs,ns)=>{let os={storage:createJSONStorage(()=>localStorage),partialize:ys=>ys,version:0,merge:(ys,vs)=>({...vs,...ys}),...ts},as=!1;const ls=new Set,cs=new Set;let us=os.storage;if(!us)return es((...ys)=>{console.warn(`[zustand persist middleware] Unable to update item '${os.name}', the given storage is currently unavailable.`),ss(...ys)},rs,ns);const ds=()=>{const ys=os.partialize({...rs()});return us.setItem(os.name,{state:ys,version:os.version})},ms=ns.setState;ns.setState=(ys,vs)=>{ms(ys,vs),ds()};const ps=es((...ys)=>{ss(...ys),ds()},rs,ns);ns.getInitialState=()=>ps;let hs;const xs=()=>{var ys,vs;if(!us)return;as=!1,ls.forEach(fs=>{var js;return fs((js=rs())!=null?js:ps)});const gs=((vs=os.onRehydrateStorage)==null?void 0:vs.call(os,(ys=rs())!=null?ys:ps))||void 0;return toThenable(us.getItem.bind(us))(os.name).then(fs=>{if(fs)if(typeof fs.version=="number"&&fs.version!==os.version){if(os.migrate)return[!0,os.migrate(fs.state,fs.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,fs.state];return[!1,void 0]}).then(fs=>{var js;const[Ss,bs]=fs;if(hs=os.merge(bs,(js=rs())!=null?js:ps),ss(hs,!0),Ss)return ds()}).then(()=>{gs==null||gs(hs,void 0),hs=rs(),as=!0,cs.forEach(fs=>fs(hs))}).catch(fs=>{gs==null||gs(void 0,fs)})};return ns.persist={setOptions:ys=>{os={...os,...ys},ys.storage&&(us=ys.storage)},clearStorage:()=>{us==null||us.removeItem(os.name)},getOptions:()=>os,rehydrate:()=>xs(),hasHydrated:()=>as,onHydrate:ys=>(ls.add(ys),()=>{ls.delete(ys)}),onFinishHydration:ys=>(cs.add(ys),()=>{cs.delete(ys)})},os.skipHydration||xs(),hs||ps},persistImpl=(es,ts)=>"getStorage"in ts||"serialize"in ts||"deserialize"in ts?((__vite_import_meta_env__?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),oldImpl(es,ts)):newImpl(es,ts),persist=persistImpl,e=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,t=Object.keys,n=Array.isArray;function r$1(es,ts){return typeof ts!="object"||t(ts).forEach(function(ss){es[ss]=ts[ss]}),es}typeof Promise>"u"||e.Promise||(e.Promise=Promise);const s=Object.getPrototypeOf,i={}.hasOwnProperty;function o(es,ts){return i.call(es,ts)}function a(es,ts){typeof ts=="function"&&(ts=ts(s(es))),(typeof Reflect>"u"?t:Reflect.ownKeys)(ts).forEach(ss=>{l(es,ss,ts[ss])})}const u=Object.defineProperty;function l(es,ts,ss,rs){u(es,ts,r$1(ss&&o(ss,"get")&&typeof ss.get=="function"?{get:ss.get,set:ss.set,configurable:!0}:{value:ss,configurable:!0,writable:!0},rs))}function c(es){return{from:function(ts){return es.prototype=Object.create(ts.prototype),l(es.prototype,"constructor",es),{extend:a.bind(null,es.prototype)}}}}const h=Object.getOwnPropertyDescriptor;function d(es,ts){let ss;return h(es,ts)||(ss=s(es))&&d(ss,ts)}const f=[].slice;function p(es,ts,ss){return f.call(es,ts,ss)}function y(es,ts){return ts(es)}function m(es){if(!es)throw new Error("Assertion Failed")}function v(es){e.setImmediate?setImmediate(es):setTimeout(es,0)}function g(es,ts){return es.reduce((ss,rs,ns)=>{var os=ts(rs,ns);return os&&(ss[os[0]]=os[1]),ss},{})}function b(es,ts){if(typeof ts=="string"&&o(es,ts))return es[ts];if(!ts)return es;if(typeof ts!="string"){for(var ss=[],rs=0,ns=ts.length;rs<ns;++rs){var os=b(es,ts[rs]);ss.push(os)}return ss}var as=ts.indexOf(".");if(as!==-1){var ls=es[ts.substr(0,as)];return ls==null?void 0:b(ls,ts.substr(as+1))}}function _(es,ts,ss){if(es&&ts!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(es)))if(typeof ts!="string"&&"length"in ts){m(typeof ss!="string"&&"length"in ss);for(var rs=0,ns=ts.length;rs<ns;++rs)_(es,ts[rs],ss[rs])}else{var os=ts.indexOf(".");if(os!==-1){var as=ts.substr(0,os),ls=ts.substr(os+1);if(ls==="")ss===void 0?n(es)&&!isNaN(parseInt(as))?es.splice(as,1):delete es[as]:es[as]=ss;else{var cs=es[as];cs&&o(es,as)||(cs=es[as]={}),_(cs,ls,ss)}}else ss===void 0?n(es)&&!isNaN(parseInt(ts))?es.splice(ts,1):delete es[ts]:es[ts]=ss}}function w(es){var ts={};for(var ss in es)o(es,ss)&&(ts[ss]=es[ss]);return ts}const x=[].concat;function k(es){return x.apply([],es)}const E="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(k([8,16,32,64].map(es=>["Int","Uint","Float"].map(ts=>ts+es+"Array")))).filter(es=>e[es]),P=E.map(es=>e[es]);g(E,es=>[es,!0]);let K=null;function O(es){K=typeof WeakMap<"u"&&new WeakMap;const ts=S(es);return K=null,ts}function S(es){if(!es||typeof es!="object")return es;let ts=K&&K.get(es);if(ts)return ts;if(n(es)){ts=[],K&&K.set(es,ts);for(var ss=0,rs=es.length;ss<rs;++ss)ts.push(S(es[ss]))}else if(P.indexOf(es.constructor)>=0)ts=es;else{const os=s(es);for(var ns in ts=os===Object.prototype?{}:Object.create(os),K&&K.set(es,ts),es)o(es,ns)&&(ts[ns]=S(es[ns]))}return ts}const{toString:A}={};function C(es){return A.call(es).slice(8,-1)}const j=typeof Symbol<"u"?Symbol.iterator:"@@iterator",D=typeof j=="symbol"?function(es){var ts;return es!=null&&(ts=es[j])&&ts.apply(es)}:function(){return null},I={};function B(es){var ts,ss,rs,ns;if(arguments.length===1){if(n(es))return es.slice();if(this===I&&typeof es=="string")return[es];if(ns=D(es)){for(ss=[];!(rs=ns.next()).done;)ss.push(rs.value);return ss}if(es==null)return[es];if(typeof(ts=es.length)=="number"){for(ss=new Array(ts);ts--;)ss[ts]=es[ts];return ss}return[es]}for(ts=arguments.length,ss=new Array(ts);ts--;)ss[ts]=arguments[ts];return ss}const T=typeof Symbol<"u"?es=>es[Symbol.toStringTag]==="AsyncFunction":()=>!1;var R=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function F(es,ts){R=es,M=ts}var M=()=>!0;const N=!new Error("").stack;function q(){if(N)try{throw q.arguments,new Error}catch(es){return es}return new Error}function $(es,ts){var ss=es.stack;return ss?(ts=ts||0,ss.indexOf(es.name)===0&&(ts+=(es.name+es.message).split(`
`).length),ss.split(`
`).slice(ts).filter(M).map(rs=>`
`+rs).join("")):""}var U=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],L=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(U),V={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function W(es,ts){this._e=q(),this.name=es,this.message=ts}function Y(es,ts){return es+". Errors: "+Object.keys(ts).map(ss=>ts[ss].toString()).filter((ss,rs,ns)=>ns.indexOf(ss)===rs).join(`
`)}function z(es,ts,ss,rs){this._e=q(),this.failures=ts,this.failedKeys=rs,this.successCount=ss,this.message=Y(es,ts)}function G(es,ts){this._e=q(),this.name="BulkError",this.failures=Object.keys(ts).map(ss=>ts[ss]),this.failuresByPos=ts,this.message=Y(es,ts)}c(W).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+$(this._e,2))}},toString:function(){return this.name+": "+this.message}}),c(z).from(W),c(G).from(W);var H=L.reduce((es,ts)=>(es[ts]=ts+"Error",es),{});const Q=W;var X=L.reduce((es,ts)=>{var ss=ts+"Error";function rs(ns,os){this._e=q(),this.name=ss,ns?typeof ns=="string"?(this.message=`${ns}${os?`
 `+os:""}`,this.inner=os||null):typeof ns=="object"&&(this.message=`${ns.name} ${ns.message}`,this.inner=ns):(this.message=V[ts]||ss,this.inner=null)}return c(rs).from(Q),es[ts]=rs,es},{});X.Syntax=SyntaxError,X.Type=TypeError,X.Range=RangeError;var J=U.reduce((es,ts)=>(es[ts+"Error"]=X[ts],es),{}),Z=L.reduce((es,ts)=>(["Syntax","Type","Range"].indexOf(ts)===-1&&(es[ts+"Error"]=X[ts]),es),{});function ee(){}function te(es){return es}function ne(es,ts){return es==null||es===te?ts:function(ss){return ts(es(ss))}}function re(es,ts){return function(){es.apply(this,arguments),ts.apply(this,arguments)}}function se(es,ts){return es===ee?ts:function(){var ss=es.apply(this,arguments);ss!==void 0&&(arguments[0]=ss);var rs=this.onsuccess,ns=this.onerror;this.onsuccess=null,this.onerror=null;var os=ts.apply(this,arguments);return rs&&(this.onsuccess=this.onsuccess?re(rs,this.onsuccess):rs),ns&&(this.onerror=this.onerror?re(ns,this.onerror):ns),os!==void 0?os:ss}}function ie(es,ts){return es===ee?ts:function(){es.apply(this,arguments);var ss=this.onsuccess,rs=this.onerror;this.onsuccess=this.onerror=null,ts.apply(this,arguments),ss&&(this.onsuccess=this.onsuccess?re(ss,this.onsuccess):ss),rs&&(this.onerror=this.onerror?re(rs,this.onerror):rs)}}function oe(es,ts){return es===ee?ts:function(ss){var rs=es.apply(this,arguments);r$1(ss,rs);var ns=this.onsuccess,os=this.onerror;this.onsuccess=null,this.onerror=null;var as=ts.apply(this,arguments);return ns&&(this.onsuccess=this.onsuccess?re(ns,this.onsuccess):ns),os&&(this.onerror=this.onerror?re(os,this.onerror):os),rs===void 0?as===void 0?void 0:as:r$1(rs,as)}}function ae(es,ts){return es===ee?ts:function(){return ts.apply(this,arguments)!==!1&&es.apply(this,arguments)}}function ue(es,ts){return es===ee?ts:function(){var ss=es.apply(this,arguments);if(ss&&typeof ss.then=="function"){for(var rs=this,ns=arguments.length,os=new Array(ns);ns--;)os[ns]=arguments[ns];return ss.then(function(){return ts.apply(rs,os)})}return ts.apply(this,arguments)}}Z.ModifyError=z,Z.DexieError=W,Z.BulkError=G;var le={};const ce=100,[he,de,fe]=typeof Promise>"u"?[]:(()=>{let es=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[es,s(es),es];const ts=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[ts,s(ts),es]})(),pe=de&&de.then,ye=he&&he.constructor,me=!!fe;var ve=!1,ge=fe?()=>{fe.then($e)}:e.setImmediate?setImmediate.bind(null,$e):e.MutationObserver?()=>{var es=document.createElement("div");new MutationObserver(()=>{$e(),es=null}).observe(es,{attributes:!0}),es.setAttribute("i","1")}:()=>{setTimeout($e,0)},be=function(es,ts){Se.push([es,ts]),we&&(ge(),we=!1)},_e=!0,we=!0,xe=[],ke=[],Ee=null,Pe=te,Ke={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:dt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(es=>{try{dt(es[0],es[1])}catch{}})}},Oe=Ke,Se=[],Ae=0,Ce=[];function je(es){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ee,this._lib=!1;var ts=this._PSD=Oe;if(R&&(this._stackHolder=q(),this._prev=null,this._numPrev=0),typeof es!="function"){if(es!==le)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Te(this,this._value))}this._state=null,this._value=null,++ts.ref,Be(this,es)}const De={get:function(){var es=Oe,ts=Xe;function ss(rs,ns){var os=!es.global&&(es!==Oe||ts!==Xe);const as=os&&!tt();var ls=new je((cs,us)=>{Fe(this,new Ie(lt(rs,es,os,as),lt(ns,es,os,as),cs,us,es))});return R&&qe(ls,this),ls}return ss.prototype=le,ss},set:function(es){l(this,"then",es&&es.prototype===le?De:{get:function(){return es},set:De.set})}};function Ie(es,ts,ss,rs,ns){this.onFulfilled=typeof es=="function"?es:null,this.onRejected=typeof ts=="function"?ts:null,this.resolve=ss,this.reject=rs,this.psd=ns}function Be(es,ts){try{ts(ss=>{if(es._state===null){if(ss===es)throw new TypeError("A promise cannot be resolved with itself.");var rs=es._lib&&Ue();ss&&typeof ss.then=="function"?Be(es,(ns,os)=>{ss instanceof je?ss._then(ns,os):ss.then(ns,os)}):(es._state=!0,es._value=ss,Re(es)),rs&&Le()}},Te.bind(null,es))}catch(ss){Te(es,ss)}}function Te(es,ts){if(ke.push(ts),es._state===null){var ss=es._lib&&Ue();ts=Pe(ts),es._state=!1,es._value=ts,R&&ts!==null&&typeof ts=="object"&&!ts._promise&&function(rs,ns,os){try{rs.apply(null,os)}catch{}}(()=>{var rs=d(ts,"stack");ts._promise=es,l(ts,"stack",{get:()=>ve?rs&&(rs.get?rs.get.apply(ts):rs.value):es.stack})}),function(rs){xe.some(ns=>ns._value===rs._value)||xe.push(rs)}(es),Re(es),ss&&Le()}}function Re(es){var ts=es._listeners;es._listeners=[];for(var ss=0,rs=ts.length;ss<rs;++ss)Fe(es,ts[ss]);var ns=es._PSD;--ns.ref||ns.finalize(),Ae===0&&(++Ae,be(()=>{--Ae==0&&Ve()},[]))}function Fe(es,ts){if(es._state!==null){var ss=es._state?ts.onFulfilled:ts.onRejected;if(ss===null)return(es._state?ts.resolve:ts.reject)(es._value);++ts.psd.ref,++Ae,be(Me,[ss,es,ts])}else es._listeners.push(ts)}function Me(es,ts,ss){try{Ee=ts;var rs,ns=ts._value;ts._state?rs=es(ns):(ke.length&&(ke=[]),rs=es(ns),ke.indexOf(ns)===-1&&function(os){for(var as=xe.length;as;)if(xe[--as]._value===os._value)return void xe.splice(as,1)}(ts)),ss.resolve(rs)}catch(os){ss.reject(os)}finally{Ee=null,--Ae==0&&Ve(),--ss.psd.ref||ss.psd.finalize()}}function Ne(es,ts,ss){if(ts.length===ss)return ts;var rs="";if(es._state===!1){var ns,os,as=es._value;as!=null?(ns=as.name||"Error",os=as.message||as,rs=$(as,0)):(ns=as,os=""),ts.push(ns+(os?": "+os:"")+rs)}return R&&((rs=$(es._stackHolder,2))&&ts.indexOf(rs)===-1&&ts.push(rs),es._prev&&Ne(es._prev,ts,ss)),ts}function qe(es,ts){var ss=ts?ts._numPrev+1:0;ss<100&&(es._prev=ts,es._numPrev=ss)}function $e(){Ue()&&Le()}function Ue(){var es=_e;return _e=!1,we=!1,es}function Le(){var es,ts,ss;do for(;Se.length>0;)for(es=Se,Se=[],ss=es.length,ts=0;ts<ss;++ts){var rs=es[ts];rs[0].apply(null,rs[1])}while(Se.length>0);_e=!0,we=!0}function Ve(){var es=xe;xe=[],es.forEach(rs=>{rs._PSD.onunhandled.call(null,rs._value,rs)});for(var ts=Ce.slice(0),ss=ts.length;ss;)ts[--ss]()}function We(es){return new je(le,!1,es)}function Ye(es,ts){var ss=Oe;return function(){var rs=Ue(),ns=Oe;try{return it(ss,!0),es.apply(this,arguments)}catch(os){ts&&ts(os)}finally{it(ns,!1),rs&&Le()}}}a(je.prototype,{then:De,_then:function(es,ts){Fe(this,new Ie(null,null,es,ts,Oe))},catch:function(es){if(arguments.length===1)return this.then(null,es);var ts=arguments[0],ss=arguments[1];return typeof ts=="function"?this.then(null,rs=>rs instanceof ts?ss(rs):We(rs)):this.then(null,rs=>rs&&rs.name===ts?ss(rs):We(rs))},finally:function(es){return this.then(ts=>(es(),ts),ts=>(es(),We(ts)))},stack:{get:function(){if(this._stack)return this._stack;try{ve=!0;var es=Ne(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=es),es}finally{ve=!1}}},timeout:function(es,ts){return es<1/0?new je((ss,rs)=>{var ns=setTimeout(()=>rs(new X.Timeout(ts)),es);this.then(ss,rs).finally(clearTimeout.bind(null,ns))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&l(je.prototype,Symbol.toStringTag,"Dexie.Promise"),Ke.env=ot(),a(je,{all:function(){var es=B.apply(null,arguments).map(nt);return new je(function(ts,ss){es.length===0&&ts([]);var rs=es.length;es.forEach((ns,os)=>je.resolve(ns).then(as=>{es[os]=as,--rs||ts(es)},ss))})},resolve:es=>{if(es instanceof je)return es;if(es&&typeof es.then=="function")return new je((ss,rs)=>{es.then(ss,rs)});var ts=new je(le,!0,es);return qe(ts,Ee),ts},reject:We,race:function(){var es=B.apply(null,arguments).map(nt);return new je((ts,ss)=>{es.map(rs=>je.resolve(rs).then(ts,ss))})},PSD:{get:()=>Oe,set:es=>Oe=es},totalEchoes:{get:()=>Xe},newPSD:Ze,usePSD:at,scheduler:{get:()=>be,set:es=>{be=es}},rejectionMapper:{get:()=>Pe,set:es=>{Pe=es}},follow:(es,ts)=>new je((ss,rs)=>Ze((ns,os)=>{var as=Oe;as.unhandleds=[],as.onunhandled=os,as.finalize=re(function(){(function(ls){function cs(){ls(),Ce.splice(Ce.indexOf(cs),1)}Ce.push(cs),++Ae,be(()=>{--Ae==0&&Ve()},[])})(()=>{this.unhandleds.length===0?ns():os(this.unhandleds[0])})},as.finalize),es()},ts,ss,rs))}),ye&&(ye.allSettled&&l(je,"allSettled",function(){const es=B.apply(null,arguments).map(nt);return new je(ts=>{es.length===0&&ts([]);let ss=es.length;const rs=new Array(ss);es.forEach((ns,os)=>je.resolve(ns).then(as=>rs[os]={status:"fulfilled",value:as},as=>rs[os]={status:"rejected",reason:as}).then(()=>--ss||ts(rs)))})}),ye.any&&typeof AggregateError<"u"&&l(je,"any",function(){const es=B.apply(null,arguments).map(nt);return new je((ts,ss)=>{es.length===0&&ss(new AggregateError([]));let rs=es.length;const ns=new Array(rs);es.forEach((os,as)=>je.resolve(os).then(ls=>ts(ls),ls=>{ns[as]=ls,--rs||ss(new AggregateError(ns))}))})}));const ze={awaits:0,echoes:0,id:0};var Ge=0,He=[],Qe=0,Xe=0,Je=0;function Ze(es,ts,ss,rs){var ns=Oe,os=Object.create(ns);os.parent=ns,os.ref=0,os.global=!1,os.id=++Je;var as=Ke.env;os.env=me?{Promise:je,PromiseProp:{value:je,configurable:!0,writable:!0},all:je.all,race:je.race,allSettled:je.allSettled,any:je.any,resolve:je.resolve,reject:je.reject,nthen:ct(as.nthen,os),gthen:ct(as.gthen,os)}:{},ts&&r$1(os,ts),++ns.ref,os.finalize=function(){--this.parent.ref||this.parent.finalize()};var ls=at(os,es,ss,rs);return os.ref===0&&os.finalize(),ls}function et(){return ze.id||(ze.id=++Ge),++ze.awaits,ze.echoes+=ce,ze.id}function tt(){return!!ze.awaits&&(--ze.awaits==0&&(ze.id=0),ze.echoes=ze.awaits*ce,!0)}function nt(es){return ze.echoes&&es&&es.constructor===ye?(et(),es.then(ts=>(tt(),ts),ts=>(tt(),ft(ts)))):es}function rt(es){++Xe,ze.echoes&&--ze.echoes!=0||(ze.echoes=ze.id=0),He.push(Oe),it(es,!0)}function st(){var es=He[He.length-1];He.pop(),it(es,!1)}function it(es,ts){var ss=Oe;if((ts?!ze.echoes||Qe++&&es===Oe:!Qe||--Qe&&es===Oe)||ut(ts?rt.bind(null,es):st),es!==Oe&&(Oe=es,ss===Ke&&(Ke.env=ot()),me)){var rs=Ke.env.Promise,ns=es.env;de.then=ns.nthen,rs.prototype.then=ns.gthen,(ss.global||es.global)&&(Object.defineProperty(e,"Promise",ns.PromiseProp),rs.all=ns.all,rs.race=ns.race,rs.resolve=ns.resolve,rs.reject=ns.reject,ns.allSettled&&(rs.allSettled=ns.allSettled),ns.any&&(rs.any=ns.any))}}function ot(){var es=e.Promise;return me?{Promise:es,PromiseProp:Object.getOwnPropertyDescriptor(e,"Promise"),all:es.all,race:es.race,allSettled:es.allSettled,any:es.any,resolve:es.resolve,reject:es.reject,nthen:de.then,gthen:es.prototype.then}:{}}function at(es,ts,ss,rs,ns){var os=Oe;try{return it(es,!0),ts(ss,rs,ns)}finally{it(os,!1)}}function ut(es){pe.call(he,es)}function lt(es,ts,ss,rs){return typeof es!="function"?es:function(){var ns=Oe;ss&&et(),it(ts,!0);try{return es.apply(this,arguments)}finally{it(ns,!1),rs&&ut(tt)}}}function ct(es,ts){return function(ss,rs){return es.call(this,lt(ss,ts),lt(rs,ts))}}(""+pe).indexOf("[native code]")===-1&&(et=tt=ee);const ht="unhandledrejection";function dt(es,ts){var ss;try{ss=ts.onuncatched(es)}catch{}if(ss!==!1)try{var rs,ns={promise:ts,reason:es};if(e.document&&document.createEvent?((rs=document.createEvent("Event")).initEvent(ht,!0,!0),r$1(rs,ns)):e.CustomEvent&&r$1(rs=new CustomEvent(ht,{detail:ns}),ns),rs&&e.dispatchEvent&&(dispatchEvent(rs),!e.PromiseRejectionEvent&&e.onunhandledrejection))try{e.onunhandledrejection(rs)}catch{}R&&rs&&!rs.defaultPrevented&&console.warn(`Unhandled rejection: ${es.stack||es}`)}catch{}}var ft=je.reject;function pt(es,ts,ss,rs){if(es.idbdb&&(es._state.openComplete||Oe.letThrough||es._vip)){var ns=es._createTransaction(ts,ss,es._dbSchema);try{ns.create(),es._state.PR1398_maxLoop=3}catch(os){return os.name===H.InvalidState&&es.isOpen()&&--es._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),es._close(),es.open().then(()=>pt(es,ts,ss,rs))):ft(os)}return ns._promise(ts,(os,as)=>Ze(()=>(Oe.trans=ns,rs(os,as,ns)))).then(os=>ns._completion.then(()=>os))}if(es._state.openComplete)return ft(new X.DatabaseClosed(es._state.dbOpenError));if(!es._state.isBeingOpened){if(!es._options.autoOpen)return ft(new X.DatabaseClosed);es.open().catch(ee)}return es._state.dbReadyPromise.then(()=>pt(es,ts,ss,rs))}const yt="3.2.7",mt="",vt=-1/0,gt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",bt="String expected.",_t=[],wt=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),xt=wt,kt=wt,Et=es=>!/(dexie\.js|dexie\.min\.js)/.test(es),Pt="__dbnames",Kt="readonly",Ot="readwrite";function St(es,ts){return es?ts?function(){return es.apply(this,arguments)&&ts.apply(this,arguments)}:es:ts}const At={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ct(es){return typeof es!="string"||/\./.test(es)?ts=>ts:ts=>(ts[es]===void 0&&es in ts&&delete(ts=O(ts))[es],ts)}class jt{_trans(ts,ss,rs){const ns=this._tx||Oe.trans,os=this.name;function as(cs,us,ds){if(!ds.schema[os])throw new X.NotFound("Table "+os+" not part of transaction");return ss(ds.idbtrans,ds)}const ls=Ue();try{return ns&&ns.db===this.db?ns===Oe.trans?ns._promise(ts,as,rs):Ze(()=>ns._promise(ts,as,rs),{trans:ns,transless:Oe.transless||Oe}):pt(this.db,ts,[this.name],as)}finally{ls&&Le()}}get(ts,ss){return ts&&ts.constructor===Object?this.where(ts).first(ss):this._trans("readonly",rs=>this.core.get({trans:rs,key:ts}).then(ns=>this.hook.reading.fire(ns))).then(ss)}where(ts){if(typeof ts=="string")return new this.db.WhereClause(this,ts);if(n(ts))return new this.db.WhereClause(this,`[${ts.join("+")}]`);const ss=t(ts);if(ss.length===1)return this.where(ss[0]).equals(ts[ss[0]]);const rs=this.schema.indexes.concat(this.schema.primKey).filter(us=>{if(us.compound&&ss.every(ds=>us.keyPath.indexOf(ds)>=0)){for(let ds=0;ds<ss.length;++ds)if(ss.indexOf(us.keyPath[ds])===-1)return!1;return!0}return!1}).sort((us,ds)=>us.keyPath.length-ds.keyPath.length)[0];if(rs&&this.db._maxKey!==mt){const us=rs.keyPath.slice(0,ss.length);return this.where(us).equals(us.map(ds=>ts[ds]))}!rs&&R&&console.warn(`The query ${JSON.stringify(ts)} on ${this.name} would benefit of a compound index [${ss.join("+")}]`);const{idxByName:ns}=this.schema,os=this.db._deps.indexedDB;function as(us,ds){try{return os.cmp(us,ds)===0}catch{return!1}}const[ls,cs]=ss.reduce(([us,ds],ms)=>{const ps=ns[ms],hs=ts[ms];return[us||ps,us||!ps?St(ds,ps&&ps.multi?xs=>{const ys=b(xs,ms);return n(ys)&&ys.some(vs=>as(hs,vs))}:xs=>as(hs,b(xs,ms))):ds]},[null,null]);return ls?this.where(ls.name).equals(ts[ls.keyPath]).filter(cs):rs?this.filter(cs):this.where(ss).equals("")}filter(ts){return this.toCollection().and(ts)}count(ts){return this.toCollection().count(ts)}offset(ts){return this.toCollection().offset(ts)}limit(ts){return this.toCollection().limit(ts)}each(ts){return this.toCollection().each(ts)}toArray(ts){return this.toCollection().toArray(ts)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(ts){return new this.db.Collection(new this.db.WhereClause(this,n(ts)?`[${ts.join("+")}]`:ts))}reverse(){return this.toCollection().reverse()}mapToClass(ts){this.schema.mappedClass=ts;const ss=rs=>{if(!rs)return rs;const ns=Object.create(ts.prototype);for(var os in rs)if(o(rs,os))try{ns[os]=rs[os]}catch{}return ns};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=ss,this.hook("reading",ss),ts}defineClass(){return this.mapToClass(function(ts){r$1(this,ts)})}add(ts,ss){const{auto:rs,keyPath:ns}=this.schema.primKey;let os=ts;return ns&&rs&&(os=Ct(ns)(ts)),this._trans("readwrite",as=>this.core.mutate({trans:as,type:"add",keys:ss!=null?[ss]:null,values:[os]})).then(as=>as.numFailures?je.reject(as.failures[0]):as.lastResult).then(as=>{if(ns)try{_(ts,ns,as)}catch{}return as})}update(ts,ss){if(typeof ts!="object"||n(ts))return this.where(":id").equals(ts).modify(ss);{const rs=b(ts,this.schema.primKey.keyPath);if(rs===void 0)return ft(new X.InvalidArgument("Given object does not contain its primary key"));try{typeof ss!="function"?t(ss).forEach(ns=>{_(ts,ns,ss[ns])}):ss(ts,{value:ts,primKey:rs})}catch{}return this.where(":id").equals(rs).modify(ss)}}put(ts,ss){const{auto:rs,keyPath:ns}=this.schema.primKey;let os=ts;return ns&&rs&&(os=Ct(ns)(ts)),this._trans("readwrite",as=>this.core.mutate({trans:as,type:"put",values:[os],keys:ss!=null?[ss]:null})).then(as=>as.numFailures?je.reject(as.failures[0]):as.lastResult).then(as=>{if(ns)try{_(ts,ns,as)}catch{}return as})}delete(ts){return this._trans("readwrite",ss=>this.core.mutate({trans:ss,type:"delete",keys:[ts]})).then(ss=>ss.numFailures?je.reject(ss.failures[0]):void 0)}clear(){return this._trans("readwrite",ts=>this.core.mutate({trans:ts,type:"deleteRange",range:At})).then(ts=>ts.numFailures?je.reject(ts.failures[0]):void 0)}bulkGet(ts){return this._trans("readonly",ss=>this.core.getMany({keys:ts,trans:ss}).then(rs=>rs.map(ns=>this.hook.reading.fire(ns))))}bulkAdd(ts,ss,rs){const ns=Array.isArray(ss)?ss:void 0,os=(rs=rs||(ns?void 0:ss))?rs.allKeys:void 0;return this._trans("readwrite",as=>{const{auto:ls,keyPath:cs}=this.schema.primKey;if(cs&&ns)throw new X.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(ns&&ns.length!==ts.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");const us=ts.length;let ds=cs&&ls?ts.map(Ct(cs)):ts;return this.core.mutate({trans:as,type:"add",keys:ns,values:ds,wantResults:os}).then(({numFailures:ms,results:ps,lastResult:hs,failures:xs})=>{if(ms===0)return os?ps:hs;throw new G(`${this.name}.bulkAdd(): ${ms} of ${us} operations failed`,xs)})})}bulkPut(ts,ss,rs){const ns=Array.isArray(ss)?ss:void 0,os=(rs=rs||(ns?void 0:ss))?rs.allKeys:void 0;return this._trans("readwrite",as=>{const{auto:ls,keyPath:cs}=this.schema.primKey;if(cs&&ns)throw new X.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(ns&&ns.length!==ts.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");const us=ts.length;let ds=cs&&ls?ts.map(Ct(cs)):ts;return this.core.mutate({trans:as,type:"put",keys:ns,values:ds,wantResults:os}).then(({numFailures:ms,results:ps,lastResult:hs,failures:xs})=>{if(ms===0)return os?ps:hs;throw new G(`${this.name}.bulkPut(): ${ms} of ${us} operations failed`,xs)})})}bulkDelete(ts){const ss=ts.length;return this._trans("readwrite",rs=>this.core.mutate({trans:rs,type:"delete",keys:ts})).then(({numFailures:rs,lastResult:ns,failures:os})=>{if(rs===0)return ns;throw new G(`${this.name}.bulkDelete(): ${rs} of ${ss} operations failed`,os)})}}function Dt(es){var ts={},ss=function(as,ls){if(ls){for(var cs=arguments.length,us=new Array(cs-1);--cs;)us[cs-1]=arguments[cs];return ts[as].subscribe.apply(null,us),es}if(typeof as=="string")return ts[as]};ss.addEventType=os;for(var rs=1,ns=arguments.length;rs<ns;++rs)os(arguments[rs]);return ss;function os(as,ls,cs){if(typeof as!="object"){var us;ls||(ls=ae),cs||(cs=ee);var ds={subscribers:[],fire:cs,subscribe:function(ms){ds.subscribers.indexOf(ms)===-1&&(ds.subscribers.push(ms),ds.fire=ls(ds.fire,ms))},unsubscribe:function(ms){ds.subscribers=ds.subscribers.filter(function(ps){return ps!==ms}),ds.fire=ds.subscribers.reduce(ls,cs)}};return ts[as]=ss[as]=ds,ds}t(us=as).forEach(function(ms){var ps=us[ms];if(n(ps))os(ms,us[ms][0],us[ms][1]);else{if(ps!=="asap")throw new X.InvalidArgument("Invalid event config");var hs=os(ms,te,function(){for(var xs=arguments.length,ys=new Array(xs);xs--;)ys[xs]=arguments[xs];hs.subscribers.forEach(function(vs){v(function(){vs.apply(null,ys)})})})}})}}function It(es,ts){return c(ts).from({prototype:es}),ts}function Bt(es,ts){return!(es.filter||es.algorithm||es.or)&&(ts?es.justLimit:!es.replayFilter)}function Tt(es,ts){es.filter=St(es.filter,ts)}function Rt(es,ts,ss){var rs=es.replayFilter;es.replayFilter=rs?()=>St(rs(),ts()):ts,es.justLimit=ss&&!rs}function Ft(es,ts){if(es.isPrimKey)return ts.primaryKey;const ss=ts.getIndexByKeyPath(es.index);if(!ss)throw new X.Schema("KeyPath "+es.index+" on object store "+ts.name+" is not indexed");return ss}function Mt(es,ts,ss){const rs=Ft(es,ts.schema);return ts.openCursor({trans:ss,values:!es.keysOnly,reverse:es.dir==="prev",unique:!!es.unique,query:{index:rs,range:es.range}})}function Nt(es,ts,ss,rs){const ns=es.replayFilter?St(es.filter,es.replayFilter()):es.filter;if(es.or){const os={},as=(ls,cs,us)=>{if(!ns||ns(cs,us,ps=>cs.stop(ps),ps=>cs.fail(ps))){var ds=cs.primaryKey,ms=""+ds;ms==="[object ArrayBuffer]"&&(ms=""+new Uint8Array(ds)),o(os,ms)||(os[ms]=!0,ts(ls,cs,us))}};return Promise.all([es.or._iterate(as,ss),qt(Mt(es,rs,ss),es.algorithm,as,!es.keysOnly&&es.valueMapper)])}return qt(Mt(es,rs,ss),St(es.algorithm,ns),ts,!es.keysOnly&&es.valueMapper)}function qt(es,ts,ss,rs){var ns=Ye(rs?(os,as,ls)=>ss(rs(os),as,ls):ss);return es.then(os=>{if(os)return os.start(()=>{var as=()=>os.continue();ts&&!ts(os,ls=>as=ls,ls=>{os.stop(ls),as=ee},ls=>{os.fail(ls),as=ee})||ns(os.value,os,ls=>as=ls),as()})})}function $t(es,ts){try{const ss=Ut(es),rs=Ut(ts);if(ss!==rs)return ss==="Array"?1:rs==="Array"?-1:ss==="binary"?1:rs==="binary"?-1:ss==="string"?1:rs==="string"?-1:ss==="Date"?1:rs!=="Date"?NaN:-1;switch(ss){case"number":case"Date":case"string":return es>ts?1:es<ts?-1:0;case"binary":return function(ns,os){const as=ns.length,ls=os.length,cs=as<ls?as:ls;for(let us=0;us<cs;++us)if(ns[us]!==os[us])return ns[us]<os[us]?-1:1;return as===ls?0:as<ls?-1:1}(Lt(es),Lt(ts));case"Array":return function(ns,os){const as=ns.length,ls=os.length,cs=as<ls?as:ls;for(let us=0;us<cs;++us){const ds=$t(ns[us],os[us]);if(ds!==0)return ds}return as===ls?0:as<ls?-1:1}(es,ts)}}catch{}return NaN}function Ut(es){const ts=typeof es;if(ts!=="object")return ts;if(ArrayBuffer.isView(es))return"binary";const ss=C(es);return ss==="ArrayBuffer"?"binary":ss}function Lt(es){return es instanceof Uint8Array?es:ArrayBuffer.isView(es)?new Uint8Array(es.buffer,es.byteOffset,es.byteLength):new Uint8Array(es)}class Vt{_read(ts,ss){var rs=this._ctx;return rs.error?rs.table._trans(null,ft.bind(null,rs.error)):rs.table._trans("readonly",ts).then(ss)}_write(ts){var ss=this._ctx;return ss.error?ss.table._trans(null,ft.bind(null,ss.error)):ss.table._trans("readwrite",ts,"locked")}_addAlgorithm(ts){var ss=this._ctx;ss.algorithm=St(ss.algorithm,ts)}_iterate(ts,ss){return Nt(this._ctx,ts,ss,this._ctx.table.core)}clone(ts){var ss=Object.create(this.constructor.prototype),rs=Object.create(this._ctx);return ts&&r$1(rs,ts),ss._ctx=rs,ss}raw(){return this._ctx.valueMapper=null,this}each(ts){var ss=this._ctx;return this._read(rs=>Nt(ss,ts,rs,ss.table.core))}count(ts){return this._read(ss=>{const rs=this._ctx,ns=rs.table.core;if(Bt(rs,!0))return ns.count({trans:ss,query:{index:Ft(rs,ns.schema),range:rs.range}}).then(as=>Math.min(as,rs.limit));var os=0;return Nt(rs,()=>(++os,!1),ss,ns).then(()=>os)}).then(ts)}sortBy(ts,ss){const rs=ts.split(".").reverse(),ns=rs[0],os=rs.length-1;function as(us,ds){return ds?as(us[rs[ds]],ds-1):us[ns]}var ls=this._ctx.dir==="next"?1:-1;function cs(us,ds){var ms=as(us,os),ps=as(ds,os);return ms<ps?-ls:ms>ps?ls:0}return this.toArray(function(us){return us.sort(cs)}).then(ss)}toArray(ts){return this._read(ss=>{var rs=this._ctx;if(rs.dir==="next"&&Bt(rs,!0)&&rs.limit>0){const{valueMapper:ns}=rs,os=Ft(rs,rs.table.core.schema);return rs.table.core.query({trans:ss,limit:rs.limit,values:!0,query:{index:os,range:rs.range}}).then(({result:as})=>ns?as.map(ns):as)}{const ns=[];return Nt(rs,os=>ns.push(os),ss,rs.table.core).then(()=>ns)}},ts)}offset(ts){var ss=this._ctx;return ts<=0||(ss.offset+=ts,Bt(ss)?Rt(ss,()=>{var rs=ts;return(ns,os)=>rs===0||(rs===1?(--rs,!1):(os(()=>{ns.advance(rs),rs=0}),!1))}):Rt(ss,()=>{var rs=ts;return()=>--rs<0})),this}limit(ts){return this._ctx.limit=Math.min(this._ctx.limit,ts),Rt(this._ctx,()=>{var ss=ts;return function(rs,ns,os){return--ss<=0&&ns(os),ss>=0}},!0),this}until(ts,ss){return Tt(this._ctx,function(rs,ns,os){return!ts(rs.value)||(ns(os),ss)}),this}first(ts){return this.limit(1).toArray(function(ss){return ss[0]}).then(ts)}last(ts){return this.reverse().first(ts)}filter(ts){var ss,rs;return Tt(this._ctx,function(ns){return ts(ns.value)}),ss=this._ctx,rs=ts,ss.isMatch=St(ss.isMatch,rs),this}and(ts){return this.filter(ts)}or(ts){return new this.db.WhereClause(this._ctx.table,ts,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(ts){var ss=this._ctx;return ss.keysOnly=!ss.isMatch,this.each(function(rs,ns){ts(ns.key,ns)})}eachUniqueKey(ts){return this._ctx.unique="unique",this.eachKey(ts)}eachPrimaryKey(ts){var ss=this._ctx;return ss.keysOnly=!ss.isMatch,this.each(function(rs,ns){ts(ns.primaryKey,ns)})}keys(ts){var ss=this._ctx;ss.keysOnly=!ss.isMatch;var rs=[];return this.each(function(ns,os){rs.push(os.key)}).then(function(){return rs}).then(ts)}primaryKeys(ts){var ss=this._ctx;if(ss.dir==="next"&&Bt(ss,!0)&&ss.limit>0)return this._read(ns=>{var os=Ft(ss,ss.table.core.schema);return ss.table.core.query({trans:ns,values:!1,limit:ss.limit,query:{index:os,range:ss.range}})}).then(({result:ns})=>ns).then(ts);ss.keysOnly=!ss.isMatch;var rs=[];return this.each(function(ns,os){rs.push(os.primaryKey)}).then(function(){return rs}).then(ts)}uniqueKeys(ts){return this._ctx.unique="unique",this.keys(ts)}firstKey(ts){return this.limit(1).keys(function(ss){return ss[0]}).then(ts)}lastKey(ts){return this.reverse().firstKey(ts)}distinct(){var ts=this._ctx,ss=ts.index&&ts.table.schema.idxByName[ts.index];if(!ss||!ss.multi)return this;var rs={};return Tt(this._ctx,function(ns){var os=ns.primaryKey.toString(),as=o(rs,os);return rs[os]=!0,!as}),this}modify(ts){var ss=this._ctx;return this._write(rs=>{var ns;if(typeof ts=="function")ns=ts;else{var os=t(ts),as=os.length;ns=function(ys){for(var vs=!1,gs=0;gs<as;++gs){var fs=os[gs],js=ts[fs];b(ys,fs)!==js&&(_(ys,fs,js),vs=!0)}return vs}}const ls=ss.table.core,{outbound:cs,extractKey:us}=ls.schema.primaryKey,ds=this.db._options.modifyChunkSize||200,ms=[];let ps=0;const hs=[],xs=(ys,vs)=>{const{failures:gs,numFailures:fs}=vs;ps+=ys-fs;for(let js of t(gs))ms.push(gs[js])};return this.clone().primaryKeys().then(ys=>{const vs=gs=>{const fs=Math.min(ds,ys.length-gs);return ls.getMany({trans:rs,keys:ys.slice(gs,gs+fs),cache:"immutable"}).then(js=>{const Ss=[],bs=[],Es=cs?[]:null,Rs=[];for(let Ns=0;Ns<fs;++Ns){const ks=js[Ns],_s={value:O(ks),primKey:ys[gs+Ns]};ns.call(_s,_s.value,_s)!==!1&&(_s.value==null?Rs.push(ys[gs+Ns]):cs||$t(us(ks),us(_s.value))===0?(bs.push(_s.value),cs&&Es.push(ys[gs+Ns])):(Rs.push(ys[gs+Ns]),Ss.push(_s.value)))}const ws=Bt(ss)&&ss.limit===1/0&&(typeof ts!="function"||ts===Wt)&&{index:ss.index,range:ss.range};return Promise.resolve(Ss.length>0&&ls.mutate({trans:rs,type:"add",values:Ss}).then(Ns=>{for(let ks in Ns.failures)Rs.splice(parseInt(ks),1);xs(Ss.length,Ns)})).then(()=>(bs.length>0||ws&&typeof ts=="object")&&ls.mutate({trans:rs,type:"put",keys:Es,values:bs,criteria:ws,changeSpec:typeof ts!="function"&&ts}).then(Ns=>xs(bs.length,Ns))).then(()=>(Rs.length>0||ws&&ts===Wt)&&ls.mutate({trans:rs,type:"delete",keys:Rs,criteria:ws}).then(Ns=>xs(Rs.length,Ns))).then(()=>ys.length>gs+fs&&vs(gs+ds))})};return vs(0).then(()=>{if(ms.length>0)throw new z("Error modifying one or more objects",ms,ps,hs);return ys.length})})})}delete(){var ts=this._ctx,ss=ts.range;return Bt(ts)&&(ts.isPrimKey&&!kt||ss.type===3)?this._write(rs=>{const{primaryKey:ns}=ts.table.core.schema,os=ss;return ts.table.core.count({trans:rs,query:{index:ns,range:os}}).then(as=>ts.table.core.mutate({trans:rs,type:"deleteRange",range:os}).then(({failures:ls,lastResult:cs,results:us,numFailures:ds})=>{if(ds)throw new z("Could not delete some values",Object.keys(ls).map(ms=>ls[ms]),as-ds);return as-ds}))}):this.modify(Wt)}}const Wt=(es,ts)=>ts.value=null;function Yt(es,ts){return es<ts?-1:es===ts?0:1}function zt(es,ts){return es>ts?-1:es===ts?0:1}function Gt(es,ts,ss){var rs=es instanceof en?new es.Collection(es):es;return rs._ctx.error=ss?new ss(ts):new TypeError(ts),rs}function Ht(es){return new es.Collection(es,()=>Zt("")).limit(0)}function Qt(es,ts,ss,rs,ns,os){for(var as=Math.min(es.length,rs.length),ls=-1,cs=0;cs<as;++cs){var us=ts[cs];if(us!==rs[cs])return ns(es[cs],ss[cs])<0?es.substr(0,cs)+ss[cs]+ss.substr(cs+1):ns(es[cs],rs[cs])<0?es.substr(0,cs)+rs[cs]+ss.substr(cs+1):ls>=0?es.substr(0,ls)+ts[ls]+ss.substr(ls+1):null;ns(es[cs],us)<0&&(ls=cs)}return as<rs.length&&os==="next"?es+ss.substr(es.length):as<es.length&&os==="prev"?es.substr(0,ss.length):ls<0?null:es.substr(0,ls)+rs[ls]+ss.substr(ls+1)}function Xt(es,ts,ss,rs){var ns,os,as,ls,cs,us,ds,ms=ss.length;if(!ss.every(ys=>typeof ys=="string"))return Gt(es,bt);function ps(ys){ns=function(gs){return gs==="next"?fs=>fs.toUpperCase():fs=>fs.toLowerCase()}(ys),os=function(gs){return gs==="next"?fs=>fs.toLowerCase():fs=>fs.toUpperCase()}(ys),as=ys==="next"?Yt:zt;var vs=ss.map(function(gs){return{lower:os(gs),upper:ns(gs)}}).sort(function(gs,fs){return as(gs.lower,fs.lower)});ls=vs.map(function(gs){return gs.upper}),cs=vs.map(function(gs){return gs.lower}),us=ys,ds=ys==="next"?"":rs}ps("next");var hs=new es.Collection(es,()=>Jt(ls[0],cs[ms-1]+rs));hs._ondirectionchange=function(ys){ps(ys)};var xs=0;return hs._addAlgorithm(function(ys,vs,gs){var fs=ys.key;if(typeof fs!="string")return!1;var js=os(fs);if(ts(js,cs,xs))return!0;for(var Ss=null,bs=xs;bs<ms;++bs){var Es=Qt(fs,js,ls[bs],cs[bs],as,us);Es===null&&Ss===null?xs=bs+1:(Ss===null||as(Ss,Es)>0)&&(Ss=Es)}return vs(Ss!==null?function(){ys.continue(Ss+ds)}:gs),!1}),hs}function Jt(es,ts,ss,rs){return{type:2,lower:es,upper:ts,lowerOpen:ss,upperOpen:rs}}function Zt(es){return{type:1,lower:es,upper:es}}class en{get Collection(){return this._ctx.table.db.Collection}between(ts,ss,rs,ns){rs=rs!==!1,ns=ns===!0;try{return this._cmp(ts,ss)>0||this._cmp(ts,ss)===0&&(rs||ns)&&(!rs||!ns)?Ht(this):new this.Collection(this,()=>Jt(ts,ss,!rs,!ns))}catch{return Gt(this,gt)}}equals(ts){return ts==null?Gt(this,gt):new this.Collection(this,()=>Zt(ts))}above(ts){return ts==null?Gt(this,gt):new this.Collection(this,()=>Jt(ts,void 0,!0))}aboveOrEqual(ts){return ts==null?Gt(this,gt):new this.Collection(this,()=>Jt(ts,void 0,!1))}below(ts){return ts==null?Gt(this,gt):new this.Collection(this,()=>Jt(void 0,ts,!1,!0))}belowOrEqual(ts){return ts==null?Gt(this,gt):new this.Collection(this,()=>Jt(void 0,ts))}startsWith(ts){return typeof ts!="string"?Gt(this,bt):this.between(ts,ts+mt,!0,!0)}startsWithIgnoreCase(ts){return ts===""?this.startsWith(ts):Xt(this,(ss,rs)=>ss.indexOf(rs[0])===0,[ts],mt)}equalsIgnoreCase(ts){return Xt(this,(ss,rs)=>ss===rs[0],[ts],"")}anyOfIgnoreCase(){var ts=B.apply(I,arguments);return ts.length===0?Ht(this):Xt(this,(ss,rs)=>rs.indexOf(ss)!==-1,ts,"")}startsWithAnyOfIgnoreCase(){var ts=B.apply(I,arguments);return ts.length===0?Ht(this):Xt(this,(ss,rs)=>rs.some(ns=>ss.indexOf(ns)===0),ts,mt)}anyOf(){const ts=B.apply(I,arguments);let ss=this._cmp;try{ts.sort(ss)}catch{return Gt(this,gt)}if(ts.length===0)return Ht(this);const rs=new this.Collection(this,()=>Jt(ts[0],ts[ts.length-1]));rs._ondirectionchange=os=>{ss=os==="next"?this._ascending:this._descending,ts.sort(ss)};let ns=0;return rs._addAlgorithm((os,as,ls)=>{const cs=os.key;for(;ss(cs,ts[ns])>0;)if(++ns,ns===ts.length)return as(ls),!1;return ss(cs,ts[ns])===0||(as(()=>{os.continue(ts[ns])}),!1)}),rs}notEqual(ts){return this.inAnyRange([[vt,ts],[ts,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const ts=B.apply(I,arguments);if(ts.length===0)return new this.Collection(this);try{ts.sort(this._ascending)}catch{return Gt(this,gt)}const ss=ts.reduce((rs,ns)=>rs?rs.concat([[rs[rs.length-1][1],ns]]):[[vt,ns]],null);return ss.push([ts[ts.length-1],this.db._maxKey]),this.inAnyRange(ss,{includeLowers:!1,includeUppers:!1})}inAnyRange(ts,ss){const rs=this._cmp,ns=this._ascending,os=this._descending,as=this._min,ls=this._max;if(ts.length===0)return Ht(this);if(!ts.every(fs=>fs[0]!==void 0&&fs[1]!==void 0&&ns(fs[0],fs[1])<=0))return Gt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",X.InvalidArgument);const cs=!ss||ss.includeLowers!==!1,us=ss&&ss.includeUppers===!0;let ds,ms=ns;function ps(fs,js){return ms(fs[0],js[0])}try{ds=ts.reduce(function(fs,js){let Ss=0,bs=fs.length;for(;Ss<bs;++Ss){const Es=fs[Ss];if(rs(js[0],Es[1])<0&&rs(js[1],Es[0])>0){Es[0]=as(Es[0],js[0]),Es[1]=ls(Es[1],js[1]);break}}return Ss===bs&&fs.push(js),fs},[]),ds.sort(ps)}catch{return Gt(this,gt)}let hs=0;const xs=us?fs=>ns(fs,ds[hs][1])>0:fs=>ns(fs,ds[hs][1])>=0,ys=cs?fs=>os(fs,ds[hs][0])>0:fs=>os(fs,ds[hs][0])>=0;let vs=xs;const gs=new this.Collection(this,()=>Jt(ds[0][0],ds[ds.length-1][1],!cs,!us));return gs._ondirectionchange=fs=>{fs==="next"?(vs=xs,ms=ns):(vs=ys,ms=os),ds.sort(ps)},gs._addAlgorithm((fs,js,Ss)=>{for(var bs=fs.key;vs(bs);)if(++hs,hs===ds.length)return js(Ss),!1;return!!function(Es){return!xs(Es)&&!ys(Es)}(bs)||(this._cmp(bs,ds[hs][1])===0||this._cmp(bs,ds[hs][0])===0||js(()=>{ms===ns?fs.continue(ds[hs][0]):fs.continue(ds[hs][1])}),!1)}),gs}startsWithAnyOf(){const ts=B.apply(I,arguments);return ts.every(ss=>typeof ss=="string")?ts.length===0?Ht(this):this.inAnyRange(ts.map(ss=>[ss,ss+mt])):Gt(this,"startsWithAnyOf() only works with strings")}}function tn(es){return Ye(function(ts){return nn(ts),es(ts.target.error),!1})}function nn(es){es.stopPropagation&&es.stopPropagation(),es.preventDefault&&es.preventDefault()}const rn="storagemutated",sn="x-storagemutated-1",on=Dt(null,rn);class an{_lock(){return m(!Oe.global),++this._reculock,this._reculock!==1||Oe.global||(Oe.lockOwnerFor=this),this}_unlock(){if(m(!Oe.global),--this._reculock==0)for(Oe.global||(Oe.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var ts=this._blockedFuncs.shift();try{at(ts[1],ts[0])}catch{}}return this}_locked(){return this._reculock&&Oe.lockOwnerFor!==this}create(ts){if(!this.mode)return this;const ss=this.db.idbdb,rs=this.db._state.dbOpenError;if(m(!this.idbtrans),!ts&&!ss)switch(rs&&rs.name){case"DatabaseClosedError":throw new X.DatabaseClosed(rs);case"MissingAPIError":throw new X.MissingAPI(rs.message,rs);default:throw new X.OpenFailed(rs)}if(!this.active)throw new X.TransactionInactive;return m(this._completion._state===null),(ts=this.idbtrans=ts||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):ss.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ye(ns=>{nn(ns),this._reject(ts.error)}),ts.onabort=Ye(ns=>{nn(ns),this.active&&this._reject(new X.Abort(ts.error)),this.active=!1,this.on("abort").fire(ns)}),ts.oncomplete=Ye(()=>{this.active=!1,this._resolve(),"mutatedParts"in ts&&on.storagemutated.fire(ts.mutatedParts)}),this}_promise(ts,ss,rs){if(ts==="readwrite"&&this.mode!=="readwrite")return ft(new X.ReadOnly("Transaction is readonly"));if(!this.active)return ft(new X.TransactionInactive);if(this._locked())return new je((os,as)=>{this._blockedFuncs.push([()=>{this._promise(ts,ss,rs).then(os,as)},Oe])});if(rs)return Ze(()=>{var os=new je((as,ls)=>{this._lock();const cs=ss(as,ls,this);cs&&cs.then&&cs.then(as,ls)});return os.finally(()=>this._unlock()),os._lib=!0,os});var ns=new je((os,as)=>{var ls=ss(os,as,this);ls&&ls.then&&ls.then(os,as)});return ns._lib=!0,ns}_root(){return this.parent?this.parent._root():this}waitFor(ts){var ss=this._root();const rs=je.resolve(ts);if(ss._waitingFor)ss._waitingFor=ss._waitingFor.then(()=>rs);else{ss._waitingFor=rs,ss._waitingQueue=[];var ns=ss.idbtrans.objectStore(ss.storeNames[0]);(function as(){for(++ss._spinCount;ss._waitingQueue.length;)ss._waitingQueue.shift()();ss._waitingFor&&(ns.get(-1/0).onsuccess=as)})()}var os=ss._waitingFor;return new je((as,ls)=>{rs.then(cs=>ss._waitingQueue.push(Ye(as.bind(null,cs))),cs=>ss._waitingQueue.push(Ye(ls.bind(null,cs)))).finally(()=>{ss._waitingFor===os&&(ss._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new X.Abort))}table(ts){const ss=this._memoizedTables||(this._memoizedTables={});if(o(ss,ts))return ss[ts];const rs=this.schema[ts];if(!rs)throw new X.NotFound("Table "+ts+" not part of transaction");const ns=new this.db.Table(ts,rs,this);return ns.core=this.db.core.table(ts),ss[ts]=ns,ns}}function un(es,ts,ss,rs,ns,os,as){return{name:es,keyPath:ts,unique:ss,multi:rs,auto:ns,compound:os,src:(ss&&!as?"&":"")+(rs?"*":"")+(ns?"++":"")+ln(ts)}}function ln(es){return typeof es=="string"?es:es?"["+[].join.call(es,"+")+"]":""}function cn(es,ts,ss){return{name:es,primKey:ts,indexes:ss,mappedClass:null,idxByName:g(ss,rs=>[rs.name,rs])}}let hn=es=>{try{return es.only([[]]),hn=()=>[[]],[[]]}catch{return hn=()=>mt,mt}};function dn(es){return es==null?()=>{}:typeof es=="string"?function(ts){return ts.split(".").length===1?rs=>rs[ts]:rs=>b(rs,ts)}(es):ts=>b(ts,es)}function fn(es){return[].slice.call(es)}let pn=0;function yn(es){return es==null?":id":typeof es=="string"?es:`[${es.join("+")}]`}function mn(es,ts,ss){function rs(cs){if(cs.type===3)return null;if(cs.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:us,upper:ds,lowerOpen:ms,upperOpen:ps}=cs;return us===void 0?ds===void 0?null:ts.upperBound(ds,!!ps):ds===void 0?ts.lowerBound(us,!!ms):ts.bound(us,ds,!!ms,!!ps)}const{schema:ns,hasGetAll:os}=function(cs,us){const ds=fn(cs.objectStoreNames);return{schema:{name:cs.name,tables:ds.map(ms=>us.objectStore(ms)).map(ms=>{const{keyPath:ps,autoIncrement:hs}=ms,xs=n(ps),ys=ps==null,vs={},gs={name:ms.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:ys,compound:xs,keyPath:ps,autoIncrement:hs,unique:!0,extractKey:dn(ps)},indexes:fn(ms.indexNames).map(fs=>ms.index(fs)).map(fs=>{const{name:js,unique:Ss,multiEntry:bs,keyPath:Es}=fs,Rs={name:js,compound:n(Es),keyPath:Es,unique:Ss,multiEntry:bs,extractKey:dn(Es)};return vs[yn(Es)]=Rs,Rs}),getIndexByKeyPath:fs=>vs[yn(fs)]};return vs[":id"]=gs.primaryKey,ps!=null&&(vs[yn(ps)]=gs.primaryKey),gs})},hasGetAll:ds.length>0&&"getAll"in us.objectStore(ds[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(es,ss),as=ns.tables.map(cs=>function(us){const ds=us.name;return{name:ds,schema:us,mutate:function({trans:ms,type:ps,keys:hs,values:xs,range:ys}){return new Promise((vs,gs)=>{vs=Ye(vs);const fs=ms.objectStore(ds),js=fs.keyPath==null,Ss=ps==="put"||ps==="add";if(!Ss&&ps!=="delete"&&ps!=="deleteRange")throw new Error("Invalid operation type: "+ps);const{length:bs}=hs||xs||{length:1};if(hs&&xs&&hs.length!==xs.length)throw new Error("Given keys array must have same length as given values array.");if(bs===0)return vs({numFailures:0,failures:{},results:[],lastResult:void 0});let Es;const Rs=[],ws=[];let Ns=0;const ks=Ls=>{++Ns,nn(Ls)};if(ps==="deleteRange"){if(ys.type===4)return vs({numFailures:Ns,failures:ws,results:[],lastResult:void 0});ys.type===3?Rs.push(Es=fs.clear()):Rs.push(Es=fs.delete(rs(ys)))}else{const[Ls,Os]=Ss?js?[xs,hs]:[xs,null]:[hs,null];if(Ss)for(let zs=0;zs<bs;++zs)Rs.push(Es=Os&&Os[zs]!==void 0?fs[ps](Ls[zs],Os[zs]):fs[ps](Ls[zs])),Es.onerror=ks;else for(let zs=0;zs<bs;++zs)Rs.push(Es=fs[ps](Ls[zs])),Es.onerror=ks}const _s=Ls=>{const Os=Ls.target.result;Rs.forEach((zs,qs)=>zs.error!=null&&(ws[qs]=zs.error)),vs({numFailures:Ns,failures:ws,results:ps==="delete"?hs:Rs.map(zs=>zs.result),lastResult:Os})};Es.onerror=Ls=>{ks(Ls),_s(Ls)},Es.onsuccess=_s})},getMany:({trans:ms,keys:ps})=>new Promise((hs,xs)=>{hs=Ye(hs);const ys=ms.objectStore(ds),vs=ps.length,gs=new Array(vs);let fs,js=0,Ss=0;const bs=Rs=>{const ws=Rs.target;gs[ws._pos]=ws.result,++Ss===js&&hs(gs)},Es=tn(xs);for(let Rs=0;Rs<vs;++Rs)ps[Rs]!=null&&(fs=ys.get(ps[Rs]),fs._pos=Rs,fs.onsuccess=bs,fs.onerror=Es,++js);js===0&&hs(gs)}),get:({trans:ms,key:ps})=>new Promise((hs,xs)=>{hs=Ye(hs);const ys=ms.objectStore(ds).get(ps);ys.onsuccess=vs=>hs(vs.target.result),ys.onerror=tn(xs)}),query:function(ms){return ps=>new Promise((hs,xs)=>{hs=Ye(hs);const{trans:ys,values:vs,limit:gs,query:fs}=ps,js=gs===1/0?void 0:gs,{index:Ss,range:bs}=fs,Es=ys.objectStore(ds),Rs=Ss.isPrimaryKey?Es:Es.index(Ss.name),ws=rs(bs);if(gs===0)return hs({result:[]});if(ms){const Ns=vs?Rs.getAll(ws,js):Rs.getAllKeys(ws,js);Ns.onsuccess=ks=>hs({result:ks.target.result}),Ns.onerror=tn(xs)}else{let Ns=0;const ks=vs||!("openKeyCursor"in Rs)?Rs.openCursor(ws):Rs.openKeyCursor(ws),_s=[];ks.onsuccess=Ls=>{const Os=ks.result;return Os?(_s.push(vs?Os.value:Os.primaryKey),++Ns===gs?hs({result:_s}):void Os.continue()):hs({result:_s})},ks.onerror=tn(xs)}})}(os),openCursor:function({trans:ms,values:ps,query:hs,reverse:xs,unique:ys}){return new Promise((vs,gs)=>{vs=Ye(vs);const{index:fs,range:js}=hs,Ss=ms.objectStore(ds),bs=fs.isPrimaryKey?Ss:Ss.index(fs.name),Es=xs?ys?"prevunique":"prev":ys?"nextunique":"next",Rs=ps||!("openKeyCursor"in bs)?bs.openCursor(rs(js),Es):bs.openKeyCursor(rs(js),Es);Rs.onerror=tn(gs),Rs.onsuccess=Ye(ws=>{const Ns=Rs.result;if(!Ns)return void vs(null);Ns.___id=++pn,Ns.done=!1;const ks=Ns.continue.bind(Ns);let _s=Ns.continuePrimaryKey;_s&&(_s=_s.bind(Ns));const Ls=Ns.advance.bind(Ns),Os=()=>{throw new Error("Cursor not stopped")};Ns.trans=ms,Ns.stop=Ns.continue=Ns.continuePrimaryKey=Ns.advance=()=>{throw new Error("Cursor not started")},Ns.fail=Ye(gs),Ns.next=function(){let zs=1;return this.start(()=>zs--?this.continue():this.stop()).then(()=>this)},Ns.start=zs=>{const qs=new Promise((Ys,Ws)=>{Ys=Ye(Ys),Rs.onerror=tn(Ws),Ns.fail=Ws,Ns.stop=Is=>{Ns.stop=Ns.continue=Ns.continuePrimaryKey=Ns.advance=Os,Ys(Is)}}),Qs=()=>{if(Rs.result)try{zs()}catch(Ys){Ns.fail(Ys)}else Ns.done=!0,Ns.start=()=>{throw new Error("Cursor behind last entry")},Ns.stop()};return Rs.onsuccess=Ye(Ys=>{Rs.onsuccess=Qs,Qs()}),Ns.continue=ks,Ns.continuePrimaryKey=_s,Ns.advance=Ls,Qs(),qs},vs(Ns)},gs)})},count({query:ms,trans:ps}){const{index:hs,range:xs}=ms;return new Promise((ys,vs)=>{const gs=ps.objectStore(ds),fs=hs.isPrimaryKey?gs:gs.index(hs.name),js=rs(xs),Ss=js?fs.count(js):fs.count();Ss.onsuccess=Ye(bs=>ys(bs.target.result)),Ss.onerror=tn(vs)})}}}(cs)),ls={};return as.forEach(cs=>ls[cs.name]=cs),{stack:"dbcore",transaction:es.transaction.bind(es),table(cs){if(!ls[cs])throw new Error(`Table '${cs}' not found`);return ls[cs]},MIN_KEY:-1/0,MAX_KEY:hn(ts),schema:ns}}function vn({_novip:es},ts){const ss=ts.db,rs=function(ns,os,{IDBKeyRange:as,indexedDB:ls},cs){return{dbcore:function(ds,ms){return ms.reduce((ps,{create:hs})=>({...ps,...hs(ps)}),ds)}(mn(os,as,cs),ns.dbcore)}}(es._middlewares,ss,es._deps,ts);es.core=rs.dbcore,es.tables.forEach(ns=>{const os=ns.name;es.core.schema.tables.some(as=>as.name===os)&&(ns.core=es.core.table(os),es[os]instanceof es.Table&&(es[os].core=ns.core))})}function gn({_novip:es},ts,ss,rs){ss.forEach(ns=>{const os=rs[ns];ts.forEach(as=>{const ls=d(as,ns);(!ls||"value"in ls&&ls.value===void 0)&&(as===es.Transaction.prototype||as instanceof es.Transaction?l(as,ns,{get(){return this.table(ns)},set(cs){u(this,ns,{value:cs,writable:!0,configurable:!0,enumerable:!0})}}):as[ns]=new es.Table(ns,os))})})}function bn({_novip:es},ts){ts.forEach(ss=>{for(let rs in ss)ss[rs]instanceof es.Table&&delete ss[rs]})}function _n(es,ts){return es._cfg.version-ts._cfg.version}function wn(es,ts,ss,rs){const ns=es._dbSchema,os=es._createTransaction("readwrite",es._storeNames,ns);os.create(ss),os._completion.catch(rs);const as=os._reject.bind(os),ls=Oe.transless||Oe;Ze(()=>{Oe.trans=os,Oe.transless=ls,ts===0?(t(ns).forEach(cs=>{kn(ss,cs,ns[cs].primKey,ns[cs].indexes)}),vn(es,ss),je.follow(()=>es.on.populate.fire(os)).catch(as)):function({_novip:cs},us,ds,ms){const ps=[],hs=cs._versions;let xs=cs._dbSchema=Pn(cs,cs.idbdb,ms),ys=!1;const vs=hs.filter(fs=>fs._cfg.version>=us);function gs(){return ps.length?je.resolve(ps.shift()(ds.idbtrans)).then(gs):je.resolve()}return vs.forEach(fs=>{ps.push(()=>{const js=xs,Ss=fs._cfg.dbschema;Kn(cs,js,ms),Kn(cs,Ss,ms),xs=cs._dbSchema=Ss;const bs=xn(js,Ss);bs.add.forEach(Rs=>{kn(ms,Rs[0],Rs[1].primKey,Rs[1].indexes)}),bs.change.forEach(Rs=>{if(Rs.recreate)throw new X.Upgrade("Not yet support for changing primary key");{const ws=ms.objectStore(Rs.name);Rs.add.forEach(Ns=>En(ws,Ns)),Rs.change.forEach(Ns=>{ws.deleteIndex(Ns.name),En(ws,Ns)}),Rs.del.forEach(Ns=>ws.deleteIndex(Ns))}});const Es=fs._cfg.contentUpgrade;if(Es&&fs._cfg.version>us){vn(cs,ms),ds._memoizedTables={},ys=!0;let Rs=w(Ss);bs.del.forEach(_s=>{Rs[_s]=js[_s]}),bn(cs,[cs.Transaction.prototype]),gn(cs,[cs.Transaction.prototype],t(Rs),Rs),ds.schema=Rs;const ws=T(Es);let Ns;ws&&et();const ks=je.follow(()=>{if(Ns=Es(ds),Ns&&ws){var _s=tt.bind(null,null);Ns.then(_s,_s)}});return Ns&&typeof Ns.then=="function"?je.resolve(Ns):ks.then(()=>Ns)}}),ps.push(js=>{(!ys||!xt)&&function(Ss,bs){[].slice.call(bs.db.objectStoreNames).forEach(Es=>Ss[Es]==null&&bs.db.deleteObjectStore(Es))}(fs._cfg.dbschema,js),bn(cs,[cs.Transaction.prototype]),gn(cs,[cs.Transaction.prototype],cs._storeNames,cs._dbSchema),ds.schema=cs._dbSchema})}),gs().then(()=>{var fs,js;js=ms,t(fs=xs).forEach(Ss=>{js.db.objectStoreNames.contains(Ss)||kn(js,Ss,fs[Ss].primKey,fs[Ss].indexes)})})}(es,ts,os,ss).catch(as)})}function xn(es,ts){const ss={del:[],add:[],change:[]};let rs;for(rs in es)ts[rs]||ss.del.push(rs);for(rs in ts){const ns=es[rs],os=ts[rs];if(ns){const as={name:rs,def:os,recreate:!1,del:[],add:[],change:[]};if(""+(ns.primKey.keyPath||"")!=""+(os.primKey.keyPath||"")||ns.primKey.auto!==os.primKey.auto&&!wt)as.recreate=!0,ss.change.push(as);else{const ls=ns.idxByName,cs=os.idxByName;let us;for(us in ls)cs[us]||as.del.push(us);for(us in cs){const ds=ls[us],ms=cs[us];ds?ds.src!==ms.src&&as.change.push(ms):as.add.push(ms)}(as.del.length>0||as.add.length>0||as.change.length>0)&&ss.change.push(as)}}else ss.add.push([rs,os])}return ss}function kn(es,ts,ss,rs){const ns=es.db.createObjectStore(ts,ss.keyPath?{keyPath:ss.keyPath,autoIncrement:ss.auto}:{autoIncrement:ss.auto});return rs.forEach(os=>En(ns,os)),ns}function En(es,ts){es.createIndex(ts.name,ts.keyPath,{unique:ts.unique,multiEntry:ts.multi})}function Pn(es,ts,ss){const rs={};return p(ts.objectStoreNames,0).forEach(ns=>{const os=ss.objectStore(ns);let as=os.keyPath;const ls=un(ln(as),as||"",!1,!1,!!os.autoIncrement,as&&typeof as!="string",!0),cs=[];for(let ds=0;ds<os.indexNames.length;++ds){const ms=os.index(os.indexNames[ds]);as=ms.keyPath;var us=un(ms.name,as,!!ms.unique,!!ms.multiEntry,!1,as&&typeof as!="string",!1);cs.push(us)}rs[ns]=cn(ns,ls,cs)}),rs}function Kn({_novip:es},ts,ss){const rs=ss.db.objectStoreNames;for(let ns=0;ns<rs.length;++ns){const os=rs[ns],as=ss.objectStore(os);es._hasGetAll="getAll"in as;for(let ls=0;ls<as.indexNames.length;++ls){const cs=as.indexNames[ls],us=as.index(cs).keyPath,ds=typeof us=="string"?us:"["+p(us).join("+")+"]";if(ts[os]){const ms=ts[os].idxByName[ds];ms&&(ms.name=cs,delete ts[os].idxByName[ds],ts[os].idxByName[cs]=ms)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&e.WorkerGlobalScope&&e instanceof e.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(es._hasGetAll=!1)}class On{_parseStoresSpec(ts,ss){t(ts).forEach(rs=>{if(ts[rs]!==null){var ns=ts[rs].split(",").map((as,ls)=>{const cs=(as=as.trim()).replace(/([&*]|\+\+)/g,""),us=/^\[/.test(cs)?cs.match(/^\[(.*)\]$/)[1].split("+"):cs;return un(cs,us||null,/\&/.test(as),/\*/.test(as),/\+\+/.test(as),n(us),ls===0)}),os=ns.shift();if(os.multi)throw new X.Schema("Primary key cannot be multi-valued");ns.forEach(as=>{if(as.auto)throw new X.Schema("Only primary key can be marked as autoIncrement (++)");if(!as.keyPath)throw new X.Schema("Index must have a name and cannot be an empty string")}),ss[rs]=cn(rs,os,ns)}})}stores(ts){const ss=this.db;this._cfg.storesSource=this._cfg.storesSource?r$1(this._cfg.storesSource,ts):ts;const rs=ss._versions,ns={};let os={};return rs.forEach(as=>{r$1(ns,as._cfg.storesSource),os=as._cfg.dbschema={},as._parseStoresSpec(ns,os)}),ss._dbSchema=os,bn(ss,[ss._allTables,ss,ss.Transaction.prototype]),gn(ss,[ss._allTables,ss,ss.Transaction.prototype,this._cfg.tables],t(os),os),ss._storeNames=t(os),this}upgrade(ts){return this._cfg.contentUpgrade=ue(this._cfg.contentUpgrade||ee,ts),this}}function Sn(es,ts){let ss=es._dbNamesDB;return ss||(ss=es._dbNamesDB=new Xn(Pt,{addons:[],indexedDB:es,IDBKeyRange:ts}),ss.version(1).stores({dbnames:"name"})),ss.table("dbnames")}function An(es){return es&&typeof es.databases=="function"}function Cn(es){return Ze(function(){return Oe.letThrough=!0,es()})}function jn(){var es;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(ts){var ss=function(){return indexedDB.databases().finally(ts)};es=setInterval(ss,100),ss()}).finally(function(){return clearInterval(es)}):Promise.resolve()}function Dn(es){const ts=es._state,{indexedDB:ss}=es._deps;if(ts.isBeingOpened||es.idbdb)return ts.dbReadyPromise.then(()=>ts.dbOpenError?ft(ts.dbOpenError):es);R&&(ts.openCanceller._stackHolder=q()),ts.isBeingOpened=!0,ts.dbOpenError=null,ts.openComplete=!1;const rs=ts.openCanceller;function ns(){if(ts.openCanceller!==rs)throw new X.DatabaseClosed("db.open() was cancelled")}let os=ts.dbReadyResolve,as=null,ls=!1;const cs=()=>new je((us,ds)=>{if(ns(),!ss)throw new X.MissingAPI;const ms=es.name,ps=ts.autoSchema?ss.open(ms):ss.open(ms,Math.round(10*es.verno));if(!ps)throw new X.MissingAPI;ps.onerror=tn(ds),ps.onblocked=Ye(es._fireOnBlocked),ps.onupgradeneeded=Ye(hs=>{if(as=ps.transaction,ts.autoSchema&&!es._options.allowEmptyDB){ps.onerror=nn,as.abort(),ps.result.close();const ys=ss.deleteDatabase(ms);ys.onsuccess=ys.onerror=Ye(()=>{ds(new X.NoSuchDatabase(`Database ${ms} doesnt exist`))})}else{as.onerror=tn(ds);var xs=hs.oldVersion>Math.pow(2,62)?0:hs.oldVersion;ls=xs<1,es._novip.idbdb=ps.result,wn(es,xs/10,as,ds)}},ds),ps.onsuccess=Ye(()=>{as=null;const hs=es._novip.idbdb=ps.result,xs=p(hs.objectStoreNames);if(xs.length>0)try{const vs=hs.transaction((ys=xs).length===1?ys[0]:ys,"readonly");ts.autoSchema?function({_novip:gs},fs,js){gs.verno=fs.version/10;const Ss=gs._dbSchema=Pn(0,fs,js);gs._storeNames=p(fs.objectStoreNames,0),gn(gs,[gs._allTables],t(Ss),Ss)}(es,hs,vs):(Kn(es,es._dbSchema,vs),function(gs,fs){const js=xn(Pn(0,gs.idbdb,fs),gs._dbSchema);return!(js.add.length||js.change.some(Ss=>Ss.add.length||Ss.change.length))}(es,vs)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),vn(es,vs)}catch{}var ys;_t.push(es),hs.onversionchange=Ye(vs=>{ts.vcFired=!0,es.on("versionchange").fire(vs)}),hs.onclose=Ye(vs=>{es.on("close").fire(vs)}),ls&&function({indexedDB:vs,IDBKeyRange:gs},fs){!An(vs)&&fs!==Pt&&Sn(vs,gs).put({name:fs}).catch(ee)}(es._deps,ms),us()},ds)}).catch(us=>us&&us.name==="UnknownError"&&ts.PR1398_maxLoop>0?(ts.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),cs()):je.reject(us));return je.race([rs,(typeof navigator>"u"?je.resolve():jn()).then(cs)]).then(()=>(ns(),ts.onReadyBeingFired=[],je.resolve(Cn(()=>es.on.ready.fire(es.vip))).then(function us(){if(ts.onReadyBeingFired.length>0){let ds=ts.onReadyBeingFired.reduce(ue,ee);return ts.onReadyBeingFired=[],je.resolve(Cn(()=>ds(es.vip))).then(us)}}))).finally(()=>{ts.onReadyBeingFired=null,ts.isBeingOpened=!1}).then(()=>es).catch(us=>{ts.dbOpenError=us;try{as&&as.abort()}catch{}return rs===ts.openCanceller&&es._close(),ft(us)}).finally(()=>{ts.openComplete=!0,os()})}function In(es){var ts=os=>es.next(os),ss=ns(ts),rs=ns(os=>es.throw(os));function ns(os){return as=>{var ls=os(as),cs=ls.value;return ls.done?cs:cs&&typeof cs.then=="function"?cs.then(ss,rs):n(cs)?Promise.all(cs).then(ss,rs):ss(cs)}}return ns(ts)()}function Bn(es,ts,ss){var rs=arguments.length;if(rs<2)throw new X.InvalidArgument("Too few arguments");for(var ns=new Array(rs-1);--rs;)ns[rs-1]=arguments[rs];return ss=ns.pop(),[es,k(ns),ss]}function Tn(es,ts,ss,rs,ns){return je.resolve().then(()=>{const os=Oe.transless||Oe,as=es._createTransaction(ts,ss,es._dbSchema,rs),ls={trans:as,transless:os};if(rs)as.idbtrans=rs.idbtrans;else try{as.create(),es._state.PR1398_maxLoop=3}catch(ms){return ms.name===H.InvalidState&&es.isOpen()&&--es._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),es._close(),es.open().then(()=>Tn(es,ts,ss,null,ns))):ft(ms)}const cs=T(ns);let us;cs&&et();const ds=je.follow(()=>{if(us=ns.call(as,as),us)if(cs){var ms=tt.bind(null,null);us.then(ms,ms)}else typeof us.next=="function"&&typeof us.throw=="function"&&(us=In(us))},ls);return(us&&typeof us.then=="function"?je.resolve(us).then(ms=>as.active?ms:ft(new X.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):ds.then(()=>us)).then(ms=>(rs&&as._resolve(),as._completion.then(()=>ms))).catch(ms=>(as._reject(ms),ft(ms)))})}function Rn(es,ts,ss){const rs=n(es)?es.slice():[es];for(let ns=0;ns<ss;++ns)rs.push(ts);return rs}const Fn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(es){return{...es,table(ts){const ss=es.table(ts),{schema:rs}=ss,ns={},os=[];function as(ds,ms,ps){const hs=yn(ds),xs=ns[hs]=ns[hs]||[],ys=ds==null?0:typeof ds=="string"?1:ds.length,vs=ms>0,gs={...ps,isVirtual:vs,keyTail:ms,keyLength:ys,extractKey:dn(ds),unique:!vs&&ps.unique};return xs.push(gs),gs.isPrimaryKey||os.push(gs),ys>1&&as(ys===2?ds[0]:ds.slice(0,ys-1),ms+1,ps),xs.sort((fs,js)=>fs.keyTail-js.keyTail),gs}const ls=as(rs.primaryKey.keyPath,0,rs.primaryKey);ns[":id"]=[ls];for(const ds of rs.indexes)as(ds.keyPath,0,ds);function cs(ds){const ms=ds.query.index;return ms.isVirtual?{...ds,query:{index:ms,range:(ps=ds.query.range,hs=ms.keyTail,{type:ps.type===1?2:ps.type,lower:Rn(ps.lower,ps.lowerOpen?es.MAX_KEY:es.MIN_KEY,hs),lowerOpen:!0,upper:Rn(ps.upper,ps.upperOpen?es.MIN_KEY:es.MAX_KEY,hs),upperOpen:!0})}}:ds;var ps,hs}return{...ss,schema:{...rs,primaryKey:ls,indexes:os,getIndexByKeyPath:function(ds){const ms=ns[yn(ds)];return ms&&ms[0]}},count:ds=>ss.count(cs(ds)),query:ds=>ss.query(cs(ds)),openCursor(ds){const{keyTail:ms,isVirtual:ps,keyLength:hs}=ds.query.index;return ps?ss.openCursor(cs(ds)).then(xs=>xs&&function(ys){return Object.create(ys,{continue:{value:function(gs){gs!=null?ys.continue(Rn(gs,ds.reverse?es.MAX_KEY:es.MIN_KEY,ms)):ds.unique?ys.continue(ys.key.slice(0,hs).concat(ds.reverse?es.MIN_KEY:es.MAX_KEY,ms)):ys.continue()}},continuePrimaryKey:{value(gs,fs){ys.continuePrimaryKey(Rn(gs,es.MAX_KEY,ms),fs)}},primaryKey:{get:()=>ys.primaryKey},key:{get(){const gs=ys.key;return hs===1?gs[0]:gs.slice(0,hs)}},value:{get:()=>ys.value}})}(xs)):ss.openCursor(ds)}}}}}};function Mn(es,ts,ss,rs){return ss=ss||{},rs=rs||"",t(es).forEach(ns=>{if(o(ts,ns)){var os=es[ns],as=ts[ns];if(typeof os=="object"&&typeof as=="object"&&os&&as){const ls=C(os);ls!==C(as)?ss[rs+ns]=ts[ns]:ls==="Object"?Mn(os,as,ss,rs+ns+"."):os!==as&&(ss[rs+ns]=ts[ns])}else os!==as&&(ss[rs+ns]=ts[ns])}else ss[rs+ns]=void 0}),t(ts).forEach(ns=>{o(es,ns)||(ss[rs+ns]=ts[ns])}),ss}const Nn={stack:"dbcore",name:"HooksMiddleware",level:2,create:es=>({...es,table(ts){const ss=es.table(ts),{primaryKey:rs}=ss.schema;return{...ss,mutate(os){const as=Oe.trans,{deleting:ls,creating:cs,updating:us}=as.table(ts).hook;switch(os.type){case"add":if(cs.fire===ee)break;return as._promise("readwrite",()=>ds(os),!0);case"put":if(cs.fire===ee&&us.fire===ee)break;return as._promise("readwrite",()=>ds(os),!0);case"delete":if(ls.fire===ee)break;return as._promise("readwrite",()=>ds(os),!0);case"deleteRange":if(ls.fire===ee)break;return as._promise("readwrite",()=>function(ps){return ms(ps.trans,ps.range,1e4)}(os),!0)}return ss.mutate(os);function ds(ps){const hs=Oe.trans,xs=ps.keys||function(ys,vs){return vs.type==="delete"?vs.keys:vs.keys||vs.values.map(ys.extractKey)}(rs,ps);if(!xs)throw new Error("Keys missing");return(ps=ps.type==="add"||ps.type==="put"?{...ps,keys:xs}:{...ps}).type!=="delete"&&(ps.values=[...ps.values]),ps.keys&&(ps.keys=[...ps.keys]),function(ys,vs,gs){return vs.type==="add"?Promise.resolve([]):ys.getMany({trans:vs.trans,keys:gs,cache:"immutable"})}(ss,ps,xs).then(ys=>{const vs=xs.map((gs,fs)=>{const js=ys[fs],Ss={onerror:null,onsuccess:null};if(ps.type==="delete")ls.fire.call(Ss,gs,js,hs);else if(ps.type==="add"||js===void 0){const bs=cs.fire.call(Ss,gs,ps.values[fs],hs);gs==null&&bs!=null&&(gs=bs,ps.keys[fs]=gs,rs.outbound||_(ps.values[fs],rs.keyPath,gs))}else{const bs=Mn(js,ps.values[fs]),Es=us.fire.call(Ss,bs,gs,js,hs);if(Es){const Rs=ps.values[fs];Object.keys(Es).forEach(ws=>{o(Rs,ws)?Rs[ws]=Es[ws]:_(Rs,ws,Es[ws])})}}return Ss});return ss.mutate(ps).then(({failures:gs,results:fs,numFailures:js,lastResult:Ss})=>{for(let bs=0;bs<xs.length;++bs){const Es=fs?fs[bs]:xs[bs],Rs=vs[bs];Es==null?Rs.onerror&&Rs.onerror(gs[bs]):Rs.onsuccess&&Rs.onsuccess(ps.type==="put"&&ys[bs]?ps.values[bs]:Es)}return{failures:gs,results:fs,numFailures:js,lastResult:Ss}}).catch(gs=>(vs.forEach(fs=>fs.onerror&&fs.onerror(gs)),Promise.reject(gs)))})}function ms(ps,hs,xs){return ss.query({trans:ps,values:!1,query:{index:rs,range:hs},limit:xs}).then(({result:ys})=>ds({type:"delete",keys:ys,trans:ps}).then(vs=>vs.numFailures>0?Promise.reject(vs.failures[0]):ys.length<xs?{failures:[],numFailures:0,lastResult:void 0}:ms(ps,{...hs,lower:ys[ys.length-1],lowerOpen:!0},xs)))}}}}})};function qn(es,ts,ss){try{if(!ts||ts.keys.length<es.length)return null;const rs=[];for(let ns=0,os=0;ns<ts.keys.length&&os<es.length;++ns)$t(ts.keys[ns],es[os])===0&&(rs.push(ss?O(ts.values[ns]):ts.values[ns]),++os);return rs.length===es.length?rs:null}catch{return null}}const $n={stack:"dbcore",level:-1,create:es=>({table:ts=>{const ss=es.table(ts);return{...ss,getMany:rs=>{if(!rs.cache)return ss.getMany(rs);const ns=qn(rs.keys,rs.trans._cache,rs.cache==="clone");return ns?je.resolve(ns):ss.getMany(rs).then(os=>(rs.trans._cache={keys:rs.keys,values:rs.cache==="clone"?O(os):os},os))},mutate:rs=>(rs.type!=="add"&&(rs.trans._cache=null),ss.mutate(rs))}}})};function Un(es){return!("from"in es)}const Ln=function(es,ts){if(!this){const ss=new Ln;return es&&"d"in es&&r$1(ss,es),ss}r$1(this,arguments.length?{d:1,from:es,to:arguments.length>1?ts:es}:{d:0})};function Vn(es,ts,ss){const rs=$t(ts,ss);if(isNaN(rs))return;if(rs>0)throw RangeError();if(Un(es))return r$1(es,{from:ts,to:ss,d:1});const ns=es.l,os=es.r;if($t(ss,es.from)<0)return ns?Vn(ns,ts,ss):es.l={from:ts,to:ss,d:1,l:null,r:null},Gn(es);if($t(ts,es.to)>0)return os?Vn(os,ts,ss):es.r={from:ts,to:ss,d:1,l:null,r:null},Gn(es);$t(ts,es.from)<0&&(es.from=ts,es.l=null,es.d=os?os.d+1:1),$t(ss,es.to)>0&&(es.to=ss,es.r=null,es.d=es.l?es.l.d+1:1);const as=!es.r;ns&&!es.l&&Wn(es,ns),os&&as&&Wn(es,os)}function Wn(es,ts){Un(ts)||function ss(rs,{from:ns,to:os,l:as,r:ls}){Vn(rs,ns,os),as&&ss(rs,as),ls&&ss(rs,ls)}(es,ts)}function Yn(es,ts){const ss=zn(ts);let rs=ss.next();if(rs.done)return!1;let ns=rs.value;const os=zn(es);let as=os.next(ns.from),ls=as.value;for(;!rs.done&&!as.done;){if($t(ls.from,ns.to)<=0&&$t(ls.to,ns.from)>=0)return!0;$t(ns.from,ls.from)<0?ns=(rs=ss.next(ls.from)).value:ls=(as=os.next(ns.from)).value}return!1}function zn(es){let ts=Un(es)?null:{s:0,n:es};return{next(ss){const rs=arguments.length>0;for(;ts;)switch(ts.s){case 0:if(ts.s=1,rs)for(;ts.n.l&&$t(ss,ts.n.from)<0;)ts={up:ts,n:ts.n.l,s:1};else for(;ts.n.l;)ts={up:ts,n:ts.n.l,s:1};case 1:if(ts.s=2,!rs||$t(ss,ts.n.to)<=0)return{value:ts.n,done:!1};case 2:if(ts.n.r){ts.s=3,ts={up:ts,n:ts.n.r,s:0};continue}case 3:ts=ts.up}return{done:!0}}}}function Gn(es){var ts,ss;const rs=(((ts=es.r)===null||ts===void 0?void 0:ts.d)||0)-(((ss=es.l)===null||ss===void 0?void 0:ss.d)||0),ns=rs>1?"r":rs<-1?"l":"";if(ns){const os=ns==="r"?"l":"r",as={...es},ls=es[ns];es.from=ls.from,es.to=ls.to,es[ns]=ls[ns],as[ns]=ls[os],es[os]=as,as.d=Hn(as)}es.d=Hn(es)}function Hn({r:es,l:ts}){return(es?ts?Math.max(es.d,ts.d):es.d:ts?ts.d:0)+1}a(Ln.prototype,{add(es){return Wn(this,es),this},addKey(es){return Vn(this,es,es),this},addKeys(es){return es.forEach(ts=>Vn(this,ts,ts)),this},[j](){return zn(this)}});const Qn={stack:"dbcore",level:0,create:es=>{const ts=es.schema.name,ss=new Ln(es.MIN_KEY,es.MAX_KEY);return{...es,table:rs=>{const ns=es.table(rs),{schema:os}=ns,{primaryKey:as}=os,{extractKey:ls,outbound:cs}=as,us={...ns,mutate:ps=>{const hs=ps.trans,xs=hs.mutatedParts||(hs.mutatedParts={}),ys=Es=>{const Rs=`idb://${ts}/${rs}/${Es}`;return xs[Rs]||(xs[Rs]=new Ln)},vs=ys(""),gs=ys(":dels"),{type:fs}=ps;let[js,Ss]=ps.type==="deleteRange"?[ps.range]:ps.type==="delete"?[ps.keys]:ps.values.length<50?[[],ps.values]:[];const bs=ps.trans._cache;return ns.mutate(ps).then(Es=>{if(n(js)){fs!=="delete"&&(js=Es.results),vs.addKeys(js);const Rs=qn(js,bs);Rs||fs==="add"||gs.addKeys(js),(Rs||Ss)&&function(ws,Ns,ks,_s){function Ls(Os){const zs=ws(Os.name||"");function qs(Ys){return Ys!=null?Os.extractKey(Ys):null}const Qs=Ys=>Os.multiEntry&&n(Ys)?Ys.forEach(Ws=>zs.addKey(Ws)):zs.addKey(Ys);(ks||_s).forEach((Ys,Ws)=>{const Is=ks&&qs(ks[Ws]),Bs=_s&&qs(_s[Ws]);$t(Is,Bs)!==0&&(Is!=null&&Qs(Is),Bs!=null&&Qs(Bs))})}Ns.indexes.forEach(Ls)}(ys,os,Rs,Ss)}else if(js){const Rs={from:js.lower,to:js.upper};gs.add(Rs),vs.add(Rs)}else vs.add(ss),gs.add(ss),os.indexes.forEach(Rs=>ys(Rs.name).add(ss));return Es})}},ds=({query:{index:ps,range:hs}})=>{var xs,ys;return[ps,new Ln((xs=hs.lower)!==null&&xs!==void 0?xs:es.MIN_KEY,(ys=hs.upper)!==null&&ys!==void 0?ys:es.MAX_KEY)]},ms={get:ps=>[as,new Ln(ps.key)],getMany:ps=>[as,new Ln().addKeys(ps.keys)],count:ds,query:ds,openCursor:ds};return t(ms).forEach(ps=>{us[ps]=function(hs){const{subscr:xs}=Oe;if(xs){const ys=Ss=>{const bs=`idb://${ts}/${rs}/${Ss}`;return xs[bs]||(xs[bs]=new Ln)},vs=ys(""),gs=ys(":dels"),[fs,js]=ms[ps](hs);if(ys(fs.name||"").add(js),!fs.isPrimaryKey){if(ps!=="count"){const Ss=ps==="query"&&cs&&hs.values&&ns.query({...hs,values:!1});return ns[ps].apply(this,arguments).then(bs=>{if(ps==="query"){if(cs&&hs.values)return Ss.then(({result:Rs})=>(vs.addKeys(Rs),bs));const Es=hs.values?bs.result.map(ls):bs.result;hs.values?vs.addKeys(Es):gs.addKeys(Es)}else if(ps==="openCursor"){const Es=bs,Rs=hs.values;return Es&&Object.create(Es,{key:{get:()=>(gs.addKey(Es.primaryKey),Es.key)},primaryKey:{get(){const ws=Es.primaryKey;return gs.addKey(ws),ws}},value:{get:()=>(Rs&&vs.addKey(Es.primaryKey),Es.value)}})}return bs})}gs.add(ss)}}return ns[ps].apply(this,arguments)}}),us}}}};class Xn{constructor(ts,ss){this._middlewares={},this.verno=0;const rs=Xn.dependencies;this._options=ss={addons:Xn.addons,autoOpen:!0,indexedDB:rs.indexedDB,IDBKeyRange:rs.IDBKeyRange,...ss},this._deps={indexedDB:ss.indexedDB,IDBKeyRange:ss.IDBKeyRange};const{addons:ns}=ss;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const os={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ee,dbReadyPromise:null,cancelOpen:ee,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var as;os.dbReadyPromise=new je(ls=>{os.dbReadyResolve=ls}),os.openCanceller=new je((ls,cs)=>{os.cancelOpen=cs}),this._state=os,this.name=ts,this.on=Dt(this,"populate","blocked","versionchange","close",{ready:[ue,ee]}),this.on.ready.subscribe=y(this.on.ready.subscribe,ls=>(cs,us)=>{Xn.vip(()=>{const ds=this._state;if(ds.openComplete)ds.dbOpenError||je.resolve().then(cs),us&&ls(cs);else if(ds.onReadyBeingFired)ds.onReadyBeingFired.push(cs),us&&ls(cs);else{ls(cs);const ms=this;us||ls(function ps(){ms.on.ready.unsubscribe(cs),ms.on.ready.unsubscribe(ps)})}})}),this.Collection=(as=this,It(Vt.prototype,function(ls,cs){this.db=as;let us=At,ds=null;if(cs)try{us=cs()}catch(xs){ds=xs}const ms=ls._ctx,ps=ms.table,hs=ps.hook.reading.fire;this._ctx={table:ps,index:ms.index,isPrimKey:!ms.index||ps.schema.primKey.keyPath&&ms.index===ps.schema.primKey.name,range:us,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:ds,or:ms.or,valueMapper:hs!==te?hs:null}})),this.Table=function(ls){return It(jt.prototype,function(cs,us,ds){this.db=ls,this._tx=ds,this.name=cs,this.schema=us,this.hook=ls._allTables[cs]?ls._allTables[cs].hook:Dt(null,{creating:[se,ee],reading:[ne,te],updating:[oe,ee],deleting:[ie,ee]})})}(this),this.Transaction=function(ls){return It(an.prototype,function(cs,us,ds,ms,ps){this.db=ls,this.mode=cs,this.storeNames=us,this.schema=ds,this.chromeTransactionDurability=ms,this.idbtrans=null,this.on=Dt(this,"complete","error","abort"),this.parent=ps||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new je((hs,xs)=>{this._resolve=hs,this._reject=xs}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},hs=>{var xs=this.active;return this.active=!1,this.on.error.fire(hs),this.parent?this.parent._reject(hs):xs&&this.idbtrans&&this.idbtrans.abort(),ft(hs)})})}(this),this.Version=function(ls){return It(On.prototype,function(cs){this.db=ls,this._cfg={version:cs,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(ls){return It(en.prototype,function(cs,us,ds){this.db=ls,this._ctx={table:cs,index:us===":id"?null:us,or:ds};const ms=ls._deps.indexedDB;if(!ms)throw new X.MissingAPI;this._cmp=this._ascending=ms.cmp.bind(ms),this._descending=(ps,hs)=>ms.cmp(hs,ps),this._max=(ps,hs)=>ms.cmp(ps,hs)>0?ps:hs,this._min=(ps,hs)=>ms.cmp(ps,hs)<0?ps:hs,this._IDBKeyRange=ls._deps.IDBKeyRange})}(this),this.on("versionchange",ls=>{ls.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",ls=>{!ls.newVersion||ls.newVersion<ls.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${ls.oldVersion/10}`)}),this._maxKey=hn(ss.IDBKeyRange),this._createTransaction=(ls,cs,us,ds)=>new this.Transaction(ls,cs,us,this._options.chromeTransactionDurability,ds),this._fireOnBlocked=ls=>{this.on("blocked").fire(ls),_t.filter(cs=>cs.name===this.name&&cs!==this&&!cs._state.vcFired).map(cs=>cs.on("versionchange").fire(ls))},this.use(Fn),this.use(Nn),this.use(Qn),this.use($n),this.vip=Object.create(this,{_vip:{value:!0}}),ns.forEach(ls=>ls(this))}version(ts){if(isNaN(ts)||ts<.1)throw new X.Type("Given version is not a positive number");if(ts=Math.round(10*ts)/10,this.idbdb||this._state.isBeingOpened)throw new X.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,ts);const ss=this._versions;var rs=ss.filter(ns=>ns._cfg.version===ts)[0];return rs||(rs=new this.Version(ts),ss.push(rs),ss.sort(_n),rs.stores({}),this._state.autoSchema=!1,rs)}_whenReady(ts){return this.idbdb&&(this._state.openComplete||Oe.letThrough||this._vip)?ts():new je((ss,rs)=>{if(this._state.openComplete)return rs(new X.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void rs(new X.DatabaseClosed);this.open().catch(ee)}this._state.dbReadyPromise.then(ss,rs)}).then(ts)}use({stack:ts,create:ss,level:rs,name:ns}){ns&&this.unuse({stack:ts,name:ns});const os=this._middlewares[ts]||(this._middlewares[ts]=[]);return os.push({stack:ts,create:ss,level:rs??10,name:ns}),os.sort((as,ls)=>as.level-ls.level),this}unuse({stack:ts,name:ss,create:rs}){return ts&&this._middlewares[ts]&&(this._middlewares[ts]=this._middlewares[ts].filter(ns=>rs?ns.create!==rs:!!ss&&ns.name!==ss)),this}open(){return Dn(this)}_close(){const ts=this._state,ss=_t.indexOf(this);if(ss>=0&&_t.splice(ss,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}ts.dbReadyPromise=new je(rs=>{ts.dbReadyResolve=rs}),ts.openCanceller=new je((rs,ns)=>{ts.cancelOpen=ns})}close(){this._close();const ts=this._state;this._options.autoOpen=!1,ts.dbOpenError=new X.DatabaseClosed,ts.isBeingOpened&&ts.cancelOpen(ts.dbOpenError)}delete(){const ts=arguments.length>0,ss=this._state;return new je((rs,ns)=>{const os=()=>{this.close();var as=this._deps.indexedDB.deleteDatabase(this.name);as.onsuccess=Ye(()=>{(function({indexedDB:ls,IDBKeyRange:cs},us){!An(ls)&&us!==Pt&&Sn(ls,cs).delete(us).catch(ee)})(this._deps,this.name),rs()}),as.onerror=tn(ns),as.onblocked=this._fireOnBlocked};if(ts)throw new X.InvalidArgument("Arguments not allowed in db.delete()");ss.isBeingOpened?ss.dbReadyPromise.then(os):os()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const ts=this._state.dbOpenError;return ts&&ts.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return t(this._allTables).map(ts=>this._allTables[ts])}transaction(){const ts=Bn.apply(this,arguments);return this._transaction.apply(this,ts)}_transaction(ts,ss,rs){let ns=Oe.trans;ns&&ns.db===this&&ts.indexOf("!")===-1||(ns=null);const os=ts.indexOf("?")!==-1;let as,ls;ts=ts.replace("!","").replace("?","");try{if(ls=ss.map(us=>{var ds=us instanceof this.Table?us.name:us;if(typeof ds!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return ds}),ts=="r"||ts===Kt)as=Kt;else{if(ts!="rw"&&ts!=Ot)throw new X.InvalidArgument("Invalid transaction mode: "+ts);as=Ot}if(ns){if(ns.mode===Kt&&as===Ot){if(!os)throw new X.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");ns=null}ns&&ls.forEach(us=>{if(ns&&ns.storeNames.indexOf(us)===-1){if(!os)throw new X.SubTransaction("Table "+us+" not included in parent transaction.");ns=null}}),os&&ns&&!ns.active&&(ns=null)}}catch(us){return ns?ns._promise(null,(ds,ms)=>{ms(us)}):ft(us)}const cs=Tn.bind(null,this,as,ls,ns,rs);return ns?ns._promise(as,cs,"lock"):Oe.trans?at(Oe.transless,()=>this._whenReady(cs)):this._whenReady(cs)}table(ts){if(!o(this._allTables,ts))throw new X.InvalidTable(`Table ${ts} does not exist`);return this._allTables[ts]}}const Jn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Zn{constructor(ts){this._subscribe=ts}subscribe(ts,ss,rs){return this._subscribe(ts&&typeof ts!="function"?ts:{next:ts,error:ss,complete:rs})}[Jn](){return this}}function er(es,ts){return t(ts).forEach(ss=>{Wn(es[ss]||(es[ss]=new Ln),ts[ss])}),es}function tr(es){let ts,ss=!1;const rs=new Zn(ns=>{const os=T(es);let as=!1,ls={},cs={};const us={get closed(){return as},unsubscribe:()=>{as=!0,on.storagemutated.unsubscribe(hs)}};ns.start&&ns.start(us);let ds=!1,ms=!1;function ps(){return t(cs).some(ys=>ls[ys]&&Yn(ls[ys],cs[ys]))}const hs=ys=>{er(ls,ys),ps()&&xs()},xs=()=>{if(ds||as)return;ls={};const ys={},vs=function(gs){os&&et();const fs=()=>Ze(es,{subscr:gs,trans:null}),js=Oe.trans?at(Oe.transless,fs):fs();return os&&js.then(tt,tt),js}(ys);ms||(on(rn,hs),ms=!0),ds=!0,Promise.resolve(vs).then(gs=>{ss=!0,ts=gs,ds=!1,as||(ps()?xs():(ls={},cs=ys,ns.next&&ns.next(gs)))},gs=>{ds=!1,ss=!1,ns.error&&ns.error(gs),us.unsubscribe()})};return xs(),us});return rs.hasValue=()=>ss,rs.getValue=()=>ts,rs}let nr;try{nr={indexedDB:e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:e.IDBKeyRange||e.webkitIDBKeyRange}}catch{nr={indexedDB:null,IDBKeyRange:null}}const rr=Xn;function sr(es){let ts=ir;try{ir=!0,on.storagemutated.fire(es)}finally{ir=ts}}a(rr,{...Z,delete:es=>new rr(es,{addons:[]}).delete(),exists:es=>new rr(es,{addons:[]}).open().then(ts=>(ts.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(es){try{return function({indexedDB:ts,IDBKeyRange:ss}){return An(ts)?Promise.resolve(ts.databases()).then(rs=>rs.map(ns=>ns.name).filter(ns=>ns!==Pt)):Sn(ts,ss).toCollection().primaryKeys()}(rr.dependencies).then(es)}catch{return ft(new X.MissingAPI)}},defineClass:()=>function(es){r$1(this,es)},ignoreTransaction:es=>Oe.trans?at(Oe.transless,es):es(),vip:Cn,async:function(es){return function(){try{var ts=In(es.apply(this,arguments));return ts&&typeof ts.then=="function"?ts:je.resolve(ts)}catch(ss){return ft(ss)}}},spawn:function(es,ts,ss){try{var rs=In(es.apply(ss,ts||[]));return rs&&typeof rs.then=="function"?rs:je.resolve(rs)}catch(ns){return ft(ns)}},currentTransaction:{get:()=>Oe.trans||null},waitFor:function(es,ts){const ss=je.resolve(typeof es=="function"?rr.ignoreTransaction(es):es).timeout(ts||6e4);return Oe.trans?Oe.trans.waitFor(ss):ss},Promise:je,debug:{get:()=>R,set:es=>{F(es,es==="dexie"?()=>!0:Et)}},derive:c,extend:r$1,props:a,override:y,Events:Dt,on,liveQuery:tr,extendObservabilitySet:er,getByKeyPath:b,setByKeyPath:_,delByKeyPath:function(es,ts){typeof ts=="string"?_(es,ts,void 0):"length"in ts&&[].map.call(ts,function(ss){_(es,ss,void 0)})},shallowClone:w,deepClone:O,getObjectDiff:Mn,cmp:$t,asap:v,minKey:vt,addons:[],connections:_t,errnames:H,dependencies:nr,semVer:yt,version:yt.split(".").map(es=>parseInt(es)).reduce((es,ts,ss)=>es+ts/Math.pow(10,2*ss))}),rr.maxKey=hn(rr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(on(rn,es=>{if(!ir){let ts;wt?(ts=document.createEvent("CustomEvent"),ts.initCustomEvent(sn,!0,!0,es)):ts=new CustomEvent(sn,{detail:es}),ir=!0,dispatchEvent(ts),ir=!1}}),addEventListener(sn,({detail:es})=>{ir||sr(es)}));let ir=!1;if(typeof BroadcastChannel<"u"){const es=new BroadcastChannel(sn);typeof es.unref=="function"&&es.unref(),on(rn,ts=>{ir||es.postMessage(ts)}),es.onmessage=ts=>{ts.data&&sr(ts.data)}}else if(typeof self<"u"&&typeof navigator<"u"){on(rn,ts=>{try{ir||(typeof localStorage<"u"&&localStorage.setItem(sn,JSON.stringify({trig:Math.random(),changedParts:ts})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(ss=>ss.postMessage({type:sn,changedParts:ts})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",ts=>{if(ts.key===sn){const ss=JSON.parse(ts.newValue);ss&&sr(ss.changedParts)}});const es=self.document&&navigator.serviceWorker;es&&es.addEventListener("message",function({data:ts}){ts&&ts.type===sn&&sr(ts.changedParts)})}je.rejectionMapper=function(es,ts){if(!es||es instanceof W||es instanceof TypeError||es instanceof SyntaxError||!es.name||!J[es.name])return es;var ss=new J[es.name](ts||es.message,es);return"stack"in es&&l(ss,"stack",{get:function(){return this.inner.stack}}),ss},F(R,Et);class HairMakeupDB extends Xn{constructor(){super("HairMakeupProDB");eo(this,"projects");eo(this,"scenes");eo(this,"characters");eo(this,"looks");eo(this,"sceneCaptures");eo(this,"photoBlobs");eo(this,"storeBackups");this.version(1).stores({projects:"id, name, createdAt, updatedAt",scenes:"id, sceneNumber, slugline, isComplete",characters:"id, name",looks:"id, characterId, name",sceneCaptures:"id, sceneId, characterId, lookId, capturedAt",photos:"id, capturedAt, angle"}),this.version(2).stores({projects:"id, updatedAt",scenes:"id, sceneNumber, slugline, isComplete",characters:"id, name",looks:"id, characterId, name",sceneCaptures:"id, projectId, sceneId, characterId, updatedAt",photoBlobs:"id, capturedAt, angle",storeBackups:"id, updatedAt",photos:null}).upgrade(async()=>{console.log("Migrating database to version 2 with blob storage")})}}const db=new HairMakeupDB;async function savePhotoBlob(es,ts,ss,rs){return await db.photoBlobs.put({id:es,blob:ts,thumbnail:ss,capturedAt:new Date,angle:rs}),es}async function getPhotoBlob(es){return await db.photoBlobs.get(es)}async function saveStoreBackup(es,ts){await db.storeBackups.put({id:es,state:ts,updatedAt:new Date})}async function getStoreBackup(es){const ts=await db.storeBackups.get(es);return ts==null?void 0:ts.state}const debounceTimers={},pendingWrites={},DEBOUNCE_DELAY=500,INDEXEDDB_STORES=new Set(["hair-makeup-pro-storage","hair-makeup-callsheets","hair-makeup-schedule","hair-makeup-timesheet-storage"]);function debouncedWrite(es,ts,ss){pendingWrites[es]=ts,debounceTimers[es]&&clearTimeout(debounceTimers[es]),debounceTimers[es]=setTimeout(async()=>{const rs=pendingWrites[es];delete pendingWrites[es],delete debounceTimers[es];try{await ss(es,rs)}catch(ns){console.error(`Failed to write store ${es}:`,ns)}},DEBOUNCE_DELAY)}async function flushPendingWrites(){const es=[];for(const[ts,ss]of Object.entries(pendingWrites))if(debounceTimers[ts]&&(clearTimeout(debounceTimers[ts]),delete debounceTimers[ts]),INDEXEDDB_STORES.has(ts))es.push(saveStoreBackup(ts,ss).catch(rs=>console.error(`Failed to flush store ${ts}:`,rs)));else try{localStorage.setItem(ts,JSON.stringify(ss))}catch(rs){console.error(`Failed to flush store ${ts} to localStorage:`,rs)}Object.keys(pendingWrites).forEach(ts=>delete pendingWrites[ts]),await Promise.all(es)}function createHybridStorage(es){const ts=INDEXEDDB_STORES.has(es);return{getItem:async ss=>{if(ts)try{await db.open();const rs=await getStoreBackup(ss);if(rs)return rs;const ns=localStorage.getItem(ss);return ns?JSON.parse(ns):null}catch(rs){console.error(`Failed to read store ${ss} from IndexedDB:`,rs);const ns=localStorage.getItem(ss);return ns?JSON.parse(ns):null}else{const rs=localStorage.getItem(ss);return rs?JSON.parse(rs):null}},setItem:(ss,rs)=>{ts?debouncedWrite(ss,rs,async(ns,os)=>{try{localStorage.setItem(ns,JSON.stringify(os))}catch{}await saveStoreBackup(ns,os)}):debouncedWrite(ss,rs,async(ns,os)=>{localStorage.setItem(ns,JSON.stringify(os))})},removeItem:async ss=>{if(debounceTimers[ss]&&(clearTimeout(debounceTimers[ss]),delete debounceTimers[ss]),delete pendingWrites[ss],ts)try{await db.storeBackups.delete(ss)}catch(rs){console.error(`Failed to remove store ${ss} from IndexedDB:`,rs)}localStorage.removeItem(ss)}}}async function migrateToIndexedDB(){const es=[],ts=[];await db.open();for(const ss of INDEXEDDB_STORES)try{const rs=localStorage.getItem(ss);if(rs&&!await getStoreBackup(ss)){const os=JSON.parse(rs);await saveStoreBackup(ss,os),es.push(ss),localStorage.removeItem(ss)}}catch(rs){console.error(`Failed to migrate store ${ss}:`,rs),ts.push(ss)}return{migrated:es,errors:ts}}typeof window<"u"&&(window.addEventListener("beforeunload",()=>{for(const[es,ts]of Object.entries(pendingWrites))try{localStorage.setItem(es,JSON.stringify(ts))}catch{}}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&flushPendingWrites().catch(()=>{})}));function commonjsRequire(es){throw new Error('Could not dynamically require "'+es+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports$1){(function(ts,ss){module.exports=ts.pdfjsLib=ss()})(globalThis,()=>(()=>{var __webpack_modules__=[,(es,ts)=>{var to;Object.defineProperty(ts,"__esModule",{value:!0}),ts.VerbosityLevel=ts.Util=ts.UnknownErrorException=ts.UnexpectedResponseException=ts.TextRenderingMode=ts.RenderingIntentFlag=ts.PromiseCapability=ts.PermissionFlag=ts.PasswordResponses=ts.PasswordException=ts.PageActionEventType=ts.OPS=ts.MissingPDFException=ts.MAX_IMAGE_SIZE_TO_CACHE=ts.LINE_FACTOR=ts.LINE_DESCENT_FACTOR=ts.InvalidPDFException=ts.ImageKind=ts.IDENTITY_MATRIX=ts.FormatError=ts.FeatureTest=ts.FONT_IDENTITY_MATRIX=ts.DocumentActionEventType=ts.CMapCompressionType=ts.BaseException=ts.BASELINE_FACTOR=ts.AnnotationType=ts.AnnotationReplyType=ts.AnnotationPrefix=ts.AnnotationMode=ts.AnnotationFlag=ts.AnnotationFieldFlag=ts.AnnotationEditorType=ts.AnnotationEditorPrefix=ts.AnnotationEditorParamsType=ts.AnnotationBorderStyleType=ts.AnnotationActionEventType=ts.AbortException=void 0,ts.assert=Is,ts.bytesToString=ur,ts.createValidAbsoluteUrl=Vs,ts.getModificationDate=Ar,ts.getUuid=Vr,ts.getVerbosityLevel=qs,ts.info=Qs,ts.isArrayBuffer=ar,ts.isArrayEqual=Pr,ts.isNodeJS=void 0,ts.normalizeUnicode=$r,ts.objectFromMap=kr,ts.objectSize=Nr,ts.setVerbosityLevel=zs,ts.shadow=Ds,ts.string32=Er,ts.stringToBytes=cr,ts.stringToPDFString=dr,ts.stringToUTF8String=br,ts.unreachable=Ws,ts.utf8StringToString=Rr,ts.warn=Ys;const ss=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");ts.isNodeJS=ss;const rs=[1,0,0,1,0,0];ts.IDENTITY_MATRIX=rs;const ns=[.001,0,0,.001,0,0];ts.FONT_IDENTITY_MATRIX=ns;const os=1e7;ts.MAX_IMAGE_SIZE_TO_CACHE=os;const as=1.35;ts.LINE_FACTOR=as;const ls=.35;ts.LINE_DESCENT_FACTOR=ls;const cs=ls/as;ts.BASELINE_FACTOR=cs;const us={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};ts.RenderingIntentFlag=us;const ds={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};ts.AnnotationMode=ds;const ms="pdfjs_internal_editor_";ts.AnnotationEditorPrefix=ms;const ps={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};ts.AnnotationEditorType=ps;const hs={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};ts.AnnotationEditorParamsType=hs;const xs={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};ts.PermissionFlag=xs;const ys={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};ts.TextRenderingMode=ys;const vs={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};ts.ImageKind=vs;const gs={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};ts.AnnotationType=gs;const fs={GROUP:"Group",REPLY:"R"};ts.AnnotationReplyType=fs;const js={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};ts.AnnotationFlag=js;const Ss={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};ts.AnnotationFieldFlag=Ss;const bs={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};ts.AnnotationBorderStyleType=bs;const Es={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};ts.AnnotationActionEventType=Es;const Rs={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};ts.DocumentActionEventType=Rs;const ws={O:"PageOpen",C:"PageClose"};ts.PageActionEventType=ws;const Ns={ERRORS:0,WARNINGS:1,INFOS:5};ts.VerbosityLevel=Ns;const ks={NONE:0,BINARY:1};ts.CMapCompressionType=ks;const _s={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};ts.OPS=_s;const Ls={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};ts.PasswordResponses=Ls;let Os=Ns.WARNINGS;function zs(_r){Number.isInteger(_r)&&(Os=_r)}function qs(){return Os}function Qs(_r){Os>=Ns.INFOS&&console.log(`Info: ${_r}`)}function Ys(_r){Os>=Ns.WARNINGS&&console.log(`Warning: ${_r}`)}function Ws(_r){throw new Error(_r)}function Is(_r,gr){_r||Ws(gr)}function Bs(_r){switch(_r==null?void 0:_r.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Vs(_r,gr=null,vr=null){if(!_r)return null;try{if(vr&&typeof _r=="string"){if(vr.addDefaultProtocol&&_r.startsWith("www.")){const Qr=_r.match(/\./g);(Qr==null?void 0:Qr.length)>=2&&(_r=`http://${_r}`)}if(vr.tryConvertEncoding)try{_r=br(_r)}catch{}}const Or=gr?new URL(_r,gr):new URL(_r);if(Bs(Or))return Or}catch{}return null}function Ds(_r,gr,vr,Or=!1){return Object.defineProperty(_r,gr,{value:vr,enumerable:!Or,configurable:!0,writable:!1}),vr}const Cs=function(){function gr(vr,Or){this.constructor===gr&&Ws("Cannot initialize BaseException."),this.message=vr,this.name=Or}return gr.prototype=new Error,gr.constructor=gr,gr}();ts.BaseException=Cs;class Ts extends Cs{constructor(gr,vr){super(gr,"PasswordException"),this.code=vr}}ts.PasswordException=Ts;class $s extends Cs{constructor(gr,vr){super(gr,"UnknownErrorException"),this.details=vr}}ts.UnknownErrorException=$s;class Ps extends Cs{constructor(gr){super(gr,"InvalidPDFException")}}ts.InvalidPDFException=Ps;class Fs extends Cs{constructor(gr){super(gr,"MissingPDFException")}}ts.MissingPDFException=Fs;class Us extends Cs{constructor(gr,vr){super(gr,"UnexpectedResponseException"),this.status=vr}}ts.UnexpectedResponseException=Us;class Gs extends Cs{constructor(gr){super(gr,"FormatError")}}ts.FormatError=Gs;class hr extends Cs{constructor(gr){super(gr,"AbortException")}}ts.AbortException=hr;function ur(_r){(typeof _r!="object"||(_r==null?void 0:_r.length)===void 0)&&Ws("Invalid argument for bytesToString");const gr=_r.length,vr=8192;if(gr<vr)return String.fromCharCode.apply(null,_r);const Or=[];for(let Qr=0;Qr<gr;Qr+=vr){const Jr=Math.min(Qr+vr,gr),or=_r.subarray(Qr,Jr);Or.push(String.fromCharCode.apply(null,or))}return Or.join("")}function cr(_r){typeof _r!="string"&&Ws("Invalid argument for stringToBytes");const gr=_r.length,vr=new Uint8Array(gr);for(let Or=0;Or<gr;++Or)vr[Or]=_r.charCodeAt(Or)&255;return vr}function Er(_r){return String.fromCharCode(_r>>24&255,_r>>16&255,_r>>8&255,_r&255)}function Nr(_r){return Object.keys(_r).length}function kr(_r){const gr=Object.create(null);for(const[vr,Or]of _r)gr[vr]=Or;return gr}function mr(){const _r=new Uint8Array(4);return _r[0]=1,new Uint32Array(_r.buffer,0,1)[0]===1}function xr(){try{return new Function(""),!0}catch{return!1}}class Ms{static get isLittleEndian(){return Ds(this,"isLittleEndian",mr())}static get isEvalSupported(){return Ds(this,"isEvalSupported",xr())}static get isOffscreenCanvasSupported(){return Ds(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?Ds(this,"platform",{isWin:!1,isMac:!1}):Ds(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var gr,vr;return Ds(this,"isCSSRoundSupported",(vr=(gr=globalThis.CSS)==null?void 0:gr.supports)==null?void 0:vr.call(gr,"width: round(1.5px, 1px)"))}}ts.FeatureTest=Ms;const Hs=[...Array(256).keys()].map(_r=>_r.toString(16).padStart(2,"0"));class Js{static makeHexColor(gr,vr,Or){return`#${Hs[gr]}${Hs[vr]}${Hs[Or]}`}static scaleMinMax(gr,vr){let Or;gr[0]?(gr[0]<0&&(Or=vr[0],vr[0]=vr[1],vr[1]=Or),vr[0]*=gr[0],vr[1]*=gr[0],gr[3]<0&&(Or=vr[2],vr[2]=vr[3],vr[3]=Or),vr[2]*=gr[3],vr[3]*=gr[3]):(Or=vr[0],vr[0]=vr[2],vr[2]=Or,Or=vr[1],vr[1]=vr[3],vr[3]=Or,gr[1]<0&&(Or=vr[2],vr[2]=vr[3],vr[3]=Or),vr[2]*=gr[1],vr[3]*=gr[1],gr[2]<0&&(Or=vr[0],vr[0]=vr[1],vr[1]=Or),vr[0]*=gr[2],vr[1]*=gr[2]),vr[0]+=gr[4],vr[1]+=gr[4],vr[2]+=gr[5],vr[3]+=gr[5]}static transform(gr,vr){return[gr[0]*vr[0]+gr[2]*vr[1],gr[1]*vr[0]+gr[3]*vr[1],gr[0]*vr[2]+gr[2]*vr[3],gr[1]*vr[2]+gr[3]*vr[3],gr[0]*vr[4]+gr[2]*vr[5]+gr[4],gr[1]*vr[4]+gr[3]*vr[5]+gr[5]]}static applyTransform(gr,vr){const Or=gr[0]*vr[0]+gr[1]*vr[2]+vr[4],Qr=gr[0]*vr[1]+gr[1]*vr[3]+vr[5];return[Or,Qr]}static applyInverseTransform(gr,vr){const Or=vr[0]*vr[3]-vr[1]*vr[2],Qr=(gr[0]*vr[3]-gr[1]*vr[2]+vr[2]*vr[5]-vr[4]*vr[3])/Or,Jr=(-gr[0]*vr[1]+gr[1]*vr[0]+vr[4]*vr[1]-vr[5]*vr[0])/Or;return[Qr,Jr]}static getAxialAlignedBoundingBox(gr,vr){const Or=this.applyTransform(gr,vr),Qr=this.applyTransform(gr.slice(2,4),vr),Jr=this.applyTransform([gr[0],gr[3]],vr),or=this.applyTransform([gr[2],gr[1]],vr);return[Math.min(Or[0],Qr[0],Jr[0],or[0]),Math.min(Or[1],Qr[1],Jr[1],or[1]),Math.max(Or[0],Qr[0],Jr[0],or[0]),Math.max(Or[1],Qr[1],Jr[1],or[1])]}static inverseTransform(gr){const vr=gr[0]*gr[3]-gr[1]*gr[2];return[gr[3]/vr,-gr[1]/vr,-gr[2]/vr,gr[0]/vr,(gr[2]*gr[5]-gr[4]*gr[3])/vr,(gr[4]*gr[1]-gr[5]*gr[0])/vr]}static singularValueDecompose2dScale(gr){const vr=[gr[0],gr[2],gr[1],gr[3]],Or=gr[0]*vr[0]+gr[1]*vr[2],Qr=gr[0]*vr[1]+gr[1]*vr[3],Jr=gr[2]*vr[0]+gr[3]*vr[2],or=gr[2]*vr[1]+gr[3]*vr[3],Sr=(Or+or)/2,Mr=Math.sqrt((Or+or)**2-4*(Or*or-Jr*Qr))/2,Ur=Sr+Mr||1,zr=Sr-Mr||1;return[Math.sqrt(Ur),Math.sqrt(zr)]}static normalizeRect(gr){const vr=gr.slice(0);return gr[0]>gr[2]&&(vr[0]=gr[2],vr[2]=gr[0]),gr[1]>gr[3]&&(vr[1]=gr[3],vr[3]=gr[1]),vr}static intersect(gr,vr){const Or=Math.max(Math.min(gr[0],gr[2]),Math.min(vr[0],vr[2])),Qr=Math.min(Math.max(gr[0],gr[2]),Math.max(vr[0],vr[2]));if(Or>Qr)return null;const Jr=Math.max(Math.min(gr[1],gr[3]),Math.min(vr[1],vr[3])),or=Math.min(Math.max(gr[1],gr[3]),Math.max(vr[1],vr[3]));return Jr>or?null:[Or,Jr,Qr,or]}static bezierBoundingBox(gr,vr,Or,Qr,Jr,or,Sr,Mr){const Ur=[],zr=[[],[]];let Ir,Xs,Ks,lr,yr,wr,Cr,Tr;for(let qr=0;qr<2;++qr){if(qr===0?(Xs=6*gr-12*Or+6*Jr,Ir=-3*gr+9*Or-9*Jr+3*Sr,Ks=3*Or-3*gr):(Xs=6*vr-12*Qr+6*or,Ir=-3*vr+9*Qr-9*or+3*Mr,Ks=3*Qr-3*vr),Math.abs(Ir)<1e-12){if(Math.abs(Xs)<1e-12)continue;lr=-Ks/Xs,0<lr&&lr<1&&Ur.push(lr);continue}Cr=Xs*Xs-4*Ks*Ir,Tr=Math.sqrt(Cr),!(Cr<0)&&(yr=(-Xs+Tr)/(2*Ir),0<yr&&yr<1&&Ur.push(yr),wr=(-Xs-Tr)/(2*Ir),0<wr&&wr<1&&Ur.push(wr))}let Hr=Ur.length,Fr;const Lr=Hr;for(;Hr--;)lr=Ur[Hr],Fr=1-lr,zr[0][Hr]=Fr*Fr*Fr*gr+3*Fr*Fr*lr*Or+3*Fr*lr*lr*Jr+lr*lr*lr*Sr,zr[1][Hr]=Fr*Fr*Fr*vr+3*Fr*Fr*lr*Qr+3*Fr*lr*lr*or+lr*lr*lr*Mr;return zr[0][Lr]=gr,zr[1][Lr]=vr,zr[0][Lr+1]=Sr,zr[1][Lr+1]=Mr,zr[0].length=zr[1].length=Lr+2,[Math.min(...zr[0]),Math.min(...zr[1]),Math.max(...zr[0]),Math.max(...zr[1])]}}ts.Util=Js;const Zs=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function dr(_r){if(_r[0]>=""){let vr;if(_r[0]===""&&_r[1]===""?vr="utf-16be":_r[0]===""&&_r[1]===""?vr="utf-16le":_r[0]===""&&_r[1]===""&&_r[2]===""&&(vr="utf-8"),vr)try{const Or=new TextDecoder(vr,{fatal:!0}),Qr=cr(_r);return Or.decode(Qr)}catch(Or){Ys(`stringToPDFString: "${Or}".`)}}const gr=[];for(let vr=0,Or=_r.length;vr<Or;vr++){const Qr=Zs[_r.charCodeAt(vr)];gr.push(Qr?String.fromCharCode(Qr):_r.charAt(vr))}return gr.join("")}function br(_r){return decodeURIComponent(escape(_r))}function Rr(_r){return unescape(encodeURIComponent(_r))}function ar(_r){return typeof _r=="object"&&(_r==null?void 0:_r.byteLength)!==void 0}function Pr(_r,gr){if(_r.length!==gr.length)return!1;for(let vr=0,Or=_r.length;vr<Or;vr++)if(_r[vr]!==gr[vr])return!1;return!0}function Ar(_r=new Date){return[_r.getUTCFullYear().toString(),(_r.getUTCMonth()+1).toString().padStart(2,"0"),_r.getUTCDate().toString().padStart(2,"0"),_r.getUTCHours().toString().padStart(2,"0"),_r.getUTCMinutes().toString().padStart(2,"0"),_r.getUTCSeconds().toString().padStart(2,"0")].join("")}class Gr{constructor(){fr(this,to,!1);this.promise=new Promise((gr,vr)=>{this.resolve=Or=>{jr(this,to,!0),gr(Or)},this.reject=Or=>{jr(this,to,!0),vr(Or)}})}get settled(){return As(this,to)}}to=new WeakMap,ts.PromiseCapability=Gr;let Dr=null,Yr=null;function $r(_r){return Dr||(Dr=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Yr=new Map([["","t"]])),_r.replaceAll(Dr,(gr,vr,Or)=>vr?vr.normalize("NFKC"):Yr.get(Or))}function Vr(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const _r=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(_r);else for(let gr=0;gr<32;gr++)_r[gr]=Math.floor(Math.random()*255);return ur(_r)}const Zr="pdfjs_internal_id_";ts.AnnotationPrefix=Zr},(__unused_webpack_module,exports$1,__w_pdfjs_require__)=>{var es,ss,rs,ns,ho,So,ls,cs,us,ds,ms,ps,hs,xs,ys,No,gs,fs,Bo,Ss,bs;Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.RenderTask=exports$1.PDFWorkerUtil=exports$1.PDFWorker=exports$1.PDFPageProxy=exports$1.PDFDocumentProxy=exports$1.PDFDocumentLoadingTask=exports$1.PDFDataRangeTransport=exports$1.LoopbackPort=exports$1.DefaultStandardFontDataFactory=exports$1.DefaultFilterFactory=exports$1.DefaultCanvasFactory=exports$1.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports$1,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports$1.build=void 0,exports$1.getDocument=getDocument,exports$1.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports$1.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports$1.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(Rs){if(typeof Rs=="string"||Rs instanceof URL?Rs={url:Rs}:(0,_util.isArrayBuffer)(Rs)&&(Rs={data:Rs}),typeof Rs!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!Rs.url&&!Rs.data&&!Rs.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const ws=new PDFDocumentLoadingTask,{docId:Ns}=ws,ks=Rs.url?getUrlProp(Rs.url):null,_s=Rs.data?getDataProp(Rs.data):null,Ls=Rs.httpHeaders||null,Os=Rs.withCredentials===!0,zs=Rs.password??null,qs=Rs.range instanceof PDFDataRangeTransport?Rs.range:null,Qs=Number.isInteger(Rs.rangeChunkSize)&&Rs.rangeChunkSize>0?Rs.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Ys=Rs.worker instanceof PDFWorker?Rs.worker:null;const Ws=Rs.verbosity,Is=typeof Rs.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(Rs.docBaseUrl)?Rs.docBaseUrl:null,Bs=typeof Rs.cMapUrl=="string"?Rs.cMapUrl:null,Vs=Rs.cMapPacked!==!1,Ds=Rs.CMapReaderFactory||DefaultCMapReaderFactory,Cs=typeof Rs.standardFontDataUrl=="string"?Rs.standardFontDataUrl:null,Ts=Rs.StandardFontDataFactory||DefaultStandardFontDataFactory,$s=Rs.stopAtErrors!==!0,Ps=Number.isInteger(Rs.maxImageSize)&&Rs.maxImageSize>-1?Rs.maxImageSize:-1,Fs=Rs.isEvalSupported!==!1,Us=typeof Rs.isOffscreenCanvasSupported=="boolean"?Rs.isOffscreenCanvasSupported:!_util.isNodeJS,Gs=Number.isInteger(Rs.canvasMaxAreaInBytes)?Rs.canvasMaxAreaInBytes:-1,hr=typeof Rs.disableFontFace=="boolean"?Rs.disableFontFace:_util.isNodeJS,ur=Rs.fontExtraProperties===!0,cr=Rs.enableXfa===!0,Er=Rs.ownerDocument||globalThis.document,Nr=Rs.disableRange===!0,kr=Rs.disableStream===!0,mr=Rs.disableAutoFetch===!0,xr=Rs.pdfBug===!0,Ms=qs?qs.length:Rs.length??NaN,Hs=typeof Rs.useSystemFonts=="boolean"?Rs.useSystemFonts:!_util.isNodeJS&&!hr,Js=typeof Rs.useWorkerFetch=="boolean"?Rs.useWorkerFetch:Ds===_display_utils.DOMCMapReaderFactory&&Ts===_display_utils.DOMStandardFontDataFactory&&Bs&&Cs&&(0,_display_utils.isValidFetchUrl)(Bs,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(Cs,document.baseURI),Zs=Rs.canvasFactory||new DefaultCanvasFactory({ownerDocument:Er}),dr=Rs.filterFactory||new DefaultFilterFactory({docId:Ns,ownerDocument:Er}),br=null;(0,_util.setVerbosityLevel)(Ws);const Rr={canvasFactory:Zs,filterFactory:dr};if(Js||(Rr.cMapReaderFactory=new Ds({baseUrl:Bs,isCompressed:Vs}),Rr.standardFontDataFactory=new Ts({baseUrl:Cs})),!Ys){const Ar={verbosity:Ws,port:_worker_options.GlobalWorkerOptions.workerPort};Ys=Ar.port?PDFWorker.fromPort(Ar):new PDFWorker(Ar),ws._worker=Ys}const ar={docId:Ns,apiVersion:"3.11.174",data:_s,password:zs,disableAutoFetch:mr,rangeChunkSize:Qs,length:Ms,docBaseUrl:Is,enableXfa:cr,evaluatorOptions:{maxImageSize:Ps,disableFontFace:hr,ignoreErrors:$s,isEvalSupported:Fs,isOffscreenCanvasSupported:Us,canvasMaxAreaInBytes:Gs,fontExtraProperties:ur,useSystemFonts:Hs,cMapUrl:Js?Bs:null,standardFontDataUrl:Js?Cs:null}},Pr={ignoreErrors:$s,isEvalSupported:Fs,disableFontFace:hr,fontExtraProperties:ur,enableXfa:cr,ownerDocument:Er,disableAutoFetch:mr,pdfBug:xr,styleElement:br};return Ys.promise.then(function(){if(ws.destroyed)throw new Error("Loading aborted");const Ar=_fetchDocument(Ys,ar),Gr=new Promise(function(Dr){let Yr;qs?Yr=new _transport_stream.PDFDataTransportStream({length:Ms,initialData:qs.initialData,progressiveDone:qs.progressiveDone,contentDispositionFilename:qs.contentDispositionFilename,disableRange:Nr,disableStream:kr},qs):_s||(Yr=(Vr=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(Vr):(0,_display_utils.isValidFetchUrl)(Vr.url)?new _displayFetch_stream.PDFFetchStream(Vr):new _displayNetwork.PDFNetworkStream(Vr))({url:ks,length:Ms,httpHeaders:Ls,withCredentials:Os,rangeChunkSize:Qs,disableRange:Nr,disableStream:kr})),Dr(Yr)});return Promise.all([Ar,Gr]).then(function([Dr,Yr]){if(ws.destroyed)throw new Error("Loading aborted");const $r=new _message_handler.MessageHandler(Ns,Dr,Ys.port),Vr=new WorkerTransport($r,ws,Yr,Pr,Rr);ws._transport=Vr,$r.send("Ready",null)})}).catch(ws._capability.reject),ws}async function _fetchDocument(Rs,ws){if(Rs.destroyed)throw new Error("Worker was destroyed");const Ns=await Rs.messageHandler.sendWithPromise("GetDocRequest",ws,ws.data?[ws.data.buffer]:null);if(Rs.destroyed)throw new Error("Worker was destroyed");return Ns}function getUrlProp(Rs){if(Rs instanceof URL)return Rs.href;try{return new URL(Rs,window.location).href}catch{if(_util.isNodeJS&&typeof Rs=="string")return Rs}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(Rs){if(_util.isNodeJS&&typeof Buffer<"u"&&Rs instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(Rs instanceof Uint8Array&&Rs.byteLength===Rs.buffer.byteLength)return Rs;if(typeof Rs=="string")return(0,_util.stringToBytes)(Rs);if(typeof Rs=="object"&&!isNaN(Rs==null?void 0:Rs.length)||(0,_util.isArrayBuffer)(Rs))return new Uint8Array(Rs);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const ts=class ts{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${go(ts,es)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var ws,Ns,ks;this.destroyed=!0;try{(ws=this._worker)!=null&&ws.port&&(this._worker._pendingDestroy=!0),await((Ns=this._transport)==null?void 0:Ns.destroy())}catch(_s){throw(ks=this._worker)!=null&&ks.port&&delete this._worker._pendingDestroy,_s}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};es=new WeakMap,fr(ts,es,0);let PDFDocumentLoadingTask=ts;exports$1.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(ws,Ns,ks=!1,_s=null){this.length=ws,this.initialData=Ns,this.progressiveDone=ks,this.contentDispositionFilename=_s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(ws){this._rangeListeners.push(ws)}addProgressListener(ws){this._progressListeners.push(ws)}addProgressiveReadListener(ws){this._progressiveReadListeners.push(ws)}addProgressiveDoneListener(ws){this._progressiveDoneListeners.push(ws)}onDataRange(ws,Ns){for(const ks of this._rangeListeners)ks(ws,Ns)}onDataProgress(ws,Ns){this._readyCapability.promise.then(()=>{for(const ks of this._progressListeners)ks(ws,Ns)})}onDataProgressiveRead(ws){this._readyCapability.promise.then(()=>{for(const Ns of this._progressiveReadListeners)Ns(ws)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const ws of this._progressiveDoneListeners)ws()})}transportReady(){this._readyCapability.resolve()}requestDataRange(ws,Ns){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports$1.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(ws,Ns){this._pdfInfo=ws,this._transport=Ns,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(ks=>{if(!ks)return ks;const _s=[];for(const Ls in ks)_s.push(...ks[Ls]);return _s}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(ws){return this._transport.getPage(ws)}getPageIndex(ws){return this._transport.getPageIndex(ws)}getDestinations(){return this._transport.getDestinations()}getDestination(ws){return this._transport.getDestination(ws)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(ws=!1){return this._transport.startCleanup(ws||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports$1.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(ws,Ns,ks,_s=!1){fr(this,ns);fr(this,ss,null);fr(this,rs,!1);this._pageIndex=ws,this._pageInfo=Ns,this._transport=ks,this._stats=_s?new _display_utils.StatTimer:null,this._pdfBug=_s,this.commonObjs=ks.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:ws,rotation:Ns=this.rotate,offsetX:ks=0,offsetY:_s=0,dontFlip:Ls=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:ws,rotation:Ns,offsetX:ks,offsetY:_s,dontFlip:Ls})}getAnnotations({intent:ws="display"}={}){const Ns=this._transport.getRenderingIntent(ws);return this._transport.getAnnotations(this._pageIndex,Ns.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var ws;return((ws=this._transport._htmlForXfa)==null?void 0:ws.children[this._pageIndex])||null}render({canvasContext:ws,viewport:Ns,intent:ks="display",annotationMode:_s=_util.AnnotationMode.ENABLE,transform:Ls=null,background:Os=null,optionalContentConfigPromise:zs=null,annotationCanvasMap:qs=null,pageColors:Qs=null,printAnnotationStorage:Ys=null}){var Ts,$s;(Ts=this._stats)==null||Ts.time("Overall");const Ws=this._transport.getRenderingIntent(ks,_s,Ys);jr(this,rs,!1),pr(this,ns,So).call(this),zs||(zs=this._transport.getOptionalContentConfig());let Is=this._intentStates.get(Ws.cacheKey);Is||(Is=Object.create(null),this._intentStates.set(Ws.cacheKey,Is)),Is.streamReaderCancelTimeout&&(clearTimeout(Is.streamReaderCancelTimeout),Is.streamReaderCancelTimeout=null);const Bs=!!(Ws.renderingIntent&_util.RenderingIntentFlag.PRINT);Is.displayReadyCapability||(Is.displayReadyCapability=new _util.PromiseCapability,Is.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},($s=this._stats)==null||$s.time("Page Request"),this._pumpOperatorList(Ws));const Vs=Ps=>{var Fs,Us;Is.renderTasks.delete(Ds),(this._maybeCleanupAfterRender||Bs)&&jr(this,rs,!0),pr(this,ns,ho).call(this,!Bs),Ps?(Ds.capability.reject(Ps),this._abortOperatorList({intentState:Is,reason:Ps instanceof Error?Ps:new Error(Ps)})):Ds.capability.resolve(),(Fs=this._stats)==null||Fs.timeEnd("Rendering"),(Us=this._stats)==null||Us.timeEnd("Overall")},Ds=new InternalRenderTask({callback:Vs,params:{canvasContext:ws,viewport:Ns,transform:Ls,background:Os},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:qs,operatorList:Is.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Bs,pdfBug:this._pdfBug,pageColors:Qs});(Is.renderTasks||(Is.renderTasks=new Set)).add(Ds);const Cs=Ds.task;return Promise.all([Is.displayReadyCapability.promise,zs]).then(([Ps,Fs])=>{var Us;if(this.destroyed){Vs();return}(Us=this._stats)==null||Us.time("Rendering"),Ds.initializeGraphics({transparency:Ps,optionalContentConfig:Fs}),Ds.operatorListChanged()}).catch(Vs),Cs}getOperatorList({intent:ws="display",annotationMode:Ns=_util.AnnotationMode.ENABLE,printAnnotationStorage:ks=null}={}){var qs;function _s(){Os.operatorList.lastChunk&&(Os.opListReadCapability.resolve(Os.operatorList),Os.renderTasks.delete(zs))}const Ls=this._transport.getRenderingIntent(ws,Ns,ks,!0);let Os=this._intentStates.get(Ls.cacheKey);Os||(Os=Object.create(null),this._intentStates.set(Ls.cacheKey,Os));let zs;return Os.opListReadCapability||(zs=Object.create(null),zs.operatorListChanged=_s,Os.opListReadCapability=new _util.PromiseCapability,(Os.renderTasks||(Os.renderTasks=new Set)).add(zs),Os.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(qs=this._stats)==null||qs.time("Page Request"),this._pumpOperatorList(Ls)),Os.opListReadCapability.promise}streamTextContent({includeMarkedContent:ws=!1,disableNormalization:Ns=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:ws===!0,disableNormalization:Ns===!0},{highWaterMark:100,size(_s){return _s.items.length}})}getTextContent(ws={}){if(this._transport._htmlForXfa)return this.getXfa().then(ks=>_xfa_text.XfaText.textContent(ks));const Ns=this.streamTextContent(ws);return new Promise(function(ks,_s){function Ls(){Os.read().then(function({value:qs,done:Qs}){if(Qs){ks(zs);return}Object.assign(zs.styles,qs.styles),zs.items.push(...qs.items),Ls()},_s)}const Os=Ns.getReader(),zs={items:[],styles:Object.create(null)};Ls()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const ws=[];for(const Ns of this._intentStates.values())if(this._abortOperatorList({intentState:Ns,reason:new Error("Page was destroyed."),force:!0}),!Ns.opListReadCapability)for(const ks of Ns.renderTasks)ws.push(ks.completed),ks.cancel();return this.objs.clear(),jr(this,rs,!1),pr(this,ns,So).call(this),Promise.all(ws)}cleanup(ws=!1){jr(this,rs,!0);const Ns=pr(this,ns,ho).call(this,!1);return ws&&Ns&&this._stats&&(this._stats=new _display_utils.StatTimer),Ns}_startRenderPage(ws,Ns){var _s,Ls;const ks=this._intentStates.get(Ns);ks&&((_s=this._stats)==null||_s.timeEnd("Page Request"),(Ls=ks.displayReadyCapability)==null||Ls.resolve(ws))}_renderPageChunk(ws,Ns){for(let ks=0,_s=ws.length;ks<_s;ks++)Ns.operatorList.fnArray.push(ws.fnArray[ks]),Ns.operatorList.argsArray.push(ws.argsArray[ks]);Ns.operatorList.lastChunk=ws.lastChunk,Ns.operatorList.separateAnnots=ws.separateAnnots;for(const ks of Ns.renderTasks)ks.operatorListChanged();ws.lastChunk&&pr(this,ns,ho).call(this,!0)}_pumpOperatorList({renderingIntent:ws,cacheKey:Ns,annotationStorageSerializable:ks}){const{map:_s,transfers:Ls}=ks,zs=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:ws,cacheKey:Ns,annotationStorage:_s},Ls).getReader(),qs=this._intentStates.get(Ns);qs.streamReader=zs;const Qs=()=>{zs.read().then(({value:Ys,done:Ws})=>{if(Ws){qs.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Ys,qs),Qs())},Ys=>{if(qs.streamReader=null,!this._transport.destroyed){if(qs.operatorList){qs.operatorList.lastChunk=!0;for(const Ws of qs.renderTasks)Ws.operatorListChanged();pr(this,ns,ho).call(this,!0)}if(qs.displayReadyCapability)qs.displayReadyCapability.reject(Ys);else if(qs.opListReadCapability)qs.opListReadCapability.reject(Ys);else throw Ys}})};Qs()}_abortOperatorList({intentState:ws,reason:Ns,force:ks=!1}){if(ws.streamReader){if(ws.streamReaderCancelTimeout&&(clearTimeout(ws.streamReaderCancelTimeout),ws.streamReaderCancelTimeout=null),!ks){if(ws.renderTasks.size>0)return;if(Ns instanceof _display_utils.RenderingCancelledException){let _s=RENDERING_CANCELLED_TIMEOUT;Ns.extraDelay>0&&Ns.extraDelay<1e3&&(_s+=Ns.extraDelay),ws.streamReaderCancelTimeout=setTimeout(()=>{ws.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:ws,reason:Ns,force:!0})},_s);return}}if(ws.streamReader.cancel(new _util.AbortException(Ns.message)).catch(()=>{}),ws.streamReader=null,!this._transport.destroyed){for(const[_s,Ls]of this._intentStates)if(Ls===ws){this._intentStates.delete(_s);break}this.cleanup()}}}get stats(){return this._stats}}ss=new WeakMap,rs=new WeakMap,ns=new WeakSet,ho=function(ws=!1){if(pr(this,ns,So).call(this),!As(this,rs)||this.destroyed)return!1;if(ws)return jr(this,ss,setTimeout(()=>{jr(this,ss,null),pr(this,ns,ho).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:Ns,operatorList:ks}of this._intentStates.values())if(Ns.size>0||!ks.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),jr(this,rs,!1),!0},So=function(){As(this,ss)&&(clearTimeout(As(this,ss)),jr(this,ss,null))},exports$1.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){fr(this,ls,new Set);fr(this,cs,Promise.resolve())}postMessage(ws,Ns){const ks={data:structuredClone(ws,Ns?{transfer:Ns}:null)};As(this,cs).then(()=>{for(const _s of As(this,ls))_s.call(this,ks)})}addEventListener(ws,Ns){As(this,ls).add(Ns)}removeEventListener(ws,Ns){As(this,ls).delete(Ns)}terminate(){As(this,ls).clear()}}ls=new WeakMap,cs=new WeakMap,exports$1.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports$1.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const Rs=(us=document==null?void 0:document.currentScript)==null?void 0:us.src;Rs&&(PDFWorkerUtil.fallbackWorkerSrc=Rs.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(Rs,ws){let Ns;try{if(Ns=new URL(Rs),!Ns.origin||Ns.origin==="null")return!1}catch{return!1}const ks=new URL(ws,Ns);return Ns.origin===ks.origin},PDFWorkerUtil.createCDNWrapper=function(Rs){const ws=`importScripts("${Rs}");`;return URL.createObjectURL(new Blob([ws]))}}const _PDFWorker=class _PDFWorker{constructor({name:Rs=null,port:ws=null,verbosity:Ns=(0,_util.getVerbosityLevel)()}={}){var ks;if(this.name=Rs,this.destroyed=!1,this.verbosity=Ns,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,ws){if((ks=As(_PDFWorker,ds))!=null&&ks.has(ws))throw new Error("Cannot use more than one PDFWorker per port.");(As(_PDFWorker,ds)||jr(_PDFWorker,ds,new WeakMap)).set(ws,this),this._initializeFromPort(ws);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(Rs){this._port=Rs,this._messageHandler=new _message_handler.MessageHandler("main","worker",Rs),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:Rs}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,Rs)||(Rs=PDFWorkerUtil.createCDNWrapper(new URL(Rs,window.location).href));const ws=new Worker(Rs),Ns=new _message_handler.MessageHandler("main","worker",ws),ks=()=>{ws.removeEventListener("error",_s),Ns.destroy(),ws.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},_s=()=>{this._webWorker||ks()};ws.addEventListener("error",_s),Ns.on("test",Os=>{if(ws.removeEventListener("error",_s),this.destroyed){ks();return}Os?(this._messageHandler=Ns,this._port=ws,this._webWorker=ws,this._readyCapability.resolve(),Ns.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),Ns.destroy(),ws.terminate())}),Ns.on("ready",Os=>{if(ws.removeEventListener("error",_s),this.destroyed){ks();return}try{Ls()}catch{this._setupFakeWorker()}});const Ls=()=>{const Os=new Uint8Array;Ns.send("test",Os,[Os.buffer])};Ls();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(Rs=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const ws=new LoopbackPort;this._port=ws;const Ns=`fake${PDFWorkerUtil.fakeWorkerId++}`,ks=new _message_handler.MessageHandler(Ns+"_worker",Ns,ws);Rs.setup(ks,ws);const _s=new _message_handler.MessageHandler(Ns,Ns+"_worker",ws);this._messageHandler=_s,this._readyCapability.resolve(),_s.send("configure",{verbosity:this.verbosity})}).catch(Rs=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${Rs.message}".`))})}destroy(){var Rs;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(Rs=As(_PDFWorker,ds))==null||Rs.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(Rs){var Ns;if(!(Rs!=null&&Rs.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const ws=(Ns=As(this,ds))==null?void 0:Ns.get(Rs.port);if(ws){if(ws._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return ws}return new _PDFWorker(Rs)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var Rs;try{return((Rs=globalThis.pdfjsWorker)==null?void 0:Rs.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};ds=new WeakMap,fr(_PDFWorker,ds);let PDFWorker=_PDFWorker;exports$1.PDFWorker=PDFWorker;class WorkerTransport{constructor(ws,Ns,ks,_s,Ls){fr(this,ys);fr(this,ms,new Map);fr(this,ps,new Map);fr(this,hs,new Map);fr(this,xs,null);this.messageHandler=ws,this.loadingTask=Ns,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:_s.ownerDocument,styleElement:_s.styleElement}),this._params=_s,this.canvasFactory=Ls.canvasFactory,this.filterFactory=Ls.filterFactory,this.cMapReaderFactory=Ls.cMapReaderFactory,this.standardFontDataFactory=Ls.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=ks,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(ws,Ns=_util.AnnotationMode.ENABLE,ks=null,_s=!1){let Ls=_util.RenderingIntentFlag.DISPLAY,Os=_annotation_storage.SerializableEmpty;switch(ws){case"any":Ls=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":Ls=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${ws}`)}switch(Ns){case _util.AnnotationMode.DISABLE:Ls+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:Ls+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:Ls+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,Os=(Ls&_util.RenderingIntentFlag.PRINT&&ks instanceof _annotation_storage.PrintAnnotationStorage?ks:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${Ns}`)}return _s&&(Ls+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:Ls,cacheKey:`${Ls}_${Os.hash}`,annotationStorageSerializable:Os}}destroy(){var ks;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(ks=As(this,xs))==null||ks.reject(new Error("Worker was destroyed during onPassword callback"));const ws=[];for(const _s of As(this,ps).values())ws.push(_s._destroy());As(this,ps).clear(),As(this,hs).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const Ns=this.messageHandler.sendWithPromise("Terminate",null);return ws.push(Ns),Promise.all(ws).then(()=>{var _s;this.commonObjs.clear(),this.fontLoader.clear(),As(this,ms).clear(),this.filterFactory.destroy(),(_s=this._networkStream)==null||_s.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:ws,loadingTask:Ns}=this;ws.on("GetReader",(ks,_s)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=Ls=>{this._lastProgress={loaded:Ls.loaded,total:Ls.total}},_s.onPull=()=>{this._fullReader.read().then(function({value:Ls,done:Os}){if(Os){_s.close();return}(0,_util.assert)(Ls instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),_s.enqueue(new Uint8Array(Ls),1,[Ls])}).catch(Ls=>{_s.error(Ls)})},_s.onCancel=Ls=>{this._fullReader.cancel(Ls),_s.ready.catch(Os=>{if(!this.destroyed)throw Os})}}),ws.on("ReaderHeadersReady",ks=>{const _s=new _util.PromiseCapability,Ls=this._fullReader;return Ls.headersReady.then(()=>{var Os;(!Ls.isStreamingSupported||!Ls.isRangeSupported)&&(this._lastProgress&&((Os=Ns.onProgress)==null||Os.call(Ns,this._lastProgress)),Ls.onProgress=zs=>{var qs;(qs=Ns.onProgress)==null||qs.call(Ns,{loaded:zs.loaded,total:zs.total})}),_s.resolve({isStreamingSupported:Ls.isStreamingSupported,isRangeSupported:Ls.isRangeSupported,contentLength:Ls.contentLength})},_s.reject),_s.promise}),ws.on("GetRangeReader",(ks,_s)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const Ls=this._networkStream.getRangeReader(ks.begin,ks.end);if(!Ls){_s.close();return}_s.onPull=()=>{Ls.read().then(function({value:Os,done:zs}){if(zs){_s.close();return}(0,_util.assert)(Os instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),_s.enqueue(new Uint8Array(Os),1,[Os])}).catch(Os=>{_s.error(Os)})},_s.onCancel=Os=>{Ls.cancel(Os),_s.ready.catch(zs=>{if(!this.destroyed)throw zs})}}),ws.on("GetDoc",({pdfInfo:ks})=>{this._numPages=ks.numPages,this._htmlForXfa=ks.htmlForXfa,delete ks.htmlForXfa,Ns._capability.resolve(new PDFDocumentProxy(ks,this))}),ws.on("DocException",function(ks){let _s;switch(ks.name){case"PasswordException":_s=new _util.PasswordException(ks.message,ks.code);break;case"InvalidPDFException":_s=new _util.InvalidPDFException(ks.message);break;case"MissingPDFException":_s=new _util.MissingPDFException(ks.message);break;case"UnexpectedResponseException":_s=new _util.UnexpectedResponseException(ks.message,ks.status);break;case"UnknownErrorException":_s=new _util.UnknownErrorException(ks.message,ks.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}Ns._capability.reject(_s)}),ws.on("PasswordRequest",ks=>{if(jr(this,xs,new _util.PromiseCapability),Ns.onPassword){const _s=Ls=>{Ls instanceof Error?As(this,xs).reject(Ls):As(this,xs).resolve({password:Ls})};try{Ns.onPassword(_s,ks.code)}catch(Ls){As(this,xs).reject(Ls)}}else As(this,xs).reject(new _util.PasswordException(ks.message,ks.code));return As(this,xs).promise}),ws.on("DataLoaded",ks=>{var _s;(_s=Ns.onProgress)==null||_s.call(Ns,{loaded:ks.length,total:ks.length}),this.downloadInfoCapability.resolve(ks)}),ws.on("StartRenderPage",ks=>{if(this.destroyed)return;As(this,ps).get(ks.pageIndex)._startRenderPage(ks.transparency,ks.cacheKey)}),ws.on("commonobj",([ks,_s,Ls])=>{var Os;if(!this.destroyed&&!this.commonObjs.has(ks))switch(_s){case"Font":const zs=this._params;if("error"in Ls){const Ys=Ls.error;(0,_util.warn)(`Error during font loading: ${Ys}`),this.commonObjs.resolve(ks,Ys);break}const qs=zs.pdfBug&&((Os=globalThis.FontInspector)!=null&&Os.enabled)?(Ys,Ws)=>globalThis.FontInspector.fontAdded(Ys,Ws):null,Qs=new _font_loader.FontFaceObject(Ls,{isEvalSupported:zs.isEvalSupported,disableFontFace:zs.disableFontFace,ignoreErrors:zs.ignoreErrors,inspectFont:qs});this.fontLoader.bind(Qs).catch(Ys=>ws.sendWithPromise("FontFallback",{id:ks})).finally(()=>{!zs.fontExtraProperties&&Qs.data&&(Qs.data=null),this.commonObjs.resolve(ks,Qs)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(ks,Ls);break;default:throw new Error(`Got unknown common object type ${_s}`)}}),ws.on("obj",([ks,_s,Ls,Os])=>{var qs;if(this.destroyed)return;const zs=As(this,ps).get(_s);if(!zs.objs.has(ks))switch(Ls){case"Image":if(zs.objs.resolve(ks,Os),Os){let Qs;if(Os.bitmap){const{width:Ys,height:Ws}=Os;Qs=Ys*Ws*4}else Qs=((qs=Os.data)==null?void 0:qs.length)||0;Qs>_util.MAX_IMAGE_SIZE_TO_CACHE&&(zs._maybeCleanupAfterRender=!0)}break;case"Pattern":zs.objs.resolve(ks,Os);break;default:throw new Error(`Got unknown object type ${Ls}`)}}),ws.on("DocProgress",ks=>{var _s;this.destroyed||(_s=Ns.onProgress)==null||_s.call(Ns,{loaded:ks.loaded,total:ks.total})}),ws.on("FetchBuiltInCMap",ks=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(ks):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),ws.on("FetchStandardFontData",ks=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(ks):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var ks;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:ws,transfers:Ns}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:ws,filename:((ks=this._fullReader)==null?void 0:ks.filename)??null},Ns).finally(()=>{this.annotationStorage.resetModified()})}getPage(ws){if(!Number.isInteger(ws)||ws<=0||ws>this._numPages)return Promise.reject(new Error("Invalid page request."));const Ns=ws-1,ks=As(this,hs).get(Ns);if(ks)return ks;const _s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:Ns}).then(Ls=>{if(this.destroyed)throw new Error("Transport destroyed");const Os=new PDFPageProxy(Ns,Ls,this,this._params.pdfBug);return As(this,ps).set(Ns,Os),Os});return As(this,hs).set(Ns,_s),_s}getPageIndex(ws){return typeof ws!="object"||ws===null||!Number.isInteger(ws.num)||ws.num<0||!Number.isInteger(ws.gen)||ws.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:ws.num,gen:ws.gen})}getAnnotations(ws,Ns){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:ws,intent:Ns})}getFieldObjects(){return pr(this,ys,No).call(this,"GetFieldObjects")}hasJSActions(){return pr(this,ys,No).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(ws){return typeof ws!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:ws})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return pr(this,ys,No).call(this,"GetDocJSActions")}getPageJSActions(ws){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:ws})}getStructTree(ws){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:ws})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(ws=>new _optional_content_config.OptionalContentConfig(ws))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const ws="GetMetadata",Ns=As(this,ms).get(ws);if(Ns)return Ns;const ks=this.messageHandler.sendWithPromise(ws,null).then(_s=>{var Ls,Os;return{info:_s[0],metadata:_s[1]?new _metadata.Metadata(_s[1]):null,contentDispositionFilename:((Ls=this._fullReader)==null?void 0:Ls.filename)??null,contentLength:((Os=this._fullReader)==null?void 0:Os.contentLength)??null}});return As(this,ms).set(ws,ks),ks}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(ws=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const Ns of As(this,ps).values())if(!Ns.cleanup())throw new Error(`startCleanup: Page ${Ns.pageNumber} is currently rendering.`);this.commonObjs.clear(),ws||this.fontLoader.clear(),As(this,ms).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:ws,enableXfa:Ns}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:ws,enableXfa:Ns})}}ms=new WeakMap,ps=new WeakMap,hs=new WeakMap,xs=new WeakMap,ys=new WeakSet,No=function(ws,Ns=null){const ks=As(this,ms).get(ws);if(ks)return ks;const _s=this.messageHandler.sendWithPromise(ws,Ns);return As(this,ms).set(ws,_s),_s};class PDFObjects{constructor(){fr(this,fs);fr(this,gs,Object.create(null))}get(ws,Ns=null){if(Ns){const _s=pr(this,fs,Bo).call(this,ws);return _s.capability.promise.then(()=>Ns(_s.data)),null}const ks=As(this,gs)[ws];if(!(ks!=null&&ks.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${ws}.`);return ks.data}has(ws){const Ns=As(this,gs)[ws];return(Ns==null?void 0:Ns.capability.settled)||!1}resolve(ws,Ns=null){const ks=pr(this,fs,Bo).call(this,ws);ks.data=Ns,ks.capability.resolve()}clear(){var ws;for(const Ns in As(this,gs)){const{data:ks}=As(this,gs)[Ns];(ws=ks==null?void 0:ks.bitmap)==null||ws.close()}jr(this,gs,Object.create(null))}}gs=new WeakMap,fs=new WeakSet,Bo=function(ws){var Ns;return(Ns=As(this,gs))[ws]||(Ns[ws]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(ws){fr(this,Ss,null);jr(this,Ss,ws),this.onContinue=null}get promise(){return As(this,Ss).capability.promise}cancel(ws=0){As(this,Ss).cancel(null,ws)}get separateAnnots(){const{separateAnnots:ws}=As(this,Ss).operatorList;if(!ws)return!1;const{annotationCanvasMap:Ns}=As(this,Ss);return ws.form||ws.canvas&&(Ns==null?void 0:Ns.size)>0}}Ss=new WeakMap,exports$1.RenderTask=RenderTask;const Es=class Es{constructor({callback:ws,params:Ns,objs:ks,commonObjs:_s,annotationCanvasMap:Ls,operatorList:Os,pageIndex:zs,canvasFactory:qs,filterFactory:Qs,useRequestAnimationFrame:Ys=!1,pdfBug:Ws=!1,pageColors:Is=null}){this.callback=ws,this.params=Ns,this.objs=ks,this.commonObjs=_s,this.annotationCanvasMap=Ls,this.operatorListIdx=null,this.operatorList=Os,this._pageIndex=zs,this.canvasFactory=qs,this.filterFactory=Qs,this._pdfBug=Ws,this.pageColors=Is,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Ys===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=Ns.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:ws=!1,optionalContentConfig:Ns}){var zs,qs;if(this.cancelled)return;if(this._canvas){if(As(Es,bs).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");As(Es,bs).add(this._canvas)}this._pdfBug&&((zs=globalThis.StepperManager)!=null&&zs.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:ks,viewport:_s,transform:Ls,background:Os}=this.params;this.gfx=new _canvas.CanvasGraphics(ks,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:Ns},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:Ls,viewport:_s,transparency:ws,background:Os}),this.operatorListIdx=0,this.graphicsReady=!0,(qs=this.graphicsReadyCallback)==null||qs.call(this)}cancel(ws=null,Ns=0){var ks;this.running=!1,this.cancelled=!0,(ks=this.gfx)==null||ks.endDrawing(),As(Es,bs).delete(this._canvas),this.callback(ws||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,Ns))}operatorListChanged(){var ws;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(ws=this.stepper)==null||ws.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),As(Es,bs).delete(this._canvas),this.callback())))}};bs=new WeakMap,fr(Es,bs,new WeakSet);let InternalRenderTask=Es;const version="3.11.174";exports$1.version=version;const build="ce8716743";exports$1.build=build},(es,ts,ss)=>{var us,ds,ms,Ol,hs;Object.defineProperty(ts,"__esModule",{value:!0}),ts.SerializableEmpty=ts.PrintAnnotationStorage=ts.AnnotationStorage=void 0;var rs=ss(1),ns=ss(4),os=ss(8);const as=Object.freeze({map:null,hash:"",transfers:void 0});ts.SerializableEmpty=as;class ls{constructor(){fr(this,ms);fr(this,us,!1);fr(this,ds,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(ys,vs){const gs=As(this,ds).get(ys);return gs===void 0?vs:Object.assign(vs,gs)}getRawValue(ys){return As(this,ds).get(ys)}remove(ys){if(As(this,ds).delete(ys),As(this,ds).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const vs of As(this,ds).values())if(vs instanceof ns.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(ys,vs){const gs=As(this,ds).get(ys);let fs=!1;if(gs!==void 0)for(const[js,Ss]of Object.entries(vs))gs[js]!==Ss&&(fs=!0,gs[js]=Ss);else fs=!0,As(this,ds).set(ys,vs);fs&&pr(this,ms,Ol).call(this),vs instanceof ns.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(vs.constructor._type)}has(ys){return As(this,ds).has(ys)}getAll(){return As(this,ds).size>0?(0,rs.objectFromMap)(As(this,ds)):null}setAll(ys){for(const[vs,gs]of Object.entries(ys))this.setValue(vs,gs)}get size(){return As(this,ds).size}resetModified(){As(this,us)&&(jr(this,us,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new cs(this)}get serializable(){if(As(this,ds).size===0)return as;const ys=new Map,vs=new os.MurmurHash3_64,gs=[],fs=Object.create(null);let js=!1;for(const[Ss,bs]of As(this,ds)){const Es=bs instanceof ns.AnnotationEditor?bs.serialize(!1,fs):bs;Es&&(ys.set(Ss,Es),vs.update(`${Ss}:${JSON.stringify(Es)}`),js||(js=!!Es.bitmap))}if(js)for(const Ss of ys.values())Ss.bitmap&&gs.push(Ss.bitmap);return ys.size>0?{map:ys,hash:vs.hexdigest(),transfers:gs}:as}}us=new WeakMap,ds=new WeakMap,ms=new WeakSet,Ol=function(){As(this,us)||(jr(this,us,!0),typeof this.onSetModified=="function"&&this.onSetModified())},ts.AnnotationStorage=ls;class cs extends ls{constructor(vs){super();fr(this,hs);const{map:gs,hash:fs,transfers:js}=vs.serializable,Ss=structuredClone(gs,js?{transfer:js}:null);jr(this,hs,{map:Ss,hash:fs,transfers:js})}get print(){(0,rs.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return As(this,hs)}}hs=new WeakMap,ts.PrintAnnotationStorage=cs},(es,ts,ss)=>{var cs,us,ds,ms,ps,hs,xs,ys,vs,gs,fs,js,Ss,bs,Es,Uo,Ho,Ns,Wo,zo,$l,Fl,Bl,Vo,Ul;Object.defineProperty(ts,"__esModule",{value:!0}),ts.AnnotationEditor=void 0;var rs=ss(5),ns=ss(1),os=ss(6);const Ys=class Ys{constructor(Is){fr(this,Es);fr(this,cs,"");fr(this,us,!1);fr(this,ds,null);fr(this,ms,null);fr(this,ps,null);fr(this,hs,!1);fr(this,xs,null);fr(this,ys,this.focusin.bind(this));fr(this,vs,this.focusout.bind(this));fr(this,gs,!1);fr(this,fs,!1);fr(this,js,!1);eo(this,"_initialOptions",Object.create(null));eo(this,"_uiManager",null);eo(this,"_focusEventsAllowed",!0);eo(this,"_l10nPromise",null);fr(this,Ss,!1);fr(this,bs,Ys._zIndex++);this.constructor===Ys&&(0,ns.unreachable)("Cannot initialize AnnotationEditor."),this.parent=Is.parent,this.id=Is.id,this.width=this.height=null,this.pageIndex=Is.parent.pageIndex,this.name=Is.name,this.div=null,this._uiManager=Is.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=Is.isCentered,this._structTreeParentId=null;const{rotation:Bs,rawDims:{pageWidth:Vs,pageHeight:Ds,pageX:Cs,pageY:Ts}}=this.parent.viewport;this.rotation=Bs,this.pageRotation=(360+Bs-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[Vs,Ds],this.pageTranslation=[Cs,Ts];const[$s,Ps]=this.parentDimensions;this.x=Is.x/$s,this.y=Is.y/Ps,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,ns.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(Is){const Bs=new ls({id:Is.parent.getNextId(),parent:Is.parent,uiManager:Is._uiManager});Bs.annotationElementId=Is.annotationElementId,Bs.deleted=!0,Bs._uiManager.addToAnnotationStorage(Bs)}static initialize(Is,Bs=null){if(Ys._l10nPromise||(Ys._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(Ds=>[Ds,Is.get(Ds)]))),Bs!=null&&Bs.strings)for(const Ds of Bs.strings)Ys._l10nPromise.set(Ds,Is.get(Ds));if(Ys._borderLineWidth!==-1)return;const Vs=getComputedStyle(document.documentElement);Ys._borderLineWidth=parseFloat(Vs.getPropertyValue("--outline-width"))||0}static updateDefaultParams(Is,Bs){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(Is){return!1}static paste(Is,Bs){(0,ns.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return As(this,Ss)}set _isDraggable(Is){var Bs;jr(this,Ss,Is),(Bs=this.div)==null||Bs.classList.toggle("draggable",Is)}center(){const[Is,Bs]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*Bs/(Is*2),this.y+=this.width*Is/(Bs*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*Bs/(Is*2),this.y-=this.width*Is/(Bs*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(Is){this._uiManager.addCommands(Is)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=As(this,bs)}setParent(Is){Is!==null&&(this.pageIndex=Is.pageIndex,this.pageDimensions=Is.pageDimensions),this.parent=Is}focusin(Is){this._focusEventsAllowed&&(As(this,gs)?jr(this,gs,!1):this.parent.setSelected(this))}focusout(Is){var Vs;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const Bs=Is.relatedTarget;Bs!=null&&Bs.closest(`#${this.id}`)||(Is.preventDefault(),(Vs=this.parent)!=null&&Vs.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(Is,Bs,Vs,Ds){const[Cs,Ts]=this.parentDimensions;[Vs,Ds]=this.screenToPageTranslation(Vs,Ds),this.x=(Is+Vs)/Cs,this.y=(Bs+Ds)/Ts,this.fixAndSetPosition()}translate(Is,Bs){pr(this,Es,Uo).call(this,this.parentDimensions,Is,Bs)}translateInPage(Is,Bs){pr(this,Es,Uo).call(this,this.pageDimensions,Is,Bs),this.div.scrollIntoView({block:"nearest"})}drag(Is,Bs){const[Vs,Ds]=this.parentDimensions;if(this.x+=Is/Vs,this.y+=Bs/Ds,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:Fs,y:Us}=this.div.getBoundingClientRect();this.parent.findNewParent(this,Fs,Us)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:Cs,y:Ts}=this;const[$s,Ps]=pr(this,Es,Ho).call(this);Cs+=$s,Ts+=Ps,this.div.style.left=`${(100*Cs).toFixed(2)}%`,this.div.style.top=`${(100*Ts).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[Is,Bs]=this.pageDimensions;let{x:Vs,y:Ds,width:Cs,height:Ts}=this;switch(Cs*=Is,Ts*=Bs,Vs*=Is,Ds*=Bs,this.rotation){case 0:Vs=Math.max(0,Math.min(Is-Cs,Vs)),Ds=Math.max(0,Math.min(Bs-Ts,Ds));break;case 90:Vs=Math.max(0,Math.min(Is-Ts,Vs)),Ds=Math.min(Bs,Math.max(Cs,Ds));break;case 180:Vs=Math.min(Is,Math.max(Cs,Vs)),Ds=Math.min(Bs,Math.max(Ts,Ds));break;case 270:Vs=Math.min(Is,Math.max(Ts,Vs)),Ds=Math.max(0,Math.min(Bs-Cs,Ds));break}this.x=Vs/=Is,this.y=Ds/=Bs;const[$s,Ps]=pr(this,Es,Ho).call(this);Vs+=$s,Ds+=Ps;const{style:Fs}=this.div;Fs.left=`${(100*Vs).toFixed(2)}%`,Fs.top=`${(100*Ds).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(Is,Bs){var Vs;return pr(Vs=Ys,Ns,Wo).call(Vs,Is,Bs,this.parentRotation)}pageTranslationToScreen(Is,Bs){var Vs;return pr(Vs=Ys,Ns,Wo).call(Vs,Is,Bs,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:Is,pageDimensions:[Bs,Vs]}=this,Ds=Bs*Is,Cs=Vs*Is;return ns.FeatureTest.isCSSRoundSupported?[Math.round(Ds),Math.round(Cs)]:[Ds,Cs]}setDims(Is,Bs){var Cs;const[Vs,Ds]=this.parentDimensions;this.div.style.width=`${(100*Is/Vs).toFixed(2)}%`,As(this,hs)||(this.div.style.height=`${(100*Bs/Ds).toFixed(2)}%`),(Cs=As(this,ds))==null||Cs.classList.toggle("small",Is<Ys.SMALL_EDITOR_SIZE||Bs<Ys.SMALL_EDITOR_SIZE)}fixDims(){const{style:Is}=this.div,{height:Bs,width:Vs}=Is,Ds=Vs.endsWith("%"),Cs=!As(this,hs)&&Bs.endsWith("%");if(Ds&&Cs)return;const[Ts,$s]=this.parentDimensions;Ds||(Is.width=`${(100*parseFloat(Vs)/Ts).toFixed(2)}%`),!As(this,hs)&&!Cs&&(Is.height=`${(100*parseFloat(Bs)/$s).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(As(this,ds))return;const Is=jr(this,ds,document.createElement("button"));Is.className="altText";const Bs=await Ys._l10nPromise.get("editor_alt_text_button_label");Is.textContent=Bs,Is.setAttribute("aria-label",Bs),Is.tabIndex="0",Is.addEventListener("contextmenu",os.noContextMenu),Is.addEventListener("pointerdown",Vs=>Vs.stopPropagation()),Is.addEventListener("click",Vs=>{Vs.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),Is.addEventListener("keydown",Vs=>{Vs.target===Is&&Vs.key==="Enter"&&(Vs.preventDefault(),this._uiManager.editAltText(this))}),pr(this,Es,Vo).call(this),this.div.append(Is),Ys.SMALL_EDITOR_SIZE||(Ys.SMALL_EDITOR_SIZE=Math.min(128,Math.round(Is.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:As(this,cs),decorative:As(this,us)}}set altTextData({altText:Is,decorative:Bs}){As(this,cs)===Is&&As(this,us)===Bs||(jr(this,cs,Is),jr(this,us,Bs),pr(this,Es,Vo).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",As(this,ys)),this.div.addEventListener("focusout",As(this,vs));const[Is,Bs]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*Bs/Is).toFixed(2)}%`,this.div.style.maxHeight=`${(100*Is/Bs).toFixed(2)}%`);const[Vs,Ds]=this.getInitialTranslation();return this.translate(Vs,Ds),(0,rs.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(Is){const{isMac:Bs}=ns.FeatureTest.platform;if(Is.button!==0||Is.ctrlKey&&Bs){Is.preventDefault();return}jr(this,gs,!0),pr(this,Es,Ul).call(this,Is)}moveInDOM(){var Is;(Is=this.parent)==null||Is.moveEditorInDOM(this)}_setParentAndPosition(Is,Bs,Vs){Is.changeParent(this),this.x=Bs,this.y=Vs,this.fixAndSetPosition()}getRect(Is,Bs){const Vs=this.parentScale,[Ds,Cs]=this.pageDimensions,[Ts,$s]=this.pageTranslation,Ps=Is/Vs,Fs=Bs/Vs,Us=this.x*Ds,Gs=this.y*Cs,hr=this.width*Ds,ur=this.height*Cs;switch(this.rotation){case 0:return[Us+Ps+Ts,Cs-Gs-Fs-ur+$s,Us+Ps+hr+Ts,Cs-Gs-Fs+$s];case 90:return[Us+Fs+Ts,Cs-Gs+Ps+$s,Us+Fs+ur+Ts,Cs-Gs+Ps+hr+$s];case 180:return[Us-Ps-hr+Ts,Cs-Gs+Fs+$s,Us-Ps+Ts,Cs-Gs+Fs+ur+$s];case 270:return[Us-Fs-ur+Ts,Cs-Gs-Ps-hr+$s,Us-Fs+Ts,Cs-Gs-Ps+$s];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(Is,Bs){const[Vs,Ds,Cs,Ts]=Is,$s=Cs-Vs,Ps=Ts-Ds;switch(this.rotation){case 0:return[Vs,Bs-Ts,$s,Ps];case 90:return[Vs,Bs-Ds,Ps,$s];case 180:return[Cs,Bs-Ds,$s,Ps];case 270:return[Cs,Bs-Ts,Ps,$s];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){jr(this,js,!0)}disableEditMode(){jr(this,js,!1)}isInEditMode(){return As(this,js)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var Is,Bs;(Is=this.div)==null||Is.addEventListener("focusin",As(this,ys)),(Bs=this.div)==null||Bs.addEventListener("focusout",As(this,vs))}serialize(Is=!1,Bs=null){(0,ns.unreachable)("An editor must be serializable")}static deserialize(Is,Bs,Vs){const Ds=new this.prototype.constructor({parent:Bs,id:Bs.getNextId(),uiManager:Vs});Ds.rotation=Is.rotation;const[Cs,Ts]=Ds.pageDimensions,[$s,Ps,Fs,Us]=Ds.getRectInCurrentCoords(Is.rect,Ts);return Ds.x=$s/Cs,Ds.y=Ps/Ts,Ds.width=Fs/Cs,Ds.height=Us/Ts,Ds}remove(){var Is;this.div.removeEventListener("focusin",As(this,ys)),this.div.removeEventListener("focusout",As(this,vs)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(Is=As(this,ds))==null||Is.remove(),jr(this,ds,null),jr(this,ms,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(pr(this,Es,$l).call(this),As(this,xs).classList.remove("hidden"))}select(){var Is;this.makeResizable(),(Is=this.div)==null||Is.classList.add("selectedEditor")}unselect(){var Is,Bs,Vs;(Is=As(this,xs))==null||Is.classList.add("hidden"),(Bs=this.div)==null||Bs.classList.remove("selectedEditor"),(Vs=this.div)!=null&&Vs.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(Is,Bs){}disableEditing(){As(this,ds)&&(As(this,ds).hidden=!0)}enableEditing(){As(this,ds)&&(As(this,ds).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return As(this,fs)}set isEditing(Is){jr(this,fs,Is),this.parent&&(Is?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(Is,Bs){jr(this,hs,!0);const Vs=Is/Bs,{style:Ds}=this.div;Ds.aspectRatio=Vs,Ds.height="auto"}static get MIN_SIZE(){return 16}};cs=new WeakMap,us=new WeakMap,ds=new WeakMap,ms=new WeakMap,ps=new WeakMap,hs=new WeakMap,xs=new WeakMap,ys=new WeakMap,vs=new WeakMap,gs=new WeakMap,fs=new WeakMap,js=new WeakMap,Ss=new WeakMap,bs=new WeakMap,Es=new WeakSet,Uo=function([Is,Bs],Vs,Ds){[Vs,Ds]=this.screenToPageTranslation(Vs,Ds),this.x+=Vs/Is,this.y+=Ds/Bs,this.fixAndSetPosition()},Ho=function(){const[Is,Bs]=this.parentDimensions,{_borderLineWidth:Vs}=Ys,Ds=Vs/Is,Cs=Vs/Bs;switch(this.rotation){case 90:return[-Ds,Cs];case 180:return[Ds,Cs];case 270:return[Ds,-Cs];default:return[-Ds,-Cs]}},Ns=new WeakSet,Wo=function(Is,Bs,Vs){switch(Vs){case 90:return[Bs,-Is];case 180:return[-Is,-Bs];case 270:return[-Bs,Is];default:return[Is,Bs]}},zo=function(Is){switch(Is){case 90:{const[Bs,Vs]=this.pageDimensions;return[0,-Bs/Vs,Vs/Bs,0]}case 180:return[-1,0,0,-1];case 270:{const[Bs,Vs]=this.pageDimensions;return[0,Bs/Vs,-Vs/Bs,0]}default:return[1,0,0,1]}},$l=function(){if(As(this,xs))return;jr(this,xs,document.createElement("div")),As(this,xs).classList.add("resizers");const Is=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||Is.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const Bs of Is){const Vs=document.createElement("div");As(this,xs).append(Vs),Vs.classList.add("resizer",Bs),Vs.addEventListener("pointerdown",pr(this,Es,Fl).bind(this,Bs)),Vs.addEventListener("contextmenu",os.noContextMenu)}this.div.prepend(As(this,xs))},Fl=function(Is,Bs){Bs.preventDefault();const{isMac:Vs}=ns.FeatureTest.platform;if(Bs.button!==0||Bs.ctrlKey&&Vs)return;const Ds=pr(this,Es,Bl).bind(this,Is),Cs=this._isDraggable;this._isDraggable=!1;const Ts={passive:!0,capture:!0};window.addEventListener("pointermove",Ds,Ts);const $s=this.x,Ps=this.y,Fs=this.width,Us=this.height,Gs=this.parent.div.style.cursor,hr=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(Bs.target).cursor;const ur=()=>{this._isDraggable=Cs,window.removeEventListener("pointerup",ur),window.removeEventListener("blur",ur),window.removeEventListener("pointermove",Ds,Ts),this.parent.div.style.cursor=Gs,this.div.style.cursor=hr;const cr=this.x,Er=this.y,Nr=this.width,kr=this.height;cr===$s&&Er===Ps&&Nr===Fs&&kr===Us||this.addCommands({cmd:()=>{this.width=Nr,this.height=kr,this.x=cr,this.y=Er;const[mr,xr]=this.parentDimensions;this.setDims(mr*Nr,xr*kr),this.fixAndSetPosition()},undo:()=>{this.width=Fs,this.height=Us,this.x=$s,this.y=Ps;const[mr,xr]=this.parentDimensions;this.setDims(mr*Fs,xr*Us),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",ur),window.addEventListener("blur",ur)},Bl=function(Is,Bs){const[Vs,Ds]=this.parentDimensions,Cs=this.x,Ts=this.y,$s=this.width,Ps=this.height,Fs=Ys.MIN_SIZE/Vs,Us=Ys.MIN_SIZE/Ds,Gs=$r=>Math.round($r*1e4)/1e4,hr=pr(this,Es,zo).call(this,this.rotation),ur=($r,Vr)=>[hr[0]*$r+hr[2]*Vr,hr[1]*$r+hr[3]*Vr],cr=pr(this,Es,zo).call(this,360-this.rotation),Er=($r,Vr)=>[cr[0]*$r+cr[2]*Vr,cr[1]*$r+cr[3]*Vr];let Nr,kr,mr=!1,xr=!1;switch(Is){case"topLeft":mr=!0,Nr=($r,Vr)=>[0,0],kr=($r,Vr)=>[$r,Vr];break;case"topMiddle":Nr=($r,Vr)=>[$r/2,0],kr=($r,Vr)=>[$r/2,Vr];break;case"topRight":mr=!0,Nr=($r,Vr)=>[$r,0],kr=($r,Vr)=>[0,Vr];break;case"middleRight":xr=!0,Nr=($r,Vr)=>[$r,Vr/2],kr=($r,Vr)=>[0,Vr/2];break;case"bottomRight":mr=!0,Nr=($r,Vr)=>[$r,Vr],kr=($r,Vr)=>[0,0];break;case"bottomMiddle":Nr=($r,Vr)=>[$r/2,Vr],kr=($r,Vr)=>[$r/2,0];break;case"bottomLeft":mr=!0,Nr=($r,Vr)=>[0,Vr],kr=($r,Vr)=>[$r,0];break;case"middleLeft":xr=!0,Nr=($r,Vr)=>[0,Vr/2],kr=($r,Vr)=>[$r,Vr/2];break}const Ms=Nr($s,Ps),Hs=kr($s,Ps);let Js=ur(...Hs);const Zs=Gs(Cs+Js[0]),dr=Gs(Ts+Js[1]);let br=1,Rr=1,[ar,Pr]=this.screenToPageTranslation(Bs.movementX,Bs.movementY);if([ar,Pr]=Er(ar/Vs,Pr/Ds),mr){const $r=Math.hypot($s,Ps);br=Rr=Math.max(Math.min(Math.hypot(Hs[0]-Ms[0]-ar,Hs[1]-Ms[1]-Pr)/$r,1/$s,1/Ps),Fs/$s,Us/Ps)}else xr?br=Math.max(Fs,Math.min(1,Math.abs(Hs[0]-Ms[0]-ar)))/$s:Rr=Math.max(Us,Math.min(1,Math.abs(Hs[1]-Ms[1]-Pr)))/Ps;const Ar=Gs($s*br),Gr=Gs(Ps*Rr);Js=ur(...kr(Ar,Gr));const Dr=Zs-Js[0],Yr=dr-Js[1];this.width=Ar,this.height=Gr,this.x=Dr,this.y=Yr,this.setDims(Vs*Ar,Ds*Gr),this.fixAndSetPosition()},Vo=async function(){var Vs;const Is=As(this,ds);if(!Is)return;if(!As(this,cs)&&!As(this,us)){Is.classList.remove("done"),(Vs=As(this,ms))==null||Vs.remove();return}Ys._l10nPromise.get("editor_alt_text_edit_button_label").then(Ds=>{Is.setAttribute("aria-label",Ds)});let Bs=As(this,ms);if(!Bs){jr(this,ms,Bs=document.createElement("span")),Bs.className="tooltip",Bs.setAttribute("role","tooltip");const Ds=Bs.id=`alt-text-tooltip-${this.id}`;Is.setAttribute("aria-describedby",Ds);const Cs=100;Is.addEventListener("mouseenter",()=>{jr(this,ps,setTimeout(()=>{jr(this,ps,null),As(this,ms).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},Cs))}),Is.addEventListener("mouseleave",()=>{var Ts;clearTimeout(As(this,ps)),jr(this,ps,null),(Ts=As(this,ms))==null||Ts.classList.remove("show")})}Is.classList.add("done"),Bs.innerText=As(this,us)?await Ys._l10nPromise.get("editor_alt_text_decorative_tooltip"):As(this,cs),Bs.parentNode||Is.append(Bs)},Ul=function(Is){if(!this._isDraggable)return;const Bs=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let Vs,Ds;Bs&&(Vs={passive:!0,capture:!0},Ds=Ts=>{const[$s,Ps]=this.screenToPageTranslation(Ts.movementX,Ts.movementY);this._uiManager.dragSelectedEditors($s,Ps)},window.addEventListener("pointermove",Ds,Vs));const Cs=()=>{if(window.removeEventListener("pointerup",Cs),window.removeEventListener("blur",Cs),Bs&&window.removeEventListener("pointermove",Ds,Vs),jr(this,gs,!1),!this._uiManager.endDragSession()){const{isMac:Ts}=ns.FeatureTest.platform;Is.ctrlKey&&!Ts||Is.shiftKey||Is.metaKey&&Ts?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",Cs),window.addEventListener("blur",Cs)},fr(Ys,Ns),eo(Ys,"_borderLineWidth",-1),eo(Ys,"_colorManager",new rs.ColorManager),eo(Ys,"_zIndex",1),eo(Ys,"SMALL_EDITOR_SIZE",0);let as=Ys;ts.AnnotationEditor=as;class ls extends as{constructor(Is){super(Is),this.annotationElementId=Is.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(es,ts,ss)=>{var hs,xs,ys,vs,gs,Go,Ss,bs,Es,Rs,ws,Hl,_s,Ls,Os,zs,qs,Qs,Ys,Ws,Is,Bs,Vs,Ds,Cs,Ts,$s,Ps,Fs,Us,Gs,hr,ur,cr,Er,Nr,kr,mr,xr,Ms,Hs,Js,Zs,dr,br,Rr,ar,Wl,Ko,qo,ko,Yo,Xo,io,jo,zl,Vl,Jo,vo,Qo;Object.defineProperty(ts,"__esModule",{value:!0}),ts.KeyboardManager=ts.CommandManager=ts.ColorManager=ts.AnnotationEditorUIManager=void 0,ts.bindEvents=os,ts.opacityToHex=as;var rs=ss(1),ns=ss(6);function os(Jr,or,Sr){for(const Mr of Sr)or.addEventListener(Mr,Jr[Mr].bind(Jr))}function as(Jr){return Math.round(Math.min(255,Math.max(1,255*Jr))).toString(16).padStart(2,"0")}class ls{constructor(){fr(this,hs,0)}getId(){return`${rs.AnnotationEditorPrefix}${go(this,hs)._++}`}}hs=new WeakMap;const js=class js{constructor(){fr(this,gs);fr(this,xs,(0,rs.getUuid)());fr(this,ys,0);fr(this,vs,null)}static get _isSVGFittingCanvas(){const or='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',Mr=new OffscreenCanvas(1,3).getContext("2d"),Ur=new Image;Ur.src=or;const zr=Ur.decode().then(()=>(Mr.drawImage(Ur,0,0,1,1,0,0,1,3),new Uint32Array(Mr.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,rs.shadow)(this,"_isSVGFittingCanvas",zr)}async getFromFile(or){const{lastModified:Sr,name:Mr,size:Ur,type:zr}=or;return pr(this,gs,Go).call(this,`${Sr}_${Mr}_${Ur}_${zr}`,or)}async getFromUrl(or){return pr(this,gs,Go).call(this,or,or)}async getFromId(or){As(this,vs)||jr(this,vs,new Map);const Sr=As(this,vs).get(or);return Sr?Sr.bitmap?(Sr.refCounter+=1,Sr):Sr.file?this.getFromFile(Sr.file):this.getFromUrl(Sr.url):null}getSvgUrl(or){const Sr=As(this,vs).get(or);return Sr!=null&&Sr.isSvg?Sr.svgUrl:null}deleteId(or){As(this,vs)||jr(this,vs,new Map);const Sr=As(this,vs).get(or);Sr&&(Sr.refCounter-=1,Sr.refCounter===0&&(Sr.bitmap=null))}isValidId(or){return or.startsWith(`image_${As(this,xs)}_`)}};xs=new WeakMap,ys=new WeakMap,vs=new WeakMap,gs=new WeakSet,Go=async function(or,Sr){As(this,vs)||jr(this,vs,new Map);let Mr=As(this,vs).get(or);if(Mr===null)return null;if(Mr!=null&&Mr.bitmap)return Mr.refCounter+=1,Mr;try{Mr||(Mr={bitmap:null,id:`image_${As(this,xs)}_${go(this,ys)._++}`,refCounter:0,isSvg:!1});let Ur;if(typeof Sr=="string"){Mr.url=Sr;const zr=await fetch(Sr);if(!zr.ok)throw new Error(zr.statusText);Ur=await zr.blob()}else Ur=Mr.file=Sr;if(Ur.type==="image/svg+xml"){const zr=js._isSVGFittingCanvas,Ir=new FileReader,Xs=new Image,Ks=new Promise((lr,yr)=>{Xs.onload=()=>{Mr.bitmap=Xs,Mr.isSvg=!0,lr()},Ir.onload=async()=>{const wr=Mr.svgUrl=Ir.result;Xs.src=await zr?`${wr}#svgView(preserveAspectRatio(none))`:wr},Xs.onerror=Ir.onerror=yr});Ir.readAsDataURL(Ur),await Ks}else Mr.bitmap=await createImageBitmap(Ur);Mr.refCounter=1}catch(Ur){console.error(Ur),Mr=null}return As(this,vs).set(or,Mr),Mr&&As(this,vs).set(Mr.id,Mr),Mr};let cs=js;class us{constructor(or=128){fr(this,Ss,[]);fr(this,bs,!1);fr(this,Es);fr(this,Rs,-1);jr(this,Es,or)}add({cmd:or,undo:Sr,mustExec:Mr,type:Ur=NaN,overwriteIfSameType:zr=!1,keepUndo:Ir=!1}){if(Mr&&or(),As(this,bs))return;const Xs={cmd:or,undo:Sr,type:Ur};if(As(this,Rs)===-1){As(this,Ss).length>0&&(As(this,Ss).length=0),jr(this,Rs,0),As(this,Ss).push(Xs);return}if(zr&&As(this,Ss)[As(this,Rs)].type===Ur){Ir&&(Xs.undo=As(this,Ss)[As(this,Rs)].undo),As(this,Ss)[As(this,Rs)]=Xs;return}const Ks=As(this,Rs)+1;Ks===As(this,Es)?As(this,Ss).splice(0,1):(jr(this,Rs,Ks),Ks<As(this,Ss).length&&As(this,Ss).splice(Ks)),As(this,Ss).push(Xs)}undo(){As(this,Rs)!==-1&&(jr(this,bs,!0),As(this,Ss)[As(this,Rs)].undo(),jr(this,bs,!1),jr(this,Rs,As(this,Rs)-1))}redo(){As(this,Rs)<As(this,Ss).length-1&&(jr(this,Rs,As(this,Rs)+1),jr(this,bs,!0),As(this,Ss)[As(this,Rs)].cmd(),jr(this,bs,!1))}hasSomethingToUndo(){return As(this,Rs)!==-1}hasSomethingToRedo(){return As(this,Rs)<As(this,Ss).length-1}destroy(){jr(this,Ss,null)}}Ss=new WeakMap,bs=new WeakMap,Es=new WeakMap,Rs=new WeakMap,ts.CommandManager=us;class ds{constructor(or){fr(this,ws);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:Sr}=rs.FeatureTest.platform;for(const[Mr,Ur,zr={}]of or)for(const Ir of Mr){const Xs=Ir.startsWith("mac+");Sr&&Xs?(this.callbacks.set(Ir.slice(4),{callback:Ur,options:zr}),this.allKeys.add(Ir.split("+").at(-1))):!Sr&&!Xs&&(this.callbacks.set(Ir,{callback:Ur,options:zr}),this.allKeys.add(Ir.split("+").at(-1)))}}exec(or,Sr){if(!this.allKeys.has(Sr.key))return;const Mr=this.callbacks.get(pr(this,ws,Hl).call(this,Sr));if(!Mr)return;const{callback:Ur,options:{bubbles:zr=!1,args:Ir=[],checker:Xs=null}}=Mr;Xs&&!Xs(or,Sr)||(Ur.bind(or,...Ir)(),zr||(Sr.stopPropagation(),Sr.preventDefault()))}}ws=new WeakSet,Hl=function(or){or.altKey&&this.buffer.push("alt"),or.ctrlKey&&this.buffer.push("ctrl"),or.metaKey&&this.buffer.push("meta"),or.shiftKey&&this.buffer.push("shift"),this.buffer.push(or.key);const Sr=this.buffer.join("+");return this.buffer.length=0,Sr},ts.KeyboardManager=ds;const ks=class ks{get _colors(){const or=new Map([["CanvasText",null],["Canvas",null]]);return(0,ns.getColorValues)(or),(0,rs.shadow)(this,"_colors",or)}convert(or){const Sr=(0,ns.getRGB)(or);if(!window.matchMedia("(forced-colors: active)").matches)return Sr;for(const[Mr,Ur]of this._colors)if(Ur.every((zr,Ir)=>zr===Sr[Ir]))return ks._colorsMapping.get(Mr);return Sr}getHexCode(or){const Sr=this._colors.get(or);return Sr?rs.Util.makeHexColor(...Sr):or}};eo(ks,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let ms=ks;ts.ColorManager=ms;const Qr=class Qr{constructor(or,Sr,Mr,Ur,zr,Ir){fr(this,ar);fr(this,_s,null);fr(this,Ls,new Map);fr(this,Os,new Map);fr(this,zs,null);fr(this,qs,null);fr(this,Qs,new us);fr(this,Ys,0);fr(this,Ws,new Set);fr(this,Is,null);fr(this,Bs,null);fr(this,Vs,new Set);fr(this,Ds,null);fr(this,Cs,new ls);fr(this,Ts,!1);fr(this,$s,!1);fr(this,Ps,null);fr(this,Fs,rs.AnnotationEditorType.NONE);fr(this,Us,new Set);fr(this,Gs,null);fr(this,hr,this.blur.bind(this));fr(this,ur,this.focus.bind(this));fr(this,cr,this.copy.bind(this));fr(this,Er,this.cut.bind(this));fr(this,Nr,this.paste.bind(this));fr(this,kr,this.keydown.bind(this));fr(this,mr,this.onEditingAction.bind(this));fr(this,xr,this.onPageChanging.bind(this));fr(this,Ms,this.onScaleChanging.bind(this));fr(this,Hs,this.onRotationChanging.bind(this));fr(this,Js,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});fr(this,Zs,[0,0]);fr(this,dr,null);fr(this,br,null);fr(this,Rr,null);jr(this,br,or),jr(this,Rr,Sr),jr(this,zs,Mr),this._eventBus=Ur,this._eventBus._on("editingaction",As(this,mr)),this._eventBus._on("pagechanging",As(this,xr)),this._eventBus._on("scalechanging",As(this,Ms)),this._eventBus._on("rotationchanging",As(this,Hs)),jr(this,qs,zr.annotationStorage),jr(this,Ds,zr.filterFactory),jr(this,Gs,Ir),this.viewParameters={realScale:ns.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const or=Qr.prototype,Sr=zr=>{const{activeElement:Ir}=document;return Ir&&As(zr,br).contains(Ir)&&zr.hasSomethingToControl()},Mr=this.TRANSLATE_SMALL,Ur=this.TRANSLATE_BIG;return(0,rs.shadow)(this,"_keyboardManager",new ds([[["ctrl+a","mac+meta+a"],or.selectAll],[["ctrl+z","mac+meta+z"],or.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],or.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],or.delete],[["Escape","mac+Escape"],or.unselectAll],[["ArrowLeft","mac+ArrowLeft"],or.translateSelectedEditors,{args:[-Mr,0],checker:Sr}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],or.translateSelectedEditors,{args:[-Ur,0],checker:Sr}],[["ArrowRight","mac+ArrowRight"],or.translateSelectedEditors,{args:[Mr,0],checker:Sr}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],or.translateSelectedEditors,{args:[Ur,0],checker:Sr}],[["ArrowUp","mac+ArrowUp"],or.translateSelectedEditors,{args:[0,-Mr],checker:Sr}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],or.translateSelectedEditors,{args:[0,-Ur],checker:Sr}],[["ArrowDown","mac+ArrowDown"],or.translateSelectedEditors,{args:[0,Mr],checker:Sr}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],or.translateSelectedEditors,{args:[0,Ur],checker:Sr}]]))}destroy(){pr(this,ar,ko).call(this),pr(this,ar,Ko).call(this),this._eventBus._off("editingaction",As(this,mr)),this._eventBus._off("pagechanging",As(this,xr)),this._eventBus._off("scalechanging",As(this,Ms)),this._eventBus._off("rotationchanging",As(this,Hs));for(const or of As(this,Os).values())or.destroy();As(this,Os).clear(),As(this,Ls).clear(),As(this,Vs).clear(),jr(this,_s,null),As(this,Us).clear(),As(this,Qs).destroy(),As(this,zs).destroy()}get hcmFilter(){return(0,rs.shadow)(this,"hcmFilter",As(this,Gs)?As(this,Ds).addHCMFilter(As(this,Gs).foreground,As(this,Gs).background):"none")}get direction(){return(0,rs.shadow)(this,"direction",getComputedStyle(As(this,br)).direction)}editAltText(or){var Sr;(Sr=As(this,zs))==null||Sr.editAltText(this,or)}onPageChanging({pageNumber:or}){jr(this,Ys,or-1)}focusMainContainer(){As(this,br).focus()}findParent(or,Sr){for(const Mr of As(this,Os).values()){const{x:Ur,y:zr,width:Ir,height:Xs}=Mr.div.getBoundingClientRect();if(or>=Ur&&or<=Ur+Ir&&Sr>=zr&&Sr<=zr+Xs)return Mr}return null}disableUserSelect(or=!1){As(this,Rr).classList.toggle("noUserSelect",or)}addShouldRescale(or){As(this,Vs).add(or)}removeShouldRescale(or){As(this,Vs).delete(or)}onScaleChanging({scale:or}){this.commitOrRemove(),this.viewParameters.realScale=or*ns.PixelsPerInch.PDF_TO_CSS_UNITS;for(const Sr of As(this,Vs))Sr.onScaleChanging()}onRotationChanging({pagesRotation:or}){this.commitOrRemove(),this.viewParameters.rotation=or}addToAnnotationStorage(or){!or.isEmpty()&&As(this,qs)&&!As(this,qs).has(or.id)&&As(this,qs).setValue(or.id,or)}blur(){if(!this.hasSelection)return;const{activeElement:or}=document;for(const Sr of As(this,Us))if(Sr.div.contains(or)){jr(this,Ps,[Sr,or]),Sr._focusEventsAllowed=!1;break}}focus(){if(!As(this,Ps))return;const[or,Sr]=As(this,Ps);jr(this,Ps,null),Sr.addEventListener("focusin",()=>{or._focusEventsAllowed=!0},{once:!0}),Sr.focus()}addEditListeners(){pr(this,ar,qo).call(this),pr(this,ar,Yo).call(this)}removeEditListeners(){pr(this,ar,ko).call(this),pr(this,ar,Xo).call(this)}copy(or){var Mr;if(or.preventDefault(),(Mr=As(this,_s))==null||Mr.commitOrRemove(),!this.hasSelection)return;const Sr=[];for(const Ur of As(this,Us)){const zr=Ur.serialize(!0);zr&&Sr.push(zr)}Sr.length!==0&&or.clipboardData.setData("application/pdfjs",JSON.stringify(Sr))}cut(or){this.copy(or),this.delete()}paste(or){or.preventDefault();const{clipboardData:Sr}=or;for(const zr of Sr.items)for(const Ir of As(this,Bs))if(Ir.isHandlingMimeForPasting(zr.type)){Ir.paste(zr,this.currentLayer);return}let Mr=Sr.getData("application/pdfjs");if(!Mr)return;try{Mr=JSON.parse(Mr)}catch(zr){(0,rs.warn)(`paste: "${zr.message}".`);return}if(!Array.isArray(Mr))return;this.unselectAll();const Ur=this.currentLayer;try{const zr=[];for(const Ks of Mr){const lr=Ur.deserialize(Ks);if(!lr)return;zr.push(lr)}const Ir=()=>{for(const Ks of zr)pr(this,ar,Jo).call(this,Ks);pr(this,ar,Qo).call(this,zr)},Xs=()=>{for(const Ks of zr)Ks.remove()};this.addCommands({cmd:Ir,undo:Xs,mustExec:!0})}catch(zr){(0,rs.warn)(`paste: "${zr.message}".`)}}keydown(or){var Sr;(Sr=this.getActive())!=null&&Sr.shouldGetKeyboardEvents()||Qr._keyboardManager.exec(this,or)}onEditingAction(or){["undo","redo","delete","selectAll"].includes(or.name)&&this[or.name]()}setEditingState(or){or?(pr(this,ar,Wl).call(this),pr(this,ar,qo).call(this),pr(this,ar,Yo).call(this),pr(this,ar,io).call(this,{isEditing:As(this,Fs)!==rs.AnnotationEditorType.NONE,isEmpty:pr(this,ar,vo).call(this),hasSomethingToUndo:As(this,Qs).hasSomethingToUndo(),hasSomethingToRedo:As(this,Qs).hasSomethingToRedo(),hasSelectedEditor:!1})):(pr(this,ar,Ko).call(this),pr(this,ar,ko).call(this),pr(this,ar,Xo).call(this),pr(this,ar,io).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(or){if(!As(this,Bs)){jr(this,Bs,or);for(const Sr of As(this,Bs))pr(this,ar,jo).call(this,Sr.defaultPropertiesToUpdate)}}getId(){return As(this,Cs).getId()}get currentLayer(){return As(this,Os).get(As(this,Ys))}getLayer(or){return As(this,Os).get(or)}get currentPageIndex(){return As(this,Ys)}addLayer(or){As(this,Os).set(or.pageIndex,or),As(this,Ts)?or.enable():or.disable()}removeLayer(or){As(this,Os).delete(or.pageIndex)}updateMode(or,Sr=null){if(As(this,Fs)!==or){if(jr(this,Fs,or),or===rs.AnnotationEditorType.NONE){this.setEditingState(!1),pr(this,ar,Vl).call(this);return}this.setEditingState(!0),pr(this,ar,zl).call(this),this.unselectAll();for(const Mr of As(this,Os).values())Mr.updateMode(or);if(Sr){for(const Mr of As(this,Ls).values())if(Mr.annotationElementId===Sr){this.setSelected(Mr),Mr.enterInEditMode();break}}}}updateToolbar(or){or!==As(this,Fs)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:or})}updateParams(or,Sr){if(As(this,Bs)){if(or===rs.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(or);return}for(const Mr of As(this,Us))Mr.updateParams(or,Sr);for(const Mr of As(this,Bs))Mr.updateDefaultParams(or,Sr)}}enableWaiting(or=!1){if(As(this,$s)!==or){jr(this,$s,or);for(const Sr of As(this,Os).values())or?Sr.disableClick():Sr.enableClick(),Sr.div.classList.toggle("waiting",or)}}getEditors(or){const Sr=[];for(const Mr of As(this,Ls).values())Mr.pageIndex===or&&Sr.push(Mr);return Sr}getEditor(or){return As(this,Ls).get(or)}addEditor(or){As(this,Ls).set(or.id,or)}removeEditor(or){var Sr;As(this,Ls).delete(or.id),this.unselect(or),(!or.annotationElementId||!As(this,Ws).has(or.annotationElementId))&&((Sr=As(this,qs))==null||Sr.remove(or.id))}addDeletedAnnotationElement(or){As(this,Ws).add(or.annotationElementId),or.deleted=!0}isDeletedAnnotationElement(or){return As(this,Ws).has(or)}removeDeletedAnnotationElement(or){As(this,Ws).delete(or.annotationElementId),or.deleted=!1}setActiveEditor(or){As(this,_s)!==or&&(jr(this,_s,or),or&&pr(this,ar,jo).call(this,or.propertiesToUpdate))}toggleSelected(or){if(As(this,Us).has(or)){As(this,Us).delete(or),or.unselect(),pr(this,ar,io).call(this,{hasSelectedEditor:this.hasSelection});return}As(this,Us).add(or),or.select(),pr(this,ar,jo).call(this,or.propertiesToUpdate),pr(this,ar,io).call(this,{hasSelectedEditor:!0})}setSelected(or){for(const Sr of As(this,Us))Sr!==or&&Sr.unselect();As(this,Us).clear(),As(this,Us).add(or),or.select(),pr(this,ar,jo).call(this,or.propertiesToUpdate),pr(this,ar,io).call(this,{hasSelectedEditor:!0})}isSelected(or){return As(this,Us).has(or)}unselect(or){or.unselect(),As(this,Us).delete(or),pr(this,ar,io).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return As(this,Us).size!==0}undo(){As(this,Qs).undo(),pr(this,ar,io).call(this,{hasSomethingToUndo:As(this,Qs).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:pr(this,ar,vo).call(this)})}redo(){As(this,Qs).redo(),pr(this,ar,io).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:As(this,Qs).hasSomethingToRedo(),isEmpty:pr(this,ar,vo).call(this)})}addCommands(or){As(this,Qs).add(or),pr(this,ar,io).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:pr(this,ar,vo).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const or=[...As(this,Us)],Sr=()=>{for(const Ur of or)Ur.remove()},Mr=()=>{for(const Ur of or)pr(this,ar,Jo).call(this,Ur)};this.addCommands({cmd:Sr,undo:Mr,mustExec:!0})}commitOrRemove(){var or;(or=As(this,_s))==null||or.commitOrRemove()}hasSomethingToControl(){return As(this,_s)||this.hasSelection}selectAll(){for(const or of As(this,Us))or.commit();pr(this,ar,Qo).call(this,As(this,Ls).values())}unselectAll(){if(As(this,_s)){As(this,_s).commitOrRemove();return}if(this.hasSelection){for(const or of As(this,Us))or.unselect();As(this,Us).clear(),pr(this,ar,io).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(or,Sr,Mr=!1){if(Mr||this.commitOrRemove(),!this.hasSelection)return;As(this,Zs)[0]+=or,As(this,Zs)[1]+=Sr;const[Ur,zr]=As(this,Zs),Ir=[...As(this,Us)],Xs=1e3;As(this,dr)&&clearTimeout(As(this,dr)),jr(this,dr,setTimeout(()=>{jr(this,dr,null),As(this,Zs)[0]=As(this,Zs)[1]=0,this.addCommands({cmd:()=>{for(const Ks of Ir)As(this,Ls).has(Ks.id)&&Ks.translateInPage(Ur,zr)},undo:()=>{for(const Ks of Ir)As(this,Ls).has(Ks.id)&&Ks.translateInPage(-Ur,-zr)},mustExec:!1})},Xs));for(const Ks of Ir)Ks.translateInPage(or,Sr)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),jr(this,Is,new Map);for(const or of As(this,Us))As(this,Is).set(or,{savedX:or.x,savedY:or.y,savedPageIndex:or.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!As(this,Is))return!1;this.disableUserSelect(!1);const or=As(this,Is);jr(this,Is,null);let Sr=!1;for(const[{x:Ur,y:zr,pageIndex:Ir},Xs]of or)Xs.newX=Ur,Xs.newY=zr,Xs.newPageIndex=Ir,Sr||(Sr=Ur!==Xs.savedX||zr!==Xs.savedY||Ir!==Xs.savedPageIndex);if(!Sr)return!1;const Mr=(Ur,zr,Ir,Xs)=>{if(As(this,Ls).has(Ur.id)){const Ks=As(this,Os).get(Xs);Ks?Ur._setParentAndPosition(Ks,zr,Ir):(Ur.pageIndex=Xs,Ur.x=zr,Ur.y=Ir)}};return this.addCommands({cmd:()=>{for(const[Ur,{newX:zr,newY:Ir,newPageIndex:Xs}]of or)Mr(Ur,zr,Ir,Xs)},undo:()=>{for(const[Ur,{savedX:zr,savedY:Ir,savedPageIndex:Xs}]of or)Mr(Ur,zr,Ir,Xs)},mustExec:!0}),!0}dragSelectedEditors(or,Sr){if(As(this,Is))for(const Mr of As(this,Is).keys())Mr.drag(or,Sr)}rebuild(or){if(or.parent===null){const Sr=this.getLayer(or.pageIndex);Sr?(Sr.changeParent(or),Sr.addOrRebuild(or)):(this.addEditor(or),this.addToAnnotationStorage(or),or.rebuild())}else or.parent.addOrRebuild(or)}isActive(or){return As(this,_s)===or}getActive(){return As(this,_s)}getMode(){return As(this,Fs)}get imageManager(){return(0,rs.shadow)(this,"imageManager",new cs)}};_s=new WeakMap,Ls=new WeakMap,Os=new WeakMap,zs=new WeakMap,qs=new WeakMap,Qs=new WeakMap,Ys=new WeakMap,Ws=new WeakMap,Is=new WeakMap,Bs=new WeakMap,Vs=new WeakMap,Ds=new WeakMap,Cs=new WeakMap,Ts=new WeakMap,$s=new WeakMap,Ps=new WeakMap,Fs=new WeakMap,Us=new WeakMap,Gs=new WeakMap,hr=new WeakMap,ur=new WeakMap,cr=new WeakMap,Er=new WeakMap,Nr=new WeakMap,kr=new WeakMap,mr=new WeakMap,xr=new WeakMap,Ms=new WeakMap,Hs=new WeakMap,Js=new WeakMap,Zs=new WeakMap,dr=new WeakMap,br=new WeakMap,Rr=new WeakMap,ar=new WeakSet,Wl=function(){window.addEventListener("focus",As(this,ur)),window.addEventListener("blur",As(this,hr))},Ko=function(){window.removeEventListener("focus",As(this,ur)),window.removeEventListener("blur",As(this,hr))},qo=function(){window.addEventListener("keydown",As(this,kr),{capture:!0})},ko=function(){window.removeEventListener("keydown",As(this,kr),{capture:!0})},Yo=function(){document.addEventListener("copy",As(this,cr)),document.addEventListener("cut",As(this,Er)),document.addEventListener("paste",As(this,Nr))},Xo=function(){document.removeEventListener("copy",As(this,cr)),document.removeEventListener("cut",As(this,Er)),document.removeEventListener("paste",As(this,Nr))},io=function(or){Object.entries(or).some(([Mr,Ur])=>As(this,Js)[Mr]!==Ur)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(As(this,Js),or)})},jo=function(or){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:or})},zl=function(){if(!As(this,Ts)){jr(this,Ts,!0);for(const or of As(this,Os).values())or.enable()}},Vl=function(){if(this.unselectAll(),As(this,Ts)){jr(this,Ts,!1);for(const or of As(this,Os).values())or.disable()}},Jo=function(or){const Sr=As(this,Os).get(or.pageIndex);Sr?Sr.addOrRebuild(or):this.addEditor(or)},vo=function(){if(As(this,Ls).size===0)return!0;if(As(this,Ls).size===1)for(const or of As(this,Ls).values())return or.isEmpty();return!1},Qo=function(or){As(this,Us).clear();for(const Sr of or)Sr.isEmpty()||(As(this,Us).add(Sr),Sr.select());pr(this,ar,io).call(this,{hasSelectedEditor:!0})},eo(Qr,"TRANSLATE_SMALL",1),eo(Qr,"TRANSLATE_BIG",10);let ps=Qr;ts.AnnotationEditorUIManager=ps},(es,ts,ss)=>{var Ys,Ws,Is,Bs,Vs,Ds,Cs,Ts,$s,Ps,Fs,Us,po,mo,Zo,Co,_o,bo,yo;Object.defineProperty(ts,"__esModule",{value:!0}),ts.StatTimer=ts.RenderingCancelledException=ts.PixelsPerInch=ts.PageViewport=ts.PDFDateString=ts.DOMStandardFontDataFactory=ts.DOMSVGFactory=ts.DOMFilterFactory=ts.DOMCanvasFactory=ts.DOMCMapReaderFactory=void 0,ts.deprecated=Rs,ts.getColorValues=Ls,ts.getCurrentTransform=Os,ts.getCurrentTransformInverse=zs,ts.getFilenameFromUrl=gs,ts.getPdfFilenameFromUrl=fs,ts.getRGB=_s,ts.getXfaPageViewport=ks,ts.isDataScheme=ys,ts.isPdfFile=vs,ts.isValidFetchUrl=Ss,ts.loadScript=Es,ts.noContextMenu=bs,ts.setLayerDimensions=qs;var rs=ss(7),ns=ss(1);const os="http://www.w3.org/2000/svg",Qs=class Qs{};eo(Qs,"CSS",96),eo(Qs,"PDF",72),eo(Qs,"PDF_TO_CSS_UNITS",Qs.CSS/Qs.PDF);let as=Qs;ts.PixelsPerInch=as;class ls extends rs.BaseFilterFactory{constructor({docId:Ms,ownerDocument:Hs=globalThis.document}={}){super();fr(this,Us);fr(this,Ys);fr(this,Ws);fr(this,Is);fr(this,Bs);fr(this,Vs);fr(this,Ds);fr(this,Cs);fr(this,Ts);fr(this,$s);fr(this,Ps);fr(this,Fs,0);jr(this,Is,Ms),jr(this,Bs,Hs)}addFilter(Ms){if(!Ms)return"none";let Hs=As(this,Us,po).get(Ms);if(Hs)return Hs;let Js,Zs,dr,br;if(Ms.length===1){const Ar=Ms[0],Gr=new Array(256);for(let Dr=0;Dr<256;Dr++)Gr[Dr]=Ar[Dr]/255;br=Js=Zs=dr=Gr.join(",")}else{const[Ar,Gr,Dr]=Ms,Yr=new Array(256),$r=new Array(256),Vr=new Array(256);for(let Zr=0;Zr<256;Zr++)Yr[Zr]=Ar[Zr]/255,$r[Zr]=Gr[Zr]/255,Vr[Zr]=Dr[Zr]/255;Js=Yr.join(","),Zs=$r.join(","),dr=Vr.join(","),br=`${Js}${Zs}${dr}`}if(Hs=As(this,Us,po).get(br),Hs)return As(this,Us,po).set(Ms,Hs),Hs;const Rr=`g_${As(this,Is)}_transfer_map_${go(this,Fs)._++}`,ar=`url(#${Rr})`;As(this,Us,po).set(Ms,ar),As(this,Us,po).set(br,ar);const Pr=pr(this,Us,Co).call(this,Rr);return pr(this,Us,bo).call(this,Js,Zs,dr,Pr),ar}addHCMFilter(Ms,Hs){var Gr;const Js=`${Ms}-${Hs}`;if(As(this,Ds)===Js)return As(this,Cs);if(jr(this,Ds,Js),jr(this,Cs,"none"),(Gr=As(this,Vs))==null||Gr.remove(),!Ms||!Hs)return As(this,Cs);const Zs=pr(this,Us,yo).call(this,Ms);Ms=ns.Util.makeHexColor(...Zs);const dr=pr(this,Us,yo).call(this,Hs);if(Hs=ns.Util.makeHexColor(...dr),As(this,Us,mo).style.color="",Ms==="#000000"&&Hs==="#ffffff"||Ms===Hs)return As(this,Cs);const br=new Array(256);for(let Dr=0;Dr<=255;Dr++){const Yr=Dr/255;br[Dr]=Yr<=.03928?Yr/12.92:((Yr+.055)/1.055)**2.4}const Rr=br.join(","),ar=`g_${As(this,Is)}_hcm_filter`,Pr=jr(this,Ts,pr(this,Us,Co).call(this,ar));pr(this,Us,bo).call(this,Rr,Rr,Rr,Pr),pr(this,Us,Zo).call(this,Pr);const Ar=(Dr,Yr)=>{const $r=Zs[Dr]/255,Vr=dr[Dr]/255,Zr=new Array(Yr+1);for(let to=0;to<=Yr;to++)Zr[to]=$r+to/Yr*(Vr-$r);return Zr.join(",")};return pr(this,Us,bo).call(this,Ar(0,5),Ar(1,5),Ar(2,5),Pr),jr(this,Cs,`url(#${ar})`),As(this,Cs)}addHighlightHCMFilter(Ms,Hs,Js,Zs){var Vr;const dr=`${Ms}-${Hs}-${Js}-${Zs}`;if(As(this,$s)===dr)return As(this,Ps);if(jr(this,$s,dr),jr(this,Ps,"none"),(Vr=As(this,Ts))==null||Vr.remove(),!Ms||!Hs)return As(this,Ps);const[br,Rr]=[Ms,Hs].map(pr(this,Us,yo).bind(this));let ar=Math.round(.2126*br[0]+.7152*br[1]+.0722*br[2]),Pr=Math.round(.2126*Rr[0]+.7152*Rr[1]+.0722*Rr[2]),[Ar,Gr]=[Js,Zs].map(pr(this,Us,yo).bind(this));Pr<ar&&([ar,Pr,Ar,Gr]=[Pr,ar,Gr,Ar]),As(this,Us,mo).style.color="";const Dr=(Zr,to,_r)=>{const gr=new Array(256),vr=(Pr-ar)/_r,Or=Zr/255,Qr=(to-Zr)/(255*_r);let Jr=0;for(let or=0;or<=_r;or++){const Sr=Math.round(ar+or*vr),Mr=Or+or*Qr;for(let Ur=Jr;Ur<=Sr;Ur++)gr[Ur]=Mr;Jr=Sr+1}for(let or=Jr;or<256;or++)gr[or]=gr[Jr-1];return gr.join(",")},Yr=`g_${As(this,Is)}_hcm_highlight_filter`,$r=jr(this,Ts,pr(this,Us,Co).call(this,Yr));return pr(this,Us,Zo).call(this,$r),pr(this,Us,bo).call(this,Dr(Ar[0],Gr[0],5),Dr(Ar[1],Gr[1],5),Dr(Ar[2],Gr[2],5),$r),jr(this,Ps,`url(#${Yr})`),As(this,Ps)}destroy(Ms=!1){Ms&&(As(this,Cs)||As(this,Ps))||(As(this,Ws)&&(As(this,Ws).parentNode.parentNode.remove(),jr(this,Ws,null)),As(this,Ys)&&(As(this,Ys).clear(),jr(this,Ys,null)),jr(this,Fs,0))}}Ys=new WeakMap,Ws=new WeakMap,Is=new WeakMap,Bs=new WeakMap,Vs=new WeakMap,Ds=new WeakMap,Cs=new WeakMap,Ts=new WeakMap,$s=new WeakMap,Ps=new WeakMap,Fs=new WeakMap,Us=new WeakSet,po=function(){return As(this,Ys)||jr(this,Ys,new Map)},mo=function(){if(!As(this,Ws)){const Ms=As(this,Bs).createElement("div"),{style:Hs}=Ms;Hs.visibility="hidden",Hs.contain="strict",Hs.width=Hs.height=0,Hs.position="absolute",Hs.top=Hs.left=0,Hs.zIndex=-1;const Js=As(this,Bs).createElementNS(os,"svg");Js.setAttribute("width",0),Js.setAttribute("height",0),jr(this,Ws,As(this,Bs).createElementNS(os,"defs")),Ms.append(Js),Js.append(As(this,Ws)),As(this,Bs).body.append(Ms)}return As(this,Ws)},Zo=function(Ms){const Hs=As(this,Bs).createElementNS(os,"feColorMatrix");Hs.setAttribute("type","matrix"),Hs.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),Ms.append(Hs)},Co=function(Ms){const Hs=As(this,Bs).createElementNS(os,"filter");return Hs.setAttribute("color-interpolation-filters","sRGB"),Hs.setAttribute("id",Ms),As(this,Us,mo).append(Hs),Hs},_o=function(Ms,Hs,Js){const Zs=As(this,Bs).createElementNS(os,Hs);Zs.setAttribute("type","discrete"),Zs.setAttribute("tableValues",Js),Ms.append(Zs)},bo=function(Ms,Hs,Js,Zs){const dr=As(this,Bs).createElementNS(os,"feComponentTransfer");Zs.append(dr),pr(this,Us,_o).call(this,dr,"feFuncR",Ms),pr(this,Us,_o).call(this,dr,"feFuncG",Hs),pr(this,Us,_o).call(this,dr,"feFuncB",Js)},yo=function(Ms){return As(this,Us,mo).style.color=Ms,_s(getComputedStyle(As(this,Us,mo)).getPropertyValue("color"))},ts.DOMFilterFactory=ls;class cs extends rs.BaseCanvasFactory{constructor({ownerDocument:xr=globalThis.document}={}){super(),this._document=xr}_createCanvas(xr,Ms){const Hs=this._document.createElement("canvas");return Hs.width=xr,Hs.height=Ms,Hs}}ts.DOMCanvasFactory=cs;async function us(mr,xr=!1){if(Ss(mr,document.baseURI)){const Ms=await fetch(mr);if(!Ms.ok)throw new Error(Ms.statusText);return xr?new Uint8Array(await Ms.arrayBuffer()):(0,ns.stringToBytes)(await Ms.text())}return new Promise((Ms,Hs)=>{const Js=new XMLHttpRequest;Js.open("GET",mr,!0),xr&&(Js.responseType="arraybuffer"),Js.onreadystatechange=()=>{if(Js.readyState===XMLHttpRequest.DONE){if(Js.status===200||Js.status===0){let Zs;if(xr&&Js.response?Zs=new Uint8Array(Js.response):!xr&&Js.responseText&&(Zs=(0,ns.stringToBytes)(Js.responseText)),Zs){Ms(Zs);return}}Hs(new Error(Js.statusText))}},Js.send(null)})}class ds extends rs.BaseCMapReaderFactory{_fetchData(xr,Ms){return us(xr,this.isCompressed).then(Hs=>({cMapData:Hs,compressionType:Ms}))}}ts.DOMCMapReaderFactory=ds;class ms extends rs.BaseStandardFontDataFactory{_fetchData(xr){return us(xr,!0)}}ts.DOMStandardFontDataFactory=ms;class ps extends rs.BaseSVGFactory{_createSVG(xr){return document.createElementNS(os,xr)}}ts.DOMSVGFactory=ps;class hs{constructor({viewBox:xr,scale:Ms,rotation:Hs,offsetX:Js=0,offsetY:Zs=0,dontFlip:dr=!1}){this.viewBox=xr,this.scale=Ms,this.rotation=Hs,this.offsetX=Js,this.offsetY=Zs;const br=(xr[2]+xr[0])/2,Rr=(xr[3]+xr[1])/2;let ar,Pr,Ar,Gr;switch(Hs%=360,Hs<0&&(Hs+=360),Hs){case 180:ar=-1,Pr=0,Ar=0,Gr=1;break;case 90:ar=0,Pr=1,Ar=1,Gr=0;break;case 270:ar=0,Pr=-1,Ar=-1,Gr=0;break;case 0:ar=1,Pr=0,Ar=0,Gr=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}dr&&(Ar=-Ar,Gr=-Gr);let Dr,Yr,$r,Vr;ar===0?(Dr=Math.abs(Rr-xr[1])*Ms+Js,Yr=Math.abs(br-xr[0])*Ms+Zs,$r=(xr[3]-xr[1])*Ms,Vr=(xr[2]-xr[0])*Ms):(Dr=Math.abs(br-xr[0])*Ms+Js,Yr=Math.abs(Rr-xr[1])*Ms+Zs,$r=(xr[2]-xr[0])*Ms,Vr=(xr[3]-xr[1])*Ms),this.transform=[ar*Ms,Pr*Ms,Ar*Ms,Gr*Ms,Dr-ar*Ms*br-Ar*Ms*Rr,Yr-Pr*Ms*br-Gr*Ms*Rr],this.width=$r,this.height=Vr}get rawDims(){const{viewBox:xr}=this;return(0,ns.shadow)(this,"rawDims",{pageWidth:xr[2]-xr[0],pageHeight:xr[3]-xr[1],pageX:xr[0],pageY:xr[1]})}clone({scale:xr=this.scale,rotation:Ms=this.rotation,offsetX:Hs=this.offsetX,offsetY:Js=this.offsetY,dontFlip:Zs=!1}={}){return new hs({viewBox:this.viewBox.slice(),scale:xr,rotation:Ms,offsetX:Hs,offsetY:Js,dontFlip:Zs})}convertToViewportPoint(xr,Ms){return ns.Util.applyTransform([xr,Ms],this.transform)}convertToViewportRectangle(xr){const Ms=ns.Util.applyTransform([xr[0],xr[1]],this.transform),Hs=ns.Util.applyTransform([xr[2],xr[3]],this.transform);return[Ms[0],Ms[1],Hs[0],Hs[1]]}convertToPdfPoint(xr,Ms){return ns.Util.applyInverseTransform([xr,Ms],this.transform)}}ts.PageViewport=hs;class xs extends ns.BaseException{constructor(xr,Ms=0){super(xr,"RenderingCancelledException"),this.extraDelay=Ms}}ts.RenderingCancelledException=xs;function ys(mr){const xr=mr.length;let Ms=0;for(;Ms<xr&&mr[Ms].trim()==="";)Ms++;return mr.substring(Ms,Ms+5).toLowerCase()==="data:"}function vs(mr){return typeof mr=="string"&&/\.pdf$/i.test(mr)}function gs(mr,xr=!1){return xr||([mr]=mr.split(/[#?]/,1)),mr.substring(mr.lastIndexOf("/")+1)}function fs(mr,xr="document.pdf"){if(typeof mr!="string")return xr;if(ys(mr))return(0,ns.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),xr;const Ms=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Hs=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Js=Ms.exec(mr);let Zs=Hs.exec(Js[1])||Hs.exec(Js[2])||Hs.exec(Js[3]);if(Zs&&(Zs=Zs[0],Zs.includes("%")))try{Zs=Hs.exec(decodeURIComponent(Zs))[0]}catch{}return Zs||xr}class js{constructor(){eo(this,"started",Object.create(null));eo(this,"times",[])}time(xr){xr in this.started&&(0,ns.warn)(`Timer is already running for ${xr}`),this.started[xr]=Date.now()}timeEnd(xr){xr in this.started||(0,ns.warn)(`Timer has not been started for ${xr}`),this.times.push({name:xr,start:this.started[xr],end:Date.now()}),delete this.started[xr]}toString(){const xr=[];let Ms=0;for(const{name:Hs}of this.times)Ms=Math.max(Hs.length,Ms);for(const{name:Hs,start:Js,end:Zs}of this.times)xr.push(`${Hs.padEnd(Ms)} ${Zs-Js}ms
`);return xr.join("")}}ts.StatTimer=js;function Ss(mr,xr){try{const{protocol:Ms}=xr?new URL(mr,xr):new URL(mr);return Ms==="http:"||Ms==="https:"}catch{return!1}}function bs(mr){mr.preventDefault()}function Es(mr,xr=!1){return new Promise((Ms,Hs)=>{const Js=document.createElement("script");Js.src=mr,Js.onload=function(Zs){xr&&Js.remove(),Ms(Zs)},Js.onerror=function(){Hs(new Error(`Cannot load script at: ${Js.src}`))},(document.head||document.documentElement).append(Js)})}function Rs(mr){console.log("Deprecated API usage: "+mr)}let ws;class Ns{static toDateObject(xr){if(!xr||typeof xr!="string")return null;ws||(ws=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const Ms=ws.exec(xr);if(!Ms)return null;const Hs=parseInt(Ms[1],10);let Js=parseInt(Ms[2],10);Js=Js>=1&&Js<=12?Js-1:0;let Zs=parseInt(Ms[3],10);Zs=Zs>=1&&Zs<=31?Zs:1;let dr=parseInt(Ms[4],10);dr=dr>=0&&dr<=23?dr:0;let br=parseInt(Ms[5],10);br=br>=0&&br<=59?br:0;let Rr=parseInt(Ms[6],10);Rr=Rr>=0&&Rr<=59?Rr:0;const ar=Ms[7]||"Z";let Pr=parseInt(Ms[8],10);Pr=Pr>=0&&Pr<=23?Pr:0;let Ar=parseInt(Ms[9],10)||0;return Ar=Ar>=0&&Ar<=59?Ar:0,ar==="-"?(dr+=Pr,br+=Ar):ar==="+"&&(dr-=Pr,br-=Ar),new Date(Date.UTC(Hs,Js,Zs,dr,br,Rr))}}ts.PDFDateString=Ns;function ks(mr,{scale:xr=1,rotation:Ms=0}){const{width:Hs,height:Js}=mr.attributes.style,Zs=[0,0,parseInt(Hs),parseInt(Js)];return new hs({viewBox:Zs,scale:xr,rotation:Ms})}function _s(mr){if(mr.startsWith("#")){const xr=parseInt(mr.slice(1),16);return[(xr&16711680)>>16,(xr&65280)>>8,xr&255]}return mr.startsWith("rgb(")?mr.slice(4,-1).split(",").map(xr=>parseInt(xr)):mr.startsWith("rgba(")?mr.slice(5,-1).split(",").map(xr=>parseInt(xr)).slice(0,3):((0,ns.warn)(`Not a valid color format: "${mr}"`),[0,0,0])}function Ls(mr){const xr=document.createElement("span");xr.style.visibility="hidden",document.body.append(xr);for(const Ms of mr.keys()){xr.style.color=Ms;const Hs=window.getComputedStyle(xr).color;mr.set(Ms,_s(Hs))}xr.remove()}function Os(mr){const{a:xr,b:Ms,c:Hs,d:Js,e:Zs,f:dr}=mr.getTransform();return[xr,Ms,Hs,Js,Zs,dr]}function zs(mr){const{a:xr,b:Ms,c:Hs,d:Js,e:Zs,f:dr}=mr.getTransform().invertSelf();return[xr,Ms,Hs,Js,Zs,dr]}function qs(mr,xr,Ms=!1,Hs=!0){if(xr instanceof hs){const{pageWidth:Js,pageHeight:Zs}=xr.rawDims,{style:dr}=mr,br=ns.FeatureTest.isCSSRoundSupported,Rr=`var(--scale-factor) * ${Js}px`,ar=`var(--scale-factor) * ${Zs}px`,Pr=br?`round(${Rr}, 1px)`:`calc(${Rr})`,Ar=br?`round(${ar}, 1px)`:`calc(${ar})`;!Ms||xr.rotation%180===0?(dr.width=Pr,dr.height=Ar):(dr.width=Ar,dr.height=Pr)}Hs&&mr.setAttribute("data-main-rotation",xr.rotation)}},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.BaseStandardFontDataFactory=ts.BaseSVGFactory=ts.BaseFilterFactory=ts.BaseCanvasFactory=ts.BaseCMapReaderFactory=void 0;var rs=ss(1);class ns{constructor(){this.constructor===ns&&(0,rs.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(ds){return"none"}addHCMFilter(ds,ms){return"none"}addHighlightHCMFilter(ds,ms,ps,hs){return"none"}destroy(ds=!1){}}ts.BaseFilterFactory=ns;class os{constructor(){this.constructor===os&&(0,rs.unreachable)("Cannot initialize BaseCanvasFactory.")}create(ds,ms){if(ds<=0||ms<=0)throw new Error("Invalid canvas size");const ps=this._createCanvas(ds,ms);return{canvas:ps,context:ps.getContext("2d")}}reset(ds,ms,ps){if(!ds.canvas)throw new Error("Canvas is not specified");if(ms<=0||ps<=0)throw new Error("Invalid canvas size");ds.canvas.width=ms,ds.canvas.height=ps}destroy(ds){if(!ds.canvas)throw new Error("Canvas is not specified");ds.canvas.width=0,ds.canvas.height=0,ds.canvas=null,ds.context=null}_createCanvas(ds,ms){(0,rs.unreachable)("Abstract method `_createCanvas` called.")}}ts.BaseCanvasFactory=os;class as{constructor({baseUrl:ds=null,isCompressed:ms=!0}){this.constructor===as&&(0,rs.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=ds,this.isCompressed=ms}async fetch({name:ds}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!ds)throw new Error("CMap name must be specified.");const ms=this.baseUrl+ds+(this.isCompressed?".bcmap":""),ps=this.isCompressed?rs.CMapCompressionType.BINARY:rs.CMapCompressionType.NONE;return this._fetchData(ms,ps).catch(hs=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${ms}`)})}_fetchData(ds,ms){(0,rs.unreachable)("Abstract method `_fetchData` called.")}}ts.BaseCMapReaderFactory=as;class ls{constructor({baseUrl:ds=null}){this.constructor===ls&&(0,rs.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=ds}async fetch({filename:ds}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!ds)throw new Error("Font filename must be specified.");const ms=`${this.baseUrl}${ds}`;return this._fetchData(ms).catch(ps=>{throw new Error(`Unable to load font data at: ${ms}`)})}_fetchData(ds){(0,rs.unreachable)("Abstract method `_fetchData` called.")}}ts.BaseStandardFontDataFactory=ls;class cs{constructor(){this.constructor===cs&&(0,rs.unreachable)("Cannot initialize BaseSVGFactory.")}create(ds,ms,ps=!1){if(ds<=0||ms<=0)throw new Error("Invalid SVG dimensions");const hs=this._createSVG("svg:svg");return hs.setAttribute("version","1.1"),ps||(hs.setAttribute("width",`${ds}px`),hs.setAttribute("height",`${ms}px`)),hs.setAttribute("preserveAspectRatio","none"),hs.setAttribute("viewBox",`0 0 ${ds} ${ms}`),hs}createElement(ds){if(typeof ds!="string")throw new Error("Invalid SVG element type");return this._createSVG(ds)}_createSVG(ds){(0,rs.unreachable)("Abstract method `_createSVG` called.")}}ts.BaseSVGFactory=cs},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.MurmurHash3_64=void 0;var rs=ss(1);const ns=3285377520,os=4294901760,as=65535;class ls{constructor(us){this.h1=us?us&4294967295:ns,this.h2=us?us&4294967295:ns}update(us){let ds,ms;if(typeof us=="string"){ds=new Uint8Array(us.length*2),ms=0;for(let Rs=0,ws=us.length;Rs<ws;Rs++){const Ns=us.charCodeAt(Rs);Ns<=255?ds[ms++]=Ns:(ds[ms++]=Ns>>>8,ds[ms++]=Ns&255)}}else if((0,rs.isArrayBuffer)(us))ds=us.slice(),ms=ds.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const ps=ms>>2,hs=ms-ps*4,xs=new Uint32Array(ds.buffer,0,ps);let ys=0,vs=0,gs=this.h1,fs=this.h2;const js=3432918353,Ss=461845907,bs=js&as,Es=Ss&as;for(let Rs=0;Rs<ps;Rs++)Rs&1?(ys=xs[Rs],ys=ys*js&os|ys*bs&as,ys=ys<<15|ys>>>17,ys=ys*Ss&os|ys*Es&as,gs^=ys,gs=gs<<13|gs>>>19,gs=gs*5+3864292196):(vs=xs[Rs],vs=vs*js&os|vs*bs&as,vs=vs<<15|vs>>>17,vs=vs*Ss&os|vs*Es&as,fs^=vs,fs=fs<<13|fs>>>19,fs=fs*5+3864292196);switch(ys=0,hs){case 3:ys^=ds[ps*4+2]<<16;case 2:ys^=ds[ps*4+1]<<8;case 1:ys^=ds[ps*4],ys=ys*js&os|ys*bs&as,ys=ys<<15|ys>>>17,ys=ys*Ss&os|ys*Es&as,ps&1?gs^=ys:fs^=ys}this.h1=gs,this.h2=fs}hexdigest(){let us=this.h1,ds=this.h2;return us^=ds>>>1,us=us*3981806797&os|us*36045&as,ds=ds*4283543511&os|((ds<<16|us>>>16)*2950163797&os)>>>16,us^=ds>>>1,us=us*444984403&os|us*60499&as,ds=ds*3301882366&os|((ds<<16|us>>>16)*3120437893&os)>>>16,us^=ds>>>1,(us>>>0).toString(16).padStart(8,"0")+(ds>>>0).toString(16).padStart(8,"0")}}ts.MurmurHash3_64=ls},(es,ts,ss)=>{var as;Object.defineProperty(ts,"__esModule",{value:!0}),ts.FontLoader=ts.FontFaceObject=void 0;var rs=ss(1);class ns{constructor({ownerDocument:cs=globalThis.document,styleElement:us=null}){fr(this,as,new Set);this._document=cs,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(cs){this.nativeFontFaces.add(cs),this._document.fonts.add(cs)}removeNativeFontFace(cs){this.nativeFontFaces.delete(cs),this._document.fonts.delete(cs)}insertRule(cs){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const us=this.styleElement.sheet;us.insertRule(cs,us.cssRules.length)}clear(){for(const cs of this.nativeFontFaces)this._document.fonts.delete(cs);this.nativeFontFaces.clear(),As(this,as).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(cs){if(!(!cs||As(this,as).has(cs.loadedName))){if((0,rs.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:us,src:ds,style:ms}=cs,ps=new FontFace(us,ds,ms);this.addNativeFontFace(ps);try{await ps.load(),As(this,as).add(us)}catch{(0,rs.warn)(`Cannot load system font: ${cs.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(ps)}return}(0,rs.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(cs){if(cs.attached||cs.missingFile&&!cs.systemFontInfo)return;if(cs.attached=!0,cs.systemFontInfo){await this.loadSystemFont(cs.systemFontInfo);return}if(this.isFontLoadingAPISupported){const ds=cs.createNativeFontFace();if(ds){this.addNativeFontFace(ds);try{await ds.loaded}catch(ms){throw(0,rs.warn)(`Failed to load font '${ds.family}': '${ms}'.`),cs.disableFontFace=!0,ms}}return}const us=cs.createFontFaceRule();if(us){if(this.insertRule(us),this.isSyncFontLoadingSupported)return;await new Promise(ds=>{const ms=this._queueLoadingCallback(ds);this._prepareFontLoadEvent(cs,ms)})}}get isFontLoadingAPISupported(){var us;const cs=!!((us=this._document)!=null&&us.fonts);return(0,rs.shadow)(this,"isFontLoadingAPISupported",cs)}get isSyncFontLoadingSupported(){let cs=!1;return(rs.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(cs=!0),(0,rs.shadow)(this,"isSyncFontLoadingSupported",cs)}_queueLoadingCallback(cs){function us(){for((0,rs.assert)(!ms.done,"completeRequest() cannot be called twice."),ms.done=!0;ds.length>0&&ds[0].done;){const ps=ds.shift();setTimeout(ps.callback,0)}}const{loadingRequests:ds}=this,ms={done:!1,complete:us,callback:cs};return ds.push(ms),ms}get _loadTestFont(){const cs=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,rs.shadow)(this,"_loadTestFont",cs)}_prepareFontLoadEvent(cs,us){function ds(_s,Ls){return _s.charCodeAt(Ls)<<24|_s.charCodeAt(Ls+1)<<16|_s.charCodeAt(Ls+2)<<8|_s.charCodeAt(Ls+3)&255}function ms(_s,Ls,Os,zs){const qs=_s.substring(0,Ls),Qs=_s.substring(Ls+Os);return qs+zs+Qs}let ps,hs;const xs=this._document.createElement("canvas");xs.width=1,xs.height=1;const ys=xs.getContext("2d");let vs=0;function gs(_s,Ls){if(++vs>30){(0,rs.warn)("Load test font never loaded."),Ls();return}if(ys.font="30px "+_s,ys.fillText(".",0,20),ys.getImageData(0,0,1,1).data[3]>0){Ls();return}setTimeout(gs.bind(null,_s,Ls))}const fs=`lt${Date.now()}${this.loadTestFontId++}`;let js=this._loadTestFont;js=ms(js,976,fs.length,fs);const bs=16,Es=1482184792;let Rs=ds(js,bs);for(ps=0,hs=fs.length-3;ps<hs;ps+=4)Rs=Rs-Es+ds(fs,ps)|0;ps<fs.length&&(Rs=Rs-Es+ds(fs+"XXX",ps)|0),js=ms(js,bs,4,(0,rs.string32)(Rs));const ws=`url(data:font/opentype;base64,${btoa(js)});`,Ns=`@font-face {font-family:"${fs}";src:${ws}}`;this.insertRule(Ns);const ks=this._document.createElement("div");ks.style.visibility="hidden",ks.style.width=ks.style.height="10px",ks.style.position="absolute",ks.style.top=ks.style.left="0px";for(const _s of[cs.loadedName,fs]){const Ls=this._document.createElement("span");Ls.textContent="Hi",Ls.style.fontFamily=_s,ks.append(Ls)}this._document.body.append(ks),gs(fs,()=>{ks.remove(),us.complete()})}}as=new WeakMap,ts.FontLoader=ns;class os{constructor(cs,{isEvalSupported:us=!0,disableFontFace:ds=!1,ignoreErrors:ms=!1,inspectFont:ps=null}){this.compiledGlyphs=Object.create(null);for(const hs in cs)this[hs]=cs[hs];this.isEvalSupported=us!==!1,this.disableFontFace=ds===!0,this.ignoreErrors=ms===!0,this._inspectFont=ps}createNativeFontFace(){var us;if(!this.data||this.disableFontFace)return null;let cs;if(!this.cssFontInfo)cs=new FontFace(this.loadedName,this.data,{});else{const ds={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(ds.style=`oblique ${this.cssFontInfo.italicAngle}deg`),cs=new FontFace(this.cssFontInfo.fontFamily,this.data,ds)}return(us=this._inspectFont)==null||us.call(this,this),cs}createFontFaceRule(){var ms;if(!this.data||this.disableFontFace)return null;const cs=(0,rs.bytesToString)(this.data),us=`url(data:${this.mimetype};base64,${btoa(cs)});`;let ds;if(!this.cssFontInfo)ds=`@font-face {font-family:"${this.loadedName}";src:${us}}`;else{let ps=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(ps+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),ds=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${ps}src:${us}}`}return(ms=this._inspectFont)==null||ms.call(this,this,us),ds}getPathGenerator(cs,us){if(this.compiledGlyphs[us]!==void 0)return this.compiledGlyphs[us];let ds;try{ds=cs.get(this.loadedName+"_path_"+us)}catch(ms){if(!this.ignoreErrors)throw ms;return(0,rs.warn)(`getPathGenerator - ignoring character: "${ms}".`),this.compiledGlyphs[us]=function(ps,hs){}}if(this.isEvalSupported&&rs.FeatureTest.isEvalSupported){const ms=[];for(const ps of ds){const hs=ps.args!==void 0?ps.args.join(","):"";ms.push("c.",ps.cmd,"(",hs,`);
`)}return this.compiledGlyphs[us]=new Function("c","size",ms.join(""))}return this.compiledGlyphs[us]=function(ms,ps){for(const hs of ds)hs.cmd==="scale"&&(hs.args=[ps,-ps]),ms[hs.cmd].apply(ms,hs.args)}}}ts.FontFaceObject=os},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.NodeStandardFontDataFactory=ts.NodeFilterFactory=ts.NodeCanvasFactory=ts.NodeCMapReaderFactory=void 0;var rs=ss(7);ss(1);const ns=function(us){return new Promise((ds,ms)=>{require$$5.readFile(us,(hs,xs)=>{if(hs||!xs){ms(new Error(hs));return}ds(new Uint8Array(xs))})})};class os extends rs.BaseFilterFactory{}ts.NodeFilterFactory=os;class as extends rs.BaseCanvasFactory{_createCanvas(ds,ms){return require$$5.createCanvas(ds,ms)}}ts.NodeCanvasFactory=as;class ls extends rs.BaseCMapReaderFactory{_fetchData(ds,ms){return ns(ds).then(ps=>({cMapData:ps,compressionType:ms}))}}ts.NodeCMapReaderFactory=ls;class cs extends rs.BaseStandardFontDataFactory{_fetchData(ds){return ns(ds)}}ts.NodeStandardFontDataFactory=cs},(es,ts,ss)=>{var Ws,na,xa;Object.defineProperty(ts,"__esModule",{value:!0}),ts.CanvasGraphics=void 0;var rs=ss(1),ns=ss(6),os=ss(12),as=ss(13);const ls=16,cs=100,us=4096,ds=15,ms=10,ps=1e3,hs=16;function xs(Ds,Cs){if(Ds._removeMirroring)throw new Error("Context is already forwarding operations.");Ds.__originalSave=Ds.save,Ds.__originalRestore=Ds.restore,Ds.__originalRotate=Ds.rotate,Ds.__originalScale=Ds.scale,Ds.__originalTranslate=Ds.translate,Ds.__originalTransform=Ds.transform,Ds.__originalSetTransform=Ds.setTransform,Ds.__originalResetTransform=Ds.resetTransform,Ds.__originalClip=Ds.clip,Ds.__originalMoveTo=Ds.moveTo,Ds.__originalLineTo=Ds.lineTo,Ds.__originalBezierCurveTo=Ds.bezierCurveTo,Ds.__originalRect=Ds.rect,Ds.__originalClosePath=Ds.closePath,Ds.__originalBeginPath=Ds.beginPath,Ds._removeMirroring=()=>{Ds.save=Ds.__originalSave,Ds.restore=Ds.__originalRestore,Ds.rotate=Ds.__originalRotate,Ds.scale=Ds.__originalScale,Ds.translate=Ds.__originalTranslate,Ds.transform=Ds.__originalTransform,Ds.setTransform=Ds.__originalSetTransform,Ds.resetTransform=Ds.__originalResetTransform,Ds.clip=Ds.__originalClip,Ds.moveTo=Ds.__originalMoveTo,Ds.lineTo=Ds.__originalLineTo,Ds.bezierCurveTo=Ds.__originalBezierCurveTo,Ds.rect=Ds.__originalRect,Ds.closePath=Ds.__originalClosePath,Ds.beginPath=Ds.__originalBeginPath,delete Ds._removeMirroring},Ds.save=function(){Cs.save(),this.__originalSave()},Ds.restore=function(){Cs.restore(),this.__originalRestore()},Ds.translate=function($s,Ps){Cs.translate($s,Ps),this.__originalTranslate($s,Ps)},Ds.scale=function($s,Ps){Cs.scale($s,Ps),this.__originalScale($s,Ps)},Ds.transform=function($s,Ps,Fs,Us,Gs,hr){Cs.transform($s,Ps,Fs,Us,Gs,hr),this.__originalTransform($s,Ps,Fs,Us,Gs,hr)},Ds.setTransform=function($s,Ps,Fs,Us,Gs,hr){Cs.setTransform($s,Ps,Fs,Us,Gs,hr),this.__originalSetTransform($s,Ps,Fs,Us,Gs,hr)},Ds.resetTransform=function(){Cs.resetTransform(),this.__originalResetTransform()},Ds.rotate=function($s){Cs.rotate($s),this.__originalRotate($s)},Ds.clip=function($s){Cs.clip($s),this.__originalClip($s)},Ds.moveTo=function(Ts,$s){Cs.moveTo(Ts,$s),this.__originalMoveTo(Ts,$s)},Ds.lineTo=function(Ts,$s){Cs.lineTo(Ts,$s),this.__originalLineTo(Ts,$s)},Ds.bezierCurveTo=function(Ts,$s,Ps,Fs,Us,Gs){Cs.bezierCurveTo(Ts,$s,Ps,Fs,Us,Gs),this.__originalBezierCurveTo(Ts,$s,Ps,Fs,Us,Gs)},Ds.rect=function(Ts,$s,Ps,Fs){Cs.rect(Ts,$s,Ps,Fs),this.__originalRect(Ts,$s,Ps,Fs)},Ds.closePath=function(){Cs.closePath(),this.__originalClosePath()},Ds.beginPath=function(){Cs.beginPath(),this.__originalBeginPath()}}class ys{constructor(Cs){this.canvasFactory=Cs,this.cache=Object.create(null)}getCanvas(Cs,Ts,$s){let Ps;return this.cache[Cs]!==void 0?(Ps=this.cache[Cs],this.canvasFactory.reset(Ps,Ts,$s)):(Ps=this.canvasFactory.create(Ts,$s),this.cache[Cs]=Ps),Ps}delete(Cs){delete this.cache[Cs]}clear(){for(const Cs in this.cache){const Ts=this.cache[Cs];this.canvasFactory.destroy(Ts),delete this.cache[Cs]}}}function vs(Ds,Cs,Ts,$s,Ps,Fs,Us,Gs,hr,ur){const[cr,Er,Nr,kr,mr,xr]=(0,ns.getCurrentTransform)(Ds);if(Er===0&&Nr===0){const Js=Us*cr+mr,Zs=Math.round(Js),dr=Gs*kr+xr,br=Math.round(dr),Rr=(Us+hr)*cr+mr,ar=Math.abs(Math.round(Rr)-Zs)||1,Pr=(Gs+ur)*kr+xr,Ar=Math.abs(Math.round(Pr)-br)||1;return Ds.setTransform(Math.sign(cr),0,0,Math.sign(kr),Zs,br),Ds.drawImage(Cs,Ts,$s,Ps,Fs,0,0,ar,Ar),Ds.setTransform(cr,Er,Nr,kr,mr,xr),[ar,Ar]}if(cr===0&&kr===0){const Js=Gs*Nr+mr,Zs=Math.round(Js),dr=Us*Er+xr,br=Math.round(dr),Rr=(Gs+ur)*Nr+mr,ar=Math.abs(Math.round(Rr)-Zs)||1,Pr=(Us+hr)*Er+xr,Ar=Math.abs(Math.round(Pr)-br)||1;return Ds.setTransform(0,Math.sign(Er),Math.sign(Nr),0,Zs,br),Ds.drawImage(Cs,Ts,$s,Ps,Fs,0,0,Ar,ar),Ds.setTransform(cr,Er,Nr,kr,mr,xr),[Ar,ar]}Ds.drawImage(Cs,Ts,$s,Ps,Fs,Us,Gs,hr,ur);const Ms=Math.hypot(cr,Er),Hs=Math.hypot(Nr,kr);return[Ms*hr,Hs*ur]}function gs(Ds){const{width:Cs,height:Ts}=Ds;if(Cs>ps||Ts>ps)return null;const $s=1e3,Ps=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),Fs=Cs+1;let Us=new Uint8Array(Fs*(Ts+1)),Gs,hr,ur;const cr=Cs+7&-8;let Er=new Uint8Array(cr*Ts),Nr=0;for(const Hs of Ds.data){let Js=128;for(;Js>0;)Er[Nr++]=Hs&Js?0:255,Js>>=1}let kr=0;for(Nr=0,Er[Nr]!==0&&(Us[0]=1,++kr),hr=1;hr<Cs;hr++)Er[Nr]!==Er[Nr+1]&&(Us[hr]=Er[Nr]?2:1,++kr),Nr++;for(Er[Nr]!==0&&(Us[hr]=2,++kr),Gs=1;Gs<Ts;Gs++){Nr=Gs*cr,ur=Gs*Fs,Er[Nr-cr]!==Er[Nr]&&(Us[ur]=Er[Nr]?1:8,++kr);let Hs=(Er[Nr]?4:0)+(Er[Nr-cr]?8:0);for(hr=1;hr<Cs;hr++)Hs=(Hs>>2)+(Er[Nr+1]?4:0)+(Er[Nr-cr+1]?8:0),Ps[Hs]&&(Us[ur+hr]=Ps[Hs],++kr),Nr++;if(Er[Nr-cr]!==Er[Nr]&&(Us[ur+hr]=Er[Nr]?2:4,++kr),kr>$s)return null}for(Nr=cr*(Ts-1),ur=Gs*Fs,Er[Nr]!==0&&(Us[ur]=8,++kr),hr=1;hr<Cs;hr++)Er[Nr]!==Er[Nr+1]&&(Us[ur+hr]=Er[Nr]?4:8,++kr),Nr++;if(Er[Nr]!==0&&(Us[ur+hr]=4,++kr),kr>$s)return null;const mr=new Int32Array([0,Fs,-1,0,-Fs,0,0,0,1]),xr=new Path2D;for(Gs=0;kr&&Gs<=Ts;Gs++){let Hs=Gs*Fs;const Js=Hs+Cs;for(;Hs<Js&&!Us[Hs];)Hs++;if(Hs===Js)continue;xr.moveTo(Hs%Fs,Gs);const Zs=Hs;let dr=Us[Hs];do{const br=mr[dr];do Hs+=br;while(!Us[Hs]);const Rr=Us[Hs];Rr!==5&&Rr!==10?(dr=Rr,Us[Hs]=0):(dr=Rr&51*dr>>4,Us[Hs]&=dr>>2|dr<<2),xr.lineTo(Hs%Fs,Hs/Fs|0),Us[Hs]||--kr}while(Zs!==Hs);--Gs}return Er=null,Us=null,function(Hs){Hs.save(),Hs.scale(1/Cs,-1/Ts),Hs.translate(0,-Ts),Hs.fill(xr),Hs.beginPath(),Hs.restore()}}class fs{constructor(Cs,Ts){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=rs.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=rs.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=rs.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,Cs,Ts])}clone(){const Cs=Object.create(this);return Cs.clipBox=this.clipBox.slice(),Cs}setCurrentPoint(Cs,Ts){this.x=Cs,this.y=Ts}updatePathMinMax(Cs,Ts,$s){[Ts,$s]=rs.Util.applyTransform([Ts,$s],Cs),this.minX=Math.min(this.minX,Ts),this.minY=Math.min(this.minY,$s),this.maxX=Math.max(this.maxX,Ts),this.maxY=Math.max(this.maxY,$s)}updateRectMinMax(Cs,Ts){const $s=rs.Util.applyTransform(Ts,Cs),Ps=rs.Util.applyTransform(Ts.slice(2),Cs);this.minX=Math.min(this.minX,$s[0],Ps[0]),this.minY=Math.min(this.minY,$s[1],Ps[1]),this.maxX=Math.max(this.maxX,$s[0],Ps[0]),this.maxY=Math.max(this.maxY,$s[1],Ps[1])}updateScalingPathMinMax(Cs,Ts){rs.Util.scaleMinMax(Cs,Ts),this.minX=Math.min(this.minX,Ts[0]),this.maxX=Math.max(this.maxX,Ts[1]),this.minY=Math.min(this.minY,Ts[2]),this.maxY=Math.max(this.maxY,Ts[3])}updateCurvePathMinMax(Cs,Ts,$s,Ps,Fs,Us,Gs,hr,ur,cr){const Er=rs.Util.bezierBoundingBox(Ts,$s,Ps,Fs,Us,Gs,hr,ur);if(cr){cr[0]=Math.min(cr[0],Er[0],Er[2]),cr[1]=Math.max(cr[1],Er[0],Er[2]),cr[2]=Math.min(cr[2],Er[1],Er[3]),cr[3]=Math.max(cr[3],Er[1],Er[3]);return}this.updateRectMinMax(Cs,Er)}getPathBoundingBox(Cs=os.PathType.FILL,Ts=null){const $s=[this.minX,this.minY,this.maxX,this.maxY];if(Cs===os.PathType.STROKE){Ts||(0,rs.unreachable)("Stroke bounding box must include transform.");const Ps=rs.Util.singularValueDecompose2dScale(Ts),Fs=Ps[0]*this.lineWidth/2,Us=Ps[1]*this.lineWidth/2;$s[0]-=Fs,$s[1]-=Us,$s[2]+=Fs,$s[3]+=Us}return $s}updateClipFromPath(){const Cs=rs.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(Cs||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(Cs){this.clipBox=Cs,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(Cs=os.PathType.FILL,Ts=null){return rs.Util.intersect(this.clipBox,this.getPathBoundingBox(Cs,Ts))}}function js(Ds,Cs){if(typeof ImageData<"u"&&Cs instanceof ImageData){Ds.putImageData(Cs,0,0);return}const Ts=Cs.height,$s=Cs.width,Ps=Ts%hs,Fs=(Ts-Ps)/hs,Us=Ps===0?Fs:Fs+1,Gs=Ds.createImageData($s,hs);let hr=0,ur;const cr=Cs.data,Er=Gs.data;let Nr,kr,mr,xr;if(Cs.kind===rs.ImageKind.GRAYSCALE_1BPP){const Ms=cr.byteLength,Hs=new Uint32Array(Er.buffer,0,Er.byteLength>>2),Js=Hs.length,Zs=$s+7>>3,dr=4294967295,br=rs.FeatureTest.isLittleEndian?4278190080:255;for(Nr=0;Nr<Us;Nr++){for(mr=Nr<Fs?hs:Ps,ur=0,kr=0;kr<mr;kr++){const Rr=Ms-hr;let ar=0;const Pr=Rr>Zs?$s:Rr*8-7,Ar=Pr&-8;let Gr=0,Dr=0;for(;ar<Ar;ar+=8)Dr=cr[hr++],Hs[ur++]=Dr&128?dr:br,Hs[ur++]=Dr&64?dr:br,Hs[ur++]=Dr&32?dr:br,Hs[ur++]=Dr&16?dr:br,Hs[ur++]=Dr&8?dr:br,Hs[ur++]=Dr&4?dr:br,Hs[ur++]=Dr&2?dr:br,Hs[ur++]=Dr&1?dr:br;for(;ar<Pr;ar++)Gr===0&&(Dr=cr[hr++],Gr=128),Hs[ur++]=Dr&Gr?dr:br,Gr>>=1}for(;ur<Js;)Hs[ur++]=0;Ds.putImageData(Gs,0,Nr*hs)}}else if(Cs.kind===rs.ImageKind.RGBA_32BPP){for(kr=0,xr=$s*hs*4,Nr=0;Nr<Fs;Nr++)Er.set(cr.subarray(hr,hr+xr)),hr+=xr,Ds.putImageData(Gs,0,kr),kr+=hs;Nr<Us&&(xr=$s*Ps*4,Er.set(cr.subarray(hr,hr+xr)),Ds.putImageData(Gs,0,kr))}else if(Cs.kind===rs.ImageKind.RGB_24BPP)for(mr=hs,xr=$s*mr,Nr=0;Nr<Us;Nr++){for(Nr>=Fs&&(mr=Ps,xr=$s*mr),ur=0,kr=xr;kr--;)Er[ur++]=cr[hr++],Er[ur++]=cr[hr++],Er[ur++]=cr[hr++],Er[ur++]=255;Ds.putImageData(Gs,0,Nr*hs)}else throw new Error(`bad image kind: ${Cs.kind}`)}function Ss(Ds,Cs){if(Cs.bitmap){Ds.drawImage(Cs.bitmap,0,0);return}const Ts=Cs.height,$s=Cs.width,Ps=Ts%hs,Fs=(Ts-Ps)/hs,Us=Ps===0?Fs:Fs+1,Gs=Ds.createImageData($s,hs);let hr=0;const ur=Cs.data,cr=Gs.data;for(let Er=0;Er<Us;Er++){const Nr=Er<Fs?hs:Ps;({srcPos:hr}=(0,as.convertBlackAndWhiteToRGBA)({src:ur,srcPos:hr,dest:cr,width:$s,height:Nr,nonBlackColor:0})),Ds.putImageData(Gs,0,Er*hs)}}function bs(Ds,Cs){const Ts=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const $s of Ts)Ds[$s]!==void 0&&(Cs[$s]=Ds[$s]);Ds.setLineDash!==void 0&&(Cs.setLineDash(Ds.getLineDash()),Cs.lineDashOffset=Ds.lineDashOffset)}function Es(Ds){if(Ds.strokeStyle=Ds.fillStyle="#000000",Ds.fillRule="nonzero",Ds.globalAlpha=1,Ds.lineWidth=1,Ds.lineCap="butt",Ds.lineJoin="miter",Ds.miterLimit=10,Ds.globalCompositeOperation="source-over",Ds.font="10px sans-serif",Ds.setLineDash!==void 0&&(Ds.setLineDash([]),Ds.lineDashOffset=0),!rs.isNodeJS){const{filter:Cs}=Ds;Cs!=="none"&&Cs!==""&&(Ds.filter="none")}}function Rs(Ds,Cs,Ts,$s){const Ps=Ds.length;for(let Fs=3;Fs<Ps;Fs+=4){const Us=Ds[Fs];if(Us===0)Ds[Fs-3]=Cs,Ds[Fs-2]=Ts,Ds[Fs-1]=$s;else if(Us<255){const Gs=255-Us;Ds[Fs-3]=Ds[Fs-3]*Us+Cs*Gs>>8,Ds[Fs-2]=Ds[Fs-2]*Us+Ts*Gs>>8,Ds[Fs-1]=Ds[Fs-1]*Us+$s*Gs>>8}}}function ws(Ds,Cs,Ts){const $s=Ds.length,Ps=1/255;for(let Fs=3;Fs<$s;Fs+=4){const Us=Ts?Ts[Ds[Fs]]:Ds[Fs];Cs[Fs]=Cs[Fs]*Us*Ps|0}}function Ns(Ds,Cs,Ts){const $s=Ds.length;for(let Ps=3;Ps<$s;Ps+=4){const Fs=Ds[Ps-3]*77+Ds[Ps-2]*152+Ds[Ps-1]*28;Cs[Ps]=Ts?Cs[Ps]*Ts[Fs>>8]>>8:Cs[Ps]*Fs>>16}}function ks(Ds,Cs,Ts,$s,Ps,Fs,Us,Gs,hr,ur,cr){const Er=!!Fs,Nr=Er?Fs[0]:0,kr=Er?Fs[1]:0,mr=Er?Fs[2]:0,xr=Ps==="Luminosity"?Ns:ws,Hs=Math.min($s,Math.ceil(1048576/Ts));for(let Js=0;Js<$s;Js+=Hs){const Zs=Math.min(Hs,$s-Js),dr=Ds.getImageData(Gs-ur,Js+(hr-cr),Ts,Zs),br=Cs.getImageData(Gs,Js+hr,Ts,Zs);Er&&Rs(dr.data,Nr,kr,mr),xr(dr.data,br.data,Us),Cs.putImageData(br,Gs,Js+hr)}}function _s(Ds,Cs,Ts,$s){const Ps=$s[0],Fs=$s[1],Us=$s[2]-Ps,Gs=$s[3]-Fs;Us===0||Gs===0||(ks(Cs.context,Ts,Us,Gs,Cs.subtype,Cs.backdrop,Cs.transferMap,Ps,Fs,Cs.offsetX,Cs.offsetY),Ds.save(),Ds.globalAlpha=1,Ds.globalCompositeOperation="source-over",Ds.setTransform(1,0,0,1,0,0),Ds.drawImage(Ts.canvas,0,0),Ds.restore())}function Ls(Ds,Cs){const Ts=rs.Util.singularValueDecompose2dScale(Ds);Ts[0]=Math.fround(Ts[0]),Ts[1]=Math.fround(Ts[1]);const $s=Math.fround((globalThis.devicePixelRatio||1)*ns.PixelsPerInch.PDF_TO_CSS_UNITS);return Cs!==void 0?Cs:Ts[0]<=$s||Ts[1]<=$s}const Os=["butt","round","square"],zs=["miter","round","bevel"],qs={},Qs={},Vs=class Vs{constructor(Cs,Ts,$s,Ps,Fs,{optionalContentConfig:Us,markedContentStack:Gs=null},hr,ur){fr(this,Ws);this.ctx=Cs,this.current=new fs(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=Ts,this.objs=$s,this.canvasFactory=Ps,this.filterFactory=Fs,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=Gs||[],this.optionalContentConfig=Us,this.cachedCanvases=new ys(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=hr,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=ur,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(Cs,Ts=null){return typeof Cs=="string"?Cs.startsWith("g_")?this.commonObjs.get(Cs):this.objs.get(Cs):Ts}beginDrawing({transform:Cs,viewport:Ts,transparency:$s=!1,background:Ps=null}){const Fs=this.ctx.canvas.width,Us=this.ctx.canvas.height,Gs=this.ctx.fillStyle;if(this.ctx.fillStyle=Ps||"#ffffff",this.ctx.fillRect(0,0,Fs,Us),this.ctx.fillStyle=Gs,$s){const hr=this.cachedCanvases.getCanvas("transparent",Fs,Us);this.compositeCtx=this.ctx,this.transparentCanvas=hr.canvas,this.ctx=hr.context,this.ctx.save(),this.ctx.transform(...(0,ns.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),Es(this.ctx),Cs&&(this.ctx.transform(...Cs),this.outputScaleX=Cs[0],this.outputScaleY=Cs[0]),this.ctx.transform(...Ts.transform),this.viewportScale=Ts.scale,this.baseTransform=(0,ns.getCurrentTransform)(this.ctx)}executeOperatorList(Cs,Ts,$s,Ps){const Fs=Cs.argsArray,Us=Cs.fnArray;let Gs=Ts||0;const hr=Fs.length;if(hr===Gs)return Gs;const ur=hr-Gs>ms&&typeof $s=="function",cr=ur?Date.now()+ds:0;let Er=0;const Nr=this.commonObjs,kr=this.objs;let mr;for(;;){if(Ps!==void 0&&Gs===Ps.nextBreakPoint)return Ps.breakIt(Gs,$s),Gs;if(mr=Us[Gs],mr!==rs.OPS.dependency)this[mr].apply(this,Fs[Gs]);else for(const xr of Fs[Gs]){const Ms=xr.startsWith("g_")?Nr:kr;if(!Ms.has(xr))return Ms.get(xr,$s),Gs}if(Gs++,Gs===hr)return Gs;if(ur&&++Er>ms){if(Date.now()>cr)return $s(),Gs;Er=0}}}endDrawing(){pr(this,Ws,na).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const Cs of this._cachedBitmapsMap.values()){for(const Ts of Cs.values())typeof HTMLCanvasElement<"u"&&Ts instanceof HTMLCanvasElement&&(Ts.width=Ts.height=0);Cs.clear()}this._cachedBitmapsMap.clear(),pr(this,Ws,xa).call(this)}_scaleImage(Cs,Ts){const $s=Cs.width,Ps=Cs.height;let Fs=Math.max(Math.hypot(Ts[0],Ts[1]),1),Us=Math.max(Math.hypot(Ts[2],Ts[3]),1),Gs=$s,hr=Ps,ur="prescale1",cr,Er;for(;Fs>2&&Gs>1||Us>2&&hr>1;){let Nr=Gs,kr=hr;Fs>2&&Gs>1&&(Nr=Gs>=16384?Math.floor(Gs/2)-1||1:Math.ceil(Gs/2),Fs/=Gs/Nr),Us>2&&hr>1&&(kr=hr>=16384?Math.floor(hr/2)-1||1:Math.ceil(hr)/2,Us/=hr/kr),cr=this.cachedCanvases.getCanvas(ur,Nr,kr),Er=cr.context,Er.clearRect(0,0,Nr,kr),Er.drawImage(Cs,0,0,Gs,hr,0,0,Nr,kr),Cs=cr.canvas,Gs=Nr,hr=kr,ur=ur==="prescale1"?"prescale2":"prescale1"}return{img:Cs,paintWidth:Gs,paintHeight:hr}}_createMaskCanvas(Cs){const Ts=this.ctx,{width:$s,height:Ps}=Cs,Fs=this.current.fillColor,Us=this.current.patternFill,Gs=(0,ns.getCurrentTransform)(Ts);let hr,ur,cr,Er;if((Cs.bitmap||Cs.data)&&Cs.count>1){const ar=Cs.bitmap||Cs.data.buffer;ur=JSON.stringify(Us?Gs:[Gs.slice(0,4),Fs]),hr=this._cachedBitmapsMap.get(ar),hr||(hr=new Map,this._cachedBitmapsMap.set(ar,hr));const Pr=hr.get(ur);if(Pr&&!Us){const Ar=Math.round(Math.min(Gs[0],Gs[2])+Gs[4]),Gr=Math.round(Math.min(Gs[1],Gs[3])+Gs[5]);return{canvas:Pr,offsetX:Ar,offsetY:Gr}}cr=Pr}cr||(Er=this.cachedCanvases.getCanvas("maskCanvas",$s,Ps),Ss(Er.context,Cs));let Nr=rs.Util.transform(Gs,[1/$s,0,0,-1/Ps,0,0]);Nr=rs.Util.transform(Nr,[1,0,0,1,0,-Ps]);const kr=rs.Util.applyTransform([0,0],Nr),mr=rs.Util.applyTransform([$s,Ps],Nr),xr=rs.Util.normalizeRect([kr[0],kr[1],mr[0],mr[1]]),Ms=Math.round(xr[2]-xr[0])||1,Hs=Math.round(xr[3]-xr[1])||1,Js=this.cachedCanvases.getCanvas("fillCanvas",Ms,Hs),Zs=Js.context,dr=Math.min(kr[0],mr[0]),br=Math.min(kr[1],mr[1]);Zs.translate(-dr,-br),Zs.transform(...Nr),cr||(cr=this._scaleImage(Er.canvas,(0,ns.getCurrentTransformInverse)(Zs)),cr=cr.img,hr&&Us&&hr.set(ur,cr)),Zs.imageSmoothingEnabled=Ls((0,ns.getCurrentTransform)(Zs),Cs.interpolate),vs(Zs,cr,0,0,cr.width,cr.height,0,0,$s,Ps),Zs.globalCompositeOperation="source-in";const Rr=rs.Util.transform((0,ns.getCurrentTransformInverse)(Zs),[1,0,0,1,-dr,-br]);return Zs.fillStyle=Us?Fs.getPattern(Ts,this,Rr,os.PathType.FILL):Fs,Zs.fillRect(0,0,$s,Ps),hr&&!Us&&(this.cachedCanvases.delete("fillCanvas"),hr.set(ur,Js.canvas)),{canvas:Js.canvas,offsetX:Math.round(dr),offsetY:Math.round(br)}}setLineWidth(Cs){Cs!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=Cs,this.ctx.lineWidth=Cs}setLineCap(Cs){this.ctx.lineCap=Os[Cs]}setLineJoin(Cs){this.ctx.lineJoin=zs[Cs]}setMiterLimit(Cs){this.ctx.miterLimit=Cs}setDash(Cs,Ts){const $s=this.ctx;$s.setLineDash!==void 0&&($s.setLineDash(Cs),$s.lineDashOffset=Ts)}setRenderingIntent(Cs){}setFlatness(Cs){}setGState(Cs){for(const[Ts,$s]of Cs)switch(Ts){case"LW":this.setLineWidth($s);break;case"LC":this.setLineCap($s);break;case"LJ":this.setLineJoin($s);break;case"ML":this.setMiterLimit($s);break;case"D":this.setDash($s[0],$s[1]);break;case"RI":this.setRenderingIntent($s);break;case"FL":this.setFlatness($s);break;case"Font":this.setFont($s[0],$s[1]);break;case"CA":this.current.strokeAlpha=$s;break;case"ca":this.current.fillAlpha=$s,this.ctx.globalAlpha=$s;break;case"BM":this.ctx.globalCompositeOperation=$s;break;case"SMask":this.current.activeSMask=$s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter($s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const Cs=this.inSMaskMode;this.current.activeSMask&&!Cs?this.beginSMaskMode():!this.current.activeSMask&&Cs&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const Cs=this.ctx.canvas.width,Ts=this.ctx.canvas.height,$s="smaskGroupAt"+this.groupLevel,Ps=this.cachedCanvases.getCanvas($s,Cs,Ts);this.suspendedCtx=this.ctx,this.ctx=Ps.context;const Fs=this.ctx;Fs.setTransform(...(0,ns.getCurrentTransform)(this.suspendedCtx)),bs(this.suspendedCtx,Fs),xs(Fs,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),bs(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(Cs){if(!this.current.activeSMask)return;Cs?(Cs[0]=Math.floor(Cs[0]),Cs[1]=Math.floor(Cs[1]),Cs[2]=Math.ceil(Cs[2]),Cs[3]=Math.ceil(Cs[3])):Cs=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const Ts=this.current.activeSMask,$s=this.suspendedCtx;_s($s,Ts,this.ctx,Cs),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(bs(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const Cs=this.current;this.stateStack.push(Cs),this.current=Cs.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),bs(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(Cs,Ts,$s,Ps,Fs,Us){this.ctx.transform(Cs,Ts,$s,Ps,Fs,Us),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(Cs,Ts,$s){const Ps=this.ctx,Fs=this.current;let Us=Fs.x,Gs=Fs.y,hr,ur;const cr=(0,ns.getCurrentTransform)(Ps),Er=cr[0]===0&&cr[3]===0||cr[1]===0&&cr[2]===0,Nr=Er?$s.slice(0):null;for(let kr=0,mr=0,xr=Cs.length;kr<xr;kr++)switch(Cs[kr]|0){case rs.OPS.rectangle:Us=Ts[mr++],Gs=Ts[mr++];const Ms=Ts[mr++],Hs=Ts[mr++],Js=Us+Ms,Zs=Gs+Hs;Ps.moveTo(Us,Gs),Ms===0||Hs===0?Ps.lineTo(Js,Zs):(Ps.lineTo(Js,Gs),Ps.lineTo(Js,Zs),Ps.lineTo(Us,Zs)),Er||Fs.updateRectMinMax(cr,[Us,Gs,Js,Zs]),Ps.closePath();break;case rs.OPS.moveTo:Us=Ts[mr++],Gs=Ts[mr++],Ps.moveTo(Us,Gs),Er||Fs.updatePathMinMax(cr,Us,Gs);break;case rs.OPS.lineTo:Us=Ts[mr++],Gs=Ts[mr++],Ps.lineTo(Us,Gs),Er||Fs.updatePathMinMax(cr,Us,Gs);break;case rs.OPS.curveTo:hr=Us,ur=Gs,Us=Ts[mr+4],Gs=Ts[mr+5],Ps.bezierCurveTo(Ts[mr],Ts[mr+1],Ts[mr+2],Ts[mr+3],Us,Gs),Fs.updateCurvePathMinMax(cr,hr,ur,Ts[mr],Ts[mr+1],Ts[mr+2],Ts[mr+3],Us,Gs,Nr),mr+=6;break;case rs.OPS.curveTo2:hr=Us,ur=Gs,Ps.bezierCurveTo(Us,Gs,Ts[mr],Ts[mr+1],Ts[mr+2],Ts[mr+3]),Fs.updateCurvePathMinMax(cr,hr,ur,Us,Gs,Ts[mr],Ts[mr+1],Ts[mr+2],Ts[mr+3],Nr),Us=Ts[mr+2],Gs=Ts[mr+3],mr+=4;break;case rs.OPS.curveTo3:hr=Us,ur=Gs,Us=Ts[mr+2],Gs=Ts[mr+3],Ps.bezierCurveTo(Ts[mr],Ts[mr+1],Us,Gs,Us,Gs),Fs.updateCurvePathMinMax(cr,hr,ur,Ts[mr],Ts[mr+1],Us,Gs,Us,Gs,Nr),mr+=4;break;case rs.OPS.closePath:Ps.closePath();break}Er&&Fs.updateScalingPathMinMax(cr,Nr),Fs.setCurrentPoint(Us,Gs)}closePath(){this.ctx.closePath()}stroke(Cs=!0){const Ts=this.ctx,$s=this.current.strokeColor;Ts.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof $s=="object"&&($s!=null&&$s.getPattern)?(Ts.save(),Ts.strokeStyle=$s.getPattern(Ts,this,(0,ns.getCurrentTransformInverse)(Ts),os.PathType.STROKE),this.rescaleAndStroke(!1),Ts.restore()):this.rescaleAndStroke(!0)),Cs&&this.consumePath(this.current.getClippedPathBoundingBox()),Ts.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(Cs=!0){const Ts=this.ctx,$s=this.current.fillColor,Ps=this.current.patternFill;let Fs=!1;Ps&&(Ts.save(),Ts.fillStyle=$s.getPattern(Ts,this,(0,ns.getCurrentTransformInverse)(Ts),os.PathType.FILL),Fs=!0);const Us=this.current.getClippedPathBoundingBox();this.contentVisible&&Us!==null&&(this.pendingEOFill?(Ts.fill("evenodd"),this.pendingEOFill=!1):Ts.fill()),Fs&&Ts.restore(),Cs&&this.consumePath(Us)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=qs}eoClip(){this.pendingClip=Qs}beginText(){this.current.textMatrix=rs.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const Cs=this.pendingTextPaths,Ts=this.ctx;if(Cs===void 0){Ts.beginPath();return}Ts.save(),Ts.beginPath();for(const $s of Cs)Ts.setTransform(...$s.transform),Ts.translate($s.x,$s.y),$s.addToPath(Ts,$s.fontSize);Ts.restore(),Ts.clip(),Ts.beginPath(),delete this.pendingTextPaths}setCharSpacing(Cs){this.current.charSpacing=Cs}setWordSpacing(Cs){this.current.wordSpacing=Cs}setHScale(Cs){this.current.textHScale=Cs/100}setLeading(Cs){this.current.leading=-Cs}setFont(Cs,Ts){var cr;const $s=this.commonObjs.get(Cs),Ps=this.current;if(!$s)throw new Error(`Can't find font for ${Cs}`);if(Ps.fontMatrix=$s.fontMatrix||rs.FONT_IDENTITY_MATRIX,(Ps.fontMatrix[0]===0||Ps.fontMatrix[3]===0)&&(0,rs.warn)("Invalid font matrix for font "+Cs),Ts<0?(Ts=-Ts,Ps.fontDirection=-1):Ps.fontDirection=1,this.current.font=$s,this.current.fontSize=Ts,$s.isType3Font)return;const Fs=$s.loadedName||"sans-serif",Us=((cr=$s.systemFontInfo)==null?void 0:cr.css)||`"${Fs}", ${$s.fallbackName}`;let Gs="normal";$s.black?Gs="900":$s.bold&&(Gs="bold");const hr=$s.italic?"italic":"normal";let ur=Ts;Ts<ls?ur=ls:Ts>cs&&(ur=cs),this.current.fontSizeScale=Ts/ur,this.ctx.font=`${hr} ${Gs} ${ur}px ${Us}`}setTextRenderingMode(Cs){this.current.textRenderingMode=Cs}setTextRise(Cs){this.current.textRise=Cs}moveText(Cs,Ts){this.current.x=this.current.lineX+=Cs,this.current.y=this.current.lineY+=Ts}setLeadingMoveText(Cs,Ts){this.setLeading(-Ts),this.moveText(Cs,Ts)}setTextMatrix(Cs,Ts,$s,Ps,Fs,Us){this.current.textMatrix=[Cs,Ts,$s,Ps,Fs,Us],this.current.textMatrixScale=Math.hypot(Cs,Ts),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(Cs,Ts,$s,Ps){const Fs=this.ctx,Us=this.current,Gs=Us.font,hr=Us.textRenderingMode,ur=Us.fontSize/Us.fontSizeScale,cr=hr&rs.TextRenderingMode.FILL_STROKE_MASK,Er=!!(hr&rs.TextRenderingMode.ADD_TO_PATH_FLAG),Nr=Us.patternFill&&!Gs.missingFile;let kr;(Gs.disableFontFace||Er||Nr)&&(kr=Gs.getPathGenerator(this.commonObjs,Cs)),Gs.disableFontFace||Nr?(Fs.save(),Fs.translate(Ts,$s),Fs.beginPath(),kr(Fs,ur),Ps&&Fs.setTransform(...Ps),(cr===rs.TextRenderingMode.FILL||cr===rs.TextRenderingMode.FILL_STROKE)&&Fs.fill(),(cr===rs.TextRenderingMode.STROKE||cr===rs.TextRenderingMode.FILL_STROKE)&&Fs.stroke(),Fs.restore()):((cr===rs.TextRenderingMode.FILL||cr===rs.TextRenderingMode.FILL_STROKE)&&Fs.fillText(Cs,Ts,$s),(cr===rs.TextRenderingMode.STROKE||cr===rs.TextRenderingMode.FILL_STROKE)&&Fs.strokeText(Cs,Ts,$s)),Er&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,ns.getCurrentTransform)(Fs),x:Ts,y:$s,fontSize:ur,addToPath:kr})}get isFontSubpixelAAEnabled(){const{context:Cs}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);Cs.scale(1.5,1),Cs.fillText("I",0,10);const Ts=Cs.getImageData(0,0,10,10).data;let $s=!1;for(let Ps=3;Ps<Ts.length;Ps+=4)if(Ts[Ps]>0&&Ts[Ps]<255){$s=!0;break}return(0,rs.shadow)(this,"isFontSubpixelAAEnabled",$s)}showText(Cs){const Ts=this.current,$s=Ts.font;if($s.isType3Font)return this.showType3Text(Cs);const Ps=Ts.fontSize;if(Ps===0)return;const Fs=this.ctx,Us=Ts.fontSizeScale,Gs=Ts.charSpacing,hr=Ts.wordSpacing,ur=Ts.fontDirection,cr=Ts.textHScale*ur,Er=Cs.length,Nr=$s.vertical,kr=Nr?1:-1,mr=$s.defaultVMetrics,xr=Ps*Ts.fontMatrix[0],Ms=Ts.textRenderingMode===rs.TextRenderingMode.FILL&&!$s.disableFontFace&&!Ts.patternFill;Fs.save(),Fs.transform(...Ts.textMatrix),Fs.translate(Ts.x,Ts.y+Ts.textRise),ur>0?Fs.scale(cr,-1):Fs.scale(cr,1);let Hs;if(Ts.patternFill){Fs.save();const Rr=Ts.fillColor.getPattern(Fs,this,(0,ns.getCurrentTransformInverse)(Fs),os.PathType.FILL);Hs=(0,ns.getCurrentTransform)(Fs),Fs.restore(),Fs.fillStyle=Rr}let Js=Ts.lineWidth;const Zs=Ts.textMatrixScale;if(Zs===0||Js===0){const Rr=Ts.textRenderingMode&rs.TextRenderingMode.FILL_STROKE_MASK;(Rr===rs.TextRenderingMode.STROKE||Rr===rs.TextRenderingMode.FILL_STROKE)&&(Js=this.getSinglePixelWidth())}else Js/=Zs;if(Us!==1&&(Fs.scale(Us,Us),Js/=Us),Fs.lineWidth=Js,$s.isInvalidPDFjsFont){const Rr=[];let ar=0;for(const Pr of Cs)Rr.push(Pr.unicode),ar+=Pr.width;Fs.fillText(Rr.join(""),0,0),Ts.x+=ar*xr*cr,Fs.restore(),this.compose();return}let dr=0,br;for(br=0;br<Er;++br){const Rr=Cs[br];if(typeof Rr=="number"){dr+=kr*Rr*Ps/1e3;continue}let ar=!1;const Pr=(Rr.isSpace?hr:0)+Gs,Ar=Rr.fontChar,Gr=Rr.accent;let Dr,Yr,$r=Rr.width;if(Nr){const Zr=Rr.vmetric||mr,to=-(Rr.vmetric?Zr[1]:$r*.5)*xr,_r=Zr[2]*xr;$r=Zr?-Zr[0]:$r,Dr=to/Us,Yr=(dr+_r)/Us}else Dr=dr/Us,Yr=0;if($s.remeasure&&$r>0){const Zr=Fs.measureText(Ar).width*1e3/Ps*Us;if($r<Zr&&this.isFontSubpixelAAEnabled){const to=$r/Zr;ar=!0,Fs.save(),Fs.scale(to,1),Dr/=to}else $r!==Zr&&(Dr+=($r-Zr)/2e3*Ps/Us)}if(this.contentVisible&&(Rr.isInFont||$s.missingFile)){if(Ms&&!Gr)Fs.fillText(Ar,Dr,Yr);else if(this.paintChar(Ar,Dr,Yr,Hs),Gr){const Zr=Dr+Ps*Gr.offset.x/Us,to=Yr-Ps*Gr.offset.y/Us;this.paintChar(Gr.fontChar,Zr,to,Hs)}}const Vr=Nr?$r*xr-Pr*ur:$r*xr+Pr*ur;dr+=Vr,ar&&Fs.restore()}Nr?Ts.y-=dr:Ts.x+=dr*cr,Fs.restore(),this.compose()}showType3Text(Cs){const Ts=this.ctx,$s=this.current,Ps=$s.font,Fs=$s.fontSize,Us=$s.fontDirection,Gs=Ps.vertical?1:-1,hr=$s.charSpacing,ur=$s.wordSpacing,cr=$s.textHScale*Us,Er=$s.fontMatrix||rs.FONT_IDENTITY_MATRIX,Nr=Cs.length,kr=$s.textRenderingMode===rs.TextRenderingMode.INVISIBLE;let mr,xr,Ms,Hs;if(!(kr||Fs===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,Ts.save(),Ts.transform(...$s.textMatrix),Ts.translate($s.x,$s.y),Ts.scale(cr,Us),mr=0;mr<Nr;++mr){if(xr=Cs[mr],typeof xr=="number"){Hs=Gs*xr*Fs/1e3,this.ctx.translate(Hs,0),$s.x+=Hs*cr;continue}const Js=(xr.isSpace?ur:0)+hr,Zs=Ps.charProcOperatorList[xr.operatorListId];if(!Zs){(0,rs.warn)(`Type3 character "${xr.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=xr,this.save(),Ts.scale(Fs,Fs),Ts.transform(...Er),this.executeOperatorList(Zs),this.restore()),Ms=rs.Util.applyTransform([xr.width,0],Er)[0]*Fs+Js,Ts.translate(Ms,0),$s.x+=Ms*cr}Ts.restore(),this.processingType3=null}}setCharWidth(Cs,Ts){}setCharWidthAndBounds(Cs,Ts,$s,Ps,Fs,Us){this.ctx.rect($s,Ps,Fs-$s,Us-Ps),this.ctx.clip(),this.endPath()}getColorN_Pattern(Cs){let Ts;if(Cs[0]==="TilingPattern"){const $s=Cs[1],Ps=this.baseTransform||(0,ns.getCurrentTransform)(this.ctx),Fs={createCanvasGraphics:Us=>new Vs(Us,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};Ts=new os.TilingPattern(Cs,$s,this.ctx,Fs,Ps)}else Ts=this._getPattern(Cs[1],Cs[2]);return Ts}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(Cs,Ts,$s){const Ps=rs.Util.makeHexColor(Cs,Ts,$s);this.ctx.strokeStyle=Ps,this.current.strokeColor=Ps}setFillRGBColor(Cs,Ts,$s){const Ps=rs.Util.makeHexColor(Cs,Ts,$s);this.ctx.fillStyle=Ps,this.current.fillColor=Ps,this.current.patternFill=!1}_getPattern(Cs,Ts=null){let $s;return this.cachedPatterns.has(Cs)?$s=this.cachedPatterns.get(Cs):($s=(0,os.getShadingPattern)(this.getObject(Cs)),this.cachedPatterns.set(Cs,$s)),Ts&&($s.matrix=Ts),$s}shadingFill(Cs){if(!this.contentVisible)return;const Ts=this.ctx;this.save();const $s=this._getPattern(Cs);Ts.fillStyle=$s.getPattern(Ts,this,(0,ns.getCurrentTransformInverse)(Ts),os.PathType.SHADING);const Ps=(0,ns.getCurrentTransformInverse)(Ts);if(Ps){const{width:Fs,height:Us}=Ts.canvas,[Gs,hr,ur,cr]=rs.Util.getAxialAlignedBoundingBox([0,0,Fs,Us],Ps);this.ctx.fillRect(Gs,hr,ur-Gs,cr-hr)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,rs.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,rs.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(Cs,Ts){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(Cs)&&Cs.length===6&&this.transform(...Cs),this.baseTransform=(0,ns.getCurrentTransform)(this.ctx),Ts)){const $s=Ts[2]-Ts[0],Ps=Ts[3]-Ts[1];this.ctx.rect(Ts[0],Ts[1],$s,Ps),this.current.updateRectMinMax((0,ns.getCurrentTransform)(this.ctx),Ts),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(Cs){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const Ts=this.ctx;Cs.isolated||(0,rs.info)("TODO: Support non-isolated groups."),Cs.knockout&&(0,rs.warn)("Knockout groups not supported.");const $s=(0,ns.getCurrentTransform)(Ts);if(Cs.matrix&&Ts.transform(...Cs.matrix),!Cs.bbox)throw new Error("Bounding box is required.");let Ps=rs.Util.getAxialAlignedBoundingBox(Cs.bbox,(0,ns.getCurrentTransform)(Ts));const Fs=[0,0,Ts.canvas.width,Ts.canvas.height];Ps=rs.Util.intersect(Ps,Fs)||[0,0,0,0];const Us=Math.floor(Ps[0]),Gs=Math.floor(Ps[1]);let hr=Math.max(Math.ceil(Ps[2])-Us,1),ur=Math.max(Math.ceil(Ps[3])-Gs,1),cr=1,Er=1;hr>us&&(cr=hr/us,hr=us),ur>us&&(Er=ur/us,ur=us),this.current.startNewPathAndClipBox([0,0,hr,ur]);let Nr="groupAt"+this.groupLevel;Cs.smask&&(Nr+="_smask_"+this.smaskCounter++%2);const kr=this.cachedCanvases.getCanvas(Nr,hr,ur),mr=kr.context;mr.scale(1/cr,1/Er),mr.translate(-Us,-Gs),mr.transform(...$s),Cs.smask?this.smaskStack.push({canvas:kr.canvas,context:mr,offsetX:Us,offsetY:Gs,scaleX:cr,scaleY:Er,subtype:Cs.smask.subtype,backdrop:Cs.smask.backdrop,transferMap:Cs.smask.transferMap||null,startTransformInverse:null}):(Ts.setTransform(1,0,0,1,0,0),Ts.translate(Us,Gs),Ts.scale(cr,Er),Ts.save()),bs(Ts,mr),this.ctx=mr,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(Ts),this.groupLevel++}endGroup(Cs){if(!this.contentVisible)return;this.groupLevel--;const Ts=this.ctx,$s=this.groupStack.pop();if(this.ctx=$s,this.ctx.imageSmoothingEnabled=!1,Cs.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const Ps=(0,ns.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...Ps);const Fs=rs.Util.getAxialAlignedBoundingBox([0,0,Ts.canvas.width,Ts.canvas.height],Ps);this.ctx.drawImage(Ts.canvas,0,0),this.ctx.restore(),this.compose(Fs)}}beginAnnotation(Cs,Ts,$s,Ps,Fs){if(pr(this,Ws,na).call(this),Es(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(Ts)&&Ts.length===4){const Us=Ts[2]-Ts[0],Gs=Ts[3]-Ts[1];if(Fs&&this.annotationCanvasMap){$s=$s.slice(),$s[4]-=Ts[0],$s[5]-=Ts[1],Ts=Ts.slice(),Ts[0]=Ts[1]=0,Ts[2]=Us,Ts[3]=Gs;const[hr,ur]=rs.Util.singularValueDecompose2dScale((0,ns.getCurrentTransform)(this.ctx)),{viewportScale:cr}=this,Er=Math.ceil(Us*this.outputScaleX*cr),Nr=Math.ceil(Gs*this.outputScaleY*cr);this.annotationCanvas=this.canvasFactory.create(Er,Nr);const{canvas:kr,context:mr}=this.annotationCanvas;this.annotationCanvasMap.set(Cs,kr),this.annotationCanvas.savedCtx=this.ctx,this.ctx=mr,this.ctx.save(),this.ctx.setTransform(hr,0,0,-ur,0,Gs*ur),Es(this.ctx)}else Es(this.ctx),this.ctx.rect(Ts[0],Ts[1],Us,Gs),this.ctx.clip(),this.endPath()}this.current=new fs(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...$s),this.transform(...Ps)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),pr(this,Ws,xa).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(Cs){if(!this.contentVisible)return;const Ts=Cs.count;Cs=this.getObject(Cs.data,Cs),Cs.count=Ts;const $s=this.ctx,Ps=this.processingType3;if(Ps&&(Ps.compiled===void 0&&(Ps.compiled=gs(Cs)),Ps.compiled)){Ps.compiled($s);return}const Fs=this._createMaskCanvas(Cs),Us=Fs.canvas;$s.save(),$s.setTransform(1,0,0,1,0,0),$s.drawImage(Us,Fs.offsetX,Fs.offsetY),$s.restore(),this.compose()}paintImageMaskXObjectRepeat(Cs,Ts,$s=0,Ps=0,Fs,Us){if(!this.contentVisible)return;Cs=this.getObject(Cs.data,Cs);const Gs=this.ctx;Gs.save();const hr=(0,ns.getCurrentTransform)(Gs);Gs.transform(Ts,$s,Ps,Fs,0,0);const ur=this._createMaskCanvas(Cs);Gs.setTransform(1,0,0,1,ur.offsetX-hr[4],ur.offsetY-hr[5]);for(let cr=0,Er=Us.length;cr<Er;cr+=2){const Nr=rs.Util.transform(hr,[Ts,$s,Ps,Fs,Us[cr],Us[cr+1]]),[kr,mr]=rs.Util.applyTransform([0,0],Nr);Gs.drawImage(ur.canvas,kr,mr)}Gs.restore(),this.compose()}paintImageMaskXObjectGroup(Cs){if(!this.contentVisible)return;const Ts=this.ctx,$s=this.current.fillColor,Ps=this.current.patternFill;for(const Fs of Cs){const{data:Us,width:Gs,height:hr,transform:ur}=Fs,cr=this.cachedCanvases.getCanvas("maskCanvas",Gs,hr),Er=cr.context;Er.save();const Nr=this.getObject(Us,Fs);Ss(Er,Nr),Er.globalCompositeOperation="source-in",Er.fillStyle=Ps?$s.getPattern(Er,this,(0,ns.getCurrentTransformInverse)(Ts),os.PathType.FILL):$s,Er.fillRect(0,0,Gs,hr),Er.restore(),Ts.save(),Ts.transform(...ur),Ts.scale(1,-1),vs(Ts,cr.canvas,0,0,Gs,hr,0,-1,1,1),Ts.restore()}this.compose()}paintImageXObject(Cs){if(!this.contentVisible)return;const Ts=this.getObject(Cs);if(!Ts){(0,rs.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(Ts)}paintImageXObjectRepeat(Cs,Ts,$s,Ps){if(!this.contentVisible)return;const Fs=this.getObject(Cs);if(!Fs){(0,rs.warn)("Dependent image isn't ready yet");return}const Us=Fs.width,Gs=Fs.height,hr=[];for(let ur=0,cr=Ps.length;ur<cr;ur+=2)hr.push({transform:[Ts,0,0,$s,Ps[ur],Ps[ur+1]],x:0,y:0,w:Us,h:Gs});this.paintInlineImageXObjectGroup(Fs,hr)}applyTransferMapsToCanvas(Cs){return this.current.transferMaps!=="none"&&(Cs.filter=this.current.transferMaps,Cs.drawImage(Cs.canvas,0,0),Cs.filter="none"),Cs.canvas}applyTransferMapsToBitmap(Cs){if(this.current.transferMaps==="none")return Cs.bitmap;const{bitmap:Ts,width:$s,height:Ps}=Cs,Fs=this.cachedCanvases.getCanvas("inlineImage",$s,Ps),Us=Fs.context;return Us.filter=this.current.transferMaps,Us.drawImage(Ts,0,0),Us.filter="none",Fs.canvas}paintInlineImageXObject(Cs){if(!this.contentVisible)return;const Ts=Cs.width,$s=Cs.height,Ps=this.ctx;if(this.save(),!rs.isNodeJS){const{filter:Gs}=Ps;Gs!=="none"&&Gs!==""&&(Ps.filter="none")}Ps.scale(1/Ts,-1/$s);let Fs;if(Cs.bitmap)Fs=this.applyTransferMapsToBitmap(Cs);else if(typeof HTMLElement=="function"&&Cs instanceof HTMLElement||!Cs.data)Fs=Cs;else{const hr=this.cachedCanvases.getCanvas("inlineImage",Ts,$s).context;js(hr,Cs),Fs=this.applyTransferMapsToCanvas(hr)}const Us=this._scaleImage(Fs,(0,ns.getCurrentTransformInverse)(Ps));Ps.imageSmoothingEnabled=Ls((0,ns.getCurrentTransform)(Ps),Cs.interpolate),vs(Ps,Us.img,0,0,Us.paintWidth,Us.paintHeight,0,-$s,Ts,$s),this.compose(),this.restore()}paintInlineImageXObjectGroup(Cs,Ts){if(!this.contentVisible)return;const $s=this.ctx;let Ps;if(Cs.bitmap)Ps=Cs.bitmap;else{const Fs=Cs.width,Us=Cs.height,hr=this.cachedCanvases.getCanvas("inlineImage",Fs,Us).context;js(hr,Cs),Ps=this.applyTransferMapsToCanvas(hr)}for(const Fs of Ts)$s.save(),$s.transform(...Fs.transform),$s.scale(1,-1),vs($s,Ps,Fs.x,Fs.y,Fs.w,Fs.h,0,-1,1,1),$s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(Cs){}markPointProps(Cs,Ts){}beginMarkedContent(Cs){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(Cs,Ts){Cs==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(Ts)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(Cs){const Ts=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(Cs);const $s=this.ctx;this.pendingClip&&(Ts||(this.pendingClip===Qs?$s.clip("evenodd"):$s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),$s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const Cs=(0,ns.getCurrentTransform)(this.ctx);if(Cs[1]===0&&Cs[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(Cs[0]),Math.abs(Cs[3]));else{const Ts=Math.abs(Cs[0]*Cs[3]-Cs[2]*Cs[1]),$s=Math.hypot(Cs[0],Cs[2]),Ps=Math.hypot(Cs[1],Cs[3]);this._cachedGetSinglePixelWidth=Math.max($s,Ps)/Ts}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:Cs}=this.current,{a:Ts,b:$s,c:Ps,d:Fs}=this.ctx.getTransform();let Us,Gs;if($s===0&&Ps===0){const hr=Math.abs(Ts),ur=Math.abs(Fs);if(hr===ur)if(Cs===0)Us=Gs=1/hr;else{const cr=hr*Cs;Us=Gs=cr<1?1/cr:1}else if(Cs===0)Us=1/hr,Gs=1/ur;else{const cr=hr*Cs,Er=ur*Cs;Us=cr<1?1/cr:1,Gs=Er<1?1/Er:1}}else{const hr=Math.abs(Ts*Fs-$s*Ps),ur=Math.hypot(Ts,$s),cr=Math.hypot(Ps,Fs);if(Cs===0)Us=cr/hr,Gs=ur/hr;else{const Er=Cs*hr;Us=cr>Er?cr/Er:1,Gs=ur>Er?ur/Er:1}}this._cachedScaleForStroking[0]=Us,this._cachedScaleForStroking[1]=Gs}return this._cachedScaleForStroking}rescaleAndStroke(Cs){const{ctx:Ts}=this,{lineWidth:$s}=this.current,[Ps,Fs]=this.getScaleForStroking();if(Ts.lineWidth=$s||1,Ps===1&&Fs===1){Ts.stroke();return}const Us=Ts.getLineDash();if(Cs&&Ts.save(),Ts.scale(Ps,Fs),Us.length>0){const Gs=Math.max(Ps,Fs);Ts.setLineDash(Us.map(hr=>hr/Gs)),Ts.lineDashOffset/=Gs}Ts.stroke(),Cs&&Ts.restore()}isContentVisible(){for(let Cs=this.markedContentStack.length-1;Cs>=0;Cs--)if(!this.markedContentStack[Cs].visible)return!1;return!0}};Ws=new WeakSet,na=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},xa=function(){if(this.pageColors){const Cs=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(Cs!=="none"){const Ts=this.ctx.filter;this.ctx.filter=Cs,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=Ts}}};let Ys=Vs;ts.CanvasGraphics=Ys;for(const Ds in rs.OPS)Ys.prototype[Ds]!==void 0&&(Ys.prototype[rs.OPS[Ds]]=Ys.prototype[Ds])},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.TilingPattern=ts.PathType=void 0,ts.getShadingPattern=hs;var rs=ss(1),ns=ss(6);const os={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};ts.PathType=os;function as(gs,fs){if(!fs)return;const js=fs[2]-fs[0],Ss=fs[3]-fs[1],bs=new Path2D;bs.rect(fs[0],fs[1],js,Ss),gs.clip(bs)}class ls{constructor(){this.constructor===ls&&(0,rs.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,rs.unreachable)("Abstract method `getPattern` called.")}}class cs extends ls{constructor(fs){super(),this._type=fs[1],this._bbox=fs[2],this._colorStops=fs[3],this._p0=fs[4],this._p1=fs[5],this._r0=fs[6],this._r1=fs[7],this.matrix=null}_createGradient(fs){let js;this._type==="axial"?js=fs.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(js=fs.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const Ss of this._colorStops)js.addColorStop(Ss[0],Ss[1]);return js}getPattern(fs,js,Ss,bs){let Es;if(bs===os.STROKE||bs===os.FILL){const Rs=js.current.getClippedPathBoundingBox(bs,(0,ns.getCurrentTransform)(fs))||[0,0,0,0],ws=Math.ceil(Rs[2]-Rs[0])||1,Ns=Math.ceil(Rs[3]-Rs[1])||1,ks=js.cachedCanvases.getCanvas("pattern",ws,Ns,!0),_s=ks.context;_s.clearRect(0,0,_s.canvas.width,_s.canvas.height),_s.beginPath(),_s.rect(0,0,_s.canvas.width,_s.canvas.height),_s.translate(-Rs[0],-Rs[1]),Ss=rs.Util.transform(Ss,[1,0,0,1,Rs[0],Rs[1]]),_s.transform(...js.baseTransform),this.matrix&&_s.transform(...this.matrix),as(_s,this._bbox),_s.fillStyle=this._createGradient(_s),_s.fill(),Es=fs.createPattern(ks.canvas,"no-repeat");const Ls=new DOMMatrix(Ss);Es.setTransform(Ls)}else as(fs,this._bbox),Es=this._createGradient(fs);return Es}}function us(gs,fs,js,Ss,bs,Es,Rs,ws){const Ns=fs.coords,ks=fs.colors,_s=gs.data,Ls=gs.width*4;let Os;Ns[js+1]>Ns[Ss+1]&&(Os=js,js=Ss,Ss=Os,Os=Es,Es=Rs,Rs=Os),Ns[Ss+1]>Ns[bs+1]&&(Os=Ss,Ss=bs,bs=Os,Os=Rs,Rs=ws,ws=Os),Ns[js+1]>Ns[Ss+1]&&(Os=js,js=Ss,Ss=Os,Os=Es,Es=Rs,Rs=Os);const zs=(Ns[js]+fs.offsetX)*fs.scaleX,qs=(Ns[js+1]+fs.offsetY)*fs.scaleY,Qs=(Ns[Ss]+fs.offsetX)*fs.scaleX,Ys=(Ns[Ss+1]+fs.offsetY)*fs.scaleY,Ws=(Ns[bs]+fs.offsetX)*fs.scaleX,Is=(Ns[bs+1]+fs.offsetY)*fs.scaleY;if(qs>=Is)return;const Bs=ks[Es],Vs=ks[Es+1],Ds=ks[Es+2],Cs=ks[Rs],Ts=ks[Rs+1],$s=ks[Rs+2],Ps=ks[ws],Fs=ks[ws+1],Us=ks[ws+2],Gs=Math.round(qs),hr=Math.round(Is);let ur,cr,Er,Nr,kr,mr,xr,Ms;for(let Hs=Gs;Hs<=hr;Hs++){if(Hs<Ys){const Rr=Hs<qs?0:(qs-Hs)/(qs-Ys);ur=zs-(zs-Qs)*Rr,cr=Bs-(Bs-Cs)*Rr,Er=Vs-(Vs-Ts)*Rr,Nr=Ds-(Ds-$s)*Rr}else{let Rr;Hs>Is?Rr=1:Ys===Is?Rr=0:Rr=(Ys-Hs)/(Ys-Is),ur=Qs-(Qs-Ws)*Rr,cr=Cs-(Cs-Ps)*Rr,Er=Ts-(Ts-Fs)*Rr,Nr=$s-($s-Us)*Rr}let Js;Hs<qs?Js=0:Hs>Is?Js=1:Js=(qs-Hs)/(qs-Is),kr=zs-(zs-Ws)*Js,mr=Bs-(Bs-Ps)*Js,xr=Vs-(Vs-Fs)*Js,Ms=Ds-(Ds-Us)*Js;const Zs=Math.round(Math.min(ur,kr)),dr=Math.round(Math.max(ur,kr));let br=Ls*Hs+Zs*4;for(let Rr=Zs;Rr<=dr;Rr++)Js=(ur-Rr)/(ur-kr),Js<0?Js=0:Js>1&&(Js=1),_s[br++]=cr-(cr-mr)*Js|0,_s[br++]=Er-(Er-xr)*Js|0,_s[br++]=Nr-(Nr-Ms)*Js|0,_s[br++]=255}}function ds(gs,fs,js){const Ss=fs.coords,bs=fs.colors;let Es,Rs;switch(fs.type){case"lattice":const ws=fs.verticesPerRow,Ns=Math.floor(Ss.length/ws)-1,ks=ws-1;for(Es=0;Es<Ns;Es++){let _s=Es*ws;for(let Ls=0;Ls<ks;Ls++,_s++)us(gs,js,Ss[_s],Ss[_s+1],Ss[_s+ws],bs[_s],bs[_s+1],bs[_s+ws]),us(gs,js,Ss[_s+ws+1],Ss[_s+1],Ss[_s+ws],bs[_s+ws+1],bs[_s+1],bs[_s+ws])}break;case"triangles":for(Es=0,Rs=Ss.length;Es<Rs;Es+=3)us(gs,js,Ss[Es],Ss[Es+1],Ss[Es+2],bs[Es],bs[Es+1],bs[Es+2]);break;default:throw new Error("illegal figure")}}class ms extends ls{constructor(fs){super(),this._coords=fs[2],this._colors=fs[3],this._figures=fs[4],this._bounds=fs[5],this._bbox=fs[7],this._background=fs[8],this.matrix=null}_createMeshCanvas(fs,js,Ss){const ws=Math.floor(this._bounds[0]),Ns=Math.floor(this._bounds[1]),ks=Math.ceil(this._bounds[2])-ws,_s=Math.ceil(this._bounds[3])-Ns,Ls=Math.min(Math.ceil(Math.abs(ks*fs[0]*1.1)),3e3),Os=Math.min(Math.ceil(Math.abs(_s*fs[1]*1.1)),3e3),zs=ks/Ls,qs=_s/Os,Qs={coords:this._coords,colors:this._colors,offsetX:-ws,offsetY:-Ns,scaleX:1/zs,scaleY:1/qs},Ys=Ls+2*2,Ws=Os+2*2,Is=Ss.getCanvas("mesh",Ys,Ws,!1),Bs=Is.context,Vs=Bs.createImageData(Ls,Os);if(js){const Cs=Vs.data;for(let Ts=0,$s=Cs.length;Ts<$s;Ts+=4)Cs[Ts]=js[0],Cs[Ts+1]=js[1],Cs[Ts+2]=js[2],Cs[Ts+3]=255}for(const Cs of this._figures)ds(Vs,Cs,Qs);return Bs.putImageData(Vs,2,2),{canvas:Is.canvas,offsetX:ws-2*zs,offsetY:Ns-2*qs,scaleX:zs,scaleY:qs}}getPattern(fs,js,Ss,bs){as(fs,this._bbox);let Es;if(bs===os.SHADING)Es=rs.Util.singularValueDecompose2dScale((0,ns.getCurrentTransform)(fs));else if(Es=rs.Util.singularValueDecompose2dScale(js.baseTransform),this.matrix){const ws=rs.Util.singularValueDecompose2dScale(this.matrix);Es=[Es[0]*ws[0],Es[1]*ws[1]]}const Rs=this._createMeshCanvas(Es,bs===os.SHADING?null:this._background,js.cachedCanvases);return bs!==os.SHADING&&(fs.setTransform(...js.baseTransform),this.matrix&&fs.transform(...this.matrix)),fs.translate(Rs.offsetX,Rs.offsetY),fs.scale(Rs.scaleX,Rs.scaleY),fs.createPattern(Rs.canvas,"no-repeat")}}class ps extends ls{getPattern(){return"hotpink"}}function hs(gs){switch(gs[0]){case"RadialAxial":return new cs(gs);case"Mesh":return new ms(gs);case"Dummy":return new ps}throw new Error(`Unknown IR type: ${gs[0]}`)}const xs={COLORED:1,UNCOLORED:2},vs=class vs{constructor(fs,js,Ss,bs,Es){this.operatorList=fs[2],this.matrix=fs[3]||[1,0,0,1,0,0],this.bbox=fs[4],this.xstep=fs[5],this.ystep=fs[6],this.paintType=fs[7],this.tilingType=fs[8],this.color=js,this.ctx=Ss,this.canvasGraphicsFactory=bs,this.baseTransform=Es}createPatternCanvas(fs){const js=this.operatorList,Ss=this.bbox,bs=this.xstep,Es=this.ystep,Rs=this.paintType,ws=this.tilingType,Ns=this.color,ks=this.canvasGraphicsFactory;(0,rs.info)("TilingType: "+ws);const _s=Ss[0],Ls=Ss[1],Os=Ss[2],zs=Ss[3],qs=rs.Util.singularValueDecompose2dScale(this.matrix),Qs=rs.Util.singularValueDecompose2dScale(this.baseTransform),Ys=[qs[0]*Qs[0],qs[1]*Qs[1]],Ws=this.getSizeAndScale(bs,this.ctx.canvas.width,Ys[0]),Is=this.getSizeAndScale(Es,this.ctx.canvas.height,Ys[1]),Bs=fs.cachedCanvases.getCanvas("pattern",Ws.size,Is.size,!0),Vs=Bs.context,Ds=ks.createCanvasGraphics(Vs);Ds.groupLevel=fs.groupLevel,this.setFillAndStrokeStyleToContext(Ds,Rs,Ns);let Cs=_s,Ts=Ls,$s=Os,Ps=zs;return _s<0&&(Cs=0,$s+=Math.abs(_s)),Ls<0&&(Ts=0,Ps+=Math.abs(Ls)),Vs.translate(-(Ws.scale*Cs),-(Is.scale*Ts)),Ds.transform(Ws.scale,0,0,Is.scale,0,0),Vs.save(),this.clipBbox(Ds,Cs,Ts,$s,Ps),Ds.baseTransform=(0,ns.getCurrentTransform)(Ds.ctx),Ds.executeOperatorList(js),Ds.endDrawing(),{canvas:Bs.canvas,scaleX:Ws.scale,scaleY:Is.scale,offsetX:Cs,offsetY:Ts}}getSizeAndScale(fs,js,Ss){fs=Math.abs(fs);const bs=Math.max(vs.MAX_PATTERN_SIZE,js);let Es=Math.ceil(fs*Ss);return Es>=bs?Es=bs:Ss=Es/fs,{scale:Ss,size:Es}}clipBbox(fs,js,Ss,bs,Es){const Rs=bs-js,ws=Es-Ss;fs.ctx.rect(js,Ss,Rs,ws),fs.current.updateRectMinMax((0,ns.getCurrentTransform)(fs.ctx),[js,Ss,bs,Es]),fs.clip(),fs.endPath()}setFillAndStrokeStyleToContext(fs,js,Ss){const bs=fs.ctx,Es=fs.current;switch(js){case xs.COLORED:const Rs=this.ctx;bs.fillStyle=Rs.fillStyle,bs.strokeStyle=Rs.strokeStyle,Es.fillColor=Rs.fillStyle,Es.strokeColor=Rs.strokeStyle;break;case xs.UNCOLORED:const ws=rs.Util.makeHexColor(Ss[0],Ss[1],Ss[2]);bs.fillStyle=ws,bs.strokeStyle=ws,Es.fillColor=ws,Es.strokeColor=ws;break;default:throw new rs.FormatError(`Unsupported paint type: ${js}`)}}getPattern(fs,js,Ss,bs){let Es=Ss;bs!==os.SHADING&&(Es=rs.Util.transform(Es,js.baseTransform),this.matrix&&(Es=rs.Util.transform(Es,this.matrix)));const Rs=this.createPatternCanvas(js);let ws=new DOMMatrix(Es);ws=ws.translate(Rs.offsetX,Rs.offsetY),ws=ws.scale(1/Rs.scaleX,1/Rs.scaleY);const Ns=fs.createPattern(Rs.canvas,"repeat");return Ns.setTransform(ws),Ns}};eo(vs,"MAX_PATTERN_SIZE",3e3);let ys=vs;ts.TilingPattern=ys},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.convertBlackAndWhiteToRGBA=os,ts.convertToRGBA=ns,ts.grayToRGBA=ls;var rs=ss(1);function ns(cs){switch(cs.kind){case rs.ImageKind.GRAYSCALE_1BPP:return os(cs);case rs.ImageKind.RGB_24BPP:return as(cs)}return null}function os({src:cs,srcPos:us=0,dest:ds,width:ms,height:ps,nonBlackColor:hs=4294967295,inverseDecode:xs=!1}){const ys=rs.FeatureTest.isLittleEndian?4278190080:255,[vs,gs]=xs?[hs,ys]:[ys,hs],fs=ms>>3,js=ms&7,Ss=cs.length;ds=new Uint32Array(ds.buffer);let bs=0;for(let Es=0;Es<ps;Es++){for(const ws=us+fs;us<ws;us++){const Ns=us<Ss?cs[us]:255;ds[bs++]=Ns&128?gs:vs,ds[bs++]=Ns&64?gs:vs,ds[bs++]=Ns&32?gs:vs,ds[bs++]=Ns&16?gs:vs,ds[bs++]=Ns&8?gs:vs,ds[bs++]=Ns&4?gs:vs,ds[bs++]=Ns&2?gs:vs,ds[bs++]=Ns&1?gs:vs}if(js===0)continue;const Rs=us<Ss?cs[us++]:255;for(let ws=0;ws<js;ws++)ds[bs++]=Rs&1<<7-ws?gs:vs}return{srcPos:us,destPos:bs}}function as({src:cs,srcPos:us=0,dest:ds,destPos:ms=0,width:ps,height:hs}){let xs=0;const ys=cs.length>>2,vs=new Uint32Array(cs.buffer,us,ys);if(rs.FeatureTest.isLittleEndian){for(;xs<ys-2;xs+=3,ms+=4){const gs=vs[xs],fs=vs[xs+1],js=vs[xs+2];ds[ms]=gs|4278190080,ds[ms+1]=gs>>>24|fs<<8|4278190080,ds[ms+2]=fs>>>16|js<<16|4278190080,ds[ms+3]=js>>>8|4278190080}for(let gs=xs*4,fs=cs.length;gs<fs;gs+=3)ds[ms++]=cs[gs]|cs[gs+1]<<8|cs[gs+2]<<16|4278190080}else{for(;xs<ys-2;xs+=3,ms+=4){const gs=vs[xs],fs=vs[xs+1],js=vs[xs+2];ds[ms]=gs|255,ds[ms+1]=gs<<24|fs>>>8|255,ds[ms+2]=fs<<16|js>>>16|255,ds[ms+3]=js<<8|255}for(let gs=xs*4,fs=cs.length;gs<fs;gs+=3)ds[ms++]=cs[gs]<<24|cs[gs+1]<<16|cs[gs+2]<<8|255}return{srcPos:us,destPos:ms}}function ls(cs,us){if(rs.FeatureTest.isLittleEndian)for(let ds=0,ms=cs.length;ds<ms;ds++)us[ds]=cs[ds]*65793|4278190080;else for(let ds=0,ms=cs.length;ds<ms;ds++)us[ds]=cs[ds]*16843008|255}},(es,ts)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.GlobalWorkerOptions=void 0;const ss=Object.create(null);ts.GlobalWorkerOptions=ss,ss.workerPort=null,ss.workerSrc=""},(es,ts,ss)=>{var cs,Gl,Kl,Ao;Object.defineProperty(ts,"__esModule",{value:!0}),ts.MessageHandler=void 0;var rs=ss(1);const ns={DATA:1,ERROR:2},os={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function as(ps){switch(ps instanceof Error||typeof ps=="object"&&ps!==null||(0,rs.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),ps.name){case"AbortException":return new rs.AbortException(ps.message);case"MissingPDFException":return new rs.MissingPDFException(ps.message);case"PasswordException":return new rs.PasswordException(ps.message,ps.code);case"UnexpectedResponseException":return new rs.UnexpectedResponseException(ps.message,ps.status);case"UnknownErrorException":return new rs.UnknownErrorException(ps.message,ps.details);default:return new rs.UnknownErrorException(ps.message,ps.toString())}}class ls{constructor(hs,xs,ys){fr(this,cs);this.sourceName=hs,this.targetName=xs,this.comObj=ys,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=vs=>{const gs=vs.data;if(gs.targetName!==this.sourceName)return;if(gs.stream){pr(this,cs,Kl).call(this,gs);return}if(gs.callback){const js=gs.callbackId,Ss=this.callbackCapabilities[js];if(!Ss)throw new Error(`Cannot resolve callback ${js}`);if(delete this.callbackCapabilities[js],gs.callback===ns.DATA)Ss.resolve(gs.data);else if(gs.callback===ns.ERROR)Ss.reject(as(gs.reason));else throw new Error("Unexpected callback case");return}const fs=this.actionHandler[gs.action];if(!fs)throw new Error(`Unknown action from worker: ${gs.action}`);if(gs.callbackId){const js=this.sourceName,Ss=gs.sourceName;new Promise(function(bs){bs(fs(gs.data))}).then(function(bs){ys.postMessage({sourceName:js,targetName:Ss,callback:ns.DATA,callbackId:gs.callbackId,data:bs})},function(bs){ys.postMessage({sourceName:js,targetName:Ss,callback:ns.ERROR,callbackId:gs.callbackId,reason:as(bs)})});return}if(gs.streamId){pr(this,cs,Gl).call(this,gs);return}fs(gs.data)},ys.addEventListener("message",this._onComObjOnMessage)}on(hs,xs){const ys=this.actionHandler;if(ys[hs])throw new Error(`There is already an actionName called "${hs}"`);ys[hs]=xs}send(hs,xs,ys){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:hs,data:xs},ys)}sendWithPromise(hs,xs,ys){const vs=this.callbackId++,gs=new rs.PromiseCapability;this.callbackCapabilities[vs]=gs;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:hs,callbackId:vs,data:xs},ys)}catch(fs){gs.reject(fs)}return gs.promise}sendWithStream(hs,xs,ys,vs){const gs=this.streamId++,fs=this.sourceName,js=this.targetName,Ss=this.comObj;return new ReadableStream({start:bs=>{const Es=new rs.PromiseCapability;return this.streamControllers[gs]={controller:bs,startCall:Es,pullCall:null,cancelCall:null,isClosed:!1},Ss.postMessage({sourceName:fs,targetName:js,action:hs,streamId:gs,data:xs,desiredSize:bs.desiredSize},vs),Es.promise},pull:bs=>{const Es=new rs.PromiseCapability;return this.streamControllers[gs].pullCall=Es,Ss.postMessage({sourceName:fs,targetName:js,stream:os.PULL,streamId:gs,desiredSize:bs.desiredSize}),Es.promise},cancel:bs=>{(0,rs.assert)(bs instanceof Error,"cancel must have a valid reason");const Es=new rs.PromiseCapability;return this.streamControllers[gs].cancelCall=Es,this.streamControllers[gs].isClosed=!0,Ss.postMessage({sourceName:fs,targetName:js,stream:os.CANCEL,streamId:gs,reason:as(bs)}),Es.promise}},ys)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}cs=new WeakSet,Gl=function(hs){const xs=hs.streamId,ys=this.sourceName,vs=hs.sourceName,gs=this.comObj,fs=this,js=this.actionHandler[hs.action],Ss={enqueue(bs,Es=1,Rs){if(this.isCancelled)return;const ws=this.desiredSize;this.desiredSize-=Es,ws>0&&this.desiredSize<=0&&(this.sinkCapability=new rs.PromiseCapability,this.ready=this.sinkCapability.promise),gs.postMessage({sourceName:ys,targetName:vs,stream:os.ENQUEUE,streamId:xs,chunk:bs},Rs)},close(){this.isCancelled||(this.isCancelled=!0,gs.postMessage({sourceName:ys,targetName:vs,stream:os.CLOSE,streamId:xs}),delete fs.streamSinks[xs])},error(bs){(0,rs.assert)(bs instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,gs.postMessage({sourceName:ys,targetName:vs,stream:os.ERROR,streamId:xs,reason:as(bs)}))},sinkCapability:new rs.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:hs.desiredSize,ready:null};Ss.sinkCapability.resolve(),Ss.ready=Ss.sinkCapability.promise,this.streamSinks[xs]=Ss,new Promise(function(bs){bs(js(hs.data,Ss))}).then(function(){gs.postMessage({sourceName:ys,targetName:vs,stream:os.START_COMPLETE,streamId:xs,success:!0})},function(bs){gs.postMessage({sourceName:ys,targetName:vs,stream:os.START_COMPLETE,streamId:xs,reason:as(bs)})})},Kl=function(hs){const xs=hs.streamId,ys=this.sourceName,vs=hs.sourceName,gs=this.comObj,fs=this.streamControllers[xs],js=this.streamSinks[xs];switch(hs.stream){case os.START_COMPLETE:hs.success?fs.startCall.resolve():fs.startCall.reject(as(hs.reason));break;case os.PULL_COMPLETE:hs.success?fs.pullCall.resolve():fs.pullCall.reject(as(hs.reason));break;case os.PULL:if(!js){gs.postMessage({sourceName:ys,targetName:vs,stream:os.PULL_COMPLETE,streamId:xs,success:!0});break}js.desiredSize<=0&&hs.desiredSize>0&&js.sinkCapability.resolve(),js.desiredSize=hs.desiredSize,new Promise(function(Ss){var bs;Ss((bs=js.onPull)==null?void 0:bs.call(js))}).then(function(){gs.postMessage({sourceName:ys,targetName:vs,stream:os.PULL_COMPLETE,streamId:xs,success:!0})},function(Ss){gs.postMessage({sourceName:ys,targetName:vs,stream:os.PULL_COMPLETE,streamId:xs,reason:as(Ss)})});break;case os.ENQUEUE:if((0,rs.assert)(fs,"enqueue should have stream controller"),fs.isClosed)break;fs.controller.enqueue(hs.chunk);break;case os.CLOSE:if((0,rs.assert)(fs,"close should have stream controller"),fs.isClosed)break;fs.isClosed=!0,fs.controller.close(),pr(this,cs,Ao).call(this,fs,xs);break;case os.ERROR:(0,rs.assert)(fs,"error should have stream controller"),fs.controller.error(as(hs.reason)),pr(this,cs,Ao).call(this,fs,xs);break;case os.CANCEL_COMPLETE:hs.success?fs.cancelCall.resolve():fs.cancelCall.reject(as(hs.reason)),pr(this,cs,Ao).call(this,fs,xs);break;case os.CANCEL:if(!js)break;new Promise(function(Ss){var bs;Ss((bs=js.onCancel)==null?void 0:bs.call(js,as(hs.reason)))}).then(function(){gs.postMessage({sourceName:ys,targetName:vs,stream:os.CANCEL_COMPLETE,streamId:xs,success:!0})},function(Ss){gs.postMessage({sourceName:ys,targetName:vs,stream:os.CANCEL_COMPLETE,streamId:xs,reason:as(Ss)})}),js.sinkCapability.reject(as(hs.reason)),js.isCancelled=!0,delete this.streamSinks[xs];break;default:throw new Error("Unexpected stream case")}},Ao=async function(hs,xs){var ys,vs,gs;await Promise.allSettled([(ys=hs.startCall)==null?void 0:ys.promise,(vs=hs.pullCall)==null?void 0:vs.promise,(gs=hs.cancelCall)==null?void 0:gs.promise]),delete this.streamControllers[xs]},ts.MessageHandler=ls},(es,ts,ss)=>{var os,as;Object.defineProperty(ts,"__esModule",{value:!0}),ts.Metadata=void 0;var rs=ss(1);class ns{constructor({parsedData:cs,rawData:us}){fr(this,os);fr(this,as);jr(this,os,cs),jr(this,as,us)}getRaw(){return As(this,as)}get(cs){return As(this,os).get(cs)??null}getAll(){return(0,rs.objectFromMap)(As(this,os))}has(cs){return As(this,os).has(cs)}}os=new WeakMap,as=new WeakMap,ts.Metadata=ns},(es,ts,ss)=>{var cs,us,ds,ms,ps,hs,ga;Object.defineProperty(ts,"__esModule",{value:!0}),ts.OptionalContentConfig=void 0;var rs=ss(1),ns=ss(8);const os=Symbol("INTERNAL");class as{constructor(vs,gs){fr(this,cs,!0);this.name=vs,this.intent=gs}get visible(){return As(this,cs)}_setVisible(vs,gs){vs!==os&&(0,rs.unreachable)("Internal method `_setVisible` called."),jr(this,cs,gs)}}cs=new WeakMap;class ls{constructor(vs){fr(this,hs);fr(this,us,null);fr(this,ds,new Map);fr(this,ms,null);fr(this,ps,null);if(this.name=null,this.creator=null,vs!==null){this.name=vs.name,this.creator=vs.creator,jr(this,ps,vs.order);for(const gs of vs.groups)As(this,ds).set(gs.id,new as(gs.name,gs.intent));if(vs.baseState==="OFF")for(const gs of As(this,ds).values())gs._setVisible(os,!1);for(const gs of vs.on)As(this,ds).get(gs)._setVisible(os,!0);for(const gs of vs.off)As(this,ds).get(gs)._setVisible(os,!1);jr(this,ms,this.getHash())}}isVisible(vs){if(As(this,ds).size===0)return!0;if(!vs)return(0,rs.warn)("Optional content group not defined."),!0;if(vs.type==="OCG")return As(this,ds).has(vs.id)?As(this,ds).get(vs.id).visible:((0,rs.warn)(`Optional content group not found: ${vs.id}`),!0);if(vs.type==="OCMD"){if(vs.expression)return pr(this,hs,ga).call(this,vs.expression);if(!vs.policy||vs.policy==="AnyOn"){for(const gs of vs.ids){if(!As(this,ds).has(gs))return(0,rs.warn)(`Optional content group not found: ${gs}`),!0;if(As(this,ds).get(gs).visible)return!0}return!1}else if(vs.policy==="AllOn"){for(const gs of vs.ids){if(!As(this,ds).has(gs))return(0,rs.warn)(`Optional content group not found: ${gs}`),!0;if(!As(this,ds).get(gs).visible)return!1}return!0}else if(vs.policy==="AnyOff"){for(const gs of vs.ids){if(!As(this,ds).has(gs))return(0,rs.warn)(`Optional content group not found: ${gs}`),!0;if(!As(this,ds).get(gs).visible)return!0}return!1}else if(vs.policy==="AllOff"){for(const gs of vs.ids){if(!As(this,ds).has(gs))return(0,rs.warn)(`Optional content group not found: ${gs}`),!0;if(As(this,ds).get(gs).visible)return!1}return!0}return(0,rs.warn)(`Unknown optional content policy ${vs.policy}.`),!0}return(0,rs.warn)(`Unknown group type ${vs.type}.`),!0}setVisibility(vs,gs=!0){if(!As(this,ds).has(vs)){(0,rs.warn)(`Optional content group not found: ${vs}`);return}As(this,ds).get(vs)._setVisible(os,!!gs),jr(this,us,null)}get hasInitialVisibility(){return As(this,ms)===null||this.getHash()===As(this,ms)}getOrder(){return As(this,ds).size?As(this,ps)?As(this,ps).slice():[...As(this,ds).keys()]:null}getGroups(){return As(this,ds).size>0?(0,rs.objectFromMap)(As(this,ds)):null}getGroup(vs){return As(this,ds).get(vs)||null}getHash(){if(As(this,us)!==null)return As(this,us);const vs=new ns.MurmurHash3_64;for(const[gs,fs]of As(this,ds))vs.update(`${gs}:${fs.visible}`);return jr(this,us,vs.hexdigest())}}us=new WeakMap,ds=new WeakMap,ms=new WeakMap,ps=new WeakMap,hs=new WeakSet,ga=function(vs){const gs=vs.length;if(gs<2)return!0;const fs=vs[0];for(let js=1;js<gs;js++){const Ss=vs[js];let bs;if(Array.isArray(Ss))bs=pr(this,hs,ga).call(this,Ss);else if(As(this,ds).has(Ss))bs=As(this,ds).get(Ss).visible;else return(0,rs.warn)(`Optional content group not found: ${Ss}`),!0;switch(fs){case"And":if(!bs)return!1;break;case"Or":if(bs)return!0;break;case"Not":return!bs;default:return!0}}return fs==="And"},ts.OptionalContentConfig=ls},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.PDFDataTransportStream=void 0;var rs=ss(1),ns=ss(6);class os{constructor({length:us,initialData:ds,progressiveDone:ms=!1,contentDispositionFilename:ps=null,disableRange:hs=!1,disableStream:xs=!1},ys){if((0,rs.assert)(ys,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=ms,this._contentDispositionFilename=ps,(ds==null?void 0:ds.length)>0){const vs=ds instanceof Uint8Array&&ds.byteLength===ds.buffer.byteLength?ds.buffer:new Uint8Array(ds).buffer;this._queuedChunks.push(vs)}this._pdfDataRangeTransport=ys,this._isStreamingSupported=!xs,this._isRangeSupported=!hs,this._contentLength=us,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((vs,gs)=>{this._onReceiveData({begin:vs,chunk:gs})}),this._pdfDataRangeTransport.addProgressListener((vs,gs)=>{this._onProgress({loaded:vs,total:gs})}),this._pdfDataRangeTransport.addProgressiveReadListener(vs=>{this._onReceiveData({chunk:vs})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:us,chunk:ds}){const ms=ds instanceof Uint8Array&&ds.byteLength===ds.buffer.byteLength?ds.buffer:new Uint8Array(ds).buffer;if(us===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(ms):this._queuedChunks.push(ms);else{const ps=this._rangeReaders.some(function(hs){return hs._begin!==us?!1:(hs._enqueue(ms),!0)});(0,rs.assert)(ps,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var us;return((us=this._fullRequestReader)==null?void 0:us._loaded)??0}_onProgress(us){var ds,ms,ps,hs;us.total===void 0?(ms=(ds=this._rangeReaders[0])==null?void 0:ds.onProgress)==null||ms.call(ds,{loaded:us.loaded}):(hs=(ps=this._fullRequestReader)==null?void 0:ps.onProgress)==null||hs.call(ps,{loaded:us.loaded,total:us.total})}_onProgressiveDone(){var us;(us=this._fullRequestReader)==null||us.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(us){const ds=this._rangeReaders.indexOf(us);ds>=0&&this._rangeReaders.splice(ds,1)}getFullReader(){(0,rs.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const us=this._queuedChunks;return this._queuedChunks=null,new as(this,us,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(us,ds){if(ds<=this._progressiveDataLength)return null;const ms=new ls(this,us,ds);return this._pdfDataRangeTransport.requestDataRange(us,ds),this._rangeReaders.push(ms),ms}cancelAllRequests(us){var ds;(ds=this._fullRequestReader)==null||ds.cancel(us);for(const ms of this._rangeReaders.slice(0))ms.cancel(us);this._pdfDataRangeTransport.abort()}}ts.PDFDataTransportStream=os;class as{constructor(us,ds,ms=!1,ps=null){this._stream=us,this._done=ms||!1,this._filename=(0,ns.isPdfFile)(ps)?ps:null,this._queuedChunks=ds||[],this._loaded=0;for(const hs of this._queuedChunks)this._loaded+=hs.byteLength;this._requests=[],this._headersReady=Promise.resolve(),us._fullRequestReader=this,this.onProgress=null}_enqueue(us){this._done||(this._requests.length>0?this._requests.shift().resolve({value:us,done:!1}):this._queuedChunks.push(us),this._loaded+=us.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const us=new rs.PromiseCapability;return this._requests.push(us),us.promise}cancel(us){this._done=!0;for(const ds of this._requests)ds.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class ls{constructor(us,ds,ms){this._stream=us,this._begin=ds,this._end=ms,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(us){if(!this._done){if(this._requests.length===0)this._queuedChunk=us;else{this._requests.shift().resolve({value:us,done:!1});for(const ms of this._requests)ms.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const ds=this._queuedChunk;return this._queuedChunk=null,{value:ds,done:!1}}if(this._done)return{value:void 0,done:!0};const us=new rs.PromiseCapability;return this._requests.push(us),us.promise}cancel(us){this._done=!0;for(const ds of this._requests)ds.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.PDFFetchStream=void 0;var rs=ss(1),ns=ss(20);function os(ms,ps,hs){return{method:"GET",headers:ms,signal:hs.signal,mode:"cors",credentials:ps?"include":"same-origin",redirect:"follow"}}function as(ms){const ps=new Headers;for(const hs in ms){const xs=ms[hs];xs!==void 0&&ps.append(hs,xs)}return ps}function ls(ms){return ms instanceof Uint8Array?ms.buffer:ms instanceof ArrayBuffer?ms:((0,rs.warn)(`getArrayBuffer - unexpected data format: ${ms}`),new Uint8Array(ms).buffer)}class cs{constructor(ps){this.source=ps,this.isHttp=/^https?:/i.test(ps.url),this.httpHeaders=this.isHttp&&ps.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var ps;return((ps=this._fullRequestReader)==null?void 0:ps._loaded)??0}getFullReader(){return(0,rs.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new us(this),this._fullRequestReader}getRangeReader(ps,hs){if(hs<=this._progressiveDataLength)return null;const xs=new ds(this,ps,hs);return this._rangeRequestReaders.push(xs),xs}cancelAllRequests(ps){var hs;(hs=this._fullRequestReader)==null||hs.cancel(ps);for(const xs of this._rangeRequestReaders.slice(0))xs.cancel(ps)}}ts.PDFFetchStream=cs;class us{constructor(ps){this._stream=ps,this._reader=null,this._loaded=0,this._filename=null;const hs=ps.source;this._withCredentials=hs.withCredentials||!1,this._contentLength=hs.length,this._headersCapability=new rs.PromiseCapability,this._disableRange=hs.disableRange||!1,this._rangeChunkSize=hs.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!hs.disableStream,this._isRangeSupported=!hs.disableRange,this._headers=as(this._stream.httpHeaders);const xs=hs.url;fetch(xs,os(this._headers,this._withCredentials,this._abortController)).then(ys=>{if(!(0,ns.validateResponseStatus)(ys.status))throw(0,ns.createResponseStatusError)(ys.status,xs);this._reader=ys.body.getReader(),this._headersCapability.resolve();const vs=js=>ys.headers.get(js),{allowRangeRequests:gs,suggestedLength:fs}=(0,ns.validateRangeRequestCapabilities)({getResponseHeader:vs,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=gs,this._contentLength=fs||this._contentLength,this._filename=(0,ns.extractFilenameFromHeader)(vs),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new rs.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var xs;await this._headersCapability.promise;const{value:ps,done:hs}=await this._reader.read();return hs?{value:ps,done:hs}:(this._loaded+=ps.byteLength,(xs=this.onProgress)==null||xs.call(this,{loaded:this._loaded,total:this._contentLength}),{value:ls(ps),done:!1})}cancel(ps){var hs;(hs=this._reader)==null||hs.cancel(ps),this._abortController.abort()}}class ds{constructor(ps,hs,xs){this._stream=ps,this._reader=null,this._loaded=0;const ys=ps.source;this._withCredentials=ys.withCredentials||!1,this._readCapability=new rs.PromiseCapability,this._isStreamingSupported=!ys.disableStream,this._abortController=new AbortController,this._headers=as(this._stream.httpHeaders),this._headers.append("Range",`bytes=${hs}-${xs-1}`);const vs=ys.url;fetch(vs,os(this._headers,this._withCredentials,this._abortController)).then(gs=>{if(!(0,ns.validateResponseStatus)(gs.status))throw(0,ns.createResponseStatusError)(gs.status,vs);this._readCapability.resolve(),this._reader=gs.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var xs;await this._readCapability.promise;const{value:ps,done:hs}=await this._reader.read();return hs?{value:ps,done:hs}:(this._loaded+=ps.byteLength,(xs=this.onProgress)==null||xs.call(this,{loaded:this._loaded}),{value:ls(ps),done:!1})}cancel(ps){var hs;(hs=this._reader)==null||hs.cancel(ps),this._abortController.abort()}}},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.createResponseStatusError=cs,ts.extractFilenameFromHeader=ls,ts.validateRangeRequestCapabilities=as,ts.validateResponseStatus=us;var rs=ss(1),ns=ss(21),os=ss(6);function as({getResponseHeader:ds,isHttp:ms,rangeChunkSize:ps,disableRange:hs}){const xs={allowRangeRequests:!1,suggestedLength:void 0},ys=parseInt(ds("Content-Length"),10);return!Number.isInteger(ys)||(xs.suggestedLength=ys,ys<=2*ps)||hs||!ms||ds("Accept-Ranges")!=="bytes"||(ds("Content-Encoding")||"identity")!=="identity"||(xs.allowRangeRequests=!0),xs}function ls(ds){const ms=ds("Content-Disposition");if(ms){let ps=(0,ns.getFilenameFromContentDispositionHeader)(ms);if(ps.includes("%"))try{ps=decodeURIComponent(ps)}catch{}if((0,os.isPdfFile)(ps))return ps}return null}function cs(ds,ms){return ds===404||ds===0&&ms.startsWith("file:")?new rs.MissingPDFException('Missing PDF "'+ms+'".'):new rs.UnexpectedResponseException(`Unexpected server response (${ds}) while retrieving PDF "${ms}".`,ds)}function us(ds){return ds===200||ds===206}},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.getFilenameFromContentDispositionHeader=ns;var rs=ss(1);function ns(os){let as=!0,ls=cs("filename\\*","i").exec(os);if(ls){ls=ls[1];let ys=ps(ls);return ys=unescape(ys),ys=hs(ys),ys=xs(ys),ds(ys)}if(ls=ms(os),ls){const ys=xs(ls);return ds(ys)}if(ls=cs("filename","i").exec(os),ls){ls=ls[1];let ys=ps(ls);return ys=xs(ys),ds(ys)}function cs(ys,vs){return new RegExp("(?:^|;)\\s*"+ys+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',vs)}function us(ys,vs){if(ys){if(!/^[\x00-\xFF]+$/.test(vs))return vs;try{const gs=new TextDecoder(ys,{fatal:!0}),fs=(0,rs.stringToBytes)(vs);vs=gs.decode(fs),as=!1}catch{}}return vs}function ds(ys){return as&&/[\x80-\xff]/.test(ys)&&(ys=us("utf-8",ys),as&&(ys=us("iso-8859-1",ys))),ys}function ms(ys){const vs=[];let gs;const fs=cs("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(gs=fs.exec(ys))!==null;){let[,Ss,bs,Es]=gs;if(Ss=parseInt(Ss,10),Ss in vs){if(Ss===0)break;continue}vs[Ss]=[bs,Es]}const js=[];for(let Ss=0;Ss<vs.length&&Ss in vs;++Ss){let[bs,Es]=vs[Ss];Es=ps(Es),bs&&(Es=unescape(Es),Ss===0&&(Es=hs(Es))),js.push(Es)}return js.join("")}function ps(ys){if(ys.startsWith('"')){const vs=ys.slice(1).split('\\"');for(let gs=0;gs<vs.length;++gs){const fs=vs[gs].indexOf('"');fs!==-1&&(vs[gs]=vs[gs].slice(0,fs),vs.length=gs+1),vs[gs]=vs[gs].replaceAll(/\\(.)/g,"$1")}ys=vs.join('"')}return ys}function hs(ys){const vs=ys.indexOf("'");if(vs===-1)return ys;const gs=ys.slice(0,vs),js=ys.slice(vs+1).replace(/^[^']*'/,"");return us(gs,js)}function xs(ys){return!ys.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(ys)?ys:ys.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(vs,gs,fs,js){if(fs==="q"||fs==="Q")return js=js.replaceAll("_"," "),js=js.replaceAll(/=([0-9a-fA-F]{2})/g,function(Ss,bs){return String.fromCharCode(parseInt(bs,16))}),us(gs,js);try{js=atob(js)}catch{}return us(gs,js)})}return""}},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.PDFNetworkStream=void 0;var rs=ss(1),ns=ss(20);const os=200,as=206;function ls(ps){const hs=ps.response;return typeof hs!="string"?hs:(0,rs.stringToBytes)(hs).buffer}class cs{constructor(hs,xs={}){this.url=hs,this.isHttp=/^https?:/i.test(hs),this.httpHeaders=this.isHttp&&xs.httpHeaders||Object.create(null),this.withCredentials=xs.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(hs,xs,ys){const vs={begin:hs,end:xs};for(const gs in ys)vs[gs]=ys[gs];return this.request(vs)}requestFull(hs){return this.request(hs)}request(hs){const xs=new XMLHttpRequest,ys=this.currXhrId++,vs=this.pendingRequests[ys]={xhr:xs};xs.open("GET",this.url),xs.withCredentials=this.withCredentials;for(const gs in this.httpHeaders){const fs=this.httpHeaders[gs];fs!==void 0&&xs.setRequestHeader(gs,fs)}return this.isHttp&&"begin"in hs&&"end"in hs?(xs.setRequestHeader("Range",`bytes=${hs.begin}-${hs.end-1}`),vs.expectedStatus=as):vs.expectedStatus=os,xs.responseType="arraybuffer",hs.onError&&(xs.onerror=function(gs){hs.onError(xs.status)}),xs.onreadystatechange=this.onStateChange.bind(this,ys),xs.onprogress=this.onProgress.bind(this,ys),vs.onHeadersReceived=hs.onHeadersReceived,vs.onDone=hs.onDone,vs.onError=hs.onError,vs.onProgress=hs.onProgress,xs.send(null),ys}onProgress(hs,xs){var vs;const ys=this.pendingRequests[hs];ys&&((vs=ys.onProgress)==null||vs.call(ys,xs))}onStateChange(hs,xs){var Ss,bs,Es;const ys=this.pendingRequests[hs];if(!ys)return;const vs=ys.xhr;if(vs.readyState>=2&&ys.onHeadersReceived&&(ys.onHeadersReceived(),delete ys.onHeadersReceived),vs.readyState!==4||!(hs in this.pendingRequests))return;if(delete this.pendingRequests[hs],vs.status===0&&this.isHttp){(Ss=ys.onError)==null||Ss.call(ys,vs.status);return}const gs=vs.status||os;if(!(gs===os&&ys.expectedStatus===as)&&gs!==ys.expectedStatus){(bs=ys.onError)==null||bs.call(ys,vs.status);return}const js=ls(vs);if(gs===as){const Rs=vs.getResponseHeader("Content-Range"),ws=/bytes (\d+)-(\d+)\/(\d+)/.exec(Rs);ys.onDone({begin:parseInt(ws[1],10),chunk:js})}else js?ys.onDone({begin:0,chunk:js}):(Es=ys.onError)==null||Es.call(ys,vs.status)}getRequestXhr(hs){return this.pendingRequests[hs].xhr}isPendingRequest(hs){return hs in this.pendingRequests}abortRequest(hs){const xs=this.pendingRequests[hs].xhr;delete this.pendingRequests[hs],xs.abort()}}class us{constructor(hs){this._source=hs,this._manager=new cs(hs.url,{httpHeaders:hs.httpHeaders,withCredentials:hs.withCredentials}),this._rangeChunkSize=hs.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(hs){const xs=this._rangeRequestReaders.indexOf(hs);xs>=0&&this._rangeRequestReaders.splice(xs,1)}getFullReader(){return(0,rs.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new ds(this._manager,this._source),this._fullRequestReader}getRangeReader(hs,xs){const ys=new ms(this._manager,hs,xs);return ys.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(ys),ys}cancelAllRequests(hs){var xs;(xs=this._fullRequestReader)==null||xs.cancel(hs);for(const ys of this._rangeRequestReaders.slice(0))ys.cancel(hs)}}ts.PDFNetworkStream=us;class ds{constructor(hs,xs){this._manager=hs;const ys={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=xs.url,this._fullRequestId=hs.requestFull(ys),this._headersReceivedCapability=new rs.PromiseCapability,this._disableRange=xs.disableRange||!1,this._contentLength=xs.length,this._rangeChunkSize=xs.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const hs=this._fullRequestId,xs=this._manager.getRequestXhr(hs),ys=fs=>xs.getResponseHeader(fs),{allowRangeRequests:vs,suggestedLength:gs}=(0,ns.validateRangeRequestCapabilities)({getResponseHeader:ys,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});vs&&(this._isRangeSupported=!0),this._contentLength=gs||this._contentLength,this._filename=(0,ns.extractFilenameFromHeader)(ys),this._isRangeSupported&&this._manager.abortRequest(hs),this._headersReceivedCapability.resolve()}_onDone(hs){if(hs&&(this._requests.length>0?this._requests.shift().resolve({value:hs.chunk,done:!1}):this._cachedChunks.push(hs.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const xs of this._requests)xs.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(hs){this._storedError=(0,ns.createResponseStatusError)(hs,this._url),this._headersReceivedCapability.reject(this._storedError);for(const xs of this._requests)xs.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(hs){var xs;(xs=this.onProgress)==null||xs.call(this,{loaded:hs.loaded,total:hs.lengthComputable?hs.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const hs=new rs.PromiseCapability;return this._requests.push(hs),hs.promise}cancel(hs){this._done=!0,this._headersReceivedCapability.reject(hs);for(const xs of this._requests)xs.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class ms{constructor(hs,xs,ys){this._manager=hs;const vs={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=hs.url,this._requestId=hs.requestRange(xs,ys,vs),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var hs;(hs=this.onClosed)==null||hs.call(this,this)}_onDone(hs){const xs=hs.chunk;this._requests.length>0?this._requests.shift().resolve({value:xs,done:!1}):this._queuedChunk=xs,this._done=!0;for(const ys of this._requests)ys.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(hs){this._storedError=(0,ns.createResponseStatusError)(hs,this._url);for(const xs of this._requests)xs.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(hs){var xs;this.isStreamingSupported||(xs=this.onProgress)==null||xs.call(this,{loaded:hs.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const xs=this._queuedChunk;return this._queuedChunk=null,{value:xs,done:!1}}if(this._done)return{value:void 0,done:!0};const hs=new rs.PromiseCapability;return this._requests.push(hs),hs.promise}cancel(hs){this._done=!0;for(const xs of this._requests)xs.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.PDFNodeStream=void 0;var rs=ss(1),ns=ss(20);const os=/^file:\/\/\/[a-zA-Z]:\//;function as(ys){const vs=require$$5,gs=vs.parse(ys);return gs.protocol==="file:"||gs.host?gs:/^[a-z]:[/\\]/i.test(ys)?vs.parse(`file:///${ys}`):(gs.host||(gs.protocol="file:"),gs)}class ls{constructor(vs){this.source=vs,this.url=as(vs.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&vs.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var vs;return((vs=this._fullRequestReader)==null?void 0:vs._loaded)??0}getFullReader(){return(0,rs.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new hs(this):new ms(this),this._fullRequestReader}getRangeReader(vs,gs){if(gs<=this._progressiveDataLength)return null;const fs=this.isFsUrl?new xs(this,vs,gs):new ps(this,vs,gs);return this._rangeRequestReaders.push(fs),fs}cancelAllRequests(vs){var gs;(gs=this._fullRequestReader)==null||gs.cancel(vs);for(const fs of this._rangeRequestReaders.slice(0))fs.cancel(vs)}}ts.PDFNodeStream=ls;class cs{constructor(vs){this._url=vs.url,this._done=!1,this._storedError=null,this.onProgress=null;const gs=vs.source;this._contentLength=gs.length,this._loaded=0,this._filename=null,this._disableRange=gs.disableRange||!1,this._rangeChunkSize=gs.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!gs.disableStream,this._isRangeSupported=!gs.disableRange,this._readableStream=null,this._readCapability=new rs.PromiseCapability,this._headersCapability=new rs.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var fs;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const vs=this._readableStream.read();return vs===null?(this._readCapability=new rs.PromiseCapability,this.read()):(this._loaded+=vs.length,(fs=this.onProgress)==null||fs.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(vs).buffer,done:!1})}cancel(vs){if(!this._readableStream){this._error(vs);return}this._readableStream.destroy(vs)}_error(vs){this._storedError=vs,this._readCapability.resolve()}_setReadableStream(vs){this._readableStream=vs,vs.on("readable",()=>{this._readCapability.resolve()}),vs.on("end",()=>{vs.destroy(),this._done=!0,this._readCapability.resolve()}),vs.on("error",gs=>{this._error(gs)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new rs.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class us{constructor(vs){this._url=vs.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new rs.PromiseCapability;const gs=vs.source;this._isStreamingSupported=!gs.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var fs;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const vs=this._readableStream.read();return vs===null?(this._readCapability=new rs.PromiseCapability,this.read()):(this._loaded+=vs.length,(fs=this.onProgress)==null||fs.call(this,{loaded:this._loaded}),{value:new Uint8Array(vs).buffer,done:!1})}cancel(vs){if(!this._readableStream){this._error(vs);return}this._readableStream.destroy(vs)}_error(vs){this._storedError=vs,this._readCapability.resolve()}_setReadableStream(vs){this._readableStream=vs,vs.on("readable",()=>{this._readCapability.resolve()}),vs.on("end",()=>{vs.destroy(),this._done=!0,this._readCapability.resolve()}),vs.on("error",gs=>{this._error(gs)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function ds(ys,vs){return{protocol:ys.protocol,auth:ys.auth,host:ys.hostname,port:ys.port,path:ys.path,method:"GET",headers:vs}}class ms extends cs{constructor(vs){super(vs);const gs=fs=>{if(fs.statusCode===404){const Es=new rs.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Es,this._headersCapability.reject(Es);return}this._headersCapability.resolve(),this._setReadableStream(fs);const js=Es=>this._readableStream.headers[Es.toLowerCase()],{allowRangeRequests:Ss,suggestedLength:bs}=(0,ns.validateRangeRequestCapabilities)({getResponseHeader:js,isHttp:vs.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=Ss,this._contentLength=bs||this._contentLength,this._filename=(0,ns.extractFilenameFromHeader)(js)};if(this._request=null,this._url.protocol==="http:"){const fs=require$$5;this._request=fs.request(ds(this._url,vs.httpHeaders),gs)}else{const fs=require$$5;this._request=fs.request(ds(this._url,vs.httpHeaders),gs)}this._request.on("error",fs=>{this._storedError=fs,this._headersCapability.reject(fs)}),this._request.end()}}class ps extends us{constructor(vs,gs,fs){super(vs),this._httpHeaders={};for(const Ss in vs.httpHeaders){const bs=vs.httpHeaders[Ss];bs!==void 0&&(this._httpHeaders[Ss]=bs)}this._httpHeaders.Range=`bytes=${gs}-${fs-1}`;const js=Ss=>{if(Ss.statusCode===404){const bs=new rs.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=bs;return}this._setReadableStream(Ss)};if(this._request=null,this._url.protocol==="http:"){const Ss=require$$5;this._request=Ss.request(ds(this._url,this._httpHeaders),js)}else{const Ss=require$$5;this._request=Ss.request(ds(this._url,this._httpHeaders),js)}this._request.on("error",Ss=>{this._storedError=Ss}),this._request.end()}}class hs extends cs{constructor(vs){super(vs);let gs=decodeURIComponent(this._url.path);os.test(this._url.href)&&(gs=gs.replace(/^\//,""));const fs=require$$5;fs.lstat(gs,(js,Ss)=>{if(js){js.code==="ENOENT"&&(js=new rs.MissingPDFException(`Missing PDF "${gs}".`)),this._storedError=js,this._headersCapability.reject(js);return}this._contentLength=Ss.size,this._setReadableStream(fs.createReadStream(gs)),this._headersCapability.resolve()})}}class xs extends us{constructor(vs,gs,fs){super(vs);let js=decodeURIComponent(this._url.path);os.test(this._url.href)&&(js=js.replace(/^\//,""));const Ss=require$$5;this._setReadableStream(Ss.createReadStream(js,{start:gs,end:fs-1}))}}},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.SVGGraphics=void 0;var rs=ss(6),ns=ss(1);const os={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},as="http://www.w3.org/XML/1998/namespace",ls="http://www.w3.org/1999/xlink",cs=["butt","round","square"],us=["miter","round","bevel"],ds=function(Ss,bs="",Es=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!Es)return URL.createObjectURL(new Blob([Ss],{type:bs}));const Rs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let ws=`data:${bs};base64,`;for(let Ns=0,ks=Ss.length;Ns<ks;Ns+=3){const _s=Ss[Ns]&255,Ls=Ss[Ns+1]&255,Os=Ss[Ns+2]&255,zs=_s>>2,qs=(_s&3)<<4|Ls>>4,Qs=Ns+1<ks?(Ls&15)<<2|Os>>6:64,Ys=Ns+2<ks?Os&63:64;ws+=Rs[zs]+Rs[qs]+Rs[Qs]+Rs[Ys]}return ws},ms=function(){const Ss=new Uint8Array([137,80,78,71,13,10,26,10]),bs=12,Es=new Int32Array(256);for(let Os=0;Os<256;Os++){let zs=Os;for(let qs=0;qs<8;qs++)zs=zs&1?3988292384^zs>>1&2147483647:zs>>1&2147483647;Es[Os]=zs}function Rs(Os,zs,qs){let Qs=-1;for(let Ys=zs;Ys<qs;Ys++){const Ws=(Qs^Os[Ys])&255,Is=Es[Ws];Qs=Qs>>>8^Is}return Qs^-1}function ws(Os,zs,qs,Qs){let Ys=Qs;const Ws=zs.length;qs[Ys]=Ws>>24&255,qs[Ys+1]=Ws>>16&255,qs[Ys+2]=Ws>>8&255,qs[Ys+3]=Ws&255,Ys+=4,qs[Ys]=Os.charCodeAt(0)&255,qs[Ys+1]=Os.charCodeAt(1)&255,qs[Ys+2]=Os.charCodeAt(2)&255,qs[Ys+3]=Os.charCodeAt(3)&255,Ys+=4,qs.set(zs,Ys),Ys+=zs.length;const Is=Rs(qs,Qs+4,Ys);qs[Ys]=Is>>24&255,qs[Ys+1]=Is>>16&255,qs[Ys+2]=Is>>8&255,qs[Ys+3]=Is&255}function Ns(Os,zs,qs){let Qs=1,Ys=0;for(let Ws=zs;Ws<qs;++Ws)Qs=(Qs+(Os[Ws]&255))%65521,Ys=(Ys+Qs)%65521;return Ys<<16|Qs}function ks(Os){if(!ns.isNodeJS)return _s(Os);try{const zs=parseInt(process.versions.node)>=8?Os:Buffer.from(Os),qs=require$$5.deflateSync(zs,{level:9});return qs instanceof Uint8Array?qs:new Uint8Array(qs)}catch(zs){(0,ns.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+zs)}return _s(Os)}function _s(Os){let zs=Os.length;const qs=65535,Qs=Math.ceil(zs/qs),Ys=new Uint8Array(2+zs+Qs*5+4);let Ws=0;Ys[Ws++]=120,Ys[Ws++]=156;let Is=0;for(;zs>qs;)Ys[Ws++]=0,Ys[Ws++]=255,Ys[Ws++]=255,Ys[Ws++]=0,Ys[Ws++]=0,Ys.set(Os.subarray(Is,Is+qs),Ws),Ws+=qs,Is+=qs,zs-=qs;Ys[Ws++]=1,Ys[Ws++]=zs&255,Ys[Ws++]=zs>>8&255,Ys[Ws++]=~zs&65535&255,Ys[Ws++]=(~zs&65535)>>8&255,Ys.set(Os.subarray(Is),Ws),Ws+=Os.length-Is;const Bs=Ns(Os,0,Os.length);return Ys[Ws++]=Bs>>24&255,Ys[Ws++]=Bs>>16&255,Ys[Ws++]=Bs>>8&255,Ys[Ws++]=Bs&255,Ys}function Ls(Os,zs,qs,Qs){const Ys=Os.width,Ws=Os.height;let Is,Bs,Vs;const Ds=Os.data;switch(zs){case ns.ImageKind.GRAYSCALE_1BPP:Bs=0,Is=1,Vs=Ys+7>>3;break;case ns.ImageKind.RGB_24BPP:Bs=2,Is=8,Vs=Ys*3;break;case ns.ImageKind.RGBA_32BPP:Bs=6,Is=8,Vs=Ys*4;break;default:throw new Error("invalid format")}const Cs=new Uint8Array((1+Vs)*Ws);let Ts=0,$s=0;for(let ur=0;ur<Ws;++ur)Cs[Ts++]=0,Cs.set(Ds.subarray($s,$s+Vs),Ts),$s+=Vs,Ts+=Vs;if(zs===ns.ImageKind.GRAYSCALE_1BPP&&Qs){Ts=0;for(let ur=0;ur<Ws;ur++){Ts++;for(let cr=0;cr<Vs;cr++)Cs[Ts++]^=255}}const Ps=new Uint8Array([Ys>>24&255,Ys>>16&255,Ys>>8&255,Ys&255,Ws>>24&255,Ws>>16&255,Ws>>8&255,Ws&255,Is,Bs,0,0,0]),Fs=ks(Cs),Us=Ss.length+bs*3+Ps.length+Fs.length,Gs=new Uint8Array(Us);let hr=0;return Gs.set(Ss,hr),hr+=Ss.length,ws("IHDR",Ps,Gs,hr),hr+=bs+Ps.length,ws("IDATA",Fs,Gs,hr),hr+=bs+Fs.length,ws("IEND",new Uint8Array(0),Gs,hr),ds(Gs,"image/png",qs)}return function(zs,qs,Qs){const Ys=zs.kind===void 0?ns.ImageKind.GRAYSCALE_1BPP:zs.kind;return Ls(zs,Ys,qs,Qs)}}();class ps{constructor(){this.fontSizeScale=1,this.fontWeight=os.fontWeight,this.fontSize=0,this.textMatrix=ns.IDENTITY_MATRIX,this.fontMatrix=ns.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=ns.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=os.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(bs,Es){this.x=bs,this.y=Es}}function hs(Ss){let bs=[];const Es=[];for(const Rs of Ss){if(Rs.fn==="save"){bs.push({fnId:92,fn:"group",items:[]}),Es.push(bs),bs=bs.at(-1).items;continue}Rs.fn==="restore"?bs=Es.pop():bs.push(Rs)}return bs}function xs(Ss){if(Number.isInteger(Ss))return Ss.toString();const bs=Ss.toFixed(10);let Es=bs.length-1;if(bs[Es]!=="0")return bs;do Es--;while(bs[Es]==="0");return bs.substring(0,bs[Es]==="."?Es:Es+1)}function ys(Ss){if(Ss[4]===0&&Ss[5]===0){if(Ss[1]===0&&Ss[2]===0)return Ss[0]===1&&Ss[3]===1?"":`scale(${xs(Ss[0])} ${xs(Ss[3])})`;if(Ss[0]===Ss[3]&&Ss[1]===-Ss[2]){const bs=Math.acos(Ss[0])*180/Math.PI;return`rotate(${xs(bs)})`}}else if(Ss[0]===1&&Ss[1]===0&&Ss[2]===0&&Ss[3]===1)return`translate(${xs(Ss[4])} ${xs(Ss[5])})`;return`matrix(${xs(Ss[0])} ${xs(Ss[1])} ${xs(Ss[2])} ${xs(Ss[3])} ${xs(Ss[4])} ${xs(Ss[5])})`}let vs=0,gs=0,fs=0;class js{constructor(bs,Es,Rs=!1){(0,rs.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new rs.DOMSVGFactory,this.current=new ps,this.transformMatrix=ns.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=bs,this.objs=Es,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!Rs,this._operatorIdMapping=[];for(const ws in ns.OPS)this._operatorIdMapping[ns.OPS[ws]]=ws}getObject(bs,Es=null){return typeof bs=="string"?bs.startsWith("g_")?this.commonObjs.get(bs):this.objs.get(bs):Es}save(){this.transformStack.push(this.transformMatrix);const bs=this.current;this.extraStack.push(bs),this.current=bs.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(bs){this.save(),this.executeOpTree(bs),this.restore()}loadDependencies(bs){const Es=bs.fnArray,Rs=bs.argsArray;for(let ws=0,Ns=Es.length;ws<Ns;ws++)if(Es[ws]===ns.OPS.dependency)for(const ks of Rs[ws]){const _s=ks.startsWith("g_")?this.commonObjs:this.objs,Ls=new Promise(Os=>{_s.get(ks,Os)});this.current.dependencies.push(Ls)}return Promise.all(this.current.dependencies)}transform(bs,Es,Rs,ws,Ns,ks){const _s=[bs,Es,Rs,ws,Ns,ks];this.transformMatrix=ns.Util.transform(this.transformMatrix,_s),this.tgrp=null}getSVG(bs,Es){this.viewport=Es;const Rs=this._initialize(Es);return this.loadDependencies(bs).then(()=>(this.transformMatrix=ns.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(bs)),Rs))}convertOpList(bs){const Es=this._operatorIdMapping,Rs=bs.argsArray,ws=bs.fnArray,Ns=[];for(let ks=0,_s=ws.length;ks<_s;ks++){const Ls=ws[ks];Ns.push({fnId:Ls,fn:Es[Ls],args:Rs[ks]})}return hs(Ns)}executeOpTree(bs){for(const Es of bs){const Rs=Es.fn,ws=Es.fnId,Ns=Es.args;switch(ws|0){case ns.OPS.beginText:this.beginText();break;case ns.OPS.dependency:break;case ns.OPS.setLeading:this.setLeading(Ns);break;case ns.OPS.setLeadingMoveText:this.setLeadingMoveText(Ns[0],Ns[1]);break;case ns.OPS.setFont:this.setFont(Ns);break;case ns.OPS.showText:this.showText(Ns[0]);break;case ns.OPS.showSpacedText:this.showText(Ns[0]);break;case ns.OPS.endText:this.endText();break;case ns.OPS.moveText:this.moveText(Ns[0],Ns[1]);break;case ns.OPS.setCharSpacing:this.setCharSpacing(Ns[0]);break;case ns.OPS.setWordSpacing:this.setWordSpacing(Ns[0]);break;case ns.OPS.setHScale:this.setHScale(Ns[0]);break;case ns.OPS.setTextMatrix:this.setTextMatrix(Ns[0],Ns[1],Ns[2],Ns[3],Ns[4],Ns[5]);break;case ns.OPS.setTextRise:this.setTextRise(Ns[0]);break;case ns.OPS.setTextRenderingMode:this.setTextRenderingMode(Ns[0]);break;case ns.OPS.setLineWidth:this.setLineWidth(Ns[0]);break;case ns.OPS.setLineJoin:this.setLineJoin(Ns[0]);break;case ns.OPS.setLineCap:this.setLineCap(Ns[0]);break;case ns.OPS.setMiterLimit:this.setMiterLimit(Ns[0]);break;case ns.OPS.setFillRGBColor:this.setFillRGBColor(Ns[0],Ns[1],Ns[2]);break;case ns.OPS.setStrokeRGBColor:this.setStrokeRGBColor(Ns[0],Ns[1],Ns[2]);break;case ns.OPS.setStrokeColorN:this.setStrokeColorN(Ns);break;case ns.OPS.setFillColorN:this.setFillColorN(Ns);break;case ns.OPS.shadingFill:this.shadingFill(Ns[0]);break;case ns.OPS.setDash:this.setDash(Ns[0],Ns[1]);break;case ns.OPS.setRenderingIntent:this.setRenderingIntent(Ns[0]);break;case ns.OPS.setFlatness:this.setFlatness(Ns[0]);break;case ns.OPS.setGState:this.setGState(Ns[0]);break;case ns.OPS.fill:this.fill();break;case ns.OPS.eoFill:this.eoFill();break;case ns.OPS.stroke:this.stroke();break;case ns.OPS.fillStroke:this.fillStroke();break;case ns.OPS.eoFillStroke:this.eoFillStroke();break;case ns.OPS.clip:this.clip("nonzero");break;case ns.OPS.eoClip:this.clip("evenodd");break;case ns.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case ns.OPS.paintImageXObject:this.paintImageXObject(Ns[0]);break;case ns.OPS.paintInlineImageXObject:this.paintInlineImageXObject(Ns[0]);break;case ns.OPS.paintImageMaskXObject:this.paintImageMaskXObject(Ns[0]);break;case ns.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(Ns[0],Ns[1]);break;case ns.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case ns.OPS.closePath:this.closePath();break;case ns.OPS.closeStroke:this.closeStroke();break;case ns.OPS.closeFillStroke:this.closeFillStroke();break;case ns.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case ns.OPS.nextLine:this.nextLine();break;case ns.OPS.transform:this.transform(Ns[0],Ns[1],Ns[2],Ns[3],Ns[4],Ns[5]);break;case ns.OPS.constructPath:this.constructPath(Ns[0],Ns[1]);break;case ns.OPS.endPath:this.endPath();break;case 92:this.group(Es.items);break;default:(0,ns.warn)(`Unimplemented operator ${Rs}`);break}}}setWordSpacing(bs){this.current.wordSpacing=bs}setCharSpacing(bs){this.current.charSpacing=bs}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(bs,Es,Rs,ws,Ns,ks){const _s=this.current;_s.textMatrix=_s.lineMatrix=[bs,Es,Rs,ws,Ns,ks],_s.textMatrixScale=Math.hypot(bs,Es),_s.x=_s.lineX=0,_s.y=_s.lineY=0,_s.xcoords=[],_s.ycoords=[],_s.tspan=this.svgFactory.createElement("svg:tspan"),_s.tspan.setAttributeNS(null,"font-family",_s.fontFamily),_s.tspan.setAttributeNS(null,"font-size",`${xs(_s.fontSize)}px`),_s.tspan.setAttributeNS(null,"y",xs(-_s.y)),_s.txtElement=this.svgFactory.createElement("svg:text"),_s.txtElement.append(_s.tspan)}beginText(){const bs=this.current;bs.x=bs.lineX=0,bs.y=bs.lineY=0,bs.textMatrix=ns.IDENTITY_MATRIX,bs.lineMatrix=ns.IDENTITY_MATRIX,bs.textMatrixScale=1,bs.tspan=this.svgFactory.createElement("svg:tspan"),bs.txtElement=this.svgFactory.createElement("svg:text"),bs.txtgrp=this.svgFactory.createElement("svg:g"),bs.xcoords=[],bs.ycoords=[]}moveText(bs,Es){const Rs=this.current;Rs.x=Rs.lineX+=bs,Rs.y=Rs.lineY+=Es,Rs.xcoords=[],Rs.ycoords=[],Rs.tspan=this.svgFactory.createElement("svg:tspan"),Rs.tspan.setAttributeNS(null,"font-family",Rs.fontFamily),Rs.tspan.setAttributeNS(null,"font-size",`${xs(Rs.fontSize)}px`),Rs.tspan.setAttributeNS(null,"y",xs(-Rs.y))}showText(bs){const Es=this.current,Rs=Es.font,ws=Es.fontSize;if(ws===0)return;const Ns=Es.fontSizeScale,ks=Es.charSpacing,_s=Es.wordSpacing,Ls=Es.fontDirection,Os=Es.textHScale*Ls,zs=Rs.vertical,qs=zs?1:-1,Qs=Rs.defaultVMetrics,Ys=ws*Es.fontMatrix[0];let Ws=0;for(const Vs of bs){if(Vs===null){Ws+=Ls*_s;continue}else if(typeof Vs=="number"){Ws+=qs*Vs*ws/1e3;continue}const Ds=(Vs.isSpace?_s:0)+ks,Cs=Vs.fontChar;let Ts,$s,Ps=Vs.width;if(zs){let Us;const Gs=Vs.vmetric||Qs;Us=Vs.vmetric?Gs[1]:Ps*.5,Us=-Us*Ys;const hr=Gs[2]*Ys;Ps=Gs?-Gs[0]:Ps,Ts=Us/Ns,$s=(Ws+hr)/Ns}else Ts=Ws/Ns,$s=0;(Vs.isInFont||Rs.missingFile)&&(Es.xcoords.push(Es.x+Ts),zs&&Es.ycoords.push(-Es.y+$s),Es.tspan.textContent+=Cs);const Fs=zs?Ps*Ys-Ds*Ls:Ps*Ys+Ds*Ls;Ws+=Fs}Es.tspan.setAttributeNS(null,"x",Es.xcoords.map(xs).join(" ")),zs?Es.tspan.setAttributeNS(null,"y",Es.ycoords.map(xs).join(" ")):Es.tspan.setAttributeNS(null,"y",xs(-Es.y)),zs?Es.y-=Ws:Es.x+=Ws*Os,Es.tspan.setAttributeNS(null,"font-family",Es.fontFamily),Es.tspan.setAttributeNS(null,"font-size",`${xs(Es.fontSize)}px`),Es.fontStyle!==os.fontStyle&&Es.tspan.setAttributeNS(null,"font-style",Es.fontStyle),Es.fontWeight!==os.fontWeight&&Es.tspan.setAttributeNS(null,"font-weight",Es.fontWeight);const Is=Es.textRenderingMode&ns.TextRenderingMode.FILL_STROKE_MASK;if(Is===ns.TextRenderingMode.FILL||Is===ns.TextRenderingMode.FILL_STROKE?(Es.fillColor!==os.fillColor&&Es.tspan.setAttributeNS(null,"fill",Es.fillColor),Es.fillAlpha<1&&Es.tspan.setAttributeNS(null,"fill-opacity",Es.fillAlpha)):Es.textRenderingMode===ns.TextRenderingMode.ADD_TO_PATH?Es.tspan.setAttributeNS(null,"fill","transparent"):Es.tspan.setAttributeNS(null,"fill","none"),Is===ns.TextRenderingMode.STROKE||Is===ns.TextRenderingMode.FILL_STROKE){const Vs=1/(Es.textMatrixScale||1);this._setStrokeAttributes(Es.tspan,Vs)}let Bs=Es.textMatrix;Es.textRise!==0&&(Bs=Bs.slice(),Bs[5]+=Es.textRise),Es.txtElement.setAttributeNS(null,"transform",`${ys(Bs)} scale(${xs(Os)}, -1)`),Es.txtElement.setAttributeNS(as,"xml:space","preserve"),Es.txtElement.append(Es.tspan),Es.txtgrp.append(Es.txtElement),this._ensureTransformGroup().append(Es.txtElement)}setLeadingMoveText(bs,Es){this.setLeading(-Es),this.moveText(bs,Es)}addFontStyle(bs){if(!bs.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const Es=ds(bs.data,bs.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${bs.loadedName}"; src: url(${Es}); }
`}setFont(bs){const Es=this.current,Rs=this.commonObjs.get(bs[0]);let ws=bs[1];Es.font=Rs,this.embedFonts&&!Rs.missingFile&&!this.embeddedFonts[Rs.loadedName]&&(this.addFontStyle(Rs),this.embeddedFonts[Rs.loadedName]=Rs),Es.fontMatrix=Rs.fontMatrix||ns.FONT_IDENTITY_MATRIX;let Ns="normal";Rs.black?Ns="900":Rs.bold&&(Ns="bold");const ks=Rs.italic?"italic":"normal";ws<0?(ws=-ws,Es.fontDirection=-1):Es.fontDirection=1,Es.fontSize=ws,Es.fontFamily=Rs.loadedName,Es.fontWeight=Ns,Es.fontStyle=ks,Es.tspan=this.svgFactory.createElement("svg:tspan"),Es.tspan.setAttributeNS(null,"y",xs(-Es.y)),Es.xcoords=[],Es.ycoords=[]}endText(){var Es;const bs=this.current;bs.textRenderingMode&ns.TextRenderingMode.ADD_TO_PATH_FLAG&&((Es=bs.txtElement)!=null&&Es.hasChildNodes())&&(bs.element=bs.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(bs){bs>0&&(this.current.lineWidth=bs)}setLineCap(bs){this.current.lineCap=cs[bs]}setLineJoin(bs){this.current.lineJoin=us[bs]}setMiterLimit(bs){this.current.miterLimit=bs}setStrokeAlpha(bs){this.current.strokeAlpha=bs}setStrokeRGBColor(bs,Es,Rs){this.current.strokeColor=ns.Util.makeHexColor(bs,Es,Rs)}setFillAlpha(bs){this.current.fillAlpha=bs}setFillRGBColor(bs,Es,Rs){this.current.fillColor=ns.Util.makeHexColor(bs,Es,Rs),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(bs){this.current.strokeColor=this._makeColorN_Pattern(bs)}setFillColorN(bs){this.current.fillColor=this._makeColorN_Pattern(bs)}shadingFill(bs){const{width:Es,height:Rs}=this.viewport,ws=ns.Util.inverseTransform(this.transformMatrix),[Ns,ks,_s,Ls]=ns.Util.getAxialAlignedBoundingBox([0,0,Es,Rs],ws),Os=this.svgFactory.createElement("svg:rect");Os.setAttributeNS(null,"x",Ns),Os.setAttributeNS(null,"y",ks),Os.setAttributeNS(null,"width",_s-Ns),Os.setAttributeNS(null,"height",Ls-ks),Os.setAttributeNS(null,"fill",this._makeShadingPattern(bs)),this.current.fillAlpha<1&&Os.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Os)}_makeColorN_Pattern(bs){return bs[0]==="TilingPattern"?this._makeTilingPattern(bs):this._makeShadingPattern(bs)}_makeTilingPattern(bs){const Es=bs[1],Rs=bs[2],ws=bs[3]||ns.IDENTITY_MATRIX,[Ns,ks,_s,Ls]=bs[4],Os=bs[5],zs=bs[6],qs=bs[7],Qs=`shading${fs++}`,[Ys,Ws,Is,Bs]=ns.Util.normalizeRect([...ns.Util.applyTransform([Ns,ks],ws),...ns.Util.applyTransform([_s,Ls],ws)]),[Vs,Ds]=ns.Util.singularValueDecompose2dScale(ws),Cs=Os*Vs,Ts=zs*Ds,$s=this.svgFactory.createElement("svg:pattern");$s.setAttributeNS(null,"id",Qs),$s.setAttributeNS(null,"patternUnits","userSpaceOnUse"),$s.setAttributeNS(null,"width",Cs),$s.setAttributeNS(null,"height",Ts),$s.setAttributeNS(null,"x",`${Ys}`),$s.setAttributeNS(null,"y",`${Ws}`);const Ps=this.svg,Fs=this.transformMatrix,Us=this.current.fillColor,Gs=this.current.strokeColor,hr=this.svgFactory.create(Is-Ys,Bs-Ws);if(this.svg=hr,this.transformMatrix=ws,qs===2){const ur=ns.Util.makeHexColor(...Es);this.current.fillColor=ur,this.current.strokeColor=ur}return this.executeOpTree(this.convertOpList(Rs)),this.svg=Ps,this.transformMatrix=Fs,this.current.fillColor=Us,this.current.strokeColor=Gs,$s.append(hr.childNodes[0]),this.defs.append($s),`url(#${Qs})`}_makeShadingPattern(bs){switch(typeof bs=="string"&&(bs=this.objs.get(bs)),bs[0]){case"RadialAxial":const Es=`shading${fs++}`,Rs=bs[3];let ws;switch(bs[1]){case"axial":const Ns=bs[4],ks=bs[5];ws=this.svgFactory.createElement("svg:linearGradient"),ws.setAttributeNS(null,"id",Es),ws.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),ws.setAttributeNS(null,"x1",Ns[0]),ws.setAttributeNS(null,"y1",Ns[1]),ws.setAttributeNS(null,"x2",ks[0]),ws.setAttributeNS(null,"y2",ks[1]);break;case"radial":const _s=bs[4],Ls=bs[5],Os=bs[6],zs=bs[7];ws=this.svgFactory.createElement("svg:radialGradient"),ws.setAttributeNS(null,"id",Es),ws.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),ws.setAttributeNS(null,"cx",Ls[0]),ws.setAttributeNS(null,"cy",Ls[1]),ws.setAttributeNS(null,"r",zs),ws.setAttributeNS(null,"fx",_s[0]),ws.setAttributeNS(null,"fy",_s[1]),ws.setAttributeNS(null,"fr",Os);break;default:throw new Error(`Unknown RadialAxial type: ${bs[1]}`)}for(const Ns of Rs){const ks=this.svgFactory.createElement("svg:stop");ks.setAttributeNS(null,"offset",Ns[0]),ks.setAttributeNS(null,"stop-color",Ns[1]),ws.append(ks)}return this.defs.append(ws),`url(#${Es})`;case"Mesh":return(0,ns.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${bs[0]}`)}}setDash(bs,Es){this.current.dashArray=bs,this.current.dashPhase=Es}constructPath(bs,Es){const Rs=this.current;let ws=Rs.x,Ns=Rs.y,ks=[],_s=0;for(const Ls of bs)switch(Ls|0){case ns.OPS.rectangle:ws=Es[_s++],Ns=Es[_s++];const Os=Es[_s++],zs=Es[_s++],qs=ws+Os,Qs=Ns+zs;ks.push("M",xs(ws),xs(Ns),"L",xs(qs),xs(Ns),"L",xs(qs),xs(Qs),"L",xs(ws),xs(Qs),"Z");break;case ns.OPS.moveTo:ws=Es[_s++],Ns=Es[_s++],ks.push("M",xs(ws),xs(Ns));break;case ns.OPS.lineTo:ws=Es[_s++],Ns=Es[_s++],ks.push("L",xs(ws),xs(Ns));break;case ns.OPS.curveTo:ws=Es[_s+4],Ns=Es[_s+5],ks.push("C",xs(Es[_s]),xs(Es[_s+1]),xs(Es[_s+2]),xs(Es[_s+3]),xs(ws),xs(Ns)),_s+=6;break;case ns.OPS.curveTo2:ks.push("C",xs(ws),xs(Ns),xs(Es[_s]),xs(Es[_s+1]),xs(Es[_s+2]),xs(Es[_s+3])),ws=Es[_s+2],Ns=Es[_s+3],_s+=4;break;case ns.OPS.curveTo3:ws=Es[_s+2],Ns=Es[_s+3],ks.push("C",xs(Es[_s]),xs(Es[_s+1]),xs(ws),xs(Ns),xs(ws),xs(Ns)),_s+=4;break;case ns.OPS.closePath:ks.push("Z");break}ks=ks.join(" "),Rs.path&&bs.length>0&&bs[0]!==ns.OPS.rectangle&&bs[0]!==ns.OPS.moveTo?ks=Rs.path.getAttributeNS(null,"d")+ks:(Rs.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(Rs.path)),Rs.path.setAttributeNS(null,"d",ks),Rs.path.setAttributeNS(null,"fill","none"),Rs.element=Rs.path,Rs.setCurrentPoint(ws,Ns)}endPath(){const bs=this.current;if(bs.path=null,!this.pendingClip)return;if(!bs.element){this.pendingClip=null;return}const Es=`clippath${vs++}`,Rs=this.svgFactory.createElement("svg:clipPath");Rs.setAttributeNS(null,"id",Es),Rs.setAttributeNS(null,"transform",ys(this.transformMatrix));const ws=bs.element.cloneNode(!0);if(this.pendingClip==="evenodd"?ws.setAttributeNS(null,"clip-rule","evenodd"):ws.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,Rs.append(ws),this.defs.append(Rs),bs.activeClipUrl){bs.clipGroup=null;for(const Ns of this.extraStack)Ns.clipGroup=null;Rs.setAttributeNS(null,"clip-path",bs.activeClipUrl)}bs.activeClipUrl=`url(#${Es})`,this.tgrp=null}clip(bs){this.pendingClip=bs}closePath(){const bs=this.current;if(bs.path){const Es=`${bs.path.getAttributeNS(null,"d")}Z`;bs.path.setAttributeNS(null,"d",Es)}}setLeading(bs){this.current.leading=-bs}setTextRise(bs){this.current.textRise=bs}setTextRenderingMode(bs){this.current.textRenderingMode=bs}setHScale(bs){this.current.textHScale=bs/100}setRenderingIntent(bs){}setFlatness(bs){}setGState(bs){for(const[Es,Rs]of bs)switch(Es){case"LW":this.setLineWidth(Rs);break;case"LC":this.setLineCap(Rs);break;case"LJ":this.setLineJoin(Rs);break;case"ML":this.setMiterLimit(Rs);break;case"D":this.setDash(Rs[0],Rs[1]);break;case"RI":this.setRenderingIntent(Rs);break;case"FL":this.setFlatness(Rs);break;case"Font":this.setFont(Rs);break;case"CA":this.setStrokeAlpha(Rs);break;case"ca":this.setFillAlpha(Rs);break;default:(0,ns.warn)(`Unimplemented graphic state operator ${Es}`);break}}fill(){const bs=this.current;bs.element&&(bs.element.setAttributeNS(null,"fill",bs.fillColor),bs.element.setAttributeNS(null,"fill-opacity",bs.fillAlpha),this.endPath())}stroke(){const bs=this.current;bs.element&&(this._setStrokeAttributes(bs.element),bs.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(bs,Es=1){const Rs=this.current;let ws=Rs.dashArray;Es!==1&&ws.length>0&&(ws=ws.map(function(Ns){return Es*Ns})),bs.setAttributeNS(null,"stroke",Rs.strokeColor),bs.setAttributeNS(null,"stroke-opacity",Rs.strokeAlpha),bs.setAttributeNS(null,"stroke-miterlimit",xs(Rs.miterLimit)),bs.setAttributeNS(null,"stroke-linecap",Rs.lineCap),bs.setAttributeNS(null,"stroke-linejoin",Rs.lineJoin),bs.setAttributeNS(null,"stroke-width",xs(Es*Rs.lineWidth)+"px"),bs.setAttributeNS(null,"stroke-dasharray",ws.map(xs).join(" ")),bs.setAttributeNS(null,"stroke-dashoffset",xs(Es*Rs.dashPhase)+"px")}eoFill(){var bs;(bs=this.current.element)==null||bs.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var bs;(bs=this.current.element)==null||bs.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const bs=this.svgFactory.createElement("svg:rect");bs.setAttributeNS(null,"x","0"),bs.setAttributeNS(null,"y","0"),bs.setAttributeNS(null,"width","1px"),bs.setAttributeNS(null,"height","1px"),bs.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(bs)}paintImageXObject(bs){const Es=this.getObject(bs);if(!Es){(0,ns.warn)(`Dependent image with object ID ${bs} is not ready yet`);return}this.paintInlineImageXObject(Es)}paintInlineImageXObject(bs,Es){const Rs=bs.width,ws=bs.height,Ns=ms(bs,this.forceDataSchema,!!Es),ks=this.svgFactory.createElement("svg:rect");ks.setAttributeNS(null,"x","0"),ks.setAttributeNS(null,"y","0"),ks.setAttributeNS(null,"width",xs(Rs)),ks.setAttributeNS(null,"height",xs(ws)),this.current.element=ks,this.clip("nonzero");const _s=this.svgFactory.createElement("svg:image");_s.setAttributeNS(ls,"xlink:href",Ns),_s.setAttributeNS(null,"x","0"),_s.setAttributeNS(null,"y",xs(-ws)),_s.setAttributeNS(null,"width",xs(Rs)+"px"),_s.setAttributeNS(null,"height",xs(ws)+"px"),_s.setAttributeNS(null,"transform",`scale(${xs(1/Rs)} ${xs(-1/ws)})`),Es?Es.append(_s):this._ensureTransformGroup().append(_s)}paintImageMaskXObject(bs){const Es=this.getObject(bs.data,bs);if(Es.bitmap){(0,ns.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const Rs=this.current,ws=Es.width,Ns=Es.height,ks=Rs.fillColor;Rs.maskId=`mask${gs++}`;const _s=this.svgFactory.createElement("svg:mask");_s.setAttributeNS(null,"id",Rs.maskId);const Ls=this.svgFactory.createElement("svg:rect");Ls.setAttributeNS(null,"x","0"),Ls.setAttributeNS(null,"y","0"),Ls.setAttributeNS(null,"width",xs(ws)),Ls.setAttributeNS(null,"height",xs(Ns)),Ls.setAttributeNS(null,"fill",ks),Ls.setAttributeNS(null,"mask",`url(#${Rs.maskId})`),this.defs.append(_s),this._ensureTransformGroup().append(Ls),this.paintInlineImageXObject(Es,_s)}paintFormXObjectBegin(bs,Es){if(Array.isArray(bs)&&bs.length===6&&this.transform(bs[0],bs[1],bs[2],bs[3],bs[4],bs[5]),Es){const Rs=Es[2]-Es[0],ws=Es[3]-Es[1],Ns=this.svgFactory.createElement("svg:rect");Ns.setAttributeNS(null,"x",Es[0]),Ns.setAttributeNS(null,"y",Es[1]),Ns.setAttributeNS(null,"width",xs(Rs)),Ns.setAttributeNS(null,"height",xs(ws)),this.current.element=Ns,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(bs){const Es=this.svgFactory.create(bs.width,bs.height),Rs=this.svgFactory.createElement("svg:defs");Es.append(Rs),this.defs=Rs;const ws=this.svgFactory.createElement("svg:g");return ws.setAttributeNS(null,"transform",ys(bs.transform)),Es.append(ws),this.svg=ws,Es}_ensureClipGroup(){if(!this.current.clipGroup){const bs=this.svgFactory.createElement("svg:g");bs.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(bs),this.current.clipGroup=bs}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",ys(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}ts.SVGGraphics=js},(es,ts)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.XfaText=void 0;class ss{static textContent(ns){const os=[],as={items:os,styles:Object.create(null)};function ls(cs){var ms;if(!cs)return;let us=null;const ds=cs.name;if(ds==="#text")us=cs.value;else if(ss.shouldBuildText(ds))(ms=cs==null?void 0:cs.attributes)!=null&&ms.textContent?us=cs.attributes.textContent:cs.value&&(us=cs.value);else return;if(us!==null&&os.push({str:us}),!!cs.children)for(const ps of cs.children)ls(ps)}return ls(ns),as}static shouldBuildText(ns){return!(ns==="textarea"||ns==="input"||ns==="option"||ns==="select")}}ts.XfaText=ss},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.TextLayerRenderTask=void 0,ts.renderTextLayer=ys,ts.updateTextLayer=vs;var rs=ss(1),ns=ss(6);const os=1e5,as=30,ls=.8,cs=new Map;function us(gs,fs){let js;if(fs&&rs.FeatureTest.isOffscreenCanvasSupported)js=new OffscreenCanvas(gs,gs).getContext("2d",{alpha:!1});else{const Ss=document.createElement("canvas");Ss.width=Ss.height=gs,js=Ss.getContext("2d",{alpha:!1})}return js}function ds(gs,fs){const js=cs.get(gs);if(js)return js;const Ss=us(as,fs);Ss.font=`${as}px ${gs}`;const bs=Ss.measureText("");let Es=bs.fontBoundingBoxAscent,Rs=Math.abs(bs.fontBoundingBoxDescent);if(Es){const Ns=Es/(Es+Rs);return cs.set(gs,Ns),Ss.canvas.width=Ss.canvas.height=0,Ns}Ss.strokeStyle="red",Ss.clearRect(0,0,as,as),Ss.strokeText("g",0,0);let ws=Ss.getImageData(0,0,as,as).data;Rs=0;for(let Ns=ws.length-1-3;Ns>=0;Ns-=4)if(ws[Ns]>0){Rs=Math.ceil(Ns/4/as);break}Ss.clearRect(0,0,as,as),Ss.strokeText("A",0,as),ws=Ss.getImageData(0,0,as,as).data,Es=0;for(let Ns=0,ks=ws.length;Ns<ks;Ns+=4)if(ws[Ns]>0){Es=as-Math.floor(Ns/4/as);break}if(Ss.canvas.width=Ss.canvas.height=0,Es){const Ns=Es/(Es+Rs);return cs.set(gs,Ns),Ns}return cs.set(gs,ls),ls}function ms(gs,fs,js){const Ss=document.createElement("span"),bs={angle:0,canvasWidth:0,hasText:fs.str!=="",hasEOL:fs.hasEOL,fontSize:0};gs._textDivs.push(Ss);const Es=rs.Util.transform(gs._transform,fs.transform);let Rs=Math.atan2(Es[1],Es[0]);const ws=js[fs.fontName];ws.vertical&&(Rs+=Math.PI/2);const Ns=Math.hypot(Es[2],Es[3]),ks=Ns*ds(ws.fontFamily,gs._isOffscreenCanvasSupported);let _s,Ls;Rs===0?(_s=Es[4],Ls=Es[5]-ks):(_s=Es[4]+ks*Math.sin(Rs),Ls=Es[5]-ks*Math.cos(Rs));const Os="calc(var(--scale-factor)*",zs=Ss.style;gs._container===gs._rootContainer?(zs.left=`${(100*_s/gs._pageWidth).toFixed(2)}%`,zs.top=`${(100*Ls/gs._pageHeight).toFixed(2)}%`):(zs.left=`${Os}${_s.toFixed(2)}px)`,zs.top=`${Os}${Ls.toFixed(2)}px)`),zs.fontSize=`${Os}${Ns.toFixed(2)}px)`,zs.fontFamily=ws.fontFamily,bs.fontSize=Ns,Ss.setAttribute("role","presentation"),Ss.textContent=fs.str,Ss.dir=fs.dir,gs._fontInspectorEnabled&&(Ss.dataset.fontName=fs.fontName),Rs!==0&&(bs.angle=Rs*(180/Math.PI));let qs=!1;if(fs.str.length>1)qs=!0;else if(fs.str!==" "&&fs.transform[0]!==fs.transform[3]){const Qs=Math.abs(fs.transform[0]),Ys=Math.abs(fs.transform[3]);Qs!==Ys&&Math.max(Qs,Ys)/Math.min(Qs,Ys)>1.5&&(qs=!0)}qs&&(bs.canvasWidth=ws.vertical?fs.height:fs.width),gs._textDivProperties.set(Ss,bs),gs._isReadableStream&&gs._layoutText(Ss)}function ps(gs){const{div:fs,scale:js,properties:Ss,ctx:bs,prevFontSize:Es,prevFontFamily:Rs}=gs,{style:ws}=fs;let Ns="";if(Ss.canvasWidth!==0&&Ss.hasText){const{fontFamily:ks}=ws,{canvasWidth:_s,fontSize:Ls}=Ss;(Es!==Ls||Rs!==ks)&&(bs.font=`${Ls*js}px ${ks}`,gs.prevFontSize=Ls,gs.prevFontFamily=ks);const{width:Os}=bs.measureText(fs.textContent);Os>0&&(Ns=`scaleX(${_s*js/Os})`)}Ss.angle!==0&&(Ns=`rotate(${Ss.angle}deg) ${Ns}`),Ns.length>0&&(ws.transform=Ns)}function hs(gs){if(gs._canceled)return;const fs=gs._textDivs,js=gs._capability;if(fs.length>os){js.resolve();return}if(!gs._isReadableStream)for(const bs of fs)gs._layoutText(bs);js.resolve()}class xs{constructor({textContentSource:fs,container:js,viewport:Ss,textDivs:bs,textDivProperties:Es,textContentItemsStr:Rs,isOffscreenCanvasSupported:ws}){var Os;this._textContentSource=fs,this._isReadableStream=fs instanceof ReadableStream,this._container=this._rootContainer=js,this._textDivs=bs||[],this._textContentItemsStr=Rs||[],this._isOffscreenCanvasSupported=ws,this._fontInspectorEnabled=!!((Os=globalThis.FontInspector)!=null&&Os.enabled),this._reader=null,this._textDivProperties=Es||new WeakMap,this._canceled=!1,this._capability=new rs.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:Ss.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:us(0,ws)};const{pageWidth:Ns,pageHeight:ks,pageX:_s,pageY:Ls}=Ss.rawDims;this._transform=[1,0,0,-1,-_s,Ls+ks],this._pageWidth=Ns,this._pageHeight=ks,(0,ns.setLayerDimensions)(js,Ss),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new rs.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new rs.AbortException("TextLayer task cancelled."))}_processItems(fs,js){for(const Ss of fs){if(Ss.str===void 0){if(Ss.type==="beginMarkedContentProps"||Ss.type==="beginMarkedContent"){const bs=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),Ss.id!==null&&this._container.setAttribute("id",`${Ss.id}`),bs.append(this._container)}else Ss.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(Ss.str),ms(this,Ss,js)}}_layoutText(fs){const js=this._layoutTextParams.properties=this._textDivProperties.get(fs);if(this._layoutTextParams.div=fs,ps(this._layoutTextParams),js.hasText&&this._container.append(fs),js.hasEOL){const Ss=document.createElement("br");Ss.setAttribute("role","presentation"),this._container.append(Ss)}}_render(){const fs=new rs.PromiseCapability;let js=Object.create(null);if(this._isReadableStream){const Ss=()=>{this._reader.read().then(({value:bs,done:Es})=>{if(Es){fs.resolve();return}Object.assign(js,bs.styles),this._processItems(bs.items,js),Ss()},fs.reject)};this._reader=this._textContentSource.getReader(),Ss()}else if(this._textContentSource){const{items:Ss,styles:bs}=this._textContentSource;this._processItems(Ss,bs),fs.resolve()}else throw new Error('No "textContentSource" parameter specified.');fs.promise.then(()=>{js=null,hs(this)},this._capability.reject)}}ts.TextLayerRenderTask=xs;function ys(gs){!gs.textContentSource&&(gs.textContent||gs.textContentStream)&&((0,ns.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),gs.textContentSource=gs.textContent||gs.textContentStream);const{container:fs,viewport:js}=gs,Ss=getComputedStyle(fs),bs=Ss.getPropertyValue("visibility"),Es=parseFloat(Ss.getPropertyValue("--scale-factor"));bs==="visible"&&(!Es||Math.abs(Es-js.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const Rs=new xs(gs);return Rs._render(),Rs}function vs({container:gs,viewport:fs,textDivs:js,textDivProperties:Ss,isOffscreenCanvasSupported:bs,mustRotate:Es=!0,mustRescale:Rs=!0}){if(Es&&(0,ns.setLayerDimensions)(gs,{rotation:fs.rotation}),Rs){const ws=us(0,bs),ks={prevFontSize:null,prevFontFamily:null,div:null,scale:fs.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:ws};for(const _s of js)ks.properties=Ss.get(_s),ks.div=_s,ps(ks)}}},(es,ts,ss)=>{var ds,ms,ps,hs,xs,ys,vs,gs,fs,js,Ss,ba,To,_a,$a;Object.defineProperty(ts,"__esModule",{value:!0}),ts.AnnotationEditorLayer=void 0;var rs=ss(1),ns=ss(4),os=ss(28),as=ss(33),ls=ss(6),cs=ss(34);const Ns=class Ns{constructor({uiManager:_s,pageIndex:Ls,div:Os,accessibilityManager:zs,annotationLayer:qs,viewport:Qs,l10n:Ys}){fr(this,Ss);fr(this,ds);fr(this,ms,!1);fr(this,ps,null);fr(this,hs,this.pointerup.bind(this));fr(this,xs,this.pointerdown.bind(this));fr(this,ys,new Map);fr(this,vs,!1);fr(this,gs,!1);fr(this,fs,!1);fr(this,js);const Ws=[os.FreeTextEditor,as.InkEditor,cs.StampEditor];if(!Ns._initialized){Ns._initialized=!0;for(const Is of Ws)Is.initialize(Ys)}_s.registerEditorTypes(Ws),jr(this,js,_s),this.pageIndex=Ls,this.div=Os,jr(this,ds,zs),jr(this,ps,qs),this.viewport=Qs,As(this,js).addLayer(this)}get isEmpty(){return As(this,ys).size===0}updateToolbar(_s){As(this,js).updateToolbar(_s)}updateMode(_s=As(this,js).getMode()){pr(this,Ss,$a).call(this),_s===rs.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),_s!==rs.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",_s===rs.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",_s===rs.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",_s===rs.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(_s){if(!_s&&As(this,js).getMode()!==rs.AnnotationEditorType.INK)return;if(!_s){for(const Os of As(this,ys).values())if(Os.isEmpty()){Os.setInBackground();return}}pr(this,Ss,To).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(_s){As(this,js).setEditingState(_s)}addCommands(_s){As(this,js).addCommands(_s)}enable(){this.div.style.pointerEvents="auto";const _s=new Set;for(const Os of As(this,ys).values())Os.enableEditing(),Os.annotationElementId&&_s.add(Os.annotationElementId);if(!As(this,ps))return;const Ls=As(this,ps).getEditableAnnotations();for(const Os of Ls){if(Os.hide(),As(this,js).isDeletedAnnotationElement(Os.data.id)||_s.has(Os.data.id))continue;const zs=this.deserialize(Os);zs&&(this.addOrRebuild(zs),zs.enableEditing())}}disable(){var Ls;jr(this,fs,!0),this.div.style.pointerEvents="none";const _s=new Set;for(const Os of As(this,ys).values()){if(Os.disableEditing(),!Os.annotationElementId||Os.serialize()!==null){_s.add(Os.annotationElementId);continue}(Ls=this.getEditableAnnotation(Os.annotationElementId))==null||Ls.show(),Os.remove()}if(As(this,ps)){const Os=As(this,ps).getEditableAnnotations();for(const zs of Os){const{id:qs}=zs.data;_s.has(qs)||As(this,js).isDeletedAnnotationElement(qs)||zs.show()}}pr(this,Ss,$a).call(this),this.isEmpty&&(this.div.hidden=!0),jr(this,fs,!1)}getEditableAnnotation(_s){var Ls;return((Ls=As(this,ps))==null?void 0:Ls.getEditableAnnotation(_s))||null}setActiveEditor(_s){As(this,js).getActive()!==_s&&As(this,js).setActiveEditor(_s)}enableClick(){this.div.addEventListener("pointerdown",As(this,xs)),this.div.addEventListener("pointerup",As(this,hs))}disableClick(){this.div.removeEventListener("pointerdown",As(this,xs)),this.div.removeEventListener("pointerup",As(this,hs))}attach(_s){As(this,ys).set(_s.id,_s);const{annotationElementId:Ls}=_s;Ls&&As(this,js).isDeletedAnnotationElement(Ls)&&As(this,js).removeDeletedAnnotationElement(_s)}detach(_s){var Ls;As(this,ys).delete(_s.id),(Ls=As(this,ds))==null||Ls.removePointerInTextLayer(_s.contentDiv),!As(this,fs)&&_s.annotationElementId&&As(this,js).addDeletedAnnotationElement(_s)}remove(_s){this.detach(_s),As(this,js).removeEditor(_s),_s.div.contains(document.activeElement)&&setTimeout(()=>{As(this,js).focusMainContainer()},0),_s.div.remove(),_s.isAttachedToDOM=!1,As(this,gs)||this.addInkEditorIfNeeded(!1)}changeParent(_s){var Ls;_s.parent!==this&&(_s.annotationElementId&&(As(this,js).addDeletedAnnotationElement(_s.annotationElementId),ns.AnnotationEditor.deleteAnnotationElement(_s),_s.annotationElementId=null),this.attach(_s),(Ls=_s.parent)==null||Ls.detach(_s),_s.setParent(this),_s.div&&_s.isAttachedToDOM&&(_s.div.remove(),this.div.append(_s.div)))}add(_s){if(this.changeParent(_s),As(this,js).addEditor(_s),this.attach(_s),!_s.isAttachedToDOM){const Ls=_s.render();this.div.append(Ls),_s.isAttachedToDOM=!0}_s.fixAndSetPosition(),_s.onceAdded(),As(this,js).addToAnnotationStorage(_s)}moveEditorInDOM(_s){var Os;if(!_s.isAttachedToDOM)return;const{activeElement:Ls}=document;_s.div.contains(Ls)&&(_s._focusEventsAllowed=!1,setTimeout(()=>{_s.div.contains(document.activeElement)?_s._focusEventsAllowed=!0:(_s.div.addEventListener("focusin",()=>{_s._focusEventsAllowed=!0},{once:!0}),Ls.focus())},0)),_s._structTreeParentId=(Os=As(this,ds))==null?void 0:Os.moveElementInDOM(this.div,_s.div,_s.contentDiv,!0)}addOrRebuild(_s){_s.needsToBeRebuilt()?_s.rebuild():this.add(_s)}addUndoableEditor(_s){const Ls=()=>_s._uiManager.rebuild(_s),Os=()=>{_s.remove()};this.addCommands({cmd:Ls,undo:Os,mustExec:!1})}getNextId(){return As(this,js).getId()}pasteEditor(_s,Ls){As(this,js).updateToolbar(_s),As(this,js).updateMode(_s);const{offsetX:Os,offsetY:zs}=pr(this,Ss,_a).call(this),qs=this.getNextId(),Qs=pr(this,Ss,ba).call(this,{parent:this,id:qs,x:Os,y:zs,uiManager:As(this,js),isCentered:!0,...Ls});Qs&&this.add(Qs)}deserialize(_s){switch(_s.annotationType??_s.annotationEditorType){case rs.AnnotationEditorType.FREETEXT:return os.FreeTextEditor.deserialize(_s,this,As(this,js));case rs.AnnotationEditorType.INK:return as.InkEditor.deserialize(_s,this,As(this,js));case rs.AnnotationEditorType.STAMP:return cs.StampEditor.deserialize(_s,this,As(this,js))}return null}addNewEditor(){pr(this,Ss,To).call(this,pr(this,Ss,_a).call(this),!0)}setSelected(_s){As(this,js).setSelected(_s)}toggleSelected(_s){As(this,js).toggleSelected(_s)}isSelected(_s){return As(this,js).isSelected(_s)}unselect(_s){As(this,js).unselect(_s)}pointerup(_s){const{isMac:Ls}=rs.FeatureTest.platform;if(!(_s.button!==0||_s.ctrlKey&&Ls)&&_s.target===this.div&&As(this,vs)){if(jr(this,vs,!1),!As(this,ms)){jr(this,ms,!0);return}if(As(this,js).getMode()===rs.AnnotationEditorType.STAMP){As(this,js).unselectAll();return}pr(this,Ss,To).call(this,_s,!1)}}pointerdown(_s){if(As(this,vs)){jr(this,vs,!1);return}const{isMac:Ls}=rs.FeatureTest.platform;if(_s.button!==0||_s.ctrlKey&&Ls||_s.target!==this.div)return;jr(this,vs,!0);const Os=As(this,js).getActive();jr(this,ms,!Os||Os.isEmpty())}findNewParent(_s,Ls,Os){const zs=As(this,js).findParent(Ls,Os);return zs===null||zs===this?!1:(zs.changeParent(_s),!0)}destroy(){var _s,Ls;((_s=As(this,js).getActive())==null?void 0:_s.parent)===this&&(As(this,js).commitOrRemove(),As(this,js).setActiveEditor(null));for(const Os of As(this,ys).values())(Ls=As(this,ds))==null||Ls.removePointerInTextLayer(Os.contentDiv),Os.setParent(null),Os.isAttachedToDOM=!1,Os.div.remove();this.div=null,As(this,ys).clear(),As(this,js).removeLayer(this)}render({viewport:_s}){this.viewport=_s,(0,ls.setLayerDimensions)(this.div,_s);for(const Ls of As(this,js).getEditors(this.pageIndex))this.add(Ls);this.updateMode()}update({viewport:_s}){As(this,js).commitOrRemove(),this.viewport=_s,(0,ls.setLayerDimensions)(this.div,{rotation:_s.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:_s,pageHeight:Ls}=this.viewport.rawDims;return[_s,Ls]}};ds=new WeakMap,ms=new WeakMap,ps=new WeakMap,hs=new WeakMap,xs=new WeakMap,ys=new WeakMap,vs=new WeakMap,gs=new WeakMap,fs=new WeakMap,js=new WeakMap,Ss=new WeakSet,ba=function(_s){switch(As(this,js).getMode()){case rs.AnnotationEditorType.FREETEXT:return new os.FreeTextEditor(_s);case rs.AnnotationEditorType.INK:return new as.InkEditor(_s);case rs.AnnotationEditorType.STAMP:return new cs.StampEditor(_s)}return null},To=function(_s,Ls){const Os=this.getNextId(),zs=pr(this,Ss,ba).call(this,{parent:this,id:Os,x:_s.offsetX,y:_s.offsetY,uiManager:As(this,js),isCentered:Ls});return zs&&this.add(zs),zs},_a=function(){const{x:_s,y:Ls,width:Os,height:zs}=this.div.getBoundingClientRect(),qs=Math.max(0,_s),Qs=Math.max(0,Ls),Ys=Math.min(window.innerWidth,_s+Os),Ws=Math.min(window.innerHeight,Ls+zs),Is=(qs+Ys)/2-_s,Bs=(Qs+Ws)/2-Ls,[Vs,Ds]=this.viewport.rotation%180===0?[Is,Bs]:[Bs,Is];return{offsetX:Vs,offsetY:Ds}},$a=function(){jr(this,gs,!0);for(const _s of As(this,ys).values())_s.isEmpty()&&_s.remove();jr(this,gs,!1)},eo(Ns,"_initialized",!1);let us=Ns;ts.AnnotationEditorLayer=us},(es,ts,ss)=>{var cs,us,ds,ms,ps,hs,xs,ys,vs,gs,Yl,Xl,Jl,Eo,xl,Ql,yl;Object.defineProperty(ts,"__esModule",{value:!0}),ts.FreeTextEditor=void 0;var rs=ss(1),ns=ss(5),os=ss(4),as=ss(29);const Ns=class Ns extends os.AnnotationEditor{constructor(Ls){super({...Ls,name:"freeTextEditor"});fr(this,gs);fr(this,cs,this.editorDivBlur.bind(this));fr(this,us,this.editorDivFocus.bind(this));fr(this,ds,this.editorDivInput.bind(this));fr(this,ms,this.editorDivKeydown.bind(this));fr(this,ps);fr(this,hs,"");fr(this,xs,`${this.id}-editor`);fr(this,ys);fr(this,vs,null);jr(this,ps,Ls.color||Ns._defaultColor||os.AnnotationEditor._defaultLineColor),jr(this,ys,Ls.fontSize||Ns._defaultFontSize)}static get _keyboardManager(){const Ls=Ns.prototype,Os=Qs=>Qs.isEmpty(),zs=ns.AnnotationEditorUIManager.TRANSLATE_SMALL,qs=ns.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,rs.shadow)(this,"_keyboardManager",new ns.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],Ls.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],Ls.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],Ls._translateEmpty,{args:[-zs,0],checker:Os}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Ls._translateEmpty,{args:[-qs,0],checker:Os}],[["ArrowRight","mac+ArrowRight"],Ls._translateEmpty,{args:[zs,0],checker:Os}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Ls._translateEmpty,{args:[qs,0],checker:Os}],[["ArrowUp","mac+ArrowUp"],Ls._translateEmpty,{args:[0,-zs],checker:Os}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Ls._translateEmpty,{args:[0,-qs],checker:Os}],[["ArrowDown","mac+ArrowDown"],Ls._translateEmpty,{args:[0,zs],checker:Os}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Ls._translateEmpty,{args:[0,qs],checker:Os}]]))}static initialize(Ls){os.AnnotationEditor.initialize(Ls,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const Os=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(Os.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Ls,Os){switch(Ls){case rs.AnnotationEditorParamsType.FREETEXT_SIZE:Ns._defaultFontSize=Os;break;case rs.AnnotationEditorParamsType.FREETEXT_COLOR:Ns._defaultColor=Os;break}}updateParams(Ls,Os){switch(Ls){case rs.AnnotationEditorParamsType.FREETEXT_SIZE:pr(this,gs,Yl).call(this,Os);break;case rs.AnnotationEditorParamsType.FREETEXT_COLOR:pr(this,gs,Xl).call(this,Os);break}}static get defaultPropertiesToUpdate(){return[[rs.AnnotationEditorParamsType.FREETEXT_SIZE,Ns._defaultFontSize],[rs.AnnotationEditorParamsType.FREETEXT_COLOR,Ns._defaultColor||os.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[rs.AnnotationEditorParamsType.FREETEXT_SIZE,As(this,ys)],[rs.AnnotationEditorParamsType.FREETEXT_COLOR,As(this,ps)]]}_translateEmpty(Ls,Os){this._uiManager.translateSelectedEditors(Ls,Os,!0)}getInitialTranslation(){const Ls=this.parentScale;return[-Ns._internalPadding*Ls,-(Ns._internalPadding+As(this,ys))*Ls]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(rs.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",As(this,ms)),this.editorDiv.addEventListener("focus",As(this,us)),this.editorDiv.addEventListener("blur",As(this,cs)),this.editorDiv.addEventListener("input",As(this,ds)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",As(this,xs)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",As(this,ms)),this.editorDiv.removeEventListener("focus",As(this,us)),this.editorDiv.removeEventListener("blur",As(this,cs)),this.editorDiv.removeEventListener("input",As(this,ds)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Ls){this._focusEventsAllowed&&(super.focusin(Ls),Ls.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var Ls;if(this.width){pr(this,gs,yl).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(Ls=this._initialOptions)!=null&&Ls.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Ls=As(this,hs),Os=jr(this,hs,pr(this,gs,Jl).call(this).trimEnd());if(Ls===Os)return;const zs=qs=>{if(jr(this,hs,qs),!qs){this.remove();return}pr(this,gs,xl).call(this),this._uiManager.rebuild(this),pr(this,gs,Eo).call(this)};this.addCommands({cmd:()=>{zs(Os)},undo:()=>{zs(Ls)},mustExec:!1}),pr(this,gs,Eo).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(Ls){this.enterInEditMode()}keydown(Ls){Ls.target===this.div&&Ls.key==="Enter"&&(this.enterInEditMode(),Ls.preventDefault())}editorDivKeydown(Ls){Ns._keyboardManager.exec(this,Ls)}editorDivFocus(Ls){this.isEditing=!0}editorDivBlur(Ls){this.isEditing=!1}editorDivInput(Ls){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Ls,Os;this.width&&(Ls=this.x,Os=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",As(this,xs)),this.enableEditing(),os.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(qs=>{var Qs;return(Qs=this.editorDiv)==null?void 0:Qs.setAttribute("aria-label",qs)}),os.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(qs=>{var Qs;return(Qs=this.editorDiv)==null?void 0:Qs.setAttribute("default-content",qs)}),this.editorDiv.contentEditable=!0;const{style:zs}=this.editorDiv;if(zs.fontSize=`calc(${As(this,ys)}px * var(--scale-factor))`,zs.color=As(this,ps),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,ns.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[qs,Qs]=this.parentDimensions;if(this.annotationElementId){const{position:Ys}=As(this,vs);let[Ws,Is]=this.getInitialTranslation();[Ws,Is]=this.pageTranslationToScreen(Ws,Is);const[Bs,Vs]=this.pageDimensions,[Ds,Cs]=this.pageTranslation;let Ts,$s;switch(this.rotation){case 0:Ts=Ls+(Ys[0]-Ds)/Bs,$s=Os+this.height-(Ys[1]-Cs)/Vs;break;case 90:Ts=Ls+(Ys[0]-Ds)/Bs,$s=Os-(Ys[1]-Cs)/Vs,[Ws,Is]=[Is,-Ws];break;case 180:Ts=Ls-this.width+(Ys[0]-Ds)/Bs,$s=Os-(Ys[1]-Cs)/Vs,[Ws,Is]=[-Ws,-Is];break;case 270:Ts=Ls+(Ys[0]-Ds-this.height*Vs)/Bs,$s=Os+(Ys[1]-Cs-this.width*Bs)/Vs,[Ws,Is]=[-Is,Ws];break}this.setAt(Ts*qs,$s*Qs,Ws,Is)}else this.setAt(Ls*qs,Os*Qs,this.width*qs,this.height*Qs);pr(this,gs,xl).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Ls,Os,zs){let qs=null;if(Ls instanceof as.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Ys,fontColor:Ws},rect:Is,rotation:Bs,id:Vs},textContent:Ds,textPosition:Cs,parent:{page:{pageNumber:Ts}}}=Ls;if(!Ds||Ds.length===0)return null;qs=Ls={annotationType:rs.AnnotationEditorType.FREETEXT,color:Array.from(Ws),fontSize:Ys,value:Ds.join(`
`),position:Cs,pageIndex:Ts-1,rect:Is,rotation:Bs,id:Vs,deleted:!1}}const Qs=super.deserialize(Ls,Os,zs);return jr(Qs,ys,Ls.fontSize),jr(Qs,ps,rs.Util.makeHexColor(...Ls.color)),jr(Qs,hs,Ls.value),Qs.annotationElementId=Ls.id||null,jr(Qs,vs,qs),Qs}serialize(Ls=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const Os=Ns._internalPadding*this.parentScale,zs=this.getRect(Os,Os),qs=os.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:As(this,ps)),Qs={annotationType:rs.AnnotationEditorType.FREETEXT,color:qs,fontSize:As(this,ys),value:As(this,hs),pageIndex:this.pageIndex,rect:zs,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return Ls?Qs:this.annotationElementId&&!pr(this,gs,Ql).call(this,Qs)?null:(Qs.id=this.annotationElementId,Qs)}};cs=new WeakMap,us=new WeakMap,ds=new WeakMap,ms=new WeakMap,ps=new WeakMap,hs=new WeakMap,xs=new WeakMap,ys=new WeakMap,vs=new WeakMap,gs=new WeakSet,Yl=function(Ls){const Os=qs=>{this.editorDiv.style.fontSize=`calc(${qs}px * var(--scale-factor))`,this.translate(0,-(qs-As(this,ys))*this.parentScale),jr(this,ys,qs),pr(this,gs,Eo).call(this)},zs=As(this,ys);this.addCommands({cmd:()=>{Os(Ls)},undo:()=>{Os(zs)},mustExec:!0,type:rs.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Xl=function(Ls){const Os=As(this,ps);this.addCommands({cmd:()=>{jr(this,ps,this.editorDiv.style.color=Ls)},undo:()=>{jr(this,ps,this.editorDiv.style.color=Os)},mustExec:!0,type:rs.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Jl=function(){const Ls=this.editorDiv.getElementsByTagName("div");if(Ls.length===0)return this.editorDiv.innerText;const Os=[];for(const zs of Ls)Os.push(zs.innerText.replace(/\r\n?|\n/,""));return Os.join(`
`)},Eo=function(){const[Ls,Os]=this.parentDimensions;let zs;if(this.isAttachedToDOM)zs=this.div.getBoundingClientRect();else{const{currentLayer:qs,div:Qs}=this,Ys=Qs.style.display;Qs.style.display="hidden",qs.div.append(this.div),zs=Qs.getBoundingClientRect(),Qs.remove(),Qs.style.display=Ys}this.rotation%180===this.parentRotation%180?(this.width=zs.width/Ls,this.height=zs.height/Os):(this.width=zs.height/Ls,this.height=zs.width/Os),this.fixAndSetPosition()},xl=function(){if(this.editorDiv.replaceChildren(),!!As(this,hs))for(const Ls of As(this,hs).split(`
`)){const Os=document.createElement("div");Os.append(Ls?document.createTextNode(Ls):document.createElement("br")),this.editorDiv.append(Os)}},Ql=function(Ls){const{value:Os,fontSize:zs,color:qs,rect:Qs,pageIndex:Ys}=As(this,vs);return Ls.value!==Os||Ls.fontSize!==zs||Ls.rect.some((Ws,Is)=>Math.abs(Ws-Qs[Is])>=1)||Ls.color.some((Ws,Is)=>Ws!==qs[Is])||Ls.pageIndex!==Ys},yl=function(Ls=!1){if(!this.annotationElementId)return;if(pr(this,gs,Eo).call(this),!Ls&&(this.width===0||this.height===0)){setTimeout(()=>pr(this,gs,yl).call(this,!0),0);return}const Os=Ns._internalPadding*this.parentScale;As(this,vs).rect=this.getRect(Os,Os)},eo(Ns,"_freeTextDefaultContent",""),eo(Ns,"_internalPadding",0),eo(Ns,"_defaultColor",null),eo(Ns,"_defaultFontSize",10),eo(Ns,"_type","freetext");let ls=Ns;ts.FreeTextEditor=ls},(es,ts,ss)=>{var $s,Fs,uo,Zl,hr,ur,cr,Er,Nr,kr,mr,xr,Ms,Hs,Js,Zs,dr,br,Rr,ar,Pr,Ar,_c,Po,El,Rl,Vr,Zr,to,_r,gr,vr,Or,wl,Jr,or,Sr,Mr,eu,Sl;Object.defineProperty(ts,"__esModule",{value:!0}),ts.StampAnnotationElement=ts.InkAnnotationElement=ts.FreeTextAnnotationElement=ts.AnnotationLayer=void 0;var rs=ss(1),ns=ss(6),os=ss(3),as=ss(30),ls=ss(31),cs=ss(32);const us=1e3,ds=9,ms=new WeakSet;function ps(Ir){return{width:Ir[2]-Ir[0],height:Ir[3]-Ir[1]}}class hs{static create(Xs){switch(Xs.data.annotationType){case rs.AnnotationType.LINK:return new ys(Xs);case rs.AnnotationType.TEXT:return new vs(Xs);case rs.AnnotationType.WIDGET:switch(Xs.data.fieldType){case"Tx":return new fs(Xs);case"Btn":return Xs.data.radioButton?new bs(Xs):Xs.data.checkBox?new Ss(Xs):new Es(Xs);case"Ch":return new Rs(Xs);case"Sig":return new js(Xs)}return new gs(Xs);case rs.AnnotationType.POPUP:return new ws(Xs);case rs.AnnotationType.FREETEXT:return new ks(Xs);case rs.AnnotationType.LINE:return new _s(Xs);case rs.AnnotationType.SQUARE:return new Ls(Xs);case rs.AnnotationType.CIRCLE:return new Os(Xs);case rs.AnnotationType.POLYLINE:return new zs(Xs);case rs.AnnotationType.CARET:return new Qs(Xs);case rs.AnnotationType.INK:return new Ys(Xs);case rs.AnnotationType.POLYGON:return new qs(Xs);case rs.AnnotationType.HIGHLIGHT:return new Ws(Xs);case rs.AnnotationType.UNDERLINE:return new Is(Xs);case rs.AnnotationType.SQUIGGLY:return new Bs(Xs);case rs.AnnotationType.STRIKEOUT:return new Vs(Xs);case rs.AnnotationType.STAMP:return new Ds(Xs);case rs.AnnotationType.FILEATTACHMENT:return new Cs(Xs);default:return new xs(Xs)}}}const Ps=class Ps{constructor(Xs,{isRenderable:Ks=!1,ignoreBorder:lr=!1,createQuadrilaterals:yr=!1}={}){fr(this,$s,!1);this.isRenderable=Ks,this.data=Xs.data,this.layer=Xs.layer,this.linkService=Xs.linkService,this.downloadManager=Xs.downloadManager,this.imageResourcesPath=Xs.imageResourcesPath,this.renderForms=Xs.renderForms,this.svgFactory=Xs.svgFactory,this.annotationStorage=Xs.annotationStorage,this.enableScripting=Xs.enableScripting,this.hasJSActions=Xs.hasJSActions,this._fieldObjects=Xs.fieldObjects,this.parent=Xs.parent,Ks&&(this.container=this._createContainer(lr)),yr&&this._createQuadrilaterals()}static _hasPopupData({titleObj:Xs,contentsObj:Ks,richText:lr}){return!!(Xs!=null&&Xs.str||Ks!=null&&Ks.str||lr!=null&&lr.str)}get hasPopupData(){return Ps._hasPopupData(this.data)}_createContainer(Xs){const{data:Ks,parent:{page:lr,viewport:yr}}=this,wr=document.createElement("section");wr.setAttribute("data-annotation-id",Ks.id),this instanceof gs||(wr.tabIndex=us),wr.style.zIndex=this.parent.zIndex++,this.data.popupRef&&wr.setAttribute("aria-haspopup","dialog"),Ks.noRotate&&wr.classList.add("norotate");const{pageWidth:Cr,pageHeight:Tr,pageX:Hr,pageY:Fr}=yr.rawDims;if(!Ks.rect||this instanceof ws){const{rotation:Kr}=Ks;return!Ks.hasOwnCanvas&&Kr!==0&&this.setRotation(Kr,wr),wr}const{width:Lr,height:qr}=ps(Ks.rect),Br=rs.Util.normalizeRect([Ks.rect[0],lr.view[3]-Ks.rect[1]+lr.view[1],Ks.rect[2],lr.view[3]-Ks.rect[3]+lr.view[1]]);if(!Xs&&Ks.borderStyle.width>0){wr.style.borderWidth=`${Ks.borderStyle.width}px`;const Kr=Ks.borderStyle.horizontalCornerRadius,Xr=Ks.borderStyle.verticalCornerRadius;if(Kr>0||Xr>0){const so=`calc(${Kr}px * var(--scale-factor)) / calc(${Xr}px * var(--scale-factor))`;wr.style.borderRadius=so}else if(this instanceof bs){const so=`calc(${Lr}px * var(--scale-factor)) / calc(${qr}px * var(--scale-factor))`;wr.style.borderRadius=so}switch(Ks.borderStyle.style){case rs.AnnotationBorderStyleType.SOLID:wr.style.borderStyle="solid";break;case rs.AnnotationBorderStyleType.DASHED:wr.style.borderStyle="dashed";break;case rs.AnnotationBorderStyleType.BEVELED:(0,rs.warn)("Unimplemented border style: beveled");break;case rs.AnnotationBorderStyleType.INSET:(0,rs.warn)("Unimplemented border style: inset");break;case rs.AnnotationBorderStyleType.UNDERLINE:wr.style.borderBottomStyle="solid";break}const _i=Ks.borderColor||null;_i?(jr(this,$s,!0),wr.style.borderColor=rs.Util.makeHexColor(_i[0]|0,_i[1]|0,_i[2]|0)):wr.style.borderWidth=0}wr.style.left=`${100*(Br[0]-Hr)/Cr}%`,wr.style.top=`${100*(Br[1]-Fr)/Tr}%`;const{rotation:Wr}=Ks;return Ks.hasOwnCanvas||Wr===0?(wr.style.width=`${100*Lr/Cr}%`,wr.style.height=`${100*qr/Tr}%`):this.setRotation(Wr,wr),wr}setRotation(Xs,Ks=this.container){if(!this.data.rect)return;const{pageWidth:lr,pageHeight:yr}=this.parent.viewport.rawDims,{width:wr,height:Cr}=ps(this.data.rect);let Tr,Hr;Xs%180===0?(Tr=100*wr/lr,Hr=100*Cr/yr):(Tr=100*Cr/lr,Hr=100*wr/yr),Ks.style.width=`${Tr}%`,Ks.style.height=`${Hr}%`,Ks.setAttribute("data-main-rotation",(360-Xs)%360)}get _commonActions(){const Xs=(Ks,lr,yr)=>{const wr=yr.detail[Ks],Cr=wr[0],Tr=wr.slice(1);yr.target.style[lr]=as.ColorConverters[`${Cr}_HTML`](Tr),this.annotationStorage.setValue(this.data.id,{[lr]:as.ColorConverters[`${Cr}_rgb`](Tr)})};return(0,rs.shadow)(this,"_commonActions",{display:Ks=>{const{display:lr}=Ks.detail,yr=lr%2===1;this.container.style.visibility=yr?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:yr,noPrint:lr===1||lr===2})},print:Ks=>{this.annotationStorage.setValue(this.data.id,{noPrint:!Ks.detail.print})},hidden:Ks=>{const{hidden:lr}=Ks.detail;this.container.style.visibility=lr?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:lr,noView:lr})},focus:Ks=>{setTimeout(()=>Ks.target.focus({preventScroll:!1}),0)},userName:Ks=>{Ks.target.title=Ks.detail.userName},readonly:Ks=>{Ks.target.disabled=Ks.detail.readonly},required:Ks=>{this._setRequired(Ks.target,Ks.detail.required)},bgColor:Ks=>{Xs("bgColor","backgroundColor",Ks)},fillColor:Ks=>{Xs("fillColor","backgroundColor",Ks)},fgColor:Ks=>{Xs("fgColor","color",Ks)},textColor:Ks=>{Xs("textColor","color",Ks)},borderColor:Ks=>{Xs("borderColor","borderColor",Ks)},strokeColor:Ks=>{Xs("strokeColor","borderColor",Ks)},rotation:Ks=>{const lr=Ks.detail.rotation;this.setRotation(lr),this.annotationStorage.setValue(this.data.id,{rotation:lr})}})}_dispatchEventFromSandbox(Xs,Ks){const lr=this._commonActions;for(const yr of Object.keys(Ks.detail)){const wr=Xs[yr]||lr[yr];wr==null||wr(Ks)}}_setDefaultPropertiesFromJS(Xs){if(!this.enableScripting)return;const Ks=this.annotationStorage.getRawValue(this.data.id);if(!Ks)return;const lr=this._commonActions;for(const[yr,wr]of Object.entries(Ks)){const Cr=lr[yr];if(Cr){const Tr={detail:{[yr]:wr},target:Xs};Cr(Tr),delete Ks[yr]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:Xs}=this.data;if(!Xs)return;const[Ks,lr,yr,wr]=this.data.rect;if(Xs.length===1){const[,{x:Xr,y:_i},{x:so,y:no}]=Xs[0];if(yr===Xr&&wr===_i&&Ks===so&&lr===no)return}const{style:Cr}=this.container;let Tr;if(As(this,$s)){const{borderColor:Xr,borderWidth:_i}=Cr;Cr.borderWidth=0,Tr=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${Xr}" stroke-width="${_i}">`],this.container.classList.add("hasBorder")}const Hr=yr-Ks,Fr=wr-lr,{svgFactory:Lr}=this,qr=Lr.createElement("svg");qr.classList.add("quadrilateralsContainer"),qr.setAttribute("width",0),qr.setAttribute("height",0);const Br=Lr.createElement("defs");qr.append(Br);const Wr=Lr.createElement("clipPath"),Kr=`clippath_${this.data.id}`;Wr.setAttribute("id",Kr),Wr.setAttribute("clipPathUnits","objectBoundingBox"),Br.append(Wr);for(const[,{x:Xr,y:_i},{x:so,y:no}]of Xs){const ro=Lr.createElement("rect"),oo=(so-Ks)/Hr,lo=(wr-_i)/Fr,co=(Xr-so)/Hr,Dl=(_i-no)/Fr;ro.setAttribute("x",oo),ro.setAttribute("y",lo),ro.setAttribute("width",co),ro.setAttribute("height",Dl),Wr.append(ro),Tr==null||Tr.push(`<rect vector-effect="non-scaling-stroke" x="${oo}" y="${lo}" width="${co}" height="${Dl}"/>`)}As(this,$s)&&(Tr.push("</g></svg>')"),Cr.backgroundImage=Tr.join("")),this.container.append(qr),this.container.style.clipPath=`url(#${Kr})`}_createPopup(){const{container:Xs,data:Ks}=this;Xs.setAttribute("aria-haspopup","dialog");const lr=new ws({data:{color:Ks.color,titleObj:Ks.titleObj,modificationDate:Ks.modificationDate,contentsObj:Ks.contentsObj,richText:Ks.richText,parentRect:Ks.rect,borderStyle:0,id:`popup_${Ks.id}`,rotation:Ks.rotation},parent:this.parent,elements:[this]});this.parent.div.append(lr.render())}render(){(0,rs.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(Xs,Ks=null){const lr=[];if(this._fieldObjects){const yr=this._fieldObjects[Xs];if(yr)for(const{page:wr,id:Cr,exportValues:Tr}of yr){if(wr===-1||Cr===Ks)continue;const Hr=typeof Tr=="string"?Tr:null,Fr=document.querySelector(`[data-element-id="${Cr}"]`);if(Fr&&!ms.has(Fr)){(0,rs.warn)(`_getElementsByName - element not allowed: ${Cr}`);continue}lr.push({id:Cr,exportValue:Hr,domElement:Fr})}return lr}for(const yr of document.getElementsByName(Xs)){const{exportValue:wr}=yr,Cr=yr.getAttribute("data-element-id");Cr!==Ks&&ms.has(yr)&&lr.push({id:Cr,exportValue:wr,domElement:yr})}return lr}show(){var Xs;this.container&&(this.container.hidden=!1),(Xs=this.popup)==null||Xs.maybeShow()}hide(){var Xs;this.container&&(this.container.hidden=!0),(Xs=this.popup)==null||Xs.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const Xs=this.getElementsToTriggerPopup();if(Array.isArray(Xs))for(const Ks of Xs)Ks.classList.add("highlightArea");else Xs.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:Xs,data:{id:Ks}}=this;this.container.addEventListener("dblclick",()=>{var lr;(lr=this.linkService.eventBus)==null||lr.dispatch("switchannotationeditormode",{source:this,mode:Xs,editId:Ks})})}};$s=new WeakMap;let xs=Ps;class ys extends xs{constructor(Ks,lr=null){super(Ks,{isRenderable:!0,ignoreBorder:!!(lr!=null&&lr.ignoreBorder),createQuadrilaterals:!0});fr(this,Fs);this.isTooltipOnly=Ks.data.isTooltipOnly}render(){const{data:Ks,linkService:lr}=this,yr=document.createElement("a");yr.setAttribute("data-element-id",Ks.id);let wr=!1;return Ks.url?(lr.addLinkAttributes(yr,Ks.url,Ks.newWindow),wr=!0):Ks.action?(this._bindNamedAction(yr,Ks.action),wr=!0):Ks.attachment?(this._bindAttachment(yr,Ks.attachment),wr=!0):Ks.setOCGState?(pr(this,Fs,Zl).call(this,yr,Ks.setOCGState),wr=!0):Ks.dest?(this._bindLink(yr,Ks.dest),wr=!0):(Ks.actions&&(Ks.actions.Action||Ks.actions["Mouse Up"]||Ks.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(yr,Ks),wr=!0),Ks.resetForm?(this._bindResetFormAction(yr,Ks.resetForm),wr=!0):this.isTooltipOnly&&!wr&&(this._bindLink(yr,""),wr=!0)),this.container.classList.add("linkAnnotation"),wr&&this.container.append(yr),this.container}_bindLink(Ks,lr){Ks.href=this.linkService.getDestinationHash(lr),Ks.onclick=()=>(lr&&this.linkService.goToDestination(lr),!1),(lr||lr==="")&&pr(this,Fs,uo).call(this)}_bindNamedAction(Ks,lr){Ks.href=this.linkService.getAnchorUrl(""),Ks.onclick=()=>(this.linkService.executeNamedAction(lr),!1),pr(this,Fs,uo).call(this)}_bindAttachment(Ks,lr){Ks.href=this.linkService.getAnchorUrl(""),Ks.onclick=()=>{var yr;return(yr=this.downloadManager)==null||yr.openOrDownloadData(this.container,lr.content,lr.filename),!1},pr(this,Fs,uo).call(this)}_bindJSAction(Ks,lr){Ks.href=this.linkService.getAnchorUrl("");const yr=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const wr of Object.keys(lr.actions)){const Cr=yr.get(wr);Cr&&(Ks[Cr]=()=>{var Tr;return(Tr=this.linkService.eventBus)==null||Tr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:lr.id,name:wr}}),!1})}Ks.onclick||(Ks.onclick=()=>!1),pr(this,Fs,uo).call(this)}_bindResetFormAction(Ks,lr){const yr=Ks.onclick;if(yr||(Ks.href=this.linkService.getAnchorUrl("")),pr(this,Fs,uo).call(this),!this._fieldObjects){(0,rs.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),yr||(Ks.onclick=()=>!1);return}Ks.onclick=()=>{var qr;yr==null||yr();const{fields:wr,refs:Cr,include:Tr}=lr,Hr=[];if(wr.length!==0||Cr.length!==0){const Br=new Set(Cr);for(const Wr of wr){const Kr=this._fieldObjects[Wr]||[];for(const{id:Xr}of Kr)Br.add(Xr)}for(const Wr of Object.values(this._fieldObjects))for(const Kr of Wr)Br.has(Kr.id)===Tr&&Hr.push(Kr)}else for(const Br of Object.values(this._fieldObjects))Hr.push(...Br);const Fr=this.annotationStorage,Lr=[];for(const Br of Hr){const{id:Wr}=Br;switch(Lr.push(Wr),Br.type){case"text":{const Xr=Br.defaultValue||"";Fr.setValue(Wr,{value:Xr});break}case"checkbox":case"radiobutton":{const Xr=Br.defaultValue===Br.exportValues;Fr.setValue(Wr,{value:Xr});break}case"combobox":case"listbox":{const Xr=Br.defaultValue||"";Fr.setValue(Wr,{value:Xr});break}default:continue}const Kr=document.querySelector(`[data-element-id="${Wr}"]`);if(Kr){if(!ms.has(Kr)){(0,rs.warn)(`_bindResetFormAction - element not allowed: ${Wr}`);continue}}else continue;Kr.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((qr=this.linkService.eventBus)==null||qr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:Lr,name:"ResetForm"}})),!1}}}Fs=new WeakSet,uo=function(){this.container.setAttribute("data-internal-link","")},Zl=function(Ks,lr){Ks.href=this.linkService.getAnchorUrl(""),Ks.onclick=()=>(this.linkService.executeSetOCGState(lr),!1),pr(this,Fs,uo).call(this)};class vs extends xs{constructor(Xs){super(Xs,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const Xs=document.createElement("img");return Xs.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",Xs.alt="[{{type}} Annotation]",Xs.dataset.l10nId="text_annotation_type",Xs.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(Xs),this.container}}class gs extends xs{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(Xs){var Ks;this.data.hasOwnCanvas&&(((Ks=Xs.previousSibling)==null?void 0:Ks.nodeName)==="CANVAS"&&(Xs.previousSibling.hidden=!0),Xs.hidden=!1)}_getKeyModifier(Xs){const{isWin:Ks,isMac:lr}=rs.FeatureTest.platform;return Ks&&Xs.ctrlKey||lr&&Xs.metaKey}_setEventListener(Xs,Ks,lr,yr,wr){lr.includes("mouse")?Xs.addEventListener(lr,Cr=>{var Tr;(Tr=this.linkService.eventBus)==null||Tr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:yr,value:wr(Cr),shift:Cr.shiftKey,modifier:this._getKeyModifier(Cr)}})}):Xs.addEventListener(lr,Cr=>{var Tr;if(lr==="blur"){if(!Ks.focused||!Cr.relatedTarget)return;Ks.focused=!1}else if(lr==="focus"){if(Ks.focused)return;Ks.focused=!0}wr&&((Tr=this.linkService.eventBus)==null||Tr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:yr,value:wr(Cr)}}))})}_setEventListeners(Xs,Ks,lr,yr){var wr,Cr,Tr;for(const[Hr,Fr]of lr)(Fr==="Action"||(wr=this.data.actions)!=null&&wr[Fr])&&((Fr==="Focus"||Fr==="Blur")&&(Ks||(Ks={focused:!1})),this._setEventListener(Xs,Ks,Hr,Fr,yr),Fr==="Focus"&&!((Cr=this.data.actions)!=null&&Cr.Blur)?this._setEventListener(Xs,Ks,"blur","Blur",null):Fr==="Blur"&&!((Tr=this.data.actions)!=null&&Tr.Focus)&&this._setEventListener(Xs,Ks,"focus","Focus",null))}_setBackgroundColor(Xs){const Ks=this.data.backgroundColor||null;Xs.style.backgroundColor=Ks===null?"transparent":rs.Util.makeHexColor(Ks[0],Ks[1],Ks[2])}_setTextStyle(Xs){const Ks=["left","center","right"],{fontColor:lr}=this.data.defaultAppearanceData,yr=this.data.defaultAppearanceData.fontSize||ds,wr=Xs.style;let Cr;const Tr=2,Hr=Fr=>Math.round(10*Fr)/10;if(this.data.multiLine){const Fr=Math.abs(this.data.rect[3]-this.data.rect[1]-Tr),Lr=Math.round(Fr/(rs.LINE_FACTOR*yr))||1,qr=Fr/Lr;Cr=Math.min(yr,Hr(qr/rs.LINE_FACTOR))}else{const Fr=Math.abs(this.data.rect[3]-this.data.rect[1]-Tr);Cr=Math.min(yr,Hr(Fr/rs.LINE_FACTOR))}wr.fontSize=`calc(${Cr}px * var(--scale-factor))`,wr.color=rs.Util.makeHexColor(lr[0],lr[1],lr[2]),this.data.textAlignment!==null&&(wr.textAlign=Ks[this.data.textAlignment])}_setRequired(Xs,Ks){Ks?Xs.setAttribute("required",!0):Xs.removeAttribute("required"),Xs.setAttribute("aria-required",Ks)}}class fs extends gs{constructor(Xs){const Ks=Xs.renderForms||!Xs.data.hasAppearance&&!!Xs.data.fieldValue;super(Xs,{isRenderable:Ks})}setPropertyOnSiblings(Xs,Ks,lr,yr){const wr=this.annotationStorage;for(const Cr of this._getElementsByName(Xs.name,Xs.id))Cr.domElement&&(Cr.domElement[Ks]=lr),wr.setValue(Cr.id,{[yr]:lr})}render(){var yr,wr;const Xs=this.annotationStorage,Ks=this.data.id;this.container.classList.add("textWidgetAnnotation");let lr=null;if(this.renderForms){const Cr=Xs.getValue(Ks,{value:this.data.fieldValue});let Tr=Cr.value||"";const Hr=Xs.getValue(Ks,{charLimit:this.data.maxLen}).charLimit;Hr&&Tr.length>Hr&&(Tr=Tr.slice(0,Hr));let Fr=Cr.formattedValue||((yr=this.data.textContent)==null?void 0:yr.join(`
`))||null;Fr&&this.data.comb&&(Fr=Fr.replaceAll(/\s+/g,""));const Lr={userValue:Tr,formattedValue:Fr,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(lr=document.createElement("textarea"),lr.textContent=Fr??Tr,this.data.doNotScroll&&(lr.style.overflowY="hidden")):(lr=document.createElement("input"),lr.type="text",lr.setAttribute("value",Fr??Tr),this.data.doNotScroll&&(lr.style.overflowX="hidden")),this.data.hasOwnCanvas&&(lr.hidden=!0),ms.add(lr),lr.setAttribute("data-element-id",Ks),lr.disabled=this.data.readOnly,lr.name=this.data.fieldName,lr.tabIndex=us,this._setRequired(lr,this.data.required),Hr&&(lr.maxLength=Hr),lr.addEventListener("input",Br=>{Xs.setValue(Ks,{value:Br.target.value}),this.setPropertyOnSiblings(lr,"value",Br.target.value,"value"),Lr.formattedValue=null}),lr.addEventListener("resetform",Br=>{const Wr=this.data.defaultFieldValue??"";lr.value=Lr.userValue=Wr,Lr.formattedValue=null});let qr=Br=>{const{formattedValue:Wr}=Lr;Wr!=null&&(Br.target.value=Wr),Br.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){lr.addEventListener("focus",Wr=>{if(Lr.focused)return;const{target:Kr}=Wr;Lr.userValue&&(Kr.value=Lr.userValue),Lr.lastCommittedValue=Kr.value,Lr.commitKey=1,Lr.focused=!0}),lr.addEventListener("updatefromsandbox",Wr=>{this.showElementAndHideCanvas(Wr.target);const Kr={value(Xr){Lr.userValue=Xr.detail.value??"",Xs.setValue(Ks,{value:Lr.userValue.toString()}),Xr.target.value=Lr.userValue},formattedValue(Xr){const{formattedValue:_i}=Xr.detail;Lr.formattedValue=_i,_i!=null&&Xr.target!==document.activeElement&&(Xr.target.value=_i),Xs.setValue(Ks,{formattedValue:_i})},selRange(Xr){Xr.target.setSelectionRange(...Xr.detail.selRange)},charLimit:Xr=>{var ro;const{charLimit:_i}=Xr.detail,{target:so}=Xr;if(_i===0){so.removeAttribute("maxLength");return}so.setAttribute("maxLength",_i);let no=Lr.userValue;!no||no.length<=_i||(no=no.slice(0,_i),so.value=Lr.userValue=no,Xs.setValue(Ks,{value:no}),(ro=this.linkService.eventBus)==null||ro.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ks,name:"Keystroke",value:no,willCommit:!0,commitKey:1,selStart:so.selectionStart,selEnd:so.selectionEnd}}))}};this._dispatchEventFromSandbox(Kr,Wr)}),lr.addEventListener("keydown",Wr=>{var _i;Lr.commitKey=1;let Kr=-1;if(Wr.key==="Escape"?Kr=0:Wr.key==="Enter"&&!this.data.multiLine?Kr=2:Wr.key==="Tab"&&(Lr.commitKey=3),Kr===-1)return;const{value:Xr}=Wr.target;Lr.lastCommittedValue!==Xr&&(Lr.lastCommittedValue=Xr,Lr.userValue=Xr,(_i=this.linkService.eventBus)==null||_i.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ks,name:"Keystroke",value:Xr,willCommit:!0,commitKey:Kr,selStart:Wr.target.selectionStart,selEnd:Wr.target.selectionEnd}}))});const Br=qr;qr=null,lr.addEventListener("blur",Wr=>{var Xr;if(!Lr.focused||!Wr.relatedTarget)return;Lr.focused=!1;const{value:Kr}=Wr.target;Lr.userValue=Kr,Lr.lastCommittedValue!==Kr&&((Xr=this.linkService.eventBus)==null||Xr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ks,name:"Keystroke",value:Kr,willCommit:!0,commitKey:Lr.commitKey,selStart:Wr.target.selectionStart,selEnd:Wr.target.selectionEnd}})),Br(Wr)}),(wr=this.data.actions)!=null&&wr.Keystroke&&lr.addEventListener("beforeinput",Wr=>{var lo;Lr.lastCommittedValue=null;const{data:Kr,target:Xr}=Wr,{value:_i,selectionStart:so,selectionEnd:no}=Xr;let ro=so,oo=no;switch(Wr.inputType){case"deleteWordBackward":{const co=_i.substring(0,so).match(/\w*[^\w]*$/);co&&(ro-=co[0].length);break}case"deleteWordForward":{const co=_i.substring(so).match(/^[^\w]*\w*/);co&&(oo+=co[0].length);break}case"deleteContentBackward":so===no&&(ro-=1);break;case"deleteContentForward":so===no&&(oo+=1);break}Wr.preventDefault(),(lo=this.linkService.eventBus)==null||lo.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ks,name:"Keystroke",value:_i,change:Kr||"",willCommit:!1,selStart:ro,selEnd:oo}})}),this._setEventListeners(lr,Lr,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Wr=>Wr.target.value)}if(qr&&lr.addEventListener("blur",qr),this.data.comb){const Wr=(this.data.rect[2]-this.data.rect[0])/Hr;lr.classList.add("comb"),lr.style.letterSpacing=`calc(${Wr}px * var(--scale-factor) - 1ch)`}}else lr=document.createElement("div"),lr.textContent=this.data.fieldValue,lr.style.verticalAlign="middle",lr.style.display="table-cell";return this._setTextStyle(lr),this._setBackgroundColor(lr),this._setDefaultPropertiesFromJS(lr),this.container.append(lr),this.container}}class js extends gs{constructor(Xs){super(Xs,{isRenderable:!!Xs.data.hasOwnCanvas})}}class Ss extends gs{constructor(Xs){super(Xs,{isRenderable:Xs.renderForms})}render(){const Xs=this.annotationStorage,Ks=this.data,lr=Ks.id;let yr=Xs.getValue(lr,{value:Ks.exportValue===Ks.fieldValue}).value;typeof yr=="string"&&(yr=yr!=="Off",Xs.setValue(lr,{value:yr})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const wr=document.createElement("input");return ms.add(wr),wr.setAttribute("data-element-id",lr),wr.disabled=Ks.readOnly,this._setRequired(wr,this.data.required),wr.type="checkbox",wr.name=Ks.fieldName,yr&&wr.setAttribute("checked",!0),wr.setAttribute("exportValue",Ks.exportValue),wr.tabIndex=us,wr.addEventListener("change",Cr=>{const{name:Tr,checked:Hr}=Cr.target;for(const Fr of this._getElementsByName(Tr,lr)){const Lr=Hr&&Fr.exportValue===Ks.exportValue;Fr.domElement&&(Fr.domElement.checked=Lr),Xs.setValue(Fr.id,{value:Lr})}Xs.setValue(lr,{value:Hr})}),wr.addEventListener("resetform",Cr=>{const Tr=Ks.defaultFieldValue||"Off";Cr.target.checked=Tr===Ks.exportValue}),this.enableScripting&&this.hasJSActions&&(wr.addEventListener("updatefromsandbox",Cr=>{const Tr={value(Hr){Hr.target.checked=Hr.detail.value!=="Off",Xs.setValue(lr,{value:Hr.target.checked})}};this._dispatchEventFromSandbox(Tr,Cr)}),this._setEventListeners(wr,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Cr=>Cr.target.checked)),this._setBackgroundColor(wr),this._setDefaultPropertiesFromJS(wr),this.container.append(wr),this.container}}class bs extends gs{constructor(Xs){super(Xs,{isRenderable:Xs.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const Xs=this.annotationStorage,Ks=this.data,lr=Ks.id;let yr=Xs.getValue(lr,{value:Ks.fieldValue===Ks.buttonValue}).value;typeof yr=="string"&&(yr=yr!==Ks.buttonValue,Xs.setValue(lr,{value:yr}));const wr=document.createElement("input");if(ms.add(wr),wr.setAttribute("data-element-id",lr),wr.disabled=Ks.readOnly,this._setRequired(wr,this.data.required),wr.type="radio",wr.name=Ks.fieldName,yr&&wr.setAttribute("checked",!0),wr.tabIndex=us,wr.addEventListener("change",Cr=>{const{name:Tr,checked:Hr}=Cr.target;for(const Fr of this._getElementsByName(Tr,lr))Xs.setValue(Fr.id,{value:!1});Xs.setValue(lr,{value:Hr})}),wr.addEventListener("resetform",Cr=>{const Tr=Ks.defaultFieldValue;Cr.target.checked=Tr!=null&&Tr===Ks.buttonValue}),this.enableScripting&&this.hasJSActions){const Cr=Ks.buttonValue;wr.addEventListener("updatefromsandbox",Tr=>{const Hr={value:Fr=>{const Lr=Cr===Fr.detail.value;for(const qr of this._getElementsByName(Fr.target.name)){const Br=Lr&&qr.id===lr;qr.domElement&&(qr.domElement.checked=Br),Xs.setValue(qr.id,{value:Br})}}};this._dispatchEventFromSandbox(Hr,Tr)}),this._setEventListeners(wr,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Tr=>Tr.target.checked)}return this._setBackgroundColor(wr),this._setDefaultPropertiesFromJS(wr),this.container.append(wr),this.container}}class Es extends ys{constructor(Xs){super(Xs,{ignoreBorder:Xs.data.hasAppearance})}render(){const Xs=super.render();Xs.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(Xs.title=this.data.alternativeText);const Ks=Xs.lastChild;return this.enableScripting&&this.hasJSActions&&Ks&&(this._setDefaultPropertiesFromJS(Ks),Ks.addEventListener("updatefromsandbox",lr=>{this._dispatchEventFromSandbox({},lr)})),Xs}}class Rs extends gs{constructor(Xs){super(Xs,{isRenderable:Xs.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const Xs=this.annotationStorage,Ks=this.data.id,lr=Xs.getValue(Ks,{value:this.data.fieldValue}),yr=document.createElement("select");ms.add(yr),yr.setAttribute("data-element-id",Ks),yr.disabled=this.data.readOnly,this._setRequired(yr,this.data.required),yr.name=this.data.fieldName,yr.tabIndex=us;let wr=this.data.combo&&this.data.options.length>0;this.data.combo||(yr.size=this.data.options.length,this.data.multiSelect&&(yr.multiple=!0)),yr.addEventListener("resetform",Lr=>{const qr=this.data.defaultFieldValue;for(const Br of yr.options)Br.selected=Br.value===qr});for(const Lr of this.data.options){const qr=document.createElement("option");qr.textContent=Lr.displayValue,qr.value=Lr.exportValue,lr.value.includes(Lr.exportValue)&&(qr.setAttribute("selected",!0),wr=!1),yr.append(qr)}let Cr=null;if(wr){const Lr=document.createElement("option");Lr.value=" ",Lr.setAttribute("hidden",!0),Lr.setAttribute("selected",!0),yr.prepend(Lr),Cr=()=>{Lr.remove(),yr.removeEventListener("input",Cr),Cr=null},yr.addEventListener("input",Cr)}const Tr=Lr=>{const qr=Lr?"value":"textContent",{options:Br,multiple:Wr}=yr;return Wr?Array.prototype.filter.call(Br,Kr=>Kr.selected).map(Kr=>Kr[qr]):Br.selectedIndex===-1?null:Br[Br.selectedIndex][qr]};let Hr=Tr(!1);const Fr=Lr=>{const qr=Lr.target.options;return Array.prototype.map.call(qr,Br=>({displayValue:Br.textContent,exportValue:Br.value}))};return this.enableScripting&&this.hasJSActions?(yr.addEventListener("updatefromsandbox",Lr=>{const qr={value(Br){Cr==null||Cr();const Wr=Br.detail.value,Kr=new Set(Array.isArray(Wr)?Wr:[Wr]);for(const Xr of yr.options)Xr.selected=Kr.has(Xr.value);Xs.setValue(Ks,{value:Tr(!0)}),Hr=Tr(!1)},multipleSelection(Br){yr.multiple=!0},remove(Br){const Wr=yr.options,Kr=Br.detail.remove;Wr[Kr].selected=!1,yr.remove(Kr),Wr.length>0&&Array.prototype.findIndex.call(Wr,_i=>_i.selected)===-1&&(Wr[0].selected=!0),Xs.setValue(Ks,{value:Tr(!0),items:Fr(Br)}),Hr=Tr(!1)},clear(Br){for(;yr.length!==0;)yr.remove(0);Xs.setValue(Ks,{value:null,items:[]}),Hr=Tr(!1)},insert(Br){const{index:Wr,displayValue:Kr,exportValue:Xr}=Br.detail.insert,_i=yr.children[Wr],so=document.createElement("option");so.textContent=Kr,so.value=Xr,_i?_i.before(so):yr.append(so),Xs.setValue(Ks,{value:Tr(!0),items:Fr(Br)}),Hr=Tr(!1)},items(Br){const{items:Wr}=Br.detail;for(;yr.length!==0;)yr.remove(0);for(const Kr of Wr){const{displayValue:Xr,exportValue:_i}=Kr,so=document.createElement("option");so.textContent=Xr,so.value=_i,yr.append(so)}yr.options.length>0&&(yr.options[0].selected=!0),Xs.setValue(Ks,{value:Tr(!0),items:Fr(Br)}),Hr=Tr(!1)},indices(Br){const Wr=new Set(Br.detail.indices);for(const Kr of Br.target.options)Kr.selected=Wr.has(Kr.index);Xs.setValue(Ks,{value:Tr(!0)}),Hr=Tr(!1)},editable(Br){Br.target.disabled=!Br.detail.editable}};this._dispatchEventFromSandbox(qr,Lr)}),yr.addEventListener("input",Lr=>{var Br;const qr=Tr(!0);Xs.setValue(Ks,{value:qr}),Lr.preventDefault(),(Br=this.linkService.eventBus)==null||Br.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Ks,name:"Keystroke",value:Hr,changeEx:qr,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(yr,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],Lr=>Lr.target.value)):yr.addEventListener("input",function(Lr){Xs.setValue(Ks,{value:Tr(!0)})}),this.data.combo&&this._setTextStyle(yr),this._setBackgroundColor(yr),this._setDefaultPropertiesFromJS(yr),this.container.append(yr),this.container}}class ws extends xs{constructor(Xs){const{data:Ks,elements:lr}=Xs;super(Xs,{isRenderable:xs._hasPopupData(Ks)}),this.elements=lr}render(){this.container.classList.add("popupAnnotation");const Xs=new Ns({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),Ks=[];for(const lr of this.elements)lr.popup=Xs,Ks.push(lr.data.id),lr.addHighlightArea();return this.container.setAttribute("aria-controls",Ks.map(lr=>`${rs.AnnotationPrefix}${lr}`).join(",")),this.container}}class Ns{constructor({container:Xs,color:Ks,elements:lr,titleObj:yr,modificationDate:wr,contentsObj:Cr,richText:Tr,parent:Hr,rect:Fr,parentRect:Lr,open:qr}){fr(this,Ar);fr(this,hr,null);fr(this,ur,pr(this,Ar,_c).bind(this));fr(this,cr,pr(this,Ar,Rl).bind(this));fr(this,Er,pr(this,Ar,El).bind(this));fr(this,Nr,pr(this,Ar,Po).bind(this));fr(this,kr,null);fr(this,mr,null);fr(this,xr,null);fr(this,Ms,null);fr(this,Hs,null);fr(this,Js,null);fr(this,Zs,!1);fr(this,dr,null);fr(this,br,null);fr(this,Rr,null);fr(this,ar,null);fr(this,Pr,!1);var Wr;jr(this,mr,Xs),jr(this,ar,yr),jr(this,xr,Cr),jr(this,Rr,Tr),jr(this,Hs,Hr),jr(this,kr,Ks),jr(this,br,Fr),jr(this,Js,Lr),jr(this,Ms,lr);const Br=ns.PDFDateString.toDateObject(wr);Br&&jr(this,hr,Hr.l10n.get("annotation_date_string",{date:Br.toLocaleDateString(),time:Br.toLocaleTimeString()})),this.trigger=lr.flatMap(Kr=>Kr.getElementsToTriggerPopup());for(const Kr of this.trigger)Kr.addEventListener("click",As(this,Nr)),Kr.addEventListener("mouseenter",As(this,Er)),Kr.addEventListener("mouseleave",As(this,cr)),Kr.classList.add("popupTriggerArea");for(const Kr of lr)(Wr=Kr.container)==null||Wr.addEventListener("keydown",As(this,ur));As(this,mr).hidden=!0,qr&&pr(this,Ar,Po).call(this)}render(){if(As(this,dr))return;const{page:{view:Xs},viewport:{rawDims:{pageWidth:Ks,pageHeight:lr,pageX:yr,pageY:wr}}}=As(this,Hs),Cr=jr(this,dr,document.createElement("div"));if(Cr.className="popup",As(this,kr)){const ro=Cr.style.outlineColor=rs.Util.makeHexColor(...As(this,kr));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?Cr.style.backgroundColor=`color-mix(in srgb, ${ro} 30%, white)`:Cr.style.backgroundColor=rs.Util.makeHexColor(...As(this,kr).map(lo=>Math.floor(.7*(255-lo)+lo)))}const Tr=document.createElement("span");Tr.className="header";const Hr=document.createElement("h1");if(Tr.append(Hr),{dir:Hr.dir,str:Hr.textContent}=As(this,ar),Cr.append(Tr),As(this,hr)){const ro=document.createElement("span");ro.classList.add("popupDate"),As(this,hr).then(oo=>{ro.textContent=oo}),Tr.append(ro)}const Fr=As(this,xr),Lr=As(this,Rr);if(Lr!=null&&Lr.str&&(!(Fr!=null&&Fr.str)||Fr.str===Lr.str))cs.XfaLayer.render({xfaHtml:Lr.html,intent:"richText",div:Cr}),Cr.lastChild.classList.add("richText","popupContent");else{const ro=this._formatContents(Fr);Cr.append(ro)}let qr=!!As(this,Js),Br=qr?As(this,Js):As(this,br);for(const ro of As(this,Ms))if(!Br||rs.Util.intersect(ro.data.rect,Br)!==null){Br=ro.data.rect,qr=!0;break}const Wr=rs.Util.normalizeRect([Br[0],Xs[3]-Br[1]+Xs[1],Br[2],Xs[3]-Br[3]+Xs[1]]),Xr=qr?Br[2]-Br[0]+5:0,_i=Wr[0]+Xr,so=Wr[1],{style:no}=As(this,mr);no.left=`${100*(_i-yr)/Ks}%`,no.top=`${100*(so-wr)/lr}%`,As(this,mr).append(Cr)}_formatContents({str:Xs,dir:Ks}){const lr=document.createElement("p");lr.classList.add("popupContent"),lr.dir=Ks;const yr=Xs.split(/(?:\r\n?|\n)/);for(let wr=0,Cr=yr.length;wr<Cr;++wr){const Tr=yr[wr];lr.append(document.createTextNode(Tr)),wr<Cr-1&&lr.append(document.createElement("br"))}return lr}forceHide(){jr(this,Pr,this.isVisible),As(this,Pr)&&(As(this,mr).hidden=!0)}maybeShow(){As(this,Pr)&&(jr(this,Pr,!1),As(this,mr).hidden=!1)}get isVisible(){return As(this,mr).hidden===!1}}hr=new WeakMap,ur=new WeakMap,cr=new WeakMap,Er=new WeakMap,Nr=new WeakMap,kr=new WeakMap,mr=new WeakMap,xr=new WeakMap,Ms=new WeakMap,Hs=new WeakMap,Js=new WeakMap,Zs=new WeakMap,dr=new WeakMap,br=new WeakMap,Rr=new WeakMap,ar=new WeakMap,Pr=new WeakMap,Ar=new WeakSet,_c=function(Xs){Xs.altKey||Xs.shiftKey||Xs.ctrlKey||Xs.metaKey||(Xs.key==="Enter"||Xs.key==="Escape"&&As(this,Zs))&&pr(this,Ar,Po).call(this)},Po=function(){jr(this,Zs,!As(this,Zs)),As(this,Zs)?(pr(this,Ar,El).call(this),As(this,mr).addEventListener("click",As(this,Nr)),As(this,mr).addEventListener("keydown",As(this,ur))):(pr(this,Ar,Rl).call(this),As(this,mr).removeEventListener("click",As(this,Nr)),As(this,mr).removeEventListener("keydown",As(this,ur)))},El=function(){As(this,dr)||this.render(),this.isVisible?As(this,Zs)&&As(this,mr).classList.add("focused"):(As(this,mr).hidden=!1,As(this,mr).style.zIndex=parseInt(As(this,mr).style.zIndex)+1e3)},Rl=function(){As(this,mr).classList.remove("focused"),!(As(this,Zs)||!this.isVisible)&&(As(this,mr).hidden=!0,As(this,mr).style.zIndex=parseInt(As(this,mr).style.zIndex)-1e3)};class ks extends xs{constructor(Xs){super(Xs,{isRenderable:!0,ignoreBorder:!0}),this.textContent=Xs.data.textContent,this.textPosition=Xs.data.textPosition,this.annotationEditorType=rs.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const Xs=document.createElement("div");Xs.classList.add("annotationTextContent"),Xs.setAttribute("role","comment");for(const Ks of this.textContent){const lr=document.createElement("span");lr.textContent=Ks,Xs.append(lr)}this.container.append(Xs)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}ts.FreeTextAnnotationElement=ks;class _s extends xs{constructor(Ks){super(Ks,{isRenderable:!0,ignoreBorder:!0});fr(this,Vr,null)}render(){this.container.classList.add("lineAnnotation");const Ks=this.data,{width:lr,height:yr}=ps(Ks.rect),wr=this.svgFactory.create(lr,yr,!0),Cr=jr(this,Vr,this.svgFactory.createElement("svg:line"));return Cr.setAttribute("x1",Ks.rect[2]-Ks.lineCoordinates[0]),Cr.setAttribute("y1",Ks.rect[3]-Ks.lineCoordinates[1]),Cr.setAttribute("x2",Ks.rect[2]-Ks.lineCoordinates[2]),Cr.setAttribute("y2",Ks.rect[3]-Ks.lineCoordinates[3]),Cr.setAttribute("stroke-width",Ks.borderStyle.width||1),Cr.setAttribute("stroke","transparent"),Cr.setAttribute("fill","transparent"),wr.append(Cr),this.container.append(wr),!Ks.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return As(this,Vr)}addHighlightArea(){this.container.classList.add("highlightArea")}}Vr=new WeakMap;class Ls extends xs{constructor(Ks){super(Ks,{isRenderable:!0,ignoreBorder:!0});fr(this,Zr,null)}render(){this.container.classList.add("squareAnnotation");const Ks=this.data,{width:lr,height:yr}=ps(Ks.rect),wr=this.svgFactory.create(lr,yr,!0),Cr=Ks.borderStyle.width,Tr=jr(this,Zr,this.svgFactory.createElement("svg:rect"));return Tr.setAttribute("x",Cr/2),Tr.setAttribute("y",Cr/2),Tr.setAttribute("width",lr-Cr),Tr.setAttribute("height",yr-Cr),Tr.setAttribute("stroke-width",Cr||1),Tr.setAttribute("stroke","transparent"),Tr.setAttribute("fill","transparent"),wr.append(Tr),this.container.append(wr),!Ks.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return As(this,Zr)}addHighlightArea(){this.container.classList.add("highlightArea")}}Zr=new WeakMap;class Os extends xs{constructor(Ks){super(Ks,{isRenderable:!0,ignoreBorder:!0});fr(this,to,null)}render(){this.container.classList.add("circleAnnotation");const Ks=this.data,{width:lr,height:yr}=ps(Ks.rect),wr=this.svgFactory.create(lr,yr,!0),Cr=Ks.borderStyle.width,Tr=jr(this,to,this.svgFactory.createElement("svg:ellipse"));return Tr.setAttribute("cx",lr/2),Tr.setAttribute("cy",yr/2),Tr.setAttribute("rx",lr/2-Cr/2),Tr.setAttribute("ry",yr/2-Cr/2),Tr.setAttribute("stroke-width",Cr||1),Tr.setAttribute("stroke","transparent"),Tr.setAttribute("fill","transparent"),wr.append(Tr),this.container.append(wr),!Ks.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return As(this,to)}addHighlightArea(){this.container.classList.add("highlightArea")}}to=new WeakMap;class zs extends xs{constructor(Ks){super(Ks,{isRenderable:!0,ignoreBorder:!0});fr(this,_r,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const Ks=this.data,{width:lr,height:yr}=ps(Ks.rect),wr=this.svgFactory.create(lr,yr,!0);let Cr=[];for(const Hr of Ks.vertices){const Fr=Hr.x-Ks.rect[0],Lr=Ks.rect[3]-Hr.y;Cr.push(Fr+","+Lr)}Cr=Cr.join(" ");const Tr=jr(this,_r,this.svgFactory.createElement(this.svgElementName));return Tr.setAttribute("points",Cr),Tr.setAttribute("stroke-width",Ks.borderStyle.width||1),Tr.setAttribute("stroke","transparent"),Tr.setAttribute("fill","transparent"),wr.append(Tr),this.container.append(wr),!Ks.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return As(this,_r)}addHighlightArea(){this.container.classList.add("highlightArea")}}_r=new WeakMap;class qs extends zs{constructor(Xs){super(Xs),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Qs extends xs{constructor(Xs){super(Xs,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Ys extends xs{constructor(Ks){super(Ks,{isRenderable:!0,ignoreBorder:!0});fr(this,gr,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=rs.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const Ks=this.data,{width:lr,height:yr}=ps(Ks.rect),wr=this.svgFactory.create(lr,yr,!0);for(const Cr of Ks.inkLists){let Tr=[];for(const Fr of Cr){const Lr=Fr.x-Ks.rect[0],qr=Ks.rect[3]-Fr.y;Tr.push(`${Lr},${qr}`)}Tr=Tr.join(" ");const Hr=this.svgFactory.createElement(this.svgElementName);As(this,gr).push(Hr),Hr.setAttribute("points",Tr),Hr.setAttribute("stroke-width",Ks.borderStyle.width||1),Hr.setAttribute("stroke","transparent"),Hr.setAttribute("fill","transparent"),!Ks.popupRef&&this.hasPopupData&&this._createPopup(),wr.append(Hr)}return this.container.append(wr),this.container}getElementsToTriggerPopup(){return As(this,gr)}addHighlightArea(){this.container.classList.add("highlightArea")}}gr=new WeakMap,ts.InkAnnotationElement=Ys;class Ws extends xs{constructor(Xs){super(Xs,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class Is extends xs{constructor(Xs){super(Xs,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Bs extends xs{constructor(Xs){super(Xs,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Vs extends xs{constructor(Xs){super(Xs,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Ds extends xs{constructor(Xs){super(Xs,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}ts.StampAnnotationElement=Ds;class Cs extends xs{constructor(Ks){var wr;super(Ks,{isRenderable:!0});fr(this,Or);fr(this,vr,null);const{filename:lr,content:yr}=this.data.file;this.filename=(0,ns.getFilenameFromUrl)(lr,!0),this.content=yr,(wr=this.linkService.eventBus)==null||wr.dispatch("fileattachmentannotation",{source:this,filename:lr,content:yr})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:Ks,data:lr}=this;let yr;lr.hasAppearance||lr.fillAlpha===0?yr=document.createElement("div"):(yr=document.createElement("img"),yr.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(lr.name)?"paperclip":"pushpin"}.svg`,lr.fillAlpha&&lr.fillAlpha<1&&(yr.style=`filter: opacity(${Math.round(lr.fillAlpha*100)}%);`)),yr.addEventListener("dblclick",pr(this,Or,wl).bind(this)),jr(this,vr,yr);const{isMac:wr}=rs.FeatureTest.platform;return Ks.addEventListener("keydown",Cr=>{Cr.key==="Enter"&&(wr?Cr.metaKey:Cr.ctrlKey)&&pr(this,Or,wl).call(this)}),!lr.popupRef&&this.hasPopupData?this._createPopup():yr.classList.add("popupTriggerArea"),Ks.append(yr),Ks}getElementsToTriggerPopup(){return As(this,vr)}addHighlightArea(){this.container.classList.add("highlightArea")}}vr=new WeakMap,Or=new WeakSet,wl=function(){var Ks;(Ks=this.downloadManager)==null||Ks.openOrDownloadData(this.container,this.content,this.filename)};class Ts{constructor({div:Xs,accessibilityManager:Ks,annotationCanvasMap:lr,l10n:yr,page:wr,viewport:Cr}){fr(this,Mr);fr(this,Jr,null);fr(this,or,null);fr(this,Sr,new Map);this.div=Xs,jr(this,Jr,Ks),jr(this,or,lr),this.l10n=yr,this.page=wr,this.viewport=Cr,this.zIndex=0,this.l10n||(this.l10n=ls.NullL10n)}async render(Xs){const{annotations:Ks}=Xs,lr=this.div;(0,ns.setLayerDimensions)(lr,this.viewport);const yr=new Map,wr={data:null,layer:lr,linkService:Xs.linkService,downloadManager:Xs.downloadManager,imageResourcesPath:Xs.imageResourcesPath||"",renderForms:Xs.renderForms!==!1,svgFactory:new ns.DOMSVGFactory,annotationStorage:Xs.annotationStorage||new os.AnnotationStorage,enableScripting:Xs.enableScripting===!0,hasJSActions:Xs.hasJSActions,fieldObjects:Xs.fieldObjects,parent:this,elements:null};for(const Cr of Ks){if(Cr.noHTML)continue;const Tr=Cr.annotationType===rs.AnnotationType.POPUP;if(Tr){const Lr=yr.get(Cr.id);if(!Lr)continue;wr.elements=Lr}else{const{width:Lr,height:qr}=ps(Cr.rect);if(Lr<=0||qr<=0)continue}wr.data=Cr;const Hr=hs.create(wr);if(!Hr.isRenderable)continue;if(!Tr&&Cr.popupRef){const Lr=yr.get(Cr.popupRef);Lr?Lr.push(Hr):yr.set(Cr.popupRef,[Hr])}Hr.annotationEditorType>0&&As(this,Sr).set(Hr.data.id,Hr);const Fr=Hr.render();Cr.hidden&&(Fr.style.visibility="hidden"),pr(this,Mr,eu).call(this,Fr,Cr.id)}pr(this,Mr,Sl).call(this),await this.l10n.translate(lr)}update({viewport:Xs}){const Ks=this.div;this.viewport=Xs,(0,ns.setLayerDimensions)(Ks,{rotation:Xs.rotation}),pr(this,Mr,Sl).call(this),Ks.hidden=!1}getEditableAnnotations(){return Array.from(As(this,Sr).values())}getEditableAnnotation(Xs){return As(this,Sr).get(Xs)}}Jr=new WeakMap,or=new WeakMap,Sr=new WeakMap,Mr=new WeakSet,eu=function(Xs,Ks){var yr;const lr=Xs.firstChild||Xs;lr.id=`${rs.AnnotationPrefix}${Ks}`,this.div.append(Xs),(yr=As(this,Jr))==null||yr.moveElementInDOM(this.div,Xs,lr,!1)},Sl=function(){if(!As(this,or))return;const Xs=this.div;for(const[Ks,lr]of As(this,or)){const yr=Xs.querySelector(`[data-annotation-id="${Ks}"]`);if(!yr)continue;const{firstChild:wr}=yr;wr?wr.nodeName==="CANVAS"?wr.replaceWith(lr):wr.before(lr):yr.append(lr)}As(this,or).clear()},ts.AnnotationLayer=Ts},(es,ts)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.ColorConverters=void 0;function ss(os){return Math.floor(Math.max(0,Math.min(1,os))*255).toString(16).padStart(2,"0")}function rs(os){return Math.max(0,Math.min(255,255*os))}class ns{static CMYK_G([as,ls,cs,us]){return["G",1-Math.min(1,.3*as+.59*cs+.11*ls+us)]}static G_CMYK([as]){return["CMYK",0,0,0,1-as]}static G_RGB([as]){return["RGB",as,as,as]}static G_rgb([as]){return as=rs(as),[as,as,as]}static G_HTML([as]){const ls=ss(as);return`#${ls}${ls}${ls}`}static RGB_G([as,ls,cs]){return["G",.3*as+.59*ls+.11*cs]}static RGB_rgb(as){return as.map(rs)}static RGB_HTML(as){return`#${as.map(ss).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([as,ls,cs,us]){return["RGB",1-Math.min(1,as+us),1-Math.min(1,cs+us),1-Math.min(1,ls+us)]}static CMYK_rgb([as,ls,cs,us]){return[rs(1-Math.min(1,as+us)),rs(1-Math.min(1,cs+us)),rs(1-Math.min(1,ls+us))]}static CMYK_HTML(as){const ls=this.CMYK_RGB(as).slice(1);return this.RGB_HTML(ls)}static RGB_CMYK([as,ls,cs]){const us=1-as,ds=1-ls,ms=1-cs,ps=Math.min(us,ds,ms);return["CMYK",us,ds,ms,ps]}}ts.ColorConverters=ns},(es,ts)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.NullL10n=void 0,ts.getL10nFallback=rs;const ss={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}}  {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}}  {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};ss.print_progress_percent="{{progress}}%";function rs(as,ls){switch(as){case"find_match_count":as=`find_match_count[${ls.total===1?"one":"other"}]`;break;case"find_match_count_limit":as=`find_match_count_limit[${ls.limit===1?"one":"other"}]`;break}return ss[as]||""}function ns(as,ls){return ls?as.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(cs,us)=>us in ls?ls[us]:"{{"+us+"}}"):as}const os={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(as,ls=null,cs=rs(as,ls)){return ns(cs,ls)},async translate(as){}};ts.NullL10n=os},(es,ts,ss)=>{Object.defineProperty(ts,"__esModule",{value:!0}),ts.XfaLayer=void 0;var rs=ss(25);class ns{static setupStorage(as,ls,cs,us,ds){const ms=us.getValue(ls,{value:null});switch(cs.name){case"textarea":if(ms.value!==null&&(as.textContent=ms.value),ds==="print")break;as.addEventListener("input",ps=>{us.setValue(ls,{value:ps.target.value})});break;case"input":if(cs.attributes.type==="radio"||cs.attributes.type==="checkbox"){if(ms.value===cs.attributes.xfaOn?as.setAttribute("checked",!0):ms.value===cs.attributes.xfaOff&&as.removeAttribute("checked"),ds==="print")break;as.addEventListener("change",ps=>{us.setValue(ls,{value:ps.target.checked?ps.target.getAttribute("xfaOn"):ps.target.getAttribute("xfaOff")})})}else{if(ms.value!==null&&as.setAttribute("value",ms.value),ds==="print")break;as.addEventListener("input",ps=>{us.setValue(ls,{value:ps.target.value})})}break;case"select":if(ms.value!==null){as.setAttribute("value",ms.value);for(const ps of cs.children)ps.attributes.value===ms.value?ps.attributes.selected=!0:ps.attributes.hasOwnProperty("selected")&&delete ps.attributes.selected}as.addEventListener("input",ps=>{const hs=ps.target.options,xs=hs.selectedIndex===-1?"":hs[hs.selectedIndex].value;us.setValue(ls,{value:xs})});break}}static setAttributes({html:as,element:ls,storage:cs=null,intent:us,linkService:ds}){const{attributes:ms}=ls,ps=as instanceof HTMLAnchorElement;ms.type==="radio"&&(ms.name=`${ms.name}-${us}`);for(const[hs,xs]of Object.entries(ms))if(xs!=null)switch(hs){case"class":xs.length&&as.setAttribute(hs,xs.join(" "));break;case"dataId":break;case"id":as.setAttribute("data-element-id",xs);break;case"style":Object.assign(as.style,xs);break;case"textContent":as.textContent=xs;break;default:(!ps||hs!=="href"&&hs!=="newWindow")&&as.setAttribute(hs,xs)}ps&&ds.addLinkAttributes(as,ms.href,ms.newWindow),cs&&ms.dataId&&this.setupStorage(as,ms.dataId,ls,cs)}static render(as){var ys;const ls=as.annotationStorage,cs=as.linkService,us=as.xfaHtml,ds=as.intent||"display",ms=document.createElement(us.name);us.attributes&&this.setAttributes({html:ms,element:us,intent:ds,linkService:cs});const ps=[[us,-1,ms]],hs=as.div;if(hs.append(ms),as.viewport){const vs=`matrix(${as.viewport.transform.join(",")})`;hs.style.transform=vs}ds!=="richText"&&hs.setAttribute("class","xfaLayer xfaFont");const xs=[];for(;ps.length>0;){const[vs,gs,fs]=ps.at(-1);if(gs+1===vs.children.length){ps.pop();continue}const js=vs.children[++ps.at(-1)[1]];if(js===null)continue;const{name:Ss}=js;if(Ss==="#text"){const Es=document.createTextNode(js.value);xs.push(Es),fs.append(Es);continue}const bs=(ys=js==null?void 0:js.attributes)!=null&&ys.xmlns?document.createElementNS(js.attributes.xmlns,Ss):document.createElement(Ss);if(fs.append(bs),js.attributes&&this.setAttributes({html:bs,element:js,storage:ls,intent:ds,linkService:cs}),js.children&&js.children.length>0)ps.push([js,-1,bs]);else if(js.value){const Es=document.createTextNode(js.value);rs.XfaText.shouldBuildText(Ss)&&xs.push(Es),bs.append(Es)}}for(const vs of hs.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))vs.setAttribute("readOnly",!0);return{textDivs:xs}}static update(as){const ls=`matrix(${as.viewport.transform.join(",")})`;as.div.style.transform=ls,as.div.hidden=!1}}ts.XfaLayer=ns},(es,ts,ss)=>{var us,ds,ms,ps,hs,xs,ys,vs,gs,fs,js,Ss,bs,Es,Rs,tu,su,ru,nu,Nl,iu,Cl,ou,au,lu,cu,uu,ao,_l,Mo,Lo,xo,Al,Do,Fs,du,Tl,hu,pu,Pl,Io,fo;Object.defineProperty(ts,"__esModule",{value:!0}),ts.InkEditor=void 0;var rs=ss(1),ns=ss(4),os=ss(29),as=ss(6),ls=ss(5);const kr=class kr extends ns.AnnotationEditor{constructor(Ms){super({...Ms,name:"inkEditor"});fr(this,Rs);fr(this,us,0);fr(this,ds,0);fr(this,ms,this.canvasPointermove.bind(this));fr(this,ps,this.canvasPointerleave.bind(this));fr(this,hs,this.canvasPointerup.bind(this));fr(this,xs,this.canvasPointerdown.bind(this));fr(this,ys,new Path2D);fr(this,vs,!1);fr(this,gs,!1);fr(this,fs,!1);fr(this,js,null);fr(this,Ss,0);fr(this,bs,0);fr(this,Es,null);this.color=Ms.color||null,this.thickness=Ms.thickness||null,this.opacity=Ms.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(Ms){ns.AnnotationEditor.initialize(Ms,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(Ms,Hs){switch(Ms){case rs.AnnotationEditorParamsType.INK_THICKNESS:kr._defaultThickness=Hs;break;case rs.AnnotationEditorParamsType.INK_COLOR:kr._defaultColor=Hs;break;case rs.AnnotationEditorParamsType.INK_OPACITY:kr._defaultOpacity=Hs/100;break}}updateParams(Ms,Hs){switch(Ms){case rs.AnnotationEditorParamsType.INK_THICKNESS:pr(this,Rs,tu).call(this,Hs);break;case rs.AnnotationEditorParamsType.INK_COLOR:pr(this,Rs,su).call(this,Hs);break;case rs.AnnotationEditorParamsType.INK_OPACITY:pr(this,Rs,ru).call(this,Hs);break}}static get defaultPropertiesToUpdate(){return[[rs.AnnotationEditorParamsType.INK_THICKNESS,kr._defaultThickness],[rs.AnnotationEditorParamsType.INK_COLOR,kr._defaultColor||ns.AnnotationEditor._defaultLineColor],[rs.AnnotationEditorParamsType.INK_OPACITY,Math.round(kr._defaultOpacity*100)]]}get propertiesToUpdate(){return[[rs.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||kr._defaultThickness],[rs.AnnotationEditorParamsType.INK_COLOR,this.color||kr._defaultColor||ns.AnnotationEditor._defaultLineColor],[rs.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??kr._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(pr(this,Rs,Mo).call(this),pr(this,Rs,Lo).call(this)),this.isAttachedToDOM||(this.parent.add(this),pr(this,Rs,xo).call(this)),pr(this,Rs,fo).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,As(this,js).disconnect(),jr(this,js,null),super.remove())}setParent(Ms){!this.parent&&Ms?this._uiManager.removeShouldRescale(this):this.parent&&Ms===null&&this._uiManager.addShouldRescale(this),super.setParent(Ms)}onScaleChanging(){const[Ms,Hs]=this.parentDimensions,Js=this.width*Ms,Zs=this.height*Hs;this.setDimensions(Js,Zs)}enableEditMode(){As(this,vs)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",As(this,xs)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",As(this,xs)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){As(this,vs)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),jr(this,vs,!0),this.div.classList.add("disabled"),pr(this,Rs,fo).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(Ms){this._focusEventsAllowed&&(super.focusin(Ms),this.enableEditMode())}canvasPointerdown(Ms){Ms.button!==0||!this.isInEditMode()||As(this,vs)||(this.setInForeground(),Ms.preventDefault(),Ms.type!=="mouse"&&this.div.focus(),pr(this,Rs,iu).call(this,Ms.offsetX,Ms.offsetY))}canvasPointermove(Ms){Ms.preventDefault(),pr(this,Rs,Cl).call(this,Ms.offsetX,Ms.offsetY)}canvasPointerup(Ms){Ms.preventDefault(),pr(this,Rs,_l).call(this,Ms)}canvasPointerleave(Ms){pr(this,Rs,_l).call(this,Ms)}get isResizable(){return!this.isEmpty()&&As(this,vs)}render(){if(this.div)return this.div;let Ms,Hs;this.width&&(Ms=this.x,Hs=this.y),super.render(),ns.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(Rr=>{var ar;return(ar=this.div)==null?void 0:ar.setAttribute("aria-label",Rr)});const[Js,Zs,dr,br]=pr(this,Rs,nu).call(this);if(this.setAt(Js,Zs,0,0),this.setDims(dr,br),pr(this,Rs,Mo).call(this),this.width){const[Rr,ar]=this.parentDimensions;this.setAspectRatio(this.width*Rr,this.height*ar),this.setAt(Ms*Rr,Hs*ar,this.width*Rr,this.height*ar),jr(this,fs,!0),pr(this,Rs,xo).call(this),this.setDims(this.width*Rr,this.height*ar),pr(this,Rs,ao).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return pr(this,Rs,Lo).call(this),this.div}setDimensions(Ms,Hs){const Js=Math.round(Ms),Zs=Math.round(Hs);if(As(this,Ss)===Js&&As(this,bs)===Zs)return;jr(this,Ss,Js),jr(this,bs,Zs),this.canvas.style.visibility="hidden";const[dr,br]=this.parentDimensions;this.width=Ms/dr,this.height=Hs/br,this.fixAndSetPosition(),As(this,vs)&&pr(this,Rs,Al).call(this,Ms,Hs),pr(this,Rs,xo).call(this),pr(this,Rs,ao).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(Ms,Hs,Js){var Vr,Zr,to;if(Ms instanceof os.InkAnnotationElement)return null;const Zs=super.deserialize(Ms,Hs,Js);Zs.thickness=Ms.thickness,Zs.color=rs.Util.makeHexColor(...Ms.color),Zs.opacity=Ms.opacity;const[dr,br]=Zs.pageDimensions,Rr=Zs.width*dr,ar=Zs.height*br,Pr=Zs.parentScale,Ar=Ms.thickness/2;jr(Zs,vs,!0),jr(Zs,Ss,Math.round(Rr)),jr(Zs,bs,Math.round(ar));const{paths:Gr,rect:Dr,rotation:Yr}=Ms;for(let{bezier:_r}of Gr){_r=pr(Vr=kr,Fs,hu).call(Vr,_r,Dr,Yr);const gr=[];Zs.paths.push(gr);let vr=Pr*(_r[0]-Ar),Or=Pr*(_r[1]-Ar);for(let Jr=2,or=_r.length;Jr<or;Jr+=6){const Sr=Pr*(_r[Jr]-Ar),Mr=Pr*(_r[Jr+1]-Ar),Ur=Pr*(_r[Jr+2]-Ar),zr=Pr*(_r[Jr+3]-Ar),Ir=Pr*(_r[Jr+4]-Ar),Xs=Pr*(_r[Jr+5]-Ar);gr.push([[vr,Or],[Sr,Mr],[Ur,zr],[Ir,Xs]]),vr=Ir,Or=Xs}const Qr=pr(this,Fs,du).call(this,gr);Zs.bezierPath2D.push(Qr)}const $r=pr(Zr=Zs,Rs,Pl).call(Zr);return jr(Zs,ds,Math.max(ns.AnnotationEditor.MIN_SIZE,$r[2]-$r[0])),jr(Zs,us,Math.max(ns.AnnotationEditor.MIN_SIZE,$r[3]-$r[1])),pr(to=Zs,Rs,Al).call(to,Rr,ar),Zs}serialize(){if(this.isEmpty())return null;const Ms=this.getRect(0,0),Hs=ns.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:rs.AnnotationEditorType.INK,color:Hs,thickness:this.thickness,opacity:this.opacity,paths:pr(this,Rs,pu).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,Ms),pageIndex:this.pageIndex,rect:Ms,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};us=new WeakMap,ds=new WeakMap,ms=new WeakMap,ps=new WeakMap,hs=new WeakMap,xs=new WeakMap,ys=new WeakMap,vs=new WeakMap,gs=new WeakMap,fs=new WeakMap,js=new WeakMap,Ss=new WeakMap,bs=new WeakMap,Es=new WeakMap,Rs=new WeakSet,tu=function(Ms){const Hs=this.thickness;this.addCommands({cmd:()=>{this.thickness=Ms,pr(this,Rs,fo).call(this)},undo:()=>{this.thickness=Hs,pr(this,Rs,fo).call(this)},mustExec:!0,type:rs.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},su=function(Ms){const Hs=this.color;this.addCommands({cmd:()=>{this.color=Ms,pr(this,Rs,ao).call(this)},undo:()=>{this.color=Hs,pr(this,Rs,ao).call(this)},mustExec:!0,type:rs.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},ru=function(Ms){Ms/=100;const Hs=this.opacity;this.addCommands({cmd:()=>{this.opacity=Ms,pr(this,Rs,ao).call(this)},undo:()=>{this.opacity=Hs,pr(this,Rs,ao).call(this)},mustExec:!0,type:rs.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},nu=function(){const{parentRotation:Ms,parentDimensions:[Hs,Js]}=this;switch(Ms){case 90:return[0,Js,Js,Hs];case 180:return[Hs,Js,Hs,Js];case 270:return[Hs,0,Js,Hs];default:return[0,0,Hs,Js]}},Nl=function(){const{ctx:Ms,color:Hs,opacity:Js,thickness:Zs,parentScale:dr,scaleFactor:br}=this;Ms.lineWidth=Zs*dr/br,Ms.lineCap="round",Ms.lineJoin="round",Ms.miterLimit=10,Ms.strokeStyle=`${Hs}${(0,ls.opacityToHex)(Js)}`},iu=function(Ms,Hs){this.canvas.addEventListener("contextmenu",as.noContextMenu),this.canvas.addEventListener("pointerleave",As(this,ps)),this.canvas.addEventListener("pointermove",As(this,ms)),this.canvas.addEventListener("pointerup",As(this,hs)),this.canvas.removeEventListener("pointerdown",As(this,xs)),this.isEditing=!0,As(this,fs)||(jr(this,fs,!0),pr(this,Rs,xo).call(this),this.thickness||(this.thickness=kr._defaultThickness),this.color||(this.color=kr._defaultColor||ns.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=kr._defaultOpacity)),this.currentPath.push([Ms,Hs]),jr(this,gs,!1),pr(this,Rs,Nl).call(this),jr(this,Es,()=>{pr(this,Rs,lu).call(this),As(this,Es)&&window.requestAnimationFrame(As(this,Es))}),window.requestAnimationFrame(As(this,Es))},Cl=function(Ms,Hs){const[Js,Zs]=this.currentPath.at(-1);if(this.currentPath.length>1&&Ms===Js&&Hs===Zs)return;const dr=this.currentPath;let br=As(this,ys);if(dr.push([Ms,Hs]),jr(this,gs,!0),dr.length<=2){br.moveTo(...dr[0]),br.lineTo(Ms,Hs);return}dr.length===3&&(jr(this,ys,br=new Path2D),br.moveTo(...dr[0])),pr(this,Rs,cu).call(this,br,...dr.at(-3),...dr.at(-2),Ms,Hs)},ou=function(){if(this.currentPath.length===0)return;const Ms=this.currentPath.at(-1);As(this,ys).lineTo(...Ms)},au=function(Ms,Hs){jr(this,Es,null),Ms=Math.min(Math.max(Ms,0),this.canvas.width),Hs=Math.min(Math.max(Hs,0),this.canvas.height),pr(this,Rs,Cl).call(this,Ms,Hs),pr(this,Rs,ou).call(this);let Js;if(this.currentPath.length!==1)Js=pr(this,Rs,uu).call(this);else{const ar=[Ms,Hs];Js=[[ar,ar.slice(),ar.slice(),ar]]}const Zs=As(this,ys),dr=this.currentPath;this.currentPath=[],jr(this,ys,new Path2D);const br=()=>{this.allRawPaths.push(dr),this.paths.push(Js),this.bezierPath2D.push(Zs),this.rebuild()},Rr=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(pr(this,Rs,Mo).call(this),pr(this,Rs,Lo).call(this)),pr(this,Rs,fo).call(this))};this.addCommands({cmd:br,undo:Rr,mustExec:!0})},lu=function(){if(!As(this,gs))return;jr(this,gs,!1);const Ms=Math.ceil(this.thickness*this.parentScale),Hs=this.currentPath.slice(-3),Js=Hs.map(br=>br[0]),Zs=Hs.map(br=>br[1]);Math.min(...Js)-Ms,Math.max(...Js)+Ms,Math.min(...Zs)-Ms,Math.max(...Zs)+Ms;const{ctx:dr}=this;dr.save(),dr.clearRect(0,0,this.canvas.width,this.canvas.height);for(const br of this.bezierPath2D)dr.stroke(br);dr.stroke(As(this,ys)),dr.restore()},cu=function(Ms,Hs,Js,Zs,dr,br,Rr){const ar=(Hs+Zs)/2,Pr=(Js+dr)/2,Ar=(Zs+br)/2,Gr=(dr+Rr)/2;Ms.bezierCurveTo(ar+2*(Zs-ar)/3,Pr+2*(dr-Pr)/3,Ar+2*(Zs-Ar)/3,Gr+2*(dr-Gr)/3,Ar,Gr)},uu=function(){const Ms=this.currentPath;if(Ms.length<=2)return[[Ms[0],Ms[0],Ms.at(-1),Ms.at(-1)]];const Hs=[];let Js,[Zs,dr]=Ms[0];for(Js=1;Js<Ms.length-2;Js++){const[Dr,Yr]=Ms[Js],[$r,Vr]=Ms[Js+1],Zr=(Dr+$r)/2,to=(Yr+Vr)/2,_r=[Zs+2*(Dr-Zs)/3,dr+2*(Yr-dr)/3],gr=[Zr+2*(Dr-Zr)/3,to+2*(Yr-to)/3];Hs.push([[Zs,dr],_r,gr,[Zr,to]]),[Zs,dr]=[Zr,to]}const[br,Rr]=Ms[Js],[ar,Pr]=Ms[Js+1],Ar=[Zs+2*(br-Zs)/3,dr+2*(Rr-dr)/3],Gr=[ar+2*(br-ar)/3,Pr+2*(Rr-Pr)/3];return Hs.push([[Zs,dr],Ar,Gr,[ar,Pr]]),Hs},ao=function(){if(this.isEmpty()){pr(this,Rs,Do).call(this);return}pr(this,Rs,Nl).call(this);const{canvas:Ms,ctx:Hs}=this;Hs.setTransform(1,0,0,1,0,0),Hs.clearRect(0,0,Ms.width,Ms.height),pr(this,Rs,Do).call(this);for(const Js of this.bezierPath2D)Hs.stroke(Js)},_l=function(Ms){this.canvas.removeEventListener("pointerleave",As(this,ps)),this.canvas.removeEventListener("pointermove",As(this,ms)),this.canvas.removeEventListener("pointerup",As(this,hs)),this.canvas.addEventListener("pointerdown",As(this,xs)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",as.noContextMenu)},10),pr(this,Rs,au).call(this,Ms.offsetX,Ms.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Mo=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",ns.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(Ms=>{var Hs;return(Hs=this.canvas)==null?void 0:Hs.setAttribute("aria-label",Ms)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Lo=function(){jr(this,js,new ResizeObserver(Ms=>{const Hs=Ms[0].contentRect;Hs.width&&Hs.height&&this.setDimensions(Hs.width,Hs.height)})),As(this,js).observe(this.div)},xo=function(){if(!As(this,fs))return;const[Ms,Hs]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*Ms),this.canvas.height=Math.ceil(this.height*Hs),pr(this,Rs,Do).call(this)},Al=function(Ms,Hs){const Js=pr(this,Rs,Io).call(this),Zs=(Ms-Js)/As(this,ds),dr=(Hs-Js)/As(this,us);this.scaleFactor=Math.min(Zs,dr)},Do=function(){const Ms=pr(this,Rs,Io).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+Ms,this.translationY*this.scaleFactor+Ms)},Fs=new WeakSet,du=function(Ms){const Hs=new Path2D;for(let Js=0,Zs=Ms.length;Js<Zs;Js++){const[dr,br,Rr,ar]=Ms[Js];Js===0&&Hs.moveTo(...dr),Hs.bezierCurveTo(br[0],br[1],Rr[0],Rr[1],ar[0],ar[1])}return Hs},Tl=function(Ms,Hs,Js){const[Zs,dr,br,Rr]=Hs;switch(Js){case 0:for(let ar=0,Pr=Ms.length;ar<Pr;ar+=2)Ms[ar]+=Zs,Ms[ar+1]=Rr-Ms[ar+1];break;case 90:for(let ar=0,Pr=Ms.length;ar<Pr;ar+=2){const Ar=Ms[ar];Ms[ar]=Ms[ar+1]+Zs,Ms[ar+1]=Ar+dr}break;case 180:for(let ar=0,Pr=Ms.length;ar<Pr;ar+=2)Ms[ar]=br-Ms[ar],Ms[ar+1]+=dr;break;case 270:for(let ar=0,Pr=Ms.length;ar<Pr;ar+=2){const Ar=Ms[ar];Ms[ar]=br-Ms[ar+1],Ms[ar+1]=Rr-Ar}break;default:throw new Error("Invalid rotation")}return Ms},hu=function(Ms,Hs,Js){const[Zs,dr,br,Rr]=Hs;switch(Js){case 0:for(let ar=0,Pr=Ms.length;ar<Pr;ar+=2)Ms[ar]-=Zs,Ms[ar+1]=Rr-Ms[ar+1];break;case 90:for(let ar=0,Pr=Ms.length;ar<Pr;ar+=2){const Ar=Ms[ar];Ms[ar]=Ms[ar+1]-dr,Ms[ar+1]=Ar-Zs}break;case 180:for(let ar=0,Pr=Ms.length;ar<Pr;ar+=2)Ms[ar]=br-Ms[ar],Ms[ar+1]-=dr;break;case 270:for(let ar=0,Pr=Ms.length;ar<Pr;ar+=2){const Ar=Ms[ar];Ms[ar]=Rr-Ms[ar+1],Ms[ar+1]=br-Ar}break;default:throw new Error("Invalid rotation")}return Ms},pu=function(Ms,Hs,Js,Zs){var Pr,Ar;const dr=[],br=this.thickness/2,Rr=Ms*Hs+br,ar=Ms*Js+br;for(const Gr of this.paths){const Dr=[],Yr=[];for(let $r=0,Vr=Gr.length;$r<Vr;$r++){const[Zr,to,_r,gr]=Gr[$r],vr=Ms*Zr[0]+Rr,Or=Ms*Zr[1]+ar,Qr=Ms*to[0]+Rr,Jr=Ms*to[1]+ar,or=Ms*_r[0]+Rr,Sr=Ms*_r[1]+ar,Mr=Ms*gr[0]+Rr,Ur=Ms*gr[1]+ar;$r===0&&(Dr.push(vr,Or),Yr.push(vr,Or)),Dr.push(Qr,Jr,or,Sr,Mr,Ur),Yr.push(Qr,Jr),$r===Vr-1&&Yr.push(Mr,Ur)}dr.push({bezier:pr(Pr=kr,Fs,Tl).call(Pr,Dr,Zs,this.rotation),points:pr(Ar=kr,Fs,Tl).call(Ar,Yr,Zs,this.rotation)})}return dr},Pl=function(){let Ms=1/0,Hs=-1/0,Js=1/0,Zs=-1/0;for(const dr of this.paths)for(const[br,Rr,ar,Pr]of dr){const Ar=rs.Util.bezierBoundingBox(...br,...Rr,...ar,...Pr);Ms=Math.min(Ms,Ar[0]),Js=Math.min(Js,Ar[1]),Hs=Math.max(Hs,Ar[2]),Zs=Math.max(Zs,Ar[3])}return[Ms,Js,Hs,Zs]},Io=function(){return As(this,vs)?Math.ceil(this.thickness*this.parentScale):0},fo=function(Ms=!1){if(this.isEmpty())return;if(!As(this,vs)){pr(this,Rs,ao).call(this);return}const Hs=pr(this,Rs,Pl).call(this),Js=pr(this,Rs,Io).call(this);jr(this,ds,Math.max(ns.AnnotationEditor.MIN_SIZE,Hs[2]-Hs[0])),jr(this,us,Math.max(ns.AnnotationEditor.MIN_SIZE,Hs[3]-Hs[1]));const Zs=Math.ceil(Js+As(this,ds)*this.scaleFactor),dr=Math.ceil(Js+As(this,us)*this.scaleFactor),[br,Rr]=this.parentDimensions;this.width=Zs/br,this.height=dr/Rr,this.setAspectRatio(Zs,dr);const ar=this.translationX,Pr=this.translationY;this.translationX=-Hs[0],this.translationY=-Hs[1],pr(this,Rs,xo).call(this),pr(this,Rs,ao).call(this),jr(this,Ss,Zs),jr(this,bs,dr),this.setDims(Zs,dr);const Ar=Ms?Js/this.scaleFactor/2:0;this.translate(ar-this.translationX-Ar,Pr-this.translationY-Ar)},fr(kr,Fs),eo(kr,"_defaultColor",null),eo(kr,"_defaultOpacity",1),eo(kr,"_defaultThickness",1),eo(kr,"_type","ink");let cs=kr;ts.InkEditor=cs},(es,ts,ss)=>{var cs,us,ds,ms,ps,hs,xs,ys,vs,gs,fs,Ro,wo,Oo,Ml,mu,xu,Ll,$o,fu;Object.defineProperty(ts,"__esModule",{value:!0}),ts.StampEditor=void 0;var rs=ss(1),ns=ss(4),os=ss(6),as=ss(29);const Ls=class Ls extends ns.AnnotationEditor{constructor(qs){super({...qs,name:"stampEditor"});fr(this,fs);fr(this,cs,null);fr(this,us,null);fr(this,ds,null);fr(this,ms,null);fr(this,ps,null);fr(this,hs,null);fr(this,xs,null);fr(this,ys,null);fr(this,vs,!1);fr(this,gs,!1);jr(this,ms,qs.bitmapUrl),jr(this,ps,qs.bitmapFile)}static initialize(qs){ns.AnnotationEditor.initialize(qs)}static get supportedTypes(){const qs=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,rs.shadow)(this,"supportedTypes",qs.map(Qs=>`image/${Qs}`))}static get supportedTypesStr(){return(0,rs.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(qs){return this.supportedTypes.includes(qs)}static paste(qs,Qs){Qs.pasteEditor(rs.AnnotationEditorType.STAMP,{bitmapFile:qs.getAsFile()})}remove(){var qs,Qs;As(this,us)&&(jr(this,cs,null),this._uiManager.imageManager.deleteId(As(this,us)),(qs=As(this,hs))==null||qs.remove(),jr(this,hs,null),(Qs=As(this,xs))==null||Qs.disconnect(),jr(this,xs,null)),super.remove()}rebuild(){if(!this.parent){As(this,us)&&pr(this,fs,Oo).call(this);return}super.rebuild(),this.div!==null&&(As(this,us)&&pr(this,fs,Oo).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(As(this,ds)||As(this,cs)||As(this,ms)||As(this,ps))}get isResizable(){return!0}render(){if(this.div)return this.div;let qs,Qs;if(this.width&&(qs=this.x,Qs=this.y),super.render(),this.div.hidden=!0,As(this,cs)?pr(this,fs,Ml).call(this):pr(this,fs,Oo).call(this),this.width){const[Ys,Ws]=this.parentDimensions;this.setAt(qs*Ys,Qs*Ws,this.width*Ys,this.height*Ws)}return this.div}static deserialize(qs,Qs,Ys){if(qs instanceof as.StampAnnotationElement)return null;const Ws=super.deserialize(qs,Qs,Ys),{rect:Is,bitmapUrl:Bs,bitmapId:Vs,isSvg:Ds,accessibilityData:Cs}=qs;Vs&&Ys.imageManager.isValidId(Vs)?jr(Ws,us,Vs):jr(Ws,ms,Bs),jr(Ws,vs,Ds);const[Ts,$s]=Ws.pageDimensions;return Ws.width=(Is[2]-Is[0])/Ts,Ws.height=(Is[3]-Is[1])/$s,Cs&&(Ws.altTextData=Cs),Ws}serialize(qs=!1,Qs=null){if(this.isEmpty())return null;const Ys={annotationType:rs.AnnotationEditorType.STAMP,bitmapId:As(this,us),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:As(this,vs),structTreeParentId:this._structTreeParentId};if(qs)return Ys.bitmapUrl=pr(this,fs,$o).call(this,!0),Ys.accessibilityData=this.altTextData,Ys;const{decorative:Ws,altText:Is}=this.altTextData;if(!Ws&&Is&&(Ys.accessibilityData={type:"Figure",alt:Is}),Qs===null)return Ys;Qs.stamps||(Qs.stamps=new Map);const Bs=As(this,vs)?(Ys.rect[2]-Ys.rect[0])*(Ys.rect[3]-Ys.rect[1]):null;if(!Qs.stamps.has(As(this,us)))Qs.stamps.set(As(this,us),{area:Bs,serialized:Ys}),Ys.bitmap=pr(this,fs,$o).call(this,!1);else if(As(this,vs)){const Vs=Qs.stamps.get(As(this,us));Bs>Vs.area&&(Vs.area=Bs,Vs.serialized.bitmap.close(),Vs.serialized.bitmap=pr(this,fs,$o).call(this,!1))}return Ys}};cs=new WeakMap,us=new WeakMap,ds=new WeakMap,ms=new WeakMap,ps=new WeakMap,hs=new WeakMap,xs=new WeakMap,ys=new WeakMap,vs=new WeakMap,gs=new WeakMap,fs=new WeakSet,Ro=function(qs,Qs=!1){if(!qs){this.remove();return}jr(this,cs,qs.bitmap),Qs||(jr(this,us,qs.id),jr(this,vs,qs.isSvg)),pr(this,fs,Ml).call(this)},wo=function(){jr(this,ds,null),this._uiManager.enableWaiting(!1),As(this,hs)&&this.div.focus()},Oo=function(){if(As(this,us)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(As(this,us)).then(Qs=>pr(this,fs,Ro).call(this,Qs,!0)).finally(()=>pr(this,fs,wo).call(this));return}if(As(this,ms)){const Qs=As(this,ms);jr(this,ms,null),this._uiManager.enableWaiting(!0),jr(this,ds,this._uiManager.imageManager.getFromUrl(Qs).then(Ys=>pr(this,fs,Ro).call(this,Ys)).finally(()=>pr(this,fs,wo).call(this)));return}if(As(this,ps)){const Qs=As(this,ps);jr(this,ps,null),this._uiManager.enableWaiting(!0),jr(this,ds,this._uiManager.imageManager.getFromFile(Qs).then(Ys=>pr(this,fs,Ro).call(this,Ys)).finally(()=>pr(this,fs,wo).call(this)));return}const qs=document.createElement("input");qs.type="file",qs.accept=Ls.supportedTypesStr,jr(this,ds,new Promise(Qs=>{qs.addEventListener("change",async()=>{if(!qs.files||qs.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const Ys=await this._uiManager.imageManager.getFromFile(qs.files[0]);pr(this,fs,Ro).call(this,Ys)}Qs()}),qs.addEventListener("cancel",()=>{this.remove(),Qs()})}).finally(()=>pr(this,fs,wo).call(this))),qs.click()},Ml=function(){const{div:qs}=this;let{width:Qs,height:Ys}=As(this,cs);const[Ws,Is]=this.pageDimensions,Bs=.75;if(this.width)Qs=this.width*Ws,Ys=this.height*Is;else if(Qs>Bs*Ws||Ys>Bs*Is){const Ts=Math.min(Bs*Ws/Qs,Bs*Is/Ys);Qs*=Ts,Ys*=Ts}const[Vs,Ds]=this.parentDimensions;this.setDims(Qs*Vs/Ws,Ys*Ds/Is),this._uiManager.enableWaiting(!1);const Cs=jr(this,hs,document.createElement("canvas"));qs.append(Cs),qs.hidden=!1,pr(this,fs,Ll).call(this,Qs,Ys),pr(this,fs,fu).call(this),As(this,gs)||(this.parent.addUndoableEditor(this),jr(this,gs,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},mu=function(qs,Qs){var Bs;const[Ys,Ws]=this.parentDimensions;this.width=qs/Ys,this.height=Qs/Ws,this.setDims(qs,Qs),(Bs=this._initialOptions)!=null&&Bs.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,As(this,ys)!==null&&clearTimeout(As(this,ys)),jr(this,ys,setTimeout(()=>{jr(this,ys,null),pr(this,fs,Ll).call(this,qs,Qs)},200))},xu=function(qs,Qs){const{width:Ys,height:Ws}=As(this,cs);let Is=Ys,Bs=Ws,Vs=As(this,cs);for(;Is>2*qs||Bs>2*Qs;){const Ds=Is,Cs=Bs;Is>2*qs&&(Is=Is>=16384?Math.floor(Is/2)-1:Math.ceil(Is/2)),Bs>2*Qs&&(Bs=Bs>=16384?Math.floor(Bs/2)-1:Math.ceil(Bs/2));const Ts=new OffscreenCanvas(Is,Bs);Ts.getContext("2d").drawImage(Vs,0,0,Ds,Cs,0,0,Is,Bs),Vs=Ts.transferToImageBitmap()}return Vs},Ll=function(qs,Qs){qs=Math.ceil(qs),Qs=Math.ceil(Qs);const Ys=As(this,hs);if(!Ys||Ys.width===qs&&Ys.height===Qs)return;Ys.width=qs,Ys.height=Qs;const Ws=As(this,vs)?As(this,cs):pr(this,fs,xu).call(this,qs,Qs),Is=Ys.getContext("2d");Is.filter=this._uiManager.hcmFilter,Is.drawImage(Ws,0,0,Ws.width,Ws.height,0,0,qs,Qs)},$o=function(qs){if(qs){if(As(this,vs)){const Ws=this._uiManager.imageManager.getSvgUrl(As(this,us));if(Ws)return Ws}const Qs=document.createElement("canvas");return{width:Qs.width,height:Qs.height}=As(this,cs),Qs.getContext("2d").drawImage(As(this,cs),0,0),Qs.toDataURL()}if(As(this,vs)){const[Qs,Ys]=this.pageDimensions,Ws=Math.round(this.width*Qs*os.PixelsPerInch.PDF_TO_CSS_UNITS),Is=Math.round(this.height*Ys*os.PixelsPerInch.PDF_TO_CSS_UNITS),Bs=new OffscreenCanvas(Ws,Is);return Bs.getContext("2d").drawImage(As(this,cs),0,0,As(this,cs).width,As(this,cs).height,0,0,Ws,Is),Bs.transferToImageBitmap()}return structuredClone(As(this,cs))},fu=function(){jr(this,xs,new ResizeObserver(qs=>{const Qs=qs[0].contentRect;Qs.width&&Qs.height&&pr(this,fs,mu).call(this,Qs.width,Qs.height)})),As(this,xs).observe(this.div)},eo(Ls,"_type","stamp");let ls=Ls;ts.StampEditor=ls}],__webpack_module_cache__={};function __w_pdfjs_require__(es){var ts=__webpack_module_cache__[es];if(ts!==void 0)return ts.exports;var ss=__webpack_module_cache__[es]={exports:{}};return __webpack_modules__[es](ss,ss.exports,__w_pdfjs_require__),ss.exports}var __webpack_exports__={};return(()=>{var es=__webpack_exports__;Object.defineProperty(es,"__esModule",{value:!0}),Object.defineProperty(es,"AbortException",{enumerable:!0,get:function(){return ts.AbortException}}),Object.defineProperty(es,"AnnotationEditorLayer",{enumerable:!0,get:function(){return os.AnnotationEditorLayer}}),Object.defineProperty(es,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return ts.AnnotationEditorParamsType}}),Object.defineProperty(es,"AnnotationEditorType",{enumerable:!0,get:function(){return ts.AnnotationEditorType}}),Object.defineProperty(es,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return as.AnnotationEditorUIManager}}),Object.defineProperty(es,"AnnotationLayer",{enumerable:!0,get:function(){return ls.AnnotationLayer}}),Object.defineProperty(es,"AnnotationMode",{enumerable:!0,get:function(){return ts.AnnotationMode}}),Object.defineProperty(es,"CMapCompressionType",{enumerable:!0,get:function(){return ts.CMapCompressionType}}),Object.defineProperty(es,"DOMSVGFactory",{enumerable:!0,get:function(){return rs.DOMSVGFactory}}),Object.defineProperty(es,"FeatureTest",{enumerable:!0,get:function(){return ts.FeatureTest}}),Object.defineProperty(es,"GlobalWorkerOptions",{enumerable:!0,get:function(){return cs.GlobalWorkerOptions}}),Object.defineProperty(es,"ImageKind",{enumerable:!0,get:function(){return ts.ImageKind}}),Object.defineProperty(es,"InvalidPDFException",{enumerable:!0,get:function(){return ts.InvalidPDFException}}),Object.defineProperty(es,"MissingPDFException",{enumerable:!0,get:function(){return ts.MissingPDFException}}),Object.defineProperty(es,"OPS",{enumerable:!0,get:function(){return ts.OPS}}),Object.defineProperty(es,"PDFDataRangeTransport",{enumerable:!0,get:function(){return ss.PDFDataRangeTransport}}),Object.defineProperty(es,"PDFDateString",{enumerable:!0,get:function(){return rs.PDFDateString}}),Object.defineProperty(es,"PDFWorker",{enumerable:!0,get:function(){return ss.PDFWorker}}),Object.defineProperty(es,"PasswordResponses",{enumerable:!0,get:function(){return ts.PasswordResponses}}),Object.defineProperty(es,"PermissionFlag",{enumerable:!0,get:function(){return ts.PermissionFlag}}),Object.defineProperty(es,"PixelsPerInch",{enumerable:!0,get:function(){return rs.PixelsPerInch}}),Object.defineProperty(es,"PromiseCapability",{enumerable:!0,get:function(){return ts.PromiseCapability}}),Object.defineProperty(es,"RenderingCancelledException",{enumerable:!0,get:function(){return rs.RenderingCancelledException}}),Object.defineProperty(es,"SVGGraphics",{enumerable:!0,get:function(){return ss.SVGGraphics}}),Object.defineProperty(es,"UnexpectedResponseException",{enumerable:!0,get:function(){return ts.UnexpectedResponseException}}),Object.defineProperty(es,"Util",{enumerable:!0,get:function(){return ts.Util}}),Object.defineProperty(es,"VerbosityLevel",{enumerable:!0,get:function(){return ts.VerbosityLevel}}),Object.defineProperty(es,"XfaLayer",{enumerable:!0,get:function(){return us.XfaLayer}}),Object.defineProperty(es,"build",{enumerable:!0,get:function(){return ss.build}}),Object.defineProperty(es,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return ts.createValidAbsoluteUrl}}),Object.defineProperty(es,"getDocument",{enumerable:!0,get:function(){return ss.getDocument}}),Object.defineProperty(es,"getFilenameFromUrl",{enumerable:!0,get:function(){return rs.getFilenameFromUrl}}),Object.defineProperty(es,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return rs.getPdfFilenameFromUrl}}),Object.defineProperty(es,"getXfaPageViewport",{enumerable:!0,get:function(){return rs.getXfaPageViewport}}),Object.defineProperty(es,"isDataScheme",{enumerable:!0,get:function(){return rs.isDataScheme}}),Object.defineProperty(es,"isPdfFile",{enumerable:!0,get:function(){return rs.isPdfFile}}),Object.defineProperty(es,"loadScript",{enumerable:!0,get:function(){return rs.loadScript}}),Object.defineProperty(es,"noContextMenu",{enumerable:!0,get:function(){return rs.noContextMenu}}),Object.defineProperty(es,"normalizeUnicode",{enumerable:!0,get:function(){return ts.normalizeUnicode}}),Object.defineProperty(es,"renderTextLayer",{enumerable:!0,get:function(){return ns.renderTextLayer}}),Object.defineProperty(es,"setLayerDimensions",{enumerable:!0,get:function(){return rs.setLayerDimensions}}),Object.defineProperty(es,"shadow",{enumerable:!0,get:function(){return ts.shadow}}),Object.defineProperty(es,"updateTextLayer",{enumerable:!0,get:function(){return ns.updateTextLayer}}),Object.defineProperty(es,"version",{enumerable:!0,get:function(){return ss.version}});var ts=__w_pdfjs_require__(1),ss=__w_pdfjs_require__(2),rs=__w_pdfjs_require__(6),ns=__w_pdfjs_require__(26),os=__w_pdfjs_require__(27),as=__w_pdfjs_require__(5),ls=__w_pdfjs_require__(29),cs=__w_pdfjs_require__(14),us=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let es=0;es<256;++es)byteToHex.push((es+256).toString(16).slice(1));function unsafeStringify(es,ts=0){return byteToHex[es[ts+0]]+byteToHex[es[ts+1]]+byteToHex[es[ts+2]]+byteToHex[es[ts+3]]+"-"+byteToHex[es[ts+4]]+byteToHex[es[ts+5]]+"-"+byteToHex[es[ts+6]]+byteToHex[es[ts+7]]+"-"+byteToHex[es[ts+8]]+byteToHex[es[ts+9]]+"-"+byteToHex[es[ts+10]]+byteToHex[es[ts+11]]+byteToHex[es[ts+12]]+byteToHex[es[ts+13]]+byteToHex[es[ts+14]]+byteToHex[es[ts+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(es,ts,ss){if(native.randomUUID&&!es)return native.randomUUID();es=es||{};const rs=es.random||(es.rng||rng)();return rs[6]=rs[6]&15|64,rs[8]=rs[8]&63|128,unsafeStringify(rs)}pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;async function parseScheduleStage1(es){console.time("scheduleParser:stage1");const ts=await new Promise(cs=>{const us=new FileReader;us.onload=()=>cs(us.result),us.readAsDataURL(es)}),ss=await extractTextFromPDF$2(es);console.log("Stage 1: Extracted text length:",ss.length);const rs=extractCastListFast(ss);console.log("Stage 1: Found",rs.length,"cast members");const{totalDays:ns,dayTextBlocks:os}=extractDayCountAndBlocks(ss);console.log("Stage 1: Found",ns,"shooting days");const as=extractMetadata(ss);console.log("Stage 1: Production name:",as.productionName);const ls={id:v4(),productionName:as.productionName,scriptVersion:as.scriptVersion,scheduleVersion:as.scheduleVersion,status:"pending",processingProgress:{current:0,total:ns},castList:rs,days:[],totalDays:ns,uploadedAt:new Date,pdfUri:ts,rawText:ss};return console.timeEnd("scheduleParser:stage1"),{schedule:ls,rawText:ss,dayTextBlocks:os}}function extractDayCountAndBlocks(es){const ts=[],ss=/End of Shooting Day\s+(\d+)/gi,rs=[];let ns;for(;(ns=ss.exec(es))!==null;){const as=parseInt(ns[1],10);rs.find(ls=>ls.dayNum===as)||rs.push({dayNum:as,endPos:ns.index+ns[0].length})}rs.sort((as,ls)=>as.endPos-ls.endPos);let os=0;for(let as=0;as<rs.length;as++){const ls=rs[as],cs=as>0?rs[as-1].endPos:0,us=es.slice(cs,ls.endPos+200);ts.push(us),os=Math.max(os,ls.dayNum)}if(rs.length===0){const as=/(?:^|\n)(?:Shooting\s+)?Day\s+(\d+)/gi;for(;(ns=as.exec(es))!==null;){const ls=parseInt(ns[1],10);os=Math.max(os,ls)}}return{totalDays:os,dayTextBlocks:ts}}async function extractTextFromPDF$2(es){const ts=await es.arrayBuffer(),ss=await pdfExports.getDocument({data:ts}).promise;let rs="";for(let ns=1;ns<=ss.numPages;ns++){const as=await(await ss.getPage(ns)).getTextContent(),ls=new Map;for(const us of as.items){if(!us.str||us.str.trim()==="")continue;const ds=Math.round(us.transform[5]/3)*3,ms=us.transform[4];ls.has(ds)||ls.set(ds,[]),ls.get(ds).push({x:ms,text:us.str,width:us.width||0})}const cs=Array.from(ls.keys()).sort((us,ds)=>ds-us);for(const us of cs){const ds=ls.get(us);ds.sort((xs,ys)=>xs.x-ys.x);let ms="",ps=0,hs=0;for(const xs of ds){const ys=xs.x-(ps+hs);ps>0&&ys>15?ms+="	":ps>0&&ys>3&&(ms+=" "),ms+=xs.text,ps=xs.x,hs=xs.width}rs+=ms.trimEnd()+`
`}rs+=`
=== PAGE ${ns} ===

`}return rs}function extractCastListFast(es){const ts=[],ss=es.slice(0,15e3),rs=[/(?:CAST\s*LIST|CAST\s*MEMBERS?|CAST|CHARACTERS?)[:\s]*\n([\s\S]*?)(?=\n\s*\n\s*\n|SHOOTING\s*DAY|END\s*OF|DAY\s+\d|=== PAGE)/i,/(?:CAST\s*LIST|CAST\s*MEMBERS?|CAST|CHARACTERS?)[:\s]*\n([\s\S]*?)(?=\n[A-Z]{3,}\s*\n|\nSCENE|\nDAY\b)/i];for(const cs of rs){const us=ss.match(cs);if(us){const ds=us[1],ms=/(\d{1,3})\s*[.\-)\]:]?\s*([A-Z][A-Za-z'\-.\s]{1,30})/g;let ps;for(;(ps=ms.exec(ds))!==null;)addCastMember(ts,ps[1],ps[2]);if(ts.length>=2)break}}const ns=/(?:^|\n|\t)\s*(\d{1,3})\s*[.\-)\]:]\s*([A-Z][A-Za-z'\-.\s]{1,30}?)(?=\s*\n|\s*\t|\s{3,})/gm;let os;for(;(os=ns.exec(ss))!==null;)addCastMember(ts,os[1],os[2]);const as=/(?:^|\n)\s*(\d{1,3})[\t\s]{2,}([A-Z][A-Za-z'\-.\s]{1,30}?)(?=\s*[\t\n]|\s{3,}|$)/gm;for(;(os=as.exec(ss))!==null;)addCastMember(ts,os[1],os[2]);const ls=/\((\d{1,3})\)\s*([A-Z][A-Za-z'\-.\s]{1,30}?)(?=\s*\n|\s*\t|\s{3,})/gm;for(;(os=ls.exec(ss))!==null;)addCastMember(ts,os[1],os[2]);if(ts.length<3){const cs=/(?:^|\n|\t)\s*(\d{1,2})\s*[.\-)\]:]\s*([A-Z][A-Za-z'\-.\s]{2,25})/gm,us=[];for(;(os=cs.exec(es.slice(0,2e4)))!==null;){const ds=os[2].trim(),ms=new RegExp(`\\b${escapeRegExpSchedule(ds.split(" ")[0])}\\b`,"gi"),ps=(es.match(ms)||[]).length;ps>=2&&us.push({num:os[1],name:ds,count:ps})}us.sort((ds,ms)=>ms.count-ds.count);for(const ds of us)addCastMember(ts,ds.num,ds.name)}return ts.sort((cs,us)=>cs.number-us.number),console.log("extractCastListFast: Found",ts.length,"cast members:",ts.map(cs=>`${cs.number}.${cs.name}`).join(", ")),ts}function escapeRegExpSchedule(es){return es.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function addCastMember(es,ts,ss){const rs=parseInt(ts,10);let ns=ss.trim().replace(/\s+/g," ").replace(/[.,;:]+$/,"").trim();rs<=0||rs>200||ns.length<2||ns.length>30||/^(INT|EXT|DAY|NIGHT|MORNING|HOURS|PAGE|SCENE|EST|TIME|CALL|UNIT|SET|LOC|END|TOTAL|SHOOT)/i.test(ns)||/^\d+$/.test(ns)||/^\d{1,2}[:/]\d{2}/.test(ns)||es.find(os=>os.number===rs)||(ns=ns.toUpperCase(),es.push({number:rs,name:ns}))}function extractMetadata(es){const ts=es.slice(0,2e3),ss=ts.match(/^[A-Z][A-Z\s\-']+(?=\s*\n)/m),rs=ts.match(/(?:Script|Draft)[:\s]*([A-Za-z]+\s*\d*)/i),ns=ts.match(/(?:Schedule|Version)[:\s]*([A-Za-z0-9\s\-\/]+)/i);return{productionName:ss?ss[0].trim():void 0,scriptVersion:rs?rs[1].trim():void 0,scheduleVersion:ns?ns[1].trim():void 0}}function aiDebugLog(...es){console.log("[AIService]",...es)}async function callAI(es,ts={}){var ls;const{system:ss,maxTokens:rs=4e3,maxRetries:ns=3}=ts;aiDebugLog("callAI started, maxTokens:",rs,"prompt length:",es.length);const os=[{role:"user",content:es}];let as=null;for(let cs=0;cs<ns;cs++)try{aiDebugLog(`Attempt ${cs+1}/${ns}...`);const ds=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:os,system:ss,maxTokens:rs,model:"claude-sonnet-4-20250514"})});if(aiDebugLog("Response status:",ds.status),!ds.ok){const ps=await ds.json().catch(()=>({})),hs=((ls=ps.error)==null?void 0:ls.message)||ps.error||"";if(aiDebugLog("API error:",ds.status,hs),ds.status===429){const xs=Math.pow(2,cs+1)*1e3;aiDebugLog(`Rate limited, waiting ${xs}ms before retry...`),await new Promise(ys=>setTimeout(ys,xs));continue}if(ds.status===529){const xs=Math.pow(2,cs+1)*1e3;aiDebugLog(`Server overloaded, waiting ${xs}ms before retry...`),await new Promise(ys=>setTimeout(ys,xs));continue}if(ds.status===400&&(hs.includes("credit balance")||hs.includes("purchase credits")))throw new Error("Insufficient API credits. Please add credits at console.anthropic.com");if(ds.status===401||ds.status===403)throw new Error("Invalid API key. Please check your configuration.");if(ds.status>=500){const xs=Math.pow(2,cs+1)*1e3;aiDebugLog(`Server error ${ds.status}, waiting ${xs}ms before retry...`),await new Promise(ys=>setTimeout(ys,xs));continue}throw new Error(ps.error||`API error: ${ds.status}`)}const ms=await ds.json();if(ms.content&&ms.content.length>0){const ps=ms.content[0].text;return aiDebugLog("AI call successful, response length:",ps.length),ms.usage&&aiDebugLog("Token usage:",ms.usage),ps}throw new Error("Empty response from AI")}catch(us){as=us,aiDebugLog(`AI call attempt ${cs+1} failed:`,us),console.error(`AI call attempt ${cs+1} failed:`,us);const ds=as.message||"";if(ds.includes("Insufficient API credits")||ds.includes("Invalid API key"))throw as;if(cs<ns-1){const ms=Math.pow(2,cs+1)*1e3;aiDebugLog(`Waiting ${ms}ms before retry...`),await new Promise(ps=>setTimeout(ps,ms))}}throw aiDebugLog("All retries failed, throwing error"),as||new Error("AI call failed after retries")}async function processDayWithAI(es,ts,ss){const rs=`You are an expert at parsing film/TV production schedules. Extract structured scene data from a single shooting day's schedule text.

The text comes from a PDF extraction and may have table structure lost. Look for patterns:
- Scene numbers (e.g., "Scene 21", "Scene 14", "Scene 61A")
- INT/EXT markers
- Location/set descriptions (e.g., "MARGOT'S BEDROOM - PLUMHILL MANOR")
- Day/Night indicators
- Page counts (e.g., "2 pgs", "1 4/8 pgs", "5/8 pgs")
- Cast numbers (small numbers like 1, 2, 3 that refer to cast members)
- Estimated times (e.g., "3:00", "1:30", ":30")
- Story day markers (e.g., "D5", "N8", "D4")
- Scene descriptions/log lines
- Set moves, lighting changes, load in/out markers
- "End of Shooting Day" summary lines with date and total pages

${ss}

Return ONLY valid JSON with no additional text or markdown.`,ns=`Parse this shooting day text and extract ALL scenes with their details.

SHOOTING DAY TEXT:
---
${es}
---

Return a JSON object with this structure:
{
  "dayNumber": ${ts},
  "date": "YYYY-MM-DD or null if not found",
  "dayOfWeek": "Monday/Tuesday/etc or null",
  "location": "Main location for the day",
  "notes": ["array of notes like 'Set Move :30', 'Lighting Change for Night', 'Load In :30'"],
  "totalPages": "total pages string if found in End of Shooting Day line",
  "scenes": [
    {
      "sceneNumber": "21",
      "pages": "2",
      "intExt": "INT",
      "dayNight": "Day",
      "setLocation": "MARGOT'S BEDROOM - PLUMHILL MANOR",
      "description": "Margot wakes to a call from Calvaux.",
      "castNumbers": [1],
      "estimatedTime": "3:00",
      "storyDay": "D5",
      "remarks": "Calvaux (Phone)"
    }
  ]
}

IMPORTANT:
- Extract EVERY scene entry, including those after "Lighting Change" or "Set Move" markers
- Scene numbers may include letters like "61A", "14pt"
- Pages can be "2", "1 4/8", "2/8", "5/8", "3/8" etc.
- Cast numbers are the small integers (1, 2, 3, 7, etc.) that reference the cast list
- Day/Night is usually "Day", "Night", "Morning" - also look for D/N column
- The description/log line describes what happens in the scene
- estimatedTime is the Est. Time value (e.g., "3:00", "1:30", ":30", "1:00")
- storyDay is the Day marker like "D5", "N8", "D4" from the Day column
- remarks captures any additional notes from the Remarks column
- Include the shootOrder (1-based index within the day)
- Look for the "End of Shooting Day X" line for date and total pages info`,as=(await callAI(ns,{system:rs,maxTokens:6e3})).match(/\{[\s\S]*\}/);if(!as)throw new Error(`Failed to parse AI response for day ${ts}`);const ls=JSON.parse(as[0]),cs=(ls.scenes||[]).map((us,ds)=>{var ms;return{sceneNumber:String(us.sceneNumber||""),pages:us.pages||void 0,intExt:((ms=us.intExt)==null?void 0:ms.toUpperCase())==="EXT"?"EXT":"INT",dayNight:us.dayNight||us.storyDay||"Day",setLocation:us.setLocation||"",description:us.description||us.remarks||void 0,castNumbers:Array.isArray(us.castNumbers)?us.castNumbers.map(Number).filter(ps=>!isNaN(ps)):[],estimatedTime:us.estimatedTime||void 0,shootOrder:ds+1}});return{dayNumber:ls.dayNumber||ts,date:ls.date||void 0,dayOfWeek:ls.dayOfWeek||void 0,location:ls.location||"",notes:Array.isArray(ls.notes)?ls.notes:void 0,scenes:cs,totalPages:ls.totalPages||void 0}}function extractDayTextBlocks(es){const ts=new Map,ss=/End of Shooting Day\s+(\d+)/gi,rs=[];let ns;for(;(ns=ss.exec(es))!==null;){const os=parseInt(ns[1],10),as=Math.min(ns.index+ns[0].length+200,es.length);rs.push({dayNum:os,endPos:as})}rs.sort((os,as)=>os.endPos-as.endPos);for(let os=0;os<rs.length;os++){const as=rs[os],ls=os>0?rs[os-1].endPos:0,cs=es.slice(ls,as.endPos);ts.set(as.dayNum,cs)}return ts}async function processScheduleStage2(es,ts){const ss=es.rawText;if(!ss)throw new Error("No raw text available for processing. Please re-upload the schedule.");const rs=es.castList.length>0?`CAST LIST (number  name):
${es.castList.map(cs=>`${cs.number}. ${cs.name}`).join(`
`)}

Use these cast numbers when identifying which cast members are in each scene.`:"",ns=extractDayTextBlocks(ss),os=es.totalDays||ns.size;if(ns.size===0)return ts==null||ts({current:1,total:1,message:"Processing schedule..."}),{days:[await processDayWithAI(ss.slice(0,3e4),1,rs)]};const as=[],ls=Array.from(ns.keys()).sort((cs,us)=>cs-us);for(let cs=0;cs<ls.length;cs++){const us=ls[cs],ds=ns.get(us);ts==null||ts({current:cs+1,total:os,message:`Processing Day ${us} of ${os}...`});try{const ms=await processDayWithAI(ds,us,rs);as.push(ms)}catch(ms){console.error(`Failed to process day ${us}:`,ms),as.push({dayNumber:us,location:"",scenes:[],notes:[`Processing failed: ${ms instanceof Error?ms.message:"Unknown error"}`]})}}return{days:as}}function buildSceneMap(es){const ts=new Map;for(const ss of es.days)for(const rs of ss.scenes){const ns=rs.sceneNumber.replace(/\s+/g,"").toUpperCase();ts.set(ns,{day:ss,entry:rs})}return ts}function normalizeSceneNumber(es){return es.replace(/\s+/g,"").toUpperCase()}function detectCastChanges(es,ts){const ss=new Set(es.castNumbers),rs=new Set(ts.castNumbers),ns=[...rs].filter(as=>!ss.has(as)),os=[...ss].filter(as=>!rs.has(as));return ns.length===0&&os.length===0?null:{added:ns,removed:os}}function detectTimingChanges(es,ts,ss){return ss?(es.estimatedTime||"")!==(ts.estimatedTime||"")||es.shootOrder!==ts.shootOrder||(es.pages||"")!==(ts.pages||""):!1}function compareScheduleAmendment(es,ts){const ss=buildSceneMap(es),rs=buildSceneMap(ts),ns=[],os=[],as=new Set(es.days.map(js=>js.dayNumber)),ls=new Set(ts.days.map(js=>js.dayNumber)),cs=new Set;for(const[js,{day:Ss,entry:bs}]of rs){cs.add(js);const Es=ss.get(js);if(!Es)ns.push({sceneNumber:bs.sceneNumber,changeType:"scene_added",description:`Scene ${bs.sceneNumber} added to Day ${Ss.dayNumber}`,newDay:Ss.dayNumber,newEntry:bs});else{const{day:Rs,entry:ws}=Es,Ns=Rs.dayNumber===Ss.dayNumber;Ns||ns.push({sceneNumber:bs.sceneNumber,changeType:"scene_moved",description:`Scene ${bs.sceneNumber} moved from Day ${Rs.dayNumber} to Day ${Ss.dayNumber}`,oldDay:Rs.dayNumber,newDay:Ss.dayNumber,oldEntry:ws,newEntry:bs});const ks=detectCastChanges(ws,bs);if(ks){const _s=[];ks.added.length>0&&_s.push(`${ks.added.length} cast added`),ks.removed.length>0&&_s.push(`${ks.removed.length} cast removed`),ns.push({sceneNumber:bs.sceneNumber,changeType:"cast_changed",description:`Scene ${bs.sceneNumber}: ${_s.join(", ")}`,oldDay:Rs.dayNumber,newDay:Ss.dayNumber,oldEntry:ws,newEntry:bs,castAdded:ks.added,castRemoved:ks.removed})}if(Ns&&detectTimingChanges(ws,bs,Ns)){const _s=[];(ws.estimatedTime||"")!==(bs.estimatedTime||"")&&_s.push(`time: ${ws.estimatedTime||"none"}  ${bs.estimatedTime||"none"}`),ws.shootOrder!==bs.shootOrder&&_s.push(`order: ${ws.shootOrder}  ${bs.shootOrder}`),(ws.pages||"")!==(bs.pages||"")&&_s.push(`pages: ${ws.pages||"none"}  ${bs.pages||"none"}`),ns.push({sceneNumber:bs.sceneNumber,changeType:"timing_changed",description:`Scene ${bs.sceneNumber}: ${_s.join(", ")}`,oldDay:Rs.dayNumber,newDay:Ss.dayNumber,oldEntry:ws,newEntry:bs})}}}for(const[js,{day:Ss,entry:bs}]of ss)cs.has(js)||ns.push({sceneNumber:bs.sceneNumber,changeType:"scene_removed",description:`Scene ${bs.sceneNumber} removed from Day ${Ss.dayNumber}`,oldDay:Ss.dayNumber,oldEntry:bs});for(const js of ts.days)if(!as.has(js.dayNumber)){const Ss=ns.filter(bs=>bs.newDay===js.dayNumber);os.push({dayNumber:js.dayNumber,changeType:"day_added",description:`Day ${js.dayNumber} added (${js.scenes.length} scene${js.scenes.length!==1?"s":""})`,newDay:js,sceneChanges:Ss})}for(const js of es.days)if(!ls.has(js.dayNumber)){const Ss=ns.filter(bs=>bs.oldDay===js.dayNumber);os.push({dayNumber:js.dayNumber,changeType:"day_removed",description:`Day ${js.dayNumber} removed (${js.scenes.length} scene${js.scenes.length!==1?"s":""})`,oldDay:js,sceneChanges:Ss})}for(const js of ts.days)if(as.has(js.dayNumber)){const Ss=ns.filter(bs=>bs.newDay===js.dayNumber||bs.oldDay===js.dayNumber);if(Ss.length>0){const bs=es.days.find(Es=>Es.dayNumber===js.dayNumber);os.push({dayNumber:js.dayNumber,changeType:"day_modified",description:`Day ${js.dayNumber}: ${Ss.length} change${Ss.length!==1?"s":""}`,oldDay:bs,newDay:js,sceneChanges:Ss})}}os.sort((js,Ss)=>js.dayNumber-Ss.dayNumber);const us=ns.filter(js=>js.changeType==="scene_added"),ds=ns.filter(js=>js.changeType==="scene_removed"),ms=ns.filter(js=>js.changeType==="scene_moved"),ps=ns.filter(js=>js.changeType==="cast_changed"),hs=ns.filter(js=>js.changeType==="timing_changed"),xs=os.filter(js=>js.changeType==="day_added"),ys=os.filter(js=>js.changeType==="day_removed"),vs=[];us.length>0&&vs.push(`${us.length} scene${us.length>1?"s":""} added`),ds.length>0&&vs.push(`${ds.length} scene${ds.length>1?"s":""} removed`),ms.length>0&&vs.push(`${ms.length} scene${ms.length>1?"s":""} moved`),ps.length>0&&vs.push(`${ps.length} cast change${ps.length>1?"s":""}`),hs.length>0&&vs.push(`${hs.length} timing change${hs.length>1?"s":""}`),xs.length>0&&vs.push(`${xs.length} day${xs.length>1?"s":""} added`),ys.length>0&&vs.push(`${ys.length} day${ys.length>1?"s":""} removed`);const gs=vs.length>0?vs.join(", "):"No changes detected",fs=ns.length>0||os.length>0;return{dayChanges:os,allSceneChanges:ns,addedScenes:us,removedScenes:ds,movedScenes:ms,castChanges:ps,timingChanges:hs,addedDays:xs,removedDays:ys,summary:gs,hasChanges:fs}}function applyScheduleAmendment(es,ts,ss,rs={includeAddedScenes:!0,includeRemovedScenes:!0,includeMovedScenes:!0,includeCastChanges:!0,includeTimingChanges:!0}){const ns=new Map;for(const ds of es.days)ns.set(ds.dayNumber,{...ds,scenes:[...ds.scenes]});const os=new Set;if(!rs.includeAddedScenes)for(const ds of ss.addedScenes)os.add(normalizeSceneNumber(ds.sceneNumber));if(!rs.includeRemovedScenes)for(const ds of ss.removedScenes)os.add(normalizeSceneNumber(ds.sceneNumber));if(!rs.includeMovedScenes)for(const ds of ss.movedScenes)os.add(normalizeSceneNumber(ds.sceneNumber));const as=new Set;if(!rs.includeCastChanges)for(const ds of ss.castChanges)as.add(normalizeSceneNumber(ds.sceneNumber));const ls=new Set;if(!rs.includeTimingChanges)for(const ds of ss.timingChanges)ls.add(normalizeSceneNumber(ds.sceneNumber));const cs=buildSceneMap(es),us=[];for(const ds of ts.days){const ms=[];for(const ps of ds.scenes){const hs=normalizeSceneNumber(ps.sceneNumber);if(os.has(hs)&&ss.addedScenes.some(vs=>normalizeSceneNumber(vs.sceneNumber)===hs))continue;const xs=cs.get(hs);let ys={...ps};as.has(hs)&&xs&&(ys.castNumbers=[...xs.entry.castNumbers]),ls.has(hs)&&xs&&(ys.estimatedTime=xs.entry.estimatedTime,ys.shootOrder=xs.entry.shootOrder,ys.pages=xs.entry.pages),ms.push(ys)}if(!rs.includeRemovedScenes){const ps=es.days.find(hs=>hs.dayNumber===ds.dayNumber);if(ps)for(const hs of ps.scenes){const xs=normalizeSceneNumber(hs.sceneNumber);ts.days.some(ys=>ys.scenes.some(vs=>normalizeSceneNumber(vs.sceneNumber)===xs))||ms.push({...hs})}}us.push({...ds,scenes:ms})}if(!rs.includeRemovedScenes)for(const ds of es.days)ts.days.some(ms=>ms.dayNumber===ds.dayNumber)||us.push({...ds,scenes:[...ds.scenes]});return us.sort((ds,ms)=>ds.dayNumber-ms.dayNumber),{...ts,days:us,status:ts.status,castList:mergecastLists(es.castList,ts.castList)}}function mergecastLists(es,ts){const ss=[...ts],rs=new Set(ts.map(ns=>ns.number));for(const ns of es)rs.has(ns.number)||ss.push(ns);return ss.sort((ns,os)=>ns.number-os.number)}const useScheduleStore=create()(persist((es,ts)=>({schedule:null,savedSchedules:{},isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null,pendingSchedule:null,setSchedule:ss=>{es({schedule:ss,isUploading:!1,uploadError:null})},uploadScheduleStage1:async ss=>{es({isUploading:!0,uploadError:null});try{console.log("[ScheduleStore] Starting Stage 1 parsing...");const rs=await parseScheduleStage1(ss);console.log("[ScheduleStore] Stage 1 complete:",{castCount:rs.schedule.castList.length,totalDays:rs.schedule.totalDays,productionName:rs.schedule.productionName});const ns={...rs.schedule,status:"pending"};return es({schedule:ns,isUploading:!1}),ns}catch(rs){const ns=rs instanceof Error?rs.message:"Failed to parse schedule";throw console.error("[ScheduleStore] Stage 1 failed:",rs),es({isUploading:!1,uploadError:ns}),rs}},uploadRevisionStage1:async ss=>{es({isUploading:!0,uploadError:null});try{console.log("[ScheduleStore] Starting revision Stage 1 parsing...");const ns={...(await parseScheduleStage1(ss)).schedule,status:"pending"};return es({pendingSchedule:ns,isUploading:!1}),ns}catch(rs){const ns=rs instanceof Error?rs.message:"Failed to parse revised schedule";throw console.error("[ScheduleStore] Revision Stage 1 failed:",rs),es({isUploading:!1,uploadError:ns}),rs}},startRevisionStage2Processing:async()=>{const ss=ts();if(!(!ss.pendingSchedule||ss.isProcessingStage2)){es({isProcessingStage2:!0,stage2Error:null,stage2Progress:{current:0,total:ss.pendingSchedule.totalDays||1}});try{const rs=await processScheduleStage2(ss.pendingSchedule,ns=>{es({stage2Progress:ns})});es(ns=>({pendingSchedule:ns.pendingSchedule?{...ns.pendingSchedule,days:rs.days,status:"complete",processingProgress:{current:rs.days.length,total:rs.days.length}}:null,isProcessingStage2:!1,stage2Progress:{current:rs.days.length,total:rs.days.length}})),console.log("[ScheduleStore] Revision Stage 2 complete:",{daysProcessed:rs.days.length,totalScenes:rs.days.reduce((ns,os)=>ns+os.scenes.length,0)})}catch(rs){const ns=rs instanceof Error?rs.message:"Failed to process revised schedule";console.error("[ScheduleStore] Revision Stage 2 failed:",rs),es({isProcessingStage2:!1,stage2Error:ns})}}},compareAmendment:()=>{const ss=ts();return!ss.schedule||!ss.pendingSchedule||ss.schedule.days.length===0||ss.pendingSchedule.days.length===0?null:compareScheduleAmendment(ss.schedule,ss.pendingSchedule)},applyAmendment:(ss,rs)=>{const ns=ts();if(!ns.schedule||!ns.pendingSchedule)return;const os=applyScheduleAmendment(ns.schedule,ns.pendingSchedule,ss,rs);es({schedule:os,pendingSchedule:null}),console.log("[ScheduleStore] Amendment applied:",{days:os.days.length,totalScenes:os.days.reduce((as,ls)=>as+ls.scenes.length,0)})},clearPendingSchedule:()=>{es({pendingSchedule:null})},startStage2Processing:async()=>{const ss=ts();if(!(!ss.schedule||ss.isProcessingStage2)){es({isProcessingStage2:!0,stage2Error:null,stage2Progress:{current:0,total:ss.schedule.totalDays||1}}),es(rs=>({schedule:rs.schedule?{...rs.schedule,status:"processing"}:null}));try{const rs=await processScheduleStage2(ss.schedule,ns=>{es({stage2Progress:ns})});es(ns=>({schedule:ns.schedule?{...ns.schedule,days:rs.days,status:"complete",processingProgress:{current:rs.days.length,total:rs.days.length}}:null,isProcessingStage2:!1,stage2Progress:{current:rs.days.length,total:rs.days.length}})),console.log("[ScheduleStore] Stage 2 complete:",{daysProcessed:rs.days.length,totalScenes:rs.days.reduce((ns,os)=>ns+os.scenes.length,0)})}catch(rs){const ns=rs instanceof Error?rs.message:"Failed to process schedule";console.error("[ScheduleStore] Stage 2 failed:",rs),es({isProcessingStage2:!1,stage2Error:ns,schedule:ts().schedule?{...ts().schedule,status:"partial",processingError:ns}:null})}}},updateDayData:(ss,rs)=>{es(ns=>{if(!ns.schedule)return ns;const os=ns.schedule.days.findIndex(ls=>ls.dayNumber===ss),as=[...ns.schedule.days];return os>=0?as[os]=rs:(as.push(rs),as.sort((ls,cs)=>ls.dayNumber-cs.dayNumber)),{schedule:{...ns.schedule,days:as}}})},clearSchedule:()=>{es({schedule:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null})},getCastMemberByNumber:ss=>{const rs=ts().schedule;return rs&&rs.castList.find(ns=>ns.number===ss)||null},getCastMemberByName:ss=>{const rs=ts().schedule;if(!rs)return null;const ns=ss.toUpperCase().trim();return rs.castList.find(os=>os.name.toUpperCase().includes(ns)||os.character&&os.character.toUpperCase().includes(ns))||null},getCastNamesForNumbers:ss=>{const rs=ts().schedule;return rs?ss.map(ns=>{const os=rs.castList.find(as=>as.number===ns);return os?os.character||os.name:`Cast #${ns}`}):[]},getScenesForShootingDay:ss=>{const rs=ts().schedule;return rs&&rs.days.find(ns=>ns.dayNumber===ss)||null},getShootingDayForScene:ss=>{const rs=ts().schedule;if(!rs)return null;const ns=ss.replace(/\s+/g,"").toUpperCase();for(const os of rs.days)for(const as of os.scenes)if(as.sceneNumber.replace(/\s+/g,"").toUpperCase()===ns)return os.dayNumber;return null},saveScheduleForProject:ss=>{ts().schedule&&es(ns=>({savedSchedules:{...ns.savedSchedules,[ss]:{schedule:ns.schedule}},schedule:null,isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null}))},restoreScheduleForProject:ss=>{const rs=ts(),ns=rs.savedSchedules[ss];if(!ns)return!1;const os={...rs.savedSchedules};return delete os[ss],es({schedule:ns.schedule,savedSchedules:os,isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null}),!0},hasSavedSchedule:ss=>!!ts().savedSchedules[ss],clearScheduleForProject:()=>{es({schedule:null,isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null})}}),{name:"hair-makeup-schedule",storage:createHybridStorage("hair-makeup-schedule"),partialize:es=>({schedule:es.schedule,savedSchedules:es.savedSchedules})})),BETA_MODE=!0,TIER_FEATURES={trainee:{maxProjects:3,maxArchivedProjects:1,maxPhotosPerProject:50,canCreateProjects:!1,offlineMode:!1,exportReports:!1,personalTemplates:!1,teamManagement:!1,characterProgressionTracking:!1,shootingScheduleView:!1,teamPhotoStorage:!1,desktopWebAccess:!1,preProductionBreakdown:!1,characterDesignDocs:!1,exportProductionBooks:!1,budgetSchedulingTools:!1},artist:{maxProjects:10,maxArchivedProjects:-1,maxPhotosPerProject:500,canCreateProjects:!1,offlineMode:!0,exportReports:!0,personalTemplates:!0,teamManagement:!1,characterProgressionTracking:!1,shootingScheduleView:!1,teamPhotoStorage:!1,desktopWebAccess:!1,preProductionBreakdown:!1,characterDesignDocs:!1,exportProductionBooks:!1,budgetSchedulingTools:!1},supervisor:{maxProjects:25,maxArchivedProjects:15,maxPhotosPerProject:1e3,canCreateProjects:!0,offlineMode:!0,exportReports:!0,personalTemplates:!0,teamManagement:!0,characterProgressionTracking:!0,shootingScheduleView:!0,teamPhotoStorage:!1,desktopWebAccess:!1,preProductionBreakdown:!1,characterDesignDocs:!1,exportProductionBooks:!1,budgetSchedulingTools:!1},designer:{maxProjects:-1,maxArchivedProjects:-1,maxPhotosPerProject:-1,canCreateProjects:!0,offlineMode:!0,exportReports:!0,personalTemplates:!0,teamManagement:!0,characterProgressionTracking:!0,shootingScheduleView:!0,teamPhotoStorage:!0,desktopWebAccess:!0,preProductionBreakdown:!0,characterDesignDocs:!0,exportProductionBooks:!0,budgetSchedulingTools:!0}},TIER_PRICING={trainee:{monthly:0,yearly:0,currency:"GBP",currencySymbol:""},artist:{monthly:4.99,yearly:47.9,currency:"GBP",currencySymbol:""},supervisor:{monthly:9.99,yearly:95.9,currency:"GBP",currencySymbol:""},designer:{monthly:29.99,yearly:287.9,perProject:49,currency:"GBP",currencySymbol:""}},SUBSCRIPTION_TIERS=[{id:"trainee",name:"TRAINEE",displayName:"Trainee",description:"Perfect for students and emerging artists",pricing:TIER_PRICING.trainee,features:TIER_FEATURES.trainee,featureList:["Multiple projects simultaneously","50 photos per project","View breakdowns & scenes","Add continuity notes","1 archived project"]},{id:"artist",name:"ARTIST",displayName:"Artist",description:"For working floor artists",pricing:TIER_PRICING.artist,features:TIER_FEATURES.artist,featureList:["Everything in Trainee","500 photos per project","Offline mode with full sync","Export continuity reports (PDF)","Personal templates between projects","Unlimited project archive"],isPopular:!0},{id:"supervisor",name:"SUPERVISOR",displayName:"Supervisor",description:"For supervisors and key artists",pricing:TIER_PRICING.supervisor,features:TIER_FEATURES.supervisor,featureList:["Everything in Artist","1000 photos per project","Create & manage projects","Generate team invite codes","Team management","Character progression tracking","Shooting schedule view"]},{id:"designer",name:"DESIGNER",displayName:"Designer",description:"The complete package for HODs and designers",pricing:TIER_PRICING.designer,features:TIER_FEATURES.designer,featureList:["Everything in Supervisor","Unlimited photo storage","Team photo storage included","Full desktop web access","Pre-production script breakdown","Character design documentation","Export full production books","Budget & scheduling tools"],isPremium:!0}],formatMonthlyEquivalent=(es,ts="")=>{const ss=es/12;return`${ts}${ss.toFixed(2)}`},isTierHigher=(es,ts)=>{const ss=["trainee","artist","supervisor","designer"];return ss.indexOf(es)>ss.indexOf(ts)},getDowngradeWarnings=(es,ts)=>{const ss=TIER_FEATURES[es],rs=TIER_FEATURES[ts],ns=[];if(ss.offlineMode&&!rs.offlineMode&&ns.push("Offline mode with full sync"),ss.exportReports&&!rs.exportReports&&ns.push("Export continuity reports"),ss.personalTemplates&&!rs.personalTemplates&&ns.push("Personal templates"),ss.teamManagement&&!rs.teamManagement&&ns.push("Team management"),ss.canCreateProjects&&!rs.canCreateProjects&&ns.push("Create & manage projects"),ss.characterProgressionTracking&&!rs.characterProgressionTracking&&ns.push("Character progression tracking"),ss.shootingScheduleView&&!rs.shootingScheduleView&&ns.push("Shooting schedule view"),ss.teamPhotoStorage&&!rs.teamPhotoStorage&&ns.push("Team photo storage"),ss.desktopWebAccess&&!rs.desktopWebAccess&&ns.push("Desktop web access"),ss.preProductionBreakdown&&!rs.preProductionBreakdown&&ns.push("Pre-production script breakdown"),ss.characterDesignDocs&&!rs.characterDesignDocs&&ns.push("Character design documentation"),ss.exportProductionBooks&&!rs.exportProductionBooks&&ns.push("Export production books"),ss.budgetSchedulingTools&&!rs.budgetSchedulingTools&&ns.push("Budget & scheduling tools"),ss.maxPhotosPerProject>rs.maxPhotosPerProject){const os=ss.maxPhotosPerProject===-1?"Unlimited":ss.maxPhotosPerProject,as=rs.maxPhotosPerProject===-1?"Unlimited":rs.maxPhotosPerProject;ns.push(`Photo limit reduced from ${os} to ${as} per project`)}return ns},createDefaultSubscription=()=>({tier:"designer",status:"active",billingPeriod:null}),createEmptyCastProfile=es=>({id:`cast-${es}`,characterId:es,actorName:"",phone:"",email:"",agentName:"",agentPhone:"",agentEmail:"",allergies:"",specialRequirements:"",skinType:"",notes:""}),HAIR_TYPES=["Natural","Wig","Hair Pieces","Extensions"],WIG_TYPES=["Lace Front","Full Lace","Hard Front","U-Part","Closure"],WIG_ATTACHMENTS=["Glue","Tape","Pins","Combs","Clips","Elastic"],HAIRLINE_STYLES=["Natural","Laid","Concealed","Bleached Knots"],SFX_TYPES=["Prosthetics","Wounds","Scars","Tattoos","Aging","Bald Cap","Contact Lenses","Teeth","Body Paint"],BLOOD_TYPES=["Fresh","Dried","Arterial","Mouth Blood","Bruising"],ALL_NAV_ITEMS=[{id:"today",label:"Today",iconName:"calendar"},{id:"breakdown",label:"Breakdown",iconName:"grid"},{id:"lookbook",label:"Lookbook",iconName:"book"},{id:"hours",label:"Hours",iconName:"clock"},{id:"budget",label:"Budget",iconName:"wallet"},{id:"script",label:"Script",iconName:"document"},{id:"schedule",label:"Schedule",iconName:"schedule"},{id:"callsheets",label:"Call Sheets",iconName:"clipboard"},{id:"settings",label:"Settings",iconName:"cog"}],DEFAULT_BOTTOM_NAV=["today","breakdown","hours"],SCENE_FILMING_STATUS_CONFIG={"not-filmed":{label:"Incomplete",shortLabel:"Incomplete",bgClass:"bg-red-100",textClass:"text-red-600",borderClass:"border-red-400",color:"#dc2626",glassOverlay:"rgba(239, 68, 68, 0.15)"},partial:{label:"Part Complete",shortLabel:"Part Complete",bgClass:"bg-amber-100",textClass:"text-amber-600",borderClass:"border-amber-400",color:"#d97706",glassOverlay:"rgba(245, 158, 11, 0.15)"},complete:{label:"Complete",shortLabel:"Complete",bgClass:"bg-green-100",textClass:"text-green-600",borderClass:"border-green-400",color:"#16a34a",glassOverlay:"rgba(34, 197, 94, 0.15)"}},createEmptyMakeupDetails=()=>({foundation:"",coverage:"",concealer:"",concealerPlacement:"",contour:"",contourPlacement:"",highlight:"",highlightPlacement:"",blush:"",blushPlacement:"",browProduct:"",browShape:"",eyePrimer:"",lidColour:"",creaseColour:"",outerV:"",liner:"",lashes:"",lipLiner:"",lipColour:"",setting:""}),createEmptyHairDetails=()=>({style:"",products:"",parting:"",piecesOut:"",pins:"",accessories:"",hairType:"Natural",wigNameId:"",wigType:"",wigCapMethod:"",wigAttachment:[],hairline:"",laceTint:"",edgesBabyHairs:""}),createEmptySFXDetails=()=>({sfxRequired:!1,sfxTypes:[],prostheticPieces:"",prostheticAdhesive:"",bloodTypes:[],bloodProducts:"",bloodPlacement:"",tattooCoverage:"",temporaryTattoos:"",contactLenses:"",teeth:"",agingCharacterNotes:"",sfxApplicationTime:null,sfxReferencePhotos:[]}),createEmptyContinuityFlags=()=>({sweat:!1,dishevelled:!1,blood:!1,dirt:!1,wetHair:!1,tears:!1}),STAGE_SUGGESTIONS=["Fresh","Day 1 Healing","Day 2 Healing","Day 3 Healing","Scabbed","Scarring","Healed","Faded"],CONTINUITY_EVENT_TYPES=["Wound","Bruise","Prosthetic","Scar","Tattoo","Other"],countFilledFields=es=>Object.entries(es).filter(([ts,ss])=>ts==="hairType"||ts==="sfxRequired"?!1:Array.isArray(ss)?ss.length>0:typeof ss=="number"?ss>0:ss===null||typeof ss=="boolean"?!1:typeof ss=="string"?ss.trim()!=="":!1).length,countHairFields=es=>{const ts=["style","products","parting","piecesOut","pins","accessories"],ss=["wigNameId","wigType","wigCapMethod","wigAttachment","hairline","laceTint","edgesBabyHairs"];let rs=0;return ts.forEach(ns=>{const os=es[ns];typeof os=="string"&&os.trim()!==""&&rs++}),es.hairType!=="Natural"&&ss.forEach(ns=>{const os=es[ns];(Array.isArray(os)&&os.length>0||typeof os=="string"&&os.trim()!=="")&&rs++}),rs},countSFXFields=es=>{if(!es.sfxRequired)return 0;let ts=0;return es.sfxTypes.length>0&&ts++,es.prostheticPieces.trim()!==""&&ts++,es.prostheticAdhesive.trim()!==""&&ts++,es.bloodTypes.length>0&&ts++,es.bloodProducts.trim()!==""&&ts++,es.bloodPlacement.trim()!==""&&ts++,es.tattooCoverage.trim()!==""&&ts++,es.temporaryTattoos.trim()!==""&&ts++,es.contactLenses.trim()!==""&&ts++,es.teeth.trim()!==""&&ts++,es.agingCharacterNotes.trim()!==""&&ts++,es.sfxApplicationTime!==null&&es.sfxApplicationTime>0&&ts++,es.sfxReferencePhotos.length>0&&ts++,ts},DAY_TYPE_LABELS={SWD:"Standard Working Day",CWD:"Continuous Working Day",SCWD:"Semi-Continuous Working Day"};function parseDayTypeFromString(es){if(!es)return"SWD";const ts=es.toUpperCase();return ts.includes("SEMI-CONTINUOUS")||ts.includes("SEMI CONTINUOUS")||ts.includes("SCWD")||ts.includes("SHORT CONTINUOUS")?"SCWD":ts.includes("CONTINUOUS")||ts.includes("CWD")?"CWD":"SWD"}const getLunchDurationForDayType=es=>{switch(es){case"SWD":return 60;case"SCWD":return 30;case"CWD":return 0;default:return 60}},createDefaultRateCard=()=>({dailyRate:0,baseDayHours:11,baseContract:"11+1",dayType:"SWD",otMultiplier:1.5,lateNightMultiplier:2,preCallMultiplier:1.5,sixthDayMultiplier:1.5,seventhDayMultiplier:2,kitRental:0,lunchDuration:60}),createEmptyTimesheetEntry=es=>({id:`entry-${es}`,date:es,dayType:"SWD",preCall:"",unitCall:"",lunchStart:"",lunchEnd:"",outOfChair:"",wrapOut:"",lunchTaken:60,isSixthDay:!1,isSeventhDay:!1,notes:"",status:"draft"}),CURRENCIES=[{code:"GBP",symbol:"",name:"British Pound",locale:"en-GB"},{code:"USD",symbol:"$",name:"US Dollar",locale:"en-US"},{code:"EUR",symbol:"",name:"Euro",locale:"de-DE"},{code:"CAD",symbol:"C$",name:"Canadian Dollar",locale:"en-CA"},{code:"AUD",symbol:"A$",name:"Australian Dollar",locale:"en-AU"}],DEFAULT_CURRENCY="GBP",getCurrencyByCode=es=>CURRENCIES.find(ts=>ts.code===es)||CURRENCIES[0],formatCurrency=(es,ts=DEFAULT_CURRENCY)=>`${getCurrencyByCode(ts).symbol}${es.toFixed(2)}`,createEmptyBillingDetails=()=>({fullName:"",businessName:"",address:"",phone:"",email:"",bankDetails:{accountName:"",sortCode:"",accountNumber:""},paymentTerms:"Payment within 30 days",vatSettings:{isVATRegistered:!1,vatNumber:"",vatRate:20}}),EXPORT_DOCUMENTS=[{id:"continuity_bible",name:"Continuity Bible",description:"Complete reference document - all characters, all looks, all scenes with photos",format:"pdf",selected:!0},{id:"scene_breakdown",name:"Scene Breakdown",description:"Spreadsheet of all scenes with H&MU details per character",format:"csv",selected:!0},{id:"character_lookbooks",name:"Character Lookbooks",description:"Individual PDFs per character with all their looks",format:"pdf_zip",selected:!0},{id:"photo_archive",name:"Photo Archive",description:"All captured photos organized by character/scene",format:"zip",selected:!0},{id:"timesheets",name:"Timesheets",description:"All logged hours for the production",format:"pdf",selected:!0},{id:"invoice_summary",name:"Invoice Summary",description:"Total hours, rates, kit rental for invoicing",format:"pdf",selected:!1}],PROJECT_RETENTION_DAYS=90,REMINDER_INTERVAL_DAYS=7,INACTIVITY_TRIGGER_DAYS=30,createDefaultLifecycle=()=>({state:"active",lastActivityAt:new Date}),calculateDaysUntilDeletion=es=>{const ts=new Date,ss=new Date(es);ss.setDate(ss.getDate()+PROJECT_RETENTION_DAYS);const rs=ss.getTime()-ts.getTime();return Math.max(0,Math.ceil(rs/(1e3*60*60*24)))},PRODUCTION_TYPES=[{value:"film",label:"Film"},{value:"tv_series",label:"TV Series"},{value:"short_film",label:"Short Film"},{value:"commercial",label:"Commercial"},{value:"music_video",label:"Music Video"},{value:"other",label:"Other"}],PROJECT_CODE_CHARS="ABCDEFGHJKMNPQRSTUVWXYZ23456789",generateProjectCode=()=>{let es="";for(let ts=0;ts<3;ts++)es+=PROJECT_CODE_CHARS.charAt(Math.floor(Math.random()*23));es+="-";for(let ts=0;ts<4;ts++)es+=PROJECT_CODE_CHARS.charAt(Math.floor(Math.random()*PROJECT_CODE_CHARS.length));return es},isValidProjectCode=es=>/^[ABCDEFGHJKMNPQRSTUVWXYZ]{3}-[ABCDEFGHJKMNPQRSTUVWXYZ23456789]{4}$/.test(es.toUpperCase()),formatProjectCode=es=>{const ts=es.toUpperCase().replace(/[^ABCDEFGHJKMNPQRSTUVWXYZ23456789]/g,"");return ts.length<=3?ts:ts.slice(0,3)+"-"+ts.slice(3,7)},TIER_LIMITS={trainee:{maxProjects:3,maxArchivedProjects:1,canCreateProjects:!1},artist:{maxProjects:10,maxArchivedProjects:-1,canCreateProjects:!1},supervisor:{maxProjects:25,maxArchivedProjects:15,canCreateProjects:!0},designer:{maxProjects:-1,maxArchivedProjects:-1,canCreateProjects:!0}},shouldTriggerWrap=(es,ts)=>{if(ts.state!=="active")return{trigger:!1};if(es.scenes.length>0&&es.scenes.every(as=>as.isComplete))return{trigger:!0,reason:"all_scenes_complete"};const rs=new Date,ns=new Date(ts.lastActivityAt);return Math.floor((rs.getTime()-ns.getTime())/(1e3*60*60*24))>=INACTIVITY_TRIGGER_DAYS?{trigger:!0,reason:"inactivity"}:{trigger:!1}},TEAM_MEMBER_ROLES=[{value:"designer",label:"Designer (HoD)",level:8},{value:"supervisor",label:"Supervisor",level:7},{value:"key",label:"Key Artist",level:6},{value:"hair",label:"Hair Artist",level:5},{value:"makeup",label:"Makeup Artist",level:4},{value:"sfx",label:"Special Effects Artist",level:3},{value:"daily",label:"Daily",level:2},{value:"trainee",label:"Trainee",level:1}],getTeamMemberRoleLabel=es=>{var ts;return((ts=TEAM_MEMBER_ROLES.find(ss=>ss.value===es))==null?void 0:ts.label)||es},PERMISSION_LEVELS=[{value:"all",label:"All team members"},{value:"key_plus",label:"Key artists and above"},{value:"supervisor_plus",label:"Supervisors only"}],groupTeamMembersByRole=es=>{const ts=new Map;return TEAM_MEMBER_ROLES.forEach(ss=>{ts.set(ss.value,[])}),es.forEach(ss=>{const rs=ts.get(ss.role);rs&&rs.push(ss)}),ts.forEach(ss=>{ss.sort((rs,ns)=>rs.name.localeCompare(ns.name))}),TEAM_MEMBER_ROLES.filter(ss=>{var rs;return(((rs=ts.get(ss.value))==null?void 0:rs.length)||0)>0}).map(ss=>({role:ss.value,label:ss.label+"s",members:ts.get(ss.value)||[]}))},canManageProject=(es,ts)=>{if(!ts)return!1;if(ts.isOwner)return!0;const ss=["designer","supervisor"];return["supervisor","designer"].includes(es)&&ss.includes(ts.role)},createDefaultProjectPermissions=()=>({addPhotos:"all",editNotes:"all",markComplete:"key_plus"}),formatStorageSize=es=>{if(es===0)return"0 B";const ts=1024,ss=["B","KB","MB","GB","TB"],rs=Math.floor(Math.log(es)/Math.log(ts));return parseFloat((es/Math.pow(ts,rs)).toFixed(1))+" "+ss[rs]},CHARACTER_COLORS=["#C9A961","#8B5CF6","#EC4899","#10B981","#F59E0B","#EF4444","#3B82F6","#6366F1","#14B8A6","#F97316"];function normalizeNameForMatch(es){return es.toUpperCase().replace(/^\d+\.\s*/,"").replace(/[^A-Z\s]/g,"").replace(/\s+/g," ").trim()}function findMatchingCharacter(es,ts){const ss=normalizeNameForMatch(es);if(!ss)return null;const rs=ts.find(os=>normalizeNameForMatch(os.name)===ss);return rs||ts.find(os=>{const as=normalizeNameForMatch(os.name);return as.includes(ss)||ss.includes(as)||as.split(" ")[0]===ss.split(" ")[0]})||null}function createCharacterFromName(es,ts){const ss=`char-${v4().slice(0,8)}`,rs=es.replace(/^\d+\.\s*/,"").trim(),ns=rs.split(" ").map(as=>as[0]).join("").slice(0,2).toUpperCase(),os=CHARACTER_COLORS[ts%CHARACTER_COLORS.length];return{id:ss,name:rs,initials:ns||"??",avatarColour:os}}function getTimeOrder(es){const ts=es.toUpperCase().trim();return ts.includes("MORN")||ts==="DAWN"||ts==="SUNRISE"?0:ts.includes("DAY")||ts==="D"||ts.includes("AFTERNOON")?1:ts.includes("EVEN")||ts==="DUSK"||ts==="SUNSET"?2:ts.includes("NIGHT")||ts==="N"?3:-1}function isExplicitNewDay(es){const ts=es.toUpperCase().trim();return!!(/\bNEXT\s+(DAY|MORNING|EVENING|NIGHT|AFTERNOON)\b/.test(ts)||/\bFOLLOWING\s+(DAY|MORNING|EVENING|NIGHT|AFTERNOON)\b/.test(ts)||/\bNEW\s+DAY\b/.test(ts)||/\b\d+\s+(DAYS?|WEEKS?|MONTHS?|YEARS?)\s+LATER\b/.test(ts)||/\b(ONE|TWO|THREE|FOUR|FIVE|SIX|SEVEN|SEVERAL|FEW|SOME)\s+(DAYS?|WEEKS?|MONTHS?|YEARS?)\s+LATER\b/.test(ts))}function isNewStoryDay(es,ts,ss){return isExplicitNewDay(ss)?!0:es<0||ts<0?!1:es>=2&&ts<=1||es===1&&ts===0}function buildStoryDayMap(es,ts){const ss=new Map,rs=new Map;for(const ds of es.days)for(const ms of ds.scenes){const ps=ms.sceneNumber.replace(/\s+/g,"").toUpperCase();rs.set(ps,ms.dayNight)}for(const ds of ts){const ms=ds.sceneNumber.replace(/\s+/g,"").toUpperCase();rs.has(ms)||rs.set(ms,ds.timeOfDay)}const ns=new Map;for(const ds of ts){const ms=ds.sceneNumber.replace(/\s+/g,"").toUpperCase();if(ds.slugline){const ps=ds.slugline.match(/[-]\s*([^-]+)$/);ps&&ns.set(ms,ps[1].trim())}}const os=/^[DN](\d+)/i;let as=!1;for(const[ds,ms]of rs){const ps=ms.match(os);ps&&(as=!0,ss.set(ds,parseInt(ps[1],10)))}if(as&&ss.size>0)return console.log("[CastSync] Story days from explicit D1/D2/N1 markers:",ss.size,"scenes mapped"),ss;const ls=Array.from(rs.keys()).sort((ds,ms)=>ds.localeCompare(ms,void 0,{numeric:!0}));let cs=1,us=-1;for(const ds of ls){const ms=rs.get(ds)||"",ps=ns.get(ds)||"",hs=ps.length>ms.length?ps:ms,xs=getTimeOrder(ms);isNewStoryDay(us,xs,hs)&&cs++,ss.set(ds,cs),xs>=0&&(us=xs)}return console.log("[CastSync] Story days inferred from time-of-day transitions:",cs,"days detected"),ss}function createLooksForCharacter(es,ts,ss){const rs=new Map;for(const as of ts){const ls=as.replace(/\s+/g,"").toUpperCase(),cs=ss.get(ls)||1;rs.has(cs)||rs.set(cs,[]),rs.get(cs).push(as)}const ns=Array.from(rs.keys()).sort((as,ls)=>as-ls),os=[];for(const as of ns){const ls=rs.get(as).sort((cs,us)=>cs.localeCompare(us,void 0,{numeric:!0}));os.push({id:`look-${es.id}-day${as}`,characterId:es.id,name:`Day ${as}`,scenes:ls,estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()})}return os.length===0&&os.push({id:`look-${es.id}`,characterId:es.id,name:"Day 1",scenes:[],estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()}),os}function getCharacterNameFromCastNumber(es,ts){const ss=ts.castList.find(rs=>rs.number===es);return ss?ss.character||ss.name:null}function buildSceneCastMap(es){const ts=new Map;for(const ss of es.days)for(const rs of ss.scenes){const ns=rs.sceneNumber.replace(/\s+/g,"").toUpperCase();rs.castNumbers&&rs.castNumbers.length>0&&ts.set(ns,rs.castNumbers)}return ts}function syncCastDataToScenes(es,ts,ss,rs,ns={}){const{createMissingCharacters:os=!0,overwriteExisting:as=!1,autoConfirm:ls=!0}=ns,cs={success:!0,scenesUpdated:0,charactersCreated:0,errors:[],sceneResults:[]},us=buildSceneCastMap(es),ds=buildStoryDayMap(es,ts);console.log("[CastSync] Scene cast map built:",Object.fromEntries(us));const ms=[],ps=new Map,hs=ts.map(gs=>({...gs})),xs=[...ss];for(const gs of hs){const fs=gs.sceneNumber.replace(/\s+/g,"").toUpperCase(),js=us.get(fs);if(!js||js.length===0||!as&&gs.characters.length>0&&gs.characterConfirmationStatus==="confirmed")continue;const Ss=[];for(const Rs of js){const ws=getCharacterNameFromCastNumber(Rs,es);ws?Ss.push(ws):cs.errors.push(`Scene ${gs.sceneNumber}: Cast #${Rs} not found in cast list`)}const bs=[],Es=[];for(const Rs of Ss){let ws=findMatchingCharacter(Rs,[...xs,...ms]);!ws&&os&&(ws=createCharacterFromName(Rs,xs.length+ms.length),ms.push(ws),Es.push(ws.id),ps.set(ws.id,[]),cs.charactersCreated++),ws&&(bs.push(ws.id),ps.has(ws.id)&&ps.get(ws.id).push(gs.sceneNumber))}bs.length>0&&(ls?(gs.characters=bs,gs.characterConfirmationStatus="confirmed",gs.suggestedCharacters=void 0):(gs.suggestedCharacters=Ss,gs.characterConfirmationStatus="ready"),cs.scenesUpdated++),cs.sceneResults.push({sceneNumber:gs.sceneNumber,castNumbers:js,characterNames:Ss,matchedCharacterIds:bs.filter(Rs=>!Es.includes(Rs)),newCharacterIds:Es})}xs.push(...ms);const ys=[];for(const gs of ms){const fs=ps.get(gs.id)||[],js=createLooksForCharacter(gs,fs,ds);ys.push(...js)}const vs=rs.map(gs=>{const fs=[];for(const js of hs)js.characters.includes(gs.characterId)&&!gs.scenes.includes(js.sceneNumber)&&fs.push(js.sceneNumber);return fs.length>0?{...gs,scenes:[...gs.scenes,...fs].sort((js,Ss)=>js.localeCompare(Ss,void 0,{numeric:!0}))}:gs});return vs.push(...ys),console.log("[CastSync] Sync complete:",{scenesUpdated:cs.scenesUpdated,charactersCreated:cs.charactersCreated,errors:cs.errors}),{result:cs,updatedScenes:hs,updatedCharacters:xs,updatedLooks:vs}}function canSyncCastData(es){return es?es.castList.length===0?{canSync:!1,reason:"Schedule has no cast list"}:es.status!=="complete"?{canSync:!1,reason:"Schedule processing not complete. Run AI analysis first."}:!es.days||es.days.length===0?{canSync:!1,reason:"Schedule has no shooting days. Run AI analysis first."}:es.days.some(ss=>ss.scenes.some(rs=>rs.castNumbers&&rs.castNumbers.length>0))?{canSync:!0}:{canSync:!1,reason:"No cast data found in schedule scenes"}:{canSync:!1,reason:"No schedule uploaded"}}function calculateTextSimilarity(es,ts){if(!es&&!ts)return 100;if(!es||!ts)return 0;const ss=us=>us.toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim(),rs=ss(es),ns=ss(ts);if(rs===ns)return 100;const os=new Set(rs.split(" ").filter(us=>us.length>2)),as=new Set(ns.split(" ").filter(us=>us.length>2));if(os.size===0&&as.size===0)return 100;if(os.size===0||as.size===0)return 0;const ls=new Set([...os].filter(us=>as.has(us))),cs=new Set([...os,...as]);return Math.round(ls.size/cs.size*100)}function describeChanges(es,ts,ss){return!es&&ts?"New scene added":es&&!ts?"Scene removed from script":ss>=95?"Minor formatting changes":ss>=80?"Minor dialogue or action changes":ss>=50?"Significant content changes":"Major rewrite of scene"}function compareScriptAmendment(es,ts){const ss=[],rs=new Set,ns=new Set,os=new Map(es.map(ps=>[ps.sceneNumber,ps]));for(const ps of ts){const hs=os.get(ps.sceneNumber);if(ns.add(ps.sceneNumber),!hs)ss.push({sceneNumber:ps.sceneNumber,status:"new",newScene:ps,changeDescription:"New scene added to script"});else{rs.add(ps.sceneNumber);const xs=calculateTextSimilarity(hs.scriptContent||"",ps.scriptContent||"");xs>=95?ss.push({sceneNumber:ps.sceneNumber,status:"unchanged",existingScene:hs,newScene:ps,changeDescription:"No significant changes",contentSimilarity:xs}):ss.push({sceneNumber:ps.sceneNumber,status:"modified",existingScene:hs,newScene:ps,changeDescription:describeChanges(hs.scriptContent,ps.scriptContent,xs),contentSimilarity:xs})}}for(const ps of es)rs.has(ps.sceneNumber)||ss.push({sceneNumber:ps.sceneNumber,status:"deleted",existingScene:ps,changeDescription:"Scene removed from script"});ss.sort((ps,hs)=>{const xs=parseFloat(ps.sceneNumber.replace(/[A-Z]/g,".5"))||0,ys=parseFloat(hs.sceneNumber.replace(/[A-Z]/g,".5"))||0;return xs-ys});const as=ss.filter(ps=>ps.status==="new"),ls=ss.filter(ps=>ps.status==="modified"),cs=ss.filter(ps=>ps.status==="deleted"),us=ss.filter(ps=>ps.status==="unchanged"),ds=[];as.length>0&&ds.push(`${as.length} new scene${as.length>1?"s":""}`),ls.length>0&&ds.push(`${ls.length} modified scene${ls.length>1?"s":""}`),cs.length>0&&ds.push(`${cs.length} deleted scene${cs.length>1?"s":""}`);const ms=ds.length>0?ds.join(", "):"No changes detected";return{changes:ss,newScenes:as,modifiedScenes:ls,deletedScenes:cs,unchangedScenes:us,summary:ms}}function applyAmendmentToScenes(es,ts,ss={includeNew:!0,includeModified:!0,includeDeleted:!1}){const rs=new Date().toISOString(),ns=new Map(es.map(os=>[os.sceneNumber,{...os}]));for(const os of ts.changes)if(os.status==="new"&&ss.includeNew&&os.newScene){const as={id:`scene-${os.newScene.sceneNumber}-${Date.now()}`,sceneNumber:os.newScene.sceneNumber,slugline:os.newScene.slugline,intExt:os.newScene.intExt,timeOfDay:os.newScene.timeOfDay,scriptContent:os.newScene.scriptContent,characters:[],isComplete:!1,amendmentStatus:"new",amendmentDate:rs,amendmentNotes:"New scene added in script revision"};ns.set(os.sceneNumber,as)}else if(os.status==="modified"&&ss.includeModified&&os.newScene){const as=ns.get(os.sceneNumber);as&&ns.set(os.sceneNumber,{...as,slugline:os.newScene.slugline,intExt:os.newScene.intExt,timeOfDay:os.newScene.timeOfDay,scriptContent:os.newScene.scriptContent,previousScriptContent:as.scriptContent,amendmentStatus:"modified",amendmentDate:rs,amendmentNotes:os.changeDescription})}else if(os.status==="deleted"&&ss.includeDeleted){const as=ns.get(os.sceneNumber);as&&ns.set(os.sceneNumber,{...as,amendmentStatus:"deleted",amendmentDate:rs,amendmentNotes:"Scene removed in script revision"})}else if(os.status==="unchanged"){const as=ns.get(os.sceneNumber);as&&as.amendmentStatus&&ns.set(os.sceneNumber,{...as,amendmentStatus:"unchanged"})}return Array.from(ns.values()).sort((os,as)=>{const ls=parseFloat(os.sceneNumber.replace(/[A-Z]/g,".5"))||0,cs=parseFloat(as.sceneNumber.replace(/[A-Z]/g,".5"))||0;return ls-cs})}function clearAmendmentFlags(es){return es.map(ts=>({...ts,amendmentStatus:void 0,previousScriptContent:void 0,amendmentNotes:void 0}))}function getAmendmentCount(es){const ts=es.filter(ns=>ns.amendmentStatus==="new").length,ss=es.filter(ns=>ns.amendmentStatus==="modified").length,rs=es.filter(ns=>ns.amendmentStatus==="deleted").length;return{total:ts+ss+rs,new:ts,modified:ss,deleted:rs}}const useProjectStore=create()(persist((es,ts)=>({currentProject:null,currentSceneId:null,currentCharacterId:null,currentLookId:null,activeTab:"today",sceneFilter:"all",searchQuery:"",needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null,savedProjects:{},archivedProjects:[],setProject:ss=>es({currentProject:ss,needsSetup:!1,lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}),setProjectNeedsSetup:ss=>es({currentProject:ss,needsSetup:!0,lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}),clearNeedsSetup:()=>es({needsSetup:!1}),setScriptPdf:ss=>es(rs=>({currentProject:rs.currentProject?{...rs.currentProject,scriptPdfData:ss}:null})),clearProject:()=>es({currentProject:null,currentSceneId:null,currentCharacterId:null,needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}),saveAndClearProject:()=>{const ss=ts();if(ss.currentProject){const rs=ss.currentProject.id,ns=ss.currentProject,os=ss.sceneCaptures,as=ss.lifecycle,ls=ss.needsSetup;useScheduleStore.getState().saveScheduleForProject(rs),es(cs=>({savedProjects:{...cs.savedProjects,[rs]:{project:ns,sceneCaptures:os,lifecycle:as,needsSetup:ls}},currentProject:null,currentSceneId:null,currentCharacterId:null,needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}))}else useScheduleStore.getState().clearScheduleForProject(),es({currentProject:null,currentSceneId:null,currentCharacterId:null,needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null})},restoreSavedProject:ss=>{const rs=ts(),ns=rs.savedProjects[ss];if(!ns)return!1;const os={...rs.savedProjects};return delete os[ss],useScheduleStore.getState().restoreScheduleForProject(ss),es({currentProject:ns.project,sceneCaptures:ns.sceneCaptures,lifecycle:ns.lifecycle,needsSetup:ns.needsSetup,savedProjects:os,currentSceneId:null,currentCharacterId:null,showWrapPopup:!1,wrapTriggerReason:null}),!0},hasSavedProject:ss=>!!ts().savedProjects[ss],removeSavedProject:ss=>{const rs={...ts().savedProjects};delete rs[ss],es({savedProjects:rs})},setActiveTab:ss=>es({activeTab:ss}),setCurrentScene:ss=>es({currentSceneId:ss}),setCurrentCharacter:ss=>es({currentCharacterId:ss}),setCurrentLook:ss=>es({currentLookId:ss}),setSceneFilter:ss=>es({sceneFilter:ss}),setSearchQuery:ss=>es({searchQuery:ss}),getOrCreateSceneCapture:(ss,rs)=>{var ds,ms,ps;const ns=ts(),os=`${ss}-${rs}`,as=ns.sceneCaptures[os];if(as)return as;const ls=(ms=(ds=ns.currentProject)==null?void 0:ds.scenes.find(hs=>hs.id===ss))==null?void 0:ms.sceneNumber,cs=(ps=ns.currentProject)==null?void 0:ps.looks.find(hs=>hs.characterId===rs&&ls!==void 0&&hs.scenes.includes(ls)),us={id:os,sceneId:ss,characterId:rs,lookId:(cs==null?void 0:cs.id)??"",capturedAt:new Date,photos:{},additionalPhotos:[],continuityFlags:createEmptyContinuityFlags(),continuityEvents:[],sfxDetails:createEmptySFXDetails(),notes:""};return es(hs=>({sceneCaptures:{...hs.sceneCaptures,[os]:us}})),us},updateSceneCapture:(ss,rs)=>{es(ns=>({sceneCaptures:{...ns.sceneCaptures,[ss]:{...ns.sceneCaptures[ss],...rs}}}))},addPhotoToCapture:(ss,rs,ns)=>{es(os=>{const as=os.sceneCaptures[ss];return as?ns==="additional"?{sceneCaptures:{...os.sceneCaptures,[ss]:{...as,additionalPhotos:[...as.additionalPhotos,rs]}}}:{sceneCaptures:{...os.sceneCaptures,[ss]:{...as,photos:{...as.photos,[ns]:rs}}}}:os})},removePhotoFromCapture:(ss,rs,ns)=>{es(os=>{const as=os.sceneCaptures[ss];if(!as)return os;if(rs==="additional"&&ns)return{sceneCaptures:{...os.sceneCaptures,[ss]:{...as,additionalPhotos:as.additionalPhotos.filter(us=>us.id!==ns)}}};const ls=rs,cs={...as.photos};return delete cs[ls],{sceneCaptures:{...os.sceneCaptures,[ss]:{...as,photos:cs}}}})},toggleContinuityFlag:(ss,rs)=>{es(ns=>{const os=ns.sceneCaptures[ss];return os?{sceneCaptures:{...ns.sceneCaptures,[ss]:{...os,continuityFlags:{...os.continuityFlags,[rs]:!os.continuityFlags[rs]}}}}:ns})},addContinuityEvent:(ss,rs)=>{es(ns=>{const os=ns.sceneCaptures[ss];return os?{sceneCaptures:{...ns.sceneCaptures,[ss]:{...os,continuityEvents:[...os.continuityEvents,rs]}}}:ns})},updateContinuityEvent:(ss,rs,ns)=>{es(os=>{const as=os.sceneCaptures[ss];return as?{sceneCaptures:{...os.sceneCaptures,[ss]:{...as,continuityEvents:as.continuityEvents.map(ls=>ls.id===rs?{...ls,...ns}:ls)}}}:os})},removeContinuityEvent:(ss,rs)=>{es(ns=>{const os=ns.sceneCaptures[ss];return os?{sceneCaptures:{...ns.sceneCaptures,[ss]:{...os,continuityEvents:os.continuityEvents.filter(as=>as.id!==rs)}}}:ns})},updateSFXDetails:(ss,rs)=>{es(ns=>{const os=ns.sceneCaptures[ss];return os?{sceneCaptures:{...ns.sceneCaptures,[ss]:{...os,sfxDetails:rs}}}:ns})},addSFXPhoto:(ss,rs)=>{es(ns=>{const os=ns.sceneCaptures[ss];return os?{sceneCaptures:{...ns.sceneCaptures,[ss]:{...os,sfxDetails:{...os.sfxDetails,sfxReferencePhotos:[...os.sfxDetails.sfxReferencePhotos,rs]}}}}:ns})},removeSFXPhoto:(ss,rs)=>{es(ns=>{const os=ns.sceneCaptures[ss];return os?{sceneCaptures:{...ns.sceneCaptures,[ss]:{...os,sfxDetails:{...os.sfxDetails,sfxReferencePhotos:os.sfxDetails.sfxReferencePhotos.filter(as=>as.id!==rs)}}}}:ns})},addScene:ss=>{const rs={id:`scene-${ss.sceneNumber}-${Date.now()}`,sceneNumber:ss.sceneNumber,slugline:ss.slugline||`Scene ${ss.sceneNumber}`,intExt:ss.intExt||"INT",timeOfDay:ss.timeOfDay||"DAY",synopsis:ss.synopsis,scriptContent:ss.scriptContent,characters:ss.characters||[],isComplete:!1,characterConfirmationStatus:"confirmed",shootingDay:ss.shootingDay};return es(ns=>{if(!ns.currentProject)return ns;const os=[...ns.currentProject.scenes,rs].sort((as,ls)=>{const cs=parseInt(as.sceneNumber.replace(/\D/g,""))||0,us=parseInt(ls.sceneNumber.replace(/\D/g,""))||0;return cs!==us?cs-us:as.sceneNumber.localeCompare(ls.sceneNumber)});return{currentProject:{...ns.currentProject,scenes:os}}}),rs},addCharacterToScene:(ss,rs)=>{es(ns=>ns.currentProject?{currentProject:{...ns.currentProject,scenes:ns.currentProject.scenes.map(os=>os.id===ss&&!os.characters.includes(rs)?{...os,characters:[...os.characters,rs]}:os)}}:ns)},markSceneComplete:ss=>{es(rs=>rs.currentProject?{currentProject:{...rs.currentProject,scenes:rs.currentProject.scenes.map(ns=>ns.id===ss?{...ns,isComplete:!0,completedAt:new Date}:ns)}}:rs)},markSceneIncomplete:ss=>{es(rs=>rs.currentProject?{currentProject:{...rs.currentProject,scenes:rs.currentProject.scenes.map(ns=>ns.id===ss?{...ns,isComplete:!1,completedAt:void 0}:ns)}}:rs)},copyToNextScene:(ss,rs)=>{const ns=ts();if(!ns.currentProject)return null;const os=ns.currentProject.scenes.find(ds=>ds.id===ss);if(!os)return null;const as=ns.currentProject.scenes.find(ds=>ds.sceneNumber>os.sceneNumber&&ds.characters.includes(rs));if(!as)return null;const ls=ns.sceneCaptures[`${ss}-${rs}`];if(!ls)return as.id;const cs=`${as.id}-${rs}`,us={id:cs,sceneId:as.id,characterId:rs,lookId:ls.lookId,capturedAt:new Date,photos:{},additionalPhotos:[],continuityFlags:{...ls.continuityFlags},continuityEvents:ls.continuityEvents.map(ds=>({...ds,id:v4()})),sfxDetails:{...ls.sfxDetails,sfxReferencePhotos:[]},notes:ls.notes,applicationTime:ls.applicationTime};return es(ds=>({sceneCaptures:{...ds.sceneCaptures,[cs]:us},currentSceneId:as.id})),as.id},updateSceneFilmingStatus:(ss,rs,ns)=>{es(os=>os.currentProject?{currentProject:{...os.currentProject,scenes:os.currentProject.scenes.map(as=>as.sceneNumber===ss?{...as,filmingStatus:rs,filmingNotes:ns}:as)}}:os)},updateSceneSynopsis:(ss,rs)=>{es(ns=>ns.currentProject?{currentProject:{...ns.currentProject,scenes:ns.currentProject.scenes.map(os=>os.id===ss?{...os,synopsis:rs}:os)}}:ns)},updateAllSceneSynopses:ss=>{es(rs=>{if(!rs.currentProject)return rs;const ns=new Map;return ss.forEach(os=>{os.synopsis&&ns.set(os.id,os.synopsis)}),{currentProject:{...rs.currentProject,scenes:rs.currentProject.scenes.map(os=>{const as=ns.get(os.id);return as?{...os,synopsis:as}:os})}}})},updateLook:(ss,rs)=>{es(ns=>ns.currentProject?{currentProject:{...ns.currentProject,looks:ns.currentProject.looks.map(os=>os.id===ss?{...os,...rs}:os)}}:ns)},updateLookWithPropagation:(ss,rs)=>{const ns=ts();if(!ns.currentProject)return;const os=ns.currentProject.looks.find(cs=>cs.id===ss);if(!os)return;es(cs=>cs.currentProject?{currentProject:{...cs.currentProject,looks:cs.currentProject.looks.map(us=>us.id===ss?{...us,...rs}:us)}}:cs);const as={...ns.sceneCaptures};let ls=!1;for(const cs of os.scenes){const us=ns.currentProject.scenes.find(hs=>hs.sceneNumber===cs);if(!us)continue;const ds=`${us.id}-${os.characterId}`,ms=as[ds];if(!ms)continue;const ps={};if(rs.continuityFlags){const hs=ms.continuityFlags;!hs.sweat&&!hs.dishevelled&&!hs.blood&&!hs.dirt&&!hs.wetHair&&!hs.tears&&(ps.continuityFlags={...rs.continuityFlags})}rs.notes!==void 0&&!ms.notes&&(ps.notes=rs.notes),rs.sfxDetails&&!ms.sfxDetails.sfxRequired&&ms.sfxDetails.sfxTypes.length===0&&(ps.sfxDetails={...rs.sfxDetails}),Object.keys(ps).length>0&&(as[ds]={...ms,...ps},ls=!0)}ls&&es({sceneCaptures:as})},getCastProfile:ss=>{var ns;const rs=ts();if(rs.currentProject)return(ns=rs.currentProject.castProfiles)==null?void 0:ns.find(os=>os.characterId===ss)},updateCastProfile:(ss,rs)=>{es(ns=>{if(!ns.currentProject)return ns;const os=ns.currentProject.castProfiles||[],as=os.findIndex(cs=>cs.characterId===ss);let ls;if(as>=0)ls=os.map((cs,us)=>us===as?{...cs,...rs}:cs);else{const cs={...createEmptyCastProfile(ss),...rs};ls=[...os,cs]}return{currentProject:{...ns.currentProject,castProfiles:ls}}})},startCharacterDetection:()=>{es(ss=>ss.currentProject?{currentProject:{...ss.currentProject,characterDetectionStatus:"running",scenes:ss.currentProject.scenes.map(rs=>({...rs,characterConfirmationStatus:rs.characterConfirmationStatus==="confirmed"?"confirmed":"detecting"}))}}:ss)},setCharacterDetectionStatus:ss=>{es(rs=>rs.currentProject?{currentProject:{...rs.currentProject,characterDetectionStatus:ss}}:rs)},updateSceneSuggestedCharacters:(ss,rs)=>{es(ns=>ns.currentProject?{currentProject:{...ns.currentProject,scenes:ns.currentProject.scenes.map(os=>os.id===ss?{...os,suggestedCharacters:rs,characterConfirmationStatus:os.characterConfirmationStatus==="confirmed"?"confirmed":"ready"}:os)}}:ns)},updateSceneConfirmationStatus:(ss,rs)=>{es(ns=>ns.currentProject?{currentProject:{...ns.currentProject,scenes:ns.currentProject.scenes.map(os=>os.id===ss?{...os,characterConfirmationStatus:rs}:os)}}:ns)},confirmSceneCharacters:(ss,rs)=>{es(ns=>{if(!ns.currentProject)return ns;const os=ns.currentProject.scenes.find(xs=>xs.id===ss),as=(os==null?void 0:os.characters)||[],ls=ns.currentProject.scenes.map(xs=>xs.id===ss?{...xs,characters:rs,characterConfirmationStatus:"confirmed",suggestedCharacters:void 0}:xs),cs=ls.filter(xs=>xs.characterConfirmationStatus==="confirmed").length,us=ls.find(xs=>xs.id===ss),ds=as.filter(xs=>!rs.includes(xs)),ms=new Set;for(const xs of ns.currentProject.looks)us&&xs.scenes.includes(us.sceneNumber)&&ms.add(xs.characterId);const ps=new Set,hs=ns.currentProject.looks.map(xs=>us?ds.includes(xs.characterId)&&xs.scenes.includes(us.sceneNumber)?{...xs,scenes:xs.scenes.filter(ys=>ys!==us.sceneNumber)}:rs.includes(xs.characterId)&&!ms.has(xs.characterId)&&!ps.has(xs.characterId)?(ps.add(xs.characterId),{...xs,scenes:[...xs.scenes,us.sceneNumber].sort((ys,vs)=>ys.localeCompare(vs,void 0,{numeric:!0}))}):xs:xs);return{currentProject:{...ns.currentProject,scenes:ls,looks:hs,scenesConfirmed:cs}}})},addCharacterFromScene:(ss,rs)=>{const ns=ts();if(!ns.currentProject)throw new Error("No project loaded");const os=`char-${v4().slice(0,8)}`,as=rs.split(" ").map(ms=>ms[0]).join("").slice(0,2),ls=["#C9A961","#8B5CF6","#EC4899","#10B981","#F59E0B","#EF4444","#3B82F6","#6366F1"],cs=ls[ns.currentProject.characters.length%ls.length],us={id:os,name:rs,initials:as,avatarColour:cs},ds=ns.currentProject.scenes.find(ms=>ms.id===ss);return es(ms=>{if(!ms.currentProject)return ms;const ps={id:`look-${us.id}`,characterId:us.id,name:"Day 1",scenes:ds?[ds.sceneNumber]:[],estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()};return{currentProject:{...ms.currentProject,characters:[...ms.currentProject.characters,us],looks:[...ms.currentProject.looks,ps]}}}),us},getUnconfirmedScenesCount:()=>{const ss=ts();return ss.currentProject?ss.currentProject.scenes.filter(rs=>rs.characterConfirmationStatus!=="confirmed").length:0},getConfirmedScenesCount:()=>{const ss=ts();return ss.currentProject?ss.currentProject.scenes.filter(rs=>rs.characterConfirmationStatus==="confirmed").length:0},getScene:ss=>{var rs;return(rs=ts().currentProject)==null?void 0:rs.scenes.find(ns=>ns.id===ss)},getCharacter:ss=>{var rs;return(rs=ts().currentProject)==null?void 0:rs.characters.find(ns=>ns.id===ss)},getLookForCharacterInScene:(ss,rs)=>{var ns;return(ns=ts().currentProject)==null?void 0:ns.looks.find(os=>os.characterId===ss&&os.scenes.includes(rs))},getSceneCapture:(ss,rs)=>ts().sceneCaptures[`${ss}-${rs}`],getFilteredScenes:()=>{const ss=ts();if(!ss.currentProject)return[];let rs=[...ss.currentProject.scenes];if(ss.sceneFilter==="complete"?rs=rs.filter(ns=>ns.isComplete):ss.sceneFilter==="incomplete"&&(rs=rs.filter(ns=>!ns.isComplete)),ss.searchQuery){const ns=ss.searchQuery.toLowerCase();rs=rs.filter(os=>os.sceneNumber.toString().includes(ns)||os.slugline.toLowerCase().includes(ns))}return rs.sort((ns,os)=>ns.sceneNumber.localeCompare(os.sceneNumber,void 0,{numeric:!0}))},getScenesForLook:ss=>{const rs=ts();if(!rs.currentProject)return[];const ns=rs.currentProject.looks.find(os=>os.id===ss);return ns?rs.currentProject.scenes.filter(os=>ns.scenes.includes(os.sceneNumber)).sort((os,as)=>os.sceneNumber.localeCompare(as.sceneNumber,void 0,{numeric:!0})):[]},syncCastDataFromSchedule:(ss,rs={})=>{const ns=ts();if(!ns.currentProject)return null;const{canSync:os,reason:as}=canSyncCastData(ss);if(!os)return console.error("[ProjectStore] Cannot sync cast data:",as),null;const{result:ls,updatedScenes:cs,updatedCharacters:us,updatedLooks:ds}=syncCastDataToScenes(ss,ns.currentProject.scenes,ns.currentProject.characters,ns.currentProject.looks,rs);return(ls.scenesUpdated>0||ls.charactersCreated>0)&&(es(ms=>{if(!ms.currentProject)return{};const hs=(ms.currentProject.castProfiles||[]).map(xs=>{const ys=xs.characterId.match(/^cast-(\d+)$/);if(!ys)return xs;const vs=parseInt(ys[1],10),gs=ss.castList.find(Ss=>Ss.number===vs);if(!gs)return xs;const fs=(gs.character||gs.name).replace(/^\d+\.\s*/,"").trim().toUpperCase(),js=us.find(Ss=>Ss.name.trim().toUpperCase()===fs);return js?(console.log(`[ProjectStore] Migrating cast profile from placeholder ${xs.characterId} to ${js.id} (${js.name})`),{...xs,characterId:js.id,id:`cast-${js.id}`}):xs});return{currentProject:{...ms.currentProject,scenes:cs,characters:us,looks:ds,castProfiles:hs}}}),console.log("[ProjectStore] Cast sync complete:",{scenesUpdated:ls.scenesUpdated,charactersCreated:ls.charactersCreated})),ls},canSyncCastData:ss=>canSyncCastData(ss),compareScriptAmendment:ss=>{const{currentProject:rs}=ts();return rs!=null&&rs.scenes?compareScriptAmendment(rs.scenes,ss):null},applyScriptAmendment:(ss,rs={includeNew:!0,includeModified:!0,includeDeleted:!1})=>{const{currentProject:ns}=ts();if(!ns)return;const os=applyAmendmentToScenes(ns.scenes,ss,rs);es({currentProject:{...ns,scenes:os,updatedAt:new Date}})},clearSceneAmendmentFlags:()=>{const{currentProject:ss}=ts();if(!ss)return;const rs=clearAmendmentFlags(ss.scenes);es({currentProject:{...ss,scenes:rs}})},clearSingleSceneAmendment:ss=>{const{currentProject:rs}=ts();if(!rs)return;const ns=rs.scenes.map(os=>os.id===ss?{...os,amendmentStatus:void 0,amendmentNotes:void 0,previousScriptContent:void 0}:os);es({currentProject:{...rs,scenes:ns}})},getAmendmentCounts:()=>{const{currentProject:ss}=ts();return ss!=null&&ss.scenes?getAmendmentCount(ss.scenes):{total:0,new:0,modified:0,deleted:0}},updateActivity:()=>{es(ss=>({lifecycle:{...ss.lifecycle,lastActivityAt:new Date}}))},checkWrapTrigger:()=>{const ss=ts();if(!ss.currentProject)return;if(ss.lifecycle.nextReminderAt&&new Date>=new Date(ss.lifecycle.nextReminderAt)){es({showWrapPopup:!0,wrapTriggerReason:ss.lifecycle.wrapReason||"manual"});return}const rs=shouldTriggerWrap(ss.currentProject,ss.lifecycle);rs.trigger&&rs.reason&&es({showWrapPopup:!0,wrapTriggerReason:rs.reason})},wrapProject:ss=>{const rs=new Date,ns=new Date(rs);ns.setDate(ns.getDate()+PROJECT_RETENTION_DAYS),es(os=>({lifecycle:{...os.lifecycle,state:"wrapped",wrappedAt:rs,wrapReason:ss,deletionDate:ns},showWrapPopup:!1,wrapTriggerReason:null}))},dismissWrapPopup:ss=>{if(ss){const rs=new Date;rs.setDate(rs.getDate()+REMINDER_INTERVAL_DAYS),es(ns=>({showWrapPopup:!1,lifecycle:{...ns.lifecycle,reminderDismissedAt:new Date,nextReminderAt:rs}}))}else es({showWrapPopup:!1})},restoreProject:()=>{es(ss=>({lifecycle:{...ss.lifecycle,state:"active",wrappedAt:void 0,deletionDate:void 0,archiveDate:void 0,reminderDismissedAt:void 0,nextReminderAt:void 0,lastActivityAt:new Date}}))},archiveProject:()=>{const ss=ts();if(!ss.currentProject)return;const rs=new Date,ns={project:ss.currentProject,lifecycle:{...ss.lifecycle,state:"archived",archiveDate:rs},sceneCaptures:ss.sceneCaptures};es(os=>({archivedProjects:[...os.archivedProjects,ns],currentProject:null,sceneCaptures:{},lifecycle:createDefaultLifecycle()}))},permanentlyDeleteProject:()=>{es({currentProject:null,sceneCaptures:{},lifecycle:createDefaultLifecycle()})},getArchivedProjects:()=>ts().archivedProjects.map(rs=>{const ns=Object.values(rs.sceneCaptures).reduce((os,as)=>{let ls=0;return as.photos.front&&ls++,as.photos.left&&ls++,as.photos.right&&ls++,as.photos.back&&ls++,ls+=as.additionalPhotos.length,os+ls},0);return{id:rs.project.id,name:rs.project.name,state:rs.lifecycle.state,wrappedAt:rs.lifecycle.wrappedAt,daysUntilDeletion:rs.lifecycle.wrappedAt?calculateDaysUntilDeletion(new Date(rs.lifecycle.wrappedAt)):0,scenesCount:rs.project.scenes.length,charactersCount:rs.project.characters.length,photosCount:ns}}),loadArchivedProject:ss=>{const rs=ts(),ns=rs.archivedProjects.findIndex(ls=>ls.project.id===ss);if(ns===-1)return;const os=rs.archivedProjects[ns],as=[...rs.archivedProjects];as.splice(ns,1),es({currentProject:os.project,sceneCaptures:os.sceneCaptures,lifecycle:os.lifecycle,archivedProjects:as})},getDaysUntilDeletion:()=>{const ss=ts();return ss.lifecycle.state==="active"||!ss.lifecycle.wrappedAt?-1:calculateDaysUntilDeletion(new Date(ss.lifecycle.wrappedAt))},getLifecycleBanner:()=>{const ss=ts();if(ss.lifecycle.state==="active")return null;const rs=ss.lifecycle.wrappedAt?calculateDaysUntilDeletion(new Date(ss.lifecycle.wrappedAt)):0;return ss.lifecycle.state==="wrapped"?{show:!0,message:`Project wrapped. ${rs} days until archive.`,daysRemaining:rs}:ss.lifecycle.state==="archived"?{show:!0,message:"Archived. Export to restore.",daysRemaining:rs}:null}}),{name:"hair-makeup-pro-storage",storage:createHybridStorage("hair-makeup-pro-storage"),partialize:es=>({currentProject:es.currentProject,sceneCaptures:es.sceneCaptures,lifecycle:es.lifecycle,savedProjects:es.savedProjects,archivedProjects:es.archivedProjects,needsSetup:es.needsSetup})}));function __rest(es,ts){var ss={};for(var rs in es)Object.prototype.hasOwnProperty.call(es,rs)&&ts.indexOf(rs)<0&&(ss[rs]=es[rs]);if(es!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ns=0,rs=Object.getOwnPropertySymbols(es);ns<rs.length;ns++)ts.indexOf(rs[ns])<0&&Object.prototype.propertyIsEnumerable.call(es,rs[ns])&&(ss[rs[ns]]=es[rs[ns]]);return ss}function __awaiter(es,ts,ss,rs){function ns(os){return os instanceof ss?os:new ss(function(as){as(os)})}return new(ss||(ss=Promise))(function(os,as){function ls(ds){try{us(rs.next(ds))}catch(ms){as(ms)}}function cs(ds){try{us(rs.throw(ds))}catch(ms){as(ms)}}function us(ds){ds.done?os(ds.value):ns(ds.value).then(ls,cs)}us((rs=rs.apply(es,ts||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;const resolveFetch$3=es=>es?(...ts)=>es(...ts):(...ts)=>fetch(...ts);class FunctionsError extends Error{constructor(ts,ss="FunctionsError",rs){super(ts),this.name=ss,this.context=rs}}class FunctionsFetchError extends FunctionsError{constructor(ts){super("Failed to send a request to the Edge Function","FunctionsFetchError",ts)}}class FunctionsRelayError extends FunctionsError{constructor(ts){super("Relay Error invoking the Edge Function","FunctionsRelayError",ts)}}class FunctionsHttpError extends FunctionsError{constructor(ts){super("Edge Function returned a non-2xx status code","FunctionsHttpError",ts)}}var FunctionRegion;(function(es){es.Any="any",es.ApNortheast1="ap-northeast-1",es.ApNortheast2="ap-northeast-2",es.ApSouth1="ap-south-1",es.ApSoutheast1="ap-southeast-1",es.ApSoutheast2="ap-southeast-2",es.CaCentral1="ca-central-1",es.EuCentral1="eu-central-1",es.EuWest1="eu-west-1",es.EuWest2="eu-west-2",es.EuWest3="eu-west-3",es.SaEast1="sa-east-1",es.UsEast1="us-east-1",es.UsWest1="us-west-1",es.UsWest2="us-west-2"})(FunctionRegion||(FunctionRegion={}));class FunctionsClient{constructor(ts,{headers:ss={},customFetch:rs,region:ns=FunctionRegion.Any}={}){this.url=ts,this.headers=ss,this.region=ns,this.fetch=resolveFetch$3(rs)}setAuth(ts){this.headers.Authorization=`Bearer ${ts}`}invoke(ts){return __awaiter(this,arguments,void 0,function*(ss,rs={}){var ns;let os,as;try{const{headers:ls,method:cs,body:us,signal:ds,timeout:ms}=rs;let ps={},{region:hs}=rs;hs||(hs=this.region);const xs=new URL(`${this.url}/${ss}`);hs&&hs!=="any"&&(ps["x-region"]=hs,xs.searchParams.set("forceFunctionRegion",hs));let ys;us&&(ls&&!Object.prototype.hasOwnProperty.call(ls,"Content-Type")||!ls)?typeof Blob<"u"&&us instanceof Blob||us instanceof ArrayBuffer?(ps["Content-Type"]="application/octet-stream",ys=us):typeof us=="string"?(ps["Content-Type"]="text/plain",ys=us):typeof FormData<"u"&&us instanceof FormData?ys=us:(ps["Content-Type"]="application/json",ys=JSON.stringify(us)):us&&typeof us!="string"&&!(typeof Blob<"u"&&us instanceof Blob)&&!(us instanceof ArrayBuffer)&&!(typeof FormData<"u"&&us instanceof FormData)?ys=JSON.stringify(us):ys=us;let vs=ds;ms&&(as=new AbortController,os=setTimeout(()=>as.abort(),ms),ds?(vs=as.signal,ds.addEventListener("abort",()=>as.abort())):vs=as.signal);const gs=yield this.fetch(xs.toString(),{method:cs||"POST",headers:Object.assign(Object.assign(Object.assign({},ps),this.headers),ls),body:ys,signal:vs}).catch(bs=>{throw new FunctionsFetchError(bs)}),fs=gs.headers.get("x-relay-error");if(fs&&fs==="true")throw new FunctionsRelayError(gs);if(!gs.ok)throw new FunctionsHttpError(gs);let js=((ns=gs.headers.get("Content-Type"))!==null&&ns!==void 0?ns:"text/plain").split(";")[0].trim(),Ss;return js==="application/json"?Ss=yield gs.json():js==="application/octet-stream"||js==="application/pdf"?Ss=yield gs.blob():js==="text/event-stream"?Ss=gs:js==="multipart/form-data"?Ss=yield gs.formData():Ss=yield gs.text(),{data:Ss,error:null,response:gs}}catch(ls){return{data:null,error:ls,response:ls instanceof FunctionsHttpError||ls instanceof FunctionsRelayError?ls.context:void 0}}finally{os&&clearTimeout(os)}})}}var PostgrestError=class extends Error{constructor(es){super(es.message),this.name="PostgrestError",this.details=es.details,this.hint=es.hint,this.code=es.code}},PostgrestBuilder=class{constructor(es){var ts,ss;this.shouldThrowOnError=!1,this.method=es.method,this.url=es.url,this.headers=new Headers(es.headers),this.schema=es.schema,this.body=es.body,this.shouldThrowOnError=(ts=es.shouldThrowOnError)!==null&&ts!==void 0?ts:!1,this.signal=es.signal,this.isMaybeSingle=(ss=es.isMaybeSingle)!==null&&ss!==void 0?ss:!1,es.fetch?this.fetch=es.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(es,ts){return this.headers=new Headers(this.headers),this.headers.set(es,ts),this}then(es,ts){var ss=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const rs=this.fetch;let ns=rs(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async os=>{let as=null,ls=null,cs=null,us=os.status,ds=os.statusText;if(os.ok){var ms,ps;if(ss.method!=="HEAD"){var hs;const gs=await os.text();gs===""||(ss.headers.get("Accept")==="text/csv"||ss.headers.get("Accept")&&(!((hs=ss.headers.get("Accept"))===null||hs===void 0)&&hs.includes("application/vnd.pgrst.plan+text"))?ls=gs:ls=JSON.parse(gs))}const ys=(ms=ss.headers.get("Prefer"))===null||ms===void 0?void 0:ms.match(/count=(exact|planned|estimated)/),vs=(ps=os.headers.get("content-range"))===null||ps===void 0?void 0:ps.split("/");ys&&vs&&vs.length>1&&(cs=parseInt(vs[1])),ss.isMaybeSingle&&ss.method==="GET"&&Array.isArray(ls)&&(ls.length>1?(as={code:"PGRST116",details:`Results contain ${ls.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},ls=null,cs=null,us=406,ds="Not Acceptable"):ls.length===1?ls=ls[0]:ls=null)}else{var xs;const ys=await os.text();try{as=JSON.parse(ys),Array.isArray(as)&&os.status===404&&(ls=[],as=null,us=200,ds="OK")}catch{os.status===404&&ys===""?(us=204,ds="No Content"):as={message:ys}}if(as&&ss.isMaybeSingle&&(!(as==null||(xs=as.details)===null||xs===void 0)&&xs.includes("0 rows"))&&(as=null,us=200,ds="OK"),as&&ss.shouldThrowOnError)throw new PostgrestError(as)}return{error:as,data:ls,count:cs,status:us,statusText:ds}});return this.shouldThrowOnError||(ns=ns.catch(os=>{var as;let ls="";const cs=os==null?void 0:os.cause;if(cs){var us,ds,ms,ps;const xs=(us=cs==null?void 0:cs.message)!==null&&us!==void 0?us:"",ys=(ds=cs==null?void 0:cs.code)!==null&&ds!==void 0?ds:"";ls=`${(ms=os==null?void 0:os.name)!==null&&ms!==void 0?ms:"FetchError"}: ${os==null?void 0:os.message}`,ls+=`

Caused by: ${(ps=cs==null?void 0:cs.name)!==null&&ps!==void 0?ps:"Error"}: ${xs}`,ys&&(ls+=` (${ys})`),cs!=null&&cs.stack&&(ls+=`
${cs.stack}`)}else{var hs;ls=(hs=os==null?void 0:os.stack)!==null&&hs!==void 0?hs:""}return{error:{message:`${(as=os==null?void 0:os.name)!==null&&as!==void 0?as:"FetchError"}: ${os==null?void 0:os.message}`,details:ls,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),ns.then(es,ts)}returns(){return this}overrideTypes(){return this}},PostgrestTransformBuilder=class extends PostgrestBuilder{select(es){let ts=!1;const ss=(es??"*").split("").map(rs=>/\s/.test(rs)&&!ts?"":(rs==='"'&&(ts=!ts),rs)).join("");return this.url.searchParams.set("select",ss),this.headers.append("Prefer","return=representation"),this}order(es,{ascending:ts=!0,nullsFirst:ss,foreignTable:rs,referencedTable:ns=rs}={}){const os=ns?`${ns}.order`:"order",as=this.url.searchParams.get(os);return this.url.searchParams.set(os,`${as?`${as},`:""}${es}.${ts?"asc":"desc"}${ss===void 0?"":ss?".nullsfirst":".nullslast"}`),this}limit(es,{foreignTable:ts,referencedTable:ss=ts}={}){const rs=typeof ss>"u"?"limit":`${ss}.limit`;return this.url.searchParams.set(rs,`${es}`),this}range(es,ts,{foreignTable:ss,referencedTable:rs=ss}={}){const ns=typeof rs>"u"?"offset":`${rs}.offset`,os=typeof rs>"u"?"limit":`${rs}.limit`;return this.url.searchParams.set(ns,`${es}`),this.url.searchParams.set(os,`${ts-es+1}`),this}abortSignal(es){return this.signal=es,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:es=!1,verbose:ts=!1,settings:ss=!1,buffers:rs=!1,wal:ns=!1,format:os="text"}={}){var as;const ls=[es?"analyze":null,ts?"verbose":null,ss?"settings":null,rs?"buffers":null,ns?"wal":null].filter(Boolean).join("|"),cs=(as=this.headers.get("Accept"))!==null&&as!==void 0?as:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${os}; for="${cs}"; options=${ls};`),os==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(es){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${es}`),this}};const PostgrestReservedCharsRegexp=new RegExp("[,()]");var PostgrestFilterBuilder=class extends PostgrestTransformBuilder{eq(es,ts){return this.url.searchParams.append(es,`eq.${ts}`),this}neq(es,ts){return this.url.searchParams.append(es,`neq.${ts}`),this}gt(es,ts){return this.url.searchParams.append(es,`gt.${ts}`),this}gte(es,ts){return this.url.searchParams.append(es,`gte.${ts}`),this}lt(es,ts){return this.url.searchParams.append(es,`lt.${ts}`),this}lte(es,ts){return this.url.searchParams.append(es,`lte.${ts}`),this}like(es,ts){return this.url.searchParams.append(es,`like.${ts}`),this}likeAllOf(es,ts){return this.url.searchParams.append(es,`like(all).{${ts.join(",")}}`),this}likeAnyOf(es,ts){return this.url.searchParams.append(es,`like(any).{${ts.join(",")}}`),this}ilike(es,ts){return this.url.searchParams.append(es,`ilike.${ts}`),this}ilikeAllOf(es,ts){return this.url.searchParams.append(es,`ilike(all).{${ts.join(",")}}`),this}ilikeAnyOf(es,ts){return this.url.searchParams.append(es,`ilike(any).{${ts.join(",")}}`),this}regexMatch(es,ts){return this.url.searchParams.append(es,`match.${ts}`),this}regexIMatch(es,ts){return this.url.searchParams.append(es,`imatch.${ts}`),this}is(es,ts){return this.url.searchParams.append(es,`is.${ts}`),this}isDistinct(es,ts){return this.url.searchParams.append(es,`isdistinct.${ts}`),this}in(es,ts){const ss=Array.from(new Set(ts)).map(rs=>typeof rs=="string"&&PostgrestReservedCharsRegexp.test(rs)?`"${rs}"`:`${rs}`).join(",");return this.url.searchParams.append(es,`in.(${ss})`),this}notIn(es,ts){const ss=Array.from(new Set(ts)).map(rs=>typeof rs=="string"&&PostgrestReservedCharsRegexp.test(rs)?`"${rs}"`:`${rs}`).join(",");return this.url.searchParams.append(es,`not.in.(${ss})`),this}contains(es,ts){return typeof ts=="string"?this.url.searchParams.append(es,`cs.${ts}`):Array.isArray(ts)?this.url.searchParams.append(es,`cs.{${ts.join(",")}}`):this.url.searchParams.append(es,`cs.${JSON.stringify(ts)}`),this}containedBy(es,ts){return typeof ts=="string"?this.url.searchParams.append(es,`cd.${ts}`):Array.isArray(ts)?this.url.searchParams.append(es,`cd.{${ts.join(",")}}`):this.url.searchParams.append(es,`cd.${JSON.stringify(ts)}`),this}rangeGt(es,ts){return this.url.searchParams.append(es,`sr.${ts}`),this}rangeGte(es,ts){return this.url.searchParams.append(es,`nxl.${ts}`),this}rangeLt(es,ts){return this.url.searchParams.append(es,`sl.${ts}`),this}rangeLte(es,ts){return this.url.searchParams.append(es,`nxr.${ts}`),this}rangeAdjacent(es,ts){return this.url.searchParams.append(es,`adj.${ts}`),this}overlaps(es,ts){return typeof ts=="string"?this.url.searchParams.append(es,`ov.${ts}`):this.url.searchParams.append(es,`ov.{${ts.join(",")}}`),this}textSearch(es,ts,{config:ss,type:rs}={}){let ns="";rs==="plain"?ns="pl":rs==="phrase"?ns="ph":rs==="websearch"&&(ns="w");const os=ss===void 0?"":`(${ss})`;return this.url.searchParams.append(es,`${ns}fts${os}.${ts}`),this}match(es){return Object.entries(es).forEach(([ts,ss])=>{this.url.searchParams.append(ts,`eq.${ss}`)}),this}not(es,ts,ss){return this.url.searchParams.append(es,`not.${ts}.${ss}`),this}or(es,{foreignTable:ts,referencedTable:ss=ts}={}){const rs=ss?`${ss}.or`:"or";return this.url.searchParams.append(rs,`(${es})`),this}filter(es,ts,ss){return this.url.searchParams.append(es,`${ts}.${ss}`),this}},PostgrestQueryBuilder=class{constructor(es,{headers:ts={},schema:ss,fetch:rs}){this.url=es,this.headers=new Headers(ts),this.schema=ss,this.fetch=rs}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(es,ts){const{head:ss=!1,count:rs}=ts??{},ns=ss?"HEAD":"GET";let os=!1;const as=(es??"*").split("").map(us=>/\s/.test(us)&&!os?"":(us==='"'&&(os=!os),us)).join(""),{url:ls,headers:cs}=this.cloneRequestState();return ls.searchParams.set("select",as),rs&&cs.append("Prefer",`count=${rs}`),new PostgrestFilterBuilder({method:ns,url:ls,headers:cs,schema:this.schema,fetch:this.fetch})}insert(es,{count:ts,defaultToNull:ss=!0}={}){var rs;const ns="POST",{url:os,headers:as}=this.cloneRequestState();if(ts&&as.append("Prefer",`count=${ts}`),ss||as.append("Prefer","missing=default"),Array.isArray(es)){const ls=es.reduce((cs,us)=>cs.concat(Object.keys(us)),[]);if(ls.length>0){const cs=[...new Set(ls)].map(us=>`"${us}"`);os.searchParams.set("columns",cs.join(","))}}return new PostgrestFilterBuilder({method:ns,url:os,headers:as,schema:this.schema,body:es,fetch:(rs=this.fetch)!==null&&rs!==void 0?rs:fetch})}upsert(es,{onConflict:ts,ignoreDuplicates:ss=!1,count:rs,defaultToNull:ns=!0}={}){var os;const as="POST",{url:ls,headers:cs}=this.cloneRequestState();if(cs.append("Prefer",`resolution=${ss?"ignore":"merge"}-duplicates`),ts!==void 0&&ls.searchParams.set("on_conflict",ts),rs&&cs.append("Prefer",`count=${rs}`),ns||cs.append("Prefer","missing=default"),Array.isArray(es)){const us=es.reduce((ds,ms)=>ds.concat(Object.keys(ms)),[]);if(us.length>0){const ds=[...new Set(us)].map(ms=>`"${ms}"`);ls.searchParams.set("columns",ds.join(","))}}return new PostgrestFilterBuilder({method:as,url:ls,headers:cs,schema:this.schema,body:es,fetch:(os=this.fetch)!==null&&os!==void 0?os:fetch})}update(es,{count:ts}={}){var ss;const rs="PATCH",{url:ns,headers:os}=this.cloneRequestState();return ts&&os.append("Prefer",`count=${ts}`),new PostgrestFilterBuilder({method:rs,url:ns,headers:os,schema:this.schema,body:es,fetch:(ss=this.fetch)!==null&&ss!==void 0?ss:fetch})}delete({count:es}={}){var ts;const ss="DELETE",{url:rs,headers:ns}=this.cloneRequestState();return es&&ns.append("Prefer",`count=${es}`),new PostgrestFilterBuilder({method:ss,url:rs,headers:ns,schema:this.schema,fetch:(ts=this.fetch)!==null&&ts!==void 0?ts:fetch})}},PostgrestClient=class gu{constructor(ts,{headers:ss={},schema:rs,fetch:ns}={}){this.url=ts,this.headers=new Headers(ss),this.schemaName=rs,this.fetch=ns}from(ts){if(!ts||typeof ts!="string"||ts.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new PostgrestQueryBuilder(new URL(`${this.url}/${ts}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(ts){return new gu(this.url,{headers:this.headers,schema:ts,fetch:this.fetch})}rpc(ts,ss={},{head:rs=!1,get:ns=!1,count:os}={}){var as;let ls;const cs=new URL(`${this.url}/rpc/${ts}`);let us;const ds=hs=>hs!==null&&typeof hs=="object"&&(!Array.isArray(hs)||hs.some(ds)),ms=rs&&Object.values(ss).some(ds);ms?(ls="POST",us=ss):rs||ns?(ls=rs?"HEAD":"GET",Object.entries(ss).filter(([hs,xs])=>xs!==void 0).map(([hs,xs])=>[hs,Array.isArray(xs)?`{${xs.join(",")}}`:`${xs}`]).forEach(([hs,xs])=>{cs.searchParams.append(hs,xs)})):(ls="POST",us=ss);const ps=new Headers(this.headers);return ms?ps.set("Prefer",os?`count=${os},return=minimal`:"return=minimal"):os&&ps.set("Prefer",`count=${os}`),new PostgrestFilterBuilder({method:ls,url:cs,headers:ps,schema:this.schemaName,body:us,fetch:(as=this.fetch)!==null&&as!==void 0?as:fetch})}};class WebSocketFactory{constructor(){}static detectEnvironment(){var ts;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((ts=navigator.userAgent)===null||ts===void 0)&&ts.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const ss=globalThis.process;if(ss){const rs=ss.versions;if(rs&&rs.node){const ns=rs.node,os=parseInt(ns.replace(/^v/,"").split(".")[0]);return os>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${os} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${os} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const ts=this.detectEnvironment();if(ts.constructor)return ts.constructor;let ss=ts.error||"WebSocket not supported in this environment.";throw ts.workaround&&(ss+=`

Suggested solution: ${ts.workaround}`),new Error(ss)}static createWebSocket(ts,ss){const rs=this.getWebSocketConstructor();return new rs(ts,ss)}static isWebSocketSupported(){try{const ts=this.detectEnvironment();return ts.type==="native"||ts.type==="ws"}catch{return!1}}}const version$3="2.93.1",DEFAULT_VERSION=`realtime-js/${version$3}`,VSN_1_0_0="1.0.0",VSN_2_0_0="2.0.0",DEFAULT_VSN=VSN_2_0_0,DEFAULT_TIMEOUT=1e4,WS_CLOSE_NORMAL=1e3,MAX_PUSH_BUFFER_SIZE=100;var SOCKET_STATES;(function(es){es[es.connecting=0]="connecting",es[es.open=1]="open",es[es.closing=2]="closing",es[es.closed=3]="closed"})(SOCKET_STATES||(SOCKET_STATES={}));var CHANNEL_STATES;(function(es){es.closed="closed",es.errored="errored",es.joined="joined",es.joining="joining",es.leaving="leaving"})(CHANNEL_STATES||(CHANNEL_STATES={}));var CHANNEL_EVENTS;(function(es){es.close="phx_close",es.error="phx_error",es.join="phx_join",es.reply="phx_reply",es.leave="phx_leave",es.access_token="access_token"})(CHANNEL_EVENTS||(CHANNEL_EVENTS={}));var TRANSPORTS;(function(es){es.websocket="websocket"})(TRANSPORTS||(TRANSPORTS={}));var CONNECTION_STATE;(function(es){es.Connecting="connecting",es.Open="open",es.Closing="closing",es.Closed="closed"})(CONNECTION_STATE||(CONNECTION_STATE={}));class Serializer{constructor(ts){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=ts??[]}encode(ts,ss){if(ts.event===this.BROADCAST_EVENT&&!(ts.payload instanceof ArrayBuffer)&&typeof ts.payload.event=="string")return ss(this._binaryEncodeUserBroadcastPush(ts));let rs=[ts.join_ref,ts.ref,ts.topic,ts.event,ts.payload];return ss(JSON.stringify(rs))}_binaryEncodeUserBroadcastPush(ts){var ss;return this._isArrayBuffer((ss=ts.payload)===null||ss===void 0?void 0:ss.payload)?this._encodeBinaryUserBroadcastPush(ts):this._encodeJsonUserBroadcastPush(ts)}_encodeBinaryUserBroadcastPush(ts){var ss,rs;const ns=(rs=(ss=ts.payload)===null||ss===void 0?void 0:ss.payload)!==null&&rs!==void 0?rs:new ArrayBuffer(0);return this._encodeUserBroadcastPush(ts,this.BINARY_ENCODING,ns)}_encodeJsonUserBroadcastPush(ts){var ss,rs;const ns=(rs=(ss=ts.payload)===null||ss===void 0?void 0:ss.payload)!==null&&rs!==void 0?rs:{},as=new TextEncoder().encode(JSON.stringify(ns)).buffer;return this._encodeUserBroadcastPush(ts,this.JSON_ENCODING,as)}_encodeUserBroadcastPush(ts,ss,rs){var ns,os;const as=ts.topic,ls=(ns=ts.ref)!==null&&ns!==void 0?ns:"",cs=(os=ts.join_ref)!==null&&os!==void 0?os:"",us=ts.payload.event,ds=this.allowedMetadataKeys?this._pick(ts.payload,this.allowedMetadataKeys):{},ms=Object.keys(ds).length===0?"":JSON.stringify(ds);if(cs.length>255)throw new Error(`joinRef length ${cs.length} exceeds maximum of 255`);if(ls.length>255)throw new Error(`ref length ${ls.length} exceeds maximum of 255`);if(as.length>255)throw new Error(`topic length ${as.length} exceeds maximum of 255`);if(us.length>255)throw new Error(`userEvent length ${us.length} exceeds maximum of 255`);if(ms.length>255)throw new Error(`metadata length ${ms.length} exceeds maximum of 255`);const ps=this.USER_BROADCAST_PUSH_META_LENGTH+cs.length+ls.length+as.length+us.length+ms.length,hs=new ArrayBuffer(this.HEADER_LENGTH+ps);let xs=new DataView(hs),ys=0;xs.setUint8(ys++,this.KINDS.userBroadcastPush),xs.setUint8(ys++,cs.length),xs.setUint8(ys++,ls.length),xs.setUint8(ys++,as.length),xs.setUint8(ys++,us.length),xs.setUint8(ys++,ms.length),xs.setUint8(ys++,ss),Array.from(cs,gs=>xs.setUint8(ys++,gs.charCodeAt(0))),Array.from(ls,gs=>xs.setUint8(ys++,gs.charCodeAt(0))),Array.from(as,gs=>xs.setUint8(ys++,gs.charCodeAt(0))),Array.from(us,gs=>xs.setUint8(ys++,gs.charCodeAt(0))),Array.from(ms,gs=>xs.setUint8(ys++,gs.charCodeAt(0)));var vs=new Uint8Array(hs.byteLength+rs.byteLength);return vs.set(new Uint8Array(hs),0),vs.set(new Uint8Array(rs),hs.byteLength),vs.buffer}decode(ts,ss){if(this._isArrayBuffer(ts)){let rs=this._binaryDecode(ts);return ss(rs)}if(typeof ts=="string"){const rs=JSON.parse(ts),[ns,os,as,ls,cs]=rs;return ss({join_ref:ns,ref:os,topic:as,event:ls,payload:cs})}return ss({})}_binaryDecode(ts){const ss=new DataView(ts),rs=ss.getUint8(0),ns=new TextDecoder;switch(rs){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(ts,ss,ns)}}_decodeUserBroadcast(ts,ss,rs){const ns=ss.getUint8(1),os=ss.getUint8(2),as=ss.getUint8(3),ls=ss.getUint8(4);let cs=this.HEADER_LENGTH+4;const us=rs.decode(ts.slice(cs,cs+ns));cs=cs+ns;const ds=rs.decode(ts.slice(cs,cs+os));cs=cs+os;const ms=rs.decode(ts.slice(cs,cs+as));cs=cs+as;const ps=ts.slice(cs,ts.byteLength),hs=ls===this.JSON_ENCODING?JSON.parse(rs.decode(ps)):ps,xs={type:this.BROADCAST_EVENT,event:ds,payload:hs};return as>0&&(xs.meta=JSON.parse(ms)),{join_ref:null,ref:null,topic:us,event:this.BROADCAST_EVENT,payload:xs}}_isArrayBuffer(ts){var ss;return ts instanceof ArrayBuffer||((ss=ts==null?void 0:ts.constructor)===null||ss===void 0?void 0:ss.name)==="ArrayBuffer"}_pick(ts,ss){return!ts||typeof ts!="object"?{}:Object.fromEntries(Object.entries(ts).filter(([rs])=>ss.includes(rs)))}}class Timer{constructor(ts,ss){this.callback=ts,this.timerCalc=ss,this.timer=void 0,this.tries=0,this.callback=ts,this.timerCalc=ss}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var PostgresTypes;(function(es){es.abstime="abstime",es.bool="bool",es.date="date",es.daterange="daterange",es.float4="float4",es.float8="float8",es.int2="int2",es.int4="int4",es.int4range="int4range",es.int8="int8",es.int8range="int8range",es.json="json",es.jsonb="jsonb",es.money="money",es.numeric="numeric",es.oid="oid",es.reltime="reltime",es.text="text",es.time="time",es.timestamp="timestamp",es.timestamptz="timestamptz",es.timetz="timetz",es.tsrange="tsrange",es.tstzrange="tstzrange"})(PostgresTypes||(PostgresTypes={}));const convertChangeData=(es,ts,ss={})=>{var rs;const ns=(rs=ss.skipTypes)!==null&&rs!==void 0?rs:[];return ts?Object.keys(ts).reduce((os,as)=>(os[as]=convertColumn(as,es,ts,ns),os),{}):{}},convertColumn=(es,ts,ss,rs)=>{const ns=ts.find(ls=>ls.name===es),os=ns==null?void 0:ns.type,as=ss[es];return os&&!rs.includes(os)?convertCell(os,as):noop$1(as)},convertCell=(es,ts)=>{if(es.charAt(0)==="_"){const ss=es.slice(1,es.length);return toArray(ts,ss)}switch(es){case PostgresTypes.bool:return toBoolean(ts);case PostgresTypes.float4:case PostgresTypes.float8:case PostgresTypes.int2:case PostgresTypes.int4:case PostgresTypes.int8:case PostgresTypes.numeric:case PostgresTypes.oid:return toNumber(ts);case PostgresTypes.json:case PostgresTypes.jsonb:return toJson(ts);case PostgresTypes.timestamp:return toTimestampString(ts);case PostgresTypes.abstime:case PostgresTypes.date:case PostgresTypes.daterange:case PostgresTypes.int4range:case PostgresTypes.int8range:case PostgresTypes.money:case PostgresTypes.reltime:case PostgresTypes.text:case PostgresTypes.time:case PostgresTypes.timestamptz:case PostgresTypes.timetz:case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return noop$1(ts);default:return noop$1(ts)}},noop$1=es=>es,toBoolean=es=>{switch(es){case"t":return!0;case"f":return!1;default:return es}},toNumber=es=>{if(typeof es=="string"){const ts=parseFloat(es);if(!Number.isNaN(ts))return ts}return es},toJson=es=>{if(typeof es=="string")try{return JSON.parse(es)}catch{return es}return es},toArray=(es,ts)=>{if(typeof es!="string")return es;const ss=es.length-1,rs=es[ss];if(es[0]==="{"&&rs==="}"){let os;const as=es.slice(1,ss);try{os=JSON.parse("["+as+"]")}catch{os=as?as.split(","):[]}return os.map(ls=>convertCell(ts,ls))}return es},toTimestampString=es=>typeof es=="string"?es.replace(" ","T"):es,httpEndpointURL=es=>{const ts=new URL(es);return ts.protocol=ts.protocol.replace(/^ws/i,"http"),ts.pathname=ts.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),ts.pathname===""||ts.pathname==="/"?ts.pathname="/api/broadcast":ts.pathname=ts.pathname+"/api/broadcast",ts.href};class Push{constructor(ts,ss,rs={},ns=DEFAULT_TIMEOUT){this.channel=ts,this.event=ss,this.payload=rs,this.timeout=ns,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(ts){this.timeout=ts,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(ts){this.payload=Object.assign(Object.assign({},this.payload),ts)}receive(ts,ss){var rs;return this._hasReceived(ts)&&ss((rs=this.receivedResp)===null||rs===void 0?void 0:rs.response),this.recHooks.push({status:ts,callback:ss}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const ts=ss=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=ss,this._matchReceive(ss)};this.channel._on(this.refEvent,{},ts),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(ts,ss){this.refEvent&&this.channel._trigger(this.refEvent,{status:ts,response:ss})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:ts,response:ss}){this.recHooks.filter(rs=>rs.status===ts).forEach(rs=>rs.callback(ss))}_hasReceived(ts){return this.receivedResp&&this.receivedResp.status===ts}}var REALTIME_PRESENCE_LISTEN_EVENTS;(function(es){es.SYNC="sync",es.JOIN="join",es.LEAVE="leave"})(REALTIME_PRESENCE_LISTEN_EVENTS||(REALTIME_PRESENCE_LISTEN_EVENTS={}));class RealtimePresence{constructor(ts,ss){this.channel=ts,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const rs=(ss==null?void 0:ss.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(rs.state,{},ns=>{const{onJoin:os,onLeave:as,onSync:ls}=this.caller;this.joinRef=this.channel._joinRef(),this.state=RealtimePresence.syncState(this.state,ns,os,as),this.pendingDiffs.forEach(cs=>{this.state=RealtimePresence.syncDiff(this.state,cs,os,as)}),this.pendingDiffs=[],ls()}),this.channel._on(rs.diff,{},ns=>{const{onJoin:os,onLeave:as,onSync:ls}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(ns):(this.state=RealtimePresence.syncDiff(this.state,ns,os,as),ls())}),this.onJoin((ns,os,as)=>{this.channel._trigger("presence",{event:"join",key:ns,currentPresences:os,newPresences:as})}),this.onLeave((ns,os,as)=>{this.channel._trigger("presence",{event:"leave",key:ns,currentPresences:os,leftPresences:as})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(ts,ss,rs,ns){const os=this.cloneDeep(ts),as=this.transformState(ss),ls={},cs={};return this.map(os,(us,ds)=>{as[us]||(cs[us]=ds)}),this.map(as,(us,ds)=>{const ms=os[us];if(ms){const ps=ds.map(vs=>vs.presence_ref),hs=ms.map(vs=>vs.presence_ref),xs=ds.filter(vs=>hs.indexOf(vs.presence_ref)<0),ys=ms.filter(vs=>ps.indexOf(vs.presence_ref)<0);xs.length>0&&(ls[us]=xs),ys.length>0&&(cs[us]=ys)}else ls[us]=ds}),this.syncDiff(os,{joins:ls,leaves:cs},rs,ns)}static syncDiff(ts,ss,rs,ns){const{joins:os,leaves:as}={joins:this.transformState(ss.joins),leaves:this.transformState(ss.leaves)};return rs||(rs=()=>{}),ns||(ns=()=>{}),this.map(os,(ls,cs)=>{var us;const ds=(us=ts[ls])!==null&&us!==void 0?us:[];if(ts[ls]=this.cloneDeep(cs),ds.length>0){const ms=ts[ls].map(hs=>hs.presence_ref),ps=ds.filter(hs=>ms.indexOf(hs.presence_ref)<0);ts[ls].unshift(...ps)}rs(ls,ds,cs)}),this.map(as,(ls,cs)=>{let us=ts[ls];if(!us)return;const ds=cs.map(ms=>ms.presence_ref);us=us.filter(ms=>ds.indexOf(ms.presence_ref)<0),ts[ls]=us,ns(ls,us,cs),us.length===0&&delete ts[ls]}),ts}static map(ts,ss){return Object.getOwnPropertyNames(ts).map(rs=>ss(rs,ts[rs]))}static transformState(ts){return ts=this.cloneDeep(ts),Object.getOwnPropertyNames(ts).reduce((ss,rs)=>{const ns=ts[rs];return"metas"in ns?ss[rs]=ns.metas.map(os=>(os.presence_ref=os.phx_ref,delete os.phx_ref,delete os.phx_ref_prev,os)):ss[rs]=ns,ss},{})}static cloneDeep(ts){return JSON.parse(JSON.stringify(ts))}onJoin(ts){this.caller.onJoin=ts}onLeave(ts){this.caller.onLeave=ts}onSync(ts){this.caller.onSync=ts}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var REALTIME_POSTGRES_CHANGES_LISTEN_EVENT;(function(es){es.ALL="*",es.INSERT="INSERT",es.UPDATE="UPDATE",es.DELETE="DELETE"})(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT||(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT={}));var REALTIME_LISTEN_TYPES;(function(es){es.BROADCAST="broadcast",es.PRESENCE="presence",es.POSTGRES_CHANGES="postgres_changes",es.SYSTEM="system"})(REALTIME_LISTEN_TYPES||(REALTIME_LISTEN_TYPES={}));var REALTIME_SUBSCRIBE_STATES;(function(es){es.SUBSCRIBED="SUBSCRIBED",es.TIMED_OUT="TIMED_OUT",es.CLOSED="CLOSED",es.CHANNEL_ERROR="CHANNEL_ERROR"})(REALTIME_SUBSCRIBE_STATES||(REALTIME_SUBSCRIBE_STATES={}));class RealtimeChannel{constructor(ts,ss={config:{}},rs){var ns,os;if(this.topic=ts,this.params=ss,this.socket=rs,this.bindings={},this.state=CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=ts.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},ss.config),this.timeout=this.socket.timeout,this.joinPush=new Push(this,CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Timer(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(as=>as.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(as=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,as),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",as=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,as),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(CHANNEL_EVENTS.reply,{},(as,ls)=>{this._trigger(this._replyEventName(ls),as)}),this.presence=new RealtimePresence(this),this.broadcastEndpointURL=httpEndpointURL(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((os=(ns=this.params.config)===null||ns===void 0?void 0:ns.broadcast)===null||os===void 0)&&os.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(ts,ss=this.timeout){var rs,ns,os;if(this.socket.isConnected()||this.socket.connect(),this.state==CHANNEL_STATES.closed){const{config:{broadcast:as,presence:ls,private:cs}}=this.params,us=(ns=(rs=this.bindings.postgres_changes)===null||rs===void 0?void 0:rs.map(hs=>hs.filter))!==null&&ns!==void 0?ns:[],ds=!!this.bindings[REALTIME_LISTEN_TYPES.PRESENCE]&&this.bindings[REALTIME_LISTEN_TYPES.PRESENCE].length>0||((os=this.params.config.presence)===null||os===void 0?void 0:os.enabled)===!0,ms={},ps={broadcast:as,presence:Object.assign(Object.assign({},ls),{enabled:ds}),postgres_changes:us,private:cs};this.socket.accessTokenValue&&(ms.access_token=this.socket.accessTokenValue),this._onError(hs=>ts==null?void 0:ts(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,hs)),this._onClose(()=>ts==null?void 0:ts(REALTIME_SUBSCRIBE_STATES.CLOSED)),this.updateJoinPayload(Object.assign({config:ps},ms)),this.joinedOnce=!0,this._rejoin(ss),this.joinPush.receive("ok",async({postgres_changes:hs})=>{var xs;if(this.socket._isManualToken()||this.socket.setAuth(),hs===void 0){ts==null||ts(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}else{const ys=this.bindings.postgres_changes,vs=(xs=ys==null?void 0:ys.length)!==null&&xs!==void 0?xs:0,gs=[];for(let fs=0;fs<vs;fs++){const js=ys[fs],{filter:{event:Ss,schema:bs,table:Es,filter:Rs}}=js,ws=hs&&hs[fs];if(ws&&ws.event===Ss&&RealtimeChannel.isFilterValueEqual(ws.schema,bs)&&RealtimeChannel.isFilterValueEqual(ws.table,Es)&&RealtimeChannel.isFilterValueEqual(ws.filter,Rs))gs.push(Object.assign(Object.assign({},js),{id:ws.id}));else{this.unsubscribe(),this.state=CHANNEL_STATES.errored,ts==null||ts(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=gs,ts&&ts(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}}).receive("error",hs=>{this.state=CHANNEL_STATES.errored,ts==null||ts(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(hs).join(", ")||"error")))}).receive("timeout",()=>{ts==null||ts(REALTIME_SUBSCRIBE_STATES.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(ts,ss={}){return await this.send({type:"presence",event:"track",payload:ts},ss.timeout||this.timeout)}async untrack(ts={}){return await this.send({type:"presence",event:"untrack"},ts)}on(ts,ss,rs){return this.state===CHANNEL_STATES.joined&&ts===REALTIME_LISTEN_TYPES.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(ts,ss,rs)}async httpSend(ts,ss,rs={}){var ns;if(ss==null)return Promise.reject("Payload is required for httpSend()");const os={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(os.Authorization=`Bearer ${this.socket.accessTokenValue}`);const as={method:"POST",headers:os,body:JSON.stringify({messages:[{topic:this.subTopic,event:ts,payload:ss,private:this.private}]})},ls=await this._fetchWithTimeout(this.broadcastEndpointURL,as,(ns=rs.timeout)!==null&&ns!==void 0?ns:this.timeout);if(ls.status===202)return{success:!0};let cs=ls.statusText;try{const us=await ls.json();cs=us.error||us.message||cs}catch{}return Promise.reject(new Error(cs))}async send(ts,ss={}){var rs,ns;if(!this._canPush()&&ts.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:os,payload:as}=ts,ls={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(ls.Authorization=`Bearer ${this.socket.accessTokenValue}`);const cs={method:"POST",headers:ls,body:JSON.stringify({messages:[{topic:this.subTopic,event:os,payload:as,private:this.private}]})};try{const us=await this._fetchWithTimeout(this.broadcastEndpointURL,cs,(rs=ss.timeout)!==null&&rs!==void 0?rs:this.timeout);return await((ns=us.body)===null||ns===void 0?void 0:ns.cancel()),us.ok?"ok":"error"}catch(us){return us.name==="AbortError"?"timed out":"error"}}else return new Promise(os=>{var as,ls,cs;const us=this._push(ts.type,ts,ss.timeout||this.timeout);ts.type==="broadcast"&&!(!((cs=(ls=(as=this.params)===null||as===void 0?void 0:as.config)===null||ls===void 0?void 0:ls.broadcast)===null||cs===void 0)&&cs.ack)&&os("ok"),us.receive("ok",()=>os("ok")),us.receive("error",()=>os("error")),us.receive("timeout",()=>os("timed out"))})}updateJoinPayload(ts){this.joinPush.updatePayload(ts)}unsubscribe(ts=this.timeout){this.state=CHANNEL_STATES.leaving;const ss=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(CHANNEL_EVENTS.close,"leave",this._joinRef())};this.joinPush.destroy();let rs=null;return new Promise(ns=>{rs=new Push(this,CHANNEL_EVENTS.leave,{},ts),rs.receive("ok",()=>{ss(),ns("ok")}).receive("timeout",()=>{ss(),ns("timed out")}).receive("error",()=>{ns("error")}),rs.send(),this._canPush()||rs.trigger("ok",{})}).finally(()=>{rs==null||rs.destroy()})}teardown(){this.pushBuffer.forEach(ts=>ts.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=CHANNEL_STATES.closed,this.bindings={}}async _fetchWithTimeout(ts,ss,rs){const ns=new AbortController,os=setTimeout(()=>ns.abort(),rs),as=await this.socket.fetch(ts,Object.assign(Object.assign({},ss),{signal:ns.signal}));return clearTimeout(os),as}_push(ts,ss,rs=this.timeout){if(!this.joinedOnce)throw`tried to push '${ts}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let ns=new Push(this,ts,ss,rs);return this._canPush()?ns.send():this._addToPushBuffer(ns),ns}_addToPushBuffer(ts){if(ts.startTimeout(),this.pushBuffer.push(ts),this.pushBuffer.length>MAX_PUSH_BUFFER_SIZE){const ss=this.pushBuffer.shift();ss&&(ss.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${ss.event}`,ss.payload))}}_onMessage(ts,ss,rs){return ss}_isMember(ts){return this.topic===ts}_joinRef(){return this.joinPush.ref}_trigger(ts,ss,rs){var ns,os;const as=ts.toLocaleLowerCase(),{close:ls,error:cs,leave:us,join:ds}=CHANNEL_EVENTS;if(rs&&[ls,cs,us,ds].indexOf(as)>=0&&rs!==this._joinRef())return;let ps=this._onMessage(as,ss,rs);if(ss&&!ps)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(as)?(ns=this.bindings.postgres_changes)===null||ns===void 0||ns.filter(hs=>{var xs,ys,vs;return((xs=hs.filter)===null||xs===void 0?void 0:xs.event)==="*"||((vs=(ys=hs.filter)===null||ys===void 0?void 0:ys.event)===null||vs===void 0?void 0:vs.toLocaleLowerCase())===as}).map(hs=>hs.callback(ps,rs)):(os=this.bindings[as])===null||os===void 0||os.filter(hs=>{var xs,ys,vs,gs,fs,js;if(["broadcast","presence","postgres_changes"].includes(as))if("id"in hs){const Ss=hs.id,bs=(xs=hs.filter)===null||xs===void 0?void 0:xs.event;return Ss&&((ys=ss.ids)===null||ys===void 0?void 0:ys.includes(Ss))&&(bs==="*"||(bs==null?void 0:bs.toLocaleLowerCase())===((vs=ss.data)===null||vs===void 0?void 0:vs.type.toLocaleLowerCase()))}else{const Ss=(fs=(gs=hs==null?void 0:hs.filter)===null||gs===void 0?void 0:gs.event)===null||fs===void 0?void 0:fs.toLocaleLowerCase();return Ss==="*"||Ss===((js=ss==null?void 0:ss.event)===null||js===void 0?void 0:js.toLocaleLowerCase())}else return hs.type.toLocaleLowerCase()===as}).map(hs=>{if(typeof ps=="object"&&"ids"in ps){const xs=ps.data,{schema:ys,table:vs,commit_timestamp:gs,type:fs,errors:js}=xs;ps=Object.assign(Object.assign({},{schema:ys,table:vs,commit_timestamp:gs,eventType:fs,new:{},old:{},errors:js}),this._getPayloadRecords(xs))}hs.callback(ps,rs)})}_isClosed(){return this.state===CHANNEL_STATES.closed}_isJoined(){return this.state===CHANNEL_STATES.joined}_isJoining(){return this.state===CHANNEL_STATES.joining}_isLeaving(){return this.state===CHANNEL_STATES.leaving}_replyEventName(ts){return`chan_reply_${ts}`}_on(ts,ss,rs){const ns=ts.toLocaleLowerCase(),os={type:ns,filter:ss,callback:rs};return this.bindings[ns]?this.bindings[ns].push(os):this.bindings[ns]=[os],this}_off(ts,ss){const rs=ts.toLocaleLowerCase();return this.bindings[rs]&&(this.bindings[rs]=this.bindings[rs].filter(ns=>{var os;return!(((os=ns.type)===null||os===void 0?void 0:os.toLocaleLowerCase())===rs&&RealtimeChannel.isEqual(ns.filter,ss))})),this}static isEqual(ts,ss){if(Object.keys(ts).length!==Object.keys(ss).length)return!1;for(const rs in ts)if(ts[rs]!==ss[rs])return!1;return!0}static isFilterValueEqual(ts,ss){return(ts??void 0)===(ss??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(ts){this._on(CHANNEL_EVENTS.close,{},ts)}_onError(ts){this._on(CHANNEL_EVENTS.error,{},ss=>ts(ss))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(ts=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=CHANNEL_STATES.joining,this.joinPush.resend(ts))}_getPayloadRecords(ts){const ss={new:{},old:{}};return(ts.type==="INSERT"||ts.type==="UPDATE")&&(ss.new=convertChangeData(ts.columns,ts.record)),(ts.type==="UPDATE"||ts.type==="DELETE")&&(ss.old=convertChangeData(ts.columns,ts.old_record)),ss}}const noop=()=>{},CONNECTION_TIMEOUTS={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},RECONNECT_INTERVALS=[1e3,2e3,5e3,1e4],DEFAULT_RECONNECT_FALLBACK=1e4,WORKER_SCRIPT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class RealtimeClient{constructor(ts,ss){var rs;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=DEFAULT_TIMEOUT,this.transport=null,this.heartbeatIntervalMs=CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=noop,this.ref=0,this.reconnectTimer=null,this.vsn=DEFAULT_VSN,this.logger=noop,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=ns=>ns?(...os)=>ns(...os):(...os)=>fetch(...os),!(!((rs=ss==null?void 0:ss.params)===null||rs===void 0)&&rs.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=ss.params.apikey,this.endPoint=`${ts}/${TRANSPORTS.websocket}`,this.httpEndpoint=httpEndpointURL(ts),this._initializeOptions(ss),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(ss==null?void 0:ss.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=WebSocketFactory.createWebSocket(this.endpointURL())}catch(ts){this._setConnectionState("disconnected");const ss=ts.message;throw ss.includes("Node.js")?new Error(`${ss}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${ss}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(ts,ss){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const rs=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(rs),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(ts?this.conn.close(ts,ss??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(ts){const ss=await ts.unsubscribe();return this.channels.length===0&&this.disconnect(),ss}async removeAllChannels(){const ts=await Promise.all(this.channels.map(ss=>ss.unsubscribe()));return this.channels=[],this.disconnect(),ts}log(ts,ss,rs){this.logger(ts,ss,rs)}connectionState(){switch(this.conn&&this.conn.readyState){case SOCKET_STATES.connecting:return CONNECTION_STATE.Connecting;case SOCKET_STATES.open:return CONNECTION_STATE.Open;case SOCKET_STATES.closing:return CONNECTION_STATE.Closing;default:return CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===CONNECTION_STATE.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(ts,ss={config:{}}){const rs=`realtime:${ts}`,ns=this.getChannels().find(os=>os.topic===rs);if(ns)return ns;{const os=new RealtimeChannel(`realtime:${ts}`,ss,this);return this.channels.push(os),os}}push(ts){const{topic:ss,event:rs,payload:ns,ref:os}=ts,as=()=>{this.encode(ts,ls=>{var cs;(cs=this.conn)===null||cs===void 0||cs.send(ls)})};this.log("push",`${ss} ${rs} (${os})`,ns),this.isConnected()?as():this.sendBuffer.push(as)}async setAuth(ts=null){this._authPromise=this._performAuth(ts);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var ts;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(ss){this.log("error","error in heartbeat callback",ss)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(ss){this.log("error","error in heartbeat callback",ss)}this._wasManualDisconnect=!1,(ts=this.conn)===null||ts===void 0||ts.close(WS_CLOSE_NORMAL,"heartbeat timeout"),setTimeout(()=>{var ss;this.isConnected()||(ss=this.reconnectTimer)===null||ss===void 0||ss.scheduleTimeout()},CONNECTION_TIMEOUTS.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(ss){this.log("error","error in heartbeat callback",ss)}this._setAuthSafely("heartbeat")}onHeartbeat(ts){this.heartbeatCallback=ts}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(ts=>ts()),this.sendBuffer=[])}_makeRef(){let ts=this.ref+1;return ts===this.ref?this.ref=0:this.ref=ts,this.ref.toString()}_leaveOpenTopic(ts){let ss=this.channels.find(rs=>rs.topic===ts&&(rs._isJoined()||rs._isJoining()));ss&&(this.log("transport",`leaving duplicate topic "${ts}"`),ss.unsubscribe())}_remove(ts){this.channels=this.channels.filter(ss=>ss.topic!==ts.topic)}_onConnMessage(ts){this.decode(ts.data,ss=>{if(ss.topic==="phoenix"&&ss.event==="phx_reply"&&ss.ref&&ss.ref===this.pendingHeartbeatRef){const us=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(ss.payload.status==="ok"?"ok":"error",us)}catch(ds){this.log("error","error in heartbeat callback",ds)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:rs,event:ns,payload:os,ref:as}=ss,ls=as?`(${as})`:"",cs=os.status||"";this.log("receive",`${cs} ${rs} ${ns} ${ls}`.trim(),os),this.channels.filter(us=>us._isMember(rs)).forEach(us=>us._trigger(ns,os,as)),this._triggerStateCallbacks("message",ss)})}_clearTimer(ts){var ss;ts==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):ts==="reconnect"&&((ss=this.reconnectTimer)===null||ss===void 0||ss.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=ts=>this._onConnError(ts),this.conn.onmessage=ts=>this._onConnMessage(ts),this.conn.onclose=ts=>this._onConnClose(ts),this.conn.readyState===SOCKET_STATES.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===SOCKET_STATES.open||this.conn.readyState===SOCKET_STATES.connecting)try{this.conn.close()}catch(ts){this.log("error","Error closing connection",ts)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(ts=>ts.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(ss=>{this.log("error","error waiting for auth on connect",ss),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const ts=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(ts),this.workerRef.onerror=ss=>{this.log("worker","worker error",ss.message),this._terminateWorker()},this.workerRef.onmessage=ss=>{ss.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(ts){var ss;this._setConnectionState("disconnected"),this.log("transport","close",ts),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(ss=this.reconnectTimer)===null||ss===void 0||ss.scheduleTimeout(),this._triggerStateCallbacks("close",ts)}_onConnError(ts){this._setConnectionState("disconnected"),this.log("transport",`${ts}`),this._triggerChanError(),this._triggerStateCallbacks("error",ts);try{this.heartbeatCallback("error")}catch(ss){this.log("error","error in heartbeat callback",ss)}}_triggerChanError(){this.channels.forEach(ts=>ts._trigger(CHANNEL_EVENTS.error))}_appendParams(ts,ss){if(Object.keys(ss).length===0)return ts;const rs=ts.match(/\?/)?"&":"?",ns=new URLSearchParams(ss);return`${ts}${rs}${ns}`}_workerObjectUrl(ts){let ss;if(ts)ss=ts;else{const rs=new Blob([WORKER_SCRIPT],{type:"application/javascript"});ss=URL.createObjectURL(rs)}return ss}_setConnectionState(ts,ss=!1){this._connectionState=ts,ts==="connecting"?this._wasManualDisconnect=!1:ts==="disconnecting"&&(this._wasManualDisconnect=ss)}async _performAuth(ts=null){let ss,rs=!1;if(ts)ss=ts,rs=!0;else if(this.accessToken)try{ss=await this.accessToken()}catch(ns){this.log("error","Error fetching access token from callback",ns),ss=this.accessTokenValue}else ss=this.accessTokenValue;rs?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=ss&&(this.accessTokenValue=ss,this.channels.forEach(ns=>{const os={access_token:ss,version:DEFAULT_VERSION};ss&&ns.updateJoinPayload(os),ns.joinedOnce&&ns._isJoined()&&ns._push(CHANNEL_EVENTS.access_token,{access_token:ss})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(ts="general"){this._isManualToken()||this.setAuth().catch(ss=>{this.log("error",`Error setting auth in ${ts}`,ss)})}_triggerStateCallbacks(ts,ss){try{this.stateChangeCallbacks[ts].forEach(rs=>{try{rs(ss)}catch(ns){this.log("error",`error in ${ts} callback`,ns)}})}catch(rs){this.log("error",`error triggering ${ts} callbacks`,rs)}}_setupReconnectionTimer(){this.reconnectTimer=new Timer(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},CONNECTION_TIMEOUTS.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(ts){var ss,rs,ns,os,as,ls,cs,us,ds,ms,ps,hs;switch(this.transport=(ss=ts==null?void 0:ts.transport)!==null&&ss!==void 0?ss:null,this.timeout=(rs=ts==null?void 0:ts.timeout)!==null&&rs!==void 0?rs:DEFAULT_TIMEOUT,this.heartbeatIntervalMs=(ns=ts==null?void 0:ts.heartbeatIntervalMs)!==null&&ns!==void 0?ns:CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.worker=(os=ts==null?void 0:ts.worker)!==null&&os!==void 0?os:!1,this.accessToken=(as=ts==null?void 0:ts.accessToken)!==null&&as!==void 0?as:null,this.heartbeatCallback=(ls=ts==null?void 0:ts.heartbeatCallback)!==null&&ls!==void 0?ls:noop,this.vsn=(cs=ts==null?void 0:ts.vsn)!==null&&cs!==void 0?cs:DEFAULT_VSN,ts!=null&&ts.params&&(this.params=ts.params),ts!=null&&ts.logger&&(this.logger=ts.logger),(ts!=null&&ts.logLevel||ts!=null&&ts.log_level)&&(this.logLevel=ts.logLevel||ts.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(us=ts==null?void 0:ts.reconnectAfterMs)!==null&&us!==void 0?us:xs=>RECONNECT_INTERVALS[xs-1]||DEFAULT_RECONNECT_FALLBACK,this.vsn){case VSN_1_0_0:this.encode=(ds=ts==null?void 0:ts.encode)!==null&&ds!==void 0?ds:(xs,ys)=>ys(JSON.stringify(xs)),this.decode=(ms=ts==null?void 0:ts.decode)!==null&&ms!==void 0?ms:(xs,ys)=>ys(JSON.parse(xs));break;case VSN_2_0_0:this.encode=(ps=ts==null?void 0:ts.encode)!==null&&ps!==void 0?ps:this.serializer.encode.bind(this.serializer),this.decode=(hs=ts==null?void 0:ts.decode)!==null&&hs!==void 0?hs:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=ts==null?void 0:ts.workerUrl}}}var IcebergError=class extends Error{constructor(es,ts){var ss;super(es),this.name="IcebergError",this.status=ts.status,this.icebergType=ts.icebergType,this.icebergCode=ts.icebergCode,this.details=ts.details,this.isCommitStateUnknown=ts.icebergType==="CommitStateUnknownException"||[500,502,504].includes(ts.status)&&((ss=ts.icebergType)==null?void 0:ss.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function buildUrl(es,ts,ss){const rs=new URL(ts,es);if(ss)for(const[ns,os]of Object.entries(ss))os!==void 0&&rs.searchParams.set(ns,os);return rs.toString()}async function buildAuthHeaders(es){return!es||es.type==="none"?{}:es.type==="bearer"?{Authorization:`Bearer ${es.token}`}:es.type==="header"?{[es.name]:es.value}:es.type==="custom"?await es.getHeaders():{}}function createFetchClient(es){const ts=es.fetchImpl??globalThis.fetch;return{async request({method:ss,path:rs,query:ns,body:os,headers:as}){const ls=buildUrl(es.baseUrl,rs,ns),cs=await buildAuthHeaders(es.auth),us=await ts(ls,{method:ss,headers:{...os?{"Content-Type":"application/json"}:{},...cs,...as},body:os?JSON.stringify(os):void 0}),ds=await us.text(),ms=(us.headers.get("content-type")||"").includes("application/json"),ps=ms&&ds?JSON.parse(ds):ds;if(!us.ok){const hs=ms?ps:void 0,xs=hs==null?void 0:hs.error;throw new IcebergError((xs==null?void 0:xs.message)??`Request failed with status ${us.status}`,{status:us.status,icebergType:xs==null?void 0:xs.type,icebergCode:xs==null?void 0:xs.code,details:hs})}return{status:us.status,headers:us.headers,data:ps}}}}function namespaceToPath(es){return es.join("")}var NamespaceOperations=class{constructor(es,ts=""){this.client=es,this.prefix=ts}async listNamespaces(es){const ts=es?{parent:namespaceToPath(es.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:ts})).data.namespaces.map(rs=>({namespace:rs}))}async createNamespace(es,ts){const ss={namespace:es.namespace,properties:ts==null?void 0:ts.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:ss})).data}async dropNamespace(es){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${namespaceToPath(es.namespace)}`})}async loadNamespaceMetadata(es){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${namespaceToPath(es.namespace)}`})).data.properties}}async namespaceExists(es){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${namespaceToPath(es.namespace)}`}),!0}catch(ts){if(ts instanceof IcebergError&&ts.status===404)return!1;throw ts}}async createNamespaceIfNotExists(es,ts){try{return await this.createNamespace(es,ts)}catch(ss){if(ss instanceof IcebergError&&ss.status===409)return;throw ss}}};function namespaceToPath2(es){return es.join("")}var TableOperations=class{constructor(es,ts="",ss){this.client=es,this.prefix=ts,this.accessDelegation=ss}async listTables(es){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${namespaceToPath2(es.namespace)}/tables`})).data.identifiers}async createTable(es,ts){const ss={};return this.accessDelegation&&(ss["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${namespaceToPath2(es.namespace)}/tables`,body:ts,headers:ss})).data.metadata}async updateTable(es,ts){const ss=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${namespaceToPath2(es.namespace)}/tables/${es.name}`,body:ts});return{"metadata-location":ss.data["metadata-location"],metadata:ss.data.metadata}}async dropTable(es,ts){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${namespaceToPath2(es.namespace)}/tables/${es.name}`,query:{purgeRequested:String((ts==null?void 0:ts.purge)??!1)}})}async loadTable(es){const ts={};return this.accessDelegation&&(ts["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${namespaceToPath2(es.namespace)}/tables/${es.name}`,headers:ts})).data.metadata}async tableExists(es){const ts={};this.accessDelegation&&(ts["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${namespaceToPath2(es.namespace)}/tables/${es.name}`,headers:ts}),!0}catch(ss){if(ss instanceof IcebergError&&ss.status===404)return!1;throw ss}}async createTableIfNotExists(es,ts){try{return await this.createTable(es,ts)}catch(ss){if(ss instanceof IcebergError&&ss.status===409)return await this.loadTable({namespace:es.namespace,name:ts.name});throw ss}}},IcebergRestCatalog=class{constructor(es){var rs;let ts="v1";es.catalogName&&(ts+=`/${es.catalogName}`);const ss=es.baseUrl.endsWith("/")?es.baseUrl:`${es.baseUrl}/`;this.client=createFetchClient({baseUrl:ss,auth:es.auth,fetchImpl:es.fetch}),this.accessDelegation=(rs=es.accessDelegation)==null?void 0:rs.join(","),this.namespaceOps=new NamespaceOperations(this.client,ts),this.tableOps=new TableOperations(this.client,ts,this.accessDelegation)}async listNamespaces(es){return this.namespaceOps.listNamespaces(es)}async createNamespace(es,ts){return this.namespaceOps.createNamespace(es,ts)}async dropNamespace(es){await this.namespaceOps.dropNamespace(es)}async loadNamespaceMetadata(es){return this.namespaceOps.loadNamespaceMetadata(es)}async listTables(es){return this.tableOps.listTables(es)}async createTable(es,ts){return this.tableOps.createTable(es,ts)}async updateTable(es,ts){return this.tableOps.updateTable(es,ts)}async dropTable(es,ts){await this.tableOps.dropTable(es,ts)}async loadTable(es){return this.tableOps.loadTable(es)}async namespaceExists(es){return this.namespaceOps.namespaceExists(es)}async tableExists(es){return this.tableOps.tableExists(es)}async createNamespaceIfNotExists(es,ts){return this.namespaceOps.createNamespaceIfNotExists(es,ts)}async createTableIfNotExists(es,ts){return this.tableOps.createTableIfNotExists(es,ts)}},StorageError=class extends Error{constructor(es,ts="storage",ss,rs){super(es),this.__isStorageError=!0,this.namespace=ts,this.name=ts==="vectors"?"StorageVectorsError":"StorageError",this.status=ss,this.statusCode=rs}};function isStorageError(es){return typeof es=="object"&&es!==null&&"__isStorageError"in es}var StorageApiError=class extends StorageError{constructor(es,ts,ss,rs="storage"){super(es,rs,ts,ss),this.name=rs==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=ts,this.statusCode=ss}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},StorageUnknownError=class extends StorageError{constructor(es,ts,ss="storage"){super(es,ss),this.name=ss==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=ts}};const resolveFetch$2=es=>es?(...ts)=>es(...ts):(...ts)=>fetch(...ts),isPlainObject=es=>{if(typeof es!="object"||es===null)return!1;const ts=Object.getPrototypeOf(es);return(ts===null||ts===Object.prototype||Object.getPrototypeOf(ts)===null)&&!(Symbol.toStringTag in es)&&!(Symbol.iterator in es)},recursiveToCamel=es=>{if(Array.isArray(es))return es.map(ss=>recursiveToCamel(ss));if(typeof es=="function"||es!==Object(es))return es;const ts={};return Object.entries(es).forEach(([ss,rs])=>{const ns=ss.replace(/([-_][a-z])/gi,os=>os.toUpperCase().replace(/[-_]/g,""));ts[ns]=recursiveToCamel(rs)}),ts},isValidBucketName=es=>!es||typeof es!="string"||es.length===0||es.length>100||es.trim()!==es||es.includes("/")||es.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(es);function _typeof$1(es){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ts){return typeof ts}:function(ts){return ts&&typeof Symbol=="function"&&ts.constructor===Symbol&&ts!==Symbol.prototype?"symbol":typeof ts},_typeof$1(es)}function toPrimitive$1(es,ts){if(_typeof$1(es)!="object"||!es)return es;var ss=es[Symbol.toPrimitive];if(ss!==void 0){var rs=ss.call(es,ts);if(_typeof$1(rs)!="object")return rs;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ts==="string"?String:Number)(es)}function toPropertyKey$1(es){var ts=toPrimitive$1(es,"string");return _typeof$1(ts)=="symbol"?ts:ts+""}function _defineProperty$1(es,ts,ss){return(ts=toPropertyKey$1(ts))in es?Object.defineProperty(es,ts,{value:ss,enumerable:!0,configurable:!0,writable:!0}):es[ts]=ss,es}function ownKeys$1(es,ts){var ss=Object.keys(es);if(Object.getOwnPropertySymbols){var rs=Object.getOwnPropertySymbols(es);ts&&(rs=rs.filter(function(ns){return Object.getOwnPropertyDescriptor(es,ns).enumerable})),ss.push.apply(ss,rs)}return ss}function _objectSpread2$1(es){for(var ts=1;ts<arguments.length;ts++){var ss=arguments[ts]!=null?arguments[ts]:{};ts%2?ownKeys$1(Object(ss),!0).forEach(function(rs){_defineProperty$1(es,rs,ss[rs])}):Object.getOwnPropertyDescriptors?Object.defineProperties(es,Object.getOwnPropertyDescriptors(ss)):ownKeys$1(Object(ss)).forEach(function(rs){Object.defineProperty(es,rs,Object.getOwnPropertyDescriptor(ss,rs))})}return es}const _getErrorMessage$1=es=>{var ts;return es.msg||es.message||es.error_description||(typeof es.error=="string"?es.error:(ts=es.error)===null||ts===void 0?void 0:ts.message)||JSON.stringify(es)},handleError$1=async(es,ts,ss,rs)=>{if(es&&typeof es=="object"&&"status"in es&&"ok"in es&&typeof es.status=="number"&&!(ss!=null&&ss.noResolveJson)){const ns=es,os=ns.status||500;if(typeof ns.json=="function")ns.json().then(as=>{const ls=(as==null?void 0:as.statusCode)||(as==null?void 0:as.code)||os+"";ts(new StorageApiError(_getErrorMessage$1(as),os,ls,rs))}).catch(()=>{if(rs==="vectors"){const as=os+"";ts(new StorageApiError(ns.statusText||`HTTP ${os} error`,os,as,rs))}else{const as=os+"";ts(new StorageApiError(ns.statusText||`HTTP ${os} error`,os,as,rs))}});else{const as=os+"";ts(new StorageApiError(ns.statusText||`HTTP ${os} error`,os,as,rs))}}else ts(new StorageUnknownError(_getErrorMessage$1(es),es,rs))},_getRequestParams$1=(es,ts,ss,rs)=>{const ns={method:es,headers:(ts==null?void 0:ts.headers)||{}};return es==="GET"||es==="HEAD"||!rs?_objectSpread2$1(_objectSpread2$1({},ns),ss):(isPlainObject(rs)?(ns.headers=_objectSpread2$1({"Content-Type":"application/json"},ts==null?void 0:ts.headers),ns.body=JSON.stringify(rs)):ns.body=rs,ts!=null&&ts.duplex&&(ns.duplex=ts.duplex),_objectSpread2$1(_objectSpread2$1({},ns),ss))};async function _handleRequest$1(es,ts,ss,rs,ns,os,as){return new Promise((ls,cs)=>{es(ss,_getRequestParams$1(ts,rs,ns,os)).then(us=>{if(!us.ok)throw us;if(rs!=null&&rs.noResolveJson)return us;if(as==="vectors"){const ds=us.headers.get("content-type");if(!ds||!ds.includes("application/json"))return{}}return us.json()}).then(us=>ls(us)).catch(us=>handleError$1(us,cs,rs,as))})}function createFetchApi(es="storage"){return{get:async(ts,ss,rs,ns)=>_handleRequest$1(ts,"GET",ss,rs,ns,void 0,es),post:async(ts,ss,rs,ns,os)=>_handleRequest$1(ts,"POST",ss,ns,os,rs,es),put:async(ts,ss,rs,ns,os)=>_handleRequest$1(ts,"PUT",ss,ns,os,rs,es),head:async(ts,ss,rs,ns)=>_handleRequest$1(ts,"HEAD",ss,_objectSpread2$1(_objectSpread2$1({},rs),{},{noResolveJson:!0}),ns,void 0,es),remove:async(ts,ss,rs,ns,os)=>_handleRequest$1(ts,"DELETE",ss,ns,os,rs,es)}}const defaultApi=createFetchApi("storage"),{get,post,put,head,remove}=defaultApi;var BaseApiClient=class{constructor(es,ts={},ss,rs="storage"){this.shouldThrowOnError=!1,this.url=es,this.headers=ts,this.fetch=resolveFetch$2(ss),this.namespace=rs}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(es){var ts=this;try{return{data:await es(),error:null}}catch(ss){if(ts.shouldThrowOnError)throw ss;if(isStorageError(ss))return{data:null,error:ss};throw ss}}},StreamDownloadBuilder=class{constructor(es,ts){this.downloadFn=es,this.shouldThrowOnError=ts}then(es,ts){return this.execute().then(es,ts)}async execute(){var es=this;try{return{data:(await es.downloadFn()).body,error:null}}catch(ts){if(es.shouldThrowOnError)throw ts;if(isStorageError(ts))return{data:null,error:ts};throw ts}}};let _Symbol$toStringTag;_Symbol$toStringTag=Symbol.toStringTag;var BlobDownloadBuilder=class{constructor(es,ts){this.downloadFn=es,this.shouldThrowOnError=ts,this[_Symbol$toStringTag]="BlobDownloadBuilder",this.promise=null}asStream(){return new StreamDownloadBuilder(this.downloadFn,this.shouldThrowOnError)}then(es,ts){return this.getPromise().then(es,ts)}catch(es){return this.getPromise().catch(es)}finally(es){return this.getPromise().finally(es)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var es=this;try{return{data:await(await es.downloadFn()).blob(),error:null}}catch(ts){if(es.shouldThrowOnError)throw ts;if(isStorageError(ts))return{data:null,error:ts};throw ts}}};const DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var StorageFileApi=class extends BaseApiClient{constructor(es,ts={},ss,rs){super(es,ts,rs,"storage"),this.bucketId=ss}async uploadOrUpdate(es,ts,ss,rs){var ns=this;return ns.handleOperation(async()=>{let os;const as=_objectSpread2$1(_objectSpread2$1({},DEFAULT_FILE_OPTIONS),rs);let ls=_objectSpread2$1(_objectSpread2$1({},ns.headers),es==="POST"&&{"x-upsert":String(as.upsert)});const cs=as.metadata;typeof Blob<"u"&&ss instanceof Blob?(os=new FormData,os.append("cacheControl",as.cacheControl),cs&&os.append("metadata",ns.encodeMetadata(cs)),os.append("",ss)):typeof FormData<"u"&&ss instanceof FormData?(os=ss,os.has("cacheControl")||os.append("cacheControl",as.cacheControl),cs&&!os.has("metadata")&&os.append("metadata",ns.encodeMetadata(cs))):(os=ss,ls["cache-control"]=`max-age=${as.cacheControl}`,ls["content-type"]=as.contentType,cs&&(ls["x-metadata"]=ns.toBase64(ns.encodeMetadata(cs))),(typeof ReadableStream<"u"&&os instanceof ReadableStream||os&&typeof os=="object"&&"pipe"in os&&typeof os.pipe=="function")&&!as.duplex&&(as.duplex="half")),rs!=null&&rs.headers&&(ls=_objectSpread2$1(_objectSpread2$1({},ls),rs.headers));const us=ns._removeEmptyFolders(ts),ds=ns._getFinalPath(us),ms=await(es=="PUT"?put:post)(ns.fetch,`${ns.url}/object/${ds}`,os,_objectSpread2$1({headers:ls},as!=null&&as.duplex?{duplex:as.duplex}:{}));return{path:us,id:ms.Id,fullPath:ms.Key}})}async upload(es,ts,ss){return this.uploadOrUpdate("POST",es,ts,ss)}async uploadToSignedUrl(es,ts,ss,rs){var ns=this;const os=ns._removeEmptyFolders(es),as=ns._getFinalPath(os),ls=new URL(ns.url+`/object/upload/sign/${as}`);return ls.searchParams.set("token",ts),ns.handleOperation(async()=>{let cs;const us=_objectSpread2$1({upsert:DEFAULT_FILE_OPTIONS.upsert},rs),ds=_objectSpread2$1(_objectSpread2$1({},ns.headers),{"x-upsert":String(us.upsert)});return typeof Blob<"u"&&ss instanceof Blob?(cs=new FormData,cs.append("cacheControl",us.cacheControl),cs.append("",ss)):typeof FormData<"u"&&ss instanceof FormData?(cs=ss,cs.append("cacheControl",us.cacheControl)):(cs=ss,ds["cache-control"]=`max-age=${us.cacheControl}`,ds["content-type"]=us.contentType),{path:os,fullPath:(await put(ns.fetch,ls.toString(),cs,{headers:ds})).Key}})}async createSignedUploadUrl(es,ts){var ss=this;return ss.handleOperation(async()=>{let rs=ss._getFinalPath(es);const ns=_objectSpread2$1({},ss.headers);ts!=null&&ts.upsert&&(ns["x-upsert"]="true");const os=await post(ss.fetch,`${ss.url}/object/upload/sign/${rs}`,{},{headers:ns}),as=new URL(ss.url+os.url),ls=as.searchParams.get("token");if(!ls)throw new StorageError("No token returned by API");return{signedUrl:as.toString(),path:es,token:ls}})}async update(es,ts,ss){return this.uploadOrUpdate("PUT",es,ts,ss)}async move(es,ts,ss){var rs=this;return rs.handleOperation(async()=>await post(rs.fetch,`${rs.url}/object/move`,{bucketId:rs.bucketId,sourceKey:es,destinationKey:ts,destinationBucket:ss==null?void 0:ss.destinationBucket},{headers:rs.headers}))}async copy(es,ts,ss){var rs=this;return rs.handleOperation(async()=>({path:(await post(rs.fetch,`${rs.url}/object/copy`,{bucketId:rs.bucketId,sourceKey:es,destinationKey:ts,destinationBucket:ss==null?void 0:ss.destinationBucket},{headers:rs.headers})).Key}))}async createSignedUrl(es,ts,ss){var rs=this;return rs.handleOperation(async()=>{let ns=rs._getFinalPath(es),os=await post(rs.fetch,`${rs.url}/object/sign/${ns}`,_objectSpread2$1({expiresIn:ts},ss!=null&&ss.transform?{transform:ss.transform}:{}),{headers:rs.headers});const as=ss!=null&&ss.download?`&download=${ss.download===!0?"":ss.download}`:"";return{signedUrl:encodeURI(`${rs.url}${os.signedURL}${as}`)}})}async createSignedUrls(es,ts,ss){var rs=this;return rs.handleOperation(async()=>{const ns=await post(rs.fetch,`${rs.url}/object/sign/${rs.bucketId}`,{expiresIn:ts,paths:es},{headers:rs.headers}),os=ss!=null&&ss.download?`&download=${ss.download===!0?"":ss.download}`:"";return ns.map(as=>_objectSpread2$1(_objectSpread2$1({},as),{},{signedUrl:as.signedURL?encodeURI(`${rs.url}${as.signedURL}${os}`):null}))})}download(es,ts){const ss=typeof(ts==null?void 0:ts.transform)<"u"?"render/image/authenticated":"object",rs=this.transformOptsToQueryString((ts==null?void 0:ts.transform)||{}),ns=rs?`?${rs}`:"",os=this._getFinalPath(es),as=()=>get(this.fetch,`${this.url}/${ss}/${os}${ns}`,{headers:this.headers,noResolveJson:!0});return new BlobDownloadBuilder(as,this.shouldThrowOnError)}async info(es){var ts=this;const ss=ts._getFinalPath(es);return ts.handleOperation(async()=>recursiveToCamel(await get(ts.fetch,`${ts.url}/object/info/${ss}`,{headers:ts.headers})))}async exists(es){var ts=this;const ss=ts._getFinalPath(es);try{return await head(ts.fetch,`${ts.url}/object/${ss}`,{headers:ts.headers}),{data:!0,error:null}}catch(rs){if(ts.shouldThrowOnError)throw rs;if(isStorageError(rs)&&rs instanceof StorageUnknownError){const ns=rs.originalError;if([400,404].includes(ns==null?void 0:ns.status))return{data:!1,error:rs}}throw rs}}getPublicUrl(es,ts){const ss=this._getFinalPath(es),rs=[],ns=ts!=null&&ts.download?`download=${ts.download===!0?"":ts.download}`:"";ns!==""&&rs.push(ns);const os=typeof(ts==null?void 0:ts.transform)<"u"?"render/image":"object",as=this.transformOptsToQueryString((ts==null?void 0:ts.transform)||{});as!==""&&rs.push(as);let ls=rs.join("&");return ls!==""&&(ls=`?${ls}`),{data:{publicUrl:encodeURI(`${this.url}/${os}/public/${ss}${ls}`)}}}async remove(es){var ts=this;return ts.handleOperation(async()=>await remove(ts.fetch,`${ts.url}/object/${ts.bucketId}`,{prefixes:es},{headers:ts.headers}))}async list(es,ts,ss){var rs=this;return rs.handleOperation(async()=>{const ns=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},DEFAULT_SEARCH_OPTIONS),ts),{},{prefix:es||""});return await post(rs.fetch,`${rs.url}/object/list/${rs.bucketId}`,ns,{headers:rs.headers},ss)})}async listV2(es,ts){var ss=this;return ss.handleOperation(async()=>{const rs=_objectSpread2$1({},es);return await post(ss.fetch,`${ss.url}/object/list-v2/${ss.bucketId}`,rs,{headers:ss.headers},ts)})}encodeMetadata(es){return JSON.stringify(es)}toBase64(es){return typeof Buffer<"u"?Buffer.from(es).toString("base64"):btoa(es)}_getFinalPath(es){return`${this.bucketId}/${es.replace(/^\/+/,"")}`}_removeEmptyFolders(es){return es.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(es){const ts=[];return es.width&&ts.push(`width=${es.width}`),es.height&&ts.push(`height=${es.height}`),es.resize&&ts.push(`resize=${es.resize}`),es.format&&ts.push(`format=${es.format}`),es.quality&&ts.push(`quality=${es.quality}`),ts.join("&")}};const version$2="2.93.1",DEFAULT_HEADERS$2={"X-Client-Info":`storage-js/${version$2}`};var StorageBucketApi=class extends BaseApiClient{constructor(es,ts={},ss,rs){const ns=new URL(es);rs!=null&&rs.useNewHostname&&/supabase\.(co|in|red)$/.test(ns.hostname)&&!ns.hostname.includes("storage.supabase.")&&(ns.hostname=ns.hostname.replace("supabase.","storage.supabase."));const os=ns.href.replace(/\/$/,""),as=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),ts);super(os,as,ss,"storage")}async listBuckets(es){var ts=this;return ts.handleOperation(async()=>{const ss=ts.listBucketOptionsToQueryString(es);return await get(ts.fetch,`${ts.url}/bucket${ss}`,{headers:ts.headers})})}async getBucket(es){var ts=this;return ts.handleOperation(async()=>await get(ts.fetch,`${ts.url}/bucket/${es}`,{headers:ts.headers}))}async createBucket(es,ts={public:!1}){var ss=this;return ss.handleOperation(async()=>await post(ss.fetch,`${ss.url}/bucket`,{id:es,name:es,type:ts.type,public:ts.public,file_size_limit:ts.fileSizeLimit,allowed_mime_types:ts.allowedMimeTypes},{headers:ss.headers}))}async updateBucket(es,ts){var ss=this;return ss.handleOperation(async()=>await put(ss.fetch,`${ss.url}/bucket/${es}`,{id:es,name:es,public:ts.public,file_size_limit:ts.fileSizeLimit,allowed_mime_types:ts.allowedMimeTypes},{headers:ss.headers}))}async emptyBucket(es){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/bucket/${es}/empty`,{},{headers:ts.headers}))}async deleteBucket(es){var ts=this;return ts.handleOperation(async()=>await remove(ts.fetch,`${ts.url}/bucket/${es}`,{},{headers:ts.headers}))}listBucketOptionsToQueryString(es){const ts={};return es&&("limit"in es&&(ts.limit=String(es.limit)),"offset"in es&&(ts.offset=String(es.offset)),es.search&&(ts.search=es.search),es.sortColumn&&(ts.sortColumn=es.sortColumn),es.sortOrder&&(ts.sortOrder=es.sortOrder)),Object.keys(ts).length>0?"?"+new URLSearchParams(ts).toString():""}},StorageAnalyticsClient=class extends BaseApiClient{constructor(es,ts={},ss){const rs=es.replace(/\/$/,""),ns=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),ts);super(rs,ns,ss,"storage")}async createBucket(es){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/bucket`,{name:es},{headers:ts.headers}))}async listBuckets(es){var ts=this;return ts.handleOperation(async()=>{const ss=new URLSearchParams;(es==null?void 0:es.limit)!==void 0&&ss.set("limit",es.limit.toString()),(es==null?void 0:es.offset)!==void 0&&ss.set("offset",es.offset.toString()),es!=null&&es.sortColumn&&ss.set("sortColumn",es.sortColumn),es!=null&&es.sortOrder&&ss.set("sortOrder",es.sortOrder),es!=null&&es.search&&ss.set("search",es.search);const rs=ss.toString(),ns=rs?`${ts.url}/bucket?${rs}`:`${ts.url}/bucket`;return await get(ts.fetch,ns,{headers:ts.headers})})}async deleteBucket(es){var ts=this;return ts.handleOperation(async()=>await remove(ts.fetch,`${ts.url}/bucket/${es}`,{},{headers:ts.headers}))}from(es){var ts=this;if(!isValidBucketName(es))throw new StorageError("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const ss=new IcebergRestCatalog({baseUrl:this.url,catalogName:es,auth:{type:"custom",getHeaders:async()=>ts.headers},fetch:this.fetch}),rs=this.shouldThrowOnError;return new Proxy(ss,{get(ns,os){const as=ns[os];return typeof as!="function"?as:async(...ls)=>{try{return{data:await as.apply(ns,ls),error:null}}catch(cs){if(rs)throw cs;return{data:null,error:cs}}}}})}},VectorIndexApi=class extends BaseApiClient{constructor(es,ts={},ss){const rs=es.replace(/\/$/,""),ns=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),{},{"Content-Type":"application/json"},ts);super(rs,ns,ss,"vectors")}async createIndex(es){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/CreateIndex`,es,{headers:ts.headers})||{})}async getIndex(es,ts){var ss=this;return ss.handleOperation(async()=>await post(ss.fetch,`${ss.url}/GetIndex`,{vectorBucketName:es,indexName:ts},{headers:ss.headers}))}async listIndexes(es){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/ListIndexes`,es,{headers:ts.headers}))}async deleteIndex(es,ts){var ss=this;return ss.handleOperation(async()=>await post(ss.fetch,`${ss.url}/DeleteIndex`,{vectorBucketName:es,indexName:ts},{headers:ss.headers})||{})}},VectorDataApi=class extends BaseApiClient{constructor(es,ts={},ss){const rs=es.replace(/\/$/,""),ns=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),{},{"Content-Type":"application/json"},ts);super(rs,ns,ss,"vectors")}async putVectors(es){var ts=this;if(es.vectors.length<1||es.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/PutVectors`,es,{headers:ts.headers})||{})}async getVectors(es){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/GetVectors`,es,{headers:ts.headers}))}async listVectors(es){var ts=this;if(es.segmentCount!==void 0){if(es.segmentCount<1||es.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(es.segmentIndex!==void 0&&(es.segmentIndex<0||es.segmentIndex>=es.segmentCount))throw new Error(`segmentIndex must be between 0 and ${es.segmentCount-1}`)}return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/ListVectors`,es,{headers:ts.headers}))}async queryVectors(es){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/QueryVectors`,es,{headers:ts.headers}))}async deleteVectors(es){var ts=this;if(es.keys.length<1||es.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/DeleteVectors`,es,{headers:ts.headers})||{})}},VectorBucketApi=class extends BaseApiClient{constructor(es,ts={},ss){const rs=es.replace(/\/$/,""),ns=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),{},{"Content-Type":"application/json"},ts);super(rs,ns,ss,"vectors")}async createBucket(es){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/CreateVectorBucket`,{vectorBucketName:es},{headers:ts.headers})||{})}async getBucket(es){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/GetVectorBucket`,{vectorBucketName:es},{headers:ts.headers}))}async listBuckets(es={}){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/ListVectorBuckets`,es,{headers:ts.headers}))}async deleteBucket(es){var ts=this;return ts.handleOperation(async()=>await post(ts.fetch,`${ts.url}/DeleteVectorBucket`,{vectorBucketName:es},{headers:ts.headers})||{})}},StorageVectorsClient=class extends VectorBucketApi{constructor(es,ts={}){super(es,ts.headers||{},ts.fetch)}from(es){return new VectorBucketScope(this.url,this.headers,es,this.fetch)}async createBucket(es){var ts=()=>super.createBucket,ss=this;return ts().call(ss,es)}async getBucket(es){var ts=()=>super.getBucket,ss=this;return ts().call(ss,es)}async listBuckets(es={}){var ts=()=>super.listBuckets,ss=this;return ts().call(ss,es)}async deleteBucket(es){var ts=()=>super.deleteBucket,ss=this;return ts().call(ss,es)}},VectorBucketScope=class extends VectorIndexApi{constructor(es,ts,ss,rs){super(es,ts,rs),this.vectorBucketName=ss}async createIndex(es){var ts=()=>super.createIndex,ss=this;return ts().call(ss,_objectSpread2$1(_objectSpread2$1({},es),{},{vectorBucketName:ss.vectorBucketName}))}async listIndexes(es={}){var ts=()=>super.listIndexes,ss=this;return ts().call(ss,_objectSpread2$1(_objectSpread2$1({},es),{},{vectorBucketName:ss.vectorBucketName}))}async getIndex(es){var ts=()=>super.getIndex,ss=this;return ts().call(ss,ss.vectorBucketName,es)}async deleteIndex(es){var ts=()=>super.deleteIndex,ss=this;return ts().call(ss,ss.vectorBucketName,es)}index(es){return new VectorIndexScope(this.url,this.headers,this.vectorBucketName,es,this.fetch)}},VectorIndexScope=class extends VectorDataApi{constructor(es,ts,ss,rs,ns){super(es,ts,ns),this.vectorBucketName=ss,this.indexName=rs}async putVectors(es){var ts=()=>super.putVectors,ss=this;return ts().call(ss,_objectSpread2$1(_objectSpread2$1({},es),{},{vectorBucketName:ss.vectorBucketName,indexName:ss.indexName}))}async getVectors(es){var ts=()=>super.getVectors,ss=this;return ts().call(ss,_objectSpread2$1(_objectSpread2$1({},es),{},{vectorBucketName:ss.vectorBucketName,indexName:ss.indexName}))}async listVectors(es={}){var ts=()=>super.listVectors,ss=this;return ts().call(ss,_objectSpread2$1(_objectSpread2$1({},es),{},{vectorBucketName:ss.vectorBucketName,indexName:ss.indexName}))}async queryVectors(es){var ts=()=>super.queryVectors,ss=this;return ts().call(ss,_objectSpread2$1(_objectSpread2$1({},es),{},{vectorBucketName:ss.vectorBucketName,indexName:ss.indexName}))}async deleteVectors(es){var ts=()=>super.deleteVectors,ss=this;return ts().call(ss,_objectSpread2$1(_objectSpread2$1({},es),{},{vectorBucketName:ss.vectorBucketName,indexName:ss.indexName}))}},StorageClient=class extends StorageBucketApi{constructor(es,ts={},ss,rs){super(es,ts,ss,rs)}from(es){return new StorageFileApi(this.url,this.headers,es,this.fetch)}get vectors(){return new StorageVectorsClient(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new StorageAnalyticsClient(this.url+"/iceberg",this.headers,this.fetch)}};const version$1="2.93.1",AUTO_REFRESH_TICK_DURATION_MS=30*1e3,AUTO_REFRESH_TICK_THRESHOLD=3,EXPIRY_MARGIN_MS=AUTO_REFRESH_TICK_THRESHOLD*AUTO_REFRESH_TICK_DURATION_MS,GOTRUE_URL="http://localhost:9999",STORAGE_KEY="supabase.auth.token",DEFAULT_HEADERS$1={"X-Client-Info":`gotrue-js/${version$1}`},API_VERSION_HEADER_NAME="X-Supabase-Api-Version",API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},BASE64URL_REGEX=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,JWKS_TTL=10*60*1e3;class AuthError extends Error{constructor(ts,ss,rs){super(ts),this.__isAuthError=!0,this.name="AuthError",this.status=ss,this.code=rs}}function isAuthError(es){return typeof es=="object"&&es!==null&&"__isAuthError"in es}class AuthApiError extends AuthError{constructor(ts,ss,rs){super(ts,ss,rs),this.name="AuthApiError",this.status=ss,this.code=rs}}function isAuthApiError(es){return isAuthError(es)&&es.name==="AuthApiError"}class AuthUnknownError extends AuthError{constructor(ts,ss){super(ts),this.name="AuthUnknownError",this.originalError=ss}}class CustomAuthError extends AuthError{constructor(ts,ss,rs,ns){super(ts,rs,ns),this.name=ss,this.status=rs}}class AuthSessionMissingError extends CustomAuthError{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function isAuthSessionMissingError(es){return isAuthError(es)&&es.name==="AuthSessionMissingError"}class AuthInvalidTokenResponseError extends CustomAuthError{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class AuthInvalidCredentialsError extends CustomAuthError{constructor(ts){super(ts,"AuthInvalidCredentialsError",400,void 0)}}class AuthImplicitGrantRedirectError extends CustomAuthError{constructor(ts,ss=null){super(ts,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=ss}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function isAuthImplicitGrantRedirectError(es){return isAuthError(es)&&es.name==="AuthImplicitGrantRedirectError"}class AuthPKCEGrantCodeExchangeError extends CustomAuthError{constructor(ts,ss=null){super(ts,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=ss}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthPKCECodeVerifierMissingError extends CustomAuthError{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class AuthRetryableFetchError extends CustomAuthError{constructor(ts,ss){super(ts,"AuthRetryableFetchError",ss,void 0)}}function isAuthRetryableFetchError(es){return isAuthError(es)&&es.name==="AuthRetryableFetchError"}class AuthWeakPasswordError extends CustomAuthError{constructor(ts,ss,rs){super(ts,"AuthWeakPasswordError",ss,"weak_password"),this.reasons=rs}}class AuthInvalidJwtError extends CustomAuthError{constructor(ts){super(ts,"AuthInvalidJwtError",400,"invalid_jwt")}}const TO_BASE64URL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),IGNORE_BASE64URL=` 	
\r=`.split(""),FROM_BASE64URL=(()=>{const es=new Array(128);for(let ts=0;ts<es.length;ts+=1)es[ts]=-1;for(let ts=0;ts<IGNORE_BASE64URL.length;ts+=1)es[IGNORE_BASE64URL[ts].charCodeAt(0)]=-2;for(let ts=0;ts<TO_BASE64URL.length;ts+=1)es[TO_BASE64URL[ts].charCodeAt(0)]=ts;return es})();function byteToBase64URL(es,ts,ss){if(es!==null)for(ts.queue=ts.queue<<8|es,ts.queuedBits+=8;ts.queuedBits>=6;){const rs=ts.queue>>ts.queuedBits-6&63;ss(TO_BASE64URL[rs]),ts.queuedBits-=6}else if(ts.queuedBits>0)for(ts.queue=ts.queue<<6-ts.queuedBits,ts.queuedBits=6;ts.queuedBits>=6;){const rs=ts.queue>>ts.queuedBits-6&63;ss(TO_BASE64URL[rs]),ts.queuedBits-=6}}function byteFromBase64URL(es,ts,ss){const rs=FROM_BASE64URL[es];if(rs>-1)for(ts.queue=ts.queue<<6|rs,ts.queuedBits+=6;ts.queuedBits>=8;)ss(ts.queue>>ts.queuedBits-8&255),ts.queuedBits-=8;else{if(rs===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(es)}"`)}}function stringFromBase64URL(es){const ts=[],ss=as=>{ts.push(String.fromCodePoint(as))},rs={utf8seq:0,codepoint:0},ns={queue:0,queuedBits:0},os=as=>{stringFromUTF8(as,rs,ss)};for(let as=0;as<es.length;as+=1)byteFromBase64URL(es.charCodeAt(as),ns,os);return ts.join("")}function codepointToUTF8(es,ts){if(es<=127){ts(es);return}else if(es<=2047){ts(192|es>>6),ts(128|es&63);return}else if(es<=65535){ts(224|es>>12),ts(128|es>>6&63),ts(128|es&63);return}else if(es<=1114111){ts(240|es>>18),ts(128|es>>12&63),ts(128|es>>6&63),ts(128|es&63);return}throw new Error(`Unrecognized Unicode codepoint: ${es.toString(16)}`)}function stringToUTF8(es,ts){for(let ss=0;ss<es.length;ss+=1){let rs=es.charCodeAt(ss);if(rs>55295&&rs<=56319){const ns=(rs-55296)*1024&65535;rs=(es.charCodeAt(ss+1)-56320&65535|ns)+65536,ss+=1}codepointToUTF8(rs,ts)}}function stringFromUTF8(es,ts,ss){if(ts.utf8seq===0){if(es<=127){ss(es);return}for(let rs=1;rs<6;rs+=1)if(!(es>>7-rs&1)){ts.utf8seq=rs;break}if(ts.utf8seq===2)ts.codepoint=es&31;else if(ts.utf8seq===3)ts.codepoint=es&15;else if(ts.utf8seq===4)ts.codepoint=es&7;else throw new Error("Invalid UTF-8 sequence");ts.utf8seq-=1}else if(ts.utf8seq>0){if(es<=127)throw new Error("Invalid UTF-8 sequence");ts.codepoint=ts.codepoint<<6|es&63,ts.utf8seq-=1,ts.utf8seq===0&&ss(ts.codepoint)}}function base64UrlToUint8Array(es){const ts=[],ss={queue:0,queuedBits:0},rs=ns=>{ts.push(ns)};for(let ns=0;ns<es.length;ns+=1)byteFromBase64URL(es.charCodeAt(ns),ss,rs);return new Uint8Array(ts)}function stringToUint8Array(es){const ts=[];return stringToUTF8(es,ss=>ts.push(ss)),new Uint8Array(ts)}function bytesToBase64URL(es){const ts=[],ss={queue:0,queuedBits:0},rs=ns=>{ts.push(ns)};return es.forEach(ns=>byteToBase64URL(ns,ss,rs)),byteToBase64URL(null,ss,rs),ts.join("")}function expiresAt(es){return Math.round(Date.now()/1e3)+es}function generateCallbackId(){return Symbol("auth-callback")}const isBrowser=()=>typeof window<"u"&&typeof document<"u",localStorageWriteTests={tested:!1,writable:!1},supportsLocalStorage=()=>{if(!isBrowser())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(localStorageWriteTests.tested)return localStorageWriteTests.writable;const es=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(es,es),globalThis.localStorage.removeItem(es),localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!0}catch{localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!1}return localStorageWriteTests.writable};function parseParametersFromURL(es){const ts={},ss=new URL(es);if(ss.hash&&ss.hash[0]==="#")try{new URLSearchParams(ss.hash.substring(1)).forEach((ns,os)=>{ts[os]=ns})}catch{}return ss.searchParams.forEach((rs,ns)=>{ts[ns]=rs}),ts}const resolveFetch$1=es=>es?(...ts)=>es(...ts):(...ts)=>fetch(...ts),looksLikeFetchResponse=es=>typeof es=="object"&&es!==null&&"status"in es&&"ok"in es&&"json"in es&&typeof es.json=="function",setItemAsync=async(es,ts,ss)=>{await es.setItem(ts,JSON.stringify(ss))},getItemAsync=async(es,ts)=>{const ss=await es.getItem(ts);if(!ss)return null;try{return JSON.parse(ss)}catch{return ss}},removeItemAsync=async(es,ts)=>{await es.removeItem(ts)};class Deferred{constructor(){this.promise=new Deferred.promiseConstructor((ts,ss)=>{this.resolve=ts,this.reject=ss})}}Deferred.promiseConstructor=Promise;function decodeJWT(es){const ts=es.split(".");if(ts.length!==3)throw new AuthInvalidJwtError("Invalid JWT structure");for(let rs=0;rs<ts.length;rs++)if(!BASE64URL_REGEX.test(ts[rs]))throw new AuthInvalidJwtError("JWT not in base64url format");return{header:JSON.parse(stringFromBase64URL(ts[0])),payload:JSON.parse(stringFromBase64URL(ts[1])),signature:base64UrlToUint8Array(ts[2]),raw:{header:ts[0],payload:ts[1]}}}async function sleep(es){return await new Promise(ts=>{setTimeout(()=>ts(null),es)})}function retryable(es,ts){return new Promise((rs,ns)=>{(async()=>{for(let os=0;os<1/0;os++)try{const as=await es(os);if(!ts(os,null,as)){rs(as);return}}catch(as){if(!ts(os,as)){ns(as);return}}})()})}function dec2hex(es){return("0"+es.toString(16)).substr(-2)}function generatePKCEVerifier(){const ts=new Uint32Array(56);if(typeof crypto>"u"){const ss="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",rs=ss.length;let ns="";for(let os=0;os<56;os++)ns+=ss.charAt(Math.floor(Math.random()*rs));return ns}return crypto.getRandomValues(ts),Array.from(ts,dec2hex).join("")}async function sha256(es){const ss=new TextEncoder().encode(es),rs=await crypto.subtle.digest("SHA-256",ss),ns=new Uint8Array(rs);return Array.from(ns).map(os=>String.fromCharCode(os)).join("")}async function generatePKCEChallenge(es){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),es;const ss=await sha256(es);return btoa(ss).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function getCodeChallengeAndMethod(es,ts,ss=!1){const rs=generatePKCEVerifier();let ns=rs;ss&&(ns+="/PASSWORD_RECOVERY"),await setItemAsync(es,`${ts}-code-verifier`,ns);const os=await generatePKCEChallenge(rs);return[os,rs===os?"plain":"s256"]}const API_VERSION_REGEX=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function parseResponseAPIVersion(es){const ts=es.headers.get(API_VERSION_HEADER_NAME);if(!ts||!ts.match(API_VERSION_REGEX))return null;try{return new Date(`${ts}T00:00:00.0Z`)}catch{return null}}function validateExp(es){if(!es)throw new Error("Missing exp claim");const ts=Math.floor(Date.now()/1e3);if(es<=ts)throw new Error("JWT has expired")}function getAlgorithm(es){switch(es){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const UUID_REGEX=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function validateUUID(es){if(!UUID_REGEX.test(es))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function userNotAvailableProxy(){const es={};return new Proxy(es,{get:(ts,ss)=>{if(ss==="__isUserNotAvailableProxy")return!0;if(typeof ss=="symbol"){const rs=ss.toString();if(rs==="Symbol(Symbol.toPrimitive)"||rs==="Symbol(Symbol.toStringTag)"||rs==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${ss}" property of the session object is not supported. Please use getUser() instead.`)},set:(ts,ss)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${ss}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(ts,ss)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${ss}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function insecureUserWarningProxy(es,ts){return new Proxy(es,{get:(ss,rs,ns)=>{if(rs==="__isInsecureUserWarningProxy")return!0;if(typeof rs=="symbol"){const os=rs.toString();if(os==="Symbol(Symbol.toPrimitive)"||os==="Symbol(Symbol.toStringTag)"||os==="Symbol(util.inspect.custom)"||os==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(ss,rs,ns)}return!ts.value&&typeof rs=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),ts.value=!0),Reflect.get(ss,rs,ns)}})}function deepClone(es){return JSON.parse(JSON.stringify(es))}const _getErrorMessage=es=>es.msg||es.message||es.error_description||es.error||JSON.stringify(es),NETWORK_ERROR_CODES=[502,503,504];async function handleError(es){var ts;if(!looksLikeFetchResponse(es))throw new AuthRetryableFetchError(_getErrorMessage(es),0);if(NETWORK_ERROR_CODES.includes(es.status))throw new AuthRetryableFetchError(_getErrorMessage(es),es.status);let ss;try{ss=await es.json()}catch(os){throw new AuthUnknownError(_getErrorMessage(os),os)}let rs;const ns=parseResponseAPIVersion(es);if(ns&&ns.getTime()>=API_VERSIONS["2024-01-01"].timestamp&&typeof ss=="object"&&ss&&typeof ss.code=="string"?rs=ss.code:typeof ss=="object"&&ss&&typeof ss.error_code=="string"&&(rs=ss.error_code),rs){if(rs==="weak_password")throw new AuthWeakPasswordError(_getErrorMessage(ss),es.status,((ts=ss.weak_password)===null||ts===void 0?void 0:ts.reasons)||[]);if(rs==="session_not_found")throw new AuthSessionMissingError}else if(typeof ss=="object"&&ss&&typeof ss.weak_password=="object"&&ss.weak_password&&Array.isArray(ss.weak_password.reasons)&&ss.weak_password.reasons.length&&ss.weak_password.reasons.reduce((os,as)=>os&&typeof as=="string",!0))throw new AuthWeakPasswordError(_getErrorMessage(ss),es.status,ss.weak_password.reasons);throw new AuthApiError(_getErrorMessage(ss),es.status||500,rs)}const _getRequestParams=(es,ts,ss,rs)=>{const ns={method:es,headers:(ts==null?void 0:ts.headers)||{}};return es==="GET"?ns:(ns.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},ts==null?void 0:ts.headers),ns.body=JSON.stringify(rs),Object.assign(Object.assign({},ns),ss))};async function _request(es,ts,ss,rs){var ns;const os=Object.assign({},rs==null?void 0:rs.headers);os[API_VERSION_HEADER_NAME]||(os[API_VERSION_HEADER_NAME]=API_VERSIONS["2024-01-01"].name),rs!=null&&rs.jwt&&(os.Authorization=`Bearer ${rs.jwt}`);const as=(ns=rs==null?void 0:rs.query)!==null&&ns!==void 0?ns:{};rs!=null&&rs.redirectTo&&(as.redirect_to=rs.redirectTo);const ls=Object.keys(as).length?"?"+new URLSearchParams(as).toString():"",cs=await _handleRequest(es,ts,ss+ls,{headers:os,noResolveJson:rs==null?void 0:rs.noResolveJson},{},rs==null?void 0:rs.body);return rs!=null&&rs.xform?rs==null?void 0:rs.xform(cs):{data:Object.assign({},cs),error:null}}async function _handleRequest(es,ts,ss,rs,ns,os){const as=_getRequestParams(ts,rs,ns,os);let ls;try{ls=await es(ss,Object.assign({},as))}catch(cs){throw console.error(cs),new AuthRetryableFetchError(_getErrorMessage(cs),0)}if(ls.ok||await handleError(ls),rs!=null&&rs.noResolveJson)return ls;try{return await ls.json()}catch(cs){await handleError(cs)}}function _sessionResponse(es){var ts;let ss=null;hasSession(es)&&(ss=Object.assign({},es),es.expires_at||(ss.expires_at=expiresAt(es.expires_in)));const rs=(ts=es.user)!==null&&ts!==void 0?ts:es;return{data:{session:ss,user:rs},error:null}}function _sessionResponsePassword(es){const ts=_sessionResponse(es);return!ts.error&&es.weak_password&&typeof es.weak_password=="object"&&Array.isArray(es.weak_password.reasons)&&es.weak_password.reasons.length&&es.weak_password.message&&typeof es.weak_password.message=="string"&&es.weak_password.reasons.reduce((ss,rs)=>ss&&typeof rs=="string",!0)&&(ts.data.weak_password=es.weak_password),ts}function _userResponse(es){var ts;return{data:{user:(ts=es.user)!==null&&ts!==void 0?ts:es},error:null}}function _ssoResponse(es){return{data:es,error:null}}function _generateLinkResponse(es){const{action_link:ts,email_otp:ss,hashed_token:rs,redirect_to:ns,verification_type:os}=es,as=__rest(es,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),ls={action_link:ts,email_otp:ss,hashed_token:rs,redirect_to:ns,verification_type:os},cs=Object.assign({},as);return{data:{properties:ls,user:cs},error:null}}function _noResolveJsonResponse(es){return es}function hasSession(es){return es.access_token&&es.refresh_token&&es.expires_in}const SIGN_OUT_SCOPES=["global","local","others"];class GoTrueAdminApi{constructor({url:ts="",headers:ss={},fetch:rs}){this.url=ts,this.headers=ss,this.fetch=resolveFetch$1(rs),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(ts,ss=SIGN_OUT_SCOPES[0]){if(SIGN_OUT_SCOPES.indexOf(ss)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${SIGN_OUT_SCOPES.join(", ")}`);try{return await _request(this.fetch,"POST",`${this.url}/logout?scope=${ss}`,{headers:this.headers,jwt:ts,noResolveJson:!0}),{data:null,error:null}}catch(rs){if(isAuthError(rs))return{data:null,error:rs};throw rs}}async inviteUserByEmail(ts,ss={}){try{return await _request(this.fetch,"POST",`${this.url}/invite`,{body:{email:ts,data:ss.data},headers:this.headers,redirectTo:ss.redirectTo,xform:_userResponse})}catch(rs){if(isAuthError(rs))return{data:{user:null},error:rs};throw rs}}async generateLink(ts){try{const{options:ss}=ts,rs=__rest(ts,["options"]),ns=Object.assign(Object.assign({},rs),ss);return"newEmail"in rs&&(ns.new_email=rs==null?void 0:rs.newEmail,delete ns.newEmail),await _request(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:ns,headers:this.headers,xform:_generateLinkResponse,redirectTo:ss==null?void 0:ss.redirectTo})}catch(ss){if(isAuthError(ss))return{data:{properties:null,user:null},error:ss};throw ss}}async createUser(ts){try{return await _request(this.fetch,"POST",`${this.url}/admin/users`,{body:ts,headers:this.headers,xform:_userResponse})}catch(ss){if(isAuthError(ss))return{data:{user:null},error:ss};throw ss}}async listUsers(ts){var ss,rs,ns,os,as,ls,cs;try{const us={nextPage:null,lastPage:0,total:0},ds=await _request(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(rs=(ss=ts==null?void 0:ts.page)===null||ss===void 0?void 0:ss.toString())!==null&&rs!==void 0?rs:"",per_page:(os=(ns=ts==null?void 0:ts.perPage)===null||ns===void 0?void 0:ns.toString())!==null&&os!==void 0?os:""},xform:_noResolveJsonResponse});if(ds.error)throw ds.error;const ms=await ds.json(),ps=(as=ds.headers.get("x-total-count"))!==null&&as!==void 0?as:0,hs=(cs=(ls=ds.headers.get("link"))===null||ls===void 0?void 0:ls.split(","))!==null&&cs!==void 0?cs:[];return hs.length>0&&(hs.forEach(xs=>{const ys=parseInt(xs.split(";")[0].split("=")[1].substring(0,1)),vs=JSON.parse(xs.split(";")[1].split("=")[1]);us[`${vs}Page`]=ys}),us.total=parseInt(ps)),{data:Object.assign(Object.assign({},ms),us),error:null}}catch(us){if(isAuthError(us))return{data:{users:[]},error:us};throw us}}async getUserById(ts){validateUUID(ts);try{return await _request(this.fetch,"GET",`${this.url}/admin/users/${ts}`,{headers:this.headers,xform:_userResponse})}catch(ss){if(isAuthError(ss))return{data:{user:null},error:ss};throw ss}}async updateUserById(ts,ss){validateUUID(ts);try{return await _request(this.fetch,"PUT",`${this.url}/admin/users/${ts}`,{body:ss,headers:this.headers,xform:_userResponse})}catch(rs){if(isAuthError(rs))return{data:{user:null},error:rs};throw rs}}async deleteUser(ts,ss=!1){validateUUID(ts);try{return await _request(this.fetch,"DELETE",`${this.url}/admin/users/${ts}`,{headers:this.headers,body:{should_soft_delete:ss},xform:_userResponse})}catch(rs){if(isAuthError(rs))return{data:{user:null},error:rs};throw rs}}async _listFactors(ts){validateUUID(ts.userId);try{const{data:ss,error:rs}=await _request(this.fetch,"GET",`${this.url}/admin/users/${ts.userId}/factors`,{headers:this.headers,xform:ns=>({data:{factors:ns},error:null})});return{data:ss,error:rs}}catch(ss){if(isAuthError(ss))return{data:null,error:ss};throw ss}}async _deleteFactor(ts){validateUUID(ts.userId),validateUUID(ts.id);try{return{data:await _request(this.fetch,"DELETE",`${this.url}/admin/users/${ts.userId}/factors/${ts.id}`,{headers:this.headers}),error:null}}catch(ss){if(isAuthError(ss))return{data:null,error:ss};throw ss}}async _listOAuthClients(ts){var ss,rs,ns,os,as,ls,cs;try{const us={nextPage:null,lastPage:0,total:0},ds=await _request(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(rs=(ss=ts==null?void 0:ts.page)===null||ss===void 0?void 0:ss.toString())!==null&&rs!==void 0?rs:"",per_page:(os=(ns=ts==null?void 0:ts.perPage)===null||ns===void 0?void 0:ns.toString())!==null&&os!==void 0?os:""},xform:_noResolveJsonResponse});if(ds.error)throw ds.error;const ms=await ds.json(),ps=(as=ds.headers.get("x-total-count"))!==null&&as!==void 0?as:0,hs=(cs=(ls=ds.headers.get("link"))===null||ls===void 0?void 0:ls.split(","))!==null&&cs!==void 0?cs:[];return hs.length>0&&(hs.forEach(xs=>{const ys=parseInt(xs.split(";")[0].split("=")[1].substring(0,1)),vs=JSON.parse(xs.split(";")[1].split("=")[1]);us[`${vs}Page`]=ys}),us.total=parseInt(ps)),{data:Object.assign(Object.assign({},ms),us),error:null}}catch(us){if(isAuthError(us))return{data:{clients:[]},error:us};throw us}}async _createOAuthClient(ts){try{return await _request(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:ts,headers:this.headers,xform:ss=>({data:ss,error:null})})}catch(ss){if(isAuthError(ss))return{data:null,error:ss};throw ss}}async _getOAuthClient(ts){try{return await _request(this.fetch,"GET",`${this.url}/admin/oauth/clients/${ts}`,{headers:this.headers,xform:ss=>({data:ss,error:null})})}catch(ss){if(isAuthError(ss))return{data:null,error:ss};throw ss}}async _updateOAuthClient(ts,ss){try{return await _request(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${ts}`,{body:ss,headers:this.headers,xform:rs=>({data:rs,error:null})})}catch(rs){if(isAuthError(rs))return{data:null,error:rs};throw rs}}async _deleteOAuthClient(ts){try{return await _request(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${ts}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(ss){if(isAuthError(ss))return{data:null,error:ss};throw ss}}async _regenerateOAuthClientSecret(ts){try{return await _request(this.fetch,"POST",`${this.url}/admin/oauth/clients/${ts}/regenerate_secret`,{headers:this.headers,xform:ss=>({data:ss,error:null})})}catch(ss){if(isAuthError(ss))return{data:null,error:ss};throw ss}}}function memoryLocalStorageAdapter(es={}){return{getItem:ts=>es[ts]||null,setItem:(ts,ss)=>{es[ts]=ss},removeItem:ts=>{delete es[ts]}}}const internals={debug:!!(globalThis&&supportsLocalStorage()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class LockAcquireTimeoutError extends Error{constructor(ts){super(ts),this.isAcquireTimeout=!0}}class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError{}async function navigatorLock(es,ts,ss){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",es,ts);const rs=new globalThis.AbortController;return ts>0&&setTimeout(()=>{rs.abort(),internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",es)},ts),await Promise.resolve().then(()=>globalThis.navigator.locks.request(es,ts===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:rs.signal},async ns=>{if(ns){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",es,ns.name);try{return await ss()}finally{internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",es,ns.name)}}else{if(ts===0)throw internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",es),new NavigatorLockAcquireTimeoutError(`Acquiring an exclusive Navigator LockManager lock "${es}" immediately failed`);if(internals.debug)try{const os=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(os,null,"  "))}catch(os){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",os)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await ss()}}))}function polyfillGlobalThis(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function getAddress(es){if(!/^0x[a-fA-F0-9]{40}$/.test(es))throw new Error(`@supabase/auth-js: Address "${es}" is invalid.`);return es.toLowerCase()}function fromHex(es){return parseInt(es,16)}function toHex(es){const ts=new TextEncoder().encode(es);return"0x"+Array.from(ts,rs=>rs.toString(16).padStart(2,"0")).join("")}function createSiweMessage(es){var ts;const{chainId:ss,domain:rs,expirationTime:ns,issuedAt:os=new Date,nonce:as,notBefore:ls,requestId:cs,resources:us,scheme:ds,uri:ms,version:ps}=es;{if(!Number.isInteger(ss))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${ss}`);if(!rs)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(as&&as.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${as}`);if(!ms)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(ps!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${ps}`);if(!((ts=es.statement)===null||ts===void 0)&&ts.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${es.statement}`)}const hs=getAddress(es.address),xs=ds?`${ds}://${rs}`:rs,ys=es.statement?`${es.statement}
`:"",vs=`${xs} wants you to sign in with your Ethereum account:
${hs}

${ys}`;let gs=`URI: ${ms}
Version: ${ps}
Chain ID: ${ss}${as?`
Nonce: ${as}`:""}
Issued At: ${os.toISOString()}`;if(ns&&(gs+=`
Expiration Time: ${ns.toISOString()}`),ls&&(gs+=`
Not Before: ${ls.toISOString()}`),cs&&(gs+=`
Request ID: ${cs}`),us){let fs=`
Resources:`;for(const js of us){if(!js||typeof js!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${js}`);fs+=`
- ${js}`}gs+=fs}return`${vs}
${gs}`}class WebAuthnError extends Error{constructor({message:ts,code:ss,cause:rs,name:ns}){var os;super(ts,{cause:rs}),this.__isWebAuthnError=!0,this.name=(os=ns??(rs instanceof Error?rs.name:void 0))!==null&&os!==void 0?os:"Unknown Error",this.code=ss}}class WebAuthnUnknownError extends WebAuthnError{constructor(ts,ss){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:ss,message:ts}),this.name="WebAuthnUnknownError",this.originalError=ss}}function identifyRegistrationError({error:es,options:ts}){var ss,rs,ns;const{publicKey:os}=ts;if(!os)throw Error("options was missing required publicKey property");if(es.name==="AbortError"){if(ts.signal instanceof AbortSignal)return new WebAuthnError({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:es})}else if(es.name==="ConstraintError"){if(((ss=os.authenticatorSelection)===null||ss===void 0?void 0:ss.requireResidentKey)===!0)return new WebAuthnError({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:es});if(ts.mediation==="conditional"&&((rs=os.authenticatorSelection)===null||rs===void 0?void 0:rs.userVerification)==="required")return new WebAuthnError({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:es});if(((ns=os.authenticatorSelection)===null||ns===void 0?void 0:ns.userVerification)==="required")return new WebAuthnError({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:es})}else{if(es.name==="InvalidStateError")return new WebAuthnError({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:es});if(es.name==="NotAllowedError")return new WebAuthnError({message:es.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:es});if(es.name==="NotSupportedError")return os.pubKeyCredParams.filter(ls=>ls.type==="public-key").length===0?new WebAuthnError({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:es}):new WebAuthnError({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:es});if(es.name==="SecurityError"){const as=window.location.hostname;if(isValidDomain(as)){if(os.rp.id!==as)return new WebAuthnError({message:`The RP ID "${os.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:es})}else return new WebAuthnError({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:es})}else if(es.name==="TypeError"){if(os.user.id.byteLength<1||os.user.id.byteLength>64)return new WebAuthnError({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:es})}else if(es.name==="UnknownError")return new WebAuthnError({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:es})}return new WebAuthnError({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:es})}function identifyAuthenticationError({error:es,options:ts}){const{publicKey:ss}=ts;if(!ss)throw Error("options was missing required publicKey property");if(es.name==="AbortError"){if(ts.signal instanceof AbortSignal)return new WebAuthnError({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:es})}else{if(es.name==="NotAllowedError")return new WebAuthnError({message:es.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:es});if(es.name==="SecurityError"){const rs=window.location.hostname;if(isValidDomain(rs)){if(ss.rpId!==rs)return new WebAuthnError({message:`The RP ID "${ss.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:es})}else return new WebAuthnError({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:es})}else if(es.name==="UnknownError")return new WebAuthnError({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:es})}return new WebAuthnError({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:es})}class WebAuthnAbortService{createNewAbortSignal(){if(this.controller){const ss=new Error("Cancelling existing WebAuthn API call for new one");ss.name="AbortError",this.controller.abort(ss)}const ts=new AbortController;return this.controller=ts,ts.signal}cancelCeremony(){if(this.controller){const ts=new Error("Manually cancelling existing WebAuthn API call");ts.name="AbortError",this.controller.abort(ts),this.controller=void 0}}}const webAuthnAbortService=new WebAuthnAbortService;function deserializeCredentialCreationOptions(es){if(!es)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(es);const{challenge:ts,user:ss,excludeCredentials:rs}=es,ns=__rest(es,["challenge","user","excludeCredentials"]),os=base64UrlToUint8Array(ts).buffer,as=Object.assign(Object.assign({},ss),{id:base64UrlToUint8Array(ss.id).buffer}),ls=Object.assign(Object.assign({},ns),{challenge:os,user:as});if(rs&&rs.length>0){ls.excludeCredentials=new Array(rs.length);for(let cs=0;cs<rs.length;cs++){const us=rs[cs];ls.excludeCredentials[cs]=Object.assign(Object.assign({},us),{id:base64UrlToUint8Array(us.id).buffer,type:us.type||"public-key",transports:us.transports})}}return ls}function deserializeCredentialRequestOptions(es){if(!es)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(es);const{challenge:ts,allowCredentials:ss}=es,rs=__rest(es,["challenge","allowCredentials"]),ns=base64UrlToUint8Array(ts).buffer,os=Object.assign(Object.assign({},rs),{challenge:ns});if(ss&&ss.length>0){os.allowCredentials=new Array(ss.length);for(let as=0;as<ss.length;as++){const ls=ss[as];os.allowCredentials[as]=Object.assign(Object.assign({},ls),{id:base64UrlToUint8Array(ls.id).buffer,type:ls.type||"public-key",transports:ls.transports})}}return os}function serializeCredentialCreationResponse(es){var ts;if("toJSON"in es&&typeof es.toJSON=="function")return es.toJSON();const ss=es;return{id:es.id,rawId:es.id,response:{attestationObject:bytesToBase64URL(new Uint8Array(es.response.attestationObject)),clientDataJSON:bytesToBase64URL(new Uint8Array(es.response.clientDataJSON))},type:"public-key",clientExtensionResults:es.getClientExtensionResults(),authenticatorAttachment:(ts=ss.authenticatorAttachment)!==null&&ts!==void 0?ts:void 0}}function serializeCredentialRequestResponse(es){var ts;if("toJSON"in es&&typeof es.toJSON=="function")return es.toJSON();const ss=es,rs=es.getClientExtensionResults(),ns=es.response;return{id:es.id,rawId:es.id,response:{authenticatorData:bytesToBase64URL(new Uint8Array(ns.authenticatorData)),clientDataJSON:bytesToBase64URL(new Uint8Array(ns.clientDataJSON)),signature:bytesToBase64URL(new Uint8Array(ns.signature)),userHandle:ns.userHandle?bytesToBase64URL(new Uint8Array(ns.userHandle)):void 0},type:"public-key",clientExtensionResults:rs,authenticatorAttachment:(ts=ss.authenticatorAttachment)!==null&&ts!==void 0?ts:void 0}}function isValidDomain(es){return es==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(es)}function browserSupportsWebAuthn(){var es,ts;return!!(isBrowser()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((es=navigator==null?void 0:navigator.credentials)===null||es===void 0?void 0:es.create)=="function"&&typeof((ts=navigator==null?void 0:navigator.credentials)===null||ts===void 0?void 0:ts.get)=="function")}async function createCredential(es){try{const ts=await navigator.credentials.create(es);return ts?ts instanceof PublicKeyCredential?{data:ts,error:null}:{data:null,error:new WebAuthnUnknownError("Browser returned unexpected credential type",ts)}:{data:null,error:new WebAuthnUnknownError("Empty credential response",ts)}}catch(ts){return{data:null,error:identifyRegistrationError({error:ts,options:es})}}}async function getCredential(es){try{const ts=await navigator.credentials.get(es);return ts?ts instanceof PublicKeyCredential?{data:ts,error:null}:{data:null,error:new WebAuthnUnknownError("Browser returned unexpected credential type",ts)}:{data:null,error:new WebAuthnUnknownError("Empty credential response",ts)}}catch(ts){return{data:null,error:identifyAuthenticationError({error:ts,options:es})}}}const DEFAULT_CREATION_OPTIONS={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},DEFAULT_REQUEST_OPTIONS={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function deepMerge(...es){const ts=ns=>ns!==null&&typeof ns=="object"&&!Array.isArray(ns),ss=ns=>ns instanceof ArrayBuffer||ArrayBuffer.isView(ns),rs={};for(const ns of es)if(ns)for(const os in ns){const as=ns[os];if(as!==void 0)if(Array.isArray(as))rs[os]=as;else if(ss(as))rs[os]=as;else if(ts(as)){const ls=rs[os];ts(ls)?rs[os]=deepMerge(ls,as):rs[os]=deepMerge(as)}else rs[os]=as}return rs}function mergeCredentialCreationOptions(es,ts){return deepMerge(DEFAULT_CREATION_OPTIONS,es,ts||{})}function mergeCredentialRequestOptions(es,ts){return deepMerge(DEFAULT_REQUEST_OPTIONS,es,ts||{})}class WebAuthnApi{constructor(ts){this.client=ts,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(ts){return this.client.mfa.enroll(Object.assign(Object.assign({},ts),{factorType:"webauthn"}))}async _challenge({factorId:ts,webauthn:ss,friendlyName:rs,signal:ns},os){try{const{data:as,error:ls}=await this.client.mfa.challenge({factorId:ts,webauthn:ss});if(!as)return{data:null,error:ls};const cs=ns??webAuthnAbortService.createNewAbortSignal();if(as.webauthn.type==="create"){const{user:us}=as.webauthn.credential_options.publicKey;us.name||(us.name=`${us.id}:${rs}`),us.displayName||(us.displayName=us.name)}switch(as.webauthn.type){case"create":{const us=mergeCredentialCreationOptions(as.webauthn.credential_options.publicKey,os==null?void 0:os.create),{data:ds,error:ms}=await createCredential({publicKey:us,signal:cs});return ds?{data:{factorId:ts,challengeId:as.id,webauthn:{type:as.webauthn.type,credential_response:ds}},error:null}:{data:null,error:ms}}case"request":{const us=mergeCredentialRequestOptions(as.webauthn.credential_options.publicKey,os==null?void 0:os.request),{data:ds,error:ms}=await getCredential(Object.assign(Object.assign({},as.webauthn.credential_options),{publicKey:us,signal:cs}));return ds?{data:{factorId:ts,challengeId:as.id,webauthn:{type:as.webauthn.type,credential_response:ds}},error:null}:{data:null,error:ms}}}}catch(as){return isAuthError(as)?{data:null,error:as}:{data:null,error:new AuthUnknownError("Unexpected error in challenge",as)}}}async _verify({challengeId:ts,factorId:ss,webauthn:rs}){return this.client.mfa.verify({factorId:ss,challengeId:ts,webauthn:rs})}async _authenticate({factorId:ts,webauthn:{rpId:ss=typeof window<"u"?window.location.hostname:void 0,rpOrigins:rs=typeof window<"u"?[window.location.origin]:void 0,signal:ns}={}},os){if(!ss)return{data:null,error:new AuthError("rpId is required for WebAuthn authentication")};try{if(!browserSupportsWebAuthn())return{data:null,error:new AuthUnknownError("Browser does not support WebAuthn",null)};const{data:as,error:ls}=await this.challenge({factorId:ts,webauthn:{rpId:ss,rpOrigins:rs},signal:ns},{request:os});if(!as)return{data:null,error:ls};const{webauthn:cs}=as;return this._verify({factorId:ts,challengeId:as.challengeId,webauthn:{type:cs.type,rpId:ss,rpOrigins:rs,credential_response:cs.credential_response}})}catch(as){return isAuthError(as)?{data:null,error:as}:{data:null,error:new AuthUnknownError("Unexpected error in authenticate",as)}}}async _register({friendlyName:ts,webauthn:{rpId:ss=typeof window<"u"?window.location.hostname:void 0,rpOrigins:rs=typeof window<"u"?[window.location.origin]:void 0,signal:ns}={}},os){if(!ss)return{data:null,error:new AuthError("rpId is required for WebAuthn registration")};try{if(!browserSupportsWebAuthn())return{data:null,error:new AuthUnknownError("Browser does not support WebAuthn",null)};const{data:as,error:ls}=await this._enroll({friendlyName:ts});if(!as)return await this.client.mfa.listFactors().then(ds=>{var ms;return(ms=ds.data)===null||ms===void 0?void 0:ms.all.find(ps=>ps.factor_type==="webauthn"&&ps.friendly_name===ts&&ps.status!=="unverified")}).then(ds=>ds?this.client.mfa.unenroll({factorId:ds==null?void 0:ds.id}):void 0),{data:null,error:ls};const{data:cs,error:us}=await this._challenge({factorId:as.id,friendlyName:as.friendly_name,webauthn:{rpId:ss,rpOrigins:rs},signal:ns},{create:os});return cs?this._verify({factorId:as.id,challengeId:cs.challengeId,webauthn:{rpId:ss,rpOrigins:rs,type:cs.webauthn.type,credential_response:cs.webauthn.credential_response}}):{data:null,error:us}}catch(as){return isAuthError(as)?{data:null,error:as}:{data:null,error:new AuthUnknownError("Unexpected error in register",as)}}}}polyfillGlobalThis();const DEFAULT_OPTIONS={url:GOTRUE_URL,storageKey:STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:DEFAULT_HEADERS$1,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function lockNoOp(es,ts,ss){return await ss()}const GLOBAL_JWKS={};class GoTrueClient{get jwks(){var ts,ss;return(ss=(ts=GLOBAL_JWKS[this.storageKey])===null||ts===void 0?void 0:ts.jwks)!==null&&ss!==void 0?ss:{keys:[]}}set jwks(ts){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{jwks:ts})}get jwks_cached_at(){var ts,ss;return(ss=(ts=GLOBAL_JWKS[this.storageKey])===null||ts===void 0?void 0:ts.cachedAt)!==null&&ss!==void 0?ss:Number.MIN_SAFE_INTEGER}set jwks_cached_at(ts){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{cachedAt:ts})}constructor(ts){var ss,rs,ns;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const os=Object.assign(Object.assign({},DEFAULT_OPTIONS),ts);if(this.storageKey=os.storageKey,this.instanceID=(ss=GoTrueClient.nextInstanceID[this.storageKey])!==null&&ss!==void 0?ss:0,GoTrueClient.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!os.debug,typeof os.debug=="function"&&(this.logger=os.debug),this.instanceID>0&&isBrowser()){const as=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(as),this.logDebugMessages&&console.trace(as)}if(this.persistSession=os.persistSession,this.autoRefreshToken=os.autoRefreshToken,this.admin=new GoTrueAdminApi({url:os.url,headers:os.headers,fetch:os.fetch}),this.url=os.url,this.headers=os.headers,this.fetch=resolveFetch$1(os.fetch),this.lock=os.lock||lockNoOp,this.detectSessionInUrl=os.detectSessionInUrl,this.flowType=os.flowType,this.hasCustomAuthorizationHeader=os.hasCustomAuthorizationHeader,this.throwOnError=os.throwOnError,this.lockAcquireTimeout=os.lockAcquireTimeout,os.lock?this.lock=os.lock:this.persistSession&&isBrowser()&&(!((rs=globalThis==null?void 0:globalThis.navigator)===null||rs===void 0)&&rs.locks)?this.lock=navigatorLock:this.lock=lockNoOp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new WebAuthnApi(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(os.storage?this.storage=os.storage:supportsLocalStorage()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),os.userStorage&&(this.userStorage=os.userStorage)):(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),isBrowser()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(as){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",as)}(ns=this.broadcastChannel)===null||ns===void 0||ns.addEventListener("message",async as=>{this._debug("received broadcast notification from other tab or client",as);try{await this._notifyAllSubscribers(as.data.event,as.data.session,!1)}catch(ls){this._debug("#broadcastChannel","error",ls)}})}this.initialize().catch(as=>{this._debug("#initialize()","error",as)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(ts){if(this.throwOnError&&ts&&ts.error)throw ts.error;return ts}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${version$1}) ${new Date().toISOString()}`}_debug(...ts){return this.logDebugMessages&&this.logger(this._logPrefix(),...ts),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var ts;try{let ss={},rs="none";if(isBrowser()&&(ss=parseParametersFromURL(window.location.href),this._isImplicitGrantCallback(ss)?rs="implicit":await this._isPKCECallback(ss)&&(rs="pkce")),isBrowser()&&this.detectSessionInUrl&&rs!=="none"){const{data:ns,error:os}=await this._getSessionFromURL(ss,rs);if(os){if(this._debug("#_initialize()","error detecting session from URL",os),isAuthImplicitGrantRedirectError(os)){const cs=(ts=os.details)===null||ts===void 0?void 0:ts.code;if(cs==="identity_already_exists"||cs==="identity_not_found"||cs==="single_identity_not_deletable")return{error:os}}return{error:os}}const{session:as,redirectType:ls}=ns;return this._debug("#_initialize()","detected session in URL",as,"redirect type",ls),await this._saveSession(as),setTimeout(async()=>{ls==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",as):await this._notifyAllSubscribers("SIGNED_IN",as)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(ss){return isAuthError(ss)?this._returnResult({error:ss}):this._returnResult({error:new AuthUnknownError("Unexpected error during initialization",ss)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(ts){var ss,rs,ns;try{const os=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(rs=(ss=ts==null?void 0:ts.options)===null||ss===void 0?void 0:ss.data)!==null&&rs!==void 0?rs:{},gotrue_meta_security:{captcha_token:(ns=ts==null?void 0:ts.options)===null||ns===void 0?void 0:ns.captchaToken}},xform:_sessionResponse}),{data:as,error:ls}=os;if(ls||!as)return this._returnResult({data:{user:null,session:null},error:ls});const cs=as.session,us=as.user;return as.session&&(await this._saveSession(as.session),await this._notifyAllSubscribers("SIGNED_IN",cs)),this._returnResult({data:{user:us,session:cs},error:null})}catch(os){if(isAuthError(os))return this._returnResult({data:{user:null,session:null},error:os});throw os}}async signUp(ts){var ss,rs,ns;try{let os;if("email"in ts){const{email:ds,password:ms,options:ps}=ts;let hs=null,xs=null;this.flowType==="pkce"&&([hs,xs]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),os=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:ps==null?void 0:ps.emailRedirectTo,body:{email:ds,password:ms,data:(ss=ps==null?void 0:ps.data)!==null&&ss!==void 0?ss:{},gotrue_meta_security:{captcha_token:ps==null?void 0:ps.captchaToken},code_challenge:hs,code_challenge_method:xs},xform:_sessionResponse})}else if("phone"in ts){const{phone:ds,password:ms,options:ps}=ts;os=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:ds,password:ms,data:(rs=ps==null?void 0:ps.data)!==null&&rs!==void 0?rs:{},channel:(ns=ps==null?void 0:ps.channel)!==null&&ns!==void 0?ns:"sms",gotrue_meta_security:{captcha_token:ps==null?void 0:ps.captchaToken}},xform:_sessionResponse})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:as,error:ls}=os;if(ls||!as)return await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:ls});const cs=as.session,us=as.user;return as.session&&(await this._saveSession(as.session),await this._notifyAllSubscribers("SIGNED_IN",cs)),this._returnResult({data:{user:us,session:cs},error:null})}catch(os){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(os))return this._returnResult({data:{user:null,session:null},error:os});throw os}}async signInWithPassword(ts){try{let ss;if("email"in ts){const{email:os,password:as,options:ls}=ts;ss=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:os,password:as,gotrue_meta_security:{captcha_token:ls==null?void 0:ls.captchaToken}},xform:_sessionResponsePassword})}else if("phone"in ts){const{phone:os,password:as,options:ls}=ts;ss=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:os,password:as,gotrue_meta_security:{captcha_token:ls==null?void 0:ls.captchaToken}},xform:_sessionResponsePassword})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:rs,error:ns}=ss;if(ns)return this._returnResult({data:{user:null,session:null},error:ns});if(!rs||!rs.session||!rs.user){const os=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:os})}return rs.session&&(await this._saveSession(rs.session),await this._notifyAllSubscribers("SIGNED_IN",rs.session)),this._returnResult({data:Object.assign({user:rs.user,session:rs.session},rs.weak_password?{weakPassword:rs.weak_password}:null),error:ns})}catch(ss){if(isAuthError(ss))return this._returnResult({data:{user:null,session:null},error:ss});throw ss}}async signInWithOAuth(ts){var ss,rs,ns,os;return await this._handleProviderSignIn(ts.provider,{redirectTo:(ss=ts.options)===null||ss===void 0?void 0:ss.redirectTo,scopes:(rs=ts.options)===null||rs===void 0?void 0:rs.scopes,queryParams:(ns=ts.options)===null||ns===void 0?void 0:ns.queryParams,skipBrowserRedirect:(os=ts.options)===null||os===void 0?void 0:os.skipBrowserRedirect})}async exchangeCodeForSession(ts){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(ts))}async signInWithWeb3(ts){const{chain:ss}=ts;switch(ss){case"ethereum":return await this.signInWithEthereum(ts);case"solana":return await this.signInWithSolana(ts);default:throw new Error(`@supabase/auth-js: Unsupported chain "${ss}"`)}}async signInWithEthereum(ts){var ss,rs,ns,os,as,ls,cs,us,ds,ms,ps;let hs,xs;if("message"in ts)hs=ts.message,xs=ts.signature;else{const{chain:ys,wallet:vs,statement:gs,options:fs}=ts;let js;if(isBrowser())if(typeof vs=="object")js=vs;else{const Ns=window;if("ethereum"in Ns&&typeof Ns.ethereum=="object"&&"request"in Ns.ethereum&&typeof Ns.ethereum.request=="function")js=Ns.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof vs!="object"||!(fs!=null&&fs.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");js=vs}const Ss=new URL((ss=fs==null?void 0:fs.url)!==null&&ss!==void 0?ss:window.location.href),bs=await js.request({method:"eth_requestAccounts"}).then(Ns=>Ns).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!bs||bs.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Es=getAddress(bs[0]);let Rs=(rs=fs==null?void 0:fs.signInWithEthereum)===null||rs===void 0?void 0:rs.chainId;if(!Rs){const Ns=await js.request({method:"eth_chainId"});Rs=fromHex(Ns)}const ws={domain:Ss.host,address:Es,statement:gs,uri:Ss.href,version:"1",chainId:Rs,nonce:(ns=fs==null?void 0:fs.signInWithEthereum)===null||ns===void 0?void 0:ns.nonce,issuedAt:(as=(os=fs==null?void 0:fs.signInWithEthereum)===null||os===void 0?void 0:os.issuedAt)!==null&&as!==void 0?as:new Date,expirationTime:(ls=fs==null?void 0:fs.signInWithEthereum)===null||ls===void 0?void 0:ls.expirationTime,notBefore:(cs=fs==null?void 0:fs.signInWithEthereum)===null||cs===void 0?void 0:cs.notBefore,requestId:(us=fs==null?void 0:fs.signInWithEthereum)===null||us===void 0?void 0:us.requestId,resources:(ds=fs==null?void 0:fs.signInWithEthereum)===null||ds===void 0?void 0:ds.resources};hs=createSiweMessage(ws),xs=await js.request({method:"personal_sign",params:[toHex(hs),Es]})}try{const{data:ys,error:vs}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:hs,signature:xs},!((ms=ts.options)===null||ms===void 0)&&ms.captchaToken?{gotrue_meta_security:{captcha_token:(ps=ts.options)===null||ps===void 0?void 0:ps.captchaToken}}:null),xform:_sessionResponse});if(vs)throw vs;if(!ys||!ys.session||!ys.user){const gs=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:gs})}return ys.session&&(await this._saveSession(ys.session),await this._notifyAllSubscribers("SIGNED_IN",ys.session)),this._returnResult({data:Object.assign({},ys),error:vs})}catch(ys){if(isAuthError(ys))return this._returnResult({data:{user:null,session:null},error:ys});throw ys}}async signInWithSolana(ts){var ss,rs,ns,os,as,ls,cs,us,ds,ms,ps,hs;let xs,ys;if("message"in ts)xs=ts.message,ys=ts.signature;else{const{chain:vs,wallet:gs,statement:fs,options:js}=ts;let Ss;if(isBrowser())if(typeof gs=="object")Ss=gs;else{const Es=window;if("solana"in Es&&typeof Es.solana=="object"&&("signIn"in Es.solana&&typeof Es.solana.signIn=="function"||"signMessage"in Es.solana&&typeof Es.solana.signMessage=="function"))Ss=Es.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof gs!="object"||!(js!=null&&js.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Ss=gs}const bs=new URL((ss=js==null?void 0:js.url)!==null&&ss!==void 0?ss:window.location.href);if("signIn"in Ss&&Ss.signIn){const Es=await Ss.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},js==null?void 0:js.signInWithSolana),{version:"1",domain:bs.host,uri:bs.href}),fs?{statement:fs}:null));let Rs;if(Array.isArray(Es)&&Es[0]&&typeof Es[0]=="object")Rs=Es[0];else if(Es&&typeof Es=="object"&&"signedMessage"in Es&&"signature"in Es)Rs=Es;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Rs&&"signature"in Rs&&(typeof Rs.signedMessage=="string"||Rs.signedMessage instanceof Uint8Array)&&Rs.signature instanceof Uint8Array)xs=typeof Rs.signedMessage=="string"?Rs.signedMessage:new TextDecoder().decode(Rs.signedMessage),ys=Rs.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Ss)||typeof Ss.signMessage!="function"||!("publicKey"in Ss)||typeof Ss!="object"||!Ss.publicKey||!("toBase58"in Ss.publicKey)||typeof Ss.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");xs=[`${bs.host} wants you to sign in with your Solana account:`,Ss.publicKey.toBase58(),...fs?["",fs,""]:[""],"Version: 1",`URI: ${bs.href}`,`Issued At: ${(ns=(rs=js==null?void 0:js.signInWithSolana)===null||rs===void 0?void 0:rs.issuedAt)!==null&&ns!==void 0?ns:new Date().toISOString()}`,...!((os=js==null?void 0:js.signInWithSolana)===null||os===void 0)&&os.notBefore?[`Not Before: ${js.signInWithSolana.notBefore}`]:[],...!((as=js==null?void 0:js.signInWithSolana)===null||as===void 0)&&as.expirationTime?[`Expiration Time: ${js.signInWithSolana.expirationTime}`]:[],...!((ls=js==null?void 0:js.signInWithSolana)===null||ls===void 0)&&ls.chainId?[`Chain ID: ${js.signInWithSolana.chainId}`]:[],...!((cs=js==null?void 0:js.signInWithSolana)===null||cs===void 0)&&cs.nonce?[`Nonce: ${js.signInWithSolana.nonce}`]:[],...!((us=js==null?void 0:js.signInWithSolana)===null||us===void 0)&&us.requestId?[`Request ID: ${js.signInWithSolana.requestId}`]:[],...!((ms=(ds=js==null?void 0:js.signInWithSolana)===null||ds===void 0?void 0:ds.resources)===null||ms===void 0)&&ms.length?["Resources",...js.signInWithSolana.resources.map(Rs=>`- ${Rs}`)]:[]].join(`
`);const Es=await Ss.signMessage(new TextEncoder().encode(xs),"utf8");if(!Es||!(Es instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");ys=Es}}try{const{data:vs,error:gs}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:xs,signature:bytesToBase64URL(ys)},!((ps=ts.options)===null||ps===void 0)&&ps.captchaToken?{gotrue_meta_security:{captcha_token:(hs=ts.options)===null||hs===void 0?void 0:hs.captchaToken}}:null),xform:_sessionResponse});if(gs)throw gs;if(!vs||!vs.session||!vs.user){const fs=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:fs})}return vs.session&&(await this._saveSession(vs.session),await this._notifyAllSubscribers("SIGNED_IN",vs.session)),this._returnResult({data:Object.assign({},vs),error:gs})}catch(vs){if(isAuthError(vs))return this._returnResult({data:{user:null,session:null},error:vs});throw vs}}async _exchangeCodeForSession(ts){const ss=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`),[rs,ns]=(ss??"").split("/");try{if(!rs&&this.flowType==="pkce")throw new AuthPKCECodeVerifierMissingError;const{data:os,error:as}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:ts,code_verifier:rs},xform:_sessionResponse});if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),as)throw as;if(!os||!os.session||!os.user){const ls=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null,redirectType:null},error:ls})}return os.session&&(await this._saveSession(os.session),await this._notifyAllSubscribers("SIGNED_IN",os.session)),this._returnResult({data:Object.assign(Object.assign({},os),{redirectType:ns??null}),error:as})}catch(os){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(os))return this._returnResult({data:{user:null,session:null,redirectType:null},error:os});throw os}}async signInWithIdToken(ts){try{const{options:ss,provider:rs,token:ns,access_token:os,nonce:as}=ts,ls=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:rs,id_token:ns,access_token:os,nonce:as,gotrue_meta_security:{captcha_token:ss==null?void 0:ss.captchaToken}},xform:_sessionResponse}),{data:cs,error:us}=ls;if(us)return this._returnResult({data:{user:null,session:null},error:us});if(!cs||!cs.session||!cs.user){const ds=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:ds})}return cs.session&&(await this._saveSession(cs.session),await this._notifyAllSubscribers("SIGNED_IN",cs.session)),this._returnResult({data:cs,error:us})}catch(ss){if(isAuthError(ss))return this._returnResult({data:{user:null,session:null},error:ss});throw ss}}async signInWithOtp(ts){var ss,rs,ns,os,as;try{if("email"in ts){const{email:ls,options:cs}=ts;let us=null,ds=null;this.flowType==="pkce"&&([us,ds]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{error:ms}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:ls,data:(ss=cs==null?void 0:cs.data)!==null&&ss!==void 0?ss:{},create_user:(rs=cs==null?void 0:cs.shouldCreateUser)!==null&&rs!==void 0?rs:!0,gotrue_meta_security:{captcha_token:cs==null?void 0:cs.captchaToken},code_challenge:us,code_challenge_method:ds},redirectTo:cs==null?void 0:cs.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:ms})}if("phone"in ts){const{phone:ls,options:cs}=ts,{data:us,error:ds}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:ls,data:(ns=cs==null?void 0:cs.data)!==null&&ns!==void 0?ns:{},create_user:(os=cs==null?void 0:cs.shouldCreateUser)!==null&&os!==void 0?os:!0,gotrue_meta_security:{captcha_token:cs==null?void 0:cs.captchaToken},channel:(as=cs==null?void 0:cs.channel)!==null&&as!==void 0?as:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:us==null?void 0:us.message_id},error:ds})}throw new AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(ls){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(ls))return this._returnResult({data:{user:null,session:null},error:ls});throw ls}}async verifyOtp(ts){var ss,rs;try{let ns,os;"options"in ts&&(ns=(ss=ts.options)===null||ss===void 0?void 0:ss.redirectTo,os=(rs=ts.options)===null||rs===void 0?void 0:rs.captchaToken);const{data:as,error:ls}=await _request(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},ts),{gotrue_meta_security:{captcha_token:os}}),redirectTo:ns,xform:_sessionResponse});if(ls)throw ls;if(!as)throw new Error("An error occurred on token verification.");const cs=as.session,us=as.user;return cs!=null&&cs.access_token&&(await this._saveSession(cs),await this._notifyAllSubscribers(ts.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",cs)),this._returnResult({data:{user:us,session:cs},error:null})}catch(ns){if(isAuthError(ns))return this._returnResult({data:{user:null,session:null},error:ns});throw ns}}async signInWithSSO(ts){var ss,rs,ns,os,as;try{let ls=null,cs=null;this.flowType==="pkce"&&([ls,cs]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const us=await _request(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in ts?{provider_id:ts.providerId}:null),"domain"in ts?{domain:ts.domain}:null),{redirect_to:(rs=(ss=ts.options)===null||ss===void 0?void 0:ss.redirectTo)!==null&&rs!==void 0?rs:void 0}),!((ns=ts==null?void 0:ts.options)===null||ns===void 0)&&ns.captchaToken?{gotrue_meta_security:{captcha_token:ts.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:ls,code_challenge_method:cs}),headers:this.headers,xform:_ssoResponse});return!((os=us.data)===null||os===void 0)&&os.url&&isBrowser()&&!(!((as=ts.options)===null||as===void 0)&&as.skipBrowserRedirect)&&window.location.assign(us.data.url),this._returnResult(us)}catch(ls){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(ls))return this._returnResult({data:null,error:ls});throw ls}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async ts=>{const{data:{session:ss},error:rs}=ts;if(rs)throw rs;if(!ss)throw new AuthSessionMissingError;const{error:ns}=await _request(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:ss.access_token});return this._returnResult({data:{user:null,session:null},error:ns})})}catch(ts){if(isAuthError(ts))return this._returnResult({data:{user:null,session:null},error:ts});throw ts}}async resend(ts){try{const ss=`${this.url}/resend`;if("email"in ts){const{email:rs,type:ns,options:os}=ts,{error:as}=await _request(this.fetch,"POST",ss,{headers:this.headers,body:{email:rs,type:ns,gotrue_meta_security:{captcha_token:os==null?void 0:os.captchaToken}},redirectTo:os==null?void 0:os.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:as})}else if("phone"in ts){const{phone:rs,type:ns,options:os}=ts,{data:as,error:ls}=await _request(this.fetch,"POST",ss,{headers:this.headers,body:{phone:rs,type:ns,gotrue_meta_security:{captcha_token:os==null?void 0:os.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:as==null?void 0:as.message_id},error:ls})}throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(ss){if(isAuthError(ss))return this._returnResult({data:{user:null,session:null},error:ss});throw ss}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async ss=>ss))}async _acquireLock(ts,ss){this._debug("#_acquireLock","begin",ts);try{if(this.lockAcquired){const rs=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),ns=(async()=>(await rs,await ss()))();return this.pendingInLock.push((async()=>{try{await ns}catch{}})()),ns}return await this.lock(`lock:${this.storageKey}`,ts,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const rs=ss();for(this.pendingInLock.push((async()=>{try{await rs}catch{}})()),await rs;this.pendingInLock.length;){const ns=[...this.pendingInLock];await Promise.all(ns),this.pendingInLock.splice(0,ns.length)}return await rs}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(ts){this._debug("#_useSession","begin");try{const ss=await this.__loadSession();return await ts(ss)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let ts=null;const ss=await getItemAsync(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",ss),ss!==null&&(this._isValidSession(ss)?ts=ss:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!ts)return{data:{session:null},error:null};const rs=ts.expires_at?ts.expires_at*1e3-Date.now()<EXPIRY_MARGIN_MS:!1;if(this._debug("#__loadSession()",`session has${rs?"":" not"} expired`,"expires_at",ts.expires_at),!rs){if(this.userStorage){const as=await getItemAsync(this.userStorage,this.storageKey+"-user");as!=null&&as.user?ts.user=as.user:ts.user=userNotAvailableProxy()}if(this.storage.isServer&&ts.user&&!ts.user.__isUserNotAvailableProxy){const as={value:this.suppressGetSessionWarning};ts.user=insecureUserWarningProxy(ts.user,as),as.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:ts},error:null}}const{data:ns,error:os}=await this._callRefreshToken(ts.refresh_token);return os?this._returnResult({data:{session:null},error:os}):this._returnResult({data:{session:ns},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(ts){if(ts)return await this._getUser(ts);await this.initializePromise;const ss=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return ss.data.user&&(this.suppressGetSessionWarning=!0),ss}async _getUser(ts){try{return ts?await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:ts,xform:_userResponse}):await this._useSession(async ss=>{var rs,ns,os;const{data:as,error:ls}=ss;if(ls)throw ls;return!(!((rs=as.session)===null||rs===void 0)&&rs.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new AuthSessionMissingError}:await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(os=(ns=as.session)===null||ns===void 0?void 0:ns.access_token)!==null&&os!==void 0?os:void 0,xform:_userResponse})})}catch(ss){if(isAuthError(ss))return isAuthSessionMissingError(ss)&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:ss});throw ss}}async updateUser(ts,ss={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(ts,ss))}async _updateUser(ts,ss={}){try{return await this._useSession(async rs=>{const{data:ns,error:os}=rs;if(os)throw os;if(!ns.session)throw new AuthSessionMissingError;const as=ns.session;let ls=null,cs=null;this.flowType==="pkce"&&ts.email!=null&&([ls,cs]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{data:us,error:ds}=await _request(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:ss==null?void 0:ss.emailRedirectTo,body:Object.assign(Object.assign({},ts),{code_challenge:ls,code_challenge_method:cs}),jwt:as.access_token,xform:_userResponse});if(ds)throw ds;return as.user=us.user,await this._saveSession(as),await this._notifyAllSubscribers("USER_UPDATED",as),this._returnResult({data:{user:as.user},error:null})})}catch(rs){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(rs))return this._returnResult({data:{user:null},error:rs});throw rs}}async setSession(ts){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(ts))}async _setSession(ts){try{if(!ts.access_token||!ts.refresh_token)throw new AuthSessionMissingError;const ss=Date.now()/1e3;let rs=ss,ns=!0,os=null;const{payload:as}=decodeJWT(ts.access_token);if(as.exp&&(rs=as.exp,ns=rs<=ss),ns){const{data:ls,error:cs}=await this._callRefreshToken(ts.refresh_token);if(cs)return this._returnResult({data:{user:null,session:null},error:cs});if(!ls)return{data:{user:null,session:null},error:null};os=ls}else{const{data:ls,error:cs}=await this._getUser(ts.access_token);if(cs)return this._returnResult({data:{user:null,session:null},error:cs});os={access_token:ts.access_token,refresh_token:ts.refresh_token,user:ls.user,token_type:"bearer",expires_in:rs-ss,expires_at:rs},await this._saveSession(os),await this._notifyAllSubscribers("SIGNED_IN",os)}return this._returnResult({data:{user:os.user,session:os},error:null})}catch(ss){if(isAuthError(ss))return this._returnResult({data:{session:null,user:null},error:ss});throw ss}}async refreshSession(ts){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(ts))}async _refreshSession(ts){try{return await this._useSession(async ss=>{var rs;if(!ts){const{data:as,error:ls}=ss;if(ls)throw ls;ts=(rs=as.session)!==null&&rs!==void 0?rs:void 0}if(!(ts!=null&&ts.refresh_token))throw new AuthSessionMissingError;const{data:ns,error:os}=await this._callRefreshToken(ts.refresh_token);return os?this._returnResult({data:{user:null,session:null},error:os}):ns?this._returnResult({data:{user:ns.user,session:ns},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(ss){if(isAuthError(ss))return this._returnResult({data:{user:null,session:null},error:ss});throw ss}}async _getSessionFromURL(ts,ss){try{if(!isBrowser())throw new AuthImplicitGrantRedirectError("No browser detected.");if(ts.error||ts.error_description||ts.error_code)throw new AuthImplicitGrantRedirectError(ts.error_description||"Error in URL with unspecified error_description",{error:ts.error||"unspecified_error",code:ts.error_code||"unspecified_code"});switch(ss){case"implicit":if(this.flowType==="pkce")throw new AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");break;default:}if(ss==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!ts.code)throw new AuthPKCEGrantCodeExchangeError("No code detected.");const{data:fs,error:js}=await this._exchangeCodeForSession(ts.code);if(js)throw js;const Ss=new URL(window.location.href);return Ss.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Ss.toString()),{data:{session:fs.session,redirectType:null},error:null}}const{provider_token:rs,provider_refresh_token:ns,access_token:os,refresh_token:as,expires_in:ls,expires_at:cs,token_type:us}=ts;if(!os||!ls||!as||!us)throw new AuthImplicitGrantRedirectError("No session defined in URL");const ds=Math.round(Date.now()/1e3),ms=parseInt(ls);let ps=ds+ms;cs&&(ps=parseInt(cs));const hs=ps-ds;hs*1e3<=AUTO_REFRESH_TICK_DURATION_MS&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${hs}s, should have been closer to ${ms}s`);const xs=ps-ms;ds-xs>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",xs,ps,ds):ds-xs<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",xs,ps,ds);const{data:ys,error:vs}=await this._getUser(os);if(vs)throw vs;const gs={provider_token:rs,provider_refresh_token:ns,access_token:os,expires_in:ms,expires_at:ps,refresh_token:as,token_type:us,user:ys.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:gs,redirectType:ts.type},error:null})}catch(rs){if(isAuthError(rs))return this._returnResult({data:{session:null,redirectType:null},error:rs});throw rs}}_isImplicitGrantCallback(ts){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),ts):!!(ts.access_token||ts.error_description)}async _isPKCECallback(ts){const ss=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`);return!!(ts.code&&ss)}async signOut(ts={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(ts))}async _signOut({scope:ts}={scope:"global"}){return await this._useSession(async ss=>{var rs;const{data:ns,error:os}=ss;if(os&&!isAuthSessionMissingError(os))return this._returnResult({error:os});const as=(rs=ns.session)===null||rs===void 0?void 0:rs.access_token;if(as){const{error:ls}=await this.admin.signOut(as,ts);if(ls&&!(isAuthApiError(ls)&&(ls.status===404||ls.status===401||ls.status===403)||isAuthSessionMissingError(ls)))return this._returnResult({error:ls})}return ts!=="others"&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(ts){const ss=generateCallbackId(),rs={id:ss,callback:ts,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",ss),this.stateChangeEmitters.delete(ss)}};return this._debug("#onAuthStateChange()","registered callback with id",ss),this.stateChangeEmitters.set(ss,rs),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(ss)})))(),{data:{subscription:rs}}}async _emitInitialSession(ts){return await this._useSession(async ss=>{var rs,ns;try{const{data:{session:os},error:as}=ss;if(as)throw as;await((rs=this.stateChangeEmitters.get(ts))===null||rs===void 0?void 0:rs.callback("INITIAL_SESSION",os)),this._debug("INITIAL_SESSION","callback id",ts,"session",os)}catch(os){await((ns=this.stateChangeEmitters.get(ts))===null||ns===void 0?void 0:ns.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",ts,"error",os),console.error(os)}})}async resetPasswordForEmail(ts,ss={}){let rs=null,ns=null;this.flowType==="pkce"&&([rs,ns]=await getCodeChallengeAndMethod(this.storage,this.storageKey,!0));try{return await _request(this.fetch,"POST",`${this.url}/recover`,{body:{email:ts,code_challenge:rs,code_challenge_method:ns,gotrue_meta_security:{captcha_token:ss.captchaToken}},headers:this.headers,redirectTo:ss.redirectTo})}catch(os){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(os))return this._returnResult({data:null,error:os});throw os}}async getUserIdentities(){var ts;try{const{data:ss,error:rs}=await this.getUser();if(rs)throw rs;return this._returnResult({data:{identities:(ts=ss.user.identities)!==null&&ts!==void 0?ts:[]},error:null})}catch(ss){if(isAuthError(ss))return this._returnResult({data:null,error:ss});throw ss}}async linkIdentity(ts){return"token"in ts?this.linkIdentityIdToken(ts):this.linkIdentityOAuth(ts)}async linkIdentityOAuth(ts){var ss;try{const{data:rs,error:ns}=await this._useSession(async os=>{var as,ls,cs,us,ds;const{data:ms,error:ps}=os;if(ps)throw ps;const hs=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,ts.provider,{redirectTo:(as=ts.options)===null||as===void 0?void 0:as.redirectTo,scopes:(ls=ts.options)===null||ls===void 0?void 0:ls.scopes,queryParams:(cs=ts.options)===null||cs===void 0?void 0:cs.queryParams,skipBrowserRedirect:!0});return await _request(this.fetch,"GET",hs,{headers:this.headers,jwt:(ds=(us=ms.session)===null||us===void 0?void 0:us.access_token)!==null&&ds!==void 0?ds:void 0})});if(ns)throw ns;return isBrowser()&&!(!((ss=ts.options)===null||ss===void 0)&&ss.skipBrowserRedirect)&&window.location.assign(rs==null?void 0:rs.url),this._returnResult({data:{provider:ts.provider,url:rs==null?void 0:rs.url},error:null})}catch(rs){if(isAuthError(rs))return this._returnResult({data:{provider:ts.provider,url:null},error:rs});throw rs}}async linkIdentityIdToken(ts){return await this._useSession(async ss=>{var rs;try{const{error:ns,data:{session:os}}=ss;if(ns)throw ns;const{options:as,provider:ls,token:cs,access_token:us,nonce:ds}=ts,ms=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(rs=os==null?void 0:os.access_token)!==null&&rs!==void 0?rs:void 0,body:{provider:ls,id_token:cs,access_token:us,nonce:ds,link_identity:!0,gotrue_meta_security:{captcha_token:as==null?void 0:as.captchaToken}},xform:_sessionResponse}),{data:ps,error:hs}=ms;return hs?this._returnResult({data:{user:null,session:null},error:hs}):!ps||!ps.session||!ps.user?this._returnResult({data:{user:null,session:null},error:new AuthInvalidTokenResponseError}):(ps.session&&(await this._saveSession(ps.session),await this._notifyAllSubscribers("USER_UPDATED",ps.session)),this._returnResult({data:ps,error:hs}))}catch(ns){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(ns))return this._returnResult({data:{user:null,session:null},error:ns});throw ns}})}async unlinkIdentity(ts){try{return await this._useSession(async ss=>{var rs,ns;const{data:os,error:as}=ss;if(as)throw as;return await _request(this.fetch,"DELETE",`${this.url}/user/identities/${ts.identity_id}`,{headers:this.headers,jwt:(ns=(rs=os.session)===null||rs===void 0?void 0:rs.access_token)!==null&&ns!==void 0?ns:void 0})})}catch(ss){if(isAuthError(ss))return this._returnResult({data:null,error:ss});throw ss}}async _refreshAccessToken(ts){const ss=`#_refreshAccessToken(${ts.substring(0,5)}...)`;this._debug(ss,"begin");try{const rs=Date.now();return await retryable(async ns=>(ns>0&&await sleep(200*Math.pow(2,ns-1)),this._debug(ss,"refreshing attempt",ns),await _request(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:ts},headers:this.headers,xform:_sessionResponse})),(ns,os)=>{const as=200*Math.pow(2,ns);return os&&isAuthRetryableFetchError(os)&&Date.now()+as-rs<AUTO_REFRESH_TICK_DURATION_MS})}catch(rs){if(this._debug(ss,"error",rs),isAuthError(rs))return this._returnResult({data:{session:null,user:null},error:rs});throw rs}finally{this._debug(ss,"end")}}_isValidSession(ts){return typeof ts=="object"&&ts!==null&&"access_token"in ts&&"refresh_token"in ts&&"expires_at"in ts}async _handleProviderSignIn(ts,ss){const rs=await this._getUrlForProvider(`${this.url}/authorize`,ts,{redirectTo:ss.redirectTo,scopes:ss.scopes,queryParams:ss.queryParams});return this._debug("#_handleProviderSignIn()","provider",ts,"options",ss,"url",rs),isBrowser()&&!ss.skipBrowserRedirect&&window.location.assign(rs),{data:{provider:ts,url:rs},error:null}}async _recoverAndRefresh(){var ts,ss;const rs="#_recoverAndRefresh()";this._debug(rs,"begin");try{const ns=await getItemAsync(this.storage,this.storageKey);if(ns&&this.userStorage){let as=await getItemAsync(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!as&&(as={user:ns.user},await setItemAsync(this.userStorage,this.storageKey+"-user",as)),ns.user=(ts=as==null?void 0:as.user)!==null&&ts!==void 0?ts:userNotAvailableProxy()}else if(ns&&!ns.user&&!ns.user){const as=await getItemAsync(this.storage,this.storageKey+"-user");as&&(as!=null&&as.user)?(ns.user=as.user,await removeItemAsync(this.storage,this.storageKey+"-user"),await setItemAsync(this.storage,this.storageKey,ns)):ns.user=userNotAvailableProxy()}if(this._debug(rs,"session from storage",ns),!this._isValidSession(ns)){this._debug(rs,"session is not valid"),ns!==null&&await this._removeSession();return}const os=((ss=ns.expires_at)!==null&&ss!==void 0?ss:1/0)*1e3-Date.now()<EXPIRY_MARGIN_MS;if(this._debug(rs,`session has${os?"":" not"} expired with margin of ${EXPIRY_MARGIN_MS}s`),os){if(this.autoRefreshToken&&ns.refresh_token){const{error:as}=await this._callRefreshToken(ns.refresh_token);as&&(console.error(as),isAuthRetryableFetchError(as)||(this._debug(rs,"refresh failed with a non-retryable error, removing the session",as),await this._removeSession()))}}else if(ns.user&&ns.user.__isUserNotAvailableProxy===!0)try{const{data:as,error:ls}=await this._getUser(ns.access_token);!ls&&(as!=null&&as.user)?(ns.user=as.user,await this._saveSession(ns),await this._notifyAllSubscribers("SIGNED_IN",ns)):this._debug(rs,"could not get user data, skipping SIGNED_IN notification")}catch(as){console.error("Error getting user data:",as),this._debug(rs,"error getting user data, skipping SIGNED_IN notification",as)}else await this._notifyAllSubscribers("SIGNED_IN",ns)}catch(ns){this._debug(rs,"error",ns),console.error(ns);return}finally{this._debug(rs,"end")}}async _callRefreshToken(ts){var ss,rs;if(!ts)throw new AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const ns=`#_callRefreshToken(${ts.substring(0,5)}...)`;this._debug(ns,"begin");try{this.refreshingDeferred=new Deferred;const{data:os,error:as}=await this._refreshAccessToken(ts);if(as)throw as;if(!os.session)throw new AuthSessionMissingError;await this._saveSession(os.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",os.session);const ls={data:os.session,error:null};return this.refreshingDeferred.resolve(ls),ls}catch(os){if(this._debug(ns,"error",os),isAuthError(os)){const as={data:null,error:os};return isAuthRetryableFetchError(os)||await this._removeSession(),(ss=this.refreshingDeferred)===null||ss===void 0||ss.resolve(as),as}throw(rs=this.refreshingDeferred)===null||rs===void 0||rs.reject(os),os}finally{this.refreshingDeferred=null,this._debug(ns,"end")}}async _notifyAllSubscribers(ts,ss,rs=!0){const ns=`#_notifyAllSubscribers(${ts})`;this._debug(ns,"begin",ss,`broadcast = ${rs}`);try{this.broadcastChannel&&rs&&this.broadcastChannel.postMessage({event:ts,session:ss});const os=[],as=Array.from(this.stateChangeEmitters.values()).map(async ls=>{try{await ls.callback(ts,ss)}catch(cs){os.push(cs)}});if(await Promise.all(as),os.length>0){for(let ls=0;ls<os.length;ls+=1)console.error(os[ls]);throw os[0]}}finally{this._debug(ns,"end")}}async _saveSession(ts){this._debug("#_saveSession()",ts),this.suppressGetSessionWarning=!0,await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`);const ss=Object.assign({},ts),rs=ss.user&&ss.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!rs&&ss.user&&await setItemAsync(this.userStorage,this.storageKey+"-user",{user:ss.user});const ns=Object.assign({},ss);delete ns.user;const os=deepClone(ns);await setItemAsync(this.storage,this.storageKey,os)}else{const ns=deepClone(ss);await setItemAsync(this.storage,this.storageKey,ns)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await removeItemAsync(this.storage,this.storageKey),await removeItemAsync(this.storage,this.storageKey+"-code-verifier"),await removeItemAsync(this.storage,this.storageKey+"-user"),this.userStorage&&await removeItemAsync(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const ts=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{ts&&isBrowser()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",ts)}catch(ss){console.error("removing visibilitychange callback failed",ss)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const ts=setInterval(()=>this._autoRefreshTokenTick(),AUTO_REFRESH_TICK_DURATION_MS);this.autoRefreshTicker=ts,ts&&typeof ts=="object"&&typeof ts.unref=="function"?ts.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(ts);const ss=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=ss,ss&&typeof ss=="object"&&typeof ss.unref=="function"?ss.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(ss)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const ts=this.autoRefreshTicker;this.autoRefreshTicker=null,ts&&clearInterval(ts);const ss=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,ss&&clearTimeout(ss)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const ts=Date.now();try{return await this._useSession(async ss=>{const{data:{session:rs}}=ss;if(!rs||!rs.refresh_token||!rs.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const ns=Math.floor((rs.expires_at*1e3-ts)/AUTO_REFRESH_TICK_DURATION_MS);this._debug("#_autoRefreshTokenTick()",`access token expires in ${ns} ticks, a tick lasts ${AUTO_REFRESH_TICK_DURATION_MS}ms, refresh threshold is ${AUTO_REFRESH_TICK_THRESHOLD} ticks`),ns<=AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(rs.refresh_token)})}catch(ss){console.error("Auto refresh tick failed with error. This is likely a transient error.",ss)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(ts){if(ts.isAcquireTimeout||ts instanceof LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw ts}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!isBrowser()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(ts){this._debug("#visibilityChangedCallback","error",ts)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(ts){console.error("_handleVisibilityChange",ts)}}async _onVisibilityChanged(ts){const ss=`#_onVisibilityChanged(${ts})`;this._debug(ss,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),ts||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(ss,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(ts,ss,rs){const ns=[`provider=${encodeURIComponent(ss)}`];if(rs!=null&&rs.redirectTo&&ns.push(`redirect_to=${encodeURIComponent(rs.redirectTo)}`),rs!=null&&rs.scopes&&ns.push(`scopes=${encodeURIComponent(rs.scopes)}`),this.flowType==="pkce"){const[os,as]=await getCodeChallengeAndMethod(this.storage,this.storageKey),ls=new URLSearchParams({code_challenge:`${encodeURIComponent(os)}`,code_challenge_method:`${encodeURIComponent(as)}`});ns.push(ls.toString())}if(rs!=null&&rs.queryParams){const os=new URLSearchParams(rs.queryParams);ns.push(os.toString())}return rs!=null&&rs.skipBrowserRedirect&&ns.push(`skip_http_redirect=${rs.skipBrowserRedirect}`),`${ts}?${ns.join("&")}`}async _unenroll(ts){try{return await this._useSession(async ss=>{var rs;const{data:ns,error:os}=ss;return os?this._returnResult({data:null,error:os}):await _request(this.fetch,"DELETE",`${this.url}/factors/${ts.factorId}`,{headers:this.headers,jwt:(rs=ns==null?void 0:ns.session)===null||rs===void 0?void 0:rs.access_token})})}catch(ss){if(isAuthError(ss))return this._returnResult({data:null,error:ss});throw ss}}async _enroll(ts){try{return await this._useSession(async ss=>{var rs,ns;const{data:os,error:as}=ss;if(as)return this._returnResult({data:null,error:as});const ls=Object.assign({friendly_name:ts.friendlyName,factor_type:ts.factorType},ts.factorType==="phone"?{phone:ts.phone}:ts.factorType==="totp"?{issuer:ts.issuer}:{}),{data:cs,error:us}=await _request(this.fetch,"POST",`${this.url}/factors`,{body:ls,headers:this.headers,jwt:(rs=os==null?void 0:os.session)===null||rs===void 0?void 0:rs.access_token});return us?this._returnResult({data:null,error:us}):(ts.factorType==="totp"&&cs.type==="totp"&&(!((ns=cs==null?void 0:cs.totp)===null||ns===void 0)&&ns.qr_code)&&(cs.totp.qr_code=`data:image/svg+xml;utf-8,${cs.totp.qr_code}`),this._returnResult({data:cs,error:null}))})}catch(ss){if(isAuthError(ss))return this._returnResult({data:null,error:ss});throw ss}}async _verify(ts){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async ss=>{var rs;const{data:ns,error:os}=ss;if(os)return this._returnResult({data:null,error:os});const as=Object.assign({challenge_id:ts.challengeId},"webauthn"in ts?{webauthn:Object.assign(Object.assign({},ts.webauthn),{credential_response:ts.webauthn.type==="create"?serializeCredentialCreationResponse(ts.webauthn.credential_response):serializeCredentialRequestResponse(ts.webauthn.credential_response)})}:{code:ts.code}),{data:ls,error:cs}=await _request(this.fetch,"POST",`${this.url}/factors/${ts.factorId}/verify`,{body:as,headers:this.headers,jwt:(rs=ns==null?void 0:ns.session)===null||rs===void 0?void 0:rs.access_token});return cs?this._returnResult({data:null,error:cs}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+ls.expires_in},ls)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",ls),this._returnResult({data:ls,error:cs}))})}catch(ss){if(isAuthError(ss))return this._returnResult({data:null,error:ss});throw ss}})}async _challenge(ts){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async ss=>{var rs;const{data:ns,error:os}=ss;if(os)return this._returnResult({data:null,error:os});const as=await _request(this.fetch,"POST",`${this.url}/factors/${ts.factorId}/challenge`,{body:ts,headers:this.headers,jwt:(rs=ns==null?void 0:ns.session)===null||rs===void 0?void 0:rs.access_token});if(as.error)return as;const{data:ls}=as;if(ls.type!=="webauthn")return{data:ls,error:null};switch(ls.webauthn.type){case"create":return{data:Object.assign(Object.assign({},ls),{webauthn:Object.assign(Object.assign({},ls.webauthn),{credential_options:Object.assign(Object.assign({},ls.webauthn.credential_options),{publicKey:deserializeCredentialCreationOptions(ls.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},ls),{webauthn:Object.assign(Object.assign({},ls.webauthn),{credential_options:Object.assign(Object.assign({},ls.webauthn.credential_options),{publicKey:deserializeCredentialRequestOptions(ls.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(ss){if(isAuthError(ss))return this._returnResult({data:null,error:ss});throw ss}})}async _challengeAndVerify(ts){const{data:ss,error:rs}=await this._challenge({factorId:ts.factorId});return rs?this._returnResult({data:null,error:rs}):await this._verify({factorId:ts.factorId,challengeId:ss.id,code:ts.code})}async _listFactors(){var ts;const{data:{user:ss},error:rs}=await this.getUser();if(rs)return{data:null,error:rs};const ns={all:[],phone:[],totp:[],webauthn:[]};for(const os of(ts=ss==null?void 0:ss.factors)!==null&&ts!==void 0?ts:[])ns.all.push(os),os.status==="verified"&&ns[os.factor_type].push(os);return{data:ns,error:null}}async _getAuthenticatorAssuranceLevel(ts){var ss,rs,ns,os;if(ts)try{const{payload:hs}=decodeJWT(ts);let xs=null;hs.aal&&(xs=hs.aal);let ys=xs;const{data:{user:vs},error:gs}=await this.getUser(ts);if(gs)return this._returnResult({data:null,error:gs});((rs=(ss=vs==null?void 0:vs.factors)===null||ss===void 0?void 0:ss.filter(Ss=>Ss.status==="verified"))!==null&&rs!==void 0?rs:[]).length>0&&(ys="aal2");const js=hs.amr||[];return{data:{currentLevel:xs,nextLevel:ys,currentAuthenticationMethods:js},error:null}}catch(hs){if(isAuthError(hs))return this._returnResult({data:null,error:hs});throw hs}const{data:{session:as},error:ls}=await this.getSession();if(ls)return this._returnResult({data:null,error:ls});if(!as)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:cs}=decodeJWT(as.access_token);let us=null;cs.aal&&(us=cs.aal);let ds=us;((os=(ns=as.user.factors)===null||ns===void 0?void 0:ns.filter(hs=>hs.status==="verified"))!==null&&os!==void 0?os:[]).length>0&&(ds="aal2");const ps=cs.amr||[];return{data:{currentLevel:us,nextLevel:ds,currentAuthenticationMethods:ps},error:null}}async _getAuthorizationDetails(ts){try{return await this._useSession(async ss=>{const{data:{session:rs},error:ns}=ss;return ns?this._returnResult({data:null,error:ns}):rs?await _request(this.fetch,"GET",`${this.url}/oauth/authorizations/${ts}`,{headers:this.headers,jwt:rs.access_token,xform:os=>({data:os,error:null})}):this._returnResult({data:null,error:new AuthSessionMissingError})})}catch(ss){if(isAuthError(ss))return this._returnResult({data:null,error:ss});throw ss}}async _approveAuthorization(ts,ss){try{return await this._useSession(async rs=>{const{data:{session:ns},error:os}=rs;if(os)return this._returnResult({data:null,error:os});if(!ns)return this._returnResult({data:null,error:new AuthSessionMissingError});const as=await _request(this.fetch,"POST",`${this.url}/oauth/authorizations/${ts}/consent`,{headers:this.headers,jwt:ns.access_token,body:{action:"approve"},xform:ls=>({data:ls,error:null})});return as.data&&as.data.redirect_url&&isBrowser()&&!(ss!=null&&ss.skipBrowserRedirect)&&window.location.assign(as.data.redirect_url),as})}catch(rs){if(isAuthError(rs))return this._returnResult({data:null,error:rs});throw rs}}async _denyAuthorization(ts,ss){try{return await this._useSession(async rs=>{const{data:{session:ns},error:os}=rs;if(os)return this._returnResult({data:null,error:os});if(!ns)return this._returnResult({data:null,error:new AuthSessionMissingError});const as=await _request(this.fetch,"POST",`${this.url}/oauth/authorizations/${ts}/consent`,{headers:this.headers,jwt:ns.access_token,body:{action:"deny"},xform:ls=>({data:ls,error:null})});return as.data&&as.data.redirect_url&&isBrowser()&&!(ss!=null&&ss.skipBrowserRedirect)&&window.location.assign(as.data.redirect_url),as})}catch(rs){if(isAuthError(rs))return this._returnResult({data:null,error:rs});throw rs}}async _listOAuthGrants(){try{return await this._useSession(async ts=>{const{data:{session:ss},error:rs}=ts;return rs?this._returnResult({data:null,error:rs}):ss?await _request(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:ss.access_token,xform:ns=>({data:ns,error:null})}):this._returnResult({data:null,error:new AuthSessionMissingError})})}catch(ts){if(isAuthError(ts))return this._returnResult({data:null,error:ts});throw ts}}async _revokeOAuthGrant(ts){try{return await this._useSession(async ss=>{const{data:{session:rs},error:ns}=ss;return ns?this._returnResult({data:null,error:ns}):rs?(await _request(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:rs.access_token,query:{client_id:ts.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new AuthSessionMissingError})})}catch(ss){if(isAuthError(ss))return this._returnResult({data:null,error:ss});throw ss}}async fetchJwk(ts,ss={keys:[]}){let rs=ss.keys.find(ls=>ls.kid===ts);if(rs)return rs;const ns=Date.now();if(rs=this.jwks.keys.find(ls=>ls.kid===ts),rs&&this.jwks_cached_at+JWKS_TTL>ns)return rs;const{data:os,error:as}=await _request(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(as)throw as;return!os.keys||os.keys.length===0||(this.jwks=os,this.jwks_cached_at=ns,rs=os.keys.find(ls=>ls.kid===ts),!rs)?null:rs}async getClaims(ts,ss={}){try{let rs=ts;if(!rs){const{data:hs,error:xs}=await this.getSession();if(xs||!hs.session)return this._returnResult({data:null,error:xs});rs=hs.session.access_token}const{header:ns,payload:os,signature:as,raw:{header:ls,payload:cs}}=decodeJWT(rs);ss!=null&&ss.allowExpired||validateExp(os.exp);const us=!ns.alg||ns.alg.startsWith("HS")||!ns.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(ns.kid,ss!=null&&ss.keys?{keys:ss.keys}:ss==null?void 0:ss.jwks);if(!us){const{error:hs}=await this.getUser(rs);if(hs)throw hs;return{data:{claims:os,header:ns,signature:as},error:null}}const ds=getAlgorithm(ns.alg),ms=await crypto.subtle.importKey("jwk",us,ds,!0,["verify"]);if(!await crypto.subtle.verify(ds,ms,as,stringToUint8Array(`${ls}.${cs}`)))throw new AuthInvalidJwtError("Invalid JWT signature");return{data:{claims:os,header:ns,signature:as},error:null}}catch(rs){if(isAuthError(rs))return this._returnResult({data:null,error:rs});throw rs}}}GoTrueClient.nextInstanceID={};const AuthClient=GoTrueClient,version="2.93.1";let JS_ENV="";typeof Deno<"u"?JS_ENV="deno":typeof document<"u"?JS_ENV="web":typeof navigator<"u"&&navigator.product==="ReactNative"?JS_ENV="react-native":JS_ENV="node";function getClientPlatform(){const es=globalThis.process;if(es&&es.platform){const ts=es.platform;if(ts==="darwin")return"macOS";if(ts==="win32")return"Windows";if(ts==="linux")return"Linux";if(ts==="android")return"Android"}if(typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platform){const ts=navigator.userAgentData.platform;if(ts==="macOS")return"macOS";if(ts==="Windows")return"Windows";if(ts==="Linux")return"Linux";if(ts==="Android")return"Android";if(ts==="iOS")return"iOS"}return null}function getClientPlatformVersion(){const es=globalThis.process;if(es){const ts=es.versions;if(ts&&ts.node&&typeof window>"u")try{const ss=globalThis.require;if(ss)return ss("os").release()}catch{return null}}if(typeof Deno<"u"&&Deno.osRelease)try{return Deno.osRelease()}catch{return null}return typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platformVersion?navigator.userAgentData.platformVersion:null}function getClientRuntime(){if(typeof Deno<"u")return"deno";if(typeof Bun<"u")return"bun";const es=globalThis.process;if(es){const ts=es.versions;if(ts&&ts.node)return"node"}return null}function getClientRuntimeVersion(){if(typeof Deno<"u"&&Deno.version)return Deno.version.deno;if(typeof Bun<"u"&&Bun.version)return Bun.version;const es=globalThis.process;if(es){const ts=es.versions;if(ts&&ts.node)return ts.node}return null}function buildHeaders(){const es={"X-Client-Info":`supabase-js-${JS_ENV}/${version}`},ts=getClientPlatform();ts&&(es["X-Supabase-Client-Platform"]=ts);const ss=getClientPlatformVersion();ss&&(es["X-Supabase-Client-Platform-Version"]=ss);const rs=getClientRuntime();rs&&(es["X-Supabase-Client-Runtime"]=rs);const ns=getClientRuntimeVersion();return ns&&(es["X-Supabase-Client-Runtime-Version"]=ns),es}const DEFAULT_HEADERS=buildHeaders(),DEFAULT_GLOBAL_OPTIONS={headers:DEFAULT_HEADERS},DEFAULT_DB_OPTIONS={schema:"public"},DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},DEFAULT_REALTIME_OPTIONS={};function _typeof(es){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ts){return typeof ts}:function(ts){return ts&&typeof Symbol=="function"&&ts.constructor===Symbol&&ts!==Symbol.prototype?"symbol":typeof ts},_typeof(es)}function toPrimitive(es,ts){if(_typeof(es)!="object"||!es)return es;var ss=es[Symbol.toPrimitive];if(ss!==void 0){var rs=ss.call(es,ts);if(_typeof(rs)!="object")return rs;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ts==="string"?String:Number)(es)}function toPropertyKey(es){var ts=toPrimitive(es,"string");return _typeof(ts)=="symbol"?ts:ts+""}function _defineProperty(es,ts,ss){return(ts=toPropertyKey(ts))in es?Object.defineProperty(es,ts,{value:ss,enumerable:!0,configurable:!0,writable:!0}):es[ts]=ss,es}function ownKeys(es,ts){var ss=Object.keys(es);if(Object.getOwnPropertySymbols){var rs=Object.getOwnPropertySymbols(es);ts&&(rs=rs.filter(function(ns){return Object.getOwnPropertyDescriptor(es,ns).enumerable})),ss.push.apply(ss,rs)}return ss}function _objectSpread2(es){for(var ts=1;ts<arguments.length;ts++){var ss=arguments[ts]!=null?arguments[ts]:{};ts%2?ownKeys(Object(ss),!0).forEach(function(rs){_defineProperty(es,rs,ss[rs])}):Object.getOwnPropertyDescriptors?Object.defineProperties(es,Object.getOwnPropertyDescriptors(ss)):ownKeys(Object(ss)).forEach(function(rs){Object.defineProperty(es,rs,Object.getOwnPropertyDescriptor(ss,rs))})}return es}const resolveFetch=es=>es?(...ts)=>es(...ts):(...ts)=>fetch(...ts),resolveHeadersConstructor=()=>Headers,fetchWithAuth=(es,ts,ss)=>{const rs=resolveFetch(ss),ns=resolveHeadersConstructor();return async(os,as)=>{var ls;const cs=(ls=await ts())!==null&&ls!==void 0?ls:es;let us=new ns(as==null?void 0:as.headers);return us.has("apikey")||us.set("apikey",es),us.has("Authorization")||us.set("Authorization",`Bearer ${cs}`),rs(os,_objectSpread2(_objectSpread2({},as),{},{headers:us}))}};function ensureTrailingSlash(es){return es.endsWith("/")?es:es+"/"}function applySettingDefaults(es,ts){var ss,rs;const{db:ns,auth:os,realtime:as,global:ls}=es,{db:cs,auth:us,realtime:ds,global:ms}=ts,ps={db:_objectSpread2(_objectSpread2({},cs),ns),auth:_objectSpread2(_objectSpread2({},us),os),realtime:_objectSpread2(_objectSpread2({},ds),as),storage:{},global:_objectSpread2(_objectSpread2(_objectSpread2({},ms),ls),{},{headers:_objectSpread2(_objectSpread2({},(ss=ms==null?void 0:ms.headers)!==null&&ss!==void 0?ss:{}),(rs=ls==null?void 0:ls.headers)!==null&&rs!==void 0?rs:{})}),accessToken:async()=>""};return es.accessToken?ps.accessToken=es.accessToken:delete ps.accessToken,ps}function validateSupabaseUrl(es){const ts=es==null?void 0:es.trim();if(!ts)throw new Error("supabaseUrl is required.");if(!ts.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(ensureTrailingSlash(ts))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var SupabaseAuthClient=class extends AuthClient{constructor(es){super(es)}},SupabaseClient=class{constructor(es,ts,ss){var rs,ns;this.supabaseUrl=es,this.supabaseKey=ts;const os=validateSupabaseUrl(es);if(!ts)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",os),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",os),this.storageUrl=new URL("storage/v1",os),this.functionsUrl=new URL("functions/v1",os);const as=`sb-${os.hostname.split(".")[0]}-auth-token`,ls={db:DEFAULT_DB_OPTIONS,realtime:DEFAULT_REALTIME_OPTIONS,auth:_objectSpread2(_objectSpread2({},DEFAULT_AUTH_OPTIONS),{},{storageKey:as}),global:DEFAULT_GLOBAL_OPTIONS},cs=applySettingDefaults(ss??{},ls);if(this.storageKey=(rs=cs.auth.storageKey)!==null&&rs!==void 0?rs:"",this.headers=(ns=cs.global.headers)!==null&&ns!==void 0?ns:{},cs.accessToken)this.accessToken=cs.accessToken,this.auth=new Proxy({},{get:(ds,ms)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(ms)} is not possible`)}});else{var us;this.auth=this._initSupabaseAuthClient((us=cs.auth)!==null&&us!==void 0?us:{},this.headers,cs.global.fetch)}this.fetch=fetchWithAuth(ts,this._getAccessToken.bind(this),cs.global.fetch),this.realtime=this._initRealtimeClient(_objectSpread2({headers:this.headers,accessToken:this._getAccessToken.bind(this)},cs.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(ds=>this.realtime.setAuth(ds)).catch(ds=>console.warn("Failed to set initial Realtime auth token:",ds)),this.rest=new PostgrestClient(new URL("rest/v1",os).href,{headers:this.headers,schema:cs.db.schema,fetch:this.fetch}),this.storage=new StorageClient(this.storageUrl.href,this.headers,this.fetch,ss==null?void 0:ss.storage),cs.accessToken||this._listenForAuthEvents()}get functions(){return new FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(es){return this.rest.from(es)}schema(es){return this.rest.schema(es)}rpc(es,ts={},ss={head:!1,get:!1,count:void 0}){return this.rest.rpc(es,ts,ss)}channel(es,ts={config:{}}){return this.realtime.channel(es,ts)}getChannels(){return this.realtime.getChannels()}removeChannel(es){return this.realtime.removeChannel(es)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var es=this,ts,ss;if(es.accessToken)return await es.accessToken();const{data:rs}=await es.auth.getSession();return(ts=(ss=rs.session)===null||ss===void 0?void 0:ss.access_token)!==null&&ts!==void 0?ts:es.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:es,persistSession:ts,detectSessionInUrl:ss,storage:rs,userStorage:ns,storageKey:os,flowType:as,lock:ls,debug:cs,throwOnError:us},ds,ms){const ps={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl.href,headers:_objectSpread2(_objectSpread2({},ps),ds),storageKey:os,autoRefreshToken:es,persistSession:ts,detectSessionInUrl:ss,storage:rs,userStorage:ns,flowType:as,lock:ls,debug:cs,throwOnError:us,fetch:ms,hasCustomAuthorizationHeader:Object.keys(this.headers).some(hs=>hs.toLowerCase()==="authorization")})}_initRealtimeClient(es){return new RealtimeClient(this.realtimeUrl.href,_objectSpread2(_objectSpread2({},es),{},{params:_objectSpread2(_objectSpread2({},{apikey:this.supabaseKey}),es==null?void 0:es.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((es,ts)=>{this._handleTokenChanged(es,"CLIENT",ts==null?void 0:ts.access_token)})}_handleTokenChanged(es,ts,ss){(es==="TOKEN_REFRESHED"||es==="SIGNED_IN")&&this.changedAccessToken!==ss?(this.changedAccessToken=ss,this.realtime.setAuth(ss)):es==="SIGNED_OUT"&&(this.realtime.setAuth(),ts=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const createClient=(es,ts,ss)=>new SupabaseClient(es,ts,ss);function shouldShowDeprecationWarning(){if(typeof window<"u")return!1;const es=globalThis.process;if(!es)return!1;const ts=es.version;if(ts==null)return!1;const ss=ts.match(/^v(\d+)\./);return ss?parseInt(ss[1],10)<=18:!1}shouldShowDeprecationWarning()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const supabaseUrl=void 0,supabaseAnonKey=void 0,isSupabaseConfigured=!!supabaseUrl,supabase=isSupabaseConfigured?createClient(supabaseUrl,supabaseAnonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:localStorage,storageKey:"checks-happy-auth"}}):createClient("https://placeholder.supabase.co","placeholder-key",{auth:{autoRefreshToken:!1,persistSession:!1}});async function signUp({email:es,password:ts,name:ss}){try{const{data:rs,error:ns}=await supabase.auth.signUp({email:es,password:ts,options:{data:{name:ss}}});if(ns)throw ns;if(!rs.user)throw new Error("No user returned from sign up");const{error:os}=await supabase.from("users").insert({id:rs.user.id,email:es,name:ss,tier:"trainee"});return os&&console.error("Error creating user profile:",os),{user:rs.user,error:null}}catch(rs){return{user:null,error:rs}}}async function signIn({email:es,password:ts}){try{const{data:ss,error:rs}=await supabase.auth.signInWithPassword({email:es,password:ts});if(rs)throw rs;return{user:ss.user,error:null}}catch(ss){return{user:null,error:ss}}}async function signOut(){try{const{error:es}=await supabase.auth.signOut();if(es)throw es;return{error:null}}catch(es){return{error:es}}}async function getUserProfile(es){try{const{data:ts,error:ss}=await supabase.from("users").select("*").eq("id",es).single();if(ss)throw ss;return{profile:ts,error:null}}catch(ts){return{profile:null,error:ts}}}async function updateUserProfile(es,ts){try{const{error:ss}=await supabase.from("users").update(ts).eq("id",es);if(ss)throw ss;return{error:null}}catch(ss){return{error:ss}}}async function updateUserTier(es,ts){return updateUserProfile(es,{tier:ts})}async function resetPassword(es){try{const{error:ts}=await supabase.auth.resetPasswordForEmail(es,{redirectTo:`${window.location.origin}/reset-password`});if(ts)throw ts;return{error:null}}catch(ts){return{error:ts}}}async function getSession(){const{data:{session:es},error:ts}=await supabase.auth.getSession();if(ts)throw ts;return es}function generateInviteCode(){const es="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let ts="";for(let ss=0;ss<3;ss++)ts+=es[Math.floor(Math.random()*es.length)];ts+="-";for(let ss=0;ss<4;ss++)ts+=es[Math.floor(Math.random()*es.length)];return ts}async function createProject(es,ts,ss){try{const rs=generateInviteCode(),{data:ns,error:os}=await supabase.from("projects").insert({name:es,production_type:ts,invite_code:rs,created_by:ss}).select().single();if(os)throw os;const{error:as}=await supabase.from("project_members").insert({project_id:ns.id,user_id:ss,role:"designer",is_owner:!0});if(as)throw await supabase.from("projects").delete().eq("id",ns.id),as;return{project:ns,inviteCode:rs,error:null}}catch(rs){return{project:null,inviteCode:null,error:rs}}}async function joinProject(es,ts,ss="floor"){try{const{data:rs,error:ns}=await supabase.from("projects").select("*").eq("invite_code",es.toUpperCase()).single();if(ns)throw ns.code==="PGRST116"?new Error("Invalid invite code"):ns;const{data:os}=await supabase.from("project_members").select("id").eq("project_id",rs.id).eq("user_id",ts).single();if(os)return{project:rs,error:null};const{error:as}=await supabase.from("project_members").insert({project_id:rs.id,user_id:ts,role:ss,is_owner:!1});if(as)throw as;return{project:rs,error:null}}catch(rs){return{project:null,error:rs}}}async function getUserProjects(es){try{const{data:ts,error:ss}=await supabase.from("project_members").select(`
        role,
        is_owner,
        joined_at,
        projects (*)
      `).eq("user_id",es).order("joined_at",{ascending:!1});if(ss)throw ss;return{projects:(ts||[]).map(ns=>({...ns.projects,role:ns.role,is_owner:ns.is_owner})),error:null}}catch(ts){return{projects:[],error:ts}}}async function deleteProject(es,ts){try{const{data:ss,error:rs}=await supabase.from("project_members").select("is_owner").eq("project_id",es).eq("user_id",ts).single();if(rs)throw new Error("Failed to verify project ownership");if(!(ss!=null&&ss.is_owner))throw new Error("Only project owners can delete projects");const{data:ns}=await supabase.from("scenes").select("id").eq("project_id",es),os=(ns==null?void 0:ns.map(us=>us.id))||[],{data:as}=await supabase.from("looks").select("id").eq("project_id",es),ls=(as==null?void 0:as.map(us=>us.id))||[];os.length>0&&await supabase.from("scene_characters").delete().in("scene_id",os),ls.length>0&&await supabase.from("look_scenes").delete().in("look_id",ls),await supabase.from("looks").delete().eq("project_id",es),await supabase.from("characters").delete().eq("project_id",es),await supabase.from("scenes").delete().eq("project_id",es),await supabase.from("project_members").delete().eq("project_id",es);const{error:cs}=await supabase.from("projects").delete().eq("id",es);if(cs)throw cs;return{error:null}}catch(ss){return{error:ss}}}async function leaveProject(es,ts){try{const{data:ss,error:rs}=await supabase.from("project_members").select("is_owner").eq("project_id",es).eq("user_id",ts).single();if(rs)throw new Error("Failed to verify membership");if(ss!=null&&ss.is_owner)throw new Error("Owners cannot leave their own project. Transfer ownership or delete the project instead.");const{error:ns}=await supabase.from("project_members").delete().eq("project_id",es).eq("user_id",ts);if(ns)throw ns;return{error:null}}catch(ss){return{error:ss}}}const VALID_TIERS=["trainee","artist","supervisor","designer"];function toAppUser(es){const ts=VALID_TIERS.includes(es.tier)?es.tier:"trainee";return{id:es.id,email:es.email,name:es.name,tier:ts,createdAt:new Date(es.created_at)}}function toProjectMembership(es){return{projectId:es.id,projectName:es.name,productionType:es.production_type,role:es.is_owner?"owner":es.role,joinedAt:new Date(es.created_at),lastAccessedAt:new Date,teamMemberCount:0,sceneCount:0,projectCode:es.invite_code,status:es.status==="wrapped"?"wrapped":"active"}}const useAuthStore=create()(persist((es,ts)=>({isAuthenticated:!1,user:null,isLoading:!1,error:null,currentScreen:"welcome",screenHistory:[],hasCompletedOnboarding:!1,hasSelectedPlan:!1,subscription:createDefaultSubscription(),projectMemberships:[],guestProjectCode:null,settingsProjectId:null,initializeAuth:async()=>{try{const ss=await getSession();if(ss!=null&&ss.user){const{profile:rs,error:ns}=await getUserProfile(ss.user.id);if(rs&&!ns){const os=toAppUser(rs),{projects:as}=await getUserProjects(ss.user.id),ls=as.map(toProjectMembership);es({isAuthenticated:!0,user:os,projectMemberships:ls,hasCompletedOnboarding:!0,hasSelectedPlan:!0,currentScreen:"hub"})}}}catch(ss){console.error("Error initializing auth:",ss)}},refreshUserProjects:async()=>{const{user:ss}=ts();if(ss)try{const{projects:rs}=await getUserProjects(ss.id),ns=rs.map(toProjectMembership);es({projectMemberships:ns})}catch(rs){console.error("Error refreshing projects:",rs)}},setScreen:(ss,rs=!0)=>{const{currentScreen:ns,screenHistory:os}=ts();ss!==ns&&es(rs?{currentScreen:ss,screenHistory:[...os,ns],error:null}:{currentScreen:ss,error:null})},goBack:()=>{const{screenHistory:ss,isAuthenticated:rs}=ts();if(ss.length>0){const ns=[...ss],os=ns.pop();es({currentScreen:os,screenHistory:ns,error:null})}else es({currentScreen:rs?"hub":"welcome",error:null})},signIn:async(ss,rs)=>{var ns,os;es({isLoading:!0,error:null});try{const{user:as,error:ls}=await signIn({email:ss,password:rs});if(ls){const ds=ls.message.includes("Invalid login")?"Invalid email or password":ls.message;return es({isLoading:!1,error:ds}),!1}if(!as)return es({isLoading:!1,error:"Sign in failed. Please try again."}),!1;const{profile:cs,error:us}=await getUserProfile(as.id);if(us||!cs){await supabase.from("users").insert({id:as.id,email:as.email,name:((ns=as.user_metadata)==null?void 0:ns.name)||ss.split("@")[0],tier:"trainee"});const ds={id:as.id,email:as.email,name:((os=as.user_metadata)==null?void 0:os.name)||ss.split("@")[0],tier:"trainee",createdAt:new Date};es({isAuthenticated:!0,user:ds,isLoading:!1,error:null,currentScreen:"hub",hasCompletedOnboarding:!0,hasSelectedPlan:!0})}else{const ds=toAppUser(cs),{projects:ms}=await getUserProjects(as.id),ps=ms.map(toProjectMembership);es({isAuthenticated:!0,user:ds,projectMemberships:ps,isLoading:!1,error:null,currentScreen:"hub",hasCompletedOnboarding:!0,hasSelectedPlan:!0})}return!0}catch(as){return console.error("Sign in error:",as),es({isLoading:!1,error:"An error occurred. Please try again."}),!1}},signUp:async(ss,rs,ns)=>{es({isLoading:!0,error:null});try{const{user:os,error:as}=await signUp({email:rs,password:ns,name:ss});if(as){const cs=as.message.includes("already registered")?"An account with this email already exists":as.message;return es({isLoading:!1,error:cs}),!1}if(!os)return es({isLoading:!1,error:"Sign up failed. Please try again."}),!1;const ls={id:os.id,email:os.email,name:ss,tier:BETA_MODE?"designer":"trainee",createdAt:new Date};return es({isAuthenticated:!0,user:ls,isLoading:!1,error:null,currentScreen:BETA_MODE?"hub":"select-plan",hasCompletedOnboarding:BETA_MODE,hasSelectedPlan:BETA_MODE,subscription:createDefaultSubscription(),projectMemberships:[]}),!0}catch(os){return console.error("Sign up error:",os),es({isLoading:!1,error:"An error occurred. Please try again."}),!1}},signOut:async()=>{try{await signOut()}catch(ss){console.error("Sign out error:",ss)}es({isAuthenticated:!1,user:null,currentScreen:"welcome",screenHistory:[],hasCompletedOnboarding:!1,hasSelectedPlan:!1,subscription:createDefaultSubscription(),projectMemberships:[],guestProjectCode:null})},joinProject:async ss=>{const{user:rs,projectMemberships:ns,isAuthenticated:os}=ts();es({isLoading:!0,error:null});try{if(!os||!rs)return es({isLoading:!1,guestProjectCode:ss.toUpperCase()}),{success:!0,projectName:"Project"};const{project:as,error:ls}=await joinProject(ss,rs.id);if(ls)return es({isLoading:!1,error:ls.message}),{success:!1,error:ls.message};if(!as)return es({isLoading:!1,error:"Failed to join project"}),{success:!1,error:"Failed to join project"};const cs={projectId:as.id,projectName:as.name,productionType:as.production_type,role:"floor",joinedAt:new Date,lastAccessedAt:new Date,teamMemberCount:1,sceneCount:0,projectCode:as.invite_code,status:"active"};return es({isLoading:!1,projectMemberships:[...ns,cs],currentScreen:"hub"}),{success:!0,projectName:as.name}}catch(as){return console.error("Join project error:",as),es({isLoading:!1,error:"Failed to join project. Please try again."}),{success:!1,error:"Failed to join project"}}},createProject:async(ss,rs)=>{const{user:ns,projectMemberships:os}=ts(),as=ns?TIER_LIMITS[ns.tier]:null;if(!ns||!(as!=null&&as.canCreateProjects))return es({error:"Your account tier does not allow creating projects"}),{success:!1,error:"Insufficient permissions"};es({isLoading:!0,error:null});try{const{project:ls,inviteCode:cs,error:us}=await createProject(ss,rs,ns.id);if(us||!ls||!cs)return es({isLoading:!1,error:(us==null?void 0:us.message)||"Failed to create project"}),{success:!1,error:(us==null?void 0:us.message)||"Failed to create project"};const ds={projectId:ls.id,projectName:ls.name,productionType:rs,role:"owner",joinedAt:new Date,lastAccessedAt:new Date,teamMemberCount:1,sceneCount:0,projectCode:cs,status:"active"};return es({isLoading:!1,projectMemberships:[...os,ds]}),{success:!0,code:cs}}catch(ls){return console.error("Create project error:",ls),es({isLoading:!1,error:"Failed to create project. Please try again."}),{success:!1,error:"Failed to create project"}}},clearError:()=>{es({error:null})},setHasCompletedOnboarding:ss=>{es({hasCompletedOnboarding:ss})},canCreateProjects:()=>{const{user:ss}=ts();if(!ss)return!1;const rs=TIER_LIMITS[ss.tier];return rs?rs.canCreateProjects:!1},updateLastAccessed:ss=>{const{projectMemberships:rs}=ts(),ns=rs.map(os=>os.projectId===ss?{...os,lastAccessedAt:new Date}:os);es({projectMemberships:ns})},selectTier:async(ss,rs)=>{const{user:ns}=ts();if(!ns)return!1;es({isLoading:!0,error:null});try{const{error:os}=await updateUserTier(ns.id,ss);if(os)return es({isLoading:!1,error:os.message}),!1;const as={...ns,tier:ss},ls={tier:ss,status:ss==="trainee"?null:"active",billingPeriod:ss==="trainee"?null:rs,subscriptionStartedAt:ss!=="trainee"?new Date:void 0,currentPeriodEndsAt:ss!=="trainee"?new Date(Date.now()+(rs==="yearly"?365:30)*24*60*60*1e3):void 0};return es({user:as,subscription:ls,hasSelectedPlan:!0,hasCompletedOnboarding:!0,currentScreen:"hub",isLoading:!1,error:null}),!0}catch(os){return console.error("Select tier error:",os),es({isLoading:!1,error:"Failed to update subscription. Please try again."}),!1}},updateSubscription:ss=>{const{subscription:rs,user:ns}=ts(),os={...rs,...ss};if(ss.tier&&ns){const as={...ns,tier:ss.tier};updateUserTier(ns.id,ss.tier).catch(console.error),es({subscription:os,user:as})}else es({subscription:os})},deleteProject:async ss=>{const{user:rs,projectMemberships:ns}=ts();if(!rs)return{success:!1,error:"Not authenticated"};es({isLoading:!0,error:null});try{if(!ss.startsWith("project-")){const{error:ls}=await deleteProject(ss,rs.id);if(ls)return es({isLoading:!1,error:ls.message}),{success:!1,error:ls.message}}const as=ns.filter(ls=>ls.projectId!==ss);return es({isLoading:!1,projectMemberships:as,error:null}),{success:!0}}catch(os){return console.error("Delete project error:",os),es({isLoading:!1,error:"Failed to delete project. Please try again."}),{success:!1,error:"Failed to delete project"}}},leaveProject:async ss=>{const{user:rs,projectMemberships:ns}=ts();if(!rs)return{success:!1,error:"Not authenticated"};es({isLoading:!0,error:null});try{if(!ss.startsWith("project-")){const{error:ls}=await leaveProject(ss,rs.id);if(ls)return es({isLoading:!1,error:ls.message}),{success:!1,error:ls.message}}const as=ns.filter(ls=>ls.projectId!==ss);return es({isLoading:!1,projectMemberships:as,error:null}),{success:!0}}catch(os){return console.error("Leave project error:",os),es({isLoading:!1,error:"Failed to leave project. Please try again."}),{success:!1,error:"Failed to leave project"}}},setSettingsProjectId:ss=>{es({settingsProjectId:ss})}}),{name:"checks-happy-auth-storage",storage:createJSONStorage(()=>localStorage),partialize:es=>({isAuthenticated:es.isAuthenticated,user:es.user,currentScreen:es.currentScreen,hasCompletedOnboarding:es.hasCompletedOnboarding,hasSelectedPlan:es.hasSelectedPlan,subscription:es.subscription,projectMemberships:es.projectMemberships,guestProjectCode:es.guestProjectCode})}));isSupabaseConfigured&&supabase.auth.onAuthStateChange(async(es,ts)=>{es==="SIGNED_IN"&&(ts!=null&&ts.user)?useAuthStore.getState().initializeAuth():es==="TOKEN_REFRESHED"&&(ts!=null&&ts.user)?useAuthStore.getState().isAuthenticated||useAuthStore.getState().initializeAuth():es==="USER_UPDATED"&&(ts!=null&&ts.user)?useAuthStore.getState().initializeAuth():es==="SIGNED_OUT"&&useAuthStore.setState({isAuthenticated:!1,user:null,projectMemberships:[],currentScreen:"welcome",screenHistory:[],hasCompletedOnboarding:!1,hasSelectedPlan:!1,subscription:createDefaultSubscription(),guestProjectCode:null})});const useSyncStore=create()(es=>({status:"idle",lastSyncedAt:null,pendingChanges:0,error:null,activeProjectId:null,realtimeConnected:!1,onlineMembers:0,setStatus:ts=>es({status:ts,error:ts==="error"?void 0:null}),setSynced:()=>es({status:"synced",lastSyncedAt:new Date,error:null}),setSyncing:()=>es({status:"syncing",error:null}),setError:ts=>es({status:"error",error:ts}),setOffline:()=>es({status:"offline"}),setActiveProject:ts=>es({activeProjectId:ts}),setRealtimeConnected:ts=>es({realtimeConnected:ts}),setOnlineMembers:ts=>es({onlineMembers:ts}),incrementPending:()=>es(ts=>({pendingChanges:ts.pendingChanges+1})),decrementPending:()=>es(ts=>({pendingChanges:Math.max(0,ts.pendingChanges-1)})),clearPending:()=>es({pendingChanges:0}),reset:()=>es({status:"idle",lastSyncedAt:null,pendingChanges:0,error:null,activeProjectId:null,realtimeConnected:!1,onlineMembers:0})})),BUCKET_NAME="continuity-photos";async function uploadPhoto(es,ts,ss,rs){try{const ns=ss instanceof File?ss.name.split(".").pop():"jpg",os=v4(),as=`${es}/${ts}/${os}.${ns}`,{data:ls,error:cs}=await supabase.storage.from(BUCKET_NAME).upload(as,ss,{contentType:ss.type||"image/jpeg",cacheControl:"3600",upsert:!1});if(cs)throw cs;const{data:us}=supabase.storage.from(BUCKET_NAME).getPublicUrl(as);return{result:{path:ls.path,url:us.publicUrl},error:null}}catch(ns){return{result:null,error:ns}}}async function uploadBase64Photo(es,ts,ss,rs="image/jpeg"){try{const os=await(await fetch(ss)).blob();return uploadPhoto(es,ts,os)}catch(ns){return{result:null,error:ns}}}async function downloadPhoto(es){try{const{data:ts,error:ss}=await supabase.storage.from(BUCKET_NAME).download(es);if(ss)throw ss;return{blob:ts,error:null}}catch(ts){return{blob:null,error:ts}}}const CLIENT_ID=v4(),PUSH_DEBOUNCE_MS=800;let activeChannel=null,activeProjectId=null,pushTimers={},pushingTables=new Set;function sceneToDb(es,ts){return{id:es.id,project_id:ts,scene_number:es.sceneNumber,int_ext:es.intExt||null,location:es.slugline||null,time_of_day:es.timeOfDay||null,synopsis:es.synopsis||null,page_count:null,story_day:(es.shootingDay,null),shooting_day:es.shootingDay||null,filming_status:es.filmingStatus||null,filming_notes:es.filmingNotes||null,is_complete:es.isComplete,completed_at:es.completedAt?new Date(es.completedAt).toISOString():null}}function characterToDb(es,ts){return{id:es.id,project_id:ts,name:es.name,actor_name:null,initials:es.initials,avatar_colour:es.avatarColour||"#6366f1",base_look_description:null}}function lookToDb(es,ts){return{id:es.id,project_id:ts,character_id:es.characterId,name:es.name,description:es.notes||null,estimated_time:es.estimatedTime,makeup_details:es.makeup,hair_details:es.hair}}function sceneCaptureToDb(es,ts,ss){return{id:es.id,scene_id:es.sceneId,character_id:es.characterId,look_id:es.lookId||null,shooting_day:null,status:"in_progress",hair_notes:null,makeup_notes:null,prosthetics_notes:null,wounds_blood_notes:null,general_notes:es.notes||null,application_time:es.applicationTime||null,continuity_flags:es.continuityFlags,continuity_events_data:es.continuityEvents,sfx_details:es.sfxDetails,checked_by:ss,checked_at:null}}function dbToScene(es,ts,ss){return{id:es.id,sceneNumber:es.scene_number,slugline:es.location||"",intExt:es.int_ext||"INT",timeOfDay:es.time_of_day||"DAY",synopsis:es.synopsis||void 0,characters:ts,isComplete:es.is_complete,completedAt:es.completed_at?new Date(es.completed_at):void 0,filmingStatus:es.filming_status||void 0,filmingNotes:es.filming_notes||void 0,shootingDay:es.shooting_day||void 0,scriptContent:ss==null?void 0:ss.scriptContent,hasScheduleDiscrepancy:ss==null?void 0:ss.hasScheduleDiscrepancy,characterConfirmationStatus:ss==null?void 0:ss.characterConfirmationStatus,suggestedCharacters:ss==null?void 0:ss.suggestedCharacters,amendmentStatus:ss==null?void 0:ss.amendmentStatus,previousScriptContent:ss==null?void 0:ss.previousScriptContent,amendmentDate:ss==null?void 0:ss.amendmentDate,amendmentNotes:ss==null?void 0:ss.amendmentNotes}}function dbToCharacter(es,ts){return{id:es.id,name:es.name,initials:es.initials,avatarColour:es.avatar_colour,actorNumber:ts==null?void 0:ts.actorNumber}}function dbToLook(es,ts,ss){return{id:es.id,characterId:es.character_id,name:es.name,scenes:ts,estimatedTime:es.estimated_time,makeup:es.makeup_details||{foundation:"",coverage:"",concealer:"",concealerPlacement:"",contour:"",contourPlacement:"",highlight:"",highlightPlacement:"",blush:"",blushPlacement:"",browProduct:"",browShape:"",eyePrimer:"",lidColour:"",creaseColour:"",outerV:"",liner:"",lashes:"",lipLiner:"",lipColour:"",setting:""},hair:es.hair_details||{style:"",products:"",parting:"",piecesOut:"",pins:"",accessories:"",hairType:"Natural",wigNameId:"",wigType:"",wigCapMethod:"",wigAttachment:[],hairline:"",laceTint:"",edgesBabyHairs:""},notes:es.description||void 0,masterReference:ss==null?void 0:ss.masterReference,continuityFlags:ss==null?void 0:ss.continuityFlags,continuityEvents:ss==null?void 0:ss.continuityEvents,sfxDetails:ss==null?void 0:ss.sfxDetails}}function dbToSceneCapture(es,ts,ss){return{id:es.id,sceneId:es.scene_id,characterId:es.character_id,lookId:es.look_id||"",capturedAt:new Date(es.created_at),photos:ts,additionalPhotos:ss,continuityFlags:es.continuity_flags||{sweat:!1,dishevelled:!1,blood:!1,dirt:!1,wetHair:!1,tears:!1},continuityEvents:es.continuity_events_data||[],sfxDetails:es.sfx_details||{sfxRequired:!1,sfxTypes:[],prostheticPieces:"",prostheticAdhesive:"",bloodTypes:[],bloodProducts:"",bloodPlacement:"",tattooCoverage:"",temporaryTattoos:"",contactLenses:"",teeth:"",agingCharacterNotes:"",sfxApplicationTime:null,sfxReferencePhotos:[]},notes:es.general_notes||"",applicationTime:es.application_time||void 0}}async function pullProjectData(es){if(!isSupabaseConfigured)return!1;const ts=useSyncStore.getState();ts.setSyncing();try{const[ss,rs,ns,os]=await Promise.all([supabase.from("scenes").select("*").eq("project_id",es).order("scene_number"),supabase.from("characters").select("*").eq("project_id",es).order("name"),supabase.from("looks").select("*").eq("project_id",es),supabase.from("schedule_data").select("*").eq("project_id",es).order("created_at",{ascending:!1}).limit(1)]);if(ss.error)throw ss.error;if(rs.error)throw rs.error;if(ns.error)throw ns.error;const as=ss.data||[],ls=rs.data||[],cs=ns.data||[],us=os.data||[],ds=as.map(Ws=>Ws.id),ms=cs.map(Ws=>Ws.id),[ps,hs,xs]=await Promise.all([ds.length>0?supabase.from("scene_characters").select("scene_id, character_id").in("scene_id",ds):Promise.resolve({data:[],error:null}),ms.length>0?supabase.from("look_scenes").select("look_id, scene_number").in("look_id",ms):Promise.resolve({data:[],error:null}),ds.length>0?supabase.from("continuity_events").select("*").in("scene_id",ds):Promise.resolve({data:[],error:null})]),ys=ps.data||[],vs=hs.data||[],gs=xs.data||[],fs=gs.map(Ws=>Ws.id),Ss=(fs.length>0?await supabase.from("photos").select("*").in("continuity_event_id",fs):{data:[],error:null}).data||[];if(as.length===0&&ls.length===0&&cs.length===0)return ts.setSynced(),!0;const bs=new Map;for(const Ws of ys){const Is=bs.get(Ws.scene_id)||[];Is.push(Ws.character_id),bs.set(Ws.scene_id,Is)}const Es=new Map;for(const Ws of vs){const Is=Es.get(Ws.look_id)||[];Is.push(Ws.scene_number),Es.set(Ws.look_id,Is)}const Rs=new Map;for(const Ws of Ss){const Is=Rs.get(Ws.continuity_event_id)||[];Is.push(Ws),Rs.set(Ws.continuity_event_id,Is)}const ws=useProjectStore.getState(),Ns=ws.currentProject;if(!Ns)return ts.setSynced(),!0;const ks=new Map(Ns.scenes.map(Ws=>[Ws.id,Ws])),_s=new Map(Ns.characters.map(Ws=>[Ws.id,Ws])),Ls=new Map(Ns.looks.map(Ws=>[Ws.id,Ws])),Os=as.map(Ws=>dbToScene(Ws,bs.get(Ws.id)||[],ks.get(Ws.id))),zs=ls.map(Ws=>dbToCharacter(Ws,_s.get(Ws.id))),qs=cs.map(Ws=>dbToLook(Ws,Es.get(Ws.id)||[],Ls.get(Ws.id))),Qs={};for(const Ws of gs){const Is=Rs.get(Ws.id)||[],Bs={},Vs=[];for(const Ds of Is){const Cs=await downloadAndCachePhoto(Ds);Cs&&(Ds.angle!=="additional"&&Ds.angle!=="detail"?Bs[Ds.angle]=Cs:Vs.push(Cs))}Qs[Ws.id]=dbToSceneCapture(Ws,Bs,Vs)}const Ys={...Ns,scenes:Os,characters:zs,looks:qs};if(ws.setProject(Ys),Object.keys(Qs).length>0)for(const[Ws,Is]of Object.entries(Qs))ws.updateSceneCapture(Ws,Is);if(us.length>0){const Ws=us[0];mergeScheduleData(Ws,es)}return ts.setSynced(),!0}catch(ss){return console.error("[SyncService] Pull failed:",ss),ts.setError(ss instanceof Error?ss.message:"Pull failed"),!1}}async function downloadAndCachePhoto(es){try{const ts=await getPhotoBlob(es.id);if(ts)return{id:es.id,uri:"",thumbnail:ts.thumbnail,capturedAt:ts.capturedAt,angle:es.angle};const{blob:ss,error:rs}=await downloadPhoto(es.storage_path);if(rs||!ss)return null;const ns=await createThumbnail(ss);return await savePhotoBlob(es.id,ss,ns,es.angle),{id:es.id,uri:URL.createObjectURL(ss),thumbnail:ns,capturedAt:new Date(es.taken_at),angle:es.angle}}catch(ts){return console.error("[SyncService] Photo download failed:",ts),null}}async function createThumbnail(es){return new Promise(ts=>{const ss=new Image,rs=URL.createObjectURL(es);ss.onload=()=>{const ns=document.createElement("canvas"),os=80;ns.width=os,ns.height=os;const as=ns.getContext("2d"),ls=Math.max(os/ss.width,os/ss.height),cs=(os-ss.width*ls)/2,us=(os-ss.height*ls)/2;as.drawImage(ss,cs,us,ss.width*ls,ss.height*ls),URL.revokeObjectURL(rs),ts(ns.toDataURL("image/jpeg",.6))},ss.onerror=()=>{URL.revokeObjectURL(rs),ts("")},ss.src=rs})}function mergeScheduleData(es,ts){const ss=useScheduleStore.getState(),rs=ss.schedule;if(!es.days&&!es.cast_list||rs&&rs.days.length>0)return;const ns={id:es.id,status:es.status==="complete"?"complete":"pending",castList:es.cast_list||[],days:es.days||[],totalDays:(es.days||[]).length,uploadedAt:new Date(es.created_at),rawText:es.raw_pdf_text||void 0};ss.setSchedule(ns)}function debouncedPush(es,ts){pushTimers[es]&&clearTimeout(pushTimers[es]),useSyncStore.getState().incrementPending(),pushTimers[es]=setTimeout(async()=>{pushingTables.add(es);try{useSyncStore.getState().setSyncing(),await ts(),useSyncStore.getState().decrementPending(),useSyncStore.getState().pendingChanges===0&&useSyncStore.getState().setSynced()}catch(ss){console.error(`[SyncService] Push ${es} failed:`,ss),useSyncStore.getState().setError(`Failed to sync ${es}`)}finally{pushingTables.delete(es)}},PUSH_DEBOUNCE_MS)}async function pushScenes(es,ts){isSupabaseConfigured&&debouncedPush("scenes",async()=>{const ss=ts.map(as=>sceneToDb(as,es)),{error:rs}=await supabase.from("scenes").upsert(ss,{onConflict:"id"});if(rs)throw rs;const ns=ts.map(as=>as.id);ns.length>0&&await supabase.from("scene_characters").delete().in("scene_id",ns);const os=[];for(const as of ts)for(const ls of as.characters)os.push({scene_id:as.id,character_id:ls});if(os.length>0){const{error:as}=await supabase.from("scene_characters").insert(os);if(as)throw as}})}async function pushCharacters(es,ts){isSupabaseConfigured&&debouncedPush("characters",async()=>{const ss=ts.map(ns=>characterToDb(ns,es)),{error:rs}=await supabase.from("characters").upsert(ss,{onConflict:"id"});if(rs)throw rs})}async function pushLooks(es,ts){isSupabaseConfigured&&debouncedPush("looks",async()=>{const ss=ts.map(as=>lookToDb(as,es)),{error:rs}=await supabase.from("looks").upsert(ss,{onConflict:"id"});if(rs)throw rs;const ns=ts.map(as=>as.id);ns.length>0&&await supabase.from("look_scenes").delete().in("look_id",ns);const os=[];for(const as of ts)for(const ls of as.scenes)os.push({look_id:as.id,scene_number:ls});if(os.length>0){const{error:as}=await supabase.from("look_scenes").insert(os);if(as)throw as}})}async function pushSceneCapture(es,ts,ss){isSupabaseConfigured&&debouncedPush(`capture_${ts.id}`,async()=>{const rs=sceneCaptureToDb(ts,es,ss),{error:ns}=await supabase.from("continuity_events").upsert(rs,{onConflict:"id"});if(ns)throw ns;await syncCapturePhotos(es,ts)})}async function syncCapturePhotos(es,ts){const ss=[];for(const[rs,ns]of Object.entries(ts.photos))ns&&ss.push({photo:ns,angle:rs});for(const rs of ts.additionalPhotos)ss.push({photo:rs,angle:"additional"});for(const{photo:rs,angle:ns}of ss){const{data:os}=await supabase.from("photos").select("id").eq("id",rs.id).single();if(os)continue;let as=null;const ls=await getPhotoBlob(rs.id);if(ls){const{result:cs,error:us}=await uploadPhoto(es,ts.characterId,ls.blob);!us&&cs&&(as=cs.path)}else if(rs.uri&&rs.uri.startsWith("data:")){const{result:cs,error:us}=await uploadBase64Photo(es,ts.characterId,rs.uri);!us&&cs&&(as=cs.path)}as&&await supabase.from("photos").insert({id:rs.id,continuity_event_id:ts.id,storage_path:as,photo_type:"on_set",angle:ns,taken_at:rs.capturedAt?new Date(rs.capturedAt).toISOString():new Date().toISOString()})}}async function pushScheduleData(es,ts){isSupabaseConfigured&&debouncedPush("schedule",async()=>{const{error:ss}=await supabase.from("schedule_data").upsert({id:ts.id,project_id:es,raw_pdf_text:ts.rawText||null,cast_list:ts.castList,days:ts.days,status:ts.status==="complete"?"complete":"pending"},{onConflict:"id"});if(ss)throw ss})}function subscribeToProject(es,ts){if(!isSupabaseConfigured)return;activeChannel&&unsubscribeFromProject(),activeProjectId=es;const ss=supabase.channel(`project:${es}`,{config:{broadcast:{self:!1},presence:{key:ts||CLIENT_ID}}});ss.on("postgres_changes",{event:"*",schema:"public",table:"scenes",filter:`project_id=eq.${es}`},rs=>{pushingTables.has("scenes")||handleSceneChange(rs)}),ss.on("postgres_changes",{event:"*",schema:"public",table:"characters",filter:`project_id=eq.${es}`},rs=>{pushingTables.has("characters")||handleCharacterChange(rs)}),ss.on("postgres_changes",{event:"*",schema:"public",table:"looks",filter:`project_id=eq.${es}`},rs=>{pushingTables.has("looks")||handleLookChange(rs)}),ss.on("postgres_changes",{event:"*",schema:"public",table:"continuity_events"},rs=>{const ns=rs.new||rs.old;if(!(ns!=null&&ns.scene_id))return;const os=useProjectStore.getState().currentProject;os!=null&&os.scenes.some(as=>as.id===ns.scene_id)&&(pushingTables.has(`capture_${ns.id}`)||handleContinuityEventChange(rs))}),ss.on("postgres_changes",{event:"*",schema:"public",table:"schedule_data",filter:`project_id=eq.${es}`},rs=>{pushingTables.has("schedule")||handleScheduleChange(rs)}),ss.on("postgres_changes",{event:"*",schema:"public",table:"photos"},rs=>{const ns=rs.new||rs.old;!(ns!=null&&ns.continuity_event_id)||!useProjectStore.getState().sceneCaptures[ns.continuity_event_id]||handlePhotoChange(rs)}),ss.on("presence",{event:"sync"},()=>{const rs=ss.presenceState(),ns=Object.keys(rs).length;useSyncStore.getState().setOnlineMembers(ns)}),ss.subscribe(async rs=>{rs==="SUBSCRIBED"?(useSyncStore.getState().setRealtimeConnected(!0),ts&&await ss.track({user_id:ts,client_id:CLIENT_ID,online_at:new Date().toISOString()})):(rs==="CLOSED"||rs==="CHANNEL_ERROR")&&useSyncStore.getState().setRealtimeConnected(!1)}),activeChannel=ss,useSyncStore.getState().setActiveProject(es)}function unsubscribeFromProject(){activeChannel&&(supabase.removeChannel(activeChannel),activeChannel=null),activeProjectId=null;for(const es of Object.values(pushTimers))clearTimeout(es);pushTimers={},pushingTables.clear(),useSyncStore.getState().setRealtimeConnected(!1),useSyncStore.getState().setActiveProject(null)}function handleSceneChange(es){const ts=useProjectStore.getState(),ss=ts.currentProject;if(ss){if(es.eventType==="INSERT"||es.eventType==="UPDATE"){const rs=es.new,ns=ss.scenes.find(os=>os.id===rs.id);fetchSceneCharacters(rs.id).then(os=>{const as=dbToScene(rs,os,ns),ls=ns?ss.scenes.map(cs=>cs.id===as.id?as:cs):[...ss.scenes,as];ts.setProject({...ss,scenes:ls})})}else if(es.eventType==="DELETE"){const rs=es.old;ts.setProject({...ss,scenes:ss.scenes.filter(ns=>ns.id!==rs.id)})}}}function handleCharacterChange(es){const ts=useProjectStore.getState(),ss=ts.currentProject;if(ss){if(es.eventType==="INSERT"||es.eventType==="UPDATE"){const rs=es.new,ns=ss.characters.find(ls=>ls.id===rs.id),os=dbToCharacter(rs,ns),as=ns?ss.characters.map(ls=>ls.id===os.id?os:ls):[...ss.characters,os];ts.setProject({...ss,characters:as})}else if(es.eventType==="DELETE"){const rs=es.old;ts.setProject({...ss,characters:ss.characters.filter(ns=>ns.id!==rs.id)})}}}function handleLookChange(es){const ts=useProjectStore.getState(),ss=ts.currentProject;if(ss){if(es.eventType==="INSERT"||es.eventType==="UPDATE"){const rs=es.new,ns=ss.looks.find(os=>os.id===rs.id);fetchLookScenes(rs.id).then(os=>{const as=dbToLook(rs,os,ns),ls=ns?ss.looks.map(cs=>cs.id===as.id?as:cs):[...ss.looks,as];ts.setProject({...ss,looks:ls})})}else if(es.eventType==="DELETE"){const rs=es.old;ts.setProject({...ss,looks:ss.looks.filter(ns=>ns.id!==rs.id)})}}}function handleContinuityEventChange(es,ts){const ss=useProjectStore.getState();if(es.eventType==="INSERT"||es.eventType==="UPDATE"){const rs=es.new;fetchCapturePhotos(rs.id).then(async ns=>{const os={},as=[];for(const cs of ns){const us=await downloadAndCachePhoto(cs);us&&(cs.angle!=="additional"&&cs.angle!=="detail"?os[cs.angle]=us:as.push(us))}const ls=dbToSceneCapture(rs,os,as);ss.updateSceneCapture(ls.id,ls)})}}function handleScheduleChange(es,ts){if(es.eventType==="INSERT"||es.eventType==="UPDATE"){const ss=es.new;mergeScheduleData(ss)}}function handlePhotoChange(es,ts){if(es.eventType==="INSERT"){const ss=es.new;downloadAndCachePhoto(ss).then(rs=>{if(!rs)return;const ns=useProjectStore.getState(),os=ns.sceneCaptures;for(const[as,ls]of Object.entries(os))if(as===ss.continuity_event_id){ss.angle!=="additional"&&ss.angle!=="detail"?ns.addPhotoToCapture(as,rs,ss.angle):ns.addPhotoToCapture(as,rs,"additional");break}})}}async function fetchSceneCharacters(es){const{data:ts}=await supabase.from("scene_characters").select("character_id").eq("scene_id",es);return(ts||[]).map(ss=>ss.character_id)}async function fetchLookScenes(es){const{data:ts}=await supabase.from("look_scenes").select("scene_number").eq("look_id",es);return(ts||[]).map(ss=>ss.scene_number)}async function fetchCapturePhotos(es){const{data:ts}=await supabase.from("photos").select("*").eq("continuity_event_id",es);return ts||[]}async function startSync(es,ts){if(!isSupabaseConfigured){useSyncStore.getState().setOffline();return}if(!navigator.onLine){useSyncStore.getState().setOffline(),window.addEventListener("online",()=>{startSync(es,ts)},{once:!0});return}await pullProjectData(es),subscribeToProject(es,ts),window.addEventListener("offline",()=>{useSyncStore.getState().setOffline()}),window.addEventListener("online",()=>{useSyncStore.getState().setStatus("syncing"),pullProjectData(es).then(()=>{subscribeToProject(es,ts)})})}function stopSync(){unsubscribeFromProject(),useSyncStore.getState().reset()}function getActiveProjectId(){return activeProjectId}let initialized=!1;function initSyncSubscriptions(){initialized||(initialized=!0,useProjectStore.subscribe((es,ts)=>{var os;const ss=getActiveProjectId();if(!ss||!es.currentProject)return;const rs=ts.currentProject,ns=es.currentProject;if(!(!rs||!ns)&&(rs.scenes!==ns.scenes&&pushScenes(ss,ns.scenes),rs.characters!==ns.characters&&pushCharacters(ss,ns.characters),rs.looks!==ns.looks&&pushLooks(ss,ns.looks),ts.sceneCaptures!==es.sceneCaptures)){const as=((os=useAuthStore.getState().user)==null?void 0:os.id)||null;for(const[ls,cs]of Object.entries(es.sceneCaptures))ts.sceneCaptures[ls]!==cs&&pushSceneCapture(ss,cs,as)}}),useScheduleStore.subscribe((es,ts)=>{const ss=getActiveProjectId();ss&&es.schedule!==ts.schedule&&es.schedule&&es.schedule.status==="complete"&&pushScheduleData(ss,es.schedule)}))}function r(es){var ts,ss,rs="";if(typeof es=="string"||typeof es=="number")rs+=es;else if(typeof es=="object")if(Array.isArray(es)){var ns=es.length;for(ts=0;ts<ns;ts++)es[ts]&&(ss=r(es[ts]))&&(rs&&(rs+=" "),rs+=ss)}else for(ss in es)es[ss]&&(rs&&(rs+=" "),rs+=ss);return rs}function clsx(){for(var es,ts,ss=0,rs="",ns=arguments.length;ss<ns;ss++)(es=arguments[ss])&&(ts=r(es))&&(rs&&(rs+=" "),rs+=ts);return rs}const MAX_BOTTOM_NAV_ITEMS=5,useNavigationStore=create()(persist((es,ts)=>({bottomNavItems:DEFAULT_BOTTOM_NAV,isEditMenuOpen:!1,setBottomNavItems:ss=>{const rs=ss.slice(0,MAX_BOTTOM_NAV_ITEMS);es({bottomNavItems:rs})},openEditMenu:()=>es({isEditMenuOpen:!0}),closeEditMenu:()=>es({isEditMenuOpen:!1}),moveToBottomNav:(ss,rs)=>{const ns=[...ts().bottomNavItems],os=ns.indexOf(ss);os!==-1?(ns.splice(os,1),ns.splice(rs,0,ss)):ns.length<MAX_BOTTOM_NAV_ITEMS?ns.splice(rs,0,ss):ns[rs]=ss,es({bottomNavItems:ns.slice(0,MAX_BOTTOM_NAV_ITEMS)})},moveToMoreMenu:ss=>{const rs=ts().bottomNavItems.filter(ns=>ns!==ss);rs.length!==0&&es({bottomNavItems:rs})},reorderBottomNav:(ss,rs)=>{const ns=[...ts().bottomNavItems],[os]=ns.splice(ss,1);ns.splice(rs,0,os),es({bottomNavItems:ns})},getMoreMenuItems:()=>{const ss=ts().bottomNavItems;return ALL_NAV_ITEMS.filter(rs=>!ss.includes(rs.id)).map(rs=>rs.id)},resetToDefaults:()=>{es({bottomNavItems:DEFAULT_BOTTOM_NAV})}}),{name:"hair-makeup-navigation",storage:createJSONStorage(()=>localStorage),partialize:es=>({bottomNavItems:es.bottomNavItems})}));function BottomNav({activeTab:es,onTabChange:ts}){const{bottomNavItems:ss}=useNavigationStore(),rs=[...ss.map(ns=>{const os=ALL_NAV_ITEMS.find(as=>as.id===ns);return os?{id:os.id,label:os.label,icon:jsxRuntimeExports.jsx(NavIcon,{name:os.iconName})}:null}).filter(Boolean),{id:"more",label:"More",icon:jsxRuntimeExports.jsx(NavIcon,{name:"ellipsis"})}];return jsxRuntimeExports.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-40 bg-card shadow-nav border-t border-border",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-around bottom-nav-safe",children:rs.map(ns=>{const os=es===ns.id;return jsxRuntimeExports.jsxs("button",{onClick:()=>ts(ns.id),className:clsx("flex flex-col items-center justify-center py-2 px-3 min-w-[56px] tap-target touch-manipulation transition-colors",{"text-gold":os,"text-text-light hover:text-text-muted":!os}),"aria-current":os?"page":void 0,children:[jsxRuntimeExports.jsx("span",{className:"w-6 h-6 mb-1",children:ns.icon}),jsxRuntimeExports.jsx("span",{className:clsx("text-[10px] font-medium",{"font-semibold":os}),children:ns.label})]},ns.id)})})})})}function NavIcon({name:es,className:ts="w-full h-full"}){switch(es){case"calendar":return jsxRuntimeExports.jsx("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})});case"grid":return jsxRuntimeExports.jsx("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 10h18M3 14h18M10 3v18M14 3v18M3 6a3 3 0 013-3h12a3 3 0 013 3v12a3 3 0 01-3 3H6a3 3 0 01-3-3V6z"})});case"book":return jsxRuntimeExports.jsx("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})});case"clock":return jsxRuntimeExports.jsx("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})});case"wallet":return jsxRuntimeExports.jsx("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v3"})});case"document":return jsxRuntimeExports.jsx("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})});case"schedule":return jsxRuntimeExports.jsx("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V15zm0 2.25h.008v.008h-.008v-.008zm2.25-4.5h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z"})});case"clipboard":return jsxRuntimeExports.jsx("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"})});case"cog":return jsxRuntimeExports.jsxs("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});case"ellipsis":return jsxRuntimeExports.jsx("svg",{className:ts,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"})});default:return null}}function Header({title:es,showBack:ts=!1,onBack:ss,showSearch:rs=!1,onSearch:ns,rightContent:os,className:as}){return jsxRuntimeExports.jsx("header",{className:clsx("sticky top-0 z-30 bg-card border-b border-border safe-top",as),children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between h-14 px-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[ts&&jsxRuntimeExports.jsx("button",{onClick:ss,className:"flex items-center gap-1 text-gold tap-target touch-manipulation -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary truncate",children:es})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[os,rs&&jsxRuntimeExports.jsx("button",{onClick:ns,className:"p-2 text-text-muted hover:text-text-primary tap-target touch-manipulation","aria-label":"Search",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]})})})}function SyncStatusBanner(){const{status:es,onlineMembers:ts,lastSyncedAt:ss}=useSyncStore(),rs={idle:{color:"bg-gray-400",label:"Not connected"},syncing:{color:"bg-warning animate-pulse",label:"Syncing..."},synced:{color:"bg-success",label:"Synced"},error:{color:"bg-destructive",label:"Sync error"},offline:{color:"bg-gray-400",label:"Working offline"}},{color:ns,label:os}=rs[es],as=ss?getTimeAgo(ss):null;return jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-[10px] px-4 py-3 mb-4 flex items-center justify-between shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2.5",children:[jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${ns}`}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-secondary",children:os}),as&&es==="synced"&&jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:as})]}),ts>1&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("div",{className:"flex -space-x-1",children:Array.from({length:Math.min(ts,3)}).map((ls,cs)=>jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-gold/20 border border-card flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px] text-gold font-medium",children:cs+1})},cs))}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[ts," online"]})]})]})}function SyncDot(){const{status:es}=useSyncStore(),ts={idle:"bg-gray-400",syncing:"bg-warning animate-pulse",synced:"bg-success",error:"bg-destructive",offline:"bg-gray-400"};return jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${ts[es]}`})}function getTimeAgo(es){const ts=Math.floor((Date.now()-es.getTime())/1e3);if(ts<10)return"just now";if(ts<60)return`${ts}s ago`;const ss=Math.floor(ts/60);return ss<60?`${ss}m ago`:`${Math.floor(ss/60)}h ago`}function ProjectHeader({onSwitchProject:es,onNavigateToProfile:ts}){const{currentProject:ss}=useProjectStore(),{user:rs}=useAuthStore();if(!ss)return null;const ns=()=>{if(!(rs!=null&&rs.name))return"U";const os=rs.name.split(" ");return os.length>=2?`${os[0][0]}${os[1][0]}`.toUpperCase():rs.name.substring(0,2).toUpperCase()};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-12 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("button",{onClick:es,className:"flex items-center gap-2 min-w-0 active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsx("div",{className:"w-7 h-7 rounded-lg gold-gradient flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary truncate max-w-[200px]",children:ss.name}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-muted flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(SyncDot,{}),jsxRuntimeExports.jsx("button",{onClick:ts,className:"w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center text-gold text-xs font-bold active:scale-95 transition-transform",children:ns()})]})]})})})})}const Button=reactExports.forwardRef(({className:es,variant:ts="primary",size:ss="md",fullWidth:rs=!1,children:ns,disabled:os,...as},ls)=>jsxRuntimeExports.jsx("button",{ref:ls,className:clsx("inline-flex items-center justify-center font-semibold transition-all duration-200 touch-manipulation tap-target","focus:outline-none focus:ring-2 focus:ring-gold/50 focus:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",{"btn-gold text-white active:scale-[0.98]":ts==="primary","bg-input-bg text-text-primary border border-border hover:bg-gray-100 dark:hover:bg-gray-800 active:scale-[0.98]":ts==="secondary","btn-outline-gold active:scale-[0.98]":ts==="outline","text-gold hover:bg-gold/10 active:scale-[0.98]":ts==="ghost","bg-red-500 text-white hover:bg-red-600 active:scale-[0.98]":ts==="danger","px-3 py-1.5 text-sm rounded-lg":ss==="sm","px-4 py-2.5 text-base rounded-lg":ss==="md","px-6 py-3.5 text-lg rounded-lg":ss==="lg","w-full":rs},es),disabled:os,...as,children:ns}));Button.displayName="Button";const Input=reactExports.forwardRef(({className:es,label:ts,error:ss,helperText:rs,id:ns,...os},as)=>{const ls=ns||(ts==null?void 0:ts.toLowerCase().replace(/\s+/g,"-"));return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[ts&&jsxRuntimeExports.jsx("label",{htmlFor:ls,className:"field-label block mb-1.5",children:ts}),jsxRuntimeExports.jsx("input",{ref:as,id:ls,className:clsx("input-field w-full",{"border-error focus:border-error focus:ring-error/30":ss},es),...os}),ss&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-error",children:ss}),rs&&!ss&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-text-muted",children:rs})]})});Input.displayName="Input";const Textarea=reactExports.forwardRef(({className:es,label:ts,error:ss,helperText:rs,id:ns,rows:os=3,...as},ls)=>{const cs=ns||(ts==null?void 0:ts.toLowerCase().replace(/\s+/g,"-"));return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[ts&&jsxRuntimeExports.jsx("label",{htmlFor:cs,className:"field-label block mb-1.5",children:ts}),jsxRuntimeExports.jsx("textarea",{ref:ls,id:cs,rows:os,className:clsx("input-field w-full resize-none",{"border-error focus:border-error focus:ring-error/30":ss},es),...as}),ss&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-error",children:ss}),rs&&!ss&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-text-muted",children:rs})]})});Textarea.displayName="Textarea";const Card=reactExports.forwardRef(({className:es,variant:ts="default",padding:ss="md",children:rs,...ns},os)=>jsxRuntimeExports.jsx("div",{ref:os,className:clsx("rounded-card",{"bg-card shadow-card":ts==="default","bg-card":ts==="flat","bg-card border border-border":ts==="bordered","p-0":ss==="none","p-3":ss==="sm","p-card-padding":ss==="md","p-6":ss==="lg"},es),...ns,children:rs}));Card.displayName="Card";const CardHeader=reactExports.forwardRef(({className:es,children:ts,...ss},rs)=>jsxRuntimeExports.jsx("div",{ref:rs,className:clsx("flex items-center justify-between mb-3",es),...ss,children:ts}));CardHeader.displayName="CardHeader";const CardTitle=reactExports.forwardRef(({className:es,children:ts,...ss},rs)=>jsxRuntimeExports.jsx("h3",{ref:rs,className:clsx("section-header",es),...ss,children:ts}));CardTitle.displayName="CardTitle";const CardContent=reactExports.forwardRef(({className:es,children:ts,...ss},rs)=>jsxRuntimeExports.jsx("div",{ref:rs,className:clsx(es),...ss,children:ts}));CardContent.displayName="CardContent";const Badge=reactExports.forwardRef(({className:es,variant:ts="default",size:ss="sm",children:rs,...ns},os)=>jsxRuntimeExports.jsx("span",{ref:os,className:clsx("inline-flex items-center justify-center font-semibold uppercase tracking-wide",{"bg-gray-100 text-text-muted":ts==="default","bg-gold text-white":ts==="gold","bg-blue-100 text-blue-700":ts==="int","bg-gold-100 text-gold-700":ts==="ext","bg-green-100 text-green-700":ts==="success","bg-orange-100 text-orange-700":ts==="warning","bg-red-100 text-red-700":ts==="error","bg-transparent border border-current":ts==="outline","px-1.5 py-0.5 text-[9px] rounded":ss==="sm","px-2.5 py-1 text-[10px] rounded-md":ss==="md"},es),...ns,children:rs}));Badge.displayName="Badge";const CountBadge=reactExports.forwardRef(({className:es,count:ts,label:ss="fields",...rs},ns)=>jsxRuntimeExports.jsxs("span",{ref:ns,className:clsx("inline-flex items-center justify-center px-2.5 py-0.5 text-[10px] font-semibold rounded-xl","bg-gold-100/60 text-gold",es),...rs,children:[ts," ",ss]}));CountBadge.displayName="CountBadge";const TogglePill=reactExports.forwardRef(({className:es,isActive:ts,label:ss,onClick:rs,...ns},os)=>jsxRuntimeExports.jsx("button",{ref:os,type:"button",role:"switch","aria-checked":ts,onClick:rs,className:clsx("px-3 py-1.5 text-xs font-medium rounded-pill border transition-all duration-200 touch-manipulation","focus:outline-none focus:ring-2 focus:ring-gold/50",{"bg-gold-50 text-gold border-gold":ts,"bg-gray-100 text-text-muted border-gray-200 hover:bg-gray-200":!ts},es),...ns,children:ss}));TogglePill.displayName="TogglePill";const Switch=reactExports.forwardRef(({className:es,isOn:ts,label:ss,onToggle:rs,...ns},os)=>jsxRuntimeExports.jsxs("button",{ref:os,type:"button",role:"switch","aria-checked":ts,onClick:rs,className:clsx("relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2",{"bg-gold":ts,"bg-gray-200":!ts},es),...ns,children:[ss&&jsxRuntimeExports.jsx("span",{className:"sr-only",children:ss}),jsxRuntimeExports.jsx("span",{"aria-hidden":"true",className:clsx("pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",{"translate-x-5":ts,"translate-x-0":!ts})})]}));Switch.displayName="Switch";function Accordion({title:es,count:ts,badge:ss,defaultOpen:rs=!1,children:ns,className:os}){const[as,ls]=reactExports.useState(rs);return jsxRuntimeExports.jsxs("div",{className:clsx("bg-card rounded-card shadow-card overflow-hidden",os),children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>ls(!as),className:"w-full flex items-center justify-between px-[18px] py-4 text-left touch-manipulation","aria-expanded":as,children:[jsxRuntimeExports.jsx("span",{className:"section-header",children:es}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2.5",children:[ss&&jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:ss}),ts!==void 0&&ts>0&&jsxRuntimeExports.jsx(CountBadge,{count:ts}),jsxRuntimeExports.jsx(ChevronIcon,{isOpen:as})]})]}),jsxRuntimeExports.jsx("div",{className:clsx("overflow-hidden transition-all duration-300 ease-in-out",{"max-h-0 opacity-0":!as,"max-h-[2000px] opacity-100":as}),children:jsxRuntimeExports.jsx("div",{className:"px-[18px] pb-[18px]",children:ns})})]})}function ChevronIcon({isOpen:es}){return jsxRuntimeExports.jsx("svg",{className:clsx("w-5 h-5 text-text-muted transition-transform duration-200",{"rotate-180":es}),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}function Modal({isOpen:es,onClose:ts,title:ss,children:rs,className:ns,showCloseButton:os=!0}){const as=reactExports.useRef(null);reactExports.useEffect(()=>{const cs=us=>{us.key==="Escape"&&es&&ts()};return document.addEventListener("keydown",cs),()=>document.removeEventListener("keydown",cs)},[es,ts]),reactExports.useEffect(()=>(es?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[es]);const ls=cs=>{cs.target===as.current&&ts()};return es?jsxRuntimeExports.jsx("div",{ref:as,onClick:ls,className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm animate-fadeIn",children:jsxRuntimeExports.jsxs("div",{className:clsx("w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp","max-h-[90vh] overflow-hidden flex flex-col",ns),children:[(ss||os)&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[ss&&jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:ss}),os&&jsxRuntimeExports.jsx("button",{onClick:ts,className:"p-2 -m-2 text-text-muted hover:text-text-primary transition-colors tap-target","aria-label":"Close modal",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:rs})]})}):null}function BottomSheet({isOpen:es,onClose:ts,title:ss,children:rs,className:ns,showCloseButton:os=!0,height:as="auto"}){return jsxRuntimeExports.jsx(Modal,{isOpen:es,onClose:ts,title:ss,showCloseButton:os,className:clsx({"max-h-[50vh]":as==="half","h-[90vh]":as==="full"},ns),children:rs})}function FormField({label:es,value:ts,onChange:ss,readOnly:rs=!1,placeholder:ns,multiline:os=!1,rows:as=2}){if(rs)return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:es}),jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:ts||jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})})]});const ls="w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] placeholder:text-[#999] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors";return os?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:es}),jsxRuntimeExports.jsx("textarea",{value:ts,onChange:cs=>ss(cs.target.value),placeholder:ns,rows:as,className:`${ls} resize-none`})]}):jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:es}),jsxRuntimeExports.jsx("input",{type:"text",value:ts,onChange:cs=>ss(cs.target.value),placeholder:ns,className:ls})]})}function getCaptureStatus(es){return!es||!(es.photos.front||es.photos.left||es.photos.right||es.photos.back||es.additionalPhotos.length>0)?"not-started":es.photos.front?"complete":"in-progress"}function formatSceneRange(es){if(es.length===0)return"";if(es.length===1)return es[0];const ts=[...es].sort((ls,cs)=>ls.localeCompare(cs,void 0,{numeric:!0})),ss=[];let rs=ts[0],ns=ts[0],os=parseInt(rs,10),as=os;for(let ls=1;ls<ts.length;ls++){const cs=ts[ls],us=parseInt(cs,10);!isNaN(as)&&!isNaN(us)&&cs===String(us)&&ns===String(as)&&us===as+1?(ns=cs,as=us):(ss.push(rs===ns?rs:`${rs}-${ns}`),rs=cs,ns=cs,os=us,as=us)}return ss.push(rs===ns?rs:`${rs}-${ns}`),ss.join(", ")}function formatEstimatedTime(es){if(es<60)return`~${es} min`;const ts=Math.floor(es/60),ss=es%60;return ss===0?`~${ts}h`:`~${ts}h ${ss}m`}function formatShortDate(es){const ts=typeof es=="string"?new Date(es):es,ss=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],rs=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${ss[ts.getDay()]} ${ts.getDate()} ${rs[ts.getMonth()]}`}const MAX_IMAGE_DIMENSION=1920,IMAGE_QUALITY=.8,THUMBNAIL_SIZE=200,THUMBNAIL_QUALITY=.6,SUPPORTED_IMAGE_TYPES=new Set(["image/jpeg","image/png","image/gif","image/webp"]);function isSupportedImageType(es){return SUPPORTED_IMAGE_TYPES.has(es.toLowerCase())}async function ensureSupportedImageFormat(es){const ts=es.match(/^data:([^;]+);base64,/);if(!ts)return es;const ss=ts[1].toLowerCase();if(isSupportedImageType(ss))return es;const rs=base64ToBlob(es),ns=await compressImage(rs,MAX_IMAGE_DIMENSION,IMAGE_QUALITY);return blobToBase64(ns)}async function compressImage(es,ts=MAX_IMAGE_DIMENSION,ss=IMAGE_QUALITY){return new Promise((rs,ns)=>{const os=new Image,as=URL.createObjectURL(es);os.onload=()=>{URL.revokeObjectURL(as);let{width:ls,height:cs}=os;(ls>ts||cs>ts)&&(ls>cs?(cs=Math.round(cs*ts/ls),ls=ts):(ls=Math.round(ls*ts/cs),cs=ts));const us=document.createElement("canvas");us.width=ls,us.height=cs;const ds=us.getContext("2d");if(!ds){ns(new Error("Failed to get canvas context"));return}ds.drawImage(os,0,0,ls,cs),us.toBlob(ms=>{ms?rs(ms):ns(new Error("Failed to compress image"))},"image/jpeg",ss)},os.onerror=()=>{URL.revokeObjectURL(as),ns(new Error("Failed to load image"))},os.src=as})}async function generateThumbnail(es){const ts=await compressImage(es,THUMBNAIL_SIZE,THUMBNAIL_QUALITY);return blobToBase64(ts)}function blobToBase64(es){return new Promise((ts,ss)=>{const rs=new FileReader;rs.onloadend=()=>{const ns=rs.result;ts(ns)},rs.onerror=ss,rs.readAsDataURL(es)})}function base64ToBlob(es){const[ts,ss]=es.split(","),rs=ts.match(/:(.*?);/),ns=rs?rs[1]:"image/jpeg",os=atob(ss),as=new ArrayBuffer(os.length),ls=new Uint8Array(as);for(let cs=0;cs<os.length;cs++)ls[cs]=os.charCodeAt(cs);return new Blob([ls],{type:ns})}async function createPhotoFromBlob(es,ts){const ss=await compressImage(es),rs=await blobToBase64(ss),ns=await generateThumbnail(es);return{id:v4(),uri:rs,thumbnail:ns,capturedAt:new Date,angle:ts}}function CharacterAvatar({character:es,size:ts="md",className:ss}){const rs=es.avatarColour??"#C9A962";return jsxRuntimeExports.jsx("div",{className:clsx("rounded-full flex items-center justify-center font-bold text-white flex-shrink-0",{"w-5 h-5 text-[8px]":ts==="xs","w-8 h-8 text-xs":ts==="sm","w-10 h-10 text-sm":ts==="md","w-14 h-14 text-lg":ts==="lg","w-20 h-20 text-2xl":ts==="xl"},ss),style:{background:`linear-gradient(135deg, ${rs} 0%, ${adjustColor$1(rs,-20)} 100%)`},children:es.initials})}function adjustColor$1(es,ts){const ss=parseInt(es.replace("#",""),16),rs=Math.max(0,Math.min(255,(ss>>16)+ts)),ns=Math.max(0,Math.min(255,(ss>>8&255)+ts)),os=Math.max(0,Math.min(255,(ss&255)+ts));return`#${((1<<24)+(rs<<16)+(ns<<8)+os).toString(16).slice(1)}`}const angleLabels$1={front:"Front",left:"Left",right:"Right",back:"Back",additional:""};function PhotoSlot({photo:es,angle:ts,onCapture:ss,onView:rs,size:ns="md",showLabel:os=!0,isPrimary:as=!1}){const ls=!!es,cs=angleLabels$1[ts],us=()=>{ls&&rs?rs():ss()};return jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsx("button",{type:"button",onClick:us,className:clsx("relative rounded-[10px] overflow-hidden touch-manipulation transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2",{"w-full aspect-square":ns==="sm","w-full aspect-[4/3]":ns==="md","w-full aspect-[16/9]":ns==="lg","w-full aspect-[3/4]":ns==="portrait","border-2 border-dashed":!ls,"border-gold":!ls&&as,"border-gray-300":!ls&&!as,"border-2 border-solid border-gold":ls}),children:ls?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("img",{src:es.thumbnail||es.uri,alt:`${cs} view`,className:"w-full h-full object-cover"}),os&&cs&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent px-2 py-1.5",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-medium text-white uppercase tracking-wide",children:cs})})]}):jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-50",children:[jsxRuntimeExports.jsx(CameraIcon$1,{className:clsx("text-gray-400",{"w-5 h-5":ns==="sm"||ns==="portrait","w-6 h-6":ns==="md","w-8 h-8":ns==="lg"})}),os&&cs&&jsxRuntimeExports.jsx("span",{className:clsx("font-bold uppercase tracking-widest text-gray-400 mt-2",{"text-[9px]":ns==="sm"||ns==="portrait","text-[10px]":ns==="md","text-xs":ns==="lg"}),children:cs})]})})})}function SceneThumbnailSlot({sceneNumber:es,hasCaptured:ts,isActive:ss,onClick:rs,thumbnailUrl:ns}){return jsxRuntimeExports.jsxs("button",{type:"button",onClick:rs,className:clsx("flex flex-col items-center gap-1.5 touch-manipulation","focus:outline-none"),children:[jsxRuntimeExports.jsx("div",{className:clsx("w-[70px] h-[70px] rounded-lg flex items-center justify-center transition-all overflow-hidden",{"border-2 border-solid border-gold":ts,"border-2 border-dashed border-gray-300 bg-gray-50":!ts,"ring-2 ring-gold ring-offset-2":ss}),children:ts&&ns?jsxRuntimeExports.jsx("img",{src:ns,alt:`Scene ${es}`,className:"w-full h-full object-cover"}):ts?jsxRuntimeExports.jsx(CheckIcon$1,{className:"w-6 h-6 text-gold"}):jsxRuntimeExports.jsx(CameraIcon$1,{className:"w-5 h-5 text-gray-400"})}),jsxRuntimeExports.jsx("span",{className:clsx("text-xs font-medium",{"text-gold":ss,"text-text-secondary":!ss}),children:es})]})}function CameraIcon$1({className:es}){return jsxRuntimeExports.jsxs("svg",{className:es,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}function CheckIcon$1({className:es}){return jsxRuntimeExports.jsx("svg",{className:es,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}function PhotoGrid({photos:es,onCapture:ts,onView:ss,className:rs}){const ns=[{angle:"front",photo:es.front},{angle:"left",photo:es.left},{angle:"right",photo:es.right},{angle:"back",photo:es.back}];return jsxRuntimeExports.jsx("div",{className:clsx("grid grid-cols-4 gap-2.5",rs),children:ns.map(({angle:os,photo:as})=>jsxRuntimeExports.jsx(PhotoSlot,{photo:as,angle:os,onCapture:()=>ts(os),onView:as&&ss?()=>ss(as,os):void 0,size:"portrait",showLabel:!0,isPrimary:os==="front"},os))})}function AdditionalPhotosGrid({photos:es,onCapture:ts,onView:ss,maxVisible:rs=8,className:ns}){const os=es.slice(0,rs),as=es.length-rs,ls=Math.max(0,4-(os.length%4||4)),cs=os.length<rs;return jsxRuntimeExports.jsxs("div",{className:clsx("grid grid-cols-4 gap-2",ns),children:[os.map((us,ds)=>jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ss==null?void 0:ss(us,ds),className:"w-full aspect-square rounded-lg overflow-hidden border-2 border-gold touch-manipulation focus:outline-none focus:ring-2 focus:ring-gold",children:jsxRuntimeExports.jsx("img",{src:us.thumbnail||us.uri,alt:`Additional photo ${ds+1}`,className:"w-full h-full object-cover"})}),ds===rs-1&&as>0&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/60 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsxs("span",{className:"text-white font-semibold text-lg",children:["+",as]})})]},us.id)),cs&&Array.from({length:Math.min(ls+1,rs-os.length)}).map((us,ds)=>jsxRuntimeExports.jsx("button",{type:"button",onClick:ts,className:clsx("w-full aspect-square rounded-lg flex items-center justify-center touch-manipulation","focus:outline-none focus:ring-2 focus:ring-gold",{"border-2 border-dashed border-gold bg-gold-50/50":ds===0,"border-2 border-dashed border-gray-300 bg-gray-50":ds>0}),children:jsxRuntimeExports.jsx("svg",{className:clsx("w-5 h-5",{"text-gold":ds===0,"text-gray-400":ds>0}),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})},`empty-${ds}`))]})}function useCamera(es={}){const{facingMode:ts="environment",onCapture:ss,onError:rs}=es,ns=reactExports.useRef(null),os=reactExports.useRef(null),as=reactExports.useRef(null),[ls,cs]=reactExports.useState(!1),[us,ds]=reactExports.useState(!1),[ms,ps]=reactExports.useState(null),[hs,xs]=reactExports.useState(ts);reactExports.useEffect(()=>(as.current=document.createElement("canvas"),()=>{as.current=null}),[]);const ys=reactExports.useCallback(()=>{os.current&&(os.current.getTracks().forEach(js=>js.stop()),os.current=null),ns.current&&(ns.current.srcObject=null),cs(!1)},[]);reactExports.useEffect(()=>()=>{os.current&&(os.current.getTracks().forEach(js=>js.stop()),os.current=null),ns.current&&(ns.current.srcObject=null)},[]);const vs=reactExports.useCallback(async()=>{try{if(ps(null),cs(!1),ys(),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported on this device");const js={video:{facingMode:{ideal:hs},width:{ideal:1920},height:{ideal:1080}},audio:!1},Ss=await navigator.mediaDevices.getUserMedia(js);os.current=Ss,ns.current&&(ns.current.srcObject=Ss,await ns.current.play(),cs(!0))}catch(js){const Ss=js instanceof Error?js.message:"Failed to access camera";ps(Ss),rs==null||rs(js instanceof Error?js:new Error(Ss))}},[hs,ys,rs]),gs=reactExports.useCallback(async()=>{const js=hs==="user"?"environment":"user";if(xs(js),os.current){ys(),await new Promise(Ss=>setTimeout(Ss,100));try{const Ss={video:{facingMode:{ideal:js},width:{ideal:1920},height:{ideal:1080}},audio:!1},bs=await navigator.mediaDevices.getUserMedia(Ss);os.current=bs,ns.current&&(ns.current.srcObject=bs,await ns.current.play(),cs(!0))}catch(Ss){const bs=Ss instanceof Error?Ss.message:"Failed to switch camera";ps(bs),rs==null||rs(Ss instanceof Error?Ss:new Error(bs))}}},[hs,ys,rs]),fs=reactExports.useCallback(async()=>{if(!ns.current||!as.current||!ls)return null;try{ds(!0);const js=ns.current,Ss=as.current;Ss.width=js.videoWidth,Ss.height=js.videoHeight;const bs=Ss.getContext("2d");if(!bs)throw new Error("Failed to get canvas context");hs==="user"&&(bs.translate(Ss.width,0),bs.scale(-1,1)),bs.drawImage(js,0,0);const Es=await new Promise((Rs,ws)=>{Ss.toBlob(Ns=>{Ns?Rs(Ns):ws(new Error("Failed to capture photo"))},"image/jpeg",.9)});return ss==null||ss(Es),Es}catch(js){const Ss=js instanceof Error?js.message:"Failed to capture photo";return ps(Ss),rs==null||rs(js instanceof Error?js:new Error(Ss)),null}finally{ds(!1)}},[ls,hs,ss,rs]);return{videoRef:ns,isReady:ls,isCapturing:us,error:ms,facingMode:hs,startCamera:vs,stopCamera:ys,capturePhoto:fs,switchCamera:gs}}const angleLabels={front:"Front View",left:"Left View",right:"Right View",back:"Back View",additional:"Additional"};function PhotoCapture({isOpen:es,onClose:ts,onCapture:ss,angle:rs="additional",characterName:ns,sceneNumber:os,lookName:as}){const[ls,cs]=reactExports.useState(null),[us,ds]=reactExports.useState(null),[ms,ps]=reactExports.useState("choose"),hs=reactExports.useRef(null),{videoRef:xs,isReady:ys,isCapturing:vs,error:gs,facingMode:fs,startCamera:js,stopCamera:Ss,capturePhoto:bs,switchCamera:Es}=useCamera({facingMode:"environment",onError:Os=>console.error("Camera error:",Os)});reactExports.useEffect(()=>{es?(ps("choose"),cs(null),ds(null)):(Ss(),cs(null),ds(null))},[es,Ss]),reactExports.useEffect(()=>{ms==="camera"?js():Ss()},[ms,js,Ss]),reactExports.useEffect(()=>()=>{us&&URL.revokeObjectURL(us)},[us]);const Rs=async()=>{const Os=await bs();if(Os){const zs=URL.createObjectURL(Os);cs(Os),ds(zs),ps("preview")}},ws=()=>{us&&URL.revokeObjectURL(us),cs(null),ds(null),ps("choose")},Ns=()=>{ls&&(ss(ls),ts())},ks=Os=>{var qs;const zs=(qs=Os.target.files)==null?void 0:qs[0];if(zs){const Qs=zs,Ys=URL.createObjectURL(Qs);cs(Qs),ds(Ys),ps("preview")}hs.current&&(hs.current.value="")},_s=()=>{var Os;(Os=hs.current)==null||Os.click()},Ls=()=>{ps("camera")};return es?ms==="choose"?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-background flex flex-col",children:[jsxRuntimeExports.jsx("input",{ref:hs,type:"file",accept:"image/*",capture:void 0,onChange:ks,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3 safe-top",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:ts,className:"text-white tap-target touch-manipulation","aria-label":"Close",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[ns&&jsxRuntimeExports.jsx("div",{className:"text-white font-semibold text-sm",children:ns}),jsxRuntimeExports.jsxs("div",{className:"text-white/80 text-xs",children:[os&&`Scene ${os}`,as&&`  ${as}`]})]}),jsxRuntimeExports.jsx("div",{className:"w-6"})]})}),jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border px-4 py-3 text-center",children:jsxRuntimeExports.jsx("span",{className:"text-text-primary text-sm font-medium",children:angleLabels[rs]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 rounded-full bg-gold/10 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsxs("svg",{className:"w-12 h-12 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Add Photo"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary text-center text-sm mb-8",children:"Take a new photo or choose one from your library"}),jsxRuntimeExports.jsxs(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:Ls,className:"max-w-xs",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"13",r:"4"})]}),"Take Photo"]}),jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"lg",fullWidth:!0,onClick:_s,className:"max-w-xs",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]}),"Choose from Library"]})]})]}):ms==="preview"&&us?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3 safe-top",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:ws,className:"text-white tap-target touch-manipulation","aria-label":"Back",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[ns&&jsxRuntimeExports.jsx("div",{className:"text-white font-semibold text-sm",children:ns}),jsxRuntimeExports.jsx("div",{className:"text-white/80 text-xs",children:angleLabels[rs]})]}),jsxRuntimeExports.jsx("div",{className:"w-6"})]})}),jsxRuntimeExports.jsx("div",{className:"flex-1 relative overflow-hidden bg-black",children:jsxRuntimeExports.jsx("img",{src:us,alt:"Captured preview",className:"w-full h-full object-contain"})}),jsxRuntimeExports.jsx("div",{className:"bg-black px-4 py-6 safe-bottom",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-6",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"lg",onClick:ws,className:"flex-1 max-w-[140px]",children:"Change"}),jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",onClick:Ns,className:"flex-1 max-w-[140px]",children:"Use Photo"})]})})]}):jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[jsxRuntimeExports.jsx("input",{ref:hs,type:"file",accept:"image/*",onChange:ks,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3 safe-top",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ps("choose"),className:"text-white tap-target touch-manipulation","aria-label":"Back",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[ns&&jsxRuntimeExports.jsx("div",{className:"text-white font-semibold text-sm",children:ns}),jsxRuntimeExports.jsxs("div",{className:"text-white/80 text-xs",children:[os&&`Scene ${os}`,as&&`  ${as}`]})]}),jsxRuntimeExports.jsx("div",{className:"w-6"})]})}),jsxRuntimeExports.jsx("div",{className:"bg-black/50 px-4 py-2 text-center",children:jsxRuntimeExports.jsx("span",{className:"text-white/90 text-sm font-medium",children:angleLabels[rs]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[jsxRuntimeExports.jsx("video",{ref:xs,autoPlay:!0,playsInline:!0,muted:!0,className:clsx("w-full h-full object-cover",{"scale-x-[-1]":fs==="user"})}),!ys&&!gs&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:jsxRuntimeExports.jsxs("div",{className:"text-white text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),jsxRuntimeExports.jsx("div",{className:"text-sm",children:"Starting camera..."})]})}),gs&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:jsxRuntimeExports.jsxs("div",{className:"text-white text-center px-8",children:[jsxRuntimeExports.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),jsxRuntimeExports.jsx("div",{className:"text-sm mb-4",children:gs.includes("permission")||gs.includes("Permission")?"Camera access denied. Please allow camera access in your browser settings.":gs}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"primary",size:"sm",onClick:js,children:"Try Again"}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:_s,children:"Choose from Library Instead"})]})]})})]}),jsxRuntimeExports.jsx("div",{className:"bg-black px-4 py-6 safe-bottom",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-8",children:[jsxRuntimeExports.jsx("button",{onClick:_s,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center tap-target touch-manipulation","aria-label":"Choose from library",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),jsxRuntimeExports.jsx("button",{onClick:Rs,disabled:!ys||vs,className:clsx("w-20 h-20 rounded-full border-4 border-white flex items-center justify-center tap-target touch-manipulation","transition-transform active:scale-95",{"opacity-50":!ys||vs}),"aria-label":"Take photo",children:jsxRuntimeExports.jsx("div",{className:clsx("w-16 h-16 rounded-full bg-white",{"animate-pulse":vs})})}),jsxRuntimeExports.jsx("button",{onClick:Es,disabled:!ys,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center tap-target touch-manipulation disabled:opacity-50","aria-label":"Switch camera",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})})]}):null}function MasterReference({photo:es,onCapture:ts,onView:ss,onRemove:rs,className:ns}){const os=!!es,as=()=>{os&&ss?ss():ts()};return jsxRuntimeExports.jsxs("div",{className:clsx("relative",ns),children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:as,className:clsx("w-full aspect-[16/9] rounded-lg overflow-hidden touch-manipulation transition-all","focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2",{"border-2 border-dashed border-gray-300 bg-gray-50":!os,"border-2 border-solid border-gold":os}),children:os?jsxRuntimeExports.jsx("img",{src:es.uri,alt:"Master reference",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx(CameraIcon,{className:"w-8 h-8 text-gray-400 mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500",children:"Tap to set master reference"})]})}),os&&rs&&jsxRuntimeExports.jsx("button",{type:"button",onClick:ls=>{ls.stopPropagation(),rs()},className:"absolute top-2 right-2 w-8 h-8 bg-black/50 text-white rounded-full flex items-center justify-center tap-target touch-manipulation hover:bg-black/70","aria-label":"Remove master reference",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),os&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent px-3 py-2",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-white uppercase tracking-wide",children:"Master Reference"})})]})}function CameraIcon({className:es}){return jsxRuntimeExports.jsxs("svg",{className:es,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}function PhotoViewer({isOpen:es,photos:ts,initialIndex:ss=0,onClose:rs,onDelete:ns}){const[os,as]=reactExports.useState(ss),[ls,cs]=reactExports.useState(!0),[us,ds]=reactExports.useState(!1),ms=reactExports.useRef(null),ps=reactExports.useRef(null),hs=reactExports.useRef(null);reactExports.useEffect(()=>{es&&(as(Math.min(ss,ts.length-1)),cs(!0))},[es,ss,ts.length]),reactExports.useEffect(()=>{if(!es)return;const Es=Rs=>{Rs.key==="ArrowLeft"?xs():Rs.key==="ArrowRight"?ys():Rs.key==="Escape"&&rs()};return window.addEventListener("keydown",Es),()=>window.removeEventListener("keydown",Es)},[es,os,ts.length]);const xs=reactExports.useCallback(()=>{os>0&&as(os-1)},[os]),ys=reactExports.useCallback(()=>{os<ts.length-1&&as(os+1)},[os,ts.length]),vs=Es=>{ms.current=Es.touches[0].clientX},gs=Es=>{ps.current=Es.touches[0].clientX},fs=()=>{if(ms.current===null||ps.current===null)return;const Es=ms.current-ps.current;Math.abs(Es)>50&&(Es>0?ys():xs()),ms.current=null,ps.current=null},js=async()=>{if(!ns||us)return;const Es=ts[os];ds(!0);try{ns(Es.id),os>=ts.length-1&&os>0&&as(os-1),ts.length<=1&&rs()}finally{ds(!1)}},Ss=()=>{cs(!ls)};if(!es||ts.length===0)return null;const bs=ts[os];return bs?jsxRuntimeExports.jsxs("div",{ref:hs,className:"fixed inset-0 z-50 bg-black",onTouchStart:vs,onTouchMove:gs,onTouchEnd:fs,children:[jsxRuntimeExports.jsx("div",{className:clsx("absolute top-0 left-0 right-0 z-10 transition-opacity duration-200","bg-gradient-to-b from-black/60 to-transparent","safe-top",{"opacity-100":ls,"opacity-0 pointer-events-none":!ls}),children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 pt-[calc(env(safe-area-inset-top)+12px)]",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:rs,className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation","aria-label":"Close",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsxs("span",{className:"text-white text-sm font-medium px-3 py-1 rounded-full bg-black/30 backdrop-blur-sm",children:[os+1," / ",ts.length]}),ns&&jsxRuntimeExports.jsx("button",{type:"button",onClick:js,disabled:us,className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation disabled:opacity-50","aria-label":"Delete photo",children:us?jsxRuntimeExports.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",onClick:Ss,children:jsxRuntimeExports.jsx("img",{src:bs.uri,alt:`Photo ${os+1}`,className:"max-w-full max-h-full object-contain",draggable:!1})}),ts.length>1&&ls&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[os>0&&jsxRuntimeExports.jsx("button",{type:"button",onClick:Es=>{Es.stopPropagation(),xs()},className:"absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation hidden sm:flex","aria-label":"Previous photo",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),os<ts.length-1&&jsxRuntimeExports.jsx("button",{type:"button",onClick:Es=>{Es.stopPropagation(),ys()},className:"absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation hidden sm:flex","aria-label":"Next photo",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),ts.length>1&&ls&&jsxRuntimeExports.jsx("div",{className:clsx("absolute bottom-0 left-0 right-0 z-10","bg-gradient-to-t from-black/60 to-transparent","safe-bottom"),children:jsxRuntimeExports.jsx("div",{className:"flex justify-center gap-1.5 pb-[calc(env(safe-area-inset-bottom)+16px)] pt-6",children:ts.map((Es,Rs)=>jsxRuntimeExports.jsx("button",{type:"button",onClick:ws=>{ws.stopPropagation(),as(Rs)},className:clsx("w-2 h-2 rounded-full transition-all touch-manipulation",{"bg-white w-6":Rs===os,"bg-white/50":Rs!==os}),"aria-label":`Go to photo ${Rs+1}`},Rs))})}),ts.length>1&&ls&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-24 left-0 right-0 flex justify-center pointer-events-none sm:hidden",children:jsxRuntimeExports.jsx("span",{className:"text-white/60 text-xs",children:"Swipe to navigate"})})]}):null}const flagLabels=[{key:"sweat",label:"Sweat"},{key:"dishevelled",label:"Dishevelled"},{key:"blood",label:"Blood"},{key:"dirt",label:"Dirt"},{key:"wetHair",label:"Wet Hair"},{key:"tears",label:"Tears"}];function QuickFlags({flags:es,onToggle:ts}){return jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:flagLabels.map(({key:ss,label:rs})=>jsxRuntimeExports.jsx(TogglePill,{isActive:es[ss],label:rs,onClick:()=>ts(ss)},ss))})}function EventCard({event:es,onRemove:ts}){const[ss,rs]=reactExports.useState(!1),ns=es.progression&&es.progression.length>0,os=es.scenes&&es.scenes.length>0?es.scenes:null;return jsxRuntimeExports.jsxs("div",{className:"bg-card border border-border rounded-[10px] p-3.5 relative",children:[ts&&jsxRuntimeExports.jsx("button",{onClick:ts,className:"absolute top-3 right-3 p-1 text-text-light hover:text-text-muted transition-colors touch-manipulation","aria-label":"Remove event",children:jsxRuntimeExports.jsx("svg",{className:"w-[18px] h-[18px]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsx("span",{className:"inline-block text-[9px] font-bold tracking-widest uppercase text-gold bg-gold-100/50 px-2 py-0.5 rounded mb-2",children:es.type}),jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary text-[15px] mb-1 pr-6",children:es.name}),es.description&&jsxRuntimeExports.jsx("p",{className:"text-[13px] text-text-secondary leading-snug mb-2.5",children:es.description}),os&&jsxRuntimeExports.jsxs("div",{className:"mb-2.5",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide block mb-1.5",children:"SCENES"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:os.map(as=>{const ls=ns&&es.progression.some(cs=>cs.scene===as);return jsxRuntimeExports.jsx("span",{className:`inline-block min-w-[32px] text-center px-2 py-0.5 text-[11px] font-medium rounded ${ls?"bg-gold text-white":"bg-gray-100 text-text-secondary"}`,children:as},as)})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Stage:"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary font-medium ml-1.5",children:es.stage||""})]}),!os&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Scenes:"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary font-medium ml-1.5",children:es.sceneRange||""})]})]}),es.products&&jsxRuntimeExports.jsxs("div",{className:"text-xs mt-2",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Products:"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary ml-1.5",children:es.products})]}),es.referencePhotos.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-3",children:[jsxRuntimeExports.jsx("div",{className:"field-label mb-2",children:"REFERENCE PHOTOS"}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar",children:es.referencePhotos.map(as=>jsxRuntimeExports.jsx("img",{src:as.thumbnail||as.uri,alt:"Reference",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"},as.id))})]}),ns&&jsxRuntimeExports.jsxs("div",{className:"mt-3 border-t border-border pt-3",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>rs(!ss),className:"flex items-center gap-1.5 text-[11px] font-semibold text-gold mb-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),"Progression (",es.progression.length," stage",es.progression.length!==1?"s":"",")",jsxRuntimeExports.jsx("svg",{className:`w-3.5 h-3.5 transition-transform ${ss?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),ss&&jsxRuntimeExports.jsxs("div",{className:"relative pl-4",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-[7px] top-1 bottom-1 w-[2px] bg-gold-200 rounded"}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:es.progression.map((as,ls)=>jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute -left-4 top-0.5 w-4 h-4 rounded-full bg-gold flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px] text-white font-bold",children:ls+1})}),jsxRuntimeExports.jsxs("div",{className:"ml-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[jsxRuntimeExports.jsx("span",{className:"text-[11px] font-semibold text-text-primary",children:as.stage||`Stage ${ls+1}`}),as.scene&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-muted bg-gray-100 px-1.5 py-0.5 rounded",children:["Sc ",as.scene]})]}),as.notes&&jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-secondary leading-snug",children:as.notes}),as.referencePhotos&&as.referencePhotos.length>0&&jsxRuntimeExports.jsx("div",{className:"flex gap-1.5 mt-1.5",children:as.referencePhotos.map(cs=>jsxRuntimeExports.jsx("img",{src:cs.thumbnail||cs.uri,alt:"Stage reference",className:"w-10 h-10 rounded object-cover"},cs.id))})]})]},as.id))})]})]})]})}function ContinuityEvents({events:es,onAddEvent:ts,onRemoveEvent:ss}){return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3.5",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"CONTINUITY EVENTS"}),jsxRuntimeExports.jsxs("button",{onClick:ts,className:"flex items-center gap-1 px-3 py-1.5 rounded-md bg-gold-100/50 text-gold text-[11px] font-semibold hover:bg-gold-100 transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Event"]})]}),es.length===0?jsxRuntimeExports.jsx(EmptyState$3,{onAdd:ts}):jsxRuntimeExports.jsx("div",{className:"space-y-2.5",children:es.map(rs=>jsxRuntimeExports.jsx(EventCard,{event:rs,onRemove:()=>ss(rs.id)},rs.id))})]})}function EmptyState$3({onAdd:es}){return jsxRuntimeExports.jsxs("button",{onClick:es,className:"w-full flex flex-col items-center justify-center py-6 text-center touch-manipulation",children:[jsxRuntimeExports.jsxs("svg",{className:"w-8 h-8 text-gray-300 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),jsxRuntimeExports.jsx("polyline",{points:"14 2 14 8 20 8",strokeLinecap:"round",strokeLinejoin:"round"}),jsxRuntimeExports.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"12",strokeLinecap:"round"}),jsxRuntimeExports.jsx("line",{x1:"9",y1:"15",x2:"15",y2:"15",strokeLinecap:"round"})]}),jsxRuntimeExports.jsx("span",{className:"text-[13px] text-text-light",children:"No continuity events"}),jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-placeholder mt-1",children:"Add wounds, bruises, prosthetics etc."})]})}function AddEventModal({isOpen:es,onClose:ts,onAdd:ss,availableScenes:rs=[]}){const[ns,os]=reactExports.useState("Wound"),[as,ls]=reactExports.useState(""),[cs,us]=reactExports.useState(""),[ds,ms]=reactExports.useState(""),[ps,hs]=reactExports.useState([]),[xs,ys]=reactExports.useState(""),[vs,gs]=reactExports.useState(!1),[fs,js]=reactExports.useState([]),[Ss,bs]=reactExports.useState(!1),[Es,Rs]=reactExports.useState(!1),ws=reactExports.useRef(null),[Ns,ks]=reactExports.useState([]),[_s,Ls]=reactExports.useState(!1),Os=()=>{os("Wound"),ls(""),us(""),ms(""),hs([]),ys(""),js([]),Rs(!1),ks([]),Ls(!1)},zs=()=>{as.trim()&&(ss({type:ns,name:as.trim(),description:cs.trim(),stage:ds.trim(),sceneRange:ps.length>0?ps.join(", "):"",scenes:ps,products:xs.trim(),referencePhotos:fs,progression:Ns}),Os())},qs=()=>{Os(),ts()},Qs=Ps=>{hs(Fs=>Fs.includes(Ps)?Fs.filter(Us=>Us!==Ps):[...Fs,Ps])},Ys=()=>{ps.length===rs.length?hs([]):hs([...rs])},Ws=()=>{const Ps=ps.find(Fs=>!Ns.some(Us=>Us.scene===Fs))||"";ks(Fs=>[...Fs,{id:`stage-${Date.now()}`,scene:Ps,stage:"",notes:"",referencePhotos:[]}])},Is=(Ps,Fs)=>{ks(Us=>Us.map(Gs=>Gs.id===Ps?{...Gs,...Fs}:Gs))},Bs=Ps=>{ks(Fs=>Fs.filter(Us=>Us.id!==Ps))},Vs=async Ps=>{var Us;const Fs=(Us=Ps.target.files)==null?void 0:Us[0];if(Fs){bs(!0);try{const Gs=await createPhotoFromBlob(Fs,"additional");js(hr=>[...hr,Gs])}catch(Gs){console.error("Failed to process photo:",Gs)}finally{bs(!1)}}ws.current&&(ws.current.value="")},Ds=Ps=>{js(Fs=>Fs.filter(Us=>Us.id!==Ps))},Cs=async Ps=>{bs(!0);try{const Fs=await createPhotoFromBlob(Ps,"additional");js(Us=>[...Us,Fs])}catch(Fs){console.error("Failed to process captured photo:",Fs)}finally{bs(!1),Rs(!1)}},Ts=()=>{Rs(!0)},$s=ns==="Wound"||ns==="Bruise"||ns==="Other";return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(PhotoCapture,{isOpen:Es,onClose:()=>Rs(!1),onCapture:Cs,angle:"additional"}),jsxRuntimeExports.jsxs(BottomSheet,{isOpen:es&&!Es,onClose:qs,title:"Add Continuity Event",height:"auto",children:[jsxRuntimeExports.jsx("input",{ref:ws,type:"file",accept:"image/*",onChange:Vs,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"TYPE"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:CONTINUITY_EVENT_TYPES.map(Ps=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>os(Ps),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full border transition-colors touch-manipulation",{"bg-gold text-white border-gold":ns===Ps,"bg-gray-100 text-text-secondary border-gray-200 hover:bg-gray-200":ns!==Ps}),children:Ps},Ps))})]}),jsxRuntimeExports.jsx(Input,{label:"NAME",value:as,onChange:Ps=>ls(Ps.target.value),placeholder:"e.g., Forehead Cut"}),jsxRuntimeExports.jsx(Textarea,{label:"DESCRIPTION",value:cs,onChange:Ps=>us(Ps.target.value),placeholder:"Describe the makeup effect...",rows:2}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"SCENES"}),rs.length>0&&jsxRuntimeExports.jsx("button",{type:"button",onClick:Ys,className:"text-[11px] text-gold font-medium",children:ps.length===rs.length?"Deselect All":"Select All"})]}),rs.length>0?jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1.5",children:rs.map(Ps=>{const Fs=ps.includes(Ps);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Qs(Ps),className:clsx("min-w-[44px] px-2.5 py-1.5 text-xs font-medium rounded-lg border transition-colors touch-manipulation",{"bg-gold text-white border-gold":Fs,"bg-gray-50 text-text-secondary border-gray-200":!Fs}),children:Ps},Ps)})}):jsxRuntimeExports.jsx(Input,{value:ps.join(", "),onChange:Ps=>hs(Ps.target.value.split(",").map(Fs=>Fs.trim()).filter(Boolean)),placeholder:"e.g., 12, 13, 14, 15"}),ps.length>0&&jsxRuntimeExports.jsxs("p",{className:"text-[11px] text-text-muted mt-1.5",children:[ps.length," scene",ps.length!==1?"s":""," selected"]})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{label:"CURRENT STAGE",value:ds,onChange:Ps=>ms(Ps.target.value),onFocus:()=>gs(!0),onBlur:()=>setTimeout(()=>gs(!1),200),placeholder:"e.g., Fresh, Day 2 Healing"}),vs&&jsxRuntimeExports.jsx("div",{className:"absolute z-10 top-full left-0 right-0 mt-1 bg-card rounded-lg shadow-lg border border-border overflow-hidden max-h-40 overflow-y-auto",children:STAGE_SUGGESTIONS.map(Ps=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{ms(Ps),gs(!1)},className:"w-full px-3 py-2 text-left text-sm text-text-secondary hover:bg-gray-50 touch-manipulation",children:Ps},Ps))})]}),$s&&ps.length>1&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"PROGRESSION TIMELINE"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Ls(!_s),className:"text-[11px] text-gold font-medium",children:_s?"Hide":"Plan changes over scenes"})]}),_s&&jsxRuntimeExports.jsxs("div",{className:"space-y-2.5",children:[Ns.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-2",children:Ns.map((Ps,Fs)=>jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-gold text-white text-[10px] font-bold flex items-center justify-center flex-shrink-0",children:Fs+1}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] font-semibold text-text-muted uppercase tracking-wide",children:["Stage ",Fs+1]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Bs(Ps.id),className:"ml-auto p-0.5 text-text-light hover:text-red-500 transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide block mb-1",children:"From Scene"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:ps.map(Us=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Is(Ps.id,{scene:Us}),className:clsx("min-w-[36px] px-2 py-1 text-[11px] font-medium rounded border transition-colors touch-manipulation",{"bg-gold text-white border-gold":Ps.scene===Us,"bg-white text-text-secondary border-gray-200":Ps.scene!==Us}),children:Us},Us))})]}),jsxRuntimeExports.jsx("div",{className:"mb-2 relative",children:jsxRuntimeExports.jsx(ProgressionStagePicker,{value:Ps.stage,onChange:Us=>Is(Ps.id,{stage:Us})})}),jsxRuntimeExports.jsx(Textarea,{value:Ps.notes,onChange:Us=>Is(Ps.id,{notes:Us.target.value}),placeholder:"Application notes for this stage...",rows:1})]},Ps.id))}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:Ws,className:"w-full py-2.5 flex items-center justify-center gap-1.5 text-[12px] font-medium text-gold bg-gold-100/30 border border-dashed border-gold-300 rounded-lg hover:bg-gold-100/50 transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Stage"]}),Ns.length===0&&jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light text-center",children:"Plan how this event changes across scenes  e.g. fresh wound in Sc 5, scabbing by Sc 12, healed by Sc 20"})]})]}),jsxRuntimeExports.jsx(Textarea,{label:"PRODUCTS",value:xs,onChange:Ps=>ys(Ps.target.value),placeholder:"List products used...",rows:2}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"REFERENCE PHOTOS"}),fs.length>0&&jsxRuntimeExports.jsx("div",{className:"grid grid-cols-4 gap-2 mb-3",children:fs.map(Ps=>jsxRuntimeExports.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100",children:[jsxRuntimeExports.jsx("img",{src:Ps.thumbnail||Ps.uri,alt:"Reference",className:"w-full h-full object-cover"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Ds(Ps.id),className:"absolute top-1 right-1 w-5 h-5 bg-black/60 rounded-full flex items-center justify-center","aria-label":"Remove photo",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},Ps.id))}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",fullWidth:!0,onClick:Ts,disabled:Ss,children:Ss?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 mr-1.5 border-2 border-gold border-t-transparent rounded-full animate-spin"}),"Processing..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),fs.length>0?"Add Another Photo":"Add Reference Photo"]})})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"lg",fullWidth:!0,onClick:qs,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:zs,disabled:!as.trim(),children:"Add Event"})]})]})]})]})}function ProgressionStagePicker({value:es,onChange:ts}){const[ss,rs]=reactExports.useState(!1);return jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{label:"STAGE",value:es,onChange:ns=>ts(ns.target.value),onFocus:()=>rs(!0),onBlur:()=>setTimeout(()=>rs(!1),200),placeholder:"e.g., Fresh, Scabbed"}),ss&&jsxRuntimeExports.jsx("div",{className:"absolute z-10 top-full left-0 right-0 mt-1 bg-card rounded-lg shadow-lg border border-border overflow-hidden max-h-32 overflow-y-auto",children:STAGE_SUGGESTIONS.map(ns=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{ts(ns),rs(!1)},className:"w-full px-3 py-1.5 text-left text-[12px] text-text-secondary hover:bg-gray-50 touch-manipulation",children:ns},ns))})]})}function MakeupForm({makeup:es,onChange:ts,readOnly:ss=!1}){const rs=es||createEmptyMakeupDetails(),ns=(os,as)=>{ts&&!ss&&ts({...rs,[os]:as})};return!es&&ss?jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No makeup details available for this look."})}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"BASE"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Foundation",value:rs.foundation,onChange:os=>ns("foundation",os),readOnly:ss,placeholder:"e.g., MAC Studio Fix NC25"}),jsxRuntimeExports.jsx(FormField,{label:"Coverage",value:rs.coverage,onChange:os=>ns("coverage",os),readOnly:ss,placeholder:"e.g., Medium"})]}),jsxRuntimeExports.jsx(FormField,{label:"Concealer",value:rs.concealer,onChange:os=>ns("concealer",os),readOnly:ss,placeholder:"e.g., NARS Radiant Creamy"}),jsxRuntimeExports.jsx(FormField,{label:"Concealer Placement",value:rs.concealerPlacement,onChange:os=>ns("concealerPlacement",os),readOnly:ss,placeholder:"e.g., Under eyes, bridge of nose"}),jsxRuntimeExports.jsx(FormField,{label:"Contour",value:rs.contour,onChange:os=>ns("contour",os),readOnly:ss,placeholder:"e.g., Charlotte Tilbury Sculpt"}),jsxRuntimeExports.jsx(FormField,{label:"Contour Placement",value:rs.contourPlacement,onChange:os=>ns("contourPlacement",os),readOnly:ss,placeholder:"e.g., Hollows of cheeks, jawline"}),jsxRuntimeExports.jsx(FormField,{label:"Highlight",value:rs.highlight,onChange:os=>ns("highlight",os),readOnly:ss,placeholder:"e.g., Becca Champagne Pop"}),jsxRuntimeExports.jsx(FormField,{label:"Highlight Placement",value:rs.highlightPlacement,onChange:os=>ns("highlightPlacement",os),readOnly:ss,placeholder:"e.g., Cheekbones, brow bone"}),jsxRuntimeExports.jsx(FormField,{label:"Blush",value:rs.blush,onChange:os=>ns("blush",os),readOnly:ss,placeholder:"e.g., NARS Orgasm"}),jsxRuntimeExports.jsx(FormField,{label:"Blush Placement",value:rs.blushPlacement,onChange:os=>ns("blushPlacement",os),readOnly:ss,placeholder:"e.g., Apples of cheeks"})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"EYES"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Brow Product",value:rs.browProduct,onChange:os=>ns("browProduct",os),readOnly:ss,placeholder:"e.g., ABH Dipbrow Taupe"}),jsxRuntimeExports.jsx(FormField,{label:"Brow Shape",value:rs.browShape,onChange:os=>ns("browShape",os),readOnly:ss,placeholder:"e.g., Natural arch"})]}),jsxRuntimeExports.jsx(FormField,{label:"Eye Primer",value:rs.eyePrimer,onChange:os=>ns("eyePrimer",os),readOnly:ss,placeholder:"e.g., Urban Decay Primer Potion"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Lid Colour",value:rs.lidColour,onChange:os=>ns("lidColour",os),readOnly:ss,placeholder:"e.g., Champagne"}),jsxRuntimeExports.jsx(FormField,{label:"Crease",value:rs.creaseColour,onChange:os=>ns("creaseColour",os),readOnly:ss,placeholder:"e.g., Warm brown"}),jsxRuntimeExports.jsx(FormField,{label:"Outer V",value:rs.outerV,onChange:os=>ns("outerV",os),readOnly:ss,placeholder:"e.g., Deep brown"})]}),jsxRuntimeExports.jsx(FormField,{label:"Liner Style",value:rs.liner,onChange:os=>ns("liner",os),readOnly:ss,placeholder:"e.g., Thin black line, tight line"}),jsxRuntimeExports.jsx(FormField,{label:"Lashes",value:rs.lashes,onChange:os=>ns("lashes",os),readOnly:ss,placeholder:"e.g., Ardell Wispies, 2 coats mascara"})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"LIPS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Lip Liner",value:rs.lipLiner,onChange:os=>ns("lipLiner",os),readOnly:ss,placeholder:"e.g., MAC Spice"}),jsxRuntimeExports.jsx(FormField,{label:"Lip Colour",value:rs.lipColour,onChange:os=>ns("lipColour",os),readOnly:ss,placeholder:"e.g., Charlotte Tilbury Pillow Talk"})]}),jsxRuntimeExports.jsx(FormField,{label:"Setting",value:rs.setting,onChange:os=>ns("setting",os),readOnly:ss,placeholder:"e.g., MAC Fix+, light powder"})]})]})]})}function HairForm({hair:es,onChange:ts,readOnly:ss=!1}){const rs=es||createEmptyHairDetails(),ns=rs.hairType!=="Natural",os=(ls,cs)=>{ts&&!ss&&ts({...rs,[ls]:cs})},as=ls=>{if(ss)return;const cs=rs.wigAttachment||[],us=cs.includes(ls)?cs.filter(ds=>ds!==ls):[...cs,ls];os("wigAttachment",us)};return!es&&ss?jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No hair details available for this look."})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Hair Type"}),ss?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:rs.hairType}):jsxRuntimeExports.jsx("select",{value:rs.hairType,onChange:ls=>os("hairType",ls.target.value),className:"w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",children:HAIR_TYPES.map(ls=>jsxRuntimeExports.jsx("option",{value:ls,children:ls},ls))})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Style Description",value:rs.style,onChange:ls=>os("style",ls),readOnly:ss,placeholder:"e.g., Loose waves, half-up half-down",multiline:!0}),jsxRuntimeExports.jsx(FormField,{label:"Products Used",value:rs.products,onChange:ls=>os("products",ls),readOnly:ss,placeholder:"e.g., Oribe Dry Texturizing Spray, heat protectant",multiline:!0}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Parting",value:rs.parting,onChange:ls=>os("parting",ls),readOnly:ss,placeholder:"e.g., Centre part"}),jsxRuntimeExports.jsx(FormField,{label:"Pieces Out",value:rs.piecesOut,onChange:ls=>os("piecesOut",ls),readOnly:ss,placeholder:"e.g., Face-framing layers"})]}),jsxRuntimeExports.jsx(FormField,{label:"Pins / Grips / Ties",value:rs.pins,onChange:ls=>os("pins",ls),readOnly:ss,placeholder:"e.g., 6 bobby pins at crown, clear elastic"}),jsxRuntimeExports.jsx(FormField,{label:"Accessories",value:rs.accessories,onChange:ls=>os("accessories",ls),readOnly:ss,placeholder:"e.g., Gold barrette, silk ribbon"})]}),ns&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-4 mt-4",children:jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"WIG / HAIRPIECE DETAILS"})}),jsxRuntimeExports.jsx(FormField,{label:"Wig Name / ID",value:rs.wigNameId,onChange:ls=>os("wigNameId",ls),readOnly:ss,placeholder:"e.g., WIG-042 Auburn Bob"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Wig Type"}),ss?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:rs.wigType||jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsxs("select",{value:rs.wigType,onChange:ls=>os("wigType",ls.target.value),className:"w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select type..."}),WIG_TYPES.map(ls=>jsxRuntimeExports.jsx("option",{value:ls,children:ls},ls))]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Hairline"}),ss?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:rs.hairline||jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsxs("select",{value:rs.hairline,onChange:ls=>os("hairline",ls.target.value),className:"w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select style..."}),HAIRLINE_STYLES.map(ls=>jsxRuntimeExports.jsx("option",{value:ls,children:ls},ls))]})]})]}),jsxRuntimeExports.jsx(FormField,{label:"Wig Cap Method",value:rs.wigCapMethod,onChange:ls=>os("wigCapMethod",ls),readOnly:ss,placeholder:"e.g., Cornrows, bald cap, braided flat"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Attachment Method"}),ss?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:rs.wigAttachment.length>0?rs.wigAttachment.join(", "):jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:WIG_ATTACHMENTS.map(ls=>{const cs=rs.wigAttachment.includes(ls);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>as(ls),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${cs?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:ls},ls)})})]}),jsxRuntimeExports.jsx(FormField,{label:"Lace Tint",value:rs.laceTint,onChange:ls=>os("laceTint",ls),readOnly:ss,placeholder:"e.g., Ebin Lace Tint Medium Brown"}),jsxRuntimeExports.jsx(FormField,{label:"Edges / Baby Hairs",value:rs.edgesBabyHairs,onChange:ls=>os("edgesBabyHairs",ls),readOnly:ss,placeholder:"e.g., Laid with Got2b, swoop on left side"})]})]})}function SFXForm({sfx:es,onChange:ts,onCapturePhoto:ss,onRemovePhoto:rs,readOnly:ns=!1}){const os=es||createEmptySFXDetails(),as=(us,ds)=>{ts&&!ns&&ts({...os,[us]:ds})},ls=us=>{if(ns)return;const ds=os.sfxTypes||[],ms=ds.includes(us)?ds.filter(ps=>ps!==us):[...ds,us];as("sfxTypes",ms)},cs=us=>{if(ns)return;const ds=os.bloodTypes||[],ms=ds.includes(us)?ds.filter(ps=>ps!==us):[...ds,us];as("bloodTypes",ms)};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"SFX Required"}),jsxRuntimeExports.jsx(Switch,{isOn:os.sfxRequired,onToggle:()=>!ns&&as("sfxRequired",!os.sfxRequired),disabled:ns})]}),os.sfxRequired&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"SFX Type"}),ns?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:os.sfxTypes.length>0?os.sfxTypes.join(", "):jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:SFX_TYPES.map(us=>{const ds=os.sfxTypes.includes(us);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ls(us),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${ds?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:us},us)})})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"PROSTHETICS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Prosthetic Pieces",value:os.prostheticPieces,onChange:us=>as("prostheticPieces",us),readOnly:ns,placeholder:"e.g., Brow piece #3, nose tip, chin extension",multiline:!0}),jsxRuntimeExports.jsx(FormField,{label:"Prosthetic Adhesive",value:os.prostheticAdhesive,onChange:us=>as("prostheticAdhesive",us),readOnly:ns,placeholder:"e.g., Pros-Aide, Telesis 5"})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"BLOOD"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Blood Type"}),ns?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:os.bloodTypes.length>0?os.bloodTypes.join(", "):jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:BLOOD_TYPES.map(us=>{const ds=os.bloodTypes.includes(us);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>cs(us),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${ds?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:us},us)})})]}),jsxRuntimeExports.jsx(FormField,{label:"Blood Products",value:os.bloodProducts,onChange:us=>as("bloodProducts",us),readOnly:ns,placeholder:"e.g., Kryolan Dark Blood, Fleet Street Drying Blood"}),jsxRuntimeExports.jsx(FormField,{label:"Blood Placement",value:os.bloodPlacement,onChange:us=>as("bloodPlacement",us),readOnly:ns,placeholder:"e.g., Left temple wound, splatter on collar",multiline:!0})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"TATTOOS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Tattoo Coverage",value:os.tattooCoverage,onChange:us=>as("tattooCoverage",us),readOnly:ns,placeholder:"e.g., Dermablend on right arm sleeve"}),jsxRuntimeExports.jsx(FormField,{label:"Temporary Tattoos",value:os.temporaryTattoos,onChange:us=>as("temporaryTattoos",us),readOnly:ns,placeholder:"e.g., Neck tattoo transfer, left forearm design"})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"EYES & TEETH"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Contact Lenses",value:os.contactLenses,onChange:us=>as("contactLenses",us),readOnly:ns,placeholder:"e.g., 9mm Mesmer Ghostly White, plano"}),jsxRuntimeExports.jsx(FormField,{label:"Teeth",value:os.teeth,onChange:us=>as("teeth",us),readOnly:ns,placeholder:"e.g., Custom vampire fangs, coffee staining"})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"AGING & CHARACTER"}),jsxRuntimeExports.jsx(FormField,{label:"Aging / Character Notes",value:os.agingCharacterNotes,onChange:us=>as("agingCharacterNotes",us),readOnly:ns,placeholder:"e.g., Stipple aging on hands and neck, sunken cheeks with highlight/shadow",multiline:!0,rows:3})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("label",{className:"field-label whitespace-nowrap",children:"SFX APPLICATION TIME"}),ns?jsxRuntimeExports.jsxs("span",{className:"text-sm text-text-primary font-semibold",children:[os.sfxApplicationTime??""," min"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("input",{type:"number",value:os.sfxApplicationTime??"",onChange:us=>as("sfxApplicationTime",us.target.value?parseInt(us.target.value,10):null),className:"w-16 bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-2 text-sm text-center font-semibold text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",placeholder:"--",min:"0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold",children:"SFX REFERENCE PHOTOS"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-light",children:[os.sfxReferencePhotos.length," photos"]})]}),jsxRuntimeExports.jsx(SFXPhotoGrid,{photos:os.sfxReferencePhotos,onCapture:ss,onRemove:rs,readOnly:ns})]})]}),!os.sfxRequired&&jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Toggle SFX Required to add special effects details."})})]})}function SFXPhotoGrid({photos:es,onCapture:ts,onRemove:ss,readOnly:rs}){return jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[es.map(ns=>jsxRuntimeExports.jsxs("div",{className:"relative aspect-square",children:[jsxRuntimeExports.jsx("img",{src:ns.thumbnail||ns.uri,alt:"SFX reference",className:"w-full h-full object-cover rounded-lg"}),!rs&&ss&&jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ss(ns.id),className:"absolute -top-1.5 -right-1.5 w-5 h-5 rounded-full bg-error text-white flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},ns.id)),!rs&&ts&&jsxRuntimeExports.jsxs("button",{type:"button",onClick:ts,className:"aspect-square rounded-lg border-2 border-dashed border-border flex flex-col items-center justify-center gap-1 text-text-light hover:border-gold hover:text-gold transition-colors",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"})]}),jsxRuntimeExports.jsx("span",{className:"text-[10px] font-medium",children:"Add"})]}),es.length===0&&rs&&jsxRuntimeExports.jsx("div",{className:"col-span-4 text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No SFX reference photos."})})]})}function NotesForm({notes:es,onChange:ts}){const[ss,rs]=reactExports.useState(es),ns=reactExports.useRef(null),os=reactExports.useRef(null),as=reactExports.useRef(ts);reactExports.useEffect(()=>{as.current=ts},[ts]),reactExports.useEffect(()=>{rs(es)},[es]);const ls=()=>{os.current&&(clearTimeout(os.current),os.current=null),ns.current!==null&&(as.current(ns.current),ns.current=null)};reactExports.useEffect(()=>()=>{ls()},[]);const cs=ds=>{rs(ds),ns.current=ds,os.current&&clearTimeout(os.current),os.current=setTimeout(()=>{ns.current!==null&&(as.current(ns.current),ns.current=null)},300)},us=()=>{ls()};return jsxRuntimeExports.jsx(Textarea,{value:ss,onChange:ds=>cs(ds.target.value),onBlur:us,placeholder:"Add continuity notes, anomalies, director requests...",rows:4,className:"resize-none"})}function CharacterProfile({sceneId:es,characterId:ts}){const{currentProject:ss,getCharacter:rs,getScene:ns,getLookForCharacterInScene:os,getOrCreateSceneCapture:as,getSceneCapture:ls,updateSceneCapture:cs,addPhotoToCapture:us,removePhotoFromCapture:ds,toggleContinuityFlag:ms,addContinuityEvent:ps,removeContinuityEvent:hs,updateSFXDetails:xs,addSFXPhoto:ys,removeSFXPhoto:vs,markSceneComplete:gs,copyToNextScene:fs,setCurrentScene:js,sceneCaptures:Ss,updateLook:bs}=useProjectStore(),Es=rs(ts),Rs=ns(es),ws=Rs?os(ts,Rs.sceneNumber):void 0,Ns=ls(es,ts)||as(es,ts),[ks,_s]=reactExports.useState(!1),[Ls,Os]=reactExports.useState("front"),[zs,qs]=reactExports.useState(!1),[Qs,Ys]=reactExports.useState(!1),[Ws,Is]=reactExports.useState(!1),[Bs,Vs]=reactExports.useState(!1),[Ds,Cs]=reactExports.useState([]),[Ts,$s]=reactExports.useState(0),[Ps,Fs]=reactExports.useState("scene");if(!Es||!Rs||!ss)return null;const Us=Ns.id,Gs=(Hs,Js=!1,Zs=!1)=>{Os(Hs),qs(Js),Ys(Zs),_s(!0)},hr=async Hs=>{const Js=await createPhotoFromBlob(Hs,zs||Qs?void 0:Ls);Qs?ys(Us,Js):zs&&ws?us(Us,Js,"additional"):us(Us,Js,Ls==="additional"?"additional":Ls)},ur=Hs=>{xs(Us,Hs)},cr=()=>{gs(es)},Er=()=>{const Hs=fs(es,ts);Hs&&js(Hs)},Nr=Hs=>{const Js={...Hs,id:`event-${Date.now()}`};ps(Us,Js),Is(!1)},kr=(Hs,Js)=>{const Zs=[],dr=["front","left","right","back"];let br=0;dr.forEach(Rr=>{const ar=Ns.photos[Rr];ar&&(Rr===Js&&(br=Zs.length),Zs.push(ar))}),Cs(Zs),$s(br),Fs("scene"),Vs(!0)},mr=(Hs,Js)=>{Cs(Ns.additionalPhotos),$s(Js),Fs("additional"),Vs(!0)},xr=Hs=>{if(Ps==="scene"){const Js=["front","left","right","back"];for(const Zs of Js){const dr=Ns.photos[Zs];if((dr==null?void 0:dr.id)===Hs){ds(Us,Zs);break}}Cs(Zs=>Zs.filter(dr=>dr.id!==Hs))}else Ps==="additional"?(ds(Us,"additional",Hs),Cs(Js=>Js.filter(Zs=>Zs.id!==Hs))):Ps==="sfx"&&(vs(Us,Hs),Cs(Js=>Js.filter(Zs=>Zs.id!==Hs)))},Ms=ws?ss.scenes.filter(Hs=>ws.scenes.includes(Hs.sceneNumber)):[];return jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-4 space-y-2.5 pb-32",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3.5",children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:Es,size:"xl"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h2",{className:"text-character-name text-gold font-bold truncate",children:Es.name}),jsxRuntimeExports.jsxs("p",{className:"text-[13px] text-text-muted mt-0.5",children:["Scene ",Rs.sceneNumber," | ",formatSluglineShort(Rs.slugline)]})]})]}),ws&&jsxRuntimeExports.jsxs("div",{className:"bg-input-bg rounded-[10px] px-4 py-3 flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-gold",children:ws.name}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted ml-2.5",children:["Scenes ",formatSceneRange(ws.scenes)]})]}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted font-medium",children:["~",formatEstimatedTime(ws.estimatedTime)]})]}),(()=>{const Hs=[{key:"sweat",label:"Sweat"},{key:"dishevelled",label:"Dishevelled"},{key:"blood",label:"Blood"},{key:"dirt",label:"Dirt"},{key:"wetHair",label:"Wet Hair"},{key:"tears",label:"Tears"}].filter(({key:Js})=>Ns.continuityFlags[Js]);return Hs.length===0?null:jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:Hs.map(({key:Js,label:Zs})=>jsxRuntimeExports.jsx("span",{className:"px-3 py-1.5 text-xs font-semibold rounded-full bg-gold text-white",children:Zs},Js))})})(),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"SCENE PHOTOS"}),jsxRuntimeExports.jsx(PhotoGrid,{photos:Ns.photos,onCapture:Hs=>Gs(Hs),onView:kr})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"MASTER REFERENCE"}),jsxRuntimeExports.jsx(MasterReference,{photo:ws==null?void 0:ws.masterReference,onCapture:()=>Gs("front",!0)})]}),Ms.length>1&&jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"SCENES IN THIS LOOK"}),jsxRuntimeExports.jsx("div",{className:"flex gap-3 overflow-x-auto hide-scrollbar p-1 -m-1",children:Ms.map(Hs=>{const Js=Ss[`${Hs.id}-${ts}`],Zs=Js?getCaptureStatus(Js)!=="not-started":!1;let dr;if(Js){const{photos:br,additionalPhotos:Rr}=Js,ar=br.front||br.left||br.right||br.back||Rr[0];dr=(ar==null?void 0:ar.thumbnail)||(ar==null?void 0:ar.uri)}return jsxRuntimeExports.jsx(SceneThumbnailSlot,{sceneNumber:Hs.sceneNumber,hasCaptured:Zs,isActive:Hs.id===es,onClick:()=>js(Hs.id),thumbnailUrl:dr},Hs.id)})})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"ADDITIONAL PHOTOS"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-light",children:[Ns.additionalPhotos.length," photos"]})]}),jsxRuntimeExports.jsx(AdditionalPhotosGrid,{photos:Ns.additionalPhotos,onCapture:()=>Gs("additional"),onView:mr})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"QUICK FLAGS"}),jsxRuntimeExports.jsx(QuickFlags,{flags:Ns.continuityFlags,onToggle:Hs=>ms(Us,Hs)})]}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx(ContinuityEvents,{events:Ns.continuityEvents,onAddEvent:()=>Is(!0),onRemoveEvent:Hs=>hs(Us,Hs)})}),jsxRuntimeExports.jsx(Accordion,{title:"MAKEUP",count:ws?countFilledFields(ws.makeup):0,children:jsxRuntimeExports.jsx(MakeupForm,{makeup:ws==null?void 0:ws.makeup,onChange:ws?Hs=>bs(ws.id,{makeup:Hs}):void 0})}),jsxRuntimeExports.jsx(Accordion,{title:"HAIR",count:ws?countHairFields(ws.hair):0,children:jsxRuntimeExports.jsx(HairForm,{hair:ws==null?void 0:ws.hair,onChange:ws?Hs=>bs(ws.id,{hair:Hs}):void 0})}),jsxRuntimeExports.jsx(Accordion,{title:"SPECIAL EFFECTS",count:countSFXFields(Ns.sfxDetails),badge:Ns.sfxDetails.sfxRequired?void 0:"None",children:jsxRuntimeExports.jsx(SFXForm,{sfx:Ns.sfxDetails,onChange:ur,onCapturePhoto:()=>Gs("additional",!1,!0),onRemovePhoto:Hs=>vs(Us,Hs)})}),jsxRuntimeExports.jsx(Accordion,{title:"SCENE NOTES",children:jsxRuntimeExports.jsx(NotesForm,{notes:Ns.notes,onChange:Hs=>cs(Us,{notes:Hs})})}),jsxRuntimeExports.jsxs("div",{className:"card flex items-center gap-3.5",children:[jsxRuntimeExports.jsx("label",{className:"field-label whitespace-nowrap",children:"APPLICATION TIME"}),jsxRuntimeExports.jsx("input",{type:"number",value:Ns.applicationTime??(ws==null?void 0:ws.estimatedTime)??"",onChange:Hs=>cs(Us,{applicationTime:Hs.target.value?parseInt(Hs.target.value,10):void 0}),className:"input-field w-16 text-center font-semibold",placeholder:"--",min:"0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2.5 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:cr,disabled:Rs.isComplete,children:Rs.isComplete?"Scene Completed":"Mark Scene Complete"}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"lg",fullWidth:!0,onClick:Er,children:"Copy to Next Scene"})]})]}),jsxRuntimeExports.jsx(PhotoCapture,{isOpen:ks,onClose:()=>_s(!1),onCapture:hr,angle:Ls,characterName:Es.name,sceneNumber:Rs.sceneNumber,lookName:ws==null?void 0:ws.name}),jsxRuntimeExports.jsx(AddEventModal,{isOpen:Ws,onClose:()=>Is(!1),onAdd:Nr}),jsxRuntimeExports.jsx(PhotoViewer,{isOpen:Bs,photos:Ds,initialIndex:Ts,onClose:()=>Vs(!1),onDelete:xr})]})}function formatSluglineShort(es){return es.replace(/^(INT\.|EXT\.)\s*/i,"").replace(/\s*-\s*(DAY|NIGHT|MORNING|EVENING|CONTINUOUS)\s*$/i,"").split(" - ")[0]}function SceneView({sceneId:es,onBack:ts}){const{currentProject:ss,currentCharacterId:rs,setCurrentCharacter:ns,getScene:os,getCharacter:as,addCharacterToScene:ls}=useProjectStore(),cs=os(es),[us,ds]=reactExports.useState(!1),[ms,ps]=reactExports.useState(!1);reactExports.useEffect(()=>{cs&&cs.characters.length>0&&!rs&&ns(cs.characters[0])},[cs,rs,ns]);const hs=reactExports.useMemo(()=>!cs||!rs?!0:cs.characters.includes(rs),[cs,rs]),xs=rs?as(rs):null,ys=reactExports.useCallback(()=>{cs&&rs&&ls(cs.id,rs)},[cs,rs,ls]),vs=reactExports.useCallback(()=>{!hs&&rs?ps(!0):ts()},[hs,rs,ts]);if(!cs||!ss)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-text-muted",children:"Scene not found"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",onClick:ts,className:"mt-2",children:"Go Back"})]})});const gs=reactExports.useMemo(()=>cs.characters.map(fs=>as(fs)).filter(Boolean),[cs.characters,as]);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx(Header,{title:`Scene ${cs.sceneNumber}`,showBack:!0,onBack:vs}),!hs&&xs&&jsxRuntimeExports.jsx("div",{className:"bg-amber-50 border-b border-amber-200 px-4 py-3",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium text-amber-800",children:[xs.name," is not in the breakdown"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-600 mt-0.5",children:"Add them to track continuity for this scene"})]}),jsxRuntimeExports.jsx("button",{onClick:ys,className:"flex-shrink-0 px-3 py-1.5 rounded-lg bg-amber-600 text-white text-xs font-semibold active:scale-95 transition-transform",children:"Add to Breakdown"})]})})}),jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border px-4 py-3",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold text-text-primary mb-2",children:cs.slugline}),cs.synopsis?jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mb-3",children:cs.synopsis}):jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted italic mb-3",children:"No synopsis available. Sync from desktop or tap to add."}),cs.scriptContent&&jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:()=>ds(!0),children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"View Full Scene"]})]})}),gs.length>0&&jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border overflow-x-auto hide-scrollbar",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"flex gap-2 px-4 py-3",children:gs.map(fs=>jsxRuntimeExports.jsx("button",{onClick:()=>ns(fs.id),className:clsx("flex-shrink-0 px-4 py-2 rounded-pill text-sm font-medium transition-colors touch-manipulation",{"gold-gradient text-white":rs===fs.id,"bg-gray-100 text-text-secondary hover:bg-gray-200":rs!==fs.id}),children:fs.name},fs.id))})})}),rs&&jsxRuntimeExports.jsx(CharacterProfile,{sceneId:es,characterId:rs}),ms&&xs&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:()=>ps(!1),children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-t-2xl overflow-hidden animate-slideUp",onClick:fs=>fs.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"p-5",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM3 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 019.374 21c-2.331 0-4.512-.645-6.374-1.766z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Add ",xs.name," to Breakdown?"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"This character hasn't been added to the scene breakdown yet"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-5 pb-5 flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{ps(!1),ts()},className:"flex-1 py-2.5 rounded-button border border-border text-text-muted text-sm font-medium",children:"Leave Without Adding"}),jsxRuntimeExports.jsx("button",{onClick:()=>{ys(),ps(!1),ts()},className:"flex-1 py-2.5 rounded-button gold-gradient text-white text-sm font-medium",children:"Add to Breakdown"})]})]})}),us&&cs.scriptContent&&jsxRuntimeExports.jsx(FullScriptModal,{content:cs.scriptContent,sceneNumber:cs.sceneNumber,onClose:()=>ds(!1)})]})}function FullScriptModal({content:es,sceneNumber:ts,onClose:ss}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col bg-card animate-slideUp",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-text-primary",children:["Scene ",ts]}),jsxRuntimeExports.jsx("button",{onClick:ss,className:"p-2 -m-2 text-text-muted hover:text-text-primary tap-target touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-text-primary leading-relaxed",children:es})})]})})}function SceneScriptModal({scene:es,onClose:ts}){return reactExports.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),reactExports.useEffect(()=>{const ss=rs=>{rs.key==="Escape"&&ts()};return document.addEventListener("keydown",ss),()=>document.removeEventListener("keydown",ss)},[ts]),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",onClick:ts,children:jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col bg-card animate-slideUp",onClick:ss=>ss.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border safe-top",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-text-primary",children:["Scene ",es.sceneNumber]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted truncate",children:es.slugline})]}),jsxRuntimeExports.jsx("button",{onClick:ts,className:"p-2 -m-2 text-text-muted hover:text-text-primary tap-target touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-border/50 bg-gray-50",children:[jsxRuntimeExports.jsx("span",{className:clsx("px-2 py-0.5 text-xs font-bold rounded",es.intExt==="INT"?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"),children:es.intExt}),jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-gray-200 text-text-secondary",children:es.timeOfDay}),es.filmingStatus&&jsxRuntimeExports.jsx("span",{className:clsx("px-2 py-0.5 text-xs font-medium rounded",es.filmingStatus==="complete"?"bg-green-100 text-green-700":es.filmingStatus==="partial"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"),children:es.filmingStatus==="complete"?"Complete":es.filmingStatus==="partial"?"Partial":"Incomplete"})]}),es.synopsis&&jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border/50 bg-gold-100/30",children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-1",children:"SYNOPSIS"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary italic",children:es.synopsis})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto",children:es.scriptContent?jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"FULL SCENE"}),jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-text-primary leading-relaxed",children:es.scriptContent})]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Script Content"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted text-center",children:["Script content is not available for this scene.",!es.synopsis&&" Upload a script to view full scene content."]})]})}),jsxRuntimeExports.jsx("div",{className:"border-t border-border p-4 safe-bottom bg-card",children:jsxRuntimeExports.jsx("button",{onClick:ts,className:"w-full py-3 rounded-button gold-gradient text-white font-medium active:scale-[0.98] transition-transform",children:"Close"})})]})})}pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;function debugLog(...es){console.log("[CallSheetParser]",...es)}async function extractTextFromPDF$1(es){const ts=await es.arrayBuffer(),ss=await pdfExports.getDocument({data:ts}).promise;let rs="";for(let ns=1;ns<=ss.numPages;ns++){const ls=(await(await ss.getPage(ns)).getTextContent()).items.map(cs=>cs.str).join(" ");rs+=ls+`
`}return rs}async function parseCallSheetText(es,ts){var ns,os,as;const ss=`You are an expert at parsing film/TV production call sheets. Your job is to extract structured data from call sheet text that has been extracted from a PDF.

IMPORTANT: Call sheets vary significantly between productions and ADs. The text extraction may lose table structure, so look for patterns and context clues.

Common patterns to look for:
- Production day: "DAY X" or "DAY X OF Y" or "SHOOT DAY X" or "CALL SHEET X OF Y"
- Dates: Various formats like "MONDAY 24TH NOVEMBER 2025" or "24/11/25"
- Unit call time: "UNIT CALL" or "UNIT CALL TIME" followed by time
- Pre-calls: HMU, COSTUME, ADs, LIGHTING, CAMERA times (often earlier than unit call)
  - May include location like "07:45 @ UB" (at Unit Base)
- Meal times: BREAKFAST, LUNCH with times and possibly locations (HOTBOX, IN HAND, etc.)
- Wrap estimates: "EST. WRAP", "CAMERA WRAP", "WRAP"
- Weather: Temperature (High/Low), conditions, sunrise/sunset times
- Locations: UNIT BASE, LOCATION, LOC 1, LOC 2, CREW PARKING with addresses and What3Words (///word.word.word)
- Scene schedules: Usually in table format with scene numbers, INT/EXT, location, D/N, pages, cast numbers, timings
- Cast information: Actor names, characters, call times, H&MU times, costume times, travel, on-set times

Time formats vary: "0730", "07:30", "7:30 AM", "7.30", "08:00 AM"

Return ONLY valid JSON with no additional text or markdown.`,rs=`Parse this call sheet text and extract ALL available information including locations, weather, and timing details.

CALL SHEET TEXT:
---
${es.slice(0,15e3)}
---

Return a JSON object with this structure (include only fields that have data in the call sheet):
{
  "date": "YYYY-MM-DD format",
  "productionDay": number,
  "totalProductionDays": number or null,
  "dayType": "e.g., 10 HRS CONTINUOUS WORKING DAY, STANDARD WORKING DAY, SEMI-CONTINUOUS",
  "unitCallTime": "HH:MM 24-hour format",
  "rehearsalsTime": "HH:MM or null (REHEARSALS ON SET FOR)",
  "firstShotTime": "HH:MM or null (TO SHOOT FOR)",
  "preCalls": {
    "ads": "HH:MM or null",
    "hmu": "HH:MM or null",
    "costume": "HH:MM or null",
    "production": "HH:MM or null",
    "lighting": "HH:MM or null",
    "camera": "HH:MM or null",
    "location": "where pre-calls happen e.g., 'Unit Base', 'UB', 'On Set'"
  },
  "breakfastTime": "HH:MM or HH:MM - HH:MM",
  "breakfastLocation": "location description or null",
  "lunchTime": "HH:MM or HH:MM - HH:MM",
  "lunchLocation": "HOTBOX, IN HAND, location name, etc.",
  "cameraWrapEstimate": "HH:MM",
  "wrapEstimate": "HH:MM",
  "weather": {
    "conditions": "Overcast, Sunny, Showers, Mostly Cloudy, Scattered Showers, etc.",
    "tempHigh": number in Celsius,
    "tempLow": number in Celsius,
    "sunrise": "HH:MM",
    "sunset": "HH:MM"
  },
  "unitBase": {
    "name": "Location name",
    "address": "Full street address",
    "what3words": "///word.word.word format if present"
  },
  "shootLocations": [
    {
      "id": "LOC 1 or LOC1 or main",
      "name": "Location name",
      "address": "Full street address",
      "what3words": "///word.word.word format if present"
    }
  ],
  "crewParking": {
    "name": "Parking location name",
    "address": "Address if different from unit base",
    "notes": "Any parking instructions"
  },
  "unitNotes": ["array of important notes from UNIT NOTES section"],
  "scenes": [
    {
      "sceneNumber": "1" or "1A" (string, exactly as shown),
      "locationId": "LOC 1, LOC 2, etc. if shown",
      "setDescription": "The INT/EXT location line ONLY, e.g. 'EXT. FARMHOUSE' or 'INT. FARMHOUSE - KITCHEN'. Do NOT include the scene description here.",
      "action": "REQUIRED: The scene description/log line that describes WHAT HAPPENS in the scene. Examples: 'PETER and GWEN meet the AOKI's', 'PETER tells GWEN to go', 'PETER & GWEN watch the helicopter take off'. This is usually below the location or after a separator. Extract this for EVERY scene.",
      "dayNight": "D" or "N" or "D/N" or "D1" or "D2" or "D11" etc (from D/N column)",
      "pages": "1/8" or "2" or "1 5/8" or "1 2/8" etc (from PAGES column)",
      "cast": ["1", "2", "4"] (cast ID numbers from CAST column, as strings),
      "estimatedTime": "08:20 - 09:00 or 09:20 - 10:30 (from TIMINGS column)",
      "notes": "CRITICAL: Extract ALL notes from the NOTES column, especially HMU (hair/makeup), VFX, SFX, STUNTS notes. Format as 'HMU: description, VFX: description, SFX: description'. These are essential for continuity tracking."
    }
  ],
  "castCalls": [
    {
      "id": "1" (cast number from ID column),
      "name": "ACTOR NAME",
      "character": "CHARACTER NAME or ROLE",
      "status": "SW" or "SWF" or "W" or "WF" etc,
      "pickup": "HH:MM or null",
      "driver": "RW, LW, MINIBUS, etc. or null",
      "callTime": "HH:MM (CALL column)",
      "breakfastTime": "HH:MM (B/FAST column) or null",
      "costumeCall": "HH:MM (COSTUME column) or null",
      "hmuCall": "HH:MM (H&MU column) or null",
      "travelTime": "HH:MM (TRAVEL column) or null",
      "onSetTime": "HH:MM (ON SET column) or null",
      "notes": "any notes for this cast member"
    }
  ],
  "supportingArtists": [
    {
      "id": "SA1 or number",
      "name": "NAME",
      "designation": "Role description",
      "callTime": "HH:MM"
    }
  ]
}

IMPORTANT:
- All times should be in 24-hour HH:MM format (convert "0730" to "07:30", "8:00 AM" to "08:00")
- Scene numbers should be extracted exactly as shown (may be numeric or alphanumeric like "4A", "18B")
- Extract What3Words addresses - they look like "///word.word.word" or "W3W - ///word.word.word"
- Look for LOCATION: and UNIT BASE: lines for address information
- Camera wrap and estimated wrap are often separate times
- Pre-calls may be listed as "PRE-CALLS" or "PRE CALLS" with department times
- Extract weather including conditions like "Overcast with Scattered Showers"
- If a field has no data, omit it or use null
- CRITICAL: Only extract scenes for the CURRENT shooting day. Do NOT include scenes from "ADVANCE SCHEDULE", "ADVANCE", "NEXT DAYS", or any section showing future production days. These appear at the end of call sheets and show upcoming days - ignore them completely.

SCENE DATA EXTRACTION (VERY IMPORTANT):
- The "SET & DESCRIPTION" column typically has TWO parts per scene:
  1. setDescription = The INT/EXT location line ONLY (e.g., "EXT. FARMHOUSE", "INT. FARMHOUSE - KITCHEN")
  2. action = The scene description/log line that describes WHAT HAPPENS (e.g., "PETER and GWEN meet the AOKI's", "PETER tells GWEN to go")
- CRITICAL: The "action" field MUST contain the description of what happens in the scene, NOT the location
- If the description appears on a separate line below the location, that is the "action"
- If the description appears after a dash or colon after the location, extract it as the "action"
- Examples of action: "PETER and GWEN watch the helicopter take off", "PETER tells GWEN to go", "PETER & GWEN make the poison, the house rocks"
- ALWAYS extract cast numbers from the CAST column (e.g., "1, 2, 9, 10, 14")
- ALWAYS extract notes from NOTES column, especially HMU (hair/makeup), VFX, SFX notes
- ALWAYS extract page counts and timings when available`;try{debugLog("Starting AI call sheet parsing..."),debugLog("Text length:",es.length,"characters");const ls=await callAI(rs,{system:ss,maxTokens:8e3});debugLog("AI response received, length:",ls.length);const cs=ls.match(/\{[\s\S]*\}/);if(!cs)throw console.error("No JSON found in AI response:",ls),debugLog("ERROR: No JSON found in AI response"),new Error("Failed to parse call sheet - invalid AI response");const us=JSON.parse(cs[0]);if(debugLog("JSON parsed successfully"),debugLog("Scenes extracted:",((ns=us.scenes)==null?void 0:ns.length)||0),debugLog("Cast calls extracted:",((os=us.castCalls)==null?void 0:os.length)||0),((as=us.scenes)==null?void 0:as.length)>0){const js=us.scenes[0];debugLog("Sample scene:",{sceneNumber:js.sceneNumber,setDescription:js.setDescription,action:js.action,cast:js.cast,estimatedTime:js.estimatedTime,pages:js.pages})}const ms=(us.scenes||[]).filter(js=>{const Ss=(js.notes||"").toLowerCase();return!(Ss.includes("advance schedule")||Ss.includes("advance day")||js.productionDay&&us.productionDay&&js.productionDay!==us.productionDay)}).map((js,Ss)=>({sceneNumber:String(js.sceneNumber||Ss+1),location:js.locationId||js.location||void 0,setDescription:js.setDescription||"Unknown Scene",action:js.action||void 0,dayNight:js.dayNight||"D",pages:js.pages||void 0,cast:Array.isArray(js.cast)?js.cast.map(String):[],notes:js.notes||void 0,estimatedTime:js.estimatedTime||void 0,startTime:js.startTime||void 0,endTime:js.endTime||void 0,shootOrder:Ss+1,status:"upcoming"})),ps=(us.castCalls||[]).map(js=>({id:String(js.id||""),name:js.name||"",character:js.character||"",status:js.status||"W",pickup:js.pickup||void 0,driver:js.driver||void 0,callTime:js.callTime||"",makeupCall:js.makeupCall||js.breakfastTime||void 0,costumeCall:js.costumeCall||void 0,hmuCall:js.hmuCall||void 0,travelTime:js.travelTime||void 0,onSetTime:js.onSetTime||void 0,notes:js.notes||void 0})),hs=(us.supportingArtists||[]).map(js=>({id:String(js.id||""),name:js.name||"",designation:js.designation||"",status:js.status||"-",callTime:js.callTime||"",makeupCall:js.makeupCall||void 0,costumeCall:js.costumeCall||void 0,hmuCall:js.hmuCall||void 0,travelTime:js.travelTime||void 0,onSetTime:js.onSetTime||void 0,notes:js.notes||void 0})),xs=us.weather?{conditions:us.weather.conditions||void 0,tempHigh:us.weather.tempHigh||void 0,tempLow:us.weather.tempLow||void 0,sunrise:us.weather.sunrise||void 0,sunset:us.weather.sunset||void 0}:void 0,ys=us.preCalls?{ads:us.preCalls.ads||void 0,hmu:us.preCalls.hmu||void 0,costume:us.preCalls.costume||void 0,production:us.preCalls.production||void 0,lighting:us.preCalls.lighting||void 0,camera:us.preCalls.camera||void 0,location:us.preCalls.location||void 0}:void 0,vs=us.unitBase?{name:us.unitBase.name||"",address:us.unitBase.address||void 0,what3words:us.unitBase.what3words||void 0,notes:us.unitBase.notes||void 0}:void 0;let gs;if(us.shootLocation)gs={name:us.shootLocation.name||"",address:us.shootLocation.address||void 0,what3words:us.shootLocation.what3words||void 0,notes:us.shootLocation.notes||void 0};else if(us.shootLocations&&us.shootLocations.length>0){const js=us.shootLocations[0],Ss=us.shootLocations.slice(1),bs=Ss.length>0?Ss.map(Es=>`${Es.id||""}: ${Es.name||""} ${Es.address||""}`).join("; "):void 0;gs={name:js.name||js.id||"",address:js.address||void 0,what3words:js.what3words||void 0,notes:bs||js.notes||void 0}}const fs=us.crewParking?{name:us.crewParking.name||"Crew Parking",address:us.crewParking.address||void 0,what3words:us.crewParking.what3words||void 0,notes:us.crewParking.notes||void 0}:void 0;return{id:v4(),date:us.date||new Date().toISOString().split("T")[0],productionDay:us.productionDay||1,totalProductionDays:us.totalProductionDays||void 0,dayType:us.dayType||void 0,unitCallTime:us.unitCallTime||"06:00",rehearsalsTime:us.rehearsalsTime||void 0,firstShotTime:us.firstShotTime||void 0,preCalls:ys,breakfastTime:us.breakfastTime||void 0,lunchTime:us.lunchTime||void 0,lunchLocation:us.lunchLocation||us.breakfastLocation||void 0,cameraWrapEstimate:us.cameraWrapEstimate||void 0,wrapEstimate:us.wrapEstimate||void 0,weather:xs,unitBase:vs,shootLocation:gs,crewParking:fs,unitNotes:Array.isArray(us.unitNotes)?us.unitNotes:void 0,scenes:ms,castCalls:ps,supportingArtists:hs,uploadedAt:new Date,pdfUri:ts,rawText:es}}catch(ls){return console.error("AI call sheet parsing failed:",ls),debugLog("ERROR: AI parsing failed, falling back to regex parser"),debugLog("Error details:",ls),fallbackParseCallSheetText(es,ts)}}function fallbackParseCallSheetText(es,ts){debugLog("Using FALLBACK regex parser (AI parsing failed)"),debugLog("NOTE: Fallback parser has limited extraction - cast, timing, action fields may be missing");const ss=Ts=>{if(!Ts)return;const $s=Ts[1].padStart(2,"0"),Ps=Ts[2]||"00";return`${$s}:${Ps}`},rs=es.match(/DAY\s*(\d+)\s*(?:OF\s*(\d+))?/i);let ns=1,os;rs&&(ns=parseInt(rs[1],10),os=rs[2]?parseInt(rs[2],10):void 0);const as=es.match(/CALL\s*SHEET\s*(\d+)\s*OF\s*(\d+)/i);as&&!rs&&(ns=parseInt(as[1],10),os=parseInt(as[2],10));let ls=new Date().toISOString().split("T")[0];const cs=es.match(/(\d{1,2})(?:ST|ND|RD|TH)?\s*(JANUARY|FEBRUARY|MARCH|APRIL|MAY|JUNE|JULY|AUGUST|SEPTEMBER|OCTOBER|NOVEMBER|DECEMBER)\s*(\d{4})/i);if(cs){const Ts={JANUARY:"01",FEBRUARY:"02",MARCH:"03",APRIL:"04",MAY:"05",JUNE:"06",JULY:"07",AUGUST:"08",SEPTEMBER:"09",OCTOBER:"10",NOVEMBER:"11",DECEMBER:"12"},$s=cs[1].padStart(2,"0"),Ps=Ts[cs[2].toUpperCase()]||"01";ls=`${cs[3]}-${Ps}-${$s}`}const us=es.match(/UNIT\s*CALL[:\s]*TIME?[:\s]*(\d{1,2})[:\.]?(\d{2})/i),ds=ss(us)||"06:00",ms=es.match(/(?:EST\.?\s*)?WRAP[:\s]*(\d{1,2})[:\.]?(\d{2})/i),ps=ss(ms),hs=es.match(/CAMERA\s*WRAP[:\s]*(\d{1,2})[:\.]?(\d{2})/i),xs=ss(hs),ys=es.match(/BREAKFAST[:\s]*(\d{1,2})[:\.]?(\d{2})/i),vs=ss(ys),gs=es.match(/(?:EST\.?\s*)?LUNCH[:\s]*(\d{1,2})[:\.]?(\d{2})/i),fs=ss(gs);let js;const Ss=es.match(/(?:HIGH|TEMP)[:\s]*(\d+)\s*[]?/i),bs=es.match(/LOW[:\s]*(\d+)\s*[]?/i),Es=es.match(/(?:SUN\s*)?RISE[S]?[:\s]*(\d{1,2})[:\.]?(\d{2})/i),Rs=es.match(/(?:SUN\s*)?SET[S]?[:\s]*(\d{1,2})[:\.]?(\d{2})/i),ws=es.match(/WEATHER[:\s]*([A-Za-z\s,]+?)(?:\s*(?:TEMP|HIGH|LOW|\d))/i);(Ss||bs||Es||Rs)&&(js={conditions:ws?ws[1].trim():void 0,tempHigh:Ss?parseInt(Ss[1],10):void 0,tempLow:bs?parseInt(bs[1],10):void 0,sunrise:ss(Es),sunset:ss(Rs)});let Ns;const ks=es.match(/HMU[:\s]*(\d{1,2})[:\.]?(\d{2})/i),_s=es.match(/COSTUME[:\s]*(\d{1,2})[:\.]?(\d{2})/i),Ls=es.match(/ADs?[:\s]*(\d{1,2})[:\.]?(\d{2})/i);(ks||_s||Ls)&&(Ns={hmu:ss(ks),costume:ss(_s),ads:ss(Ls)});let Os;const zs=es.match(/(?:LOCATION|UNIT\s*BASE)[:\s]*([^,\n]+(?:,[^,\n]+)*)/i),qs=es.match(/(?:W3W|what3words)[:\s-]*\/\/\/([a-z]+\.[a-z]+\.[a-z]+)/i);zs&&(Os={name:zs[1].trim().split(",")[0],address:zs[1].trim(),what3words:qs?`///${qs[1]}`:void 0});const Qs=es.search(/ADVANCE\s*SCHEDULE/i),Ys=Qs>0?es.slice(0,Qs):es,Ws=[],Is=/(?:SC|SCENE)?\s*(\d+[A-Z]?)\s+((?:INT|EXT)[.\s/][^D\d]*?)\s*(D\d*|N\d*|D\/N)/gi;let Bs,Vs=1;for(;(Bs=Is.exec(Ys))!==null;)Ws.push({sceneNumber:Bs[1],setDescription:Bs[2].trim(),dayNight:Bs[3],shootOrder:Vs++,status:"upcoming"});const Ds=[],Cs=es.match(/CAST\s*INFORMATION[^]*?(?=MINIBUS|TRANSPORT|DEPARTURE|ADVANCE|$)/i);if(Cs){const Ts=Cs[0];debugLog("Found CAST INFORMATION section, length:",Ts.length);const $s=/\b(\d{1,2})\s+([A-Z][A-Z\s.'-]+?)\s+([A-Z][A-Z\s'-]+?)\s+(SW?F?|W|WF|H|T|R|SWF?)\s+/gi;let Ps;for(;(Ps=$s.exec(Ts))!==null;){const Fs=Ps[1],Us=Ps[2].trim(),Gs=Ps[3].trim(),hr=Ps[4];if(Us==="NAME"||Us==="ID"||Gs==="ROLE"||Gs==="CHARACTER")continue;const ur=Ts.slice(Ps.index+Ps[0].length,Ps.index+200),cr=/(\d{1,2}:\d{2})/g,Er=ur.match(cr)||[];Ds.push({id:Fs,name:Us,character:Gs,status:hr,callTime:Er[0]||"",makeupCall:Er[1]||void 0,costumeCall:Er[2]||void 0,hmuCall:Er[3]||void 0,onSetTime:Er[4]||void 0})}debugLog("Extracted cast calls:",Ds.length),Ds.length>0&&debugLog("Sample cast call:",Ds[0])}return Ws.forEach((Ts,$s)=>{const Ps=Ys.indexOf(Ts.sceneNumber);if(Ps>=0){const Us=Ys.slice(Ps,Ps+500).match(/(?:CAST|cast)?[:\s]*(\d+(?:\s*,\s*\d+)+)/);if(Us){const Gs=Us[1].split(/\s*,\s*/).map(hr=>hr.trim());Ws[$s]={...Ts,cast:Gs},debugLog(`Scene ${Ts.sceneNumber} cast:`,Gs)}}}),{id:v4(),date:ls,productionDay:ns,totalProductionDays:os,unitCallTime:ds,breakfastTime:vs,lunchTime:fs,cameraWrapEstimate:xs,wrapEstimate:ps,weather:js,preCalls:Ns,unitBase:Os,scenes:Ws,castCalls:Ds,supportingArtists:[],uploadedAt:new Date,pdfUri:ts,rawText:es}}async function parseCallSheetPDF(es){const ts=await new Promise(rs=>{const ns=new FileReader;ns.onload=()=>rs(ns.result),ns.readAsDataURL(es)}),ss=await extractTextFromPDF$1(es);return parseCallSheetText(ss,ts)}function timeToMinutes(es){if(!es)return 0;const[ts,ss]=es.split(":").map(Number);return isNaN(ts)||isNaN(ss)?0:ts*60+ss}function minutesToTime(es){const ts=(es%1440+1440)%1440,ss=Math.floor(ts/60),rs=ts%60;return`${ss.toString().padStart(2,"0")}:${rs.toString().padStart(2,"0")}`}function timeDiffHours(es,ts){if(!es||!ts)return 0;let ss=timeToMinutes(es),rs=timeToMinutes(ts);return rs<ss&&(rs+=24*60),(rs-ss)/60}function addHoursToTime(es,ts){const ss=timeToMinutes(es)+ts*60;return minutesToTime(ss)}const BASE_CONTRACTS={"10+1":{baseWorkHours:10,label:"10+1 (10 hours + 1hr lunch)"},"11+1":{baseWorkHours:11,label:"11+1 (11 hours + 1hr lunch)"}},DAY_TYPES$1={SWD:{name:"Standard Working Day",lunchMins:60,hourReduction:0},SCWD:{name:"Semi-Continuous Working Day",lunchMins:30,hourReduction:.5},CWD:{name:"Continuous Working Day",lunchMins:0,hourReduction:1}};function getContractedWorkHours(es,ts){const ss=BASE_CONTRACTS[es].baseWorkHours,rs=DAY_TYPES$1[ts].hourReduction;return ss-rs}function getLunchDuration(es){return DAY_TYPES$1[es].lunchMins}function getHourlyRate(es,ts,ss){const rs=getContractedWorkHours(ts,ss);return rs<=0?0:es/rs}function calculatePreCall(es,ts,ss,rs=1.5){if(!es||!ts)return{hours:0,pay:0};const ns=timeDiffHours(es,ts);return ns<=0?{hours:0,pay:0}:{hours:ns,pay:ns*(ss*rs)}}function calculateOvertime(es,ts,ss,rs=1.5){const ns=Math.max(0,es-ts),os=ss*rs;return{hours:ns,pay:ns*os}}function calculateBrokenLunch(es,ts,ss,rs,ns=1.5){if(ss==="CWD"||!ts||!es)return{hours:0,pay:0};const os=addHoursToTime(es,6),as=timeToMinutes(ts),ls=timeToMinutes(os);if(as<=ls)return{hours:0,pay:0};const cs=timeDiffHours(os,ts),us=rs*ns;return{hours:cs,pay:cs*us}}function calculateBrokenTurnaround(es,ts,ss,rs,ns=1.5,os=11){if(!es||!ss)return{hours:0,pay:0};let ls=timeDiffHours(es,ts||ss);if(ls<0&&(ls+=24),ls>=os)return{hours:0,pay:0};const cs=os-ls,us=rs*ns;return{hours:cs,pay:cs*us}}function calculateLateNight(es,ts,ss,rs,ns,os=2,as="23:00"){if(!ts||!es)return{hours:0,pay:0};const ls=timeToMinutes(ts),cs=timeToMinutes(as);let us=ls;if(ls<timeToMinutes(es)&&(us=ls+24*60),us<=cs&&ls>=timeToMinutes(es))return{hours:0,pay:0};let ds;us>cs,ds=us-cs;let ms=ds/60;if(ss){const hs=timeToMinutes(ss);(hs>cs||hs<timeToMinutes(es))&&(ms-=rs/60)}ms=Math.max(0,ms);const ps=ns*(os-1);return{hours:ms,pay:ms*ps}}function applyDayMultiplier(es,ts,ss,rs=1.5,ns=2){return ss?{multiplier:ns,total:es*ns}:ts?{multiplier:rs,total:es*rs}:{multiplier:1,total:es}}function calculateBECTUTimesheet(es){if(!es.unitCallTime||!es.wrapOutTime)return createEmptyCalculation$1();const ts=getContractedWorkHours(es.baseContract,es.dayType),ss=getHourlyRate(es.dayRate,es.baseContract,es.dayType),rs=ss*es.otMultiplier,ns=es.preCallTime||es.unitCallTime,os=timeDiffHours(ns,es.wrapOutTime),as=es.lunchDuration/60,ls=Math.max(0,os-as),cs=calculatePreCall(es.preCallTime,es.unitCallTime,ss,es.preCallMultiplier),us=timeDiffHours(es.unitCallTime,es.wrapOutTime)-as,ds=calculateOvertime(Math.max(0,us),ts,ss,es.otMultiplier),ms=calculateBrokenLunch(es.unitCallTime,es.lunchTime,es.dayType,ss,es.otMultiplier),ps=calculateBrokenTurnaround(es.previousWrapOut,es.preCallTime,es.unitCallTime,ss,es.otMultiplier),hs=calculateLateNight(es.unitCallTime,es.wrapOutTime,es.lunchTime,es.lunchDuration,ss,es.lateNightMultiplier),xs=es.dayRate,ys=xs+cs.pay+ds.pay+ms.pay+ps.pay+hs.pay,vs=applyDayMultiplier(ys,es.is6thDay,es.is7thDay,es.sixthDayMultiplier,es.seventhDayMultiplier);return{contractedHours:round2(ts),hourlyRate:round2(ss),otRate:round2(rs),actualWorkHours:round2(ls),preCallHours:round2(cs.hours),overtimeHours:round2(ds.hours),brokenLunchHours:round2(ms.hours),brokenTurnaroundHours:round2(ps.hours),lateNightHours:round2(hs.hours),basePay:round2(xs),preCallPay:round2(cs.pay),overtimePay:round2(ds.pay),brokenLunchPay:round2(ms.pay),brokenTurnaroundPay:round2(ps.pay),lateNightPay:round2(hs.pay),subtotal:round2(ys),dayMultiplier:vs.multiplier,totalPay:round2(vs.total),hasBrokenLunch:ms.hours>0,hasBrokenTurnaround:ps.hours>0,hasLateNight:hs.hours>0,hasOvertime:ds.hours>0}}function createEmptyCalculation$1(){return{contractedHours:0,hourlyRate:0,otRate:0,actualWorkHours:0,preCallHours:0,overtimeHours:0,brokenLunchHours:0,brokenTurnaroundHours:0,lateNightHours:0,basePay:0,preCallPay:0,overtimePay:0,brokenLunchPay:0,brokenTurnaroundPay:0,lateNightPay:0,subtotal:0,dayMultiplier:1,totalPay:0,hasBrokenLunch:!1,hasBrokenTurnaround:!1,hasLateNight:!1,hasOvertime:!1}}function round2(es){return Math.round(es*100)/100}function baseDayHoursToContract(es){return es===10?"10+1":"11+1"}function createEmptyCalculation(){return{contractedHours:0,hourlyRate:0,otRate:0,preCallHours:0,preCallEarnings:0,workingHours:0,actualWorkHours:0,baseHours:0,otHours:0,brokenLunchHours:0,brokenTurnaroundHours:0,lateNightHours:0,totalHours:0,dailyEarnings:0,basePay:0,otEarnings:0,overtimePay:0,brokenLunchPay:0,brokenTurnaroundPay:0,lateNightEarnings:0,lateNightPay:0,sixthDayBonus:0,seventhDayBonus:0,dayMultiplier:1,subtotal:0,kitRental:0,totalEarnings:0,totalPay:0,brokenLunch:!1,hasBrokenLunch:!1,brokenTurnaround:!1,hasBrokenTurnaround:!1,hasLateNight:!1,hasOvertime:!1}}function toBECTUEntry(es,ts,ss){const rs=ts.baseContract||baseDayHoursToContract(ts.baseDayHours);return{date:es.date,dayRate:ts.dailyRate,baseContract:rs,dayType:es.dayType,preCallTime:es.preCall||null,unitCallTime:es.unitCall,lunchTime:es.lunchStart||es.callSheetLunch||null,lunchDuration:es.lunchTaken||getLunchDuration(es.dayType),wrapOutTime:es.wrapOut,is6thDay:es.isSixthDay,is7thDay:es.isSeventhDay,previousWrapOut:es.previousWrapOut||ss||null,preCallMultiplier:ts.preCallMultiplier,otMultiplier:ts.otMultiplier,lateNightMultiplier:ts.lateNightMultiplier,sixthDayMultiplier:ts.sixthDayMultiplier,seventhDayMultiplier:ts.seventhDayMultiplier}}function formatDateString(es){return es.toISOString().split("T")[0]}function addDays(es,ts){const ss=new Date(es);return ss.setDate(ss.getDate()+ts),formatDateString(ss)}function getWeekStart(es){const ts=new Date(es),ss=ts.getDay(),rs=ts.getDate()-ss+(ss===0?-6:1);return ts.setDate(rs),formatDateString(ts)}const useTimesheetStore=create()(persist((es,ts)=>({rateCard:createDefaultRateCard(),entries:{},selectedDate:formatDateString(new Date),viewMode:"week",editingEntry:!1,updateRateCard:ss=>{es(rs=>({rateCard:{...rs.rateCard,...ss}}))},getEntry:ss=>ts().entries[ss]||createEmptyTimesheetEntry(ss),saveEntry:ss=>{es(rs=>({entries:{...rs.entries,[ss.date]:ss}}))},deleteEntry:ss=>{es(rs=>{const ns={...rs.entries};return delete ns[ss],{entries:ns}})},clearAll:()=>{es({rateCard:createDefaultRateCard(),entries:{},selectedDate:formatDateString(new Date),viewMode:"week",editingEntry:!1})},setSelectedDate:ss=>es({selectedDate:ss}),setViewMode:ss=>es({viewMode:ss}),setEditingEntry:ss=>es({editingEntry:ss}),navigateDay:ss=>{const rs=ts(),ns=addDays(rs.selectedDate,ss==="next"?1:-1);es({selectedDate:ns})},autoFillFromCallSheet:(ss,rs)=>{var us;const ns=ts().entries[ss]||createEmptyTimesheetEntry(ss),os=parseDayTypeFromString(rs.dayType),as=getLunchDurationForDayType(os),ls=((us=rs.preCalls)==null?void 0:us.hmu)||"";return{...ns,preCall:ls||ns.preCall,unitCall:rs.unitCallTime||ns.unitCall,dayType:os,wrapOut:ns.wrapOut||"",outOfChair:ns.outOfChair||"",lunchTaken:as,productionDay:rs.productionDay,autoFilledFrom:rs.id,callSheetUnitCall:rs.unitCallTime,callSheetLunch:rs.lunchTime,callSheetWrap:rs.wrapEstimate}},calculateEntry:(ss,rs)=>{const{rateCard:ns}=ts();if(!ss.unitCall||!ss.wrapOut)return createEmptyCalculation();const os=toBECTUEntry(ss,ns,rs),as=calculateBECTUTimesheet(os);let ls=0,cs=0;ss.isSeventhDay?cs=as.subtotal*(ns.seventhDayMultiplier-1):ss.isSixthDay&&(ls=as.subtotal*(ns.sixthDayMultiplier-1));const us=ns.kitRental,ds=as.totalPay+us;return{contractedHours:as.contractedHours,hourlyRate:as.hourlyRate,otRate:as.otRate,preCallHours:as.preCallHours,workingHours:as.actualWorkHours,actualWorkHours:as.actualWorkHours,baseHours:as.contractedHours,otHours:as.overtimeHours,brokenLunchHours:as.brokenLunchHours,brokenTurnaroundHours:as.brokenTurnaroundHours,lateNightHours:as.lateNightHours,totalHours:as.actualWorkHours+as.preCallHours,preCallEarnings:as.preCallPay,dailyEarnings:as.basePay,basePay:as.basePay,otEarnings:as.overtimePay,overtimePay:as.overtimePay,brokenLunchPay:as.brokenLunchPay,brokenTurnaroundPay:as.brokenTurnaroundPay,lateNightEarnings:as.lateNightPay,lateNightPay:as.lateNightPay,sixthDayBonus:Math.round(ls*100)/100,seventhDayBonus:Math.round(cs*100)/100,dayMultiplier:as.dayMultiplier,subtotal:as.subtotal,kitRental:us,totalEarnings:Math.round(ds*100)/100,totalPay:Math.round(ds*100)/100,brokenLunch:as.hasBrokenLunch,hasBrokenLunch:as.hasBrokenLunch,brokenTurnaround:as.hasBrokenTurnaround,hasBrokenTurnaround:as.hasBrokenTurnaround,hasLateNight:as.hasLateNight,hasOvertime:as.hasOvertime}},getPreviousWrapOut:ss=>{const rs=addDays(ss,-1),ns=ts().entries[rs];return(ns==null?void 0:ns.wrapOut)||void 0},getWeekSummary:ss=>{const rs=ts(),ns=[];for(let Rs=0;Rs<7;Rs++){const ws=addDays(ss,Rs);rs.entries[ws]&&ns.push(rs.entries[ws])}let os=0,as=0,ls=0,cs=0,us=0,ds=0,ms=0,ps=0,hs=0,xs=0,ys=0,vs=0,gs=0,fs=0,js=0,Ss=0,bs=0;const Es=[...ns].sort((Rs,ws)=>Rs.date.localeCompare(ws.date));return Es.forEach((Rs,ws)=>{const Ns=ws>0?Es[ws-1].wrapOut:rs.getPreviousWrapOut(Rs.date),ks=rs.calculateEntry(Rs,Ns);os+=ks.totalHours,as+=ks.preCallHours,ls+=ks.baseHours,cs+=ks.otHours,us+=ks.lateNightHours,ds+=ks.brokenLunchHours,ms+=ks.brokenTurnaroundHours,Rs.isSixthDay&&!Rs.isSeventhDay&&(ps+=ks.totalHours),Rs.isSeventhDay&&(hs+=ks.totalHours),xs+=ks.totalEarnings,vs+=ks.basePay,gs+=ks.overtimePay,fs+=ks.preCallEarnings,js+=ks.brokenLunchPay,Ss+=ks.brokenTurnaroundPay,bs+=ks.lateNightPay,Rs.unitCall&&Rs.wrapOut&&(ys+=rs.rateCard.kitRental)}),{startDate:ss,endDate:addDays(ss,6),totalHours:Math.round(os*10)/10,preCallHours:Math.round(as*10)/10,baseHours:Math.round(ls*10)/10,otHours:Math.round(cs*10)/10,sixthDayHours:Math.round(ps*10)/10,seventhDayHours:Math.round(hs*10)/10,lateNightHours:Math.round(us*10)/10,brokenLunchHours:Math.round(ds*10)/10,brokenTurnaroundHours:Math.round(ms*10)/10,kitRentalTotal:ys,totalEarnings:Math.round(xs*100)/100,entries:ns,basePay:Math.round(vs*100)/100,overtimePay:Math.round(gs*100)/100,preCallPay:Math.round(fs*100)/100,brokenLunchPay:Math.round(js*100)/100,brokenTurnaroundPay:Math.round(Ss*100)/100,lateNightPay:Math.round(bs*100)/100}},getMonthEntries:(ss,rs)=>{const ns=ts(),os=[],as=new Date(ss,rs,1),ls=new Date(ss,rs+1,0),cs=new Date(as);for(;cs<=ls;){const us=formatDateString(cs);ns.entries[us]&&os.push(ns.entries[us]),cs.setDate(cs.getDate()+1)}return os}}),{name:"hair-makeup-timesheet-storage",storage:createHybridStorage("hair-makeup-timesheet-storage"),merge:(es,ts)=>({...ts,...es,entries:{...ts.entries,...(es==null?void 0:es.entries)||{}}})})),STORE_VERSION=2;function validateCallSheet(es){return!es.id||!es.date||!Array.isArray(es.scenes)?!1:es.scenes.length>50?(console.warn(`Call sheet ${es.id} has ${es.scenes.length} scenes - possible data corruption`),!1):!0}const useCallSheetStore=create()(persist((es,ts)=>({callSheets:[],activeCallSheetId:null,isUploading:!1,uploadError:null,uploadCallSheet:async ss=>{es({isUploading:!0,uploadError:null});try{const rs=await parseCallSheetPDF(ss),ns={...rs,scenes:[...rs.scenes]},os=ts().callSheets.find(cs=>cs.date===ns.date||cs.productionDay===ns.productionDay),as=cs=>{if(cs.date){const us=useTimesheetStore.getState(),ds=us.autoFillFromCallSheet(cs.date,cs);us.saveEntry(ds)}},ls=cs=>{const us=useProjectStore.getState(),ds=us.currentProject;ds!=null&&ds.scenes&&cs.scenes.forEach(ms=>{if(!ms.action)return;const ps=ds.scenes.find(hs=>hs.sceneNumber===ms.sceneNumber);ps&&!ps.synopsis&&us.updateSceneSynopsis(ps.id,ms.action)})};if(os){const cs={...ns,id:os.id};return es(us=>({callSheets:us.callSheets.map(ds=>ds.id===os.id?cs:ds),isUploading:!1,activeCallSheetId:os.id})),as(cs),ls(cs),cs}return es(cs=>({callSheets:[...cs.callSheets,ns].sort((us,ds)=>us.productionDay-ds.productionDay),isUploading:!1,activeCallSheetId:ns.id})),as(ns),ls(ns),ns}catch(rs){const ns=rs instanceof Error?rs.message:"Failed to parse call sheet";throw es({isUploading:!1,uploadError:ns}),rs}},setActiveCallSheet:ss=>{es({activeCallSheetId:ss})},getActiveCallSheet:()=>{const ss=ts();return ss.activeCallSheetId?ss.callSheets.find(rs=>rs.id===ss.activeCallSheetId)||null:[...ss.callSheets].sort((ns,os)=>new Date(os.date).getTime()-new Date(ns.date).getTime())[0]||null},getCallSheetByDate:ss=>ts().callSheets.find(rs=>rs.date===ss)||null,getCallSheetByDay:ss=>ts().callSheets.find(rs=>rs.productionDay===ss)||null,deleteCallSheet:ss=>{es(rs=>({callSheets:rs.callSheets.filter(ns=>ns.id!==ss),activeCallSheetId:rs.activeCallSheetId===ss?null:rs.activeCallSheetId}))},updateSceneStatus:(ss,rs,ns)=>{es(os=>({callSheets:os.callSheets.map(as=>as.id!==ss?as:{...as,scenes:as.scenes.map(ls=>ls.sceneNumber===rs?{...ls,status:ns,completedAt:ns==="wrapped"?new Date().toISOString():ls.completedAt}:ls)})}))},updateSceneFilmingStatus:(ss,rs,ns,os)=>{es(as=>({callSheets:as.callSheets.map(ls=>ls.id!==ss?ls:{...ls,scenes:ls.scenes.map(cs=>cs.sceneNumber===rs?{...cs,filmingStatus:ns,filmingNotes:os,status:"wrapped",completedAt:new Date().toISOString()}:cs)})}))},clearAll:()=>{es({callSheets:[],activeCallSheetId:null})}}),{name:"hair-makeup-callsheets",version:STORE_VERSION,storage:createHybridStorage("hair-makeup-callsheets"),partialize:es=>({callSheets:es.callSheets,activeCallSheetId:es.activeCallSheetId}),migrate:(es,ts)=>{const ss=es;if(ts<STORE_VERSION){console.log(`Migrating call sheet store from version ${ts} to ${STORE_VERSION}`);const rs=(ss.callSheets||[]).filter(validateCallSheet);return rs.length!==(ss.callSheets||[]).length&&console.warn("Removed corrupted call sheet data during migration"),{callSheets:rs,activeCallSheetId:ss.activeCallSheetId||null,isUploading:!1,uploadError:null}}return ss},merge:(es,ts)=>{const ss=es,rs=(ss.callSheets||[]).filter(validateCallSheet);return{...ts,callSheets:rs,activeCallSheetId:ss.activeCallSheetId||null}}}));function formatDuration(es){if(es<60)return`${es}m`;const ts=Math.floor(es/60),ss=es%60;return ss===0?`${ts}hr`:`${ts}hr ${ss}m`}function splitCombinedSceneNumber(es){const ts=new Set;ts.add(es),es.split(/[\/]/).map(ls=>ls.trim()).filter(Boolean).forEach(ls=>ts.add(ls)),es.split(/[,]/).map(ls=>ls.trim()).filter(Boolean).forEach(ls=>ts.add(ls));const ns=es.match(/^(\d+[A-Za-z]?)(?:pt|part|PT|PART|-|\s)/i);ns&&ts.add(ns[1]);const os=es.match(/^(\d+)/);os&&os[1]!==es&&ts.add(os[1]);const as=[...ts];for(const ls of as){const cs=ls.match(/^(\d+)[A-Za-z]$/);cs&&ts.add(cs[1])}return[...ts]}function Today({onSceneSelect:es,onNavigateToTab:ts}){var xr;const{currentProject:ss,updateSceneFilmingStatus:rs,addScene:ns,addCharacterToScene:os,addCharacterFromScene:as,setCurrentCharacter:ls}=useProjectStore(),cs=useCallSheetStore(Ms=>Ms.callSheets),us=useCallSheetStore(Ms=>Ms.activeCallSheetId),ds=useCallSheetStore(Ms=>Ms.getCallSheetByDate),ms=useCallSheetStore(Ms=>Ms.uploadCallSheet),ps=useCallSheetStore(Ms=>Ms.isUploading),hs=useCallSheetStore(Ms=>Ms.uploadError),xs=useCallSheetStore(Ms=>Ms.updateSceneStatus),[ys,vs]=reactExports.useState(new Date),[gs,fs]=reactExports.useState(!1),[js,Ss]=reactExports.useState(!1),[bs,Es]=reactExports.useState(new Map),Rs=reactExports.useMemo(()=>{const Ms=ys.toISOString().split("T")[0];return ds(Ms)},[ys,ds,cs]),ws=reactExports.useMemo(()=>us?cs.find(Ms=>Ms.id===us)||null:[...cs].sort((Hs,Js)=>new Date(Js.date).getTime()-new Date(Hs.date).getTime())[0]||null,[cs,us]),Ns=Rs||ws,ks=reactExports.useMemo(()=>Ns?bs.size===0?Ns:{...Ns,scenes:Ns.scenes.map(Ms=>{const Hs=bs.get(Ms.sceneNumber);return Hs?{...Ms,...Hs}:Ms})}:null,[Ns,bs]);reactExports.useEffect(()=>{Es(new Map)},[Ns==null?void 0:Ns.id]),reactExports.useEffect(()=>{ws!=null&&ws.date&&vs(new Date(ws.date))},[ws==null?void 0:ws.id,ws==null?void 0:ws.date]);const[_s,Ls]=reactExports.useState(null),[Os,zs]=reactExports.useState(null),qs=reactExports.useRef(null),Qs=async Ms=>{var Js;const Hs=(Js=Ms.target.files)==null?void 0:Js[0];if(Hs&&Hs.type==="application/pdf")try{await ms(Hs)}catch(Zs){console.error("Failed to upload call sheet:",Zs)}qs.current&&(qs.current.value="")},Ys=Ms=>{const Hs=new Date(ys);Hs.setDate(Hs.getDate()+Ms),vs(Hs),Es(new Map)},Ws=reactExports.useMemo(()=>{if(!ks)return[];if(gs)return[...ks.scenes].sort((Hs,Js)=>Hs.shootOrder-Js.shootOrder);const Ms={"in-progress":0,upcoming:1,wrapped:2};return[...ks.scenes].sort((Hs,Js)=>{const Zs=Ms[Hs.status]-Ms[Js.status];return Zs!==0?Zs:Hs.shootOrder-Js.shootOrder})},[ks,gs]),Is=(Ms,Hs)=>{if(!ks)return;const Js=[...ks.scenes].sort((Pr,Ar)=>Pr.shootOrder-Ar.shootOrder),Zs=Js.findIndex(Pr=>Pr.sceneNumber===Ms);if(Zs===-1||Hs==="up"&&Zs===0||Hs==="down"&&Zs===Js.length-1)return;const dr=Hs==="up"?Zs-1:Zs+1,br=Js[Zs].shootOrder,Rr=Js[dr].shootOrder,ar=Js[dr].sceneNumber;Es(Pr=>{const Ar=new Map(Pr),Gr=Ar.get(Ms)||{},Dr=Ar.get(ar)||{};return Ar.set(Ms,{...Gr,shootOrder:Rr}),Ar.set(ar,{...Dr,shootOrder:br}),Ar})},Bs=reactExports.useMemo(()=>ss?new Map(ss.scenes.map(Ms=>[Ms.sceneNumber,Ms])):new Map,[ss==null?void 0:ss.scenes]),Vs=reactExports.useMemo(()=>ss?new Map(ss.characters.map(Ms=>[Ms.id,Ms])):new Map,[ss==null?void 0:ss.characters]),Ds=reactExports.useMemo(()=>{if(!ss)return new Map;const Ms=new Map;for(const Hs of ss.scenes){const Js=Hs.characters.map(Zs=>Vs.get(Zs)).filter(Zs=>Zs!==void 0);Ms.set(Hs.sceneNumber,Js)}return Ms},[ss==null?void 0:ss.scenes,Vs]),Cs=reactExports.useMemo(()=>{if(!ss)return new Map;const Ms=new Map;for(const Hs of ss.looks)for(const Js of Hs.scenes)Ms.set(`${Hs.characterId}-${Js}`,Hs);return Ms},[ss==null?void 0:ss.looks]),Ts=reactExports.useMemo(()=>{if(!ss)return new Map;const Ms=new Map;for(const Hs of ss.looks){const Js=Vs.get(Hs.characterId);if(Js!=null&&Js.actorNumber)for(const Zs of Hs.scenes)Ms.set(`${Js.actorNumber}-${Zs}`,Hs)}return Ms},[ss==null?void 0:ss.looks,Vs]),$s=reactExports.useMemo(()=>ks!=null&&ks.castCalls?new Map(ks.castCalls.map(Ms=>[Ms.id,Ms])):new Map,[ks==null?void 0:ks.castCalls]),Ps=reactExports.useMemo(()=>{if(!ks)return new Map;const Ms=new Map;for(const Hs of ks.scenes){if(!Hs.cast||Hs.cast.length===0)continue;const Js=[];for(const Zs of Hs.cast){const dr=$s.get(Zs);if(dr){const br=dr.character||dr.name||`Cast #${Zs}`,Rr=br.split(" ").map(ar=>ar.charAt(0).toUpperCase()).join("").slice(0,2);Js.push({id:`cast-${Zs}`,name:br,initials:Rr,actorNumber:parseInt(Zs,10)||void 0})}else Js.push({id:`cast-${Zs}`,name:`Cast #${Zs}`,initials:Zs.slice(0,2),actorNumber:parseInt(Zs,10)||void 0})}Ms.set(Hs.sceneNumber,Js)}return Ms},[ks==null?void 0:ks.scenes,$s]),Fs=Ms=>{const Hs=Bs.get(Ms);if(Hs)return Hs;const Js=splitCombinedSceneNumber(Ms);for(const Zs of Js){const dr=Bs.get(Zs);if(dr)return dr}},Us=Ms=>{if(!ss||!Ms)return;const Hs=Ms.toUpperCase().trim(),Js=ss.characters.find(Rr=>Rr.name.toUpperCase().trim()===Hs);if(Js)return Js;const Zs=ss.characters.find(Rr=>Rr.name.toUpperCase().trim().split(" ")[0]===Hs);if(Zs)return Zs;const dr=ss.characters.find(Rr=>Rr.name.toUpperCase().trim().startsWith(Hs+" "));if(dr)return dr;const br=ss.characters.find(Rr=>{const ar=Rr.name.toUpperCase().trim().split(" ")[0];return Hs.includes(ar)&&ar.length>2});if(br)return br},Gs=Ms=>{const Hs=Ds.get(Ms)||[];if(Hs.length>0)return Hs;const Js=splitCombinedSceneNumber(Ms);for(const dr of Js){const br=Ds.get(dr)||[];if(br.length>0)return br}const Zs=Ps.get(Ms)||[];return Zs.length>0?Zs.map(dr=>{const br=Us(dr.name);return br?{...br,actorNumber:dr.actorNumber}:dr}):[]},hr=(Ms,Hs,Js)=>{const Zs=splitCombinedSceneNumber(Hs);for(const dr of Zs){const br=Cs.get(`${Ms}-${dr}`);if(br)return br}if(Js)for(const dr of Zs){const br=Ts.get(`${Js}-${dr}`);if(br)return br}if(ss&&!Ms.startsWith("cast-"))return ss.looks.find(dr=>dr.characterId===Ms)},ur=reactExports.useMemo(()=>ks!=null&&ks.castCalls?ks.castCalls.filter(Ms=>Ms.hmuCall||Ms.makeupCall).sort((Ms,Hs)=>{const Js=Ms.hmuCall||Ms.makeupCall||"",Zs=Hs.hmuCall||Hs.makeupCall||"";return Js.localeCompare(Zs)}):[],[ks==null?void 0:ks.castCalls]),cr=reactExports.useMemo(()=>{if(!(ks!=null&&ks.scenes)||!ks.firstShotTime)return null;const Ms=Dr=>{const Yr=Dr.match(/(\d{1,2}):(\d{2})/);return Yr?parseInt(Yr[1],10)*60+parseInt(Yr[2],10):null},Hs=[...ks.scenes].sort((Dr,Yr)=>Dr.shootOrder-Yr.shootOrder),Js=Hs.filter(Dr=>Dr.status==="wrapped"&&Dr.completedAt);if(Js.length===0)return{status:"not-started",completedCount:0,totalCount:ks.scenes.length};const Zs=Js[Js.length-1];let dr=null;if(Zs.estimatedTime){const Dr=Zs.estimatedTime.match(/-\s*(\d{1,2}:\d{2})/);Dr&&(dr=Ms(Dr[1]))}const br=new Date(Zs.completedAt),Rr=br.getHours()*60+br.getMinutes();if(dr!==null&&Rr<dr-2)return{status:"ahead",diffMinutes:dr-Rr,completedCount:Js.length,totalCount:ks.scenes.length};const ar=Hs.find(Dr=>Dr.status!=="wrapped");if(!ar)return{status:"completed",completedCount:Js.length,totalCount:ks.scenes.length};let Pr=null;if(ar.estimatedTime){const Dr=ar.estimatedTime.match(/^(\d{1,2}:\d{2})/);Dr&&(Pr=Ms(Dr[1]))}if(Pr===null)return{status:"unknown",completedCount:Js.length,totalCount:ks.scenes.length};const Ar=new Date,Gr=Ar.getHours()*60+Ar.getMinutes();return Gr>Pr+2?{status:"behind",diffMinutes:Gr-Pr,completedCount:Js.length,totalCount:ks.scenes.length}:{status:"on-track",completedCount:Js.length,totalCount:ks.scenes.length}},[ks==null?void 0:ks.scenes,ks==null?void 0:ks.firstShotTime]),Er=(Ms,Hs)=>{Ns&&(Es(Js=>{const Zs=new Map(Js),dr=Zs.get(Ms)||{};return Zs.set(Ms,{...dr,status:Hs}),Zs}),xs(Ns.id,Ms,Hs))},Nr=(Ms,Hs,Js)=>{Ns&&(Es(Zs=>{const dr=new Map(Zs),br=dr.get(Ms)||{};return dr.set(Ms,{...br,status:"wrapped"}),dr}),xs(Ns.id,Ms,"wrapped"),rs(Ms,Hs,Js))},kr=Ms=>{const Hs=Fs(Ms);Hs&&es(Hs.id)},mr=(Ms,Hs,Js)=>{const Zs=Ms.id.startsWith("cast-"),dr=Fs(Hs);if(dr){if(Zs){const Rr=as(dr.id,Ms.name);if(Ms.actorNumber){const ar=useProjectStore.getState();if(ar.currentProject){const Pr=ar.currentProject.characters.map(Ar=>Ar.id===Rr.id?{...Ar,actorNumber:Ms.actorNumber}:Ar);useProjectStore.setState({currentProject:{...ar.currentProject,characters:Pr}})}}os(dr.id,Rr.id),ls(Rr.id)}else ls(Ms.id);es(dr.id);return}const br=[];if(ss){const Rr=splitCombinedSceneNumber(Hs);for(const ar of ss.scenes){const Pr=splitCombinedSceneNumber(ar.sceneNumber);Rr.some(Gr=>Pr.some(Dr=>Dr===Gr||Dr.startsWith(Gr)||Gr.startsWith(Dr)))&&!br.includes(ar)&&br.push(ar)}}if(Zs){let Rr=Ms;if(ss){const ar=Us(Ms.name);ar&&(Rr=ar)}zs({sceneNumber:Hs,character:Rr,callSheetScene:Js,suggestedMergeScenes:br});return}zs({sceneNumber:Hs,character:Ms,callSheetScene:Js,suggestedMergeScenes:br})};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("input",{ref:qs,type:"file",accept:".pdf",onChange:Qs,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ys(-1),className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:formatShortDate(ys)}),jsxRuntimeExports.jsx("button",{onClick:()=>Ys(1),className:"p-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{var Ms;return(Ms=qs.current)==null?void 0:Ms.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:ps,title:"Upload call sheet",children:ps?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),ks&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>fs(!gs),className:clsx("p-2 rounded-lg transition-colors touch-manipulation",gs?"bg-gold text-white":"text-text-muted hover:text-gold"),title:gs?"Done reordering":"Reorder scenes",children:gs?jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})}),jsxRuntimeExports.jsxs("button",{onClick:()=>ts==null?void 0:ts("callsheets"),className:"flex items-center gap-1.5 px-2.5 py-1 text-xs font-semibold rounded-full bg-gold-100 text-gold active:bg-gold-200 transition-colors",title:"View call sheet PDF",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Day ",ks.productionDay]})]})]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 space-y-4",children:[hs&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:hs})}),ks?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-3",children:jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"CALL TIMES"})}),(()=>{const Ms=parseDayTypeFromString(ks.dayType);return jsxRuntimeExports.jsxs("div",{className:"mb-3 pb-3 border-b border-border/50 flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:clsx("px-2 py-0.5 text-xs font-bold rounded",Ms==="CWD"&&"bg-amber-100 text-amber-700",Ms==="SCWD"&&"bg-orange-100 text-orange-700",Ms==="SWD"&&"bg-blue-100 text-blue-700"),children:Ms}),cr&&(cr.status==="ahead"||cr.status==="behind")&&jsxRuntimeExports.jsxs("div",{className:clsx("flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium",cr.status==="ahead"&&"bg-blue-50 text-blue-600",cr.status==="behind"&&"bg-red-50 text-red-600"),children:[cr.status==="ahead"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 10l7-7m0 0l7 7m-7-7v18"})}),jsxRuntimeExports.jsxs("span",{children:[formatDuration(cr.diffMinutes)," ahead"]})]}),cr.status==="behind"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}),jsxRuntimeExports.jsxs("span",{children:[formatDuration(cr.diffMinutes)," behind"]})]})]})]})})(),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Unit Call"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ks.unitCallTime})]}),((xr=ks.preCalls)==null?void 0:xr.hmu)&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"HMU Pre-call"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-gold",children:ks.preCalls.hmu})]}),ks.firstShotTime&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"First Shot"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ks.firstShotTime})]}),ks.lunchTime&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Lunch"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ks.lunchTime})]}),ks.cameraWrapEstimate&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Camera Wrap"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ks.cameraWrapEstimate})]}),ks.wrapEstimate&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Est. Wrap"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ks.wrapEstimate})]})]})]}),ur.length>0&&jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Ss(!js),className:"w-full flex items-center justify-between touch-manipulation",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"HMU CALLS"}),jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-semibold rounded-full bg-gold-100 text-gold",children:ur.length})]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 text-text-muted transition-transform",js&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),js&&jsxRuntimeExports.jsx("div",{className:"space-y-2 mt-3 pt-3 border-t border-border/30",children:ur.map(Ms=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-border/30 last:border-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary truncate block",children:Ms.character}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate block",children:Ms.name})]}),jsxRuntimeExports.jsxs("div",{className:"text-right ml-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-gold",children:Ms.hmuCall||Ms.makeupCall}),Ms.onSetTime&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:["On set: ",Ms.onSetTime]})]})]},Ms.id))})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between",children:jsxRuntimeExports.jsxs("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:["TODAY'S SCENES (",Ws.length,")"]})}),gs&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Drag to reorder shooting schedule"}),jsxRuntimeExports.jsx("button",{onClick:()=>fs(!1),className:"text-sm font-medium text-gold",children:"Done"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2.5",children:Ws.map((Ms,Hs)=>{const Js=Fs(Ms.sceneNumber),Zs=Gs(Ms.sceneNumber);return jsxRuntimeExports.jsx(TodaySceneCard,{shootingScene:Ms,scene:Js,characters:Zs,getLookForCharacter:hr,onTap:()=>kr(Ms.sceneNumber),onCharacterTap:dr=>mr(dr,Ms.sceneNumber,Ms),onSynopsisClick:dr=>Ls(dr),onStatusChange:dr=>Er(Ms.sceneNumber,dr),onFilmingStatusChange:(dr,br)=>Nr(Ms.sceneNumber,dr,br),isReorderMode:gs,isFirst:Hs===0,isLast:Hs===Ws.length-1,onMoveUp:()=>Is(Ms.sceneNumber,"up"),onMoveDown:()=>Is(Ms.sceneNumber,"down")},Ms.sceneNumber)})})]}):jsxRuntimeExports.jsx(EmptyState$2,{hasAnyCallSheets:cs.length>0,onUploadClick:()=>{var Ms;return(Ms=qs.current)==null?void 0:Ms.click()},isUploading:ps})]}),_s&&jsxRuntimeExports.jsx(SceneScriptModal,{scene:_s,onClose:()=>Ls(null)}),Os&&jsxRuntimeExports.jsx(UnmatchedSceneModal,{info:Os,onClose:()=>zs(null),onAddScene:Ms=>{const Hs=ns(Ms);os(Hs.id,Os.character.id),zs(null),es(Hs.id)},onMergeWithScene:Ms=>{Ms.characters.includes(Os.character.id)||os(Ms.id,Os.character.id),zs(null),es(Ms.id)}})]})}const TodaySceneCard=reactExports.memo(function es({shootingScene:ts,scene:ss,characters:rs,getLookForCharacter:ns,onTap:os,onCharacterTap:as,onSynopsisClick:ls,onStatusChange:cs,onFilmingStatusChange:us,isReorderMode:ds=!1,isFirst:ms=!1,isLast:ps=!1,onMoveUp:hs,onMoveDown:xs}){const[ys,vs]=reactExports.useState(!1),[gs,fs]=reactExports.useState(!1),[js,Ss]=reactExports.useState(!1),[bs,Es]=reactExports.useState((ss==null?void 0:ss.filmingNotes)||""),Rs=reactExports.useRef(null);reactExports.useEffect(()=>{const Is=Bs=>{Rs.current&&!Rs.current.contains(Bs.target)&&Ss(!1)};return document.addEventListener("mousedown",Is),()=>document.removeEventListener("mousedown",Is)},[]);const ws=reactExports.useMemo(()=>{if(ss)return null;const Is=ts.setDescription||"",Bs=Is.match(/^(INT|EXT)\./i),Vs=Is.match(/- (DAY|NIGHT|MORNING|EVENING|DUSK|DAWN|CONTINUOUS)$/i),Ds=Is.match(/^(?:INT|EXT)\.\s*(.+?)(?:\s*-\s*(?:DAY|NIGHT|MORNING|EVENING|DUSK|DAWN|CONTINUOUS))?$/i);return{intExt:Bs?Bs[1].toUpperCase():null,timeOfDay:Vs?Vs[1].toUpperCase():null,location:Ds?Ds[1].trim():Is}},[ss,ts.setDescription]),Ns=ss==null?void 0:ss.filmingStatus,ks=ss==null?void 0:ss.filmingNotes,Ls=(()=>{if(!Ns)return null;switch(Ns){case"complete":return"scene-glass-complete";case"partial":return"scene-glass-partial";case"not-filmed":return"scene-glass-incomplete";default:return null}})(),Os={upcoming:"Upcoming","in-progress":"In Progress",wrapped:"Wrapped"},qs=(()=>{if(Ns){const Bs=SCENE_FILMING_STATUS_CONFIG[Ns];return{bg:Bs.bgClass,text:Bs.textClass,label:Bs.shortLabel,color:Bs.color}}return{...{upcoming:{bg:"bg-gray-100",text:"text-text-muted",color:"#6b7280"},"in-progress":{bg:"bg-gold-100/50",text:"text-gold",color:"#C9A962"},wrapped:{bg:"bg-green-50",text:"text-green-600",color:"#22c55e"}}[ts.status],label:Os[ts.status]}})(),Qs=()=>{vs(!0)},Ys=Is=>{Is==="not-filmed"||Is==="partial"?(fs(!0),Ss(!1)):(us(Is),Ss(!1))},Ws=Is=>{us(Is,bs),fs(!1),vs(!1)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:clsx("relative",js&&"z-40"),children:[ds&&jsxRuntimeExports.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 z-20 flex flex-col gap-1",children:[jsxRuntimeExports.jsx("button",{onClick:Is=>{Is.stopPropagation(),hs==null||hs()},disabled:ms,className:clsx("p-2 rounded-lg transition-all touch-manipulation",ms?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-gold hover:bg-gold/10 active:scale-95"),children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),jsxRuntimeExports.jsx("button",{onClick:Is=>{Is.stopPropagation(),xs==null||xs()},disabled:ps,className:clsx("p-2 rounded-lg transition-all touch-manipulation",ps?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-gold hover:bg-gold/10 active:scale-95"),children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]}),jsxRuntimeExports.jsxs("div",{onClick:ds?void 0:os,onContextMenu:Is=>{ds||(Is.preventDefault(),Qs())},className:clsx("w-full text-left card transition-all relative",!js&&"overflow-hidden",ds?"pr-16":"active:scale-[0.98] cursor-pointer"),children:[Ls&&jsxRuntimeExports.jsx("div",{className:clsx("scene-glass-overlay",Ls)}),jsxRuntimeExports.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 rounded-l-card",style:{background:ts.status==="in-progress"?"linear-gradient(180deg, #d4a853 0%, #c9a962 100%)":ts.status==="wrapped"?Ns==="complete"?"linear-gradient(180deg, #10b981 0%, #059669 100%)":Ns==="partial"?"linear-gradient(180deg, #d4a853 0%, #c9a962 100%)":Ns==="not-filmed"?"linear-gradient(180deg, #f87171 0%, #ef4444 100%)":"linear-gradient(180deg, #d1d5db 0%, #9ca3af 100%)":"transparent"}}),jsxRuntimeExports.jsxs("div",{className:"relative z-10 pl-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xl font-bold text-text-primary",children:ts.sceneNumber}),jsxRuntimeExports.jsxs("div",{ref:Rs,className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:Is=>{Is.stopPropagation(),Ss(!js)},className:"status-dropdown-btn touch-manipulation",style:{borderColor:Ns?qs.color:void 0},children:[jsxRuntimeExports.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:qs.color}}),jsxRuntimeExports.jsx("span",{className:qs.text,children:qs.label}),jsxRuntimeExports.jsx("svg",{className:clsx("w-3 h-3 text-text-muted transition-transform",js&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),js&&jsxRuntimeExports.jsx("div",{className:"absolute right-0 top-full mt-1 w-44 bg-card border border-border rounded-lg shadow-lg z-50 overflow-hidden animate-fadeIn",children:["complete","partial","not-filmed"].map(Is=>{const Bs=SCENE_FILMING_STATUS_CONFIG[Is],Vs=Ns===Is;return jsxRuntimeExports.jsxs("button",{onClick:Ds=>{Ds.stopPropagation(),Ys(Is)},className:clsx("w-full px-3 py-2.5 text-left text-sm flex items-center gap-2.5 transition-colors",Vs?Bs.bgClass:"hover:bg-gray-50"),children:[jsxRuntimeExports.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Bs.color}}),jsxRuntimeExports.jsx("span",{className:clsx("font-medium",Vs&&Bs.textClass),children:Bs.label}),Vs&&jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 ml-auto",Bs.textClass),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},Is)})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 mb-2 flex-wrap",children:[((ss==null?void 0:ss.intExt)||(ws==null?void 0:ws.intExt))&&jsxRuntimeExports.jsx("span",{className:`px-1.5 py-0.5 text-[10px] font-bold rounded ${((ss==null?void 0:ss.intExt)||(ws==null?void 0:ws.intExt))==="INT"?"bg-slate-100 text-slate-600":"bg-stone-100 text-stone-600"}`,children:(ss==null?void 0:ss.intExt)||(ws==null?void 0:ws.intExt)}),ts.dayNight&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-100 text-amber-700",children:ts.dayNight}),ts.pages&&jsxRuntimeExports.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-gray-100 text-text-muted",children:[ts.pages," pgs"]}),ts.estimatedTime&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-blue-50 text-blue-600",children:ts.estimatedTime})]}),ts.setDescription&&jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:ts.setDescription}),(ts.action||(ss==null?void 0:ss.synopsis))&&jsxRuntimeExports.jsxs("button",{onClick:Is=>{Is.stopPropagation(),ss&&ls(ss)},className:"w-full text-left group",disabled:!(ss!=null&&ss.scriptContent),children:[jsxRuntimeExports.jsx("p",{className:clsx("text-xs text-text-muted italic line-clamp-2",(ss==null?void 0:ss.scriptContent)&&"group-hover:text-gold transition-colors"),children:ts.action||(ss==null?void 0:ss.synopsis)}),(ss==null?void 0:ss.scriptContent)&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-gold flex items-center gap-1 mt-0.5",children:[jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Tap to view full scene"]})]}),ts.notes&&jsxRuntimeExports.jsx("div",{className:"mt-2 px-2.5 py-2 rounded-lg bg-gold-50 border border-gold-100",children:jsxRuntimeExports.jsx("div",{className:"text-xs text-gold-700 font-medium leading-relaxed",children:ts.notes})}),Ns&&Ns!=="complete"&&ks&&jsxRuntimeExports.jsxs("div",{className:clsx("mt-2 px-2.5 py-2 rounded-lg text-xs",Ns==="partial"?"bg-amber-50 text-amber-700 border border-amber-100":"bg-red-50 text-red-700 border border-red-100"),children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Note:"})," ",ks]}),rs.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2.5 pt-2 border-t border-border/50",children:rs.map(Is=>{const Bs=ns(Is.id,ts.sceneNumber,Is.actorNumber),Vs=Is.avatarColour??"#C9A962";return jsxRuntimeExports.jsxs("button",{onClick:Ds=>{Ds.stopPropagation(),as(Is)},className:"flex items-center gap-1 rounded-full pl-0.5 pr-2 py-0.5 transition-colors bg-gray-50 hover:bg-gold/10 active:bg-gold/20 cursor-pointer",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold text-white flex-shrink-0",style:{backgroundColor:Vs},children:Is.actorNumber||Is.initials}),jsxRuntimeExports.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:Is.name.split(" ")[0]}),Bs&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-gold",children:[" ",Bs.name]})]},Is.id)})})]})]})]}),ys&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-4",onClick:()=>vs(!1),children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl overflow-hidden",onClick:Is=>Is.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Scene ",ts.sceneNumber]})}),jsxRuntimeExports.jsxs("div",{className:"py-2",children:[ts.status!=="in-progress"&&jsxRuntimeExports.jsxs("button",{onClick:()=>{cs("in-progress"),vs(!1)},className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"})}),"Mark In Progress"]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border mt-2 pt-2",children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-2",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"FILMING STATUS"})}),jsxRuntimeExports.jsxs("button",{onClick:()=>Ws("complete"),className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-green-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Complete"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Scene fully filmed"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>fs(!0),className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-amber-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Part Complete"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Some shots still needed"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>fs(!0),className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-red-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Incomplete"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Scene not filmed"})]})]})]}),ts.status!=="upcoming"&&jsxRuntimeExports.jsxs("button",{onClick:()=>{cs("upcoming"),vs(!1)},className:"w-full px-4 py-3 text-left text-sm text-text-muted hover:bg-gray-50 flex items-center gap-3 border-t border-border mt-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})}),"Revert to Upcoming"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>vs(!1),className:"w-full p-4 text-center text-sm font-medium text-gold border-t border-border",children:"Cancel"})]})}),gs&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",onClick:()=>fs(!1),children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl overflow-hidden",onClick:Is=>Is.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Scene ",ts.sceneNumber," - Add Notes"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Why wasn't this scene fully filmed?"})]}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsx("textarea",{value:bs,onChange:Is=>Es(Is.target.value),placeholder:"e.g., Ran out of time, weather issues, actor unavailable...",rows:3,className:"w-full p-3 border border-border rounded-lg text-sm bg-input-bg text-text-primary resize-none"})}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-border flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ws("partial"),className:"flex-1 py-2.5 rounded-button bg-amber-500 text-white text-sm font-medium",children:"Part Complete"}),jsxRuntimeExports.jsx("button",{onClick:()=>Ws("not-filmed"),className:"flex-1 py-2.5 rounded-button bg-red-500 text-white text-sm font-medium",children:"Incomplete"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>fs(!1),className:"w-full p-3 text-center text-sm text-text-muted border-t border-border",children:"Cancel"})]})})]})}),EmptyState$2=reactExports.memo(function es({hasAnyCallSheets:ts,onUploadClick:ss,isUploading:rs}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:ts?jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"}):jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),ts?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"No Call Sheet for This Date"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload a call sheet for this production day to see today's scenes"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"Upload a Call Sheet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload your first call sheet to see today's scenes and start tracking continuity"})]}),jsxRuntimeExports.jsx("button",{onClick:ss,disabled:rs,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:rs?"Uploading...":"Upload Call Sheet PDF"})]})}),UnmatchedSceneModal=reactExports.memo(function es({info:ts,onClose:ss,onAddScene:rs,onMergeWithScene:ns}){const{sceneNumber:os,character:as,callSheetScene:ls,suggestedMergeScenes:cs}=ts,us=()=>{var hs,xs;let ds="INT",ms=ls.setDescription||`Scene ${os}`;const ps=(hs=ls.setDescription)==null?void 0:hs.match(/^(INT|EXT)\./i);ps&&(ds=ps[1].toUpperCase()),rs({sceneNumber:os,slugline:ms,intExt:ds,timeOfDay:((xs=ls.dayNight)==null?void 0:xs.toUpperCase())||"DAY",synopsis:ls.action,characters:[as.id]})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-4",onClick:ss,children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl overflow-hidden animate-slideUp",onClick:ds=>ds.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Scene ",os," Not in Breakdown"]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["This scene from the call sheet doesn't exist in your script breakdown. Choose how to handle continuity for ",jsxRuntimeExports.jsx("span",{className:"font-medium text-gold",children:as.name}),"."]})]}),jsxRuntimeExports.jsxs("div",{className:"py-2",children:[jsxRuntimeExports.jsxs("button",{onClick:us,className:"w-full px-4 py-3.5 text-left hover:bg-gray-50 flex items-center gap-3 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-gold-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-text-primary block",children:["Add Scene ",os," to Breakdown"]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Create a new scene and track continuity there"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}),cs.length>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-2 border-t border-border/50 mt-1",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"OR MERGE WITH EXISTING SCENE"})}),cs.map(ds=>jsxRuntimeExports.jsxs("button",{onClick:()=>ns(ds),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-blue-600",children:ds.sceneNumber})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-text-primary block truncate",children:["Merge with Scene ",ds.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate block",children:ds.slugline})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},ds.id))]})]}),jsxRuntimeExports.jsx("button",{onClick:ss,className:"w-full p-4 text-center text-sm font-medium text-text-muted border-t border-border hover:bg-gray-50 transition-colors",children:"Cancel"})]})})});function generateContinuityBiblePDF(es,ts,ss){const rs=(ss==null?void 0:ss.preparedBy)||"Hair & Makeup Department",ns=(ss==null?void 0:ss.firstShootDate)||new Date,os=(ss==null?void 0:ss.lastShootDate)||new Date,as=es.characters.map(hs=>{const xs=es.looks.filter(ys=>ys.characterId===hs.id);return generateCharacterSection(hs,xs,es.scenes,ts)}).join(""),ls=es.scenes.sort((hs,xs)=>hs.sceneNumber.localeCompare(xs.sceneNumber,void 0,{numeric:!0})),cs=ls.map(hs=>generateSceneSection(hs,es.characters,es.looks,ts)).join(""),us=es.characters.map(hs=>`<li><a href="#character-${hs.id}">${hs.name}</a></li>`).join(""),ds=ls.map(hs=>`<li><a href="#scene-${hs.id}">Sc ${hs.sceneNumber}  ${hs.slugline||"Untitled"}</a></li>`).join(""),ms=es.looks.length,ps=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>${es.name} - Continuity Bible</title>
      <style>
        @media print {
          .page-break { page-break-before: always; }
          .no-break { page-break-inside: avoid; }
          .no-print { display: none; }
          body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          padding: 0;
          max-width: 900px;
          margin: 0 auto;
          color: #2c2c2c;
          line-height: 1.5;
          font-size: 13px;
        }

        /*  Cover Page  */
        .cover-page {
          text-align: center;
          min-height: 95vh;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          padding: 60px 40px;
        }
        .cover-rule { width: 80px; height: 3px; background: #C9A962; margin: 0 auto 40px; }
        .cover-title { font-size: 38px; font-weight: 700; color: #1a1a1a; letter-spacing: -0.5px; margin-bottom: 6px; }
        .cover-subtitle { font-size: 18px; font-weight: 400; color: #C9A962; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 50px; }
        .cover-stats { display: flex; gap: 40px; justify-content: center; margin-bottom: 50px; }
        .cover-stat { text-align: center; }
        .cover-stat-value { font-size: 28px; font-weight: 700; color: #C9A962; display: block; }
        .cover-stat-label { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .cover-meta { font-size: 12px; color: #999; line-height: 1.8; }
        .cover-meta strong { color: #666; }

        /*  Section Headings  */
        .section-heading {
          font-size: 22px;
          font-weight: 700;
          color: #1a1a1a;
          margin: 0 0 6px 0;
          padding: 30px 40px 0;
        }
        .section-heading-rule { width: 50px; height: 3px; background: #C9A962; margin: 0 0 30px 40px; }

        /*  Table of Contents  */
        .toc { padding: 30px 40px; }
        .toc h2 { font-size: 22px; font-weight: 700; color: #1a1a1a; margin-bottom: 4px; }
        .toc-rule { width: 50px; height: 3px; background: #C9A962; margin-bottom: 30px; }
        .toc h3 { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: #C9A962; margin-bottom: 10px; }
        .toc ul { list-style: none; padding: 0; margin: 0 0 24px 0; }
        .toc li { padding: 3px 0; font-size: 12px; border-bottom: 1px dotted #e5e5e5; }
        .toc li:last-child { border-bottom: none; }
        .toc a { color: #444; text-decoration: none; }
        .toc a:hover { color: #C9A962; }
        .toc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .toc-scenes-list { columns: 2; column-gap: 24px; }
        .toc-scenes-list li { break-inside: avoid; }

        /*  Character Section  */
        .character-section { padding: 0 40px; margin-bottom: 20px; page-break-inside: avoid; }
        .character-header {
          background: linear-gradient(135deg, #C9A962, #B8975A);
          color: white;
          padding: 16px 20px;
          border-radius: 8px 8px 0 0;
        }
        .character-name { font-size: 20px; font-weight: 700; margin: 0; }
        .character-look-count { font-size: 12px; opacity: 0.85; margin-top: 2px; }

        /*  Look Card  */
        .look-section {
          border: 1px solid #e0e0e0;
          border-top: none;
          padding: 20px;
          margin-bottom: 0;
          page-break-inside: avoid;
        }
        .look-section:last-child { border-radius: 0 0 8px 8px; }
        .look-header {
          display: flex;
          justify-content: space-between;
          align-items: baseline;
          margin-bottom: 14px;
          padding-bottom: 10px;
          border-bottom: 1px solid #f0f0f0;
        }
        .look-name { font-size: 16px; font-weight: 600; color: #1a1a1a; }
        .look-scenes { font-size: 11px; color: #777; margin-top: 2px; }
        .look-time {
          font-size: 11px;
          color: #C9A962;
          font-weight: 500;
          white-space: nowrap;
        }

        /*  Photo Grid  */
        .photo-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 8px;
          margin: 0 0 16px;
          page-break-inside: avoid;
        }
        .photo-placeholder {
          aspect-ratio: 3/4;
          background: #fafafa;
          border: 1px dashed #d5d5d5;
          border-radius: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 10px;
          color: #bbb;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }
        .photo-img {
          width: 100%;
          aspect-ratio: 3/4;
          object-fit: cover;
          border-radius: 4px;
        }
        .master-photo {
          grid-column: span 2;
          grid-row: span 2;
        }
        .master-photo .photo-img,
        .master-photo .photo-placeholder {
          aspect-ratio: auto;
          height: 100%;
        }

        /*  Details Tables  */
        .details-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          margin-top: 16px;
        }
        .details-section h4 {
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1.5px;
          color: #C9A962;
          font-weight: 600;
          margin: 0 0 8px 0;
          padding-bottom: 6px;
          border-bottom: 1px solid #f0f0f0;
        }
        .details-table { width: 100%; font-size: 12px; border-collapse: collapse; }
        .details-table td { padding: 3px 0; vertical-align: top; }
        .details-table td:first-child { color: #888; width: 42%; }
        .details-table td:last-child { color: #2c2c2c; font-weight: 500; }

        /*  Notes  */
        .notes-section {
          margin-top: 14px;
          padding: 10px 14px;
          background: #f8f8f8;
          border-radius: 6px;
          border-left: 3px solid #C9A962;
        }
        .notes-section h4 {
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
          color: #888;
          margin: 0 0 6px 0;
        }
        .notes-section p { font-size: 12px; color: #555; margin: 0; }

        /*  Scene Section  */
        .scene-section {
          margin: 0 40px 16px;
          border: 1px solid #e0e0e0;
          border-radius: 8px;
          overflow: hidden;
          page-break-inside: avoid;
        }
        .scene-header {
          background: #f7f7f7;
          padding: 12px 16px;
          border-bottom: 1px solid #e0e0e0;
        }
        .scene-number {
          font-size: 11px;
          color: #C9A962;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 1px;
        }
        .scene-slugline { font-size: 15px; font-weight: 600; color: #1a1a1a; margin: 4px 0 0; }
        .scene-synopsis { font-size: 12px; color: #777; margin-top: 4px; }
        .scene-content { padding: 14px 16px; }
        .scene-content h4 {
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
          color: #999;
          margin: 0 0 10px;
        }
        .scene-characters { display: flex; flex-wrap: wrap; gap: 8px; }
        .scene-character-card {
          flex: 1;
          min-width: 180px;
          padding: 10px 12px;
          background: #fafafa;
          border: 1px solid #eee;
          border-radius: 6px;
        }
        .scene-character-name { font-weight: 600; font-size: 13px; color: #1a1a1a; }
        .scene-character-look { font-size: 11px; color: #777; margin-top: 2px; }

        /*  Continuity Flags  */
        .flags-list { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .flag-badge {
          padding: 3px 8px;
          border-radius: 10px;
          font-size: 10px;
          font-weight: 600;
          letter-spacing: 0.3px;
        }
        .flag-sweat { background: #e3f2fd; color: #1565c0; }
        .flag-dishevelled { background: #fff3e0; color: #ef6c00; }
        .flag-blood { background: #ffebee; color: #c62828; }
        .flag-dirt { background: #efebe9; color: #5d4037; }
        .flag-wetHair { background: #e0f7fa; color: #00838f; }
        .flag-tears { background: #e8eaf6; color: #3949ab; }

        /*  SFX  */
        .sfx-section {
          margin-top: 14px;
          padding: 10px 14px;
          background: #fffbf0;
          border: 1px solid #f0e0b0;
          border-radius: 6px;
        }
        .sfx-section h4 {
          color: #d48806;
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
          margin: 0 0 6px 0;
        }
      </style>
    </head>
    <body>
      <!-- Cover Page -->
      <div class="cover-page">
        <div class="cover-rule"></div>
        <h1 class="cover-title">${es.name}</h1>
        <h2 class="cover-subtitle">Continuity Bible</h2>
        <div class="cover-stats">
          <div class="cover-stat">
            <span class="cover-stat-value">${es.scenes.length}</span>
            <span class="cover-stat-label">Scenes</span>
          </div>
          <div class="cover-stat">
            <span class="cover-stat-value">${es.characters.length}</span>
            <span class="cover-stat-label">Characters</span>
          </div>
          <div class="cover-stat">
            <span class="cover-stat-value">${ms}</span>
            <span class="cover-stat-label">Looks</span>
          </div>
        </div>
        <div class="cover-meta">
          <p><strong>Prepared by:</strong> ${rs}</p>
          <p><strong>Production Dates:</strong> ${formatDate(ns)}  ${formatDate(os)}</p>
          <p><strong>Exported:</strong> ${ps}</p>
        </div>
      </div>

      <div class="page-break"></div>

      <!-- Table of Contents -->
      <div class="toc">
        <h2>Contents</h2>
        <div class="toc-rule"></div>
        <div class="toc-grid">
          <div>
            <h3>Characters (${es.characters.length})</h3>
            <ul>${us}</ul>
          </div>
          <div>
            <h3>Scenes (${ls.length})</h3>
            <ul class="toc-scenes-list">${ds}</ul>
          </div>
        </div>
      </div>

      <div class="page-break"></div>

      <!-- Character Sections -->
      <div class="section-heading">Character Reference</div>
      <div class="section-heading-rule"></div>
      ${as}

      <div class="page-break"></div>

      <!-- Scene Sections -->
      <div class="section-heading">Scene Index</div>
      <div class="section-heading-rule"></div>
      ${cs}
    </body>
    </html>
  `}function generateCharacterSection(es,ts,ss,rs){const ns=ts.map(os=>{var us;const as=ss.filter(ds=>os.scenes.includes(ds.sceneNumber)).map(ds=>ds.sceneNumber).join(", "),ls=Object.keys(rs).find(ds=>ds.includes(es.id)&&rs[ds].lookId===os.id),cs=ls?rs[ls]:null;return`
      <div class="look-section">
        <div class="look-header">
          <div>
            <div class="look-name">${os.name}</div>
            <div class="look-scenes">Scenes: ${as||"None assigned"}</div>
          </div>
          <div class="look-time">Application Time: ~${os.estimatedTime} min</div>
        </div>

        <!-- Photos Grid -->
        <div class="photo-grid">
          <div class="master-photo">
            ${os.masterReference?`<img class="photo-img" src="${os.masterReference.uri}" alt="Master Reference" />`:'<div class="photo-placeholder">Master Reference<br/>No Photo</div>'}
          </div>
          ${["front","left","right","back"].map(ds=>{const ms=cs==null?void 0:cs.photos[ds];return ms?`<img class="photo-img" src="${ms.uri}" alt="${ds}" />`:`<div class="photo-placeholder">${ds.charAt(0).toUpperCase()+ds.slice(1)}</div>`}).join("")}
        </div>

        <!-- Details -->
        <div class="details-grid">
          <div class="details-section">
            <h4>Makeup</h4>
            <table class="details-table">
              ${formatMakeupDetails(os.makeup)}
            </table>
          </div>
          <div class="details-section">
            <h4>Hair</h4>
            <table class="details-table">
              ${formatHairDetails(os.hair)}
            </table>
          </div>
        </div>

        ${(us=cs==null?void 0:cs.sfxDetails)!=null&&us.sfxRequired?`
          <div class="sfx-section">
            <h4>Special Effects</h4>
            <table class="details-table">
              ${formatSFXDetails(cs.sfxDetails)}
            </table>
          </div>
        `:""}

        ${cs!=null&&cs.notes?`
          <div class="notes-section">
            <h4>Notes</h4>
            <p>${cs.notes}</p>
          </div>
        `:""}
      </div>
    `}).join("");return`
    <div class="character-section" id="character-${es.id}">
      <div class="character-header">
        <h3 class="character-name">${es.name}</h3>
        <div class="character-look-count">${ts.length} Look${ts.length!==1?"s":""}</div>
      </div>
      ${ns}
    </div>
  `}function generateSceneSection(es,ts,ss,rs){const os=ts.filter(as=>es.characters.includes(as.id)).map(as=>{const ls=ss.find(ms=>ms.characterId===as.id&&ms.scenes.includes(es.sceneNumber)),cs=`${es.id}-${as.id}`,us=rs[cs],ds=us?formatContinuityFlags(us.continuityFlags):"";return`
      <div class="scene-character-card">
        <div class="scene-character-name">${as.name}</div>
        <div class="scene-character-look">${(ls==null?void 0:ls.name)||"No Look Assigned"}</div>
        ${ds?`<div class="flags-list">${ds}</div>`:""}
      </div>
    `}).join("");return`
    <div class="scene-section" id="scene-${es.id}">
      <div class="scene-header">
        <div class="scene-number">SCENE ${es.sceneNumber}</div>
        <div class="scene-slugline">${es.intExt}. ${es.slugline} - ${es.timeOfDay}</div>
        ${es.synopsis?`<div class="scene-synopsis">${es.synopsis}</div>`:""}
      </div>
      <div class="scene-content">
        <h4 style="font-size: 12px; color: #666; margin: 0 0 10px;">Characters in Scene:</h4>
        <div class="scene-characters">
          ${os||'<p style="color: #999; font-size: 13px;">No characters assigned</p>'}
        </div>
      </div>
    </div>
  `}function generateSceneBreakdownCSV(es,ts){const ss=["Scene","INT/EXT","Location","Time","Characters","Looks","Makeup Summary","Hair Summary","SFX","Flags","Notes","Status"],rs=es.scenes.sort((as,ls)=>as.sceneNumber.localeCompare(ls.sceneNumber,void 0,{numeric:!0})).map(as=>{const ls=es.characters.filter(ys=>as.characters.includes(ys.id)),cs=ls.map(ys=>ys.name).join("; "),us=ls.map(ys=>{const vs=es.looks.find(gs=>gs.characterId===ys.id&&gs.scenes.includes(as.sceneNumber));return vs?`${ys.name}: ${vs.name}`:null}).filter(Boolean).join("; ");let ds=[],ms=[],ps=[],hs=[],xs=[];return ls.forEach(ys=>{const vs=`${as.id}-${ys.id}`,gs=ts[vs],fs=es.looks.find(js=>js.characterId===ys.id&&js.scenes.includes(as.sceneNumber));if(fs&&(fs.makeup.foundation&&ds.push(fs.makeup.foundation),fs.makeup.lipColour&&ds.push(fs.makeup.lipColour),fs.hair.style&&ms.push(fs.hair.style)),gs){gs.sfxDetails.sfxRequired&&ps.push(gs.sfxDetails.sfxTypes.join(", "));const js=Object.entries(gs.continuityFlags).filter(([Ss,bs])=>bs).map(([Ss])=>Ss);hs.push(...js),gs.notes&&xs.push(gs.notes)}}),[as.sceneNumber.toString(),as.intExt,as.slugline,as.timeOfDay,cs,us,[...new Set(ds)].join(", "),[...new Set(ms)].join(", "),[...new Set(ps)].join(", ")||"None",[...new Set(hs)].join(", ")||"-",xs.join(" | "),as.isComplete?"Complete":"Incomplete"]}),ns=as=>as.includes(",")||as.includes('"')||as.includes(`
`)?`"${as.replace(/"/g,'""')}"`:as;return[ss.join(","),...rs.map(as=>as.map(ns).join(","))].join(`
`)}function generateCharacterLookbookPDF(es,ts,ss,rs){const ns=ts.map(os=>{const as=ss.filter(us=>os.scenes.includes(us.sceneNumber)).map(us=>`Scene ${us.sceneNumber}`).join(", "),ls=Object.keys(rs).find(us=>us.includes(es.id)&&rs[us].lookId===os.id),cs=ls?rs[ls]:null;return`
      <div class="look-page">
        <div class="look-header">
          <h2>${os.name}</h2>
          <p class="scenes-list">${as||"No scenes assigned"}</p>
          <p class="app-time">Estimated Application: ${os.estimatedTime} minutes</p>
        </div>

        <div class="photo-section">
          ${os.masterReference?`<img class="master-photo" src="${os.masterReference.uri}" alt="Master Reference" />`:'<div class="photo-placeholder master">No Master Reference</div>'}
          <div class="angle-photos">
            ${["front","left","right","back"].map(us=>{const ds=cs==null?void 0:cs.photos[us];return ds?`<img src="${ds.uri}" alt="${us}" />`:`<div class="photo-placeholder">${us}</div>`}).join("")}
          </div>
        </div>

        <div class="details-section">
          <div class="makeup-details">
            <h3>Makeup</h3>
            ${formatMakeupDetailsHTML(os.makeup)}
          </div>
          <div class="hair-details">
            <h3>Hair</h3>
            ${formatHairDetailsHTML(os.hair)}
          </div>
        </div>

        ${cs!=null&&cs.notes?`
          <div class="notes-section">
            <h3>Notes</h3>
            <p>${cs.notes}</p>
          </div>
        `:""}
      </div>
    `}).join('<div class="page-break"></div>');return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>${es.name} - Lookbook</title>
      <style>
        @media print { .page-break { page-break-before: always; } }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
        .character-cover { text-align: center; padding: 100px 20px; }
        .character-name { font-size: 48px; color: #C9A962; margin-bottom: 10px; }
        .character-subtitle { font-size: 18px; color: #666; }
        .look-page { margin-bottom: 40px; }
        .look-header { margin-bottom: 20px; }
        .look-header h2 { color: #C9A962; margin: 0 0 5px; }
        .scenes-list { color: #666; font-size: 14px; margin: 0; }
        .app-time { color: #999; font-size: 12px; margin: 5px 0 0; }
        .photo-section { display: flex; gap: 20px; margin-bottom: 20px; }
        .master-photo { width: 250px; height: auto; border-radius: 8px; }
        .angle-photos { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; flex: 1; }
        .angle-photos img { width: 100%; border-radius: 4px; }
        .photo-placeholder { background: #f5f5f5; border: 1px dashed #ccc; border-radius: 4px; padding: 40px; text-align: center; color: #999; }
        .photo-placeholder.master { width: 250px; min-height: 300px; display: flex; align-items: center; justify-content: center; }
        .details-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .details-section h3 { font-size: 14px; color: #C9A962; border-bottom: 1px solid #eee; padding-bottom: 5px; margin: 0 0 10px; }
        .detail-row { display: flex; justify-content: space-between; font-size: 12px; padding: 4px 0; border-bottom: 1px solid #f5f5f5; }
        .detail-label { color: #666; }
        .detail-value { color: #333; font-weight: 500; }
        .notes-section { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; }
        .notes-section h3 { font-size: 12px; color: #666; margin: 0 0 8px; }
      </style>
    </head>
    <body>
      <div class="character-cover">
        <h1 class="character-name">${es.name}</h1>
        <p class="character-subtitle">Hair & Makeup Lookbook</p>
        <p style="color: #999; margin-top: 20px;">${ts.length} Look${ts.length!==1?"s":""}</p>
      </div>
      <div class="page-break"></div>
      ${ns}
    </body>
    </html>
  `}function formatDate(es){return new Date(es).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})}function formatMakeupDetails(es){return[["Foundation",es.foundation],["Coverage",es.coverage],["Concealer",es.concealer],["Blush",es.blush],["Lips",es.lipColour],["Eyes",[es.lidColour,es.liner,es.lashes].filter(Boolean).join(", ")],["Setting",es.setting]].filter(([ss,rs])=>rs).map(([ss,rs])=>`
    <tr><td>${ss}:</td><td>${rs}</td></tr>
  `).join("")}function formatHairDetails(es){const ts=[["Style",es.style],["Parting",es.parting],["Products",es.products],["Pieces Out",es.piecesOut],["Accessories",es.accessories],["Type",es.hairType!=="Natural"?es.hairType:null]].filter(([ss,rs])=>rs);return es.hairType!=="Natural"&&(es.wigNameId&&ts.push(["Wig",es.wigNameId]),es.wigType&&ts.push(["Wig Type",es.wigType])),ts.map(([ss,rs])=>`
    <tr><td>${ss}:</td><td>${rs}</td></tr>
  `).join("")}function formatSFXDetails(es){return[["Types",es.sfxTypes.join(", ")],["Prosthetics",es.prostheticPieces],["Adhesive",es.prostheticAdhesive],["Blood Types",es.bloodTypes.join(", ")],["Blood Products",es.bloodProducts],["Contact Lenses",es.contactLenses],["Teeth",es.teeth]].filter(([ss,rs])=>rs&&rs.length>0).map(([ss,rs])=>`
    <tr><td>${ss}:</td><td>${rs}</td></tr>
  `).join("")}function formatMakeupDetailsHTML(es){return[["Foundation",es.foundation],["Coverage",es.coverage],["Concealer",es.concealer],["Blush",es.blush],["Lip Colour",es.lipColour],["Lid Colour",es.lidColour],["Liner",es.liner],["Lashes",es.lashes],["Setting",es.setting]].filter(([ss,rs])=>rs).map(([ss,rs])=>`
    <div class="detail-row">
      <span class="detail-label">${ss}</span>
      <span class="detail-value">${rs}</span>
    </div>
  `).join("")}function formatHairDetailsHTML(es){const ts=[["Style",es.style],["Parting",es.parting],["Products",es.products],["Pieces Out",es.piecesOut],["Pins",es.pins],["Accessories",es.accessories],["Type",es.hairType]].filter(([ss,rs])=>rs);return es.hairType!=="Natural"&&(es.wigNameId&&ts.push(["Wig ID",es.wigNameId]),es.wigType&&ts.push(["Wig Type",es.wigType]),es.hairline&&ts.push(["Hairline",es.hairline])),ts.map(([ss,rs])=>`
    <div class="detail-row">
      <span class="detail-label">${ss}</span>
      <span class="detail-value">${rs}</span>
    </div>
  `).join("")}function formatContinuityFlags(es){const ts=[];return es.sweat&&ts.push('<span class="flag-badge flag-sweat">Sweat</span>'),es.dishevelled&&ts.push('<span class="flag-badge flag-dishevelled">Dishevelled</span>'),es.blood&&ts.push('<span class="flag-badge flag-blood">Blood</span>'),es.dirt&&ts.push('<span class="flag-badge flag-dirt">Dirt</span>'),es.wetHair&&ts.push('<span class="flag-badge flag-wetHair">Wet Hair</span>'),es.tears&&ts.push('<span class="flag-badge flag-tears">Tears</span>'),ts.join("")}const exportUtils=Object.freeze(Object.defineProperty({__proto__:null,generateCharacterLookbookPDF,generateContinuityBiblePDF,generateSceneBreakdownCSV},Symbol.toStringTag,{value:"Module"}));function SceneCharacterConfirmation({scene:es,onClose:ts,onConfirm:ss}){var Ss;const{currentProject:rs,confirmSceneCharacters:ns,addCharacterFromScene:os}=useProjectStore(),[as,ls]=reactExports.useState(()=>new Set(es.characters||[])),[cs,us]=reactExports.useState(()=>{var Rs;const bs=new Set;return rs&&((Rs=es.characters)==null||Rs.forEach(ws=>{const Ns=rs.characters.find(ks=>ks.id===ws);Ns&&bs.add(Ns.name)})),(es.suggestedCharacters||[]).forEach(ws=>bs.add(ws)),bs}),[ds,ms]=reactExports.useState(""),[ps,hs]=reactExports.useState(!1),xs=(rs==null?void 0:rs.characters)||[],ys=reactExports.useMemo(()=>(es.suggestedCharacters||[]).map(Es=>{const Rs=xs.find(ws=>ws.name.toUpperCase()===Es.toUpperCase());return{name:Es,existingCharacter:Rs||null,isInProject:!!Rs}}),[es.suggestedCharacters,xs]),vs=(bs,Es)=>{us(Rs=>{const ws=new Set(Rs);return ws.has(bs)?(ws.delete(bs),Es&&ls(Ns=>{const ks=new Set(Ns);return ks.delete(Es.id),ks})):(ws.add(bs),Es&&ls(Ns=>new Set([...Ns,Es.id]))),ws})},gs=()=>{const bs=ds.trim().toUpperCase();if(!bs)return;if(cs.has(bs)){ms(""),hs(!1);return}const Es=xs.find(Rs=>Rs.name.toUpperCase()===bs);Es?ls(Rs=>new Set([...Rs,Es.id])):us(Rs=>new Set([...Rs,bs])),ms(""),hs(!1)},fs=()=>{const bs=new Set(as);cs.forEach(Es=>{const Rs=xs.find(ws=>ws.name.toUpperCase()===Es.toUpperCase());if(Rs)bs.add(Rs.id);else{const ws=os(es.id,Es);bs.add(ws.id)}}),ns(es.id,Array.from(bs)),ss()},js=cs.size;return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[85vh] flex flex-col safe-bottom",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary truncate",children:["Scene ",es.sceneNumber]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted truncate",children:es.slugline})]}),jsxRuntimeExports.jsx("button",{onClick:ts,className:"p-2 -mr-2 text-text-muted active:text-gold",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),es.scriptContent&&jsxRuntimeExports.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-border max-h-48 overflow-y-auto shrink-0",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-secondary font-mono whitespace-pre-wrap",children:es.scriptContent})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[es.characters&&es.characters.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("h4",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"CURRENT CHARACTERS"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:es.characters.map(bs=>{const Es=xs.find(ws=>ws.id===bs);if(!Es)return null;const Rs=as.has(bs);return jsxRuntimeExports.jsxs("div",{className:clsx("flex items-center gap-3 p-3 rounded-xl border transition-all",Rs?"border-gold bg-gold/5":"border-red-200 bg-red-50"),children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:Es,size:"sm"}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:jsxRuntimeExports.jsx("span",{className:clsx("font-medium",Rs?"text-text-primary":"text-red-400 line-through"),children:Es.name})}),jsxRuntimeExports.jsx("button",{onClick:()=>{ls(Ns=>{const ks=new Set(Ns);return ks.has(bs)?ks.delete(bs):ks.add(bs),ks});const ws=Es.name.toUpperCase();us(Ns=>{const ks=new Set(Ns);return Rs?ks.delete(ws):ks.add(ws),ks})},className:clsx("p-1.5 rounded-lg transition-colors flex-shrink-0",Rs?"text-red-500 hover:bg-red-50 active:bg-red-100":"text-green-600 hover:bg-green-50 active:bg-green-100"),title:Rs?"Remove from scene":"Add back to scene",children:Rs?jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]},bs)})})]}),ys.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("h4",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"SUGGESTED CHARACTERS"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ys.map(({name:bs,existingCharacter:Es})=>{const Rs=cs.has(bs);return jsxRuntimeExports.jsxs("button",{onClick:()=>vs(bs,Es),className:clsx("w-full flex items-center gap-3 p-3 rounded-xl border transition-all text-left",Rs?"border-gold bg-gold/5":"border-border bg-card"),children:[jsxRuntimeExports.jsx("div",{className:clsx("w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 transition-all",Rs?"border-gold bg-gold":"border-gray-300"),children:Rs&&jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}),Es?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:Es,size:"sm"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:Es.name}),jsxRuntimeExports.jsx("span",{className:"text-xs text-green-600 ml-2",children:"In project"})]})]}):jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:bs}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted ml-2",children:"New character"})]})]},bs)})})]}),es.characterConfirmationStatus==="detecting"&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-sm mb-4 p-3 bg-gray-50 rounded-lg",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Detecting characters..."]}),es.characterConfirmationStatus==="pending"&&!((Ss=es.suggestedCharacters)!=null&&Ss.length)&&jsxRuntimeExports.jsx("div",{className:"text-text-muted text-sm mb-4 p-3 bg-gray-50 rounded-lg",children:"No characters detected yet. Add characters manually below."}),jsxRuntimeExports.jsx("div",{className:"mt-4",children:ps?jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:ds,onChange:bs=>ms(bs.target.value.toUpperCase()),placeholder:"CHARACTER NAME",className:"flex-1 px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary uppercase",autoFocus:!0,onKeyDown:bs=>{bs.key==="Enter"&&gs(),bs.key==="Escape"&&hs(!1)}}),jsxRuntimeExports.jsx("button",{onClick:gs,disabled:!ds.trim(),className:"px-3 py-2 bg-gold text-white rounded-lg text-sm font-medium disabled:opacity-50",children:"Add"}),jsxRuntimeExports.jsx("button",{onClick:()=>{hs(!1),ms("")},className:"px-3 py-2 text-text-muted",children:"Cancel"})]}):jsxRuntimeExports.jsxs("button",{onClick:()=>hs(!0),className:"w-full flex items-center justify-center gap-2 p-3 rounded-xl border border-dashed border-border text-text-muted hover:border-gold hover:text-gold transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add character not detected"]})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-t border-border shrink-0",children:jsxRuntimeExports.jsxs("button",{onClick:fs,className:"w-full py-3 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform",children:["Confirm ",js," Character",js!==1?"s":""]})})]})})}function CharacterConfirmationProgress({totalScenes:es,confirmedScenes:ts}){const ss=es>0?Math.round(ts/es*100):0;return ts>=es?null:jsxRuntimeExports.jsxs("div",{className:"mx-4 mb-3 p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-amber-700",children:"Character Confirmation"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-amber-600",children:[ts," / ",es," scenes"]})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 bg-amber-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-amber-500 rounded-full transition-all duration-300",style:{width:`${ss}%`}})}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-amber-600 mt-1.5",children:"Confirm characters in each scene to track continuity"})]})}function AmendmentReviewModal({amendmentResult:es,onApply:ts,onCancel:ss}){const[rs,ns]=reactExports.useState(!0),[os,as]=reactExports.useState(!0),[ls,cs]=reactExports.useState(!1),[us,ds]=reactExports.useState(null),{newScenes:ms,modifiedScenes:ps,deletedScenes:hs,summary:xs}=es,ys=ms.length>0||ps.length>0||hs.length>0,vs=()=>{ts({includeNew:rs,includeModified:os,includeDeleted:ls})},gs=(fs,js)=>{const Ss=us===fs.sceneNumber,bs=js==="new"?"bg-green-50 border-green-200":js==="modified"?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200",Es=js==="new"?"text-green-700":js==="modified"?"text-amber-700":"text-red-700",Rs=js==="new"?"bg-green-100 text-green-700":js==="modified"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700",ws=js==="new"?"NEW":js==="modified"?"MODIFIED":"DELETED";return jsxRuntimeExports.jsxs("div",{className:clsx("border rounded-lg overflow-hidden",bs),children:[jsxRuntimeExports.jsxs("button",{onClick:()=>ds(Ss?null:fs.sceneNumber),className:"w-full p-3 flex items-center justify-between text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"font-semibold text-text-primary",children:["Scene ",fs.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:clsx("px-1.5 py-0.5 text-[10px] font-bold rounded",Rs),children:ws})]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 text-text-muted transition-transform",Ss&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),Ss&&jsxRuntimeExports.jsxs("div",{className:"px-3 pb-3 border-t border-border/30",children:[jsxRuntimeExports.jsx("p",{className:clsx("text-xs mt-2",Es),children:fs.changeDescription}),fs.contentSimilarity!==void 0&&jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted mb-1",children:[jsxRuntimeExports.jsx("span",{children:"Content similarity"}),jsxRuntimeExports.jsxs("span",{children:[fs.contentSimilarity,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:clsx("h-full rounded-full",fs.contentSimilarity>=80?"bg-green-500":fs.contentSimilarity>=50?"bg-amber-500":"bg-red-500"),style:{width:`${fs.contentSimilarity}%`}})})]}),js==="modified"&&fs.existingScene&&jsxRuntimeExports.jsxs("div",{className:"mt-3 p-2 bg-white/50 rounded text-xs",children:[jsxRuntimeExports.jsx("p",{className:"text-text-muted mb-1",children:"Existing data preserved:"}),jsxRuntimeExports.jsxs("ul",{className:"text-text-secondary space-y-0.5",children:[fs.existingScene.characters.length>0&&jsxRuntimeExports.jsxs("li",{children:["- ",fs.existingScene.characters.length," confirmed character(s)"]}),fs.existingScene.synopsis&&jsxRuntimeExports.jsx("li",{children:"- Scene synopsis"}),fs.existingScene.filmingStatus&&jsxRuntimeExports.jsxs("li",{children:["- Filming status: ",fs.existingScene.filmingStatus]})]})]}),fs.newScene&&jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Slugline:"}),jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-primary",children:fs.newScene.slugline})]})]})]},fs.sceneNumber)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[90vh] flex flex-col safe-bottom",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Script Amendment Detected"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:xs})]}),jsxRuntimeExports.jsx("button",{onClick:ss,className:"p-2 -mr-2 text-text-muted active:text-gold",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:ys?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-700",children:"Your existing breakdown data (confirmed characters, looks, continuity photos) will be preserved for modified scenes."})}),ms.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("h4",{className:"text-xs font-bold tracking-wider uppercase text-green-700",children:["New Scenes (",ms.length,")"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:rs,onChange:fs=>ns(fs.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Include"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ms.map(fs=>gs(fs,"new"))})]}),ps.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("h4",{className:"text-xs font-bold tracking-wider uppercase text-amber-700",children:["Modified Scenes (",ps.length,")"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:os,onChange:fs=>as(fs.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Include"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ps.map(fs=>gs(fs,"modified"))})]}),hs.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("h4",{className:"text-xs font-bold tracking-wider uppercase text-red-700",children:["Deleted Scenes (",hs.length,")"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:ls,onChange:fs=>cs(fs.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Mark as deleted"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:hs.map(fs=>gs(fs,"deleted"))})]})]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsx("p",{className:"text-text-primary font-medium",children:"No Changes Detected"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-1",children:"The script appears to be identical to your current breakdown."})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-t border-border shrink-0 space-y-2",children:ys?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:vs,disabled:!rs&&!os&&!ls,className:"w-full py-3 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50",children:"Apply Selected Changes"}),jsxRuntimeExports.jsx("button",{onClick:ss,className:"w-full py-2 text-sm text-text-muted",children:"Cancel - Keep Current Version"})]}):jsxRuntimeExports.jsx("button",{onClick:ss,className:"w-full py-3 rounded-button bg-gray-100 text-text-primary font-semibold text-base active:scale-[0.98] transition-transform",children:"Close"})})]})})}function AmendmentBadge({status:es,onDismiss:ts}){if(!es||es==="unchanged")return null;const rs={new:{bg:"bg-green-100",text:"text-green-700",border:"border-green-200",label:"NEW",icon:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})},modified:{bg:"bg-amber-100",text:"text-amber-700",border:"border-amber-200",label:"AMENDED",icon:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})},deleted:{bg:"bg-red-100",text:"text-red-700",border:"border-red-200",label:"REMOVED",icon:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}}[es];return jsxRuntimeExports.jsxs("div",{className:clsx("inline-flex items-center gap-1 px-2 py-1 rounded-full border",rs.bg,rs.border),children:[jsxRuntimeExports.jsx("span",{className:rs.text,children:rs.icon}),jsxRuntimeExports.jsx("span",{className:clsx("text-[10px] font-bold",rs.text),children:rs.label}),ts&&jsxRuntimeExports.jsx("button",{onClick:ns=>{ns.stopPropagation(),ts()},className:clsx("ml-1 hover:opacity-70",rs.text),children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}function FilmingStatusDropdown({scene:es,onStatusChange:ts,onNotesModalOpen:ss}){const[rs,ns]=reactExports.useState(!1),os=reactExports.useRef(null);reactExports.useEffect(()=>{const cs=us=>{os.current&&!os.current.contains(us.target)&&ns(!1)};if(rs)return document.addEventListener("mousedown",cs),()=>document.removeEventListener("mousedown",cs)},[rs]);const as=es.filmingStatus?SCENE_FILMING_STATUS_CONFIG[es.filmingStatus]:null,ls=cs=>{ns(!1),cs==="complete"?ts(es.sceneNumber,cs):ss(es.sceneNumber,cs)};return jsxRuntimeExports.jsxs("div",{ref:os,className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:cs=>{cs.stopPropagation(),ns(!rs)},className:clsx("flex items-center gap-1.5 px-2 py-1 text-[10px] font-semibold rounded-lg flex-shrink-0 border transition-colors",as?[as.bgClass,as.textClass,es.filmingStatus==="complete"&&"border-green-200",es.filmingStatus==="partial"&&"border-amber-200",es.filmingStatus==="not-filmed"&&"border-red-200"]:"bg-gray-100 text-text-muted border-gray-200 hover:border-gray-300"),children:[as?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:clsx("w-2 h-2 rounded-full",es.filmingStatus==="complete"&&"bg-green-500",es.filmingStatus==="partial"&&"bg-amber-500",es.filmingStatus==="not-filmed"&&"bg-red-500")}),as.shortLabel]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),"Set Status"]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-3 h-3 transition-transform",rs&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),rs&&jsxRuntimeExports.jsx("div",{className:"absolute right-0 top-full mt-1 z-50 bg-white rounded-lg shadow-lg border border-border overflow-hidden min-w-[140px]",children:["complete","partial","not-filmed"].map(cs=>{const us=SCENE_FILMING_STATUS_CONFIG[cs],ds=es.filmingStatus===cs;return jsxRuntimeExports.jsxs("button",{onClick:ms=>{ms.stopPropagation(),ls(cs)},className:clsx("w-full flex items-center gap-2 px-3 py-2 text-xs font-medium transition-colors text-left",ds?`${us.bgClass} ${us.textClass}`:"hover:bg-gray-50 text-text-primary"),children:[jsxRuntimeExports.jsx("span",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{backgroundColor:us.color}}),us.label,ds&&jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 ml-auto text-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},cs)})})]})}function FilmingNotesModal({sceneNumber:es,status:ts,onConfirm:ss,onClose:rs}){const[ns,os]=reactExports.useState(""),as=SCENE_FILMING_STATUS_CONFIG[ts];return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:rs,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg max-h-[80vh] overflow-y-auto",onClick:ls=>ls.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:as.color}}),jsxRuntimeExports.jsxs("h2",{className:"text-lg font-semibold text-text-primary",children:["Scene ",es," - ",as.label]})]}),jsxRuntimeExports.jsx("button",{onClick:rs,className:"p-2 -mr-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:ts==="partial"?"What still needs to be filmed?":"Why wasn't this scene filmed?"}),jsxRuntimeExports.jsx("textarea",{value:ns,onChange:ls=>os(ls.target.value),placeholder:"e.g., Ran out of time, weather issues, actor unavailable...",className:"w-full px-3 py-2.5 text-sm border border-border rounded-lg bg-card text-text-primary resize-none focus:outline-none focus:ring-2 focus:ring-gold/50 focus:border-gold",rows:4,autoFocus:!0})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:rs,className:"flex-1 py-2.5 rounded-button border border-border text-text-muted text-sm font-medium",children:"Cancel"}),jsxRuntimeExports.jsxs("button",{onClick:()=>ss(ns),className:clsx("flex-1 py-2.5 rounded-button text-white text-sm font-medium",ts==="partial"?"bg-amber-500":"bg-red-500"),children:["Mark as ",as.label]})]})]})]})})}function Breakdown({onSceneSelect:es}){const{currentProject:ts,sceneCaptures:ss,updateSceneFilmingStatus:rs,clearSingleSceneAmendment:ns}=useProjectStore(),os=useScheduleStore(Ps=>Ps.schedule),[as,ls]=reactExports.useState("scene-number"),[cs,us]=reactExports.useState(!1),[ds,ms]=reactExports.useState({characters:[],location:null,completionStatus:"all",filmingStatus:"all",lookId:null}),[ps,hs]=reactExports.useState(null),[xs,ys]=reactExports.useState(null),[vs,gs]=reactExports.useState(null),[fs,js]=reactExports.useState(!1),Ss=reactExports.useCallback(async()=>{if(!(!ts||fs)){js(!0);try{const Ps=generateSceneBreakdownCSV(ts,ss),Fs=new Blob([Ps],{type:"text/csv"}),Us=URL.createObjectURL(Fs),Gs=document.createElement("a");Gs.href=Us,Gs.download=`${ts.name}_Scene_Breakdown.csv`,document.body.appendChild(Gs),Gs.click(),document.body.removeChild(Gs),URL.revokeObjectURL(Us)}finally{js(!1)}}},[ts,ss,fs]),[bs,Es]=reactExports.useState(null),Rs=(Ps,Fs,Us)=>{rs(Ps,Fs,Us)},ws=(Ps,Fs)=>{Es({sceneNumber:Ps,status:Fs})},Ns=Ps=>{bs&&(rs(bs.sceneNumber,bs.status,Ps),Es(null))},ks=reactExports.useMemo(()=>!xs||!ts?null:ts.scenes.find(Ps=>Ps.id===xs)||null,[xs,ts]),_s=reactExports.useMemo(()=>!vs||!ts?null:ts.scenes.find(Ps=>Ps.id===vs)||null,[vs,ts]),Ls=reactExports.useMemo(()=>{if(!ts)return{total:0,confirmed:0};const Ps=ts.scenes.length,Fs=ts.scenes.filter(Us=>Us.characterConfirmationStatus==="confirmed").length;return{total:Ps,confirmed:Fs}},[ts]),Os=reactExports.useMemo(()=>{if(!ts)return[];const Ps=new Set;return ts.scenes.forEach(Fs=>{const Us=Fs.slugline.match(/^(?:INT|EXT)\.\s*(.+?)\s*-/);Us&&Ps.add(Us[1].trim())}),Array.from(Ps).sort()},[ts]),zs=reactExports.useMemo(()=>{if(!ts)return[];let Ps=[...ts.scenes];if(ds.characters.length>0&&(Ps=Ps.filter(Fs=>ds.characters.some(Us=>Fs.characters.includes(Us)))),ds.completionStatus==="complete"?Ps=Ps.filter(Fs=>Fs.isComplete):ds.completionStatus==="incomplete"&&(Ps=Ps.filter(Fs=>!Fs.isComplete)),ds.filmingStatus!=="all"&&(Ps=Ps.filter(Fs=>Fs.filmingStatus===ds.filmingStatus)),ds.location&&(Ps=Ps.filter(Fs=>Fs.slugline.toLowerCase().includes(ds.location.toLowerCase()))),ds.lookId){const Fs=ts.looks.find(Us=>Us.id===ds.lookId);Fs&&(Ps=Ps.filter(Us=>Fs.scenes.includes(Us.sceneNumber)))}if(as==="shooting-order"&&(os!=null&&os.days)&&os.days.length>0){const Fs=new Map;for(const Us of os.days)for(const Gs of Us.scenes){const hr=Gs.sceneNumber.replace(/\s+/g,"").toUpperCase();Fs.set(hr,{day:Us.dayNumber,order:Gs.shootOrder})}return Ps.sort((Us,Gs)=>{const hr=Us.sceneNumber.replace(/\s+/g,"").toUpperCase(),ur=Gs.sceneNumber.replace(/\s+/g,"").toUpperCase(),cr=Fs.get(hr),Er=Fs.get(ur);return!cr&&!Er?Us.sceneNumber.localeCompare(Gs.sceneNumber,void 0,{numeric:!0}):cr?Er?cr.day!==Er.day?cr.day-Er.day:cr.order-Er.order:-1:1})}return Ps.sort((Fs,Us)=>Fs.sceneNumber.localeCompare(Us.sceneNumber,void 0,{numeric:!0}))},[ts,ds,as,os]),qs=reactExports.useMemo(()=>ts?new Map(ts.characters.map(Ps=>[Ps.id,Ps])):new Map,[ts==null?void 0:ts.characters]),Qs=reactExports.useMemo(()=>{if(!ts)return new Map;const Ps=new Map;for(const Fs of ts.scenes){const Us=Fs.characters.map(Gs=>qs.get(Gs)).filter(Gs=>Gs!==void 0);Ps.set(Fs.id,Us)}return Ps},[ts==null?void 0:ts.scenes,qs]),Ys=reactExports.useMemo(()=>{if(!ts)return new Map;const Ps=new Map;for(const Fs of ts.scenes){const Us=Fs.characters.length;let Gs=0;Fs.characters.forEach(hr=>{const ur=`${Fs.id}-${hr}`,cr=ss[ur];cr&&Object.keys(cr.photos).length>0&&Gs++}),Ps.set(Fs.id,{captured:Gs,total:Us})}return Ps},[ts==null?void 0:ts.scenes,ss]),Ws=reactExports.useMemo(()=>{if(!ts)return new Map;const Ps=new Map;for(const Fs of ts.looks)for(const Us of Fs.scenes)Ps.set(`${Fs.characterId}-${Us}`,Fs);return Ps},[ts==null?void 0:ts.looks]),Is=Ps=>Ys.get(Ps.id)||{captured:0,total:0},Bs=Ps=>Qs.get(Ps.id)||[],Vs=(Ps,Fs)=>Ws.get(`${Ps}-${Fs}`),Ds=(Ps,Fs)=>ss[`${Ps}-${Fs}`],Cs=()=>{ms({characters:[],location:null,completionStatus:"all",filmingStatus:"all",lookId:null})},Ts=ds.characters.length>0||ds.location!==null||ds.completionStatus!=="all"||ds.filmingStatus!=="all"||ds.lookId!==null,$s=!!(os!=null&&os.days&&os.days.length>0);return ts?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Breakdown"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[$s&&jsxRuntimeExports.jsx("button",{onClick:()=>ls(as==="scene-number"?"shooting-order":"scene-number"),className:clsx("p-2 rounded-lg transition-colors touch-manipulation",as==="shooting-order"?"text-gold bg-gold-100/50":"text-text-muted hover:text-gold"),title:as==="shooting-order"?"Sorted by shooting order":"Sort by shooting order",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5-3L16.5 18m0 0L12 13.5M16.5 18V4.5"})})}),jsxRuntimeExports.jsx("button",{onClick:Ss,disabled:fs,className:"p-2 rounded-lg transition-colors touch-manipulation text-text-muted hover:text-gold disabled:opacity-50",title:"Export Scene Breakdown",children:fs?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),jsxRuntimeExports.jsxs("button",{onClick:()=>us(!0),className:clsx("p-2 rounded-lg transition-colors touch-manipulation relative",Ts?"text-gold bg-gold-100/50":"text-text-muted hover:text-gold"),children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75"})}),Ts&&jsxRuntimeExports.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full bg-gold"})]})]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[zs.length," scene",zs.length!==1?"s":"",Ts&&" (filtered)"]}),as==="shooting-order"&&jsxRuntimeExports.jsx("span",{className:"text-xs text-gold font-medium",children:"Shooting Order"})]}),Ls.total>0&&Ls.confirmed<Ls.total&&jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx(CharacterConfirmationProgress,{totalScenes:Ls.total,confirmedScenes:Ls.confirmed})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 pb-4",children:zs.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("p",{className:"text-text-muted",children:"No scenes match your filters"}),jsxRuntimeExports.jsx("button",{onClick:Cs,className:"mt-3 text-sm text-gold font-medium",children:"Clear Filters"})]}):jsxRuntimeExports.jsx(BreakdownListView,{scenes:zs,expandedSceneId:ps,onToggleExpand:Ps=>hs(ps===Ps?null:Ps),onSceneSelect:es,onSynopsisClick:Ps=>ys(Ps),getCharactersForScene:Bs,getLookForCharacter:Vs,getCapture:Ds,getSceneProgress:Is,onCharacterConfirm:Ps=>gs(Ps),onFilmingStatusChange:Rs,onNotesModalOpen:ws,onDismissAmendment:Ps=>ns(Ps)})}),cs&&jsxRuntimeExports.jsx(FilterDrawer,{filters:ds,characters:ts.characters,locations:Os,looks:ts.looks,onFiltersChange:ms,onClose:()=>us(!1),onClear:Cs}),ks&&jsxRuntimeExports.jsx(SceneScriptModal,{scene:ks,onClose:()=>ys(null)}),_s&&jsxRuntimeExports.jsx(SceneCharacterConfirmation,{scene:_s,onClose:()=>gs(null),onConfirm:()=>gs(null)}),bs&&jsxRuntimeExports.jsx(FilmingNotesModal,{sceneNumber:bs.sceneNumber,status:bs.status,onConfirm:Ns,onClose:()=>Es(null)})]}):jsxRuntimeExports.jsx(EmptyState$1,{})}const getGlassOverlayClass=es=>{if(!es)return null;switch(es){case"complete":return"scene-glass-complete";case"partial":return"scene-glass-partial";case"not-filmed":return"scene-glass-incomplete";default:return null}};function BreakdownListView({scenes:es,expandedSceneId:ts,onToggleExpand:ss,onSceneSelect:rs,onSynopsisClick:ns,getCharactersForScene:os,getLookForCharacter:as,getCapture:ls,getSceneProgress:cs,onCharacterConfirm:us,onFilmingStatusChange:ds,onNotesModalOpen:ms,onDismissAmendment:ps}){return jsxRuntimeExports.jsx("div",{className:"space-y-2",children:es.map(hs=>{const xs=ts===hs.id,ys=os(hs),vs=cs(hs),gs=vs.total>0&&vs.captured===vs.total,fs=hs.filmingStatus?SCENE_FILMING_STATUS_CONFIG[hs.filmingStatus]:null,js=getGlassOverlayClass(hs.filmingStatus),Ss=()=>{if(!hs.filmingStatus)return"accent-bar-neutral";switch(hs.filmingStatus){case"complete":return"accent-bar-complete";case"partial":return"accent-bar-partial";case"not-filmed":return"accent-bar-incomplete";default:return"accent-bar-neutral"}};return jsxRuntimeExports.jsxs("div",{className:"card overflow-hidden relative",children:[js&&jsxRuntimeExports.jsx("div",{className:clsx("scene-glass-overlay",js)}),jsxRuntimeExports.jsx("div",{className:clsx("absolute left-0 top-0 bottom-0 w-1 rounded-l-card",Ss())}),jsxRuntimeExports.jsxs("button",{onClick:()=>ss(hs.id),className:"w-full flex items-center gap-3 p-3 text-left touch-manipulation",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-text-primary min-w-[2rem]",children:hs.sceneNumber}),hs.amendmentStatus&&hs.amendmentStatus!=="unchanged"&&jsxRuntimeExports.jsx(AmendmentBadge,{status:hs.amendmentStatus,notes:hs.amendmentNotes,onDismiss:()=>ps(hs.id)})]}),jsxRuntimeExports.jsx("span",{className:clsx("px-1.5 py-0.5 text-[10px] font-bold rounded flex-shrink-0",hs.intExt==="INT"?"bg-slate-100 text-slate-600":"bg-stone-100 text-stone-600"),children:hs.intExt}),jsxRuntimeExports.jsx("span",{className:"flex-1 text-sm text-text-secondary truncate",children:hs.slugline.replace(/^(INT|EXT)\.\s*/,"").replace(/\s*-\s*(DAY|NIGHT|MORNING|EVENING|CONTINUOUS)$/i,"")}),jsxRuntimeExports.jsxs("span",{className:"flex-shrink-0 flex items-center -space-x-1.5",children:[ys.slice(0,3).map(bs=>jsxRuntimeExports.jsx(CharacterAvatar,{character:bs,size:"xs"},bs.id)),ys.length>3&&jsxRuntimeExports.jsxs("span",{className:"w-5 h-5 rounded-full bg-gray-200 flex items-center justify-center text-[9px] font-bold text-text-muted",children:["+",ys.length-3]})]}),jsxRuntimeExports.jsx(FilmingStatusDropdown,{scene:hs,onStatusChange:ds,onNotesModalOpen:ms}),gs&&jsxRuntimeExports.jsx("span",{className:"text-green-500 flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),!gs&&vs.captured>0&&jsxRuntimeExports.jsx("span",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0 bg-gold"}),jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 text-text-light transition-transform flex-shrink-0",xs&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),jsxRuntimeExports.jsxs("div",{className:"px-3 pb-3 pt-1 border-t border-border/50",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:hs.slugline}),(hs.synopsis||hs.scriptContent)&&jsxRuntimeExports.jsxs("button",{onClick:bs=>{bs.stopPropagation(),ns(hs.id)},className:"w-full text-left group mt-1.5",children:[hs.synopsis&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted italic line-clamp-2 group-hover:text-gold transition-colors",children:hs.synopsis}),hs.scriptContent&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-gold flex items-center gap-1 mt-1",children:[jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Tap to view full scene"]})]}),jsxRuntimeExports.jsx("div",{className:"mt-2 pt-2 border-t border-border/30",children:jsxRuntimeExports.jsxs("button",{onClick:bs=>{bs.stopPropagation(),us(hs.id)},className:"inline-flex items-center gap-1 text-xs text-gold font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),ys.length>0?"Edit characters":"Add characters"]})})]}),xs&&jsxRuntimeExports.jsxs("div",{className:"border-t border-border px-3 pb-3 pt-3 space-y-3",children:[hs.filmingStatus&&jsxRuntimeExports.jsxs("div",{className:clsx("p-2.5 rounded-lg",fs==null?void 0:fs.bgClass),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(FilmingStatusIcon,{status:hs.filmingStatus}),jsxRuntimeExports.jsx("span",{className:clsx("text-sm font-medium",fs==null?void 0:fs.textClass),children:fs==null?void 0:fs.label})]}),hs.filmingNotes&&jsxRuntimeExports.jsx("p",{className:clsx("text-xs mt-1.5",fs==null?void 0:fs.textClass),children:hs.filmingNotes})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ys.map(bs=>{const Es=as(bs.id,hs.sceneNumber),Rs=ls(hs.id,bs.id),ws=Rs&&Object.keys(Rs.photos).length>0,Ns=Rs?Object.entries(Rs.continuityFlags).filter(([ks,_s])=>_s).map(([ks])=>ks):[];return jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:bs,size:"sm"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:bs.name}),Es&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-gold ml-2",children:[" ",Es.name]})]}),ws&&jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),Es&&jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[11px]",children:[Es.makeup.foundation&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-light",children:"Makeup:"})," ",jsxRuntimeExports.jsx("span",{className:"text-text-secondary",children:Es.makeup.foundation})]}),Es.hair.style&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-light",children:"Hair:"})," ",jsxRuntimeExports.jsx("span",{className:"text-text-secondary",children:Es.hair.style})]})]}),Ns.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Ns.map(ks=>jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[9px] font-medium rounded bg-amber-100 text-amber-700 capitalize",children:ks.replace(/([A-Z])/g," $1").trim()},ks))}),Rs&&Object.keys(Rs.photos).length>0&&jsxRuntimeExports.jsx("div",{className:"flex gap-1 mt-2",children:["front","left","right","back"].map(ks=>{const _s=Rs.photos[ks];return jsxRuntimeExports.jsx("div",{className:clsx("w-10 h-10 rounded overflow-hidden bg-gray-200",!_s&&"opacity-30"),children:_s&&jsxRuntimeExports.jsx("img",{src:_s.thumbnail||_s.uri,alt:ks,className:"w-full h-full object-cover"})},ks)})})]},bs.id)})}),jsxRuntimeExports.jsx("button",{onClick:()=>rs(hs.id),className:"w-full py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-[0.98] transition-transform",children:vs.captured>0?"Edit Details":"Capture Continuity"})]})]},hs.id)})})}function FilmingStatusIcon({status:es}){const ts=SCENE_FILMING_STATUS_CONFIG[es];return es==="complete"?jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:ts.color},children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}):es==="partial"?jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:ts.color},children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}):jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:ts.color},children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})}function FilterDrawer({filters:es,characters:ts,locations:ss,looks:rs,onFiltersChange:ns,onClose:os,onClear:as}){const ls=cs=>{const us=es.characters.includes(cs)?es.characters.filter(ds=>ds!==cs):[...es.characters,cs];ns({...es,characters:us})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:os,children:jsxRuntimeExports.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-80 max-w-full bg-card shadow-xl overflow-y-auto",onClick:cs=>cs.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold text-text-primary",children:"Filters"}),jsxRuntimeExports.jsx("button",{onClick:os,className:"p-1 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-5",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"FILMING STATUS"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ns({...es,filmingStatus:"all"}),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full transition-colors",es.filmingStatus==="all"?"bg-gold text-white":"bg-gray-100 text-text-muted"),children:"All"}),["complete","partial","not-filmed"].map(cs=>{const us=SCENE_FILMING_STATUS_CONFIG[cs];return jsxRuntimeExports.jsxs("button",{onClick:()=>ns({...es,filmingStatus:cs}),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full transition-colors flex items-center gap-1.5",es.filmingStatus===cs?`${us.bgClass} ${us.textClass}`:"bg-gray-100 text-text-muted"),children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:us.color}}),us.shortLabel]},cs)})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"CONTINUITY STATUS"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:["all","complete","incomplete"].map(cs=>jsxRuntimeExports.jsx("button",{onClick:()=>ns({...es,completionStatus:cs}),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full transition-colors",es.completionStatus===cs?"bg-gold text-white":"bg-gray-100 text-text-muted"),children:cs==="all"?"All":cs==="complete"?"Captured":"Not Captured"},cs))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"CHARACTERS"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:ts.map(cs=>jsxRuntimeExports.jsxs("button",{onClick:()=>ls(cs.id),className:clsx("flex items-center gap-1.5 px-2.5 py-1.5 rounded-full text-xs font-medium transition-colors",es.characters.includes(cs.id)?"bg-gold text-white":"bg-gray-100 text-text-muted"),children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:cs,size:"xs"}),cs.name.split(" ")[0]]},cs.id))})]}),ss.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"LOCATION"}),jsxRuntimeExports.jsxs("select",{value:es.location||"",onChange:cs=>ns({...es,location:cs.target.value||null}),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary",children:[jsxRuntimeExports.jsx("option",{value:"",children:"All Locations"}),ss.map(cs=>jsxRuntimeExports.jsx("option",{value:cs,children:cs},cs))]})]}),rs.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"LOOK"}),jsxRuntimeExports.jsxs("select",{value:es.lookId||"",onChange:cs=>ns({...es,lookId:cs.target.value||null}),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary",children:[jsxRuntimeExports.jsx("option",{value:"",children:"All Looks"}),rs.map(cs=>{const us=ts.find(ds=>ds.id===cs.characterId);return jsxRuntimeExports.jsxs("option",{value:cs.id,children:[us==null?void 0:us.name.split(" ")[0]," - ",cs.name]},cs.id)})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"sticky bottom-0 bg-card border-t border-border p-4 flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:as,className:"flex-1 py-2.5 rounded-button border border-border text-text-muted text-sm font-medium",children:"Clear All"}),jsxRuntimeExports.jsx("button",{onClick:os,className:"flex-1 py-2.5 rounded-button gold-gradient text-white text-sm font-medium",children:"Apply"})]})]})})}function EmptyState$1(){return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"h-14 px-4 flex items-center",children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Breakdown"})})})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125"})})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"No Breakdown Data"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Sync from desktop or upload a script to generate scenes"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{className:"px-4 py-2.5 rounded-button border border-gold text-gold text-sm font-medium active:scale-95 transition-transform",children:"Sync Now"}),jsxRuntimeExports.jsx("button",{className:"px-4 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform",children:"Upload Script"})]})]})]})}function LookCard({look:es,character:ts,progress:ss}){const{currentProject:rs,sceneCaptures:ns,setCurrentLook:os}=useProjectStore(),as=ss.total>0?ss.captured/ss.total*100:0,ls=ss.captured===ss.total&&ss.total>0,us=(()=>{if(!rs)return null;for(let ds=es.scenes.length-1;ds>=0;ds--){const ms=es.scenes[ds],ps=rs.scenes.find(hs=>hs.sceneNumber===ms);if(ps){const hs=`${ps.id}-${es.characterId}`,xs=ns[hs];if(xs&&(xs.photos.front||xs.additionalPhotos.length>0))return{sceneNum:ms,capture:xs}}}return null})();return jsxRuntimeExports.jsx("div",{className:"bg-card rounded-card overflow-hidden shadow-card",children:jsxRuntimeExports.jsxs("button",{onClick:()=>os(es.id),className:"w-full p-4 text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-2 mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h4",{className:"text-[15px] font-bold text-text-primary",children:es.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Scenes ",es.scenes.join(", "),"  ~",es.estimatedTime," min"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:`text-[11px] font-semibold ${ls?"text-success":"text-gold"}`,children:[ss.captured,"/",ss.total]}),jsxRuntimeExports.jsx("svg",{className:"w-[18px] h-[18px] text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]}),jsxRuntimeExports.jsx("div",{className:"mb-3",children:jsxRuntimeExports.jsx("div",{className:"h-[3px] bg-gray-100 rounded-sm overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:`h-full rounded-sm transition-all duration-300 ${ls?"bg-success":"gold-gradient"}`,style:{width:`${as}%`}})})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-[60px] h-[60px] rounded-lg bg-input-bg border border-border flex-shrink-0 overflow-hidden flex items-center justify-center",children:es.masterReference?jsxRuntimeExports.jsx("img",{src:es.masterReference.thumbnail||es.masterReference.uri,alt:"Master reference",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),us?jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("span",{className:"text-[9px] font-semibold tracking-wider uppercase text-text-light block mb-1.5",children:["Scene ",us.sceneNum]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-4 gap-1",children:["front","left","right","back"].map(ds=>{const ms=us.capture.photos[ds];return jsxRuntimeExports.jsx("div",{className:`aspect-[3/4] rounded ${ms?"bg-gray-200 border border-gold":"bg-input-bg border border-border"} flex items-center justify-center`,children:ms?jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}):jsxRuntimeExports.jsx("svg",{className:"w-2.5 h-2.5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"})})},ds)})})]}):jsxRuntimeExports.jsx("div",{className:"flex-1 bg-input-bg rounded-lg p-3 text-center",children:jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-light",children:"No captures yet"})})]})]})})}function CharacterSection({character:es,looks:ts,capturedScenes:ss,totalScenes:rs,getCaptureProgress:ns,onAddLook:os}){const[as,ls]=reactExports.useState(!1),[cs,us]=reactExports.useState(!1),[ds,ms]=reactExports.useState(!1),{getCastProfile:ps,updateCastProfile:hs}=useProjectStore(),xs=ps(es.id)||createEmptyCastProfile(es.id),ys=xs.actorName||xs.phone||xs.email||xs.allergies||xs.specialRequirements||xs.profilePhotoUri;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>ls(!as),className:"w-full py-3 flex items-center justify-between text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[xs.profilePhotoUri?jsxRuntimeExports.jsx("img",{src:xs.profilePhotoUri,alt:es.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-semibold flex-shrink-0",style:{background:`linear-gradient(135deg, ${es.avatarColour||"#C9A962"} 0%, ${adjustColor(es.avatarColour||"#C9A962",-20)} 100%)`},children:es.actorNumber??es.initials}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-[17px] font-bold text-gold truncate",children:es.name}),es.actorNumber&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-muted font-medium",children:["#",es.actorNumber]})]}),xs.actorName&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-secondary truncate",children:xs.actorName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-0.5",children:[ts.length," look",ts.length!==1?"s":"","  ",ss,"/",rs," scenes"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[ys&&jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full bg-success",title:"Profile complete"}),xs.allergies&&jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500",title:"Has allergies"})]})]}),jsxRuntimeExports.jsx("svg",{className:`w-5 h-5 text-text-light transition-transform duration-200 flex-shrink-0 ${as?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),jsxRuntimeExports.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${as?"max-h-[3000px] opacity-100":"max-h-0 opacity-0"}`,children:jsxRuntimeExports.jsxs("div",{className:"pl-[52px] space-y-2.5",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-card shadow-card overflow-hidden",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>us(!cs),className:"w-full px-4 py-3 flex items-center justify-between text-left touch-manipulation",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-text-muted uppercase tracking-wide",children:"Cast Profile"}),jsxRuntimeExports.jsx("svg",{className:`w-4 h-4 text-text-muted transition-transform ${cs?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),cs&&jsxRuntimeExports.jsxs("div",{className:"px-4 pb-4 pt-1 space-y-3 border-t border-border",children:[xs.profilePhotoUri&&jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("img",{src:xs.profilePhotoUri,alt:xs.actorName||es.name,className:"w-20 h-20 rounded-full object-cover border-2 border-gold"})}),xs.actorName&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"ACTOR"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary mt-0.5",children:xs.actorName})]}),(xs.phone||xs.email)&&jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[xs.phone&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"PHONE"}),jsxRuntimeExports.jsx("a",{href:`tel:${xs.phone}`,className:"text-sm text-gold mt-0.5 block",children:xs.phone})]}),xs.email&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"EMAIL"}),jsxRuntimeExports.jsx("a",{href:`mailto:${xs.email}`,className:"text-sm text-gold mt-0.5 block truncate",children:xs.email})]})]}),(xs.agentName||xs.agentPhone||xs.agentEmail)&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"AGENT"}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-sm",children:[xs.agentName&&jsxRuntimeExports.jsx("p",{className:"text-text-primary",children:xs.agentName}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mt-0.5",children:[xs.agentPhone&&jsxRuntimeExports.jsx("a",{href:`tel:${xs.agentPhone}`,className:"text-gold",children:xs.agentPhone}),xs.agentEmail&&jsxRuntimeExports.jsx("a",{href:`mailto:${xs.agentEmail}`,className:"text-gold truncate",children:xs.agentEmail})]})]})]}),xs.allergies&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-red-600 uppercase tracking-wide",children:"ALLERGIES"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700 mt-0.5",children:xs.allergies})]}),xs.specialRequirements&&jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-amber-600 uppercase tracking-wide",children:"SPECIAL REQUIREMENTS"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-700 mt-0.5",children:xs.specialRequirements})]}),xs.skinType&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"SKIN TYPE"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary mt-0.5",children:xs.skinType})]}),xs.notes&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"NOTES"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mt-0.5",children:xs.notes})]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",fullWidth:!0,onClick:()=>ms(!0),children:ys?"Edit Profile":"Add Profile Information"})]})]}),ts.length>0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[ts.map(vs=>jsxRuntimeExports.jsx(LookCard,{look:vs,character:es,progress:ns(vs)},vs.id)),jsxRuntimeExports.jsxs("button",{onClick:os,className:"w-full py-3.5 flex items-center justify-center gap-1.5 text-[13px] font-medium text-text-muted bg-card border-2 border-dashed border-gray-200 rounded-card hover:border-gold-300 hover:text-gold transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add New Look"]})]}):jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-card p-6 text-center",children:[jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300 mx-auto mb-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253",strokeLinecap:"round",strokeLinejoin:"round"})}),jsxRuntimeExports.jsx("p",{className:"text-[13px] text-text-muted mb-1",children:"No looks defined"}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mb-3",children:"Sync from desktop or create manually"}),jsxRuntimeExports.jsx("button",{onClick:os,className:"px-5 py-2.5 rounded-full bg-gold-100/50 text-gold text-xs font-semibold",children:"+ Add Look"})]})]})})]}),jsxRuntimeExports.jsx(EditCastProfileModal,{isOpen:ds,onClose:()=>ms(!1),character:es,profile:xs,onSave:vs=>{hs(es.id,vs),ms(!1)}})]})}function EditCastProfileModal({isOpen:es,onClose:ts,character:ss,profile:rs,onSave:ns}){const[os,as]=reactExports.useState(rs.actorName),[ls,cs]=reactExports.useState(rs.phone),[us,ds]=reactExports.useState(rs.email),[ms,ps]=reactExports.useState(rs.agentName),[hs,xs]=reactExports.useState(rs.agentPhone),[ys,vs]=reactExports.useState(rs.agentEmail),[gs,fs]=reactExports.useState(rs.allergies),[js,Ss]=reactExports.useState(rs.specialRequirements),[bs,Es]=reactExports.useState(rs.skinType),[Rs,ws]=reactExports.useState(rs.notes),[Ns,ks]=reactExports.useState(rs.profilePhotoUri||""),_s=reactExports.useRef(null),Ls=zs=>{var Ys;const qs=(Ys=zs.target.files)==null?void 0:Ys[0];if(!qs)return;const Qs=new FileReader;Qs.onload=()=>{const Ws=new Image;Ws.onload=()=>{const Is=document.createElement("canvas"),Bs=256;Is.width=Bs,Is.height=Bs;const Vs=Is.getContext("2d"),Ds=Math.min(Ws.width,Ws.height),Cs=(Ws.width-Ds)/2,Ts=(Ws.height-Ds)/2;Vs.drawImage(Ws,Cs,Ts,Ds,Ds,0,0,Bs,Bs),ks(Is.toDataURL("image/jpeg",.8))},Ws.src=Qs.result},Qs.readAsDataURL(qs),zs.target.value=""},Os=()=>{ns({actorName:os,phone:ls,email:us,agentName:ms,agentPhone:hs,agentEmail:ys,allergies:gs,specialRequirements:js,skinType:bs,notes:Rs,profilePhotoUri:Ns||void 0})};return jsxRuntimeExports.jsx(BottomSheet,{isOpen:es,onClose:ts,title:`${ss.name} - Cast Profile`,height:"auto",children:jsxRuntimeExports.jsxs("div",{className:"space-y-4 pb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-2",children:[jsxRuntimeExports.jsx("input",{ref:_s,type:"file",accept:"image/*",onChange:Ls,className:"hidden"}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>{var zs;return(zs=_s.current)==null?void 0:zs.click()},className:"relative group",children:[Ns?jsxRuntimeExports.jsx("img",{src:Ns,alt:"Headshot",className:"w-20 h-20 rounded-full object-cover border-2 border-gold"}):jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-input-bg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 right-0 w-6 h-6 rounded-full bg-gold flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]}),jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-muted",children:Ns?"Tap to change headshot":"Add headshot"}),Ns&&jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ks(""),className:"text-[11px] text-red-500 font-medium",children:"Remove photo"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Actor Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Input,{label:"ACTOR NAME",value:os,onChange:zs=>as(zs.target.value),placeholder:"Full name"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{label:"PHONE",value:ls,onChange:zs=>cs(zs.target.value),placeholder:"+44...",type:"tel"}),jsxRuntimeExports.jsx(Input,{label:"EMAIL",value:us,onChange:zs=>ds(zs.target.value),placeholder:"actor@email.com",type:"email"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Agent Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Input,{label:"AGENT NAME",value:ms,onChange:zs=>ps(zs.target.value),placeholder:"Agent or agency name"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{label:"AGENT PHONE",value:hs,onChange:zs=>xs(zs.target.value),placeholder:"+44...",type:"tel"}),jsxRuntimeExports.jsx(Input,{label:"AGENT EMAIL",value:ys,onChange:zs=>vs(zs.target.value),placeholder:"agent@agency.com",type:"email"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Health & Requirements"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Textarea,{label:"ALLERGIES",value:gs,onChange:zs=>fs(zs.target.value),placeholder:"List any allergies (latex, adhesives, specific products...)",rows:2}),jsxRuntimeExports.jsx(Textarea,{label:"SPECIAL REQUIREMENTS",value:js,onChange:zs=>Ss(zs.target.value),placeholder:"Sensitive skin, prefers certain products, etc.",rows:2}),jsxRuntimeExports.jsx(Input,{label:"SKIN TYPE",value:bs,onChange:zs=>Es(zs.target.value),placeholder:"Oily, dry, combination, sensitive..."})]})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Textarea,{label:"ADDITIONAL NOTES",value:Rs,onChange:zs=>ws(zs.target.value),placeholder:"Any other relevant information...",rows:3})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"lg",fullWidth:!0,onClick:ts,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:Os,children:"Save Profile"})]})]})})}function adjustColor(es,ts){const ss=parseInt(es.replace("#",""),16),rs=Math.max(0,Math.min(255,(ss>>16)+ts)),ns=Math.max(0,Math.min(255,(ss>>8&255)+ts)),os=Math.max(0,Math.min(255,(ss&255)+ts));return`#${((1<<24)+(rs<<16)+(ns<<8)+os).toString(16).slice(1)}`}function AddLookModal({isOpen:es,onClose:ts,preselectedCharacterId:ss}){const{currentProject:rs,setProject:ns}=useProjectStore(),[os,as]=reactExports.useState(""),[ls,cs]=reactExports.useState(""),[us,ds]=reactExports.useState(""),[ms,ps]=reactExports.useState(""),[hs,xs]=reactExports.useState("30");reactExports.useEffect(()=>{var vs;es&&(as(ss||((vs=rs==null?void 0:rs.characters[0])==null?void 0:vs.id)||""),cs(""),ds(""),ps(""),xs("30"))},[es,ss,rs]),reactExports.useEffect(()=>{if(os&&rs){const gs=rs.looks.filter(fs=>fs.characterId===os).length+1;cs(`Day ${gs}`)}},[os,rs]);const ys=()=>{if(!rs||!os||!ls.trim())return;const vs=parseInt(us,10)||1,gs=parseInt(ms,10)||vs,fs=[];for(let bs=Math.min(vs,gs);bs<=Math.max(vs,gs);bs++)fs.push(String(bs));const js={id:v4(),characterId:os,name:ls.trim(),scenes:fs,estimatedTime:parseInt(hs,10)||30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()},Ss=rs.looks.map(bs=>{if(bs.characterId===os&&fs.length>0){const Es=bs.scenes.filter(Rs=>!fs.includes(Rs));if(Es.length!==bs.scenes.length)return{...bs,scenes:Es}}return bs});ns({...rs,looks:[...Ss,js],updatedAt:new Date}),ts()};return reactExports.useEffect(()=>(es?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[es]),es?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm animate-fadeIn",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp max-h-[85vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Add New Look"}),jsxRuntimeExports.jsx("button",{onClick:ts,className:"p-2 -m-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"CHARACTER"}),jsxRuntimeExports.jsx("select",{value:os,onChange:vs=>as(vs.target.value),className:"input-field w-full",children:rs==null?void 0:rs.characters.map(vs=>jsxRuntimeExports.jsx("option",{value:vs.id,children:vs.name},vs.id))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"LOOK NAME"}),jsxRuntimeExports.jsx("input",{type:"text",value:ls,onChange:vs=>cs(vs.target.value),placeholder:"e.g., Day 1 - Professional",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:'Suggest descriptive names like "Day 1 - Office", "Post-Fight", etc.'})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"SCENE RANGE"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("input",{type:"number",value:us,onChange:vs=>ds(vs.target.value),placeholder:"Start",min:"1",className:"input-field w-24 text-center"}),jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"to"}),jsxRuntimeExports.jsx("input",{type:"number",value:ms,onChange:vs=>ps(vs.target.value),placeholder:"End",min:"1",className:"input-field w-24 text-center"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Which scenes use this look? You can adjust later."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"ESTIMATED APPLICATION TIME"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{type:"number",value:hs,onChange:vs=>xs(vs.target.value),min:"5",step:"5",className:"input-field w-24 text-center"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-gold-50 rounded-lg p-3",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gold-dark font-medium",children:"Standalone Mode"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"You can add makeup and hair details after creating the look, or sync from desktop for full specifications."})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-border flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ts,className:"flex-1 py-3 px-4 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:ys,disabled:!os||!ls.trim(),className:"flex-1 py-3 px-4 rounded-button gold-gradient text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Look"})]})]})}):null}function LookOverview({lookId:es,onBack:ts,onSceneClick:ss}){const{currentProject:rs,getCharacter:ns,sceneCaptures:os,updateLookWithPropagation:as,updateLook:ls}=useProjectStore(),[cs,us]=reactExports.useState(!1),[ds,ms]=reactExports.useState(!1),[ps,hs]=reactExports.useState(!1),[xs,ys]=reactExports.useState([]),[vs,gs]=reactExports.useState(0),[fs,js]=reactExports.useState(!1),Ss=rs==null?void 0:rs.looks.find(Cs=>Cs.id===es),bs=Ss?ns(Ss.characterId):void 0;if(!Ss||!bs||!rs)return null;const Rs=rs.scenes.filter(Cs=>Ss.scenes.includes(Cs.sceneNumber)).map(Cs=>{const Ts=`${Cs.id}-${Ss.characterId}`,$s=os[Ts],Ps=$s==null?void 0:$s.photos.front;return{scene:Cs,frontPhoto:Ps,hasCaptured:!!$s&&!!($s.photos.front||$s.additionalPhotos.length>0)}}),ws=Ss.continuityFlags||createEmptyContinuityFlags(),Ns=Ss.sfxDetails||createEmptySFXDetails(),ks=Ss.notes||"",_s=Ss.continuityEvents||[],Ls=(Cs=!1)=>{js(Cs),us(!0)},Os=async Cs=>{const Ts=await createPhotoFromBlob(Cs);if(fs){const $s=Ss.sfxDetails||createEmptySFXDetails();as(Ss.id,{sfxDetails:{...$s,sfxReferencePhotos:[...$s.sfxReferencePhotos,Ts]}})}else ls(Ss.id,{masterReference:Ts})},zs=()=>{ls(Ss.id,{masterReference:void 0})},qs=()=>{Ss.masterReference&&(ys([Ss.masterReference]),gs(0),hs(!0))},Qs=Cs=>{const Ts={...ws,[Cs]:!ws[Cs]};as(Ss.id,{continuityFlags:Ts})},Ys=Cs=>{const Ts={...Cs,id:`event-${Date.now()}`};ls(Ss.id,{continuityEvents:[..._s,Ts]}),ms(!1)},Ws=Cs=>{ls(Ss.id,{continuityEvents:_s.filter(Ts=>Ts.id!==Cs)})},Is=Cs=>{as(Ss.id,{sfxDetails:Cs})},Bs=Cs=>{const Ts=Ss.sfxDetails||createEmptySFXDetails();ls(Ss.id,{sfxDetails:{...Ts,sfxReferencePhotos:Ts.sfxReferencePhotos.filter($s=>$s.id!==Cs)}})},Vs=Cs=>{as(Ss.id,{notes:Cs})},Ds=Cs=>{var Ts;((Ts=Ss.masterReference)==null?void 0:Ts.id)===Cs&&zs(),ys($s=>$s.filter(Ps=>Ps.id!==Cs))};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ts,className:"w-8 h-8 flex items-center justify-center -ml-1",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-[17px] font-bold text-text-primary flex-1",children:"Look Overview"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"px-4 py-4 space-y-2.5 pb-32",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3.5",children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:bs,size:"xl"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h2",{className:"text-character-name text-gold font-bold truncate",children:bs.name}),jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-text-primary mt-0.5",children:Ss.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-0.5",children:["Scenes ",formatSceneRange(Ss.scenes)," "," ","~",formatEstimatedTime(Ss.estimatedTime)]})]})]}),(()=>{const Cs=[{key:"sweat",label:"Sweat"},{key:"dishevelled",label:"Dishevelled"},{key:"blood",label:"Blood"},{key:"dirt",label:"Dirt"},{key:"wetHair",label:"Wet Hair"},{key:"tears",label:"Tears"}].filter(({key:Ts})=>ws[Ts]);return Cs.length===0?null:jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:Cs.map(({key:Ts,label:$s})=>jsxRuntimeExports.jsx("span",{className:"px-3 py-1.5 text-xs font-semibold rounded-full bg-gold text-white",children:$s},Ts))})})(),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"MASTER REFERENCE"}),jsxRuntimeExports.jsx(MasterReference,{photo:Ss.masterReference,onCapture:()=>Ls(!1),onView:qs,onRemove:Ss.masterReference?zs:void 0}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-2",children:"This reference applies to all scenes in this look"})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"SCENE CONTINUITY"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-light",children:[Rs.filter(Cs=>Cs.hasCaptured).length,"/",Rs.length," captured"]})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-3 overflow-x-auto hide-scrollbar pb-1 -mx-1 px-1",children:Rs.map(({scene:Cs,frontPhoto:Ts,hasCaptured:$s})=>jsxRuntimeExports.jsxs("button",{onClick:()=>ss(Cs.id),className:"flex-shrink-0 w-20 group",children:[jsxRuntimeExports.jsx("div",{className:`aspect-[3/4] rounded-lg overflow-hidden border-2 transition-colors ${$s?"border-gold bg-gray-100":"border-gray-200 bg-gray-50"}`,children:Ts?jsxRuntimeExports.jsx("img",{src:Ts.thumbnail||Ts.uri,alt:`Scene ${Cs.sceneNumber}`,className:"w-full h-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-full h-full flex items-center justify-center",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})})}),jsxRuntimeExports.jsxs("div",{className:`text-center mt-1.5 text-[10px] font-semibold ${$s?"text-gold":"text-text-muted"}`,children:["Sc ",Cs.sceneNumber]})]},Cs.id))})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"QUICK FLAGS"}),jsxRuntimeExports.jsx(QuickFlags,{flags:ws,onToggle:Qs}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-2",children:"Flags set here apply to all scenes in this look"})]}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx(ContinuityEvents,{events:_s,onAddEvent:()=>ms(!0),onRemoveEvent:Ws})}),jsxRuntimeExports.jsx(Accordion,{title:"MAKEUP",count:countFilledFields(Ss.makeup),children:jsxRuntimeExports.jsx(MakeupForm,{makeup:Ss.makeup,onChange:Cs=>as(Ss.id,{makeup:Cs})})}),jsxRuntimeExports.jsx(Accordion,{title:"HAIR",count:countHairFields(Ss.hair),children:jsxRuntimeExports.jsx(HairForm,{hair:Ss.hair,onChange:Cs=>as(Ss.id,{hair:Cs})})}),jsxRuntimeExports.jsx(Accordion,{title:"SPECIAL EFFECTS",count:countSFXFields(Ns),badge:Ns.sfxRequired?void 0:"None",children:jsxRuntimeExports.jsx(SFXForm,{sfx:Ns,onChange:Is,onCapturePhoto:()=>Ls(!0),onRemovePhoto:Bs})}),jsxRuntimeExports.jsxs(Accordion,{title:"LOOK NOTES",children:[jsxRuntimeExports.jsx(NotesForm,{notes:ks,onChange:Vs}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-2",children:"Notes set here auto-fill into all scenes for this look"})]}),jsxRuntimeExports.jsxs("div",{className:"card flex items-center gap-3.5",children:[jsxRuntimeExports.jsx("label",{className:"field-label whitespace-nowrap",children:"APPLICATION TIME"}),jsxRuntimeExports.jsx("input",{type:"number",value:Ss.estimatedTime||"",onChange:Cs=>ls(Ss.id,{estimatedTime:Cs.target.value?parseInt(Cs.target.value,10):0}),className:"input-field w-16 text-center font-semibold",placeholder:"--",min:"0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]})]})}),jsxRuntimeExports.jsx(PhotoCapture,{isOpen:cs,onClose:()=>us(!1),onCapture:Os,angle:"front",characterName:bs.name,sceneNumber:Ss.scenes[0]||"",lookName:Ss.name}),jsxRuntimeExports.jsx(AddEventModal,{isOpen:ds,onClose:()=>ms(!1),onAdd:Ys,availableScenes:Ss.scenes}),jsxRuntimeExports.jsx(PhotoViewer,{isOpen:ps,photos:xs,initialIndex:vs,onClose:()=>hs(!1),onDelete:Ds})]})}function Lookbooks(){const{currentProject:es,sceneCaptures:ts,currentLookId:ss,setCurrentLook:rs,setActiveTab:ns,setCurrentScene:os}=useProjectStore(),{schedule:as}=useScheduleStore(),{callSheets:ls}=useCallSheetStore(),[cs,us]=reactExports.useState(!1),[ds,ms]=reactExports.useState(null),ps=reactExports.useMemo(()=>{const ws=new Map;for(const Ns of ls)for(const ks of Ns.scenes)if(ks.cast)for(const _s of ks.cast){const Ls=parseInt(_s,10);isNaN(Ls)||(ws.has(Ls)||ws.set(Ls,new Set),ws.get(Ls).add(ks.sceneNumber))}return ws},[ls]),hs=reactExports.useMemo(()=>{const ws=new Map;return es!=null&&es.characters&&es.characters.forEach(Ns=>{ws.set(Ns.id,{...Ns})}),as!=null&&as.castList&&as.castList.forEach(Ns=>{const ks=(Ns.character||Ns.name).toUpperCase(),_s=es==null?void 0:es.characters.find(Ls=>Ls.name.toUpperCase()===ks);if(_s){const Ls=ws.get(_s.id);Ls&&(Ls.actorNumber=Ns.number,ws.set(_s.id,Ls))}else{const Ls=Ns.character||Ns.name,Os=`cast-${Ns.number}`,zs=Ls.split(/\s+/).filter(Boolean),qs=zs.length>=2?`${zs[0][0]}${zs[zs.length-1][0]}`.toUpperCase():Ls.substring(0,2).toUpperCase(),Qs=["#C9A962","#8B5CF6","#EC4899","#14B8A6","#F59E0B","#6366F1","#22C55E","#EF4444"],Ys=Qs[Ns.number%Qs.length];ws.set(Os,{id:Os,name:Ls,initials:qs,avatarColour:Ys,actorNumber:Ns.number})}}),Array.from(ws.values()).sort((Ns,ks)=>{const _s=Ns.actorNumber??999,Ls=ks.actorNumber??999;return _s!==Ls?_s-Ls:Ns.name.localeCompare(ks.name)})},[es==null?void 0:es.characters,as==null?void 0:as.castList]),xs=reactExports.useCallback(()=>{const ws=new Map;return hs.forEach(Ns=>{ws.set(Ns.id,[])}),es!=null&&es.looks&&es.looks.forEach(Ns=>{const ks=ws.get(Ns.characterId)||[];ws.set(Ns.characterId,[...ks,Ns])}),ws},[es==null?void 0:es.looks,hs]),ys=reactExports.useCallback(ws=>{if(!es)return{captured:0,total:0};const Ns=ws.scenes.length;let ks=0;return ws.scenes.forEach(_s=>{const Ls=es.scenes.find(Os=>Os.sceneNumber===_s);if(Ls){const Os=`${Ls.id}-${ws.characterId}`,zs=ts[Os];zs&&(zs.photos.front||zs.additionalPhotos.length>0)&&ks++}}),{captured:ks,total:Ns}},[es,ts]),vs=ws=>hs.find(Ns=>Ns.id===ws),gs=ws=>{ms(ws||null),us(!0)},[fs,js]=reactExports.useState(!1),Ss=reactExports.useCallback(async()=>{if(!(!es||fs)){js(!0);try{const ws=es.characters.filter(Os=>es.looks.some(zs=>zs.characterId===Os.id)).map(Os=>{const zs=es.looks.filter(qs=>qs.characterId===Os.id);return generateCharacterLookbookPDF(Os,zs,es.scenes,ts)});if(ws.length===0)return;let Ns;if(ws.length===1)Ns=ws[0];else{const Os=ws.map(Qs=>{const Ys=Qs.match(/<body>([\s\S]*?)<\/body>/);return Ys?Ys[1]:""}),zs=ws[0].match(/<style>([\s\S]*?)<\/style>/),qs=zs?zs[1]:"";Ns=`<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>${es.name} - Lookbooks</title><style>${qs}</style></head><body>${Os.join('<div class="page-break"></div>')}</body></html>`}const ks=new Blob([Ns],{type:"text/html;charset=utf-8"}),_s=URL.createObjectURL(ks),Ls=window.open(_s,"_blank");Ls&&Ls.addEventListener("load",()=>{setTimeout(()=>Ls.print(),500)}),URL.revokeObjectURL(_s)}finally{js(!1)}}},[es,ts,fs]);if(ss)return jsxRuntimeExports.jsx(LookOverview,{lookId:ss,onBack:()=>rs(null),onSceneClick:ws=>{rs(null),ns("breakdown"),os(ws)}});if(!es)return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx(LookbooksHeader,{}),jsxRuntimeExports.jsx(EmptyState,{onAddLook:()=>gs()})]});const bs=xs(),Es=hs.length>0,Rs=hs.length;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx(LookbooksHeader,{onExport:Ss,isExporting:fs}),jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"px-4 pt-4 pb-24",children:[jsxRuntimeExports.jsx(SyncStatusBanner,{}),Es?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"section-header mb-3",children:["CAST & LOOKBOOKS (",Rs,")"]}),jsxRuntimeExports.jsx("div",{className:"space-y-5",children:Array.from(bs.entries()).map(([ws,Ns])=>{const ks=vs(ws);if(!ks)return null;let _s=0,Ls=0;Ns.forEach(Qs=>{const Ys=ys(Qs);_s+=Ys.captured,Ls+=Ys.total});const Os=ks.actorNumber?ps.get(ks.actorNumber):void 0,zs=(Os==null?void 0:Os.size)||0,qs=Math.max(Ls,zs);return jsxRuntimeExports.jsx(CharacterSection,{character:ks,looks:Ns,capturedScenes:_s,totalScenes:qs,getCaptureProgress:ys,onAddLook:()=>gs(ws)},ws)})})]}):jsxRuntimeExports.jsx(EmptyState,{onAddLook:()=>gs()})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>gs(),className:"fixed bottom-24 right-4 w-14 h-14 rounded-full gold-gradient shadow-lg flex items-center justify-center text-white z-40 active:scale-95 transition-transform","aria-label":"Add Look",children:jsxRuntimeExports.jsx("svg",{className:"w-7 h-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),jsxRuntimeExports.jsx(AddLookModal,{isOpen:cs,onClose:()=>us(!1),preselectedCharacterId:ds})]})}function LookbooksHeader({onExport:es,isExporting:ts}){return jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:"w-9"}),jsxRuntimeExports.jsx("h1",{className:"text-[17px] font-bold text-text-primary",children:"Lookbook"}),es?jsxRuntimeExports.jsx("button",{onClick:es,disabled:ts,className:"p-2 rounded-lg transition-colors touch-manipulation text-text-muted hover:text-gold disabled:opacity-50",title:"Export Lookbooks",children:ts?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})})}):jsxRuntimeExports.jsx("div",{className:"w-9"})]})})})}function EmptyState({onAddLook:es}){return jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-[60vh] px-8",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gold-100 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"No looks defined"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-6",children:"Sync from desktop or create looks manually"}),jsxRuntimeExports.jsxs("button",{onClick:es,className:"inline-flex items-center gap-2 px-6 py-3 rounded-button gold-gradient text-white font-medium shadow-sm active:scale-95 transition-transform",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Look"]})]})})}function parseTimeShorthand(es){if(!es)return"";let ts=es.trim().toLowerCase(),ss=!1,rs=!1;/p\.?m\.?$/.test(ts)||/p$/.test(ts)?(ss=!0,ts=ts.replace(/p\.?m\.?$|p$/,"").trim()):(/a\.?m\.?$/.test(ts)||/a$/.test(ts))&&(rs=!0,ts=ts.replace(/a\.?m\.?$|a$/,"").trim());let ns,os;if(ts.includes(":")){const as=ts.split(":");ns=parseInt(as[0],10),os=parseInt(as[1]||"0",10)}else{const as=ts.replace(/\D/g,"");if(!as)return"";if(as.length<=2)ns=parseInt(as,10),os=0;else if(as.length===3)ns=parseInt(as[0],10),os=parseInt(as.slice(1),10);else if(as.length===4)ns=parseInt(as.slice(0,2),10),os=parseInt(as.slice(2),10);else return""}return ss&&ns<12&&(ns+=12),rs&&ns===12&&(ns=0),isNaN(ns)||isNaN(os)||ns<0||ns>23||os<0||os>59?"":`${ns.toString().padStart(2,"0")}:${os.toString().padStart(2,"0")}`}const TIME_SLOTS=[];for(let es=5;es<=23;es++)TIME_SLOTS.push(`${es.toString().padStart(2,"0")}:00`),TIME_SLOTS.push(`${es.toString().padStart(2,"0")}:30`);function formatSlotLabel(es){const[ts,ss]=es.split(":"),rs=parseInt(ts,10),ns=rs<12?"am":"pm";return`${rs===0?12:rs>12?rs-12:rs}:${ss}${ns}`}function SmartTimeInput({value:es,onChange:ts,placeholder:ss,className:rs,style:ns}){const[os,as]=reactExports.useState(es||""),[ls,cs]=reactExports.useState(!1),[us,ds]=reactExports.useState(!1),ms=reactExports.useRef(null),ps=reactExports.useRef(null);reactExports.useEffect(()=>{ls||as(es||"")},[es,ls]),reactExports.useEffect(()=>{if(us&&ps.current&&es){const gs=TIME_SLOTS.indexOf(es);if(gs>=0){const fs=ps.current.children[gs];fs==null||fs.scrollIntoView({block:"center"})}}},[us,es]),reactExports.useEffect(()=>{if(!us)return;const gs=fs=>{ms.current&&!ms.current.contains(fs.target)&&ds(!1)};return document.addEventListener("mousedown",gs),()=>document.removeEventListener("mousedown",gs)},[us]);const hs=reactExports.useCallback(()=>{const gs=parseTimeShorthand(os);as(gs),gs!==es&&ts(gs)},[os,es,ts]),xs=()=>{cs(!1),hs()},ys=gs=>{gs.key==="Enter"&&gs.currentTarget.blur()},vs=gs=>{as(gs),ts(gs),ds(!1)};return jsxRuntimeExports.jsxs("div",{ref:ms,className:"relative flex items-center gap-1",children:[jsxRuntimeExports.jsx("input",{type:"text",inputMode:"numeric",value:os,onChange:gs=>as(gs.target.value),onBlur:xs,onFocus:()=>{cs(!0),ds(!1)},onKeyDown:ys,placeholder:ss||"00:00",className:rs,style:{...ns,flex:1}}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[jsxRuntimeExports.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider px-1 py-px rounded",style:{backgroundColor:"var(--color-border)",color:"var(--color-text-muted)"},children:"24hr"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:gs=>{gs.preventDefault(),ds(!us)},className:"p-0.5 rounded",style:{color:"var(--color-text-muted)"},"aria-label":"Pick time",children:jsxRuntimeExports.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("polyline",{points:"12 6 12 12 16 14"})]})})]}),us&&jsxRuntimeExports.jsx("div",{ref:ps,className:"absolute left-0 right-0 z-50 rounded-lg shadow-lg overflow-y-auto",style:{top:"100%",marginTop:4,maxHeight:200,backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)"},children:TIME_SLOTS.map(gs=>{const fs=gs===es;return jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>vs(gs),className:`w-full px-3 py-2 text-left text-[13px] flex justify-between items-center ${fs?"font-bold":""}`,style:{backgroundColor:fs?"var(--color-input-bg)":"transparent",color:fs?"var(--color-gold)":"var(--color-text-primary)",borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("span",{className:"font-mono",children:gs}),jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:11},children:formatSlotLabel(gs)})]},gs)})})]})}const DAY_LABELS$1=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],DAY_TYPES=["SWD","CWD","SCWD"];function WeekView({weekStartDate:es,onNavigate:ts}){const{entries:ss,calculateEntry:rs,saveEntry:ns,getEntry:os,rateCard:as}=useTimesheetStore(),[ls,cs]=reactExports.useState(null),[us,ds]=reactExports.useState(null),ms=()=>{const vs=new Date(es),gs=new Date(addDays(es,6)),fs=vs.getDate(),js=gs.getDate(),Ss=vs.toLocaleDateString("en-GB",{month:"short"}),bs=gs.toLocaleDateString("en-GB",{month:"short"}),Es=DAY_LABELS$1[0][0],Rs=DAY_LABELS$1[6][0];return Ss===bs?`${Es} ${fs} - ${Rs} ${js} ${Ss}`:`${Es} ${fs} ${Ss} - ${Rs} ${js} ${bs}`},ps=Array.from({length:7},(vs,gs)=>{const fs=addDays(es,gs),js=ss[fs],Ss=js?rs(js):null,bs=new Date().toISOString().split("T")[0];return{date:fs,dayLabel:DAY_LABELS$1[gs],dayNumber:new Date(fs).getDate(),entry:js,calc:Ss,isToday:fs===bs,isWeekend:gs>=5}}),hs=vs=>{ls===vs?(us&&us.date===vs&&ns(us),cs(null),ds(null)):(us&&ns(us),cs(vs),ds(os(vs)||createEmptyTimesheetEntry(vs)))},xs=(vs,gs)=>{if(!us)return;const fs={[vs]:gs};if(vs==="dayType"){const Ss=gs;fs.lunchTaken=getLunchDurationForDayType(Ss)}const js={...us,...fs};ds(js),ns(js)},ys=vs=>!(vs!=null&&vs.unitCall)||!(vs!=null&&vs.wrapOut)?null:`${vs.preCall||vs.unitCall}  ${vs.wrapOut}`;return jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ts("prev"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:ms()}),jsxRuntimeExports.jsx("button",{onClick:()=>ts("next"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ps.map(({date:vs,dayLabel:gs,dayNumber:fs,entry:js,calc:Ss,isToday:bs,isWeekend:Es})=>{const Rs=js&&js.unitCall&&js.wrapOut,ws=ls===vs,Ns=ys(js),ks=[];return Rs&&(js.dayType!=="SWD"&&ks.push(js.dayType),Ss&&Ss.preCallHours>0&&ks.push(`${Ss.preCallHours.toFixed(1)}h pre`),Ss&&Ss.otHours>0&&ks.push(`${Ss.otHours.toFixed(1)}h OT`),js.isSixthDay&&!js.isSeventhDay&&ks.push("6th day"),js.isSeventhDay&&ks.push("7th day")),jsxRuntimeExports.jsxs("div",{className:`rounded-xl overflow-hidden border transition-all ${bs?"border-2 border-gold":"border-border"}`,style:{backgroundColor:"var(--color-card)"},children:[jsxRuntimeExports.jsxs("div",{onClick:()=>hs(vs),className:"px-3.5 py-3 flex items-center cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 w-11 text-center mr-3",children:[jsxRuntimeExports.jsx("div",{className:`text-[10px] font-medium uppercase ${bs||Es?"text-gold":""}`,style:{color:bs||Es?void 0:"var(--color-text-muted)"},children:gs}),jsxRuntimeExports.jsx("div",{className:`text-xl font-bold ${bs?"text-gold":""}`,style:{color:bs?void 0:"var(--color-text-primary)"},children:fs})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:Rs?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"text-[14px] font-semibold",style:{color:"var(--color-text-primary)"},children:Ns}),ks.length>0&&jsxRuntimeExports.jsx("div",{className:"text-[11px] mt-0.5 truncate",style:{color:"var(--color-text-muted)"},children:ks.join("  ")})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:`text-[14px] font-medium ${bs?"text-gold":""}`,style:{color:bs?void 0:"var(--color-text-muted)"},children:bs?"Today":""}),jsxRuntimeExports.jsx("div",{className:"text-[12px] text-gold font-medium mt-0.5",children:"+ Add hours"})]})}),Ss&&Ss.totalHours>0&&jsxRuntimeExports.jsxs("div",{className:"text-right ml-3 flex-shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"text-[17px] font-bold text-gold leading-tight",children:[Ss.totalHours.toFixed(Ss.totalHours%1===0?0:1),"h"]}),Ss.totalEarnings>0&&jsxRuntimeExports.jsxs("div",{className:"text-[11px] font-medium leading-tight",style:{color:"var(--color-text-muted)"},children:["",Ss.totalEarnings.toFixed(0)]})]}),jsxRuntimeExports.jsx("svg",{className:`w-3 h-3 ml-2.5 flex-shrink-0 transition-transform ${ws?"rotate-180":""}`,style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),ws&&us&&jsxRuntimeExports.jsx(ExpandedDayContent,{entry:us,updateField:xs,calculation:rs(us),rateCard:as})]},vs)})})]})}function ExpandedDayContent({entry:es,updateField:ts,calculation:ss,rateCard:rs}){const ns=!!es.autoFilledFrom;return jsxRuntimeExports.jsxs("div",{className:"px-4 pb-4 pt-3 space-y-3",style:{borderTop:"1px solid var(--color-border)"},onClick:os=>os.stopPropagation(),children:[ns&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-emerald-600 bg-emerald-50 px-3 py-2 rounded-lg",children:[jsxRuntimeExports.jsx("span",{children:""}),jsxRuntimeExports.jsxs("span",{children:["Times auto-filled from Day ",es.productionDay," call sheet"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-[11px] uppercase tracking-wide font-medium min-w-[70px]",style:{color:"var(--color-text-muted)"},children:"Day Type"}),jsxRuntimeExports.jsx("select",{value:es.dayType,onChange:os=>ts("dayType",os.target.value),className:"flex-1 py-2.5 px-3 rounded-lg text-sm font-medium appearance-none bg-no-repeat",style:{backgroundColor:"var(--color-input-bg)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E")`,backgroundPosition:"right 12px center"},children:DAY_TYPES.map(os=>jsxRuntimeExports.jsxs("option",{value:os,children:[os," - ",DAY_TYPE_LABELS[os]]},os))})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs("label",{className:`flex items-center gap-2 px-3.5 py-2.5 rounded-lg cursor-pointer border ${es.isSixthDay?"bg-orange-50 border-orange-400":""}`,style:es.isSixthDay?void 0:{backgroundColor:"var(--color-input-bg)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:`w-[18px] h-[18px] rounded flex items-center justify-center text-xs ${es.isSixthDay?"bg-orange-500 border-orange-500 text-white":"border-2"}`,style:es.isSixthDay?void 0:{borderColor:"#ccc"},children:es.isSixthDay&&""}),jsxRuntimeExports.jsx("span",{className:"text-[13px] font-medium",style:{color:"var(--color-text-primary)"},children:"6th Day"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-orange-500",children:["(",rs.sixthDayMultiplier,"x)"]}),jsxRuntimeExports.jsx("input",{type:"checkbox",checked:es.isSixthDay,onChange:os=>{ts("isSixthDay",os.target.checked),os.target.checked&&ts("isSeventhDay",!1)},className:"sr-only"})]}),jsxRuntimeExports.jsxs("label",{className:`flex items-center gap-2 px-3.5 py-2.5 rounded-lg cursor-pointer border ${es.isSeventhDay?"bg-red-50 border-red-400":""}`,style:es.isSeventhDay?void 0:{backgroundColor:"var(--color-input-bg)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:`w-[18px] h-[18px] rounded flex items-center justify-center text-xs ${es.isSeventhDay?"bg-red-600 border-red-600 text-white":"border-2"}`,style:es.isSeventhDay?void 0:{borderColor:"#ccc"},children:es.isSeventhDay&&""}),jsxRuntimeExports.jsx("span",{className:"text-[13px] font-medium",style:{color:"var(--color-text-primary)"},children:"7th Day"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-red-600",children:["(",rs.seventhDayMultiplier,"x)"]}),jsxRuntimeExports.jsx("input",{type:"checkbox",checked:es.isSeventhDay,onChange:os=>{ts("isSeventhDay",os.target.checked),os.target.checked&&ts("isSixthDay",!1)},className:"sr-only"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[jsxRuntimeExports.jsx(TimeInputCell,{label:"Pre-Call",value:es.preCall,onChange:os=>ts("preCall",os),highlight:"gold",hint:`@ ${rs.preCallMultiplier}x`}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Unit Call",value:es.unitCall,onChange:os=>ts("unitCall",os)}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Lunch",value:es.lunchStart||"",onChange:os=>ts("lunchStart",os)}),jsxRuntimeExports.jsxs("div",{className:"p-2.5 rounded-lg",style:{backgroundColor:"var(--color-input-bg)",border:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:"text-[10px] uppercase tracking-wide mb-0.5",style:{color:"var(--color-text-muted)"},children:"Lunch Duration"}),jsxRuntimeExports.jsxs("select",{value:es.lunchTaken,onChange:os=>ts("lunchTaken",parseInt(os.target.value)),className:"text-[15px] font-semibold bg-transparent w-full appearance-none",style:{color:"var(--color-text-primary)"},children:[jsxRuntimeExports.jsx("option",{value:30,children:"30 min"}),jsxRuntimeExports.jsx("option",{value:45,children:"45 min"}),jsxRuntimeExports.jsx("option",{value:60,children:"1 hr"}),jsxRuntimeExports.jsx("option",{value:0,children:"None"})]})]}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Unit Wrap",value:es.outOfChair,onChange:os=>ts("outOfChair",os)}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Wrap Out",value:es.wrapOut,onChange:os=>ts("wrapOut",os),highlight:ss.otHours>0?"orange":void 0,hint:ss.otHours>0?"OT":void 0})]}),ss.totalHours>0&&jsxRuntimeExports.jsxs("div",{className:"rounded-lg p-3.5",style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsx("div",{className:"text-[10px] uppercase tracking-wide font-medium mb-2.5",style:{color:"var(--color-text-muted)"},children:"Hours Breakdown"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1.5",children:[ss.preCallHours>0&&jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Pre-Call",hours:ss.preCallHours,rate:`@ ${rs.preCallMultiplier}x`}),jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Base Hours",hours:ss.baseHours,rate:"@ 1x"}),ss.otHours>0&&jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Overtime",hours:ss.otHours,rate:`@ ${rs.otMultiplier}x`}),ss.lateNightHours>0&&jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Late Night",hours:ss.lateNightHours,rate:`@ ${rs.lateNightMultiplier}x`}),jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Lunch (unpaid)",hours:-(es.lunchTaken/60)}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pt-2.5 mt-2.5",style:{borderTop:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold",style:{color:"var(--color-text-primary)"},children:"Total Worked"}),jsxRuntimeExports.jsxs("span",{className:"text-base font-bold",style:{color:"var(--color-text-primary)"},children:[ss.totalHours.toFixed(1)," hrs"]})]})]})]}),ss.totalEarnings>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg gold-gradient text-white",children:[jsxRuntimeExports.jsx("span",{className:"text-[11px] uppercase tracking-wide opacity-90",children:"Day Earnings"}),jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold",children:["",ss.totalEarnings.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"text-[10px] uppercase tracking-wide font-medium mb-1.5",style:{color:"var(--color-text-muted)"},children:["Notes / OT Reason",ss.otHours>0&&jsxRuntimeExports.jsx("span",{className:"text-orange-500 ml-1",children:"(Required for OT)"})]}),jsxRuntimeExports.jsx("textarea",{value:es.notes,onChange:os=>ts("notes",os.target.value),placeholder:"e.g., Extended for reshoots, rain delay...",rows:2,className:"w-full p-3 rounded-lg text-[13px] resize-none",style:{backgroundColor:"var(--color-input-bg)",border:`1px solid ${ss.otHours>0&&!es.notes?"rgba(249, 115, 22, 0.5)":"var(--color-border)"}`,color:"var(--color-text-primary)"}})]})]})}function TimeInputCell({label:es,value:ts,onChange:ss,highlight:rs,hint:ns}){const os=rs==="gold"?{backgroundColor:"#fffbeb",border:"1px solid var(--color-gold)"}:rs==="orange"?{backgroundColor:"#fff7ed",border:"1px solid #f97316"}:{backgroundColor:"var(--color-input-bg)",border:"1px solid var(--color-border)"};return jsxRuntimeExports.jsxs("div",{className:"p-2.5 rounded-lg relative",style:{...os,overflow:"visible"},children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] uppercase tracking-wide",style:{color:"var(--color-text-muted)"},children:es}),ns&&jsxRuntimeExports.jsx("span",{className:"text-[9px] font-semibold",style:{color:rs==="orange"?"#f97316":"var(--color-gold)"},children:ns})]}),jsxRuntimeExports.jsx(SmartTimeInput,{value:ts,onChange:ss,className:"text-[15px] font-semibold bg-transparent outline-none min-w-0",style:{color:ts?"var(--color-text-primary)":"var(--color-text-muted)"}})]})}function BreakdownRow$1({label:es,hours:ts,rate:ss}){return jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-[13px]",children:[jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1.5",style:{color:"var(--color-text-muted)"},children:[es,ss&&jsxRuntimeExports.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:ss})]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:[(ts>0,""),ts.toFixed(1)," hrs"]})]})}const DAY_LABELS=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function TimesheetDocument({weekStartDate:es,onNavigate:ts}){const{entries:ss,calculateEntry:rs,getWeekSummary:ns,getPreviousWrapOut:os,rateCard:as}=useTimesheetStore(),ls=ns(es),cs=()=>{const hs=new Date(es),xs=new Date(addDays(es,6)),ys=hs.getDate(),vs=xs.getDate(),gs=hs.toLocaleDateString("en-GB",{month:"short"}),fs=xs.toLocaleDateString("en-GB",{month:"short"}),js=xs.getFullYear();return gs===fs?`${ys} - ${vs} ${gs} ${js}`:`${ys} ${gs} - ${vs} ${fs} ${js}`},us=Array.from({length:7},(hs,xs)=>{const ys=addDays(es,xs),vs=ss[ys],gs=os(ys),fs=vs?rs(vs,gs):null,js=new Date().toISOString().split("T")[0];return{date:ys,dayLabel:DAY_LABELS[xs],dayNumber:new Date(ys).getDate(),entry:vs,calc:fs,isToday:ys===js,hasData:!!(vs!=null&&vs.unitCall&&(vs!=null&&vs.wrapOut))}}),ds=us.filter(hs=>hs.hasData).length,ms=hs=>hs||"",ps=hs=>{switch(hs){case"CWD":return"bg-blue-100 text-blue-700";case"SCWD":return"bg-pink-100 text-pink-700";default:return"bg-gray-100 text-gray-600"}};return jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ts("prev"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:cs()}),jsxRuntimeExports.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-muted)"},children:[ds," day",ds!==1?"s":""," logged"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>ts("next"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl border overflow-hidden",style:{backgroundColor:"var(--color-card)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-white font-semibold text-sm",children:"WEEKLY TIMESHEET"}),jsxRuntimeExports.jsx("p",{className:"text-white/70 text-xs",children:cs()})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("div",{className:"text-white/70 text-xs",children:"Week Total"}),jsxRuntimeExports.jsxs("div",{className:"text-white font-bold text-lg",children:[ls.totalHours.toFixed(1)," hrs"]})]})]})}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full min-w-[600px] text-xs",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsx("th",{className:"text-left py-2 px-3 font-medium sticky left-0 z-10",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-text-muted)",minWidth:"80px"},children:""}),us.map(hs=>jsxRuntimeExports.jsxs("th",{className:`text-center py-2 px-2 font-medium ${hs.isToday?"text-gold":""}`,style:{color:hs.isToday?void 0:"var(--color-text-muted)",minWidth:"70px"},children:[jsxRuntimeExports.jsx("div",{className:"font-semibold",children:hs.dayLabel}),jsxRuntimeExports.jsx("div",{className:`text-lg ${hs.isToday?"text-gold":""}`,style:{color:hs.isToday?void 0:"var(--color-text-primary)"},children:hs.dayNumber})]},hs.date)),jsxRuntimeExports.jsx("th",{className:"text-center py-2 px-3 font-semibold",style:{backgroundColor:"var(--color-gold-light)",color:"var(--color-gold)",minWidth:"70px"},children:"Total"})]})}),jsxRuntimeExports.jsxs("tbody",{children:[jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Day Type"}),us.map(hs=>{var xs;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",children:(xs=hs.entry)!=null&&xs.dayType?jsxRuntimeExports.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${ps(hs.entry.dayType)}`,children:hs.entry.dayType}):jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-placeholder)"},children:""})},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("span",{className:"text-gold",children:"Pre-Call"})}),us.map(hs=>{var xs;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",style:{color:"var(--color-text-primary)"},children:ms((xs=hs.entry)==null?void 0:xs.preCall)},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3 font-medium",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-gold)"},children:ls.preCallHours>0?`${ls.preCallHours.toFixed(1)}h`:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Unit Call"}),us.map(hs=>{var xs;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2 font-medium",style:{color:"var(--color-text-primary)"},children:ms((xs=hs.entry)==null?void 0:xs.unitCall)},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Lunch"}),us.map(hs=>{var xs,ys;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",style:{color:"var(--color-text-muted)"},children:((xs=hs.entry)==null?void 0:xs.dayType)==="CWD"?jsxRuntimeExports.jsx("span",{className:"text-[10px]",children:"W.I.H"}):(ys=hs.entry)!=null&&ys.lunchTaken?`${hs.entry.lunchTaken}m`:""},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Wrap Out"}),us.map(hs=>{var xs;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2 font-medium",style:{color:"var(--color-text-primary)"},children:ms((xs=hs.entry)==null?void 0:xs.wrapOut)},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:9,className:"py-1",style:{backgroundColor:"var(--color-input-bg)"}})}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Base Hrs"}),us.map(hs=>{var xs;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",style:{color:"var(--color-text-primary)"},children:(xs=hs.calc)!=null&&xs.baseHours?hs.calc.baseHours.toFixed(1):""},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3 font-semibold",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-text-primary)"},children:ls.baseHours.toFixed(1)})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("span",{className:"text-orange-500",children:"Overtime"})}),us.map(hs=>{var xs;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2 text-orange-500",children:(xs=hs.calc)!=null&&xs.otHours?`+${hs.calc.otHours.toFixed(1)}`:""},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3 font-semibold text-orange-500",style:{backgroundColor:"var(--color-input-bg)"},children:ls.otHours>0?`+${ls.otHours.toFixed(1)}`:""})]}),jsxRuntimeExports.jsxs("tr",{style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3 font-semibold sticky left-0",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-text-primary)"},children:"Total Hrs"}),us.map(hs=>{var xs;return jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-2 font-bold",style:{color:"var(--color-text-primary)"},children:(xs=hs.calc)!=null&&xs.totalHours?hs.calc.totalHours.toFixed(1):""},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-3 font-bold text-gold",style:{backgroundColor:"var(--color-gold-light)"},children:ls.totalHours.toFixed(1)})]}),(ls.sixthDayHours>0||ls.seventhDayHours>0)&&jsxRuntimeExports.jsxs("tr",{style:{borderTop:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Premium"}),us.map(hs=>{var xs,ys;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",children:(xs=hs.entry)!=null&&xs.isSeventhDay?jsxRuntimeExports.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-red-100 text-red-600",children:"7th"}):(ys=hs.entry)!=null&&ys.isSixthDay?jsxRuntimeExports.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-orange-100 text-orange-600",children:"6th"}):jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-placeholder)"},children:""})},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{className:"gold-gradient",children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3 font-semibold text-white sticky left-0",style:{background:"inherit"},children:"Earnings"}),us.map(hs=>{var xs;return jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-2 text-white font-medium",children:(xs=hs.calc)!=null&&xs.totalEarnings?formatCurrency(hs.calc.totalEarnings):""},hs.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-3 font-bold text-white text-base",children:formatCurrency(ls.totalEarnings)})]})]})]})})]}),ls.totalEarnings>0&&jsxRuntimeExports.jsxs("div",{className:"mt-4 rounded-xl border p-4",style:{backgroundColor:"var(--color-card)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("h4",{className:"text-xs font-medium uppercase tracking-wide mb-3",style:{color:"var(--color-text-muted)"},children:"Earnings Breakdown"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(BreakdownRow,{label:"Base Pay",value:ls.basePay}),ls.preCallPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:`Pre-Call (${as.preCallMultiplier}x)`,value:ls.preCallPay,highlight:"gold"}),ls.overtimePay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:`Overtime (${as.otMultiplier}x)`,value:ls.overtimePay,highlight:"orange"}),ls.brokenLunchPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:"Broken Lunch",value:ls.brokenLunchPay,highlight:"amber"}),ls.brokenTurnaroundPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:"Broken Turnaround",value:ls.brokenTurnaroundPay,highlight:"purple"}),ls.lateNightPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:`Late Night (${as.lateNightMultiplier}x)`,value:ls.lateNightPay,highlight:"red"}),ls.kitRentalTotal>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:"Kit Rental",value:ls.kitRentalTotal}),jsxRuntimeExports.jsx("div",{className:"pt-2 mt-2",style:{borderTop:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:"Week Total"}),jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-gold",children:formatCurrency(ls.totalEarnings)})]})})]})]}),ds===0&&jsxRuntimeExports.jsxs("div",{className:"mt-6 text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",style:{backgroundColor:"var(--color-input-bg)"},children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8",style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),jsxRuntimeExports.jsx("h3",{className:"font-semibold mb-1",style:{color:"var(--color-text-primary)"},children:"No hours logged this week"}),jsxRuntimeExports.jsx("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:"Switch to Day view to log your hours"})]})]})}function BreakdownRow({label:es,value:ts,highlight:ss}){const rs={gold:"text-gold",orange:"text-orange-500",amber:"text-amber-500",red:"text-red-500",purple:"text-purple-500"};return jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm",children:[jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-muted)"},children:es}),jsxRuntimeExports.jsx("span",{className:`font-medium ${ss?rs[ss]:""}`,style:ss?void 0:{color:"var(--color-text-primary)"},children:formatCurrency(ts)})]})}function SummaryCard({summary:es}){const{rateCard:ts}=useTimesheetStore();return es.entries.length>0?jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center",children:[jsxRuntimeExports.jsx(SummaryItem,{label:"Days",value:es.entries.length.toString()}),jsxRuntimeExports.jsx(SummaryItem,{label:"Base Hrs",value:es.baseHours.toFixed(0)}),jsxRuntimeExports.jsx(SummaryItem,{label:"Pre-Call",value:es.preCallHours.toFixed(1),subtext:`@ ${ts.preCallMultiplier}x`}),jsxRuntimeExports.jsx(SummaryItem,{label:"Overtime",value:es.otHours.toFixed(1),subtext:`@ ${ts.otMultiplier}x`,highlight:!0})]}),(es.sixthDayHours>0||es.seventhDayHours>0||es.lateNightHours>0)&&jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center mt-3 pt-3",style:{borderTop:"1px solid var(--color-border)"},children:[es.sixthDayHours>0&&jsxRuntimeExports.jsx(SummaryItem,{label:"6th Day",value:es.sixthDayHours.toFixed(1),subtext:`@ ${ts.sixthDayMultiplier}x`}),es.seventhDayHours>0&&jsxRuntimeExports.jsx(SummaryItem,{label:"7th Day",value:es.seventhDayHours.toFixed(1),subtext:`@ ${ts.seventhDayMultiplier}x`}),es.lateNightHours>0&&jsxRuntimeExports.jsx(SummaryItem,{label:"Late Night",value:es.lateNightHours.toFixed(1),subtext:`@ ${ts.lateNightMultiplier}x`})]}),es.totalEarnings>0&&jsxRuntimeExports.jsxs("details",{className:"group mt-4",children:[jsxRuntimeExports.jsxs("summary",{className:"flex items-center justify-between cursor-pointer py-2",style:{borderTop:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("span",{className:"text-xs uppercase tracking-wide font-semibold",style:{color:"var(--color-text-muted)"},children:"Earnings Preview"}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 transition-transform group-open:rotate-180",style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),jsxRuntimeExports.jsxs("div",{className:"pt-3 space-y-2",children:[es.kitRentalTotal>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Kit Rental"}),jsxRuntimeExports.jsxs("span",{style:{color:"var(--color-text-primary)"},children:["",es.kitRentalTotal.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Est. Total"}),jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold text-gold",children:["",es.totalEarnings.toLocaleString("en-GB",{minimumFractionDigits:2})]})]})]})]})]}):jsxRuntimeExports.jsxs("div",{className:"card text-center py-8",children:[jsxRuntimeExports.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",style:{color:"var(--color-text-placeholder)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsx("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:"No entries this week"}),jsxRuntimeExports.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-placeholder)"},children:"Tap a day to log your hours"})]})}function SummaryItem({label:es,value:ts,subtext:ss,highlight:rs}){return jsxRuntimeExports.jsxs("div",{className:"py-2 px-1",children:[jsxRuntimeExports.jsx("div",{className:"text-[9px] uppercase tracking-wide font-medium mb-1",style:{color:"var(--color-text-placeholder)"},children:es}),jsxRuntimeExports.jsx("div",{className:`text-lg font-bold ${rs?"text-gold":""}`,style:{color:rs?void 0:"var(--color-text-primary)"},children:ts}),ss&&jsxRuntimeExports.jsx("div",{className:"text-[10px]",style:{color:"var(--color-text-placeholder)"},children:ss})]})}function ExportModal({isOpen:es,onClose:ts,weekSummary:ss,weekStartDate:rs}){const{entries:ns,calculateEntry:os,rateCard:as}=useTimesheetStore(),[ls,cs]=reactExports.useState("pdf"),[us,ds]=reactExports.useState(!1),[ms,ps]=reactExports.useState(!1);if(!es)return null;const hs=()=>{const Rs=[];for(let ws=0;ws<7;ws++){const Ns=addDays(rs,ws),ks=ns[Ns];ks&&Rs.push({date:Ns,entry:ks,calc:os(ks)})}return Rs},xs=ss.entries.length,vs=(()=>{let Rs=0,ws=0,Ns=0,ks=0,_s=0,Ls=0,Os=0,zs=0;return ss.entries.forEach(qs=>{const Qs=os(qs);Rs+=Qs.preCallHours,ws+=Qs.preCallEarnings,Ns+=Qs.workingHours,ks+=Qs.lateNightHours,_s+=Qs.dailyEarnings,Ls+=Qs.otEarnings,Os+=Qs.lateNightEarnings,zs+=Qs.sixthDayBonus}),{preCallHours:Rs,preCallPay:ws,workingHours:Ns,lateNightHours:ks,basePay:_s,otPay:Ls,lateNightPay:Os,sixthDayBonus:zs}})(),gs=Rs=>new Date(Rs).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}),fs=()=>{const Rs=new Date(rs),ws=new Date(addDays(rs,6));return`${Rs.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${ws.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}`},js=()=>{const Rs=hs(),ws=["Date","Day Type","Pre-Call","Unit Call","Out of Chair","Wrap Out","6th Day","Lunch (mins)","Pre-Call Hours","Working Hours","OT Hours","Late Night Hours","Total Hours","Pre-Call Pay","Base Pay","OT Pay","Late Night Pay","6th Day Bonus","Kit Rental","Total Earnings","Notes"],Ns=Rs.map(({date:ks,entry:_s,calc:Ls})=>[gs(ks),_s.dayType,_s.preCall||"",_s.unitCall||"",_s.outOfChair||"",_s.wrapOut||"",_s.isSixthDay?"Yes":"No",String(_s.lunchTaken??60),Ls.preCallHours.toFixed(2),Ls.workingHours.toFixed(2),Ls.otHours.toFixed(2),Ls.lateNightHours.toFixed(2),Ls.totalHours.toFixed(2),Ls.preCallEarnings.toFixed(2),Ls.dailyEarnings.toFixed(2),Ls.otEarnings.toFixed(2),Ls.lateNightEarnings.toFixed(2),Ls.sixthDayBonus.toFixed(2),Ls.kitRental.toFixed(2),Ls.totalEarnings.toFixed(2),_s.notes||""]);return Ns.push(["TOTAL","","","","","","","",vs.preCallHours.toFixed(2),vs.workingHours.toFixed(2),ss.otHours.toFixed(2),vs.lateNightHours.toFixed(2),ss.totalHours.toFixed(2),vs.preCallPay.toFixed(2),vs.basePay.toFixed(2),vs.otPay.toFixed(2),vs.lateNightPay.toFixed(2),vs.sixthDayBonus.toFixed(2),ss.kitRentalTotal.toFixed(2),ss.totalEarnings.toFixed(2),""]),[ws.join(","),...Ns.map(ks=>ks.join(","))].join(`
`)},Ss=()=>{const Rs=hs(),ws=as.dailyRate/as.baseDayHours,Ns="&pound;";return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Timesheet - ${fs()}</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 32px; max-width: 800px; margin: 0 auto; color: #1a1a1a; font-size: 13px; line-height: 1.5; }

    .header { margin-bottom: 24px; }
    .header h1 { font-size: 22px; font-weight: 700; margin-bottom: 2px; }
    .header .period { font-size: 14px; color: #C9A962; font-weight: 600; }

    .rate-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 24px; }
    .rate-card { background: #f8f8f8; border: 1px solid #e5e5e5; border-radius: 8px; padding: 10px 12px; text-align: center; }
    .rate-card .label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 2px; }
    .rate-card .value { font-size: 15px; font-weight: 700; }

    table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
    thead th { background: #f8f8f8; padding: 10px 8px; text-align: left; font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; color: #666; border-bottom: 2px solid #e5e5e5; }
    tbody td { padding: 10px 8px; border-bottom: 1px solid #f0f0f0; }
    tbody tr:last-child td { border-bottom: none; }
    .day-name { font-weight: 600; }
    .sixth-tag { display: inline-block; font-size: 9px; font-weight: 600; color: #C9A962; background: #faf6ed; border: 1px solid #C9A962; border-radius: 3px; padding: 1px 4px; margin-left: 4px; vertical-align: middle; }
    .amt { text-align: right; font-weight: 600; }
    .muted { color: #ccc; }
    tfoot td { border-top: 2px solid #C9A962; font-weight: 700; padding-top: 12px; }

    .summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px; }
    .summary-card { border: 1px solid #e5e5e5; border-radius: 8px; padding: 14px 12px; text-align: center; }
    .summary-card .label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 4px; }
    .summary-card .value { font-size: 20px; font-weight: 700; }
    .summary-card.gold { border-color: #C9A962; background: #faf6ed; }
    .summary-card.gold .value { color: #C9A962; }

    .sign-off { margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
    .sign-line { border-top: 1px solid #ccc; padding-top: 8px; font-size: 11px; color: #888; }

    .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #e5e5e5; font-size: 11px; color: #aaa; text-align: center; }

    @media print {
      body { padding: 16px; }
      .rate-card, .summary-card.gold, thead th { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>Timesheet</h1>
    <div class="period">${fs()}</div>
  </div>

  <div class="rate-cards">
    <div class="rate-card">
      <div class="label">Daily Rate</div>
      <div class="value">${Ns}${as.dailyRate.toFixed(2)}</div>
    </div>
    <div class="rate-card">
      <div class="label">Base Day</div>
      <div class="value">${as.baseDayHours} hrs</div>
    </div>
    <div class="rate-card">
      <div class="label">Hourly Rate</div>
      <div class="value">${Ns}${ws.toFixed(2)}</div>
    </div>
    <div class="rate-card">
      <div class="label">Kit Rental</div>
      <div class="value">${Ns}${as.kitRental.toFixed(2)}/day</div>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Pre-Call</th>
        <th>Unit Call</th>
        <th>Wrap</th>
        <th>Hours</th>
        <th>OT</th>
        <th class="amt">Earnings</th>
      </tr>
    </thead>
    <tbody>
      ${Rs.map(({date:ks,entry:_s,calc:Ls})=>`
      <tr>
        <td><span class="day-name">${gs(ks)}</span>${_s.isSixthDay?'<span class="sixth-tag">6th Day</span>':""}</td>
        <td>${_s.preCall||'<span class="muted">&mdash;</span>'}</td>
        <td>${_s.unitCall||'<span class="muted">&mdash;</span>'}</td>
        <td>${_s.wrapOut||'<span class="muted">&mdash;</span>'}</td>
        <td>${Ls.totalHours.toFixed(1)}</td>
        <td>${Ls.otHours>0?Ls.otHours.toFixed(1):'<span class="muted">&mdash;</span>'}</td>
        <td class="amt">${Ns}${Ls.totalEarnings.toFixed(2)}</td>
      </tr>`).join("")}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4">Total (${xs} days)</td>
        <td>${ss.totalHours.toFixed(1)}</td>
        <td>${ss.otHours>0?ss.otHours.toFixed(1):"&mdash;"}</td>
        <td class="amt">${Ns}${ss.totalEarnings.toFixed(2)}</td>
      </tr>
    </tfoot>
  </table>

  <div class="summary">
    <div class="summary-card">
      <div class="label">Days Worked</div>
      <div class="value">${xs}</div>
    </div>
    <div class="summary-card">
      <div class="label">Total Hours</div>
      <div class="value">${ss.totalHours.toFixed(1)}</div>
    </div>
    <div class="summary-card">
      <div class="label">OT Hours</div>
      <div class="value">${ss.otHours.toFixed(1)}</div>
    </div>
    <div class="summary-card gold">
      <div class="label">Total Earnings</div>
      <div class="value">${Ns}${ss.totalEarnings.toFixed(2)}</div>
    </div>
  </div>

  <div class="sign-off">
    <div>
      <div class="sign-line">Employee Signature</div>
    </div>
    <div>
      <div class="sign-line">Date</div>
    </div>
  </div>

  <div class="footer">
    Generated by Hair &amp; Makeup Pro
  </div>

</body>
</html>`},bs=()=>{const Rs=as.dailyRate/as.baseDayHours,ws=`INV-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`,Ns=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),ks="&pound;";return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice ${ws}</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; color: #1a1a1a; font-size: 14px; line-height: 1.5; }

    .inv-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 36px; padding-bottom: 20px; border-bottom: 3px solid #C9A962; }
    .inv-brand { font-size: 20px; font-weight: 700; color: #1a1a1a; }
    .inv-brand-sub { font-size: 12px; color: #888; margin-top: 2px; }
    .inv-title-block { text-align: right; }
    .inv-title { font-size: 28px; font-weight: 800; color: #C9A962; letter-spacing: 2px; }
    .inv-number { font-size: 13px; color: #666; margin-top: 2px; }

    .inv-details { display: flex; justify-content: space-between; margin-bottom: 32px; }
    .inv-col h3 { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 8px; font-weight: 600; }
    .inv-col p { font-size: 13px; color: #333; line-height: 1.7; }
    .inv-col strong { font-weight: 600; }
    .inv-placeholder { color: #bbb; font-style: italic; }

    table.inv-table { width: 100%; border-collapse: collapse; margin-bottom: 28px; }
    table.inv-table thead th { text-align: left; padding: 10px 10px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; color: #666; border-bottom: 2px solid #e5e5e5; }
    table.inv-table tbody td { padding: 14px 10px; border-bottom: 1px solid #f0f0f0; vertical-align: top; }
    table.inv-table tbody tr:last-child td { border-bottom: none; }
    table.inv-table .desc-sub { font-size: 12px; color: #888; margin-top: 2px; }
    table.inv-table .amt { text-align: right; font-weight: 600; white-space: nowrap; }

    .inv-totals { width: 280px; margin-left: auto; margin-bottom: 40px; }
    .inv-totals .row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px; }
    .inv-totals .row .lbl { color: #666; }
    .inv-totals .row .val { font-weight: 600; }
    .inv-totals .total-row { border-top: 2px solid #C9A962; padding-top: 10px; margin-top: 6px; }
    .inv-totals .total-row .lbl { font-weight: 700; font-size: 14px; color: #1a1a1a; }
    .inv-totals .total-row .val { font-weight: 800; font-size: 18px; color: #C9A962; }

    .inv-terms { background: #f8f8f8; border-radius: 8px; padding: 16px 20px; margin-bottom: 32px; font-size: 12px; color: #666; }
    .inv-terms strong { color: #333; }

    .inv-footer { padding-top: 16px; border-top: 1px solid #e5e5e5; font-size: 11px; color: #aaa; text-align: center; }

    @media print {
      body { padding: 20px; }
      .inv-header { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
</head>
<body>

  <div class="inv-header">
    <div>
      <div class="inv-brand">Hair &amp; Makeup Pro</div>
      <div class="inv-brand-sub">Freelance Services</div>
    </div>
    <div class="inv-title-block">
      <div class="inv-title">INVOICE</div>
      <div class="inv-number">${ws}</div>
    </div>
  </div>

  <div class="inv-details">
    <div class="inv-col">
      <h3>From</h3>
      <p>
        <span class="inv-placeholder">[Your Name]</span><br>
        <span class="inv-placeholder">[Your Address]</span><br>
        <span class="inv-placeholder">[City, Postcode]</span>
      </p>
    </div>
    <div class="inv-col">
      <h3>Bill To</h3>
      <p>
        <span class="inv-placeholder">[Production Company]</span><br>
        <span class="inv-placeholder">[Address]</span><br>
        <span class="inv-placeholder">[City, Postcode]</span>
      </p>
    </div>
    <div class="inv-col" style="text-align: right;">
      <h3>Invoice Details</h3>
      <p>
        <strong>Date:</strong> ${Ns}<br>
        <strong>Due:</strong> 30 days from receipt<br>
        <strong>Period:</strong> ${fs()}
      </p>
    </div>
  </div>

  <table class="inv-table">
    <thead>
      <tr>
        <th>Description</th>
        <th>Qty</th>
        <th>Rate</th>
        <th class="amt">Amount</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Hair &amp; Makeup Services &mdash; Base Day Rate<div class="desc-sub">${xs} days &times; ${as.baseDayHours} hours</div></td>
        <td>${xs}</td>
        <td>${ks}${as.dailyRate.toFixed(2)}</td>
        <td class="amt">${ks}${vs.basePay.toFixed(2)}</td>
      </tr>
      ${vs.preCallPay>0?`
      <tr>
        <td>Pre-Call Hours<div class="desc-sub">${vs.preCallHours.toFixed(1)} hours at hourly rate</div></td>
        <td>${vs.preCallHours.toFixed(1)} hrs</td>
        <td>${ks}${Rs.toFixed(2)}</td>
        <td class="amt">${ks}${vs.preCallPay.toFixed(2)}</td>
      </tr>`:""}
      ${vs.otPay>0?`
      <tr>
        <td>Overtime<div class="desc-sub">At ${as.otMultiplier}&times; hourly rate (${ks}${(Rs*as.otMultiplier).toFixed(2)}/hr)</div></td>
        <td>${ss.otHours.toFixed(1)} hrs</td>
        <td>${ks}${(Rs*as.otMultiplier).toFixed(2)}</td>
        <td class="amt">${ks}${vs.otPay.toFixed(2)}</td>
      </tr>`:""}
      ${vs.lateNightPay>0?`
      <tr>
        <td>Late Night Hours<div class="desc-sub">${vs.lateNightHours.toFixed(1)} hours after midnight</div></td>
        <td>${vs.lateNightHours.toFixed(1)} hrs</td>
        <td>&mdash;</td>
        <td class="amt">${ks}${vs.lateNightPay.toFixed(2)}</td>
      </tr>`:""}
      ${vs.sixthDayBonus>0?`
      <tr>
        <td>6th Day Premium<div class="desc-sub">Additional 50% for 6th consecutive working day</div></td>
        <td>&mdash;</td>
        <td>&mdash;</td>
        <td class="amt">${ks}${vs.sixthDayBonus.toFixed(2)}</td>
      </tr>`:""}
      ${ss.kitRentalTotal>0?`
      <tr>
        <td>Kit / Box Rental<div class="desc-sub">${xs} days at ${ks}${as.kitRental.toFixed(2)}/day</div></td>
        <td>${xs}</td>
        <td>${ks}${as.kitRental.toFixed(2)}</td>
        <td class="amt">${ks}${ss.kitRentalTotal.toFixed(2)}</td>
      </tr>`:""}
    </tbody>
  </table>

  <div class="inv-totals">
    <div class="row">
      <span class="lbl">Base Pay</span>
      <span class="val">${ks}${vs.basePay.toFixed(2)}</span>
    </div>
    ${vs.preCallPay>0?`<div class="row"><span class="lbl">Pre-Call</span><span class="val">${ks}${vs.preCallPay.toFixed(2)}</span></div>`:""}
    ${vs.otPay>0?`<div class="row"><span class="lbl">Overtime</span><span class="val">${ks}${vs.otPay.toFixed(2)}</span></div>`:""}
    ${vs.lateNightPay>0?`<div class="row"><span class="lbl">Late Night</span><span class="val">${ks}${vs.lateNightPay.toFixed(2)}</span></div>`:""}
    ${vs.sixthDayBonus>0?`<div class="row"><span class="lbl">6th Day Premium</span><span class="val">${ks}${vs.sixthDayBonus.toFixed(2)}</span></div>`:""}
    ${ss.kitRentalTotal>0?`<div class="row"><span class="lbl">Kit Rental</span><span class="val">${ks}${ss.kitRentalTotal.toFixed(2)}</span></div>`:""}
    <div class="row total-row">
      <span class="lbl">Total Due</span>
      <span class="val">${ks}${ss.totalEarnings.toFixed(2)}</span>
    </div>
  </div>

  <div class="inv-terms">
    <strong>Payment Terms:</strong> 30 days from invoice date. Please reference invoice number <strong>${ws}</strong> with payment.
  </div>

  <div class="inv-footer">
    Generated by Hair &amp; Makeup Pro
  </div>

</body>
</html>`},Es=async()=>{ds(!0),ps(!1);try{let Rs,ws,Ns;switch(ls){case"csv":Rs=js(),ws=`timesheet-${rs}.csv`,Ns="text/csv";break;case"pdf":Rs=Ss(),ws=`timesheet-${rs}.html`,Ns="text/html";break;case"invoice":Rs=bs(),ws=`invoice-${rs}.html`,Ns="text/html";break}const ks=new Blob([Rs],{type:Ns==="text/html"?"text/html;charset=utf-8":Ns}),_s=URL.createObjectURL(ks);if(ls==="pdf"||ls==="invoice"){const Ls=window.open(_s,"_blank");Ls&&Ls.addEventListener("load",()=>{setTimeout(()=>Ls.print(),500)})}else{const Ls=document.createElement("a");Ls.href=_s,Ls.download=ws,document.body.appendChild(Ls),Ls.click(),document.body.removeChild(Ls)}URL.revokeObjectURL(_s),ps(!0),setTimeout(()=>ps(!1),2e3)}catch(Rs){console.error("Export failed:",Rs)}finally{ds(!1)}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl w-full max-w-sm overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:"Export Timesheet"}),jsxRuntimeExports.jsx("button",{onClick:ts,className:"p-1 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted mb-4",children:["Week of ",fs()]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 mb-6",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"EXPORT FORMAT"}),jsxRuntimeExports.jsx("button",{onClick:()=>cs("pdf"),className:`w-full p-3 rounded-card border-2 text-left transition-all ${ls==="pdf"?"border-gold bg-gold-50":"border-border bg-input-bg hover:border-gold/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${ls==="pdf"?"bg-gold text-white":"bg-gray-200 text-text-muted"}`,children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-text-primary",children:"PDF Timesheet"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Print-ready document"})]})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>cs("csv"),className:`w-full p-3 rounded-card border-2 text-left transition-all ${ls==="csv"?"border-gold bg-gold-50":"border-border bg-input-bg hover:border-gold/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${ls==="csv"?"bg-gold text-white":"bg-gray-200 text-text-muted"}`,children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-text-primary",children:"CSV Spreadsheet"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"For Excel/Google Sheets"})]})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>cs("invoice"),className:`w-full p-3 rounded-card border-2 text-left transition-all ${ls==="invoice"?"border-gold bg-gold-50":"border-border bg-input-bg hover:border-gold/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${ls==="invoice"?"bg-gold text-white":"bg-gray-200 text-text-muted"}`,children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-text-primary",children:"Invoice"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Ready to send to production"})]})]})})]}),jsxRuntimeExports.jsx("div",{className:"bg-input-bg rounded-card p-3 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center text-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-text-muted text-xs",children:"Days"}),jsxRuntimeExports.jsx("div",{className:"font-semibold text-text-primary",children:xs})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-text-muted text-xs",children:"Hours"}),jsxRuntimeExports.jsx("div",{className:"font-semibold text-text-primary",children:ss.totalHours.toFixed(1)})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-text-muted text-xs",children:"Total"}),jsxRuntimeExports.jsxs("div",{className:"font-semibold text-gold",children:["",ss.totalEarnings.toFixed(2)]})]})]})}),jsxRuntimeExports.jsx("button",{onClick:Es,disabled:us,className:`w-full py-3 rounded-button font-medium transition-all ${ms?"bg-success text-white":"gold-gradient text-white active:scale-[0.98]"} ${us?"opacity-70":""}`,children:us?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Exporting..."]}):ms?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Exported!"]}):`Export ${ls==="pdf"?"PDF":ls==="csv"?"CSV":"Invoice"}`})]})]})})}const BASE_CONTRACT_OPTIONS=[{value:"10+1",label:"10+1 (10 hours work + 1hr lunch)",hours:10},{value:"11+1",label:"11+1 (11 hours work + 1hr lunch)",hours:11}];function RateCardSettings(){const{rateCard:es,updateRateCard:ts}=useTimesheetStore(),ss=rs=>{const ns=BASE_CONTRACT_OPTIONS.find(os=>os.value===rs);ts({baseContract:rs,baseDayHours:(ns==null?void 0:ns.hours)||11})};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"DAILY RATE"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:""}),jsxRuntimeExports.jsx("input",{type:"number",value:es.dailyRate||"",onChange:rs=>ts({dailyRate:rs.target.value?parseFloat(rs.target.value):0}),placeholder:"0.00",min:"0",step:"0.01",className:"input-field flex-1"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Your agreed daily rate (BECTU minimum guarantee)"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"BASE CONTRACT (BECTU)"}),jsxRuntimeExports.jsx("select",{value:es.baseContract||"11+1",onChange:rs=>ss(rs.target.value),className:"input-field w-full",children:BASE_CONTRACT_OPTIONS.map(rs=>jsxRuntimeExports.jsx("option",{value:rs.value,children:rs.label},rs.value))}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Standard UK film industry contract. Hours worked beyond this trigger overtime."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-card p-4 space-y-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label",children:"RATE MULTIPLIERS"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Pre-Call"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:es.preCallMultiplier,onChange:rs=>ts({preCallMultiplier:parseFloat(rs.target.value)||1.5}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-1",children:"Hours before unit call"})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Overtime (after base hours)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:es.otMultiplier,onChange:rs=>ts({otMultiplier:parseFloat(rs.target.value)||1.5}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Late Night (after 23:00)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:es.lateNightMultiplier,onChange:rs=>ts({lateNightMultiplier:parseFloat(rs.target.value)||2}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"6th Day"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:es.sixthDayMultiplier,onChange:rs=>ts({sixthDayMultiplier:parseFloat(rs.target.value)||1.5}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-1",children:"Applied to entire day's earnings"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"7th Day"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:es.seventhDayMultiplier,onChange:rs=>ts({seventhDayMultiplier:parseFloat(rs.target.value)||2}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-orange-500 font-medium"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-1",children:"7th consecutive day worked"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"KIT / BOX RENTAL"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:""}),jsxRuntimeExports.jsx("input",{type:"number",value:es.kitRental||"",onChange:rs=>ts({kitRental:rs.target.value?parseFloat(rs.target.value):0}),placeholder:"0.00",min:"0",step:"0.01",className:"input-field flex-1"}),jsxRuntimeExports.jsx("span",{className:"text-text-muted text-sm",children:"/day"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Daily kit rental added to each working day"})]}),es.dailyRate>0&&jsxRuntimeExports.jsxs("div",{className:"bg-gold-50 rounded-card p-4 mt-6",children:[jsxRuntimeExports.jsx("h4",{className:"field-label mb-3",children:"RATE SUMMARY"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Hourly Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(es.dailyRate/es.baseDayHours).toFixed(2),"/hr"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Pre-Call Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(es.dailyRate/es.baseDayHours*es.preCallMultiplier).toFixed(2),"/hr"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"OT Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(es.dailyRate/es.baseDayHours*es.otMultiplier).toFixed(2),"/hr"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Late Night Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(es.dailyRate/es.baseDayHours*es.lateNightMultiplier).toFixed(2),"/hr"]})]})]})]})]})}function Timesheet(){const{viewMode:es,setViewMode:ts,selectedDate:ss,getWeekSummary:rs,rateCard:ns}=useTimesheetStore(),[os,as]=reactExports.useState(()=>getWeekStart(ss)),[ls,cs]=reactExports.useState(!1),[us,ds]=reactExports.useState(!1),ms=xs=>{const ys=addDays(os,xs==="next"?7:-7);as(ys)},ps=rs(os),hs=()=>{const xs=[];return ns.dailyRate>0&&xs.push(`${ns.dailyRate}/day`),xs.push(`${ns.baseDayHours}+1`),ns.kitRental>0&&xs.push(`Kit ${ns.kitRental}`),xs.join("  ")};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Timesheet"}),jsxRuntimeExports.jsx("button",{onClick:()=>cs(!0),className:"p-2 text-text-muted hover:text-gold transition-colors","aria-label":"Export",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 pb-3",children:jsxRuntimeExports.jsxs("div",{className:"flex bg-input-bg rounded-pill p-1 border border-border",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ts("week"),className:`flex-1 py-2 px-3 rounded-pill text-sm font-medium transition-all ${es==="week"?"bg-card text-text-primary border-2 border-gold":"text-text-muted"}`,children:"Day"}),jsxRuntimeExports.jsx("button",{onClick:()=>ts("sheet"),className:`flex-1 py-2 px-3 rounded-pill text-sm font-medium transition-all ${es==="sheet"?"bg-card text-text-primary border-2 border-gold":"text-text-muted"}`,children:"Sheet"})]})})]})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsx("div",{className:"mx-4 mt-4 mb-3",children:jsxRuntimeExports.jsxs("div",{className:`rounded-xl border overflow-hidden transition-all ${us?"border-gold":"border-border"}`,style:{backgroundColor:"var(--color-card)"},children:[jsxRuntimeExports.jsxs("div",{onClick:()=>ds(!us),className:"px-4 py-3 flex items-center justify-between cursor-pointer",style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-medium flex items-center gap-2",style:{color:"var(--color-text-muted)"},children:[jsxRuntimeExports.jsx("span",{children:""})," Rate Card"]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs",style:{color:"var(--color-text-placeholder)"},children:hs()}),jsxRuntimeExports.jsx("svg",{className:`w-2.5 h-2.5 transition-transform ${us?"rotate-180":""}`,style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),us&&jsxRuntimeExports.jsx("div",{className:"px-4 py-3",style:{borderTop:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsx(RateCardSettings,{})})]})}),es==="week"&&jsxRuntimeExports.jsx(WeekView,{weekStartDate:os,onNavigate:ms,selectedDate:ss}),es==="sheet"&&jsxRuntimeExports.jsx(TimesheetDocument,{weekStartDate:os,onNavigate:ms}),jsxRuntimeExports.jsx("div",{className:"px-4 pb-24",children:jsxRuntimeExports.jsx(SummaryCard,{summary:ps})})]}),jsxRuntimeExports.jsx(ExportModal,{isOpen:ls,onClose:()=>cs(!1),weekSummary:ps,weekStartDate:os})]})}async function extractReceiptData(es){var ts;try{const rs=(await ensureSupportedImageFormat(es)).match(/^data:([^;]+);base64,(.+)$/);if(!rs)return{success:!1,data:null,error:"Invalid image data format"};const[,ns,os]=rs,cs=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:[{type:"image",source:{type:"base64",media_type:ns,data:os}},{type:"text",text:`Analyze this receipt image and extract the following information in JSON format:

{
  "vendor": "Store or supplier name",
  "amount": 123.45,
  "vat": 20.58,
  "date": "YYYY-MM-DD",
  "items": [
    { "name": "Item description", "price": 12.34 }
  ],
  "currency": "GBP",
  "confidence": "high"
}

IMPORTANT INSTRUCTIONS:
1. "vendor" - Extract the store/supplier name (e.g., "Amazon", "Catwalk Hair & Cosmetics", "Boots")
2. "amount" - The TOTAL amount paid (as a number, not string). Look for "Total", "Grand Total", "Amount Due", etc. This should be the final amount INCLUDING VAT.
3. "vat" - The VAT amount (as a number, not string). Look for "VAT", "Tax", "Sales Tax", "GST", or similar. If multiple VAT lines, sum them. If the receipt shows a VAT rate but no amount, calculate it from the subtotal. Set to null if no VAT information is visible.
4. "date" - The receipt date in YYYY-MM-DD format. Convert from any format you see (e.g., "23 November 2025"  "2025-11-23")
5. "items" - List individual items with their prices. Include product names and individual prices.
6. "currency" - Detect currency from symbols (=GBP, $=USD, =EUR) or text. Default to "GBP" if unclear.
7. "confidence" - Set to "high" if all fields are clearly visible, "medium" if some are unclear, "low" if the image is hard to read.

If a field cannot be determined, use null for that field (except items which should be an empty array).
Return ONLY the JSON object, no markdown or explanation.`}]}],system:`You are an expert receipt parser. Extract structured data from receipt images accurately.
Always return valid JSON. Be precise with numbers - do not include currency symbols in numeric fields.
For dates, always convert to YYYY-MM-DD format regardless of the source format.`,maxTokens:2e3,model:"claude-sonnet-4-20250514"})});if(!cs.ok){const xs=await cs.json().catch(()=>({}));throw new Error(((ts=xs.error)==null?void 0:ts.message)||xs.error||`API error: ${cs.status}`)}const us=await cs.json();if(!us.content||us.content.length===0)throw new Error("Empty response from AI");const ds=us.content[0].text;console.log("[ReceiptAI] Raw response:",ds);const ms=ds.match(/\{[\s\S]*\}/);if(!ms)throw new Error("Failed to parse receipt data from AI response");const ps=JSON.parse(ms[0]),hs={vendor:typeof ps.vendor=="string"?ps.vendor.trim():"",amount:typeof ps.amount=="number"?ps.amount:parseFloat(ps.amount)||null,vat:typeof ps.vat=="number"?ps.vat:parseFloat(ps.vat)||null,date:validateDate(ps.date),items:Array.isArray(ps.items)?ps.items.filter(xs=>xs&&typeof xs.name=="string").map(xs=>({name:xs.name.trim(),price:typeof xs.price=="number"?xs.price:parseFloat(xs.price)||0})):[],currency:typeof ps.currency=="string"?ps.currency.toUpperCase():"GBP",confidence:["high","medium","low"].includes(ps.confidence)?ps.confidence:"medium"};return console.log("[ReceiptAI] Extracted data:",hs),{success:!0,data:hs}}catch(ss){return console.error("[ReceiptAI] Extraction failed:",ss),{success:!1,data:null,error:ss instanceof Error?ss.message:"Failed to extract receipt data"}}}function validateDate(es){if(!es||typeof es!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(es)){const ss=new Date(es);if(!isNaN(ss.getTime()))return es}const ts=new Date(es);return isNaN(ts.getTime())?null:ts.toISOString().split("T")[0]}function buildDescriptionFromItems(es){if(!es||es.length===0)return"";let ss=es.slice(0,3).map(rs=>rs.name).join(", ");return es.length>3&&(ss+=` +${es.length-3} more`),ss}const CATEGORIES=["Kit Supplies","Consumables","Transportation","Equipment","Other"],BUDGET_STORAGE_KEY="hairandmakeup_budget";function Budget(){const[es,ts]=reactExports.useState([]),[ss,rs]=reactExports.useState(0),[ns,os]=reactExports.useState(0),[as,ls]=reactExports.useState(!1),[cs,us]=reactExports.useState(null),[ds,ms]=reactExports.useState(!1),[ps,hs]=reactExports.useState(!1),[xs,ys]=reactExports.useState(DEFAULT_CURRENCY),[vs,gs]=reactExports.useState(!1),[fs,js]=reactExports.useState(!1),[Ss,bs]=reactExports.useState(null),Es=reactExports.useRef(null),Rs=reactExports.useRef(null),{currentProject:ws}=useProjectStore();reactExports.useEffect(()=>{try{const Ps=localStorage.getItem(BUDGET_STORAGE_KEY);if(Ps){const Fs=JSON.parse(Ps);Fs.budgetTotal!==void 0&&rs(Fs.budgetTotal),Fs.floatReceived!==void 0&&os(Fs.floatReceived),Fs.receipts&&ts(Fs.receipts),Fs.currency&&ys(Fs.currency)}}catch(Ps){console.error("Failed to load budget data:",Ps)}},[]),reactExports.useEffect(()=>{try{localStorage.setItem(BUDGET_STORAGE_KEY,JSON.stringify({budgetTotal:ss,floatReceived:ns,receipts:es,currency:xs}))}catch(Ps){console.error("Failed to save budget data:",Ps)}},[ss,ns,es,xs]);const Ns=getCurrencyByCode(xs),{totalSpent:ks,totalVat:_s,byCategory:Ls}=reactExports.useMemo(()=>{const Ps=es.reduce((Gs,hr)=>Gs+hr.amount,0),Fs=es.reduce((Gs,hr)=>Gs+(hr.vat||0),0),Us={"Kit Supplies":0,Consumables:0,Transportation:0,Equipment:0,Other:0};return es.forEach(Gs=>{Us[Gs.category]+=Gs.amount}),{totalSpent:Ps,totalVat:Fs,byCategory:Us}},[es]),Os=ss-ks,zs=ss>0?ks/ss*100:0,qs=()=>{hs(!0)},Qs=()=>{var Ps;hs(!1),(Ps=Es.current)==null||Ps.click()},Ys=()=>{var Ps;hs(!1),(Ps=Rs.current)==null||Ps.click()},Ws=Ps=>{var Us;const Fs=(Us=Ps.target.files)==null?void 0:Us[0];if(Fs){const Gs=new FileReader;Gs.onloadend=()=>{us(Gs.result),ms(!0)},Gs.readAsDataURL(Fs)}Ps.target.value=""},Is=Ps=>{const Fs={...Ps,id:`r-${Date.now()}`,synced:!1};ts([Fs,...es]),ms(!1),us(null)},Bs=()=>{hs(!1),us(null),ms(!0)},Vs=Ps=>{ts(es.map(Fs=>Fs.id===Ps.id?Ps:Fs)),bs(null)},Ds=Ps=>{ts(es.filter(Fs=>Fs.id!==Ps)),bs(null)},Cs=()=>{const Ps=(ws==null?void 0:ws.name)||"Production",Fs=getCurrencyByCode(xs),Us=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),Gs=[];return Gs.push("SPENDING RECONCILIATION REPORT"),Gs.push(`Project: ${Ps}`),Gs.push(`Export Date: ${Us}`),Gs.push(`Currency: ${xs} (${Fs.symbol})`),Gs.push(""),Gs.push("BUDGET SUMMARY"),Gs.push(`Total Budget,${Fs.symbol}${ss.toFixed(2)}`),Gs.push(`Float Received,${Fs.symbol}${ns.toFixed(2)}`),Gs.push(`Total Spent,${Fs.symbol}${ks.toFixed(2)}`),Gs.push(`Total VAT,${Fs.symbol}${_s.toFixed(2)}`),Gs.push(`Remaining Budget,${Fs.symbol}${Os.toFixed(2)}`),Gs.push(`Float Remaining,${Fs.symbol}${(ns-ks).toFixed(2)}`),Gs.push(`Percentage Used,${zs.toFixed(1)}%`),Gs.push(""),Gs.push("SPENDING BY CATEGORY"),Gs.push("Category,Amount"),CATEGORIES.forEach(ur=>{Ls[ur]>0&&Gs.push(`${ur},${Fs.symbol}${Ls[ur].toFixed(2)}`)}),Gs.push(`TOTAL,${Fs.symbol}${ks.toFixed(2)}`),Gs.push(""),Gs.push("RECEIPT DETAILS"),Gs.push("Date,Vendor,Category,Description,Amount,VAT"),[...es].sort((ur,cr)=>new Date(ur.date).getTime()-new Date(cr.date).getTime()).forEach(ur=>{const cr=new Date(ur.date).toLocaleDateString("en-GB"),Er=ur.vendor.includes(",")?`"${ur.vendor}"`:ur.vendor,Nr=ur.description.includes(",")?`"${ur.description}"`:ur.description,kr=ur.vat>0?`${Fs.symbol}${ur.vat.toFixed(2)}`:"";Gs.push(`${cr},${Er},${ur.category},${Nr},${Fs.symbol}${ur.amount.toFixed(2)},${kr}`)}),Gs.push(""),Gs.push(`Total Receipts: ${es.length}`),Gs.join(`
`)},Ts=Ps=>{const Fs=(ws==null?void 0:ws.name)||"Production",Us=new Date().toISOString().split("T")[0];if(Ps==="csv"){const Gs=Cs(),hr=new Blob([Gs],{type:"text/csv"}),ur=URL.createObjectURL(hr),cr=document.createElement("a");cr.href=ur,cr.download=`spending-reconciliation-${Fs.replace(/\s+/g,"-").toLowerCase()}-${Us}.csv`,document.body.appendChild(cr),cr.click(),document.body.removeChild(cr),URL.revokeObjectURL(ur)}else{const Gs=$s(),hr=new Blob([Gs],{type:"text/html;charset=utf-8"}),ur=URL.createObjectURL(hr),cr=window.open(ur,"_blank");cr&&cr.addEventListener("load",()=>{setTimeout(()=>cr.print(),500)}),URL.revokeObjectURL(ur)}js(!1)},$s=()=>{const Ps=(ws==null?void 0:ws.name)||"Production",Us=getCurrencyByCode(xs).symbol,Gs=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),hr=[...es].sort((cr,Er)=>new Date(cr.date).getTime()-new Date(Er.date).getTime()),ur=hr.filter(cr=>cr.imageUri);return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spending Reconciliation - ${Ps}</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 32px;
      max-width: 800px;
      margin: 0 auto;
      color: #1a1a1a;
      font-size: 13px;
      line-height: 1.5;
    }

    /* Header */
    .header { margin-bottom: 28px; }
    .header h1 { font-size: 22px; font-weight: 700; color: #1a1a1a; margin-bottom: 2px; }
    .header .project { font-size: 15px; color: #C9A962; font-weight: 600; margin-bottom: 4px; }
    .header .date { font-size: 12px; color: #888; }

    /* Summary Cards */
    .summary {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 28px;
    }
    .summary-card {
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 14px 12px;
      text-align: center;
    }
    .summary-card .label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 4px; }
    .summary-card .value { font-size: 20px; font-weight: 700; color: #1a1a1a; }
    .summary-card.gold { border-color: #C9A962; background: #faf6ed; }
    .summary-card.gold .value { color: #C9A962; }
    .summary-card.over .value { color: #dc3545; }

    /* Progress Bar */
    .progress-wrap { margin-bottom: 28px; }
    .progress-bar { height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 4px; background: #C9A962; }
    .progress-fill.over { background: #dc3545; }
    .progress-label { display: flex; justify-content: space-between; margin-top: 4px; font-size: 11px; color: #888; }

    /* Sections */
    .section { margin-bottom: 28px; }
    .section-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #888;
      padding-bottom: 6px;
      border-bottom: 2px solid #C9A962;
      margin-bottom: 12px;
    }

    /* Category Breakdown */
    .cat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
    .cat-row .name { color: #333; }
    .cat-row .bar-wrap { flex: 1; margin: 0 16px; display: flex; align-items: center; }
    .cat-bar { height: 6px; background: #C9A962; border-radius: 3px; opacity: 0.6; }
    .cat-row .amt { font-weight: 600; color: #1a1a1a; min-width: 80px; text-align: right; }
    .cat-total { display: flex; justify-content: space-between; padding: 10px 0; border-top: 2px solid #C9A962; font-weight: 700; margin-top: 4px; }

    /* Receipts Table */
    table.receipts { width: 100%; border-collapse: collapse; }
    table.receipts th {
      background: #f8f8f8;
      padding: 10px 8px;
      text-align: left;
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      color: #666;
      border-bottom: 2px solid #e5e5e5;
    }
    table.receipts td {
      padding: 10px 8px;
      border-bottom: 1px solid #f0f0f0;
      vertical-align: top;
    }
    table.receipts tr:last-child td { border-bottom: none; }
    table.receipts .num { text-align: center; color: #aaa; font-size: 11px; }
    table.receipts .amt { text-align: right; font-weight: 600; white-space: nowrap; }
    table.receipts .cat { font-size: 11px; color: #666; }
    table.receipts .desc { font-size: 11px; color: #999; }
    table.receipts tfoot td { border-top: 2px solid #C9A962; font-weight: 700; padding-top: 12px; }

    /* Receipt Filing */
    .filing-entry {
      page-break-inside: avoid;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .filing-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background: #f8f8f8;
      border-bottom: 1px solid #e5e5e5;
    }
    .filing-header .vendor { font-weight: 600; font-size: 14px; }
    .filing-header .amount { font-weight: 700; font-size: 14px; }
    .filing-meta {
      display: flex;
      gap: 16px;
      padding: 8px 14px;
      font-size: 11px;
      color: #666;
      border-bottom: 1px solid #f0f0f0;
    }
    .filing-meta span { display: flex; align-items: center; gap: 4px; }
    .filing-image {
      padding: 12px;
      text-align: center;
      background: #fafafa;
    }
    .filing-image img {
      max-width: 100%;
      max-height: 500px;
      object-fit: contain;
      border-radius: 4px;
    }

    /* Footer */
    .footer {
      margin-top: 32px;
      padding-top: 12px;
      border-top: 1px solid #e5e5e5;
      font-size: 11px;
      color: #aaa;
      text-align: center;
    }

    @media print {
      body { padding: 16px; }
      .summary-card.gold, table.receipts th, .filing-header {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      .filing-entry { page-break-inside: avoid; }
      .receipt-filing { page-break-before: always; }
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>Spending Reconciliation</h1>
    <div class="project">${Ps}</div>
    <div class="date">Exported ${Gs}</div>
  </div>

  <div class="summary">
    <div class="summary-card">
      <div class="label">Budget</div>
      <div class="value">${Us}${ss.toFixed(2)}</div>
    </div>
    <div class="summary-card">
      <div class="label">Spent</div>
      <div class="value">${Us}${ks.toFixed(2)}</div>
    </div>
    <div class="summary-card ${Os>=0?"gold":"over"}">
      <div class="label">${Os>=0?"Remaining":"Over Budget"}</div>
      <div class="value">${Us}${Math.abs(Os).toFixed(2)}</div>
    </div>
    <div class="summary-card">
      <div class="label">Used</div>
      <div class="value">${zs.toFixed(1)}%</div>
    </div>
  </div>

  <div class="progress-wrap">
    <div class="progress-bar">
      <div class="progress-fill ${zs>100?"over":""}" style="width: ${Math.min(zs,100)}%"></div>
    </div>
    <div class="progress-label">
      <span>0%</span>
      <span>Budget utilisation</span>
      <span>100%</span>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Financial Reconciliation</div>
    <table style="width:100%; border-collapse:collapse; font-size:13px;">
      <tbody>
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Total Budget</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Us}${ss.toFixed(2)}</td>
        </tr>
        ${ns>0?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Float Received</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Us}${ns.toFixed(2)}</td>
        </tr>`:""}
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Total Spent</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Us}${ks.toFixed(2)}</td>
        </tr>
        ${_s>0?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Total VAT (included in spent)</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Us}${_s.toFixed(2)}</td>
        </tr>
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Spend excl. VAT</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Us}${(ks-_s).toFixed(2)}</td>
        </tr>`:""}
        ${ns>0?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Float Remaining</td>
          <td style="padding:8px 0; text-align:right; font-weight:700; color:${ns-ks>=0?"#198754":"#dc3545"}">${Us}${(ns-ks).toFixed(2)}</td>
        </tr>`:""}
        ${ns>0&&ns<ss?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Outstanding from Production</td>
          <td style="padding:8px 0; text-align:right; font-weight:700; color:#C9A962">${Us}${(ss-ns).toFixed(2)}</td>
        </tr>`:""}
        ${ns>0&&ks>ns?`
        <tr>
          <td style="padding:8px 0; color:#666">Owed by Production (overspend on float)</td>
          <td style="padding:8px 0; text-align:right; font-weight:700; color:#dc3545">${Us}${(ks-ns).toFixed(2)}</td>
        </tr>`:""}
      </tbody>
    </table>
  </div>

  <div class="section">
    <div class="section-title">Spending by Category</div>
    ${CATEGORIES.filter(cr=>Ls[cr]>0).map(cr=>{const Er=ks>0?Ls[cr]/ks*100:0;return`
      <div class="cat-row">
        <span class="name">${cr}</span>
        <span class="bar-wrap"><span class="cat-bar" style="width: ${Er}%"></span></span>
        <span class="amt">${Us}${Ls[cr].toFixed(2)}</span>
      </div>`}).join("")}
    <div class="cat-total">
      <span>Total</span>
      <span>${Us}${ks.toFixed(2)}</span>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Receipt Log (${es.length} receipts)</div>
    <table class="receipts">
      <thead>
        <tr>
          <th style="width:30px">#</th>
          <th>Date</th>
          <th>Vendor</th>
          <th>Category</th>
          <th>Description</th>
          <th class="amt">VAT</th>
          <th class="amt">Amount</th>
        </tr>
      </thead>
      <tbody>
        ${hr.map((cr,Er)=>`
        <tr>
          <td class="num">${Er+1}</td>
          <td>${new Date(cr.date).toLocaleDateString("en-GB")}</td>
          <td>${cr.vendor}</td>
          <td class="cat">${cr.category}</td>
          <td class="desc">${cr.description||"&mdash;"}</td>
          <td class="amt">${cr.vat>0?`${Us}${cr.vat.toFixed(2)}`:"&mdash;"}</td>
          <td class="amt">${Us}${cr.amount.toFixed(2)}</td>
        </tr>`).join("")}
      </tbody>
      <tfoot>
        <tr>
          <td colspan="5">Total (${es.length} receipts)</td>
          <td class="amt">${_s>0?`${Us}${_s.toFixed(2)}`:"&mdash;"}</td>
          <td class="amt">${Us}${ks.toFixed(2)}</td>
        </tr>
      </tfoot>
    </table>
  </div>

  ${ur.length>0?`
  <div class="section receipt-filing">
    <div class="section-title">Receipt Filing (${ur.length} images)</div>
    ${ur.map((cr,Er)=>`
    <div class="filing-entry">
      <div class="filing-header">
        <span class="vendor">${Er+1}. ${cr.vendor}</span>
        <span class="amount">${Us}${cr.amount.toFixed(2)}</span>
      </div>
      <div class="filing-meta">
        <span>${new Date(cr.date).toLocaleDateString("en-GB")}</span>
        <span>${cr.category}</span>
        ${cr.description?`<span>${cr.description}</span>`:""}
      </div>
      <div class="filing-image">
        <img src="${cr.imageUri}" alt="Receipt from ${cr.vendor}">
      </div>
    </div>`).join("")}
  </div>`:""}

  <div class="footer">
    Generated by Hair &amp; Makeup Pro &middot; ${Gs}
  </div>

</body>
</html>`};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Budget"}),jsxRuntimeExports.jsxs("button",{onClick:()=>gs(!0),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-text-muted bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:[jsxRuntimeExports.jsx("span",{children:Ns.symbol}),jsxRuntimeExports.jsx("span",{children:xs}),jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[es.length>0&&jsxRuntimeExports.jsx("button",{onClick:()=>js(!0),className:"p-2 text-text-muted active:text-gold transition-colors",title:"Export reconciliation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})})}),jsxRuntimeExports.jsxs("button",{onClick:qs,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gold active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"})]}),"Scan"]})]})]})})}),jsxRuntimeExports.jsx("input",{ref:Es,type:"file",accept:"image/*",capture:"environment",onChange:Ws,className:"hidden"}),jsxRuntimeExports.jsx("input",{ref:Rs,type:"file",accept:"image/*",onChange:Ws,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"section-header",children:"SPENDING OVERVIEW"}),jsxRuntimeExports.jsxs("button",{onClick:()=>ls(!0),className:"flex items-center gap-1 text-xs text-gold font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})}),ss>0?"Edit Budget":"Set Budget"]})]}),jsxRuntimeExports.jsx("div",{className:"relative h-3 bg-gray-100 rounded-full overflow-hidden mb-3",children:ss>0?jsxRuntimeExports.jsx("div",{className:`absolute left-0 top-0 h-full rounded-full transition-all ${zs>90?"bg-error":zs>70?"bg-amber-500":"bg-gold"}`,style:{width:`${Math.min(zs,100)}%`}}):jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-light",children:"Set a budget to track spending"})})}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-end",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-text-primary",children:formatCurrency(ks,xs)}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted ml-1",children:"spent"})]}),jsxRuntimeExports.jsx("div",{className:"text-right",children:ss>0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:`text-lg font-semibold ${Os<0?"text-error":"text-green-600"}`,children:formatCurrency(Os,xs)}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:["remaining of ",formatCurrency(ss,xs)]})]}):jsxRuntimeExports.jsx("button",{onClick:()=>ls(!0),className:"text-sm text-gold font-medium",children:"Tap to set budget"})})]}),(ns>0||_s>0)&&jsxRuntimeExports.jsxs("div",{className:"mt-3 pt-3 border-t border-border space-y-1.5",children:[ns>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Float received"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:formatCurrency(ns,xs)})]}),ns>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Float remaining"}),jsxRuntimeExports.jsx("span",{className:`font-semibold ${ns-ks<0?"text-error":"text-green-600"}`,children:formatCurrency(ns-ks,xs)})]}),_s>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Total VAT"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:formatCurrency(_s,xs)})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h2",{className:"section-header mb-3",children:"BY CATEGORY"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[CATEGORIES.filter(Ps=>Ls[Ps]>0).map(Ps=>{const Fs=Ls[Ps],Us=ks>0?Fs/ks*100:0;return jsxRuntimeExports.jsx("div",{className:"flex items-center gap-3",children:jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-text-primary",children:Ps}),jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:formatCurrency(Fs,xs)})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 bg-gray-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gold/60 rounded-full",style:{width:`${Us}%`}})})]})},Ps)}),ks===0&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light text-center py-2",children:"No expenses recorded yet"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"section-header",children:"RECENT RECEIPTS"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[es.length," total"]})]}),es.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-2",children:es.map(Ps=>jsxRuntimeExports.jsx("div",{className:"card cursor-pointer active:scale-[0.98] transition-transform",onClick:()=>bs(Ps),children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary truncate",children:Ps.vendor}),!Ps.synced&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[9px] font-medium rounded bg-amber-100 text-amber-700",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:Ps.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium rounded-full bg-gray-100 text-text-muted",children:Ps.category}),jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-light",children:formatShortDate(Ps.date)})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-bold text-text-primary",children:formatCurrency(Ps.amount,xs)}),Ps.vat>0&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-light block",children:["VAT ",formatCurrency(Ps.vat,xs)]})]}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})},Ps.id))})]}),jsxRuntimeExports.jsxs("button",{onClick:qs,className:"w-full card flex items-center justify-center gap-3 py-4 border-2 border-dashed border-gold/30 hover:border-gold hover:bg-gold/5 transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-gold",children:"Add Receipt"})]}),jsxRuntimeExports.jsx("div",{className:"text-center py-2",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light",children:"Syncs with website budget page"})})]}),vs&&jsxRuntimeExports.jsx(CurrencyPickerModal,{currentCurrency:xs,onSelect:Ps=>{ys(Ps),gs(!1)},onClose:()=>gs(!1)}),ds&&jsxRuntimeExports.jsx(AddReceiptModal,{imageUri:cs,currencySymbol:Ns.symbol,onAdd:Is,onClose:()=>{ms(!1),us(null)}}),ps&&jsxRuntimeExports.jsx(ScanOptionsModal,{onTakePhoto:Qs,onChooseFromLibrary:Ys,onManualEntry:Bs,onClose:()=>hs(!1)}),as&&jsxRuntimeExports.jsx(BudgetEditModal,{currentBudget:ss,currentFloat:ns,currencySymbol:Ns.symbol,onSave:(Ps,Fs)=>{rs(Ps),os(Fs),ls(!1)},onClose:()=>ls(!1)}),fs&&jsxRuntimeExports.jsx(ExportReconciliationModal,{onExport:Ts,onClose:()=>js(!1),receiptsCount:es.length,totalSpent:ks,currencySymbol:Ns.symbol}),Ss&&jsxRuntimeExports.jsx(ReceiptDetailModal,{receipt:Ss,currencySymbol:Ns.symbol,onSave:Vs,onDelete:Ds,onClose:()=>bs(null)})]})}function CurrencyPickerModal({currentCurrency:es,onSelect:ts,onClose:ss}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:ss,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg",onClick:rs=>rs.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-3 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Select Currency"})}),jsxRuntimeExports.jsx("div",{className:"p-2 max-h-[60vh] overflow-y-auto",children:CURRENCIES.map(rs=>jsxRuntimeExports.jsxs("button",{onClick:()=>ts(rs.code),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${es===rs.code?"bg-gold/10":"hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx("span",{className:"text-xl font-medium text-text-primary w-8",children:rs.symbol}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:rs.code}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted ml-2",children:rs.name})]}),es===rs.code&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},rs.code))}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border",children:jsxRuntimeExports.jsx("button",{onClick:ss,className:"w-full px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"})})]})})}function ScanOptionsModal({onTakePhoto:es,onChooseFromLibrary:ts,onManualEntry:ss,onClose:rs}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:rs,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg animate-slideUp",onClick:ns=>ns.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Add Receipt"})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:es,className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gold/10 hover:bg-gold/20 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-gold/20 flex items-center justify-center",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Take Photo"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Capture receipt with camera"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:ts,className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Choose from Library"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Select existing photo"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:ss,className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Manual Entry"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Enter details without photo"})]})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border",children:jsxRuntimeExports.jsx("button",{onClick:rs,className:"w-full px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"})})]})})}function AddReceiptModal({imageUri:es,currencySymbol:ts,onAdd:ss,onClose:rs}){const[ns,os]=reactExports.useState(""),[as,ls]=reactExports.useState(""),[cs,us]=reactExports.useState(""),[ds,ms]=reactExports.useState("Kit Supplies"),[ps,hs]=reactExports.useState(""),[xs,ys]=reactExports.useState(new Date().toISOString().split("T")[0]),[vs,gs]=reactExports.useState(!1),[fs,js]=reactExports.useState(null),[Ss,bs]=reactExports.useState([]);reactExports.useEffect(()=>{es&&Es(es)},[es]);const Es=async ws=>{gs(!0),js(null);try{const Ns=await extractReceiptData(ws);if(Ns.success&&Ns.data){const{data:ks}=Ns;ks.vendor&&os(ks.vendor),ks.amount!==null&&ls(ks.amount.toFixed(2)),ks.vat!==null&&ks.vat!==void 0&&us(ks.vat.toFixed(2)),ks.date&&ys(ks.date),ks.items&&ks.items.length>0&&(bs(ks.items),hs(buildDescriptionFromItems(ks.items))),ks.confidence==="low"&&js("Some values may be inaccurate. Please review carefully.")}else js(Ns.error||"Failed to extract receipt data. Please enter manually.")}catch(Ns){console.error("Extraction error:",Ns),js("Failed to analyze receipt. Please enter details manually.")}finally{gs(!1)}},Rs=ws=>{ws.preventDefault(),!(!ns||!as)&&ss({date:xs,vendor:ns,amount:parseFloat(as),vat:parseFloat(cs)||0,category:ds,description:ps,imageUri:es||void 0})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Add Receipt"}),jsxRuntimeExports.jsx("button",{onClick:rs,className:"p-2 -mr-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("form",{onSubmit:Rs,className:"p-4 space-y-4",children:[es&&jsxRuntimeExports.jsxs("div",{className:"relative aspect-[4/3] rounded-lg overflow-hidden bg-gray-100",children:[jsxRuntimeExports.jsx("img",{src:es,alt:"Receipt",className:"w-full h-full object-contain"}),vs&&jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 bg-black/60 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-3 border-white/30 border-t-white rounded-full animate-spin mb-3"}),jsxRuntimeExports.jsx("span",{className:"text-white text-sm font-medium",children:"Analyzing receipt..."})]})]}),fs&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 rounded-lg bg-amber-50 border border-amber-200",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-700",children:fs})}),!vs&&!fs&&es&&ns&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 rounded-lg bg-green-50 border border-green-200",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-green-700",children:"Receipt data extracted. Please review and edit if needed."})}),Ss.length>0&&jsxRuntimeExports.jsxs("div",{className:"rounded-lg border border-gray-200 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-secondary",children:"Detected Items:"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>bs([...Ss,{name:"",price:0}]),disabled:vs,className:"text-[10px] font-medium text-gold hover:text-gold-dark",children:"+ Add Item"})]}),jsxRuntimeExports.jsx("div",{className:"divide-y divide-gray-100 max-h-48 overflow-y-auto",children:Ss.map((ws,Ns)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:ws.name,onChange:ks=>{const _s=[...Ss];_s[Ns]={...ws,name:ks.target.value},bs(_s),hs(buildDescriptionFromItems(_s))},className:"flex-1 text-xs bg-transparent border-b border-transparent focus:border-gold outline-none py-1 text-text-primary",placeholder:"Item name",disabled:vs}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:ts}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:ws.price||"",onChange:ks=>{const _s=[...Ss];_s[Ns]={...ws,price:parseFloat(ks.target.value)||0},bs(_s)},className:"w-16 text-xs text-right bg-transparent border-b border-transparent focus:border-gold outline-none py-1 text-text-primary",placeholder:"0.00",disabled:vs})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const ks=Ss.filter((_s,Ls)=>Ls!==Ns);bs(ks),hs(buildDescriptionFromItems(ks))},disabled:vs,className:"p-1 text-text-light hover:text-red-500 transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},Ns))}),jsxRuntimeExports.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-200 flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-text-secondary",children:"Items Total:"}),jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-text-primary",children:[ts,Ss.reduce((ws,Ns)=>ws+(Ns.price||0),0).toFixed(2)]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Vendor / Store"}),jsxRuntimeExports.jsx("input",{type:"text",value:ns,onChange:ws=>os(ws.target.value),className:"input-field w-full",placeholder:"e.g., Camera Ready Cosmetics",required:!0,disabled:vs})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Amount"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:ts}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:as,onChange:ws=>ls(ws.target.value),className:"input-field w-full pl-7",placeholder:"0.00",required:!0,disabled:vs})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"VAT"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:ts}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:cs,onChange:ws=>us(ws.target.value),className:"input-field w-full pl-7",placeholder:"0.00",disabled:vs})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Date"}),jsxRuntimeExports.jsx("input",{type:"date",value:xs,onChange:ws=>ys(ws.target.value),className:"input-field w-full",disabled:vs})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Category"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:CATEGORIES.map(ws=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ms(ws),disabled:vs,className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${ds===ws?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"} ${vs?"opacity-50 cursor-not-allowed":""}`,children:ws},ws))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Description (optional)"}),jsxRuntimeExports.jsx("input",{type:"text",value:ps,onChange:ws=>hs(ws.target.value),className:"input-field w-full",placeholder:"e.g., Foundation restocks",disabled:vs})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:rs,className:"flex-1 px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",disabled:vs,children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 rounded-button gold-gradient text-white font-medium disabled:opacity-50",disabled:!ns||!as||vs,children:vs?"Analyzing...":"Add Receipt"})]})]})]})})}function ReceiptDetailModal({receipt:es,currencySymbol:ts,onSave:ss,onDelete:rs,onClose:ns}){const[os,as]=reactExports.useState(!1),[ls,cs]=reactExports.useState(es.vendor),[us,ds]=reactExports.useState(es.amount.toFixed(2)),[ms,ps]=reactExports.useState((es.vat||0).toFixed(2)),[hs,xs]=reactExports.useState(es.category),[ys,vs]=reactExports.useState(es.description),[gs,fs]=reactExports.useState(es.date),[js,Ss]=reactExports.useState(!1),bs=Es=>{Es.preventDefault(),!(!ls||!us)&&ss({...es,vendor:ls,amount:parseFloat(us),vat:parseFloat(ms)||0,category:hs,description:ys,date:gs})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:ns,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto animate-slideUp",onClick:Es=>Es.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between z-10",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:os?"Edit Receipt":"Receipt Details"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[!os&&jsxRuntimeExports.jsx("button",{onClick:()=>as(!0),className:"p-2 text-gold hover:text-gold-dark transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),jsxRuntimeExports.jsx("button",{onClick:ns,className:"p-2 -mr-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),es.imageUri&&jsxRuntimeExports.jsx("div",{className:"relative aspect-[4/3] bg-gray-100",children:jsxRuntimeExports.jsx("img",{src:es.imageUri,alt:"Receipt",className:"w-full h-full object-contain"})}),os?jsxRuntimeExports.jsxs("form",{onSubmit:bs,className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Vendor / Store"}),jsxRuntimeExports.jsx("input",{type:"text",value:ls,onChange:Es=>cs(Es.target.value),className:"input-field w-full",placeholder:"e.g., Camera Ready Cosmetics",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Amount"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:ts}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:us,onChange:Es=>ds(Es.target.value),className:"input-field w-full pl-7",placeholder:"0.00",required:!0})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"VAT"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:ts}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:ms,onChange:Es=>ps(Es.target.value),className:"input-field w-full pl-7",placeholder:"0.00"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Date"}),jsxRuntimeExports.jsx("input",{type:"date",value:gs,onChange:Es=>fs(Es.target.value),className:"input-field w-full"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Category"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:CATEGORIES.map(Es=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>xs(Es),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${hs===Es?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:Es},Es))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Description"}),jsxRuntimeExports.jsx("input",{type:"text",value:ys,onChange:Es=>vs(Es.target.value),className:"input-field w-full",placeholder:"e.g., Foundation restocks"})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{cs(es.vendor),ds(es.amount.toFixed(2)),ps((es.vat||0).toFixed(2)),xs(es.category),vs(es.description),fs(es.date),as(!1)},className:"flex-1 px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 rounded-button gold-gradient text-white font-medium disabled:opacity-50",disabled:!ls||!us,children:"Save Changes"})]})]}):jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-text-primary",children:es.vendor}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-0.5",children:formatShortDate(es.date)})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("span",{className:"text-xl font-bold text-text-primary",children:[ts,es.amount.toFixed(2)]}),es.vat>0&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:["incl. ",ts,es.vat.toFixed(2)," VAT"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[es.vat>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"VAT"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-text-primary",children:[ts,es.vat.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Category"}),jsxRuntimeExports.jsx("span",{className:"px-2.5 py-1 text-xs font-medium rounded-full bg-gray-100 text-text-secondary",children:es.category})]}),es.description&&jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Description"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-primary text-right max-w-[60%]",children:es.description})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Status"}),jsxRuntimeExports.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${es.synced?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:es.synced?"Synced":"Pending"})]})]}),jsxRuntimeExports.jsx("div",{className:"pt-2",children:js?jsxRuntimeExports.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Delete this receipt? This cannot be undone."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ss(!1),className:"flex-1 px-4 py-2.5 rounded-button bg-white border border-border text-text-primary text-sm font-medium",children:"Keep"}),jsxRuntimeExports.jsx("button",{onClick:()=>rs(es.id),className:"flex-1 px-4 py-2.5 rounded-button bg-red-500 text-white text-sm font-medium",children:"Delete"})]})]}):jsxRuntimeExports.jsx("button",{onClick:()=>Ss(!0),className:"w-full px-4 py-3 rounded-button text-red-500 text-sm font-medium hover:bg-red-50 transition-colors",children:"Delete Receipt"})})]})]})})}function BudgetEditModal({currentBudget:es,currentFloat:ts,currencySymbol:ss,onSave:rs,onClose:ns}){const[os,as]=reactExports.useState(es>0?es.toString():""),[ls,cs]=reactExports.useState(ts>0?ts.toString():""),us=ds=>{ds.preventDefault();const ms=parseFloat(os),ps=parseFloat(ls)||0;!isNaN(ms)&&ms>=0&&rs(ms,ps)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:ns,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg animate-slideUp",onClick:ds=>ds.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-3 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Budget Settings"})}),jsxRuntimeExports.jsxs("form",{onSubmit:us,className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Total Budget"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mb-2",children:"The overall budget allocated for this production."}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-lg",children:ss}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:os,onChange:ds=>as(ds.target.value),className:"input-field w-full pl-8 text-2xl font-bold",placeholder:"0.00",autoFocus:!0})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Float Received"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mb-2",children:"Money received in advance from production. This could be the full budget or a partial payment."}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-lg",children:ss}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:ls,onChange:ds=>cs(ds.target.value),className:"input-field w-full pl-8 text-xl font-bold",placeholder:"0.00"})]})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:ns,className:"flex-1 px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 rounded-button gold-gradient text-white font-medium",children:"Save"})]})]})]})})}function ExportReconciliationModal({onExport:es,onClose:ts,receiptsCount:ss,totalSpent:rs,currencySymbol:ns}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:ts,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg animate-slideUp",onClick:os=>os.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Export Spending Report"})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Reconciliation Summary"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[ss," receipts recorded"]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("p",{className:"text-lg font-bold text-gold",children:[ns,rs.toFixed(2)]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"total spent"})]})]})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Export a spending reconciliation report to send to production. Choose your preferred format:"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>es("csv"),className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Spreadsheet (CSV)"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Opens in Excel, Google Sheets"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>es("pdf"),className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"PDF Report"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Print-ready document"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border",children:jsxRuntimeExports.jsx("button",{onClick:ts,className:"w-full px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"})})]})})}const scriptRel="modulepreload",assetsURL=function(es){return"/mobile/"+es},seen={},__vitePreload=function es(ts,ss,rs){let ns=Promise.resolve();if(ss&&ss.length>0){document.getElementsByTagName("link");const as=document.querySelector("meta[property=csp-nonce]"),ls=(as==null?void 0:as.nonce)||(as==null?void 0:as.getAttribute("nonce"));ns=Promise.allSettled(ss.map(cs=>{if(cs=assetsURL(cs),cs in seen)return;seen[cs]=!0;const us=cs.endsWith(".css"),ds=us?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${cs}"]${ds}`))return;const ms=document.createElement("link");if(ms.rel=us?"stylesheet":scriptRel,us||(ms.as="script"),ms.crossOrigin="",ms.href=cs,ls&&ms.setAttribute("nonce",ls),document.head.appendChild(ms),us)return new Promise((ps,hs)=>{ms.addEventListener("load",ps),ms.addEventListener("error",()=>hs(new Error(`Unable to preload CSS for ${cs}`)))})}))}function os(as){const ls=new Event("vite:preloadError",{cancelable:!0});if(ls.payload=as,window.dispatchEvent(ls),!ls.defaultPrevented)throw as}return ns.then(as=>{for(const ls of as||[])ls.status==="rejected"&&os(ls.reason);return ts().catch(os)})},useBillingStore=create()(persist((es,ts)=>({billingDetails:createEmptyBillingDetails(),isLoading:!1,isSaving:!1,lastError:null,setBillingDetails:ss=>{es({billingDetails:{...ss,lastUpdated:new Date},lastError:null})},updatePersonalInfo:ss=>{es(rs=>({billingDetails:{...rs.billingDetails,...ss,lastUpdated:new Date},lastError:null}))},updateBankDetails:ss=>{es(rs=>({billingDetails:{...rs.billingDetails,bankDetails:{...rs.billingDetails.bankDetails,...ss},lastUpdated:new Date},lastError:null}))},updatePaymentTerms:ss=>{es(rs=>({billingDetails:{...rs.billingDetails,paymentTerms:ss,lastUpdated:new Date},lastError:null}))},updateVATSettings:ss=>{es(rs=>({billingDetails:{...rs.billingDetails,vatSettings:{...rs.billingDetails.vatSettings,...ss},lastUpdated:new Date},lastError:null}))},toggleVATRegistered:()=>{es(ss=>({billingDetails:{...ss.billingDetails,vatSettings:{...ss.billingDetails.vatSettings,isVATRegistered:!ss.billingDetails.vatSettings.isVATRegistered},lastUpdated:new Date},lastError:null}))},resetBillingDetails:()=>{es({billingDetails:createEmptyBillingDetails(),lastError:null})},isBillingComplete:()=>{const{billingDetails:ss}=ts(),{bankDetails:rs,vatSettings:ns}=ss,os=!!(ss.fullName&&ss.address&&ss.email),as=!!(rs.accountName&&rs.sortCode&&rs.accountNumber),ls=!ns.isVATRegistered||!!ns.vatNumber;return os&&as&&ls},getValidationErrors:()=>{const{billingDetails:ss}=ts(),{bankDetails:rs,vatSettings:ns}=ss,os=[];return ss.fullName||os.push("Full name is required"),ss.address||os.push("Address is required"),ss.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ss.email)||os.push("Email format is invalid"):os.push("Email is required"),rs.accountName||os.push("Bank account name is required"),rs.sortCode?/^\d{2}-?\d{2}-?\d{2}$/.test(rs.sortCode.replace(/\s/g,""))||os.push("Sort code should be 6 digits (e.g., 12-34-56)"):os.push("Sort code is required"),rs.accountNumber?/^\d{8}$/.test(rs.accountNumber.replace(/\s/g,""))||os.push("Account number should be 8 digits"):os.push("Account number is required"),ns.isVATRegistered&&!ns.vatNumber&&os.push("VAT number is required when VAT registered"),(ns.vatRate<0||ns.vatRate>100)&&os.push("VAT rate must be between 0 and 100"),os}}),{name:"checks-happy-billing",storage:createJSONStorage(()=>localStorage),partialize:es=>({billingDetails:es.billingDetails})})),formatSortCode=es=>{const ts=es.replace(/\D/g,"");return ts.length<=2?ts:ts.length<=4?`${ts.slice(0,2)}-${ts.slice(2)}`:`${ts.slice(0,2)}-${ts.slice(2,4)}-${ts.slice(4,6)}`},formatAccountNumber=es=>es.replace(/\D/g,"").slice(0,8),INVOICE_TIERS=["supervisor","designer"];function ProjectExportScreen({onBack:es,onExportComplete:ts,onNavigateToBilling:ss}){var _s,Ls;const{currentProject:rs,lifecycle:ns,sceneCaptures:os}=useProjectStore(),{isBillingComplete:as}=useBillingStore(),{user:ls}=useAuthStore(),[cs,us]=reactExports.useState(EXPORT_DOCUMENTS.map(Os=>({...Os}))),ds=ls&&INVOICE_TIERS.includes(ls.tier),ms=(_s=cs.find(Os=>Os.id==="invoice_summary"))==null?void 0:_s.selected,ps=as(),[hs,xs]=reactExports.useState("download"),[ys,vs]=reactExports.useState({status:"idle",progress:0}),gs=()=>{let Os=0;return cs.filter(qs=>qs.selected).forEach(qs=>{switch(qs.id){case"continuity_bible":Os+=2*1024*1024;break;case"scene_breakdown":Os+=50*1024;break;case"character_lookbooks":Os+=((rs==null?void 0:rs.characters.length)||0)*1024*1024;break;case"photo_archive":const Qs=Object.values(os).reduce((Ys,Ws)=>{let Is=0;return Ws.photos.front&&Is++,Ws.photos.left&&Is++,Ws.photos.right&&Is++,Ws.photos.back&&Is++,Is+=Ws.additionalPhotos.length,Ys+Is},0);Os+=Qs*500*1024;break;case"timesheets":Os+=200*1024;break;case"invoice_summary":Os+=100*1024;break}}),Os<1024*1024?`~${Math.round(Os/1024)} KB`:`~${Math.round(Os/(1024*1024))} MB`},fs=Os=>{us(zs=>zs.map(qs=>qs.id===Os?{...qs,selected:!qs.selected}:qs))},js=()=>{const Os=cs.every(zs=>zs.selected);us(zs=>zs.map(qs=>({...qs,selected:!Os})))},Ss=Os=>{switch(Os){case"pdf":return"bg-red-100 text-red-700";case"csv":case"excel":return"bg-green-100 text-green-700";case"zip":case"pdf_zip":return"bg-blue-100 text-blue-700";default:return"bg-gray-100 text-gray-700"}},bs=Os=>{switch(Os){case"pdf":return"PDF";case"csv":return"CSV";case"excel":return"Excel";case"zip":return"ZIP";case"pdf_zip":return"PDF (zip)";default:return Os.toUpperCase()}},Es=async()=>{const Os=cs.filter(zs=>zs.selected).map(zs=>zs.id);if(Os.length!==0){vs({status:"preparing",progress:0});try{for(let zs=0;zs<Os.length;zs++){const qs=Os[zs];vs({status:"generating",currentDocument:qs,progress:Math.round(zs/Os.length*80)}),await new Promise(Qs=>setTimeout(Qs,500))}vs({status:"packaging",progress:90}),await new Promise(zs=>setTimeout(zs,500)),await Rs(Os),vs({status:"complete",progress:100}),setTimeout(()=>{ts==null||ts()},1500)}catch(zs){vs({status:"error",progress:0,error:zs instanceof Error?zs.message:"Export failed"})}}},Rs=async Os=>{const{generateContinuityBiblePDF:zs}=await __vitePreload(async()=>{const{generateContinuityBiblePDF:Ys}=await Promise.resolve().then(()=>exportUtils);return{generateContinuityBiblePDF:Ys}},void 0),{generateSceneBreakdownCSV:qs}=await __vitePreload(async()=>{const{generateSceneBreakdownCSV:Ys}=await Promise.resolve().then(()=>exportUtils);return{generateSceneBreakdownCSV:Ys}},void 0),Qs=[];if(rs){for(const Ys of Os)switch(Ys){case"continuity_bible":const Ws=zs(rs,os);Qs.push({filename:`${rs.name}_Continuity_Bible.html`,content:Ws,mimeType:"text/html"});break;case"scene_breakdown":const Is=qs(rs,os);Qs.push({filename:`${rs.name}_Scene_Breakdown.csv`,content:Is,mimeType:"text/csv"});break}for(const Ys of Qs){const Ws=new Blob([Ys.content],{type:Ys.mimeType==="text/html"?"text/html;charset=utf-8":Ys.mimeType}),Is=URL.createObjectURL(Ws);if(Ys.mimeType==="text/html"){const Bs=window.open(Is,"_blank");Bs&&Bs.addEventListener("load",()=>{setTimeout(()=>Bs.print(),500)})}else{const Bs=document.createElement("a");Bs.href=Is,Bs.download=Ys.filename,document.body.appendChild(Bs),Bs.click(),document.body.removeChild(Bs)}URL.revokeObjectURL(Is)}}},ws=cs.filter(Os=>Os.selected).length,Ns=cs.every(Os=>Os.selected),ks=()=>ns.wrappedAt?new Date(ns.wrappedAt).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}):new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});return rs?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:es,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Export Project"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[rs.name,"  Wrapped ",ks()]})]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"SELECT DOCUMENTS"}),jsxRuntimeExports.jsx("button",{onClick:js,className:"text-sm font-medium text-gold active:opacity-70 transition-opacity",children:Ns?"Deselect All":"Select All"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2 mb-6",children:cs.map(Os=>jsxRuntimeExports.jsxs("button",{onClick:()=>fs(Os.id),className:`w-full card flex items-start gap-3 text-left transition-all ${Os.selected?"border-2 border-gold bg-gold/5":""}`,children:[jsxRuntimeExports.jsx("div",{className:`mt-0.5 w-5 h-5 rounded flex-shrink-0 flex items-center justify-center border-2 transition-colors ${Os.selected?"bg-gold border-gold":"border-border"}`,children:Os.selected&&jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Os.name}),jsxRuntimeExports.jsx("span",{className:`px-2 py-0.5 text-[10px] font-medium rounded ${Ss(Os.format)}`,children:bs(Os.format)})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:Os.description})]})]},Os.id))}),ms&&ds&&ss&&jsxRuntimeExports.jsx("div",{className:`mb-6 p-4 rounded-xl border ${ps?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${ps?"bg-green-100":"bg-amber-100"}`,children:ps?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:`text-sm font-medium ${ps?"text-green-700":"text-amber-700"}`,children:ps?"Billing details complete":"Billing details incomplete"}),jsxRuntimeExports.jsx("p",{className:`text-xs mt-0.5 ${ps?"text-green-600":"text-amber-600"}`,children:ps?"Your personal info, bank details, and VAT settings will appear on the invoice.":"Complete your billing details to generate professional invoices."}),jsxRuntimeExports.jsx("button",{onClick:ss,className:`mt-2 text-xs font-medium ${ps?"text-green-700":"text-amber-700"} underline`,children:ps?"Edit billing details":"Complete billing details"})]})]})}),ms&&!ds&&jsxRuntimeExports.jsx("div",{className:"mb-6 p-4 rounded-xl border bg-gray-50 border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 bg-gold/10",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Supervisor Feature"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"Upgrade to Supervisor or Designer to generate professional invoices with your billing details."})]})]})}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"DELIVERY METHOD"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"download",label:"Save to Device",icon:"download"},{id:"share",label:"Share",icon:"share"}].map(Os=>jsxRuntimeExports.jsxs("button",{onClick:()=>xs(Os.id),className:`p-3 rounded-xl border-2 text-center transition-all ${hs===Os.id?"border-gold bg-gold/5":"border-border bg-card"}`,children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 mx-auto mb-2 rounded-lg flex items-center justify-center ${hs===Os.id?"bg-gold text-white":"bg-gray-100 text-text-muted"}`,children:Os.icon==="download"?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-text-primary",children:Os.label})]},Os.id))})]}),ys.status!=="idle"&&jsxRuntimeExports.jsx("div",{className:"mb-6 p-4 bg-card rounded-xl border border-border",children:ys.status==="error"?jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-red-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-error",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-error font-medium",children:ys.error})]}):ys.status==="complete"?jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-green-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary font-medium",children:"Export Complete!"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm text-text-primary font-medium",children:[ys.status==="preparing"&&"Preparing export...",ys.status==="generating"&&`Generating ${((Ls=cs.find(Os=>Os.id===ys.currentDocument))==null?void 0:Ls.name)||""}...`,ys.status==="packaging"&&"Packaging files..."]}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-text-muted",children:[ys.progress,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gold rounded-full transition-all duration-300",style:{width:`${ys.progress}%`}})})]})}),jsxRuntimeExports.jsx("button",{onClick:Es,disabled:ws===0||["preparing","generating","packaging"].includes(ys.status),className:`w-full py-4 rounded-button font-semibold text-base shadow-lg transition-all ${ws===0?"bg-gray-200 text-text-light cursor-not-allowed":["preparing","generating","packaging"].includes(ys.status)?"bg-gold/70 text-white cursor-wait":"gold-gradient text-white active:scale-[0.98]"}`,children:["preparing","generating","packaging"].includes(ys.status)?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Exporting..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Export ",ws>0?`${ws} Selected`:"Documents",ws>0&&jsxRuntimeExports.jsxs("span",{className:"ml-2 opacity-80",children:["(",gs(),")"]})]})}),jsxRuntimeExports.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-xs font-semibold text-text-muted uppercase mb-3",children:"Project Summary"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold text-text-primary",children:rs.scenes.length}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Scenes"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold text-text-primary",children:rs.characters.length}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Characters"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold text-text-primary",children:rs.looks.length}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Looks"})]})]})]})]})]}):null}function BillingDetailsScreen({onBack:es}){const{billingDetails:ts,updatePersonalInfo:ss,updateBankDetails:rs,updatePaymentTerms:ns,updateVATSettings:os,toggleVATRegistered:as,isBillingComplete:ls,getValidationErrors:cs}=useBillingStore(),[us,ds]=reactExports.useState(!1),[ms,ps]=reactExports.useState(null);reactExports.useEffect(()=>{if(ms){const vs=setTimeout(()=>ps(null),2e3);return()=>clearTimeout(vs)}},[ms]);const hs=()=>{ds(!0),cs().length===0&&ps("Details saved successfully")},xs=us?cs():[],ys=ls();return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:es,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Billing Details"})]}),ys&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Complete"]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:[ms&&jsxRuntimeExports.jsx("div",{className:"mb-4 px-4 py-2 bg-green-50 border border-green-200 rounded-lg text-sm text-green-700",children:ms}),xs.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4 px-4 py-3 bg-red-50 border border-red-200 rounded-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-700 mb-2",children:"Please fix the following:"}),jsxRuntimeExports.jsx("ul",{className:"text-xs text-red-600 space-y-1",children:xs.map((vs,gs)=>jsxRuntimeExports.jsxs("li",{children:[" ",vs]},gs))})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PERSONAL / BUSINESS INFORMATION"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"FULL NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:ts.fullName,onChange:vs=>ss({fullName:vs.target.value}),placeholder:"John Smith",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"BUSINESS NAME"}),jsxRuntimeExports.jsx("input",{type:"text",value:ts.businessName,onChange:vs=>ss({businessName:vs.target.value}),placeholder:"Optional - if trading under a business name",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"For freelancers trading under a company or trading name"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ADDRESS *"}),jsxRuntimeExports.jsx("textarea",{value:ts.address,onChange:vs=>ss({address:vs.target.value}),placeholder:`123 High Street
London
SW1A 1AA`,rows:3,className:"input-field w-full resize-none"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"PHONE"}),jsxRuntimeExports.jsx("input",{type:"tel",value:ts.phone,onChange:vs=>ss({phone:vs.target.value}),placeholder:"+44 7700 900000",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"EMAIL *"}),jsxRuntimeExports.jsx("input",{type:"email",value:ts.email,onChange:vs=>ss({email:vs.target.value}),placeholder:"john@example.com",className:"input-field w-full"})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"BANK DETAILS FOR PAYMENT"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ACCOUNT NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:ts.bankDetails.accountName,onChange:vs=>rs({accountName:vs.target.value}),placeholder:"John Smith",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Name as it appears on your bank account"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"SORT CODE *"}),jsxRuntimeExports.jsx("input",{type:"text",value:ts.bankDetails.sortCode,onChange:vs=>{const gs=formatSortCode(vs.target.value);rs({sortCode:gs})},placeholder:"12-34-56",maxLength:8,className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ACCOUNT NUMBER *"}),jsxRuntimeExports.jsx("input",{type:"text",value:ts.bankDetails.accountNumber,onChange:vs=>{const gs=formatAccountNumber(vs.target.value);rs({accountNumber:gs})},placeholder:"12345678",maxLength:8,className:"input-field w-full"})]})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PAYMENT TERMS"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"TERMS"}),jsxRuntimeExports.jsxs("select",{value:ts.paymentTerms,onChange:vs=>ns(vs.target.value),className:"input-field w-full",children:[jsxRuntimeExports.jsx("option",{value:"Payment upon receipt",children:"Payment upon receipt"}),jsxRuntimeExports.jsx("option",{value:"Payment within 7 days",children:"Payment within 7 days"}),jsxRuntimeExports.jsx("option",{value:"Payment within 14 days",children:"Payment within 14 days"}),jsxRuntimeExports.jsx("option",{value:"Payment within 30 days",children:"Payment within 30 days"}),jsxRuntimeExports.jsx("option",{value:"Payment within 60 days",children:"Payment within 60 days"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-2",children:"This will appear on generated invoices"})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"VAT / TAX SETTINGS"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:"VAT Registered"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Are you registered for VAT?"})]}),jsxRuntimeExports.jsx("button",{onClick:as,className:`relative w-12 h-7 rounded-full transition-colors ${ts.vatSettings.isVATRegistered?"bg-gold":"bg-gray-200"}`,children:jsxRuntimeExports.jsx("span",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform ${ts.vatSettings.isVATRegistered?"left-6":"left-1"}`})})]}),ts.vatSettings.isVATRegistered&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"VAT NUMBER *"}),jsxRuntimeExports.jsx("input",{type:"text",value:ts.vatSettings.vatNumber,onChange:vs=>os({vatNumber:vs.target.value.toUpperCase()}),placeholder:"GB123456789",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"UK format: GB followed by 9 digits"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"VAT RATE (%)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{type:"number",value:ts.vatSettings.vatRate,onChange:vs=>os({vatRate:parseFloat(vs.target.value)||0}),min:"0",max:"100",step:"0.1",className:"input-field w-24"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"%"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Standard UK rate is 20%"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-border",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-muted mb-2",children:"INVOICE PREVIEW"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Subtotal (ex VAT)"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary",children:"1,000.00"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsxs("span",{className:"text-text-muted",children:["VAT (",ts.vatSettings.vatRate,"%)"]}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary",children:["",(1e3*ts.vatSettings.vatRate/100).toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-semibold pt-1 border-t border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-text-primary",children:"Total (inc VAT)"}),jsxRuntimeExports.jsxs("span",{className:"text-gold",children:["",(1e3*(1+ts.vatSettings.vatRate/100)).toFixed(2)]})]})]})]})]}),!ts.vatSettings.isVATRegistered&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"If you're not VAT registered, your invoices will not include VAT calculations. You can register for VAT at any time if your taxable turnover exceeds the threshold."})]})]}),jsxRuntimeExports.jsxs("div",{className:"sticky bottom-0 bg-background pt-4 pb-safe-bottom",children:[jsxRuntimeExports.jsx("button",{onClick:hs,className:"w-full py-3 rounded-button gold-gradient text-white font-medium active:scale-98 transition-transform",children:"Save Details"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center mt-2",children:"Details are saved automatically and will appear on your invoices"})]})]})]})}function ConfirmationModal({isOpen:es,onClose:ts,onConfirm:ss,title:rs,message:ns,confirmText:os="Confirm",cancelText:as="Cancel",variant:ls="default",requiresTextConfirmation:cs,isLoading:us=!1}){const[ds,ms]=reactExports.useState(""),ps=cs!==void 0&&ds.toLowerCase()!==cs.toLowerCase(),hs=()=>{ms(""),ts()},xs=()=>{!ps&&!us&&(ss(),ms(""))};return jsxRuntimeExports.jsx(Modal,{isOpen:es,onClose:hs,title:rs,children:jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-text-muted",children:ns}),cs&&jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:['Type "',jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:cs}),'" to confirm:']}),jsxRuntimeExports.jsx(Input,{type:"text",value:ds,onChange:ys=>ms(ys.target.value),placeholder:cs,autoComplete:"off"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:hs,fullWidth:!0,disabled:us,children:as}),jsxRuntimeExports.jsx(Button,{variant:ls==="danger"?"outline":"primary",onClick:xs,fullWidth:!0,disabled:ps||us,className:ls==="danger"?"border-red-500 text-red-500 hover:bg-red-50":"",children:us?"Loading...":os})]})]})})}function TeamMemberCard({member:es,canManage:ts,onChangeRole:ss,onRemove:rs}){const[ns,os]=reactExports.useState(!1),[as,ls]=reactExports.useState(!1),cs=reactExports.useRef(null),us=vs=>new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(new Date(vs)),ds=vs=>vs.split(" ").map(gs=>gs[0]).join("").toUpperCase().slice(0,2),ms=vs=>{const gs=["bg-blue-500","bg-green-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500","bg-orange-500","bg-cyan-500"];let fs=0;for(let js=0;js<vs.length;js++)fs=vs.charCodeAt(js)+((fs<<5)-fs);return gs[Math.abs(fs)%gs.length]};reactExports.useEffect(()=>{const vs=gs=>{cs.current&&!cs.current.contains(gs.target)&&(os(!1),ls(!1))};if(ns)return document.addEventListener("mousedown",vs),()=>document.removeEventListener("mousedown",vs)},[ns]);const ps=()=>{ts&&!es.isOwner&&(os(!0),"vibrate"in navigator&&navigator.vibrate(50))},hs=reactExports.useRef(null),xs=()=>{hs.current=setTimeout(ps,500)},ys=()=>{hs.current&&(clearTimeout(hs.current),hs.current=null)};return jsxRuntimeExports.jsxs("div",{className:"relative",ref:cs,children:[jsxRuntimeExports.jsxs("div",{className:"card flex items-center gap-3 mb-2",onTouchStart:xs,onTouchEnd:ys,onTouchCancel:ys,onContextMenu:vs=>{ts&&!es.isOwner&&(vs.preventDefault(),os(!0))},children:[es.avatarUrl?jsxRuntimeExports.jsx("img",{src:es.avatarUrl,alt:es.name,className:"w-12 h-12 rounded-full object-cover"}):jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold ${ms(es.name)}`,children:ds(es.name)}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary truncate",children:es.name}),es.isOwner&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium bg-gold-100 text-gold rounded-full",children:"Owner"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:getTeamMemberRoleLabel(es.role)}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-light",children:["Joined ",us(es.joinedAt)]})]}),ts&&!es.isOwner&&jsxRuntimeExports.jsx("button",{onClick:()=>os(!ns),className:"p-2 -m-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]}),ns&&jsxRuntimeExports.jsxs("div",{className:"absolute right-4 top-full mt-1 z-10 bg-card rounded-xl shadow-lg border border-border overflow-hidden min-w-[160px]",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{os(!1),ls(!0)},className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Change Role"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{os(!1),rs==null||rs(es.userId)},className:"w-full px-4 py-3 text-left text-sm text-red-500 hover:bg-red-50 flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remove from Project"]})]}),as&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Change Role"}),jsxRuntimeExports.jsx("button",{onClick:()=>ls(!1),className:"p-2 -m-2 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted mt-1",children:["Select a new role for ",es.name]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:TEAM_MEMBER_ROLES.map(vs=>jsxRuntimeExports.jsxs("button",{onClick:()=>{ss==null||ss(es.userId,vs.value),ls(!1)},className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${es.role===vs.value?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${es.role===vs.value?"text-gold":"text-text-primary"}`,children:vs.label}),es.role===vs.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},vs.value))})})]})})]})}function TeamMemberList({members:es,canManage:ts,onChangeRole:ss,onRemoveMember:rs}){const[ns,os]=reactExports.useState(null),as=groupTeamMembersByRole(es),ls=ds=>{const ms=es.find(ps=>ps.userId===ds);ms&&os(ms)},cs=()=>{ns&&(rs==null||rs(ns.userId),os(null))},us=ds=>{const ms=ds.members.length;switch(ds.role){case"designer":return`DESIGNERS (HOD) (${ms})`;case"supervisor":return`SUPERVISORS (${ms})`;case"key":return`KEY ARTISTS (${ms})`;case"hair":return`HAIR ARTISTS (${ms})`;case"makeup":return`MAKEUP ARTISTS (${ms})`;case"sfx":return`SPECIAL EFFECTS ARTISTS (${ms})`;case"daily":return`DAILIES (${ms})`;case"trainee":return`TRAINEES (${ms})`;default:return`${ds.label.toUpperCase()} (${ms})`}};return es.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No team members yet"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-1",children:"Share the invite code to add team members"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"space-y-6",children:as.map(ds=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3 px-1",children:us(ds)}),jsxRuntimeExports.jsx("div",{children:ds.members.map(ms=>jsxRuntimeExports.jsx(TeamMemberCard,{member:ms,canManage:ts,onChangeRole:ss,onRemove:ls},ms.userId))})]},ds.role))}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:!!ns,onClose:()=>os(null),onConfirm:cs,title:`Remove ${ns==null?void 0:ns.name}?`,message:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("p",{children:"They will lose access to this project immediately."}),jsxRuntimeExports.jsx("p",{children:"Their contributions will remain."})]}),confirmText:"Remove",variant:"danger"})]})}function InviteCodeShare({inviteCode:es,isOwner:ts,onRegenerateCode:ss}){const[rs,ns]=reactExports.useState(null),[os,as]=reactExports.useState(!1),[ls,cs]=reactExports.useState(!1),[us,ds]=reactExports.useState(es),ms=`checkshappy.app/join/${us}`,ps=async(ys,vs)=>{try{await navigator.clipboard.writeText(ys),ns(vs),setTimeout(()=>ns(null),2e3)}catch{const gs=document.createElement("textarea");gs.value=ys,document.body.appendChild(gs),gs.select(),document.execCommand("copy"),document.body.removeChild(gs),ns(vs),setTimeout(()=>ns(null),2e3)}},hs=async()=>{if(navigator.share)try{await navigator.share({title:"Join my project on Checks Happy",text:`Use code ${us} to join my production on Checks Happy!`,url:`https://${ms}`})}catch{}else ps(`https://${ms}`,"link")},xs=async()=>{if(ss){cs(!0);try{const ys=await ss();ds(ys),as(!1)}finally{cs(!1)}}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Share this code with your team:"}),jsxRuntimeExports.jsx("div",{className:"bg-gray-50 rounded-2xl p-6 mb-4",children:jsxRuntimeExports.jsx("span",{className:"text-3xl font-bold tracking-widest text-text-primary",children:us})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>ps(us,"code"),fullWidth:!0,children:rs==="code"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy"]})}),jsxRuntimeExports.jsxs(Button,{variant:"primary",onClick:hs,fullWidth:!0,children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]})]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-3",children:"Or share this link:"}),jsxRuntimeExports.jsx("div",{className:"bg-gray-50 rounded-xl p-3 mb-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary font-mono break-all",children:ms})}),jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:()=>ps(`https://${ms}`,"link"),fullWidth:!0,children:rs==="link"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Link Copied!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Copy Link"]})})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 p-4 bg-gold-50/50 rounded-xl",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:"Tip:"})," Add the code to your call sheet so the whole team can join easily."]})]}),ts&&ss&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-border"}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-amber-50 rounded-xl",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-medium text-amber-800 mb-1",children:"Regenerate Code"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-700 mb-3",children:"Create a new code if the current one has been shared too widely. Existing team members won't be affected."}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>as(!0),className:"border-amber-600 text-amber-700 hover:bg-amber-100",children:"Regenerate Code"})]})]})})]})]}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:os,onClose:()=>as(!1),onConfirm:xs,title:"Regenerate invite code?",message:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("p",{children:["The current code (",jsxRuntimeExports.jsx("span",{className:"font-mono font-medium",children:us}),") will stop working immediately."]}),jsxRuntimeExports.jsx("p",{children:"Team members already joined won't be affected."})]}),confirmText:"Regenerate",isLoading:ls})]})}function ProjectStatsCard({stats:es}){const ts=ss=>{if(!ss)return"No activity";const ns=new Date().getTime()-new Date(ss).getTime(),os=Math.floor(ns/(1e3*60)),as=Math.floor(ns/(1e3*60*60)),ls=Math.floor(ns/(1e3*60*60*24));return os<1?"Just now":os<60?`${os} minutes ago`:as<24?`${as} hours ago`:ls===1?"Yesterday":ls<7?`${ls} days ago`:new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short"}).format(new Date(ss))};return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"SCRIPT"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Scenes"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:es.sceneCount})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Story Days"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:es.storyDays})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Characters"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:es.characterCount})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"CONTINUITY"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Progress"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:[es.completionPercentage,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"w-full h-3 bg-gray-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full gold-gradient rounded-full transition-all duration-500",style:{width:`${es.completionPercentage}%`}})}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-2",children:[es.completedScenes," of ",es.sceneCount," scenes checked"]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PHOTOS"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Photos Uploaded"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:es.photoCount.toLocaleString()})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Storage Used"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:formatStorageSize(es.storageUsed)})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"TEAM ACTIVITY"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Team Members"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:es.teamMemberCount})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Last Activity"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ts(es.lastActivity)})]}),es.mostActiveUser&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Most Active"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:[es.mostActiveUser.name," (",es.mostActiveUser.editCount.toLocaleString()," edits)"]})]})]})]})]})}function PermissionPicker({label:es,value:ts,onChange:ss,disabled:rs=!1}){var ls;const[ns,os]=reactExports.useState(!1),as=((ls=PERMISSION_LEVELS.find(cs=>cs.value===ts))==null?void 0:ls.label)||ts;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>!rs&&os(!0),disabled:rs,className:`w-full card flex items-center justify-between ${rs?"opacity-50 cursor-not-allowed":"active:scale-[0.98] transition-transform"}`,children:[jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:es}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:as})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsx(BottomSheet,{isOpen:ns,onClose:()=>os(!1),title:es,children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:PERMISSION_LEVELS.map(cs=>jsxRuntimeExports.jsxs("button",{onClick:()=>{ss(cs.value),os(!1)},className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${ts===cs.value?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${ts===cs.value?"text-gold":"text-text-primary"}`,children:cs.label}),ts===cs.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},cs.value))})})]})}const PRODUCTION_TYPE_OPTIONS=[{value:"film",label:"Feature Film"},{value:"tv_series",label:"TV Series"},{value:"short_film",label:"Short Film"},{value:"commercial",label:"Commercial"},{value:"music_video",label:"Music Video"},{value:"theatre",label:"Theatre"},{value:"other",label:"Other"}];function ProductionTypeSelector({value:es,onChange:ts,disabled:ss=!1}){var as;const[rs,ns]=reactExports.useState(!1),os=((as=PRODUCTION_TYPE_OPTIONS.find(ls=>ls.value===es))==null?void 0:as.label)||es;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>!ss&&ns(!0),disabled:ss,className:`w-full card flex items-center justify-between ${ss?"opacity-50 cursor-not-allowed":"active:scale-[0.98] transition-transform"}`,children:[jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Production Type"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:os})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsx(BottomSheet,{isOpen:rs,onClose:()=>ns(!1),title:"Production Type",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:PRODUCTION_TYPE_OPTIONS.map(ls=>jsxRuntimeExports.jsxs("button",{onClick:()=>{ts(ls.value),ns(!1)},className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${es===ls.value?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${es===ls.value?"text-gold":"text-text-primary"}`,children:ls.label}),es===ls.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},ls.value))})})]})}function ScheduleEditor({scenes:es,onSave:ts,initialDayNumber:ss=1,initialDate:rs=new Date,initialSceneIds:ns=[]}){const[os,as]=reactExports.useState(ss),[ls,cs]=reactExports.useState(ys(rs)),[us,ds]=reactExports.useState(new Set(ns)),[ms,ps]=reactExports.useState(""),[hs,xs]=reactExports.useState(!1);function ys(bs){return bs.toISOString().split("T")[0]}function vs(bs){const Es=new Date(bs);return new Intl.DateTimeFormat("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}).format(Es)}const gs=reactExports.useMemo(()=>{if(!ms.trim())return es;const bs=ms.toLowerCase();return es.filter(Es=>Es.sceneNumber.toLowerCase().includes(bs)||Es.slugline.toLowerCase().includes(bs))},[es,ms]),fs=bs=>{const Es=new Set(us);Es.has(bs)?Es.delete(bs):Es.add(bs),ds(Es)},js=async()=>{xs(!0);try{const bs=new Date(ls);ts(os,bs,Array.from(us))}finally{xs(!1)}},Ss=reactExports.useMemo(()=>es.filter(bs=>us.has(bs.id)),[es,us]);return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"Shooting Day"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("select",{value:os,onChange:bs=>as(Number(bs.target.value)),className:"input-field w-full appearance-none pr-10",children:Array.from({length:100},(bs,Es)=>Es+1).map(bs=>jsxRuntimeExports.jsxs("option",{value:bs,children:["Day ",bs]},bs))}),jsxRuntimeExports.jsx("svg",{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"Date"}),jsxRuntimeExports.jsx("input",{type:"date",value:ls,onChange:bs=>cs(bs.target.value),className:"input-field w-full"})]})]}),jsxRuntimeExports.jsx("div",{className:"text-center py-2 px-4 bg-gold-50 rounded-xl",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gold",children:vs(ls)})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"SELECT SCENES FOR TODAY:"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),jsxRuntimeExports.jsx(Input,{type:"text",value:ms,onChange:bs=>ps(bs.target.value),placeholder:"Search scenes...",className:"pl-10"})]})]}),jsxRuntimeExports.jsxs("div",{className:"max-h-[40vh] overflow-y-auto -mx-4 px-4",children:[jsxRuntimeExports.jsx("div",{className:"space-y-2",children:gs.map(bs=>{const Es=us.has(bs.id);return jsxRuntimeExports.jsxs("button",{onClick:()=>fs(bs.id),className:`w-full px-4 py-3 rounded-xl text-left flex items-center gap-3 transition-colors ${Es?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-md border-2 flex items-center justify-center transition-colors ${Es?"bg-gold border-gold text-white":"border-gray-300"}`,children:Es&&jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:["Scene ",bs.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:bs.intExt})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted truncate",children:bs.slugline})]}),bs.isComplete&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium bg-green-100 text-green-600 rounded-full",children:"Complete"})]},bs.id)})}),gs.length===0&&jsxRuntimeExports.jsx("div",{className:"text-center py-8",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No scenes found"})})]}),jsxRuntimeExports.jsx("div",{className:"py-2 border-t border-border",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted text-center",children:[us.size," scene",us.size!==1?"s":""," selected"]})}),Ss.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-muted mb-2",children:"Shot Order:"}),jsxRuntimeExports.jsx("div",{className:"space-y-1",children:Ss.map((bs,Es)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-bold text-text-muted w-5",children:[Es+1,"."]}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-primary",children:["Scene ",bs.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate flex-1",children:bs.slugline})]},bs.id))}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-2 text-center",children:"Tip: Drag to reorder scenes for shot order"})]}),jsxRuntimeExports.jsx(Button,{variant:"primary",onClick:js,fullWidth:!0,disabled:us.size===0||hs,children:hs?"Saving...":"Save Today's Schedule"})]})}function DangerZone({projectName:es,photoCount:ts,onArchive:ss,onDelete:rs}){const[ns,os]=reactExports.useState(!1),[as,ls]=reactExports.useState(!1),[cs,us]=reactExports.useState(!1),[ds,ms]=reactExports.useState(!1),ps=async()=>{us(!0);try{await ss(),os(!1)}finally{us(!1)}},hs=async()=>{ms(!0);try{await rs(),ls(!1)}finally{ms(!1)}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-red-500 mb-3",children:"DANGER ZONE"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>os(!0),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-50 flex items-center justify-center text-amber-600",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Archive Project"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Mark as wrapped, make read-only"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>ls(!0),className:"w-full card flex items-center gap-4 border-red-200 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-50 flex items-center justify-center text-red-500",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-500",children:"Delete Project"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Permanently delete all data"})]}),jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})]})]})]}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:ns,onClose:()=>os(!1),onConfirm:ps,title:`Archive "${es}"?`,message:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("p",{children:"The project will become read-only."}),jsxRuntimeExports.jsx("p",{children:"Team members can still view continuity data and photos, but can't make changes."}),jsxRuntimeExports.jsx("p",{className:"font-medium",children:"You can restore it later from your Dashboard."})]}),confirmText:"Archive Project",isLoading:cs}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:as,onClose:()=>ls(!1),onConfirm:hs,title:`Delete "${es}"?`,message:jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:"This cannot be undone."})]}),jsxRuntimeExports.jsx("p",{children:"This will permanently delete:"}),jsxRuntimeExports.jsxs("ul",{className:"list-disc list-inside space-y-1 text-text-muted",children:[jsxRuntimeExports.jsx("li",{children:"All scenes and breakdowns"}),jsxRuntimeExports.jsx("li",{children:"All continuity notes"}),jsxRuntimeExports.jsxs("li",{children:["All ",ts.toLocaleString()," photos"]}),jsxRuntimeExports.jsx("li",{children:"Team member access"})]})]}),confirmText:"Delete Forever",variant:"danger",requiresTextConfirmation:es,isLoading:ds})]})}const mockDelay=es=>new Promise(ts=>setTimeout(ts,es)),generateMockTeamMembers=es=>[{name:"Sarah Chen",role:"designer",isOwner:!0},{name:"Mike Torres",role:"supervisor",isOwner:!1},{name:"Emma Wright",role:"key",isOwner:!1},{name:"David Park",role:"key",isOwner:!1},{name:"Lucy Hammond",role:"hair",isOwner:!1},{name:"Alex Rivera",role:"makeup",isOwner:!1},{name:"Jordan Lee",role:"sfx",isOwner:!1},{name:"James Cole",role:"daily",isOwner:!1}].map((ss,rs)=>({userId:`user-${rs+1}`,projectId:es,name:ss.name,email:`${ss.name.toLowerCase().replace(" ",".")}@example.com`,role:ss.role,isOwner:ss.isOwner,joinedAt:new Date(Date.now()-(30-rs)*24*60*60*1e3),lastActiveAt:new Date(Date.now()-rs*60*60*1e3),editCount:Math.floor(Math.random()*500)+50})),generateMockStats=()=>({sceneCount:142,storyDays:23,characterCount:14,completedScenes:94,completionPercentage:67,photoCount:1247,storageUsed:2.3*1024*1024*1024,teamMemberCount:8,lastActivity:new Date(Date.now()-2*60*60*1e3),mostActiveUser:{name:"Sarah Chen",editCount:342}}),useProjectSettingsStore=create((es,ts)=>({projectSettings:null,teamMembers:[],projectStats:null,shootingDays:[],isLoading:!1,error:null,loadProjectSettings:async ss=>{es({isLoading:!0,error:null});try{await mockDelay(400);const rs={id:ss,name:"The Punishing",type:"film",status:"shooting",inviteCode:"TMK-4827",ownerId:"user-1",permissions:createDefaultProjectPermissions(),createdAt:new Date(Date.now()-30*24*60*60*1e3),archivedAt:null},ns=generateMockStats();es({projectSettings:rs,projectStats:ns,isLoading:!1})}catch{es({isLoading:!1,error:"Failed to load project settings"})}},updateProjectName:async ss=>{const{projectSettings:rs}=ts();if(rs){es({isLoading:!0});try{await mockDelay(300),es({projectSettings:{...rs,name:ss},isLoading:!1})}catch{es({isLoading:!1,error:"Failed to update project name"})}}},updateProjectType:async ss=>{const{projectSettings:rs}=ts();if(rs){es({isLoading:!0});try{await mockDelay(300),es({projectSettings:{...rs,type:ss},isLoading:!1})}catch{es({isLoading:!1,error:"Failed to update project type"})}}},updateProjectStatus:async ss=>{const{projectSettings:rs}=ts();if(rs){es({isLoading:!0});try{await mockDelay(300),es({projectSettings:{...rs,status:ss},isLoading:!1})}catch{es({isLoading:!1,error:"Failed to update project status"})}}},updatePermission:async(ss,rs)=>{const{projectSettings:ns}=ts();if(ns){es({isLoading:!0});try{await mockDelay(300),es({projectSettings:{...ns,permissions:{...ns.permissions,[ss]:rs}},isLoading:!1})}catch{es({isLoading:!1,error:"Failed to update permission"})}}},regenerateInviteCode:async()=>{const{projectSettings:ss}=ts();if(!ss)throw new Error("No project loaded");es({isLoading:!0});try{await mockDelay(500);const rs=generateProjectCode();return es({projectSettings:{...ss,inviteCode:rs},isLoading:!1}),rs}catch{throw es({isLoading:!1,error:"Failed to regenerate invite code"}),new Error("Failed to regenerate invite code")}},archiveProject:async()=>{const{projectSettings:ss}=ts();if(ss){es({isLoading:!0});try{await mockDelay(500),es({projectSettings:{...ss,status:"archived",archivedAt:new Date},isLoading:!1})}catch{throw es({isLoading:!1,error:"Failed to archive project"}),new Error("Failed to archive project")}}},deleteProject:async()=>{es({isLoading:!0});try{await mockDelay(800),es({projectSettings:null,teamMembers:[],projectStats:null,shootingDays:[],isLoading:!1})}catch{throw es({isLoading:!1,error:"Failed to delete project"}),new Error("Failed to delete project")}},loadTeamMembers:async ss=>{es({isLoading:!0,error:null});try{await mockDelay(400);const rs=generateMockTeamMembers(ss);es({teamMembers:rs,isLoading:!1})}catch{es({isLoading:!1,error:"Failed to load team members"})}},changeTeamMemberRole:async(ss,rs)=>{const{teamMembers:ns}=ts();es({isLoading:!0});try{await mockDelay(300);const os=ns.map(as=>as.userId===ss?{...as,role:rs}:as);es({teamMembers:os,isLoading:!1})}catch{es({isLoading:!1,error:"Failed to change role"})}},removeTeamMember:async ss=>{const{teamMembers:rs,projectStats:ns}=ts();es({isLoading:!0});try{await mockDelay(400);const os=rs.filter(as=>as.userId!==ss);es({teamMembers:os,projectStats:ns?{...ns,teamMemberCount:os.length}:null,isLoading:!1})}catch{es({isLoading:!1,error:"Failed to remove team member"})}},saveShootingDay:async(ss,rs,ns)=>{const{shootingDays:os,projectSettings:as}=ts();if(as){es({isLoading:!0});try{await mockDelay(400);const ls={id:`day-${ss}`,projectId:as.id,dayNumber:ss,date:rs,sceneIds:ns,createdBy:"current-user",createdAt:new Date},cs=os.findIndex(ds=>ds.dayNumber===ss),us=cs>=0?os.map((ds,ms)=>ms===cs?ls:ds):[...os,ls];es({shootingDays:us,isLoading:!1})}catch{es({isLoading:!1,error:"Failed to save shooting day"})}}},clearState:()=>{es({projectSettings:null,teamMembers:[],projectStats:null,shootingDays:[],isLoading:!1,error:null})}}));function TeamScreen({projectId:es,canManage:ts,isOwner:ss,onBack:rs,onInvite:ns}){const{teamMembers:os,isLoading:as,loadTeamMembers:ls,changeTeamMemberRole:cs,removeTeamMember:us}=useProjectSettingsStore();reactExports.useEffect(()=>{ls(es)},[es,ls]);const ds=(ps,hs)=>{cs(ps,hs)},ms=ps=>{us(ps)};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:rs,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Team"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[os.length," members"]})]})]}),ss&&jsxRuntimeExports.jsxs(Button,{variant:"primary",size:"sm",onClick:ns,children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Invite"]})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:as&&os.length===0?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"})}):jsxRuntimeExports.jsx(TeamMemberList,{members:os,canManage:ts,onChangeRole:ds,onRemoveMember:ms})})]})}function InviteScreen({inviteCode:es,isOwner:ts,onBack:ss}){const{regenerateInviteCode:rs}=useProjectSettingsStore();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ss,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Invite Team"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-6",children:jsxRuntimeExports.jsx(InviteCodeShare,{inviteCode:es,isOwner:ts,onRegenerateCode:ts?rs:void 0})})]})}function ProjectStatsScreen({projectId:es,onBack:ts}){const{projectStats:ss,isLoading:rs,loadProjectSettings:ns}=useProjectSettingsStore();return reactExports.useEffect(()=>{ss||ns(es)},[es,ss,ns]),jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ts,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Stats"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:rs&&!ss?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"})}):ss?jsxRuntimeExports.jsx(ProjectStatsCard,{stats:ss}):jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No stats available"})})})]})}function ScheduleScreen({onBack:es,onSaved:ts}){const{currentProject:ss}=useProjectStore(),{saveShootingDay:rs}=useProjectSettingsStore(),ns=(ss==null?void 0:ss.scenes)||[],os=async(as,ls,cs)=>{await rs(as,ls,cs),ts==null||ts()};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:es,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Today's Scenes"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:ns.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No scenes available"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-1",children:"Import a script to add scenes"})]}):jsxRuntimeExports.jsx(ScheduleEditor,{scenes:ns,onSave:os})})]})}function ProjectSettingsScreen({projectId:es,onBack:ts,onNavigateToTeam:ss,onNavigateToStats:rs,onNavigateToExport:ns,onProjectArchived:os,onProjectDeleted:as}){const{projectSettings:ls,projectStats:cs,isLoading:us,loadProjectSettings:ds,updateProjectName:ms,updateProjectType:ps,updatePermission:hs,archiveProject:xs,deleteProject:ys}=useProjectSettingsStore(),{currentProject:vs,lifecycle:gs,wrapProject:fs,restoreProject:js,getDaysUntilDeletion:Ss}=useProjectStore(),{user:bs}=useAuthStore(),Es=bs&&ls?bs.id===ls.ownerId:!1,[Rs,ws]=reactExports.useState(!1),[Ns,ks]=reactExports.useState(""),[_s,Ls]=reactExports.useState(!1),[Os,zs]=reactExports.useState(!1),qs=Ss();reactExports.useEffect(()=>{ds(es)},[es,ds]),reactExports.useEffect(()=>{ls&&ks(ls.name)},[ls]);const Qs=async()=>{Ns.trim()&&Ns!==(ls==null?void 0:ls.name)&&await ms(Ns.trim()),ws(!1)},Ys=async()=>{await xs(),os==null||os()},Ws=async()=>{await ys(),as==null||as()},Is=()=>{fs("manual"),Ls(!1)};return us&&!ls?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ts,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Settings"})]})})}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"})})]}):ls?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ts,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Settings"})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 space-y-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PROJECT DETAILS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[Rs?jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"Production Name"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Input,{value:Ns,onChange:Bs=>ks(Bs.target.value),autoFocus:!0,className:"flex-1"}),jsxRuntimeExports.jsx("button",{onClick:Qs,className:"px-3 py-2 text-sm font-medium text-gold hover:bg-gold-50 rounded-lg transition-colors",children:"Save"}),jsxRuntimeExports.jsx("button",{onClick:()=>{ks(ls.name),ws(!1)},className:"px-3 py-2 text-sm text-text-muted hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"})]})]}):jsxRuntimeExports.jsxs("button",{onClick:()=>ws(!0),className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Production Name"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:ls.name})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsx(ProductionTypeSelector,{value:ls.type,onChange:ps})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"TEAM"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:ss,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Team Members"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"View and manage team"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>zs(!Os),className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Share Invite Code"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Invite team members to join"})]})]}),jsxRuntimeExports.jsx("svg",{className:`w-5 h-5 text-text-light transition-transform ${Os?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),Os&&jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx(InviteCodeShare,{inviteCode:ls.inviteCode,isOwner:Es})}),jsxRuntimeExports.jsxs("button",{onClick:rs,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Project Stats"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"View project statistics"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"TEAM PERMISSIONS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(PermissionPicker,{label:"Who can add photos",value:ls.permissions.addPhotos,onChange:Bs=>hs("addPhotos",Bs)}),jsxRuntimeExports.jsx(PermissionPicker,{label:"Who can edit continuity notes",value:ls.permissions.editNotes,onChange:Bs=>hs("editNotes",Bs)}),jsxRuntimeExports.jsx(PermissionPicker,{label:"Who can mark scenes complete",value:ls.permissions.markComplete,onChange:Bs=>hs("markComplete",Bs)})]})]}),vs&&jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"EXPORT & WRAP"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:ns,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Export Project"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Download continuity documents"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),gs.state==="active"&&jsxRuntimeExports.jsxs("button",{onClick:()=>Ls(!0),className:"w-full card flex items-center justify-between hover:bg-amber-50 active:scale-[0.98] transition-all",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.875 1.875 0 0118 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-amber-700",children:"Mark as Wrapped"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Production complete"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),gs.state==="wrapped"&&jsxRuntimeExports.jsx("div",{className:"card bg-amber-50 border border-amber-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Project Wrapped"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-amber-600",children:[qs," days until archive"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>js(),className:"px-3 py-1.5 text-xs font-medium text-gold bg-white rounded-lg border border-gold",children:"Restore"})]})}),gs.state==="archived"&&jsxRuntimeExports.jsx("div",{className:"card bg-red-50 border border-red-200",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-800",children:"Project Archived - Read Only"})})]})]}),jsxRuntimeExports.jsx(DangerZone,{projectName:ls.name,photoCount:(cs==null?void 0:cs.photoCount)||0,onArchive:Ys,onDelete:Ws})]}),_s&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>Ls(!1)}),jsxRuntimeExports.jsxs("div",{className:"relative bg-card rounded-2xl p-6 max-w-sm w-full shadow-xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-text-primary mb-2",children:"Mark Project as Wrapped?"}),jsxRuntimeExports.jsxs("p",{className:"text-text-secondary text-sm mb-4",children:['This will mark "',ls.name,'" as wrapped. The project will be archived after ',PROJECT_RETENTION_DAYS," days."]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mb-6",children:"You can restore the project at any time before it's archived."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ls(!1),className:"flex-1 py-2.5 px-4 rounded-button border border-border text-text-muted text-sm font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Is,className:"flex-1 py-2.5 px-4 rounded-button bg-amber-500 text-white text-sm font-medium",children:"Wrap Project"})]})]})]})]}):null}pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;async function extractTextFromPDF(es){const ts=await es.arrayBuffer(),ss=await pdfExports.getDocument({data:ts}).promise;let rs="";for(let ns=1;ns<=ss.numPages;ns++){const as=await(await ss.getPage(ns)).getTextContent(),ls=new Map;for(const us of as.items){if(!us.str||us.str.trim()==="")continue;const ds=Math.round(us.transform[5]/2)*2,ms=us.transform[4];ls.has(ds)||ls.set(ds,[]),ls.get(ds).push({x:ms,text:us.str,width:us.width||0})}const cs=Array.from(ls.keys()).sort((us,ds)=>ds-us);for(const us of cs){const ds=ls.get(us);ds.sort((xs,ys)=>xs.x-ys.x);let ms="",ps=0,hs=0;for(const xs of ds){const ys=xs.x-(ps+hs);ps>0&&ys>3&&(ys>20?ms+="    ":ms+=" "),ms+=xs.text,ps=xs.x,hs=xs.width}rs+=ms.trimEnd()+`
`}rs+=`
`}return normalizeScriptText(rs)}function normalizeScriptText(es){return es.replace(/\b(INT|EXT)\s*\n\s*\./g,"$1.").replace(/\b(INT|EXT)\s*\n\s*\/\s*(INT|EXT)/g,"$1/$2").replace(/CONTIN\s*\n\s*UED?/gi,"CONTINUOUS").replace(/CONT['']?D/gi,"CONT'D").replace(/\(\s*V\s*\.\s*O\s*\.\s*\)/gi,"(V.O.)").replace(/\(\s*O\s*\.\s*S\s*\.\s*\)/gi,"(O.S.)").replace(/[ \t]+/g," ").replace(/\n{4,}/g,`


`).replace(/(\d+[A-Z]?)\s+\./g,"$1.").trim()}function extractTextFromFDX(es){try{const rs=new DOMParser().parseFromString(es,"text/xml").querySelectorAll("Paragraph");let ns="";return rs.forEach(os=>{const as=os.getAttribute("Type"),ls=os.querySelectorAll("Text");let cs="";ls.forEach(us=>{cs+=us.textContent||""}),as==="Scene Heading"?ns+=`
`+cs.trim()+`
`:as==="Character"?ns+=`
`+cs.trim().toUpperCase()+`
`:as==="Dialogue"?ns+=cs.trim()+`
`:as==="Action"?ns+=`
`+cs.trim()+`
`:ns+=cs.trim()+`
`}),ns}catch(ts){return console.error("Error parsing FDX:",ts),es}}function normalizeTimeOfDayForScene(es){const ts=(es||"DAY").toUpperCase();return ts==="NIGHT"||ts==="NIGHTMARE"?"NIGHT":ts==="MORNING"||ts==="DAWN"||ts==="SUNRISE"?"MORNING":ts==="EVENING"||ts==="DUSK"||ts==="SUNSET"||ts==="MAGIC HOUR"||ts==="GOLDEN HOUR"?"EVENING":ts==="CONTINUOUS"||ts==="CONT"||ts==="LATER"||ts==="SAME"||ts==="SAME TIME"||ts==="MOMENTS LATER"||ts==="SIMULTANEOUS"?"CONTINUOUS":"DAY"}function normalizeCharacterName(es){let ts=es.toUpperCase();if(ts=ts.replace(/\s*\(.*?\)\s*/g,""),ts.includes("/")&&!ts.startsWith("INT")&&!ts.startsWith("EXT")){const ss=ts.split("/");ss[0].length>=2&&ss[0].length<=20&&(ts=ss[0].trim())}return ts.replace(/\s+/g," ").trim()}function extractCharactersFromActionLine(es){const ts=[],ss=es.trim();if(ss.length<5||/^(INT\.|EXT\.|INT\/EXT|CUT TO|FADE|DISSOLVE|CONTINUED)/i.test(ss))return ts;const rs=new Set(["INT","EXT","ROAD","STREET","AVENUE","HIGHWAY","PATH","TRAIL","LANE","DAY","NIGHT","MORNING","EVENING","CONTINUOUS","LATER","SAME","CONT","DAWN","DUSK","CONTINUED","CUT","FADE","DISSOLVE","SMASH","MATCH","WIPE","THE","AND","BUT","FOR","NOT","YOU","ALL","CAN","HER","HIS","HIM","SHE","HAS","HAD","WAS","ARE","BEEN","HAVE","THEIR","WHAT","WHEN","WHERE","WHICH","WHO","THIS","THAT","WITH","FROM","INTO","ONTO","UPON","BACK","OVER","UNDER","VERY","MUCH","MORE","MOST","JUST","ONLY","ALSO","EVEN","STILL","WELL","SUCH","SOME","MANY","BOTH","EACH","OTHER","CLOSE","WIDE","ANGLE","VIEW","SHOT","POV","INSERT","FLASHBACK","DREAM","TITLE","SUPER","CHYRON","SUBTITLE","TV","DVD","VHS","USA","NYC","NYPD","FBI","CIA","NSA","TAXI","STAND","CAR","DOOR","ROOM","HOUSE","BOAT","PHONE","GUN","KNIFE","TABLE","CHAIR","PARKA","WHEELCHAIR","VEHICLE","WINDOW","WALL","FLOOR","CEILING","BED","DESK","LAMP","MOUNTAINS","MOUNTAIN","HILLS","HILLSIDES","VALLEY","RIVER","RIVERS","STREAM","STREAMS","LAKE","OCEAN","SEA","BEACH","FOREST","WOODS","TREE","TREES","SKY","SUN","MOON","CLOUDS","RAIN","SNOW","WIND","WATER","MELTWATER","WILDFLOWER","FLOWERS","GRASS","EDENIC","VERDANT","LONELY","QUIET","LOUD","DARK","BRIGHT","SMALL","LARGE","BIG","TALL","SHORT","LONG","WIDE","NARROW","THICK","THIN","HEAVY","LIGHT","HARD","SOFT","HOT","COLD","WARM","COOL","WET","DRY","CLEAN","DIRTY","NEW","OLD","FRESH","STALE","GOOD","BAD","GREAT","POOR","RICH","SIMPLE","COMPLEX","EASY","DIFFICULT","FAST","SLOW","HIGH","LOW","NEAR","FAR","CLOSE","DISTANT","OPEN","CLOSED","EMPTY","FULL","BEAUTIFUL","GORGEOUS","STUNNING","SERENE","PEACEFUL","CALM","WILD","FIERCE","RED","BLUE","GREEN","YELLOW","ORANGE","PURPLE","PINK","BLACK","WHITE","GREY","GRAY","BROWN","GOLDEN","SILVER","ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN","FIRST","SECOND","THIRD","LAST","NEXT","ANOTHER","FEW","SEVERAL"]),ns=/^[A-Z]+(ING|ED|LY|TION|SION|NESS|MENT|ABLE|IBLE|ICAL|IOUS|EOUS|ULAR|TERN|ERN|WARD|WARDS|LIKE|LESS|FUL|IC|AL|ARY|ORY|IVE|OUS|ANT|ENT)$/,os=/^(INT|EXT)\s*[.\/]/,as=/\b([A-Z][A-Z.'-]+(?:\s+[A-Z][A-Z.'-]+){0,2})\b/g;let ls;for(;(ls=as.exec(ss))!==null;){const us=ls[1].trim();if(os.test(us)||us.split(/\s+/).length===1&&rs.has(us)||rs.has(us)||ns.test(us))continue;const ds=us.split(/\s+/);if(ds.some(xs=>ns.test(xs)||rs.has(xs))||/\b(TAXI|CAR|DOOR|ROOM|HOUSE|BOAT|PHONE|GUN|KNIFE|TABLE|CHAIR|STAND|PARKA|WHEELCHAIR|VEHICLE|ROAD|STREET|MOUNTAIN|RIVER|TREE)\b/i.test(us))continue;const hs=/\b(MAN|WOMAN|PERSON|DRIVER|OFFICER|DOCTOR|NURSE|GUARD|SOLDIER|WORKER|GIRL|BOY|LADY|GUY|KID|CHILD|TEEN|TEENAGER|CLERK|WAITER|WAITRESS|COP|DETECTIVE|AGENT|STRANGER|FIGURE)\b/i;if(ds.length>=2&&hs.test(us)){ts.push(us);continue}if(ds.length===1&&us.length>=3&&us.length<=15){const xs=ss.slice(ls.index+us.length),ys=/^\s*(enters|exits|walks|runs|stands|sits|looks|turns|moves|says|speaks|watches|stares|smiles|nods|shakes|reaches|grabs|holds|opens|closes|steps|crosses|approaches|leaves|arrives|appears|disappears|rises|falls|jumps|climbs|crawls|lies|kneels|bends|leans|waves|points|gestures|signals|calls|shouts|whispers|laughs|cries|sighs|groans|screams|freezes|pauses|stops|starts|continues|begins|finishes|waits|hesitates)/i.test(xs),vs=/^('s\s|'s$)/i.test(xs),gs=/^\s+and\s+[A-Z][a-z]/i.test(xs);(ys||vs||gs)&&ts.push(us)}}const cs=/(?:^|[,;]\s*|\.\s+)([A-Z][a-z]+(?:\s+(?:and|&)\s+[A-Z][a-z]+)*)\s+(and\s+)?(?=enters|exits|walks|runs|stands|sits|looks|turns|moves|says|speaks|watches|stares|smiles|nods|shakes|reaches|grabs|holds|opens|closes|steps|crosses|approaches|leaves|arrives|appears|disappears|rises|falls|jumps|climbs|crawls|lies|kneels|bends|leans|waves|points|gestures|signals|calls|shouts|whispers|laughs|cries|sighs|groans|screams|freezes|pauses|stops|starts|continues|begins|finishes|waits|hesitates|[a-z])/gi;for(;(ls=cs.exec(ss))!==null;){const us=ls[1].split(/\s+(?:and|&)\s+/i);for(const ds of us){const ms=ds.trim().toUpperCase();ms.length>=3&&ms.length<=20&&!rs.has(ms)&&!ns.test(ms)&&!["THE","AND","BUT","FOR","NOT","THIS","THAT","WHEN","WHERE","WHILE","THEN","THERE","HERE"].includes(ms)&&ts.push(ms)}}return[...new Set(ts)]}function isCharacterCue(es){const ts=es.trim();if(ts!==ts.toUpperCase()||ts.length>50)return!1;const ss=[/^(INT\.|EXT\.|INT\/EXT|EXT\/INT|I\/E\.)/i,/^(CUT TO|FADE|DISSOLVE|SMASH|MATCH|WIPE)/i,/^(THE END|CONTINUED|MORE|\(MORE\))/i,/^\d+\s*$/,/^\s*$/,/^(TITLE:|SUPER:|CHYRON:|CARD:|INSERT:|INTERCUT)/i,/^(FLASHBACK|END FLASHBACK|FLASH BACK|DREAM SEQUENCE)/i,/^(BACK TO|RESUME|ANGLE ON|CLOSE ON|WIDE ON|POV)/i,/^(LATER|CONTINUOUS|MOMENTS LATER|SAME TIME)/i,/^(SUPERIMPOSE|SUBTITLE|CAPTION)/i];for(const as of ss)if(as.test(ts))return!1;if(!/[A-Z]/.test(ts))return!1;const rs=[/^(A |AN |THE |HE |SHE |THEY |WE |IT |HIS |HER |THEIR )/,/^(IN THE |AT THE |ON THE |FROM THE |TO THE |INTO THE )/,/^(ARRIVING|ENTERING|LEAVING|WALKING|RUNNING|STANDING|SITTING)/,/ (ENTERS|EXITS|WALKS|RUNS|STANDS|SITS|LOOKS|TURNS|MOVES)$/,/ (IS |ARE |WAS |WERE |HAS |HAVE |THE |A |AN )/,/^[A-Z]+ [A-Z]+ [A-Z]+ [A-Z]+ [A-Z]+/,/\.$/,/^\d+[A-Z]?\s+/];for(const as of rs)if(as.test(ts))return!1;const ns=ts.replace(/\s*\(.*?\)\s*/g,"").trim(),os=ns.split(/\s+/).length;return os>4||os===1&&(/^[A-Z]+(ING|ED|LY|TION|SION|NESS|MENT|ABLE|IBLE|ICAL|IOUS|EOUS|ULAR|TERN|ERN|WARD|WARDS|LIKE|LESS|FUL|IC|AL|ARY|ORY|IVE|OUS|ANT|ENT)$/.test(ns)||new Set(["INT","EXT","ROAD","STREET","HOUSE","ROOM","OFFICE","BUILDING","DAY","NIGHT","MORNING","EVENING","DAWN","DUSK","LATER","CONTINUOUS","EDENIC","VERDANT","TOWERING","LONELY","BEAUTIFUL","GORGEOUS","STUNNING","SERENE","PEACEFUL","WILD","FIERCE","ANCIENT","MODERN","RUSTIC","MOUNTAINS","MOUNTAIN","HILLS","VALLEY","RIVER","STREAM","LAKE","OCEAN","FOREST","WOODS","TREE","TREES","SKY","SUN","MOON","MELTWATER","RED","BLUE","GREEN","YELLOW","ORANGE","PURPLE","BLACK","WHITE","GOLDEN","VERY","MUCH","MORE","MOST","JUST","ONLY","ALSO","EVEN","STILL","WELL","ONE","TWO","THREE","FIRST","SECOND","THIRD","LAST","NEXT","ANOTHER","CONTINUED","FADE","CUT","DISSOLVE","ANGLE","SHOT","VIEW","CLOSE","WIDE"]).has(ns))?!1:ns.length>=2&&ns.length<=35}function parseSceneHeadingLine(es){const ts=es.trim(),ss={sceneNumber:null,intExt:"INT",location:"",timeOfDay:"DAY",rawSlugline:ts,isValid:!1};if(!ts||ts.length<5)return ss;let rs=ts.replace(/\s*\*+\s*$/,"").trim();const ns=/^(\d+[A-Z]?)\s+/i,os=/\s+(\d+[A-Z]?)\s*$/i;let as=null,ls=rs;const cs=ls.match(ns);cs&&(as=cs[1].toUpperCase(),ls=ls.slice(cs[0].length).trim());const us=ls.match(os);if(us){const fs=us[1].toUpperCase();as||(as=fs),ls=ls.slice(0,-us[0].length).trim()}const ds=/^(INT\.?\/EXT\.?|EXT\.?\/INT\.?|I\/E\.?|INT\.?|EXT\.?)\s*/i,ms=ls.match(ds);if(!ms)return ss;const hs=ms[1].toUpperCase().replace(/\.$/,"").startsWith("EXT")?"EXT":"INT";ls=ls.slice(ms[0].length).trim(),ls=ls.replace(/^[\.\-]\s*/,"").trim();const xs=/(?:\s*[-\.]+\s*|\s+)(DAY|NIGHT|MORNING|EVENING|AFTERNOON|DAWN|DUSK|SUNSET|SUNRISE|CONTINUOUS|CONT|LATER|SAME|SAME TIME|MOMENTS LATER|SIMULTANEOUS|MAGIC HOUR|GOLDEN HOUR|FLASHBACK|PRESENT|DREAM|FANTASY|NIGHTMARE|ESTABLISHING)(?:\s*[-]?\s*(?:FLASHBACK|PRESENT|CONT(?:'D)?)?)?$/i;let ys="DAY",vs=ls;const gs=ls.match(xs);return gs&&(ys=gs[1].toUpperCase(),ys==="CONT"&&(ys="CONTINUOUS"),vs=ls.slice(0,gs.index).trim(),vs=vs.replace(/[\s\-\.,]+$/,"").trim()),!gs&&ls.length>0&&(vs=ls.replace(/[\s\-\.,]+$/,"").trim()),!vs||vs.length<2?ss:{sceneNumber:as,intExt:hs,location:vs,timeOfDay:ys,rawSlugline:ts,isValid:!0}}function convertParsedScriptToProject(es,ts){const ss=new Map,rs=ts.map((os,as)=>{const ls=`char-${v4().slice(0,8)}`;ss.set(os,ls);const cs=os.split(" ").map(ms=>ms[0]).join("").slice(0,2),us=["#C9A961","#8B5CF6","#EC4899","#10B981","#F59E0B","#EF4444","#3B82F6","#6366F1"],ds=us[as%us.length];return{id:ls,name:os,initials:cs,avatarColour:ds}});return{scenes:es.scenes.map(os=>{const as=os.characters.filter(ls=>ss.has(ls)).map(ls=>ss.get(ls));return{id:`scene-${os.sceneNumber}`,sceneNumber:os.sceneNumber,slugline:`${os.intExt}. ${os.location} - ${os.timeOfDay}`,intExt:os.intExt,timeOfDay:os.timeOfDay,synopsis:os.synopsis,scriptContent:os.content,characters:as,isComplete:!1}}),characters:rs}}async function parseScenesFast(es){const ts=es.name.toLowerCase();let ss;if(ts.endsWith(".pdf"))ss=await extractTextFromPDF(es);else if(ts.endsWith(".fdx")){const ds=await es.text();ss=extractTextFromFDX(ds)}else ss=await es.text();const rs=ss.split(`
`),ns=[];let os=null,as=0,ls="";for(let ds=0;ds<rs.length;ds++){const ms=rs[ds],ps=ms.trim(),hs=parseSceneHeadingLine(ps);if(hs.isValid){os&&(os.scriptContent=ls.trim(),ns.push(os)),as++;const xs=hs.sceneNumber||String(as),ys=normalizeTimeOfDayForScene(hs.timeOfDay);os={sceneNumber:xs,slugline:ps,intExt:hs.intExt,location:hs.location,timeOfDay:ys,scriptContent:""},ls=ps+`
`;continue}os&&(ls+=ms+`
`)}os&&(os.scriptContent=ls.trim(),ns.push(os));const cs=ss.slice(0,1e3).match(/^(?:title[:\s]*)?([A-Z][A-Z\s\d\-\'\"]+)(?:\n|by)/im);return{title:cs?cs[1].trim():"Untitled Script",scenes:ns,rawText:ss}}async function detectCharactersForScene(es,ts,ss){const rs=(ss==null?void 0:ss.knownCharacters)??[],ns=[],os=new Set;if(rs.length>0){const cs=es.toUpperCase();for(const us of rs){const ds=normalizeCharacterName(us);if(ds.length<2)continue;new RegExp(`\\b${escapeRegExp(ds)}\\b`,"i").test(cs)&&!os.has(ds)&&(os.add(ds),ns.push(ds))}}const as=es.split(`
`);let ls=!1;for(let cs=0;cs<as.length;cs++){const ds=as[cs].trim();if(isCharacterCue(ds)){const ms=normalizeCharacterName(ds);ms.length>=2&&!os.has(ms)&&(os.add(ms),ns.push(ms)),ls=!0}else if(!(ls&&ds.length>0)){if(ls=!1,ds.length>10&&rs.length===0){const ms=extractCharactersFromActionLine(ds);for(const ps of ms){const hs=normalizeCharacterName(ps);hs.length>=2&&!os.has(hs)&&(os.add(hs),ns.push(hs))}}}}return ns}function escapeRegExp(es){return es.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async function detectCharactersForScenesBatch(es,ts,ss){var ls;const rs=new Map,ns=es.length;let os=0;const as=5;for(let cs=0;cs<es.length;cs+=as){const us=es.slice(cs,cs+as),ds=await Promise.all(us.map(async ms=>{const ps=await detectCharactersForScene(ms.scriptContent,ts,{knownCharacters:ss==null?void 0:ss.knownCharacters});return{sceneNumber:ms.sceneNumber,characters:ps}}));for(const ms of ds)rs.set(ms.sceneNumber,ms.characters),os++,(ls=ss==null?void 0:ss.onProgress)==null||ls.call(ss,os,ns)}return rs}function ScheduleAmendmentModal({amendmentResult:es,getCastNamesForNumbers:ts,onApply:ss,onCancel:rs}){const[ns,os]=reactExports.useState(!0),[as,ls]=reactExports.useState(!0),[cs,us]=reactExports.useState(!0),[ds,ms]=reactExports.useState(!0),[ps,hs]=reactExports.useState(!0),[xs,ys]=reactExports.useState(null),{addedScenes:vs,removedScenes:gs,movedScenes:fs,castChanges:js,timingChanges:Ss,addedDays:bs,removedDays:Es,summary:Rs,hasChanges:ws}=es,Ns=()=>{ss({includeAddedScenes:ns,includeRemovedScenes:as,includeMovedScenes:cs,includeCastChanges:ds,includeTimingChanges:ps})},ks=ns||as||cs||ds||ps,_s=zs=>{switch(zs){case"scene_added":case"day_added":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})});case"scene_removed":case"day_removed":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})});case"scene_moved":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})});case"cast_changed":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})})});case"timing_changed":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})});default:return null}},Ls=zs=>jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2 py-2",children:[_s(zs.changeType),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-text-primary",children:["Sc ",zs.sceneNumber]}),zs.newEntry&&jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted truncate",children:zs.newEntry.setLocation})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-muted mt-0.5",children:zs.description}),zs.changeType==="cast_changed"&&jsxRuntimeExports.jsxs("div",{className:"mt-1 space-y-0.5",children:[zs.castAdded&&zs.castAdded.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:ts(zs.castAdded).map((qs,Qs)=>jsxRuntimeExports.jsxs("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded",children:["+ ",qs]},Qs))}),zs.castRemoved&&zs.castRemoved.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:ts(zs.castRemoved).map((qs,Qs)=>jsxRuntimeExports.jsxs("span",{className:"text-[10px] bg-red-100 text-red-700 px-1.5 py-0.5 rounded",children:["- ",qs]},Qs))})]})]})]},`${zs.sceneNumber}-${zs.changeType}`),Os=(zs,qs,Qs,Ys,Ws,Is,Bs="Include")=>{if(Qs.length===0)return null;const Vs=xs===qs,Ds={green:{heading:"text-green-700",border:"border-green-200",bg:"bg-green-50"},red:{heading:"text-red-700",border:"border-red-200",bg:"bg-red-50"},blue:{heading:"text-blue-700",border:"border-blue-200",bg:"bg-blue-50"},purple:{heading:"text-purple-700",border:"border-purple-200",bg:"bg-purple-50"},amber:{heading:"text-amber-700",border:"border-amber-200",bg:"bg-amber-50"}},Cs=Ds[Ys]||Ds.amber;return jsxRuntimeExports.jsxs("div",{className:clsx("border rounded-lg overflow-hidden",Cs.border),children:[jsxRuntimeExports.jsx("div",{className:clsx("px-3 py-2",Cs.bg),children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>ys(Vs?null:qs),className:"flex items-center gap-2 flex-1 text-left",children:[jsxRuntimeExports.jsxs("h4",{className:clsx("text-xs font-bold tracking-wider uppercase",Cs.heading),children:[zs," (",Qs.length,")"]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-3.5 h-3.5 text-text-muted transition-transform",Vs&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:Ws,onChange:Ts=>Is(Ts.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:Bs})]})]})}),Vs&&jsxRuntimeExports.jsx("div",{className:"px-3 divide-y divide-border/30",children:Qs.map(Ls)})]})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[90vh] flex flex-col safe-bottom",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Schedule Changes Detected"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:Rs})]}),jsxRuntimeExports.jsx("button",{onClick:rs,className:"p-2 -mr-2 text-text-muted active:text-gold",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:ws?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-700",children:"Select which changes to apply. Unchecked changes will be ignored and your current data will be preserved."})}),(bs.length>0||Es.length>0)&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[bs.length>0&&jsxRuntimeExports.jsx("div",{className:"flex-1 p-2 bg-green-50 border border-green-200 rounded-lg",children:jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-green-700",children:["+",bs.length," day",bs.length>1?"s":""]})}),Es.length>0&&jsxRuntimeExports.jsx("div",{className:"flex-1 p-2 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-red-700",children:["-",Es.length," day",Es.length>1?"s":""]})})]}),Os("Scenes Added","added",vs,"green",ns,os),Os("Scenes Removed","removed",gs,"red",as,ls,"Remove"),Os("Scenes Moved","moved",fs,"blue",cs,us),Os("Cast Changes","cast",js,"purple",ds,ms),Os("Timing Changes","timing",Ss,"amber",ps,hs)]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsx("p",{className:"text-text-primary font-medium",children:"No Changes Detected"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-1",children:"The new schedule appears identical to your current one."})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-t border-border shrink-0 space-y-2",children:ws?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:Ns,disabled:!ks,className:"w-full py-3 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50",children:"Apply Selected Changes"}),jsxRuntimeExports.jsx("button",{onClick:rs,className:"w-full py-2 text-sm text-text-muted",children:"Cancel - Keep Current Schedule"})]}):jsxRuntimeExports.jsx("button",{onClick:rs,className:"w-full py-3 rounded-button bg-gray-100 text-text-primary font-semibold text-base active:scale-[0.98] transition-transform",children:"Close"})})]})})}const getSystemTheme=()=>typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",resolveTheme=es=>es==="system"?getSystemTheme():es,applyTheme=es=>{if(typeof document<"u"){const ts=document.documentElement;ts.classList.remove("light","dark"),ts.classList.add(es);const ss=document.querySelector('meta[name="theme-color"]');ss&&ss.setAttribute("content",es==="dark"?"#000000":"#f5f4f2")}},useThemeStore=create()(persist(es=>({theme:"light",resolvedTheme:"light",setTheme:ts=>{const ss=resolveTheme(ts);applyTheme(ss),es({theme:ts,resolvedTheme:ss})}}),{name:"hair-makeup-theme-storage",storage:createJSONStorage(()=>localStorage),onRehydrateStorage:()=>es=>{if(es){const ts=resolveTheme(es.theme);applyTheme(ts),es.resolvedTheme=ts}}}));typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",es=>{if(useThemeStore.getState().theme==="system"){const ss=es.matches?"dark":"light";applyTheme(ss),useThemeStore.setState({resolvedTheme:ss})}});function UserProfileScreen({onBack:es,onNavigateToBilling:ts}){const{user:ss,signOut:rs}=useAuthStore(),{theme:ns,setTheme:os}=useThemeStore(),[as,ls]=reactExports.useState(!1),[cs,us]=reactExports.useState((ss==null?void 0:ss.name)||""),[ds,ms]=reactExports.useState(!1),[ps,hs]=reactExports.useState(null),[xs,ys]=reactExports.useState(!1),vs=[{value:"light",label:"Light",icon:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})},{value:"dark",label:"Dark",icon:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})},{value:"system",label:"System",icon:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}],gs=()=>{if(!(ss!=null&&ss.name))return"U";const Es=ss.name.split(" ");return Es.length>=2?`${Es[0][0]}${Es[1][0]}`.toUpperCase():ss.name.substring(0,2).toUpperCase()},fs=()=>"Beta Tester",js=async()=>{if(!cs.trim()||!ss){hs({type:"error",text:"Name cannot be empty"});return}ms(!0);try{const{error:Es}=await updateUserProfile(ss.id,{name:cs.trim()});if(Es)throw Es;useAuthStore.setState({user:{...ss,name:cs.trim()}}),ls(!1),hs({type:"success",text:"Profile updated successfully"})}catch{hs({type:"error",text:"Failed to update profile"})}finally{ms(!1)}},Ss=async()=>{if(!(ss!=null&&ss.email)){hs({type:"error",text:"No email address found"});return}ys(!0);try{const{error:Es}=await supabase.auth.resetPasswordForEmail(ss.email,{redirectTo:`${window.location.origin}/reset-password`});if(Es)throw Es;hs({type:"success",text:"Password reset email sent! Check your inbox."})}catch{hs({type:"error",text:"Failed to send password reset email"})}finally{ys(!1)}},bs=()=>{rs()};return ps&&setTimeout(()=>hs(null),4e3),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:es,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"My Account"})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:[ps&&jsxRuntimeExports.jsx("div",{className:`mb-4 px-4 py-2 rounded-lg text-sm ${ps.type==="success"?"bg-green-50 border border-green-200 text-green-700":"bg-red-50 border border-red-200 text-red-700"}`,children:ps.text}),jsxRuntimeExports.jsx("section",{className:"mb-6",children:jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-border mb-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gold-100 flex items-center justify-center text-gold text-xl font-bold",children:gs()}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[as?jsxRuntimeExports.jsx("input",{type:"text",value:cs,onChange:Es=>us(Es.target.value),className:"input-field w-full text-lg font-bold",autoFocus:!0}):jsxRuntimeExports.jsx("h2",{className:"text-lg font-bold text-text-primary truncate",children:(ss==null?void 0:ss.name)||"User"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted truncate",children:(ss==null?void 0:ss.email)||""}),jsxRuntimeExports.jsx("div",{className:"inline-flex items-center gap-1 mt-1 px-2 py-0.5 bg-gold-50 rounded-full",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-gold",children:fs()})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:as?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>{ls(!1),us((ss==null?void 0:ss.name)||"")},className:"flex-1 py-2 px-4 rounded-button border border-border text-text-muted text-sm font-medium active:scale-98 transition-transform",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:js,disabled:ds,className:"flex-1 py-2 px-4 rounded-button gold-gradient text-white text-sm font-medium active:scale-98 transition-transform disabled:opacity-50",children:ds?"Saving...":"Save"})]}):jsxRuntimeExports.jsx("button",{onClick:()=>ls(!0),className:"flex-1 py-2 px-4 rounded-button border border-border text-text-primary text-sm font-medium active:scale-98 transition-transform",children:"Edit Profile"})})]})}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"ACCOUNT SETTINGS"}),jsxRuntimeExports.jsxs("div",{className:"card divide-y divide-border",children:[jsxRuntimeExports.jsxs("button",{onClick:Ss,disabled:xs,className:"w-full flex items-center gap-4 px-4 py-3 active:bg-gray-50 transition-colors disabled:opacity-50",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:xs?"Sending...":"Reset Password"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Send password reset email"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsxs("button",{onClick:ts,className:"w-full flex items-center gap-4 px-4 py-3 active:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Billing & Bank Details"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"For timesheets and invoices"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"BETA ACCESS"}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-gold-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.745 3.745 0 011.043 3.296A3.745 3.745 0 0121 12z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Full Access Enabled"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Thank you for beta testing!"})]})]})})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"APPEARANCE"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Theme"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted capitalize",children:ns})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-3 gap-2",children:vs.map(Es=>jsxRuntimeExports.jsxs("button",{onClick:()=>os(Es.value),className:`flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all ${ns===Es.value?"border-gold bg-gold/10 text-gold":"border-border text-text-muted hover:border-gold/50"}`,children:[Es.icon,jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:Es.label})]},Es.value))})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"SESSION"}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsxs("button",{onClick:bs,className:"w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-red-50 active:bg-red-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-50 flex items-center justify-center text-red-500",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-red-500",children:"Sign Out"})]})})]}),jsxRuntimeExports.jsx("div",{className:"text-center text-xs text-text-muted py-4",children:jsxRuntimeExports.jsx("p",{children:"Checks Happy v1.0.0"})})]})]})}function More({onNavigateToTab:es,onStartNewProject:ts,initialView:ss,resetKey:rs,subView:ns}){const os=()=>ns||(ss&&["script","schedule","callsheets"].includes(ss)?ss:"menu"),[as,ls]=reactExports.useState(os),{isEditMenuOpen:cs,closeEditMenu:us,openEditMenu:ds}=useNavigationStore(),{projectMemberships:ms,user:ps}=useAuthStore(),{projectSettings:hs,clearState:xs}=useProjectSettingsStore(),ys=ms.length>0?ms[0]:null,vs=(ys==null?void 0:ys.role)==="owner",gs=ys&&ps?canManageProject(ps.tier,{isOwner:vs,role:vs?"designer":ys.role==="supervisor"?"supervisor":"trainee"}):!1;reactExports.useEffect(()=>{ns?ls(ns):ss&&["script","schedule","callsheets"].includes(ss)?ls(ss):ss==="more"&&ls("menu")},[ss,rs,ns]);const fs=cs?"editMenu":as,js=Rs=>{Rs==="editMenu"?ds():ls(Rs)},Ss=()=>{us(),ls("menu")},bs=()=>{ss&&["script","schedule","callsheets"].includes(ss)?es==null||es("today"):ls("menu")},Es=()=>{switch(fs){case"script":return jsxRuntimeExports.jsx(ScriptViewer,{onBack:bs});case"schedule":return jsxRuntimeExports.jsx(ScheduleViewer,{onBack:bs});case"callsheets":return jsxRuntimeExports.jsx(CallSheetArchive,{onBack:bs});case"editMenu":return jsxRuntimeExports.jsx(EditMenuScreen,{onDone:Ss});case"export":return jsxRuntimeExports.jsx(ProjectExportScreen,{onBack:()=>ls("projectSettings"),onExportComplete:()=>ls("projectSettings"),onNavigateToBilling:()=>ls("billing")});case"archivedProjects":return jsxRuntimeExports.jsx(ArchivedProjectsScreen,{onBack:()=>ls("menu")});case"projectSettings":return jsxRuntimeExports.jsx(ProjectSettingsScreen,{projectId:(ys==null?void 0:ys.projectId)||"",onBack:()=>ls("menu"),onNavigateToTeam:()=>ls("team"),onNavigateToStats:()=>ls("projectStats"),onNavigateToExport:()=>ls("export"),onProjectArchived:()=>{xs(),ls("menu")},onProjectDeleted:()=>{xs(),ts==null||ts()}});case"team":return jsxRuntimeExports.jsx(TeamScreen,{projectId:(ys==null?void 0:ys.projectId)||"",canManage:gs,isOwner:vs,onBack:()=>ls("projectSettings"),onInvite:()=>ls("invite")});case"invite":return jsxRuntimeExports.jsx(InviteScreen,{inviteCode:(hs==null?void 0:hs.inviteCode)||(ys==null?void 0:ys.projectCode)||"",isOwner:vs,onBack:()=>ls("team")});case"projectStats":return jsxRuntimeExports.jsx(ProjectStatsScreen,{projectId:(ys==null?void 0:ys.projectId)||"",onBack:()=>ls("projectSettings")});case"manualSchedule":return jsxRuntimeExports.jsx(ScheduleScreen,{onBack:()=>ls("projectSettings"),onSaved:()=>ls("projectSettings")});case"billing":return jsxRuntimeExports.jsx(BillingDetailsScreen,{onBack:()=>ls("menu"),onUpgrade:()=>{useAuthStore.getState().setScreen("select-plan")}});case"userProfile":return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:()=>ls("menu"),onNavigateToBilling:()=>ls("billing")});default:return jsxRuntimeExports.jsx(MoreMenu,{onNavigate:js,onNavigateToTab:es,canManage:gs})}};return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background pb-safe-bottom",children:Es()})}function MoreMenu({onNavigate:es,onNavigateToTab:ts,canManage:ss}){const{getMoreMenuItems:rs}=useNavigationStore(),os=rs().map(us=>ALL_NAV_ITEMS.find(ds=>ds.id===us)).filter(Boolean),as=us=>{switch(us){case"lookbook":return"Character looks and styles";case"script":return"View script PDF with scene search";case"schedule":return"Shooting schedule day-by-day";case"callsheets":return"Upload and manage call sheets";case"today":return"Today's shooting schedule";case"breakdown":return"Scene breakdown by character";case"hours":return"Timesheet and earnings";case"budget":return"Expenses overview, scan receipts";default:return""}},ls=us=>{["script","schedule","callsheets"].includes(us)?es(us):ts&&ts(us)},cs=os.filter(us=>us.id!=="settings");return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"h-14 px-4 flex items-center",children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"More"})})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[cs.map(us=>jsxRuntimeExports.jsxs("button",{onClick:()=>ls(us.id),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold-100/50 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(NavIcon,{name:us.iconName,className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:us.label}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:as(us.id)})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},us.id)),ss&&jsxRuntimeExports.jsxs("button",{onClick:()=>es("projectSettings"),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold-100/50 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(NavIcon,{name:"cog",className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Settings"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Project settings and management"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}),jsxRuntimeExports.jsx("div",{className:"pt-4 border-t border-border mt-4",children:jsxRuntimeExports.jsxs("button",{onClick:()=>es("editMenu"),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Edit Menu"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Customize bottom navigation"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})})]})})]})}function EditMenuScreen({onDone:es}){var Ws,Is;const{bottomNavItems:ts,setBottomNavItems:ss,moveToBottomNav:rs,moveToMoreMenu:ns}=useNavigationStore(),[os,as]=reactExports.useState(null),[ls,cs]=reactExports.useState(null),[us,ds]=reactExports.useState(null),[ms,ps]=reactExports.useState(!1),[hs,xs]=reactExports.useState(null),ys=reactExports.useRef(null),vs=reactExports.useRef(null),gs=reactExports.useRef(new Map),fs=reactExports.useRef(null),js=reactExports.useRef(null),Ss=ALL_NAV_ITEMS.filter(Bs=>!ts.includes(Bs.id)),bs=ts.map(Bs=>ALL_NAV_ITEMS.find(Vs=>Vs.id===Bs)).filter(Boolean),Es=reactExports.useCallback(Bs=>{as(Bs)},[]),Rs=reactExports.useCallback(()=>{os&&ls!==null&&us&&(us==="bottom"?rs(os,ls):us==="more"&&ns(os)),as(null),cs(null),ds(null),ps(!1),xs(null)},[os,ls,us,rs,ns]),ws=reactExports.useCallback((Bs,Vs)=>{ds(Bs),cs(Vs)},[]),Ns=reactExports.useCallback(Bs=>{const Vs=fs.current,Ds=js.current;if(Vs){const Cs=Vs.getBoundingClientRect();if(Bs>=Cs.top&&Bs<=Cs.bottom){let Ts=bs.length;for(let $s=0;$s<bs.length;$s++){const Ps=gs.current.get(`bottom-${bs[$s].id}`);if(Ps){const Fs=Ps.getBoundingClientRect(),Us=Fs.top+Fs.height/2;if(Bs<Us){Ts=$s;break}}}ds("bottom"),cs(Ts);return}}if(Ds){const Cs=Ds.getBoundingClientRect();if(Bs>=Cs.top&&Bs<=Cs.bottom){ds("more"),cs(0);return}}ds(null),cs(null)},[bs]),ks=reactExports.useCallback((Bs,Vs)=>{const Ds=Bs.touches[0];ys.current={x:Ds.clientX,y:Ds.clientY,item:Vs},vs.current=setTimeout(()=>{as(Vs),ps(!0),xs({x:Ds.clientX,y:Ds.clientY}),"vibrate"in navigator&&navigator.vibrate(50)},200)},[]),_s=reactExports.useCallback(Bs=>{const Vs=Bs.touches[0];if(!ys.current)return;const Ds=Math.abs(Vs.clientX-ys.current.x),Cs=Math.abs(Vs.clientY-ys.current.y);if(!ms&&(Ds>10||Cs>10)&&vs.current){clearTimeout(vs.current),vs.current=null;return}ms&&(Bs.preventDefault(),xs({x:Vs.clientX,y:Vs.clientY}),Ns(Vs.clientY))},[ms,Ns]),Ls=reactExports.useCallback(()=>{vs.current&&(clearTimeout(vs.current),vs.current=null),ys.current=null,ms&&Rs()},[ms,Rs]),Os=reactExports.useCallback(()=>{vs.current&&(clearTimeout(vs.current),vs.current=null),ys.current=null,as(null),cs(null),ds(null),ps(!1),xs(null)},[]),zs=reactExports.useCallback(Bs=>{Bs.preventDefault(),Bs.stopPropagation();const Vs=Bs.touches[0];xs({x:Vs.clientX,y:Vs.clientY}),Ns(Vs.clientY)},[Ns]),qs=reactExports.useCallback(Bs=>{Bs.preventDefault(),Ls()},[Ls]),Qs=(Bs,Vs)=>{const Ds=[...ts],[Cs]=Ds.splice(Bs,1);Ds.splice(Vs,0,Cs),ss(Ds)},Ys=reactExports.useCallback((Bs,Vs)=>{Vs?gs.current.set(Bs,Vs):gs.current.delete(Bs)},[]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Customize Menu"}),jsxRuntimeExports.jsx("button",{onClick:es,className:"px-4 py-1.5 text-sm font-semibold text-gold active:opacity-70 transition-opacity",children:"Done"})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted mb-6",children:["Drag items to reorder. Up to ",MAX_BOTTOM_NAV_ITEMS," appear in bottom nav."]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",ref:fs,children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"BOTTOM NAV"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[bs.map((Bs,Vs)=>jsxRuntimeExports.jsx(DraggableItem,{item:Bs,index:Vs,section:"bottom",isDragging:os===Bs.id,isDragOver:us==="bottom"&&ls===Vs,onDragStart:()=>Es(Bs.id),onDragEnd:Rs,onDragOver:()=>ws("bottom",Vs),onTouchStart:Ds=>ks(Ds,Bs.id),onTouchMove:_s,onTouchEnd:Ls,onTouchCancel:Os,onMoveUp:Vs>0?()=>Qs(Vs,Vs-1):void 0,onMoveDown:Vs<bs.length-1?()=>Qs(Vs,Vs+1):void 0,onRemove:bs.length>1?()=>ns(Bs.id):void 0,refCallback:Ds=>Ys(`bottom-${Bs.id}`,Ds)},Bs.id)),ts.length<MAX_BOTTOM_NAV_ITEMS&&jsxRuntimeExports.jsx("div",{className:`border-2 border-dashed rounded-xl p-4 text-center transition-colors ${us==="bottom"&&ls===ts.length?"border-gold bg-gold/5":"border-border"}`,onDragOver:Bs=>{Bs.preventDefault(),ws("bottom",ts.length)},onDrop:Rs,children:jsxRuntimeExports.jsx("span",{className:"text-sm text-text-light",children:"Drop here to add"})})]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border mb-6"}),jsxRuntimeExports.jsxs("div",{ref:js,children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"MORE MENU"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[Ss.map((Bs,Vs)=>jsxRuntimeExports.jsx(DraggableItem,{item:Bs,index:Vs,section:"more",isDragging:os===Bs.id,isDragOver:us==="more"&&ls===Vs,onDragStart:()=>Es(Bs.id),onDragEnd:Rs,onDragOver:()=>ws("more",Vs),onTouchStart:Ds=>ks(Ds,Bs.id),onTouchMove:_s,onTouchEnd:Ls,onTouchCancel:Os,onAddToNav:ts.length<MAX_BOTTOM_NAV_ITEMS?()=>rs(Bs.id,ts.length):void 0,refCallback:Ds=>Ys(`more-${Bs.id}`,Ds)},Bs.id)),Ss.length===0&&jsxRuntimeExports.jsx("div",{className:"text-center py-6 text-text-light text-sm",children:"All items are in the bottom nav"})]})]}),ms&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-30",style:{touchAction:"none"},onTouchMove:zs,onTouchEnd:qs,onTouchCancel:Os}),ms&&hs&&os&&jsxRuntimeExports.jsxs("div",{className:"fixed z-50 pointer-events-none",style:{left:hs.x-100,top:hs.y-30},children:[jsxRuntimeExports.jsxs("div",{className:"bg-gold text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 opacity-90",children:[jsxRuntimeExports.jsx(NavIcon,{name:((Ws=ALL_NAV_ITEMS.find(Bs=>Bs.id===os))==null?void 0:Ws.iconName)||"ellipsis",className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:(Is=ALL_NAV_ITEMS.find(Bs=>Bs.id===os))==null?void 0:Is.label})]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-center mt-1 text-gold font-medium",children:us==="bottom"?"Drop in Bottom Nav":us==="more"?"Drop in More Menu":"Drag to reorder"})]}),jsxRuntimeExports.jsx("div",{className:"mt-6 p-3 bg-gray-50 rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[jsxRuntimeExports.jsx(NavIcon,{name:"ellipsis",className:"w-5 h-5"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"More"})," button is always last and cannot be moved."]})]})})]})]})}function DraggableItem({item:es,isDragging:ts,isDragOver:ss,onDragStart:rs,onDragEnd:ns,onDragOver:os,onTouchStart:as,onTouchMove:ls,onTouchEnd:cs,onTouchCancel:us,onMoveUp:ds,onMoveDown:ms,onRemove:ps,onAddToNav:hs,refCallback:xs}){return jsxRuntimeExports.jsxs("div",{ref:xs,className:`card flex items-center gap-3 transition-all cursor-grab active:cursor-grabbing select-none ${ts?"opacity-50 scale-95":""} ${ss?"ring-2 ring-gold ring-offset-2":""}`,draggable:!0,onDragStart:rs,onDragEnd:ns,onDragOver:ys=>{ys.preventDefault(),os()},onTouchStart:as,onTouchMove:ls,onTouchEnd:cs,onTouchCancel:us,children:[jsxRuntimeExports.jsx("div",{className:"text-text-light touch-none",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{d:"M8 6a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 18a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM14 6a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM14 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM14 18a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"})})}),jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-gold-100/50 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(NavIcon,{name:es.iconName,className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 text-sm font-medium text-text-primary",children:es.label}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[ds&&jsxRuntimeExports.jsx("button",{onClick:ys=>{ys.stopPropagation(),ds()},className:"p-1.5 rounded-lg hover:bg-gray-100 text-text-light",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),ms&&jsxRuntimeExports.jsx("button",{onClick:ys=>{ys.stopPropagation(),ms()},className:"p-1.5 rounded-lg hover:bg-gray-100 text-text-light",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),ps&&jsxRuntimeExports.jsx("button",{onClick:ys=>{ys.stopPropagation(),ps()},className:"p-1.5 rounded-lg hover:bg-red-50 text-text-light hover:text-error",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),hs&&jsxRuntimeExports.jsx("button",{onClick:ys=>{ys.stopPropagation(),hs()},className:"p-1.5 rounded-lg hover:bg-green-50 text-text-light hover:text-green-600",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]})]})}function ScriptViewer({onBack:es}){const[ts,ss]=reactExports.useState(""),[rs,ns]=reactExports.useState(null),[os,as]=reactExports.useState("full"),{currentProject:ls,compareScriptAmendment:cs,applyScriptAmendment:us}=useProjectStore(),ds=reactExports.useRef(new Map),ms=reactExports.useRef(null),[ps,hs]=reactExports.useState(!1),[xs,ys]=reactExports.useState(null),vs=async Es=>{var ws;const Rs=(ws=Es.target.files)==null?void 0:ws[0];if(Rs){hs(!0);try{const Ns=await parseScenesFast(Rs),ks=cs(Ns.scenes);ks&&ys(ks)}catch(Ns){console.error("Error processing revised script:",Ns),alert("Failed to process the script. Please try again.")}finally{hs(!1),ms.current&&(ms.current.value="")}}},gs=Es=>{xs&&(us(xs,Es),ys(null))},fs=reactExports.useMemo(()=>ls!=null&&ls.scenes?[...ls.scenes].sort((Es,Rs)=>Es.sceneNumber.localeCompare(Rs.sceneNumber,void 0,{numeric:!0})):[],[ls==null?void 0:ls.scenes]),js=fs.some(Es=>Es.scriptContent),Ss=reactExports.useMemo(()=>{if(!ts.trim())return fs;const Es=ts.toLowerCase();return fs.filter(Rs=>{var ws,Ns;return((ws=Rs.scriptContent)==null?void 0:ws.toLowerCase().includes(Es))||Rs.slugline.toLowerCase().includes(Es)||((Ns=Rs.synopsis)==null?void 0:Ns.toLowerCase().includes(Es))})},[fs,ts]);reactExports.useEffect(()=>{if(rs){const Es=ds.current.get(rs);Es&&Es.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>ns(null),500)}},[rs]);const bs=(Es,Rs)=>Rs.trim()?Es.split(new RegExp(`(${Rs.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi")).map((Ns,ks)=>Ns.toLowerCase()===Rs.toLowerCase()?jsxRuntimeExports.jsx("mark",{className:"bg-gold/30 text-text-primary px-0.5 rounded",children:Ns},ks):Ns):Es;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:es,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Script"}),js&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("span",{className:"ml-auto text-xs text-text-muted",children:[fs.length," scenes"]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var Es;return(Es=ms.current)==null?void 0:Es.click()},disabled:ps,className:"ml-2 px-2 py-1 text-[10px] font-medium text-gold border border-gold rounded-lg active:bg-gold/10 transition-colors disabled:opacity-50",children:ps?"Processing...":"Upload New Draft"}),jsxRuntimeExports.jsx("input",{ref:ms,type:"file",accept:".pdf,.fdx,.txt,.fountain",onChange:vs,className:"hidden"})]})]}),js&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"px-4 pb-3 flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>as("full"),className:`flex-1 py-1.5 text-xs font-medium rounded-lg transition-colors ${os==="full"?"bg-gold text-white":"bg-gray-100 text-text-muted"}`,children:"Full Script"}),jsxRuntimeExports.jsx("button",{onClick:()=>as("pdf"),disabled:!(ls!=null&&ls.scriptPdfData),className:`flex-1 py-1.5 text-xs font-medium rounded-lg transition-colors ${os==="pdf"?"bg-gold text-white":"bg-gray-100 text-text-muted"} ${ls!=null&&ls.scriptPdfData?"":"opacity-50 cursor-not-allowed"}`,children:"PDF Script"})]}),os==="full"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"px-4 pb-2 flex gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 relative",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search script...",value:ts,onChange:Es=>ss(Es.target.value),className:"w-full pl-9 pr-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary"}),ts&&jsxRuntimeExports.jsx("button",{onClick:()=>ss(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-light hover:text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("select",{value:rs||"",onChange:Es=>ns(Es.target.value||null),className:"px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary min-w-[100px]",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Jump to..."}),fs.map(Es=>jsxRuntimeExports.jsxs("option",{value:Es.sceneNumber,children:["Scene ",Es.sceneNumber]},Es.sceneNumber))]})]}),ts&&jsxRuntimeExports.jsx("div",{className:"px-4 pb-2",children:jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Ss.length," scene",Ss.length!==1?"s":""," found"]})})]})]})]})}),jsxRuntimeExports.jsx("div",{className:"mobile-container pb-safe-bottom",children:js?os==="full"?jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:Ss.map(Es=>jsxRuntimeExports.jsxs("div",{ref:Rs=>{Rs&&ds.current.set(Es.sceneNumber,Rs)},className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-[120px] z-10 bg-gold/10 backdrop-blur-sm border-l-4 border-gold px-3 py-2 mb-2 rounded-r-lg",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-bold text-gold",children:["SCENE ",Es.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:`px-1.5 py-0.5 text-[10px] font-bold rounded ${Es.intExt==="INT"?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"}`,children:Es.intExt}),jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-gray-100 text-text-muted",children:Es.timeOfDay})]}),jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-text-primary mt-1",children:Es.slugline}),Es.synopsis&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted italic mt-1",children:bs(Es.synopsis,ts)})]}),Es.scriptContent?jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-text-primary leading-relaxed pl-3",children:ts?bs(Es.scriptContent,ts):Es.scriptContent}):jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted italic pl-3",children:"No script content available for this scene"})]},Es.id))}):jsxRuntimeExports.jsx("div",{className:"h-[calc(100vh-180px)]",children:ls!=null&&ls.scriptPdfData?jsxRuntimeExports.jsx("iframe",{src:ls.scriptPdfData,className:"w-full h-full border-0",title:"Script PDF"}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full px-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No PDF Available"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center",children:"Upload a PDF script to view the original document here"})]})}):jsxRuntimeExports.jsx("div",{className:"px-4 py-8",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(NavIcon,{name:"document",className:"w-8 h-8 text-gray-300"})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Script Content"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload a script (PDF, FDX, or Fountain) to view it here"}),jsxRuntimeExports.jsx("button",{className:"px-4 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform",children:"Upload Script"})]})})}),xs&&jsxRuntimeExports.jsx(AmendmentReviewModal,{amendmentResult:xs,onApply:gs,onCancel:()=>ys(null)})]})}function ScheduleViewer({onBack:es}){const{schedule:ts,isUploading:ss,uploadError:rs,uploadScheduleStage1:ns,uploadRevisionStage1:os,startRevisionStage2Processing:as,compareAmendment:ls,applyAmendment:cs,clearPendingSchedule:us,clearSchedule:ds,isProcessingStage2:ms,stage2Progress:ps,stage2Error:hs,startStage2Processing:xs,getCastNamesForNumbers:ys}=useScheduleStore(),{currentProject:vs,syncCastDataFromSchedule:gs}=useProjectStore(),fs=reactExports.useRef(null),js=reactExports.useRef(null),[Ss,bs]=reactExports.useState(!1),[Es,Rs]=reactExports.useState("breakdown"),[ws,Ns]=reactExports.useState(null),[ks,_s]=reactExports.useState(null),[Ls,Os]=reactExports.useState(!1),zs=async Ds=>{var Ts;const Cs=(Ts=Ds.target.files)==null?void 0:Ts[0];if(Cs&&Cs.type==="application/pdf")try{await ns(Cs),Rs("breakdown"),await xs(),vs&&Bs({autoConfirm:!0})}catch($s){console.error("Failed to upload schedule:",$s)}fs.current&&(fs.current.value="")},qs=async Ds=>{var Ts;const Cs=(Ts=Ds.target.files)==null?void 0:Ts[0];if(!(!Cs||Cs.type!=="application/pdf")){try{Os(!0),await os(Cs),await as();const $s=ls();$s&&_s($s),Os(!1)}catch($s){console.error("Failed to process schedule revision:",$s),Os(!1),us()}js.current&&(js.current.value="")}},Qs=Ds=>{ks&&(cs(ks,Ds),_s(null),vs&&Bs({autoConfirm:!0}))},Ys=()=>{_s(null),us()},Ws=()=>{ds(),bs(!1),Rs("pdf")},Is=async()=>{Rs("breakdown"),await xs(),vs&&Bs({autoConfirm:!0})},Bs=Ds=>{const Cs=useScheduleStore.getState().schedule;if(!(!Cs||!vs))try{const Ts=gs(Cs,{createMissingCharacters:(Ds==null?void 0:Ds.createMissingCharacters)??!0,overwriteExisting:(Ds==null?void 0:Ds.overwriteExisting)??!1,autoConfirm:(Ds==null?void 0:Ds.autoConfirm)??!0});Ts&&(console.log("[ScheduleViewer] Cast data synced:",{scenesUpdated:Ts.scenesUpdated,charactersCreated:Ts.charactersCreated}),Ts.errors.length>0&&console.warn("[ScheduleViewer] Sync had some errors:",Ts.errors))}catch(Ts){console.error("[ScheduleViewer] Failed to sync cast data:",Ts)}};reactExports.useEffect(()=>{ts&&!ms&&!Ls&&(!ts.days||ts.days.length===0)&&ts.rawText&&(console.log("[ScheduleViewer] Auto-starting processing for unprocessed schedule"),Is())},[]);const Vs=(ts==null?void 0:ts.days)&&ts.days.length>0;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:es,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Schedule"})]}),ts?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[Vs&&jsxRuntimeExports.jsx("button",{onClick:()=>{var Ds;return(Ds=js.current)==null?void 0:Ds.click()},disabled:ss||ms||Ls,className:"px-2 py-1 text-[10px] font-medium text-gold border border-gold rounded-lg active:bg-gold/10 transition-colors disabled:opacity-50",children:Ls?"Processing...":"Upload New Draft"}),jsxRuntimeExports.jsx("button",{onClick:()=>bs(!0),className:"p-2 text-red-500 active:opacity-70 transition-opacity touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),jsxRuntimeExports.jsx("button",{onClick:()=>{var Ds;return(Ds=fs.current)==null?void 0:Ds.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:ss,children:ss?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})})]}):jsxRuntimeExports.jsx("button",{onClick:()=>{var Ds;return(Ds=fs.current)==null?void 0:Ds.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:ss,children:ss?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),ts&&jsxRuntimeExports.jsxs("div",{className:"px-4 pb-3 flex gap-1 bg-card",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Rs("breakdown"),className:`flex-1 py-2 text-xs font-medium rounded-lg transition-colors ${Es==="breakdown"?"gold-gradient text-white":"bg-gray-100 text-text-muted"}`,children:"Breakdown"}),jsxRuntimeExports.jsx("button",{onClick:()=>Rs("pdf"),className:`flex-1 py-2 text-xs font-medium rounded-lg transition-colors ${Es==="pdf"?"gold-gradient text-white":"bg-gray-100 text-text-muted"}`,children:"PDF"})]})]})}),jsxRuntimeExports.jsx("input",{ref:fs,type:"file",accept:".pdf",onChange:zs,className:"hidden"}),jsxRuntimeExports.jsx("input",{ref:js,type:"file",accept:".pdf",onChange:qs,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[rs&&jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:rs})}),hs&&jsxRuntimeExports.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:hs}),jsxRuntimeExports.jsx("button",{onClick:Is,className:"mt-2 text-xs text-red-700 underline",children:"Retry Processing"})]}),ts?Es==="pdf"?ts.pdfUri?jsxRuntimeExports.jsx("iframe",{src:ts.pdfUri,className:"w-full h-[calc(100vh-180px)] border-0 -mx-4 -mt-4",style:{width:"calc(100% + 2rem)"},title:"Schedule PDF"}):jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"PDF preview not available"})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[ms&&jsxRuntimeExports.jsxs("div",{className:"card p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin text-gold",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:ps.message||`Processing Day ${ps.current} of ${ps.total}...`}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"You can navigate away - processing continues in the background"})]})]}),ps.total>0&&jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:jsxRuntimeExports.jsx("div",{className:"gold-gradient h-2 rounded-full transition-all duration-300",style:{width:`${ps.current/ps.total*100}%`}})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Characters will be automatically confirmed once processing completes."})]}),Ls&&jsxRuntimeExports.jsxs("div",{className:"card p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin text-gold",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:"Processing New Draft..."}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:ps.message||(ps.total>0?`Day ${ps.current} of ${ps.total}`:"Parsing schedule PDF")})]})]}),ps.total>0&&jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:jsxRuntimeExports.jsx("div",{className:"gold-gradient h-2 rounded-full transition-all duration-300",style:{width:`${ps.current/ps.total*100}%`}})})]}),!Vs&&!ms&&!Ls&&ts&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gold/10 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsxs("svg",{className:"w-8 h-8 text-gold animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"Processing Schedule"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6 max-w-xs",children:ts.totalDays>0?`Preparing to process ${ts.totalDays} shooting day${ts.totalDays!==1?"s":""}...`:"Starting schedule processing..."}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center max-w-xs",children:"Characters will be automatically synced to your breakdown once processing completes."})]}),Vs&&ts.days.map(Ds=>jsxRuntimeExports.jsxs("div",{className:"card overflow-hidden",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Ns(ws===Ds.dayNumber?null:Ds.dayNumber),className:"w-full p-3 flex items-center justify-between text-left active:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:["Day ",Ds.dayNumber]}),Ds.date&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Ds.dayOfWeek?`${Ds.dayOfWeek}, `:"",Ds.date]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[Ds.location&&jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate",children:Ds.location}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-gold font-medium",children:[Ds.scenes.length," scene",Ds.scenes.length!==1?"s":""]}),Ds.totalPages&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Ds.totalPages," pages"]})]})]}),jsxRuntimeExports.jsx("svg",{className:`w-4 h-4 text-text-muted transition-transform flex-shrink-0 ${ws===Ds.dayNumber?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),ws===Ds.dayNumber&&jsxRuntimeExports.jsxs("div",{className:"border-t border-border",children:[Ds.notes&&Ds.notes.length>0&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 bg-amber-50 border-b border-border",children:Ds.notes.map((Cs,Ts)=>jsxRuntimeExports.jsx("span",{className:"text-xs text-amber-700 block",children:Cs},Ts))}),Ds.scenes.map((Cs,Ts)=>jsxRuntimeExports.jsx("div",{className:`px-3 py-2.5 ${Ts>0?"border-t border-border/50":""}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-gray-100 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted leading-none",children:"Sc"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-text-primary leading-tight",children:Cs.sceneNumber})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:`text-[10px] font-medium px-1 py-0.5 rounded ${Cs.intExt==="EXT"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:Cs.intExt}),jsxRuntimeExports.jsx("span",{className:`text-[10px] font-medium px-1 py-0.5 rounded ${Cs.dayNight.toLowerCase().includes("night")||Cs.dayNight.startsWith("N")?"bg-indigo-100 text-indigo-700":"bg-amber-100 text-amber-700"}`,children:Cs.dayNight}),Cs.pages&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-muted",children:[Cs.pages," pgs"]}),Cs.estimatedTime&&jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted ml-auto",children:Cs.estimatedTime})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-primary mt-0.5 truncate",children:Cs.setLocation}),Cs.description&&jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-muted mt-0.5 line-clamp-2",children:Cs.description}),Cs.castNumbers.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:ys(Cs.castNumbers).map(($s,Ps)=>jsxRuntimeExports.jsx("span",{className:"text-[10px] bg-gray-100 text-text-muted px-1.5 py-0.5 rounded",children:$s},Ps))})]})]})},`${Cs.sceneNumber}-${Ts}`)),Ds.scenes.length===0&&jsxRuntimeExports.jsx("div",{className:"px-3 py-4 text-center",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"No scenes extracted for this day"})})]})]},Ds.dayNumber))]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(NavIcon,{name:"schedule",className:"w-8 h-8 text-gray-300"})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Schedule Uploaded"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6 max-w-xs",children:"Upload your production schedule PDF to view it here"}),jsxRuntimeExports.jsx("button",{onClick:()=>{var Ds;return(Ds=fs.current)==null?void 0:Ds.click()},disabled:ss,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50 mb-6",children:ss?"Uploading...":"Upload Schedule PDF"}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4 max-w-xs",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-text-secondary",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Automatic Processing"}),jsxRuntimeExports.jsx("p",{children:"The schedule will process automatically in the background. Characters will be confirmed within a few minutes."})]})]})})]})]}),Ss&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 max-w-sm w-full",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-2",children:"Delete Schedule?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-4",children:"This will remove the schedule and all cross-reference data. You can upload a new schedule at any time."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>bs(!1),className:"flex-1 px-4 py-2.5 rounded-button text-sm font-medium text-text-primary bg-gray-100 active:bg-gray-200 transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Ws,className:"flex-1 px-4 py-2.5 rounded-button text-sm font-medium text-white bg-red-500 active:bg-red-600 transition-colors",children:"Delete"})]})]})}),ks&&jsxRuntimeExports.jsx(ScheduleAmendmentModal,{amendmentResult:ks,getCastNamesForNumbers:ys,onApply:Qs,onCancel:Ys})]})}function CallSheetArchive({onBack:es}){const{callSheets:ts,activeCallSheetId:ss,setActiveCallSheet:rs,uploadCallSheet:ns,deleteCallSheet:os,isUploading:as,uploadError:ls}=useCallSheetStore(),cs=reactExports.useRef(null),[us,ds]=reactExports.useState(null),[ms,ps]=reactExports.useState(null),hs=async gs=>{var js;const fs=(js=gs.target.files)==null?void 0:js[0];if(fs&&fs.type==="application/pdf")try{await ns(fs)}catch(Ss){console.error("Failed to upload call sheet:",Ss)}cs.current&&(cs.current.value="")},xs=(gs,fs)=>{fs.stopPropagation(),rs(gs)},ys=gs=>{os(gs),ps(null)},vs=us?ts.find(gs=>gs.id===us):null;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:es,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Call Sheets"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var gs;return(gs=cs.current)==null?void 0:gs.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:as,children:as?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]})})}),jsxRuntimeExports.jsx("input",{ref:cs,type:"file",accept:".pdf",onChange:hs,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[ls&&jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:ls})}),ts.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(NavIcon,{name:"document",className:"w-8 h-8 text-gray-300"})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Call Sheets"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload your daily call sheet PDFs to track scenes and times"}),jsxRuntimeExports.jsx("button",{onClick:()=>{var gs;return(gs=cs.current)==null?void 0:gs.click()},disabled:as,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:as?"Uploading...":"Upload Call Sheet PDF"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ts.map(gs=>jsxRuntimeExports.jsxs("div",{onClick:()=>ds(gs.id),className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${gs.id===ss?"bg-gold-100":"bg-gray-100"}`,children:jsxRuntimeExports.jsx(NavIcon,{name:"document",className:`w-5 h-5 ${gs.id===ss?"text-gold":"text-text-light"}`})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsxs("h3",{className:"text-sm font-semibold text-text-primary",children:["Day ",gs.productionDay,gs.totalProductionDays&&` of ${gs.totalProductionDays}`]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[formatShortDate(gs.date),"  ",gs.scenes.length," scene",gs.scenes.length!==1?"s":"",gs.unitCallTime&&`  Call: ${gs.unitCallTime}`]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[gs.id===ss?jsxRuntimeExports.jsx("span",{className:"px-2.5 py-1 text-[10px] font-medium rounded-full bg-green-100 text-green-600",children:"Active"}):jsxRuntimeExports.jsx("button",{onClick:fs=>xs(gs.id,fs),className:"px-2.5 py-1 text-[10px] font-medium rounded-full bg-gold-100 text-gold hover:bg-gold-200 transition-colors",children:"Set Active"}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]},gs.id))}),jsxRuntimeExports.jsx("div",{className:"mt-6 text-center",children:jsxRuntimeExports.jsx("button",{onClick:()=>{var gs;return(gs=cs.current)==null?void 0:gs.click()},disabled:as,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:as?"Uploading...":"Upload Call Sheet PDF"})})]})]}),vs&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-black/90 flex flex-col",onClick:()=>ds(null),children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between safe-top",onClick:gs=>gs.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-base font-semibold text-text-primary",children:["Day ",vs.productionDay," Call Sheet"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:formatShortDate(vs.date)})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[ms===vs.id?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ps(null),className:"px-3 py-1.5 text-xs text-text-muted",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:()=>{ys(vs.id),ds(null)},className:"px-3 py-1.5 text-xs bg-red-500 text-white rounded-lg",children:"Delete"})]}):jsxRuntimeExports.jsx("button",{onClick:()=>ps(vs.id),className:"p-2 text-red-400 hover:text-red-500",title:"Delete call sheet",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}),jsxRuntimeExports.jsx("button",{onClick:()=>ds(null),className:"p-2 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-hidden",onClick:gs=>gs.stopPropagation(),children:vs.pdfUri?jsxRuntimeExports.jsx("iframe",{src:vs.pdfUri,className:"w-full h-full border-0",title:`Day ${vs.productionDay} Call Sheet`}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"PDF Not Available"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"The original PDF for this call sheet was not saved."}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500",children:["Day ",vs.productionDay,"  ",vs.scenes.length," scenes  Unit call ",vs.unitCallTime]})]})})]})]})}function ArchivedProjectsScreen({onBack:es}){const{getArchivedProjects:ts,loadArchivedProject:ss}=useProjectStore(),rs=ts();return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:es,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Archived Projects"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:rs.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Archived Projects"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted",children:["Wrapped projects will appear here after ",PROJECT_RETENTION_DAYS," days."]})]}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:rs.map(ns=>jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary",children:ns.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[ns.scenesCount," scenes  ",ns.charactersCount," characters  ",ns.photosCount," photos"]})]}),jsxRuntimeExports.jsx("span",{className:`px-2 py-1 text-[10px] font-medium rounded-full ${ns.state==="wrapped"?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"}`,children:ns.state==="wrapped"?"Wrapped":"Archived"})]}),ns.wrappedAt&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-light mb-3",children:["Wrapped ",formatShortDate(new Date(ns.wrappedAt).toISOString().split("T")[0]),ns.daysUntilDeletion>0&&`  ${ns.daysUntilDeletion} days until deletion`]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ss(ns.id),className:"flex-1 px-3 py-2 text-sm font-medium rounded-button bg-gold/10 text-gold active:scale-[0.98] transition-transform",children:"Restore Project"}),jsxRuntimeExports.jsx("button",{className:"px-3 py-2 text-sm font-medium rounded-button bg-gray-100 text-text-secondary active:scale-[0.98] transition-transform",children:"Export"})]})]},ns.id))})})]})}function WrapPopupModal({onExport:es}){const{currentProject:ts,showWrapPopup:ss,wrapTriggerReason:rs,lifecycle:ns,wrapProject:os,dismissWrapPopup:as}=useProjectStore();if(!ss||!ts)return null;const ls=()=>{if(ns.state==="wrapped"&&ns.deletionDate)return new Date(ns.deletionDate).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});const ms=new Date;return ms.setDate(ms.getDate()+PROJECT_RETENTION_DAYS),ms.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})},cs=()=>{switch(rs){case"all_scenes_complete":return`All scenes for "${ts.name}" are marked complete.`;case"inactivity":return`"${ts.name}" has been inactive for 30 days.`;case"manual":return`"${ts.name}" has been marked as wrapped.`;default:return`"${ts.name}" is ready to be wrapped.`}},us=()=>{ns.state==="active"&&rs&&os(rs),es()},ds=()=>{ns.state==="active"&&rs&&os(rs),as(!0)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"pt-8 pb-4 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.875 1.875 0 0118 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0118 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 016 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-text-primary mb-1",children:"That's a Wrap!"})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-6",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary text-center mb-4",children:cs()}),jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-amber-800",children:["Your project will be stored for ",PROJECT_RETENTION_DAYS," days in case of pickups, then automatically deleted."]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-900 font-medium mt-2",children:"Export your continuity documents now to keep a permanent backup."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:us,className:"w-full py-3.5 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Export Documents"]}),jsxRuntimeExports.jsx("button",{onClick:ds,className:"w-full py-3 rounded-button bg-gray-100 text-text-secondary font-medium text-base active:scale-[0.98] transition-transform",children:"Remind Me Later"})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-light text-center mt-4",children:["Project deletion: ",ls()]})]})]})})}function LifecycleBanner({onExport:es}){const{lifecycle:ts,getLifecycleBanner:ss,restoreProject:rs}=useProjectStore(),ns=ss();if(!(ns!=null&&ns.show))return null;const os=ts.state==="wrapped",as=ts.state==="archived";return jsxRuntimeExports.jsx("div",{className:`${as?"bg-red-50 border-b border-red-200":"bg-amber-50 border-b border-amber-200"}`,children:jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-2",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[as?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-red-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsx("span",{className:`text-xs font-medium truncate ${as?"text-red-800":"text-amber-800"}`,children:ns.message})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[os&&jsxRuntimeExports.jsx("button",{onClick:rs,className:"text-xs font-medium text-amber-700 hover:text-amber-900",children:"Restore"}),jsxRuntimeExports.jsx("button",{onClick:es,className:`px-2 py-1 text-[10px] font-semibold rounded ${as?"bg-red-600 text-white":"bg-amber-600 text-white"}`,children:"Export"})]})]})})})}function Home({onProjectReady:es,onBack:ts}){const[ss,rs]=reactExports.useState("upload"),[ns,os]=reactExports.useState(""),[as,ls]=reactExports.useState(null),[cs,us]=reactExports.useState(null),[,ds]=reactExports.useState(null),[ms,ps]=reactExports.useState(0),[hs,xs]=reactExports.useState("Reading document..."),[ys,vs]=reactExports.useState(null),[gs,fs]=reactExports.useState(new Set),[js,Ss]=reactExports.useState(new Map),bs=reactExports.useRef(null),Es=reactExports.useRef(null),{setProject:Rs,setScriptPdf:ws,currentProject:Ns}=useProjectStore(),{setSchedule:ks}=useScheduleStore(),_s=reactExports.useCallback(async(Vs,Ds)=>{var Cs;try{ps(10),xs("Reading script..."),await new Promise(ur=>setTimeout(ur,200));let Ts=null;if(Ds){ps(15),xs("Processing schedule...");try{Ts=(await parseScheduleStage1(Ds)).schedule,ds(Ts),ks(Ts),console.log(`Schedule parsed: ${Ts.castList.length} cast members identified`),Ts.castList.length===0?console.warn("Schedule uploaded but no cast members extracted - character detection will use script regex fallback"):console.log("Cast list:",Ts.castList.map(cr=>`${cr.number}.${cr.name}`).join(", "))}catch(ur){console.warn("Schedule parsing failed, continuing without:",ur)}}ps(30),xs("Detecting scenes...");const $s=await parseScenesFast(Vs);ps(70),xs("Creating project..."),await new Promise(ur=>setTimeout(ur,100));const Ps=$s.scenes.map(ur=>({id:`scene-${ur.sceneNumber}`,sceneNumber:ur.sceneNumber,slugline:ur.slugline,intExt:ur.intExt,timeOfDay:ur.timeOfDay,scriptContent:ur.scriptContent,characters:[],isComplete:!1,characterConfirmationStatus:"pending",suggestedCharacters:void 0,shootingDay:void 0})),Fs=(Ns==null?void 0:Ns.id)||`project-${Date.now()}`,Us=ns||(Ns==null?void 0:Ns.name)||$s.title||Vs.name.replace(/\.[^/.]+$/,"").replace(/[-_]/g," ")||"Untitled Project",Gs={id:Fs,name:Us,createdAt:(Ns==null?void 0:Ns.createdAt)||new Date,updatedAt:new Date,scenes:Ps,characters:(Ns==null?void 0:Ns.characters)||[],looks:(Ns==null?void 0:Ns.looks)||[],characterDetectionStatus:"idle",scenesConfirmed:0};if(ps(90),xs("Almost done..."),await new Promise(ur=>setTimeout(ur,200)),ps(100),xs("Complete!"),Gs._rawText=$s.rawText,Ts&&(Gs._scheduleCastList=Ts.castList),Rs(Gs),Vs.type==="application/pdf"){const ur=new FileReader;ur.onload=()=>{const cr=ur.result;ws(cr)},ur.readAsDataURL(Vs)}const hr=((Cs=Ts==null?void 0:Ts.castList)==null?void 0:Cs.map(ur=>ur.name))||[];setTimeout(()=>{Ls(Gs,$s.rawText,hr)},500),setTimeout(()=>es(),500)}catch(Ts){console.error("Script parsing error:",Ts),alert(Ts instanceof Error?Ts.message:"Failed to parse script"),rs("upload")}},[ns,Rs,ws,ks,es,Ns]),Ls=reactExports.useCallback(async(Vs,Ds,Cs=[])=>{var Ts;try{useProjectStore.getState().startCharacterDetection();const $s=Vs.scenes.map(Gs=>({sceneNumber:Gs.sceneNumber,scriptContent:Gs.scriptContent||""}));console.log(`Starting character detection for ${$s.length} scenes`),Cs.length>0&&console.log(`Using ${Cs.length} known characters from schedule:`,Cs);const Ps=await detectCharactersForScenesBatch($s,Ds,{useAI:!1,knownCharacters:Cs.length>0?Cs:void 0,onProgress:(Gs,hr)=>{console.log(`Character detection: ${Gs}/${hr}`)}}),Fs=useProjectStore.getState(),Us=((Ts=Fs.currentProject)==null?void 0:Ts.scenes)||Vs.scenes;Ps.forEach((Gs,hr)=>{const ur=Us.find(cr=>cr.sceneNumber===hr);ur&&Fs.updateSceneSuggestedCharacters(ur.id,Gs)}),Fs.setCharacterDetectionStatus("complete")}catch($s){console.error("Background character detection failed:",$s),useProjectStore.getState().setCharacterDetectionStatus("complete")}},[]),Os=reactExports.useCallback(async(Vs,Ds)=>_s(Vs,Ds),[_s]),zs=Vs=>{var Cs;const Ds=(Cs=Vs.target.files)==null?void 0:Cs[0];if(Ds){ls(Ds);const Ts=Ds.name.replace(/\.[^/.]+$/,"").replace(/[-_]/g," ");os(Ts)}},qs=Vs=>{var Cs;const Ds=(Cs=Vs.target.files)==null?void 0:Cs[0];Ds&&us(Ds)},Qs=()=>{as&&(rs("processing"),Os(as,cs))},Ys=()=>{if(!ys){const Us={id:`project-${Date.now()}`,name:ns||"Untitled Project",createdAt:new Date,updatedAt:new Date,scenes:[],characters:[],looks:[]};Rs(Us),es();return}const Vs=Array.from(gs).filter(Us=>!js.has(Us)),{scenes:Ds,characters:Cs}=convertParsedScriptToProject(ys,Vs),Ts=Cs.map(Us=>({id:`look-${Us.id}`,characterId:Us.id,name:"Look 1",scenes:Ds.filter(Gs=>Gs.characters.includes(Us.id)).map(Gs=>Gs.sceneNumber),estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()})),$s=(Ns==null?void 0:Ns.id)||`project-${Date.now()}`,Ps=ns||(Ns==null?void 0:Ns.name)||ys.title||"Untitled Project",Fs={id:$s,name:Ps,createdAt:(Ns==null?void 0:Ns.createdAt)||new Date,updatedAt:new Date,scenes:Ds,characters:Cs,looks:Ts};Rs(Fs),es()},Ws=()=>{vs(null),fs(new Set),rs("setup")},Is=Vs=>{fs(Ds=>{const Cs=new Set(Ds);return Cs.has(Vs)?Cs.delete(Vs):Cs.add(Vs),Cs})},Bs=(Vs,Ds)=>{Ss(Cs=>{const Ts=new Map(Cs);return Vs===Ds?Ts.delete(Vs):Ts.set(Vs,Ds),Ts}),fs(Cs=>{const Ts=new Set(Cs);return Ts.add(Ds),Ts})};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background safe-top safe-bottom",children:[ss==="upload"&&jsxRuntimeExports.jsx(UploadScreen,{fileInputRef:bs,scheduleInputRef:Es,uploadedFile:as,uploadedScheduleFile:cs,onBack:ts,onSkip:Ws,onStartWithFiles:Qs}),ss==="processing"&&jsxRuntimeExports.jsx(ProcessingScreen,{fileName:(as==null?void 0:as.name)||"",progress:ms,status:hs}),ss==="characters"&&ys&&jsxRuntimeExports.jsx(CharacterSelectionScreen,{parsedScript:ys,selectedCharacters:gs,mergeMap:js,onToggleCharacter:Is,onMergeCharacter:Bs,onContinue:()=>rs("setup"),onBack:()=>rs("upload")}),ss==="setup"&&jsxRuntimeExports.jsx(SetupScreen,{projectName:ns,onNameChange:os,detectedScenes:(ys==null?void 0:ys.scenes.length)||0,detectedCharacters:Array.from(gs).filter(Vs=>!js.has(Vs)),onStart:Ys,onBack:()=>rs(ys?"characters":"upload")}),jsxRuntimeExports.jsx("input",{ref:bs,type:"file",accept:".pdf,.fdx,.fountain,.txt",onChange:zs,className:"hidden"}),jsxRuntimeExports.jsx("input",{ref:Es,type:"file",accept:".pdf",onChange:qs,className:"hidden"})]})}function UploadScreen({fileInputRef:es,scheduleInputRef:ts,uploadedFile:ss,uploadedScheduleFile:rs,onBack:ns,onSkip:os,onStartWithFiles:as}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 flex items-center gap-3 border-b border-border",children:[ns&&jsxRuntimeExports.jsx("button",{onClick:ns,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Upload Files"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Script"}),jsxRuntimeExports.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gold/10 text-gold",children:"Required"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var ls;return(ls=es.current)==null?void 0:ls.click()},className:`w-full rounded-2xl border-2 border-dashed transition-colors p-6 ${ss?"border-green-400 bg-green-50":"border-gold/40 bg-gold/5 active:bg-gold/10"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${ss?"bg-green-100":"bg-gold/10"}`,children:ss?jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 text-left",children:ss?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-green-700 truncate",children:ss.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600",children:"Tap to change"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Tap to upload script"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"PDF, Final Draft, or Fountain"})]})})]})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Production Schedule"}),jsxRuntimeExports.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-100 text-text-muted",children:"Optional"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var ls;return(ls=ts.current)==null?void 0:ls.click()},className:`w-full rounded-2xl border-2 border-dashed transition-colors p-6 ${rs?"border-green-400 bg-green-50":"border-gray-300 bg-gray-50 active:bg-gray-100"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${rs?"bg-green-100":"bg-gray-100"}`,children:rs?jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 text-left",children:rs?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-green-700 truncate",children:rs.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600",children:"Tap to change"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-secondary",children:"Tap to upload schedule"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"PDF (strips, one-liner)"})]})})]})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-2 px-2",children:"Uploading a schedule gives you accurate character assignments per scene and shooting day info"})]}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-blue-50 border border-blue-100 p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-blue-700",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Faster with Schedule"}),jsxRuntimeExports.jsx("p",{children:"The schedule contains the official cast list with character numbers. This allows instant, accurate character detection per scene without AI processing."})]})]})}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-text-secondary",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Background Processing"}),jsxRuntimeExports.jsx("p",{children:"The schedule will process automatically in the background. Character assignments will be confirmed within a few minutes - you can start using the app right away."})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-8 pt-4 border-t border-border space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:as,disabled:!ss,className:"w-full py-4 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50 disabled:active:scale-100",children:ss?"Start Processing":"Upload a script to continue"}),jsxRuntimeExports.jsx("button",{onClick:os,className:"py-3 text-sm text-text-muted font-medium active:text-gold transition-colors",children:"Skip - add manually"})]})]})}function ProcessingScreen({fileName:es,progress:ts,status:ss}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen items-center justify-center px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gold/10 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gold animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary mb-2",children:"Processing Script"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-6 truncate max-w-full",children:es}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-xs",children:[jsxRuntimeExports.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden mb-2",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gold rounded-full transition-all duration-300",style:{width:`${ts}%`}})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light text-center mb-4",children:ss}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center leading-relaxed",children:"Detecting scenes in your script. You'll be able to confirm characters scene-by-scene."})]})]})}function CharacterSelectionScreen({parsedScript:es,selectedCharacters:ts,mergeMap:ss,onToggleCharacter:rs,onMergeCharacter:ns,onContinue:os,onBack:as}){const[ls,cs]=reactExports.useState(!1),[us,ds]=reactExports.useState(null),ms=[...es.characters].sort((hs,xs)=>xs.sceneCount-hs.sceneCount),ps=hs=>{ds(hs),cs(!0)};return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 flex items-center gap-3 border-b border-border",children:[jsxRuntimeExports.jsx("button",{onClick:as,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Select Characters"})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-4 bg-gold/5 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-around text-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gold",children:es.scenes.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Scenes"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gold",children:es.characters.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Characters Found"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gold",children:ts.size-ss.size}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Selected"})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 py-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Select the characters you want to track. Tap the merge icon to combine similar characters."})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ms.map(hs=>{const xs=ts.has(hs.name),ys=ss.get(hs.name),vs=!!ys;return jsxRuntimeExports.jsx("div",{className:`rounded-xl border transition-all ${vs?"border-gray-200 bg-gray-50 opacity-60":xs?"border-gold bg-gold/5":"border-border bg-card"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 p-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>!vs&&rs(hs.name),disabled:vs,className:`w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all ${vs?"border-gray-300 bg-gray-200":xs?"border-gold bg-gold":"border-gray-300"}`,children:(xs||vs)&&jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`font-medium truncate ${vs?"text-text-muted line-through":"text-text-primary"}`,children:hs.name}),vs&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[" ",ys]})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[hs.sceneCount," scene",hs.sceneCount!==1?"s":"",hs.variants.length>1&&`  ${hs.variants.length} variants`]})]}),!vs&&jsxRuntimeExports.jsx("button",{onClick:()=>ps(hs.name),className:"p-2 text-text-muted hover:text-gold transition-colors",title:"Merge with another character",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 16.875h3.375m0 0h3.375m-3.375 0V13.5m0 3.375v3.375M6 10.5h2.25a2.25 2.25 0 002.25-2.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v2.25A2.25 2.25 0 006 10.5zm0 9.75h2.25A2.25 2.25 0 0010.5 18v-2.25a2.25 2.25 0 00-2.25-2.25H6a2.25 2.25 0 00-2.25 2.25V18A2.25 2.25 0 006 20.25zm9.75-9.75H18a2.25 2.25 0 002.25-2.25V6A2.25 2.25 0 0018 3.75h-2.25A2.25 2.25 0 0013.5 6v2.25a2.25 2.25 0 002.25 2.25z"})})})]})},hs.name)})})}),jsxRuntimeExports.jsx("div",{className:"px-6 pb-8 pt-4 border-t border-border",children:jsxRuntimeExports.jsxs("button",{onClick:os,disabled:ts.size-ss.size===0,className:"w-full py-4 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50",children:["Continue with ",ts.size-ss.size," Character",ts.size-ss.size!==1?"s":""]})}),ls&&us&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[70vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 border-b border-border flex items-center justify-between",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-semibold text-text-primary",children:['Merge "',us,'" into...']}),jsxRuntimeExports.jsx("button",{onClick:()=>cs(!1),className:"p-2 text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[ss.has(us)&&jsxRuntimeExports.jsxs("button",{onClick:()=>{ns(us,us),cs(!1)},className:"w-full p-3 text-left rounded-lg border border-red-200 bg-red-50 text-red-700",children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Remove merge"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-red-500 block",children:"Keep as separate character"})]}),ms.filter(hs=>hs.name!==us&&!ss.has(hs.name)).map(hs=>jsxRuntimeExports.jsxs("button",{onClick:()=>{ns(us,hs.name),cs(!1)},className:"w-full p-3 text-left rounded-lg border border-border bg-card hover:border-gold transition-colors",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:hs.name}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:[hs.sceneCount," scenes"]})]},hs.name))]})})]})})]})}function SetupScreen({projectName:es,onNameChange:ts,detectedScenes:ss,detectedCharacters:rs,onStart:ns,onBack:os}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 flex items-center gap-3 border-b border-border",children:[jsxRuntimeExports.jsx("button",{onClick:os,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Setup"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 py-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Project Name"}),jsxRuntimeExports.jsx("input",{type:"text",value:es,onChange:as=>ts(as.target.value),placeholder:"Enter project name",className:"input-field w-full text-base"})]}),(ss>0||rs.length>0)&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"DETECTED FROM SCRIPT"}),ss>0&&jsxRuntimeExports.jsxs("div",{className:"card flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.875 1.875 0 0118 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0118 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 016 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Scenes"})]}),jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-gold",children:ss})]}),rs.length>0&&jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Characters"}),jsxRuntimeExports.jsx("span",{className:"ml-auto text-lg font-bold text-gold",children:rs.length})]}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:rs.map(as=>jsxRuntimeExports.jsx("span",{className:"px-3 py-1 text-xs font-medium rounded-full bg-gray-100 text-text-secondary",children:as},as))})]})]}),ss===0&&rs.length===0&&jsxRuntimeExports.jsxs("div",{className:"card text-center py-8",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-2",children:"No script uploaded"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light",children:"You can add scenes and characters manually after setup"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 pb-8",children:jsxRuntimeExports.jsx("button",{onClick:ns,disabled:!es.trim(),className:"w-full py-4 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50 disabled:active:scale-100",children:"Start Project"})})]})}const API_ENDPOINT="/api/ai",SYSTEM_PROMPT=`You are Claude, an AI assistant specialized in film and television hair, makeup, and continuity production. You're helping a hair and makeup professional manage their work on set.

You have access to their project data including:
- Characters and their looks
- Scene breakdowns with H&MU requirements
- Continuity tracking and events
- Timesheet and hours data
- Budget information

Be helpful, concise, and production-focused. Use industry terminology appropriately. When discussing looks or continuity, be specific about products, techniques, and timing.

Keep responses focused and practical - these users are often on set and need quick, actionable information.`,useChatStore=create()(persist((es,ts)=>({messages:[],isOpen:!1,isLoading:!1,error:null,toggleChat:()=>es(ss=>({isOpen:!ss.isOpen})),openChat:()=>es({isOpen:!0}),closeChat:()=>es({isOpen:!1}),addMessage:(ss,rs)=>{const ns={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,role:ss,content:rs,timestamp:new Date};es(os=>({messages:[...os.messages.slice(-49),ns]}))},clearMessages:()=>es({messages:[],error:null}),setLoading:ss=>es({isLoading:ss}),setError:ss=>es({error:ss}),sendMessage:async(ss,rs)=>{var ls,cs;const{addMessage:ns,setLoading:os,setError:as}=ts();ns("user",ss),os(!0),as(null);try{const us=ts().messages.slice(-10).map(xs=>({role:xs.role,content:xs.content})),ds=`${SYSTEM_PROMPT}

Current Project Context:
${rs}`,ms=await fetch(API_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:us,system:ds,maxTokens:1024,model:"claude-sonnet-4-20250514"})});if(!ms.ok){const xs=await ms.json().catch(()=>({}));throw new Error(xs.error||`API error: ${ms.status}`)}const ps=await ms.json(),hs=((cs=(ls=ps.content)==null?void 0:ls[0])==null?void 0:cs.text)||ps.completion||"Sorry, I could not generate a response.";ns("assistant",hs)}catch(us){const ds=us instanceof Error?us.message:"Failed to send message";as(ds),ns("assistant",`Sorry, I encountered an error: ${ds}`)}finally{os(!1)}}}),{name:"hair-makeup-chat-storage",storage:createJSONStorage(()=>localStorage),partialize:es=>({messages:es.messages.slice(-50)})})),SUGGESTIONS=[{label:"Character overview",prompt:"Give me an overview of all characters and their looks in this project"},{label:"Continuity tracking",prompt:"What continuity events should I track across scenes?"},{label:"Complex H&MU scenes",prompt:"Which scenes have the most complex hair and makeup requirements?"}];function ChatAssistant(){const{messages:es,isOpen:ts,isLoading:ss,error:rs,toggleChat:ns,closeChat:os,sendMessage:as,clearMessages:ls}=useChatStore(),[cs,us]=reactExports.useState(""),ds=reactExports.useRef(null),ms=reactExports.useRef(null);reactExports.useEffect(()=>{ts&&ds.current&&ds.current.scrollIntoView({behavior:"smooth"})},[es,ts]),reactExports.useEffect(()=>{ts&&ms.current&&ms.current.focus()},[ts]);const ps=()=>{const fs=useProjectStore.getState(),js=useTimesheetStore.getState(),Ss=[];if(fs.currentProject){const Es=fs.currentProject;Ss.push(`Project: ${Es.name}`),Ss.push(`Characters: ${Es.characters.length}`),Ss.push(`Scenes: ${Es.scenes.length}`),Ss.push(`Looks: ${Es.looks.length}`),Es.characters.length>0&&(Ss.push(`
Characters:`),Es.characters.slice(0,10).forEach(ws=>{const Ns=Es.looks.filter(ks=>ks.characterId===ws.id);Ss.push(`- ${ws.name} (${ws.initials}): ${Ns.length} looks`)}));const Rs=Es.scenes.filter(ws=>ws.isComplete).length;Ss.push(`
Scenes: ${Rs}/${Es.scenes.length} complete`)}const bs=Object.values(js.entries);if(bs.length>0){const Es=bs.reduce((Rs,ws)=>{const Ns=js.calculateEntry(ws);return Rs+Ns.totalHours},0);Ss.push(`
Timesheet: ${bs.length} days logged, ${Es.toFixed(1)} total hours`)}return Ss.join(`
`)||"No project data available yet."},hs=async()=>{const fs=cs.trim();if(!fs||ss)return;us("");const js=ps();await as(fs,js)},xs=fs=>{us(fs);const js=ps();as(fs,js)},ys=fs=>{fs.key==="Enter"&&!fs.shiftKey&&(fs.preventDefault(),hs())},vs=fs=>fs.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,'<code class="bg-black/20 px-1 rounded text-sm">$1</code>').replace(/\n/g,"<br />"),gs=es.length>0;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:ns,className:`fixed bottom-24 right-4 z-50 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all active:scale-95 ${ts?"gold-gradient rotate-0":"gold-gradient"}`,style:{boxShadow:"0 4px 20px rgba(201, 169, 97, 0.4)"},"aria-label":ts?"Close chat":"Open chat assistant",children:ts?jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),ts&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-30 flex flex-col",style:{backgroundColor:"var(--color-background)"},children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",style:{backgroundColor:"var(--color-card)",borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-success animate-pulse"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:"Claude Assistant"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:ls,className:"p-2 rounded-lg transition-colors",style:{color:"var(--color-text-muted)"},title:"Clear chat",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),jsxRuntimeExports.jsx("button",{onClick:os,className:"p-2 rounded-lg transition-colors",style:{color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:gs?jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[es.map(fs=>jsxRuntimeExports.jsx("div",{className:`flex ${fs.role==="user"?"justify-end":"justify-start"}`,children:jsxRuntimeExports.jsx("div",{className:`max-w-[85%] rounded-2xl px-4 py-3 ${fs.role==="user"?"gold-gradient text-white rounded-br-sm":"rounded-bl-sm"}`,style:fs.role==="assistant"?{backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"}:void 0,children:jsxRuntimeExports.jsx("div",{className:"text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:vs(fs.content)}})})},fs.id)),ss&&jsxRuntimeExports.jsx("div",{className:"flex justify-start",children:jsxRuntimeExports.jsx("div",{className:"rounded-2xl rounded-bl-sm px-4 py-3",style:{backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsxs("div",{className:"flex gap-1",children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"var(--color-text-muted)",animationDelay:"0ms"}}),jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"var(--color-text-muted)",animationDelay:"150ms"}}),jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"var(--color-text-muted)",animationDelay:"300ms"}})]})})}),rs&&jsxRuntimeExports.jsx("div",{className:"text-center py-2",children:jsxRuntimeExports.jsx("span",{className:"text-sm text-error",children:rs})}),jsxRuntimeExports.jsx("div",{ref:ds})]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4",children:[jsxRuntimeExports.jsx("div",{className:"text-5xl mb-4",children:""}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--color-text-primary)"},children:"Project Assistant"}),jsxRuntimeExports.jsx("p",{className:"text-sm mb-6",style:{color:"var(--color-text-muted)"},children:"I have access to your project data including characters, looks, scenes, and timesheets. How can I help?"}),jsxRuntimeExports.jsx("div",{className:"space-y-2 w-full max-w-sm",children:SUGGESTIONS.map((fs,js)=>jsxRuntimeExports.jsx("button",{onClick:()=>xs(fs.prompt),className:"w-full p-3 rounded-card text-left transition-all active:scale-[0.98]",style:{backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:fs.label})},js))})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 pt-3 pb-24",style:{backgroundColor:"var(--color-card)",borderTop:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsxs("div",{className:"flex items-end gap-2",children:[jsxRuntimeExports.jsx("textarea",{ref:ms,value:cs,onChange:fs=>us(fs.target.value),onKeyDown:ys,placeholder:"Ask about your project...",rows:1,className:"flex-1 input-field resize-none max-h-32",style:{minHeight:"44px"},disabled:ss}),jsxRuntimeExports.jsx("button",{onClick:hs,disabled:!cs.trim()||ss,className:"p-3 rounded-button gold-gradient text-white disabled:opacity-50 transition-all active:scale-95",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]})]})}class ErrorBoundary extends reactExports.Component{constructor(ss){super(ss);eo(this,"handleTryAgain",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});eo(this,"handleReload",()=>{window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(ss){return{hasError:!0,error:ss}}componentDidCatch(ss,rs){console.error("ErrorBoundary caught an error:",ss,rs),this.setState({errorInfo:rs})}render(){return this.state.hasError?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md w-full text-center",children:[jsxRuntimeExports.jsx("div",{className:"mx-auto w-16 h-16 mb-6 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold text-text-primary mb-2",children:"Something went wrong"}),jsxRuntimeExports.jsx("p",{className:"text-text-muted mb-6",children:"The app encountered an unexpected error. Please try again or reload the page."}),!1,jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:this.handleTryAgain,className:"w-full py-3 px-4 rounded-button gold-gradient text-white font-semibold shadow-md active:scale-[0.98] transition-transform",children:"Try Again"}),jsxRuntimeExports.jsx("button",{onClick:this.handleReload,className:"w-full py-3 px-4 rounded-button bg-card border border-border text-text-primary font-medium hover:bg-background-secondary transition-colors",children:"Reload Page"})]})]})}):this.props.children}}const logoTick="/mobile/logo-tick.png";function WelcomeScreen(){const{setScreen:es}=useAuthStore();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col",style:{background:"linear-gradient(180deg, #fffdfb 0%, #fefcfb 30%, #faf6f0 70%, #f5efe5 100%)"},children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-8",children:[jsxRuntimeExports.jsx("img",{src:logoTick,alt:"Checks Happy Logo",className:"w-32 h-32 mb-3 object-contain",style:{maskImage:"radial-gradient(ellipse 70% 70% at center, black 50%, transparent 100%)",WebkitMaskImage:"radial-gradient(ellipse 70% 70% at center, black 50%, transparent 100%)"}}),jsxRuntimeExports.jsx("h1",{className:"text-[34px] font-serif font-medium tracking-wide text-[#1a1a1a]",children:"CHECKS HAPPY"}),jsxRuntimeExports.jsxs("svg",{width:"280",height:"10",viewBox:"0 0 280 10",className:"mt-3 mb-8",children:[jsxRuntimeExports.jsx("defs",{children:jsxRuntimeExports.jsxs("linearGradient",{id:"underlineGold",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[jsxRuntimeExports.jsx("stop",{offset:"0%",stopColor:"#C9A962",stopOpacity:"0.3"}),jsxRuntimeExports.jsx("stop",{offset:"10%",stopColor:"#C9A962"}),jsxRuntimeExports.jsx("stop",{offset:"50%",stopColor:"#D4B86A"}),jsxRuntimeExports.jsx("stop",{offset:"90%",stopColor:"#C9A962"}),jsxRuntimeExports.jsx("stop",{offset:"100%",stopColor:"#C9A962",stopOpacity:"0.3"})]})}),jsxRuntimeExports.jsx("path",{d:`M 0 5
               Q 40 5, 70 4.25
               Q 100 3.5, 140 3
               Q 180 3.5, 210 4.25
               Q 240 5, 280 5
               Q 240 5, 210 5.75
               Q 180 6.5, 140 7
               Q 100 6.5, 70 5.75
               Q 40 5, 0 5
               Z`,fill:"url(#underlineGold)"})]}),jsxRuntimeExports.jsx("p",{className:"text-lg text-[#4a4a4a] mb-10",children:"Your personal onset assistant"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center w-full max-w-md mb-12",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center flex-1",children:[jsxRuntimeExports.jsxs("svg",{className:"w-14 h-14 mb-3",viewBox:"0 0 56 56",fill:"none",children:[jsxRuntimeExports.jsx("path",{d:"M4 18C4 15.79 5.79 14 8 14H14L18 8H38L42 14H48C50.21 14 52 15.79 52 18V44C52 46.21 50.21 48 48 48H8C5.79 48 4 46.21 4 44V18Z",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("circle",{cx:"28",cy:"30",r:"10",fill:"#fefcfb"}),jsxRuntimeExports.jsx("circle",{cx:"28",cy:"30",r:"5",fill:"#1a1a1a"})]}),jsxRuntimeExports.jsx("span",{className:"text-base font-serif text-[#1a1a1a]",children:"Capture"})]}),jsxRuntimeExports.jsx("div",{className:"w-px h-24 bg-[#c5c0b5]"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center flex-1",children:[jsxRuntimeExports.jsxs("svg",{className:"w-14 h-14 mb-3",viewBox:"0 0 56 56",fill:"none",children:[jsxRuntimeExports.jsx("path",{d:"M28 8C16.954 8 8 16.954 8 28c0 4.5 1.5 8.6 4 12",stroke:"#1a1a1a",strokeWidth:"4",strokeLinecap:"round",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M28 48c11.046 0 20-8.954 20-20 0-4.5-1.5-8.6-4-12",stroke:"#1a1a1a",strokeWidth:"4",strokeLinecap:"round",fill:"none"}),jsxRuntimeExports.jsx("polygon",{points:"4,36 14,44 16,32",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("polygon",{points:"52,20 42,12 40,24",fill:"#1a1a1a"})]}),jsxRuntimeExports.jsx("span",{className:"text-base font-serif text-[#1a1a1a]",children:"Track"})]}),jsxRuntimeExports.jsx("div",{className:"w-px h-24 bg-[#c5c0b5]"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center flex-1",children:[jsxRuntimeExports.jsxs("svg",{className:"w-14 h-14 mb-3",viewBox:"0 0 56 56",fill:"none",children:[jsxRuntimeExports.jsx("circle",{cx:"28",cy:"14",r:"8",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("path",{d:"M14 48v-10c0-7.732 6.268-14 14-14s14 6.268 14 14v10",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("circle",{cx:"10",cy:"20",r:"6",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("path",{d:"M0 48v-8c0-5.523 4.477-10 10-10 2.5 0 4.8.9 6.5 2.4",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("circle",{cx:"46",cy:"20",r:"6",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("path",{d:"M56 48v-8c0-5.523-4.477-10-10-10-2.5 0-4.8.9-6.5 2.4",fill:"#1a1a1a"})]}),jsxRuntimeExports.jsx("span",{className:"text-base font-serif text-[#1a1a1a]",children:"Collaborate"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-8 pb-10 space-y-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>es("signin"),className:`w-full h-14 rounded font-semibold text-lg transition-all duration-200
            bg-gradient-to-b from-[#E2C87D] via-[#C9A962] to-[#A8893D] text-white active:scale-[0.98] shadow-md`,children:"Sign In"}),jsxRuntimeExports.jsx("button",{onClick:()=>es("signup"),className:`w-full h-14 rounded font-semibold text-lg transition-all duration-200
            border border-[#1a1a1a] text-[#1a1a1a] bg-[#fefcfb] active:scale-[0.98]`,children:"Create Account"}),jsxRuntimeExports.jsxs("div",{className:"pt-8 flex items-center justify-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-[#c5c0b5]"}),jsxRuntimeExports.jsx("button",{className:"text-sm text-[#7a7a7a] hover:text-[#4a4a4a] transition-colors whitespace-nowrap",onClick:()=>es("join"),children:"Join with Project Code"}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-[#c5c0b5]"})]})]})]})}function SignInScreen(){const{setScreen:es,goBack:ts,signIn:ss,isLoading:rs,error:ns,clearError:os}=useAuthStore(),[as,ls]=reactExports.useState(""),[cs,us]=reactExports.useState(""),[ds,ms]=reactExports.useState(!1),[ps,hs]=reactExports.useState(!1),[xs,ys]=reactExports.useState(!1),[vs,gs]=reactExports.useState(null),fs=async Ss=>{Ss.preventDefault(),os(),as.trim()&&cs&&await ss(as.trim(),cs)},js=as.trim()&&cs;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:ts,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Welcome back"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Sign in to access your projects"}),jsxRuntimeExports.jsxs("form",{onSubmit:fs,className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{type:"email",label:"Email",placeholder:"your@email.com",value:as,onChange:Ss=>ls(Ss.target.value),autoComplete:"email",autoCapitalize:"none",disabled:rs}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{type:ds?"text":"password",label:"Password",placeholder:"Enter your password",value:cs,onChange:Ss=>us(Ss.target.value),autoComplete:"current-password",disabled:rs}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ms(!ds),className:"absolute right-3 top-8 text-text-muted hover:text-text-secondary",tabIndex:-1,children:ds?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"}),jsxRuntimeExports.jsx("path",{d:"M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"}),jsxRuntimeExports.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),(ns||vs)&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:ns||vs})}),jsxRuntimeExports.jsx("div",{className:"text-right",children:jsxRuntimeExports.jsx("button",{type:"button",className:"text-sm text-gold hover:underline",disabled:xs,onClick:async()=>{if(!as.trim()){gs('Enter your email address first, then tap "Forgot password?"');return}ys(!0),hs(!1),gs(null),os();const{error:Ss}=await resetPassword(as.trim());ys(!1),Ss?gs(Ss.message):hs(!0)},children:xs?"Sending...":"Forgot password?"})}),ps&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-700",children:["Password reset link sent to ",as,". Check your inbox."]})}),jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,size:"lg",disabled:!js||rs,children:rs?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Signing in..."]}):"Sign In"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-6 pb-safe-bottom text-center",children:jsxRuntimeExports.jsxs("p",{className:"text-text-secondary",children:["Don't have an account?"," ",jsxRuntimeExports.jsx("button",{onClick:()=>es("signup"),className:"text-gold font-medium hover:underline",children:"Sign up"})]})})]})}function SignUpScreen(){const{setScreen:es,goBack:ts,signUp:ss,isLoading:rs,error:ns,clearError:os}=useAuthStore(),[as,ls]=reactExports.useState(""),[cs,us]=reactExports.useState(""),[ds,ms]=reactExports.useState(""),[ps,hs]=reactExports.useState(""),[xs,ys]=reactExports.useState(!1),[vs,gs]=reactExports.useState({}),fs=()=>{const bs={};return as.trim()||(bs.name="Name is required"),cs.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(cs)||(bs.email="Please enter a valid email"):bs.email="Email is required",ds?ds.length<8&&(bs.password="Password must be at least 8 characters"):bs.password="Password is required",ps?ds!==ps&&(bs.confirmPassword="Passwords do not match"):bs.confirmPassword="Please confirm your password",gs(bs),Object.keys(bs).length===0},js=async bs=>{bs.preventDefault(),os(),fs()&&await ss(as.trim(),cs.trim(),ds)},Ss=as.trim()&&cs.trim()&&ds&&ps;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:ts,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4 overflow-y-auto",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Create account"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Join Checks Happy and start tracking"}),jsxRuntimeExports.jsxs("form",{onSubmit:js,className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{type:"text",label:"Name",placeholder:"Your name",value:as,onChange:bs=>{ls(bs.target.value),vs.name&&gs(Es=>({...Es,name:void 0}))},autoComplete:"name",disabled:rs,error:vs.name}),jsxRuntimeExports.jsx(Input,{type:"email",label:"Email",placeholder:"your@email.com",value:cs,onChange:bs=>{us(bs.target.value),vs.email&&gs(Es=>({...Es,email:void 0}))},autoComplete:"email",autoCapitalize:"none",disabled:rs,error:vs.email}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{type:xs?"text":"password",label:"Password",placeholder:"At least 8 characters",value:ds,onChange:bs=>{ms(bs.target.value),vs.password&&gs(Es=>({...Es,password:void 0}))},autoComplete:"new-password",disabled:rs,error:vs.password}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ys(!xs),className:"absolute right-3 top-8 text-text-muted hover:text-text-secondary",tabIndex:-1,children:xs?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"}),jsxRuntimeExports.jsx("path",{d:"M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"}),jsxRuntimeExports.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),jsxRuntimeExports.jsx(Input,{type:xs?"text":"password",label:"Confirm Password",placeholder:"Re-enter your password",value:ps,onChange:bs=>{hs(bs.target.value),vs.confirmPassword&&gs(Es=>({...Es,confirmPassword:void 0}))},autoComplete:"new-password",disabled:rs,error:vs.confirmPassword}),ns&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:ns})}),jsxRuntimeExports.jsx("div",{className:"pt-2",children:jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,size:"lg",disabled:!Ss||rs,children:rs?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Creating account..."]}):"Create Account"})})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-6 pb-safe-bottom text-center",children:jsxRuntimeExports.jsxs("p",{className:"text-text-secondary",children:["Already have an account?"," ",jsxRuntimeExports.jsx("button",{onClick:()=>es("signin"),className:"text-gold font-medium hover:underline",children:"Sign in"})]})})]})}function JoinProjectScreen(){const{setScreen:es,goBack:ts,joinProject:ss,isLoading:rs,error:ns,clearError:os,isAuthenticated:as}=useAuthStore(),[ls,cs]=reactExports.useState(""),[us,ds]=reactExports.useState(null),ms=ys=>{const vs=formatProjectCode(ys.target.value);cs(vs),ns&&os()},ps=async ys=>{if(ys.preventDefault(),os(),ds(null),!isValidProjectCode(ls))return;const vs=await ss(ls);vs.success&&vs.projectName&&ds({projectName:vs.projectName})},hs=isValidProjectCode(ls),xs=us&&!as;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:ts,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 px-6 pt-4",children:xs?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-green-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M20 6L9 17l-5-5"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-text-primary mb-2",children:"You're in!"}),jsxRuntimeExports.jsxs("p",{className:"text-text-secondary text-center mb-8",children:["Joined ",jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:us.projectName})]}),jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"lg",onClick:()=>{es("hub")},children:"Open Project"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Join a Team"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Enter the project code shared by your supervisor"}),jsxRuntimeExports.jsxs("div",{className:"mb-8",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Project Code"}),jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"ABC-1234",value:ls,onChange:ms,className:"text-center text-2xl tracking-[0.2em] font-mono uppercase",maxLength:8,disabled:rs,autoComplete:"off",autoCapitalize:"characters"})}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-xs text-text-muted text-center",children:"Format: ABC-1234"})]}),ns&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg mb-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:ns})}),jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"lg",disabled:!hs||rs,onClick:ps,children:rs?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Joining..."]}):"Join"}),jsxRuntimeExports.jsx("div",{className:"mt-8 p-4 bg-gold-50 border border-gold-200 rounded-xl",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("path",{d:"M12 16v-4"}),jsxRuntimeExports.jsx("path",{d:"M12 8h.01"})]})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("p",{className:"text-sm text-gold-800",children:as?"The project will be added to your hub.":"You can join without an account. Create one later to access multiple projects."})})]})})]})}),!xs&&!as&&jsxRuntimeExports.jsx("div",{className:"px-6 py-6 pb-safe-bottom text-center",children:jsxRuntimeExports.jsxs("p",{className:"text-text-secondary",children:["Want to manage multiple projects?"," ",jsxRuntimeExports.jsx("button",{onClick:()=>es("signup"),className:"text-gold font-medium hover:underline",children:"Create an account"})]})})]})}function UpgradeModal({isOpen:es,onClose:ts,onUpgrade:ss}){return jsxRuntimeExports.jsx(Modal,{isOpen:es,onClose:ts,title:"Upgrade to Create Projects",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gold-50 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),jsxRuntimeExports.jsxs("p",{className:"text-text-secondary mb-6",children:["Creating projects requires a"," ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-text-primary",children:"Supervisor"})," or"," ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-text-primary",children:"Designer"})," subscription."]}),jsxRuntimeExports.jsxs("div",{className:"bg-gold-50/50 rounded-lg p-4 mb-6 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary mb-2",children:"With Supervisor or higher, you can:"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-1.5 text-sm text-text-secondary",children:[jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Create and manage projects"]}),jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Generate team invite codes"]}),jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Team management tools"]}),jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"1000+ photos per project"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"lg",variant:"primary",onClick:ss,children:"Upgrade Now"}),jsxRuntimeExports.jsx("button",{onClick:ts,className:"w-full py-2 text-sm text-text-muted hover:text-text-secondary",children:"Not now"})]})]})})}const formatRelativeTime=es=>{const ts=new Date,ss=new Date(es),rs=ts.getTime()-ss.getTime(),ns=Math.floor(rs/6e4),os=Math.floor(ns/60),as=Math.floor(os/24);return ns<1?"Just now":ns<60?`${ns}m ago`:os<24?`${os}h ago`:as===1?"Yesterday":as<7?`${as}d ago`:ss.toLocaleDateString()},getRoleLabel=es=>({owner:"Owner",designer:"Designer",hod:"HOD",supervisor:"Supervisor",key:"Key",floor:"Floor",daily:"Daily",trainee:"Trainee",artist:"Artist",viewer:"Viewer"})[es]||es,getTypeLabel=es=>({film:"Feature Film",tv_series:"TV Series",short_film:"Short Film",commercial:"Commercial",music_video:"Music Video",other:"Production"})[es]||"Production";function createProjectFromMembership(es){return{id:es.projectId,name:es.projectName,createdAt:es.joinedAt,updatedAt:es.lastAccessedAt,scenes:[],characters:[],looks:[]}}function DeleteProjectModal({isOpen:es,onClose:ts,onConfirm:ss,projectName:rs,isOwner:ns,isLoading:os}){return es?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center px-4 pb-8",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:ts}),jsxRuntimeExports.jsxs("div",{className:"relative bg-card rounded-2xl p-5 max-w-sm w-full shadow-xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1.5",children:ns?"Delete project?":"Leave project?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mb-5",children:ns?`This will permanently delete "${rs}" and all its data for everyone.`:`You'll need a new invite code to rejoin "${rs}".`}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ts,disabled:os,className:"flex-1 h-11 rounded-xl border border-border text-sm font-medium text-text-primary active:scale-[0.98] transition-transform",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:ss,disabled:os,className:"flex-1 h-11 rounded-xl bg-red-600 text-sm font-medium text-white active:scale-[0.98] transition-transform",children:os?"Deleting...":ns?"Delete":"Leave"})]})]})]}):null}function ProjectMenu({isOpen:es,onClose:ts,onSettings:ss,onDelete:rs,isOwner:ns}){return es?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-40",onClick:ts}),jsxRuntimeExports.jsxs("div",{className:"absolute right-0 top-full mt-1 z-50 bg-card rounded-xl shadow-lg border border-border py-1 min-w-[160px]",children:[ss&&jsxRuntimeExports.jsx("button",{onClick:()=>{ss(),ts()},className:"w-full text-left px-4 py-2.5 text-sm text-text-primary hover:bg-gray-50 transition-colors",children:"Settings"}),jsxRuntimeExports.jsx("button",{onClick:()=>{rs(),ts()},className:"w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors",children:ns?"Delete project":"Leave project"})]})]}):null}function ProjectHubScreen(){const{user:es,setScreen:ts,goBack:ss,signOut:rs,projectMemberships:ns,canCreateProjects:os,updateLastAccessed:as,hasCompletedOnboarding:ls,deleteProject:cs,leaveProject:us,isLoading:ds,setSettingsProjectId:ms}=useAuthStore(),[ps,hs]=reactExports.useState(!1),[xs,ys]=reactExports.useState(null),[vs,gs]=reactExports.useState(null),fs=[...ns].sort((ks,_s)=>new Date(_s.lastAccessedAt).getTime()-new Date(ks.lastAccessedAt).getTime()),js=fs.length>0?fs[0]:null,Ss=fs.slice(1),bs=ks=>{var Os;as(ks.projectId);const _s=useProjectStore.getState();if(_s.hasSavedProject(ks.projectId)){_s.restoreSavedProject(ks.projectId),_s.setActiveTab("today");return}if(((Os=_s.currentProject)==null?void 0:Os.id)===ks.projectId){_s.setActiveTab("today");return}if(_s.currentProject&&_s.currentProject.scenes.length>0){const zs={..._s.currentProject,id:ks.projectId,name:ks.projectName};_s.setProject(zs),_s.setActiveTab("today");return}const Ls=createProjectFromMembership(ks);_s.setProjectNeedsSetup(Ls),_s.setActiveTab("today")},Es=()=>{os()?ts("create-project"):hs(!0)},Rs=async()=>{var Ls;if(!xs)return;if((xs.role==="owner"?await cs(xs.projectId):await us(xs.projectId)).success){const Os=useProjectStore.getState();((Ls=Os.currentProject)==null?void 0:Ls.id)===xs.projectId&&Os.clearProject(),Os.hasSavedProject(xs.projectId)&&Os.removeSavedProject(xs.projectId),ys(null)}},ws=()=>{if(!(es!=null&&es.name))return"?";const ks=es.name.split(" ");return ks.length>=2?`${ks[0][0]}${ks[1][0]}`.toUpperCase():es.name.slice(0,2).toUpperCase()},Ns=ks=>ks==="owner"||ks==="supervisor";return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[!ls&&jsxRuntimeExports.jsx("button",{onClick:ss,className:"w-9 h-9 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2",children:jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})}),jsxRuntimeExports.jsx("h1",{className:"text-[17px] font-bold text-text-primary",children:"Projects"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>ts("profile"),className:"w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center text-gold text-xs font-bold active:scale-95 transition-transform",children:ws()})]})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-4",children:fs.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-16 px-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-2xl bg-card border border-border flex items-center justify-center mb-5",children:jsxRuntimeExports.jsx("svg",{className:"w-7 h-7 text-text-muted",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold text-text-primary mb-1",children:"No projects yet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-8 max-w-[240px]",children:"Create a new project or join your team with an invite code."}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[280px] space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:Es,className:"w-full h-11 rounded-xl gold-gradient text-white text-sm font-medium active:scale-[0.98] transition-transform",children:"Create Project"}),jsxRuntimeExports.jsx("button",{onClick:()=>ts("join"),className:"w-full h-11 rounded-xl border border-border text-sm font-medium text-text-primary active:scale-[0.98] transition-transform",children:"Join with Code"})]})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[js&&jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"text-[11px] font-medium tracking-wider text-text-muted uppercase mb-2.5",children:"Current"}),jsxRuntimeExports.jsxs("button",{onClick:()=>bs(js),className:"w-full text-left bg-card rounded-2xl p-4 shadow-sm border border-border active:scale-[0.99] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary leading-tight pr-2",children:js.projectName}),jsxRuntimeExports.jsxs("div",{className:"relative flex-shrink-0",onClick:ks=>ks.stopPropagation(),children:[jsxRuntimeExports.jsx("button",{onClick:ks=>{ks.stopPropagation(),gs(vs===js.projectId?null:js.projectId)},className:"w-7 h-7 flex items-center justify-center rounded-lg hover:bg-gray-100 -mr-1 -mt-0.5",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-text-muted",viewBox:"0 0 24 24",fill:"currentColor",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"5",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"19",r:"1.5"})]})}),jsxRuntimeExports.jsx(ProjectMenu,{isOpen:vs===js.projectId,onClose:()=>gs(null),onSettings:Ns(js.role)?()=>{ms(js.projectId),ts("project-settings")}:void 0,onDelete:()=>ys(js),isOwner:js.role==="owner"})]})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[getTypeLabel(js.productionType),jsxRuntimeExports.jsx("span",{className:"mx-1.5 text-text-light",children:""}),getRoleLabel(js.role)]}),(js.sceneCount>0||js.teamMemberCount>0)&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-1.5",children:[js.sceneCount>0&&`${js.sceneCount} scene${js.sceneCount!==1?"s":""}`,js.sceneCount>0&&js.teamMemberCount>0&&jsxRuntimeExports.jsx("span",{className:"mx-1.5 text-text-light",children:""}),js.teamMemberCount>0&&`${js.teamMemberCount} team`]})]})]}),Ss.length>0&&jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"text-[11px] font-medium tracking-wider text-text-muted uppercase mb-2.5",children:"Other Projects"}),jsxRuntimeExports.jsx("div",{className:"bg-card rounded-2xl border border-border overflow-hidden divide-y divide-border",children:Ss.map(ks=>jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsxs("button",{onClick:()=>bs(ks),className:"w-full text-left px-4 py-3.5 flex items-center justify-between active:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-medium text-text-primary truncate",children:ks.projectName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-0.5",children:[getTypeLabel(ks.productionType),jsxRuntimeExports.jsx("span",{className:"mx-1.5 text-text-light",children:""}),formatRelativeTime(ks.lastAccessedAt)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 ml-3 flex-shrink-0",children:[jsxRuntimeExports.jsxs("div",{onClick:_s=>_s.stopPropagation(),className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:_s=>{_s.stopPropagation(),gs(vs===ks.projectId?null:ks.projectId)},className:"w-7 h-7 flex items-center justify-center rounded-lg hover:bg-gray-100",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-text-muted",viewBox:"0 0 24 24",fill:"currentColor",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"5",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"19",r:"1.5"})]})}),jsxRuntimeExports.jsx(ProjectMenu,{isOpen:vs===ks.projectId,onClose:()=>gs(null),onSettings:Ns(ks.role)?()=>{ms(ks.projectId),ts("project-settings")}:void 0,onDelete:()=>ys(ks),isOwner:ks.role==="owner"})]}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-light",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:jsxRuntimeExports.jsx("path",{d:"M9 18l6-6-6-6"})})]})]})},ks.projectId))})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-5 pt-2 pb-4",children:[jsxRuntimeExports.jsxs("button",{onClick:Es,className:"flex items-center gap-1.5 text-sm font-medium text-gold active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[jsxRuntimeExports.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),jsxRuntimeExports.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Create"]}),jsxRuntimeExports.jsx("div",{className:"w-px h-4 bg-border"}),jsxRuntimeExports.jsxs("button",{onClick:()=>ts("join"),className:"flex items-center gap-1.5 text-sm font-medium text-text-secondary active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),jsxRuntimeExports.jsx("polyline",{points:"10 17 15 12 10 7"}),jsxRuntimeExports.jsx("line",{x1:"15",y1:"12",x2:"3",y2:"12"})]}),"Join"]})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-3 pb-safe-bottom",children:jsxRuntimeExports.jsx("button",{onClick:rs,className:"w-full text-center text-xs text-text-muted active:opacity-70 transition-opacity",children:"Sign out"})}),jsxRuntimeExports.jsx(UpgradeModal,{isOpen:ps,onClose:()=>hs(!1),onUpgrade:()=>{hs(!1),ts("select-plan")}}),jsxRuntimeExports.jsx(DeleteProjectModal,{isOpen:xs!==null,onClose:()=>ys(null),onConfirm:Rs,projectName:(xs==null?void 0:xs.projectName)||"",isOwner:(xs==null?void 0:xs.role)==="owner",isLoading:ds})]})}function CreateProjectScreen(){const{goBack:es,createProject:ts,isLoading:ss,error:rs,clearError:ns}=useAuthStore(),[os,as]=reactExports.useState(""),[ls,cs]=reactExports.useState("film"),us=async ms=>{if(ms.preventDefault(),ns(),!os.trim())return;const ps=await ts(os.trim(),ls);if(ps.success&&ps.code){const{projectMemberships:hs}=useAuthStore.getState(),xs=hs.find(ys=>ys.projectCode===ps.code);if(xs){const ys={id:xs.projectId,name:xs.projectName,createdAt:xs.joinedAt,updatedAt:xs.lastAccessedAt,scenes:[],characters:[],looks:[]};useProjectStore.getState().setProjectNeedsSetup(ys)}}},ds=os.trim();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:es,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Create Project"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Set up a new production for your team"}),jsxRuntimeExports.jsxs("form",{onSubmit:us,className:"space-y-6",children:[jsxRuntimeExports.jsx(Input,{type:"text",label:"Production Name",placeholder:"e.g., The Crown S6",value:os,onChange:ms=>as(ms.target.value),disabled:ss,autoComplete:"off"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Production Type"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-2",children:PRODUCTION_TYPES.map(ms=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>cs(ms.value),className:`px-4 py-3 rounded-lg border text-sm font-medium transition-colors ${ls===ms.value?"border-gold bg-gold-50 text-gold":"border-border bg-card text-text-secondary hover:border-gold-300"}`,children:ms.label},ms.value))})]}),rs&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:rs})}),jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,size:"lg",disabled:!ds||ss,children:ss?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Creating..."]}):"Create Project"})]})]})]})}function FeatureList({features:es,variant:ts="default",showCheckmarks:ss=!0}){return jsxRuntimeExports.jsx("ul",{className:clsx("space-y-2",ts==="compact"&&"space-y-1.5"),children:es.map((rs,ns)=>jsxRuntimeExports.jsxs("li",{className:clsx("flex items-start gap-2",ts==="compact"?"text-xs":"text-sm","text-text-secondary"),children:[ss&&jsxRuntimeExports.jsx("span",{className:"flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsx("svg",{className:clsx("text-gold",ts==="compact"?"w-3.5 h-3.5":"w-4 h-4"),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}),jsxRuntimeExports.jsx("span",{children:rs})]},ns))})}function FeatureLossList({features:es}){return es.length===0?null:jsxRuntimeExports.jsx("ul",{className:"space-y-2",children:es.map((ts,ss)=>jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2 text-sm text-red-600",children:[jsxRuntimeExports.jsx("span",{className:"flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),jsxRuntimeExports.jsx("span",{children:ts})]},ss))})}function TierCard({tier:es,billingPeriod:ts,isSelected:ss=!1,isCurrentPlan:rs=!1,onSelect:ns,disabled:os=!1}){const{id:as,name:ls,description:cs,pricing:us,featureList:ds,isPopular:ms,isPremium:ps}=es,hs=()=>as==="trainee"||ts!=="yearly"?null:`${formatMonthlyEquivalent(us.yearly,us.currencySymbol)}/mo`,xs=()=>rs?"Current Plan":as==="trainee"?"Start Free":"Subscribe",ys=()=>ss||rs?"primary":"outline";return hs(),jsxRuntimeExports.jsxs("div",{className:clsx("relative rounded-xl p-4 transition-all duration-200","border-2",{"border-gold bg-gold-50/50":ss&&!rs,"border-gold bg-gold-50/30":rs,"border-gold/30 bg-gradient-to-br from-gold-50/20 to-transparent":ps&&!ss&&!rs,"border-border bg-card":!ss&&!rs&&!ps,"hover:border-gold/50":!ss&&!rs}),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[ms&&jsxRuntimeExports.jsx(Badge,{variant:"gold",size:"md",children:"Most Popular"}),ps&&jsxRuntimeExports.jsx(Badge,{variant:"gold",size:"md",children:"Premium"}),rs&&jsxRuntimeExports.jsx(Badge,{variant:"success",size:"md",children:"Current Plan"})]}),jsxRuntimeExports.jsx("h3",{className:clsx("text-lg font-bold mb-1",ps?"gold-text-gradient":"text-text-primary"),children:ls}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mb-4",children:cs}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-gold",children:"Beta Access"}),jsxRuntimeExports.jsx(Badge,{variant:"gold",size:"sm",children:"Free"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Full access during beta testing"})]}),jsxRuntimeExports.jsx(FeatureList,{features:ds}),jsxRuntimeExports.jsx(Button,{variant:ys(),size:"md",fullWidth:!0,onClick:()=>ns(as),disabled:os||rs,className:"mt-4",children:xs()}),ss&&!rs&&jsxRuntimeExports.jsx("div",{className:"absolute top-3 right-3",children:jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-gold flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})})})]})}const COMPARISON_FEATURES=[{label:"Photos per project",trainee:"50",artist:"500",supervisor:"1,000",designer:"Unlimited"},{label:"Projects",trainee:"3",artist:"10",supervisor:"25",designer:"Unlimited"},{label:"Archived projects",trainee:"1",artist:"Unlimited",supervisor:"15",designer:"Unlimited"},{label:"Offline mode",trainee:!1,artist:!0,supervisor:!0,designer:!0},{label:"Export PDF reports",trainee:!1,artist:!0,supervisor:!0,designer:!0},{label:"Personal templates",trainee:!1,artist:!0,supervisor:!0,designer:!0},{label:"Create projects",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Team management",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Team invite codes",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Character progression",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Shooting schedule",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Team photo storage",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Desktop web access",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Pre-production breakdown",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Character design docs",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Production books export",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Budget & scheduling",trainee:!1,artist:!1,supervisor:!1,designer:!0}],tierOrder=["trainee","artist","supervisor","designer"];function CheckIcon(){return jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}function CrossIcon(){return jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-text-muted",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function ComparisonModal({isOpen:es,onClose:ts,currentTier:ss}){const rs=SUBSCRIPTION_TIERS,ns=(os,as)=>typeof os=="boolean"?os?jsxRuntimeExports.jsx(CheckIcon,{}):jsxRuntimeExports.jsx(CrossIcon,{}):jsxRuntimeExports.jsx("span",{className:clsx("text-xs font-medium",as===ss?"text-gold":"text-text-secondary"),children:os});return jsxRuntimeExports.jsxs(BottomSheet,{isOpen:es,onClose:ts,title:"Compare Plans",height:"full",children:[jsxRuntimeExports.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:jsxRuntimeExports.jsxs("table",{className:"w-full min-w-[500px]",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"border-b border-border",children:[jsxRuntimeExports.jsx("th",{className:"text-left py-3 pr-4 text-xs font-semibold text-text-muted uppercase tracking-wide",children:"Feature"}),rs.map(os=>jsxRuntimeExports.jsxs("th",{className:clsx("text-center py-3 px-2 text-xs font-bold uppercase tracking-wide",os.id===ss?"text-gold":"text-text-primary"),children:[os.name,os.id===ss&&jsxRuntimeExports.jsx("div",{className:"text-[9px] text-gold font-normal mt-0.5",children:"Current"})]},os.id))]})}),jsxRuntimeExports.jsxs("tbody",{children:[jsxRuntimeExports.jsxs("tr",{className:"border-b border-border bg-gold-50/30",children:[jsxRuntimeExports.jsx("td",{className:"py-3 pr-4 text-sm font-medium text-text-primary",children:"Beta Access"}),rs.map(os=>jsxRuntimeExports.jsx("td",{className:clsx("text-center py-3 px-2",os.id===ss?"bg-gold-50/50":""),children:jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-gold",children:"Free"})},os.id))]}),COMPARISON_FEATURES.map((os,as)=>jsxRuntimeExports.jsxs("tr",{className:clsx("border-b border-border",as%2===0?"bg-transparent":"bg-input-bg/30"),children:[jsxRuntimeExports.jsx("td",{className:"py-2.5 pr-4 text-sm text-text-secondary",children:os.label}),tierOrder.map(ls=>jsxRuntimeExports.jsx("td",{className:clsx("text-center py-2.5 px-2",ls===ss?"bg-gold-50/30":""),children:jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:ns(os[ls],ls)})},ls))]},os.label))]})]})}),jsxRuntimeExports.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center",children:"All features available during beta testing. Thank you for testing!"})})]})}function SelectPlanScreen({isOnboarding:es=!0,currentTier:ts,onSelectTier:ss,onSkip:rs,onBack:ns,isLoading:os=!1}){const[as,ls]=reactExports.useState(es?null:ts||null),[cs,us]=reactExports.useState("monthly"),[ds,ms]=reactExports.useState(!1),[ps,hs]=reactExports.useState(!1),xs=ts&&as&&isTierHigher(ts,as)?getDowngradeWarnings(ts,as):[],ys=bs=>{ls(bs),ts&&isTierHigher(ts,bs)?hs(!0):hs(!1)},vs=()=>{as&&ss&&ss(as,cs)},gs=()=>{rs?rs():ss&&ss("trainee","monthly")},fs=as!==null&&!os,js=ts&&as&&isTierHigher(as,ts),Ss=ts&&as&&isTierHigher(ts,as);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsxs("header",{className:"flex items-center px-4 py-3 safe-top border-b border-border bg-card",children:[ns&&jsxRuntimeExports.jsx("button",{onClick:ns,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})}),jsxRuntimeExports.jsx("div",{className:clsx("flex-1",ns?"text-center pr-10":"text-center"),children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-text-primary",children:"Choose Your Plan"})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 pt-4 pb-2 text-center",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary",children:"All features are available during beta testing. Select your preferred tier."})}),!BETA_MODE,jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4",children:[jsxRuntimeExports.jsx("div",{className:"space-y-4 max-w-md mx-auto",children:SUBSCRIPTION_TIERS.map(bs=>jsxRuntimeExports.jsx(TierCard,{tier:bs,billingPeriod:cs,isSelected:as===bs.id,isCurrentPlan:ts===bs.id,onSelect:ys,disabled:os},bs.id))}),jsxRuntimeExports.jsx("div",{className:"text-center mt-6",children:jsxRuntimeExports.jsx("button",{onClick:()=>ms(!0),className:"text-sm text-gold font-medium hover:underline",children:"Compare all features"})}),jsxRuntimeExports.jsxs("div",{className:"mt-6 text-center space-y-1",children:[jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Full access during beta"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Thank you for testing!"})]}),jsxRuntimeExports.jsx("button",{className:"text-xs text-gold hover:underline",children:"Questions? Contact us"})]}),ps&&xs.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg max-w-md mx-auto",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-semibold text-red-700 mb-2",children:"You'll lose access to:"}),jsxRuntimeExports.jsx(FeatureLossList,{features:xs}),jsxRuntimeExports.jsx("p",{className:"text-xs text-red-600 mt-3",children:"Changes take effect at the end of your billing period."})]})]}),jsxRuntimeExports.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 pb-safe-bottom bg-card border-t border-border",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:vs,disabled:!fs,children:os?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Processing..."]}):as==="trainee"?"Start Free":Ss?"Downgrade Plan":js?"Upgrade Plan":as?"Subscribe":"Select a Plan"}),es&&jsxRuntimeExports.jsx("button",{onClick:gs,className:"w-full text-center text-sm text-text-muted hover:text-text-secondary",disabled:os,children:"Continue with Free for now"}),!es&&ts&&ts!=="trainee"&&jsxRuntimeExports.jsx("button",{className:"w-full text-center text-sm text-gold hover:underline",children:"Manage billing"})]})}),jsxRuntimeExports.jsx(ComparisonModal,{isOpen:ds,onClose:()=>ms(!1),currentTier:ts})]})}initSyncSubscriptions();function ConfigurationError(){return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md text-center space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"text-6xl",children:""}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"Configuration Required"}),jsxRuntimeExports.jsxs("p",{className:"text-muted-foreground",children:["The application is missing required environment variables. Please ensure",jsxRuntimeExports.jsx("code",{className:"mx-1 px-1.5 py-0.5 bg-muted rounded text-sm",children:"VITE_SUPABASE_URL"}),"and",jsxRuntimeExports.jsx("code",{className:"mx-1 px-1.5 py-0.5 bg-muted rounded text-sm",children:"VITE_SUPABASE_ANON_KEY"}),"are configured in your deployment environment."]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground/70",children:"If you're the administrator, check your Vercel environment variables or .env file."})]})})}function AppContent(){var Js;if(!isSupabaseConfigured)return jsxRuntimeExports.jsx(ConfigurationError,{});const{currentProject:es,activeTab:ts,setActiveTab:ss,currentSceneId:rs,currentLookId:ns,setCurrentScene:os,setCurrentCharacter:as,setCurrentLook:ls,checkWrapTrigger:cs,lifecycle:us,updateActivity:ds,needsSetup:ms,clearNeedsSetup:ps}=useProjectStore(),{isAuthenticated:hs,hasCompletedOnboarding:xs,currentScreen:ys,guestProjectCode:vs,selectTier:gs,setScreen:fs,goBack:js,user:Ss,settingsProjectId:bs,setSettingsProjectId:Es}=useAuthStore(),[Rs,ws]=reactExports.useState(!1),[Ns,ks]=reactExports.useState(!1),[_s,Ls]=reactExports.useState(!1),Os=reactExports.useRef(!1);reactExports.useEffect(()=>{if(Os.current)return;Os.current=!0,migrateToIndexedDB().then(({migrated:dr,errors:br})=>{dr.length>0&&console.log("[Storage] Migrated to IndexedDB:",dr),br.length>0&&console.warn("[Storage] Migration errors:",br)}).catch(dr=>{console.error("[Storage] Migration failed:",dr)});const Zs=()=>{flushPendingWrites()};return window.addEventListener("beforeunload",Zs),()=>window.removeEventListener("beforeunload",Zs)},[]);const[zs,qs]=reactExports.useState(0),[Qs,Ys]=reactExports.useState(void 0);reactExports.useEffect(()=>{xs&&!hs&&!es&&!vs&&fs("hub")},[xs,hs,es,vs,fs]);const Ws=reactExports.useMemo(()=>(es==null?void 0:es.scenes.filter(Zs=>Zs.isComplete).length)??0,[es==null?void 0:es.scenes]);reactExports.useEffect(()=>{es&&cs()},[es,Ws,cs]),reactExports.useEffect(()=>{es&&ds()},[es,rs,ts,ds]);const Is=reactExports.useRef(null);reactExports.useEffect(()=>(es&&es.id!==Is.current&&(Is.current=es.id,startSync(es.id,Ss==null?void 0:Ss.id)),!es&&Is.current&&(Is.current=null,stopSync()),()=>{Is.current&&stopSync()}),[es==null?void 0:es.id,Ss==null?void 0:Ss.id]);const{schedule:Bs,isProcessingStage2:Vs,startStage2Processing:Ds}=useScheduleStore(),{syncCastDataFromSchedule:Cs}=useProjectStore(),Ts=reactExports.useRef(!1);reactExports.useEffect(()=>{Bs&&!Vs&&(!Bs.days||Bs.days.length===0)&&Bs.rawText&&!Ts.current&&(Ts.current=!0,console.log("[App] Starting background schedule Stage 2 processing..."),Ds())},[Bs,Vs,Ds]);const $s=reactExports.useRef(null);reactExports.useEffect(()=>{if(Bs&&Bs.status==="complete"&&!Vs&&Bs.days&&Bs.days.length>0&&es&&$s.current!==Bs.id){$s.current=Bs.id;const Zs=useScheduleStore.getState().schedule;Zs&&(console.log("[App] Schedule processing complete, auto-syncing cast data..."),Cs(Zs,{createMissingCharacters:!0,overwriteExisting:!1,autoConfirm:!0}))}},[Bs==null?void 0:Bs.status,(Js=Bs==null?void 0:Bs.days)==null?void 0:Js.length,Bs==null?void 0:Bs.id,Vs,es,Cs]);const Ps=()=>{ws(!1),ps(),ss("today"),Ls(!0)},Fs=()=>{stopSync(),Is.current=null,useProjectStore.getState().saveAndClearProject(),ws(!1),fs("hub")},Us=()=>{ws(!0)},Gs=Zs=>{os(Zs),as(null)},hr=()=>{os(null),as(null)},ur=Zs=>{Zs===ts&&qs(dr=>dr+1),ss(Zs),Ys(void 0),rs&&(os(null),as(null)),ns&&ls(null)},[cr,Er]=reactExports.useState(!1),Nr=Zs=>{ur(Zs)},kr=async(Zs,dr)=>{await gs(Zs,dr)},mr=async()=>{await gs("trainee","monthly")};if(!xs&&!vs)switch(ys){case"welcome":return jsxRuntimeExports.jsx(WelcomeScreen,{});case"signin":return jsxRuntimeExports.jsx(SignInScreen,{});case"signup":return jsxRuntimeExports.jsx(SignUpScreen,{});case"join":return jsxRuntimeExports.jsx(JoinProjectScreen,{});case"hub":return jsxRuntimeExports.jsx(ProjectHubScreen,{});case"create-project":return jsxRuntimeExports.jsx(CreateProjectScreen,{});case"select-plan":return jsxRuntimeExports.jsx(SelectPlanScreen,{isOnboarding:!0,currentTier:Ss==null?void 0:Ss.tier,onSelectTier:kr,onSkip:mr,onBack:js});case"profile":return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:js,onNavigateToBilling:()=>fs("select-plan")});case"project-settings":return bs?jsxRuntimeExports.jsx(ProjectSettingsScreen,{projectId:bs,onBack:()=>{Es(null),fs("hub")},onProjectDeleted:()=>{Es(null),fs("hub")},onProjectArchived:()=>{Es(null),fs("hub")}}):jsxRuntimeExports.jsx(ProjectHubScreen,{});default:return jsxRuntimeExports.jsx(WelcomeScreen,{})}if(hs&&!es&&!Rs)switch(ys){case"hub":return jsxRuntimeExports.jsx(ProjectHubScreen,{});case"join":return jsxRuntimeExports.jsx(JoinProjectScreen,{});case"create-project":return jsxRuntimeExports.jsx(CreateProjectScreen,{});case"select-plan":return jsxRuntimeExports.jsx(SelectPlanScreen,{isOnboarding:!1,currentTier:Ss==null?void 0:Ss.tier,onSelectTier:kr,onBack:js});case"profile":return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:js,onNavigateToBilling:()=>fs("select-plan")});case"project-settings":return bs?jsxRuntimeExports.jsx(ProjectSettingsScreen,{projectId:bs,onBack:()=>{Es(null),fs("hub")},onProjectDeleted:()=>{Es(null),fs("hub")},onProjectArchived:()=>{Es(null),fs("hub")}}):jsxRuntimeExports.jsx(ProjectHubScreen,{});default:return jsxRuntimeExports.jsx(ProjectHubScreen,{})}if(xs&&!hs&&!es&&!vs)return jsxRuntimeExports.jsx(ProjectHubScreen,{});const xr=()=>{ws(!1),ps(),js()};if(Rs||!es||ms)return jsxRuntimeExports.jsx(Home,{onProjectReady:Ps,onBack:xr});if(Ns)return jsxRuntimeExports.jsx(ProjectExportScreen,{onBack:()=>ks(!1),onExportComplete:()=>ks(!1)});if(cr)return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:()=>Er(!1),onNavigateToBilling:()=>{Er(!1),ss("more"),Ys("billing")}});const Ms=()=>{if(rs&&(ts==="today"||ts==="breakdown"))return jsxRuntimeExports.jsx(SceneView,{sceneId:rs,onBack:hr});switch(ts){case"today":return jsxRuntimeExports.jsx(Today,{onSceneSelect:Gs,onNavigateToTab:Nr});case"breakdown":return jsxRuntimeExports.jsx(Breakdown,{onSceneSelect:Gs});case"lookbook":return jsxRuntimeExports.jsx(Lookbooks,{});case"hours":return jsxRuntimeExports.jsx(Timesheet,{});case"budget":return jsxRuntimeExports.jsx(Budget,{});case"script":case"schedule":case"callsheets":case"settings":case"more":return jsxRuntimeExports.jsx(More,{onNavigateToTab:Nr,onStartNewProject:Us,initialView:ts,resetKey:zs,subView:Qs});default:return jsxRuntimeExports.jsx(Today,{onSceneSelect:Gs,onNavigateToTab:Nr})}},Hs=!rs&&!["more","settings","script","schedule","callsheets"].includes(ts);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[us.state!=="active"&&jsxRuntimeExports.jsx(LifecycleBanner,{onExport:()=>ks(!0)}),Hs&&jsxRuntimeExports.jsx(ProjectHeader,{onSwitchProject:Fs,onNavigateToProfile:()=>Er(!0)}),Ms(),jsxRuntimeExports.jsx(BottomNav,{activeTab:ts,onTabChange:ur}),jsxRuntimeExports.jsx(ChatAssistant,{}),jsxRuntimeExports.jsx(WrapPopupModal,{onExport:()=>ks(!0)}),_s&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"pt-8 pb-4 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-text-primary mb-1",children:"You're All Set!"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted px-6",children:"Your project is ready to explore"})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-6",children:[jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 text-gold animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-text-secondary",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Schedule Processing"}),jsxRuntimeExports.jsx("p",{children:"Your schedule is being processed in the background. Character assignments will be confirmed automatically once complete."})]})]})}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-blue-50 border border-blue-100 p-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-blue-700",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Start Working Now"}),jsxRuntimeExports.jsx("p",{children:"You can browse scenes, add looks, and set up your continuity bible while the schedule finishes processing."})]})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>Ls(!1),className:"w-full py-3.5 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform",children:"Got It"})]})]})})]})}function App(){return jsxRuntimeExports.jsx(ErrorBoundary,{children:jsxRuntimeExports.jsx(AppContent,{})})}const initTheme=()=>{const ts=useThemeStore.getState().theme,ss=ts==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":ts;document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(ss);const rs=document.querySelector('meta[name="theme-color"]');rs&&rs.setAttribute("content",ss==="dark"?"#000000":"#f5f4f2")};initTheme();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(es=>{console.log("SW registration failed:",es)})});client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React$2.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
