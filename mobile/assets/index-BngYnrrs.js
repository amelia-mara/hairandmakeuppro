var Tu=Object.defineProperty;var Kl=ar=>{throw TypeError(ar)};var Au=(ar,or,lr)=>or in ar?Tu(ar,or,{enumerable:!0,configurable:!0,writable:!0,value:lr}):ar[or]=lr;var io=(ar,or,lr)=>Au(ar,typeof or!="symbol"?or+"":or,lr),Go=(ar,or,lr)=>or.has(ar)||Kl("Cannot "+lr);var Or=(ar,or,lr)=>(Go(ar,or,"read from private field"),lr?lr.call(ar):or.get(ar)),Ss=(ar,or,lr)=>or.has(ar)?Kl("Cannot add the same private member more than once"):or instanceof WeakSet?or.add(ar):or.set(ar,lr),Cs=(ar,or,lr,cr)=>(Go(ar,or,"write to private field"),cr?cr.call(ar,lr):or.set(ar,lr),lr),js=(ar,or,lr)=>(Go(ar,or,"access private method"),lr);var wo=(ar,or,lr,cr)=>({set _(ur){Cs(ar,or,ur,lr)},get _(){return Or(ar,or,cr)}});(function(){const or=document.createElement("link").relList;if(or&&or.supports&&or.supports("modulepreload"))return;for(const ur of document.querySelectorAll('link[rel="modulepreload"]'))cr(ur);new MutationObserver(ur=>{for(const dr of ur)if(dr.type==="childList")for(const hr of dr.addedNodes)hr.tagName==="LINK"&&hr.rel==="modulepreload"&&cr(hr)}).observe(document,{childList:!0,subtree:!0});function lr(ur){const dr={};return ur.integrity&&(dr.integrity=ur.integrity),ur.referrerPolicy&&(dr.referrerPolicy=ur.referrerPolicy),ur.crossOrigin==="use-credentials"?dr.credentials="include":ur.crossOrigin==="anonymous"?dr.credentials="omit":dr.credentials="same-origin",dr}function cr(ur){if(ur.ep)return;ur.ep=!0;const dr=lr(ur);fetch(ur.href,dr)}})();function getDefaultExportFromCjs(ar){return ar&&ar.__esModule&&Object.prototype.hasOwnProperty.call(ar,"default")?ar.default:ar}function getAugmentedNamespace(ar){if(ar.__esModule)return ar;var or=ar.default;if(typeof or=="function"){var lr=function cr(){return this instanceof cr?Reflect.construct(or,arguments,this.constructor):or.apply(this,arguments)};lr.prototype=or.prototype}else lr={};return Object.defineProperty(lr,"__esModule",{value:!0}),Object.keys(ar).forEach(function(cr){var ur=Object.getOwnPropertyDescriptor(ar,cr);Object.defineProperty(lr,cr,ur.get?ur:{enumerable:!0,get:function(){return ar[cr]}})}),lr}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$2=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$2=Symbol.for("react.strict_mode"),r$2=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$2=Symbol.iterator;function A$2(ar){return ar===null||typeof ar!="object"?null:(ar=z$2&&ar[z$2]||ar["@@iterator"],typeof ar=="function"?ar:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$2={};function E$2(ar,or,lr){this.props=ar,this.context=or,this.refs=D$2,this.updater=lr||B$2}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(ar,or){if(typeof ar!="object"&&typeof ar!="function"&&ar!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ar,or,"setState")};E$2.prototype.forceUpdate=function(ar){this.updater.enqueueForceUpdate(this,ar,"forceUpdate")};function F$1(){}F$1.prototype=E$2.prototype;function G$2(ar,or,lr){this.props=ar,this.context=or,this.refs=D$2,this.updater=lr||B$2}var H$2=G$2.prototype=new F$1;H$2.constructor=G$2;C$2(H$2,E$2.prototype);H$2.isPureReactComponent=!0;var I$2=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$2={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(ar,or,lr){var cr,ur={},dr=null,hr=null;if(or!=null)for(cr in or.ref!==void 0&&(hr=or.ref),or.key!==void 0&&(dr=""+or.key),or)J$1.call(or,cr)&&!L$2.hasOwnProperty(cr)&&(ur[cr]=or[cr]);var pr=arguments.length-2;if(pr===1)ur.children=lr;else if(1<pr){for(var xr=Array(pr),mr=0;mr<pr;mr++)xr[mr]=arguments[mr+2];ur.children=xr}if(ar&&ar.defaultProps)for(cr in pr=ar.defaultProps,pr)ur[cr]===void 0&&(ur[cr]=pr[cr]);return{$$typeof:l$2,type:ar,key:dr,ref:hr,props:ur,_owner:K$2.current}}function N$2(ar,or){return{$$typeof:l$2,type:ar.type,key:or,ref:ar.ref,props:ar.props,_owner:ar._owner}}function O$2(ar){return typeof ar=="object"&&ar!==null&&ar.$$typeof===l$2}function escape$1(ar){var or={"=":"=0",":":"=2"};return"$"+ar.replace(/[=:]/g,function(lr){return or[lr]})}var P$2=/\/+/g;function Q$2(ar,or){return typeof ar=="object"&&ar!==null&&ar.key!=null?escape$1(""+ar.key):or.toString(36)}function R$2(ar,or,lr,cr,ur){var dr=typeof ar;(dr==="undefined"||dr==="boolean")&&(ar=null);var hr=!1;if(ar===null)hr=!0;else switch(dr){case"string":case"number":hr=!0;break;case"object":switch(ar.$$typeof){case l$2:case n$2:hr=!0}}if(hr)return hr=ar,ur=ur(hr),ar=cr===""?"."+Q$2(hr,0):cr,I$2(ur)?(lr="",ar!=null&&(lr=ar.replace(P$2,"$&/")+"/"),R$2(ur,or,lr,"",function(mr){return mr})):ur!=null&&(O$2(ur)&&(ur=N$2(ur,lr+(!ur.key||hr&&hr.key===ur.key?"":(""+ur.key).replace(P$2,"$&/")+"/")+ar)),or.push(ur)),1;if(hr=0,cr=cr===""?".":cr+":",I$2(ar))for(var pr=0;pr<ar.length;pr++){dr=ar[pr];var xr=cr+Q$2(dr,pr);hr+=R$2(dr,or,lr,xr,ur)}else if(xr=A$2(ar),typeof xr=="function")for(ar=xr.call(ar),pr=0;!(dr=ar.next()).done;)dr=dr.value,xr=cr+Q$2(dr,pr++),hr+=R$2(dr,or,lr,xr,ur);else if(dr==="object")throw or=String(ar),Error("Objects are not valid as a React child (found: "+(or==="[object Object]"?"object with keys {"+Object.keys(ar).join(", ")+"}":or)+"). If you meant to render a collection of children, use an array instead.");return hr}function S$2(ar,or,lr){if(ar==null)return ar;var cr=[],ur=0;return R$2(ar,cr,"","",function(dr){return or.call(lr,dr,ur++)}),cr}function T$2(ar){if(ar._status===-1){var or=ar._result;or=or(),or.then(function(lr){(ar._status===0||ar._status===-1)&&(ar._status=1,ar._result=lr)},function(lr){(ar._status===0||ar._status===-1)&&(ar._status=2,ar._result=lr)}),ar._status===-1&&(ar._status=0,ar._result=or)}if(ar._status===1)return ar._result.default;throw ar._result}var U$2={current:null},V$2={transition:null},W$2={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$2};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(ar,or,lr){S$2(ar,function(){or.apply(this,arguments)},lr)},count:function(ar){var or=0;return S$2(ar,function(){or++}),or},toArray:function(ar){return S$2(ar,function(or){return or})||[]},only:function(ar){if(!O$2(ar))throw Error("React.Children.only expected to receive a single React element child.");return ar}};react_production_min.Component=E$2;react_production_min.Fragment=p$3;react_production_min.Profiler=r$2;react_production_min.PureComponent=G$2;react_production_min.StrictMode=q$2;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$2;react_production_min.act=X$2;react_production_min.cloneElement=function(ar,or,lr){if(ar==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ar+".");var cr=C$2({},ar.props),ur=ar.key,dr=ar.ref,hr=ar._owner;if(or!=null){if(or.ref!==void 0&&(dr=or.ref,hr=K$2.current),or.key!==void 0&&(ur=""+or.key),ar.type&&ar.type.defaultProps)var pr=ar.type.defaultProps;for(xr in or)J$1.call(or,xr)&&!L$2.hasOwnProperty(xr)&&(cr[xr]=or[xr]===void 0&&pr!==void 0?pr[xr]:or[xr])}var xr=arguments.length-2;if(xr===1)cr.children=lr;else if(1<xr){pr=Array(xr);for(var mr=0;mr<xr;mr++)pr[mr]=arguments[mr+2];cr.children=pr}return{$$typeof:l$2,type:ar.type,key:ur,ref:dr,props:cr,_owner:hr}};react_production_min.createContext=function(ar){return ar={$$typeof:u$1,_currentValue:ar,_currentValue2:ar,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ar.Provider={$$typeof:t$1,_context:ar},ar.Consumer=ar};react_production_min.createElement=M$2;react_production_min.createFactory=function(ar){var or=M$2.bind(null,ar);return or.type=ar,or};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(ar){return{$$typeof:v$2,render:ar}};react_production_min.isValidElement=O$2;react_production_min.lazy=function(ar){return{$$typeof:y$1,_payload:{_status:-1,_result:ar},_init:T$2}};react_production_min.memo=function(ar,or){return{$$typeof:x$1,type:ar,compare:or===void 0?null:or}};react_production_min.startTransition=function(ar){var or=V$2.transition;V$2.transition={};try{ar()}finally{V$2.transition=or}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(ar,or){return U$2.current.useCallback(ar,or)};react_production_min.useContext=function(ar){return U$2.current.useContext(ar)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(ar){return U$2.current.useDeferredValue(ar)};react_production_min.useEffect=function(ar,or){return U$2.current.useEffect(ar,or)};react_production_min.useId=function(){return U$2.current.useId()};react_production_min.useImperativeHandle=function(ar,or,lr){return U$2.current.useImperativeHandle(ar,or,lr)};react_production_min.useInsertionEffect=function(ar,or){return U$2.current.useInsertionEffect(ar,or)};react_production_min.useLayoutEffect=function(ar,or){return U$2.current.useLayoutEffect(ar,or)};react_production_min.useMemo=function(ar,or){return U$2.current.useMemo(ar,or)};react_production_min.useReducer=function(ar,or,lr){return U$2.current.useReducer(ar,or,lr)};react_production_min.useRef=function(ar){return U$2.current.useRef(ar)};react_production_min.useState=function(ar){return U$2.current.useState(ar)};react_production_min.useSyncExternalStore=function(ar,or,lr){return U$2.current.useSyncExternalStore(ar,or,lr)};react_production_min.useTransition=function(){return U$2.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React$2=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$1=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q$1(ar,or,lr){var cr,ur={},dr=null,hr=null;lr!==void 0&&(dr=""+lr),or.key!==void 0&&(dr=""+or.key),or.ref!==void 0&&(hr=or.ref);for(cr in or)m$2.call(or,cr)&&!p$2.hasOwnProperty(cr)&&(ur[cr]=or[cr]);if(ar&&ar.defaultProps)for(cr in or=ar.defaultProps,or)ur[cr]===void 0&&(ur[cr]=or[cr]);return{$$typeof:k$1,type:ar,key:dr,ref:hr,props:ur,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1;reactJsxRuntime_production_min.jsx=q$1;reactJsxRuntime_production_min.jsxs=q$1;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(ar){function or(Qr,Hr){var Kr=Qr.length;Qr.push(Hr);e:for(;0<Kr;){var rs=Kr-1>>>1,Mr=Qr[rs];if(0<ur(Mr,Hr))Qr[rs]=Hr,Qr[Kr]=Mr,Kr=rs;else break e}}function lr(Qr){return Qr.length===0?null:Qr[0]}function cr(Qr){if(Qr.length===0)return null;var Hr=Qr[0],Kr=Qr.pop();if(Kr!==Hr){Qr[0]=Kr;e:for(var rs=0,Mr=Qr.length,Dr=Mr>>>1;rs<Dr;){var Lr=2*(rs+1)-1,Fr=Qr[Lr],$r=Lr+1,Vr=Qr[$r];if(0>ur(Fr,Kr))$r<Mr&&0>ur(Vr,Fr)?(Qr[rs]=Vr,Qr[$r]=Kr,rs=$r):(Qr[rs]=Fr,Qr[Lr]=Kr,rs=Lr);else if($r<Mr&&0>ur(Vr,Kr))Qr[rs]=Vr,Qr[$r]=Kr,rs=$r;else break e}}return Hr}function ur(Qr,Hr){var Kr=Qr.sortIndex-Hr.sortIndex;return Kr!==0?Kr:Qr.id-Hr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var dr=performance;ar.unstable_now=function(){return dr.now()}}else{var hr=Date,pr=hr.now();ar.unstable_now=function(){return hr.now()-pr}}var xr=[],mr=[],fr=1,Er=null,vr=3,gr=!1,yr=!1,jr=!1,br=typeof setTimeout=="function"?setTimeout:null,_r=typeof clearTimeout=="function"?clearTimeout:null,wr=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Rr(Qr){for(var Hr=lr(mr);Hr!==null;){if(Hr.callback===null)cr(mr);else if(Hr.startTime<=Qr)cr(mr),Hr.sortIndex=Hr.expirationTime,or(xr,Hr);else break;Hr=lr(mr)}}function Ar(Qr){if(jr=!1,Rr(Qr),!yr)if(lr(xr)!==null)yr=!0,ps(Sr);else{var Hr=lr(mr);Hr!==null&&ts(Ar,Hr.startTime-Qr)}}function Sr(Qr,Hr){yr=!1,jr&&(jr=!1,_r(Cr),Cr=-1),gr=!0;var Kr=vr;try{for(Rr(Hr),Er=lr(xr);Er!==null&&(!(Er.expirationTime>Hr)||Qr&&!Ir());){var rs=Er.callback;if(typeof rs=="function"){Er.callback=null,vr=Er.priorityLevel;var Mr=rs(Er.expirationTime<=Hr);Hr=ar.unstable_now(),typeof Mr=="function"?Er.callback=Mr:Er===lr(xr)&&cr(xr),Rr(Hr)}else cr(xr);Er=lr(xr)}if(Er!==null)var Dr=!0;else{var Lr=lr(mr);Lr!==null&&ts(Ar,Lr.startTime-Hr),Dr=!1}return Dr}finally{Er=null,vr=Kr,gr=!1}}var kr=!1,Nr=null,Cr=-1,Tr=5,Pr=-1;function Ir(){return!(ar.unstable_now()-Pr<Tr)}function Br(){if(Nr!==null){var Qr=ar.unstable_now();Pr=Qr;var Hr=!0;try{Hr=Nr(!0,Qr)}finally{Hr?Wr():(kr=!1,Nr=null)}}else kr=!1}var Wr;if(typeof wr=="function")Wr=function(){wr(Br)};else if(typeof MessageChannel<"u"){var Yr=new MessageChannel,es=Yr.port2;Yr.port1.onmessage=Br,Wr=function(){es.postMessage(null)}}else Wr=function(){br(Br,0)};function ps(Qr){Nr=Qr,kr||(kr=!0,Wr())}function ts(Qr,Hr){Cr=br(function(){Qr(ar.unstable_now())},Hr)}ar.unstable_IdlePriority=5,ar.unstable_ImmediatePriority=1,ar.unstable_LowPriority=4,ar.unstable_NormalPriority=3,ar.unstable_Profiling=null,ar.unstable_UserBlockingPriority=2,ar.unstable_cancelCallback=function(Qr){Qr.callback=null},ar.unstable_continueExecution=function(){yr||gr||(yr=!0,ps(Sr))},ar.unstable_forceFrameRate=function(Qr){0>Qr||125<Qr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Tr=0<Qr?Math.floor(1e3/Qr):5},ar.unstable_getCurrentPriorityLevel=function(){return vr},ar.unstable_getFirstCallbackNode=function(){return lr(xr)},ar.unstable_next=function(Qr){switch(vr){case 1:case 2:case 3:var Hr=3;break;default:Hr=vr}var Kr=vr;vr=Hr;try{return Qr()}finally{vr=Kr}},ar.unstable_pauseExecution=function(){},ar.unstable_requestPaint=function(){},ar.unstable_runWithPriority=function(Qr,Hr){switch(Qr){case 1:case 2:case 3:case 4:case 5:break;default:Qr=3}var Kr=vr;vr=Qr;try{return Hr()}finally{vr=Kr}},ar.unstable_scheduleCallback=function(Qr,Hr,Kr){var rs=ar.unstable_now();switch(typeof Kr=="object"&&Kr!==null?(Kr=Kr.delay,Kr=typeof Kr=="number"&&0<Kr?rs+Kr:rs):Kr=rs,Qr){case 1:var Mr=-1;break;case 2:Mr=250;break;case 5:Mr=1073741823;break;case 4:Mr=1e4;break;default:Mr=5e3}return Mr=Kr+Mr,Qr={id:fr++,callback:Hr,priorityLevel:Qr,startTime:Kr,expirationTime:Mr,sortIndex:-1},Kr>rs?(Qr.sortIndex=Kr,or(mr,Qr),lr(xr)===null&&Qr===lr(mr)&&(jr?(_r(Cr),Cr=-1):jr=!0,ts(Ar,Kr-rs))):(Qr.sortIndex=Mr,or(xr,Qr),yr||gr||(yr=!0,ps(Sr))),Qr},ar.unstable_shouldYield=Ir,ar.unstable_wrapCallback=function(Qr){var Hr=vr;return function(){var Kr=vr;vr=Hr;try{return Qr.apply(this,arguments)}finally{vr=Kr}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(ar){for(var or="https://reactjs.org/docs/error-decoder.html?invariant="+ar,lr=1;lr<arguments.length;lr++)or+="&args[]="+encodeURIComponent(arguments[lr]);return"Minified React error #"+ar+"; visit "+or+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(ar,or){ha(ar,or),ha(ar+"Capture",or)}function ha(ar,or){for(ea[ar]=or,ar=0;ar<or.length;ar++)da.add(or[ar])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(ar){return ja.call(ma,ar)?!0:ja.call(la,ar)?!1:ka.test(ar)?ma[ar]=!0:(la[ar]=!0,!1)}function pa(ar,or,lr,cr){if(lr!==null&&lr.type===0)return!1;switch(typeof or){case"function":case"symbol":return!0;case"boolean":return cr?!1:lr!==null?!lr.acceptsBooleans:(ar=ar.toLowerCase().slice(0,5),ar!=="data-"&&ar!=="aria-");default:return!1}}function qa(ar,or,lr,cr){if(or===null||typeof or>"u"||pa(ar,or,lr,cr))return!0;if(cr)return!1;if(lr!==null)switch(lr.type){case 3:return!or;case 4:return or===!1;case 5:return isNaN(or);case 6:return isNaN(or)||1>or}return!1}function v$1(ar,or,lr,cr,ur,dr,hr){this.acceptsBooleans=or===2||or===3||or===4,this.attributeName=cr,this.attributeNamespace=ur,this.mustUseProperty=lr,this.propertyName=ar,this.type=or,this.sanitizeURL=dr,this.removeEmptyString=hr}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(ar){z$1[ar]=new v$1(ar,0,!1,ar,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(ar){var or=ar[0];z$1[or]=new v$1(or,1,!1,ar[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(ar){z$1[ar]=new v$1(ar,2,!1,ar.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(ar){z$1[ar]=new v$1(ar,2,!1,ar,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(ar){z$1[ar]=new v$1(ar,3,!1,ar.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(ar){z$1[ar]=new v$1(ar,3,!0,ar,null,!1,!1)});["capture","download"].forEach(function(ar){z$1[ar]=new v$1(ar,4,!1,ar,null,!1,!1)});["cols","rows","size","span"].forEach(function(ar){z$1[ar]=new v$1(ar,6,!1,ar,null,!1,!1)});["rowSpan","start"].forEach(function(ar){z$1[ar]=new v$1(ar,5,!1,ar.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(ar){return ar[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(ar){var or=ar.replace(ra,sa);z$1[or]=new v$1(or,1,!1,ar,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(ar){var or=ar.replace(ra,sa);z$1[or]=new v$1(or,1,!1,ar,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(ar){var or=ar.replace(ra,sa);z$1[or]=new v$1(or,1,!1,ar,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(ar){z$1[ar]=new v$1(ar,1,!1,ar.toLowerCase(),null,!1,!1)});z$1.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(ar){z$1[ar]=new v$1(ar,1,!1,ar.toLowerCase(),null,!0,!0)});function ta(ar,or,lr,cr){var ur=z$1.hasOwnProperty(or)?z$1[or]:null;(ur!==null?ur.type!==0:cr||!(2<or.length)||or[0]!=="o"&&or[0]!=="O"||or[1]!=="n"&&or[1]!=="N")&&(qa(or,lr,ur,cr)&&(lr=null),cr||ur===null?oa(or)&&(lr===null?ar.removeAttribute(or):ar.setAttribute(or,""+lr)):ur.mustUseProperty?ar[ur.propertyName]=lr===null?ur.type===3?!1:"":lr:(or=ur.attributeName,cr=ur.attributeNamespace,lr===null?ar.removeAttribute(or):(ur=ur.type,lr=ur===3||ur===4&&lr===!0?"":""+lr,cr?ar.setAttributeNS(cr,or,lr):ar.setAttribute(or,lr))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(ar){return ar===null||typeof ar!="object"?null:(ar=Ja&&ar[Ja]||ar["@@iterator"],typeof ar=="function"?ar:null)}var A$1=Object.assign,La;function Ma(ar){if(La===void 0)try{throw Error()}catch(lr){var or=lr.stack.trim().match(/\n( *(at )?)/);La=or&&or[1]||""}return`
`+La+ar}var Na=!1;function Oa(ar,or){if(!ar||Na)return"";Na=!0;var lr=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(or)if(or=function(){throw Error()},Object.defineProperty(or.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(or,[])}catch(mr){var cr=mr}Reflect.construct(ar,[],or)}else{try{or.call()}catch(mr){cr=mr}ar.call(or.prototype)}else{try{throw Error()}catch(mr){cr=mr}ar()}}catch(mr){if(mr&&cr&&typeof mr.stack=="string"){for(var ur=mr.stack.split(`
`),dr=cr.stack.split(`
`),hr=ur.length-1,pr=dr.length-1;1<=hr&&0<=pr&&ur[hr]!==dr[pr];)pr--;for(;1<=hr&&0<=pr;hr--,pr--)if(ur[hr]!==dr[pr]){if(hr!==1||pr!==1)do if(hr--,pr--,0>pr||ur[hr]!==dr[pr]){var xr=`
`+ur[hr].replace(" at new "," at ");return ar.displayName&&xr.includes("<anonymous>")&&(xr=xr.replace("<anonymous>",ar.displayName)),xr}while(1<=hr&&0<=pr);break}}}finally{Na=!1,Error.prepareStackTrace=lr}return(ar=ar?ar.displayName||ar.name:"")?Ma(ar):""}function Pa(ar){switch(ar.tag){case 5:return Ma(ar.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return ar=Oa(ar.type,!1),ar;case 11:return ar=Oa(ar.type.render,!1),ar;case 1:return ar=Oa(ar.type,!0),ar;default:return""}}function Qa(ar){if(ar==null)return null;if(typeof ar=="function")return ar.displayName||ar.name||null;if(typeof ar=="string")return ar;switch(ar){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof ar=="object")switch(ar.$$typeof){case Ca:return(ar.displayName||"Context")+".Consumer";case Ba:return(ar._context.displayName||"Context")+".Provider";case Da:var or=ar.render;return ar=ar.displayName,ar||(ar=or.displayName||or.name||"",ar=ar!==""?"ForwardRef("+ar+")":"ForwardRef"),ar;case Ga:return or=ar.displayName||null,or!==null?or:Qa(ar.type)||"Memo";case Ha:or=ar._payload,ar=ar._init;try{return Qa(ar(or))}catch{}}return null}function Ra(ar){var or=ar.type;switch(ar.tag){case 24:return"Cache";case 9:return(or.displayName||"Context")+".Consumer";case 10:return(or._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return ar=or.render,ar=ar.displayName||ar.name||"",or.displayName||(ar!==""?"ForwardRef("+ar+")":"ForwardRef");case 7:return"Fragment";case 5:return or;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(or);case 8:return or===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof or=="function")return or.displayName||or.name||null;if(typeof or=="string")return or}return null}function Sa(ar){switch(typeof ar){case"boolean":case"number":case"string":case"undefined":return ar;case"object":return ar;default:return""}}function Ta(ar){var or=ar.type;return(ar=ar.nodeName)&&ar.toLowerCase()==="input"&&(or==="checkbox"||or==="radio")}function Ua(ar){var or=Ta(ar)?"checked":"value",lr=Object.getOwnPropertyDescriptor(ar.constructor.prototype,or),cr=""+ar[or];if(!ar.hasOwnProperty(or)&&typeof lr<"u"&&typeof lr.get=="function"&&typeof lr.set=="function"){var ur=lr.get,dr=lr.set;return Object.defineProperty(ar,or,{configurable:!0,get:function(){return ur.call(this)},set:function(hr){cr=""+hr,dr.call(this,hr)}}),Object.defineProperty(ar,or,{enumerable:lr.enumerable}),{getValue:function(){return cr},setValue:function(hr){cr=""+hr},stopTracking:function(){ar._valueTracker=null,delete ar[or]}}}}function Va(ar){ar._valueTracker||(ar._valueTracker=Ua(ar))}function Wa(ar){if(!ar)return!1;var or=ar._valueTracker;if(!or)return!0;var lr=or.getValue(),cr="";return ar&&(cr=Ta(ar)?ar.checked?"true":"false":ar.value),ar=cr,ar!==lr?(or.setValue(ar),!0):!1}function Xa(ar){if(ar=ar||(typeof document<"u"?document:void 0),typeof ar>"u")return null;try{return ar.activeElement||ar.body}catch{return ar.body}}function Ya(ar,or){var lr=or.checked;return A$1({},or,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:lr??ar._wrapperState.initialChecked})}function Za(ar,or){var lr=or.defaultValue==null?"":or.defaultValue,cr=or.checked!=null?or.checked:or.defaultChecked;lr=Sa(or.value!=null?or.value:lr),ar._wrapperState={initialChecked:cr,initialValue:lr,controlled:or.type==="checkbox"||or.type==="radio"?or.checked!=null:or.value!=null}}function ab(ar,or){or=or.checked,or!=null&&ta(ar,"checked",or,!1)}function bb(ar,or){ab(ar,or);var lr=Sa(or.value),cr=or.type;if(lr!=null)cr==="number"?(lr===0&&ar.value===""||ar.value!=lr)&&(ar.value=""+lr):ar.value!==""+lr&&(ar.value=""+lr);else if(cr==="submit"||cr==="reset"){ar.removeAttribute("value");return}or.hasOwnProperty("value")?cb(ar,or.type,lr):or.hasOwnProperty("defaultValue")&&cb(ar,or.type,Sa(or.defaultValue)),or.checked==null&&or.defaultChecked!=null&&(ar.defaultChecked=!!or.defaultChecked)}function db$1(ar,or,lr){if(or.hasOwnProperty("value")||or.hasOwnProperty("defaultValue")){var cr=or.type;if(!(cr!=="submit"&&cr!=="reset"||or.value!==void 0&&or.value!==null))return;or=""+ar._wrapperState.initialValue,lr||or===ar.value||(ar.value=or),ar.defaultValue=or}lr=ar.name,lr!==""&&(ar.name=""),ar.defaultChecked=!!ar._wrapperState.initialChecked,lr!==""&&(ar.name=lr)}function cb(ar,or,lr){(or!=="number"||Xa(ar.ownerDocument)!==ar)&&(lr==null?ar.defaultValue=""+ar._wrapperState.initialValue:ar.defaultValue!==""+lr&&(ar.defaultValue=""+lr))}var eb=Array.isArray;function fb(ar,or,lr,cr){if(ar=ar.options,or){or={};for(var ur=0;ur<lr.length;ur++)or["$"+lr[ur]]=!0;for(lr=0;lr<ar.length;lr++)ur=or.hasOwnProperty("$"+ar[lr].value),ar[lr].selected!==ur&&(ar[lr].selected=ur),ur&&cr&&(ar[lr].defaultSelected=!0)}else{for(lr=""+Sa(lr),or=null,ur=0;ur<ar.length;ur++){if(ar[ur].value===lr){ar[ur].selected=!0,cr&&(ar[ur].defaultSelected=!0);return}or!==null||ar[ur].disabled||(or=ar[ur])}or!==null&&(or.selected=!0)}}function gb(ar,or){if(or.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},or,{value:void 0,defaultValue:void 0,children:""+ar._wrapperState.initialValue})}function hb(ar,or){var lr=or.value;if(lr==null){if(lr=or.children,or=or.defaultValue,lr!=null){if(or!=null)throw Error(p$1(92));if(eb(lr)){if(1<lr.length)throw Error(p$1(93));lr=lr[0]}or=lr}or==null&&(or=""),lr=or}ar._wrapperState={initialValue:Sa(lr)}}function ib(ar,or){var lr=Sa(or.value),cr=Sa(or.defaultValue);lr!=null&&(lr=""+lr,lr!==ar.value&&(ar.value=lr),or.defaultValue==null&&ar.defaultValue!==lr&&(ar.defaultValue=lr)),cr!=null&&(ar.defaultValue=""+cr)}function jb(ar){var or=ar.textContent;or===ar._wrapperState.initialValue&&or!==""&&or!==null&&(ar.value=or)}function kb(ar){switch(ar){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(ar,or){return ar==null||ar==="http://www.w3.org/1999/xhtml"?kb(or):ar==="http://www.w3.org/2000/svg"&&or==="foreignObject"?"http://www.w3.org/1999/xhtml":ar}var mb,nb=function(ar){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(or,lr,cr,ur){MSApp.execUnsafeLocalFunction(function(){return ar(or,lr,cr,ur)})}:ar}(function(ar,or){if(ar.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in ar)ar.innerHTML=or;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+or.valueOf().toString()+"</svg>",or=mb.firstChild;ar.firstChild;)ar.removeChild(ar.firstChild);for(;or.firstChild;)ar.appendChild(or.firstChild)}});function ob(ar,or){if(or){var lr=ar.firstChild;if(lr&&lr===ar.lastChild&&lr.nodeType===3){lr.nodeValue=or;return}}ar.textContent=or}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(ar){qb.forEach(function(or){or=or+ar.charAt(0).toUpperCase()+ar.substring(1),pb[or]=pb[ar]})});function rb(ar,or,lr){return or==null||typeof or=="boolean"||or===""?"":lr||typeof or!="number"||or===0||pb.hasOwnProperty(ar)&&pb[ar]?(""+or).trim():or+"px"}function sb(ar,or){ar=ar.style;for(var lr in or)if(or.hasOwnProperty(lr)){var cr=lr.indexOf("--")===0,ur=rb(lr,or[lr],cr);lr==="float"&&(lr="cssFloat"),cr?ar.setProperty(lr,ur):ar[lr]=ur}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(ar,or){if(or){if(tb[ar]&&(or.children!=null||or.dangerouslySetInnerHTML!=null))throw Error(p$1(137,ar));if(or.dangerouslySetInnerHTML!=null){if(or.children!=null)throw Error(p$1(60));if(typeof or.dangerouslySetInnerHTML!="object"||!("__html"in or.dangerouslySetInnerHTML))throw Error(p$1(61))}if(or.style!=null&&typeof or.style!="object")throw Error(p$1(62))}}function vb(ar,or){if(ar.indexOf("-")===-1)return typeof or.is=="string";switch(ar){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(ar){return ar=ar.target||ar.srcElement||window,ar.correspondingUseElement&&(ar=ar.correspondingUseElement),ar.nodeType===3?ar.parentNode:ar}var yb=null,zb=null,Ab=null;function Bb(ar){if(ar=Cb(ar)){if(typeof yb!="function")throw Error(p$1(280));var or=ar.stateNode;or&&(or=Db(or),yb(ar.stateNode,ar.type,or))}}function Eb(ar){zb?Ab?Ab.push(ar):Ab=[ar]:zb=ar}function Fb(){if(zb){var ar=zb,or=Ab;if(Ab=zb=null,Bb(ar),or)for(ar=0;ar<or.length;ar++)Bb(or[ar])}}function Gb(ar,or){return ar(or)}function Hb(){}var Ib=!1;function Jb(ar,or,lr){if(Ib)return ar(or,lr);Ib=!0;try{return Gb(ar,or,lr)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(ar,or){var lr=ar.stateNode;if(lr===null)return null;var cr=Db(lr);if(cr===null)return null;lr=cr[or];e:switch(or){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(cr=!cr.disabled)||(ar=ar.type,cr=!(ar==="button"||ar==="input"||ar==="select"||ar==="textarea")),ar=!cr;break e;default:ar=!1}if(ar)return null;if(lr&&typeof lr!="function")throw Error(p$1(231,or,typeof lr));return lr}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(ar,or,lr,cr,ur,dr,hr,pr,xr){var mr=Array.prototype.slice.call(arguments,3);try{or.apply(lr,mr)}catch(fr){this.onError(fr)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(ar){Ob=!0,Pb=ar}};function Tb(ar,or,lr,cr,ur,dr,hr,pr,xr){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(ar,or,lr,cr,ur,dr,hr,pr,xr){if(Tb.apply(this,arguments),Ob){if(Ob){var mr=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=mr)}}function Vb(ar){var or=ar,lr=ar;if(ar.alternate)for(;or.return;)or=or.return;else{ar=or;do or=ar,or.flags&4098&&(lr=or.return),ar=or.return;while(ar)}return or.tag===3?lr:null}function Wb(ar){if(ar.tag===13){var or=ar.memoizedState;if(or===null&&(ar=ar.alternate,ar!==null&&(or=ar.memoizedState)),or!==null)return or.dehydrated}return null}function Xb(ar){if(Vb(ar)!==ar)throw Error(p$1(188))}function Yb(ar){var or=ar.alternate;if(!or){if(or=Vb(ar),or===null)throw Error(p$1(188));return or!==ar?null:ar}for(var lr=ar,cr=or;;){var ur=lr.return;if(ur===null)break;var dr=ur.alternate;if(dr===null){if(cr=ur.return,cr!==null){lr=cr;continue}break}if(ur.child===dr.child){for(dr=ur.child;dr;){if(dr===lr)return Xb(ur),ar;if(dr===cr)return Xb(ur),or;dr=dr.sibling}throw Error(p$1(188))}if(lr.return!==cr.return)lr=ur,cr=dr;else{for(var hr=!1,pr=ur.child;pr;){if(pr===lr){hr=!0,lr=ur,cr=dr;break}if(pr===cr){hr=!0,cr=ur,lr=dr;break}pr=pr.sibling}if(!hr){for(pr=dr.child;pr;){if(pr===lr){hr=!0,lr=dr,cr=ur;break}if(pr===cr){hr=!0,cr=dr,lr=ur;break}pr=pr.sibling}if(!hr)throw Error(p$1(189))}}if(lr.alternate!==cr)throw Error(p$1(190))}if(lr.tag!==3)throw Error(p$1(188));return lr.stateNode.current===lr?ar:or}function Zb(ar){return ar=Yb(ar),ar!==null?$b(ar):null}function $b(ar){if(ar.tag===5||ar.tag===6)return ar;for(ar=ar.child;ar!==null;){var or=$b(ar);if(or!==null)return or;ar=ar.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(ar){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,ar,void 0,(ar.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(ar){return ar>>>=0,ar===0?32:31-(pc(ar)/qc|0)|0}var rc=64,sc=4194304;function tc(ar){switch(ar&-ar){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return ar&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return ar&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return ar}}function uc(ar,or){var lr=ar.pendingLanes;if(lr===0)return 0;var cr=0,ur=ar.suspendedLanes,dr=ar.pingedLanes,hr=lr&268435455;if(hr!==0){var pr=hr&~ur;pr!==0?cr=tc(pr):(dr&=hr,dr!==0&&(cr=tc(dr)))}else hr=lr&~ur,hr!==0?cr=tc(hr):dr!==0&&(cr=tc(dr));if(cr===0)return 0;if(or!==0&&or!==cr&&!(or&ur)&&(ur=cr&-cr,dr=or&-or,ur>=dr||ur===16&&(dr&4194240)!==0))return or;if(cr&4&&(cr|=lr&16),or=ar.entangledLanes,or!==0)for(ar=ar.entanglements,or&=cr;0<or;)lr=31-oc(or),ur=1<<lr,cr|=ar[lr],or&=~ur;return cr}function vc(ar,or){switch(ar){case 1:case 2:case 4:return or+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return or+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(ar,or){for(var lr=ar.suspendedLanes,cr=ar.pingedLanes,ur=ar.expirationTimes,dr=ar.pendingLanes;0<dr;){var hr=31-oc(dr),pr=1<<hr,xr=ur[hr];xr===-1?(!(pr&lr)||pr&cr)&&(ur[hr]=vc(pr,or)):xr<=or&&(ar.expiredLanes|=pr),dr&=~pr}}function xc(ar){return ar=ar.pendingLanes&-1073741825,ar!==0?ar:ar&1073741824?1073741824:0}function yc(){var ar=rc;return rc<<=1,!(rc&4194240)&&(rc=64),ar}function zc(ar){for(var or=[],lr=0;31>lr;lr++)or.push(ar);return or}function Ac(ar,or,lr){ar.pendingLanes|=or,or!==536870912&&(ar.suspendedLanes=0,ar.pingedLanes=0),ar=ar.eventTimes,or=31-oc(or),ar[or]=lr}function Bc(ar,or){var lr=ar.pendingLanes&~or;ar.pendingLanes=or,ar.suspendedLanes=0,ar.pingedLanes=0,ar.expiredLanes&=or,ar.mutableReadLanes&=or,ar.entangledLanes&=or,or=ar.entanglements;var cr=ar.eventTimes;for(ar=ar.expirationTimes;0<lr;){var ur=31-oc(lr),dr=1<<ur;or[ur]=0,cr[ur]=-1,ar[ur]=-1,lr&=~dr}}function Cc(ar,or){var lr=ar.entangledLanes|=or;for(ar=ar.entanglements;lr;){var cr=31-oc(lr),ur=1<<cr;ur&or|ar[cr]&or&&(ar[cr]|=or),lr&=~ur}}var C$1=0;function Dc(ar){return ar&=-ar,1<ar?4<ar?ar&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(ar,or){switch(ar){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(or.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(or.pointerId)}}function Tc(ar,or,lr,cr,ur,dr){return ar===null||ar.nativeEvent!==dr?(ar={blockedOn:or,domEventName:lr,eventSystemFlags:cr,nativeEvent:dr,targetContainers:[ur]},or!==null&&(or=Cb(or),or!==null&&Fc(or)),ar):(ar.eventSystemFlags|=cr,or=ar.targetContainers,ur!==null&&or.indexOf(ur)===-1&&or.push(ur),ar)}function Uc(ar,or,lr,cr,ur){switch(or){case"focusin":return Lc=Tc(Lc,ar,or,lr,cr,ur),!0;case"dragenter":return Mc=Tc(Mc,ar,or,lr,cr,ur),!0;case"mouseover":return Nc=Tc(Nc,ar,or,lr,cr,ur),!0;case"pointerover":var dr=ur.pointerId;return Oc.set(dr,Tc(Oc.get(dr)||null,ar,or,lr,cr,ur)),!0;case"gotpointercapture":return dr=ur.pointerId,Pc.set(dr,Tc(Pc.get(dr)||null,ar,or,lr,cr,ur)),!0}return!1}function Vc(ar){var or=Wc(ar.target);if(or!==null){var lr=Vb(or);if(lr!==null){if(or=lr.tag,or===13){if(or=Wb(lr),or!==null){ar.blockedOn=or,Ic(ar.priority,function(){Gc(lr)});return}}else if(or===3&&lr.stateNode.current.memoizedState.isDehydrated){ar.blockedOn=lr.tag===3?lr.stateNode.containerInfo:null;return}}}ar.blockedOn=null}function Xc(ar){if(ar.blockedOn!==null)return!1;for(var or=ar.targetContainers;0<or.length;){var lr=Yc(ar.domEventName,ar.eventSystemFlags,or[0],ar.nativeEvent);if(lr===null){lr=ar.nativeEvent;var cr=new lr.constructor(lr.type,lr);wb=cr,lr.target.dispatchEvent(cr),wb=null}else return or=Cb(lr),or!==null&&Fc(or),ar.blockedOn=lr,!1;or.shift()}return!0}function Zc(ar,or,lr){Xc(ar)&&lr.delete(or)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(ar,or){ar.blockedOn===or&&(ar.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(ar){function or(ur){return ad(ur,ar)}if(0<Kc.length){ad(Kc[0],ar);for(var lr=1;lr<Kc.length;lr++){var cr=Kc[lr];cr.blockedOn===ar&&(cr.blockedOn=null)}}for(Lc!==null&&ad(Lc,ar),Mc!==null&&ad(Mc,ar),Nc!==null&&ad(Nc,ar),Oc.forEach(or),Pc.forEach(or),lr=0;lr<Qc.length;lr++)cr=Qc[lr],cr.blockedOn===ar&&(cr.blockedOn=null);for(;0<Qc.length&&(lr=Qc[0],lr.blockedOn===null);)Vc(lr),lr.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(ar,or,lr,cr){var ur=C$1,dr=cd.transition;cd.transition=null;try{C$1=1,fd(ar,or,lr,cr)}finally{C$1=ur,cd.transition=dr}}function gd(ar,or,lr,cr){var ur=C$1,dr=cd.transition;cd.transition=null;try{C$1=4,fd(ar,or,lr,cr)}finally{C$1=ur,cd.transition=dr}}function fd(ar,or,lr,cr){if(dd){var ur=Yc(ar,or,lr,cr);if(ur===null)hd(ar,or,cr,id,lr),Sc(ar,cr);else if(Uc(ur,ar,or,lr,cr))cr.stopPropagation();else if(Sc(ar,cr),or&4&&-1<Rc.indexOf(ar)){for(;ur!==null;){var dr=Cb(ur);if(dr!==null&&Ec(dr),dr=Yc(ar,or,lr,cr),dr===null&&hd(ar,or,cr,id,lr),dr===ur)break;ur=dr}ur!==null&&cr.stopPropagation()}else hd(ar,or,cr,null,lr)}}var id=null;function Yc(ar,or,lr,cr){if(id=null,ar=xb(cr),ar=Wc(ar),ar!==null)if(or=Vb(ar),or===null)ar=null;else if(lr=or.tag,lr===13){if(ar=Wb(or),ar!==null)return ar;ar=null}else if(lr===3){if(or.stateNode.current.memoizedState.isDehydrated)return or.tag===3?or.stateNode.containerInfo:null;ar=null}else or!==ar&&(ar=null);return id=ar,null}function jd(ar){switch(ar){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var ar,or=ld,lr=or.length,cr,ur="value"in kd?kd.value:kd.textContent,dr=ur.length;for(ar=0;ar<lr&&or[ar]===ur[ar];ar++);var hr=lr-ar;for(cr=1;cr<=hr&&or[lr-cr]===ur[dr-cr];cr++);return md=ur.slice(ar,1<cr?1-cr:void 0)}function od(ar){var or=ar.keyCode;return"charCode"in ar?(ar=ar.charCode,ar===0&&or===13&&(ar=13)):ar=or,ar===10&&(ar=13),32<=ar||ar===13?ar:0}function pd(){return!0}function qd(){return!1}function rd(ar){function or(lr,cr,ur,dr,hr){this._reactName=lr,this._targetInst=ur,this.type=cr,this.nativeEvent=dr,this.target=hr,this.currentTarget=null;for(var pr in ar)ar.hasOwnProperty(pr)&&(lr=ar[pr],this[pr]=lr?lr(dr):dr[pr]);return this.isDefaultPrevented=(dr.defaultPrevented!=null?dr.defaultPrevented:dr.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(or.prototype,{preventDefault:function(){this.defaultPrevented=!0;var lr=this.nativeEvent;lr&&(lr.preventDefault?lr.preventDefault():typeof lr.returnValue!="unknown"&&(lr.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var lr=this.nativeEvent;lr&&(lr.stopPropagation?lr.stopPropagation():typeof lr.cancelBubble!="unknown"&&(lr.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),or}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(ar){return ar.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(ar){return ar.relatedTarget===void 0?ar.fromElement===ar.srcElement?ar.toElement:ar.fromElement:ar.relatedTarget},movementX:function(ar){return"movementX"in ar?ar.movementX:(ar!==yd&&(yd&&ar.type==="mousemove"?(wd=ar.screenX-yd.screenX,xd=ar.screenY-yd.screenY):xd=wd=0,yd=ar),wd)},movementY:function(ar){return"movementY"in ar?ar.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(ar){return"clipboardData"in ar?ar.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(ar){var or=this.nativeEvent;return or.getModifierState?or.getModifierState(ar):(ar=Od[ar])?!!or[ar]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(ar){if(ar.key){var or=Md[ar.key]||ar.key;if(or!=="Unidentified")return or}return ar.type==="keypress"?(ar=od(ar),ar===13?"Enter":String.fromCharCode(ar)):ar.type==="keydown"||ar.type==="keyup"?Nd[ar.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(ar){return ar.type==="keypress"?od(ar):0},keyCode:function(ar){return ar.type==="keydown"||ar.type==="keyup"?ar.keyCode:0},which:function(ar){return ar.type==="keypress"?od(ar):ar.type==="keydown"||ar.type==="keyup"?ar.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(ar){return"deltaX"in ar?ar.deltaX:"wheelDeltaX"in ar?-ar.wheelDeltaX:0},deltaY:function(ar){return"deltaY"in ar?ar.deltaY:"wheelDeltaY"in ar?-ar.wheelDeltaY:"wheelDelta"in ar?-ar.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe$1=!1;function ge$1(ar,or){switch(ar){case"keyup":return $d.indexOf(or.keyCode)!==-1;case"keydown":return or.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(ar){return ar=ar.detail,typeof ar=="object"&&"data"in ar?ar.data:null}var ie$1=!1;function je$1(ar,or){switch(ar){case"compositionend":return he$1(or);case"keypress":return or.which!==32?null:(fe$1=!0,ee$1);case"textInput":return ar=or.data,ar===ee$1&&fe$1?null:ar;default:return null}}function ke$1(ar,or){if(ie$1)return ar==="compositionend"||!ae$1&&ge$1(ar,or)?(ar=nd(),md=ld=kd=null,ie$1=!1,ar):null;switch(ar){case"paste":return null;case"keypress":if(!(or.ctrlKey||or.altKey||or.metaKey)||or.ctrlKey&&or.altKey){if(or.char&&1<or.char.length)return or.char;if(or.which)return String.fromCharCode(or.which)}return null;case"compositionend":return de$1&&or.locale!=="ko"?null:or.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(ar){var or=ar&&ar.nodeName&&ar.nodeName.toLowerCase();return or==="input"?!!le$1[ar.type]:or==="textarea"}function ne$1(ar,or,lr,cr){Eb(cr),or=oe$1(or,"onChange"),0<or.length&&(lr=new td("onChange","change",null,lr,cr),ar.push({event:lr,listeners:or}))}var pe$1=null,qe$1=null;function re$1(ar){se$1(ar,0)}function te$1(ar){var or=ue$1(ar);if(Wa(or))return ar}function ve$1(ar,or){if(ar==="change")return or}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye$1=typeof ze$1.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(ar){if(ar.propertyName==="value"&&te$1(qe$1)){var or=[];ne$1(or,qe$1,ar,xb(ar)),Jb(re$1,or)}}function Ce$1(ar,or,lr){ar==="focusin"?(Ae$1(),pe$1=or,qe$1=lr,pe$1.attachEvent("onpropertychange",Be$1)):ar==="focusout"&&Ae$1()}function De$1(ar){if(ar==="selectionchange"||ar==="keyup"||ar==="keydown")return te$1(qe$1)}function Ee$1(ar,or){if(ar==="click")return te$1(or)}function Fe$1(ar,or){if(ar==="input"||ar==="change")return te$1(or)}function Ge$1(ar,or){return ar===or&&(ar!==0||1/ar===1/or)||ar!==ar&&or!==or}var He$1=typeof Object.is=="function"?Object.is:Ge$1;function Ie$1(ar,or){if(He$1(ar,or))return!0;if(typeof ar!="object"||ar===null||typeof or!="object"||or===null)return!1;var lr=Object.keys(ar),cr=Object.keys(or);if(lr.length!==cr.length)return!1;for(cr=0;cr<lr.length;cr++){var ur=lr[cr];if(!ja.call(or,ur)||!He$1(ar[ur],or[ur]))return!1}return!0}function Je$1(ar){for(;ar&&ar.firstChild;)ar=ar.firstChild;return ar}function Ke$1(ar,or){var lr=Je$1(ar);ar=0;for(var cr;lr;){if(lr.nodeType===3){if(cr=ar+lr.textContent.length,ar<=or&&cr>=or)return{node:lr,offset:or-ar};ar=cr}e:{for(;lr;){if(lr.nextSibling){lr=lr.nextSibling;break e}lr=lr.parentNode}lr=void 0}lr=Je$1(lr)}}function Le$1(ar,or){return ar&&or?ar===or?!0:ar&&ar.nodeType===3?!1:or&&or.nodeType===3?Le$1(ar,or.parentNode):"contains"in ar?ar.contains(or):ar.compareDocumentPosition?!!(ar.compareDocumentPosition(or)&16):!1:!1}function Me$1(){for(var ar=window,or=Xa();or instanceof ar.HTMLIFrameElement;){try{var lr=typeof or.contentWindow.location.href=="string"}catch{lr=!1}if(lr)ar=or.contentWindow;else break;or=Xa(ar.document)}return or}function Ne$1(ar){var or=ar&&ar.nodeName&&ar.nodeName.toLowerCase();return or&&(or==="input"&&(ar.type==="text"||ar.type==="search"||ar.type==="tel"||ar.type==="url"||ar.type==="password")||or==="textarea"||ar.contentEditable==="true")}function Oe$1(ar){var or=Me$1(),lr=ar.focusedElem,cr=ar.selectionRange;if(or!==lr&&lr&&lr.ownerDocument&&Le$1(lr.ownerDocument.documentElement,lr)){if(cr!==null&&Ne$1(lr)){if(or=cr.start,ar=cr.end,ar===void 0&&(ar=or),"selectionStart"in lr)lr.selectionStart=or,lr.selectionEnd=Math.min(ar,lr.value.length);else if(ar=(or=lr.ownerDocument||document)&&or.defaultView||window,ar.getSelection){ar=ar.getSelection();var ur=lr.textContent.length,dr=Math.min(cr.start,ur);cr=cr.end===void 0?dr:Math.min(cr.end,ur),!ar.extend&&dr>cr&&(ur=cr,cr=dr,dr=ur),ur=Ke$1(lr,dr);var hr=Ke$1(lr,cr);ur&&hr&&(ar.rangeCount!==1||ar.anchorNode!==ur.node||ar.anchorOffset!==ur.offset||ar.focusNode!==hr.node||ar.focusOffset!==hr.offset)&&(or=or.createRange(),or.setStart(ur.node,ur.offset),ar.removeAllRanges(),dr>cr?(ar.addRange(or),ar.extend(hr.node,hr.offset)):(or.setEnd(hr.node,hr.offset),ar.addRange(or)))}}for(or=[],ar=lr;ar=ar.parentNode;)ar.nodeType===1&&or.push({element:ar,left:ar.scrollLeft,top:ar.scrollTop});for(typeof lr.focus=="function"&&lr.focus(),lr=0;lr<or.length;lr++)ar=or[lr],ar.element.scrollLeft=ar.left,ar.element.scrollTop=ar.top}}var Pe$1=ia&&"documentMode"in document&&11>=document.documentMode,Qe$1=null,Re$1=null,Se$1=null,Te$1=!1;function Ue$1(ar,or,lr){var cr=lr.window===lr?lr.document:lr.nodeType===9?lr:lr.ownerDocument;Te$1||Qe$1==null||Qe$1!==Xa(cr)||(cr=Qe$1,"selectionStart"in cr&&Ne$1(cr)?cr={start:cr.selectionStart,end:cr.selectionEnd}:(cr=(cr.ownerDocument&&cr.ownerDocument.defaultView||window).getSelection(),cr={anchorNode:cr.anchorNode,anchorOffset:cr.anchorOffset,focusNode:cr.focusNode,focusOffset:cr.focusOffset}),Se$1&&Ie$1(Se$1,cr)||(Se$1=cr,cr=oe$1(Re$1,"onSelect"),0<cr.length&&(or=new td("onSelect","select",null,or,lr),ar.push({event:or,listeners:cr}),or.target=Qe$1)))}function Ve$1(ar,or){var lr={};return lr[ar.toLowerCase()]=or.toLowerCase(),lr["Webkit"+ar]="webkit"+or,lr["Moz"+ar]="moz"+or,lr}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe$1={},Ye$1={};ia&&(Ye$1=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);function Ze$1(ar){if(Xe$1[ar])return Xe$1[ar];if(!We$1[ar])return ar;var or=We$1[ar],lr;for(lr in or)if(or.hasOwnProperty(lr)&&lr in Ye$1)return Xe$1[ar]=or[lr];return ar}var $e$1=Ze$1("animationend"),af=Ze$1("animationiteration"),bf=Ze$1("animationstart"),cf=Ze$1("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(ar,or){df.set(ar,or),fa(or,[ar])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(ar,or,lr){var cr=ar.type||"unknown-event";ar.currentTarget=lr,Ub(cr,or,void 0,ar),ar.currentTarget=null}function se$1(ar,or){or=(or&4)!==0;for(var lr=0;lr<ar.length;lr++){var cr=ar[lr],ur=cr.event;cr=cr.listeners;e:{var dr=void 0;if(or)for(var hr=cr.length-1;0<=hr;hr--){var pr=cr[hr],xr=pr.instance,mr=pr.currentTarget;if(pr=pr.listener,xr!==dr&&ur.isPropagationStopped())break e;nf(ur,pr,mr),dr=xr}else for(hr=0;hr<cr.length;hr++){if(pr=cr[hr],xr=pr.instance,mr=pr.currentTarget,pr=pr.listener,xr!==dr&&ur.isPropagationStopped())break e;nf(ur,pr,mr),dr=xr}}}if(Qb)throw ar=Rb,Qb=!1,Rb=null,ar}function D$1(ar,or){var lr=or[of];lr===void 0&&(lr=or[of]=new Set);var cr=ar+"__bubble";lr.has(cr)||(pf(or,ar,2,!1),lr.add(cr))}function qf(ar,or,lr){var cr=0;or&&(cr|=4),pf(lr,ar,cr,or)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(ar){if(!ar[rf]){ar[rf]=!0,da.forEach(function(lr){lr!=="selectionchange"&&(mf.has(lr)||qf(lr,!1,ar),qf(lr,!0,ar))});var or=ar.nodeType===9?ar:ar.ownerDocument;or===null||or[rf]||(or[rf]=!0,qf("selectionchange",!1,or))}}function pf(ar,or,lr,cr){switch(jd(or)){case 1:var ur=ed;break;case 4:ur=gd;break;default:ur=fd}lr=ur.bind(null,or,lr,ar),ur=void 0,!Lb||or!=="touchstart"&&or!=="touchmove"&&or!=="wheel"||(ur=!0),cr?ur!==void 0?ar.addEventListener(or,lr,{capture:!0,passive:ur}):ar.addEventListener(or,lr,!0):ur!==void 0?ar.addEventListener(or,lr,{passive:ur}):ar.addEventListener(or,lr,!1)}function hd(ar,or,lr,cr,ur){var dr=cr;if(!(or&1)&&!(or&2)&&cr!==null)e:for(;;){if(cr===null)return;var hr=cr.tag;if(hr===3||hr===4){var pr=cr.stateNode.containerInfo;if(pr===ur||pr.nodeType===8&&pr.parentNode===ur)break;if(hr===4)for(hr=cr.return;hr!==null;){var xr=hr.tag;if((xr===3||xr===4)&&(xr=hr.stateNode.containerInfo,xr===ur||xr.nodeType===8&&xr.parentNode===ur))return;hr=hr.return}for(;pr!==null;){if(hr=Wc(pr),hr===null)return;if(xr=hr.tag,xr===5||xr===6){cr=dr=hr;continue e}pr=pr.parentNode}}cr=cr.return}Jb(function(){var mr=dr,fr=xb(lr),Er=[];e:{var vr=df.get(ar);if(vr!==void 0){var gr=td,yr=ar;switch(ar){case"keypress":if(od(lr)===0)break e;case"keydown":case"keyup":gr=Rd;break;case"focusin":yr="focus",gr=Fd;break;case"focusout":yr="blur",gr=Fd;break;case"beforeblur":case"afterblur":gr=Fd;break;case"click":if(lr.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":gr=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":gr=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":gr=Vd;break;case $e$1:case af:case bf:gr=Hd;break;case cf:gr=Xd;break;case"scroll":gr=vd;break;case"wheel":gr=Zd;break;case"copy":case"cut":case"paste":gr=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":gr=Td}var jr=(or&4)!==0,br=!jr&&ar==="scroll",_r=jr?vr!==null?vr+"Capture":null:vr;jr=[];for(var wr=mr,Rr;wr!==null;){Rr=wr;var Ar=Rr.stateNode;if(Rr.tag===5&&Ar!==null&&(Rr=Ar,_r!==null&&(Ar=Kb(wr,_r),Ar!=null&&jr.push(tf(wr,Ar,Rr)))),br)break;wr=wr.return}0<jr.length&&(vr=new gr(vr,yr,null,lr,fr),Er.push({event:vr,listeners:jr}))}}if(!(or&7)){e:{if(vr=ar==="mouseover"||ar==="pointerover",gr=ar==="mouseout"||ar==="pointerout",vr&&lr!==wb&&(yr=lr.relatedTarget||lr.fromElement)&&(Wc(yr)||yr[uf]))break e;if((gr||vr)&&(vr=fr.window===fr?fr:(vr=fr.ownerDocument)?vr.defaultView||vr.parentWindow:window,gr?(yr=lr.relatedTarget||lr.toElement,gr=mr,yr=yr?Wc(yr):null,yr!==null&&(br=Vb(yr),yr!==br||yr.tag!==5&&yr.tag!==6)&&(yr=null)):(gr=null,yr=mr),gr!==yr)){if(jr=Bd,Ar="onMouseLeave",_r="onMouseEnter",wr="mouse",(ar==="pointerout"||ar==="pointerover")&&(jr=Td,Ar="onPointerLeave",_r="onPointerEnter",wr="pointer"),br=gr==null?vr:ue$1(gr),Rr=yr==null?vr:ue$1(yr),vr=new jr(Ar,wr+"leave",gr,lr,fr),vr.target=br,vr.relatedTarget=Rr,Ar=null,Wc(fr)===mr&&(jr=new jr(_r,wr+"enter",yr,lr,fr),jr.target=Rr,jr.relatedTarget=br,Ar=jr),br=Ar,gr&&yr)t:{for(jr=gr,_r=yr,wr=0,Rr=jr;Rr;Rr=vf(Rr))wr++;for(Rr=0,Ar=_r;Ar;Ar=vf(Ar))Rr++;for(;0<wr-Rr;)jr=vf(jr),wr--;for(;0<Rr-wr;)_r=vf(_r),Rr--;for(;wr--;){if(jr===_r||_r!==null&&jr===_r.alternate)break t;jr=vf(jr),_r=vf(_r)}jr=null}else jr=null;gr!==null&&wf(Er,vr,gr,jr,!1),yr!==null&&br!==null&&wf(Er,br,yr,jr,!0)}}e:{if(vr=mr?ue$1(mr):window,gr=vr.nodeName&&vr.nodeName.toLowerCase(),gr==="select"||gr==="input"&&vr.type==="file")var Sr=ve$1;else if(me$1(vr))if(we$1)Sr=Fe$1;else{Sr=De$1;var kr=Ce$1}else(gr=vr.nodeName)&&gr.toLowerCase()==="input"&&(vr.type==="checkbox"||vr.type==="radio")&&(Sr=Ee$1);if(Sr&&(Sr=Sr(ar,mr))){ne$1(Er,Sr,lr,fr);break e}kr&&kr(ar,vr,mr),ar==="focusout"&&(kr=vr._wrapperState)&&kr.controlled&&vr.type==="number"&&cb(vr,"number",vr.value)}switch(kr=mr?ue$1(mr):window,ar){case"focusin":(me$1(kr)||kr.contentEditable==="true")&&(Qe$1=kr,Re$1=mr,Se$1=null);break;case"focusout":Se$1=Re$1=Qe$1=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue$1(Er,lr,fr);break;case"selectionchange":if(Pe$1)break;case"keydown":case"keyup":Ue$1(Er,lr,fr)}var Nr;if(ae$1)e:{switch(ar){case"compositionstart":var Cr="onCompositionStart";break e;case"compositionend":Cr="onCompositionEnd";break e;case"compositionupdate":Cr="onCompositionUpdate";break e}Cr=void 0}else ie$1?ge$1(ar,lr)&&(Cr="onCompositionEnd"):ar==="keydown"&&lr.keyCode===229&&(Cr="onCompositionStart");Cr&&(de$1&&lr.locale!=="ko"&&(ie$1||Cr!=="onCompositionStart"?Cr==="onCompositionEnd"&&ie$1&&(Nr=nd()):(kd=fr,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),kr=oe$1(mr,Cr),0<kr.length&&(Cr=new Ld(Cr,ar,null,lr,fr),Er.push({event:Cr,listeners:kr}),Nr?Cr.data=Nr:(Nr=he$1(lr),Nr!==null&&(Cr.data=Nr)))),(Nr=ce$1?je$1(ar,lr):ke$1(ar,lr))&&(mr=oe$1(mr,"onBeforeInput"),0<mr.length&&(fr=new Ld("onBeforeInput","beforeinput",null,lr,fr),Er.push({event:fr,listeners:mr}),fr.data=Nr))}se$1(Er,or)})}function tf(ar,or,lr){return{instance:ar,listener:or,currentTarget:lr}}function oe$1(ar,or){for(var lr=or+"Capture",cr=[];ar!==null;){var ur=ar,dr=ur.stateNode;ur.tag===5&&dr!==null&&(ur=dr,dr=Kb(ar,lr),dr!=null&&cr.unshift(tf(ar,dr,ur)),dr=Kb(ar,or),dr!=null&&cr.push(tf(ar,dr,ur))),ar=ar.return}return cr}function vf(ar){if(ar===null)return null;do ar=ar.return;while(ar&&ar.tag!==5);return ar||null}function wf(ar,or,lr,cr,ur){for(var dr=or._reactName,hr=[];lr!==null&&lr!==cr;){var pr=lr,xr=pr.alternate,mr=pr.stateNode;if(xr!==null&&xr===cr)break;pr.tag===5&&mr!==null&&(pr=mr,ur?(xr=Kb(lr,dr),xr!=null&&hr.unshift(tf(lr,xr,pr))):ur||(xr=Kb(lr,dr),xr!=null&&hr.push(tf(lr,xr,pr)))),lr=lr.return}hr.length!==0&&ar.push({event:or,listeners:hr})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(ar){return(typeof ar=="string"?ar:""+ar).replace(xf,`
`).replace(yf,"")}function Af(ar,or,lr){if(or=zf(or),zf(ar)!==or&&lr)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(ar,or){return ar==="textarea"||ar==="noscript"||typeof or.children=="string"||typeof or.children=="number"||typeof or.dangerouslySetInnerHTML=="object"&&or.dangerouslySetInnerHTML!==null&&or.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(ar){return Hf.resolve(null).then(ar).catch(If)}:Ff;function If(ar){setTimeout(function(){throw ar})}function Kf(ar,or){var lr=or,cr=0;do{var ur=lr.nextSibling;if(ar.removeChild(lr),ur&&ur.nodeType===8)if(lr=ur.data,lr==="/$"){if(cr===0){ar.removeChild(ur),bd(or);return}cr--}else lr!=="$"&&lr!=="$?"&&lr!=="$!"||cr++;lr=ur}while(lr);bd(or)}function Lf(ar){for(;ar!=null;ar=ar.nextSibling){var or=ar.nodeType;if(or===1||or===3)break;if(or===8){if(or=ar.data,or==="$"||or==="$!"||or==="$?")break;if(or==="/$")return null}}return ar}function Mf(ar){ar=ar.previousSibling;for(var or=0;ar;){if(ar.nodeType===8){var lr=ar.data;if(lr==="$"||lr==="$!"||lr==="$?"){if(or===0)return ar;or--}else lr==="/$"&&or++}ar=ar.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(ar){var or=ar[Of];if(or)return or;for(var lr=ar.parentNode;lr;){if(or=lr[uf]||lr[Of]){if(lr=or.alternate,or.child!==null||lr!==null&&lr.child!==null)for(ar=Mf(ar);ar!==null;){if(lr=ar[Of])return lr;ar=Mf(ar)}return or}ar=lr,lr=ar.parentNode}return null}function Cb(ar){return ar=ar[Of]||ar[uf],!ar||ar.tag!==5&&ar.tag!==6&&ar.tag!==13&&ar.tag!==3?null:ar}function ue$1(ar){if(ar.tag===5||ar.tag===6)return ar.stateNode;throw Error(p$1(33))}function Db(ar){return ar[Pf]||null}var Sf=[],Tf=-1;function Uf(ar){return{current:ar}}function E$1(ar){0>Tf||(ar.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(ar,or){Tf++,Sf[Tf]=ar.current,ar.current=or}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(ar,or){var lr=ar.type.contextTypes;if(!lr)return Vf;var cr=ar.stateNode;if(cr&&cr.__reactInternalMemoizedUnmaskedChildContext===or)return cr.__reactInternalMemoizedMaskedChildContext;var ur={},dr;for(dr in lr)ur[dr]=or[dr];return cr&&(ar=ar.stateNode,ar.__reactInternalMemoizedUnmaskedChildContext=or,ar.__reactInternalMemoizedMaskedChildContext=ur),ur}function Zf(ar){return ar=ar.childContextTypes,ar!=null}function $f(){E$1(Wf),E$1(H$1)}function ag(ar,or,lr){if(H$1.current!==Vf)throw Error(p$1(168));G$1(H$1,or),G$1(Wf,lr)}function bg(ar,or,lr){var cr=ar.stateNode;if(or=or.childContextTypes,typeof cr.getChildContext!="function")return lr;cr=cr.getChildContext();for(var ur in cr)if(!(ur in or))throw Error(p$1(108,Ra(ar)||"Unknown",ur));return A$1({},lr,cr)}function cg(ar){return ar=(ar=ar.stateNode)&&ar.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G$1(H$1,ar),G$1(Wf,Wf.current),!0}function dg(ar,or,lr){var cr=ar.stateNode;if(!cr)throw Error(p$1(169));lr?(ar=bg(ar,or,Xf),cr.__reactInternalMemoizedMergedChildContext=ar,E$1(Wf),E$1(H$1),G$1(H$1,ar)):E$1(Wf),G$1(Wf,lr)}var eg=null,fg=!1,gg=!1;function hg(ar){eg===null?eg=[ar]:eg.push(ar)}function ig(ar){fg=!0,hg(ar)}function jg(){if(!gg&&eg!==null){gg=!0;var ar=0,or=C$1;try{var lr=eg;for(C$1=1;ar<lr.length;ar++){var cr=lr[ar];do cr=cr(!0);while(cr!==null)}eg=null,fg=!1}catch(ur){throw eg!==null&&(eg=eg.slice(ar+1)),ac(fc,jg),ur}finally{C$1=or,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(ar,or){kg[lg++]=ng,kg[lg++]=mg,mg=ar,ng=or}function ug(ar,or,lr){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=ar;var cr=rg;ar=sg;var ur=32-oc(cr)-1;cr&=~(1<<ur),lr+=1;var dr=32-oc(or)+ur;if(30<dr){var hr=ur-ur%5;dr=(cr&(1<<hr)-1).toString(32),cr>>=hr,ur-=hr,rg=1<<32-oc(or)+ur|lr<<ur|cr,sg=dr+ar}else rg=1<<dr|lr<<ur|cr,sg=ar}function vg(ar){ar.return!==null&&(tg(ar,1),ug(ar,1,0))}function wg(ar){for(;ar===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;ar===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$1=!1,zg=null;function Ag(ar,or){var lr=Bg(5,null,null,0);lr.elementType="DELETED",lr.stateNode=or,lr.return=ar,or=ar.deletions,or===null?(ar.deletions=[lr],ar.flags|=16):or.push(lr)}function Cg(ar,or){switch(ar.tag){case 5:var lr=ar.type;return or=or.nodeType!==1||lr.toLowerCase()!==or.nodeName.toLowerCase()?null:or,or!==null?(ar.stateNode=or,xg=ar,yg=Lf(or.firstChild),!0):!1;case 6:return or=ar.pendingProps===""||or.nodeType!==3?null:or,or!==null?(ar.stateNode=or,xg=ar,yg=null,!0):!1;case 13:return or=or.nodeType!==8?null:or,or!==null?(lr=qg!==null?{id:rg,overflow:sg}:null,ar.memoizedState={dehydrated:or,treeContext:lr,retryLane:1073741824},lr=Bg(18,null,null,0),lr.stateNode=or,lr.return=ar,ar.child=lr,xg=ar,yg=null,!0):!1;default:return!1}}function Dg(ar){return(ar.mode&1)!==0&&(ar.flags&128)===0}function Eg(ar){if(I$1){var or=yg;if(or){var lr=or;if(!Cg(ar,or)){if(Dg(ar))throw Error(p$1(418));or=Lf(lr.nextSibling);var cr=xg;or&&Cg(ar,or)?Ag(cr,lr):(ar.flags=ar.flags&-4097|2,I$1=!1,xg=ar)}}else{if(Dg(ar))throw Error(p$1(418));ar.flags=ar.flags&-4097|2,I$1=!1,xg=ar}}}function Fg(ar){for(ar=ar.return;ar!==null&&ar.tag!==5&&ar.tag!==3&&ar.tag!==13;)ar=ar.return;xg=ar}function Gg(ar){if(ar!==xg)return!1;if(!I$1)return Fg(ar),I$1=!0,!1;var or;if((or=ar.tag!==3)&&!(or=ar.tag!==5)&&(or=ar.type,or=or!=="head"&&or!=="body"&&!Ef(ar.type,ar.memoizedProps)),or&&(or=yg)){if(Dg(ar))throw Hg(),Error(p$1(418));for(;or;)Ag(ar,or),or=Lf(or.nextSibling)}if(Fg(ar),ar.tag===13){if(ar=ar.memoizedState,ar=ar!==null?ar.dehydrated:null,!ar)throw Error(p$1(317));e:{for(ar=ar.nextSibling,or=0;ar;){if(ar.nodeType===8){var lr=ar.data;if(lr==="/$"){if(or===0){yg=Lf(ar.nextSibling);break e}or--}else lr!=="$"&&lr!=="$!"&&lr!=="$?"||or++}ar=ar.nextSibling}yg=null}}else yg=xg?Lf(ar.stateNode.nextSibling):null;return!0}function Hg(){for(var ar=yg;ar;)ar=Lf(ar.nextSibling)}function Ig(){yg=xg=null,I$1=!1}function Jg(ar){zg===null?zg=[ar]:zg.push(ar)}var Kg=ua.ReactCurrentBatchConfig;function Lg(ar,or,lr){if(ar=lr.ref,ar!==null&&typeof ar!="function"&&typeof ar!="object"){if(lr._owner){if(lr=lr._owner,lr){if(lr.tag!==1)throw Error(p$1(309));var cr=lr.stateNode}if(!cr)throw Error(p$1(147,ar));var ur=cr,dr=""+ar;return or!==null&&or.ref!==null&&typeof or.ref=="function"&&or.ref._stringRef===dr?or.ref:(or=function(hr){var pr=ur.refs;hr===null?delete pr[dr]:pr[dr]=hr},or._stringRef=dr,or)}if(typeof ar!="string")throw Error(p$1(284));if(!lr._owner)throw Error(p$1(290,ar))}return ar}function Mg(ar,or){throw ar=Object.prototype.toString.call(or),Error(p$1(31,ar==="[object Object]"?"object with keys {"+Object.keys(or).join(", ")+"}":ar))}function Ng(ar){var or=ar._init;return or(ar._payload)}function Og(ar){function or(_r,wr){if(ar){var Rr=_r.deletions;Rr===null?(_r.deletions=[wr],_r.flags|=16):Rr.push(wr)}}function lr(_r,wr){if(!ar)return null;for(;wr!==null;)or(_r,wr),wr=wr.sibling;return null}function cr(_r,wr){for(_r=new Map;wr!==null;)wr.key!==null?_r.set(wr.key,wr):_r.set(wr.index,wr),wr=wr.sibling;return _r}function ur(_r,wr){return _r=Pg(_r,wr),_r.index=0,_r.sibling=null,_r}function dr(_r,wr,Rr){return _r.index=Rr,ar?(Rr=_r.alternate,Rr!==null?(Rr=Rr.index,Rr<wr?(_r.flags|=2,wr):Rr):(_r.flags|=2,wr)):(_r.flags|=1048576,wr)}function hr(_r){return ar&&_r.alternate===null&&(_r.flags|=2),_r}function pr(_r,wr,Rr,Ar){return wr===null||wr.tag!==6?(wr=Qg(Rr,_r.mode,Ar),wr.return=_r,wr):(wr=ur(wr,Rr),wr.return=_r,wr)}function xr(_r,wr,Rr,Ar){var Sr=Rr.type;return Sr===ya?fr(_r,wr,Rr.props.children,Ar,Rr.key):wr!==null&&(wr.elementType===Sr||typeof Sr=="object"&&Sr!==null&&Sr.$$typeof===Ha&&Ng(Sr)===wr.type)?(Ar=ur(wr,Rr.props),Ar.ref=Lg(_r,wr,Rr),Ar.return=_r,Ar):(Ar=Rg(Rr.type,Rr.key,Rr.props,null,_r.mode,Ar),Ar.ref=Lg(_r,wr,Rr),Ar.return=_r,Ar)}function mr(_r,wr,Rr,Ar){return wr===null||wr.tag!==4||wr.stateNode.containerInfo!==Rr.containerInfo||wr.stateNode.implementation!==Rr.implementation?(wr=Sg(Rr,_r.mode,Ar),wr.return=_r,wr):(wr=ur(wr,Rr.children||[]),wr.return=_r,wr)}function fr(_r,wr,Rr,Ar,Sr){return wr===null||wr.tag!==7?(wr=Tg(Rr,_r.mode,Ar,Sr),wr.return=_r,wr):(wr=ur(wr,Rr),wr.return=_r,wr)}function Er(_r,wr,Rr){if(typeof wr=="string"&&wr!==""||typeof wr=="number")return wr=Qg(""+wr,_r.mode,Rr),wr.return=_r,wr;if(typeof wr=="object"&&wr!==null){switch(wr.$$typeof){case va:return Rr=Rg(wr.type,wr.key,wr.props,null,_r.mode,Rr),Rr.ref=Lg(_r,null,wr),Rr.return=_r,Rr;case wa:return wr=Sg(wr,_r.mode,Rr),wr.return=_r,wr;case Ha:var Ar=wr._init;return Er(_r,Ar(wr._payload),Rr)}if(eb(wr)||Ka(wr))return wr=Tg(wr,_r.mode,Rr,null),wr.return=_r,wr;Mg(_r,wr)}return null}function vr(_r,wr,Rr,Ar){var Sr=wr!==null?wr.key:null;if(typeof Rr=="string"&&Rr!==""||typeof Rr=="number")return Sr!==null?null:pr(_r,wr,""+Rr,Ar);if(typeof Rr=="object"&&Rr!==null){switch(Rr.$$typeof){case va:return Rr.key===Sr?xr(_r,wr,Rr,Ar):null;case wa:return Rr.key===Sr?mr(_r,wr,Rr,Ar):null;case Ha:return Sr=Rr._init,vr(_r,wr,Sr(Rr._payload),Ar)}if(eb(Rr)||Ka(Rr))return Sr!==null?null:fr(_r,wr,Rr,Ar,null);Mg(_r,Rr)}return null}function gr(_r,wr,Rr,Ar,Sr){if(typeof Ar=="string"&&Ar!==""||typeof Ar=="number")return _r=_r.get(Rr)||null,pr(wr,_r,""+Ar,Sr);if(typeof Ar=="object"&&Ar!==null){switch(Ar.$$typeof){case va:return _r=_r.get(Ar.key===null?Rr:Ar.key)||null,xr(wr,_r,Ar,Sr);case wa:return _r=_r.get(Ar.key===null?Rr:Ar.key)||null,mr(wr,_r,Ar,Sr);case Ha:var kr=Ar._init;return gr(_r,wr,Rr,kr(Ar._payload),Sr)}if(eb(Ar)||Ka(Ar))return _r=_r.get(Rr)||null,fr(wr,_r,Ar,Sr,null);Mg(wr,Ar)}return null}function yr(_r,wr,Rr,Ar){for(var Sr=null,kr=null,Nr=wr,Cr=wr=0,Tr=null;Nr!==null&&Cr<Rr.length;Cr++){Nr.index>Cr?(Tr=Nr,Nr=null):Tr=Nr.sibling;var Pr=vr(_r,Nr,Rr[Cr],Ar);if(Pr===null){Nr===null&&(Nr=Tr);break}ar&&Nr&&Pr.alternate===null&&or(_r,Nr),wr=dr(Pr,wr,Cr),kr===null?Sr=Pr:kr.sibling=Pr,kr=Pr,Nr=Tr}if(Cr===Rr.length)return lr(_r,Nr),I$1&&tg(_r,Cr),Sr;if(Nr===null){for(;Cr<Rr.length;Cr++)Nr=Er(_r,Rr[Cr],Ar),Nr!==null&&(wr=dr(Nr,wr,Cr),kr===null?Sr=Nr:kr.sibling=Nr,kr=Nr);return I$1&&tg(_r,Cr),Sr}for(Nr=cr(_r,Nr);Cr<Rr.length;Cr++)Tr=gr(Nr,_r,Cr,Rr[Cr],Ar),Tr!==null&&(ar&&Tr.alternate!==null&&Nr.delete(Tr.key===null?Cr:Tr.key),wr=dr(Tr,wr,Cr),kr===null?Sr=Tr:kr.sibling=Tr,kr=Tr);return ar&&Nr.forEach(function(Ir){return or(_r,Ir)}),I$1&&tg(_r,Cr),Sr}function jr(_r,wr,Rr,Ar){var Sr=Ka(Rr);if(typeof Sr!="function")throw Error(p$1(150));if(Rr=Sr.call(Rr),Rr==null)throw Error(p$1(151));for(var kr=Sr=null,Nr=wr,Cr=wr=0,Tr=null,Pr=Rr.next();Nr!==null&&!Pr.done;Cr++,Pr=Rr.next()){Nr.index>Cr?(Tr=Nr,Nr=null):Tr=Nr.sibling;var Ir=vr(_r,Nr,Pr.value,Ar);if(Ir===null){Nr===null&&(Nr=Tr);break}ar&&Nr&&Ir.alternate===null&&or(_r,Nr),wr=dr(Ir,wr,Cr),kr===null?Sr=Ir:kr.sibling=Ir,kr=Ir,Nr=Tr}if(Pr.done)return lr(_r,Nr),I$1&&tg(_r,Cr),Sr;if(Nr===null){for(;!Pr.done;Cr++,Pr=Rr.next())Pr=Er(_r,Pr.value,Ar),Pr!==null&&(wr=dr(Pr,wr,Cr),kr===null?Sr=Pr:kr.sibling=Pr,kr=Pr);return I$1&&tg(_r,Cr),Sr}for(Nr=cr(_r,Nr);!Pr.done;Cr++,Pr=Rr.next())Pr=gr(Nr,_r,Cr,Pr.value,Ar),Pr!==null&&(ar&&Pr.alternate!==null&&Nr.delete(Pr.key===null?Cr:Pr.key),wr=dr(Pr,wr,Cr),kr===null?Sr=Pr:kr.sibling=Pr,kr=Pr);return ar&&Nr.forEach(function(Br){return or(_r,Br)}),I$1&&tg(_r,Cr),Sr}function br(_r,wr,Rr,Ar){if(typeof Rr=="object"&&Rr!==null&&Rr.type===ya&&Rr.key===null&&(Rr=Rr.props.children),typeof Rr=="object"&&Rr!==null){switch(Rr.$$typeof){case va:e:{for(var Sr=Rr.key,kr=wr;kr!==null;){if(kr.key===Sr){if(Sr=Rr.type,Sr===ya){if(kr.tag===7){lr(_r,kr.sibling),wr=ur(kr,Rr.props.children),wr.return=_r,_r=wr;break e}}else if(kr.elementType===Sr||typeof Sr=="object"&&Sr!==null&&Sr.$$typeof===Ha&&Ng(Sr)===kr.type){lr(_r,kr.sibling),wr=ur(kr,Rr.props),wr.ref=Lg(_r,kr,Rr),wr.return=_r,_r=wr;break e}lr(_r,kr);break}else or(_r,kr);kr=kr.sibling}Rr.type===ya?(wr=Tg(Rr.props.children,_r.mode,Ar,Rr.key),wr.return=_r,_r=wr):(Ar=Rg(Rr.type,Rr.key,Rr.props,null,_r.mode,Ar),Ar.ref=Lg(_r,wr,Rr),Ar.return=_r,_r=Ar)}return hr(_r);case wa:e:{for(kr=Rr.key;wr!==null;){if(wr.key===kr)if(wr.tag===4&&wr.stateNode.containerInfo===Rr.containerInfo&&wr.stateNode.implementation===Rr.implementation){lr(_r,wr.sibling),wr=ur(wr,Rr.children||[]),wr.return=_r,_r=wr;break e}else{lr(_r,wr);break}else or(_r,wr);wr=wr.sibling}wr=Sg(Rr,_r.mode,Ar),wr.return=_r,_r=wr}return hr(_r);case Ha:return kr=Rr._init,br(_r,wr,kr(Rr._payload),Ar)}if(eb(Rr))return yr(_r,wr,Rr,Ar);if(Ka(Rr))return jr(_r,wr,Rr,Ar);Mg(_r,Rr)}return typeof Rr=="string"&&Rr!==""||typeof Rr=="number"?(Rr=""+Rr,wr!==null&&wr.tag===6?(lr(_r,wr.sibling),wr=ur(wr,Rr),wr.return=_r,_r=wr):(lr(_r,wr),wr=Qg(Rr,_r.mode,Ar),wr.return=_r,_r=wr),hr(_r)):lr(_r,wr)}return br}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(ar){var or=Wg.current;E$1(Wg),ar._currentValue=or}function bh(ar,or,lr){for(;ar!==null;){var cr=ar.alternate;if((ar.childLanes&or)!==or?(ar.childLanes|=or,cr!==null&&(cr.childLanes|=or)):cr!==null&&(cr.childLanes&or)!==or&&(cr.childLanes|=or),ar===lr)break;ar=ar.return}}function ch(ar,or){Xg=ar,Zg=Yg=null,ar=ar.dependencies,ar!==null&&ar.firstContext!==null&&(ar.lanes&or&&(dh=!0),ar.firstContext=null)}function eh(ar){var or=ar._currentValue;if(Zg!==ar)if(ar={context:ar,memoizedValue:or,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=ar,Xg.dependencies={lanes:0,firstContext:ar}}else Yg=Yg.next=ar;return or}var fh=null;function gh(ar){fh===null?fh=[ar]:fh.push(ar)}function hh(ar,or,lr,cr){var ur=or.interleaved;return ur===null?(lr.next=lr,gh(or)):(lr.next=ur.next,ur.next=lr),or.interleaved=lr,ih(ar,cr)}function ih(ar,or){ar.lanes|=or;var lr=ar.alternate;for(lr!==null&&(lr.lanes|=or),lr=ar,ar=ar.return;ar!==null;)ar.childLanes|=or,lr=ar.alternate,lr!==null&&(lr.childLanes|=or),lr=ar,ar=ar.return;return lr.tag===3?lr.stateNode:null}var jh=!1;function kh(ar){ar.updateQueue={baseState:ar.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(ar,or){ar=ar.updateQueue,or.updateQueue===ar&&(or.updateQueue={baseState:ar.baseState,firstBaseUpdate:ar.firstBaseUpdate,lastBaseUpdate:ar.lastBaseUpdate,shared:ar.shared,effects:ar.effects})}function mh(ar,or){return{eventTime:ar,lane:or,tag:0,payload:null,callback:null,next:null}}function nh(ar,or,lr){var cr=ar.updateQueue;if(cr===null)return null;if(cr=cr.shared,K$1&2){var ur=cr.pending;return ur===null?or.next=or:(or.next=ur.next,ur.next=or),cr.pending=or,ih(ar,lr)}return ur=cr.interleaved,ur===null?(or.next=or,gh(cr)):(or.next=ur.next,ur.next=or),cr.interleaved=or,ih(ar,lr)}function oh(ar,or,lr){if(or=or.updateQueue,or!==null&&(or=or.shared,(lr&4194240)!==0)){var cr=or.lanes;cr&=ar.pendingLanes,lr|=cr,or.lanes=lr,Cc(ar,lr)}}function ph(ar,or){var lr=ar.updateQueue,cr=ar.alternate;if(cr!==null&&(cr=cr.updateQueue,lr===cr)){var ur=null,dr=null;if(lr=lr.firstBaseUpdate,lr!==null){do{var hr={eventTime:lr.eventTime,lane:lr.lane,tag:lr.tag,payload:lr.payload,callback:lr.callback,next:null};dr===null?ur=dr=hr:dr=dr.next=hr,lr=lr.next}while(lr!==null);dr===null?ur=dr=or:dr=dr.next=or}else ur=dr=or;lr={baseState:cr.baseState,firstBaseUpdate:ur,lastBaseUpdate:dr,shared:cr.shared,effects:cr.effects},ar.updateQueue=lr;return}ar=lr.lastBaseUpdate,ar===null?lr.firstBaseUpdate=or:ar.next=or,lr.lastBaseUpdate=or}function qh(ar,or,lr,cr){var ur=ar.updateQueue;jh=!1;var dr=ur.firstBaseUpdate,hr=ur.lastBaseUpdate,pr=ur.shared.pending;if(pr!==null){ur.shared.pending=null;var xr=pr,mr=xr.next;xr.next=null,hr===null?dr=mr:hr.next=mr,hr=xr;var fr=ar.alternate;fr!==null&&(fr=fr.updateQueue,pr=fr.lastBaseUpdate,pr!==hr&&(pr===null?fr.firstBaseUpdate=mr:pr.next=mr,fr.lastBaseUpdate=xr))}if(dr!==null){var Er=ur.baseState;hr=0,fr=mr=xr=null,pr=dr;do{var vr=pr.lane,gr=pr.eventTime;if((cr&vr)===vr){fr!==null&&(fr=fr.next={eventTime:gr,lane:0,tag:pr.tag,payload:pr.payload,callback:pr.callback,next:null});e:{var yr=ar,jr=pr;switch(vr=or,gr=lr,jr.tag){case 1:if(yr=jr.payload,typeof yr=="function"){Er=yr.call(gr,Er,vr);break e}Er=yr;break e;case 3:yr.flags=yr.flags&-65537|128;case 0:if(yr=jr.payload,vr=typeof yr=="function"?yr.call(gr,Er,vr):yr,vr==null)break e;Er=A$1({},Er,vr);break e;case 2:jh=!0}}pr.callback!==null&&pr.lane!==0&&(ar.flags|=64,vr=ur.effects,vr===null?ur.effects=[pr]:vr.push(pr))}else gr={eventTime:gr,lane:vr,tag:pr.tag,payload:pr.payload,callback:pr.callback,next:null},fr===null?(mr=fr=gr,xr=Er):fr=fr.next=gr,hr|=vr;if(pr=pr.next,pr===null){if(pr=ur.shared.pending,pr===null)break;vr=pr,pr=vr.next,vr.next=null,ur.lastBaseUpdate=vr,ur.shared.pending=null}}while(!0);if(fr===null&&(xr=Er),ur.baseState=xr,ur.firstBaseUpdate=mr,ur.lastBaseUpdate=fr,or=ur.shared.interleaved,or!==null){ur=or;do hr|=ur.lane,ur=ur.next;while(ur!==or)}else dr===null&&(ur.shared.lanes=0);rh|=hr,ar.lanes=hr,ar.memoizedState=Er}}function sh(ar,or,lr){if(ar=or.effects,or.effects=null,ar!==null)for(or=0;or<ar.length;or++){var cr=ar[or],ur=cr.callback;if(ur!==null){if(cr.callback=null,cr=lr,typeof ur!="function")throw Error(p$1(191,ur));ur.call(cr)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(ar){if(ar===th)throw Error(p$1(174));return ar}function yh(ar,or){switch(G$1(wh,or),G$1(vh,ar),G$1(uh,th),ar=or.nodeType,ar){case 9:case 11:or=(or=or.documentElement)?or.namespaceURI:lb(null,"");break;default:ar=ar===8?or.parentNode:or,or=ar.namespaceURI||null,ar=ar.tagName,or=lb(or,ar)}E$1(uh),G$1(uh,or)}function zh(){E$1(uh),E$1(vh),E$1(wh)}function Ah(ar){xh(wh.current);var or=xh(uh.current),lr=lb(or,ar.type);or!==lr&&(G$1(vh,ar),G$1(uh,lr))}function Bh(ar){vh.current===ar&&(E$1(uh),E$1(vh))}var L$1=Uf(0);function Ch(ar){for(var or=ar;or!==null;){if(or.tag===13){var lr=or.memoizedState;if(lr!==null&&(lr=lr.dehydrated,lr===null||lr.data==="$?"||lr.data==="$!"))return or}else if(or.tag===19&&or.memoizedProps.revealOrder!==void 0){if(or.flags&128)return or}else if(or.child!==null){or.child.return=or,or=or.child;continue}if(or===ar)break;for(;or.sibling===null;){if(or.return===null||or.return===ar)return null;or=or.return}or.sibling.return=or.return,or=or.sibling}return null}var Dh=[];function Eh(){for(var ar=0;ar<Dh.length;ar++)Dh[ar]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N$1=null,O$1=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P$1(){throw Error(p$1(321))}function Mh(ar,or){if(or===null)return!1;for(var lr=0;lr<or.length&&lr<ar.length;lr++)if(!He$1(ar[lr],or[lr]))return!1;return!0}function Nh(ar,or,lr,cr,ur,dr){if(Hh=dr,M$1=or,or.memoizedState=null,or.updateQueue=null,or.lanes=0,Fh.current=ar===null||ar.memoizedState===null?Oh:Ph,ar=lr(cr,ur),Jh){dr=0;do{if(Jh=!1,Kh=0,25<=dr)throw Error(p$1(301));dr+=1,O$1=N$1=null,or.updateQueue=null,Fh.current=Qh,ar=lr(cr,ur)}while(Jh)}if(Fh.current=Rh,or=N$1!==null&&N$1.next!==null,Hh=0,O$1=N$1=M$1=null,Ih=!1,or)throw Error(p$1(300));return ar}function Sh(){var ar=Kh!==0;return Kh=0,ar}function Th(){var ar={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O$1===null?M$1.memoizedState=O$1=ar:O$1=O$1.next=ar,O$1}function Uh(){if(N$1===null){var ar=M$1.alternate;ar=ar!==null?ar.memoizedState:null}else ar=N$1.next;var or=O$1===null?M$1.memoizedState:O$1.next;if(or!==null)O$1=or,N$1=ar;else{if(ar===null)throw Error(p$1(310));N$1=ar,ar={memoizedState:N$1.memoizedState,baseState:N$1.baseState,baseQueue:N$1.baseQueue,queue:N$1.queue,next:null},O$1===null?M$1.memoizedState=O$1=ar:O$1=O$1.next=ar}return O$1}function Vh(ar,or){return typeof or=="function"?or(ar):or}function Wh(ar){var or=Uh(),lr=or.queue;if(lr===null)throw Error(p$1(311));lr.lastRenderedReducer=ar;var cr=N$1,ur=cr.baseQueue,dr=lr.pending;if(dr!==null){if(ur!==null){var hr=ur.next;ur.next=dr.next,dr.next=hr}cr.baseQueue=ur=dr,lr.pending=null}if(ur!==null){dr=ur.next,cr=cr.baseState;var pr=hr=null,xr=null,mr=dr;do{var fr=mr.lane;if((Hh&fr)===fr)xr!==null&&(xr=xr.next={lane:0,action:mr.action,hasEagerState:mr.hasEagerState,eagerState:mr.eagerState,next:null}),cr=mr.hasEagerState?mr.eagerState:ar(cr,mr.action);else{var Er={lane:fr,action:mr.action,hasEagerState:mr.hasEagerState,eagerState:mr.eagerState,next:null};xr===null?(pr=xr=Er,hr=cr):xr=xr.next=Er,M$1.lanes|=fr,rh|=fr}mr=mr.next}while(mr!==null&&mr!==dr);xr===null?hr=cr:xr.next=pr,He$1(cr,or.memoizedState)||(dh=!0),or.memoizedState=cr,or.baseState=hr,or.baseQueue=xr,lr.lastRenderedState=cr}if(ar=lr.interleaved,ar!==null){ur=ar;do dr=ur.lane,M$1.lanes|=dr,rh|=dr,ur=ur.next;while(ur!==ar)}else ur===null&&(lr.lanes=0);return[or.memoizedState,lr.dispatch]}function Xh(ar){var or=Uh(),lr=or.queue;if(lr===null)throw Error(p$1(311));lr.lastRenderedReducer=ar;var cr=lr.dispatch,ur=lr.pending,dr=or.memoizedState;if(ur!==null){lr.pending=null;var hr=ur=ur.next;do dr=ar(dr,hr.action),hr=hr.next;while(hr!==ur);He$1(dr,or.memoizedState)||(dh=!0),or.memoizedState=dr,or.baseQueue===null&&(or.baseState=dr),lr.lastRenderedState=dr}return[dr,cr]}function Yh(){}function Zh(ar,or){var lr=M$1,cr=Uh(),ur=or(),dr=!He$1(cr.memoizedState,ur);if(dr&&(cr.memoizedState=ur,dh=!0),cr=cr.queue,$h(ai.bind(null,lr,cr,ar),[ar]),cr.getSnapshot!==or||dr||O$1!==null&&O$1.memoizedState.tag&1){if(lr.flags|=2048,bi(9,ci.bind(null,lr,cr,ur,or),void 0,null),Q$1===null)throw Error(p$1(349));Hh&30||di(lr,or,ur)}return ur}function di(ar,or,lr){ar.flags|=16384,ar={getSnapshot:or,value:lr},or=M$1.updateQueue,or===null?(or={lastEffect:null,stores:null},M$1.updateQueue=or,or.stores=[ar]):(lr=or.stores,lr===null?or.stores=[ar]:lr.push(ar))}function ci(ar,or,lr,cr){or.value=lr,or.getSnapshot=cr,ei(or)&&fi(ar)}function ai(ar,or,lr){return lr(function(){ei(or)&&fi(ar)})}function ei(ar){var or=ar.getSnapshot;ar=ar.value;try{var lr=or();return!He$1(ar,lr)}catch{return!0}}function fi(ar){var or=ih(ar,1);or!==null&&gi(or,ar,1,-1)}function hi(ar){var or=Th();return typeof ar=="function"&&(ar=ar()),or.memoizedState=or.baseState=ar,ar={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:ar},or.queue=ar,ar=ar.dispatch=ii.bind(null,M$1,ar),[or.memoizedState,ar]}function bi(ar,or,lr,cr){return ar={tag:ar,create:or,destroy:lr,deps:cr,next:null},or=M$1.updateQueue,or===null?(or={lastEffect:null,stores:null},M$1.updateQueue=or,or.lastEffect=ar.next=ar):(lr=or.lastEffect,lr===null?or.lastEffect=ar.next=ar:(cr=lr.next,lr.next=ar,ar.next=cr,or.lastEffect=ar)),ar}function ji(){return Uh().memoizedState}function ki(ar,or,lr,cr){var ur=Th();M$1.flags|=ar,ur.memoizedState=bi(1|or,lr,void 0,cr===void 0?null:cr)}function li(ar,or,lr,cr){var ur=Uh();cr=cr===void 0?null:cr;var dr=void 0;if(N$1!==null){var hr=N$1.memoizedState;if(dr=hr.destroy,cr!==null&&Mh(cr,hr.deps)){ur.memoizedState=bi(or,lr,dr,cr);return}}M$1.flags|=ar,ur.memoizedState=bi(1|or,lr,dr,cr)}function mi(ar,or){return ki(8390656,8,ar,or)}function $h(ar,or){return li(2048,8,ar,or)}function ni(ar,or){return li(4,2,ar,or)}function oi(ar,or){return li(4,4,ar,or)}function pi(ar,or){if(typeof or=="function")return ar=ar(),or(ar),function(){or(null)};if(or!=null)return ar=ar(),or.current=ar,function(){or.current=null}}function qi(ar,or,lr){return lr=lr!=null?lr.concat([ar]):null,li(4,4,pi.bind(null,or,ar),lr)}function ri(){}function si(ar,or){var lr=Uh();or=or===void 0?null:or;var cr=lr.memoizedState;return cr!==null&&or!==null&&Mh(or,cr[1])?cr[0]:(lr.memoizedState=[ar,or],ar)}function ti(ar,or){var lr=Uh();or=or===void 0?null:or;var cr=lr.memoizedState;return cr!==null&&or!==null&&Mh(or,cr[1])?cr[0]:(ar=ar(),lr.memoizedState=[ar,or],ar)}function ui(ar,or,lr){return Hh&21?(He$1(lr,or)||(lr=yc(),M$1.lanes|=lr,rh|=lr,ar.baseState=!0),or):(ar.baseState&&(ar.baseState=!1,dh=!0),ar.memoizedState=lr)}function vi(ar,or){var lr=C$1;C$1=lr!==0&&4>lr?lr:4,ar(!0);var cr=Gh.transition;Gh.transition={};try{ar(!1),or()}finally{C$1=lr,Gh.transition=cr}}function wi(){return Uh().memoizedState}function xi(ar,or,lr){var cr=yi(ar);if(lr={lane:cr,action:lr,hasEagerState:!1,eagerState:null,next:null},zi(ar))Ai(or,lr);else if(lr=hh(ar,or,lr,cr),lr!==null){var ur=R$1();gi(lr,ar,cr,ur),Bi(lr,or,cr)}}function ii(ar,or,lr){var cr=yi(ar),ur={lane:cr,action:lr,hasEagerState:!1,eagerState:null,next:null};if(zi(ar))Ai(or,ur);else{var dr=ar.alternate;if(ar.lanes===0&&(dr===null||dr.lanes===0)&&(dr=or.lastRenderedReducer,dr!==null))try{var hr=or.lastRenderedState,pr=dr(hr,lr);if(ur.hasEagerState=!0,ur.eagerState=pr,He$1(pr,hr)){var xr=or.interleaved;xr===null?(ur.next=ur,gh(or)):(ur.next=xr.next,xr.next=ur),or.interleaved=ur;return}}catch{}finally{}lr=hh(ar,or,ur,cr),lr!==null&&(ur=R$1(),gi(lr,ar,cr,ur),Bi(lr,or,cr))}}function zi(ar){var or=ar.alternate;return ar===M$1||or!==null&&or===M$1}function Ai(ar,or){Jh=Ih=!0;var lr=ar.pending;lr===null?or.next=or:(or.next=lr.next,lr.next=or),ar.pending=or}function Bi(ar,or,lr){if(lr&4194240){var cr=or.lanes;cr&=ar.pendingLanes,lr|=cr,or.lanes=lr,Cc(ar,lr)}}var Rh={readContext:eh,useCallback:P$1,useContext:P$1,useEffect:P$1,useImperativeHandle:P$1,useInsertionEffect:P$1,useLayoutEffect:P$1,useMemo:P$1,useReducer:P$1,useRef:P$1,useState:P$1,useDebugValue:P$1,useDeferredValue:P$1,useTransition:P$1,useMutableSource:P$1,useSyncExternalStore:P$1,useId:P$1,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(ar,or){return Th().memoizedState=[ar,or===void 0?null:or],ar},useContext:eh,useEffect:mi,useImperativeHandle:function(ar,or,lr){return lr=lr!=null?lr.concat([ar]):null,ki(4194308,4,pi.bind(null,or,ar),lr)},useLayoutEffect:function(ar,or){return ki(4194308,4,ar,or)},useInsertionEffect:function(ar,or){return ki(4,2,ar,or)},useMemo:function(ar,or){var lr=Th();return or=or===void 0?null:or,ar=ar(),lr.memoizedState=[ar,or],ar},useReducer:function(ar,or,lr){var cr=Th();return or=lr!==void 0?lr(or):or,cr.memoizedState=cr.baseState=or,ar={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ar,lastRenderedState:or},cr.queue=ar,ar=ar.dispatch=xi.bind(null,M$1,ar),[cr.memoizedState,ar]},useRef:function(ar){var or=Th();return ar={current:ar},or.memoizedState=ar},useState:hi,useDebugValue:ri,useDeferredValue:function(ar){return Th().memoizedState=ar},useTransition:function(){var ar=hi(!1),or=ar[0];return ar=vi.bind(null,ar[1]),Th().memoizedState=ar,[or,ar]},useMutableSource:function(){},useSyncExternalStore:function(ar,or,lr){var cr=M$1,ur=Th();if(I$1){if(lr===void 0)throw Error(p$1(407));lr=lr()}else{if(lr=or(),Q$1===null)throw Error(p$1(349));Hh&30||di(cr,or,lr)}ur.memoizedState=lr;var dr={value:lr,getSnapshot:or};return ur.queue=dr,mi(ai.bind(null,cr,dr,ar),[ar]),cr.flags|=2048,bi(9,ci.bind(null,cr,dr,lr,or),void 0,null),lr},useId:function(){var ar=Th(),or=Q$1.identifierPrefix;if(I$1){var lr=sg,cr=rg;lr=(cr&~(1<<32-oc(cr)-1)).toString(32)+lr,or=":"+or+"R"+lr,lr=Kh++,0<lr&&(or+="H"+lr.toString(32)),or+=":"}else lr=Lh++,or=":"+or+"r"+lr.toString(32)+":";return ar.memoizedState=or},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(ar){var or=Uh();return ui(or,N$1.memoizedState,ar)},useTransition:function(){var ar=Wh(Vh)[0],or=Uh().memoizedState;return[ar,or]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(ar){var or=Uh();return N$1===null?or.memoizedState=ar:ui(or,N$1.memoizedState,ar)},useTransition:function(){var ar=Xh(Vh)[0],or=Uh().memoizedState;return[ar,or]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(ar,or){if(ar&&ar.defaultProps){or=A$1({},or),ar=ar.defaultProps;for(var lr in ar)or[lr]===void 0&&(or[lr]=ar[lr]);return or}return or}function Di(ar,or,lr,cr){or=ar.memoizedState,lr=lr(cr,or),lr=lr==null?or:A$1({},or,lr),ar.memoizedState=lr,ar.lanes===0&&(ar.updateQueue.baseState=lr)}var Ei={isMounted:function(ar){return(ar=ar._reactInternals)?Vb(ar)===ar:!1},enqueueSetState:function(ar,or,lr){ar=ar._reactInternals;var cr=R$1(),ur=yi(ar),dr=mh(cr,ur);dr.payload=or,lr!=null&&(dr.callback=lr),or=nh(ar,dr,ur),or!==null&&(gi(or,ar,ur,cr),oh(or,ar,ur))},enqueueReplaceState:function(ar,or,lr){ar=ar._reactInternals;var cr=R$1(),ur=yi(ar),dr=mh(cr,ur);dr.tag=1,dr.payload=or,lr!=null&&(dr.callback=lr),or=nh(ar,dr,ur),or!==null&&(gi(or,ar,ur,cr),oh(or,ar,ur))},enqueueForceUpdate:function(ar,or){ar=ar._reactInternals;var lr=R$1(),cr=yi(ar),ur=mh(lr,cr);ur.tag=2,or!=null&&(ur.callback=or),or=nh(ar,ur,cr),or!==null&&(gi(or,ar,cr,lr),oh(or,ar,cr))}};function Fi(ar,or,lr,cr,ur,dr,hr){return ar=ar.stateNode,typeof ar.shouldComponentUpdate=="function"?ar.shouldComponentUpdate(cr,dr,hr):or.prototype&&or.prototype.isPureReactComponent?!Ie$1(lr,cr)||!Ie$1(ur,dr):!0}function Gi(ar,or,lr){var cr=!1,ur=Vf,dr=or.contextType;return typeof dr=="object"&&dr!==null?dr=eh(dr):(ur=Zf(or)?Xf:H$1.current,cr=or.contextTypes,dr=(cr=cr!=null)?Yf(ar,ur):Vf),or=new or(lr,dr),ar.memoizedState=or.state!==null&&or.state!==void 0?or.state:null,or.updater=Ei,ar.stateNode=or,or._reactInternals=ar,cr&&(ar=ar.stateNode,ar.__reactInternalMemoizedUnmaskedChildContext=ur,ar.__reactInternalMemoizedMaskedChildContext=dr),or}function Hi(ar,or,lr,cr){ar=or.state,typeof or.componentWillReceiveProps=="function"&&or.componentWillReceiveProps(lr,cr),typeof or.UNSAFE_componentWillReceiveProps=="function"&&or.UNSAFE_componentWillReceiveProps(lr,cr),or.state!==ar&&Ei.enqueueReplaceState(or,or.state,null)}function Ii(ar,or,lr,cr){var ur=ar.stateNode;ur.props=lr,ur.state=ar.memoizedState,ur.refs={},kh(ar);var dr=or.contextType;typeof dr=="object"&&dr!==null?ur.context=eh(dr):(dr=Zf(or)?Xf:H$1.current,ur.context=Yf(ar,dr)),ur.state=ar.memoizedState,dr=or.getDerivedStateFromProps,typeof dr=="function"&&(Di(ar,or,dr,lr),ur.state=ar.memoizedState),typeof or.getDerivedStateFromProps=="function"||typeof ur.getSnapshotBeforeUpdate=="function"||typeof ur.UNSAFE_componentWillMount!="function"&&typeof ur.componentWillMount!="function"||(or=ur.state,typeof ur.componentWillMount=="function"&&ur.componentWillMount(),typeof ur.UNSAFE_componentWillMount=="function"&&ur.UNSAFE_componentWillMount(),or!==ur.state&&Ei.enqueueReplaceState(ur,ur.state,null),qh(ar,lr,ur,cr),ur.state=ar.memoizedState),typeof ur.componentDidMount=="function"&&(ar.flags|=4194308)}function Ji(ar,or){try{var lr="",cr=or;do lr+=Pa(cr),cr=cr.return;while(cr);var ur=lr}catch(dr){ur=`
Error generating stack: `+dr.message+`
`+dr.stack}return{value:ar,source:or,stack:ur,digest:null}}function Ki(ar,or,lr){return{value:ar,source:null,stack:lr??null,digest:or??null}}function Li(ar,or){try{console.error(or.value)}catch(lr){setTimeout(function(){throw lr})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(ar,or,lr){lr=mh(-1,lr),lr.tag=3,lr.payload={element:null};var cr=or.value;return lr.callback=function(){Oi||(Oi=!0,Pi=cr),Li(ar,or)},lr}function Qi(ar,or,lr){lr=mh(-1,lr),lr.tag=3;var cr=ar.type.getDerivedStateFromError;if(typeof cr=="function"){var ur=or.value;lr.payload=function(){return cr(ur)},lr.callback=function(){Li(ar,or)}}var dr=ar.stateNode;return dr!==null&&typeof dr.componentDidCatch=="function"&&(lr.callback=function(){Li(ar,or),typeof cr!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var hr=or.stack;this.componentDidCatch(or.value,{componentStack:hr!==null?hr:""})}),lr}function Si(ar,or,lr){var cr=ar.pingCache;if(cr===null){cr=ar.pingCache=new Mi;var ur=new Set;cr.set(or,ur)}else ur=cr.get(or),ur===void 0&&(ur=new Set,cr.set(or,ur));ur.has(lr)||(ur.add(lr),ar=Ti.bind(null,ar,or,lr),or.then(ar,ar))}function Ui(ar){do{var or;if((or=ar.tag===13)&&(or=ar.memoizedState,or=or!==null?or.dehydrated!==null:!0),or)return ar;ar=ar.return}while(ar!==null);return null}function Vi(ar,or,lr,cr,ur){return ar.mode&1?(ar.flags|=65536,ar.lanes=ur,ar):(ar===or?ar.flags|=65536:(ar.flags|=128,lr.flags|=131072,lr.flags&=-52805,lr.tag===1&&(lr.alternate===null?lr.tag=17:(or=mh(-1,1),or.tag=2,nh(lr,or,1))),lr.lanes|=1),ar)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(ar,or,lr,cr){or.child=ar===null?Vg(or,null,lr,cr):Ug(or,ar.child,lr,cr)}function Yi(ar,or,lr,cr,ur){lr=lr.render;var dr=or.ref;return ch(or,ur),cr=Nh(ar,or,lr,cr,dr,ur),lr=Sh(),ar!==null&&!dh?(or.updateQueue=ar.updateQueue,or.flags&=-2053,ar.lanes&=~ur,Zi(ar,or,ur)):(I$1&&lr&&vg(or),or.flags|=1,Xi(ar,or,cr,ur),or.child)}function $i(ar,or,lr,cr,ur){if(ar===null){var dr=lr.type;return typeof dr=="function"&&!aj(dr)&&dr.defaultProps===void 0&&lr.compare===null&&lr.defaultProps===void 0?(or.tag=15,or.type=dr,bj(ar,or,dr,cr,ur)):(ar=Rg(lr.type,null,cr,or,or.mode,ur),ar.ref=or.ref,ar.return=or,or.child=ar)}if(dr=ar.child,!(ar.lanes&ur)){var hr=dr.memoizedProps;if(lr=lr.compare,lr=lr!==null?lr:Ie$1,lr(hr,cr)&&ar.ref===or.ref)return Zi(ar,or,ur)}return or.flags|=1,ar=Pg(dr,cr),ar.ref=or.ref,ar.return=or,or.child=ar}function bj(ar,or,lr,cr,ur){if(ar!==null){var dr=ar.memoizedProps;if(Ie$1(dr,cr)&&ar.ref===or.ref)if(dh=!1,or.pendingProps=cr=dr,(ar.lanes&ur)!==0)ar.flags&131072&&(dh=!0);else return or.lanes=ar.lanes,Zi(ar,or,ur)}return cj(ar,or,lr,cr,ur)}function dj(ar,or,lr){var cr=or.pendingProps,ur=cr.children,dr=ar!==null?ar.memoizedState:null;if(cr.mode==="hidden")if(!(or.mode&1))or.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(ej,fj),fj|=lr;else{if(!(lr&1073741824))return ar=dr!==null?dr.baseLanes|lr:lr,or.lanes=or.childLanes=1073741824,or.memoizedState={baseLanes:ar,cachePool:null,transitions:null},or.updateQueue=null,G$1(ej,fj),fj|=ar,null;or.memoizedState={baseLanes:0,cachePool:null,transitions:null},cr=dr!==null?dr.baseLanes:lr,G$1(ej,fj),fj|=cr}else dr!==null?(cr=dr.baseLanes|lr,or.memoizedState=null):cr=lr,G$1(ej,fj),fj|=cr;return Xi(ar,or,ur,lr),or.child}function gj(ar,or){var lr=or.ref;(ar===null&&lr!==null||ar!==null&&ar.ref!==lr)&&(or.flags|=512,or.flags|=2097152)}function cj(ar,or,lr,cr,ur){var dr=Zf(lr)?Xf:H$1.current;return dr=Yf(or,dr),ch(or,ur),lr=Nh(ar,or,lr,cr,dr,ur),cr=Sh(),ar!==null&&!dh?(or.updateQueue=ar.updateQueue,or.flags&=-2053,ar.lanes&=~ur,Zi(ar,or,ur)):(I$1&&cr&&vg(or),or.flags|=1,Xi(ar,or,lr,ur),or.child)}function hj(ar,or,lr,cr,ur){if(Zf(lr)){var dr=!0;cg(or)}else dr=!1;if(ch(or,ur),or.stateNode===null)ij(ar,or),Gi(or,lr,cr),Ii(or,lr,cr,ur),cr=!0;else if(ar===null){var hr=or.stateNode,pr=or.memoizedProps;hr.props=pr;var xr=hr.context,mr=lr.contextType;typeof mr=="object"&&mr!==null?mr=eh(mr):(mr=Zf(lr)?Xf:H$1.current,mr=Yf(or,mr));var fr=lr.getDerivedStateFromProps,Er=typeof fr=="function"||typeof hr.getSnapshotBeforeUpdate=="function";Er||typeof hr.UNSAFE_componentWillReceiveProps!="function"&&typeof hr.componentWillReceiveProps!="function"||(pr!==cr||xr!==mr)&&Hi(or,hr,cr,mr),jh=!1;var vr=or.memoizedState;hr.state=vr,qh(or,cr,hr,ur),xr=or.memoizedState,pr!==cr||vr!==xr||Wf.current||jh?(typeof fr=="function"&&(Di(or,lr,fr,cr),xr=or.memoizedState),(pr=jh||Fi(or,lr,pr,cr,vr,xr,mr))?(Er||typeof hr.UNSAFE_componentWillMount!="function"&&typeof hr.componentWillMount!="function"||(typeof hr.componentWillMount=="function"&&hr.componentWillMount(),typeof hr.UNSAFE_componentWillMount=="function"&&hr.UNSAFE_componentWillMount()),typeof hr.componentDidMount=="function"&&(or.flags|=4194308)):(typeof hr.componentDidMount=="function"&&(or.flags|=4194308),or.memoizedProps=cr,or.memoizedState=xr),hr.props=cr,hr.state=xr,hr.context=mr,cr=pr):(typeof hr.componentDidMount=="function"&&(or.flags|=4194308),cr=!1)}else{hr=or.stateNode,lh(ar,or),pr=or.memoizedProps,mr=or.type===or.elementType?pr:Ci(or.type,pr),hr.props=mr,Er=or.pendingProps,vr=hr.context,xr=lr.contextType,typeof xr=="object"&&xr!==null?xr=eh(xr):(xr=Zf(lr)?Xf:H$1.current,xr=Yf(or,xr));var gr=lr.getDerivedStateFromProps;(fr=typeof gr=="function"||typeof hr.getSnapshotBeforeUpdate=="function")||typeof hr.UNSAFE_componentWillReceiveProps!="function"&&typeof hr.componentWillReceiveProps!="function"||(pr!==Er||vr!==xr)&&Hi(or,hr,cr,xr),jh=!1,vr=or.memoizedState,hr.state=vr,qh(or,cr,hr,ur);var yr=or.memoizedState;pr!==Er||vr!==yr||Wf.current||jh?(typeof gr=="function"&&(Di(or,lr,gr,cr),yr=or.memoizedState),(mr=jh||Fi(or,lr,mr,cr,vr,yr,xr)||!1)?(fr||typeof hr.UNSAFE_componentWillUpdate!="function"&&typeof hr.componentWillUpdate!="function"||(typeof hr.componentWillUpdate=="function"&&hr.componentWillUpdate(cr,yr,xr),typeof hr.UNSAFE_componentWillUpdate=="function"&&hr.UNSAFE_componentWillUpdate(cr,yr,xr)),typeof hr.componentDidUpdate=="function"&&(or.flags|=4),typeof hr.getSnapshotBeforeUpdate=="function"&&(or.flags|=1024)):(typeof hr.componentDidUpdate!="function"||pr===ar.memoizedProps&&vr===ar.memoizedState||(or.flags|=4),typeof hr.getSnapshotBeforeUpdate!="function"||pr===ar.memoizedProps&&vr===ar.memoizedState||(or.flags|=1024),or.memoizedProps=cr,or.memoizedState=yr),hr.props=cr,hr.state=yr,hr.context=xr,cr=mr):(typeof hr.componentDidUpdate!="function"||pr===ar.memoizedProps&&vr===ar.memoizedState||(or.flags|=4),typeof hr.getSnapshotBeforeUpdate!="function"||pr===ar.memoizedProps&&vr===ar.memoizedState||(or.flags|=1024),cr=!1)}return jj(ar,or,lr,cr,dr,ur)}function jj(ar,or,lr,cr,ur,dr){gj(ar,or);var hr=(or.flags&128)!==0;if(!cr&&!hr)return ur&&dg(or,lr,!1),Zi(ar,or,dr);cr=or.stateNode,Wi.current=or;var pr=hr&&typeof lr.getDerivedStateFromError!="function"?null:cr.render();return or.flags|=1,ar!==null&&hr?(or.child=Ug(or,ar.child,null,dr),or.child=Ug(or,null,pr,dr)):Xi(ar,or,pr,dr),or.memoizedState=cr.state,ur&&dg(or,lr,!0),or.child}function kj(ar){var or=ar.stateNode;or.pendingContext?ag(ar,or.pendingContext,or.pendingContext!==or.context):or.context&&ag(ar,or.context,!1),yh(ar,or.containerInfo)}function lj(ar,or,lr,cr,ur){return Ig(),Jg(ur),or.flags|=256,Xi(ar,or,lr,cr),or.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(ar){return{baseLanes:ar,cachePool:null,transitions:null}}function oj(ar,or,lr){var cr=or.pendingProps,ur=L$1.current,dr=!1,hr=(or.flags&128)!==0,pr;if((pr=hr)||(pr=ar!==null&&ar.memoizedState===null?!1:(ur&2)!==0),pr?(dr=!0,or.flags&=-129):(ar===null||ar.memoizedState!==null)&&(ur|=1),G$1(L$1,ur&1),ar===null)return Eg(or),ar=or.memoizedState,ar!==null&&(ar=ar.dehydrated,ar!==null)?(or.mode&1?ar.data==="$!"?or.lanes=8:or.lanes=1073741824:or.lanes=1,null):(hr=cr.children,ar=cr.fallback,dr?(cr=or.mode,dr=or.child,hr={mode:"hidden",children:hr},!(cr&1)&&dr!==null?(dr.childLanes=0,dr.pendingProps=hr):dr=pj(hr,cr,0,null),ar=Tg(ar,cr,lr,null),dr.return=or,ar.return=or,dr.sibling=ar,or.child=dr,or.child.memoizedState=nj(lr),or.memoizedState=mj,ar):qj(or,hr));if(ur=ar.memoizedState,ur!==null&&(pr=ur.dehydrated,pr!==null))return rj(ar,or,hr,cr,pr,ur,lr);if(dr){dr=cr.fallback,hr=or.mode,ur=ar.child,pr=ur.sibling;var xr={mode:"hidden",children:cr.children};return!(hr&1)&&or.child!==ur?(cr=or.child,cr.childLanes=0,cr.pendingProps=xr,or.deletions=null):(cr=Pg(ur,xr),cr.subtreeFlags=ur.subtreeFlags&14680064),pr!==null?dr=Pg(pr,dr):(dr=Tg(dr,hr,lr,null),dr.flags|=2),dr.return=or,cr.return=or,cr.sibling=dr,or.child=cr,cr=dr,dr=or.child,hr=ar.child.memoizedState,hr=hr===null?nj(lr):{baseLanes:hr.baseLanes|lr,cachePool:null,transitions:hr.transitions},dr.memoizedState=hr,dr.childLanes=ar.childLanes&~lr,or.memoizedState=mj,cr}return dr=ar.child,ar=dr.sibling,cr=Pg(dr,{mode:"visible",children:cr.children}),!(or.mode&1)&&(cr.lanes=lr),cr.return=or,cr.sibling=null,ar!==null&&(lr=or.deletions,lr===null?(or.deletions=[ar],or.flags|=16):lr.push(ar)),or.child=cr,or.memoizedState=null,cr}function qj(ar,or){return or=pj({mode:"visible",children:or},ar.mode,0,null),or.return=ar,ar.child=or}function sj(ar,or,lr,cr){return cr!==null&&Jg(cr),Ug(or,ar.child,null,lr),ar=qj(or,or.pendingProps.children),ar.flags|=2,or.memoizedState=null,ar}function rj(ar,or,lr,cr,ur,dr,hr){if(lr)return or.flags&256?(or.flags&=-257,cr=Ki(Error(p$1(422))),sj(ar,or,hr,cr)):or.memoizedState!==null?(or.child=ar.child,or.flags|=128,null):(dr=cr.fallback,ur=or.mode,cr=pj({mode:"visible",children:cr.children},ur,0,null),dr=Tg(dr,ur,hr,null),dr.flags|=2,cr.return=or,dr.return=or,cr.sibling=dr,or.child=cr,or.mode&1&&Ug(or,ar.child,null,hr),or.child.memoizedState=nj(hr),or.memoizedState=mj,dr);if(!(or.mode&1))return sj(ar,or,hr,null);if(ur.data==="$!"){if(cr=ur.nextSibling&&ur.nextSibling.dataset,cr)var pr=cr.dgst;return cr=pr,dr=Error(p$1(419)),cr=Ki(dr,cr,void 0),sj(ar,or,hr,cr)}if(pr=(hr&ar.childLanes)!==0,dh||pr){if(cr=Q$1,cr!==null){switch(hr&-hr){case 4:ur=2;break;case 16:ur=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ur=32;break;case 536870912:ur=268435456;break;default:ur=0}ur=ur&(cr.suspendedLanes|hr)?0:ur,ur!==0&&ur!==dr.retryLane&&(dr.retryLane=ur,ih(ar,ur),gi(cr,ar,ur,-1))}return tj(),cr=Ki(Error(p$1(421))),sj(ar,or,hr,cr)}return ur.data==="$?"?(or.flags|=128,or.child=ar.child,or=uj.bind(null,ar),ur._reactRetry=or,null):(ar=dr.treeContext,yg=Lf(ur.nextSibling),xg=or,I$1=!0,zg=null,ar!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=ar.id,sg=ar.overflow,qg=or),or=qj(or,cr.children),or.flags|=4096,or)}function vj(ar,or,lr){ar.lanes|=or;var cr=ar.alternate;cr!==null&&(cr.lanes|=or),bh(ar.return,or,lr)}function wj(ar,or,lr,cr,ur){var dr=ar.memoizedState;dr===null?ar.memoizedState={isBackwards:or,rendering:null,renderingStartTime:0,last:cr,tail:lr,tailMode:ur}:(dr.isBackwards=or,dr.rendering=null,dr.renderingStartTime=0,dr.last=cr,dr.tail=lr,dr.tailMode=ur)}function xj(ar,or,lr){var cr=or.pendingProps,ur=cr.revealOrder,dr=cr.tail;if(Xi(ar,or,cr.children,lr),cr=L$1.current,cr&2)cr=cr&1|2,or.flags|=128;else{if(ar!==null&&ar.flags&128)e:for(ar=or.child;ar!==null;){if(ar.tag===13)ar.memoizedState!==null&&vj(ar,lr,or);else if(ar.tag===19)vj(ar,lr,or);else if(ar.child!==null){ar.child.return=ar,ar=ar.child;continue}if(ar===or)break e;for(;ar.sibling===null;){if(ar.return===null||ar.return===or)break e;ar=ar.return}ar.sibling.return=ar.return,ar=ar.sibling}cr&=1}if(G$1(L$1,cr),!(or.mode&1))or.memoizedState=null;else switch(ur){case"forwards":for(lr=or.child,ur=null;lr!==null;)ar=lr.alternate,ar!==null&&Ch(ar)===null&&(ur=lr),lr=lr.sibling;lr=ur,lr===null?(ur=or.child,or.child=null):(ur=lr.sibling,lr.sibling=null),wj(or,!1,ur,lr,dr);break;case"backwards":for(lr=null,ur=or.child,or.child=null;ur!==null;){if(ar=ur.alternate,ar!==null&&Ch(ar)===null){or.child=ur;break}ar=ur.sibling,ur.sibling=lr,lr=ur,ur=ar}wj(or,!0,lr,null,dr);break;case"together":wj(or,!1,null,null,void 0);break;default:or.memoizedState=null}return or.child}function ij(ar,or){!(or.mode&1)&&ar!==null&&(ar.alternate=null,or.alternate=null,or.flags|=2)}function Zi(ar,or,lr){if(ar!==null&&(or.dependencies=ar.dependencies),rh|=or.lanes,!(lr&or.childLanes))return null;if(ar!==null&&or.child!==ar.child)throw Error(p$1(153));if(or.child!==null){for(ar=or.child,lr=Pg(ar,ar.pendingProps),or.child=lr,lr.return=or;ar.sibling!==null;)ar=ar.sibling,lr=lr.sibling=Pg(ar,ar.pendingProps),lr.return=or;lr.sibling=null}return or.child}function yj(ar,or,lr){switch(or.tag){case 3:kj(or),Ig();break;case 5:Ah(or);break;case 1:Zf(or.type)&&cg(or);break;case 4:yh(or,or.stateNode.containerInfo);break;case 10:var cr=or.type._context,ur=or.memoizedProps.value;G$1(Wg,cr._currentValue),cr._currentValue=ur;break;case 13:if(cr=or.memoizedState,cr!==null)return cr.dehydrated!==null?(G$1(L$1,L$1.current&1),or.flags|=128,null):lr&or.child.childLanes?oj(ar,or,lr):(G$1(L$1,L$1.current&1),ar=Zi(ar,or,lr),ar!==null?ar.sibling:null);G$1(L$1,L$1.current&1);break;case 19:if(cr=(lr&or.childLanes)!==0,ar.flags&128){if(cr)return xj(ar,or,lr);or.flags|=128}if(ur=or.memoizedState,ur!==null&&(ur.rendering=null,ur.tail=null,ur.lastEffect=null),G$1(L$1,L$1.current),cr)break;return null;case 22:case 23:return or.lanes=0,dj(ar,or,lr)}return Zi(ar,or,lr)}var zj,Aj,Bj,Cj;zj=function(ar,or){for(var lr=or.child;lr!==null;){if(lr.tag===5||lr.tag===6)ar.appendChild(lr.stateNode);else if(lr.tag!==4&&lr.child!==null){lr.child.return=lr,lr=lr.child;continue}if(lr===or)break;for(;lr.sibling===null;){if(lr.return===null||lr.return===or)return;lr=lr.return}lr.sibling.return=lr.return,lr=lr.sibling}};Aj=function(){};Bj=function(ar,or,lr,cr){var ur=ar.memoizedProps;if(ur!==cr){ar=or.stateNode,xh(uh.current);var dr=null;switch(lr){case"input":ur=Ya(ar,ur),cr=Ya(ar,cr),dr=[];break;case"select":ur=A$1({},ur,{value:void 0}),cr=A$1({},cr,{value:void 0}),dr=[];break;case"textarea":ur=gb(ar,ur),cr=gb(ar,cr),dr=[];break;default:typeof ur.onClick!="function"&&typeof cr.onClick=="function"&&(ar.onclick=Bf)}ub(lr,cr);var hr;lr=null;for(mr in ur)if(!cr.hasOwnProperty(mr)&&ur.hasOwnProperty(mr)&&ur[mr]!=null)if(mr==="style"){var pr=ur[mr];for(hr in pr)pr.hasOwnProperty(hr)&&(lr||(lr={}),lr[hr]="")}else mr!=="dangerouslySetInnerHTML"&&mr!=="children"&&mr!=="suppressContentEditableWarning"&&mr!=="suppressHydrationWarning"&&mr!=="autoFocus"&&(ea.hasOwnProperty(mr)?dr||(dr=[]):(dr=dr||[]).push(mr,null));for(mr in cr){var xr=cr[mr];if(pr=ur!=null?ur[mr]:void 0,cr.hasOwnProperty(mr)&&xr!==pr&&(xr!=null||pr!=null))if(mr==="style")if(pr){for(hr in pr)!pr.hasOwnProperty(hr)||xr&&xr.hasOwnProperty(hr)||(lr||(lr={}),lr[hr]="");for(hr in xr)xr.hasOwnProperty(hr)&&pr[hr]!==xr[hr]&&(lr||(lr={}),lr[hr]=xr[hr])}else lr||(dr||(dr=[]),dr.push(mr,lr)),lr=xr;else mr==="dangerouslySetInnerHTML"?(xr=xr?xr.__html:void 0,pr=pr?pr.__html:void 0,xr!=null&&pr!==xr&&(dr=dr||[]).push(mr,xr)):mr==="children"?typeof xr!="string"&&typeof xr!="number"||(dr=dr||[]).push(mr,""+xr):mr!=="suppressContentEditableWarning"&&mr!=="suppressHydrationWarning"&&(ea.hasOwnProperty(mr)?(xr!=null&&mr==="onScroll"&&D$1("scroll",ar),dr||pr===xr||(dr=[])):(dr=dr||[]).push(mr,xr))}lr&&(dr=dr||[]).push("style",lr);var mr=dr;(or.updateQueue=mr)&&(or.flags|=4)}};Cj=function(ar,or,lr,cr){lr!==cr&&(or.flags|=4)};function Dj(ar,or){if(!I$1)switch(ar.tailMode){case"hidden":or=ar.tail;for(var lr=null;or!==null;)or.alternate!==null&&(lr=or),or=or.sibling;lr===null?ar.tail=null:lr.sibling=null;break;case"collapsed":lr=ar.tail;for(var cr=null;lr!==null;)lr.alternate!==null&&(cr=lr),lr=lr.sibling;cr===null?or||ar.tail===null?ar.tail=null:ar.tail.sibling=null:cr.sibling=null}}function S$1(ar){var or=ar.alternate!==null&&ar.alternate.child===ar.child,lr=0,cr=0;if(or)for(var ur=ar.child;ur!==null;)lr|=ur.lanes|ur.childLanes,cr|=ur.subtreeFlags&14680064,cr|=ur.flags&14680064,ur.return=ar,ur=ur.sibling;else for(ur=ar.child;ur!==null;)lr|=ur.lanes|ur.childLanes,cr|=ur.subtreeFlags,cr|=ur.flags,ur.return=ar,ur=ur.sibling;return ar.subtreeFlags|=cr,ar.childLanes=lr,or}function Ej(ar,or,lr){var cr=or.pendingProps;switch(wg(or),or.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(or),null;case 1:return Zf(or.type)&&$f(),S$1(or),null;case 3:return cr=or.stateNode,zh(),E$1(Wf),E$1(H$1),Eh(),cr.pendingContext&&(cr.context=cr.pendingContext,cr.pendingContext=null),(ar===null||ar.child===null)&&(Gg(or)?or.flags|=4:ar===null||ar.memoizedState.isDehydrated&&!(or.flags&256)||(or.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(ar,or),S$1(or),null;case 5:Bh(or);var ur=xh(wh.current);if(lr=or.type,ar!==null&&or.stateNode!=null)Bj(ar,or,lr,cr,ur),ar.ref!==or.ref&&(or.flags|=512,or.flags|=2097152);else{if(!cr){if(or.stateNode===null)throw Error(p$1(166));return S$1(or),null}if(ar=xh(uh.current),Gg(or)){cr=or.stateNode,lr=or.type;var dr=or.memoizedProps;switch(cr[Of]=or,cr[Pf]=dr,ar=(or.mode&1)!==0,lr){case"dialog":D$1("cancel",cr),D$1("close",cr);break;case"iframe":case"object":case"embed":D$1("load",cr);break;case"video":case"audio":for(ur=0;ur<lf.length;ur++)D$1(lf[ur],cr);break;case"source":D$1("error",cr);break;case"img":case"image":case"link":D$1("error",cr),D$1("load",cr);break;case"details":D$1("toggle",cr);break;case"input":Za(cr,dr),D$1("invalid",cr);break;case"select":cr._wrapperState={wasMultiple:!!dr.multiple},D$1("invalid",cr);break;case"textarea":hb(cr,dr),D$1("invalid",cr)}ub(lr,dr),ur=null;for(var hr in dr)if(dr.hasOwnProperty(hr)){var pr=dr[hr];hr==="children"?typeof pr=="string"?cr.textContent!==pr&&(dr.suppressHydrationWarning!==!0&&Af(cr.textContent,pr,ar),ur=["children",pr]):typeof pr=="number"&&cr.textContent!==""+pr&&(dr.suppressHydrationWarning!==!0&&Af(cr.textContent,pr,ar),ur=["children",""+pr]):ea.hasOwnProperty(hr)&&pr!=null&&hr==="onScroll"&&D$1("scroll",cr)}switch(lr){case"input":Va(cr),db$1(cr,dr,!0);break;case"textarea":Va(cr),jb(cr);break;case"select":case"option":break;default:typeof dr.onClick=="function"&&(cr.onclick=Bf)}cr=ur,or.updateQueue=cr,cr!==null&&(or.flags|=4)}else{hr=ur.nodeType===9?ur:ur.ownerDocument,ar==="http://www.w3.org/1999/xhtml"&&(ar=kb(lr)),ar==="http://www.w3.org/1999/xhtml"?lr==="script"?(ar=hr.createElement("div"),ar.innerHTML="<script><\/script>",ar=ar.removeChild(ar.firstChild)):typeof cr.is=="string"?ar=hr.createElement(lr,{is:cr.is}):(ar=hr.createElement(lr),lr==="select"&&(hr=ar,cr.multiple?hr.multiple=!0:cr.size&&(hr.size=cr.size))):ar=hr.createElementNS(ar,lr),ar[Of]=or,ar[Pf]=cr,zj(ar,or,!1,!1),or.stateNode=ar;e:{switch(hr=vb(lr,cr),lr){case"dialog":D$1("cancel",ar),D$1("close",ar),ur=cr;break;case"iframe":case"object":case"embed":D$1("load",ar),ur=cr;break;case"video":case"audio":for(ur=0;ur<lf.length;ur++)D$1(lf[ur],ar);ur=cr;break;case"source":D$1("error",ar),ur=cr;break;case"img":case"image":case"link":D$1("error",ar),D$1("load",ar),ur=cr;break;case"details":D$1("toggle",ar),ur=cr;break;case"input":Za(ar,cr),ur=Ya(ar,cr),D$1("invalid",ar);break;case"option":ur=cr;break;case"select":ar._wrapperState={wasMultiple:!!cr.multiple},ur=A$1({},cr,{value:void 0}),D$1("invalid",ar);break;case"textarea":hb(ar,cr),ur=gb(ar,cr),D$1("invalid",ar);break;default:ur=cr}ub(lr,ur),pr=ur;for(dr in pr)if(pr.hasOwnProperty(dr)){var xr=pr[dr];dr==="style"?sb(ar,xr):dr==="dangerouslySetInnerHTML"?(xr=xr?xr.__html:void 0,xr!=null&&nb(ar,xr)):dr==="children"?typeof xr=="string"?(lr!=="textarea"||xr!=="")&&ob(ar,xr):typeof xr=="number"&&ob(ar,""+xr):dr!=="suppressContentEditableWarning"&&dr!=="suppressHydrationWarning"&&dr!=="autoFocus"&&(ea.hasOwnProperty(dr)?xr!=null&&dr==="onScroll"&&D$1("scroll",ar):xr!=null&&ta(ar,dr,xr,hr))}switch(lr){case"input":Va(ar),db$1(ar,cr,!1);break;case"textarea":Va(ar),jb(ar);break;case"option":cr.value!=null&&ar.setAttribute("value",""+Sa(cr.value));break;case"select":ar.multiple=!!cr.multiple,dr=cr.value,dr!=null?fb(ar,!!cr.multiple,dr,!1):cr.defaultValue!=null&&fb(ar,!!cr.multiple,cr.defaultValue,!0);break;default:typeof ur.onClick=="function"&&(ar.onclick=Bf)}switch(lr){case"button":case"input":case"select":case"textarea":cr=!!cr.autoFocus;break e;case"img":cr=!0;break e;default:cr=!1}}cr&&(or.flags|=4)}or.ref!==null&&(or.flags|=512,or.flags|=2097152)}return S$1(or),null;case 6:if(ar&&or.stateNode!=null)Cj(ar,or,ar.memoizedProps,cr);else{if(typeof cr!="string"&&or.stateNode===null)throw Error(p$1(166));if(lr=xh(wh.current),xh(uh.current),Gg(or)){if(cr=or.stateNode,lr=or.memoizedProps,cr[Of]=or,(dr=cr.nodeValue!==lr)&&(ar=xg,ar!==null))switch(ar.tag){case 3:Af(cr.nodeValue,lr,(ar.mode&1)!==0);break;case 5:ar.memoizedProps.suppressHydrationWarning!==!0&&Af(cr.nodeValue,lr,(ar.mode&1)!==0)}dr&&(or.flags|=4)}else cr=(lr.nodeType===9?lr:lr.ownerDocument).createTextNode(cr),cr[Of]=or,or.stateNode=cr}return S$1(or),null;case 13:if(E$1(L$1),cr=or.memoizedState,ar===null||ar.memoizedState!==null&&ar.memoizedState.dehydrated!==null){if(I$1&&yg!==null&&or.mode&1&&!(or.flags&128))Hg(),Ig(),or.flags|=98560,dr=!1;else if(dr=Gg(or),cr!==null&&cr.dehydrated!==null){if(ar===null){if(!dr)throw Error(p$1(318));if(dr=or.memoizedState,dr=dr!==null?dr.dehydrated:null,!dr)throw Error(p$1(317));dr[Of]=or}else Ig(),!(or.flags&128)&&(or.memoizedState=null),or.flags|=4;S$1(or),dr=!1}else zg!==null&&(Fj(zg),zg=null),dr=!0;if(!dr)return or.flags&65536?or:null}return or.flags&128?(or.lanes=lr,or):(cr=cr!==null,cr!==(ar!==null&&ar.memoizedState!==null)&&cr&&(or.child.flags|=8192,or.mode&1&&(ar===null||L$1.current&1?T$1===0&&(T$1=3):tj())),or.updateQueue!==null&&(or.flags|=4),S$1(or),null);case 4:return zh(),Aj(ar,or),ar===null&&sf(or.stateNode.containerInfo),S$1(or),null;case 10:return ah(or.type._context),S$1(or),null;case 17:return Zf(or.type)&&$f(),S$1(or),null;case 19:if(E$1(L$1),dr=or.memoizedState,dr===null)return S$1(or),null;if(cr=(or.flags&128)!==0,hr=dr.rendering,hr===null)if(cr)Dj(dr,!1);else{if(T$1!==0||ar!==null&&ar.flags&128)for(ar=or.child;ar!==null;){if(hr=Ch(ar),hr!==null){for(or.flags|=128,Dj(dr,!1),cr=hr.updateQueue,cr!==null&&(or.updateQueue=cr,or.flags|=4),or.subtreeFlags=0,cr=lr,lr=or.child;lr!==null;)dr=lr,ar=cr,dr.flags&=14680066,hr=dr.alternate,hr===null?(dr.childLanes=0,dr.lanes=ar,dr.child=null,dr.subtreeFlags=0,dr.memoizedProps=null,dr.memoizedState=null,dr.updateQueue=null,dr.dependencies=null,dr.stateNode=null):(dr.childLanes=hr.childLanes,dr.lanes=hr.lanes,dr.child=hr.child,dr.subtreeFlags=0,dr.deletions=null,dr.memoizedProps=hr.memoizedProps,dr.memoizedState=hr.memoizedState,dr.updateQueue=hr.updateQueue,dr.type=hr.type,ar=hr.dependencies,dr.dependencies=ar===null?null:{lanes:ar.lanes,firstContext:ar.firstContext}),lr=lr.sibling;return G$1(L$1,L$1.current&1|2),or.child}ar=ar.sibling}dr.tail!==null&&B$1()>Gj&&(or.flags|=128,cr=!0,Dj(dr,!1),or.lanes=4194304)}else{if(!cr)if(ar=Ch(hr),ar!==null){if(or.flags|=128,cr=!0,lr=ar.updateQueue,lr!==null&&(or.updateQueue=lr,or.flags|=4),Dj(dr,!0),dr.tail===null&&dr.tailMode==="hidden"&&!hr.alternate&&!I$1)return S$1(or),null}else 2*B$1()-dr.renderingStartTime>Gj&&lr!==1073741824&&(or.flags|=128,cr=!0,Dj(dr,!1),or.lanes=4194304);dr.isBackwards?(hr.sibling=or.child,or.child=hr):(lr=dr.last,lr!==null?lr.sibling=hr:or.child=hr,dr.last=hr)}return dr.tail!==null?(or=dr.tail,dr.rendering=or,dr.tail=or.sibling,dr.renderingStartTime=B$1(),or.sibling=null,lr=L$1.current,G$1(L$1,cr?lr&1|2:lr&1),or):(S$1(or),null);case 22:case 23:return Hj(),cr=or.memoizedState!==null,ar!==null&&ar.memoizedState!==null!==cr&&(or.flags|=8192),cr&&or.mode&1?fj&1073741824&&(S$1(or),or.subtreeFlags&6&&(or.flags|=8192)):S$1(or),null;case 24:return null;case 25:return null}throw Error(p$1(156,or.tag))}function Ij(ar,or){switch(wg(or),or.tag){case 1:return Zf(or.type)&&$f(),ar=or.flags,ar&65536?(or.flags=ar&-65537|128,or):null;case 3:return zh(),E$1(Wf),E$1(H$1),Eh(),ar=or.flags,ar&65536&&!(ar&128)?(or.flags=ar&-65537|128,or):null;case 5:return Bh(or),null;case 13:if(E$1(L$1),ar=or.memoizedState,ar!==null&&ar.dehydrated!==null){if(or.alternate===null)throw Error(p$1(340));Ig()}return ar=or.flags,ar&65536?(or.flags=ar&-65537|128,or):null;case 19:return E$1(L$1),null;case 4:return zh(),null;case 10:return ah(or.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U$1=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Lj(ar,or){var lr=ar.ref;if(lr!==null)if(typeof lr=="function")try{lr(null)}catch(cr){W$1(ar,or,cr)}else lr.current=null}function Mj(ar,or,lr){try{lr()}catch(cr){W$1(ar,or,cr)}}var Nj=!1;function Oj(ar,or){if(Cf=dd,ar=Me$1(),Ne$1(ar)){if("selectionStart"in ar)var lr={start:ar.selectionStart,end:ar.selectionEnd};else e:{lr=(lr=ar.ownerDocument)&&lr.defaultView||window;var cr=lr.getSelection&&lr.getSelection();if(cr&&cr.rangeCount!==0){lr=cr.anchorNode;var ur=cr.anchorOffset,dr=cr.focusNode;cr=cr.focusOffset;try{lr.nodeType,dr.nodeType}catch{lr=null;break e}var hr=0,pr=-1,xr=-1,mr=0,fr=0,Er=ar,vr=null;t:for(;;){for(var gr;Er!==lr||ur!==0&&Er.nodeType!==3||(pr=hr+ur),Er!==dr||cr!==0&&Er.nodeType!==3||(xr=hr+cr),Er.nodeType===3&&(hr+=Er.nodeValue.length),(gr=Er.firstChild)!==null;)vr=Er,Er=gr;for(;;){if(Er===ar)break t;if(vr===lr&&++mr===ur&&(pr=hr),vr===dr&&++fr===cr&&(xr=hr),(gr=Er.nextSibling)!==null)break;Er=vr,vr=Er.parentNode}Er=gr}lr=pr===-1||xr===-1?null:{start:pr,end:xr}}else lr=null}lr=lr||{start:0,end:0}}else lr=null;for(Df={focusedElem:ar,selectionRange:lr},dd=!1,V$1=or;V$1!==null;)if(or=V$1,ar=or.child,(or.subtreeFlags&1028)!==0&&ar!==null)ar.return=or,V$1=ar;else for(;V$1!==null;){or=V$1;try{var yr=or.alternate;if(or.flags&1024)switch(or.tag){case 0:case 11:case 15:break;case 1:if(yr!==null){var jr=yr.memoizedProps,br=yr.memoizedState,_r=or.stateNode,wr=_r.getSnapshotBeforeUpdate(or.elementType===or.type?jr:Ci(or.type,jr),br);_r.__reactInternalSnapshotBeforeUpdate=wr}break;case 3:var Rr=or.stateNode.containerInfo;Rr.nodeType===1?Rr.textContent="":Rr.nodeType===9&&Rr.documentElement&&Rr.removeChild(Rr.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(Ar){W$1(or,or.return,Ar)}if(ar=or.sibling,ar!==null){ar.return=or.return,V$1=ar;break}V$1=or.return}return yr=Nj,Nj=!1,yr}function Pj(ar,or,lr){var cr=or.updateQueue;if(cr=cr!==null?cr.lastEffect:null,cr!==null){var ur=cr=cr.next;do{if((ur.tag&ar)===ar){var dr=ur.destroy;ur.destroy=void 0,dr!==void 0&&Mj(or,lr,dr)}ur=ur.next}while(ur!==cr)}}function Qj(ar,or){if(or=or.updateQueue,or=or!==null?or.lastEffect:null,or!==null){var lr=or=or.next;do{if((lr.tag&ar)===ar){var cr=lr.create;lr.destroy=cr()}lr=lr.next}while(lr!==or)}}function Rj(ar){var or=ar.ref;if(or!==null){var lr=ar.stateNode;switch(ar.tag){case 5:ar=lr;break;default:ar=lr}typeof or=="function"?or(ar):or.current=ar}}function Sj(ar){var or=ar.alternate;or!==null&&(ar.alternate=null,Sj(or)),ar.child=null,ar.deletions=null,ar.sibling=null,ar.tag===5&&(or=ar.stateNode,or!==null&&(delete or[Of],delete or[Pf],delete or[of],delete or[Qf],delete or[Rf])),ar.stateNode=null,ar.return=null,ar.dependencies=null,ar.memoizedProps=null,ar.memoizedState=null,ar.pendingProps=null,ar.stateNode=null,ar.updateQueue=null}function Tj(ar){return ar.tag===5||ar.tag===3||ar.tag===4}function Uj(ar){e:for(;;){for(;ar.sibling===null;){if(ar.return===null||Tj(ar.return))return null;ar=ar.return}for(ar.sibling.return=ar.return,ar=ar.sibling;ar.tag!==5&&ar.tag!==6&&ar.tag!==18;){if(ar.flags&2||ar.child===null||ar.tag===4)continue e;ar.child.return=ar,ar=ar.child}if(!(ar.flags&2))return ar.stateNode}}function Vj(ar,or,lr){var cr=ar.tag;if(cr===5||cr===6)ar=ar.stateNode,or?lr.nodeType===8?lr.parentNode.insertBefore(ar,or):lr.insertBefore(ar,or):(lr.nodeType===8?(or=lr.parentNode,or.insertBefore(ar,lr)):(or=lr,or.appendChild(ar)),lr=lr._reactRootContainer,lr!=null||or.onclick!==null||(or.onclick=Bf));else if(cr!==4&&(ar=ar.child,ar!==null))for(Vj(ar,or,lr),ar=ar.sibling;ar!==null;)Vj(ar,or,lr),ar=ar.sibling}function Wj(ar,or,lr){var cr=ar.tag;if(cr===5||cr===6)ar=ar.stateNode,or?lr.insertBefore(ar,or):lr.appendChild(ar);else if(cr!==4&&(ar=ar.child,ar!==null))for(Wj(ar,or,lr),ar=ar.sibling;ar!==null;)Wj(ar,or,lr),ar=ar.sibling}var X$1=null,Xj=!1;function Yj(ar,or,lr){for(lr=lr.child;lr!==null;)Zj(ar,or,lr),lr=lr.sibling}function Zj(ar,or,lr){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,lr)}catch{}switch(lr.tag){case 5:U$1||Lj(lr,or);case 6:var cr=X$1,ur=Xj;X$1=null,Yj(ar,or,lr),X$1=cr,Xj=ur,X$1!==null&&(Xj?(ar=X$1,lr=lr.stateNode,ar.nodeType===8?ar.parentNode.removeChild(lr):ar.removeChild(lr)):X$1.removeChild(lr.stateNode));break;case 18:X$1!==null&&(Xj?(ar=X$1,lr=lr.stateNode,ar.nodeType===8?Kf(ar.parentNode,lr):ar.nodeType===1&&Kf(ar,lr),bd(ar)):Kf(X$1,lr.stateNode));break;case 4:cr=X$1,ur=Xj,X$1=lr.stateNode.containerInfo,Xj=!0,Yj(ar,or,lr),X$1=cr,Xj=ur;break;case 0:case 11:case 14:case 15:if(!U$1&&(cr=lr.updateQueue,cr!==null&&(cr=cr.lastEffect,cr!==null))){ur=cr=cr.next;do{var dr=ur,hr=dr.destroy;dr=dr.tag,hr!==void 0&&(dr&2||dr&4)&&Mj(lr,or,hr),ur=ur.next}while(ur!==cr)}Yj(ar,or,lr);break;case 1:if(!U$1&&(Lj(lr,or),cr=lr.stateNode,typeof cr.componentWillUnmount=="function"))try{cr.props=lr.memoizedProps,cr.state=lr.memoizedState,cr.componentWillUnmount()}catch(pr){W$1(lr,or,pr)}Yj(ar,or,lr);break;case 21:Yj(ar,or,lr);break;case 22:lr.mode&1?(U$1=(cr=U$1)||lr.memoizedState!==null,Yj(ar,or,lr),U$1=cr):Yj(ar,or,lr);break;default:Yj(ar,or,lr)}}function ak(ar){var or=ar.updateQueue;if(or!==null){ar.updateQueue=null;var lr=ar.stateNode;lr===null&&(lr=ar.stateNode=new Kj),or.forEach(function(cr){var ur=bk.bind(null,ar,cr);lr.has(cr)||(lr.add(cr),cr.then(ur,ur))})}}function ck(ar,or){var lr=or.deletions;if(lr!==null)for(var cr=0;cr<lr.length;cr++){var ur=lr[cr];try{var dr=ar,hr=or,pr=hr;e:for(;pr!==null;){switch(pr.tag){case 5:X$1=pr.stateNode,Xj=!1;break e;case 3:X$1=pr.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=pr.stateNode.containerInfo,Xj=!0;break e}pr=pr.return}if(X$1===null)throw Error(p$1(160));Zj(dr,hr,ur),X$1=null,Xj=!1;var xr=ur.alternate;xr!==null&&(xr.return=null),ur.return=null}catch(mr){W$1(ur,or,mr)}}if(or.subtreeFlags&12854)for(or=or.child;or!==null;)dk(or,ar),or=or.sibling}function dk(ar,or){var lr=ar.alternate,cr=ar.flags;switch(ar.tag){case 0:case 11:case 14:case 15:if(ck(or,ar),ek(ar),cr&4){try{Pj(3,ar,ar.return),Qj(3,ar)}catch(jr){W$1(ar,ar.return,jr)}try{Pj(5,ar,ar.return)}catch(jr){W$1(ar,ar.return,jr)}}break;case 1:ck(or,ar),ek(ar),cr&512&&lr!==null&&Lj(lr,lr.return);break;case 5:if(ck(or,ar),ek(ar),cr&512&&lr!==null&&Lj(lr,lr.return),ar.flags&32){var ur=ar.stateNode;try{ob(ur,"")}catch(jr){W$1(ar,ar.return,jr)}}if(cr&4&&(ur=ar.stateNode,ur!=null)){var dr=ar.memoizedProps,hr=lr!==null?lr.memoizedProps:dr,pr=ar.type,xr=ar.updateQueue;if(ar.updateQueue=null,xr!==null)try{pr==="input"&&dr.type==="radio"&&dr.name!=null&&ab(ur,dr),vb(pr,hr);var mr=vb(pr,dr);for(hr=0;hr<xr.length;hr+=2){var fr=xr[hr],Er=xr[hr+1];fr==="style"?sb(ur,Er):fr==="dangerouslySetInnerHTML"?nb(ur,Er):fr==="children"?ob(ur,Er):ta(ur,fr,Er,mr)}switch(pr){case"input":bb(ur,dr);break;case"textarea":ib(ur,dr);break;case"select":var vr=ur._wrapperState.wasMultiple;ur._wrapperState.wasMultiple=!!dr.multiple;var gr=dr.value;gr!=null?fb(ur,!!dr.multiple,gr,!1):vr!==!!dr.multiple&&(dr.defaultValue!=null?fb(ur,!!dr.multiple,dr.defaultValue,!0):fb(ur,!!dr.multiple,dr.multiple?[]:"",!1))}ur[Pf]=dr}catch(jr){W$1(ar,ar.return,jr)}}break;case 6:if(ck(or,ar),ek(ar),cr&4){if(ar.stateNode===null)throw Error(p$1(162));ur=ar.stateNode,dr=ar.memoizedProps;try{ur.nodeValue=dr}catch(jr){W$1(ar,ar.return,jr)}}break;case 3:if(ck(or,ar),ek(ar),cr&4&&lr!==null&&lr.memoizedState.isDehydrated)try{bd(or.containerInfo)}catch(jr){W$1(ar,ar.return,jr)}break;case 4:ck(or,ar),ek(ar);break;case 13:ck(or,ar),ek(ar),ur=ar.child,ur.flags&8192&&(dr=ur.memoizedState!==null,ur.stateNode.isHidden=dr,!dr||ur.alternate!==null&&ur.alternate.memoizedState!==null||(fk=B$1())),cr&4&&ak(ar);break;case 22:if(fr=lr!==null&&lr.memoizedState!==null,ar.mode&1?(U$1=(mr=U$1)||fr,ck(or,ar),U$1=mr):ck(or,ar),ek(ar),cr&8192){if(mr=ar.memoizedState!==null,(ar.stateNode.isHidden=mr)&&!fr&&ar.mode&1)for(V$1=ar,fr=ar.child;fr!==null;){for(Er=V$1=fr;V$1!==null;){switch(vr=V$1,gr=vr.child,vr.tag){case 0:case 11:case 14:case 15:Pj(4,vr,vr.return);break;case 1:Lj(vr,vr.return);var yr=vr.stateNode;if(typeof yr.componentWillUnmount=="function"){cr=vr,lr=vr.return;try{or=cr,yr.props=or.memoizedProps,yr.state=or.memoizedState,yr.componentWillUnmount()}catch(jr){W$1(cr,lr,jr)}}break;case 5:Lj(vr,vr.return);break;case 22:if(vr.memoizedState!==null){gk(Er);continue}}gr!==null?(gr.return=vr,V$1=gr):gk(Er)}fr=fr.sibling}e:for(fr=null,Er=ar;;){if(Er.tag===5){if(fr===null){fr=Er;try{ur=Er.stateNode,mr?(dr=ur.style,typeof dr.setProperty=="function"?dr.setProperty("display","none","important"):dr.display="none"):(pr=Er.stateNode,xr=Er.memoizedProps.style,hr=xr!=null&&xr.hasOwnProperty("display")?xr.display:null,pr.style.display=rb("display",hr))}catch(jr){W$1(ar,ar.return,jr)}}}else if(Er.tag===6){if(fr===null)try{Er.stateNode.nodeValue=mr?"":Er.memoizedProps}catch(jr){W$1(ar,ar.return,jr)}}else if((Er.tag!==22&&Er.tag!==23||Er.memoizedState===null||Er===ar)&&Er.child!==null){Er.child.return=Er,Er=Er.child;continue}if(Er===ar)break e;for(;Er.sibling===null;){if(Er.return===null||Er.return===ar)break e;fr===Er&&(fr=null),Er=Er.return}fr===Er&&(fr=null),Er.sibling.return=Er.return,Er=Er.sibling}}break;case 19:ck(or,ar),ek(ar),cr&4&&ak(ar);break;case 21:break;default:ck(or,ar),ek(ar)}}function ek(ar){var or=ar.flags;if(or&2){try{e:{for(var lr=ar.return;lr!==null;){if(Tj(lr)){var cr=lr;break e}lr=lr.return}throw Error(p$1(160))}switch(cr.tag){case 5:var ur=cr.stateNode;cr.flags&32&&(ob(ur,""),cr.flags&=-33);var dr=Uj(ar);Wj(ar,dr,ur);break;case 3:case 4:var hr=cr.stateNode.containerInfo,pr=Uj(ar);Vj(ar,pr,hr);break;default:throw Error(p$1(161))}}catch(xr){W$1(ar,ar.return,xr)}ar.flags&=-3}or&4096&&(ar.flags&=-4097)}function hk(ar,or,lr){V$1=ar,ik(ar)}function ik(ar,or,lr){for(var cr=(ar.mode&1)!==0;V$1!==null;){var ur=V$1,dr=ur.child;if(ur.tag===22&&cr){var hr=ur.memoizedState!==null||Jj;if(!hr){var pr=ur.alternate,xr=pr!==null&&pr.memoizedState!==null||U$1;pr=Jj;var mr=U$1;if(Jj=hr,(U$1=xr)&&!mr)for(V$1=ur;V$1!==null;)hr=V$1,xr=hr.child,hr.tag===22&&hr.memoizedState!==null?jk(ur):xr!==null?(xr.return=hr,V$1=xr):jk(ur);for(;dr!==null;)V$1=dr,ik(dr),dr=dr.sibling;V$1=ur,Jj=pr,U$1=mr}kk(ar)}else ur.subtreeFlags&8772&&dr!==null?(dr.return=ur,V$1=dr):kk(ar)}}function kk(ar){for(;V$1!==null;){var or=V$1;if(or.flags&8772){var lr=or.alternate;try{if(or.flags&8772)switch(or.tag){case 0:case 11:case 15:U$1||Qj(5,or);break;case 1:var cr=or.stateNode;if(or.flags&4&&!U$1)if(lr===null)cr.componentDidMount();else{var ur=or.elementType===or.type?lr.memoizedProps:Ci(or.type,lr.memoizedProps);cr.componentDidUpdate(ur,lr.memoizedState,cr.__reactInternalSnapshotBeforeUpdate)}var dr=or.updateQueue;dr!==null&&sh(or,dr,cr);break;case 3:var hr=or.updateQueue;if(hr!==null){if(lr=null,or.child!==null)switch(or.child.tag){case 5:lr=or.child.stateNode;break;case 1:lr=or.child.stateNode}sh(or,hr,lr)}break;case 5:var pr=or.stateNode;if(lr===null&&or.flags&4){lr=pr;var xr=or.memoizedProps;switch(or.type){case"button":case"input":case"select":case"textarea":xr.autoFocus&&lr.focus();break;case"img":xr.src&&(lr.src=xr.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(or.memoizedState===null){var mr=or.alternate;if(mr!==null){var fr=mr.memoizedState;if(fr!==null){var Er=fr.dehydrated;Er!==null&&bd(Er)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U$1||or.flags&512&&Rj(or)}catch(vr){W$1(or,or.return,vr)}}if(or===ar){V$1=null;break}if(lr=or.sibling,lr!==null){lr.return=or.return,V$1=lr;break}V$1=or.return}}function gk(ar){for(;V$1!==null;){var or=V$1;if(or===ar){V$1=null;break}var lr=or.sibling;if(lr!==null){lr.return=or.return,V$1=lr;break}V$1=or.return}}function jk(ar){for(;V$1!==null;){var or=V$1;try{switch(or.tag){case 0:case 11:case 15:var lr=or.return;try{Qj(4,or)}catch(xr){W$1(or,lr,xr)}break;case 1:var cr=or.stateNode;if(typeof cr.componentDidMount=="function"){var ur=or.return;try{cr.componentDidMount()}catch(xr){W$1(or,ur,xr)}}var dr=or.return;try{Rj(or)}catch(xr){W$1(or,dr,xr)}break;case 5:var hr=or.return;try{Rj(or)}catch(xr){W$1(or,hr,xr)}}}catch(xr){W$1(or,or.return,xr)}if(or===ar){V$1=null;break}var pr=or.sibling;if(pr!==null){pr.return=or.return,V$1=pr;break}V$1=or.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K$1=0,Q$1=null,Y$1=null,Z$1=0,fj=0,ej=Uf(0),T$1=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R$1(){return K$1&6?B$1():Ak!==-1?Ak:Ak=B$1()}function yi(ar){return ar.mode&1?K$1&2&&Z$1!==0?Z$1&-Z$1:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(ar=C$1,ar!==0||(ar=window.event,ar=ar===void 0?16:jd(ar.type)),ar):1}function gi(ar,or,lr,cr){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(ar,lr,cr),(!(K$1&2)||ar!==Q$1)&&(ar===Q$1&&(!(K$1&2)&&(qk|=lr),T$1===4&&Ck(ar,Z$1)),Dk(ar,cr),lr===1&&K$1===0&&!(or.mode&1)&&(Gj=B$1()+500,fg&&jg()))}function Dk(ar,or){var lr=ar.callbackNode;wc(ar,or);var cr=uc(ar,ar===Q$1?Z$1:0);if(cr===0)lr!==null&&bc(lr),ar.callbackNode=null,ar.callbackPriority=0;else if(or=cr&-cr,ar.callbackPriority!==or){if(lr!=null&&bc(lr),or===1)ar.tag===0?ig(Ek.bind(null,ar)):hg(Ek.bind(null,ar)),Jf(function(){!(K$1&6)&&jg()}),lr=null;else{switch(Dc(cr)){case 1:lr=fc;break;case 4:lr=gc;break;case 16:lr=hc;break;case 536870912:lr=jc;break;default:lr=hc}lr=Fk(lr,Gk.bind(null,ar))}ar.callbackPriority=or,ar.callbackNode=lr}}function Gk(ar,or){if(Ak=-1,Bk=0,K$1&6)throw Error(p$1(327));var lr=ar.callbackNode;if(Hk()&&ar.callbackNode!==lr)return null;var cr=uc(ar,ar===Q$1?Z$1:0);if(cr===0)return null;if(cr&30||cr&ar.expiredLanes||or)or=Ik(ar,cr);else{or=cr;var ur=K$1;K$1|=2;var dr=Jk();(Q$1!==ar||Z$1!==or)&&(uk=null,Gj=B$1()+500,Kk(ar,or));do try{Lk();break}catch(pr){Mk(ar,pr)}while(!0);$g(),mk.current=dr,K$1=ur,Y$1!==null?or=0:(Q$1=null,Z$1=0,or=T$1)}if(or!==0){if(or===2&&(ur=xc(ar),ur!==0&&(cr=ur,or=Nk(ar,ur))),or===1)throw lr=pk,Kk(ar,0),Ck(ar,cr),Dk(ar,B$1()),lr;if(or===6)Ck(ar,cr);else{if(ur=ar.current.alternate,!(cr&30)&&!Ok(ur)&&(or=Ik(ar,cr),or===2&&(dr=xc(ar),dr!==0&&(cr=dr,or=Nk(ar,dr))),or===1))throw lr=pk,Kk(ar,0),Ck(ar,cr),Dk(ar,B$1()),lr;switch(ar.finishedWork=ur,ar.finishedLanes=cr,or){case 0:case 1:throw Error(p$1(345));case 2:Pk(ar,tk,uk);break;case 3:if(Ck(ar,cr),(cr&130023424)===cr&&(or=fk+500-B$1(),10<or)){if(uc(ar,0)!==0)break;if(ur=ar.suspendedLanes,(ur&cr)!==cr){R$1(),ar.pingedLanes|=ar.suspendedLanes&ur;break}ar.timeoutHandle=Ff(Pk.bind(null,ar,tk,uk),or);break}Pk(ar,tk,uk);break;case 4:if(Ck(ar,cr),(cr&4194240)===cr)break;for(or=ar.eventTimes,ur=-1;0<cr;){var hr=31-oc(cr);dr=1<<hr,hr=or[hr],hr>ur&&(ur=hr),cr&=~dr}if(cr=ur,cr=B$1()-cr,cr=(120>cr?120:480>cr?480:1080>cr?1080:1920>cr?1920:3e3>cr?3e3:4320>cr?4320:1960*lk(cr/1960))-cr,10<cr){ar.timeoutHandle=Ff(Pk.bind(null,ar,tk,uk),cr);break}Pk(ar,tk,uk);break;case 5:Pk(ar,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(ar,B$1()),ar.callbackNode===lr?Gk.bind(null,ar):null}function Nk(ar,or){var lr=sk;return ar.current.memoizedState.isDehydrated&&(Kk(ar,or).flags|=256),ar=Ik(ar,or),ar!==2&&(or=tk,tk=lr,or!==null&&Fj(or)),ar}function Fj(ar){tk===null?tk=ar:tk.push.apply(tk,ar)}function Ok(ar){for(var or=ar;;){if(or.flags&16384){var lr=or.updateQueue;if(lr!==null&&(lr=lr.stores,lr!==null))for(var cr=0;cr<lr.length;cr++){var ur=lr[cr],dr=ur.getSnapshot;ur=ur.value;try{if(!He$1(dr(),ur))return!1}catch{return!1}}}if(lr=or.child,or.subtreeFlags&16384&&lr!==null)lr.return=or,or=lr;else{if(or===ar)break;for(;or.sibling===null;){if(or.return===null||or.return===ar)return!0;or=or.return}or.sibling.return=or.return,or=or.sibling}}return!0}function Ck(ar,or){for(or&=~rk,or&=~qk,ar.suspendedLanes|=or,ar.pingedLanes&=~or,ar=ar.expirationTimes;0<or;){var lr=31-oc(or),cr=1<<lr;ar[lr]=-1,or&=~cr}}function Ek(ar){if(K$1&6)throw Error(p$1(327));Hk();var or=uc(ar,0);if(!(or&1))return Dk(ar,B$1()),null;var lr=Ik(ar,or);if(ar.tag!==0&&lr===2){var cr=xc(ar);cr!==0&&(or=cr,lr=Nk(ar,cr))}if(lr===1)throw lr=pk,Kk(ar,0),Ck(ar,or),Dk(ar,B$1()),lr;if(lr===6)throw Error(p$1(345));return ar.finishedWork=ar.current.alternate,ar.finishedLanes=or,Pk(ar,tk,uk),Dk(ar,B$1()),null}function Qk(ar,or){var lr=K$1;K$1|=1;try{return ar(or)}finally{K$1=lr,K$1===0&&(Gj=B$1()+500,fg&&jg())}}function Rk(ar){wk!==null&&wk.tag===0&&!(K$1&6)&&Hk();var or=K$1;K$1|=1;var lr=ok.transition,cr=C$1;try{if(ok.transition=null,C$1=1,ar)return ar()}finally{C$1=cr,ok.transition=lr,K$1=or,!(K$1&6)&&jg()}}function Hj(){fj=ej.current,E$1(ej)}function Kk(ar,or){ar.finishedWork=null,ar.finishedLanes=0;var lr=ar.timeoutHandle;if(lr!==-1&&(ar.timeoutHandle=-1,Gf(lr)),Y$1!==null)for(lr=Y$1.return;lr!==null;){var cr=lr;switch(wg(cr),cr.tag){case 1:cr=cr.type.childContextTypes,cr!=null&&$f();break;case 3:zh(),E$1(Wf),E$1(H$1),Eh();break;case 5:Bh(cr);break;case 4:zh();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah(cr.type._context);break;case 22:case 23:Hj()}lr=lr.return}if(Q$1=ar,Y$1=ar=Pg(ar.current,null),Z$1=fj=or,T$1=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(or=0;or<fh.length;or++)if(lr=fh[or],cr=lr.interleaved,cr!==null){lr.interleaved=null;var ur=cr.next,dr=lr.pending;if(dr!==null){var hr=dr.next;dr.next=ur,cr.next=hr}lr.pending=cr}fh=null}return ar}function Mk(ar,or){do{var lr=Y$1;try{if($g(),Fh.current=Rh,Ih){for(var cr=M$1.memoizedState;cr!==null;){var ur=cr.queue;ur!==null&&(ur.pending=null),cr=cr.next}Ih=!1}if(Hh=0,O$1=N$1=M$1=null,Jh=!1,Kh=0,nk.current=null,lr===null||lr.return===null){T$1=1,pk=or,Y$1=null;break}e:{var dr=ar,hr=lr.return,pr=lr,xr=or;if(or=Z$1,pr.flags|=32768,xr!==null&&typeof xr=="object"&&typeof xr.then=="function"){var mr=xr,fr=pr,Er=fr.tag;if(!(fr.mode&1)&&(Er===0||Er===11||Er===15)){var vr=fr.alternate;vr?(fr.updateQueue=vr.updateQueue,fr.memoizedState=vr.memoizedState,fr.lanes=vr.lanes):(fr.updateQueue=null,fr.memoizedState=null)}var gr=Ui(hr);if(gr!==null){gr.flags&=-257,Vi(gr,hr,pr,dr,or),gr.mode&1&&Si(dr,mr,or),or=gr,xr=mr;var yr=or.updateQueue;if(yr===null){var jr=new Set;jr.add(xr),or.updateQueue=jr}else yr.add(xr);break e}else{if(!(or&1)){Si(dr,mr,or),tj();break e}xr=Error(p$1(426))}}else if(I$1&&pr.mode&1){var br=Ui(hr);if(br!==null){!(br.flags&65536)&&(br.flags|=256),Vi(br,hr,pr,dr,or),Jg(Ji(xr,pr));break e}}dr=xr=Ji(xr,pr),T$1!==4&&(T$1=2),sk===null?sk=[dr]:sk.push(dr),dr=hr;do{switch(dr.tag){case 3:dr.flags|=65536,or&=-or,dr.lanes|=or;var _r=Ni(dr,xr,or);ph(dr,_r);break e;case 1:pr=xr;var wr=dr.type,Rr=dr.stateNode;if(!(dr.flags&128)&&(typeof wr.getDerivedStateFromError=="function"||Rr!==null&&typeof Rr.componentDidCatch=="function"&&(Ri===null||!Ri.has(Rr)))){dr.flags|=65536,or&=-or,dr.lanes|=or;var Ar=Qi(dr,pr,or);ph(dr,Ar);break e}}dr=dr.return}while(dr!==null)}Sk(lr)}catch(Sr){or=Sr,Y$1===lr&&lr!==null&&(Y$1=lr=lr.return);continue}break}while(!0)}function Jk(){var ar=mk.current;return mk.current=Rh,ar===null?Rh:ar}function tj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),Q$1===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q$1,Z$1)}function Ik(ar,or){var lr=K$1;K$1|=2;var cr=Jk();(Q$1!==ar||Z$1!==or)&&(uk=null,Kk(ar,or));do try{Tk();break}catch(ur){Mk(ar,ur)}while(!0);if($g(),K$1=lr,mk.current=cr,Y$1!==null)throw Error(p$1(261));return Q$1=null,Z$1=0,T$1}function Tk(){for(;Y$1!==null;)Uk(Y$1)}function Lk(){for(;Y$1!==null&&!cc();)Uk(Y$1)}function Uk(ar){var or=Vk(ar.alternate,ar,fj);ar.memoizedProps=ar.pendingProps,or===null?Sk(ar):Y$1=or,nk.current=null}function Sk(ar){var or=ar;do{var lr=or.alternate;if(ar=or.return,or.flags&32768){if(lr=Ij(lr,or),lr!==null){lr.flags&=32767,Y$1=lr;return}if(ar!==null)ar.flags|=32768,ar.subtreeFlags=0,ar.deletions=null;else{T$1=6,Y$1=null;return}}else if(lr=Ej(lr,or,fj),lr!==null){Y$1=lr;return}if(or=or.sibling,or!==null){Y$1=or;return}Y$1=or=ar}while(or!==null);T$1===0&&(T$1=5)}function Pk(ar,or,lr){var cr=C$1,ur=ok.transition;try{ok.transition=null,C$1=1,Wk(ar,or,lr,cr)}finally{ok.transition=ur,C$1=cr}return null}function Wk(ar,or,lr,cr){do Hk();while(wk!==null);if(K$1&6)throw Error(p$1(327));lr=ar.finishedWork;var ur=ar.finishedLanes;if(lr===null)return null;if(ar.finishedWork=null,ar.finishedLanes=0,lr===ar.current)throw Error(p$1(177));ar.callbackNode=null,ar.callbackPriority=0;var dr=lr.lanes|lr.childLanes;if(Bc(ar,dr),ar===Q$1&&(Y$1=Q$1=null,Z$1=0),!(lr.subtreeFlags&2064)&&!(lr.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),dr=(lr.flags&15990)!==0,lr.subtreeFlags&15990||dr){dr=ok.transition,ok.transition=null;var hr=C$1;C$1=1;var pr=K$1;K$1|=4,nk.current=null,Oj(ar,lr),dk(lr,ar),Oe$1(Df),dd=!!Cf,Df=Cf=null,ar.current=lr,hk(lr),dc(),K$1=pr,C$1=hr,ok.transition=dr}else ar.current=lr;if(vk&&(vk=!1,wk=ar,xk=ur),dr=ar.pendingLanes,dr===0&&(Ri=null),mc(lr.stateNode),Dk(ar,B$1()),or!==null)for(cr=ar.onRecoverableError,lr=0;lr<or.length;lr++)ur=or[lr],cr(ur.value,{componentStack:ur.stack,digest:ur.digest});if(Oi)throw Oi=!1,ar=Pi,Pi=null,ar;return xk&1&&ar.tag!==0&&Hk(),dr=ar.pendingLanes,dr&1?ar===zk?yk++:(yk=0,zk=ar):yk=0,jg(),null}function Hk(){if(wk!==null){var ar=Dc(xk),or=ok.transition,lr=C$1;try{if(ok.transition=null,C$1=16>ar?16:ar,wk===null)var cr=!1;else{if(ar=wk,wk=null,xk=0,K$1&6)throw Error(p$1(331));var ur=K$1;for(K$1|=4,V$1=ar.current;V$1!==null;){var dr=V$1,hr=dr.child;if(V$1.flags&16){var pr=dr.deletions;if(pr!==null){for(var xr=0;xr<pr.length;xr++){var mr=pr[xr];for(V$1=mr;V$1!==null;){var fr=V$1;switch(fr.tag){case 0:case 11:case 15:Pj(8,fr,dr)}var Er=fr.child;if(Er!==null)Er.return=fr,V$1=Er;else for(;V$1!==null;){fr=V$1;var vr=fr.sibling,gr=fr.return;if(Sj(fr),fr===mr){V$1=null;break}if(vr!==null){vr.return=gr,V$1=vr;break}V$1=gr}}}var yr=dr.alternate;if(yr!==null){var jr=yr.child;if(jr!==null){yr.child=null;do{var br=jr.sibling;jr.sibling=null,jr=br}while(jr!==null)}}V$1=dr}}if(dr.subtreeFlags&2064&&hr!==null)hr.return=dr,V$1=hr;else e:for(;V$1!==null;){if(dr=V$1,dr.flags&2048)switch(dr.tag){case 0:case 11:case 15:Pj(9,dr,dr.return)}var _r=dr.sibling;if(_r!==null){_r.return=dr.return,V$1=_r;break e}V$1=dr.return}}var wr=ar.current;for(V$1=wr;V$1!==null;){hr=V$1;var Rr=hr.child;if(hr.subtreeFlags&2064&&Rr!==null)Rr.return=hr,V$1=Rr;else e:for(hr=wr;V$1!==null;){if(pr=V$1,pr.flags&2048)try{switch(pr.tag){case 0:case 11:case 15:Qj(9,pr)}}catch(Sr){W$1(pr,pr.return,Sr)}if(pr===hr){V$1=null;break e}var Ar=pr.sibling;if(Ar!==null){Ar.return=pr.return,V$1=Ar;break e}V$1=pr.return}}if(K$1=ur,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,ar)}catch{}cr=!0}return cr}finally{C$1=lr,ok.transition=or}}return!1}function Xk(ar,or,lr){or=Ji(lr,or),or=Ni(ar,or,1),ar=nh(ar,or,1),or=R$1(),ar!==null&&(Ac(ar,1,or),Dk(ar,or))}function W$1(ar,or,lr){if(ar.tag===3)Xk(ar,ar,lr);else for(;or!==null;){if(or.tag===3){Xk(or,ar,lr);break}else if(or.tag===1){var cr=or.stateNode;if(typeof or.type.getDerivedStateFromError=="function"||typeof cr.componentDidCatch=="function"&&(Ri===null||!Ri.has(cr))){ar=Ji(lr,ar),ar=Qi(or,ar,1),or=nh(or,ar,1),ar=R$1(),or!==null&&(Ac(or,1,ar),Dk(or,ar));break}}or=or.return}}function Ti(ar,or,lr){var cr=ar.pingCache;cr!==null&&cr.delete(or),or=R$1(),ar.pingedLanes|=ar.suspendedLanes&lr,Q$1===ar&&(Z$1&lr)===lr&&(T$1===4||T$1===3&&(Z$1&130023424)===Z$1&&500>B$1()-fk?Kk(ar,0):rk|=lr),Dk(ar,or)}function Yk(ar,or){or===0&&(ar.mode&1?(or=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):or=1);var lr=R$1();ar=ih(ar,or),ar!==null&&(Ac(ar,or,lr),Dk(ar,lr))}function uj(ar){var or=ar.memoizedState,lr=0;or!==null&&(lr=or.retryLane),Yk(ar,lr)}function bk(ar,or){var lr=0;switch(ar.tag){case 13:var cr=ar.stateNode,ur=ar.memoizedState;ur!==null&&(lr=ur.retryLane);break;case 19:cr=ar.stateNode;break;default:throw Error(p$1(314))}cr!==null&&cr.delete(or),Yk(ar,lr)}var Vk;Vk=function(ar,or,lr){if(ar!==null)if(ar.memoizedProps!==or.pendingProps||Wf.current)dh=!0;else{if(!(ar.lanes&lr)&&!(or.flags&128))return dh=!1,yj(ar,or,lr);dh=!!(ar.flags&131072)}else dh=!1,I$1&&or.flags&1048576&&ug(or,ng,or.index);switch(or.lanes=0,or.tag){case 2:var cr=or.type;ij(ar,or),ar=or.pendingProps;var ur=Yf(or,H$1.current);ch(or,lr),ur=Nh(null,or,cr,ar,ur,lr);var dr=Sh();return or.flags|=1,typeof ur=="object"&&ur!==null&&typeof ur.render=="function"&&ur.$$typeof===void 0?(or.tag=1,or.memoizedState=null,or.updateQueue=null,Zf(cr)?(dr=!0,cg(or)):dr=!1,or.memoizedState=ur.state!==null&&ur.state!==void 0?ur.state:null,kh(or),ur.updater=Ei,or.stateNode=ur,ur._reactInternals=or,Ii(or,cr,ar,lr),or=jj(null,or,cr,!0,dr,lr)):(or.tag=0,I$1&&dr&&vg(or),Xi(null,or,ur,lr),or=or.child),or;case 16:cr=or.elementType;e:{switch(ij(ar,or),ar=or.pendingProps,ur=cr._init,cr=ur(cr._payload),or.type=cr,ur=or.tag=Zk(cr),ar=Ci(cr,ar),ur){case 0:or=cj(null,or,cr,ar,lr);break e;case 1:or=hj(null,or,cr,ar,lr);break e;case 11:or=Yi(null,or,cr,ar,lr);break e;case 14:or=$i(null,or,cr,Ci(cr.type,ar),lr);break e}throw Error(p$1(306,cr,""))}return or;case 0:return cr=or.type,ur=or.pendingProps,ur=or.elementType===cr?ur:Ci(cr,ur),cj(ar,or,cr,ur,lr);case 1:return cr=or.type,ur=or.pendingProps,ur=or.elementType===cr?ur:Ci(cr,ur),hj(ar,or,cr,ur,lr);case 3:e:{if(kj(or),ar===null)throw Error(p$1(387));cr=or.pendingProps,dr=or.memoizedState,ur=dr.element,lh(ar,or),qh(or,cr,null,lr);var hr=or.memoizedState;if(cr=hr.element,dr.isDehydrated)if(dr={element:cr,isDehydrated:!1,cache:hr.cache,pendingSuspenseBoundaries:hr.pendingSuspenseBoundaries,transitions:hr.transitions},or.updateQueue.baseState=dr,or.memoizedState=dr,or.flags&256){ur=Ji(Error(p$1(423)),or),or=lj(ar,or,cr,lr,ur);break e}else if(cr!==ur){ur=Ji(Error(p$1(424)),or),or=lj(ar,or,cr,lr,ur);break e}else for(yg=Lf(or.stateNode.containerInfo.firstChild),xg=or,I$1=!0,zg=null,lr=Vg(or,null,cr,lr),or.child=lr;lr;)lr.flags=lr.flags&-3|4096,lr=lr.sibling;else{if(Ig(),cr===ur){or=Zi(ar,or,lr);break e}Xi(ar,or,cr,lr)}or=or.child}return or;case 5:return Ah(or),ar===null&&Eg(or),cr=or.type,ur=or.pendingProps,dr=ar!==null?ar.memoizedProps:null,hr=ur.children,Ef(cr,ur)?hr=null:dr!==null&&Ef(cr,dr)&&(or.flags|=32),gj(ar,or),Xi(ar,or,hr,lr),or.child;case 6:return ar===null&&Eg(or),null;case 13:return oj(ar,or,lr);case 4:return yh(or,or.stateNode.containerInfo),cr=or.pendingProps,ar===null?or.child=Ug(or,null,cr,lr):Xi(ar,or,cr,lr),or.child;case 11:return cr=or.type,ur=or.pendingProps,ur=or.elementType===cr?ur:Ci(cr,ur),Yi(ar,or,cr,ur,lr);case 7:return Xi(ar,or,or.pendingProps,lr),or.child;case 8:return Xi(ar,or,or.pendingProps.children,lr),or.child;case 12:return Xi(ar,or,or.pendingProps.children,lr),or.child;case 10:e:{if(cr=or.type._context,ur=or.pendingProps,dr=or.memoizedProps,hr=ur.value,G$1(Wg,cr._currentValue),cr._currentValue=hr,dr!==null)if(He$1(dr.value,hr)){if(dr.children===ur.children&&!Wf.current){or=Zi(ar,or,lr);break e}}else for(dr=or.child,dr!==null&&(dr.return=or);dr!==null;){var pr=dr.dependencies;if(pr!==null){hr=dr.child;for(var xr=pr.firstContext;xr!==null;){if(xr.context===cr){if(dr.tag===1){xr=mh(-1,lr&-lr),xr.tag=2;var mr=dr.updateQueue;if(mr!==null){mr=mr.shared;var fr=mr.pending;fr===null?xr.next=xr:(xr.next=fr.next,fr.next=xr),mr.pending=xr}}dr.lanes|=lr,xr=dr.alternate,xr!==null&&(xr.lanes|=lr),bh(dr.return,lr,or),pr.lanes|=lr;break}xr=xr.next}}else if(dr.tag===10)hr=dr.type===or.type?null:dr.child;else if(dr.tag===18){if(hr=dr.return,hr===null)throw Error(p$1(341));hr.lanes|=lr,pr=hr.alternate,pr!==null&&(pr.lanes|=lr),bh(hr,lr,or),hr=dr.sibling}else hr=dr.child;if(hr!==null)hr.return=dr;else for(hr=dr;hr!==null;){if(hr===or){hr=null;break}if(dr=hr.sibling,dr!==null){dr.return=hr.return,hr=dr;break}hr=hr.return}dr=hr}Xi(ar,or,ur.children,lr),or=or.child}return or;case 9:return ur=or.type,cr=or.pendingProps.children,ch(or,lr),ur=eh(ur),cr=cr(ur),or.flags|=1,Xi(ar,or,cr,lr),or.child;case 14:return cr=or.type,ur=Ci(cr,or.pendingProps),ur=Ci(cr.type,ur),$i(ar,or,cr,ur,lr);case 15:return bj(ar,or,or.type,or.pendingProps,lr);case 17:return cr=or.type,ur=or.pendingProps,ur=or.elementType===cr?ur:Ci(cr,ur),ij(ar,or),or.tag=1,Zf(cr)?(ar=!0,cg(or)):ar=!1,ch(or,lr),Gi(or,cr,ur),Ii(or,cr,ur,lr),jj(null,or,cr,!0,ar,lr);case 19:return xj(ar,or,lr);case 22:return dj(ar,or,lr)}throw Error(p$1(156,or.tag))};function Fk(ar,or){return ac(ar,or)}function $k(ar,or,lr,cr){this.tag=ar,this.key=lr,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=or,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=cr,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(ar,or,lr,cr){return new $k(ar,or,lr,cr)}function aj(ar){return ar=ar.prototype,!(!ar||!ar.isReactComponent)}function Zk(ar){if(typeof ar=="function")return aj(ar)?1:0;if(ar!=null){if(ar=ar.$$typeof,ar===Da)return 11;if(ar===Ga)return 14}return 2}function Pg(ar,or){var lr=ar.alternate;return lr===null?(lr=Bg(ar.tag,or,ar.key,ar.mode),lr.elementType=ar.elementType,lr.type=ar.type,lr.stateNode=ar.stateNode,lr.alternate=ar,ar.alternate=lr):(lr.pendingProps=or,lr.type=ar.type,lr.flags=0,lr.subtreeFlags=0,lr.deletions=null),lr.flags=ar.flags&14680064,lr.childLanes=ar.childLanes,lr.lanes=ar.lanes,lr.child=ar.child,lr.memoizedProps=ar.memoizedProps,lr.memoizedState=ar.memoizedState,lr.updateQueue=ar.updateQueue,or=ar.dependencies,lr.dependencies=or===null?null:{lanes:or.lanes,firstContext:or.firstContext},lr.sibling=ar.sibling,lr.index=ar.index,lr.ref=ar.ref,lr}function Rg(ar,or,lr,cr,ur,dr){var hr=2;if(cr=ar,typeof ar=="function")aj(ar)&&(hr=1);else if(typeof ar=="string")hr=5;else e:switch(ar){case ya:return Tg(lr.children,ur,dr,or);case za:hr=8,ur|=8;break;case Aa:return ar=Bg(12,lr,or,ur|2),ar.elementType=Aa,ar.lanes=dr,ar;case Ea:return ar=Bg(13,lr,or,ur),ar.elementType=Ea,ar.lanes=dr,ar;case Fa:return ar=Bg(19,lr,or,ur),ar.elementType=Fa,ar.lanes=dr,ar;case Ia:return pj(lr,ur,dr,or);default:if(typeof ar=="object"&&ar!==null)switch(ar.$$typeof){case Ba:hr=10;break e;case Ca:hr=9;break e;case Da:hr=11;break e;case Ga:hr=14;break e;case Ha:hr=16,cr=null;break e}throw Error(p$1(130,ar==null?ar:typeof ar,""))}return or=Bg(hr,lr,or,ur),or.elementType=ar,or.type=cr,or.lanes=dr,or}function Tg(ar,or,lr,cr){return ar=Bg(7,ar,cr,or),ar.lanes=lr,ar}function pj(ar,or,lr,cr){return ar=Bg(22,ar,cr,or),ar.elementType=Ia,ar.lanes=lr,ar.stateNode={isHidden:!1},ar}function Qg(ar,or,lr){return ar=Bg(6,ar,null,or),ar.lanes=lr,ar}function Sg(ar,or,lr){return or=Bg(4,ar.children!==null?ar.children:[],ar.key,or),or.lanes=lr,or.stateNode={containerInfo:ar.containerInfo,pendingChildren:null,implementation:ar.implementation},or}function al(ar,or,lr,cr,ur){this.tag=or,this.containerInfo=ar,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=cr,this.onRecoverableError=ur,this.mutableSourceEagerHydrationData=null}function bl(ar,or,lr,cr,ur,dr,hr,pr,xr){return ar=new al(ar,or,lr,pr,xr),or===1?(or=1,dr===!0&&(or|=8)):or=0,dr=Bg(3,null,null,or),ar.current=dr,dr.stateNode=ar,dr.memoizedState={element:cr,isDehydrated:lr,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(dr),ar}function cl(ar,or,lr){var cr=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:cr==null?null:""+cr,children:ar,containerInfo:or,implementation:lr}}function dl(ar){if(!ar)return Vf;ar=ar._reactInternals;e:{if(Vb(ar)!==ar||ar.tag!==1)throw Error(p$1(170));var or=ar;do{switch(or.tag){case 3:or=or.stateNode.context;break e;case 1:if(Zf(or.type)){or=or.stateNode.__reactInternalMemoizedMergedChildContext;break e}}or=or.return}while(or!==null);throw Error(p$1(171))}if(ar.tag===1){var lr=ar.type;if(Zf(lr))return bg(ar,lr,or)}return or}function el(ar,or,lr,cr,ur,dr,hr,pr,xr){return ar=bl(lr,cr,!0,ar,ur,dr,hr,pr,xr),ar.context=dl(null),lr=ar.current,cr=R$1(),ur=yi(lr),dr=mh(cr,ur),dr.callback=or??null,nh(lr,dr,ur),ar.current.lanes=ur,Ac(ar,ur,cr),Dk(ar,cr),ar}function fl(ar,or,lr,cr){var ur=or.current,dr=R$1(),hr=yi(ur);return lr=dl(lr),or.context===null?or.context=lr:or.pendingContext=lr,or=mh(dr,hr),or.payload={element:ar},cr=cr===void 0?null:cr,cr!==null&&(or.callback=cr),ar=nh(ur,or,hr),ar!==null&&(gi(ar,ur,hr,dr),oh(ar,ur,hr)),hr}function gl(ar){if(ar=ar.current,!ar.child)return null;switch(ar.child.tag){case 5:return ar.child.stateNode;default:return ar.child.stateNode}}function hl(ar,or){if(ar=ar.memoizedState,ar!==null&&ar.dehydrated!==null){var lr=ar.retryLane;ar.retryLane=lr!==0&&lr<or?lr:or}}function il(ar,or){hl(ar,or),(ar=ar.alternate)&&hl(ar,or)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(ar){console.error(ar)};function ll(ar){this._internalRoot=ar}ml.prototype.render=ll.prototype.render=function(ar){var or=this._internalRoot;if(or===null)throw Error(p$1(409));fl(ar,or,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var ar=this._internalRoot;if(ar!==null){this._internalRoot=null;var or=ar.containerInfo;Rk(function(){fl(null,ar,null,null)}),or[uf]=null}};function ml(ar){this._internalRoot=ar}ml.prototype.unstable_scheduleHydration=function(ar){if(ar){var or=Hc();ar={blockedOn:null,target:ar,priority:or};for(var lr=0;lr<Qc.length&&or!==0&&or<Qc[lr].priority;lr++);Qc.splice(lr,0,ar),lr===0&&Vc(ar)}};function nl(ar){return!(!ar||ar.nodeType!==1&&ar.nodeType!==9&&ar.nodeType!==11)}function ol(ar){return!(!ar||ar.nodeType!==1&&ar.nodeType!==9&&ar.nodeType!==11&&(ar.nodeType!==8||ar.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(ar,or,lr,cr,ur){if(ur){if(typeof cr=="function"){var dr=cr;cr=function(){var mr=gl(hr);dr.call(mr)}}var hr=el(or,cr,ar,0,null,!1,!1,"",pl);return ar._reactRootContainer=hr,ar[uf]=hr.current,sf(ar.nodeType===8?ar.parentNode:ar),Rk(),hr}for(;ur=ar.lastChild;)ar.removeChild(ur);if(typeof cr=="function"){var pr=cr;cr=function(){var mr=gl(xr);pr.call(mr)}}var xr=bl(ar,0,!1,null,null,!1,!1,"",pl);return ar._reactRootContainer=xr,ar[uf]=xr.current,sf(ar.nodeType===8?ar.parentNode:ar),Rk(function(){fl(or,xr,lr,cr)}),xr}function rl(ar,or,lr,cr,ur){var dr=lr._reactRootContainer;if(dr){var hr=dr;if(typeof ur=="function"){var pr=ur;ur=function(){var xr=gl(hr);pr.call(xr)}}fl(or,hr,ar,ur)}else hr=ql(lr,or,ar,ur,cr);return gl(hr)}Ec=function(ar){switch(ar.tag){case 3:var or=ar.stateNode;if(or.current.memoizedState.isDehydrated){var lr=tc(or.pendingLanes);lr!==0&&(Cc(or,lr|1),Dk(or,B$1()),!(K$1&6)&&(Gj=B$1()+500,jg()))}break;case 13:Rk(function(){var cr=ih(ar,1);if(cr!==null){var ur=R$1();gi(cr,ar,1,ur)}}),il(ar,1)}};Fc=function(ar){if(ar.tag===13){var or=ih(ar,134217728);if(or!==null){var lr=R$1();gi(or,ar,134217728,lr)}il(ar,134217728)}};Gc=function(ar){if(ar.tag===13){var or=yi(ar),lr=ih(ar,or);if(lr!==null){var cr=R$1();gi(lr,ar,or,cr)}il(ar,or)}};Hc=function(){return C$1};Ic=function(ar,or){var lr=C$1;try{return C$1=ar,or()}finally{C$1=lr}};yb=function(ar,or,lr){switch(or){case"input":if(bb(ar,lr),or=lr.name,lr.type==="radio"&&or!=null){for(lr=ar;lr.parentNode;)lr=lr.parentNode;for(lr=lr.querySelectorAll("input[name="+JSON.stringify(""+or)+'][type="radio"]'),or=0;or<lr.length;or++){var cr=lr[or];if(cr!==ar&&cr.form===ar.form){var ur=Db(cr);if(!ur)throw Error(p$1(90));Wa(cr),bb(cr,ur)}}}break;case"textarea":ib(ar,lr);break;case"select":or=lr.value,or!=null&&fb(ar,!!lr.multiple,or,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(ar){return ar=Zb(ar),ar===null?null:ar.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(ar,or){var lr=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(or))throw Error(p$1(200));return cl(ar,or,null,lr)};reactDom_production_min.createRoot=function(ar,or){if(!nl(ar))throw Error(p$1(299));var lr=!1,cr="",ur=kl;return or!=null&&(or.unstable_strictMode===!0&&(lr=!0),or.identifierPrefix!==void 0&&(cr=or.identifierPrefix),or.onRecoverableError!==void 0&&(ur=or.onRecoverableError)),or=bl(ar,1,!1,null,null,lr,!1,cr,ur),ar[uf]=or.current,sf(ar.nodeType===8?ar.parentNode:ar),new ll(or)};reactDom_production_min.findDOMNode=function(ar){if(ar==null)return null;if(ar.nodeType===1)return ar;var or=ar._reactInternals;if(or===void 0)throw typeof ar.render=="function"?Error(p$1(188)):(ar=Object.keys(ar).join(","),Error(p$1(268,ar)));return ar=Zb(or),ar=ar===null?null:ar.stateNode,ar};reactDom_production_min.flushSync=function(ar){return Rk(ar)};reactDom_production_min.hydrate=function(ar,or,lr){if(!ol(or))throw Error(p$1(200));return rl(null,ar,or,!0,lr)};reactDom_production_min.hydrateRoot=function(ar,or,lr){if(!nl(ar))throw Error(p$1(405));var cr=lr!=null&&lr.hydratedSources||null,ur=!1,dr="",hr=kl;if(lr!=null&&(lr.unstable_strictMode===!0&&(ur=!0),lr.identifierPrefix!==void 0&&(dr=lr.identifierPrefix),lr.onRecoverableError!==void 0&&(hr=lr.onRecoverableError)),or=el(or,null,ar,1,lr??null,ur,!1,dr,hr),ar[uf]=or.current,sf(ar),cr)for(ar=0;ar<cr.length;ar++)lr=cr[ar],ur=lr._getVersion,ur=ur(lr._source),or.mutableSourceEagerHydrationData==null?or.mutableSourceEagerHydrationData=[lr,ur]:or.mutableSourceEagerHydrationData.push(lr,ur);return new ml(or)};reactDom_production_min.render=function(ar,or,lr){if(!ol(or))throw Error(p$1(200));return rl(null,ar,or,!1,lr)};reactDom_production_min.unmountComponentAtNode=function(ar){if(!ol(ar))throw Error(p$1(40));return ar._reactRootContainer?(Rk(function(){rl(null,null,ar,!1,function(){ar._reactRootContainer=null,ar[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(ar,or,lr,cr){if(!ol(lr))throw Error(p$1(200));if(ar==null||ar._reactInternals===void 0)throw Error(p$1(38));return rl(ar,or,lr,!1,cr)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(ar){console.error(ar)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m$1=reactDomExports;client.createRoot=m$1.createRoot,client.hydrateRoot=m$1.hydrateRoot;const __vite_import_meta_env__$2={},createStoreImpl=ar=>{let or;const lr=new Set,cr=(fr,Er)=>{const vr=typeof fr=="function"?fr(or):fr;if(!Object.is(vr,or)){const gr=or;or=Er??(typeof vr!="object"||vr===null)?vr:Object.assign({},or,vr),lr.forEach(yr=>yr(or,gr))}},ur=()=>or,xr={setState:cr,getState:ur,getInitialState:()=>mr,subscribe:fr=>(lr.add(fr),()=>lr.delete(fr)),destroy:()=>{(__vite_import_meta_env__$2?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),lr.clear()}},mr=or=ar(cr,ur,xr);return xr},createStore=ar=>ar?createStoreImpl(ar):createStoreImpl;var withSelector={exports:{}},withSelector_production={},shim$2={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React$1=reactExports;function is$1(ar,or){return ar===or&&(ar!==0||1/ar===1/or)||ar!==ar&&or!==or}var objectIs$1=typeof Object.is=="function"?Object.is:is$1,useState=React$1.useState,useEffect$1=React$1.useEffect,useLayoutEffect=React$1.useLayoutEffect,useDebugValue$2=React$1.useDebugValue;function useSyncExternalStore$2(ar,or){var lr=or(),cr=useState({inst:{value:lr,getSnapshot:or}}),ur=cr[0].inst,dr=cr[1];return useLayoutEffect(function(){ur.value=lr,ur.getSnapshot=or,checkIfSnapshotChanged(ur)&&dr({inst:ur})},[ar,lr,or]),useEffect$1(function(){return checkIfSnapshotChanged(ur)&&dr({inst:ur}),ar(function(){checkIfSnapshotChanged(ur)&&dr({inst:ur})})},[ar]),useDebugValue$2(lr),lr}function checkIfSnapshotChanged(ar){var or=ar.getSnapshot;ar=ar.value;try{var lr=or();return!objectIs$1(ar,lr)}catch{return!0}}function useSyncExternalStore$1(ar,or){return or()}var shim$1=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?useSyncExternalStore$1:useSyncExternalStore$2;useSyncExternalStoreShim_production.useSyncExternalStore=React$1.useSyncExternalStore!==void 0?React$1.useSyncExternalStore:shim$1;shim$2.exports=useSyncExternalStoreShim_production;var shimExports=shim$2.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React=reactExports,shim=shimExports;function is(ar,or){return ar===or&&(ar!==0||1/ar===1/or)||ar!==ar&&or!==or}var objectIs=typeof Object.is=="function"?Object.is:is,useSyncExternalStore=shim.useSyncExternalStore,useRef=React.useRef,useEffect=React.useEffect,useMemo=React.useMemo,useDebugValue$1=React.useDebugValue;withSelector_production.useSyncExternalStoreWithSelector=function(ar,or,lr,cr,ur){var dr=useRef(null);if(dr.current===null){var hr={hasValue:!1,value:null};dr.current=hr}else hr=dr.current;dr=useMemo(function(){function xr(gr){if(!mr){if(mr=!0,fr=gr,gr=cr(gr),ur!==void 0&&hr.hasValue){var yr=hr.value;if(ur(yr,gr))return Er=yr}return Er=gr}if(yr=Er,objectIs(fr,gr))return yr;var jr=cr(gr);return ur!==void 0&&ur(yr,jr)?(fr=gr,yr):(fr=gr,Er=jr)}var mr=!1,fr,Er,vr=lr===void 0?null:lr;return[function(){return xr(or())},vr===null?void 0:function(){return xr(vr())}]},[or,lr,cr,ur]);var pr=useSyncExternalStore(ar,dr[0],dr[1]);return useEffect(function(){hr.hasValue=!0,hr.value=pr},[pr]),useDebugValue$1(pr),pr};withSelector.exports=withSelector_production;var withSelectorExports=withSelector.exports;const useSyncExternalStoreExports=getDefaultExportFromCjs(withSelectorExports),__vite_import_meta_env__$1={},{useDebugValue}=React$2,{useSyncExternalStoreWithSelector}=useSyncExternalStoreExports;let didWarnAboutEqualityFn=!1;const identity=ar=>ar;function useStore(ar,or=identity,lr){(__vite_import_meta_env__$1?"production":void 0)!=="production"&&lr&&!didWarnAboutEqualityFn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),didWarnAboutEqualityFn=!0);const cr=useSyncExternalStoreWithSelector(ar.subscribe,ar.getState,ar.getServerState||ar.getInitialState,or,lr);return useDebugValue(cr),cr}const createImpl=ar=>{(__vite_import_meta_env__$1?"production":void 0)!=="production"&&typeof ar!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const or=typeof ar=="function"?createStore(ar):ar,lr=(cr,ur)=>useStore(or,cr,ur);return Object.assign(lr,or),lr},create=ar=>ar?createImpl(ar):createImpl,__vite_import_meta_env__={};function createJSONStorage(ar,or){let lr;try{lr=ar()}catch{return}return{getItem:ur=>{var dr;const hr=xr=>xr===null?null:JSON.parse(xr,void 0),pr=(dr=lr.getItem(ur))!=null?dr:null;return pr instanceof Promise?pr.then(hr):hr(pr)},setItem:(ur,dr)=>lr.setItem(ur,JSON.stringify(dr,void 0)),removeItem:ur=>lr.removeItem(ur)}}const toThenable=ar=>or=>{try{const lr=ar(or);return lr instanceof Promise?lr:{then(cr){return toThenable(cr)(lr)},catch(cr){return this}}}catch(lr){return{then(cr){return this},catch(cr){return toThenable(cr)(lr)}}}},oldImpl=(ar,or)=>(lr,cr,ur)=>{let dr={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:br=>br,version:0,merge:(br,_r)=>({..._r,...br}),...or},hr=!1;const pr=new Set,xr=new Set;let mr;try{mr=dr.getStorage()}catch{}if(!mr)return ar((...br)=>{console.warn(`[zustand persist middleware] Unable to update item '${dr.name}', the given storage is currently unavailable.`),lr(...br)},cr,ur);const fr=toThenable(dr.serialize),Er=()=>{const br=dr.partialize({...cr()});let _r;const wr=fr({state:br,version:dr.version}).then(Rr=>mr.setItem(dr.name,Rr)).catch(Rr=>{_r=Rr});if(_r)throw _r;return wr},vr=ur.setState;ur.setState=(br,_r)=>{vr(br,_r),Er()};const gr=ar((...br)=>{lr(...br),Er()},cr,ur);let yr;const jr=()=>{var br;if(!mr)return;hr=!1,pr.forEach(wr=>wr(cr()));const _r=((br=dr.onRehydrateStorage)==null?void 0:br.call(dr,cr()))||void 0;return toThenable(mr.getItem.bind(mr))(dr.name).then(wr=>{if(wr)return dr.deserialize(wr)}).then(wr=>{if(wr)if(typeof wr.version=="number"&&wr.version!==dr.version){if(dr.migrate)return dr.migrate(wr.state,wr.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return wr.state}).then(wr=>{var Rr;return yr=dr.merge(wr,(Rr=cr())!=null?Rr:gr),lr(yr,!0),Er()}).then(()=>{_r==null||_r(yr,void 0),hr=!0,xr.forEach(wr=>wr(yr))}).catch(wr=>{_r==null||_r(void 0,wr)})};return ur.persist={setOptions:br=>{dr={...dr,...br},br.getStorage&&(mr=br.getStorage())},clearStorage:()=>{mr==null||mr.removeItem(dr.name)},getOptions:()=>dr,rehydrate:()=>jr(),hasHydrated:()=>hr,onHydrate:br=>(pr.add(br),()=>{pr.delete(br)}),onFinishHydration:br=>(xr.add(br),()=>{xr.delete(br)})},jr(),yr||gr},newImpl=(ar,or)=>(lr,cr,ur)=>{let dr={storage:createJSONStorage(()=>localStorage),partialize:jr=>jr,version:0,merge:(jr,br)=>({...br,...jr}),...or},hr=!1;const pr=new Set,xr=new Set;let mr=dr.storage;if(!mr)return ar((...jr)=>{console.warn(`[zustand persist middleware] Unable to update item '${dr.name}', the given storage is currently unavailable.`),lr(...jr)},cr,ur);const fr=()=>{const jr=dr.partialize({...cr()});return mr.setItem(dr.name,{state:jr,version:dr.version})},Er=ur.setState;ur.setState=(jr,br)=>{Er(jr,br),fr()};const vr=ar((...jr)=>{lr(...jr),fr()},cr,ur);ur.getInitialState=()=>vr;let gr;const yr=()=>{var jr,br;if(!mr)return;hr=!1,pr.forEach(wr=>{var Rr;return wr((Rr=cr())!=null?Rr:vr)});const _r=((br=dr.onRehydrateStorage)==null?void 0:br.call(dr,(jr=cr())!=null?jr:vr))||void 0;return toThenable(mr.getItem.bind(mr))(dr.name).then(wr=>{if(wr)if(typeof wr.version=="number"&&wr.version!==dr.version){if(dr.migrate)return[!0,dr.migrate(wr.state,wr.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,wr.state];return[!1,void 0]}).then(wr=>{var Rr;const[Ar,Sr]=wr;if(gr=dr.merge(Sr,(Rr=cr())!=null?Rr:vr),lr(gr,!0),Ar)return fr()}).then(()=>{_r==null||_r(gr,void 0),gr=cr(),hr=!0,xr.forEach(wr=>wr(gr))}).catch(wr=>{_r==null||_r(void 0,wr)})};return ur.persist={setOptions:jr=>{dr={...dr,...jr},jr.storage&&(mr=jr.storage)},clearStorage:()=>{mr==null||mr.removeItem(dr.name)},getOptions:()=>dr,rehydrate:()=>yr(),hasHydrated:()=>hr,onHydrate:jr=>(pr.add(jr),()=>{pr.delete(jr)}),onFinishHydration:jr=>(xr.add(jr),()=>{xr.delete(jr)})},dr.skipHydration||yr(),gr||vr},persistImpl=(ar,or)=>"getStorage"in or||"serialize"in or||"deserialize"in or?((__vite_import_meta_env__?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),oldImpl(ar,or)):newImpl(ar,or),persist=persistImpl,e=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,t=Object.keys,n=Array.isArray;function r$1(ar,or){return typeof or!="object"||t(or).forEach(function(lr){ar[lr]=or[lr]}),ar}typeof Promise>"u"||e.Promise||(e.Promise=Promise);const s=Object.getPrototypeOf,i={}.hasOwnProperty;function o(ar,or){return i.call(ar,or)}function a(ar,or){typeof or=="function"&&(or=or(s(ar))),(typeof Reflect>"u"?t:Reflect.ownKeys)(or).forEach(lr=>{l(ar,lr,or[lr])})}const u=Object.defineProperty;function l(ar,or,lr,cr){u(ar,or,r$1(lr&&o(lr,"get")&&typeof lr.get=="function"?{get:lr.get,set:lr.set,configurable:!0}:{value:lr,configurable:!0,writable:!0},cr))}function c(ar){return{from:function(or){return ar.prototype=Object.create(or.prototype),l(ar.prototype,"constructor",ar),{extend:a.bind(null,ar.prototype)}}}}const h=Object.getOwnPropertyDescriptor;function d(ar,or){let lr;return h(ar,or)||(lr=s(ar))&&d(lr,or)}const f=[].slice;function p(ar,or,lr){return f.call(ar,or,lr)}function y(ar,or){return or(ar)}function m(ar){if(!ar)throw new Error("Assertion Failed")}function v(ar){e.setImmediate?setImmediate(ar):setTimeout(ar,0)}function g(ar,or){return ar.reduce((lr,cr,ur)=>{var dr=or(cr,ur);return dr&&(lr[dr[0]]=dr[1]),lr},{})}function b(ar,or){if(typeof or=="string"&&o(ar,or))return ar[or];if(!or)return ar;if(typeof or!="string"){for(var lr=[],cr=0,ur=or.length;cr<ur;++cr){var dr=b(ar,or[cr]);lr.push(dr)}return lr}var hr=or.indexOf(".");if(hr!==-1){var pr=ar[or.substr(0,hr)];return pr==null?void 0:b(pr,or.substr(hr+1))}}function _(ar,or,lr){if(ar&&or!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(ar)))if(typeof or!="string"&&"length"in or){m(typeof lr!="string"&&"length"in lr);for(var cr=0,ur=or.length;cr<ur;++cr)_(ar,or[cr],lr[cr])}else{var dr=or.indexOf(".");if(dr!==-1){var hr=or.substr(0,dr),pr=or.substr(dr+1);if(pr==="")lr===void 0?n(ar)&&!isNaN(parseInt(hr))?ar.splice(hr,1):delete ar[hr]:ar[hr]=lr;else{var xr=ar[hr];xr&&o(ar,hr)||(xr=ar[hr]={}),_(xr,pr,lr)}}else lr===void 0?n(ar)&&!isNaN(parseInt(or))?ar.splice(or,1):delete ar[or]:ar[or]=lr}}function w(ar){var or={};for(var lr in ar)o(ar,lr)&&(or[lr]=ar[lr]);return or}const x=[].concat;function k(ar){return x.apply([],ar)}const E="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(k([8,16,32,64].map(ar=>["Int","Uint","Float"].map(or=>or+ar+"Array")))).filter(ar=>e[ar]),P=E.map(ar=>e[ar]);g(E,ar=>[ar,!0]);let K=null;function O(ar){K=typeof WeakMap<"u"&&new WeakMap;const or=S(ar);return K=null,or}function S(ar){if(!ar||typeof ar!="object")return ar;let or=K&&K.get(ar);if(or)return or;if(n(ar)){or=[],K&&K.set(ar,or);for(var lr=0,cr=ar.length;lr<cr;++lr)or.push(S(ar[lr]))}else if(P.indexOf(ar.constructor)>=0)or=ar;else{const dr=s(ar);for(var ur in or=dr===Object.prototype?{}:Object.create(dr),K&&K.set(ar,or),ar)o(ar,ur)&&(or[ur]=S(ar[ur]))}return or}const{toString:A}={};function C(ar){return A.call(ar).slice(8,-1)}const j=typeof Symbol<"u"?Symbol.iterator:"@@iterator",D=typeof j=="symbol"?function(ar){var or;return ar!=null&&(or=ar[j])&&or.apply(ar)}:function(){return null},I={};function B(ar){var or,lr,cr,ur;if(arguments.length===1){if(n(ar))return ar.slice();if(this===I&&typeof ar=="string")return[ar];if(ur=D(ar)){for(lr=[];!(cr=ur.next()).done;)lr.push(cr.value);return lr}if(ar==null)return[ar];if(typeof(or=ar.length)=="number"){for(lr=new Array(or);or--;)lr[or]=ar[or];return lr}return[ar]}for(or=arguments.length,lr=new Array(or);or--;)lr[or]=arguments[or];return lr}const T=typeof Symbol<"u"?ar=>ar[Symbol.toStringTag]==="AsyncFunction":()=>!1;var R=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function F(ar,or){R=ar,M=or}var M=()=>!0;const N=!new Error("").stack;function q(){if(N)try{throw q.arguments,new Error}catch(ar){return ar}return new Error}function $$1(ar,or){var lr=ar.stack;return lr?(or=or||0,lr.indexOf(ar.name)===0&&(or+=(ar.name+ar.message).split(`
`).length),lr.split(`
`).slice(or).filter(M).map(cr=>`
`+cr).join("")):""}var U=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],L=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(U),V={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function W(ar,or){this._e=q(),this.name=ar,this.message=or}function Y(ar,or){return ar+". Errors: "+Object.keys(or).map(lr=>or[lr].toString()).filter((lr,cr,ur)=>ur.indexOf(lr)===cr).join(`
`)}function z(ar,or,lr,cr){this._e=q(),this.failures=or,this.failedKeys=cr,this.successCount=lr,this.message=Y(ar,or)}function G(ar,or){this._e=q(),this.name="BulkError",this.failures=Object.keys(or).map(lr=>or[lr]),this.failuresByPos=or,this.message=Y(ar,or)}c(W).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+$$1(this._e,2))}},toString:function(){return this.name+": "+this.message}}),c(z).from(W),c(G).from(W);var H=L.reduce((ar,or)=>(ar[or]=or+"Error",ar),{});const Q=W;var X=L.reduce((ar,or)=>{var lr=or+"Error";function cr(ur,dr){this._e=q(),this.name=lr,ur?typeof ur=="string"?(this.message=`${ur}${dr?`
 `+dr:""}`,this.inner=dr||null):typeof ur=="object"&&(this.message=`${ur.name} ${ur.message}`,this.inner=ur):(this.message=V[or]||lr,this.inner=null)}return c(cr).from(Q),ar[or]=cr,ar},{});X.Syntax=SyntaxError,X.Type=TypeError,X.Range=RangeError;var J=U.reduce((ar,or)=>(ar[or+"Error"]=X[or],ar),{}),Z=L.reduce((ar,or)=>(["Syntax","Type","Range"].indexOf(or)===-1&&(ar[or+"Error"]=X[or]),ar),{});function ee(){}function te(ar){return ar}function ne(ar,or){return ar==null||ar===te?or:function(lr){return or(ar(lr))}}function re(ar,or){return function(){ar.apply(this,arguments),or.apply(this,arguments)}}function se(ar,or){return ar===ee?or:function(){var lr=ar.apply(this,arguments);lr!==void 0&&(arguments[0]=lr);var cr=this.onsuccess,ur=this.onerror;this.onsuccess=null,this.onerror=null;var dr=or.apply(this,arguments);return cr&&(this.onsuccess=this.onsuccess?re(cr,this.onsuccess):cr),ur&&(this.onerror=this.onerror?re(ur,this.onerror):ur),dr!==void 0?dr:lr}}function ie(ar,or){return ar===ee?or:function(){ar.apply(this,arguments);var lr=this.onsuccess,cr=this.onerror;this.onsuccess=this.onerror=null,or.apply(this,arguments),lr&&(this.onsuccess=this.onsuccess?re(lr,this.onsuccess):lr),cr&&(this.onerror=this.onerror?re(cr,this.onerror):cr)}}function oe(ar,or){return ar===ee?or:function(lr){var cr=ar.apply(this,arguments);r$1(lr,cr);var ur=this.onsuccess,dr=this.onerror;this.onsuccess=null,this.onerror=null;var hr=or.apply(this,arguments);return ur&&(this.onsuccess=this.onsuccess?re(ur,this.onsuccess):ur),dr&&(this.onerror=this.onerror?re(dr,this.onerror):dr),cr===void 0?hr===void 0?void 0:hr:r$1(cr,hr)}}function ae(ar,or){return ar===ee?or:function(){return or.apply(this,arguments)!==!1&&ar.apply(this,arguments)}}function ue(ar,or){return ar===ee?or:function(){var lr=ar.apply(this,arguments);if(lr&&typeof lr.then=="function"){for(var cr=this,ur=arguments.length,dr=new Array(ur);ur--;)dr[ur]=arguments[ur];return lr.then(function(){return or.apply(cr,dr)})}return or.apply(this,arguments)}}Z.ModifyError=z,Z.DexieError=W,Z.BulkError=G;var le={};const ce=100,[he,de,fe]=typeof Promise>"u"?[]:(()=>{let ar=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[ar,s(ar),ar];const or=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[or,s(or),ar]})(),pe=de&&de.then,ye=he&&he.constructor,me=!!fe;var ve=!1,ge=fe?()=>{fe.then($e)}:e.setImmediate?setImmediate.bind(null,$e):e.MutationObserver?()=>{var ar=document.createElement("div");new MutationObserver(()=>{$e(),ar=null}).observe(ar,{attributes:!0}),ar.setAttribute("i","1")}:()=>{setTimeout($e,0)},be=function(ar,or){Se.push([ar,or]),we&&(ge(),we=!1)},_e=!0,we=!0,xe=[],ke=[],Ee=null,Pe=te,Ke={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:dt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(ar=>{try{dt(ar[0],ar[1])}catch{}})}},Oe=Ke,Se=[],Ae=0,Ce=[];function je(ar){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ee,this._lib=!1;var or=this._PSD=Oe;if(R&&(this._stackHolder=q(),this._prev=null,this._numPrev=0),typeof ar!="function"){if(ar!==le)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Te(this,this._value))}this._state=null,this._value=null,++or.ref,Be(this,ar)}const De={get:function(){var ar=Oe,or=Xe;function lr(cr,ur){var dr=!ar.global&&(ar!==Oe||or!==Xe);const hr=dr&&!tt();var pr=new je((xr,mr)=>{Fe(this,new Ie(lt(cr,ar,dr,hr),lt(ur,ar,dr,hr),xr,mr,ar))});return R&&qe(pr,this),pr}return lr.prototype=le,lr},set:function(ar){l(this,"then",ar&&ar.prototype===le?De:{get:function(){return ar},set:De.set})}};function Ie(ar,or,lr,cr,ur){this.onFulfilled=typeof ar=="function"?ar:null,this.onRejected=typeof or=="function"?or:null,this.resolve=lr,this.reject=cr,this.psd=ur}function Be(ar,or){try{or(lr=>{if(ar._state===null){if(lr===ar)throw new TypeError("A promise cannot be resolved with itself.");var cr=ar._lib&&Ue();lr&&typeof lr.then=="function"?Be(ar,(ur,dr)=>{lr instanceof je?lr._then(ur,dr):lr.then(ur,dr)}):(ar._state=!0,ar._value=lr,Re(ar)),cr&&Le()}},Te.bind(null,ar))}catch(lr){Te(ar,lr)}}function Te(ar,or){if(ke.push(or),ar._state===null){var lr=ar._lib&&Ue();or=Pe(or),ar._state=!1,ar._value=or,R&&or!==null&&typeof or=="object"&&!or._promise&&function(cr,ur,dr){try{cr.apply(null,dr)}catch{}}(()=>{var cr=d(or,"stack");or._promise=ar,l(or,"stack",{get:()=>ve?cr&&(cr.get?cr.get.apply(or):cr.value):ar.stack})}),function(cr){xe.some(ur=>ur._value===cr._value)||xe.push(cr)}(ar),Re(ar),lr&&Le()}}function Re(ar){var or=ar._listeners;ar._listeners=[];for(var lr=0,cr=or.length;lr<cr;++lr)Fe(ar,or[lr]);var ur=ar._PSD;--ur.ref||ur.finalize(),Ae===0&&(++Ae,be(()=>{--Ae==0&&Ve()},[]))}function Fe(ar,or){if(ar._state!==null){var lr=ar._state?or.onFulfilled:or.onRejected;if(lr===null)return(ar._state?or.resolve:or.reject)(ar._value);++or.psd.ref,++Ae,be(Me,[lr,ar,or])}else ar._listeners.push(or)}function Me(ar,or,lr){try{Ee=or;var cr,ur=or._value;or._state?cr=ar(ur):(ke.length&&(ke=[]),cr=ar(ur),ke.indexOf(ur)===-1&&function(dr){for(var hr=xe.length;hr;)if(xe[--hr]._value===dr._value)return void xe.splice(hr,1)}(or)),lr.resolve(cr)}catch(dr){lr.reject(dr)}finally{Ee=null,--Ae==0&&Ve(),--lr.psd.ref||lr.psd.finalize()}}function Ne(ar,or,lr){if(or.length===lr)return or;var cr="";if(ar._state===!1){var ur,dr,hr=ar._value;hr!=null?(ur=hr.name||"Error",dr=hr.message||hr,cr=$$1(hr,0)):(ur=hr,dr=""),or.push(ur+(dr?": "+dr:"")+cr)}return R&&((cr=$$1(ar._stackHolder,2))&&or.indexOf(cr)===-1&&or.push(cr),ar._prev&&Ne(ar._prev,or,lr)),or}function qe(ar,or){var lr=or?or._numPrev+1:0;lr<100&&(ar._prev=or,ar._numPrev=lr)}function $e(){Ue()&&Le()}function Ue(){var ar=_e;return _e=!1,we=!1,ar}function Le(){var ar,or,lr;do for(;Se.length>0;)for(ar=Se,Se=[],lr=ar.length,or=0;or<lr;++or){var cr=ar[or];cr[0].apply(null,cr[1])}while(Se.length>0);_e=!0,we=!0}function Ve(){var ar=xe;xe=[],ar.forEach(cr=>{cr._PSD.onunhandled.call(null,cr._value,cr)});for(var or=Ce.slice(0),lr=or.length;lr;)or[--lr]()}function We(ar){return new je(le,!1,ar)}function Ye(ar,or){var lr=Oe;return function(){var cr=Ue(),ur=Oe;try{return it(lr,!0),ar.apply(this,arguments)}catch(dr){or&&or(dr)}finally{it(ur,!1),cr&&Le()}}}a(je.prototype,{then:De,_then:function(ar,or){Fe(this,new Ie(null,null,ar,or,Oe))},catch:function(ar){if(arguments.length===1)return this.then(null,ar);var or=arguments[0],lr=arguments[1];return typeof or=="function"?this.then(null,cr=>cr instanceof or?lr(cr):We(cr)):this.then(null,cr=>cr&&cr.name===or?lr(cr):We(cr))},finally:function(ar){return this.then(or=>(ar(),or),or=>(ar(),We(or)))},stack:{get:function(){if(this._stack)return this._stack;try{ve=!0;var ar=Ne(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=ar),ar}finally{ve=!1}}},timeout:function(ar,or){return ar<1/0?new je((lr,cr)=>{var ur=setTimeout(()=>cr(new X.Timeout(or)),ar);this.then(lr,cr).finally(clearTimeout.bind(null,ur))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&l(je.prototype,Symbol.toStringTag,"Dexie.Promise"),Ke.env=ot(),a(je,{all:function(){var ar=B.apply(null,arguments).map(nt);return new je(function(or,lr){ar.length===0&&or([]);var cr=ar.length;ar.forEach((ur,dr)=>je.resolve(ur).then(hr=>{ar[dr]=hr,--cr||or(ar)},lr))})},resolve:ar=>{if(ar instanceof je)return ar;if(ar&&typeof ar.then=="function")return new je((lr,cr)=>{ar.then(lr,cr)});var or=new je(le,!0,ar);return qe(or,Ee),or},reject:We,race:function(){var ar=B.apply(null,arguments).map(nt);return new je((or,lr)=>{ar.map(cr=>je.resolve(cr).then(or,lr))})},PSD:{get:()=>Oe,set:ar=>Oe=ar},totalEchoes:{get:()=>Xe},newPSD:Ze,usePSD:at,scheduler:{get:()=>be,set:ar=>{be=ar}},rejectionMapper:{get:()=>Pe,set:ar=>{Pe=ar}},follow:(ar,or)=>new je((lr,cr)=>Ze((ur,dr)=>{var hr=Oe;hr.unhandleds=[],hr.onunhandled=dr,hr.finalize=re(function(){(function(pr){function xr(){pr(),Ce.splice(Ce.indexOf(xr),1)}Ce.push(xr),++Ae,be(()=>{--Ae==0&&Ve()},[])})(()=>{this.unhandleds.length===0?ur():dr(this.unhandleds[0])})},hr.finalize),ar()},or,lr,cr))}),ye&&(ye.allSettled&&l(je,"allSettled",function(){const ar=B.apply(null,arguments).map(nt);return new je(or=>{ar.length===0&&or([]);let lr=ar.length;const cr=new Array(lr);ar.forEach((ur,dr)=>je.resolve(ur).then(hr=>cr[dr]={status:"fulfilled",value:hr},hr=>cr[dr]={status:"rejected",reason:hr}).then(()=>--lr||or(cr)))})}),ye.any&&typeof AggregateError<"u"&&l(je,"any",function(){const ar=B.apply(null,arguments).map(nt);return new je((or,lr)=>{ar.length===0&&lr(new AggregateError([]));let cr=ar.length;const ur=new Array(cr);ar.forEach((dr,hr)=>je.resolve(dr).then(pr=>or(pr),pr=>{ur[hr]=pr,--cr||lr(new AggregateError(ur))}))})}));const ze={awaits:0,echoes:0,id:0};var Ge=0,He=[],Qe=0,Xe=0,Je=0;function Ze(ar,or,lr,cr){var ur=Oe,dr=Object.create(ur);dr.parent=ur,dr.ref=0,dr.global=!1,dr.id=++Je;var hr=Ke.env;dr.env=me?{Promise:je,PromiseProp:{value:je,configurable:!0,writable:!0},all:je.all,race:je.race,allSettled:je.allSettled,any:je.any,resolve:je.resolve,reject:je.reject,nthen:ct(hr.nthen,dr),gthen:ct(hr.gthen,dr)}:{},or&&r$1(dr,or),++ur.ref,dr.finalize=function(){--this.parent.ref||this.parent.finalize()};var pr=at(dr,ar,lr,cr);return dr.ref===0&&dr.finalize(),pr}function et(){return ze.id||(ze.id=++Ge),++ze.awaits,ze.echoes+=ce,ze.id}function tt(){return!!ze.awaits&&(--ze.awaits==0&&(ze.id=0),ze.echoes=ze.awaits*ce,!0)}function nt(ar){return ze.echoes&&ar&&ar.constructor===ye?(et(),ar.then(or=>(tt(),or),or=>(tt(),ft(or)))):ar}function rt(ar){++Xe,ze.echoes&&--ze.echoes!=0||(ze.echoes=ze.id=0),He.push(Oe),it(ar,!0)}function st(){var ar=He[He.length-1];He.pop(),it(ar,!1)}function it(ar,or){var lr=Oe;if((or?!ze.echoes||Qe++&&ar===Oe:!Qe||--Qe&&ar===Oe)||ut(or?rt.bind(null,ar):st),ar!==Oe&&(Oe=ar,lr===Ke&&(Ke.env=ot()),me)){var cr=Ke.env.Promise,ur=ar.env;de.then=ur.nthen,cr.prototype.then=ur.gthen,(lr.global||ar.global)&&(Object.defineProperty(e,"Promise",ur.PromiseProp),cr.all=ur.all,cr.race=ur.race,cr.resolve=ur.resolve,cr.reject=ur.reject,ur.allSettled&&(cr.allSettled=ur.allSettled),ur.any&&(cr.any=ur.any))}}function ot(){var ar=e.Promise;return me?{Promise:ar,PromiseProp:Object.getOwnPropertyDescriptor(e,"Promise"),all:ar.all,race:ar.race,allSettled:ar.allSettled,any:ar.any,resolve:ar.resolve,reject:ar.reject,nthen:de.then,gthen:ar.prototype.then}:{}}function at(ar,or,lr,cr,ur){var dr=Oe;try{return it(ar,!0),or(lr,cr,ur)}finally{it(dr,!1)}}function ut(ar){pe.call(he,ar)}function lt(ar,or,lr,cr){return typeof ar!="function"?ar:function(){var ur=Oe;lr&&et(),it(or,!0);try{return ar.apply(this,arguments)}finally{it(ur,!1),cr&&ut(tt)}}}function ct(ar,or){return function(lr,cr){return ar.call(this,lt(lr,or),lt(cr,or))}}(""+pe).indexOf("[native code]")===-1&&(et=tt=ee);const ht="unhandledrejection";function dt(ar,or){var lr;try{lr=or.onuncatched(ar)}catch{}if(lr!==!1)try{var cr,ur={promise:or,reason:ar};if(e.document&&document.createEvent?((cr=document.createEvent("Event")).initEvent(ht,!0,!0),r$1(cr,ur)):e.CustomEvent&&r$1(cr=new CustomEvent(ht,{detail:ur}),ur),cr&&e.dispatchEvent&&(dispatchEvent(cr),!e.PromiseRejectionEvent&&e.onunhandledrejection))try{e.onunhandledrejection(cr)}catch{}R&&cr&&!cr.defaultPrevented&&console.warn(`Unhandled rejection: ${ar.stack||ar}`)}catch{}}var ft=je.reject;function pt(ar,or,lr,cr){if(ar.idbdb&&(ar._state.openComplete||Oe.letThrough||ar._vip)){var ur=ar._createTransaction(or,lr,ar._dbSchema);try{ur.create(),ar._state.PR1398_maxLoop=3}catch(dr){return dr.name===H.InvalidState&&ar.isOpen()&&--ar._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),ar._close(),ar.open().then(()=>pt(ar,or,lr,cr))):ft(dr)}return ur._promise(or,(dr,hr)=>Ze(()=>(Oe.trans=ur,cr(dr,hr,ur)))).then(dr=>ur._completion.then(()=>dr))}if(ar._state.openComplete)return ft(new X.DatabaseClosed(ar._state.dbOpenError));if(!ar._state.isBeingOpened){if(!ar._options.autoOpen)return ft(new X.DatabaseClosed);ar.open().catch(ee)}return ar._state.dbReadyPromise.then(()=>pt(ar,or,lr,cr))}const yt="3.2.7",mt="",vt=-1/0,gt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",bt="String expected.",_t=[],wt=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),xt=wt,kt=wt,Et=ar=>!/(dexie\.js|dexie\.min\.js)/.test(ar),Pt="__dbnames",Kt="readonly",Ot="readwrite";function St(ar,or){return ar?or?function(){return ar.apply(this,arguments)&&or.apply(this,arguments)}:ar:or}const At={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ct(ar){return typeof ar!="string"||/\./.test(ar)?or=>or:or=>(or[ar]===void 0&&ar in or&&delete(or=O(or))[ar],or)}class jt{_trans(or,lr,cr){const ur=this._tx||Oe.trans,dr=this.name;function hr(xr,mr,fr){if(!fr.schema[dr])throw new X.NotFound("Table "+dr+" not part of transaction");return lr(fr.idbtrans,fr)}const pr=Ue();try{return ur&&ur.db===this.db?ur===Oe.trans?ur._promise(or,hr,cr):Ze(()=>ur._promise(or,hr,cr),{trans:ur,transless:Oe.transless||Oe}):pt(this.db,or,[this.name],hr)}finally{pr&&Le()}}get(or,lr){return or&&or.constructor===Object?this.where(or).first(lr):this._trans("readonly",cr=>this.core.get({trans:cr,key:or}).then(ur=>this.hook.reading.fire(ur))).then(lr)}where(or){if(typeof or=="string")return new this.db.WhereClause(this,or);if(n(or))return new this.db.WhereClause(this,`[${or.join("+")}]`);const lr=t(or);if(lr.length===1)return this.where(lr[0]).equals(or[lr[0]]);const cr=this.schema.indexes.concat(this.schema.primKey).filter(mr=>{if(mr.compound&&lr.every(fr=>mr.keyPath.indexOf(fr)>=0)){for(let fr=0;fr<lr.length;++fr)if(lr.indexOf(mr.keyPath[fr])===-1)return!1;return!0}return!1}).sort((mr,fr)=>mr.keyPath.length-fr.keyPath.length)[0];if(cr&&this.db._maxKey!==mt){const mr=cr.keyPath.slice(0,lr.length);return this.where(mr).equals(mr.map(fr=>or[fr]))}!cr&&R&&console.warn(`The query ${JSON.stringify(or)} on ${this.name} would benefit of a compound index [${lr.join("+")}]`);const{idxByName:ur}=this.schema,dr=this.db._deps.indexedDB;function hr(mr,fr){try{return dr.cmp(mr,fr)===0}catch{return!1}}const[pr,xr]=lr.reduce(([mr,fr],Er)=>{const vr=ur[Er],gr=or[Er];return[mr||vr,mr||!vr?St(fr,vr&&vr.multi?yr=>{const jr=b(yr,Er);return n(jr)&&jr.some(br=>hr(gr,br))}:yr=>hr(gr,b(yr,Er))):fr]},[null,null]);return pr?this.where(pr.name).equals(or[pr.keyPath]).filter(xr):cr?this.filter(xr):this.where(lr).equals("")}filter(or){return this.toCollection().and(or)}count(or){return this.toCollection().count(or)}offset(or){return this.toCollection().offset(or)}limit(or){return this.toCollection().limit(or)}each(or){return this.toCollection().each(or)}toArray(or){return this.toCollection().toArray(or)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(or){return new this.db.Collection(new this.db.WhereClause(this,n(or)?`[${or.join("+")}]`:or))}reverse(){return this.toCollection().reverse()}mapToClass(or){this.schema.mappedClass=or;const lr=cr=>{if(!cr)return cr;const ur=Object.create(or.prototype);for(var dr in cr)if(o(cr,dr))try{ur[dr]=cr[dr]}catch{}return ur};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=lr,this.hook("reading",lr),or}defineClass(){return this.mapToClass(function(or){r$1(this,or)})}add(or,lr){const{auto:cr,keyPath:ur}=this.schema.primKey;let dr=or;return ur&&cr&&(dr=Ct(ur)(or)),this._trans("readwrite",hr=>this.core.mutate({trans:hr,type:"add",keys:lr!=null?[lr]:null,values:[dr]})).then(hr=>hr.numFailures?je.reject(hr.failures[0]):hr.lastResult).then(hr=>{if(ur)try{_(or,ur,hr)}catch{}return hr})}update(or,lr){if(typeof or!="object"||n(or))return this.where(":id").equals(or).modify(lr);{const cr=b(or,this.schema.primKey.keyPath);if(cr===void 0)return ft(new X.InvalidArgument("Given object does not contain its primary key"));try{typeof lr!="function"?t(lr).forEach(ur=>{_(or,ur,lr[ur])}):lr(or,{value:or,primKey:cr})}catch{}return this.where(":id").equals(cr).modify(lr)}}put(or,lr){const{auto:cr,keyPath:ur}=this.schema.primKey;let dr=or;return ur&&cr&&(dr=Ct(ur)(or)),this._trans("readwrite",hr=>this.core.mutate({trans:hr,type:"put",values:[dr],keys:lr!=null?[lr]:null})).then(hr=>hr.numFailures?je.reject(hr.failures[0]):hr.lastResult).then(hr=>{if(ur)try{_(or,ur,hr)}catch{}return hr})}delete(or){return this._trans("readwrite",lr=>this.core.mutate({trans:lr,type:"delete",keys:[or]})).then(lr=>lr.numFailures?je.reject(lr.failures[0]):void 0)}clear(){return this._trans("readwrite",or=>this.core.mutate({trans:or,type:"deleteRange",range:At})).then(or=>or.numFailures?je.reject(or.failures[0]):void 0)}bulkGet(or){return this._trans("readonly",lr=>this.core.getMany({keys:or,trans:lr}).then(cr=>cr.map(ur=>this.hook.reading.fire(ur))))}bulkAdd(or,lr,cr){const ur=Array.isArray(lr)?lr:void 0,dr=(cr=cr||(ur?void 0:lr))?cr.allKeys:void 0;return this._trans("readwrite",hr=>{const{auto:pr,keyPath:xr}=this.schema.primKey;if(xr&&ur)throw new X.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(ur&&ur.length!==or.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");const mr=or.length;let fr=xr&&pr?or.map(Ct(xr)):or;return this.core.mutate({trans:hr,type:"add",keys:ur,values:fr,wantResults:dr}).then(({numFailures:Er,results:vr,lastResult:gr,failures:yr})=>{if(Er===0)return dr?vr:gr;throw new G(`${this.name}.bulkAdd(): ${Er} of ${mr} operations failed`,yr)})})}bulkPut(or,lr,cr){const ur=Array.isArray(lr)?lr:void 0,dr=(cr=cr||(ur?void 0:lr))?cr.allKeys:void 0;return this._trans("readwrite",hr=>{const{auto:pr,keyPath:xr}=this.schema.primKey;if(xr&&ur)throw new X.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(ur&&ur.length!==or.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");const mr=or.length;let fr=xr&&pr?or.map(Ct(xr)):or;return this.core.mutate({trans:hr,type:"put",keys:ur,values:fr,wantResults:dr}).then(({numFailures:Er,results:vr,lastResult:gr,failures:yr})=>{if(Er===0)return dr?vr:gr;throw new G(`${this.name}.bulkPut(): ${Er} of ${mr} operations failed`,yr)})})}bulkDelete(or){const lr=or.length;return this._trans("readwrite",cr=>this.core.mutate({trans:cr,type:"delete",keys:or})).then(({numFailures:cr,lastResult:ur,failures:dr})=>{if(cr===0)return ur;throw new G(`${this.name}.bulkDelete(): ${cr} of ${lr} operations failed`,dr)})}}function Dt(ar){var or={},lr=function(hr,pr){if(pr){for(var xr=arguments.length,mr=new Array(xr-1);--xr;)mr[xr-1]=arguments[xr];return or[hr].subscribe.apply(null,mr),ar}if(typeof hr=="string")return or[hr]};lr.addEventType=dr;for(var cr=1,ur=arguments.length;cr<ur;++cr)dr(arguments[cr]);return lr;function dr(hr,pr,xr){if(typeof hr!="object"){var mr;pr||(pr=ae),xr||(xr=ee);var fr={subscribers:[],fire:xr,subscribe:function(Er){fr.subscribers.indexOf(Er)===-1&&(fr.subscribers.push(Er),fr.fire=pr(fr.fire,Er))},unsubscribe:function(Er){fr.subscribers=fr.subscribers.filter(function(vr){return vr!==Er}),fr.fire=fr.subscribers.reduce(pr,xr)}};return or[hr]=lr[hr]=fr,fr}t(mr=hr).forEach(function(Er){var vr=mr[Er];if(n(vr))dr(Er,mr[Er][0],mr[Er][1]);else{if(vr!=="asap")throw new X.InvalidArgument("Invalid event config");var gr=dr(Er,te,function(){for(var yr=arguments.length,jr=new Array(yr);yr--;)jr[yr]=arguments[yr];gr.subscribers.forEach(function(br){v(function(){br.apply(null,jr)})})})}})}}function It(ar,or){return c(or).from({prototype:ar}),or}function Bt(ar,or){return!(ar.filter||ar.algorithm||ar.or)&&(or?ar.justLimit:!ar.replayFilter)}function Tt(ar,or){ar.filter=St(ar.filter,or)}function Rt(ar,or,lr){var cr=ar.replayFilter;ar.replayFilter=cr?()=>St(cr(),or()):or,ar.justLimit=lr&&!cr}function Ft(ar,or){if(ar.isPrimKey)return or.primaryKey;const lr=or.getIndexByKeyPath(ar.index);if(!lr)throw new X.Schema("KeyPath "+ar.index+" on object store "+or.name+" is not indexed");return lr}function Mt(ar,or,lr){const cr=Ft(ar,or.schema);return or.openCursor({trans:lr,values:!ar.keysOnly,reverse:ar.dir==="prev",unique:!!ar.unique,query:{index:cr,range:ar.range}})}function Nt(ar,or,lr,cr){const ur=ar.replayFilter?St(ar.filter,ar.replayFilter()):ar.filter;if(ar.or){const dr={},hr=(pr,xr,mr)=>{if(!ur||ur(xr,mr,vr=>xr.stop(vr),vr=>xr.fail(vr))){var fr=xr.primaryKey,Er=""+fr;Er==="[object ArrayBuffer]"&&(Er=""+new Uint8Array(fr)),o(dr,Er)||(dr[Er]=!0,or(pr,xr,mr))}};return Promise.all([ar.or._iterate(hr,lr),qt(Mt(ar,cr,lr),ar.algorithm,hr,!ar.keysOnly&&ar.valueMapper)])}return qt(Mt(ar,cr,lr),St(ar.algorithm,ur),or,!ar.keysOnly&&ar.valueMapper)}function qt(ar,or,lr,cr){var ur=Ye(cr?(dr,hr,pr)=>lr(cr(dr),hr,pr):lr);return ar.then(dr=>{if(dr)return dr.start(()=>{var hr=()=>dr.continue();or&&!or(dr,pr=>hr=pr,pr=>{dr.stop(pr),hr=ee},pr=>{dr.fail(pr),hr=ee})||ur(dr.value,dr,pr=>hr=pr),hr()})})}function $t(ar,or){try{const lr=Ut(ar),cr=Ut(or);if(lr!==cr)return lr==="Array"?1:cr==="Array"?-1:lr==="binary"?1:cr==="binary"?-1:lr==="string"?1:cr==="string"?-1:lr==="Date"?1:cr!=="Date"?NaN:-1;switch(lr){case"number":case"Date":case"string":return ar>or?1:ar<or?-1:0;case"binary":return function(ur,dr){const hr=ur.length,pr=dr.length,xr=hr<pr?hr:pr;for(let mr=0;mr<xr;++mr)if(ur[mr]!==dr[mr])return ur[mr]<dr[mr]?-1:1;return hr===pr?0:hr<pr?-1:1}(Lt(ar),Lt(or));case"Array":return function(ur,dr){const hr=ur.length,pr=dr.length,xr=hr<pr?hr:pr;for(let mr=0;mr<xr;++mr){const fr=$t(ur[mr],dr[mr]);if(fr!==0)return fr}return hr===pr?0:hr<pr?-1:1}(ar,or)}}catch{}return NaN}function Ut(ar){const or=typeof ar;if(or!=="object")return or;if(ArrayBuffer.isView(ar))return"binary";const lr=C(ar);return lr==="ArrayBuffer"?"binary":lr}function Lt(ar){return ar instanceof Uint8Array?ar:ArrayBuffer.isView(ar)?new Uint8Array(ar.buffer,ar.byteOffset,ar.byteLength):new Uint8Array(ar)}class Vt{_read(or,lr){var cr=this._ctx;return cr.error?cr.table._trans(null,ft.bind(null,cr.error)):cr.table._trans("readonly",or).then(lr)}_write(or){var lr=this._ctx;return lr.error?lr.table._trans(null,ft.bind(null,lr.error)):lr.table._trans("readwrite",or,"locked")}_addAlgorithm(or){var lr=this._ctx;lr.algorithm=St(lr.algorithm,or)}_iterate(or,lr){return Nt(this._ctx,or,lr,this._ctx.table.core)}clone(or){var lr=Object.create(this.constructor.prototype),cr=Object.create(this._ctx);return or&&r$1(cr,or),lr._ctx=cr,lr}raw(){return this._ctx.valueMapper=null,this}each(or){var lr=this._ctx;return this._read(cr=>Nt(lr,or,cr,lr.table.core))}count(or){return this._read(lr=>{const cr=this._ctx,ur=cr.table.core;if(Bt(cr,!0))return ur.count({trans:lr,query:{index:Ft(cr,ur.schema),range:cr.range}}).then(hr=>Math.min(hr,cr.limit));var dr=0;return Nt(cr,()=>(++dr,!1),lr,ur).then(()=>dr)}).then(or)}sortBy(or,lr){const cr=or.split(".").reverse(),ur=cr[0],dr=cr.length-1;function hr(mr,fr){return fr?hr(mr[cr[fr]],fr-1):mr[ur]}var pr=this._ctx.dir==="next"?1:-1;function xr(mr,fr){var Er=hr(mr,dr),vr=hr(fr,dr);return Er<vr?-pr:Er>vr?pr:0}return this.toArray(function(mr){return mr.sort(xr)}).then(lr)}toArray(or){return this._read(lr=>{var cr=this._ctx;if(cr.dir==="next"&&Bt(cr,!0)&&cr.limit>0){const{valueMapper:ur}=cr,dr=Ft(cr,cr.table.core.schema);return cr.table.core.query({trans:lr,limit:cr.limit,values:!0,query:{index:dr,range:cr.range}}).then(({result:hr})=>ur?hr.map(ur):hr)}{const ur=[];return Nt(cr,dr=>ur.push(dr),lr,cr.table.core).then(()=>ur)}},or)}offset(or){var lr=this._ctx;return or<=0||(lr.offset+=or,Bt(lr)?Rt(lr,()=>{var cr=or;return(ur,dr)=>cr===0||(cr===1?(--cr,!1):(dr(()=>{ur.advance(cr),cr=0}),!1))}):Rt(lr,()=>{var cr=or;return()=>--cr<0})),this}limit(or){return this._ctx.limit=Math.min(this._ctx.limit,or),Rt(this._ctx,()=>{var lr=or;return function(cr,ur,dr){return--lr<=0&&ur(dr),lr>=0}},!0),this}until(or,lr){return Tt(this._ctx,function(cr,ur,dr){return!or(cr.value)||(ur(dr),lr)}),this}first(or){return this.limit(1).toArray(function(lr){return lr[0]}).then(or)}last(or){return this.reverse().first(or)}filter(or){var lr,cr;return Tt(this._ctx,function(ur){return or(ur.value)}),lr=this._ctx,cr=or,lr.isMatch=St(lr.isMatch,cr),this}and(or){return this.filter(or)}or(or){return new this.db.WhereClause(this._ctx.table,or,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(or){var lr=this._ctx;return lr.keysOnly=!lr.isMatch,this.each(function(cr,ur){or(ur.key,ur)})}eachUniqueKey(or){return this._ctx.unique="unique",this.eachKey(or)}eachPrimaryKey(or){var lr=this._ctx;return lr.keysOnly=!lr.isMatch,this.each(function(cr,ur){or(ur.primaryKey,ur)})}keys(or){var lr=this._ctx;lr.keysOnly=!lr.isMatch;var cr=[];return this.each(function(ur,dr){cr.push(dr.key)}).then(function(){return cr}).then(or)}primaryKeys(or){var lr=this._ctx;if(lr.dir==="next"&&Bt(lr,!0)&&lr.limit>0)return this._read(ur=>{var dr=Ft(lr,lr.table.core.schema);return lr.table.core.query({trans:ur,values:!1,limit:lr.limit,query:{index:dr,range:lr.range}})}).then(({result:ur})=>ur).then(or);lr.keysOnly=!lr.isMatch;var cr=[];return this.each(function(ur,dr){cr.push(dr.primaryKey)}).then(function(){return cr}).then(or)}uniqueKeys(or){return this._ctx.unique="unique",this.keys(or)}firstKey(or){return this.limit(1).keys(function(lr){return lr[0]}).then(or)}lastKey(or){return this.reverse().firstKey(or)}distinct(){var or=this._ctx,lr=or.index&&or.table.schema.idxByName[or.index];if(!lr||!lr.multi)return this;var cr={};return Tt(this._ctx,function(ur){var dr=ur.primaryKey.toString(),hr=o(cr,dr);return cr[dr]=!0,!hr}),this}modify(or){var lr=this._ctx;return this._write(cr=>{var ur;if(typeof or=="function")ur=or;else{var dr=t(or),hr=dr.length;ur=function(jr){for(var br=!1,_r=0;_r<hr;++_r){var wr=dr[_r],Rr=or[wr];b(jr,wr)!==Rr&&(_(jr,wr,Rr),br=!0)}return br}}const pr=lr.table.core,{outbound:xr,extractKey:mr}=pr.schema.primaryKey,fr=this.db._options.modifyChunkSize||200,Er=[];let vr=0;const gr=[],yr=(jr,br)=>{const{failures:_r,numFailures:wr}=br;vr+=jr-wr;for(let Rr of t(_r))Er.push(_r[Rr])};return this.clone().primaryKeys().then(jr=>{const br=_r=>{const wr=Math.min(fr,jr.length-_r);return pr.getMany({trans:cr,keys:jr.slice(_r,_r+wr),cache:"immutable"}).then(Rr=>{const Ar=[],Sr=[],kr=xr?[]:null,Nr=[];for(let Tr=0;Tr<wr;++Tr){const Pr=Rr[Tr],Ir={value:O(Pr),primKey:jr[_r+Tr]};ur.call(Ir,Ir.value,Ir)!==!1&&(Ir.value==null?Nr.push(jr[_r+Tr]):xr||$t(mr(Pr),mr(Ir.value))===0?(Sr.push(Ir.value),xr&&kr.push(jr[_r+Tr])):(Nr.push(jr[_r+Tr]),Ar.push(Ir.value)))}const Cr=Bt(lr)&&lr.limit===1/0&&(typeof or!="function"||or===Wt)&&{index:lr.index,range:lr.range};return Promise.resolve(Ar.length>0&&pr.mutate({trans:cr,type:"add",values:Ar}).then(Tr=>{for(let Pr in Tr.failures)Nr.splice(parseInt(Pr),1);yr(Ar.length,Tr)})).then(()=>(Sr.length>0||Cr&&typeof or=="object")&&pr.mutate({trans:cr,type:"put",keys:kr,values:Sr,criteria:Cr,changeSpec:typeof or!="function"&&or}).then(Tr=>yr(Sr.length,Tr))).then(()=>(Nr.length>0||Cr&&or===Wt)&&pr.mutate({trans:cr,type:"delete",keys:Nr,criteria:Cr}).then(Tr=>yr(Nr.length,Tr))).then(()=>jr.length>_r+wr&&br(_r+fr))})};return br(0).then(()=>{if(Er.length>0)throw new z("Error modifying one or more objects",Er,vr,gr);return jr.length})})})}delete(){var or=this._ctx,lr=or.range;return Bt(or)&&(or.isPrimKey&&!kt||lr.type===3)?this._write(cr=>{const{primaryKey:ur}=or.table.core.schema,dr=lr;return or.table.core.count({trans:cr,query:{index:ur,range:dr}}).then(hr=>or.table.core.mutate({trans:cr,type:"deleteRange",range:dr}).then(({failures:pr,lastResult:xr,results:mr,numFailures:fr})=>{if(fr)throw new z("Could not delete some values",Object.keys(pr).map(Er=>pr[Er]),hr-fr);return hr-fr}))}):this.modify(Wt)}}const Wt=(ar,or)=>or.value=null;function Yt(ar,or){return ar<or?-1:ar===or?0:1}function zt(ar,or){return ar>or?-1:ar===or?0:1}function Gt(ar,or,lr){var cr=ar instanceof en?new ar.Collection(ar):ar;return cr._ctx.error=lr?new lr(or):new TypeError(or),cr}function Ht(ar){return new ar.Collection(ar,()=>Zt("")).limit(0)}function Qt(ar,or,lr,cr,ur,dr){for(var hr=Math.min(ar.length,cr.length),pr=-1,xr=0;xr<hr;++xr){var mr=or[xr];if(mr!==cr[xr])return ur(ar[xr],lr[xr])<0?ar.substr(0,xr)+lr[xr]+lr.substr(xr+1):ur(ar[xr],cr[xr])<0?ar.substr(0,xr)+cr[xr]+lr.substr(xr+1):pr>=0?ar.substr(0,pr)+or[pr]+lr.substr(pr+1):null;ur(ar[xr],mr)<0&&(pr=xr)}return hr<cr.length&&dr==="next"?ar+lr.substr(ar.length):hr<ar.length&&dr==="prev"?ar.substr(0,lr.length):pr<0?null:ar.substr(0,pr)+cr[pr]+lr.substr(pr+1)}function Xt(ar,or,lr,cr){var ur,dr,hr,pr,xr,mr,fr,Er=lr.length;if(!lr.every(jr=>typeof jr=="string"))return Gt(ar,bt);function vr(jr){ur=function(_r){return _r==="next"?wr=>wr.toUpperCase():wr=>wr.toLowerCase()}(jr),dr=function(_r){return _r==="next"?wr=>wr.toLowerCase():wr=>wr.toUpperCase()}(jr),hr=jr==="next"?Yt:zt;var br=lr.map(function(_r){return{lower:dr(_r),upper:ur(_r)}}).sort(function(_r,wr){return hr(_r.lower,wr.lower)});pr=br.map(function(_r){return _r.upper}),xr=br.map(function(_r){return _r.lower}),mr=jr,fr=jr==="next"?"":cr}vr("next");var gr=new ar.Collection(ar,()=>Jt(pr[0],xr[Er-1]+cr));gr._ondirectionchange=function(jr){vr(jr)};var yr=0;return gr._addAlgorithm(function(jr,br,_r){var wr=jr.key;if(typeof wr!="string")return!1;var Rr=dr(wr);if(or(Rr,xr,yr))return!0;for(var Ar=null,Sr=yr;Sr<Er;++Sr){var kr=Qt(wr,Rr,pr[Sr],xr[Sr],hr,mr);kr===null&&Ar===null?yr=Sr+1:(Ar===null||hr(Ar,kr)>0)&&(Ar=kr)}return br(Ar!==null?function(){jr.continue(Ar+fr)}:_r),!1}),gr}function Jt(ar,or,lr,cr){return{type:2,lower:ar,upper:or,lowerOpen:lr,upperOpen:cr}}function Zt(ar){return{type:1,lower:ar,upper:ar}}class en{get Collection(){return this._ctx.table.db.Collection}between(or,lr,cr,ur){cr=cr!==!1,ur=ur===!0;try{return this._cmp(or,lr)>0||this._cmp(or,lr)===0&&(cr||ur)&&(!cr||!ur)?Ht(this):new this.Collection(this,()=>Jt(or,lr,!cr,!ur))}catch{return Gt(this,gt)}}equals(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Zt(or))}above(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Jt(or,void 0,!0))}aboveOrEqual(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Jt(or,void 0,!1))}below(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Jt(void 0,or,!1,!0))}belowOrEqual(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Jt(void 0,or))}startsWith(or){return typeof or!="string"?Gt(this,bt):this.between(or,or+mt,!0,!0)}startsWithIgnoreCase(or){return or===""?this.startsWith(or):Xt(this,(lr,cr)=>lr.indexOf(cr[0])===0,[or],mt)}equalsIgnoreCase(or){return Xt(this,(lr,cr)=>lr===cr[0],[or],"")}anyOfIgnoreCase(){var or=B.apply(I,arguments);return or.length===0?Ht(this):Xt(this,(lr,cr)=>cr.indexOf(lr)!==-1,or,"")}startsWithAnyOfIgnoreCase(){var or=B.apply(I,arguments);return or.length===0?Ht(this):Xt(this,(lr,cr)=>cr.some(ur=>lr.indexOf(ur)===0),or,mt)}anyOf(){const or=B.apply(I,arguments);let lr=this._cmp;try{or.sort(lr)}catch{return Gt(this,gt)}if(or.length===0)return Ht(this);const cr=new this.Collection(this,()=>Jt(or[0],or[or.length-1]));cr._ondirectionchange=dr=>{lr=dr==="next"?this._ascending:this._descending,or.sort(lr)};let ur=0;return cr._addAlgorithm((dr,hr,pr)=>{const xr=dr.key;for(;lr(xr,or[ur])>0;)if(++ur,ur===or.length)return hr(pr),!1;return lr(xr,or[ur])===0||(hr(()=>{dr.continue(or[ur])}),!1)}),cr}notEqual(or){return this.inAnyRange([[vt,or],[or,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const or=B.apply(I,arguments);if(or.length===0)return new this.Collection(this);try{or.sort(this._ascending)}catch{return Gt(this,gt)}const lr=or.reduce((cr,ur)=>cr?cr.concat([[cr[cr.length-1][1],ur]]):[[vt,ur]],null);return lr.push([or[or.length-1],this.db._maxKey]),this.inAnyRange(lr,{includeLowers:!1,includeUppers:!1})}inAnyRange(or,lr){const cr=this._cmp,ur=this._ascending,dr=this._descending,hr=this._min,pr=this._max;if(or.length===0)return Ht(this);if(!or.every(wr=>wr[0]!==void 0&&wr[1]!==void 0&&ur(wr[0],wr[1])<=0))return Gt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",X.InvalidArgument);const xr=!lr||lr.includeLowers!==!1,mr=lr&&lr.includeUppers===!0;let fr,Er=ur;function vr(wr,Rr){return Er(wr[0],Rr[0])}try{fr=or.reduce(function(wr,Rr){let Ar=0,Sr=wr.length;for(;Ar<Sr;++Ar){const kr=wr[Ar];if(cr(Rr[0],kr[1])<0&&cr(Rr[1],kr[0])>0){kr[0]=hr(kr[0],Rr[0]),kr[1]=pr(kr[1],Rr[1]);break}}return Ar===Sr&&wr.push(Rr),wr},[]),fr.sort(vr)}catch{return Gt(this,gt)}let gr=0;const yr=mr?wr=>ur(wr,fr[gr][1])>0:wr=>ur(wr,fr[gr][1])>=0,jr=xr?wr=>dr(wr,fr[gr][0])>0:wr=>dr(wr,fr[gr][0])>=0;let br=yr;const _r=new this.Collection(this,()=>Jt(fr[0][0],fr[fr.length-1][1],!xr,!mr));return _r._ondirectionchange=wr=>{wr==="next"?(br=yr,Er=ur):(br=jr,Er=dr),fr.sort(vr)},_r._addAlgorithm((wr,Rr,Ar)=>{for(var Sr=wr.key;br(Sr);)if(++gr,gr===fr.length)return Rr(Ar),!1;return!!function(kr){return!yr(kr)&&!jr(kr)}(Sr)||(this._cmp(Sr,fr[gr][1])===0||this._cmp(Sr,fr[gr][0])===0||Rr(()=>{Er===ur?wr.continue(fr[gr][0]):wr.continue(fr[gr][1])}),!1)}),_r}startsWithAnyOf(){const or=B.apply(I,arguments);return or.every(lr=>typeof lr=="string")?or.length===0?Ht(this):this.inAnyRange(or.map(lr=>[lr,lr+mt])):Gt(this,"startsWithAnyOf() only works with strings")}}function tn(ar){return Ye(function(or){return nn(or),ar(or.target.error),!1})}function nn(ar){ar.stopPropagation&&ar.stopPropagation(),ar.preventDefault&&ar.preventDefault()}const rn="storagemutated",sn="x-storagemutated-1",on=Dt(null,rn);class an{_lock(){return m(!Oe.global),++this._reculock,this._reculock!==1||Oe.global||(Oe.lockOwnerFor=this),this}_unlock(){if(m(!Oe.global),--this._reculock==0)for(Oe.global||(Oe.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var or=this._blockedFuncs.shift();try{at(or[1],or[0])}catch{}}return this}_locked(){return this._reculock&&Oe.lockOwnerFor!==this}create(or){if(!this.mode)return this;const lr=this.db.idbdb,cr=this.db._state.dbOpenError;if(m(!this.idbtrans),!or&&!lr)switch(cr&&cr.name){case"DatabaseClosedError":throw new X.DatabaseClosed(cr);case"MissingAPIError":throw new X.MissingAPI(cr.message,cr);default:throw new X.OpenFailed(cr)}if(!this.active)throw new X.TransactionInactive;return m(this._completion._state===null),(or=this.idbtrans=or||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):lr.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ye(ur=>{nn(ur),this._reject(or.error)}),or.onabort=Ye(ur=>{nn(ur),this.active&&this._reject(new X.Abort(or.error)),this.active=!1,this.on("abort").fire(ur)}),or.oncomplete=Ye(()=>{this.active=!1,this._resolve(),"mutatedParts"in or&&on.storagemutated.fire(or.mutatedParts)}),this}_promise(or,lr,cr){if(or==="readwrite"&&this.mode!=="readwrite")return ft(new X.ReadOnly("Transaction is readonly"));if(!this.active)return ft(new X.TransactionInactive);if(this._locked())return new je((dr,hr)=>{this._blockedFuncs.push([()=>{this._promise(or,lr,cr).then(dr,hr)},Oe])});if(cr)return Ze(()=>{var dr=new je((hr,pr)=>{this._lock();const xr=lr(hr,pr,this);xr&&xr.then&&xr.then(hr,pr)});return dr.finally(()=>this._unlock()),dr._lib=!0,dr});var ur=new je((dr,hr)=>{var pr=lr(dr,hr,this);pr&&pr.then&&pr.then(dr,hr)});return ur._lib=!0,ur}_root(){return this.parent?this.parent._root():this}waitFor(or){var lr=this._root();const cr=je.resolve(or);if(lr._waitingFor)lr._waitingFor=lr._waitingFor.then(()=>cr);else{lr._waitingFor=cr,lr._waitingQueue=[];var ur=lr.idbtrans.objectStore(lr.storeNames[0]);(function hr(){for(++lr._spinCount;lr._waitingQueue.length;)lr._waitingQueue.shift()();lr._waitingFor&&(ur.get(-1/0).onsuccess=hr)})()}var dr=lr._waitingFor;return new je((hr,pr)=>{cr.then(xr=>lr._waitingQueue.push(Ye(hr.bind(null,xr))),xr=>lr._waitingQueue.push(Ye(pr.bind(null,xr)))).finally(()=>{lr._waitingFor===dr&&(lr._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new X.Abort))}table(or){const lr=this._memoizedTables||(this._memoizedTables={});if(o(lr,or))return lr[or];const cr=this.schema[or];if(!cr)throw new X.NotFound("Table "+or+" not part of transaction");const ur=new this.db.Table(or,cr,this);return ur.core=this.db.core.table(or),lr[or]=ur,ur}}function un(ar,or,lr,cr,ur,dr,hr){return{name:ar,keyPath:or,unique:lr,multi:cr,auto:ur,compound:dr,src:(lr&&!hr?"&":"")+(cr?"*":"")+(ur?"++":"")+ln(or)}}function ln(ar){return typeof ar=="string"?ar:ar?"["+[].join.call(ar,"+")+"]":""}function cn(ar,or,lr){return{name:ar,primKey:or,indexes:lr,mappedClass:null,idxByName:g(lr,cr=>[cr.name,cr])}}let hn=ar=>{try{return ar.only([[]]),hn=()=>[[]],[[]]}catch{return hn=()=>mt,mt}};function dn(ar){return ar==null?()=>{}:typeof ar=="string"?function(or){return or.split(".").length===1?cr=>cr[or]:cr=>b(cr,or)}(ar):or=>b(or,ar)}function fn(ar){return[].slice.call(ar)}let pn=0;function yn(ar){return ar==null?":id":typeof ar=="string"?ar:`[${ar.join("+")}]`}function mn(ar,or,lr){function cr(xr){if(xr.type===3)return null;if(xr.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:mr,upper:fr,lowerOpen:Er,upperOpen:vr}=xr;return mr===void 0?fr===void 0?null:or.upperBound(fr,!!vr):fr===void 0?or.lowerBound(mr,!!Er):or.bound(mr,fr,!!Er,!!vr)}const{schema:ur,hasGetAll:dr}=function(xr,mr){const fr=fn(xr.objectStoreNames);return{schema:{name:xr.name,tables:fr.map(Er=>mr.objectStore(Er)).map(Er=>{const{keyPath:vr,autoIncrement:gr}=Er,yr=n(vr),jr=vr==null,br={},_r={name:Er.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:jr,compound:yr,keyPath:vr,autoIncrement:gr,unique:!0,extractKey:dn(vr)},indexes:fn(Er.indexNames).map(wr=>Er.index(wr)).map(wr=>{const{name:Rr,unique:Ar,multiEntry:Sr,keyPath:kr}=wr,Nr={name:Rr,compound:n(kr),keyPath:kr,unique:Ar,multiEntry:Sr,extractKey:dn(kr)};return br[yn(kr)]=Nr,Nr}),getIndexByKeyPath:wr=>br[yn(wr)]};return br[":id"]=_r.primaryKey,vr!=null&&(br[yn(vr)]=_r.primaryKey),_r})},hasGetAll:fr.length>0&&"getAll"in mr.objectStore(fr[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(ar,lr),hr=ur.tables.map(xr=>function(mr){const fr=mr.name;return{name:fr,schema:mr,mutate:function({trans:Er,type:vr,keys:gr,values:yr,range:jr}){return new Promise((br,_r)=>{br=Ye(br);const wr=Er.objectStore(fr),Rr=wr.keyPath==null,Ar=vr==="put"||vr==="add";if(!Ar&&vr!=="delete"&&vr!=="deleteRange")throw new Error("Invalid operation type: "+vr);const{length:Sr}=gr||yr||{length:1};if(gr&&yr&&gr.length!==yr.length)throw new Error("Given keys array must have same length as given values array.");if(Sr===0)return br({numFailures:0,failures:{},results:[],lastResult:void 0});let kr;const Nr=[],Cr=[];let Tr=0;const Pr=Br=>{++Tr,nn(Br)};if(vr==="deleteRange"){if(jr.type===4)return br({numFailures:Tr,failures:Cr,results:[],lastResult:void 0});jr.type===3?Nr.push(kr=wr.clear()):Nr.push(kr=wr.delete(cr(jr)))}else{const[Br,Wr]=Ar?Rr?[yr,gr]:[yr,null]:[gr,null];if(Ar)for(let Yr=0;Yr<Sr;++Yr)Nr.push(kr=Wr&&Wr[Yr]!==void 0?wr[vr](Br[Yr],Wr[Yr]):wr[vr](Br[Yr])),kr.onerror=Pr;else for(let Yr=0;Yr<Sr;++Yr)Nr.push(kr=wr[vr](Br[Yr])),kr.onerror=Pr}const Ir=Br=>{const Wr=Br.target.result;Nr.forEach((Yr,es)=>Yr.error!=null&&(Cr[es]=Yr.error)),br({numFailures:Tr,failures:Cr,results:vr==="delete"?gr:Nr.map(Yr=>Yr.result),lastResult:Wr})};kr.onerror=Br=>{Pr(Br),Ir(Br)},kr.onsuccess=Ir})},getMany:({trans:Er,keys:vr})=>new Promise((gr,yr)=>{gr=Ye(gr);const jr=Er.objectStore(fr),br=vr.length,_r=new Array(br);let wr,Rr=0,Ar=0;const Sr=Nr=>{const Cr=Nr.target;_r[Cr._pos]=Cr.result,++Ar===Rr&&gr(_r)},kr=tn(yr);for(let Nr=0;Nr<br;++Nr)vr[Nr]!=null&&(wr=jr.get(vr[Nr]),wr._pos=Nr,wr.onsuccess=Sr,wr.onerror=kr,++Rr);Rr===0&&gr(_r)}),get:({trans:Er,key:vr})=>new Promise((gr,yr)=>{gr=Ye(gr);const jr=Er.objectStore(fr).get(vr);jr.onsuccess=br=>gr(br.target.result),jr.onerror=tn(yr)}),query:function(Er){return vr=>new Promise((gr,yr)=>{gr=Ye(gr);const{trans:jr,values:br,limit:_r,query:wr}=vr,Rr=_r===1/0?void 0:_r,{index:Ar,range:Sr}=wr,kr=jr.objectStore(fr),Nr=Ar.isPrimaryKey?kr:kr.index(Ar.name),Cr=cr(Sr);if(_r===0)return gr({result:[]});if(Er){const Tr=br?Nr.getAll(Cr,Rr):Nr.getAllKeys(Cr,Rr);Tr.onsuccess=Pr=>gr({result:Pr.target.result}),Tr.onerror=tn(yr)}else{let Tr=0;const Pr=br||!("openKeyCursor"in Nr)?Nr.openCursor(Cr):Nr.openKeyCursor(Cr),Ir=[];Pr.onsuccess=Br=>{const Wr=Pr.result;return Wr?(Ir.push(br?Wr.value:Wr.primaryKey),++Tr===_r?gr({result:Ir}):void Wr.continue()):gr({result:Ir})},Pr.onerror=tn(yr)}})}(dr),openCursor:function({trans:Er,values:vr,query:gr,reverse:yr,unique:jr}){return new Promise((br,_r)=>{br=Ye(br);const{index:wr,range:Rr}=gr,Ar=Er.objectStore(fr),Sr=wr.isPrimaryKey?Ar:Ar.index(wr.name),kr=yr?jr?"prevunique":"prev":jr?"nextunique":"next",Nr=vr||!("openKeyCursor"in Sr)?Sr.openCursor(cr(Rr),kr):Sr.openKeyCursor(cr(Rr),kr);Nr.onerror=tn(_r),Nr.onsuccess=Ye(Cr=>{const Tr=Nr.result;if(!Tr)return void br(null);Tr.___id=++pn,Tr.done=!1;const Pr=Tr.continue.bind(Tr);let Ir=Tr.continuePrimaryKey;Ir&&(Ir=Ir.bind(Tr));const Br=Tr.advance.bind(Tr),Wr=()=>{throw new Error("Cursor not stopped")};Tr.trans=Er,Tr.stop=Tr.continue=Tr.continuePrimaryKey=Tr.advance=()=>{throw new Error("Cursor not started")},Tr.fail=Ye(_r),Tr.next=function(){let Yr=1;return this.start(()=>Yr--?this.continue():this.stop()).then(()=>this)},Tr.start=Yr=>{const es=new Promise((ts,Qr)=>{ts=Ye(ts),Nr.onerror=tn(Qr),Tr.fail=Qr,Tr.stop=Hr=>{Tr.stop=Tr.continue=Tr.continuePrimaryKey=Tr.advance=Wr,ts(Hr)}}),ps=()=>{if(Nr.result)try{Yr()}catch(ts){Tr.fail(ts)}else Tr.done=!0,Tr.start=()=>{throw new Error("Cursor behind last entry")},Tr.stop()};return Nr.onsuccess=Ye(ts=>{Nr.onsuccess=ps,ps()}),Tr.continue=Pr,Tr.continuePrimaryKey=Ir,Tr.advance=Br,ps(),es},br(Tr)},_r)})},count({query:Er,trans:vr}){const{index:gr,range:yr}=Er;return new Promise((jr,br)=>{const _r=vr.objectStore(fr),wr=gr.isPrimaryKey?_r:_r.index(gr.name),Rr=cr(yr),Ar=Rr?wr.count(Rr):wr.count();Ar.onsuccess=Ye(Sr=>jr(Sr.target.result)),Ar.onerror=tn(br)})}}}(xr)),pr={};return hr.forEach(xr=>pr[xr.name]=xr),{stack:"dbcore",transaction:ar.transaction.bind(ar),table(xr){if(!pr[xr])throw new Error(`Table '${xr}' not found`);return pr[xr]},MIN_KEY:-1/0,MAX_KEY:hn(or),schema:ur}}function vn({_novip:ar},or){const lr=or.db,cr=function(ur,dr,{IDBKeyRange:hr,indexedDB:pr},xr){return{dbcore:function(fr,Er){return Er.reduce((vr,{create:gr})=>({...vr,...gr(vr)}),fr)}(mn(dr,hr,xr),ur.dbcore)}}(ar._middlewares,lr,ar._deps,or);ar.core=cr.dbcore,ar.tables.forEach(ur=>{const dr=ur.name;ar.core.schema.tables.some(hr=>hr.name===dr)&&(ur.core=ar.core.table(dr),ar[dr]instanceof ar.Table&&(ar[dr].core=ur.core))})}function gn({_novip:ar},or,lr,cr){lr.forEach(ur=>{const dr=cr[ur];or.forEach(hr=>{const pr=d(hr,ur);(!pr||"value"in pr&&pr.value===void 0)&&(hr===ar.Transaction.prototype||hr instanceof ar.Transaction?l(hr,ur,{get(){return this.table(ur)},set(xr){u(this,ur,{value:xr,writable:!0,configurable:!0,enumerable:!0})}}):hr[ur]=new ar.Table(ur,dr))})})}function bn({_novip:ar},or){or.forEach(lr=>{for(let cr in lr)lr[cr]instanceof ar.Table&&delete lr[cr]})}function _n(ar,or){return ar._cfg.version-or._cfg.version}function wn(ar,or,lr,cr){const ur=ar._dbSchema,dr=ar._createTransaction("readwrite",ar._storeNames,ur);dr.create(lr),dr._completion.catch(cr);const hr=dr._reject.bind(dr),pr=Oe.transless||Oe;Ze(()=>{Oe.trans=dr,Oe.transless=pr,or===0?(t(ur).forEach(xr=>{kn(lr,xr,ur[xr].primKey,ur[xr].indexes)}),vn(ar,lr),je.follow(()=>ar.on.populate.fire(dr)).catch(hr)):function({_novip:xr},mr,fr,Er){const vr=[],gr=xr._versions;let yr=xr._dbSchema=Pn(xr,xr.idbdb,Er),jr=!1;const br=gr.filter(wr=>wr._cfg.version>=mr);function _r(){return vr.length?je.resolve(vr.shift()(fr.idbtrans)).then(_r):je.resolve()}return br.forEach(wr=>{vr.push(()=>{const Rr=yr,Ar=wr._cfg.dbschema;Kn(xr,Rr,Er),Kn(xr,Ar,Er),yr=xr._dbSchema=Ar;const Sr=xn(Rr,Ar);Sr.add.forEach(Nr=>{kn(Er,Nr[0],Nr[1].primKey,Nr[1].indexes)}),Sr.change.forEach(Nr=>{if(Nr.recreate)throw new X.Upgrade("Not yet support for changing primary key");{const Cr=Er.objectStore(Nr.name);Nr.add.forEach(Tr=>En(Cr,Tr)),Nr.change.forEach(Tr=>{Cr.deleteIndex(Tr.name),En(Cr,Tr)}),Nr.del.forEach(Tr=>Cr.deleteIndex(Tr))}});const kr=wr._cfg.contentUpgrade;if(kr&&wr._cfg.version>mr){vn(xr,Er),fr._memoizedTables={},jr=!0;let Nr=w(Ar);Sr.del.forEach(Ir=>{Nr[Ir]=Rr[Ir]}),bn(xr,[xr.Transaction.prototype]),gn(xr,[xr.Transaction.prototype],t(Nr),Nr),fr.schema=Nr;const Cr=T(kr);let Tr;Cr&&et();const Pr=je.follow(()=>{if(Tr=kr(fr),Tr&&Cr){var Ir=tt.bind(null,null);Tr.then(Ir,Ir)}});return Tr&&typeof Tr.then=="function"?je.resolve(Tr):Pr.then(()=>Tr)}}),vr.push(Rr=>{(!jr||!xt)&&function(Ar,Sr){[].slice.call(Sr.db.objectStoreNames).forEach(kr=>Ar[kr]==null&&Sr.db.deleteObjectStore(kr))}(wr._cfg.dbschema,Rr),bn(xr,[xr.Transaction.prototype]),gn(xr,[xr.Transaction.prototype],xr._storeNames,xr._dbSchema),fr.schema=xr._dbSchema})}),_r().then(()=>{var wr,Rr;Rr=Er,t(wr=yr).forEach(Ar=>{Rr.db.objectStoreNames.contains(Ar)||kn(Rr,Ar,wr[Ar].primKey,wr[Ar].indexes)})})}(ar,or,dr,lr).catch(hr)})}function xn(ar,or){const lr={del:[],add:[],change:[]};let cr;for(cr in ar)or[cr]||lr.del.push(cr);for(cr in or){const ur=ar[cr],dr=or[cr];if(ur){const hr={name:cr,def:dr,recreate:!1,del:[],add:[],change:[]};if(""+(ur.primKey.keyPath||"")!=""+(dr.primKey.keyPath||"")||ur.primKey.auto!==dr.primKey.auto&&!wt)hr.recreate=!0,lr.change.push(hr);else{const pr=ur.idxByName,xr=dr.idxByName;let mr;for(mr in pr)xr[mr]||hr.del.push(mr);for(mr in xr){const fr=pr[mr],Er=xr[mr];fr?fr.src!==Er.src&&hr.change.push(Er):hr.add.push(Er)}(hr.del.length>0||hr.add.length>0||hr.change.length>0)&&lr.change.push(hr)}}else lr.add.push([cr,dr])}return lr}function kn(ar,or,lr,cr){const ur=ar.db.createObjectStore(or,lr.keyPath?{keyPath:lr.keyPath,autoIncrement:lr.auto}:{autoIncrement:lr.auto});return cr.forEach(dr=>En(ur,dr)),ur}function En(ar,or){ar.createIndex(or.name,or.keyPath,{unique:or.unique,multiEntry:or.multi})}function Pn(ar,or,lr){const cr={};return p(or.objectStoreNames,0).forEach(ur=>{const dr=lr.objectStore(ur);let hr=dr.keyPath;const pr=un(ln(hr),hr||"",!1,!1,!!dr.autoIncrement,hr&&typeof hr!="string",!0),xr=[];for(let fr=0;fr<dr.indexNames.length;++fr){const Er=dr.index(dr.indexNames[fr]);hr=Er.keyPath;var mr=un(Er.name,hr,!!Er.unique,!!Er.multiEntry,!1,hr&&typeof hr!="string",!1);xr.push(mr)}cr[ur]=cn(ur,pr,xr)}),cr}function Kn({_novip:ar},or,lr){const cr=lr.db.objectStoreNames;for(let ur=0;ur<cr.length;++ur){const dr=cr[ur],hr=lr.objectStore(dr);ar._hasGetAll="getAll"in hr;for(let pr=0;pr<hr.indexNames.length;++pr){const xr=hr.indexNames[pr],mr=hr.index(xr).keyPath,fr=typeof mr=="string"?mr:"["+p(mr).join("+")+"]";if(or[dr]){const Er=or[dr].idxByName[fr];Er&&(Er.name=xr,delete or[dr].idxByName[fr],or[dr].idxByName[xr]=Er)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&e.WorkerGlobalScope&&e instanceof e.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(ar._hasGetAll=!1)}class On{_parseStoresSpec(or,lr){t(or).forEach(cr=>{if(or[cr]!==null){var ur=or[cr].split(",").map((hr,pr)=>{const xr=(hr=hr.trim()).replace(/([&*]|\+\+)/g,""),mr=/^\[/.test(xr)?xr.match(/^\[(.*)\]$/)[1].split("+"):xr;return un(xr,mr||null,/\&/.test(hr),/\*/.test(hr),/\+\+/.test(hr),n(mr),pr===0)}),dr=ur.shift();if(dr.multi)throw new X.Schema("Primary key cannot be multi-valued");ur.forEach(hr=>{if(hr.auto)throw new X.Schema("Only primary key can be marked as autoIncrement (++)");if(!hr.keyPath)throw new X.Schema("Index must have a name and cannot be an empty string")}),lr[cr]=cn(cr,dr,ur)}})}stores(or){const lr=this.db;this._cfg.storesSource=this._cfg.storesSource?r$1(this._cfg.storesSource,or):or;const cr=lr._versions,ur={};let dr={};return cr.forEach(hr=>{r$1(ur,hr._cfg.storesSource),dr=hr._cfg.dbschema={},hr._parseStoresSpec(ur,dr)}),lr._dbSchema=dr,bn(lr,[lr._allTables,lr,lr.Transaction.prototype]),gn(lr,[lr._allTables,lr,lr.Transaction.prototype,this._cfg.tables],t(dr),dr),lr._storeNames=t(dr),this}upgrade(or){return this._cfg.contentUpgrade=ue(this._cfg.contentUpgrade||ee,or),this}}function Sn(ar,or){let lr=ar._dbNamesDB;return lr||(lr=ar._dbNamesDB=new Xn(Pt,{addons:[],indexedDB:ar,IDBKeyRange:or}),lr.version(1).stores({dbnames:"name"})),lr.table("dbnames")}function An(ar){return ar&&typeof ar.databases=="function"}function Cn(ar){return Ze(function(){return Oe.letThrough=!0,ar()})}function jn(){var ar;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(or){var lr=function(){return indexedDB.databases().finally(or)};ar=setInterval(lr,100),lr()}).finally(function(){return clearInterval(ar)}):Promise.resolve()}function Dn(ar){const or=ar._state,{indexedDB:lr}=ar._deps;if(or.isBeingOpened||ar.idbdb)return or.dbReadyPromise.then(()=>or.dbOpenError?ft(or.dbOpenError):ar);R&&(or.openCanceller._stackHolder=q()),or.isBeingOpened=!0,or.dbOpenError=null,or.openComplete=!1;const cr=or.openCanceller;function ur(){if(or.openCanceller!==cr)throw new X.DatabaseClosed("db.open() was cancelled")}let dr=or.dbReadyResolve,hr=null,pr=!1;const xr=()=>new je((mr,fr)=>{if(ur(),!lr)throw new X.MissingAPI;const Er=ar.name,vr=or.autoSchema?lr.open(Er):lr.open(Er,Math.round(10*ar.verno));if(!vr)throw new X.MissingAPI;vr.onerror=tn(fr),vr.onblocked=Ye(ar._fireOnBlocked),vr.onupgradeneeded=Ye(gr=>{if(hr=vr.transaction,or.autoSchema&&!ar._options.allowEmptyDB){vr.onerror=nn,hr.abort(),vr.result.close();const jr=lr.deleteDatabase(Er);jr.onsuccess=jr.onerror=Ye(()=>{fr(new X.NoSuchDatabase(`Database ${Er} doesnt exist`))})}else{hr.onerror=tn(fr);var yr=gr.oldVersion>Math.pow(2,62)?0:gr.oldVersion;pr=yr<1,ar._novip.idbdb=vr.result,wn(ar,yr/10,hr,fr)}},fr),vr.onsuccess=Ye(()=>{hr=null;const gr=ar._novip.idbdb=vr.result,yr=p(gr.objectStoreNames);if(yr.length>0)try{const br=gr.transaction((jr=yr).length===1?jr[0]:jr,"readonly");or.autoSchema?function({_novip:_r},wr,Rr){_r.verno=wr.version/10;const Ar=_r._dbSchema=Pn(0,wr,Rr);_r._storeNames=p(wr.objectStoreNames,0),gn(_r,[_r._allTables],t(Ar),Ar)}(ar,gr,br):(Kn(ar,ar._dbSchema,br),function(_r,wr){const Rr=xn(Pn(0,_r.idbdb,wr),_r._dbSchema);return!(Rr.add.length||Rr.change.some(Ar=>Ar.add.length||Ar.change.length))}(ar,br)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),vn(ar,br)}catch{}var jr;_t.push(ar),gr.onversionchange=Ye(br=>{or.vcFired=!0,ar.on("versionchange").fire(br)}),gr.onclose=Ye(br=>{ar.on("close").fire(br)}),pr&&function({indexedDB:br,IDBKeyRange:_r},wr){!An(br)&&wr!==Pt&&Sn(br,_r).put({name:wr}).catch(ee)}(ar._deps,Er),mr()},fr)}).catch(mr=>mr&&mr.name==="UnknownError"&&or.PR1398_maxLoop>0?(or.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),xr()):je.reject(mr));return je.race([cr,(typeof navigator>"u"?je.resolve():jn()).then(xr)]).then(()=>(ur(),or.onReadyBeingFired=[],je.resolve(Cn(()=>ar.on.ready.fire(ar.vip))).then(function mr(){if(or.onReadyBeingFired.length>0){let fr=or.onReadyBeingFired.reduce(ue,ee);return or.onReadyBeingFired=[],je.resolve(Cn(()=>fr(ar.vip))).then(mr)}}))).finally(()=>{or.onReadyBeingFired=null,or.isBeingOpened=!1}).then(()=>ar).catch(mr=>{or.dbOpenError=mr;try{hr&&hr.abort()}catch{}return cr===or.openCanceller&&ar._close(),ft(mr)}).finally(()=>{or.openComplete=!0,dr()})}function In(ar){var or=dr=>ar.next(dr),lr=ur(or),cr=ur(dr=>ar.throw(dr));function ur(dr){return hr=>{var pr=dr(hr),xr=pr.value;return pr.done?xr:xr&&typeof xr.then=="function"?xr.then(lr,cr):n(xr)?Promise.all(xr).then(lr,cr):lr(xr)}}return ur(or)()}function Bn(ar,or,lr){var cr=arguments.length;if(cr<2)throw new X.InvalidArgument("Too few arguments");for(var ur=new Array(cr-1);--cr;)ur[cr-1]=arguments[cr];return lr=ur.pop(),[ar,k(ur),lr]}function Tn(ar,or,lr,cr,ur){return je.resolve().then(()=>{const dr=Oe.transless||Oe,hr=ar._createTransaction(or,lr,ar._dbSchema,cr),pr={trans:hr,transless:dr};if(cr)hr.idbtrans=cr.idbtrans;else try{hr.create(),ar._state.PR1398_maxLoop=3}catch(Er){return Er.name===H.InvalidState&&ar.isOpen()&&--ar._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),ar._close(),ar.open().then(()=>Tn(ar,or,lr,null,ur))):ft(Er)}const xr=T(ur);let mr;xr&&et();const fr=je.follow(()=>{if(mr=ur.call(hr,hr),mr)if(xr){var Er=tt.bind(null,null);mr.then(Er,Er)}else typeof mr.next=="function"&&typeof mr.throw=="function"&&(mr=In(mr))},pr);return(mr&&typeof mr.then=="function"?je.resolve(mr).then(Er=>hr.active?Er:ft(new X.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):fr.then(()=>mr)).then(Er=>(cr&&hr._resolve(),hr._completion.then(()=>Er))).catch(Er=>(hr._reject(Er),ft(Er)))})}function Rn(ar,or,lr){const cr=n(ar)?ar.slice():[ar];for(let ur=0;ur<lr;++ur)cr.push(or);return cr}const Fn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(ar){return{...ar,table(or){const lr=ar.table(or),{schema:cr}=lr,ur={},dr=[];function hr(fr,Er,vr){const gr=yn(fr),yr=ur[gr]=ur[gr]||[],jr=fr==null?0:typeof fr=="string"?1:fr.length,br=Er>0,_r={...vr,isVirtual:br,keyTail:Er,keyLength:jr,extractKey:dn(fr),unique:!br&&vr.unique};return yr.push(_r),_r.isPrimaryKey||dr.push(_r),jr>1&&hr(jr===2?fr[0]:fr.slice(0,jr-1),Er+1,vr),yr.sort((wr,Rr)=>wr.keyTail-Rr.keyTail),_r}const pr=hr(cr.primaryKey.keyPath,0,cr.primaryKey);ur[":id"]=[pr];for(const fr of cr.indexes)hr(fr.keyPath,0,fr);function xr(fr){const Er=fr.query.index;return Er.isVirtual?{...fr,query:{index:Er,range:(vr=fr.query.range,gr=Er.keyTail,{type:vr.type===1?2:vr.type,lower:Rn(vr.lower,vr.lowerOpen?ar.MAX_KEY:ar.MIN_KEY,gr),lowerOpen:!0,upper:Rn(vr.upper,vr.upperOpen?ar.MIN_KEY:ar.MAX_KEY,gr),upperOpen:!0})}}:fr;var vr,gr}return{...lr,schema:{...cr,primaryKey:pr,indexes:dr,getIndexByKeyPath:function(fr){const Er=ur[yn(fr)];return Er&&Er[0]}},count:fr=>lr.count(xr(fr)),query:fr=>lr.query(xr(fr)),openCursor(fr){const{keyTail:Er,isVirtual:vr,keyLength:gr}=fr.query.index;return vr?lr.openCursor(xr(fr)).then(yr=>yr&&function(jr){return Object.create(jr,{continue:{value:function(_r){_r!=null?jr.continue(Rn(_r,fr.reverse?ar.MAX_KEY:ar.MIN_KEY,Er)):fr.unique?jr.continue(jr.key.slice(0,gr).concat(fr.reverse?ar.MIN_KEY:ar.MAX_KEY,Er)):jr.continue()}},continuePrimaryKey:{value(_r,wr){jr.continuePrimaryKey(Rn(_r,ar.MAX_KEY,Er),wr)}},primaryKey:{get:()=>jr.primaryKey},key:{get(){const _r=jr.key;return gr===1?_r[0]:_r.slice(0,gr)}},value:{get:()=>jr.value}})}(yr)):lr.openCursor(fr)}}}}}};function Mn(ar,or,lr,cr){return lr=lr||{},cr=cr||"",t(ar).forEach(ur=>{if(o(or,ur)){var dr=ar[ur],hr=or[ur];if(typeof dr=="object"&&typeof hr=="object"&&dr&&hr){const pr=C(dr);pr!==C(hr)?lr[cr+ur]=or[ur]:pr==="Object"?Mn(dr,hr,lr,cr+ur+"."):dr!==hr&&(lr[cr+ur]=or[ur])}else dr!==hr&&(lr[cr+ur]=or[ur])}else lr[cr+ur]=void 0}),t(or).forEach(ur=>{o(ar,ur)||(lr[cr+ur]=or[ur])}),lr}const Nn={stack:"dbcore",name:"HooksMiddleware",level:2,create:ar=>({...ar,table(or){const lr=ar.table(or),{primaryKey:cr}=lr.schema;return{...lr,mutate(dr){const hr=Oe.trans,{deleting:pr,creating:xr,updating:mr}=hr.table(or).hook;switch(dr.type){case"add":if(xr.fire===ee)break;return hr._promise("readwrite",()=>fr(dr),!0);case"put":if(xr.fire===ee&&mr.fire===ee)break;return hr._promise("readwrite",()=>fr(dr),!0);case"delete":if(pr.fire===ee)break;return hr._promise("readwrite",()=>fr(dr),!0);case"deleteRange":if(pr.fire===ee)break;return hr._promise("readwrite",()=>function(vr){return Er(vr.trans,vr.range,1e4)}(dr),!0)}return lr.mutate(dr);function fr(vr){const gr=Oe.trans,yr=vr.keys||function(jr,br){return br.type==="delete"?br.keys:br.keys||br.values.map(jr.extractKey)}(cr,vr);if(!yr)throw new Error("Keys missing");return(vr=vr.type==="add"||vr.type==="put"?{...vr,keys:yr}:{...vr}).type!=="delete"&&(vr.values=[...vr.values]),vr.keys&&(vr.keys=[...vr.keys]),function(jr,br,_r){return br.type==="add"?Promise.resolve([]):jr.getMany({trans:br.trans,keys:_r,cache:"immutable"})}(lr,vr,yr).then(jr=>{const br=yr.map((_r,wr)=>{const Rr=jr[wr],Ar={onerror:null,onsuccess:null};if(vr.type==="delete")pr.fire.call(Ar,_r,Rr,gr);else if(vr.type==="add"||Rr===void 0){const Sr=xr.fire.call(Ar,_r,vr.values[wr],gr);_r==null&&Sr!=null&&(_r=Sr,vr.keys[wr]=_r,cr.outbound||_(vr.values[wr],cr.keyPath,_r))}else{const Sr=Mn(Rr,vr.values[wr]),kr=mr.fire.call(Ar,Sr,_r,Rr,gr);if(kr){const Nr=vr.values[wr];Object.keys(kr).forEach(Cr=>{o(Nr,Cr)?Nr[Cr]=kr[Cr]:_(Nr,Cr,kr[Cr])})}}return Ar});return lr.mutate(vr).then(({failures:_r,results:wr,numFailures:Rr,lastResult:Ar})=>{for(let Sr=0;Sr<yr.length;++Sr){const kr=wr?wr[Sr]:yr[Sr],Nr=br[Sr];kr==null?Nr.onerror&&Nr.onerror(_r[Sr]):Nr.onsuccess&&Nr.onsuccess(vr.type==="put"&&jr[Sr]?vr.values[Sr]:kr)}return{failures:_r,results:wr,numFailures:Rr,lastResult:Ar}}).catch(_r=>(br.forEach(wr=>wr.onerror&&wr.onerror(_r)),Promise.reject(_r)))})}function Er(vr,gr,yr){return lr.query({trans:vr,values:!1,query:{index:cr,range:gr},limit:yr}).then(({result:jr})=>fr({type:"delete",keys:jr,trans:vr}).then(br=>br.numFailures>0?Promise.reject(br.failures[0]):jr.length<yr?{failures:[],numFailures:0,lastResult:void 0}:Er(vr,{...gr,lower:jr[jr.length-1],lowerOpen:!0},yr)))}}}}})};function qn(ar,or,lr){try{if(!or||or.keys.length<ar.length)return null;const cr=[];for(let ur=0,dr=0;ur<or.keys.length&&dr<ar.length;++ur)$t(or.keys[ur],ar[dr])===0&&(cr.push(lr?O(or.values[ur]):or.values[ur]),++dr);return cr.length===ar.length?cr:null}catch{return null}}const $n={stack:"dbcore",level:-1,create:ar=>({table:or=>{const lr=ar.table(or);return{...lr,getMany:cr=>{if(!cr.cache)return lr.getMany(cr);const ur=qn(cr.keys,cr.trans._cache,cr.cache==="clone");return ur?je.resolve(ur):lr.getMany(cr).then(dr=>(cr.trans._cache={keys:cr.keys,values:cr.cache==="clone"?O(dr):dr},dr))},mutate:cr=>(cr.type!=="add"&&(cr.trans._cache=null),lr.mutate(cr))}}})};function Un(ar){return!("from"in ar)}const Ln=function(ar,or){if(!this){const lr=new Ln;return ar&&"d"in ar&&r$1(lr,ar),lr}r$1(this,arguments.length?{d:1,from:ar,to:arguments.length>1?or:ar}:{d:0})};function Vn(ar,or,lr){const cr=$t(or,lr);if(isNaN(cr))return;if(cr>0)throw RangeError();if(Un(ar))return r$1(ar,{from:or,to:lr,d:1});const ur=ar.l,dr=ar.r;if($t(lr,ar.from)<0)return ur?Vn(ur,or,lr):ar.l={from:or,to:lr,d:1,l:null,r:null},Gn(ar);if($t(or,ar.to)>0)return dr?Vn(dr,or,lr):ar.r={from:or,to:lr,d:1,l:null,r:null},Gn(ar);$t(or,ar.from)<0&&(ar.from=or,ar.l=null,ar.d=dr?dr.d+1:1),$t(lr,ar.to)>0&&(ar.to=lr,ar.r=null,ar.d=ar.l?ar.l.d+1:1);const hr=!ar.r;ur&&!ar.l&&Wn(ar,ur),dr&&hr&&Wn(ar,dr)}function Wn(ar,or){Un(or)||function lr(cr,{from:ur,to:dr,l:hr,r:pr}){Vn(cr,ur,dr),hr&&lr(cr,hr),pr&&lr(cr,pr)}(ar,or)}function Yn(ar,or){const lr=zn(or);let cr=lr.next();if(cr.done)return!1;let ur=cr.value;const dr=zn(ar);let hr=dr.next(ur.from),pr=hr.value;for(;!cr.done&&!hr.done;){if($t(pr.from,ur.to)<=0&&$t(pr.to,ur.from)>=0)return!0;$t(ur.from,pr.from)<0?ur=(cr=lr.next(pr.from)).value:pr=(hr=dr.next(ur.from)).value}return!1}function zn(ar){let or=Un(ar)?null:{s:0,n:ar};return{next(lr){const cr=arguments.length>0;for(;or;)switch(or.s){case 0:if(or.s=1,cr)for(;or.n.l&&$t(lr,or.n.from)<0;)or={up:or,n:or.n.l,s:1};else for(;or.n.l;)or={up:or,n:or.n.l,s:1};case 1:if(or.s=2,!cr||$t(lr,or.n.to)<=0)return{value:or.n,done:!1};case 2:if(or.n.r){or.s=3,or={up:or,n:or.n.r,s:0};continue}case 3:or=or.up}return{done:!0}}}}function Gn(ar){var or,lr;const cr=(((or=ar.r)===null||or===void 0?void 0:or.d)||0)-(((lr=ar.l)===null||lr===void 0?void 0:lr.d)||0),ur=cr>1?"r":cr<-1?"l":"";if(ur){const dr=ur==="r"?"l":"r",hr={...ar},pr=ar[ur];ar.from=pr.from,ar.to=pr.to,ar[ur]=pr[ur],hr[ur]=pr[dr],ar[dr]=hr,hr.d=Hn(hr)}ar.d=Hn(ar)}function Hn({r:ar,l:or}){return(ar?or?Math.max(ar.d,or.d):ar.d:or?or.d:0)+1}a(Ln.prototype,{add(ar){return Wn(this,ar),this},addKey(ar){return Vn(this,ar,ar),this},addKeys(ar){return ar.forEach(or=>Vn(this,or,or)),this},[j](){return zn(this)}});const Qn={stack:"dbcore",level:0,create:ar=>{const or=ar.schema.name,lr=new Ln(ar.MIN_KEY,ar.MAX_KEY);return{...ar,table:cr=>{const ur=ar.table(cr),{schema:dr}=ur,{primaryKey:hr}=dr,{extractKey:pr,outbound:xr}=hr,mr={...ur,mutate:vr=>{const gr=vr.trans,yr=gr.mutatedParts||(gr.mutatedParts={}),jr=kr=>{const Nr=`idb://${or}/${cr}/${kr}`;return yr[Nr]||(yr[Nr]=new Ln)},br=jr(""),_r=jr(":dels"),{type:wr}=vr;let[Rr,Ar]=vr.type==="deleteRange"?[vr.range]:vr.type==="delete"?[vr.keys]:vr.values.length<50?[[],vr.values]:[];const Sr=vr.trans._cache;return ur.mutate(vr).then(kr=>{if(n(Rr)){wr!=="delete"&&(Rr=kr.results),br.addKeys(Rr);const Nr=qn(Rr,Sr);Nr||wr==="add"||_r.addKeys(Rr),(Nr||Ar)&&function(Cr,Tr,Pr,Ir){function Br(Wr){const Yr=Cr(Wr.name||"");function es(ts){return ts!=null?Wr.extractKey(ts):null}const ps=ts=>Wr.multiEntry&&n(ts)?ts.forEach(Qr=>Yr.addKey(Qr)):Yr.addKey(ts);(Pr||Ir).forEach((ts,Qr)=>{const Hr=Pr&&es(Pr[Qr]),Kr=Ir&&es(Ir[Qr]);$t(Hr,Kr)!==0&&(Hr!=null&&ps(Hr),Kr!=null&&ps(Kr))})}Tr.indexes.forEach(Br)}(jr,dr,Nr,Ar)}else if(Rr){const Nr={from:Rr.lower,to:Rr.upper};_r.add(Nr),br.add(Nr)}else br.add(lr),_r.add(lr),dr.indexes.forEach(Nr=>jr(Nr.name).add(lr));return kr})}},fr=({query:{index:vr,range:gr}})=>{var yr,jr;return[vr,new Ln((yr=gr.lower)!==null&&yr!==void 0?yr:ar.MIN_KEY,(jr=gr.upper)!==null&&jr!==void 0?jr:ar.MAX_KEY)]},Er={get:vr=>[hr,new Ln(vr.key)],getMany:vr=>[hr,new Ln().addKeys(vr.keys)],count:fr,query:fr,openCursor:fr};return t(Er).forEach(vr=>{mr[vr]=function(gr){const{subscr:yr}=Oe;if(yr){const jr=Ar=>{const Sr=`idb://${or}/${cr}/${Ar}`;return yr[Sr]||(yr[Sr]=new Ln)},br=jr(""),_r=jr(":dels"),[wr,Rr]=Er[vr](gr);if(jr(wr.name||"").add(Rr),!wr.isPrimaryKey){if(vr!=="count"){const Ar=vr==="query"&&xr&&gr.values&&ur.query({...gr,values:!1});return ur[vr].apply(this,arguments).then(Sr=>{if(vr==="query"){if(xr&&gr.values)return Ar.then(({result:Nr})=>(br.addKeys(Nr),Sr));const kr=gr.values?Sr.result.map(pr):Sr.result;gr.values?br.addKeys(kr):_r.addKeys(kr)}else if(vr==="openCursor"){const kr=Sr,Nr=gr.values;return kr&&Object.create(kr,{key:{get:()=>(_r.addKey(kr.primaryKey),kr.key)},primaryKey:{get(){const Cr=kr.primaryKey;return _r.addKey(Cr),Cr}},value:{get:()=>(Nr&&br.addKey(kr.primaryKey),kr.value)}})}return Sr})}_r.add(lr)}}return ur[vr].apply(this,arguments)}}),mr}}}};class Xn{constructor(or,lr){this._middlewares={},this.verno=0;const cr=Xn.dependencies;this._options=lr={addons:Xn.addons,autoOpen:!0,indexedDB:cr.indexedDB,IDBKeyRange:cr.IDBKeyRange,...lr},this._deps={indexedDB:lr.indexedDB,IDBKeyRange:lr.IDBKeyRange};const{addons:ur}=lr;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const dr={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ee,dbReadyPromise:null,cancelOpen:ee,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var hr;dr.dbReadyPromise=new je(pr=>{dr.dbReadyResolve=pr}),dr.openCanceller=new je((pr,xr)=>{dr.cancelOpen=xr}),this._state=dr,this.name=or,this.on=Dt(this,"populate","blocked","versionchange","close",{ready:[ue,ee]}),this.on.ready.subscribe=y(this.on.ready.subscribe,pr=>(xr,mr)=>{Xn.vip(()=>{const fr=this._state;if(fr.openComplete)fr.dbOpenError||je.resolve().then(xr),mr&&pr(xr);else if(fr.onReadyBeingFired)fr.onReadyBeingFired.push(xr),mr&&pr(xr);else{pr(xr);const Er=this;mr||pr(function vr(){Er.on.ready.unsubscribe(xr),Er.on.ready.unsubscribe(vr)})}})}),this.Collection=(hr=this,It(Vt.prototype,function(pr,xr){this.db=hr;let mr=At,fr=null;if(xr)try{mr=xr()}catch(yr){fr=yr}const Er=pr._ctx,vr=Er.table,gr=vr.hook.reading.fire;this._ctx={table:vr,index:Er.index,isPrimKey:!Er.index||vr.schema.primKey.keyPath&&Er.index===vr.schema.primKey.name,range:mr,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:fr,or:Er.or,valueMapper:gr!==te?gr:null}})),this.Table=function(pr){return It(jt.prototype,function(xr,mr,fr){this.db=pr,this._tx=fr,this.name=xr,this.schema=mr,this.hook=pr._allTables[xr]?pr._allTables[xr].hook:Dt(null,{creating:[se,ee],reading:[ne,te],updating:[oe,ee],deleting:[ie,ee]})})}(this),this.Transaction=function(pr){return It(an.prototype,function(xr,mr,fr,Er,vr){this.db=pr,this.mode=xr,this.storeNames=mr,this.schema=fr,this.chromeTransactionDurability=Er,this.idbtrans=null,this.on=Dt(this,"complete","error","abort"),this.parent=vr||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new je((gr,yr)=>{this._resolve=gr,this._reject=yr}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},gr=>{var yr=this.active;return this.active=!1,this.on.error.fire(gr),this.parent?this.parent._reject(gr):yr&&this.idbtrans&&this.idbtrans.abort(),ft(gr)})})}(this),this.Version=function(pr){return It(On.prototype,function(xr){this.db=pr,this._cfg={version:xr,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(pr){return It(en.prototype,function(xr,mr,fr){this.db=pr,this._ctx={table:xr,index:mr===":id"?null:mr,or:fr};const Er=pr._deps.indexedDB;if(!Er)throw new X.MissingAPI;this._cmp=this._ascending=Er.cmp.bind(Er),this._descending=(vr,gr)=>Er.cmp(gr,vr),this._max=(vr,gr)=>Er.cmp(vr,gr)>0?vr:gr,this._min=(vr,gr)=>Er.cmp(vr,gr)<0?vr:gr,this._IDBKeyRange=pr._deps.IDBKeyRange})}(this),this.on("versionchange",pr=>{pr.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",pr=>{!pr.newVersion||pr.newVersion<pr.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${pr.oldVersion/10}`)}),this._maxKey=hn(lr.IDBKeyRange),this._createTransaction=(pr,xr,mr,fr)=>new this.Transaction(pr,xr,mr,this._options.chromeTransactionDurability,fr),this._fireOnBlocked=pr=>{this.on("blocked").fire(pr),_t.filter(xr=>xr.name===this.name&&xr!==this&&!xr._state.vcFired).map(xr=>xr.on("versionchange").fire(pr))},this.use(Fn),this.use(Nn),this.use(Qn),this.use($n),this.vip=Object.create(this,{_vip:{value:!0}}),ur.forEach(pr=>pr(this))}version(or){if(isNaN(or)||or<.1)throw new X.Type("Given version is not a positive number");if(or=Math.round(10*or)/10,this.idbdb||this._state.isBeingOpened)throw new X.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,or);const lr=this._versions;var cr=lr.filter(ur=>ur._cfg.version===or)[0];return cr||(cr=new this.Version(or),lr.push(cr),lr.sort(_n),cr.stores({}),this._state.autoSchema=!1,cr)}_whenReady(or){return this.idbdb&&(this._state.openComplete||Oe.letThrough||this._vip)?or():new je((lr,cr)=>{if(this._state.openComplete)return cr(new X.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void cr(new X.DatabaseClosed);this.open().catch(ee)}this._state.dbReadyPromise.then(lr,cr)}).then(or)}use({stack:or,create:lr,level:cr,name:ur}){ur&&this.unuse({stack:or,name:ur});const dr=this._middlewares[or]||(this._middlewares[or]=[]);return dr.push({stack:or,create:lr,level:cr??10,name:ur}),dr.sort((hr,pr)=>hr.level-pr.level),this}unuse({stack:or,name:lr,create:cr}){return or&&this._middlewares[or]&&(this._middlewares[or]=this._middlewares[or].filter(ur=>cr?ur.create!==cr:!!lr&&ur.name!==lr)),this}open(){return Dn(this)}_close(){const or=this._state,lr=_t.indexOf(this);if(lr>=0&&_t.splice(lr,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}or.dbReadyPromise=new je(cr=>{or.dbReadyResolve=cr}),or.openCanceller=new je((cr,ur)=>{or.cancelOpen=ur})}close(){this._close();const or=this._state;this._options.autoOpen=!1,or.dbOpenError=new X.DatabaseClosed,or.isBeingOpened&&or.cancelOpen(or.dbOpenError)}delete(){const or=arguments.length>0,lr=this._state;return new je((cr,ur)=>{const dr=()=>{this.close();var hr=this._deps.indexedDB.deleteDatabase(this.name);hr.onsuccess=Ye(()=>{(function({indexedDB:pr,IDBKeyRange:xr},mr){!An(pr)&&mr!==Pt&&Sn(pr,xr).delete(mr).catch(ee)})(this._deps,this.name),cr()}),hr.onerror=tn(ur),hr.onblocked=this._fireOnBlocked};if(or)throw new X.InvalidArgument("Arguments not allowed in db.delete()");lr.isBeingOpened?lr.dbReadyPromise.then(dr):dr()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const or=this._state.dbOpenError;return or&&or.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return t(this._allTables).map(or=>this._allTables[or])}transaction(){const or=Bn.apply(this,arguments);return this._transaction.apply(this,or)}_transaction(or,lr,cr){let ur=Oe.trans;ur&&ur.db===this&&or.indexOf("!")===-1||(ur=null);const dr=or.indexOf("?")!==-1;let hr,pr;or=or.replace("!","").replace("?","");try{if(pr=lr.map(mr=>{var fr=mr instanceof this.Table?mr.name:mr;if(typeof fr!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return fr}),or=="r"||or===Kt)hr=Kt;else{if(or!="rw"&&or!=Ot)throw new X.InvalidArgument("Invalid transaction mode: "+or);hr=Ot}if(ur){if(ur.mode===Kt&&hr===Ot){if(!dr)throw new X.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");ur=null}ur&&pr.forEach(mr=>{if(ur&&ur.storeNames.indexOf(mr)===-1){if(!dr)throw new X.SubTransaction("Table "+mr+" not included in parent transaction.");ur=null}}),dr&&ur&&!ur.active&&(ur=null)}}catch(mr){return ur?ur._promise(null,(fr,Er)=>{Er(mr)}):ft(mr)}const xr=Tn.bind(null,this,hr,pr,ur,cr);return ur?ur._promise(hr,xr,"lock"):Oe.trans?at(Oe.transless,()=>this._whenReady(xr)):this._whenReady(xr)}table(or){if(!o(this._allTables,or))throw new X.InvalidTable(`Table ${or} does not exist`);return this._allTables[or]}}const Jn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Zn{constructor(or){this._subscribe=or}subscribe(or,lr,cr){return this._subscribe(or&&typeof or!="function"?or:{next:or,error:lr,complete:cr})}[Jn](){return this}}function er(ar,or){return t(or).forEach(lr=>{Wn(ar[lr]||(ar[lr]=new Ln),or[lr])}),ar}function tr(ar){let or,lr=!1;const cr=new Zn(ur=>{const dr=T(ar);let hr=!1,pr={},xr={};const mr={get closed(){return hr},unsubscribe:()=>{hr=!0,on.storagemutated.unsubscribe(gr)}};ur.start&&ur.start(mr);let fr=!1,Er=!1;function vr(){return t(xr).some(jr=>pr[jr]&&Yn(pr[jr],xr[jr]))}const gr=jr=>{er(pr,jr),vr()&&yr()},yr=()=>{if(fr||hr)return;pr={};const jr={},br=function(_r){dr&&et();const wr=()=>Ze(ar,{subscr:_r,trans:null}),Rr=Oe.trans?at(Oe.transless,wr):wr();return dr&&Rr.then(tt,tt),Rr}(jr);Er||(on(rn,gr),Er=!0),fr=!0,Promise.resolve(br).then(_r=>{lr=!0,or=_r,fr=!1,hr||(vr()?yr():(pr={},xr=jr,ur.next&&ur.next(_r)))},_r=>{fr=!1,lr=!1,ur.error&&ur.error(_r),mr.unsubscribe()})};return yr(),mr});return cr.hasValue=()=>lr,cr.getValue=()=>or,cr}let nr;try{nr={indexedDB:e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:e.IDBKeyRange||e.webkitIDBKeyRange}}catch{nr={indexedDB:null,IDBKeyRange:null}}const rr=Xn;function sr(ar){let or=ir;try{ir=!0,on.storagemutated.fire(ar)}finally{ir=or}}a(rr,{...Z,delete:ar=>new rr(ar,{addons:[]}).delete(),exists:ar=>new rr(ar,{addons:[]}).open().then(or=>(or.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(ar){try{return function({indexedDB:or,IDBKeyRange:lr}){return An(or)?Promise.resolve(or.databases()).then(cr=>cr.map(ur=>ur.name).filter(ur=>ur!==Pt)):Sn(or,lr).toCollection().primaryKeys()}(rr.dependencies).then(ar)}catch{return ft(new X.MissingAPI)}},defineClass:()=>function(ar){r$1(this,ar)},ignoreTransaction:ar=>Oe.trans?at(Oe.transless,ar):ar(),vip:Cn,async:function(ar){return function(){try{var or=In(ar.apply(this,arguments));return or&&typeof or.then=="function"?or:je.resolve(or)}catch(lr){return ft(lr)}}},spawn:function(ar,or,lr){try{var cr=In(ar.apply(lr,or||[]));return cr&&typeof cr.then=="function"?cr:je.resolve(cr)}catch(ur){return ft(ur)}},currentTransaction:{get:()=>Oe.trans||null},waitFor:function(ar,or){const lr=je.resolve(typeof ar=="function"?rr.ignoreTransaction(ar):ar).timeout(or||6e4);return Oe.trans?Oe.trans.waitFor(lr):lr},Promise:je,debug:{get:()=>R,set:ar=>{F(ar,ar==="dexie"?()=>!0:Et)}},derive:c,extend:r$1,props:a,override:y,Events:Dt,on,liveQuery:tr,extendObservabilitySet:er,getByKeyPath:b,setByKeyPath:_,delByKeyPath:function(ar,or){typeof or=="string"?_(ar,or,void 0):"length"in or&&[].map.call(or,function(lr){_(ar,lr,void 0)})},shallowClone:w,deepClone:O,getObjectDiff:Mn,cmp:$t,asap:v,minKey:vt,addons:[],connections:_t,errnames:H,dependencies:nr,semVer:yt,version:yt.split(".").map(ar=>parseInt(ar)).reduce((ar,or,lr)=>ar+or/Math.pow(10,2*lr))}),rr.maxKey=hn(rr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(on(rn,ar=>{if(!ir){let or;wt?(or=document.createEvent("CustomEvent"),or.initCustomEvent(sn,!0,!0,ar)):or=new CustomEvent(sn,{detail:ar}),ir=!0,dispatchEvent(or),ir=!1}}),addEventListener(sn,({detail:ar})=>{ir||sr(ar)}));let ir=!1;if(typeof BroadcastChannel<"u"){const ar=new BroadcastChannel(sn);typeof ar.unref=="function"&&ar.unref(),on(rn,or=>{ir||ar.postMessage(or)}),ar.onmessage=or=>{or.data&&sr(or.data)}}else if(typeof self<"u"&&typeof navigator<"u"){on(rn,or=>{try{ir||(typeof localStorage<"u"&&localStorage.setItem(sn,JSON.stringify({trig:Math.random(),changedParts:or})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(lr=>lr.postMessage({type:sn,changedParts:or})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",or=>{if(or.key===sn){const lr=JSON.parse(or.newValue);lr&&sr(lr.changedParts)}});const ar=self.document&&navigator.serviceWorker;ar&&ar.addEventListener("message",function({data:or}){or&&or.type===sn&&sr(or.changedParts)})}je.rejectionMapper=function(ar,or){if(!ar||ar instanceof W||ar instanceof TypeError||ar instanceof SyntaxError||!ar.name||!J[ar.name])return ar;var lr=new J[ar.name](or||ar.message,ar);return"stack"in ar&&l(lr,"stack",{get:function(){return this.inner.stack}}),lr},F(R,Et);class HairMakeupDB extends Xn{constructor(){super("HairMakeupProDB");io(this,"projects");io(this,"scenes");io(this,"characters");io(this,"looks");io(this,"sceneCaptures");io(this,"photoBlobs");io(this,"storeBackups");this.version(1).stores({projects:"id, name, createdAt, updatedAt",scenes:"id, sceneNumber, slugline, isComplete",characters:"id, name",looks:"id, characterId, name",sceneCaptures:"id, sceneId, characterId, lookId, capturedAt",photos:"id, capturedAt, angle"}),this.version(2).stores({projects:"id, updatedAt",scenes:"id, sceneNumber, slugline, isComplete",characters:"id, name",looks:"id, characterId, name",sceneCaptures:"id, projectId, sceneId, characterId, updatedAt",photoBlobs:"id, capturedAt, angle",storeBackups:"id, updatedAt",photos:null}).upgrade(async()=>{console.log("Migrating database to version 2 with blob storage")})}}const db=new HairMakeupDB;async function savePhotoBlob(ar,or,lr,cr){return await db.photoBlobs.put({id:ar,blob:or,thumbnail:lr,capturedAt:new Date,angle:cr}),ar}async function getPhotoBlob(ar){return await db.photoBlobs.get(ar)}async function saveStoreBackup(ar,or){await db.storeBackups.put({id:ar,state:or,updatedAt:new Date})}async function getStoreBackup(ar){const or=await db.storeBackups.get(ar);return or==null?void 0:or.state}const debounceTimers={},pendingWrites={},DEBOUNCE_DELAY=500,INDEXEDDB_STORES=new Set(["hair-makeup-pro-storage","hair-makeup-callsheets","hair-makeup-schedule","hair-makeup-timesheet-storage"]);function debouncedWrite(ar,or,lr){pendingWrites[ar]=or,debounceTimers[ar]&&clearTimeout(debounceTimers[ar]),debounceTimers[ar]=setTimeout(async()=>{const cr=pendingWrites[ar];delete pendingWrites[ar],delete debounceTimers[ar];try{await lr(ar,cr)}catch(ur){console.error(`Failed to write store ${ar}:`,ur)}},DEBOUNCE_DELAY)}async function flushPendingWrites(){const ar=[];for(const[or,lr]of Object.entries(pendingWrites))if(debounceTimers[or]&&(clearTimeout(debounceTimers[or]),delete debounceTimers[or]),INDEXEDDB_STORES.has(or))ar.push(saveStoreBackup(or,lr).catch(cr=>console.error(`Failed to flush store ${or}:`,cr)));else try{localStorage.setItem(or,JSON.stringify(lr))}catch(cr){console.error(`Failed to flush store ${or} to localStorage:`,cr)}Object.keys(pendingWrites).forEach(or=>delete pendingWrites[or]),await Promise.all(ar)}function createHybridStorage(ar){const or=INDEXEDDB_STORES.has(ar);return{getItem:async lr=>{if(or)try{await db.open();const cr=await getStoreBackup(lr);if(cr)return cr;const ur=localStorage.getItem(lr);return ur?JSON.parse(ur):null}catch(cr){console.error(`Failed to read store ${lr} from IndexedDB:`,cr);const ur=localStorage.getItem(lr);return ur?JSON.parse(ur):null}else{const cr=localStorage.getItem(lr);return cr?JSON.parse(cr):null}},setItem:(lr,cr)=>{or?debouncedWrite(lr,cr,async(ur,dr)=>{try{localStorage.setItem(ur,JSON.stringify(dr))}catch{}await saveStoreBackup(ur,dr)}):debouncedWrite(lr,cr,async(ur,dr)=>{localStorage.setItem(ur,JSON.stringify(dr))})},removeItem:async lr=>{if(debounceTimers[lr]&&(clearTimeout(debounceTimers[lr]),delete debounceTimers[lr]),delete pendingWrites[lr],or)try{await db.storeBackups.delete(lr)}catch(cr){console.error(`Failed to remove store ${lr} from IndexedDB:`,cr)}localStorage.removeItem(lr)}}}async function migrateToIndexedDB(){const ar=[],or=[];await db.open();for(const lr of INDEXEDDB_STORES)try{const cr=localStorage.getItem(lr);if(cr&&!await getStoreBackup(lr)){const dr=JSON.parse(cr);await saveStoreBackup(lr,dr),ar.push(lr),localStorage.removeItem(lr)}}catch(cr){console.error(`Failed to migrate store ${lr}:`,cr),or.push(lr)}return{migrated:ar,errors:or}}typeof window<"u"&&(window.addEventListener("beforeunload",()=>{for(const[ar,or]of Object.entries(pendingWrites))try{localStorage.setItem(ar,JSON.stringify(or))}catch{}}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&flushPendingWrites().catch(()=>{})}));function commonjsRequire(ar){throw new Error('Could not dynamically require "'+ar+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports$1){(function(or,lr){module.exports=or.pdfjsLib=lr()})(globalThis,()=>(()=>{var __webpack_modules__=[,(ar,or)=>{var no;Object.defineProperty(or,"__esModule",{value:!0}),or.VerbosityLevel=or.Util=or.UnknownErrorException=or.UnexpectedResponseException=or.TextRenderingMode=or.RenderingIntentFlag=or.PromiseCapability=or.PermissionFlag=or.PasswordResponses=or.PasswordException=or.PageActionEventType=or.OPS=or.MissingPDFException=or.MAX_IMAGE_SIZE_TO_CACHE=or.LINE_FACTOR=or.LINE_DESCENT_FACTOR=or.InvalidPDFException=or.ImageKind=or.IDENTITY_MATRIX=or.FormatError=or.FeatureTest=or.FONT_IDENTITY_MATRIX=or.DocumentActionEventType=or.CMapCompressionType=or.BaseException=or.BASELINE_FACTOR=or.AnnotationType=or.AnnotationReplyType=or.AnnotationPrefix=or.AnnotationMode=or.AnnotationFlag=or.AnnotationFieldFlag=or.AnnotationEditorType=or.AnnotationEditorPrefix=or.AnnotationEditorParamsType=or.AnnotationBorderStyleType=or.AnnotationActionEventType=or.AbortException=void 0,or.assert=Hr,or.bytesToString=ls,or.createValidAbsoluteUrl=rs,or.getModificationDate=Us,or.getUuid=ga,or.getVerbosityLevel=es,or.info=ps,or.isArrayBuffer=gs,or.isArrayEqual=Hs,or.isNodeJS=void 0,or.normalizeUnicode=Js,or.objectFromMap=Is,or.objectSize=ws,or.setVerbosityLevel=Yr,or.shadow=Mr,or.string32=bs,or.stringToBytes=ds,or.stringToPDFString=Es,or.stringToUTF8String=Ns,or.unreachable=Qr,or.utf8StringToString=Ts,or.warn=ts;const lr=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");or.isNodeJS=lr;const cr=[1,0,0,1,0,0];or.IDENTITY_MATRIX=cr;const ur=[.001,0,0,.001,0,0];or.FONT_IDENTITY_MATRIX=ur;const dr=1e7;or.MAX_IMAGE_SIZE_TO_CACHE=dr;const hr=1.35;or.LINE_FACTOR=hr;const pr=.35;or.LINE_DESCENT_FACTOR=pr;const xr=pr/hr;or.BASELINE_FACTOR=xr;const mr={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};or.RenderingIntentFlag=mr;const fr={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};or.AnnotationMode=fr;const Er="pdfjs_internal_editor_";or.AnnotationEditorPrefix=Er;const vr={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};or.AnnotationEditorType=vr;const gr={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};or.AnnotationEditorParamsType=gr;const yr={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};or.PermissionFlag=yr;const jr={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};or.TextRenderingMode=jr;const br={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};or.ImageKind=br;const _r={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};or.AnnotationType=_r;const wr={GROUP:"Group",REPLY:"R"};or.AnnotationReplyType=wr;const Rr={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};or.AnnotationFlag=Rr;const Ar={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};or.AnnotationFieldFlag=Ar;const Sr={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};or.AnnotationBorderStyleType=Sr;const kr={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};or.AnnotationActionEventType=kr;const Nr={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};or.DocumentActionEventType=Nr;const Cr={O:"PageOpen",C:"PageClose"};or.PageActionEventType=Cr;const Tr={ERRORS:0,WARNINGS:1,INFOS:5};or.VerbosityLevel=Tr;const Pr={NONE:0,BINARY:1};or.CMapCompressionType=Pr;const Ir={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};or.OPS=Ir;const Br={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};or.PasswordResponses=Br;let Wr=Tr.WARNINGS;function Yr($s){Number.isInteger($s)&&(Wr=$s)}function es(){return Wr}function ps($s){Wr>=Tr.INFOS&&console.log(`Info: ${$s}`)}function ts($s){Wr>=Tr.WARNINGS&&console.log(`Warning: ${$s}`)}function Qr($s){throw new Error($s)}function Hr($s,Rs){$s||Qr(Rs)}function Kr($s){switch($s==null?void 0:$s.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function rs($s,Rs=null,ks=null){if(!$s)return null;try{if(ks&&typeof $s=="string"){if(ks.addDefaultProtocol&&$s.startsWith("www.")){const to=$s.match(/\./g);(to==null?void 0:to.length)>=2&&($s=`http://${$s}`)}if(ks.tryConvertEncoding)try{$s=Ns($s)}catch{}}const qs=Rs?new URL($s,Rs):new URL($s);if(Kr(qs))return qs}catch{}return null}function Mr($s,Rs,ks,qs=!1){return Object.defineProperty($s,Rs,{value:ks,enumerable:!qs,configurable:!0,writable:!1}),ks}const Dr=function(){function Rs(ks,qs){this.constructor===Rs&&Qr("Cannot initialize BaseException."),this.message=ks,this.name=qs}return Rs.prototype=new Error,Rs.constructor=Rs,Rs}();or.BaseException=Dr;class Lr extends Dr{constructor(Rs,ks){super(Rs,"PasswordException"),this.code=ks}}or.PasswordException=Lr;class Fr extends Dr{constructor(Rs,ks){super(Rs,"UnknownErrorException"),this.details=ks}}or.UnknownErrorException=Fr;class $r extends Dr{constructor(Rs){super(Rs,"InvalidPDFException")}}or.InvalidPDFException=$r;class Vr extends Dr{constructor(Rs){super(Rs,"MissingPDFException")}}or.MissingPDFException=Vr;class Gr extends Dr{constructor(Rs,ks){super(Rs,"UnexpectedResponseException"),this.status=ks}}or.UnexpectedResponseException=Gr;class Jr extends Dr{constructor(Rs){super(Rs,"FormatError")}}or.FormatError=Jr;class ms extends Dr{constructor(Rs){super(Rs,"AbortException")}}or.AbortException=ms;function ls($s){(typeof $s!="object"||($s==null?void 0:$s.length)===void 0)&&Qr("Invalid argument for bytesToString");const Rs=$s.length,ks=8192;if(Rs<ks)return String.fromCharCode.apply(null,$s);const qs=[];for(let to=0;to<Rs;to+=ks){const eo=Math.min(to+ks,Rs),fs=$s.subarray(to,eo);qs.push(String.fromCharCode.apply(null,fs))}return qs.join("")}function ds($s){typeof $s!="string"&&Qr("Invalid argument for stringToBytes");const Rs=$s.length,ks=new Uint8Array(Rs);for(let qs=0;qs<Rs;++qs)ks[qs]=$s.charCodeAt(qs)&255;return ks}function bs($s){return String.fromCharCode($s>>24&255,$s>>16&255,$s>>8&255,$s&255)}function ws($s){return Object.keys($s).length}function Is($s){const Rs=Object.create(null);for(const[ks,qs]of $s)Rs[ks]=qs;return Rs}function ys(){const $s=new Uint8Array(4);return $s[0]=1,new Uint32Array($s.buffer,0,1)[0]===1}function ss(){try{return new Function(""),!0}catch{return!1}}class Ur{static get isLittleEndian(){return Mr(this,"isLittleEndian",ys())}static get isEvalSupported(){return Mr(this,"isEvalSupported",ss())}static get isOffscreenCanvasSupported(){return Mr(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?Mr(this,"platform",{isWin:!1,isMac:!1}):Mr(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var Rs,ks;return Mr(this,"isCSSRoundSupported",(ks=(Rs=globalThis.CSS)==null?void 0:Rs.supports)==null?void 0:ks.call(Rs,"width: round(1.5px, 1px)"))}}or.FeatureTest=Ur;const Xr=[...Array(256).keys()].map($s=>$s.toString(16).padStart(2,"0"));class cs{static makeHexColor(Rs,ks,qs){return`#${Xr[Rs]}${Xr[ks]}${Xr[qs]}`}static scaleMinMax(Rs,ks){let qs;Rs[0]?(Rs[0]<0&&(qs=ks[0],ks[0]=ks[1],ks[1]=qs),ks[0]*=Rs[0],ks[1]*=Rs[0],Rs[3]<0&&(qs=ks[2],ks[2]=ks[3],ks[3]=qs),ks[2]*=Rs[3],ks[3]*=Rs[3]):(qs=ks[0],ks[0]=ks[2],ks[2]=qs,qs=ks[1],ks[1]=ks[3],ks[3]=qs,Rs[1]<0&&(qs=ks[2],ks[2]=ks[3],ks[3]=qs),ks[2]*=Rs[1],ks[3]*=Rs[1],Rs[2]<0&&(qs=ks[0],ks[0]=ks[1],ks[1]=qs),ks[0]*=Rs[2],ks[1]*=Rs[2]),ks[0]+=Rs[4],ks[1]+=Rs[4],ks[2]+=Rs[5],ks[3]+=Rs[5]}static transform(Rs,ks){return[Rs[0]*ks[0]+Rs[2]*ks[1],Rs[1]*ks[0]+Rs[3]*ks[1],Rs[0]*ks[2]+Rs[2]*ks[3],Rs[1]*ks[2]+Rs[3]*ks[3],Rs[0]*ks[4]+Rs[2]*ks[5]+Rs[4],Rs[1]*ks[4]+Rs[3]*ks[5]+Rs[5]]}static applyTransform(Rs,ks){const qs=Rs[0]*ks[0]+Rs[1]*ks[2]+ks[4],to=Rs[0]*ks[1]+Rs[1]*ks[3]+ks[5];return[qs,to]}static applyInverseTransform(Rs,ks){const qs=ks[0]*ks[3]-ks[1]*ks[2],to=(Rs[0]*ks[3]-Rs[1]*ks[2]+ks[2]*ks[5]-ks[4]*ks[3])/qs,eo=(-Rs[0]*ks[1]+Rs[1]*ks[0]+ks[4]*ks[1]-ks[5]*ks[0])/qs;return[to,eo]}static getAxialAlignedBoundingBox(Rs,ks){const qs=this.applyTransform(Rs,ks),to=this.applyTransform(Rs.slice(2,4),ks),eo=this.applyTransform([Rs[0],Rs[3]],ks),fs=this.applyTransform([Rs[2],Rs[1]],ks);return[Math.min(qs[0],to[0],eo[0],fs[0]),Math.min(qs[1],to[1],eo[1],fs[1]),Math.max(qs[0],to[0],eo[0],fs[0]),Math.max(qs[1],to[1],eo[1],fs[1])]}static inverseTransform(Rs){const ks=Rs[0]*Rs[3]-Rs[1]*Rs[2];return[Rs[3]/ks,-Rs[1]/ks,-Rs[2]/ks,Rs[0]/ks,(Rs[2]*Rs[5]-Rs[4]*Rs[3])/ks,(Rs[4]*Rs[1]-Rs[5]*Rs[0])/ks]}static singularValueDecompose2dScale(Rs){const ks=[Rs[0],Rs[2],Rs[1],Rs[3]],qs=Rs[0]*ks[0]+Rs[1]*ks[2],to=Rs[0]*ks[1]+Rs[1]*ks[3],eo=Rs[2]*ks[0]+Rs[3]*ks[2],fs=Rs[2]*ks[1]+Rs[3]*ks[3],Os=(qs+fs)/2,zs=Math.sqrt((qs+fs)**2-4*(qs*fs-eo*to))/2,Zs=Os+zs||1,na=Os-zs||1;return[Math.sqrt(Zs),Math.sqrt(na)]}static normalizeRect(Rs){const ks=Rs.slice(0);return Rs[0]>Rs[2]&&(ks[0]=Rs[2],ks[2]=Rs[0]),Rs[1]>Rs[3]&&(ks[1]=Rs[3],ks[3]=Rs[1]),ks}static intersect(Rs,ks){const qs=Math.max(Math.min(Rs[0],Rs[2]),Math.min(ks[0],ks[2])),to=Math.min(Math.max(Rs[0],Rs[2]),Math.max(ks[0],ks[2]));if(qs>to)return null;const eo=Math.max(Math.min(Rs[1],Rs[3]),Math.min(ks[1],ks[3])),fs=Math.min(Math.max(Rs[1],Rs[3]),Math.max(ks[1],ks[3]));return eo>fs?null:[qs,eo,to,fs]}static bezierBoundingBox(Rs,ks,qs,to,eo,fs,Os,zs){const Zs=[],na=[[],[]];let Ys,hs,as,vs,Ls,Ds,Bs,Ws;for(let os=0;os<2;++os){if(os===0?(hs=6*Rs-12*qs+6*eo,Ys=-3*Rs+9*qs-9*eo+3*Os,as=3*qs-3*Rs):(hs=6*ks-12*to+6*fs,Ys=-3*ks+9*to-9*fs+3*zs,as=3*to-3*ks),Math.abs(Ys)<1e-12){if(Math.abs(hs)<1e-12)continue;vs=-as/hs,0<vs&&vs<1&&Zs.push(vs);continue}Bs=hs*hs-4*as*Ys,Ws=Math.sqrt(Bs),!(Bs<0)&&(Ls=(-hs+Ws)/(2*Ys),0<Ls&&Ls<1&&Zs.push(Ls),Ds=(-hs-Ws)/(2*Ys),0<Ds&&Ds<1&&Zs.push(Ds))}let _i=Zs.length,Qs;const zr=_i;for(;_i--;)vs=Zs[_i],Qs=1-vs,na[0][_i]=Qs*Qs*Qs*Rs+3*Qs*Qs*vs*qs+3*Qs*vs*vs*eo+vs*vs*vs*Os,na[1][_i]=Qs*Qs*Qs*ks+3*Qs*Qs*vs*to+3*Qs*vs*vs*fs+vs*vs*vs*zs;return na[0][zr]=Rs,na[1][zr]=ks,na[0][zr+1]=Os,na[1][zr+1]=zs,na[0].length=na[1].length=zr+2,[Math.min(...na[0]),Math.min(...na[1]),Math.max(...na[0]),Math.max(...na[1])]}}or.Util=cs;const xs=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Es($s){if($s[0]>=""){let ks;if($s[0]===""&&$s[1]===""?ks="utf-16be":$s[0]===""&&$s[1]===""?ks="utf-16le":$s[0]===""&&$s[1]===""&&$s[2]===""&&(ks="utf-8"),ks)try{const qs=new TextDecoder(ks,{fatal:!0}),to=ds($s);return qs.decode(to)}catch(qs){ts(`stringToPDFString: "${qs}".`)}}const Rs=[];for(let ks=0,qs=$s.length;ks<qs;ks++){const to=xs[$s.charCodeAt(ks)];Rs.push(to?String.fromCharCode(to):$s.charAt(ks))}return Rs.join("")}function Ns($s){return decodeURIComponent(escape($s))}function Ts($s){return unescape(encodeURIComponent($s))}function gs($s){return typeof $s=="object"&&($s==null?void 0:$s.byteLength)!==void 0}function Hs($s,Rs){if($s.length!==Rs.length)return!1;for(let ks=0,qs=$s.length;ks<qs;ks++)if($s[ks]!==Rs[ks])return!1;return!0}function Us($s=new Date){return[$s.getUTCFullYear().toString(),($s.getUTCMonth()+1).toString().padStart(2,"0"),$s.getUTCDate().toString().padStart(2,"0"),$s.getUTCHours().toString().padStart(2,"0"),$s.getUTCMinutes().toString().padStart(2,"0"),$s.getUTCSeconds().toString().padStart(2,"0")].join("")}class xa{constructor(){Ss(this,no,!1);this.promise=new Promise((Rs,ks)=>{this.resolve=qs=>{Cs(this,no,!0),Rs(qs)},this.reject=qs=>{Cs(this,no,!0),ks(qs)}})}get settled(){return Or(this,no)}}no=new WeakMap,or.PromiseCapability=xa;let Gs=null,$a=null;function Js($s){return Gs||(Gs=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,$a=new Map([["","t"]])),$s.replaceAll(Gs,(Rs,ks,qs)=>ks?ks.normalize("NFKC"):$a.get(qs))}function ga(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const $s=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues($s);else for(let Rs=0;Rs<32;Rs++)$s[Rs]=Math.floor(Math.random()*255);return ls($s)}const ro="pdfjs_internal_id_";or.AnnotationPrefix=ro},(__unused_webpack_module,exports$1,__w_pdfjs_require__)=>{var ar,lr,cr,ur,mo,Ao,pr,xr,mr,fr,Er,vr,gr,yr,jr,Po,_r,wr,Xo,Ar,Sr;Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.RenderTask=exports$1.PDFWorkerUtil=exports$1.PDFWorker=exports$1.PDFPageProxy=exports$1.PDFDocumentProxy=exports$1.PDFDocumentLoadingTask=exports$1.PDFDataRangeTransport=exports$1.LoopbackPort=exports$1.DefaultStandardFontDataFactory=exports$1.DefaultFilterFactory=exports$1.DefaultCanvasFactory=exports$1.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports$1,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports$1.build=void 0,exports$1.getDocument=getDocument,exports$1.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports$1.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports$1.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(Nr){if(typeof Nr=="string"||Nr instanceof URL?Nr={url:Nr}:(0,_util.isArrayBuffer)(Nr)&&(Nr={data:Nr}),typeof Nr!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!Nr.url&&!Nr.data&&!Nr.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const Cr=new PDFDocumentLoadingTask,{docId:Tr}=Cr,Pr=Nr.url?getUrlProp(Nr.url):null,Ir=Nr.data?getDataProp(Nr.data):null,Br=Nr.httpHeaders||null,Wr=Nr.withCredentials===!0,Yr=Nr.password??null,es=Nr.range instanceof PDFDataRangeTransport?Nr.range:null,ps=Number.isInteger(Nr.rangeChunkSize)&&Nr.rangeChunkSize>0?Nr.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let ts=Nr.worker instanceof PDFWorker?Nr.worker:null;const Qr=Nr.verbosity,Hr=typeof Nr.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(Nr.docBaseUrl)?Nr.docBaseUrl:null,Kr=typeof Nr.cMapUrl=="string"?Nr.cMapUrl:null,rs=Nr.cMapPacked!==!1,Mr=Nr.CMapReaderFactory||DefaultCMapReaderFactory,Dr=typeof Nr.standardFontDataUrl=="string"?Nr.standardFontDataUrl:null,Lr=Nr.StandardFontDataFactory||DefaultStandardFontDataFactory,Fr=Nr.stopAtErrors!==!0,$r=Number.isInteger(Nr.maxImageSize)&&Nr.maxImageSize>-1?Nr.maxImageSize:-1,Vr=Nr.isEvalSupported!==!1,Gr=typeof Nr.isOffscreenCanvasSupported=="boolean"?Nr.isOffscreenCanvasSupported:!_util.isNodeJS,Jr=Number.isInteger(Nr.canvasMaxAreaInBytes)?Nr.canvasMaxAreaInBytes:-1,ms=typeof Nr.disableFontFace=="boolean"?Nr.disableFontFace:_util.isNodeJS,ls=Nr.fontExtraProperties===!0,ds=Nr.enableXfa===!0,bs=Nr.ownerDocument||globalThis.document,ws=Nr.disableRange===!0,Is=Nr.disableStream===!0,ys=Nr.disableAutoFetch===!0,ss=Nr.pdfBug===!0,Ur=es?es.length:Nr.length??NaN,Xr=typeof Nr.useSystemFonts=="boolean"?Nr.useSystemFonts:!_util.isNodeJS&&!ms,cs=typeof Nr.useWorkerFetch=="boolean"?Nr.useWorkerFetch:Mr===_display_utils.DOMCMapReaderFactory&&Lr===_display_utils.DOMStandardFontDataFactory&&Kr&&Dr&&(0,_display_utils.isValidFetchUrl)(Kr,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(Dr,document.baseURI),xs=Nr.canvasFactory||new DefaultCanvasFactory({ownerDocument:bs}),Es=Nr.filterFactory||new DefaultFilterFactory({docId:Tr,ownerDocument:bs}),Ns=null;(0,_util.setVerbosityLevel)(Qr);const Ts={canvasFactory:xs,filterFactory:Es};if(cs||(Ts.cMapReaderFactory=new Mr({baseUrl:Kr,isCompressed:rs}),Ts.standardFontDataFactory=new Lr({baseUrl:Dr})),!ts){const Us={verbosity:Qr,port:_worker_options.GlobalWorkerOptions.workerPort};ts=Us.port?PDFWorker.fromPort(Us):new PDFWorker(Us),Cr._worker=ts}const gs={docId:Tr,apiVersion:"3.11.174",data:Ir,password:Yr,disableAutoFetch:ys,rangeChunkSize:ps,length:Ur,docBaseUrl:Hr,enableXfa:ds,evaluatorOptions:{maxImageSize:$r,disableFontFace:ms,ignoreErrors:Fr,isEvalSupported:Vr,isOffscreenCanvasSupported:Gr,canvasMaxAreaInBytes:Jr,fontExtraProperties:ls,useSystemFonts:Xr,cMapUrl:cs?Kr:null,standardFontDataUrl:cs?Dr:null}},Hs={ignoreErrors:Fr,isEvalSupported:Vr,disableFontFace:ms,fontExtraProperties:ls,enableXfa:ds,ownerDocument:bs,disableAutoFetch:ys,pdfBug:ss,styleElement:Ns};return ts.promise.then(function(){if(Cr.destroyed)throw new Error("Loading aborted");const Us=_fetchDocument(ts,gs),xa=new Promise(function(Gs){let $a;es?$a=new _transport_stream.PDFDataTransportStream({length:Ur,initialData:es.initialData,progressiveDone:es.progressiveDone,contentDispositionFilename:es.contentDispositionFilename,disableRange:ws,disableStream:Is},es):Ir||($a=(ga=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(ga):(0,_display_utils.isValidFetchUrl)(ga.url)?new _displayFetch_stream.PDFFetchStream(ga):new _displayNetwork.PDFNetworkStream(ga))({url:Pr,length:Ur,httpHeaders:Br,withCredentials:Wr,rangeChunkSize:ps,disableRange:ws,disableStream:Is})),Gs($a)});return Promise.all([Us,xa]).then(function([Gs,$a]){if(Cr.destroyed)throw new Error("Loading aborted");const Js=new _message_handler.MessageHandler(Tr,Gs,ts.port),ga=new WorkerTransport(Js,Cr,$a,Hs,Ts);Cr._transport=ga,Js.send("Ready",null)})}).catch(Cr._capability.reject),Cr}async function _fetchDocument(Nr,Cr){if(Nr.destroyed)throw new Error("Worker was destroyed");const Tr=await Nr.messageHandler.sendWithPromise("GetDocRequest",Cr,Cr.data?[Cr.data.buffer]:null);if(Nr.destroyed)throw new Error("Worker was destroyed");return Tr}function getUrlProp(Nr){if(Nr instanceof URL)return Nr.href;try{return new URL(Nr,window.location).href}catch{if(_util.isNodeJS&&typeof Nr=="string")return Nr}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(Nr){if(_util.isNodeJS&&typeof Buffer<"u"&&Nr instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(Nr instanceof Uint8Array&&Nr.byteLength===Nr.buffer.byteLength)return Nr;if(typeof Nr=="string")return(0,_util.stringToBytes)(Nr);if(typeof Nr=="object"&&!isNaN(Nr==null?void 0:Nr.length)||(0,_util.isArrayBuffer)(Nr))return new Uint8Array(Nr);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const or=class or{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${wo(or,ar)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var Cr,Tr,Pr;this.destroyed=!0;try{(Cr=this._worker)!=null&&Cr.port&&(this._worker._pendingDestroy=!0),await((Tr=this._transport)==null?void 0:Tr.destroy())}catch(Ir){throw(Pr=this._worker)!=null&&Pr.port&&delete this._worker._pendingDestroy,Ir}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};ar=new WeakMap,Ss(or,ar,0);let PDFDocumentLoadingTask=or;exports$1.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(Cr,Tr,Pr=!1,Ir=null){this.length=Cr,this.initialData=Tr,this.progressiveDone=Pr,this.contentDispositionFilename=Ir,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(Cr){this._rangeListeners.push(Cr)}addProgressListener(Cr){this._progressListeners.push(Cr)}addProgressiveReadListener(Cr){this._progressiveReadListeners.push(Cr)}addProgressiveDoneListener(Cr){this._progressiveDoneListeners.push(Cr)}onDataRange(Cr,Tr){for(const Pr of this._rangeListeners)Pr(Cr,Tr)}onDataProgress(Cr,Tr){this._readyCapability.promise.then(()=>{for(const Pr of this._progressListeners)Pr(Cr,Tr)})}onDataProgressiveRead(Cr){this._readyCapability.promise.then(()=>{for(const Tr of this._progressiveReadListeners)Tr(Cr)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const Cr of this._progressiveDoneListeners)Cr()})}transportReady(){this._readyCapability.resolve()}requestDataRange(Cr,Tr){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports$1.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(Cr,Tr){this._pdfInfo=Cr,this._transport=Tr,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(Pr=>{if(!Pr)return Pr;const Ir=[];for(const Br in Pr)Ir.push(...Pr[Br]);return Ir}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(Cr){return this._transport.getPage(Cr)}getPageIndex(Cr){return this._transport.getPageIndex(Cr)}getDestinations(){return this._transport.getDestinations()}getDestination(Cr){return this._transport.getDestination(Cr)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(Cr=!1){return this._transport.startCleanup(Cr||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports$1.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(Cr,Tr,Pr,Ir=!1){Ss(this,ur);Ss(this,lr,null);Ss(this,cr,!1);this._pageIndex=Cr,this._pageInfo=Tr,this._transport=Pr,this._stats=Ir?new _display_utils.StatTimer:null,this._pdfBug=Ir,this.commonObjs=Pr.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:Cr,rotation:Tr=this.rotate,offsetX:Pr=0,offsetY:Ir=0,dontFlip:Br=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:Cr,rotation:Tr,offsetX:Pr,offsetY:Ir,dontFlip:Br})}getAnnotations({intent:Cr="display"}={}){const Tr=this._transport.getRenderingIntent(Cr);return this._transport.getAnnotations(this._pageIndex,Tr.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var Cr;return((Cr=this._transport._htmlForXfa)==null?void 0:Cr.children[this._pageIndex])||null}render({canvasContext:Cr,viewport:Tr,intent:Pr="display",annotationMode:Ir=_util.AnnotationMode.ENABLE,transform:Br=null,background:Wr=null,optionalContentConfigPromise:Yr=null,annotationCanvasMap:es=null,pageColors:ps=null,printAnnotationStorage:ts=null}){var Lr,Fr;(Lr=this._stats)==null||Lr.time("Overall");const Qr=this._transport.getRenderingIntent(Pr,Ir,ts);Cs(this,cr,!1),js(this,ur,Ao).call(this),Yr||(Yr=this._transport.getOptionalContentConfig());let Hr=this._intentStates.get(Qr.cacheKey);Hr||(Hr=Object.create(null),this._intentStates.set(Qr.cacheKey,Hr)),Hr.streamReaderCancelTimeout&&(clearTimeout(Hr.streamReaderCancelTimeout),Hr.streamReaderCancelTimeout=null);const Kr=!!(Qr.renderingIntent&_util.RenderingIntentFlag.PRINT);Hr.displayReadyCapability||(Hr.displayReadyCapability=new _util.PromiseCapability,Hr.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Fr=this._stats)==null||Fr.time("Page Request"),this._pumpOperatorList(Qr));const rs=$r=>{var Vr,Gr;Hr.renderTasks.delete(Mr),(this._maybeCleanupAfterRender||Kr)&&Cs(this,cr,!0),js(this,ur,mo).call(this,!Kr),$r?(Mr.capability.reject($r),this._abortOperatorList({intentState:Hr,reason:$r instanceof Error?$r:new Error($r)})):Mr.capability.resolve(),(Vr=this._stats)==null||Vr.timeEnd("Rendering"),(Gr=this._stats)==null||Gr.timeEnd("Overall")},Mr=new InternalRenderTask({callback:rs,params:{canvasContext:Cr,viewport:Tr,transform:Br,background:Wr},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:es,operatorList:Hr.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Kr,pdfBug:this._pdfBug,pageColors:ps});(Hr.renderTasks||(Hr.renderTasks=new Set)).add(Mr);const Dr=Mr.task;return Promise.all([Hr.displayReadyCapability.promise,Yr]).then(([$r,Vr])=>{var Gr;if(this.destroyed){rs();return}(Gr=this._stats)==null||Gr.time("Rendering"),Mr.initializeGraphics({transparency:$r,optionalContentConfig:Vr}),Mr.operatorListChanged()}).catch(rs),Dr}getOperatorList({intent:Cr="display",annotationMode:Tr=_util.AnnotationMode.ENABLE,printAnnotationStorage:Pr=null}={}){var es;function Ir(){Wr.operatorList.lastChunk&&(Wr.opListReadCapability.resolve(Wr.operatorList),Wr.renderTasks.delete(Yr))}const Br=this._transport.getRenderingIntent(Cr,Tr,Pr,!0);let Wr=this._intentStates.get(Br.cacheKey);Wr||(Wr=Object.create(null),this._intentStates.set(Br.cacheKey,Wr));let Yr;return Wr.opListReadCapability||(Yr=Object.create(null),Yr.operatorListChanged=Ir,Wr.opListReadCapability=new _util.PromiseCapability,(Wr.renderTasks||(Wr.renderTasks=new Set)).add(Yr),Wr.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(es=this._stats)==null||es.time("Page Request"),this._pumpOperatorList(Br)),Wr.opListReadCapability.promise}streamTextContent({includeMarkedContent:Cr=!1,disableNormalization:Tr=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:Cr===!0,disableNormalization:Tr===!0},{highWaterMark:100,size(Ir){return Ir.items.length}})}getTextContent(Cr={}){if(this._transport._htmlForXfa)return this.getXfa().then(Pr=>_xfa_text.XfaText.textContent(Pr));const Tr=this.streamTextContent(Cr);return new Promise(function(Pr,Ir){function Br(){Wr.read().then(function({value:es,done:ps}){if(ps){Pr(Yr);return}Object.assign(Yr.styles,es.styles),Yr.items.push(...es.items),Br()},Ir)}const Wr=Tr.getReader(),Yr={items:[],styles:Object.create(null)};Br()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const Cr=[];for(const Tr of this._intentStates.values())if(this._abortOperatorList({intentState:Tr,reason:new Error("Page was destroyed."),force:!0}),!Tr.opListReadCapability)for(const Pr of Tr.renderTasks)Cr.push(Pr.completed),Pr.cancel();return this.objs.clear(),Cs(this,cr,!1),js(this,ur,Ao).call(this),Promise.all(Cr)}cleanup(Cr=!1){Cs(this,cr,!0);const Tr=js(this,ur,mo).call(this,!1);return Cr&&Tr&&this._stats&&(this._stats=new _display_utils.StatTimer),Tr}_startRenderPage(Cr,Tr){var Ir,Br;const Pr=this._intentStates.get(Tr);Pr&&((Ir=this._stats)==null||Ir.timeEnd("Page Request"),(Br=Pr.displayReadyCapability)==null||Br.resolve(Cr))}_renderPageChunk(Cr,Tr){for(let Pr=0,Ir=Cr.length;Pr<Ir;Pr++)Tr.operatorList.fnArray.push(Cr.fnArray[Pr]),Tr.operatorList.argsArray.push(Cr.argsArray[Pr]);Tr.operatorList.lastChunk=Cr.lastChunk,Tr.operatorList.separateAnnots=Cr.separateAnnots;for(const Pr of Tr.renderTasks)Pr.operatorListChanged();Cr.lastChunk&&js(this,ur,mo).call(this,!0)}_pumpOperatorList({renderingIntent:Cr,cacheKey:Tr,annotationStorageSerializable:Pr}){const{map:Ir,transfers:Br}=Pr,Yr=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:Cr,cacheKey:Tr,annotationStorage:Ir},Br).getReader(),es=this._intentStates.get(Tr);es.streamReader=Yr;const ps=()=>{Yr.read().then(({value:ts,done:Qr})=>{if(Qr){es.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(ts,es),ps())},ts=>{if(es.streamReader=null,!this._transport.destroyed){if(es.operatorList){es.operatorList.lastChunk=!0;for(const Qr of es.renderTasks)Qr.operatorListChanged();js(this,ur,mo).call(this,!0)}if(es.displayReadyCapability)es.displayReadyCapability.reject(ts);else if(es.opListReadCapability)es.opListReadCapability.reject(ts);else throw ts}})};ps()}_abortOperatorList({intentState:Cr,reason:Tr,force:Pr=!1}){if(Cr.streamReader){if(Cr.streamReaderCancelTimeout&&(clearTimeout(Cr.streamReaderCancelTimeout),Cr.streamReaderCancelTimeout=null),!Pr){if(Cr.renderTasks.size>0)return;if(Tr instanceof _display_utils.RenderingCancelledException){let Ir=RENDERING_CANCELLED_TIMEOUT;Tr.extraDelay>0&&Tr.extraDelay<1e3&&(Ir+=Tr.extraDelay),Cr.streamReaderCancelTimeout=setTimeout(()=>{Cr.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:Cr,reason:Tr,force:!0})},Ir);return}}if(Cr.streamReader.cancel(new _util.AbortException(Tr.message)).catch(()=>{}),Cr.streamReader=null,!this._transport.destroyed){for(const[Ir,Br]of this._intentStates)if(Br===Cr){this._intentStates.delete(Ir);break}this.cleanup()}}}get stats(){return this._stats}}lr=new WeakMap,cr=new WeakMap,ur=new WeakSet,mo=function(Cr=!1){if(js(this,ur,Ao).call(this),!Or(this,cr)||this.destroyed)return!1;if(Cr)return Cs(this,lr,setTimeout(()=>{Cs(this,lr,null),js(this,ur,mo).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:Tr,operatorList:Pr}of this._intentStates.values())if(Tr.size>0||!Pr.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),Cs(this,cr,!1),!0},Ao=function(){Or(this,lr)&&(clearTimeout(Or(this,lr)),Cs(this,lr,null))},exports$1.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Ss(this,pr,new Set);Ss(this,xr,Promise.resolve())}postMessage(Cr,Tr){const Pr={data:structuredClone(Cr,Tr?{transfer:Tr}:null)};Or(this,xr).then(()=>{for(const Ir of Or(this,pr))Ir.call(this,Pr)})}addEventListener(Cr,Tr){Or(this,pr).add(Tr)}removeEventListener(Cr,Tr){Or(this,pr).delete(Tr)}terminate(){Or(this,pr).clear()}}pr=new WeakMap,xr=new WeakMap,exports$1.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports$1.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const Nr=(mr=document==null?void 0:document.currentScript)==null?void 0:mr.src;Nr&&(PDFWorkerUtil.fallbackWorkerSrc=Nr.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(Nr,Cr){let Tr;try{if(Tr=new URL(Nr),!Tr.origin||Tr.origin==="null")return!1}catch{return!1}const Pr=new URL(Cr,Tr);return Tr.origin===Pr.origin},PDFWorkerUtil.createCDNWrapper=function(Nr){const Cr=`importScripts("${Nr}");`;return URL.createObjectURL(new Blob([Cr]))}}const _PDFWorker=class _PDFWorker{constructor({name:Nr=null,port:Cr=null,verbosity:Tr=(0,_util.getVerbosityLevel)()}={}){var Pr;if(this.name=Nr,this.destroyed=!1,this.verbosity=Tr,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,Cr){if((Pr=Or(_PDFWorker,fr))!=null&&Pr.has(Cr))throw new Error("Cannot use more than one PDFWorker per port.");(Or(_PDFWorker,fr)||Cs(_PDFWorker,fr,new WeakMap)).set(Cr,this),this._initializeFromPort(Cr);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(Nr){this._port=Nr,this._messageHandler=new _message_handler.MessageHandler("main","worker",Nr),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:Nr}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,Nr)||(Nr=PDFWorkerUtil.createCDNWrapper(new URL(Nr,window.location).href));const Cr=new Worker(Nr),Tr=new _message_handler.MessageHandler("main","worker",Cr),Pr=()=>{Cr.removeEventListener("error",Ir),Tr.destroy(),Cr.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},Ir=()=>{this._webWorker||Pr()};Cr.addEventListener("error",Ir),Tr.on("test",Wr=>{if(Cr.removeEventListener("error",Ir),this.destroyed){Pr();return}Wr?(this._messageHandler=Tr,this._port=Cr,this._webWorker=Cr,this._readyCapability.resolve(),Tr.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),Tr.destroy(),Cr.terminate())}),Tr.on("ready",Wr=>{if(Cr.removeEventListener("error",Ir),this.destroyed){Pr();return}try{Br()}catch{this._setupFakeWorker()}});const Br=()=>{const Wr=new Uint8Array;Tr.send("test",Wr,[Wr.buffer])};Br();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(Nr=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const Cr=new LoopbackPort;this._port=Cr;const Tr=`fake${PDFWorkerUtil.fakeWorkerId++}`,Pr=new _message_handler.MessageHandler(Tr+"_worker",Tr,Cr);Nr.setup(Pr,Cr);const Ir=new _message_handler.MessageHandler(Tr,Tr+"_worker",Cr);this._messageHandler=Ir,this._readyCapability.resolve(),Ir.send("configure",{verbosity:this.verbosity})}).catch(Nr=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${Nr.message}".`))})}destroy(){var Nr;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(Nr=Or(_PDFWorker,fr))==null||Nr.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(Nr){var Tr;if(!(Nr!=null&&Nr.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const Cr=(Tr=Or(this,fr))==null?void 0:Tr.get(Nr.port);if(Cr){if(Cr._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return Cr}return new _PDFWorker(Nr)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var Nr;try{return((Nr=globalThis.pdfjsWorker)==null?void 0:Nr.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};fr=new WeakMap,Ss(_PDFWorker,fr);let PDFWorker=_PDFWorker;exports$1.PDFWorker=PDFWorker;class WorkerTransport{constructor(Cr,Tr,Pr,Ir,Br){Ss(this,jr);Ss(this,Er,new Map);Ss(this,vr,new Map);Ss(this,gr,new Map);Ss(this,yr,null);this.messageHandler=Cr,this.loadingTask=Tr,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:Ir.ownerDocument,styleElement:Ir.styleElement}),this._params=Ir,this.canvasFactory=Br.canvasFactory,this.filterFactory=Br.filterFactory,this.cMapReaderFactory=Br.cMapReaderFactory,this.standardFontDataFactory=Br.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=Pr,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(Cr,Tr=_util.AnnotationMode.ENABLE,Pr=null,Ir=!1){let Br=_util.RenderingIntentFlag.DISPLAY,Wr=_annotation_storage.SerializableEmpty;switch(Cr){case"any":Br=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":Br=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${Cr}`)}switch(Tr){case _util.AnnotationMode.DISABLE:Br+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:Br+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:Br+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,Wr=(Br&_util.RenderingIntentFlag.PRINT&&Pr instanceof _annotation_storage.PrintAnnotationStorage?Pr:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${Tr}`)}return Ir&&(Br+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:Br,cacheKey:`${Br}_${Wr.hash}`,annotationStorageSerializable:Wr}}destroy(){var Pr;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(Pr=Or(this,yr))==null||Pr.reject(new Error("Worker was destroyed during onPassword callback"));const Cr=[];for(const Ir of Or(this,vr).values())Cr.push(Ir._destroy());Or(this,vr).clear(),Or(this,gr).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const Tr=this.messageHandler.sendWithPromise("Terminate",null);return Cr.push(Tr),Promise.all(Cr).then(()=>{var Ir;this.commonObjs.clear(),this.fontLoader.clear(),Or(this,Er).clear(),this.filterFactory.destroy(),(Ir=this._networkStream)==null||Ir.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:Cr,loadingTask:Tr}=this;Cr.on("GetReader",(Pr,Ir)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=Br=>{this._lastProgress={loaded:Br.loaded,total:Br.total}},Ir.onPull=()=>{this._fullReader.read().then(function({value:Br,done:Wr}){if(Wr){Ir.close();return}(0,_util.assert)(Br instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),Ir.enqueue(new Uint8Array(Br),1,[Br])}).catch(Br=>{Ir.error(Br)})},Ir.onCancel=Br=>{this._fullReader.cancel(Br),Ir.ready.catch(Wr=>{if(!this.destroyed)throw Wr})}}),Cr.on("ReaderHeadersReady",Pr=>{const Ir=new _util.PromiseCapability,Br=this._fullReader;return Br.headersReady.then(()=>{var Wr;(!Br.isStreamingSupported||!Br.isRangeSupported)&&(this._lastProgress&&((Wr=Tr.onProgress)==null||Wr.call(Tr,this._lastProgress)),Br.onProgress=Yr=>{var es;(es=Tr.onProgress)==null||es.call(Tr,{loaded:Yr.loaded,total:Yr.total})}),Ir.resolve({isStreamingSupported:Br.isStreamingSupported,isRangeSupported:Br.isRangeSupported,contentLength:Br.contentLength})},Ir.reject),Ir.promise}),Cr.on("GetRangeReader",(Pr,Ir)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const Br=this._networkStream.getRangeReader(Pr.begin,Pr.end);if(!Br){Ir.close();return}Ir.onPull=()=>{Br.read().then(function({value:Wr,done:Yr}){if(Yr){Ir.close();return}(0,_util.assert)(Wr instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),Ir.enqueue(new Uint8Array(Wr),1,[Wr])}).catch(Wr=>{Ir.error(Wr)})},Ir.onCancel=Wr=>{Br.cancel(Wr),Ir.ready.catch(Yr=>{if(!this.destroyed)throw Yr})}}),Cr.on("GetDoc",({pdfInfo:Pr})=>{this._numPages=Pr.numPages,this._htmlForXfa=Pr.htmlForXfa,delete Pr.htmlForXfa,Tr._capability.resolve(new PDFDocumentProxy(Pr,this))}),Cr.on("DocException",function(Pr){let Ir;switch(Pr.name){case"PasswordException":Ir=new _util.PasswordException(Pr.message,Pr.code);break;case"InvalidPDFException":Ir=new _util.InvalidPDFException(Pr.message);break;case"MissingPDFException":Ir=new _util.MissingPDFException(Pr.message);break;case"UnexpectedResponseException":Ir=new _util.UnexpectedResponseException(Pr.message,Pr.status);break;case"UnknownErrorException":Ir=new _util.UnknownErrorException(Pr.message,Pr.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}Tr._capability.reject(Ir)}),Cr.on("PasswordRequest",Pr=>{if(Cs(this,yr,new _util.PromiseCapability),Tr.onPassword){const Ir=Br=>{Br instanceof Error?Or(this,yr).reject(Br):Or(this,yr).resolve({password:Br})};try{Tr.onPassword(Ir,Pr.code)}catch(Br){Or(this,yr).reject(Br)}}else Or(this,yr).reject(new _util.PasswordException(Pr.message,Pr.code));return Or(this,yr).promise}),Cr.on("DataLoaded",Pr=>{var Ir;(Ir=Tr.onProgress)==null||Ir.call(Tr,{loaded:Pr.length,total:Pr.length}),this.downloadInfoCapability.resolve(Pr)}),Cr.on("StartRenderPage",Pr=>{if(this.destroyed)return;Or(this,vr).get(Pr.pageIndex)._startRenderPage(Pr.transparency,Pr.cacheKey)}),Cr.on("commonobj",([Pr,Ir,Br])=>{var Wr;if(!this.destroyed&&!this.commonObjs.has(Pr))switch(Ir){case"Font":const Yr=this._params;if("error"in Br){const ts=Br.error;(0,_util.warn)(`Error during font loading: ${ts}`),this.commonObjs.resolve(Pr,ts);break}const es=Yr.pdfBug&&((Wr=globalThis.FontInspector)!=null&&Wr.enabled)?(ts,Qr)=>globalThis.FontInspector.fontAdded(ts,Qr):null,ps=new _font_loader.FontFaceObject(Br,{isEvalSupported:Yr.isEvalSupported,disableFontFace:Yr.disableFontFace,ignoreErrors:Yr.ignoreErrors,inspectFont:es});this.fontLoader.bind(ps).catch(ts=>Cr.sendWithPromise("FontFallback",{id:Pr})).finally(()=>{!Yr.fontExtraProperties&&ps.data&&(ps.data=null),this.commonObjs.resolve(Pr,ps)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(Pr,Br);break;default:throw new Error(`Got unknown common object type ${Ir}`)}}),Cr.on("obj",([Pr,Ir,Br,Wr])=>{var es;if(this.destroyed)return;const Yr=Or(this,vr).get(Ir);if(!Yr.objs.has(Pr))switch(Br){case"Image":if(Yr.objs.resolve(Pr,Wr),Wr){let ps;if(Wr.bitmap){const{width:ts,height:Qr}=Wr;ps=ts*Qr*4}else ps=((es=Wr.data)==null?void 0:es.length)||0;ps>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Yr._maybeCleanupAfterRender=!0)}break;case"Pattern":Yr.objs.resolve(Pr,Wr);break;default:throw new Error(`Got unknown object type ${Br}`)}}),Cr.on("DocProgress",Pr=>{var Ir;this.destroyed||(Ir=Tr.onProgress)==null||Ir.call(Tr,{loaded:Pr.loaded,total:Pr.total})}),Cr.on("FetchBuiltInCMap",Pr=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(Pr):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),Cr.on("FetchStandardFontData",Pr=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(Pr):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var Pr;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:Cr,transfers:Tr}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:Cr,filename:((Pr=this._fullReader)==null?void 0:Pr.filename)??null},Tr).finally(()=>{this.annotationStorage.resetModified()})}getPage(Cr){if(!Number.isInteger(Cr)||Cr<=0||Cr>this._numPages)return Promise.reject(new Error("Invalid page request."));const Tr=Cr-1,Pr=Or(this,gr).get(Tr);if(Pr)return Pr;const Ir=this.messageHandler.sendWithPromise("GetPage",{pageIndex:Tr}).then(Br=>{if(this.destroyed)throw new Error("Transport destroyed");const Wr=new PDFPageProxy(Tr,Br,this,this._params.pdfBug);return Or(this,vr).set(Tr,Wr),Wr});return Or(this,gr).set(Tr,Ir),Ir}getPageIndex(Cr){return typeof Cr!="object"||Cr===null||!Number.isInteger(Cr.num)||Cr.num<0||!Number.isInteger(Cr.gen)||Cr.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:Cr.num,gen:Cr.gen})}getAnnotations(Cr,Tr){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:Cr,intent:Tr})}getFieldObjects(){return js(this,jr,Po).call(this,"GetFieldObjects")}hasJSActions(){return js(this,jr,Po).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(Cr){return typeof Cr!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:Cr})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return js(this,jr,Po).call(this,"GetDocJSActions")}getPageJSActions(Cr){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:Cr})}getStructTree(Cr){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:Cr})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(Cr=>new _optional_content_config.OptionalContentConfig(Cr))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const Cr="GetMetadata",Tr=Or(this,Er).get(Cr);if(Tr)return Tr;const Pr=this.messageHandler.sendWithPromise(Cr,null).then(Ir=>{var Br,Wr;return{info:Ir[0],metadata:Ir[1]?new _metadata.Metadata(Ir[1]):null,contentDispositionFilename:((Br=this._fullReader)==null?void 0:Br.filename)??null,contentLength:((Wr=this._fullReader)==null?void 0:Wr.contentLength)??null}});return Or(this,Er).set(Cr,Pr),Pr}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(Cr=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const Tr of Or(this,vr).values())if(!Tr.cleanup())throw new Error(`startCleanup: Page ${Tr.pageNumber} is currently rendering.`);this.commonObjs.clear(),Cr||this.fontLoader.clear(),Or(this,Er).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:Cr,enableXfa:Tr}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:Cr,enableXfa:Tr})}}Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,jr=new WeakSet,Po=function(Cr,Tr=null){const Pr=Or(this,Er).get(Cr);if(Pr)return Pr;const Ir=this.messageHandler.sendWithPromise(Cr,Tr);return Or(this,Er).set(Cr,Ir),Ir};class PDFObjects{constructor(){Ss(this,wr);Ss(this,_r,Object.create(null))}get(Cr,Tr=null){if(Tr){const Ir=js(this,wr,Xo).call(this,Cr);return Ir.capability.promise.then(()=>Tr(Ir.data)),null}const Pr=Or(this,_r)[Cr];if(!(Pr!=null&&Pr.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${Cr}.`);return Pr.data}has(Cr){const Tr=Or(this,_r)[Cr];return(Tr==null?void 0:Tr.capability.settled)||!1}resolve(Cr,Tr=null){const Pr=js(this,wr,Xo).call(this,Cr);Pr.data=Tr,Pr.capability.resolve()}clear(){var Cr;for(const Tr in Or(this,_r)){const{data:Pr}=Or(this,_r)[Tr];(Cr=Pr==null?void 0:Pr.bitmap)==null||Cr.close()}Cs(this,_r,Object.create(null))}}_r=new WeakMap,wr=new WeakSet,Xo=function(Cr){var Tr;return(Tr=Or(this,_r))[Cr]||(Tr[Cr]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(Cr){Ss(this,Ar,null);Cs(this,Ar,Cr),this.onContinue=null}get promise(){return Or(this,Ar).capability.promise}cancel(Cr=0){Or(this,Ar).cancel(null,Cr)}get separateAnnots(){const{separateAnnots:Cr}=Or(this,Ar).operatorList;if(!Cr)return!1;const{annotationCanvasMap:Tr}=Or(this,Ar);return Cr.form||Cr.canvas&&(Tr==null?void 0:Tr.size)>0}}Ar=new WeakMap,exports$1.RenderTask=RenderTask;const kr=class kr{constructor({callback:Cr,params:Tr,objs:Pr,commonObjs:Ir,annotationCanvasMap:Br,operatorList:Wr,pageIndex:Yr,canvasFactory:es,filterFactory:ps,useRequestAnimationFrame:ts=!1,pdfBug:Qr=!1,pageColors:Hr=null}){this.callback=Cr,this.params=Tr,this.objs=Pr,this.commonObjs=Ir,this.annotationCanvasMap=Br,this.operatorListIdx=null,this.operatorList=Wr,this._pageIndex=Yr,this.canvasFactory=es,this.filterFactory=ps,this._pdfBug=Qr,this.pageColors=Hr,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=ts===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=Tr.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:Cr=!1,optionalContentConfig:Tr}){var Yr,es;if(this.cancelled)return;if(this._canvas){if(Or(kr,Sr).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Or(kr,Sr).add(this._canvas)}this._pdfBug&&((Yr=globalThis.StepperManager)!=null&&Yr.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:Pr,viewport:Ir,transform:Br,background:Wr}=this.params;this.gfx=new _canvas.CanvasGraphics(Pr,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:Tr},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:Br,viewport:Ir,transparency:Cr,background:Wr}),this.operatorListIdx=0,this.graphicsReady=!0,(es=this.graphicsReadyCallback)==null||es.call(this)}cancel(Cr=null,Tr=0){var Pr;this.running=!1,this.cancelled=!0,(Pr=this.gfx)==null||Pr.endDrawing(),Or(kr,Sr).delete(this._canvas),this.callback(Cr||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,Tr))}operatorListChanged(){var Cr;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(Cr=this.stepper)==null||Cr.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Or(kr,Sr).delete(this._canvas),this.callback())))}};Sr=new WeakMap,Ss(kr,Sr,new WeakSet);let InternalRenderTask=kr;const version="3.11.174";exports$1.version=version;const build="ce8716743";exports$1.build=build},(ar,or,lr)=>{var mr,fr,Er,Yl,gr;Object.defineProperty(or,"__esModule",{value:!0}),or.SerializableEmpty=or.PrintAnnotationStorage=or.AnnotationStorage=void 0;var cr=lr(1),ur=lr(4),dr=lr(8);const hr=Object.freeze({map:null,hash:"",transfers:void 0});or.SerializableEmpty=hr;class pr{constructor(){Ss(this,Er);Ss(this,mr,!1);Ss(this,fr,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(jr,br){const _r=Or(this,fr).get(jr);return _r===void 0?br:Object.assign(br,_r)}getRawValue(jr){return Or(this,fr).get(jr)}remove(jr){if(Or(this,fr).delete(jr),Or(this,fr).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const br of Or(this,fr).values())if(br instanceof ur.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(jr,br){const _r=Or(this,fr).get(jr);let wr=!1;if(_r!==void 0)for(const[Rr,Ar]of Object.entries(br))_r[Rr]!==Ar&&(wr=!0,_r[Rr]=Ar);else wr=!0,Or(this,fr).set(jr,br);wr&&js(this,Er,Yl).call(this),br instanceof ur.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(br.constructor._type)}has(jr){return Or(this,fr).has(jr)}getAll(){return Or(this,fr).size>0?(0,cr.objectFromMap)(Or(this,fr)):null}setAll(jr){for(const[br,_r]of Object.entries(jr))this.setValue(br,_r)}get size(){return Or(this,fr).size}resetModified(){Or(this,mr)&&(Cs(this,mr,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new xr(this)}get serializable(){if(Or(this,fr).size===0)return hr;const jr=new Map,br=new dr.MurmurHash3_64,_r=[],wr=Object.create(null);let Rr=!1;for(const[Ar,Sr]of Or(this,fr)){const kr=Sr instanceof ur.AnnotationEditor?Sr.serialize(!1,wr):Sr;kr&&(jr.set(Ar,kr),br.update(`${Ar}:${JSON.stringify(kr)}`),Rr||(Rr=!!kr.bitmap))}if(Rr)for(const Ar of jr.values())Ar.bitmap&&_r.push(Ar.bitmap);return jr.size>0?{map:jr,hash:br.hexdigest(),transfers:_r}:hr}}mr=new WeakMap,fr=new WeakMap,Er=new WeakSet,Yl=function(){Or(this,mr)||(Cs(this,mr,!0),typeof this.onSetModified=="function"&&this.onSetModified())},or.AnnotationStorage=pr;class xr extends pr{constructor(br){super();Ss(this,gr);const{map:_r,hash:wr,transfers:Rr}=br.serializable,Ar=structuredClone(_r,Rr?{transfer:Rr}:null);Cs(this,gr,{map:Ar,hash:wr,transfers:Rr})}get print(){(0,cr.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return Or(this,gr)}}gr=new WeakMap,or.PrintAnnotationStorage=xr},(ar,or,lr)=>{var xr,mr,fr,Er,vr,gr,yr,jr,br,_r,wr,Rr,Ar,Sr,kr,Ko,Yo,Tr,qo,Jo,Jl,Ql,Zl,Qo,_c;Object.defineProperty(or,"__esModule",{value:!0}),or.AnnotationEditor=void 0;var cr=lr(5),ur=lr(1),dr=lr(6);const ts=class ts{constructor(Hr){Ss(this,kr);Ss(this,xr,"");Ss(this,mr,!1);Ss(this,fr,null);Ss(this,Er,null);Ss(this,vr,null);Ss(this,gr,!1);Ss(this,yr,null);Ss(this,jr,this.focusin.bind(this));Ss(this,br,this.focusout.bind(this));Ss(this,_r,!1);Ss(this,wr,!1);Ss(this,Rr,!1);io(this,"_initialOptions",Object.create(null));io(this,"_uiManager",null);io(this,"_focusEventsAllowed",!0);io(this,"_l10nPromise",null);Ss(this,Ar,!1);Ss(this,Sr,ts._zIndex++);this.constructor===ts&&(0,ur.unreachable)("Cannot initialize AnnotationEditor."),this.parent=Hr.parent,this.id=Hr.id,this.width=this.height=null,this.pageIndex=Hr.parent.pageIndex,this.name=Hr.name,this.div=null,this._uiManager=Hr.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=Hr.isCentered,this._structTreeParentId=null;const{rotation:Kr,rawDims:{pageWidth:rs,pageHeight:Mr,pageX:Dr,pageY:Lr}}=this.parent.viewport;this.rotation=Kr,this.pageRotation=(360+Kr-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[rs,Mr],this.pageTranslation=[Dr,Lr];const[Fr,$r]=this.parentDimensions;this.x=Hr.x/Fr,this.y=Hr.y/$r,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,ur.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(Hr){const Kr=new pr({id:Hr.parent.getNextId(),parent:Hr.parent,uiManager:Hr._uiManager});Kr.annotationElementId=Hr.annotationElementId,Kr.deleted=!0,Kr._uiManager.addToAnnotationStorage(Kr)}static initialize(Hr,Kr=null){if(ts._l10nPromise||(ts._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(Mr=>[Mr,Hr.get(Mr)]))),Kr!=null&&Kr.strings)for(const Mr of Kr.strings)ts._l10nPromise.set(Mr,Hr.get(Mr));if(ts._borderLineWidth!==-1)return;const rs=getComputedStyle(document.documentElement);ts._borderLineWidth=parseFloat(rs.getPropertyValue("--outline-width"))||0}static updateDefaultParams(Hr,Kr){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(Hr){return!1}static paste(Hr,Kr){(0,ur.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return Or(this,Ar)}set _isDraggable(Hr){var Kr;Cs(this,Ar,Hr),(Kr=this.div)==null||Kr.classList.toggle("draggable",Hr)}center(){const[Hr,Kr]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*Kr/(Hr*2),this.y+=this.width*Hr/(Kr*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*Kr/(Hr*2),this.y-=this.width*Hr/(Kr*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(Hr){this._uiManager.addCommands(Hr)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=Or(this,Sr)}setParent(Hr){Hr!==null&&(this.pageIndex=Hr.pageIndex,this.pageDimensions=Hr.pageDimensions),this.parent=Hr}focusin(Hr){this._focusEventsAllowed&&(Or(this,_r)?Cs(this,_r,!1):this.parent.setSelected(this))}focusout(Hr){var rs;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const Kr=Hr.relatedTarget;Kr!=null&&Kr.closest(`#${this.id}`)||(Hr.preventDefault(),(rs=this.parent)!=null&&rs.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(Hr,Kr,rs,Mr){const[Dr,Lr]=this.parentDimensions;[rs,Mr]=this.screenToPageTranslation(rs,Mr),this.x=(Hr+rs)/Dr,this.y=(Kr+Mr)/Lr,this.fixAndSetPosition()}translate(Hr,Kr){js(this,kr,Ko).call(this,this.parentDimensions,Hr,Kr)}translateInPage(Hr,Kr){js(this,kr,Ko).call(this,this.pageDimensions,Hr,Kr),this.div.scrollIntoView({block:"nearest"})}drag(Hr,Kr){const[rs,Mr]=this.parentDimensions;if(this.x+=Hr/rs,this.y+=Kr/Mr,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:Vr,y:Gr}=this.div.getBoundingClientRect();this.parent.findNewParent(this,Vr,Gr)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:Dr,y:Lr}=this;const[Fr,$r]=js(this,kr,Yo).call(this);Dr+=Fr,Lr+=$r,this.div.style.left=`${(100*Dr).toFixed(2)}%`,this.div.style.top=`${(100*Lr).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[Hr,Kr]=this.pageDimensions;let{x:rs,y:Mr,width:Dr,height:Lr}=this;switch(Dr*=Hr,Lr*=Kr,rs*=Hr,Mr*=Kr,this.rotation){case 0:rs=Math.max(0,Math.min(Hr-Dr,rs)),Mr=Math.max(0,Math.min(Kr-Lr,Mr));break;case 90:rs=Math.max(0,Math.min(Hr-Lr,rs)),Mr=Math.min(Kr,Math.max(Dr,Mr));break;case 180:rs=Math.min(Hr,Math.max(Dr,rs)),Mr=Math.min(Kr,Math.max(Lr,Mr));break;case 270:rs=Math.min(Hr,Math.max(Lr,rs)),Mr=Math.max(0,Math.min(Kr-Dr,Mr));break}this.x=rs/=Hr,this.y=Mr/=Kr;const[Fr,$r]=js(this,kr,Yo).call(this);rs+=Fr,Mr+=$r;const{style:Vr}=this.div;Vr.left=`${(100*rs).toFixed(2)}%`,Vr.top=`${(100*Mr).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(Hr,Kr){var rs;return js(rs=ts,Tr,qo).call(rs,Hr,Kr,this.parentRotation)}pageTranslationToScreen(Hr,Kr){var rs;return js(rs=ts,Tr,qo).call(rs,Hr,Kr,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:Hr,pageDimensions:[Kr,rs]}=this,Mr=Kr*Hr,Dr=rs*Hr;return ur.FeatureTest.isCSSRoundSupported?[Math.round(Mr),Math.round(Dr)]:[Mr,Dr]}setDims(Hr,Kr){var Dr;const[rs,Mr]=this.parentDimensions;this.div.style.width=`${(100*Hr/rs).toFixed(2)}%`,Or(this,gr)||(this.div.style.height=`${(100*Kr/Mr).toFixed(2)}%`),(Dr=Or(this,fr))==null||Dr.classList.toggle("small",Hr<ts.SMALL_EDITOR_SIZE||Kr<ts.SMALL_EDITOR_SIZE)}fixDims(){const{style:Hr}=this.div,{height:Kr,width:rs}=Hr,Mr=rs.endsWith("%"),Dr=!Or(this,gr)&&Kr.endsWith("%");if(Mr&&Dr)return;const[Lr,Fr]=this.parentDimensions;Mr||(Hr.width=`${(100*parseFloat(rs)/Lr).toFixed(2)}%`),!Or(this,gr)&&!Dr&&(Hr.height=`${(100*parseFloat(Kr)/Fr).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(Or(this,fr))return;const Hr=Cs(this,fr,document.createElement("button"));Hr.className="altText";const Kr=await ts._l10nPromise.get("editor_alt_text_button_label");Hr.textContent=Kr,Hr.setAttribute("aria-label",Kr),Hr.tabIndex="0",Hr.addEventListener("contextmenu",dr.noContextMenu),Hr.addEventListener("pointerdown",rs=>rs.stopPropagation()),Hr.addEventListener("click",rs=>{rs.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),Hr.addEventListener("keydown",rs=>{rs.target===Hr&&rs.key==="Enter"&&(rs.preventDefault(),this._uiManager.editAltText(this))}),js(this,kr,Qo).call(this),this.div.append(Hr),ts.SMALL_EDITOR_SIZE||(ts.SMALL_EDITOR_SIZE=Math.min(128,Math.round(Hr.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:Or(this,xr),decorative:Or(this,mr)}}set altTextData({altText:Hr,decorative:Kr}){Or(this,xr)===Hr&&Or(this,mr)===Kr||(Cs(this,xr,Hr),Cs(this,mr,Kr),js(this,kr,Qo).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",Or(this,jr)),this.div.addEventListener("focusout",Or(this,br));const[Hr,Kr]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*Kr/Hr).toFixed(2)}%`,this.div.style.maxHeight=`${(100*Hr/Kr).toFixed(2)}%`);const[rs,Mr]=this.getInitialTranslation();return this.translate(rs,Mr),(0,cr.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(Hr){const{isMac:Kr}=ur.FeatureTest.platform;if(Hr.button!==0||Hr.ctrlKey&&Kr){Hr.preventDefault();return}Cs(this,_r,!0),js(this,kr,_c).call(this,Hr)}moveInDOM(){var Hr;(Hr=this.parent)==null||Hr.moveEditorInDOM(this)}_setParentAndPosition(Hr,Kr,rs){Hr.changeParent(this),this.x=Kr,this.y=rs,this.fixAndSetPosition()}getRect(Hr,Kr){const rs=this.parentScale,[Mr,Dr]=this.pageDimensions,[Lr,Fr]=this.pageTranslation,$r=Hr/rs,Vr=Kr/rs,Gr=this.x*Mr,Jr=this.y*Dr,ms=this.width*Mr,ls=this.height*Dr;switch(this.rotation){case 0:return[Gr+$r+Lr,Dr-Jr-Vr-ls+Fr,Gr+$r+ms+Lr,Dr-Jr-Vr+Fr];case 90:return[Gr+Vr+Lr,Dr-Jr+$r+Fr,Gr+Vr+ls+Lr,Dr-Jr+$r+ms+Fr];case 180:return[Gr-$r-ms+Lr,Dr-Jr+Vr+Fr,Gr-$r+Lr,Dr-Jr+Vr+ls+Fr];case 270:return[Gr-Vr-ls+Lr,Dr-Jr-$r-ms+Fr,Gr-Vr+Lr,Dr-Jr-$r+Fr];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(Hr,Kr){const[rs,Mr,Dr,Lr]=Hr,Fr=Dr-rs,$r=Lr-Mr;switch(this.rotation){case 0:return[rs,Kr-Lr,Fr,$r];case 90:return[rs,Kr-Mr,$r,Fr];case 180:return[Dr,Kr-Mr,Fr,$r];case 270:return[Dr,Kr-Lr,$r,Fr];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){Cs(this,Rr,!0)}disableEditMode(){Cs(this,Rr,!1)}isInEditMode(){return Or(this,Rr)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var Hr,Kr;(Hr=this.div)==null||Hr.addEventListener("focusin",Or(this,jr)),(Kr=this.div)==null||Kr.addEventListener("focusout",Or(this,br))}serialize(Hr=!1,Kr=null){(0,ur.unreachable)("An editor must be serializable")}static deserialize(Hr,Kr,rs){const Mr=new this.prototype.constructor({parent:Kr,id:Kr.getNextId(),uiManager:rs});Mr.rotation=Hr.rotation;const[Dr,Lr]=Mr.pageDimensions,[Fr,$r,Vr,Gr]=Mr.getRectInCurrentCoords(Hr.rect,Lr);return Mr.x=Fr/Dr,Mr.y=$r/Lr,Mr.width=Vr/Dr,Mr.height=Gr/Lr,Mr}remove(){var Hr;this.div.removeEventListener("focusin",Or(this,jr)),this.div.removeEventListener("focusout",Or(this,br)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(Hr=Or(this,fr))==null||Hr.remove(),Cs(this,fr,null),Cs(this,Er,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(js(this,kr,Jl).call(this),Or(this,yr).classList.remove("hidden"))}select(){var Hr;this.makeResizable(),(Hr=this.div)==null||Hr.classList.add("selectedEditor")}unselect(){var Hr,Kr,rs;(Hr=Or(this,yr))==null||Hr.classList.add("hidden"),(Kr=this.div)==null||Kr.classList.remove("selectedEditor"),(rs=this.div)!=null&&rs.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(Hr,Kr){}disableEditing(){Or(this,fr)&&(Or(this,fr).hidden=!0)}enableEditing(){Or(this,fr)&&(Or(this,fr).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return Or(this,wr)}set isEditing(Hr){Cs(this,wr,Hr),this.parent&&(Hr?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(Hr,Kr){Cs(this,gr,!0);const rs=Hr/Kr,{style:Mr}=this.div;Mr.aspectRatio=rs,Mr.height="auto"}static get MIN_SIZE(){return 16}};xr=new WeakMap,mr=new WeakMap,fr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,jr=new WeakMap,br=new WeakMap,_r=new WeakMap,wr=new WeakMap,Rr=new WeakMap,Ar=new WeakMap,Sr=new WeakMap,kr=new WeakSet,Ko=function([Hr,Kr],rs,Mr){[rs,Mr]=this.screenToPageTranslation(rs,Mr),this.x+=rs/Hr,this.y+=Mr/Kr,this.fixAndSetPosition()},Yo=function(){const[Hr,Kr]=this.parentDimensions,{_borderLineWidth:rs}=ts,Mr=rs/Hr,Dr=rs/Kr;switch(this.rotation){case 90:return[-Mr,Dr];case 180:return[Mr,Dr];case 270:return[Mr,-Dr];default:return[-Mr,-Dr]}},Tr=new WeakSet,qo=function(Hr,Kr,rs){switch(rs){case 90:return[Kr,-Hr];case 180:return[-Hr,-Kr];case 270:return[-Kr,Hr];default:return[Hr,Kr]}},Jo=function(Hr){switch(Hr){case 90:{const[Kr,rs]=this.pageDimensions;return[0,-Kr/rs,rs/Kr,0]}case 180:return[-1,0,0,-1];case 270:{const[Kr,rs]=this.pageDimensions;return[0,Kr/rs,-rs/Kr,0]}default:return[1,0,0,1]}},Jl=function(){if(Or(this,yr))return;Cs(this,yr,document.createElement("div")),Or(this,yr).classList.add("resizers");const Hr=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||Hr.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const Kr of Hr){const rs=document.createElement("div");Or(this,yr).append(rs),rs.classList.add("resizer",Kr),rs.addEventListener("pointerdown",js(this,kr,Ql).bind(this,Kr)),rs.addEventListener("contextmenu",dr.noContextMenu)}this.div.prepend(Or(this,yr))},Ql=function(Hr,Kr){Kr.preventDefault();const{isMac:rs}=ur.FeatureTest.platform;if(Kr.button!==0||Kr.ctrlKey&&rs)return;const Mr=js(this,kr,Zl).bind(this,Hr),Dr=this._isDraggable;this._isDraggable=!1;const Lr={passive:!0,capture:!0};window.addEventListener("pointermove",Mr,Lr);const Fr=this.x,$r=this.y,Vr=this.width,Gr=this.height,Jr=this.parent.div.style.cursor,ms=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(Kr.target).cursor;const ls=()=>{this._isDraggable=Dr,window.removeEventListener("pointerup",ls),window.removeEventListener("blur",ls),window.removeEventListener("pointermove",Mr,Lr),this.parent.div.style.cursor=Jr,this.div.style.cursor=ms;const ds=this.x,bs=this.y,ws=this.width,Is=this.height;ds===Fr&&bs===$r&&ws===Vr&&Is===Gr||this.addCommands({cmd:()=>{this.width=ws,this.height=Is,this.x=ds,this.y=bs;const[ys,ss]=this.parentDimensions;this.setDims(ys*ws,ss*Is),this.fixAndSetPosition()},undo:()=>{this.width=Vr,this.height=Gr,this.x=Fr,this.y=$r;const[ys,ss]=this.parentDimensions;this.setDims(ys*Vr,ss*Gr),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",ls),window.addEventListener("blur",ls)},Zl=function(Hr,Kr){const[rs,Mr]=this.parentDimensions,Dr=this.x,Lr=this.y,Fr=this.width,$r=this.height,Vr=ts.MIN_SIZE/rs,Gr=ts.MIN_SIZE/Mr,Jr=Js=>Math.round(Js*1e4)/1e4,ms=js(this,kr,Jo).call(this,this.rotation),ls=(Js,ga)=>[ms[0]*Js+ms[2]*ga,ms[1]*Js+ms[3]*ga],ds=js(this,kr,Jo).call(this,360-this.rotation),bs=(Js,ga)=>[ds[0]*Js+ds[2]*ga,ds[1]*Js+ds[3]*ga];let ws,Is,ys=!1,ss=!1;switch(Hr){case"topLeft":ys=!0,ws=(Js,ga)=>[0,0],Is=(Js,ga)=>[Js,ga];break;case"topMiddle":ws=(Js,ga)=>[Js/2,0],Is=(Js,ga)=>[Js/2,ga];break;case"topRight":ys=!0,ws=(Js,ga)=>[Js,0],Is=(Js,ga)=>[0,ga];break;case"middleRight":ss=!0,ws=(Js,ga)=>[Js,ga/2],Is=(Js,ga)=>[0,ga/2];break;case"bottomRight":ys=!0,ws=(Js,ga)=>[Js,ga],Is=(Js,ga)=>[0,0];break;case"bottomMiddle":ws=(Js,ga)=>[Js/2,ga],Is=(Js,ga)=>[Js/2,0];break;case"bottomLeft":ys=!0,ws=(Js,ga)=>[0,ga],Is=(Js,ga)=>[Js,0];break;case"middleLeft":ss=!0,ws=(Js,ga)=>[0,ga/2],Is=(Js,ga)=>[Js,ga/2];break}const Ur=ws(Fr,$r),Xr=Is(Fr,$r);let cs=ls(...Xr);const xs=Jr(Dr+cs[0]),Es=Jr(Lr+cs[1]);let Ns=1,Ts=1,[gs,Hs]=this.screenToPageTranslation(Kr.movementX,Kr.movementY);if([gs,Hs]=bs(gs/rs,Hs/Mr),ys){const Js=Math.hypot(Fr,$r);Ns=Ts=Math.max(Math.min(Math.hypot(Xr[0]-Ur[0]-gs,Xr[1]-Ur[1]-Hs)/Js,1/Fr,1/$r),Vr/Fr,Gr/$r)}else ss?Ns=Math.max(Vr,Math.min(1,Math.abs(Xr[0]-Ur[0]-gs)))/Fr:Ts=Math.max(Gr,Math.min(1,Math.abs(Xr[1]-Ur[1]-Hs)))/$r;const Us=Jr(Fr*Ns),xa=Jr($r*Ts);cs=ls(...Is(Us,xa));const Gs=xs-cs[0],$a=Es-cs[1];this.width=Us,this.height=xa,this.x=Gs,this.y=$a,this.setDims(rs*Us,Mr*xa),this.fixAndSetPosition()},Qo=async function(){var rs;const Hr=Or(this,fr);if(!Hr)return;if(!Or(this,xr)&&!Or(this,mr)){Hr.classList.remove("done"),(rs=Or(this,Er))==null||rs.remove();return}ts._l10nPromise.get("editor_alt_text_edit_button_label").then(Mr=>{Hr.setAttribute("aria-label",Mr)});let Kr=Or(this,Er);if(!Kr){Cs(this,Er,Kr=document.createElement("span")),Kr.className="tooltip",Kr.setAttribute("role","tooltip");const Mr=Kr.id=`alt-text-tooltip-${this.id}`;Hr.setAttribute("aria-describedby",Mr);const Dr=100;Hr.addEventListener("mouseenter",()=>{Cs(this,vr,setTimeout(()=>{Cs(this,vr,null),Or(this,Er).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},Dr))}),Hr.addEventListener("mouseleave",()=>{var Lr;clearTimeout(Or(this,vr)),Cs(this,vr,null),(Lr=Or(this,Er))==null||Lr.classList.remove("show")})}Hr.classList.add("done"),Kr.innerText=Or(this,mr)?await ts._l10nPromise.get("editor_alt_text_decorative_tooltip"):Or(this,xr),Kr.parentNode||Hr.append(Kr)},_c=function(Hr){if(!this._isDraggable)return;const Kr=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let rs,Mr;Kr&&(rs={passive:!0,capture:!0},Mr=Lr=>{const[Fr,$r]=this.screenToPageTranslation(Lr.movementX,Lr.movementY);this._uiManager.dragSelectedEditors(Fr,$r)},window.addEventListener("pointermove",Mr,rs));const Dr=()=>{if(window.removeEventListener("pointerup",Dr),window.removeEventListener("blur",Dr),Kr&&window.removeEventListener("pointermove",Mr,rs),Cs(this,_r,!1),!this._uiManager.endDragSession()){const{isMac:Lr}=ur.FeatureTest.platform;Hr.ctrlKey&&!Lr||Hr.shiftKey||Hr.metaKey&&Lr?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",Dr),window.addEventListener("blur",Dr)},Ss(ts,Tr),io(ts,"_borderLineWidth",-1),io(ts,"_colorManager",new cr.ColorManager),io(ts,"_zIndex",1),io(ts,"SMALL_EDITOR_SIZE",0);let hr=ts;or.AnnotationEditor=hr;class pr extends hr{constructor(Hr){super(Hr),this.annotationElementId=Hr.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(ar,or,lr)=>{var gr,yr,jr,br,_r,Zo,Ar,Sr,kr,Nr,Cr,eu,Ir,Br,Wr,Yr,es,ps,ts,Qr,Hr,Kr,rs,Mr,Dr,Lr,Fr,$r,Vr,Gr,Jr,ms,ls,ds,bs,ws,Is,ys,ss,Ur,Xr,cs,xs,Es,Ns,Ts,gs,tu,xl,El,Lo,yl,wl,co,_o,ru,su,_l,Ro,Rl;Object.defineProperty(or,"__esModule",{value:!0}),or.KeyboardManager=or.CommandManager=or.ColorManager=or.AnnotationEditorUIManager=void 0,or.bindEvents=dr,or.opacityToHex=hr;var cr=lr(1),ur=lr(6);function dr(eo,fs,Os){for(const zs of Os)fs.addEventListener(zs,eo[zs].bind(eo))}function hr(eo){return Math.round(Math.min(255,Math.max(1,255*eo))).toString(16).padStart(2,"0")}class pr{constructor(){Ss(this,gr,0)}getId(){return`${cr.AnnotationEditorPrefix}${wo(this,gr)._++}`}}gr=new WeakMap;const Rr=class Rr{constructor(){Ss(this,_r);Ss(this,yr,(0,cr.getUuid)());Ss(this,jr,0);Ss(this,br,null)}static get _isSVGFittingCanvas(){const fs='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',zs=new OffscreenCanvas(1,3).getContext("2d"),Zs=new Image;Zs.src=fs;const na=Zs.decode().then(()=>(zs.drawImage(Zs,0,0,1,1,0,0,1,3),new Uint32Array(zs.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,cr.shadow)(this,"_isSVGFittingCanvas",na)}async getFromFile(fs){const{lastModified:Os,name:zs,size:Zs,type:na}=fs;return js(this,_r,Zo).call(this,`${Os}_${zs}_${Zs}_${na}`,fs)}async getFromUrl(fs){return js(this,_r,Zo).call(this,fs,fs)}async getFromId(fs){Or(this,br)||Cs(this,br,new Map);const Os=Or(this,br).get(fs);return Os?Os.bitmap?(Os.refCounter+=1,Os):Os.file?this.getFromFile(Os.file):this.getFromUrl(Os.url):null}getSvgUrl(fs){const Os=Or(this,br).get(fs);return Os!=null&&Os.isSvg?Os.svgUrl:null}deleteId(fs){Or(this,br)||Cs(this,br,new Map);const Os=Or(this,br).get(fs);Os&&(Os.refCounter-=1,Os.refCounter===0&&(Os.bitmap=null))}isValidId(fs){return fs.startsWith(`image_${Or(this,yr)}_`)}};yr=new WeakMap,jr=new WeakMap,br=new WeakMap,_r=new WeakSet,Zo=async function(fs,Os){Or(this,br)||Cs(this,br,new Map);let zs=Or(this,br).get(fs);if(zs===null)return null;if(zs!=null&&zs.bitmap)return zs.refCounter+=1,zs;try{zs||(zs={bitmap:null,id:`image_${Or(this,yr)}_${wo(this,jr)._++}`,refCounter:0,isSvg:!1});let Zs;if(typeof Os=="string"){zs.url=Os;const na=await fetch(Os);if(!na.ok)throw new Error(na.statusText);Zs=await na.blob()}else Zs=zs.file=Os;if(Zs.type==="image/svg+xml"){const na=Rr._isSVGFittingCanvas,Ys=new FileReader,hs=new Image,as=new Promise((vs,Ls)=>{hs.onload=()=>{zs.bitmap=hs,zs.isSvg=!0,vs()},Ys.onload=async()=>{const Ds=zs.svgUrl=Ys.result;hs.src=await na?`${Ds}#svgView(preserveAspectRatio(none))`:Ds},hs.onerror=Ys.onerror=Ls});Ys.readAsDataURL(Zs),await as}else zs.bitmap=await createImageBitmap(Zs);zs.refCounter=1}catch(Zs){console.error(Zs),zs=null}return Or(this,br).set(fs,zs),zs&&Or(this,br).set(zs.id,zs),zs};let xr=Rr;class mr{constructor(fs=128){Ss(this,Ar,[]);Ss(this,Sr,!1);Ss(this,kr);Ss(this,Nr,-1);Cs(this,kr,fs)}add({cmd:fs,undo:Os,mustExec:zs,type:Zs=NaN,overwriteIfSameType:na=!1,keepUndo:Ys=!1}){if(zs&&fs(),Or(this,Sr))return;const hs={cmd:fs,undo:Os,type:Zs};if(Or(this,Nr)===-1){Or(this,Ar).length>0&&(Or(this,Ar).length=0),Cs(this,Nr,0),Or(this,Ar).push(hs);return}if(na&&Or(this,Ar)[Or(this,Nr)].type===Zs){Ys&&(hs.undo=Or(this,Ar)[Or(this,Nr)].undo),Or(this,Ar)[Or(this,Nr)]=hs;return}const as=Or(this,Nr)+1;as===Or(this,kr)?Or(this,Ar).splice(0,1):(Cs(this,Nr,as),as<Or(this,Ar).length&&Or(this,Ar).splice(as)),Or(this,Ar).push(hs)}undo(){Or(this,Nr)!==-1&&(Cs(this,Sr,!0),Or(this,Ar)[Or(this,Nr)].undo(),Cs(this,Sr,!1),Cs(this,Nr,Or(this,Nr)-1))}redo(){Or(this,Nr)<Or(this,Ar).length-1&&(Cs(this,Nr,Or(this,Nr)+1),Cs(this,Sr,!0),Or(this,Ar)[Or(this,Nr)].cmd(),Cs(this,Sr,!1))}hasSomethingToUndo(){return Or(this,Nr)!==-1}hasSomethingToRedo(){return Or(this,Nr)<Or(this,Ar).length-1}destroy(){Cs(this,Ar,null)}}Ar=new WeakMap,Sr=new WeakMap,kr=new WeakMap,Nr=new WeakMap,or.CommandManager=mr;class fr{constructor(fs){Ss(this,Cr);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:Os}=cr.FeatureTest.platform;for(const[zs,Zs,na={}]of fs)for(const Ys of zs){const hs=Ys.startsWith("mac+");Os&&hs?(this.callbacks.set(Ys.slice(4),{callback:Zs,options:na}),this.allKeys.add(Ys.split("+").at(-1))):!Os&&!hs&&(this.callbacks.set(Ys,{callback:Zs,options:na}),this.allKeys.add(Ys.split("+").at(-1)))}}exec(fs,Os){if(!this.allKeys.has(Os.key))return;const zs=this.callbacks.get(js(this,Cr,eu).call(this,Os));if(!zs)return;const{callback:Zs,options:{bubbles:na=!1,args:Ys=[],checker:hs=null}}=zs;hs&&!hs(fs,Os)||(Zs.bind(fs,...Ys)(),na||(Os.stopPropagation(),Os.preventDefault()))}}Cr=new WeakSet,eu=function(fs){fs.altKey&&this.buffer.push("alt"),fs.ctrlKey&&this.buffer.push("ctrl"),fs.metaKey&&this.buffer.push("meta"),fs.shiftKey&&this.buffer.push("shift"),this.buffer.push(fs.key);const Os=this.buffer.join("+");return this.buffer.length=0,Os},or.KeyboardManager=fr;const Pr=class Pr{get _colors(){const fs=new Map([["CanvasText",null],["Canvas",null]]);return(0,ur.getColorValues)(fs),(0,cr.shadow)(this,"_colors",fs)}convert(fs){const Os=(0,ur.getRGB)(fs);if(!window.matchMedia("(forced-colors: active)").matches)return Os;for(const[zs,Zs]of this._colors)if(Zs.every((na,Ys)=>na===Os[Ys]))return Pr._colorsMapping.get(zs);return Os}getHexCode(fs){const Os=this._colors.get(fs);return Os?cr.Util.makeHexColor(...Os):fs}};io(Pr,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Er=Pr;or.ColorManager=Er;const to=class to{constructor(fs,Os,zs,Zs,na,Ys){Ss(this,gs);Ss(this,Ir,null);Ss(this,Br,new Map);Ss(this,Wr,new Map);Ss(this,Yr,null);Ss(this,es,null);Ss(this,ps,new mr);Ss(this,ts,0);Ss(this,Qr,new Set);Ss(this,Hr,null);Ss(this,Kr,null);Ss(this,rs,new Set);Ss(this,Mr,null);Ss(this,Dr,new pr);Ss(this,Lr,!1);Ss(this,Fr,!1);Ss(this,$r,null);Ss(this,Vr,cr.AnnotationEditorType.NONE);Ss(this,Gr,new Set);Ss(this,Jr,null);Ss(this,ms,this.blur.bind(this));Ss(this,ls,this.focus.bind(this));Ss(this,ds,this.copy.bind(this));Ss(this,bs,this.cut.bind(this));Ss(this,ws,this.paste.bind(this));Ss(this,Is,this.keydown.bind(this));Ss(this,ys,this.onEditingAction.bind(this));Ss(this,ss,this.onPageChanging.bind(this));Ss(this,Ur,this.onScaleChanging.bind(this));Ss(this,Xr,this.onRotationChanging.bind(this));Ss(this,cs,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Ss(this,xs,[0,0]);Ss(this,Es,null);Ss(this,Ns,null);Ss(this,Ts,null);Cs(this,Ns,fs),Cs(this,Ts,Os),Cs(this,Yr,zs),this._eventBus=Zs,this._eventBus._on("editingaction",Or(this,ys)),this._eventBus._on("pagechanging",Or(this,ss)),this._eventBus._on("scalechanging",Or(this,Ur)),this._eventBus._on("rotationchanging",Or(this,Xr)),Cs(this,es,na.annotationStorage),Cs(this,Mr,na.filterFactory),Cs(this,Jr,Ys),this.viewParameters={realScale:ur.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const fs=to.prototype,Os=na=>{const{activeElement:Ys}=document;return Ys&&Or(na,Ns).contains(Ys)&&na.hasSomethingToControl()},zs=this.TRANSLATE_SMALL,Zs=this.TRANSLATE_BIG;return(0,cr.shadow)(this,"_keyboardManager",new fr([[["ctrl+a","mac+meta+a"],fs.selectAll],[["ctrl+z","mac+meta+z"],fs.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],fs.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],fs.delete],[["Escape","mac+Escape"],fs.unselectAll],[["ArrowLeft","mac+ArrowLeft"],fs.translateSelectedEditors,{args:[-zs,0],checker:Os}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],fs.translateSelectedEditors,{args:[-Zs,0],checker:Os}],[["ArrowRight","mac+ArrowRight"],fs.translateSelectedEditors,{args:[zs,0],checker:Os}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],fs.translateSelectedEditors,{args:[Zs,0],checker:Os}],[["ArrowUp","mac+ArrowUp"],fs.translateSelectedEditors,{args:[0,-zs],checker:Os}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],fs.translateSelectedEditors,{args:[0,-Zs],checker:Os}],[["ArrowDown","mac+ArrowDown"],fs.translateSelectedEditors,{args:[0,zs],checker:Os}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],fs.translateSelectedEditors,{args:[0,Zs],checker:Os}]]))}destroy(){js(this,gs,Lo).call(this),js(this,gs,xl).call(this),this._eventBus._off("editingaction",Or(this,ys)),this._eventBus._off("pagechanging",Or(this,ss)),this._eventBus._off("scalechanging",Or(this,Ur)),this._eventBus._off("rotationchanging",Or(this,Xr));for(const fs of Or(this,Wr).values())fs.destroy();Or(this,Wr).clear(),Or(this,Br).clear(),Or(this,rs).clear(),Cs(this,Ir,null),Or(this,Gr).clear(),Or(this,ps).destroy(),Or(this,Yr).destroy()}get hcmFilter(){return(0,cr.shadow)(this,"hcmFilter",Or(this,Jr)?Or(this,Mr).addHCMFilter(Or(this,Jr).foreground,Or(this,Jr).background):"none")}get direction(){return(0,cr.shadow)(this,"direction",getComputedStyle(Or(this,Ns)).direction)}editAltText(fs){var Os;(Os=Or(this,Yr))==null||Os.editAltText(this,fs)}onPageChanging({pageNumber:fs}){Cs(this,ts,fs-1)}focusMainContainer(){Or(this,Ns).focus()}findParent(fs,Os){for(const zs of Or(this,Wr).values()){const{x:Zs,y:na,width:Ys,height:hs}=zs.div.getBoundingClientRect();if(fs>=Zs&&fs<=Zs+Ys&&Os>=na&&Os<=na+hs)return zs}return null}disableUserSelect(fs=!1){Or(this,Ts).classList.toggle("noUserSelect",fs)}addShouldRescale(fs){Or(this,rs).add(fs)}removeShouldRescale(fs){Or(this,rs).delete(fs)}onScaleChanging({scale:fs}){this.commitOrRemove(),this.viewParameters.realScale=fs*ur.PixelsPerInch.PDF_TO_CSS_UNITS;for(const Os of Or(this,rs))Os.onScaleChanging()}onRotationChanging({pagesRotation:fs}){this.commitOrRemove(),this.viewParameters.rotation=fs}addToAnnotationStorage(fs){!fs.isEmpty()&&Or(this,es)&&!Or(this,es).has(fs.id)&&Or(this,es).setValue(fs.id,fs)}blur(){if(!this.hasSelection)return;const{activeElement:fs}=document;for(const Os of Or(this,Gr))if(Os.div.contains(fs)){Cs(this,$r,[Os,fs]),Os._focusEventsAllowed=!1;break}}focus(){if(!Or(this,$r))return;const[fs,Os]=Or(this,$r);Cs(this,$r,null),Os.addEventListener("focusin",()=>{fs._focusEventsAllowed=!0},{once:!0}),Os.focus()}addEditListeners(){js(this,gs,El).call(this),js(this,gs,yl).call(this)}removeEditListeners(){js(this,gs,Lo).call(this),js(this,gs,wl).call(this)}copy(fs){var zs;if(fs.preventDefault(),(zs=Or(this,Ir))==null||zs.commitOrRemove(),!this.hasSelection)return;const Os=[];for(const Zs of Or(this,Gr)){const na=Zs.serialize(!0);na&&Os.push(na)}Os.length!==0&&fs.clipboardData.setData("application/pdfjs",JSON.stringify(Os))}cut(fs){this.copy(fs),this.delete()}paste(fs){fs.preventDefault();const{clipboardData:Os}=fs;for(const na of Os.items)for(const Ys of Or(this,Kr))if(Ys.isHandlingMimeForPasting(na.type)){Ys.paste(na,this.currentLayer);return}let zs=Os.getData("application/pdfjs");if(!zs)return;try{zs=JSON.parse(zs)}catch(na){(0,cr.warn)(`paste: "${na.message}".`);return}if(!Array.isArray(zs))return;this.unselectAll();const Zs=this.currentLayer;try{const na=[];for(const as of zs){const vs=Zs.deserialize(as);if(!vs)return;na.push(vs)}const Ys=()=>{for(const as of na)js(this,gs,_l).call(this,as);js(this,gs,Rl).call(this,na)},hs=()=>{for(const as of na)as.remove()};this.addCommands({cmd:Ys,undo:hs,mustExec:!0})}catch(na){(0,cr.warn)(`paste: "${na.message}".`)}}keydown(fs){var Os;(Os=this.getActive())!=null&&Os.shouldGetKeyboardEvents()||to._keyboardManager.exec(this,fs)}onEditingAction(fs){["undo","redo","delete","selectAll"].includes(fs.name)&&this[fs.name]()}setEditingState(fs){fs?(js(this,gs,tu).call(this),js(this,gs,El).call(this),js(this,gs,yl).call(this),js(this,gs,co).call(this,{isEditing:Or(this,Vr)!==cr.AnnotationEditorType.NONE,isEmpty:js(this,gs,Ro).call(this),hasSomethingToUndo:Or(this,ps).hasSomethingToUndo(),hasSomethingToRedo:Or(this,ps).hasSomethingToRedo(),hasSelectedEditor:!1})):(js(this,gs,xl).call(this),js(this,gs,Lo).call(this),js(this,gs,wl).call(this),js(this,gs,co).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(fs){if(!Or(this,Kr)){Cs(this,Kr,fs);for(const Os of Or(this,Kr))js(this,gs,_o).call(this,Os.defaultPropertiesToUpdate)}}getId(){return Or(this,Dr).getId()}get currentLayer(){return Or(this,Wr).get(Or(this,ts))}getLayer(fs){return Or(this,Wr).get(fs)}get currentPageIndex(){return Or(this,ts)}addLayer(fs){Or(this,Wr).set(fs.pageIndex,fs),Or(this,Lr)?fs.enable():fs.disable()}removeLayer(fs){Or(this,Wr).delete(fs.pageIndex)}updateMode(fs,Os=null){if(Or(this,Vr)!==fs){if(Cs(this,Vr,fs),fs===cr.AnnotationEditorType.NONE){this.setEditingState(!1),js(this,gs,su).call(this);return}this.setEditingState(!0),js(this,gs,ru).call(this),this.unselectAll();for(const zs of Or(this,Wr).values())zs.updateMode(fs);if(Os){for(const zs of Or(this,Br).values())if(zs.annotationElementId===Os){this.setSelected(zs),zs.enterInEditMode();break}}}}updateToolbar(fs){fs!==Or(this,Vr)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:fs})}updateParams(fs,Os){if(Or(this,Kr)){if(fs===cr.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(fs);return}for(const zs of Or(this,Gr))zs.updateParams(fs,Os);for(const zs of Or(this,Kr))zs.updateDefaultParams(fs,Os)}}enableWaiting(fs=!1){if(Or(this,Fr)!==fs){Cs(this,Fr,fs);for(const Os of Or(this,Wr).values())fs?Os.disableClick():Os.enableClick(),Os.div.classList.toggle("waiting",fs)}}getEditors(fs){const Os=[];for(const zs of Or(this,Br).values())zs.pageIndex===fs&&Os.push(zs);return Os}getEditor(fs){return Or(this,Br).get(fs)}addEditor(fs){Or(this,Br).set(fs.id,fs)}removeEditor(fs){var Os;Or(this,Br).delete(fs.id),this.unselect(fs),(!fs.annotationElementId||!Or(this,Qr).has(fs.annotationElementId))&&((Os=Or(this,es))==null||Os.remove(fs.id))}addDeletedAnnotationElement(fs){Or(this,Qr).add(fs.annotationElementId),fs.deleted=!0}isDeletedAnnotationElement(fs){return Or(this,Qr).has(fs)}removeDeletedAnnotationElement(fs){Or(this,Qr).delete(fs.annotationElementId),fs.deleted=!1}setActiveEditor(fs){Or(this,Ir)!==fs&&(Cs(this,Ir,fs),fs&&js(this,gs,_o).call(this,fs.propertiesToUpdate))}toggleSelected(fs){if(Or(this,Gr).has(fs)){Or(this,Gr).delete(fs),fs.unselect(),js(this,gs,co).call(this,{hasSelectedEditor:this.hasSelection});return}Or(this,Gr).add(fs),fs.select(),js(this,gs,_o).call(this,fs.propertiesToUpdate),js(this,gs,co).call(this,{hasSelectedEditor:!0})}setSelected(fs){for(const Os of Or(this,Gr))Os!==fs&&Os.unselect();Or(this,Gr).clear(),Or(this,Gr).add(fs),fs.select(),js(this,gs,_o).call(this,fs.propertiesToUpdate),js(this,gs,co).call(this,{hasSelectedEditor:!0})}isSelected(fs){return Or(this,Gr).has(fs)}unselect(fs){fs.unselect(),Or(this,Gr).delete(fs),js(this,gs,co).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return Or(this,Gr).size!==0}undo(){Or(this,ps).undo(),js(this,gs,co).call(this,{hasSomethingToUndo:Or(this,ps).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:js(this,gs,Ro).call(this)})}redo(){Or(this,ps).redo(),js(this,gs,co).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:Or(this,ps).hasSomethingToRedo(),isEmpty:js(this,gs,Ro).call(this)})}addCommands(fs){Or(this,ps).add(fs),js(this,gs,co).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:js(this,gs,Ro).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const fs=[...Or(this,Gr)],Os=()=>{for(const Zs of fs)Zs.remove()},zs=()=>{for(const Zs of fs)js(this,gs,_l).call(this,Zs)};this.addCommands({cmd:Os,undo:zs,mustExec:!0})}commitOrRemove(){var fs;(fs=Or(this,Ir))==null||fs.commitOrRemove()}hasSomethingToControl(){return Or(this,Ir)||this.hasSelection}selectAll(){for(const fs of Or(this,Gr))fs.commit();js(this,gs,Rl).call(this,Or(this,Br).values())}unselectAll(){if(Or(this,Ir)){Or(this,Ir).commitOrRemove();return}if(this.hasSelection){for(const fs of Or(this,Gr))fs.unselect();Or(this,Gr).clear(),js(this,gs,co).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(fs,Os,zs=!1){if(zs||this.commitOrRemove(),!this.hasSelection)return;Or(this,xs)[0]+=fs,Or(this,xs)[1]+=Os;const[Zs,na]=Or(this,xs),Ys=[...Or(this,Gr)],hs=1e3;Or(this,Es)&&clearTimeout(Or(this,Es)),Cs(this,Es,setTimeout(()=>{Cs(this,Es,null),Or(this,xs)[0]=Or(this,xs)[1]=0,this.addCommands({cmd:()=>{for(const as of Ys)Or(this,Br).has(as.id)&&as.translateInPage(Zs,na)},undo:()=>{for(const as of Ys)Or(this,Br).has(as.id)&&as.translateInPage(-Zs,-na)},mustExec:!1})},hs));for(const as of Ys)as.translateInPage(fs,Os)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),Cs(this,Hr,new Map);for(const fs of Or(this,Gr))Or(this,Hr).set(fs,{savedX:fs.x,savedY:fs.y,savedPageIndex:fs.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!Or(this,Hr))return!1;this.disableUserSelect(!1);const fs=Or(this,Hr);Cs(this,Hr,null);let Os=!1;for(const[{x:Zs,y:na,pageIndex:Ys},hs]of fs)hs.newX=Zs,hs.newY=na,hs.newPageIndex=Ys,Os||(Os=Zs!==hs.savedX||na!==hs.savedY||Ys!==hs.savedPageIndex);if(!Os)return!1;const zs=(Zs,na,Ys,hs)=>{if(Or(this,Br).has(Zs.id)){const as=Or(this,Wr).get(hs);as?Zs._setParentAndPosition(as,na,Ys):(Zs.pageIndex=hs,Zs.x=na,Zs.y=Ys)}};return this.addCommands({cmd:()=>{for(const[Zs,{newX:na,newY:Ys,newPageIndex:hs}]of fs)zs(Zs,na,Ys,hs)},undo:()=>{for(const[Zs,{savedX:na,savedY:Ys,savedPageIndex:hs}]of fs)zs(Zs,na,Ys,hs)},mustExec:!0}),!0}dragSelectedEditors(fs,Os){if(Or(this,Hr))for(const zs of Or(this,Hr).keys())zs.drag(fs,Os)}rebuild(fs){if(fs.parent===null){const Os=this.getLayer(fs.pageIndex);Os?(Os.changeParent(fs),Os.addOrRebuild(fs)):(this.addEditor(fs),this.addToAnnotationStorage(fs),fs.rebuild())}else fs.parent.addOrRebuild(fs)}isActive(fs){return Or(this,Ir)===fs}getActive(){return Or(this,Ir)}getMode(){return Or(this,Vr)}get imageManager(){return(0,cr.shadow)(this,"imageManager",new xr)}};Ir=new WeakMap,Br=new WeakMap,Wr=new WeakMap,Yr=new WeakMap,es=new WeakMap,ps=new WeakMap,ts=new WeakMap,Qr=new WeakMap,Hr=new WeakMap,Kr=new WeakMap,rs=new WeakMap,Mr=new WeakMap,Dr=new WeakMap,Lr=new WeakMap,Fr=new WeakMap,$r=new WeakMap,Vr=new WeakMap,Gr=new WeakMap,Jr=new WeakMap,ms=new WeakMap,ls=new WeakMap,ds=new WeakMap,bs=new WeakMap,ws=new WeakMap,Is=new WeakMap,ys=new WeakMap,ss=new WeakMap,Ur=new WeakMap,Xr=new WeakMap,cs=new WeakMap,xs=new WeakMap,Es=new WeakMap,Ns=new WeakMap,Ts=new WeakMap,gs=new WeakSet,tu=function(){window.addEventListener("focus",Or(this,ls)),window.addEventListener("blur",Or(this,ms))},xl=function(){window.removeEventListener("focus",Or(this,ls)),window.removeEventListener("blur",Or(this,ms))},El=function(){window.addEventListener("keydown",Or(this,Is),{capture:!0})},Lo=function(){window.removeEventListener("keydown",Or(this,Is),{capture:!0})},yl=function(){document.addEventListener("copy",Or(this,ds)),document.addEventListener("cut",Or(this,bs)),document.addEventListener("paste",Or(this,ws))},wl=function(){document.removeEventListener("copy",Or(this,ds)),document.removeEventListener("cut",Or(this,bs)),document.removeEventListener("paste",Or(this,ws))},co=function(fs){Object.entries(fs).some(([zs,Zs])=>Or(this,cs)[zs]!==Zs)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(Or(this,cs),fs)})},_o=function(fs){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:fs})},ru=function(){if(!Or(this,Lr)){Cs(this,Lr,!0);for(const fs of Or(this,Wr).values())fs.enable()}},su=function(){if(this.unselectAll(),Or(this,Lr)){Cs(this,Lr,!1);for(const fs of Or(this,Wr).values())fs.disable()}},_l=function(fs){const Os=Or(this,Wr).get(fs.pageIndex);Os?Os.addOrRebuild(fs):this.addEditor(fs)},Ro=function(){if(Or(this,Br).size===0)return!0;if(Or(this,Br).size===1)for(const fs of Or(this,Br).values())return fs.isEmpty();return!1},Rl=function(fs){Or(this,Gr).clear();for(const Os of fs)Os.isEmpty()||(Or(this,Gr).add(Os),Os.select());js(this,gs,co).call(this,{hasSelectedEditor:!0})},io(to,"TRANSLATE_SMALL",1),io(to,"TRANSLATE_BIG",10);let vr=to;or.AnnotationEditorUIManager=vr},(ar,or,lr)=>{var ts,Qr,Hr,Kr,rs,Mr,Dr,Lr,Fr,$r,Vr,Gr,fo,go,Sl,Do,Io,So,No;Object.defineProperty(or,"__esModule",{value:!0}),or.StatTimer=or.RenderingCancelledException=or.PixelsPerInch=or.PageViewport=or.PDFDateString=or.DOMStandardFontDataFactory=or.DOMSVGFactory=or.DOMFilterFactory=or.DOMCanvasFactory=or.DOMCMapReaderFactory=void 0,or.deprecated=Nr,or.getColorValues=Br,or.getCurrentTransform=Wr,or.getCurrentTransformInverse=Yr,or.getFilenameFromUrl=_r,or.getPdfFilenameFromUrl=wr,or.getRGB=Ir,or.getXfaPageViewport=Pr,or.isDataScheme=jr,or.isPdfFile=br,or.isValidFetchUrl=Ar,or.loadScript=kr,or.noContextMenu=Sr,or.setLayerDimensions=es;var cr=lr(7),ur=lr(1);const dr="http://www.w3.org/2000/svg",ps=class ps{};io(ps,"CSS",96),io(ps,"PDF",72),io(ps,"PDF_TO_CSS_UNITS",ps.CSS/ps.PDF);let hr=ps;or.PixelsPerInch=hr;class pr extends cr.BaseFilterFactory{constructor({docId:Ur,ownerDocument:Xr=globalThis.document}={}){super();Ss(this,Gr);Ss(this,ts);Ss(this,Qr);Ss(this,Hr);Ss(this,Kr);Ss(this,rs);Ss(this,Mr);Ss(this,Dr);Ss(this,Lr);Ss(this,Fr);Ss(this,$r);Ss(this,Vr,0);Cs(this,Hr,Ur),Cs(this,Kr,Xr)}addFilter(Ur){if(!Ur)return"none";let Xr=Or(this,Gr,fo).get(Ur);if(Xr)return Xr;let cs,xs,Es,Ns;if(Ur.length===1){const Us=Ur[0],xa=new Array(256);for(let Gs=0;Gs<256;Gs++)xa[Gs]=Us[Gs]/255;Ns=cs=xs=Es=xa.join(",")}else{const[Us,xa,Gs]=Ur,$a=new Array(256),Js=new Array(256),ga=new Array(256);for(let ro=0;ro<256;ro++)$a[ro]=Us[ro]/255,Js[ro]=xa[ro]/255,ga[ro]=Gs[ro]/255;cs=$a.join(","),xs=Js.join(","),Es=ga.join(","),Ns=`${cs}${xs}${Es}`}if(Xr=Or(this,Gr,fo).get(Ns),Xr)return Or(this,Gr,fo).set(Ur,Xr),Xr;const Ts=`g_${Or(this,Hr)}_transfer_map_${wo(this,Vr)._++}`,gs=`url(#${Ts})`;Or(this,Gr,fo).set(Ur,gs),Or(this,Gr,fo).set(Ns,gs);const Hs=js(this,Gr,Do).call(this,Ts);return js(this,Gr,So).call(this,cs,xs,Es,Hs),gs}addHCMFilter(Ur,Xr){var xa;const cs=`${Ur}-${Xr}`;if(Or(this,Mr)===cs)return Or(this,Dr);if(Cs(this,Mr,cs),Cs(this,Dr,"none"),(xa=Or(this,rs))==null||xa.remove(),!Ur||!Xr)return Or(this,Dr);const xs=js(this,Gr,No).call(this,Ur);Ur=ur.Util.makeHexColor(...xs);const Es=js(this,Gr,No).call(this,Xr);if(Xr=ur.Util.makeHexColor(...Es),Or(this,Gr,go).style.color="",Ur==="#000000"&&Xr==="#ffffff"||Ur===Xr)return Or(this,Dr);const Ns=new Array(256);for(let Gs=0;Gs<=255;Gs++){const $a=Gs/255;Ns[Gs]=$a<=.03928?$a/12.92:(($a+.055)/1.055)**2.4}const Ts=Ns.join(","),gs=`g_${Or(this,Hr)}_hcm_filter`,Hs=Cs(this,Lr,js(this,Gr,Do).call(this,gs));js(this,Gr,So).call(this,Ts,Ts,Ts,Hs),js(this,Gr,Sl).call(this,Hs);const Us=(Gs,$a)=>{const Js=xs[Gs]/255,ga=Es[Gs]/255,ro=new Array($a+1);for(let no=0;no<=$a;no++)ro[no]=Js+no/$a*(ga-Js);return ro.join(",")};return js(this,Gr,So).call(this,Us(0,5),Us(1,5),Us(2,5),Hs),Cs(this,Dr,`url(#${gs})`),Or(this,Dr)}addHighlightHCMFilter(Ur,Xr,cs,xs){var ga;const Es=`${Ur}-${Xr}-${cs}-${xs}`;if(Or(this,Fr)===Es)return Or(this,$r);if(Cs(this,Fr,Es),Cs(this,$r,"none"),(ga=Or(this,Lr))==null||ga.remove(),!Ur||!Xr)return Or(this,$r);const[Ns,Ts]=[Ur,Xr].map(js(this,Gr,No).bind(this));let gs=Math.round(.2126*Ns[0]+.7152*Ns[1]+.0722*Ns[2]),Hs=Math.round(.2126*Ts[0]+.7152*Ts[1]+.0722*Ts[2]),[Us,xa]=[cs,xs].map(js(this,Gr,No).bind(this));Hs<gs&&([gs,Hs,Us,xa]=[Hs,gs,xa,Us]),Or(this,Gr,go).style.color="";const Gs=(ro,no,$s)=>{const Rs=new Array(256),ks=(Hs-gs)/$s,qs=ro/255,to=(no-ro)/(255*$s);let eo=0;for(let fs=0;fs<=$s;fs++){const Os=Math.round(gs+fs*ks),zs=qs+fs*to;for(let Zs=eo;Zs<=Os;Zs++)Rs[Zs]=zs;eo=Os+1}for(let fs=eo;fs<256;fs++)Rs[fs]=Rs[eo-1];return Rs.join(",")},$a=`g_${Or(this,Hr)}_hcm_highlight_filter`,Js=Cs(this,Lr,js(this,Gr,Do).call(this,$a));return js(this,Gr,Sl).call(this,Js),js(this,Gr,So).call(this,Gs(Us[0],xa[0],5),Gs(Us[1],xa[1],5),Gs(Us[2],xa[2],5),Js),Cs(this,$r,`url(#${$a})`),Or(this,$r)}destroy(Ur=!1){Ur&&(Or(this,Dr)||Or(this,$r))||(Or(this,Qr)&&(Or(this,Qr).parentNode.parentNode.remove(),Cs(this,Qr,null)),Or(this,ts)&&(Or(this,ts).clear(),Cs(this,ts,null)),Cs(this,Vr,0))}}ts=new WeakMap,Qr=new WeakMap,Hr=new WeakMap,Kr=new WeakMap,rs=new WeakMap,Mr=new WeakMap,Dr=new WeakMap,Lr=new WeakMap,Fr=new WeakMap,$r=new WeakMap,Vr=new WeakMap,Gr=new WeakSet,fo=function(){return Or(this,ts)||Cs(this,ts,new Map)},go=function(){if(!Or(this,Qr)){const Ur=Or(this,Kr).createElement("div"),{style:Xr}=Ur;Xr.visibility="hidden",Xr.contain="strict",Xr.width=Xr.height=0,Xr.position="absolute",Xr.top=Xr.left=0,Xr.zIndex=-1;const cs=Or(this,Kr).createElementNS(dr,"svg");cs.setAttribute("width",0),cs.setAttribute("height",0),Cs(this,Qr,Or(this,Kr).createElementNS(dr,"defs")),Ur.append(cs),cs.append(Or(this,Qr)),Or(this,Kr).body.append(Ur)}return Or(this,Qr)},Sl=function(Ur){const Xr=Or(this,Kr).createElementNS(dr,"feColorMatrix");Xr.setAttribute("type","matrix"),Xr.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),Ur.append(Xr)},Do=function(Ur){const Xr=Or(this,Kr).createElementNS(dr,"filter");return Xr.setAttribute("color-interpolation-filters","sRGB"),Xr.setAttribute("id",Ur),Or(this,Gr,go).append(Xr),Xr},Io=function(Ur,Xr,cs){const xs=Or(this,Kr).createElementNS(dr,Xr);xs.setAttribute("type","discrete"),xs.setAttribute("tableValues",cs),Ur.append(xs)},So=function(Ur,Xr,cs,xs){const Es=Or(this,Kr).createElementNS(dr,"feComponentTransfer");xs.append(Es),js(this,Gr,Io).call(this,Es,"feFuncR",Ur),js(this,Gr,Io).call(this,Es,"feFuncG",Xr),js(this,Gr,Io).call(this,Es,"feFuncB",cs)},No=function(Ur){return Or(this,Gr,go).style.color=Ur,Ir(getComputedStyle(Or(this,Gr,go)).getPropertyValue("color"))},or.DOMFilterFactory=pr;class xr extends cr.BaseCanvasFactory{constructor({ownerDocument:ss=globalThis.document}={}){super(),this._document=ss}_createCanvas(ss,Ur){const Xr=this._document.createElement("canvas");return Xr.width=ss,Xr.height=Ur,Xr}}or.DOMCanvasFactory=xr;async function mr(ys,ss=!1){if(Ar(ys,document.baseURI)){const Ur=await fetch(ys);if(!Ur.ok)throw new Error(Ur.statusText);return ss?new Uint8Array(await Ur.arrayBuffer()):(0,ur.stringToBytes)(await Ur.text())}return new Promise((Ur,Xr)=>{const cs=new XMLHttpRequest;cs.open("GET",ys,!0),ss&&(cs.responseType="arraybuffer"),cs.onreadystatechange=()=>{if(cs.readyState===XMLHttpRequest.DONE){if(cs.status===200||cs.status===0){let xs;if(ss&&cs.response?xs=new Uint8Array(cs.response):!ss&&cs.responseText&&(xs=(0,ur.stringToBytes)(cs.responseText)),xs){Ur(xs);return}}Xr(new Error(cs.statusText))}},cs.send(null)})}class fr extends cr.BaseCMapReaderFactory{_fetchData(ss,Ur){return mr(ss,this.isCompressed).then(Xr=>({cMapData:Xr,compressionType:Ur}))}}or.DOMCMapReaderFactory=fr;class Er extends cr.BaseStandardFontDataFactory{_fetchData(ss){return mr(ss,!0)}}or.DOMStandardFontDataFactory=Er;class vr extends cr.BaseSVGFactory{_createSVG(ss){return document.createElementNS(dr,ss)}}or.DOMSVGFactory=vr;class gr{constructor({viewBox:ss,scale:Ur,rotation:Xr,offsetX:cs=0,offsetY:xs=0,dontFlip:Es=!1}){this.viewBox=ss,this.scale=Ur,this.rotation=Xr,this.offsetX=cs,this.offsetY=xs;const Ns=(ss[2]+ss[0])/2,Ts=(ss[3]+ss[1])/2;let gs,Hs,Us,xa;switch(Xr%=360,Xr<0&&(Xr+=360),Xr){case 180:gs=-1,Hs=0,Us=0,xa=1;break;case 90:gs=0,Hs=1,Us=1,xa=0;break;case 270:gs=0,Hs=-1,Us=-1,xa=0;break;case 0:gs=1,Hs=0,Us=0,xa=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Es&&(Us=-Us,xa=-xa);let Gs,$a,Js,ga;gs===0?(Gs=Math.abs(Ts-ss[1])*Ur+cs,$a=Math.abs(Ns-ss[0])*Ur+xs,Js=(ss[3]-ss[1])*Ur,ga=(ss[2]-ss[0])*Ur):(Gs=Math.abs(Ns-ss[0])*Ur+cs,$a=Math.abs(Ts-ss[1])*Ur+xs,Js=(ss[2]-ss[0])*Ur,ga=(ss[3]-ss[1])*Ur),this.transform=[gs*Ur,Hs*Ur,Us*Ur,xa*Ur,Gs-gs*Ur*Ns-Us*Ur*Ts,$a-Hs*Ur*Ns-xa*Ur*Ts],this.width=Js,this.height=ga}get rawDims(){const{viewBox:ss}=this;return(0,ur.shadow)(this,"rawDims",{pageWidth:ss[2]-ss[0],pageHeight:ss[3]-ss[1],pageX:ss[0],pageY:ss[1]})}clone({scale:ss=this.scale,rotation:Ur=this.rotation,offsetX:Xr=this.offsetX,offsetY:cs=this.offsetY,dontFlip:xs=!1}={}){return new gr({viewBox:this.viewBox.slice(),scale:ss,rotation:Ur,offsetX:Xr,offsetY:cs,dontFlip:xs})}convertToViewportPoint(ss,Ur){return ur.Util.applyTransform([ss,Ur],this.transform)}convertToViewportRectangle(ss){const Ur=ur.Util.applyTransform([ss[0],ss[1]],this.transform),Xr=ur.Util.applyTransform([ss[2],ss[3]],this.transform);return[Ur[0],Ur[1],Xr[0],Xr[1]]}convertToPdfPoint(ss,Ur){return ur.Util.applyInverseTransform([ss,Ur],this.transform)}}or.PageViewport=gr;class yr extends ur.BaseException{constructor(ss,Ur=0){super(ss,"RenderingCancelledException"),this.extraDelay=Ur}}or.RenderingCancelledException=yr;function jr(ys){const ss=ys.length;let Ur=0;for(;Ur<ss&&ys[Ur].trim()==="";)Ur++;return ys.substring(Ur,Ur+5).toLowerCase()==="data:"}function br(ys){return typeof ys=="string"&&/\.pdf$/i.test(ys)}function _r(ys,ss=!1){return ss||([ys]=ys.split(/[#?]/,1)),ys.substring(ys.lastIndexOf("/")+1)}function wr(ys,ss="document.pdf"){if(typeof ys!="string")return ss;if(jr(ys))return(0,ur.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),ss;const Ur=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Xr=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,cs=Ur.exec(ys);let xs=Xr.exec(cs[1])||Xr.exec(cs[2])||Xr.exec(cs[3]);if(xs&&(xs=xs[0],xs.includes("%")))try{xs=Xr.exec(decodeURIComponent(xs))[0]}catch{}return xs||ss}class Rr{constructor(){io(this,"started",Object.create(null));io(this,"times",[])}time(ss){ss in this.started&&(0,ur.warn)(`Timer is already running for ${ss}`),this.started[ss]=Date.now()}timeEnd(ss){ss in this.started||(0,ur.warn)(`Timer has not been started for ${ss}`),this.times.push({name:ss,start:this.started[ss],end:Date.now()}),delete this.started[ss]}toString(){const ss=[];let Ur=0;for(const{name:Xr}of this.times)Ur=Math.max(Xr.length,Ur);for(const{name:Xr,start:cs,end:xs}of this.times)ss.push(`${Xr.padEnd(Ur)} ${xs-cs}ms
`);return ss.join("")}}or.StatTimer=Rr;function Ar(ys,ss){try{const{protocol:Ur}=ss?new URL(ys,ss):new URL(ys);return Ur==="http:"||Ur==="https:"}catch{return!1}}function Sr(ys){ys.preventDefault()}function kr(ys,ss=!1){return new Promise((Ur,Xr)=>{const cs=document.createElement("script");cs.src=ys,cs.onload=function(xs){ss&&cs.remove(),Ur(xs)},cs.onerror=function(){Xr(new Error(`Cannot load script at: ${cs.src}`))},(document.head||document.documentElement).append(cs)})}function Nr(ys){console.log("Deprecated API usage: "+ys)}let Cr;class Tr{static toDateObject(ss){if(!ss||typeof ss!="string")return null;Cr||(Cr=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const Ur=Cr.exec(ss);if(!Ur)return null;const Xr=parseInt(Ur[1],10);let cs=parseInt(Ur[2],10);cs=cs>=1&&cs<=12?cs-1:0;let xs=parseInt(Ur[3],10);xs=xs>=1&&xs<=31?xs:1;let Es=parseInt(Ur[4],10);Es=Es>=0&&Es<=23?Es:0;let Ns=parseInt(Ur[5],10);Ns=Ns>=0&&Ns<=59?Ns:0;let Ts=parseInt(Ur[6],10);Ts=Ts>=0&&Ts<=59?Ts:0;const gs=Ur[7]||"Z";let Hs=parseInt(Ur[8],10);Hs=Hs>=0&&Hs<=23?Hs:0;let Us=parseInt(Ur[9],10)||0;return Us=Us>=0&&Us<=59?Us:0,gs==="-"?(Es+=Hs,Ns+=Us):gs==="+"&&(Es-=Hs,Ns-=Us),new Date(Date.UTC(Xr,cs,xs,Es,Ns,Ts))}}or.PDFDateString=Tr;function Pr(ys,{scale:ss=1,rotation:Ur=0}){const{width:Xr,height:cs}=ys.attributes.style,xs=[0,0,parseInt(Xr),parseInt(cs)];return new gr({viewBox:xs,scale:ss,rotation:Ur})}function Ir(ys){if(ys.startsWith("#")){const ss=parseInt(ys.slice(1),16);return[(ss&16711680)>>16,(ss&65280)>>8,ss&255]}return ys.startsWith("rgb(")?ys.slice(4,-1).split(",").map(ss=>parseInt(ss)):ys.startsWith("rgba(")?ys.slice(5,-1).split(",").map(ss=>parseInt(ss)).slice(0,3):((0,ur.warn)(`Not a valid color format: "${ys}"`),[0,0,0])}function Br(ys){const ss=document.createElement("span");ss.style.visibility="hidden",document.body.append(ss);for(const Ur of ys.keys()){ss.style.color=Ur;const Xr=window.getComputedStyle(ss).color;ys.set(Ur,Ir(Xr))}ss.remove()}function Wr(ys){const{a:ss,b:Ur,c:Xr,d:cs,e:xs,f:Es}=ys.getTransform();return[ss,Ur,Xr,cs,xs,Es]}function Yr(ys){const{a:ss,b:Ur,c:Xr,d:cs,e:xs,f:Es}=ys.getTransform().invertSelf();return[ss,Ur,Xr,cs,xs,Es]}function es(ys,ss,Ur=!1,Xr=!0){if(ss instanceof gr){const{pageWidth:cs,pageHeight:xs}=ss.rawDims,{style:Es}=ys,Ns=ur.FeatureTest.isCSSRoundSupported,Ts=`var(--scale-factor) * ${cs}px`,gs=`var(--scale-factor) * ${xs}px`,Hs=Ns?`round(${Ts}, 1px)`:`calc(${Ts})`,Us=Ns?`round(${gs}, 1px)`:`calc(${gs})`;!Ur||ss.rotation%180===0?(Es.width=Hs,Es.height=Us):(Es.width=Us,Es.height=Hs)}Xr&&ys.setAttribute("data-main-rotation",ss.rotation)}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.BaseStandardFontDataFactory=or.BaseSVGFactory=or.BaseFilterFactory=or.BaseCanvasFactory=or.BaseCMapReaderFactory=void 0;var cr=lr(1);class ur{constructor(){this.constructor===ur&&(0,cr.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(fr){return"none"}addHCMFilter(fr,Er){return"none"}addHighlightHCMFilter(fr,Er,vr,gr){return"none"}destroy(fr=!1){}}or.BaseFilterFactory=ur;class dr{constructor(){this.constructor===dr&&(0,cr.unreachable)("Cannot initialize BaseCanvasFactory.")}create(fr,Er){if(fr<=0||Er<=0)throw new Error("Invalid canvas size");const vr=this._createCanvas(fr,Er);return{canvas:vr,context:vr.getContext("2d")}}reset(fr,Er,vr){if(!fr.canvas)throw new Error("Canvas is not specified");if(Er<=0||vr<=0)throw new Error("Invalid canvas size");fr.canvas.width=Er,fr.canvas.height=vr}destroy(fr){if(!fr.canvas)throw new Error("Canvas is not specified");fr.canvas.width=0,fr.canvas.height=0,fr.canvas=null,fr.context=null}_createCanvas(fr,Er){(0,cr.unreachable)("Abstract method `_createCanvas` called.")}}or.BaseCanvasFactory=dr;class hr{constructor({baseUrl:fr=null,isCompressed:Er=!0}){this.constructor===hr&&(0,cr.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=fr,this.isCompressed=Er}async fetch({name:fr}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!fr)throw new Error("CMap name must be specified.");const Er=this.baseUrl+fr+(this.isCompressed?".bcmap":""),vr=this.isCompressed?cr.CMapCompressionType.BINARY:cr.CMapCompressionType.NONE;return this._fetchData(Er,vr).catch(gr=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${Er}`)})}_fetchData(fr,Er){(0,cr.unreachable)("Abstract method `_fetchData` called.")}}or.BaseCMapReaderFactory=hr;class pr{constructor({baseUrl:fr=null}){this.constructor===pr&&(0,cr.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=fr}async fetch({filename:fr}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!fr)throw new Error("Font filename must be specified.");const Er=`${this.baseUrl}${fr}`;return this._fetchData(Er).catch(vr=>{throw new Error(`Unable to load font data at: ${Er}`)})}_fetchData(fr){(0,cr.unreachable)("Abstract method `_fetchData` called.")}}or.BaseStandardFontDataFactory=pr;class xr{constructor(){this.constructor===xr&&(0,cr.unreachable)("Cannot initialize BaseSVGFactory.")}create(fr,Er,vr=!1){if(fr<=0||Er<=0)throw new Error("Invalid SVG dimensions");const gr=this._createSVG("svg:svg");return gr.setAttribute("version","1.1"),vr||(gr.setAttribute("width",`${fr}px`),gr.setAttribute("height",`${Er}px`)),gr.setAttribute("preserveAspectRatio","none"),gr.setAttribute("viewBox",`0 0 ${fr} ${Er}`),gr}createElement(fr){if(typeof fr!="string")throw new Error("Invalid SVG element type");return this._createSVG(fr)}_createSVG(fr){(0,cr.unreachable)("Abstract method `_createSVG` called.")}}or.BaseSVGFactory=xr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.MurmurHash3_64=void 0;var cr=lr(1);const ur=3285377520,dr=4294901760,hr=65535;class pr{constructor(mr){this.h1=mr?mr&4294967295:ur,this.h2=mr?mr&4294967295:ur}update(mr){let fr,Er;if(typeof mr=="string"){fr=new Uint8Array(mr.length*2),Er=0;for(let Nr=0,Cr=mr.length;Nr<Cr;Nr++){const Tr=mr.charCodeAt(Nr);Tr<=255?fr[Er++]=Tr:(fr[Er++]=Tr>>>8,fr[Er++]=Tr&255)}}else if((0,cr.isArrayBuffer)(mr))fr=mr.slice(),Er=fr.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const vr=Er>>2,gr=Er-vr*4,yr=new Uint32Array(fr.buffer,0,vr);let jr=0,br=0,_r=this.h1,wr=this.h2;const Rr=3432918353,Ar=461845907,Sr=Rr&hr,kr=Ar&hr;for(let Nr=0;Nr<vr;Nr++)Nr&1?(jr=yr[Nr],jr=jr*Rr&dr|jr*Sr&hr,jr=jr<<15|jr>>>17,jr=jr*Ar&dr|jr*kr&hr,_r^=jr,_r=_r<<13|_r>>>19,_r=_r*5+3864292196):(br=yr[Nr],br=br*Rr&dr|br*Sr&hr,br=br<<15|br>>>17,br=br*Ar&dr|br*kr&hr,wr^=br,wr=wr<<13|wr>>>19,wr=wr*5+3864292196);switch(jr=0,gr){case 3:jr^=fr[vr*4+2]<<16;case 2:jr^=fr[vr*4+1]<<8;case 1:jr^=fr[vr*4],jr=jr*Rr&dr|jr*Sr&hr,jr=jr<<15|jr>>>17,jr=jr*Ar&dr|jr*kr&hr,vr&1?_r^=jr:wr^=jr}this.h1=_r,this.h2=wr}hexdigest(){let mr=this.h1,fr=this.h2;return mr^=fr>>>1,mr=mr*3981806797&dr|mr*36045&hr,fr=fr*4283543511&dr|((fr<<16|mr>>>16)*2950163797&dr)>>>16,mr^=fr>>>1,mr=mr*444984403&dr|mr*60499&hr,fr=fr*3301882366&dr|((fr<<16|mr>>>16)*3120437893&dr)>>>16,mr^=fr>>>1,(mr>>>0).toString(16).padStart(8,"0")+(fr>>>0).toString(16).padStart(8,"0")}}or.MurmurHash3_64=pr},(ar,or,lr)=>{var hr;Object.defineProperty(or,"__esModule",{value:!0}),or.FontLoader=or.FontFaceObject=void 0;var cr=lr(1);class ur{constructor({ownerDocument:xr=globalThis.document,styleElement:mr=null}){Ss(this,hr,new Set);this._document=xr,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(xr){this.nativeFontFaces.add(xr),this._document.fonts.add(xr)}removeNativeFontFace(xr){this.nativeFontFaces.delete(xr),this._document.fonts.delete(xr)}insertRule(xr){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const mr=this.styleElement.sheet;mr.insertRule(xr,mr.cssRules.length)}clear(){for(const xr of this.nativeFontFaces)this._document.fonts.delete(xr);this.nativeFontFaces.clear(),Or(this,hr).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(xr){if(!(!xr||Or(this,hr).has(xr.loadedName))){if((0,cr.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:mr,src:fr,style:Er}=xr,vr=new FontFace(mr,fr,Er);this.addNativeFontFace(vr);try{await vr.load(),Or(this,hr).add(mr)}catch{(0,cr.warn)(`Cannot load system font: ${xr.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(vr)}return}(0,cr.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(xr){if(xr.attached||xr.missingFile&&!xr.systemFontInfo)return;if(xr.attached=!0,xr.systemFontInfo){await this.loadSystemFont(xr.systemFontInfo);return}if(this.isFontLoadingAPISupported){const fr=xr.createNativeFontFace();if(fr){this.addNativeFontFace(fr);try{await fr.loaded}catch(Er){throw(0,cr.warn)(`Failed to load font '${fr.family}': '${Er}'.`),xr.disableFontFace=!0,Er}}return}const mr=xr.createFontFaceRule();if(mr){if(this.insertRule(mr),this.isSyncFontLoadingSupported)return;await new Promise(fr=>{const Er=this._queueLoadingCallback(fr);this._prepareFontLoadEvent(xr,Er)})}}get isFontLoadingAPISupported(){var mr;const xr=!!((mr=this._document)!=null&&mr.fonts);return(0,cr.shadow)(this,"isFontLoadingAPISupported",xr)}get isSyncFontLoadingSupported(){let xr=!1;return(cr.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(xr=!0),(0,cr.shadow)(this,"isSyncFontLoadingSupported",xr)}_queueLoadingCallback(xr){function mr(){for((0,cr.assert)(!Er.done,"completeRequest() cannot be called twice."),Er.done=!0;fr.length>0&&fr[0].done;){const vr=fr.shift();setTimeout(vr.callback,0)}}const{loadingRequests:fr}=this,Er={done:!1,complete:mr,callback:xr};return fr.push(Er),Er}get _loadTestFont(){const xr=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,cr.shadow)(this,"_loadTestFont",xr)}_prepareFontLoadEvent(xr,mr){function fr(Ir,Br){return Ir.charCodeAt(Br)<<24|Ir.charCodeAt(Br+1)<<16|Ir.charCodeAt(Br+2)<<8|Ir.charCodeAt(Br+3)&255}function Er(Ir,Br,Wr,Yr){const es=Ir.substring(0,Br),ps=Ir.substring(Br+Wr);return es+Yr+ps}let vr,gr;const yr=this._document.createElement("canvas");yr.width=1,yr.height=1;const jr=yr.getContext("2d");let br=0;function _r(Ir,Br){if(++br>30){(0,cr.warn)("Load test font never loaded."),Br();return}if(jr.font="30px "+Ir,jr.fillText(".",0,20),jr.getImageData(0,0,1,1).data[3]>0){Br();return}setTimeout(_r.bind(null,Ir,Br))}const wr=`lt${Date.now()}${this.loadTestFontId++}`;let Rr=this._loadTestFont;Rr=Er(Rr,976,wr.length,wr);const Sr=16,kr=1482184792;let Nr=fr(Rr,Sr);for(vr=0,gr=wr.length-3;vr<gr;vr+=4)Nr=Nr-kr+fr(wr,vr)|0;vr<wr.length&&(Nr=Nr-kr+fr(wr+"XXX",vr)|0),Rr=Er(Rr,Sr,4,(0,cr.string32)(Nr));const Cr=`url(data:font/opentype;base64,${btoa(Rr)});`,Tr=`@font-face {font-family:"${wr}";src:${Cr}}`;this.insertRule(Tr);const Pr=this._document.createElement("div");Pr.style.visibility="hidden",Pr.style.width=Pr.style.height="10px",Pr.style.position="absolute",Pr.style.top=Pr.style.left="0px";for(const Ir of[xr.loadedName,wr]){const Br=this._document.createElement("span");Br.textContent="Hi",Br.style.fontFamily=Ir,Pr.append(Br)}this._document.body.append(Pr),_r(wr,()=>{Pr.remove(),mr.complete()})}}hr=new WeakMap,or.FontLoader=ur;class dr{constructor(xr,{isEvalSupported:mr=!0,disableFontFace:fr=!1,ignoreErrors:Er=!1,inspectFont:vr=null}){this.compiledGlyphs=Object.create(null);for(const gr in xr)this[gr]=xr[gr];this.isEvalSupported=mr!==!1,this.disableFontFace=fr===!0,this.ignoreErrors=Er===!0,this._inspectFont=vr}createNativeFontFace(){var mr;if(!this.data||this.disableFontFace)return null;let xr;if(!this.cssFontInfo)xr=new FontFace(this.loadedName,this.data,{});else{const fr={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(fr.style=`oblique ${this.cssFontInfo.italicAngle}deg`),xr=new FontFace(this.cssFontInfo.fontFamily,this.data,fr)}return(mr=this._inspectFont)==null||mr.call(this,this),xr}createFontFaceRule(){var Er;if(!this.data||this.disableFontFace)return null;const xr=(0,cr.bytesToString)(this.data),mr=`url(data:${this.mimetype};base64,${btoa(xr)});`;let fr;if(!this.cssFontInfo)fr=`@font-face {font-family:"${this.loadedName}";src:${mr}}`;else{let vr=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(vr+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),fr=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${vr}src:${mr}}`}return(Er=this._inspectFont)==null||Er.call(this,this,mr),fr}getPathGenerator(xr,mr){if(this.compiledGlyphs[mr]!==void 0)return this.compiledGlyphs[mr];let fr;try{fr=xr.get(this.loadedName+"_path_"+mr)}catch(Er){if(!this.ignoreErrors)throw Er;return(0,cr.warn)(`getPathGenerator - ignoring character: "${Er}".`),this.compiledGlyphs[mr]=function(vr,gr){}}if(this.isEvalSupported&&cr.FeatureTest.isEvalSupported){const Er=[];for(const vr of fr){const gr=vr.args!==void 0?vr.args.join(","):"";Er.push("c.",vr.cmd,"(",gr,`);
`)}return this.compiledGlyphs[mr]=new Function("c","size",Er.join(""))}return this.compiledGlyphs[mr]=function(Er,vr){for(const gr of fr)gr.cmd==="scale"&&(gr.args=[vr,-vr]),Er[gr.cmd].apply(Er,gr.args)}}}or.FontFaceObject=dr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.NodeStandardFontDataFactory=or.NodeFilterFactory=or.NodeCanvasFactory=or.NodeCMapReaderFactory=void 0;var cr=lr(7);lr(1);const ur=function(mr){return new Promise((fr,Er)=>{require$$5.readFile(mr,(gr,yr)=>{if(gr||!yr){Er(new Error(gr));return}fr(new Uint8Array(yr))})})};class dr extends cr.BaseFilterFactory{}or.NodeFilterFactory=dr;class hr extends cr.BaseCanvasFactory{_createCanvas(fr,Er){return require$$5.createCanvas(fr,Er)}}or.NodeCanvasFactory=hr;class pr extends cr.BaseCMapReaderFactory{_fetchData(fr,Er){return ur(fr).then(vr=>({cMapData:vr,compressionType:Er}))}}or.NodeCMapReaderFactory=pr;class xr extends cr.BaseStandardFontDataFactory{_fetchData(fr){return ur(fr)}}or.NodeStandardFontDataFactory=xr},(ar,or,lr)=>{var Qr,Nl,Cl;Object.defineProperty(or,"__esModule",{value:!0}),or.CanvasGraphics=void 0;var cr=lr(1),ur=lr(6),dr=lr(12),hr=lr(13);const pr=16,xr=100,mr=4096,fr=15,Er=10,vr=1e3,gr=16;function yr(Mr,Dr){if(Mr._removeMirroring)throw new Error("Context is already forwarding operations.");Mr.__originalSave=Mr.save,Mr.__originalRestore=Mr.restore,Mr.__originalRotate=Mr.rotate,Mr.__originalScale=Mr.scale,Mr.__originalTranslate=Mr.translate,Mr.__originalTransform=Mr.transform,Mr.__originalSetTransform=Mr.setTransform,Mr.__originalResetTransform=Mr.resetTransform,Mr.__originalClip=Mr.clip,Mr.__originalMoveTo=Mr.moveTo,Mr.__originalLineTo=Mr.lineTo,Mr.__originalBezierCurveTo=Mr.bezierCurveTo,Mr.__originalRect=Mr.rect,Mr.__originalClosePath=Mr.closePath,Mr.__originalBeginPath=Mr.beginPath,Mr._removeMirroring=()=>{Mr.save=Mr.__originalSave,Mr.restore=Mr.__originalRestore,Mr.rotate=Mr.__originalRotate,Mr.scale=Mr.__originalScale,Mr.translate=Mr.__originalTranslate,Mr.transform=Mr.__originalTransform,Mr.setTransform=Mr.__originalSetTransform,Mr.resetTransform=Mr.__originalResetTransform,Mr.clip=Mr.__originalClip,Mr.moveTo=Mr.__originalMoveTo,Mr.lineTo=Mr.__originalLineTo,Mr.bezierCurveTo=Mr.__originalBezierCurveTo,Mr.rect=Mr.__originalRect,Mr.closePath=Mr.__originalClosePath,Mr.beginPath=Mr.__originalBeginPath,delete Mr._removeMirroring},Mr.save=function(){Dr.save(),this.__originalSave()},Mr.restore=function(){Dr.restore(),this.__originalRestore()},Mr.translate=function(Fr,$r){Dr.translate(Fr,$r),this.__originalTranslate(Fr,$r)},Mr.scale=function(Fr,$r){Dr.scale(Fr,$r),this.__originalScale(Fr,$r)},Mr.transform=function(Fr,$r,Vr,Gr,Jr,ms){Dr.transform(Fr,$r,Vr,Gr,Jr,ms),this.__originalTransform(Fr,$r,Vr,Gr,Jr,ms)},Mr.setTransform=function(Fr,$r,Vr,Gr,Jr,ms){Dr.setTransform(Fr,$r,Vr,Gr,Jr,ms),this.__originalSetTransform(Fr,$r,Vr,Gr,Jr,ms)},Mr.resetTransform=function(){Dr.resetTransform(),this.__originalResetTransform()},Mr.rotate=function(Fr){Dr.rotate(Fr),this.__originalRotate(Fr)},Mr.clip=function(Fr){Dr.clip(Fr),this.__originalClip(Fr)},Mr.moveTo=function(Lr,Fr){Dr.moveTo(Lr,Fr),this.__originalMoveTo(Lr,Fr)},Mr.lineTo=function(Lr,Fr){Dr.lineTo(Lr,Fr),this.__originalLineTo(Lr,Fr)},Mr.bezierCurveTo=function(Lr,Fr,$r,Vr,Gr,Jr){Dr.bezierCurveTo(Lr,Fr,$r,Vr,Gr,Jr),this.__originalBezierCurveTo(Lr,Fr,$r,Vr,Gr,Jr)},Mr.rect=function(Lr,Fr,$r,Vr){Dr.rect(Lr,Fr,$r,Vr),this.__originalRect(Lr,Fr,$r,Vr)},Mr.closePath=function(){Dr.closePath(),this.__originalClosePath()},Mr.beginPath=function(){Dr.beginPath(),this.__originalBeginPath()}}class jr{constructor(Dr){this.canvasFactory=Dr,this.cache=Object.create(null)}getCanvas(Dr,Lr,Fr){let $r;return this.cache[Dr]!==void 0?($r=this.cache[Dr],this.canvasFactory.reset($r,Lr,Fr)):($r=this.canvasFactory.create(Lr,Fr),this.cache[Dr]=$r),$r}delete(Dr){delete this.cache[Dr]}clear(){for(const Dr in this.cache){const Lr=this.cache[Dr];this.canvasFactory.destroy(Lr),delete this.cache[Dr]}}}function br(Mr,Dr,Lr,Fr,$r,Vr,Gr,Jr,ms,ls){const[ds,bs,ws,Is,ys,ss]=(0,ur.getCurrentTransform)(Mr);if(bs===0&&ws===0){const cs=Gr*ds+ys,xs=Math.round(cs),Es=Jr*Is+ss,Ns=Math.round(Es),Ts=(Gr+ms)*ds+ys,gs=Math.abs(Math.round(Ts)-xs)||1,Hs=(Jr+ls)*Is+ss,Us=Math.abs(Math.round(Hs)-Ns)||1;return Mr.setTransform(Math.sign(ds),0,0,Math.sign(Is),xs,Ns),Mr.drawImage(Dr,Lr,Fr,$r,Vr,0,0,gs,Us),Mr.setTransform(ds,bs,ws,Is,ys,ss),[gs,Us]}if(ds===0&&Is===0){const cs=Jr*ws+ys,xs=Math.round(cs),Es=Gr*bs+ss,Ns=Math.round(Es),Ts=(Jr+ls)*ws+ys,gs=Math.abs(Math.round(Ts)-xs)||1,Hs=(Gr+ms)*bs+ss,Us=Math.abs(Math.round(Hs)-Ns)||1;return Mr.setTransform(0,Math.sign(bs),Math.sign(ws),0,xs,Ns),Mr.drawImage(Dr,Lr,Fr,$r,Vr,0,0,Us,gs),Mr.setTransform(ds,bs,ws,Is,ys,ss),[Us,gs]}Mr.drawImage(Dr,Lr,Fr,$r,Vr,Gr,Jr,ms,ls);const Ur=Math.hypot(ds,bs),Xr=Math.hypot(ws,Is);return[Ur*ms,Xr*ls]}function _r(Mr){const{width:Dr,height:Lr}=Mr;if(Dr>vr||Lr>vr)return null;const Fr=1e3,$r=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),Vr=Dr+1;let Gr=new Uint8Array(Vr*(Lr+1)),Jr,ms,ls;const ds=Dr+7&-8;let bs=new Uint8Array(ds*Lr),ws=0;for(const Xr of Mr.data){let cs=128;for(;cs>0;)bs[ws++]=Xr&cs?0:255,cs>>=1}let Is=0;for(ws=0,bs[ws]!==0&&(Gr[0]=1,++Is),ms=1;ms<Dr;ms++)bs[ws]!==bs[ws+1]&&(Gr[ms]=bs[ws]?2:1,++Is),ws++;for(bs[ws]!==0&&(Gr[ms]=2,++Is),Jr=1;Jr<Lr;Jr++){ws=Jr*ds,ls=Jr*Vr,bs[ws-ds]!==bs[ws]&&(Gr[ls]=bs[ws]?1:8,++Is);let Xr=(bs[ws]?4:0)+(bs[ws-ds]?8:0);for(ms=1;ms<Dr;ms++)Xr=(Xr>>2)+(bs[ws+1]?4:0)+(bs[ws-ds+1]?8:0),$r[Xr]&&(Gr[ls+ms]=$r[Xr],++Is),ws++;if(bs[ws-ds]!==bs[ws]&&(Gr[ls+ms]=bs[ws]?2:4,++Is),Is>Fr)return null}for(ws=ds*(Lr-1),ls=Jr*Vr,bs[ws]!==0&&(Gr[ls]=8,++Is),ms=1;ms<Dr;ms++)bs[ws]!==bs[ws+1]&&(Gr[ls+ms]=bs[ws]?4:8,++Is),ws++;if(bs[ws]!==0&&(Gr[ls+ms]=4,++Is),Is>Fr)return null;const ys=new Int32Array([0,Vr,-1,0,-Vr,0,0,0,1]),ss=new Path2D;for(Jr=0;Is&&Jr<=Lr;Jr++){let Xr=Jr*Vr;const cs=Xr+Dr;for(;Xr<cs&&!Gr[Xr];)Xr++;if(Xr===cs)continue;ss.moveTo(Xr%Vr,Jr);const xs=Xr;let Es=Gr[Xr];do{const Ns=ys[Es];do Xr+=Ns;while(!Gr[Xr]);const Ts=Gr[Xr];Ts!==5&&Ts!==10?(Es=Ts,Gr[Xr]=0):(Es=Ts&51*Es>>4,Gr[Xr]&=Es>>2|Es<<2),ss.lineTo(Xr%Vr,Xr/Vr|0),Gr[Xr]||--Is}while(xs!==Xr);--Jr}return bs=null,Gr=null,function(Xr){Xr.save(),Xr.scale(1/Dr,-1/Lr),Xr.translate(0,-Lr),Xr.fill(ss),Xr.beginPath(),Xr.restore()}}class wr{constructor(Dr,Lr){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=cr.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=cr.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=cr.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,Dr,Lr])}clone(){const Dr=Object.create(this);return Dr.clipBox=this.clipBox.slice(),Dr}setCurrentPoint(Dr,Lr){this.x=Dr,this.y=Lr}updatePathMinMax(Dr,Lr,Fr){[Lr,Fr]=cr.Util.applyTransform([Lr,Fr],Dr),this.minX=Math.min(this.minX,Lr),this.minY=Math.min(this.minY,Fr),this.maxX=Math.max(this.maxX,Lr),this.maxY=Math.max(this.maxY,Fr)}updateRectMinMax(Dr,Lr){const Fr=cr.Util.applyTransform(Lr,Dr),$r=cr.Util.applyTransform(Lr.slice(2),Dr);this.minX=Math.min(this.minX,Fr[0],$r[0]),this.minY=Math.min(this.minY,Fr[1],$r[1]),this.maxX=Math.max(this.maxX,Fr[0],$r[0]),this.maxY=Math.max(this.maxY,Fr[1],$r[1])}updateScalingPathMinMax(Dr,Lr){cr.Util.scaleMinMax(Dr,Lr),this.minX=Math.min(this.minX,Lr[0]),this.maxX=Math.max(this.maxX,Lr[1]),this.minY=Math.min(this.minY,Lr[2]),this.maxY=Math.max(this.maxY,Lr[3])}updateCurvePathMinMax(Dr,Lr,Fr,$r,Vr,Gr,Jr,ms,ls,ds){const bs=cr.Util.bezierBoundingBox(Lr,Fr,$r,Vr,Gr,Jr,ms,ls);if(ds){ds[0]=Math.min(ds[0],bs[0],bs[2]),ds[1]=Math.max(ds[1],bs[0],bs[2]),ds[2]=Math.min(ds[2],bs[1],bs[3]),ds[3]=Math.max(ds[3],bs[1],bs[3]);return}this.updateRectMinMax(Dr,bs)}getPathBoundingBox(Dr=dr.PathType.FILL,Lr=null){const Fr=[this.minX,this.minY,this.maxX,this.maxY];if(Dr===dr.PathType.STROKE){Lr||(0,cr.unreachable)("Stroke bounding box must include transform.");const $r=cr.Util.singularValueDecompose2dScale(Lr),Vr=$r[0]*this.lineWidth/2,Gr=$r[1]*this.lineWidth/2;Fr[0]-=Vr,Fr[1]-=Gr,Fr[2]+=Vr,Fr[3]+=Gr}return Fr}updateClipFromPath(){const Dr=cr.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(Dr||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(Dr){this.clipBox=Dr,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(Dr=dr.PathType.FILL,Lr=null){return cr.Util.intersect(this.clipBox,this.getPathBoundingBox(Dr,Lr))}}function Rr(Mr,Dr){if(typeof ImageData<"u"&&Dr instanceof ImageData){Mr.putImageData(Dr,0,0);return}const Lr=Dr.height,Fr=Dr.width,$r=Lr%gr,Vr=(Lr-$r)/gr,Gr=$r===0?Vr:Vr+1,Jr=Mr.createImageData(Fr,gr);let ms=0,ls;const ds=Dr.data,bs=Jr.data;let ws,Is,ys,ss;if(Dr.kind===cr.ImageKind.GRAYSCALE_1BPP){const Ur=ds.byteLength,Xr=new Uint32Array(bs.buffer,0,bs.byteLength>>2),cs=Xr.length,xs=Fr+7>>3,Es=4294967295,Ns=cr.FeatureTest.isLittleEndian?4278190080:255;for(ws=0;ws<Gr;ws++){for(ys=ws<Vr?gr:$r,ls=0,Is=0;Is<ys;Is++){const Ts=Ur-ms;let gs=0;const Hs=Ts>xs?Fr:Ts*8-7,Us=Hs&-8;let xa=0,Gs=0;for(;gs<Us;gs+=8)Gs=ds[ms++],Xr[ls++]=Gs&128?Es:Ns,Xr[ls++]=Gs&64?Es:Ns,Xr[ls++]=Gs&32?Es:Ns,Xr[ls++]=Gs&16?Es:Ns,Xr[ls++]=Gs&8?Es:Ns,Xr[ls++]=Gs&4?Es:Ns,Xr[ls++]=Gs&2?Es:Ns,Xr[ls++]=Gs&1?Es:Ns;for(;gs<Hs;gs++)xa===0&&(Gs=ds[ms++],xa=128),Xr[ls++]=Gs&xa?Es:Ns,xa>>=1}for(;ls<cs;)Xr[ls++]=0;Mr.putImageData(Jr,0,ws*gr)}}else if(Dr.kind===cr.ImageKind.RGBA_32BPP){for(Is=0,ss=Fr*gr*4,ws=0;ws<Vr;ws++)bs.set(ds.subarray(ms,ms+ss)),ms+=ss,Mr.putImageData(Jr,0,Is),Is+=gr;ws<Gr&&(ss=Fr*$r*4,bs.set(ds.subarray(ms,ms+ss)),Mr.putImageData(Jr,0,Is))}else if(Dr.kind===cr.ImageKind.RGB_24BPP)for(ys=gr,ss=Fr*ys,ws=0;ws<Gr;ws++){for(ws>=Vr&&(ys=$r,ss=Fr*ys),ls=0,Is=ss;Is--;)bs[ls++]=ds[ms++],bs[ls++]=ds[ms++],bs[ls++]=ds[ms++],bs[ls++]=255;Mr.putImageData(Jr,0,ws*gr)}else throw new Error(`bad image kind: ${Dr.kind}`)}function Ar(Mr,Dr){if(Dr.bitmap){Mr.drawImage(Dr.bitmap,0,0);return}const Lr=Dr.height,Fr=Dr.width,$r=Lr%gr,Vr=(Lr-$r)/gr,Gr=$r===0?Vr:Vr+1,Jr=Mr.createImageData(Fr,gr);let ms=0;const ls=Dr.data,ds=Jr.data;for(let bs=0;bs<Gr;bs++){const ws=bs<Vr?gr:$r;({srcPos:ms}=(0,hr.convertBlackAndWhiteToRGBA)({src:ls,srcPos:ms,dest:ds,width:Fr,height:ws,nonBlackColor:0})),Mr.putImageData(Jr,0,bs*gr)}}function Sr(Mr,Dr){const Lr=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const Fr of Lr)Mr[Fr]!==void 0&&(Dr[Fr]=Mr[Fr]);Mr.setLineDash!==void 0&&(Dr.setLineDash(Mr.getLineDash()),Dr.lineDashOffset=Mr.lineDashOffset)}function kr(Mr){if(Mr.strokeStyle=Mr.fillStyle="#000000",Mr.fillRule="nonzero",Mr.globalAlpha=1,Mr.lineWidth=1,Mr.lineCap="butt",Mr.lineJoin="miter",Mr.miterLimit=10,Mr.globalCompositeOperation="source-over",Mr.font="10px sans-serif",Mr.setLineDash!==void 0&&(Mr.setLineDash([]),Mr.lineDashOffset=0),!cr.isNodeJS){const{filter:Dr}=Mr;Dr!=="none"&&Dr!==""&&(Mr.filter="none")}}function Nr(Mr,Dr,Lr,Fr){const $r=Mr.length;for(let Vr=3;Vr<$r;Vr+=4){const Gr=Mr[Vr];if(Gr===0)Mr[Vr-3]=Dr,Mr[Vr-2]=Lr,Mr[Vr-1]=Fr;else if(Gr<255){const Jr=255-Gr;Mr[Vr-3]=Mr[Vr-3]*Gr+Dr*Jr>>8,Mr[Vr-2]=Mr[Vr-2]*Gr+Lr*Jr>>8,Mr[Vr-1]=Mr[Vr-1]*Gr+Fr*Jr>>8}}}function Cr(Mr,Dr,Lr){const Fr=Mr.length,$r=1/255;for(let Vr=3;Vr<Fr;Vr+=4){const Gr=Lr?Lr[Mr[Vr]]:Mr[Vr];Dr[Vr]=Dr[Vr]*Gr*$r|0}}function Tr(Mr,Dr,Lr){const Fr=Mr.length;for(let $r=3;$r<Fr;$r+=4){const Vr=Mr[$r-3]*77+Mr[$r-2]*152+Mr[$r-1]*28;Dr[$r]=Lr?Dr[$r]*Lr[Vr>>8]>>8:Dr[$r]*Vr>>16}}function Pr(Mr,Dr,Lr,Fr,$r,Vr,Gr,Jr,ms,ls,ds){const bs=!!Vr,ws=bs?Vr[0]:0,Is=bs?Vr[1]:0,ys=bs?Vr[2]:0,ss=$r==="Luminosity"?Tr:Cr,Xr=Math.min(Fr,Math.ceil(1048576/Lr));for(let cs=0;cs<Fr;cs+=Xr){const xs=Math.min(Xr,Fr-cs),Es=Mr.getImageData(Jr-ls,cs+(ms-ds),Lr,xs),Ns=Dr.getImageData(Jr,cs+ms,Lr,xs);bs&&Nr(Es.data,ws,Is,ys),ss(Es.data,Ns.data,Gr),Dr.putImageData(Ns,Jr,cs+ms)}}function Ir(Mr,Dr,Lr,Fr){const $r=Fr[0],Vr=Fr[1],Gr=Fr[2]-$r,Jr=Fr[3]-Vr;Gr===0||Jr===0||(Pr(Dr.context,Lr,Gr,Jr,Dr.subtype,Dr.backdrop,Dr.transferMap,$r,Vr,Dr.offsetX,Dr.offsetY),Mr.save(),Mr.globalAlpha=1,Mr.globalCompositeOperation="source-over",Mr.setTransform(1,0,0,1,0,0),Mr.drawImage(Lr.canvas,0,0),Mr.restore())}function Br(Mr,Dr){const Lr=cr.Util.singularValueDecompose2dScale(Mr);Lr[0]=Math.fround(Lr[0]),Lr[1]=Math.fround(Lr[1]);const Fr=Math.fround((globalThis.devicePixelRatio||1)*ur.PixelsPerInch.PDF_TO_CSS_UNITS);return Dr!==void 0?Dr:Lr[0]<=Fr||Lr[1]<=Fr}const Wr=["butt","round","square"],Yr=["miter","round","bevel"],es={},ps={},rs=class rs{constructor(Dr,Lr,Fr,$r,Vr,{optionalContentConfig:Gr,markedContentStack:Jr=null},ms,ls){Ss(this,Qr);this.ctx=Dr,this.current=new wr(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=Lr,this.objs=Fr,this.canvasFactory=$r,this.filterFactory=Vr,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=Jr||[],this.optionalContentConfig=Gr,this.cachedCanvases=new jr(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=ms,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=ls,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(Dr,Lr=null){return typeof Dr=="string"?Dr.startsWith("g_")?this.commonObjs.get(Dr):this.objs.get(Dr):Lr}beginDrawing({transform:Dr,viewport:Lr,transparency:Fr=!1,background:$r=null}){const Vr=this.ctx.canvas.width,Gr=this.ctx.canvas.height,Jr=this.ctx.fillStyle;if(this.ctx.fillStyle=$r||"#ffffff",this.ctx.fillRect(0,0,Vr,Gr),this.ctx.fillStyle=Jr,Fr){const ms=this.cachedCanvases.getCanvas("transparent",Vr,Gr);this.compositeCtx=this.ctx,this.transparentCanvas=ms.canvas,this.ctx=ms.context,this.ctx.save(),this.ctx.transform(...(0,ur.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),kr(this.ctx),Dr&&(this.ctx.transform(...Dr),this.outputScaleX=Dr[0],this.outputScaleY=Dr[0]),this.ctx.transform(...Lr.transform),this.viewportScale=Lr.scale,this.baseTransform=(0,ur.getCurrentTransform)(this.ctx)}executeOperatorList(Dr,Lr,Fr,$r){const Vr=Dr.argsArray,Gr=Dr.fnArray;let Jr=Lr||0;const ms=Vr.length;if(ms===Jr)return Jr;const ls=ms-Jr>Er&&typeof Fr=="function",ds=ls?Date.now()+fr:0;let bs=0;const ws=this.commonObjs,Is=this.objs;let ys;for(;;){if($r!==void 0&&Jr===$r.nextBreakPoint)return $r.breakIt(Jr,Fr),Jr;if(ys=Gr[Jr],ys!==cr.OPS.dependency)this[ys].apply(this,Vr[Jr]);else for(const ss of Vr[Jr]){const Ur=ss.startsWith("g_")?ws:Is;if(!Ur.has(ss))return Ur.get(ss,Fr),Jr}if(Jr++,Jr===ms)return Jr;if(ls&&++bs>Er){if(Date.now()>ds)return Fr(),Jr;bs=0}}}endDrawing(){js(this,Qr,Nl).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const Dr of this._cachedBitmapsMap.values()){for(const Lr of Dr.values())typeof HTMLCanvasElement<"u"&&Lr instanceof HTMLCanvasElement&&(Lr.width=Lr.height=0);Dr.clear()}this._cachedBitmapsMap.clear(),js(this,Qr,Cl).call(this)}_scaleImage(Dr,Lr){const Fr=Dr.width,$r=Dr.height;let Vr=Math.max(Math.hypot(Lr[0],Lr[1]),1),Gr=Math.max(Math.hypot(Lr[2],Lr[3]),1),Jr=Fr,ms=$r,ls="prescale1",ds,bs;for(;Vr>2&&Jr>1||Gr>2&&ms>1;){let ws=Jr,Is=ms;Vr>2&&Jr>1&&(ws=Jr>=16384?Math.floor(Jr/2)-1||1:Math.ceil(Jr/2),Vr/=Jr/ws),Gr>2&&ms>1&&(Is=ms>=16384?Math.floor(ms/2)-1||1:Math.ceil(ms)/2,Gr/=ms/Is),ds=this.cachedCanvases.getCanvas(ls,ws,Is),bs=ds.context,bs.clearRect(0,0,ws,Is),bs.drawImage(Dr,0,0,Jr,ms,0,0,ws,Is),Dr=ds.canvas,Jr=ws,ms=Is,ls=ls==="prescale1"?"prescale2":"prescale1"}return{img:Dr,paintWidth:Jr,paintHeight:ms}}_createMaskCanvas(Dr){const Lr=this.ctx,{width:Fr,height:$r}=Dr,Vr=this.current.fillColor,Gr=this.current.patternFill,Jr=(0,ur.getCurrentTransform)(Lr);let ms,ls,ds,bs;if((Dr.bitmap||Dr.data)&&Dr.count>1){const gs=Dr.bitmap||Dr.data.buffer;ls=JSON.stringify(Gr?Jr:[Jr.slice(0,4),Vr]),ms=this._cachedBitmapsMap.get(gs),ms||(ms=new Map,this._cachedBitmapsMap.set(gs,ms));const Hs=ms.get(ls);if(Hs&&!Gr){const Us=Math.round(Math.min(Jr[0],Jr[2])+Jr[4]),xa=Math.round(Math.min(Jr[1],Jr[3])+Jr[5]);return{canvas:Hs,offsetX:Us,offsetY:xa}}ds=Hs}ds||(bs=this.cachedCanvases.getCanvas("maskCanvas",Fr,$r),Ar(bs.context,Dr));let ws=cr.Util.transform(Jr,[1/Fr,0,0,-1/$r,0,0]);ws=cr.Util.transform(ws,[1,0,0,1,0,-$r]);const Is=cr.Util.applyTransform([0,0],ws),ys=cr.Util.applyTransform([Fr,$r],ws),ss=cr.Util.normalizeRect([Is[0],Is[1],ys[0],ys[1]]),Ur=Math.round(ss[2]-ss[0])||1,Xr=Math.round(ss[3]-ss[1])||1,cs=this.cachedCanvases.getCanvas("fillCanvas",Ur,Xr),xs=cs.context,Es=Math.min(Is[0],ys[0]),Ns=Math.min(Is[1],ys[1]);xs.translate(-Es,-Ns),xs.transform(...ws),ds||(ds=this._scaleImage(bs.canvas,(0,ur.getCurrentTransformInverse)(xs)),ds=ds.img,ms&&Gr&&ms.set(ls,ds)),xs.imageSmoothingEnabled=Br((0,ur.getCurrentTransform)(xs),Dr.interpolate),br(xs,ds,0,0,ds.width,ds.height,0,0,Fr,$r),xs.globalCompositeOperation="source-in";const Ts=cr.Util.transform((0,ur.getCurrentTransformInverse)(xs),[1,0,0,1,-Es,-Ns]);return xs.fillStyle=Gr?Vr.getPattern(Lr,this,Ts,dr.PathType.FILL):Vr,xs.fillRect(0,0,Fr,$r),ms&&!Gr&&(this.cachedCanvases.delete("fillCanvas"),ms.set(ls,cs.canvas)),{canvas:cs.canvas,offsetX:Math.round(Es),offsetY:Math.round(Ns)}}setLineWidth(Dr){Dr!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=Dr,this.ctx.lineWidth=Dr}setLineCap(Dr){this.ctx.lineCap=Wr[Dr]}setLineJoin(Dr){this.ctx.lineJoin=Yr[Dr]}setMiterLimit(Dr){this.ctx.miterLimit=Dr}setDash(Dr,Lr){const Fr=this.ctx;Fr.setLineDash!==void 0&&(Fr.setLineDash(Dr),Fr.lineDashOffset=Lr)}setRenderingIntent(Dr){}setFlatness(Dr){}setGState(Dr){for(const[Lr,Fr]of Dr)switch(Lr){case"LW":this.setLineWidth(Fr);break;case"LC":this.setLineCap(Fr);break;case"LJ":this.setLineJoin(Fr);break;case"ML":this.setMiterLimit(Fr);break;case"D":this.setDash(Fr[0],Fr[1]);break;case"RI":this.setRenderingIntent(Fr);break;case"FL":this.setFlatness(Fr);break;case"Font":this.setFont(Fr[0],Fr[1]);break;case"CA":this.current.strokeAlpha=Fr;break;case"ca":this.current.fillAlpha=Fr,this.ctx.globalAlpha=Fr;break;case"BM":this.ctx.globalCompositeOperation=Fr;break;case"SMask":this.current.activeSMask=Fr?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(Fr);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const Dr=this.inSMaskMode;this.current.activeSMask&&!Dr?this.beginSMaskMode():!this.current.activeSMask&&Dr&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const Dr=this.ctx.canvas.width,Lr=this.ctx.canvas.height,Fr="smaskGroupAt"+this.groupLevel,$r=this.cachedCanvases.getCanvas(Fr,Dr,Lr);this.suspendedCtx=this.ctx,this.ctx=$r.context;const Vr=this.ctx;Vr.setTransform(...(0,ur.getCurrentTransform)(this.suspendedCtx)),Sr(this.suspendedCtx,Vr),yr(Vr,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Sr(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(Dr){if(!this.current.activeSMask)return;Dr?(Dr[0]=Math.floor(Dr[0]),Dr[1]=Math.floor(Dr[1]),Dr[2]=Math.ceil(Dr[2]),Dr[3]=Math.ceil(Dr[3])):Dr=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const Lr=this.current.activeSMask,Fr=this.suspendedCtx;Ir(Fr,Lr,this.ctx,Dr),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(Sr(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const Dr=this.current;this.stateStack.push(Dr),this.current=Dr.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Sr(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(Dr,Lr,Fr,$r,Vr,Gr){this.ctx.transform(Dr,Lr,Fr,$r,Vr,Gr),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(Dr,Lr,Fr){const $r=this.ctx,Vr=this.current;let Gr=Vr.x,Jr=Vr.y,ms,ls;const ds=(0,ur.getCurrentTransform)($r),bs=ds[0]===0&&ds[3]===0||ds[1]===0&&ds[2]===0,ws=bs?Fr.slice(0):null;for(let Is=0,ys=0,ss=Dr.length;Is<ss;Is++)switch(Dr[Is]|0){case cr.OPS.rectangle:Gr=Lr[ys++],Jr=Lr[ys++];const Ur=Lr[ys++],Xr=Lr[ys++],cs=Gr+Ur,xs=Jr+Xr;$r.moveTo(Gr,Jr),Ur===0||Xr===0?$r.lineTo(cs,xs):($r.lineTo(cs,Jr),$r.lineTo(cs,xs),$r.lineTo(Gr,xs)),bs||Vr.updateRectMinMax(ds,[Gr,Jr,cs,xs]),$r.closePath();break;case cr.OPS.moveTo:Gr=Lr[ys++],Jr=Lr[ys++],$r.moveTo(Gr,Jr),bs||Vr.updatePathMinMax(ds,Gr,Jr);break;case cr.OPS.lineTo:Gr=Lr[ys++],Jr=Lr[ys++],$r.lineTo(Gr,Jr),bs||Vr.updatePathMinMax(ds,Gr,Jr);break;case cr.OPS.curveTo:ms=Gr,ls=Jr,Gr=Lr[ys+4],Jr=Lr[ys+5],$r.bezierCurveTo(Lr[ys],Lr[ys+1],Lr[ys+2],Lr[ys+3],Gr,Jr),Vr.updateCurvePathMinMax(ds,ms,ls,Lr[ys],Lr[ys+1],Lr[ys+2],Lr[ys+3],Gr,Jr,ws),ys+=6;break;case cr.OPS.curveTo2:ms=Gr,ls=Jr,$r.bezierCurveTo(Gr,Jr,Lr[ys],Lr[ys+1],Lr[ys+2],Lr[ys+3]),Vr.updateCurvePathMinMax(ds,ms,ls,Gr,Jr,Lr[ys],Lr[ys+1],Lr[ys+2],Lr[ys+3],ws),Gr=Lr[ys+2],Jr=Lr[ys+3],ys+=4;break;case cr.OPS.curveTo3:ms=Gr,ls=Jr,Gr=Lr[ys+2],Jr=Lr[ys+3],$r.bezierCurveTo(Lr[ys],Lr[ys+1],Gr,Jr,Gr,Jr),Vr.updateCurvePathMinMax(ds,ms,ls,Lr[ys],Lr[ys+1],Gr,Jr,Gr,Jr,ws),ys+=4;break;case cr.OPS.closePath:$r.closePath();break}bs&&Vr.updateScalingPathMinMax(ds,ws),Vr.setCurrentPoint(Gr,Jr)}closePath(){this.ctx.closePath()}stroke(Dr=!0){const Lr=this.ctx,Fr=this.current.strokeColor;Lr.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof Fr=="object"&&(Fr!=null&&Fr.getPattern)?(Lr.save(),Lr.strokeStyle=Fr.getPattern(Lr,this,(0,ur.getCurrentTransformInverse)(Lr),dr.PathType.STROKE),this.rescaleAndStroke(!1),Lr.restore()):this.rescaleAndStroke(!0)),Dr&&this.consumePath(this.current.getClippedPathBoundingBox()),Lr.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(Dr=!0){const Lr=this.ctx,Fr=this.current.fillColor,$r=this.current.patternFill;let Vr=!1;$r&&(Lr.save(),Lr.fillStyle=Fr.getPattern(Lr,this,(0,ur.getCurrentTransformInverse)(Lr),dr.PathType.FILL),Vr=!0);const Gr=this.current.getClippedPathBoundingBox();this.contentVisible&&Gr!==null&&(this.pendingEOFill?(Lr.fill("evenodd"),this.pendingEOFill=!1):Lr.fill()),Vr&&Lr.restore(),Dr&&this.consumePath(Gr)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=es}eoClip(){this.pendingClip=ps}beginText(){this.current.textMatrix=cr.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const Dr=this.pendingTextPaths,Lr=this.ctx;if(Dr===void 0){Lr.beginPath();return}Lr.save(),Lr.beginPath();for(const Fr of Dr)Lr.setTransform(...Fr.transform),Lr.translate(Fr.x,Fr.y),Fr.addToPath(Lr,Fr.fontSize);Lr.restore(),Lr.clip(),Lr.beginPath(),delete this.pendingTextPaths}setCharSpacing(Dr){this.current.charSpacing=Dr}setWordSpacing(Dr){this.current.wordSpacing=Dr}setHScale(Dr){this.current.textHScale=Dr/100}setLeading(Dr){this.current.leading=-Dr}setFont(Dr,Lr){var ds;const Fr=this.commonObjs.get(Dr),$r=this.current;if(!Fr)throw new Error(`Can't find font for ${Dr}`);if($r.fontMatrix=Fr.fontMatrix||cr.FONT_IDENTITY_MATRIX,($r.fontMatrix[0]===0||$r.fontMatrix[3]===0)&&(0,cr.warn)("Invalid font matrix for font "+Dr),Lr<0?(Lr=-Lr,$r.fontDirection=-1):$r.fontDirection=1,this.current.font=Fr,this.current.fontSize=Lr,Fr.isType3Font)return;const Vr=Fr.loadedName||"sans-serif",Gr=((ds=Fr.systemFontInfo)==null?void 0:ds.css)||`"${Vr}", ${Fr.fallbackName}`;let Jr="normal";Fr.black?Jr="900":Fr.bold&&(Jr="bold");const ms=Fr.italic?"italic":"normal";let ls=Lr;Lr<pr?ls=pr:Lr>xr&&(ls=xr),this.current.fontSizeScale=Lr/ls,this.ctx.font=`${ms} ${Jr} ${ls}px ${Gr}`}setTextRenderingMode(Dr){this.current.textRenderingMode=Dr}setTextRise(Dr){this.current.textRise=Dr}moveText(Dr,Lr){this.current.x=this.current.lineX+=Dr,this.current.y=this.current.lineY+=Lr}setLeadingMoveText(Dr,Lr){this.setLeading(-Lr),this.moveText(Dr,Lr)}setTextMatrix(Dr,Lr,Fr,$r,Vr,Gr){this.current.textMatrix=[Dr,Lr,Fr,$r,Vr,Gr],this.current.textMatrixScale=Math.hypot(Dr,Lr),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(Dr,Lr,Fr,$r){const Vr=this.ctx,Gr=this.current,Jr=Gr.font,ms=Gr.textRenderingMode,ls=Gr.fontSize/Gr.fontSizeScale,ds=ms&cr.TextRenderingMode.FILL_STROKE_MASK,bs=!!(ms&cr.TextRenderingMode.ADD_TO_PATH_FLAG),ws=Gr.patternFill&&!Jr.missingFile;let Is;(Jr.disableFontFace||bs||ws)&&(Is=Jr.getPathGenerator(this.commonObjs,Dr)),Jr.disableFontFace||ws?(Vr.save(),Vr.translate(Lr,Fr),Vr.beginPath(),Is(Vr,ls),$r&&Vr.setTransform(...$r),(ds===cr.TextRenderingMode.FILL||ds===cr.TextRenderingMode.FILL_STROKE)&&Vr.fill(),(ds===cr.TextRenderingMode.STROKE||ds===cr.TextRenderingMode.FILL_STROKE)&&Vr.stroke(),Vr.restore()):((ds===cr.TextRenderingMode.FILL||ds===cr.TextRenderingMode.FILL_STROKE)&&Vr.fillText(Dr,Lr,Fr),(ds===cr.TextRenderingMode.STROKE||ds===cr.TextRenderingMode.FILL_STROKE)&&Vr.strokeText(Dr,Lr,Fr)),bs&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,ur.getCurrentTransform)(Vr),x:Lr,y:Fr,fontSize:ls,addToPath:Is})}get isFontSubpixelAAEnabled(){const{context:Dr}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);Dr.scale(1.5,1),Dr.fillText("I",0,10);const Lr=Dr.getImageData(0,0,10,10).data;let Fr=!1;for(let $r=3;$r<Lr.length;$r+=4)if(Lr[$r]>0&&Lr[$r]<255){Fr=!0;break}return(0,cr.shadow)(this,"isFontSubpixelAAEnabled",Fr)}showText(Dr){const Lr=this.current,Fr=Lr.font;if(Fr.isType3Font)return this.showType3Text(Dr);const $r=Lr.fontSize;if($r===0)return;const Vr=this.ctx,Gr=Lr.fontSizeScale,Jr=Lr.charSpacing,ms=Lr.wordSpacing,ls=Lr.fontDirection,ds=Lr.textHScale*ls,bs=Dr.length,ws=Fr.vertical,Is=ws?1:-1,ys=Fr.defaultVMetrics,ss=$r*Lr.fontMatrix[0],Ur=Lr.textRenderingMode===cr.TextRenderingMode.FILL&&!Fr.disableFontFace&&!Lr.patternFill;Vr.save(),Vr.transform(...Lr.textMatrix),Vr.translate(Lr.x,Lr.y+Lr.textRise),ls>0?Vr.scale(ds,-1):Vr.scale(ds,1);let Xr;if(Lr.patternFill){Vr.save();const Ts=Lr.fillColor.getPattern(Vr,this,(0,ur.getCurrentTransformInverse)(Vr),dr.PathType.FILL);Xr=(0,ur.getCurrentTransform)(Vr),Vr.restore(),Vr.fillStyle=Ts}let cs=Lr.lineWidth;const xs=Lr.textMatrixScale;if(xs===0||cs===0){const Ts=Lr.textRenderingMode&cr.TextRenderingMode.FILL_STROKE_MASK;(Ts===cr.TextRenderingMode.STROKE||Ts===cr.TextRenderingMode.FILL_STROKE)&&(cs=this.getSinglePixelWidth())}else cs/=xs;if(Gr!==1&&(Vr.scale(Gr,Gr),cs/=Gr),Vr.lineWidth=cs,Fr.isInvalidPDFjsFont){const Ts=[];let gs=0;for(const Hs of Dr)Ts.push(Hs.unicode),gs+=Hs.width;Vr.fillText(Ts.join(""),0,0),Lr.x+=gs*ss*ds,Vr.restore(),this.compose();return}let Es=0,Ns;for(Ns=0;Ns<bs;++Ns){const Ts=Dr[Ns];if(typeof Ts=="number"){Es+=Is*Ts*$r/1e3;continue}let gs=!1;const Hs=(Ts.isSpace?ms:0)+Jr,Us=Ts.fontChar,xa=Ts.accent;let Gs,$a,Js=Ts.width;if(ws){const ro=Ts.vmetric||ys,no=-(Ts.vmetric?ro[1]:Js*.5)*ss,$s=ro[2]*ss;Js=ro?-ro[0]:Js,Gs=no/Gr,$a=(Es+$s)/Gr}else Gs=Es/Gr,$a=0;if(Fr.remeasure&&Js>0){const ro=Vr.measureText(Us).width*1e3/$r*Gr;if(Js<ro&&this.isFontSubpixelAAEnabled){const no=Js/ro;gs=!0,Vr.save(),Vr.scale(no,1),Gs/=no}else Js!==ro&&(Gs+=(Js-ro)/2e3*$r/Gr)}if(this.contentVisible&&(Ts.isInFont||Fr.missingFile)){if(Ur&&!xa)Vr.fillText(Us,Gs,$a);else if(this.paintChar(Us,Gs,$a,Xr),xa){const ro=Gs+$r*xa.offset.x/Gr,no=$a-$r*xa.offset.y/Gr;this.paintChar(xa.fontChar,ro,no,Xr)}}const ga=ws?Js*ss-Hs*ls:Js*ss+Hs*ls;Es+=ga,gs&&Vr.restore()}ws?Lr.y-=Es:Lr.x+=Es*ds,Vr.restore(),this.compose()}showType3Text(Dr){const Lr=this.ctx,Fr=this.current,$r=Fr.font,Vr=Fr.fontSize,Gr=Fr.fontDirection,Jr=$r.vertical?1:-1,ms=Fr.charSpacing,ls=Fr.wordSpacing,ds=Fr.textHScale*Gr,bs=Fr.fontMatrix||cr.FONT_IDENTITY_MATRIX,ws=Dr.length,Is=Fr.textRenderingMode===cr.TextRenderingMode.INVISIBLE;let ys,ss,Ur,Xr;if(!(Is||Vr===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,Lr.save(),Lr.transform(...Fr.textMatrix),Lr.translate(Fr.x,Fr.y),Lr.scale(ds,Gr),ys=0;ys<ws;++ys){if(ss=Dr[ys],typeof ss=="number"){Xr=Jr*ss*Vr/1e3,this.ctx.translate(Xr,0),Fr.x+=Xr*ds;continue}const cs=(ss.isSpace?ls:0)+ms,xs=$r.charProcOperatorList[ss.operatorListId];if(!xs){(0,cr.warn)(`Type3 character "${ss.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=ss,this.save(),Lr.scale(Vr,Vr),Lr.transform(...bs),this.executeOperatorList(xs),this.restore()),Ur=cr.Util.applyTransform([ss.width,0],bs)[0]*Vr+cs,Lr.translate(Ur,0),Fr.x+=Ur*ds}Lr.restore(),this.processingType3=null}}setCharWidth(Dr,Lr){}setCharWidthAndBounds(Dr,Lr,Fr,$r,Vr,Gr){this.ctx.rect(Fr,$r,Vr-Fr,Gr-$r),this.ctx.clip(),this.endPath()}getColorN_Pattern(Dr){let Lr;if(Dr[0]==="TilingPattern"){const Fr=Dr[1],$r=this.baseTransform||(0,ur.getCurrentTransform)(this.ctx),Vr={createCanvasGraphics:Gr=>new rs(Gr,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};Lr=new dr.TilingPattern(Dr,Fr,this.ctx,Vr,$r)}else Lr=this._getPattern(Dr[1],Dr[2]);return Lr}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(Dr,Lr,Fr){const $r=cr.Util.makeHexColor(Dr,Lr,Fr);this.ctx.strokeStyle=$r,this.current.strokeColor=$r}setFillRGBColor(Dr,Lr,Fr){const $r=cr.Util.makeHexColor(Dr,Lr,Fr);this.ctx.fillStyle=$r,this.current.fillColor=$r,this.current.patternFill=!1}_getPattern(Dr,Lr=null){let Fr;return this.cachedPatterns.has(Dr)?Fr=this.cachedPatterns.get(Dr):(Fr=(0,dr.getShadingPattern)(this.getObject(Dr)),this.cachedPatterns.set(Dr,Fr)),Lr&&(Fr.matrix=Lr),Fr}shadingFill(Dr){if(!this.contentVisible)return;const Lr=this.ctx;this.save();const Fr=this._getPattern(Dr);Lr.fillStyle=Fr.getPattern(Lr,this,(0,ur.getCurrentTransformInverse)(Lr),dr.PathType.SHADING);const $r=(0,ur.getCurrentTransformInverse)(Lr);if($r){const{width:Vr,height:Gr}=Lr.canvas,[Jr,ms,ls,ds]=cr.Util.getAxialAlignedBoundingBox([0,0,Vr,Gr],$r);this.ctx.fillRect(Jr,ms,ls-Jr,ds-ms)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,cr.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,cr.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(Dr,Lr){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(Dr)&&Dr.length===6&&this.transform(...Dr),this.baseTransform=(0,ur.getCurrentTransform)(this.ctx),Lr)){const Fr=Lr[2]-Lr[0],$r=Lr[3]-Lr[1];this.ctx.rect(Lr[0],Lr[1],Fr,$r),this.current.updateRectMinMax((0,ur.getCurrentTransform)(this.ctx),Lr),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(Dr){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const Lr=this.ctx;Dr.isolated||(0,cr.info)("TODO: Support non-isolated groups."),Dr.knockout&&(0,cr.warn)("Knockout groups not supported.");const Fr=(0,ur.getCurrentTransform)(Lr);if(Dr.matrix&&Lr.transform(...Dr.matrix),!Dr.bbox)throw new Error("Bounding box is required.");let $r=cr.Util.getAxialAlignedBoundingBox(Dr.bbox,(0,ur.getCurrentTransform)(Lr));const Vr=[0,0,Lr.canvas.width,Lr.canvas.height];$r=cr.Util.intersect($r,Vr)||[0,0,0,0];const Gr=Math.floor($r[0]),Jr=Math.floor($r[1]);let ms=Math.max(Math.ceil($r[2])-Gr,1),ls=Math.max(Math.ceil($r[3])-Jr,1),ds=1,bs=1;ms>mr&&(ds=ms/mr,ms=mr),ls>mr&&(bs=ls/mr,ls=mr),this.current.startNewPathAndClipBox([0,0,ms,ls]);let ws="groupAt"+this.groupLevel;Dr.smask&&(ws+="_smask_"+this.smaskCounter++%2);const Is=this.cachedCanvases.getCanvas(ws,ms,ls),ys=Is.context;ys.scale(1/ds,1/bs),ys.translate(-Gr,-Jr),ys.transform(...Fr),Dr.smask?this.smaskStack.push({canvas:Is.canvas,context:ys,offsetX:Gr,offsetY:Jr,scaleX:ds,scaleY:bs,subtype:Dr.smask.subtype,backdrop:Dr.smask.backdrop,transferMap:Dr.smask.transferMap||null,startTransformInverse:null}):(Lr.setTransform(1,0,0,1,0,0),Lr.translate(Gr,Jr),Lr.scale(ds,bs),Lr.save()),Sr(Lr,ys),this.ctx=ys,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(Lr),this.groupLevel++}endGroup(Dr){if(!this.contentVisible)return;this.groupLevel--;const Lr=this.ctx,Fr=this.groupStack.pop();if(this.ctx=Fr,this.ctx.imageSmoothingEnabled=!1,Dr.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const $r=(0,ur.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...$r);const Vr=cr.Util.getAxialAlignedBoundingBox([0,0,Lr.canvas.width,Lr.canvas.height],$r);this.ctx.drawImage(Lr.canvas,0,0),this.ctx.restore(),this.compose(Vr)}}beginAnnotation(Dr,Lr,Fr,$r,Vr){if(js(this,Qr,Nl).call(this),kr(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(Lr)&&Lr.length===4){const Gr=Lr[2]-Lr[0],Jr=Lr[3]-Lr[1];if(Vr&&this.annotationCanvasMap){Fr=Fr.slice(),Fr[4]-=Lr[0],Fr[5]-=Lr[1],Lr=Lr.slice(),Lr[0]=Lr[1]=0,Lr[2]=Gr,Lr[3]=Jr;const[ms,ls]=cr.Util.singularValueDecompose2dScale((0,ur.getCurrentTransform)(this.ctx)),{viewportScale:ds}=this,bs=Math.ceil(Gr*this.outputScaleX*ds),ws=Math.ceil(Jr*this.outputScaleY*ds);this.annotationCanvas=this.canvasFactory.create(bs,ws);const{canvas:Is,context:ys}=this.annotationCanvas;this.annotationCanvasMap.set(Dr,Is),this.annotationCanvas.savedCtx=this.ctx,this.ctx=ys,this.ctx.save(),this.ctx.setTransform(ms,0,0,-ls,0,Jr*ls),kr(this.ctx)}else kr(this.ctx),this.ctx.rect(Lr[0],Lr[1],Gr,Jr),this.ctx.clip(),this.endPath()}this.current=new wr(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...Fr),this.transform(...$r)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),js(this,Qr,Cl).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(Dr){if(!this.contentVisible)return;const Lr=Dr.count;Dr=this.getObject(Dr.data,Dr),Dr.count=Lr;const Fr=this.ctx,$r=this.processingType3;if($r&&($r.compiled===void 0&&($r.compiled=_r(Dr)),$r.compiled)){$r.compiled(Fr);return}const Vr=this._createMaskCanvas(Dr),Gr=Vr.canvas;Fr.save(),Fr.setTransform(1,0,0,1,0,0),Fr.drawImage(Gr,Vr.offsetX,Vr.offsetY),Fr.restore(),this.compose()}paintImageMaskXObjectRepeat(Dr,Lr,Fr=0,$r=0,Vr,Gr){if(!this.contentVisible)return;Dr=this.getObject(Dr.data,Dr);const Jr=this.ctx;Jr.save();const ms=(0,ur.getCurrentTransform)(Jr);Jr.transform(Lr,Fr,$r,Vr,0,0);const ls=this._createMaskCanvas(Dr);Jr.setTransform(1,0,0,1,ls.offsetX-ms[4],ls.offsetY-ms[5]);for(let ds=0,bs=Gr.length;ds<bs;ds+=2){const ws=cr.Util.transform(ms,[Lr,Fr,$r,Vr,Gr[ds],Gr[ds+1]]),[Is,ys]=cr.Util.applyTransform([0,0],ws);Jr.drawImage(ls.canvas,Is,ys)}Jr.restore(),this.compose()}paintImageMaskXObjectGroup(Dr){if(!this.contentVisible)return;const Lr=this.ctx,Fr=this.current.fillColor,$r=this.current.patternFill;for(const Vr of Dr){const{data:Gr,width:Jr,height:ms,transform:ls}=Vr,ds=this.cachedCanvases.getCanvas("maskCanvas",Jr,ms),bs=ds.context;bs.save();const ws=this.getObject(Gr,Vr);Ar(bs,ws),bs.globalCompositeOperation="source-in",bs.fillStyle=$r?Fr.getPattern(bs,this,(0,ur.getCurrentTransformInverse)(Lr),dr.PathType.FILL):Fr,bs.fillRect(0,0,Jr,ms),bs.restore(),Lr.save(),Lr.transform(...ls),Lr.scale(1,-1),br(Lr,ds.canvas,0,0,Jr,ms,0,-1,1,1),Lr.restore()}this.compose()}paintImageXObject(Dr){if(!this.contentVisible)return;const Lr=this.getObject(Dr);if(!Lr){(0,cr.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(Lr)}paintImageXObjectRepeat(Dr,Lr,Fr,$r){if(!this.contentVisible)return;const Vr=this.getObject(Dr);if(!Vr){(0,cr.warn)("Dependent image isn't ready yet");return}const Gr=Vr.width,Jr=Vr.height,ms=[];for(let ls=0,ds=$r.length;ls<ds;ls+=2)ms.push({transform:[Lr,0,0,Fr,$r[ls],$r[ls+1]],x:0,y:0,w:Gr,h:Jr});this.paintInlineImageXObjectGroup(Vr,ms)}applyTransferMapsToCanvas(Dr){return this.current.transferMaps!=="none"&&(Dr.filter=this.current.transferMaps,Dr.drawImage(Dr.canvas,0,0),Dr.filter="none"),Dr.canvas}applyTransferMapsToBitmap(Dr){if(this.current.transferMaps==="none")return Dr.bitmap;const{bitmap:Lr,width:Fr,height:$r}=Dr,Vr=this.cachedCanvases.getCanvas("inlineImage",Fr,$r),Gr=Vr.context;return Gr.filter=this.current.transferMaps,Gr.drawImage(Lr,0,0),Gr.filter="none",Vr.canvas}paintInlineImageXObject(Dr){if(!this.contentVisible)return;const Lr=Dr.width,Fr=Dr.height,$r=this.ctx;if(this.save(),!cr.isNodeJS){const{filter:Jr}=$r;Jr!=="none"&&Jr!==""&&($r.filter="none")}$r.scale(1/Lr,-1/Fr);let Vr;if(Dr.bitmap)Vr=this.applyTransferMapsToBitmap(Dr);else if(typeof HTMLElement=="function"&&Dr instanceof HTMLElement||!Dr.data)Vr=Dr;else{const ms=this.cachedCanvases.getCanvas("inlineImage",Lr,Fr).context;Rr(ms,Dr),Vr=this.applyTransferMapsToCanvas(ms)}const Gr=this._scaleImage(Vr,(0,ur.getCurrentTransformInverse)($r));$r.imageSmoothingEnabled=Br((0,ur.getCurrentTransform)($r),Dr.interpolate),br($r,Gr.img,0,0,Gr.paintWidth,Gr.paintHeight,0,-Fr,Lr,Fr),this.compose(),this.restore()}paintInlineImageXObjectGroup(Dr,Lr){if(!this.contentVisible)return;const Fr=this.ctx;let $r;if(Dr.bitmap)$r=Dr.bitmap;else{const Vr=Dr.width,Gr=Dr.height,ms=this.cachedCanvases.getCanvas("inlineImage",Vr,Gr).context;Rr(ms,Dr),$r=this.applyTransferMapsToCanvas(ms)}for(const Vr of Lr)Fr.save(),Fr.transform(...Vr.transform),Fr.scale(1,-1),br(Fr,$r,Vr.x,Vr.y,Vr.w,Vr.h,0,-1,1,1),Fr.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(Dr){}markPointProps(Dr,Lr){}beginMarkedContent(Dr){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(Dr,Lr){Dr==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(Lr)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(Dr){const Lr=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(Dr);const Fr=this.ctx;this.pendingClip&&(Lr||(this.pendingClip===ps?Fr.clip("evenodd"):Fr.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),Fr.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const Dr=(0,ur.getCurrentTransform)(this.ctx);if(Dr[1]===0&&Dr[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(Dr[0]),Math.abs(Dr[3]));else{const Lr=Math.abs(Dr[0]*Dr[3]-Dr[2]*Dr[1]),Fr=Math.hypot(Dr[0],Dr[2]),$r=Math.hypot(Dr[1],Dr[3]);this._cachedGetSinglePixelWidth=Math.max(Fr,$r)/Lr}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:Dr}=this.current,{a:Lr,b:Fr,c:$r,d:Vr}=this.ctx.getTransform();let Gr,Jr;if(Fr===0&&$r===0){const ms=Math.abs(Lr),ls=Math.abs(Vr);if(ms===ls)if(Dr===0)Gr=Jr=1/ms;else{const ds=ms*Dr;Gr=Jr=ds<1?1/ds:1}else if(Dr===0)Gr=1/ms,Jr=1/ls;else{const ds=ms*Dr,bs=ls*Dr;Gr=ds<1?1/ds:1,Jr=bs<1?1/bs:1}}else{const ms=Math.abs(Lr*Vr-Fr*$r),ls=Math.hypot(Lr,Fr),ds=Math.hypot($r,Vr);if(Dr===0)Gr=ds/ms,Jr=ls/ms;else{const bs=Dr*ms;Gr=ds>bs?ds/bs:1,Jr=ls>bs?ls/bs:1}}this._cachedScaleForStroking[0]=Gr,this._cachedScaleForStroking[1]=Jr}return this._cachedScaleForStroking}rescaleAndStroke(Dr){const{ctx:Lr}=this,{lineWidth:Fr}=this.current,[$r,Vr]=this.getScaleForStroking();if(Lr.lineWidth=Fr||1,$r===1&&Vr===1){Lr.stroke();return}const Gr=Lr.getLineDash();if(Dr&&Lr.save(),Lr.scale($r,Vr),Gr.length>0){const Jr=Math.max($r,Vr);Lr.setLineDash(Gr.map(ms=>ms/Jr)),Lr.lineDashOffset/=Jr}Lr.stroke(),Dr&&Lr.restore()}isContentVisible(){for(let Dr=this.markedContentStack.length-1;Dr>=0;Dr--)if(!this.markedContentStack[Dr].visible)return!1;return!0}};Qr=new WeakSet,Nl=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Cl=function(){if(this.pageColors){const Dr=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(Dr!=="none"){const Lr=this.ctx.filter;this.ctx.filter=Dr,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=Lr}}};let ts=rs;or.CanvasGraphics=ts;for(const Mr in cr.OPS)ts.prototype[Mr]!==void 0&&(ts.prototype[cr.OPS[Mr]]=ts.prototype[Mr])},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.TilingPattern=or.PathType=void 0,or.getShadingPattern=gr;var cr=lr(1),ur=lr(6);const dr={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};or.PathType=dr;function hr(_r,wr){if(!wr)return;const Rr=wr[2]-wr[0],Ar=wr[3]-wr[1],Sr=new Path2D;Sr.rect(wr[0],wr[1],Rr,Ar),_r.clip(Sr)}class pr{constructor(){this.constructor===pr&&(0,cr.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,cr.unreachable)("Abstract method `getPattern` called.")}}class xr extends pr{constructor(wr){super(),this._type=wr[1],this._bbox=wr[2],this._colorStops=wr[3],this._p0=wr[4],this._p1=wr[5],this._r0=wr[6],this._r1=wr[7],this.matrix=null}_createGradient(wr){let Rr;this._type==="axial"?Rr=wr.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(Rr=wr.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const Ar of this._colorStops)Rr.addColorStop(Ar[0],Ar[1]);return Rr}getPattern(wr,Rr,Ar,Sr){let kr;if(Sr===dr.STROKE||Sr===dr.FILL){const Nr=Rr.current.getClippedPathBoundingBox(Sr,(0,ur.getCurrentTransform)(wr))||[0,0,0,0],Cr=Math.ceil(Nr[2]-Nr[0])||1,Tr=Math.ceil(Nr[3]-Nr[1])||1,Pr=Rr.cachedCanvases.getCanvas("pattern",Cr,Tr,!0),Ir=Pr.context;Ir.clearRect(0,0,Ir.canvas.width,Ir.canvas.height),Ir.beginPath(),Ir.rect(0,0,Ir.canvas.width,Ir.canvas.height),Ir.translate(-Nr[0],-Nr[1]),Ar=cr.Util.transform(Ar,[1,0,0,1,Nr[0],Nr[1]]),Ir.transform(...Rr.baseTransform),this.matrix&&Ir.transform(...this.matrix),hr(Ir,this._bbox),Ir.fillStyle=this._createGradient(Ir),Ir.fill(),kr=wr.createPattern(Pr.canvas,"no-repeat");const Br=new DOMMatrix(Ar);kr.setTransform(Br)}else hr(wr,this._bbox),kr=this._createGradient(wr);return kr}}function mr(_r,wr,Rr,Ar,Sr,kr,Nr,Cr){const Tr=wr.coords,Pr=wr.colors,Ir=_r.data,Br=_r.width*4;let Wr;Tr[Rr+1]>Tr[Ar+1]&&(Wr=Rr,Rr=Ar,Ar=Wr,Wr=kr,kr=Nr,Nr=Wr),Tr[Ar+1]>Tr[Sr+1]&&(Wr=Ar,Ar=Sr,Sr=Wr,Wr=Nr,Nr=Cr,Cr=Wr),Tr[Rr+1]>Tr[Ar+1]&&(Wr=Rr,Rr=Ar,Ar=Wr,Wr=kr,kr=Nr,Nr=Wr);const Yr=(Tr[Rr]+wr.offsetX)*wr.scaleX,es=(Tr[Rr+1]+wr.offsetY)*wr.scaleY,ps=(Tr[Ar]+wr.offsetX)*wr.scaleX,ts=(Tr[Ar+1]+wr.offsetY)*wr.scaleY,Qr=(Tr[Sr]+wr.offsetX)*wr.scaleX,Hr=(Tr[Sr+1]+wr.offsetY)*wr.scaleY;if(es>=Hr)return;const Kr=Pr[kr],rs=Pr[kr+1],Mr=Pr[kr+2],Dr=Pr[Nr],Lr=Pr[Nr+1],Fr=Pr[Nr+2],$r=Pr[Cr],Vr=Pr[Cr+1],Gr=Pr[Cr+2],Jr=Math.round(es),ms=Math.round(Hr);let ls,ds,bs,ws,Is,ys,ss,Ur;for(let Xr=Jr;Xr<=ms;Xr++){if(Xr<ts){const Ts=Xr<es?0:(es-Xr)/(es-ts);ls=Yr-(Yr-ps)*Ts,ds=Kr-(Kr-Dr)*Ts,bs=rs-(rs-Lr)*Ts,ws=Mr-(Mr-Fr)*Ts}else{let Ts;Xr>Hr?Ts=1:ts===Hr?Ts=0:Ts=(ts-Xr)/(ts-Hr),ls=ps-(ps-Qr)*Ts,ds=Dr-(Dr-$r)*Ts,bs=Lr-(Lr-Vr)*Ts,ws=Fr-(Fr-Gr)*Ts}let cs;Xr<es?cs=0:Xr>Hr?cs=1:cs=(es-Xr)/(es-Hr),Is=Yr-(Yr-Qr)*cs,ys=Kr-(Kr-$r)*cs,ss=rs-(rs-Vr)*cs,Ur=Mr-(Mr-Gr)*cs;const xs=Math.round(Math.min(ls,Is)),Es=Math.round(Math.max(ls,Is));let Ns=Br*Xr+xs*4;for(let Ts=xs;Ts<=Es;Ts++)cs=(ls-Ts)/(ls-Is),cs<0?cs=0:cs>1&&(cs=1),Ir[Ns++]=ds-(ds-ys)*cs|0,Ir[Ns++]=bs-(bs-ss)*cs|0,Ir[Ns++]=ws-(ws-Ur)*cs|0,Ir[Ns++]=255}}function fr(_r,wr,Rr){const Ar=wr.coords,Sr=wr.colors;let kr,Nr;switch(wr.type){case"lattice":const Cr=wr.verticesPerRow,Tr=Math.floor(Ar.length/Cr)-1,Pr=Cr-1;for(kr=0;kr<Tr;kr++){let Ir=kr*Cr;for(let Br=0;Br<Pr;Br++,Ir++)mr(_r,Rr,Ar[Ir],Ar[Ir+1],Ar[Ir+Cr],Sr[Ir],Sr[Ir+1],Sr[Ir+Cr]),mr(_r,Rr,Ar[Ir+Cr+1],Ar[Ir+1],Ar[Ir+Cr],Sr[Ir+Cr+1],Sr[Ir+1],Sr[Ir+Cr])}break;case"triangles":for(kr=0,Nr=Ar.length;kr<Nr;kr+=3)mr(_r,Rr,Ar[kr],Ar[kr+1],Ar[kr+2],Sr[kr],Sr[kr+1],Sr[kr+2]);break;default:throw new Error("illegal figure")}}class Er extends pr{constructor(wr){super(),this._coords=wr[2],this._colors=wr[3],this._figures=wr[4],this._bounds=wr[5],this._bbox=wr[7],this._background=wr[8],this.matrix=null}_createMeshCanvas(wr,Rr,Ar){const Cr=Math.floor(this._bounds[0]),Tr=Math.floor(this._bounds[1]),Pr=Math.ceil(this._bounds[2])-Cr,Ir=Math.ceil(this._bounds[3])-Tr,Br=Math.min(Math.ceil(Math.abs(Pr*wr[0]*1.1)),3e3),Wr=Math.min(Math.ceil(Math.abs(Ir*wr[1]*1.1)),3e3),Yr=Pr/Br,es=Ir/Wr,ps={coords:this._coords,colors:this._colors,offsetX:-Cr,offsetY:-Tr,scaleX:1/Yr,scaleY:1/es},ts=Br+2*2,Qr=Wr+2*2,Hr=Ar.getCanvas("mesh",ts,Qr,!1),Kr=Hr.context,rs=Kr.createImageData(Br,Wr);if(Rr){const Dr=rs.data;for(let Lr=0,Fr=Dr.length;Lr<Fr;Lr+=4)Dr[Lr]=Rr[0],Dr[Lr+1]=Rr[1],Dr[Lr+2]=Rr[2],Dr[Lr+3]=255}for(const Dr of this._figures)fr(rs,Dr,ps);return Kr.putImageData(rs,2,2),{canvas:Hr.canvas,offsetX:Cr-2*Yr,offsetY:Tr-2*es,scaleX:Yr,scaleY:es}}getPattern(wr,Rr,Ar,Sr){hr(wr,this._bbox);let kr;if(Sr===dr.SHADING)kr=cr.Util.singularValueDecompose2dScale((0,ur.getCurrentTransform)(wr));else if(kr=cr.Util.singularValueDecompose2dScale(Rr.baseTransform),this.matrix){const Cr=cr.Util.singularValueDecompose2dScale(this.matrix);kr=[kr[0]*Cr[0],kr[1]*Cr[1]]}const Nr=this._createMeshCanvas(kr,Sr===dr.SHADING?null:this._background,Rr.cachedCanvases);return Sr!==dr.SHADING&&(wr.setTransform(...Rr.baseTransform),this.matrix&&wr.transform(...this.matrix)),wr.translate(Nr.offsetX,Nr.offsetY),wr.scale(Nr.scaleX,Nr.scaleY),wr.createPattern(Nr.canvas,"no-repeat")}}class vr extends pr{getPattern(){return"hotpink"}}function gr(_r){switch(_r[0]){case"RadialAxial":return new xr(_r);case"Mesh":return new Er(_r);case"Dummy":return new vr}throw new Error(`Unknown IR type: ${_r[0]}`)}const yr={COLORED:1,UNCOLORED:2},br=class br{constructor(wr,Rr,Ar,Sr,kr){this.operatorList=wr[2],this.matrix=wr[3]||[1,0,0,1,0,0],this.bbox=wr[4],this.xstep=wr[5],this.ystep=wr[6],this.paintType=wr[7],this.tilingType=wr[8],this.color=Rr,this.ctx=Ar,this.canvasGraphicsFactory=Sr,this.baseTransform=kr}createPatternCanvas(wr){const Rr=this.operatorList,Ar=this.bbox,Sr=this.xstep,kr=this.ystep,Nr=this.paintType,Cr=this.tilingType,Tr=this.color,Pr=this.canvasGraphicsFactory;(0,cr.info)("TilingType: "+Cr);const Ir=Ar[0],Br=Ar[1],Wr=Ar[2],Yr=Ar[3],es=cr.Util.singularValueDecompose2dScale(this.matrix),ps=cr.Util.singularValueDecompose2dScale(this.baseTransform),ts=[es[0]*ps[0],es[1]*ps[1]],Qr=this.getSizeAndScale(Sr,this.ctx.canvas.width,ts[0]),Hr=this.getSizeAndScale(kr,this.ctx.canvas.height,ts[1]),Kr=wr.cachedCanvases.getCanvas("pattern",Qr.size,Hr.size,!0),rs=Kr.context,Mr=Pr.createCanvasGraphics(rs);Mr.groupLevel=wr.groupLevel,this.setFillAndStrokeStyleToContext(Mr,Nr,Tr);let Dr=Ir,Lr=Br,Fr=Wr,$r=Yr;return Ir<0&&(Dr=0,Fr+=Math.abs(Ir)),Br<0&&(Lr=0,$r+=Math.abs(Br)),rs.translate(-(Qr.scale*Dr),-(Hr.scale*Lr)),Mr.transform(Qr.scale,0,0,Hr.scale,0,0),rs.save(),this.clipBbox(Mr,Dr,Lr,Fr,$r),Mr.baseTransform=(0,ur.getCurrentTransform)(Mr.ctx),Mr.executeOperatorList(Rr),Mr.endDrawing(),{canvas:Kr.canvas,scaleX:Qr.scale,scaleY:Hr.scale,offsetX:Dr,offsetY:Lr}}getSizeAndScale(wr,Rr,Ar){wr=Math.abs(wr);const Sr=Math.max(br.MAX_PATTERN_SIZE,Rr);let kr=Math.ceil(wr*Ar);return kr>=Sr?kr=Sr:Ar=kr/wr,{scale:Ar,size:kr}}clipBbox(wr,Rr,Ar,Sr,kr){const Nr=Sr-Rr,Cr=kr-Ar;wr.ctx.rect(Rr,Ar,Nr,Cr),wr.current.updateRectMinMax((0,ur.getCurrentTransform)(wr.ctx),[Rr,Ar,Sr,kr]),wr.clip(),wr.endPath()}setFillAndStrokeStyleToContext(wr,Rr,Ar){const Sr=wr.ctx,kr=wr.current;switch(Rr){case yr.COLORED:const Nr=this.ctx;Sr.fillStyle=Nr.fillStyle,Sr.strokeStyle=Nr.strokeStyle,kr.fillColor=Nr.fillStyle,kr.strokeColor=Nr.strokeStyle;break;case yr.UNCOLORED:const Cr=cr.Util.makeHexColor(Ar[0],Ar[1],Ar[2]);Sr.fillStyle=Cr,Sr.strokeStyle=Cr,kr.fillColor=Cr,kr.strokeColor=Cr;break;default:throw new cr.FormatError(`Unsupported paint type: ${Rr}`)}}getPattern(wr,Rr,Ar,Sr){let kr=Ar;Sr!==dr.SHADING&&(kr=cr.Util.transform(kr,Rr.baseTransform),this.matrix&&(kr=cr.Util.transform(kr,this.matrix)));const Nr=this.createPatternCanvas(Rr);let Cr=new DOMMatrix(kr);Cr=Cr.translate(Nr.offsetX,Nr.offsetY),Cr=Cr.scale(1/Nr.scaleX,1/Nr.scaleY);const Tr=wr.createPattern(Nr.canvas,"repeat");return Tr.setTransform(Cr),Tr}};io(br,"MAX_PATTERN_SIZE",3e3);let jr=br;or.TilingPattern=jr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.convertBlackAndWhiteToRGBA=dr,or.convertToRGBA=ur,or.grayToRGBA=pr;var cr=lr(1);function ur(xr){switch(xr.kind){case cr.ImageKind.GRAYSCALE_1BPP:return dr(xr);case cr.ImageKind.RGB_24BPP:return hr(xr)}return null}function dr({src:xr,srcPos:mr=0,dest:fr,width:Er,height:vr,nonBlackColor:gr=4294967295,inverseDecode:yr=!1}){const jr=cr.FeatureTest.isLittleEndian?4278190080:255,[br,_r]=yr?[gr,jr]:[jr,gr],wr=Er>>3,Rr=Er&7,Ar=xr.length;fr=new Uint32Array(fr.buffer);let Sr=0;for(let kr=0;kr<vr;kr++){for(const Cr=mr+wr;mr<Cr;mr++){const Tr=mr<Ar?xr[mr]:255;fr[Sr++]=Tr&128?_r:br,fr[Sr++]=Tr&64?_r:br,fr[Sr++]=Tr&32?_r:br,fr[Sr++]=Tr&16?_r:br,fr[Sr++]=Tr&8?_r:br,fr[Sr++]=Tr&4?_r:br,fr[Sr++]=Tr&2?_r:br,fr[Sr++]=Tr&1?_r:br}if(Rr===0)continue;const Nr=mr<Ar?xr[mr++]:255;for(let Cr=0;Cr<Rr;Cr++)fr[Sr++]=Nr&1<<7-Cr?_r:br}return{srcPos:mr,destPos:Sr}}function hr({src:xr,srcPos:mr=0,dest:fr,destPos:Er=0,width:vr,height:gr}){let yr=0;const jr=xr.length>>2,br=new Uint32Array(xr.buffer,mr,jr);if(cr.FeatureTest.isLittleEndian){for(;yr<jr-2;yr+=3,Er+=4){const _r=br[yr],wr=br[yr+1],Rr=br[yr+2];fr[Er]=_r|4278190080,fr[Er+1]=_r>>>24|wr<<8|4278190080,fr[Er+2]=wr>>>16|Rr<<16|4278190080,fr[Er+3]=Rr>>>8|4278190080}for(let _r=yr*4,wr=xr.length;_r<wr;_r+=3)fr[Er++]=xr[_r]|xr[_r+1]<<8|xr[_r+2]<<16|4278190080}else{for(;yr<jr-2;yr+=3,Er+=4){const _r=br[yr],wr=br[yr+1],Rr=br[yr+2];fr[Er]=_r|255,fr[Er+1]=_r<<24|wr>>>8|255,fr[Er+2]=wr<<16|Rr>>>16|255,fr[Er+3]=Rr<<8|255}for(let _r=yr*4,wr=xr.length;_r<wr;_r+=3)fr[Er++]=xr[_r]<<24|xr[_r+1]<<16|xr[_r+2]<<8|255}return{srcPos:mr,destPos:Er}}function pr(xr,mr){if(cr.FeatureTest.isLittleEndian)for(let fr=0,Er=xr.length;fr<Er;fr++)mr[fr]=xr[fr]*65793|4278190080;else for(let fr=0,Er=xr.length;fr<Er;fr++)mr[fr]=xr[fr]*16843008|255}},(ar,or)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.GlobalWorkerOptions=void 0;const lr=Object.create(null);or.GlobalWorkerOptions=lr,lr.workerPort=null,lr.workerSrc=""},(ar,or,lr)=>{var xr,nu,iu,Mo;Object.defineProperty(or,"__esModule",{value:!0}),or.MessageHandler=void 0;var cr=lr(1);const ur={DATA:1,ERROR:2},dr={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function hr(vr){switch(vr instanceof Error||typeof vr=="object"&&vr!==null||(0,cr.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),vr.name){case"AbortException":return new cr.AbortException(vr.message);case"MissingPDFException":return new cr.MissingPDFException(vr.message);case"PasswordException":return new cr.PasswordException(vr.message,vr.code);case"UnexpectedResponseException":return new cr.UnexpectedResponseException(vr.message,vr.status);case"UnknownErrorException":return new cr.UnknownErrorException(vr.message,vr.details);default:return new cr.UnknownErrorException(vr.message,vr.toString())}}class pr{constructor(gr,yr,jr){Ss(this,xr);this.sourceName=gr,this.targetName=yr,this.comObj=jr,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=br=>{const _r=br.data;if(_r.targetName!==this.sourceName)return;if(_r.stream){js(this,xr,iu).call(this,_r);return}if(_r.callback){const Rr=_r.callbackId,Ar=this.callbackCapabilities[Rr];if(!Ar)throw new Error(`Cannot resolve callback ${Rr}`);if(delete this.callbackCapabilities[Rr],_r.callback===ur.DATA)Ar.resolve(_r.data);else if(_r.callback===ur.ERROR)Ar.reject(hr(_r.reason));else throw new Error("Unexpected callback case");return}const wr=this.actionHandler[_r.action];if(!wr)throw new Error(`Unknown action from worker: ${_r.action}`);if(_r.callbackId){const Rr=this.sourceName,Ar=_r.sourceName;new Promise(function(Sr){Sr(wr(_r.data))}).then(function(Sr){jr.postMessage({sourceName:Rr,targetName:Ar,callback:ur.DATA,callbackId:_r.callbackId,data:Sr})},function(Sr){jr.postMessage({sourceName:Rr,targetName:Ar,callback:ur.ERROR,callbackId:_r.callbackId,reason:hr(Sr)})});return}if(_r.streamId){js(this,xr,nu).call(this,_r);return}wr(_r.data)},jr.addEventListener("message",this._onComObjOnMessage)}on(gr,yr){const jr=this.actionHandler;if(jr[gr])throw new Error(`There is already an actionName called "${gr}"`);jr[gr]=yr}send(gr,yr,jr){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:gr,data:yr},jr)}sendWithPromise(gr,yr,jr){const br=this.callbackId++,_r=new cr.PromiseCapability;this.callbackCapabilities[br]=_r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:gr,callbackId:br,data:yr},jr)}catch(wr){_r.reject(wr)}return _r.promise}sendWithStream(gr,yr,jr,br){const _r=this.streamId++,wr=this.sourceName,Rr=this.targetName,Ar=this.comObj;return new ReadableStream({start:Sr=>{const kr=new cr.PromiseCapability;return this.streamControllers[_r]={controller:Sr,startCall:kr,pullCall:null,cancelCall:null,isClosed:!1},Ar.postMessage({sourceName:wr,targetName:Rr,action:gr,streamId:_r,data:yr,desiredSize:Sr.desiredSize},br),kr.promise},pull:Sr=>{const kr=new cr.PromiseCapability;return this.streamControllers[_r].pullCall=kr,Ar.postMessage({sourceName:wr,targetName:Rr,stream:dr.PULL,streamId:_r,desiredSize:Sr.desiredSize}),kr.promise},cancel:Sr=>{(0,cr.assert)(Sr instanceof Error,"cancel must have a valid reason");const kr=new cr.PromiseCapability;return this.streamControllers[_r].cancelCall=kr,this.streamControllers[_r].isClosed=!0,Ar.postMessage({sourceName:wr,targetName:Rr,stream:dr.CANCEL,streamId:_r,reason:hr(Sr)}),kr.promise}},jr)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}xr=new WeakSet,nu=function(gr){const yr=gr.streamId,jr=this.sourceName,br=gr.sourceName,_r=this.comObj,wr=this,Rr=this.actionHandler[gr.action],Ar={enqueue(Sr,kr=1,Nr){if(this.isCancelled)return;const Cr=this.desiredSize;this.desiredSize-=kr,Cr>0&&this.desiredSize<=0&&(this.sinkCapability=new cr.PromiseCapability,this.ready=this.sinkCapability.promise),_r.postMessage({sourceName:jr,targetName:br,stream:dr.ENQUEUE,streamId:yr,chunk:Sr},Nr)},close(){this.isCancelled||(this.isCancelled=!0,_r.postMessage({sourceName:jr,targetName:br,stream:dr.CLOSE,streamId:yr}),delete wr.streamSinks[yr])},error(Sr){(0,cr.assert)(Sr instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,_r.postMessage({sourceName:jr,targetName:br,stream:dr.ERROR,streamId:yr,reason:hr(Sr)}))},sinkCapability:new cr.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:gr.desiredSize,ready:null};Ar.sinkCapability.resolve(),Ar.ready=Ar.sinkCapability.promise,this.streamSinks[yr]=Ar,new Promise(function(Sr){Sr(Rr(gr.data,Ar))}).then(function(){_r.postMessage({sourceName:jr,targetName:br,stream:dr.START_COMPLETE,streamId:yr,success:!0})},function(Sr){_r.postMessage({sourceName:jr,targetName:br,stream:dr.START_COMPLETE,streamId:yr,reason:hr(Sr)})})},iu=function(gr){const yr=gr.streamId,jr=this.sourceName,br=gr.sourceName,_r=this.comObj,wr=this.streamControllers[yr],Rr=this.streamSinks[yr];switch(gr.stream){case dr.START_COMPLETE:gr.success?wr.startCall.resolve():wr.startCall.reject(hr(gr.reason));break;case dr.PULL_COMPLETE:gr.success?wr.pullCall.resolve():wr.pullCall.reject(hr(gr.reason));break;case dr.PULL:if(!Rr){_r.postMessage({sourceName:jr,targetName:br,stream:dr.PULL_COMPLETE,streamId:yr,success:!0});break}Rr.desiredSize<=0&&gr.desiredSize>0&&Rr.sinkCapability.resolve(),Rr.desiredSize=gr.desiredSize,new Promise(function(Ar){var Sr;Ar((Sr=Rr.onPull)==null?void 0:Sr.call(Rr))}).then(function(){_r.postMessage({sourceName:jr,targetName:br,stream:dr.PULL_COMPLETE,streamId:yr,success:!0})},function(Ar){_r.postMessage({sourceName:jr,targetName:br,stream:dr.PULL_COMPLETE,streamId:yr,reason:hr(Ar)})});break;case dr.ENQUEUE:if((0,cr.assert)(wr,"enqueue should have stream controller"),wr.isClosed)break;wr.controller.enqueue(gr.chunk);break;case dr.CLOSE:if((0,cr.assert)(wr,"close should have stream controller"),wr.isClosed)break;wr.isClosed=!0,wr.controller.close(),js(this,xr,Mo).call(this,wr,yr);break;case dr.ERROR:(0,cr.assert)(wr,"error should have stream controller"),wr.controller.error(hr(gr.reason)),js(this,xr,Mo).call(this,wr,yr);break;case dr.CANCEL_COMPLETE:gr.success?wr.cancelCall.resolve():wr.cancelCall.reject(hr(gr.reason)),js(this,xr,Mo).call(this,wr,yr);break;case dr.CANCEL:if(!Rr)break;new Promise(function(Ar){var Sr;Ar((Sr=Rr.onCancel)==null?void 0:Sr.call(Rr,hr(gr.reason)))}).then(function(){_r.postMessage({sourceName:jr,targetName:br,stream:dr.CANCEL_COMPLETE,streamId:yr,success:!0})},function(Ar){_r.postMessage({sourceName:jr,targetName:br,stream:dr.CANCEL_COMPLETE,streamId:yr,reason:hr(Ar)})}),Rr.sinkCapability.reject(hr(gr.reason)),Rr.isCancelled=!0,delete this.streamSinks[yr];break;default:throw new Error("Unexpected stream case")}},Mo=async function(gr,yr){var jr,br,_r;await Promise.allSettled([(jr=gr.startCall)==null?void 0:jr.promise,(br=gr.pullCall)==null?void 0:br.promise,(_r=gr.cancelCall)==null?void 0:_r.promise]),delete this.streamControllers[yr]},or.MessageHandler=pr},(ar,or,lr)=>{var dr,hr;Object.defineProperty(or,"__esModule",{value:!0}),or.Metadata=void 0;var cr=lr(1);class ur{constructor({parsedData:xr,rawData:mr}){Ss(this,dr);Ss(this,hr);Cs(this,dr,xr),Cs(this,hr,mr)}getRaw(){return Or(this,hr)}get(xr){return Or(this,dr).get(xr)??null}getAll(){return(0,cr.objectFromMap)(Or(this,dr))}has(xr){return Or(this,dr).has(xr)}}dr=new WeakMap,hr=new WeakMap,or.Metadata=ur},(ar,or,lr)=>{var xr,mr,fr,Er,vr,gr,Tl;Object.defineProperty(or,"__esModule",{value:!0}),or.OptionalContentConfig=void 0;var cr=lr(1),ur=lr(8);const dr=Symbol("INTERNAL");class hr{constructor(br,_r){Ss(this,xr,!0);this.name=br,this.intent=_r}get visible(){return Or(this,xr)}_setVisible(br,_r){br!==dr&&(0,cr.unreachable)("Internal method `_setVisible` called."),Cs(this,xr,_r)}}xr=new WeakMap;class pr{constructor(br){Ss(this,gr);Ss(this,mr,null);Ss(this,fr,new Map);Ss(this,Er,null);Ss(this,vr,null);if(this.name=null,this.creator=null,br!==null){this.name=br.name,this.creator=br.creator,Cs(this,vr,br.order);for(const _r of br.groups)Or(this,fr).set(_r.id,new hr(_r.name,_r.intent));if(br.baseState==="OFF")for(const _r of Or(this,fr).values())_r._setVisible(dr,!1);for(const _r of br.on)Or(this,fr).get(_r)._setVisible(dr,!0);for(const _r of br.off)Or(this,fr).get(_r)._setVisible(dr,!1);Cs(this,Er,this.getHash())}}isVisible(br){if(Or(this,fr).size===0)return!0;if(!br)return(0,cr.warn)("Optional content group not defined."),!0;if(br.type==="OCG")return Or(this,fr).has(br.id)?Or(this,fr).get(br.id).visible:((0,cr.warn)(`Optional content group not found: ${br.id}`),!0);if(br.type==="OCMD"){if(br.expression)return js(this,gr,Tl).call(this,br.expression);if(!br.policy||br.policy==="AnyOn"){for(const _r of br.ids){if(!Or(this,fr).has(_r))return(0,cr.warn)(`Optional content group not found: ${_r}`),!0;if(Or(this,fr).get(_r).visible)return!0}return!1}else if(br.policy==="AllOn"){for(const _r of br.ids){if(!Or(this,fr).has(_r))return(0,cr.warn)(`Optional content group not found: ${_r}`),!0;if(!Or(this,fr).get(_r).visible)return!1}return!0}else if(br.policy==="AnyOff"){for(const _r of br.ids){if(!Or(this,fr).has(_r))return(0,cr.warn)(`Optional content group not found: ${_r}`),!0;if(!Or(this,fr).get(_r).visible)return!0}return!1}else if(br.policy==="AllOff"){for(const _r of br.ids){if(!Or(this,fr).has(_r))return(0,cr.warn)(`Optional content group not found: ${_r}`),!0;if(Or(this,fr).get(_r).visible)return!1}return!0}return(0,cr.warn)(`Unknown optional content policy ${br.policy}.`),!0}return(0,cr.warn)(`Unknown group type ${br.type}.`),!0}setVisibility(br,_r=!0){if(!Or(this,fr).has(br)){(0,cr.warn)(`Optional content group not found: ${br}`);return}Or(this,fr).get(br)._setVisible(dr,!!_r),Cs(this,mr,null)}get hasInitialVisibility(){return Or(this,Er)===null||this.getHash()===Or(this,Er)}getOrder(){return Or(this,fr).size?Or(this,vr)?Or(this,vr).slice():[...Or(this,fr).keys()]:null}getGroups(){return Or(this,fr).size>0?(0,cr.objectFromMap)(Or(this,fr)):null}getGroup(br){return Or(this,fr).get(br)||null}getHash(){if(Or(this,mr)!==null)return Or(this,mr);const br=new ur.MurmurHash3_64;for(const[_r,wr]of Or(this,fr))br.update(`${_r}:${wr.visible}`);return Cs(this,mr,br.hexdigest())}}mr=new WeakMap,fr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakSet,Tl=function(br){const _r=br.length;if(_r<2)return!0;const wr=br[0];for(let Rr=1;Rr<_r;Rr++){const Ar=br[Rr];let Sr;if(Array.isArray(Ar))Sr=js(this,gr,Tl).call(this,Ar);else if(Or(this,fr).has(Ar))Sr=Or(this,fr).get(Ar).visible;else return(0,cr.warn)(`Optional content group not found: ${Ar}`),!0;switch(wr){case"And":if(!Sr)return!1;break;case"Or":if(Sr)return!0;break;case"Not":return!Sr;default:return!0}}return wr==="And"},or.OptionalContentConfig=pr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.PDFDataTransportStream=void 0;var cr=lr(1),ur=lr(6);class dr{constructor({length:mr,initialData:fr,progressiveDone:Er=!1,contentDispositionFilename:vr=null,disableRange:gr=!1,disableStream:yr=!1},jr){if((0,cr.assert)(jr,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=Er,this._contentDispositionFilename=vr,(fr==null?void 0:fr.length)>0){const br=fr instanceof Uint8Array&&fr.byteLength===fr.buffer.byteLength?fr.buffer:new Uint8Array(fr).buffer;this._queuedChunks.push(br)}this._pdfDataRangeTransport=jr,this._isStreamingSupported=!yr,this._isRangeSupported=!gr,this._contentLength=mr,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((br,_r)=>{this._onReceiveData({begin:br,chunk:_r})}),this._pdfDataRangeTransport.addProgressListener((br,_r)=>{this._onProgress({loaded:br,total:_r})}),this._pdfDataRangeTransport.addProgressiveReadListener(br=>{this._onReceiveData({chunk:br})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:mr,chunk:fr}){const Er=fr instanceof Uint8Array&&fr.byteLength===fr.buffer.byteLength?fr.buffer:new Uint8Array(fr).buffer;if(mr===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(Er):this._queuedChunks.push(Er);else{const vr=this._rangeReaders.some(function(gr){return gr._begin!==mr?!1:(gr._enqueue(Er),!0)});(0,cr.assert)(vr,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var mr;return((mr=this._fullRequestReader)==null?void 0:mr._loaded)??0}_onProgress(mr){var fr,Er,vr,gr;mr.total===void 0?(Er=(fr=this._rangeReaders[0])==null?void 0:fr.onProgress)==null||Er.call(fr,{loaded:mr.loaded}):(gr=(vr=this._fullRequestReader)==null?void 0:vr.onProgress)==null||gr.call(vr,{loaded:mr.loaded,total:mr.total})}_onProgressiveDone(){var mr;(mr=this._fullRequestReader)==null||mr.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(mr){const fr=this._rangeReaders.indexOf(mr);fr>=0&&this._rangeReaders.splice(fr,1)}getFullReader(){(0,cr.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const mr=this._queuedChunks;return this._queuedChunks=null,new hr(this,mr,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(mr,fr){if(fr<=this._progressiveDataLength)return null;const Er=new pr(this,mr,fr);return this._pdfDataRangeTransport.requestDataRange(mr,fr),this._rangeReaders.push(Er),Er}cancelAllRequests(mr){var fr;(fr=this._fullRequestReader)==null||fr.cancel(mr);for(const Er of this._rangeReaders.slice(0))Er.cancel(mr);this._pdfDataRangeTransport.abort()}}or.PDFDataTransportStream=dr;class hr{constructor(mr,fr,Er=!1,vr=null){this._stream=mr,this._done=Er||!1,this._filename=(0,ur.isPdfFile)(vr)?vr:null,this._queuedChunks=fr||[],this._loaded=0;for(const gr of this._queuedChunks)this._loaded+=gr.byteLength;this._requests=[],this._headersReady=Promise.resolve(),mr._fullRequestReader=this,this.onProgress=null}_enqueue(mr){this._done||(this._requests.length>0?this._requests.shift().resolve({value:mr,done:!1}):this._queuedChunks.push(mr),this._loaded+=mr.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const mr=new cr.PromiseCapability;return this._requests.push(mr),mr.promise}cancel(mr){this._done=!0;for(const fr of this._requests)fr.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class pr{constructor(mr,fr,Er){this._stream=mr,this._begin=fr,this._end=Er,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(mr){if(!this._done){if(this._requests.length===0)this._queuedChunk=mr;else{this._requests.shift().resolve({value:mr,done:!1});for(const Er of this._requests)Er.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const fr=this._queuedChunk;return this._queuedChunk=null,{value:fr,done:!1}}if(this._done)return{value:void 0,done:!0};const mr=new cr.PromiseCapability;return this._requests.push(mr),mr.promise}cancel(mr){this._done=!0;for(const fr of this._requests)fr.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.PDFFetchStream=void 0;var cr=lr(1),ur=lr(20);function dr(Er,vr,gr){return{method:"GET",headers:Er,signal:gr.signal,mode:"cors",credentials:vr?"include":"same-origin",redirect:"follow"}}function hr(Er){const vr=new Headers;for(const gr in Er){const yr=Er[gr];yr!==void 0&&vr.append(gr,yr)}return vr}function pr(Er){return Er instanceof Uint8Array?Er.buffer:Er instanceof ArrayBuffer?Er:((0,cr.warn)(`getArrayBuffer - unexpected data format: ${Er}`),new Uint8Array(Er).buffer)}class xr{constructor(vr){this.source=vr,this.isHttp=/^https?:/i.test(vr.url),this.httpHeaders=this.isHttp&&vr.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var vr;return((vr=this._fullRequestReader)==null?void 0:vr._loaded)??0}getFullReader(){return(0,cr.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new mr(this),this._fullRequestReader}getRangeReader(vr,gr){if(gr<=this._progressiveDataLength)return null;const yr=new fr(this,vr,gr);return this._rangeRequestReaders.push(yr),yr}cancelAllRequests(vr){var gr;(gr=this._fullRequestReader)==null||gr.cancel(vr);for(const yr of this._rangeRequestReaders.slice(0))yr.cancel(vr)}}or.PDFFetchStream=xr;class mr{constructor(vr){this._stream=vr,this._reader=null,this._loaded=0,this._filename=null;const gr=vr.source;this._withCredentials=gr.withCredentials||!1,this._contentLength=gr.length,this._headersCapability=new cr.PromiseCapability,this._disableRange=gr.disableRange||!1,this._rangeChunkSize=gr.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!gr.disableStream,this._isRangeSupported=!gr.disableRange,this._headers=hr(this._stream.httpHeaders);const yr=gr.url;fetch(yr,dr(this._headers,this._withCredentials,this._abortController)).then(jr=>{if(!(0,ur.validateResponseStatus)(jr.status))throw(0,ur.createResponseStatusError)(jr.status,yr);this._reader=jr.body.getReader(),this._headersCapability.resolve();const br=Rr=>jr.headers.get(Rr),{allowRangeRequests:_r,suggestedLength:wr}=(0,ur.validateRangeRequestCapabilities)({getResponseHeader:br,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=_r,this._contentLength=wr||this._contentLength,this._filename=(0,ur.extractFilenameFromHeader)(br),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new cr.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var yr;await this._headersCapability.promise;const{value:vr,done:gr}=await this._reader.read();return gr?{value:vr,done:gr}:(this._loaded+=vr.byteLength,(yr=this.onProgress)==null||yr.call(this,{loaded:this._loaded,total:this._contentLength}),{value:pr(vr),done:!1})}cancel(vr){var gr;(gr=this._reader)==null||gr.cancel(vr),this._abortController.abort()}}class fr{constructor(vr,gr,yr){this._stream=vr,this._reader=null,this._loaded=0;const jr=vr.source;this._withCredentials=jr.withCredentials||!1,this._readCapability=new cr.PromiseCapability,this._isStreamingSupported=!jr.disableStream,this._abortController=new AbortController,this._headers=hr(this._stream.httpHeaders),this._headers.append("Range",`bytes=${gr}-${yr-1}`);const br=jr.url;fetch(br,dr(this._headers,this._withCredentials,this._abortController)).then(_r=>{if(!(0,ur.validateResponseStatus)(_r.status))throw(0,ur.createResponseStatusError)(_r.status,br);this._readCapability.resolve(),this._reader=_r.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var yr;await this._readCapability.promise;const{value:vr,done:gr}=await this._reader.read();return gr?{value:vr,done:gr}:(this._loaded+=vr.byteLength,(yr=this.onProgress)==null||yr.call(this,{loaded:this._loaded}),{value:pr(vr),done:!1})}cancel(vr){var gr;(gr=this._reader)==null||gr.cancel(vr),this._abortController.abort()}}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.createResponseStatusError=xr,or.extractFilenameFromHeader=pr,or.validateRangeRequestCapabilities=hr,or.validateResponseStatus=mr;var cr=lr(1),ur=lr(21),dr=lr(6);function hr({getResponseHeader:fr,isHttp:Er,rangeChunkSize:vr,disableRange:gr}){const yr={allowRangeRequests:!1,suggestedLength:void 0},jr=parseInt(fr("Content-Length"),10);return!Number.isInteger(jr)||(yr.suggestedLength=jr,jr<=2*vr)||gr||!Er||fr("Accept-Ranges")!=="bytes"||(fr("Content-Encoding")||"identity")!=="identity"||(yr.allowRangeRequests=!0),yr}function pr(fr){const Er=fr("Content-Disposition");if(Er){let vr=(0,ur.getFilenameFromContentDispositionHeader)(Er);if(vr.includes("%"))try{vr=decodeURIComponent(vr)}catch{}if((0,dr.isPdfFile)(vr))return vr}return null}function xr(fr,Er){return fr===404||fr===0&&Er.startsWith("file:")?new cr.MissingPDFException('Missing PDF "'+Er+'".'):new cr.UnexpectedResponseException(`Unexpected server response (${fr}) while retrieving PDF "${Er}".`,fr)}function mr(fr){return fr===200||fr===206}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.getFilenameFromContentDispositionHeader=ur;var cr=lr(1);function ur(dr){let hr=!0,pr=xr("filename\\*","i").exec(dr);if(pr){pr=pr[1];let jr=vr(pr);return jr=unescape(jr),jr=gr(jr),jr=yr(jr),fr(jr)}if(pr=Er(dr),pr){const jr=yr(pr);return fr(jr)}if(pr=xr("filename","i").exec(dr),pr){pr=pr[1];let jr=vr(pr);return jr=yr(jr),fr(jr)}function xr(jr,br){return new RegExp("(?:^|;)\\s*"+jr+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',br)}function mr(jr,br){if(jr){if(!/^[\x00-\xFF]+$/.test(br))return br;try{const _r=new TextDecoder(jr,{fatal:!0}),wr=(0,cr.stringToBytes)(br);br=_r.decode(wr),hr=!1}catch{}}return br}function fr(jr){return hr&&/[\x80-\xff]/.test(jr)&&(jr=mr("utf-8",jr),hr&&(jr=mr("iso-8859-1",jr))),jr}function Er(jr){const br=[];let _r;const wr=xr("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(_r=wr.exec(jr))!==null;){let[,Ar,Sr,kr]=_r;if(Ar=parseInt(Ar,10),Ar in br){if(Ar===0)break;continue}br[Ar]=[Sr,kr]}const Rr=[];for(let Ar=0;Ar<br.length&&Ar in br;++Ar){let[Sr,kr]=br[Ar];kr=vr(kr),Sr&&(kr=unescape(kr),Ar===0&&(kr=gr(kr))),Rr.push(kr)}return Rr.join("")}function vr(jr){if(jr.startsWith('"')){const br=jr.slice(1).split('\\"');for(let _r=0;_r<br.length;++_r){const wr=br[_r].indexOf('"');wr!==-1&&(br[_r]=br[_r].slice(0,wr),br.length=_r+1),br[_r]=br[_r].replaceAll(/\\(.)/g,"$1")}jr=br.join('"')}return jr}function gr(jr){const br=jr.indexOf("'");if(br===-1)return jr;const _r=jr.slice(0,br),Rr=jr.slice(br+1).replace(/^[^']*'/,"");return mr(_r,Rr)}function yr(jr){return!jr.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(jr)?jr:jr.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(br,_r,wr,Rr){if(wr==="q"||wr==="Q")return Rr=Rr.replaceAll("_"," "),Rr=Rr.replaceAll(/=([0-9a-fA-F]{2})/g,function(Ar,Sr){return String.fromCharCode(parseInt(Sr,16))}),mr(_r,Rr);try{Rr=atob(Rr)}catch{}return mr(_r,Rr)})}return""}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.PDFNetworkStream=void 0;var cr=lr(1),ur=lr(20);const dr=200,hr=206;function pr(vr){const gr=vr.response;return typeof gr!="string"?gr:(0,cr.stringToBytes)(gr).buffer}class xr{constructor(gr,yr={}){this.url=gr,this.isHttp=/^https?:/i.test(gr),this.httpHeaders=this.isHttp&&yr.httpHeaders||Object.create(null),this.withCredentials=yr.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(gr,yr,jr){const br={begin:gr,end:yr};for(const _r in jr)br[_r]=jr[_r];return this.request(br)}requestFull(gr){return this.request(gr)}request(gr){const yr=new XMLHttpRequest,jr=this.currXhrId++,br=this.pendingRequests[jr]={xhr:yr};yr.open("GET",this.url),yr.withCredentials=this.withCredentials;for(const _r in this.httpHeaders){const wr=this.httpHeaders[_r];wr!==void 0&&yr.setRequestHeader(_r,wr)}return this.isHttp&&"begin"in gr&&"end"in gr?(yr.setRequestHeader("Range",`bytes=${gr.begin}-${gr.end-1}`),br.expectedStatus=hr):br.expectedStatus=dr,yr.responseType="arraybuffer",gr.onError&&(yr.onerror=function(_r){gr.onError(yr.status)}),yr.onreadystatechange=this.onStateChange.bind(this,jr),yr.onprogress=this.onProgress.bind(this,jr),br.onHeadersReceived=gr.onHeadersReceived,br.onDone=gr.onDone,br.onError=gr.onError,br.onProgress=gr.onProgress,yr.send(null),jr}onProgress(gr,yr){var br;const jr=this.pendingRequests[gr];jr&&((br=jr.onProgress)==null||br.call(jr,yr))}onStateChange(gr,yr){var Ar,Sr,kr;const jr=this.pendingRequests[gr];if(!jr)return;const br=jr.xhr;if(br.readyState>=2&&jr.onHeadersReceived&&(jr.onHeadersReceived(),delete jr.onHeadersReceived),br.readyState!==4||!(gr in this.pendingRequests))return;if(delete this.pendingRequests[gr],br.status===0&&this.isHttp){(Ar=jr.onError)==null||Ar.call(jr,br.status);return}const _r=br.status||dr;if(!(_r===dr&&jr.expectedStatus===hr)&&_r!==jr.expectedStatus){(Sr=jr.onError)==null||Sr.call(jr,br.status);return}const Rr=pr(br);if(_r===hr){const Nr=br.getResponseHeader("Content-Range"),Cr=/bytes (\d+)-(\d+)\/(\d+)/.exec(Nr);jr.onDone({begin:parseInt(Cr[1],10),chunk:Rr})}else Rr?jr.onDone({begin:0,chunk:Rr}):(kr=jr.onError)==null||kr.call(jr,br.status)}getRequestXhr(gr){return this.pendingRequests[gr].xhr}isPendingRequest(gr){return gr in this.pendingRequests}abortRequest(gr){const yr=this.pendingRequests[gr].xhr;delete this.pendingRequests[gr],yr.abort()}}class mr{constructor(gr){this._source=gr,this._manager=new xr(gr.url,{httpHeaders:gr.httpHeaders,withCredentials:gr.withCredentials}),this._rangeChunkSize=gr.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(gr){const yr=this._rangeRequestReaders.indexOf(gr);yr>=0&&this._rangeRequestReaders.splice(yr,1)}getFullReader(){return(0,cr.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new fr(this._manager,this._source),this._fullRequestReader}getRangeReader(gr,yr){const jr=new Er(this._manager,gr,yr);return jr.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(jr),jr}cancelAllRequests(gr){var yr;(yr=this._fullRequestReader)==null||yr.cancel(gr);for(const jr of this._rangeRequestReaders.slice(0))jr.cancel(gr)}}or.PDFNetworkStream=mr;class fr{constructor(gr,yr){this._manager=gr;const jr={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=yr.url,this._fullRequestId=gr.requestFull(jr),this._headersReceivedCapability=new cr.PromiseCapability,this._disableRange=yr.disableRange||!1,this._contentLength=yr.length,this._rangeChunkSize=yr.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const gr=this._fullRequestId,yr=this._manager.getRequestXhr(gr),jr=wr=>yr.getResponseHeader(wr),{allowRangeRequests:br,suggestedLength:_r}=(0,ur.validateRangeRequestCapabilities)({getResponseHeader:jr,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});br&&(this._isRangeSupported=!0),this._contentLength=_r||this._contentLength,this._filename=(0,ur.extractFilenameFromHeader)(jr),this._isRangeSupported&&this._manager.abortRequest(gr),this._headersReceivedCapability.resolve()}_onDone(gr){if(gr&&(this._requests.length>0?this._requests.shift().resolve({value:gr.chunk,done:!1}):this._cachedChunks.push(gr.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const yr of this._requests)yr.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(gr){this._storedError=(0,ur.createResponseStatusError)(gr,this._url),this._headersReceivedCapability.reject(this._storedError);for(const yr of this._requests)yr.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(gr){var yr;(yr=this.onProgress)==null||yr.call(this,{loaded:gr.loaded,total:gr.lengthComputable?gr.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const gr=new cr.PromiseCapability;return this._requests.push(gr),gr.promise}cancel(gr){this._done=!0,this._headersReceivedCapability.reject(gr);for(const yr of this._requests)yr.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Er{constructor(gr,yr,jr){this._manager=gr;const br={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=gr.url,this._requestId=gr.requestRange(yr,jr,br),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var gr;(gr=this.onClosed)==null||gr.call(this,this)}_onDone(gr){const yr=gr.chunk;this._requests.length>0?this._requests.shift().resolve({value:yr,done:!1}):this._queuedChunk=yr,this._done=!0;for(const jr of this._requests)jr.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(gr){this._storedError=(0,ur.createResponseStatusError)(gr,this._url);for(const yr of this._requests)yr.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(gr){var yr;this.isStreamingSupported||(yr=this.onProgress)==null||yr.call(this,{loaded:gr.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const yr=this._queuedChunk;return this._queuedChunk=null,{value:yr,done:!1}}if(this._done)return{value:void 0,done:!0};const gr=new cr.PromiseCapability;return this._requests.push(gr),gr.promise}cancel(gr){this._done=!0;for(const yr of this._requests)yr.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.PDFNodeStream=void 0;var cr=lr(1),ur=lr(20);const dr=/^file:\/\/\/[a-zA-Z]:\//;function hr(jr){const br=require$$5,_r=br.parse(jr);return _r.protocol==="file:"||_r.host?_r:/^[a-z]:[/\\]/i.test(jr)?br.parse(`file:///${jr}`):(_r.host||(_r.protocol="file:"),_r)}class pr{constructor(br){this.source=br,this.url=hr(br.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&br.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var br;return((br=this._fullRequestReader)==null?void 0:br._loaded)??0}getFullReader(){return(0,cr.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new gr(this):new Er(this),this._fullRequestReader}getRangeReader(br,_r){if(_r<=this._progressiveDataLength)return null;const wr=this.isFsUrl?new yr(this,br,_r):new vr(this,br,_r);return this._rangeRequestReaders.push(wr),wr}cancelAllRequests(br){var _r;(_r=this._fullRequestReader)==null||_r.cancel(br);for(const wr of this._rangeRequestReaders.slice(0))wr.cancel(br)}}or.PDFNodeStream=pr;class xr{constructor(br){this._url=br.url,this._done=!1,this._storedError=null,this.onProgress=null;const _r=br.source;this._contentLength=_r.length,this._loaded=0,this._filename=null,this._disableRange=_r.disableRange||!1,this._rangeChunkSize=_r.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!_r.disableStream,this._isRangeSupported=!_r.disableRange,this._readableStream=null,this._readCapability=new cr.PromiseCapability,this._headersCapability=new cr.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var wr;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const br=this._readableStream.read();return br===null?(this._readCapability=new cr.PromiseCapability,this.read()):(this._loaded+=br.length,(wr=this.onProgress)==null||wr.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(br).buffer,done:!1})}cancel(br){if(!this._readableStream){this._error(br);return}this._readableStream.destroy(br)}_error(br){this._storedError=br,this._readCapability.resolve()}_setReadableStream(br){this._readableStream=br,br.on("readable",()=>{this._readCapability.resolve()}),br.on("end",()=>{br.destroy(),this._done=!0,this._readCapability.resolve()}),br.on("error",_r=>{this._error(_r)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new cr.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class mr{constructor(br){this._url=br.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new cr.PromiseCapability;const _r=br.source;this._isStreamingSupported=!_r.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var wr;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const br=this._readableStream.read();return br===null?(this._readCapability=new cr.PromiseCapability,this.read()):(this._loaded+=br.length,(wr=this.onProgress)==null||wr.call(this,{loaded:this._loaded}),{value:new Uint8Array(br).buffer,done:!1})}cancel(br){if(!this._readableStream){this._error(br);return}this._readableStream.destroy(br)}_error(br){this._storedError=br,this._readCapability.resolve()}_setReadableStream(br){this._readableStream=br,br.on("readable",()=>{this._readCapability.resolve()}),br.on("end",()=>{br.destroy(),this._done=!0,this._readCapability.resolve()}),br.on("error",_r=>{this._error(_r)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function fr(jr,br){return{protocol:jr.protocol,auth:jr.auth,host:jr.hostname,port:jr.port,path:jr.path,method:"GET",headers:br}}class Er extends xr{constructor(br){super(br);const _r=wr=>{if(wr.statusCode===404){const kr=new cr.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=kr,this._headersCapability.reject(kr);return}this._headersCapability.resolve(),this._setReadableStream(wr);const Rr=kr=>this._readableStream.headers[kr.toLowerCase()],{allowRangeRequests:Ar,suggestedLength:Sr}=(0,ur.validateRangeRequestCapabilities)({getResponseHeader:Rr,isHttp:br.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=Ar,this._contentLength=Sr||this._contentLength,this._filename=(0,ur.extractFilenameFromHeader)(Rr)};if(this._request=null,this._url.protocol==="http:"){const wr=require$$5;this._request=wr.request(fr(this._url,br.httpHeaders),_r)}else{const wr=require$$5;this._request=wr.request(fr(this._url,br.httpHeaders),_r)}this._request.on("error",wr=>{this._storedError=wr,this._headersCapability.reject(wr)}),this._request.end()}}class vr extends mr{constructor(br,_r,wr){super(br),this._httpHeaders={};for(const Ar in br.httpHeaders){const Sr=br.httpHeaders[Ar];Sr!==void 0&&(this._httpHeaders[Ar]=Sr)}this._httpHeaders.Range=`bytes=${_r}-${wr-1}`;const Rr=Ar=>{if(Ar.statusCode===404){const Sr=new cr.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Sr;return}this._setReadableStream(Ar)};if(this._request=null,this._url.protocol==="http:"){const Ar=require$$5;this._request=Ar.request(fr(this._url,this._httpHeaders),Rr)}else{const Ar=require$$5;this._request=Ar.request(fr(this._url,this._httpHeaders),Rr)}this._request.on("error",Ar=>{this._storedError=Ar}),this._request.end()}}class gr extends xr{constructor(br){super(br);let _r=decodeURIComponent(this._url.path);dr.test(this._url.href)&&(_r=_r.replace(/^\//,""));const wr=require$$5;wr.lstat(_r,(Rr,Ar)=>{if(Rr){Rr.code==="ENOENT"&&(Rr=new cr.MissingPDFException(`Missing PDF "${_r}".`)),this._storedError=Rr,this._headersCapability.reject(Rr);return}this._contentLength=Ar.size,this._setReadableStream(wr.createReadStream(_r)),this._headersCapability.resolve()})}}class yr extends mr{constructor(br,_r,wr){super(br);let Rr=decodeURIComponent(this._url.path);dr.test(this._url.href)&&(Rr=Rr.replace(/^\//,""));const Ar=require$$5;this._setReadableStream(Ar.createReadStream(Rr,{start:_r,end:wr-1}))}}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.SVGGraphics=void 0;var cr=lr(6),ur=lr(1);const dr={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},hr="http://www.w3.org/XML/1998/namespace",pr="http://www.w3.org/1999/xlink",xr=["butt","round","square"],mr=["miter","round","bevel"],fr=function(Ar,Sr="",kr=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!kr)return URL.createObjectURL(new Blob([Ar],{type:Sr}));const Nr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let Cr=`data:${Sr};base64,`;for(let Tr=0,Pr=Ar.length;Tr<Pr;Tr+=3){const Ir=Ar[Tr]&255,Br=Ar[Tr+1]&255,Wr=Ar[Tr+2]&255,Yr=Ir>>2,es=(Ir&3)<<4|Br>>4,ps=Tr+1<Pr?(Br&15)<<2|Wr>>6:64,ts=Tr+2<Pr?Wr&63:64;Cr+=Nr[Yr]+Nr[es]+Nr[ps]+Nr[ts]}return Cr},Er=function(){const Ar=new Uint8Array([137,80,78,71,13,10,26,10]),Sr=12,kr=new Int32Array(256);for(let Wr=0;Wr<256;Wr++){let Yr=Wr;for(let es=0;es<8;es++)Yr=Yr&1?3988292384^Yr>>1&2147483647:Yr>>1&2147483647;kr[Wr]=Yr}function Nr(Wr,Yr,es){let ps=-1;for(let ts=Yr;ts<es;ts++){const Qr=(ps^Wr[ts])&255,Hr=kr[Qr];ps=ps>>>8^Hr}return ps^-1}function Cr(Wr,Yr,es,ps){let ts=ps;const Qr=Yr.length;es[ts]=Qr>>24&255,es[ts+1]=Qr>>16&255,es[ts+2]=Qr>>8&255,es[ts+3]=Qr&255,ts+=4,es[ts]=Wr.charCodeAt(0)&255,es[ts+1]=Wr.charCodeAt(1)&255,es[ts+2]=Wr.charCodeAt(2)&255,es[ts+3]=Wr.charCodeAt(3)&255,ts+=4,es.set(Yr,ts),ts+=Yr.length;const Hr=Nr(es,ps+4,ts);es[ts]=Hr>>24&255,es[ts+1]=Hr>>16&255,es[ts+2]=Hr>>8&255,es[ts+3]=Hr&255}function Tr(Wr,Yr,es){let ps=1,ts=0;for(let Qr=Yr;Qr<es;++Qr)ps=(ps+(Wr[Qr]&255))%65521,ts=(ts+ps)%65521;return ts<<16|ps}function Pr(Wr){if(!ur.isNodeJS)return Ir(Wr);try{const Yr=parseInt(process.versions.node)>=8?Wr:Buffer.from(Wr),es=require$$5.deflateSync(Yr,{level:9});return es instanceof Uint8Array?es:new Uint8Array(es)}catch(Yr){(0,ur.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Yr)}return Ir(Wr)}function Ir(Wr){let Yr=Wr.length;const es=65535,ps=Math.ceil(Yr/es),ts=new Uint8Array(2+Yr+ps*5+4);let Qr=0;ts[Qr++]=120,ts[Qr++]=156;let Hr=0;for(;Yr>es;)ts[Qr++]=0,ts[Qr++]=255,ts[Qr++]=255,ts[Qr++]=0,ts[Qr++]=0,ts.set(Wr.subarray(Hr,Hr+es),Qr),Qr+=es,Hr+=es,Yr-=es;ts[Qr++]=1,ts[Qr++]=Yr&255,ts[Qr++]=Yr>>8&255,ts[Qr++]=~Yr&65535&255,ts[Qr++]=(~Yr&65535)>>8&255,ts.set(Wr.subarray(Hr),Qr),Qr+=Wr.length-Hr;const Kr=Tr(Wr,0,Wr.length);return ts[Qr++]=Kr>>24&255,ts[Qr++]=Kr>>16&255,ts[Qr++]=Kr>>8&255,ts[Qr++]=Kr&255,ts}function Br(Wr,Yr,es,ps){const ts=Wr.width,Qr=Wr.height;let Hr,Kr,rs;const Mr=Wr.data;switch(Yr){case ur.ImageKind.GRAYSCALE_1BPP:Kr=0,Hr=1,rs=ts+7>>3;break;case ur.ImageKind.RGB_24BPP:Kr=2,Hr=8,rs=ts*3;break;case ur.ImageKind.RGBA_32BPP:Kr=6,Hr=8,rs=ts*4;break;default:throw new Error("invalid format")}const Dr=new Uint8Array((1+rs)*Qr);let Lr=0,Fr=0;for(let ls=0;ls<Qr;++ls)Dr[Lr++]=0,Dr.set(Mr.subarray(Fr,Fr+rs),Lr),Fr+=rs,Lr+=rs;if(Yr===ur.ImageKind.GRAYSCALE_1BPP&&ps){Lr=0;for(let ls=0;ls<Qr;ls++){Lr++;for(let ds=0;ds<rs;ds++)Dr[Lr++]^=255}}const $r=new Uint8Array([ts>>24&255,ts>>16&255,ts>>8&255,ts&255,Qr>>24&255,Qr>>16&255,Qr>>8&255,Qr&255,Hr,Kr,0,0,0]),Vr=Pr(Dr),Gr=Ar.length+Sr*3+$r.length+Vr.length,Jr=new Uint8Array(Gr);let ms=0;return Jr.set(Ar,ms),ms+=Ar.length,Cr("IHDR",$r,Jr,ms),ms+=Sr+$r.length,Cr("IDATA",Vr,Jr,ms),ms+=Sr+Vr.length,Cr("IEND",new Uint8Array(0),Jr,ms),fr(Jr,"image/png",es)}return function(Yr,es,ps){const ts=Yr.kind===void 0?ur.ImageKind.GRAYSCALE_1BPP:Yr.kind;return Br(Yr,ts,es,ps)}}();class vr{constructor(){this.fontSizeScale=1,this.fontWeight=dr.fontWeight,this.fontSize=0,this.textMatrix=ur.IDENTITY_MATRIX,this.fontMatrix=ur.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=ur.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=dr.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(Sr,kr){this.x=Sr,this.y=kr}}function gr(Ar){let Sr=[];const kr=[];for(const Nr of Ar){if(Nr.fn==="save"){Sr.push({fnId:92,fn:"group",items:[]}),kr.push(Sr),Sr=Sr.at(-1).items;continue}Nr.fn==="restore"?Sr=kr.pop():Sr.push(Nr)}return Sr}function yr(Ar){if(Number.isInteger(Ar))return Ar.toString();const Sr=Ar.toFixed(10);let kr=Sr.length-1;if(Sr[kr]!=="0")return Sr;do kr--;while(Sr[kr]==="0");return Sr.substring(0,Sr[kr]==="."?kr:kr+1)}function jr(Ar){if(Ar[4]===0&&Ar[5]===0){if(Ar[1]===0&&Ar[2]===0)return Ar[0]===1&&Ar[3]===1?"":`scale(${yr(Ar[0])} ${yr(Ar[3])})`;if(Ar[0]===Ar[3]&&Ar[1]===-Ar[2]){const Sr=Math.acos(Ar[0])*180/Math.PI;return`rotate(${yr(Sr)})`}}else if(Ar[0]===1&&Ar[1]===0&&Ar[2]===0&&Ar[3]===1)return`translate(${yr(Ar[4])} ${yr(Ar[5])})`;return`matrix(${yr(Ar[0])} ${yr(Ar[1])} ${yr(Ar[2])} ${yr(Ar[3])} ${yr(Ar[4])} ${yr(Ar[5])})`}let br=0,_r=0,wr=0;class Rr{constructor(Sr,kr,Nr=!1){(0,cr.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new cr.DOMSVGFactory,this.current=new vr,this.transformMatrix=ur.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=Sr,this.objs=kr,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!Nr,this._operatorIdMapping=[];for(const Cr in ur.OPS)this._operatorIdMapping[ur.OPS[Cr]]=Cr}getObject(Sr,kr=null){return typeof Sr=="string"?Sr.startsWith("g_")?this.commonObjs.get(Sr):this.objs.get(Sr):kr}save(){this.transformStack.push(this.transformMatrix);const Sr=this.current;this.extraStack.push(Sr),this.current=Sr.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(Sr){this.save(),this.executeOpTree(Sr),this.restore()}loadDependencies(Sr){const kr=Sr.fnArray,Nr=Sr.argsArray;for(let Cr=0,Tr=kr.length;Cr<Tr;Cr++)if(kr[Cr]===ur.OPS.dependency)for(const Pr of Nr[Cr]){const Ir=Pr.startsWith("g_")?this.commonObjs:this.objs,Br=new Promise(Wr=>{Ir.get(Pr,Wr)});this.current.dependencies.push(Br)}return Promise.all(this.current.dependencies)}transform(Sr,kr,Nr,Cr,Tr,Pr){const Ir=[Sr,kr,Nr,Cr,Tr,Pr];this.transformMatrix=ur.Util.transform(this.transformMatrix,Ir),this.tgrp=null}getSVG(Sr,kr){this.viewport=kr;const Nr=this._initialize(kr);return this.loadDependencies(Sr).then(()=>(this.transformMatrix=ur.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(Sr)),Nr))}convertOpList(Sr){const kr=this._operatorIdMapping,Nr=Sr.argsArray,Cr=Sr.fnArray,Tr=[];for(let Pr=0,Ir=Cr.length;Pr<Ir;Pr++){const Br=Cr[Pr];Tr.push({fnId:Br,fn:kr[Br],args:Nr[Pr]})}return gr(Tr)}executeOpTree(Sr){for(const kr of Sr){const Nr=kr.fn,Cr=kr.fnId,Tr=kr.args;switch(Cr|0){case ur.OPS.beginText:this.beginText();break;case ur.OPS.dependency:break;case ur.OPS.setLeading:this.setLeading(Tr);break;case ur.OPS.setLeadingMoveText:this.setLeadingMoveText(Tr[0],Tr[1]);break;case ur.OPS.setFont:this.setFont(Tr);break;case ur.OPS.showText:this.showText(Tr[0]);break;case ur.OPS.showSpacedText:this.showText(Tr[0]);break;case ur.OPS.endText:this.endText();break;case ur.OPS.moveText:this.moveText(Tr[0],Tr[1]);break;case ur.OPS.setCharSpacing:this.setCharSpacing(Tr[0]);break;case ur.OPS.setWordSpacing:this.setWordSpacing(Tr[0]);break;case ur.OPS.setHScale:this.setHScale(Tr[0]);break;case ur.OPS.setTextMatrix:this.setTextMatrix(Tr[0],Tr[1],Tr[2],Tr[3],Tr[4],Tr[5]);break;case ur.OPS.setTextRise:this.setTextRise(Tr[0]);break;case ur.OPS.setTextRenderingMode:this.setTextRenderingMode(Tr[0]);break;case ur.OPS.setLineWidth:this.setLineWidth(Tr[0]);break;case ur.OPS.setLineJoin:this.setLineJoin(Tr[0]);break;case ur.OPS.setLineCap:this.setLineCap(Tr[0]);break;case ur.OPS.setMiterLimit:this.setMiterLimit(Tr[0]);break;case ur.OPS.setFillRGBColor:this.setFillRGBColor(Tr[0],Tr[1],Tr[2]);break;case ur.OPS.setStrokeRGBColor:this.setStrokeRGBColor(Tr[0],Tr[1],Tr[2]);break;case ur.OPS.setStrokeColorN:this.setStrokeColorN(Tr);break;case ur.OPS.setFillColorN:this.setFillColorN(Tr);break;case ur.OPS.shadingFill:this.shadingFill(Tr[0]);break;case ur.OPS.setDash:this.setDash(Tr[0],Tr[1]);break;case ur.OPS.setRenderingIntent:this.setRenderingIntent(Tr[0]);break;case ur.OPS.setFlatness:this.setFlatness(Tr[0]);break;case ur.OPS.setGState:this.setGState(Tr[0]);break;case ur.OPS.fill:this.fill();break;case ur.OPS.eoFill:this.eoFill();break;case ur.OPS.stroke:this.stroke();break;case ur.OPS.fillStroke:this.fillStroke();break;case ur.OPS.eoFillStroke:this.eoFillStroke();break;case ur.OPS.clip:this.clip("nonzero");break;case ur.OPS.eoClip:this.clip("evenodd");break;case ur.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case ur.OPS.paintImageXObject:this.paintImageXObject(Tr[0]);break;case ur.OPS.paintInlineImageXObject:this.paintInlineImageXObject(Tr[0]);break;case ur.OPS.paintImageMaskXObject:this.paintImageMaskXObject(Tr[0]);break;case ur.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(Tr[0],Tr[1]);break;case ur.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case ur.OPS.closePath:this.closePath();break;case ur.OPS.closeStroke:this.closeStroke();break;case ur.OPS.closeFillStroke:this.closeFillStroke();break;case ur.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case ur.OPS.nextLine:this.nextLine();break;case ur.OPS.transform:this.transform(Tr[0],Tr[1],Tr[2],Tr[3],Tr[4],Tr[5]);break;case ur.OPS.constructPath:this.constructPath(Tr[0],Tr[1]);break;case ur.OPS.endPath:this.endPath();break;case 92:this.group(kr.items);break;default:(0,ur.warn)(`Unimplemented operator ${Nr}`);break}}}setWordSpacing(Sr){this.current.wordSpacing=Sr}setCharSpacing(Sr){this.current.charSpacing=Sr}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(Sr,kr,Nr,Cr,Tr,Pr){const Ir=this.current;Ir.textMatrix=Ir.lineMatrix=[Sr,kr,Nr,Cr,Tr,Pr],Ir.textMatrixScale=Math.hypot(Sr,kr),Ir.x=Ir.lineX=0,Ir.y=Ir.lineY=0,Ir.xcoords=[],Ir.ycoords=[],Ir.tspan=this.svgFactory.createElement("svg:tspan"),Ir.tspan.setAttributeNS(null,"font-family",Ir.fontFamily),Ir.tspan.setAttributeNS(null,"font-size",`${yr(Ir.fontSize)}px`),Ir.tspan.setAttributeNS(null,"y",yr(-Ir.y)),Ir.txtElement=this.svgFactory.createElement("svg:text"),Ir.txtElement.append(Ir.tspan)}beginText(){const Sr=this.current;Sr.x=Sr.lineX=0,Sr.y=Sr.lineY=0,Sr.textMatrix=ur.IDENTITY_MATRIX,Sr.lineMatrix=ur.IDENTITY_MATRIX,Sr.textMatrixScale=1,Sr.tspan=this.svgFactory.createElement("svg:tspan"),Sr.txtElement=this.svgFactory.createElement("svg:text"),Sr.txtgrp=this.svgFactory.createElement("svg:g"),Sr.xcoords=[],Sr.ycoords=[]}moveText(Sr,kr){const Nr=this.current;Nr.x=Nr.lineX+=Sr,Nr.y=Nr.lineY+=kr,Nr.xcoords=[],Nr.ycoords=[],Nr.tspan=this.svgFactory.createElement("svg:tspan"),Nr.tspan.setAttributeNS(null,"font-family",Nr.fontFamily),Nr.tspan.setAttributeNS(null,"font-size",`${yr(Nr.fontSize)}px`),Nr.tspan.setAttributeNS(null,"y",yr(-Nr.y))}showText(Sr){const kr=this.current,Nr=kr.font,Cr=kr.fontSize;if(Cr===0)return;const Tr=kr.fontSizeScale,Pr=kr.charSpacing,Ir=kr.wordSpacing,Br=kr.fontDirection,Wr=kr.textHScale*Br,Yr=Nr.vertical,es=Yr?1:-1,ps=Nr.defaultVMetrics,ts=Cr*kr.fontMatrix[0];let Qr=0;for(const rs of Sr){if(rs===null){Qr+=Br*Ir;continue}else if(typeof rs=="number"){Qr+=es*rs*Cr/1e3;continue}const Mr=(rs.isSpace?Ir:0)+Pr,Dr=rs.fontChar;let Lr,Fr,$r=rs.width;if(Yr){let Gr;const Jr=rs.vmetric||ps;Gr=rs.vmetric?Jr[1]:$r*.5,Gr=-Gr*ts;const ms=Jr[2]*ts;$r=Jr?-Jr[0]:$r,Lr=Gr/Tr,Fr=(Qr+ms)/Tr}else Lr=Qr/Tr,Fr=0;(rs.isInFont||Nr.missingFile)&&(kr.xcoords.push(kr.x+Lr),Yr&&kr.ycoords.push(-kr.y+Fr),kr.tspan.textContent+=Dr);const Vr=Yr?$r*ts-Mr*Br:$r*ts+Mr*Br;Qr+=Vr}kr.tspan.setAttributeNS(null,"x",kr.xcoords.map(yr).join(" ")),Yr?kr.tspan.setAttributeNS(null,"y",kr.ycoords.map(yr).join(" ")):kr.tspan.setAttributeNS(null,"y",yr(-kr.y)),Yr?kr.y-=Qr:kr.x+=Qr*Wr,kr.tspan.setAttributeNS(null,"font-family",kr.fontFamily),kr.tspan.setAttributeNS(null,"font-size",`${yr(kr.fontSize)}px`),kr.fontStyle!==dr.fontStyle&&kr.tspan.setAttributeNS(null,"font-style",kr.fontStyle),kr.fontWeight!==dr.fontWeight&&kr.tspan.setAttributeNS(null,"font-weight",kr.fontWeight);const Hr=kr.textRenderingMode&ur.TextRenderingMode.FILL_STROKE_MASK;if(Hr===ur.TextRenderingMode.FILL||Hr===ur.TextRenderingMode.FILL_STROKE?(kr.fillColor!==dr.fillColor&&kr.tspan.setAttributeNS(null,"fill",kr.fillColor),kr.fillAlpha<1&&kr.tspan.setAttributeNS(null,"fill-opacity",kr.fillAlpha)):kr.textRenderingMode===ur.TextRenderingMode.ADD_TO_PATH?kr.tspan.setAttributeNS(null,"fill","transparent"):kr.tspan.setAttributeNS(null,"fill","none"),Hr===ur.TextRenderingMode.STROKE||Hr===ur.TextRenderingMode.FILL_STROKE){const rs=1/(kr.textMatrixScale||1);this._setStrokeAttributes(kr.tspan,rs)}let Kr=kr.textMatrix;kr.textRise!==0&&(Kr=Kr.slice(),Kr[5]+=kr.textRise),kr.txtElement.setAttributeNS(null,"transform",`${jr(Kr)} scale(${yr(Wr)}, -1)`),kr.txtElement.setAttributeNS(hr,"xml:space","preserve"),kr.txtElement.append(kr.tspan),kr.txtgrp.append(kr.txtElement),this._ensureTransformGroup().append(kr.txtElement)}setLeadingMoveText(Sr,kr){this.setLeading(-kr),this.moveText(Sr,kr)}addFontStyle(Sr){if(!Sr.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const kr=fr(Sr.data,Sr.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${Sr.loadedName}"; src: url(${kr}); }
`}setFont(Sr){const kr=this.current,Nr=this.commonObjs.get(Sr[0]);let Cr=Sr[1];kr.font=Nr,this.embedFonts&&!Nr.missingFile&&!this.embeddedFonts[Nr.loadedName]&&(this.addFontStyle(Nr),this.embeddedFonts[Nr.loadedName]=Nr),kr.fontMatrix=Nr.fontMatrix||ur.FONT_IDENTITY_MATRIX;let Tr="normal";Nr.black?Tr="900":Nr.bold&&(Tr="bold");const Pr=Nr.italic?"italic":"normal";Cr<0?(Cr=-Cr,kr.fontDirection=-1):kr.fontDirection=1,kr.fontSize=Cr,kr.fontFamily=Nr.loadedName,kr.fontWeight=Tr,kr.fontStyle=Pr,kr.tspan=this.svgFactory.createElement("svg:tspan"),kr.tspan.setAttributeNS(null,"y",yr(-kr.y)),kr.xcoords=[],kr.ycoords=[]}endText(){var kr;const Sr=this.current;Sr.textRenderingMode&ur.TextRenderingMode.ADD_TO_PATH_FLAG&&((kr=Sr.txtElement)!=null&&kr.hasChildNodes())&&(Sr.element=Sr.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(Sr){Sr>0&&(this.current.lineWidth=Sr)}setLineCap(Sr){this.current.lineCap=xr[Sr]}setLineJoin(Sr){this.current.lineJoin=mr[Sr]}setMiterLimit(Sr){this.current.miterLimit=Sr}setStrokeAlpha(Sr){this.current.strokeAlpha=Sr}setStrokeRGBColor(Sr,kr,Nr){this.current.strokeColor=ur.Util.makeHexColor(Sr,kr,Nr)}setFillAlpha(Sr){this.current.fillAlpha=Sr}setFillRGBColor(Sr,kr,Nr){this.current.fillColor=ur.Util.makeHexColor(Sr,kr,Nr),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(Sr){this.current.strokeColor=this._makeColorN_Pattern(Sr)}setFillColorN(Sr){this.current.fillColor=this._makeColorN_Pattern(Sr)}shadingFill(Sr){const{width:kr,height:Nr}=this.viewport,Cr=ur.Util.inverseTransform(this.transformMatrix),[Tr,Pr,Ir,Br]=ur.Util.getAxialAlignedBoundingBox([0,0,kr,Nr],Cr),Wr=this.svgFactory.createElement("svg:rect");Wr.setAttributeNS(null,"x",Tr),Wr.setAttributeNS(null,"y",Pr),Wr.setAttributeNS(null,"width",Ir-Tr),Wr.setAttributeNS(null,"height",Br-Pr),Wr.setAttributeNS(null,"fill",this._makeShadingPattern(Sr)),this.current.fillAlpha<1&&Wr.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Wr)}_makeColorN_Pattern(Sr){return Sr[0]==="TilingPattern"?this._makeTilingPattern(Sr):this._makeShadingPattern(Sr)}_makeTilingPattern(Sr){const kr=Sr[1],Nr=Sr[2],Cr=Sr[3]||ur.IDENTITY_MATRIX,[Tr,Pr,Ir,Br]=Sr[4],Wr=Sr[5],Yr=Sr[6],es=Sr[7],ps=`shading${wr++}`,[ts,Qr,Hr,Kr]=ur.Util.normalizeRect([...ur.Util.applyTransform([Tr,Pr],Cr),...ur.Util.applyTransform([Ir,Br],Cr)]),[rs,Mr]=ur.Util.singularValueDecompose2dScale(Cr),Dr=Wr*rs,Lr=Yr*Mr,Fr=this.svgFactory.createElement("svg:pattern");Fr.setAttributeNS(null,"id",ps),Fr.setAttributeNS(null,"patternUnits","userSpaceOnUse"),Fr.setAttributeNS(null,"width",Dr),Fr.setAttributeNS(null,"height",Lr),Fr.setAttributeNS(null,"x",`${ts}`),Fr.setAttributeNS(null,"y",`${Qr}`);const $r=this.svg,Vr=this.transformMatrix,Gr=this.current.fillColor,Jr=this.current.strokeColor,ms=this.svgFactory.create(Hr-ts,Kr-Qr);if(this.svg=ms,this.transformMatrix=Cr,es===2){const ls=ur.Util.makeHexColor(...kr);this.current.fillColor=ls,this.current.strokeColor=ls}return this.executeOpTree(this.convertOpList(Nr)),this.svg=$r,this.transformMatrix=Vr,this.current.fillColor=Gr,this.current.strokeColor=Jr,Fr.append(ms.childNodes[0]),this.defs.append(Fr),`url(#${ps})`}_makeShadingPattern(Sr){switch(typeof Sr=="string"&&(Sr=this.objs.get(Sr)),Sr[0]){case"RadialAxial":const kr=`shading${wr++}`,Nr=Sr[3];let Cr;switch(Sr[1]){case"axial":const Tr=Sr[4],Pr=Sr[5];Cr=this.svgFactory.createElement("svg:linearGradient"),Cr.setAttributeNS(null,"id",kr),Cr.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),Cr.setAttributeNS(null,"x1",Tr[0]),Cr.setAttributeNS(null,"y1",Tr[1]),Cr.setAttributeNS(null,"x2",Pr[0]),Cr.setAttributeNS(null,"y2",Pr[1]);break;case"radial":const Ir=Sr[4],Br=Sr[5],Wr=Sr[6],Yr=Sr[7];Cr=this.svgFactory.createElement("svg:radialGradient"),Cr.setAttributeNS(null,"id",kr),Cr.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),Cr.setAttributeNS(null,"cx",Br[0]),Cr.setAttributeNS(null,"cy",Br[1]),Cr.setAttributeNS(null,"r",Yr),Cr.setAttributeNS(null,"fx",Ir[0]),Cr.setAttributeNS(null,"fy",Ir[1]),Cr.setAttributeNS(null,"fr",Wr);break;default:throw new Error(`Unknown RadialAxial type: ${Sr[1]}`)}for(const Tr of Nr){const Pr=this.svgFactory.createElement("svg:stop");Pr.setAttributeNS(null,"offset",Tr[0]),Pr.setAttributeNS(null,"stop-color",Tr[1]),Cr.append(Pr)}return this.defs.append(Cr),`url(#${kr})`;case"Mesh":return(0,ur.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${Sr[0]}`)}}setDash(Sr,kr){this.current.dashArray=Sr,this.current.dashPhase=kr}constructPath(Sr,kr){const Nr=this.current;let Cr=Nr.x,Tr=Nr.y,Pr=[],Ir=0;for(const Br of Sr)switch(Br|0){case ur.OPS.rectangle:Cr=kr[Ir++],Tr=kr[Ir++];const Wr=kr[Ir++],Yr=kr[Ir++],es=Cr+Wr,ps=Tr+Yr;Pr.push("M",yr(Cr),yr(Tr),"L",yr(es),yr(Tr),"L",yr(es),yr(ps),"L",yr(Cr),yr(ps),"Z");break;case ur.OPS.moveTo:Cr=kr[Ir++],Tr=kr[Ir++],Pr.push("M",yr(Cr),yr(Tr));break;case ur.OPS.lineTo:Cr=kr[Ir++],Tr=kr[Ir++],Pr.push("L",yr(Cr),yr(Tr));break;case ur.OPS.curveTo:Cr=kr[Ir+4],Tr=kr[Ir+5],Pr.push("C",yr(kr[Ir]),yr(kr[Ir+1]),yr(kr[Ir+2]),yr(kr[Ir+3]),yr(Cr),yr(Tr)),Ir+=6;break;case ur.OPS.curveTo2:Pr.push("C",yr(Cr),yr(Tr),yr(kr[Ir]),yr(kr[Ir+1]),yr(kr[Ir+2]),yr(kr[Ir+3])),Cr=kr[Ir+2],Tr=kr[Ir+3],Ir+=4;break;case ur.OPS.curveTo3:Cr=kr[Ir+2],Tr=kr[Ir+3],Pr.push("C",yr(kr[Ir]),yr(kr[Ir+1]),yr(Cr),yr(Tr),yr(Cr),yr(Tr)),Ir+=4;break;case ur.OPS.closePath:Pr.push("Z");break}Pr=Pr.join(" "),Nr.path&&Sr.length>0&&Sr[0]!==ur.OPS.rectangle&&Sr[0]!==ur.OPS.moveTo?Pr=Nr.path.getAttributeNS(null,"d")+Pr:(Nr.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(Nr.path)),Nr.path.setAttributeNS(null,"d",Pr),Nr.path.setAttributeNS(null,"fill","none"),Nr.element=Nr.path,Nr.setCurrentPoint(Cr,Tr)}endPath(){const Sr=this.current;if(Sr.path=null,!this.pendingClip)return;if(!Sr.element){this.pendingClip=null;return}const kr=`clippath${br++}`,Nr=this.svgFactory.createElement("svg:clipPath");Nr.setAttributeNS(null,"id",kr),Nr.setAttributeNS(null,"transform",jr(this.transformMatrix));const Cr=Sr.element.cloneNode(!0);if(this.pendingClip==="evenodd"?Cr.setAttributeNS(null,"clip-rule","evenodd"):Cr.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,Nr.append(Cr),this.defs.append(Nr),Sr.activeClipUrl){Sr.clipGroup=null;for(const Tr of this.extraStack)Tr.clipGroup=null;Nr.setAttributeNS(null,"clip-path",Sr.activeClipUrl)}Sr.activeClipUrl=`url(#${kr})`,this.tgrp=null}clip(Sr){this.pendingClip=Sr}closePath(){const Sr=this.current;if(Sr.path){const kr=`${Sr.path.getAttributeNS(null,"d")}Z`;Sr.path.setAttributeNS(null,"d",kr)}}setLeading(Sr){this.current.leading=-Sr}setTextRise(Sr){this.current.textRise=Sr}setTextRenderingMode(Sr){this.current.textRenderingMode=Sr}setHScale(Sr){this.current.textHScale=Sr/100}setRenderingIntent(Sr){}setFlatness(Sr){}setGState(Sr){for(const[kr,Nr]of Sr)switch(kr){case"LW":this.setLineWidth(Nr);break;case"LC":this.setLineCap(Nr);break;case"LJ":this.setLineJoin(Nr);break;case"ML":this.setMiterLimit(Nr);break;case"D":this.setDash(Nr[0],Nr[1]);break;case"RI":this.setRenderingIntent(Nr);break;case"FL":this.setFlatness(Nr);break;case"Font":this.setFont(Nr);break;case"CA":this.setStrokeAlpha(Nr);break;case"ca":this.setFillAlpha(Nr);break;default:(0,ur.warn)(`Unimplemented graphic state operator ${kr}`);break}}fill(){const Sr=this.current;Sr.element&&(Sr.element.setAttributeNS(null,"fill",Sr.fillColor),Sr.element.setAttributeNS(null,"fill-opacity",Sr.fillAlpha),this.endPath())}stroke(){const Sr=this.current;Sr.element&&(this._setStrokeAttributes(Sr.element),Sr.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(Sr,kr=1){const Nr=this.current;let Cr=Nr.dashArray;kr!==1&&Cr.length>0&&(Cr=Cr.map(function(Tr){return kr*Tr})),Sr.setAttributeNS(null,"stroke",Nr.strokeColor),Sr.setAttributeNS(null,"stroke-opacity",Nr.strokeAlpha),Sr.setAttributeNS(null,"stroke-miterlimit",yr(Nr.miterLimit)),Sr.setAttributeNS(null,"stroke-linecap",Nr.lineCap),Sr.setAttributeNS(null,"stroke-linejoin",Nr.lineJoin),Sr.setAttributeNS(null,"stroke-width",yr(kr*Nr.lineWidth)+"px"),Sr.setAttributeNS(null,"stroke-dasharray",Cr.map(yr).join(" ")),Sr.setAttributeNS(null,"stroke-dashoffset",yr(kr*Nr.dashPhase)+"px")}eoFill(){var Sr;(Sr=this.current.element)==null||Sr.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var Sr;(Sr=this.current.element)==null||Sr.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const Sr=this.svgFactory.createElement("svg:rect");Sr.setAttributeNS(null,"x","0"),Sr.setAttributeNS(null,"y","0"),Sr.setAttributeNS(null,"width","1px"),Sr.setAttributeNS(null,"height","1px"),Sr.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(Sr)}paintImageXObject(Sr){const kr=this.getObject(Sr);if(!kr){(0,ur.warn)(`Dependent image with object ID ${Sr} is not ready yet`);return}this.paintInlineImageXObject(kr)}paintInlineImageXObject(Sr,kr){const Nr=Sr.width,Cr=Sr.height,Tr=Er(Sr,this.forceDataSchema,!!kr),Pr=this.svgFactory.createElement("svg:rect");Pr.setAttributeNS(null,"x","0"),Pr.setAttributeNS(null,"y","0"),Pr.setAttributeNS(null,"width",yr(Nr)),Pr.setAttributeNS(null,"height",yr(Cr)),this.current.element=Pr,this.clip("nonzero");const Ir=this.svgFactory.createElement("svg:image");Ir.setAttributeNS(pr,"xlink:href",Tr),Ir.setAttributeNS(null,"x","0"),Ir.setAttributeNS(null,"y",yr(-Cr)),Ir.setAttributeNS(null,"width",yr(Nr)+"px"),Ir.setAttributeNS(null,"height",yr(Cr)+"px"),Ir.setAttributeNS(null,"transform",`scale(${yr(1/Nr)} ${yr(-1/Cr)})`),kr?kr.append(Ir):this._ensureTransformGroup().append(Ir)}paintImageMaskXObject(Sr){const kr=this.getObject(Sr.data,Sr);if(kr.bitmap){(0,ur.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const Nr=this.current,Cr=kr.width,Tr=kr.height,Pr=Nr.fillColor;Nr.maskId=`mask${_r++}`;const Ir=this.svgFactory.createElement("svg:mask");Ir.setAttributeNS(null,"id",Nr.maskId);const Br=this.svgFactory.createElement("svg:rect");Br.setAttributeNS(null,"x","0"),Br.setAttributeNS(null,"y","0"),Br.setAttributeNS(null,"width",yr(Cr)),Br.setAttributeNS(null,"height",yr(Tr)),Br.setAttributeNS(null,"fill",Pr),Br.setAttributeNS(null,"mask",`url(#${Nr.maskId})`),this.defs.append(Ir),this._ensureTransformGroup().append(Br),this.paintInlineImageXObject(kr,Ir)}paintFormXObjectBegin(Sr,kr){if(Array.isArray(Sr)&&Sr.length===6&&this.transform(Sr[0],Sr[1],Sr[2],Sr[3],Sr[4],Sr[5]),kr){const Nr=kr[2]-kr[0],Cr=kr[3]-kr[1],Tr=this.svgFactory.createElement("svg:rect");Tr.setAttributeNS(null,"x",kr[0]),Tr.setAttributeNS(null,"y",kr[1]),Tr.setAttributeNS(null,"width",yr(Nr)),Tr.setAttributeNS(null,"height",yr(Cr)),this.current.element=Tr,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(Sr){const kr=this.svgFactory.create(Sr.width,Sr.height),Nr=this.svgFactory.createElement("svg:defs");kr.append(Nr),this.defs=Nr;const Cr=this.svgFactory.createElement("svg:g");return Cr.setAttributeNS(null,"transform",jr(Sr.transform)),kr.append(Cr),this.svg=Cr,kr}_ensureClipGroup(){if(!this.current.clipGroup){const Sr=this.svgFactory.createElement("svg:g");Sr.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(Sr),this.current.clipGroup=Sr}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",jr(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}or.SVGGraphics=Rr},(ar,or)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.XfaText=void 0;class lr{static textContent(ur){const dr=[],hr={items:dr,styles:Object.create(null)};function pr(xr){var Er;if(!xr)return;let mr=null;const fr=xr.name;if(fr==="#text")mr=xr.value;else if(lr.shouldBuildText(fr))(Er=xr==null?void 0:xr.attributes)!=null&&Er.textContent?mr=xr.attributes.textContent:xr.value&&(mr=xr.value);else return;if(mr!==null&&dr.push({str:mr}),!!xr.children)for(const vr of xr.children)pr(vr)}return pr(ur),hr}static shouldBuildText(ur){return!(ur==="textarea"||ur==="input"||ur==="option"||ur==="select")}}or.XfaText=lr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.TextLayerRenderTask=void 0,or.renderTextLayer=jr,or.updateTextLayer=br;var cr=lr(1),ur=lr(6);const dr=1e5,hr=30,pr=.8,xr=new Map;function mr(_r,wr){let Rr;if(wr&&cr.FeatureTest.isOffscreenCanvasSupported)Rr=new OffscreenCanvas(_r,_r).getContext("2d",{alpha:!1});else{const Ar=document.createElement("canvas");Ar.width=Ar.height=_r,Rr=Ar.getContext("2d",{alpha:!1})}return Rr}function fr(_r,wr){const Rr=xr.get(_r);if(Rr)return Rr;const Ar=mr(hr,wr);Ar.font=`${hr}px ${_r}`;const Sr=Ar.measureText("");let kr=Sr.fontBoundingBoxAscent,Nr=Math.abs(Sr.fontBoundingBoxDescent);if(kr){const Tr=kr/(kr+Nr);return xr.set(_r,Tr),Ar.canvas.width=Ar.canvas.height=0,Tr}Ar.strokeStyle="red",Ar.clearRect(0,0,hr,hr),Ar.strokeText("g",0,0);let Cr=Ar.getImageData(0,0,hr,hr).data;Nr=0;for(let Tr=Cr.length-1-3;Tr>=0;Tr-=4)if(Cr[Tr]>0){Nr=Math.ceil(Tr/4/hr);break}Ar.clearRect(0,0,hr,hr),Ar.strokeText("A",0,hr),Cr=Ar.getImageData(0,0,hr,hr).data,kr=0;for(let Tr=0,Pr=Cr.length;Tr<Pr;Tr+=4)if(Cr[Tr]>0){kr=hr-Math.floor(Tr/4/hr);break}if(Ar.canvas.width=Ar.canvas.height=0,kr){const Tr=kr/(kr+Nr);return xr.set(_r,Tr),Tr}return xr.set(_r,pr),pr}function Er(_r,wr,Rr){const Ar=document.createElement("span"),Sr={angle:0,canvasWidth:0,hasText:wr.str!=="",hasEOL:wr.hasEOL,fontSize:0};_r._textDivs.push(Ar);const kr=cr.Util.transform(_r._transform,wr.transform);let Nr=Math.atan2(kr[1],kr[0]);const Cr=Rr[wr.fontName];Cr.vertical&&(Nr+=Math.PI/2);const Tr=Math.hypot(kr[2],kr[3]),Pr=Tr*fr(Cr.fontFamily,_r._isOffscreenCanvasSupported);let Ir,Br;Nr===0?(Ir=kr[4],Br=kr[5]-Pr):(Ir=kr[4]+Pr*Math.sin(Nr),Br=kr[5]-Pr*Math.cos(Nr));const Wr="calc(var(--scale-factor)*",Yr=Ar.style;_r._container===_r._rootContainer?(Yr.left=`${(100*Ir/_r._pageWidth).toFixed(2)}%`,Yr.top=`${(100*Br/_r._pageHeight).toFixed(2)}%`):(Yr.left=`${Wr}${Ir.toFixed(2)}px)`,Yr.top=`${Wr}${Br.toFixed(2)}px)`),Yr.fontSize=`${Wr}${Tr.toFixed(2)}px)`,Yr.fontFamily=Cr.fontFamily,Sr.fontSize=Tr,Ar.setAttribute("role","presentation"),Ar.textContent=wr.str,Ar.dir=wr.dir,_r._fontInspectorEnabled&&(Ar.dataset.fontName=wr.fontName),Nr!==0&&(Sr.angle=Nr*(180/Math.PI));let es=!1;if(wr.str.length>1)es=!0;else if(wr.str!==" "&&wr.transform[0]!==wr.transform[3]){const ps=Math.abs(wr.transform[0]),ts=Math.abs(wr.transform[3]);ps!==ts&&Math.max(ps,ts)/Math.min(ps,ts)>1.5&&(es=!0)}es&&(Sr.canvasWidth=Cr.vertical?wr.height:wr.width),_r._textDivProperties.set(Ar,Sr),_r._isReadableStream&&_r._layoutText(Ar)}function vr(_r){const{div:wr,scale:Rr,properties:Ar,ctx:Sr,prevFontSize:kr,prevFontFamily:Nr}=_r,{style:Cr}=wr;let Tr="";if(Ar.canvasWidth!==0&&Ar.hasText){const{fontFamily:Pr}=Cr,{canvasWidth:Ir,fontSize:Br}=Ar;(kr!==Br||Nr!==Pr)&&(Sr.font=`${Br*Rr}px ${Pr}`,_r.prevFontSize=Br,_r.prevFontFamily=Pr);const{width:Wr}=Sr.measureText(wr.textContent);Wr>0&&(Tr=`scaleX(${Ir*Rr/Wr})`)}Ar.angle!==0&&(Tr=`rotate(${Ar.angle}deg) ${Tr}`),Tr.length>0&&(Cr.transform=Tr)}function gr(_r){if(_r._canceled)return;const wr=_r._textDivs,Rr=_r._capability;if(wr.length>dr){Rr.resolve();return}if(!_r._isReadableStream)for(const Sr of wr)_r._layoutText(Sr);Rr.resolve()}class yr{constructor({textContentSource:wr,container:Rr,viewport:Ar,textDivs:Sr,textDivProperties:kr,textContentItemsStr:Nr,isOffscreenCanvasSupported:Cr}){var Wr;this._textContentSource=wr,this._isReadableStream=wr instanceof ReadableStream,this._container=this._rootContainer=Rr,this._textDivs=Sr||[],this._textContentItemsStr=Nr||[],this._isOffscreenCanvasSupported=Cr,this._fontInspectorEnabled=!!((Wr=globalThis.FontInspector)!=null&&Wr.enabled),this._reader=null,this._textDivProperties=kr||new WeakMap,this._canceled=!1,this._capability=new cr.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:Ar.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:mr(0,Cr)};const{pageWidth:Tr,pageHeight:Pr,pageX:Ir,pageY:Br}=Ar.rawDims;this._transform=[1,0,0,-1,-Ir,Br+Pr],this._pageWidth=Tr,this._pageHeight=Pr,(0,ur.setLayerDimensions)(Rr,Ar),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new cr.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new cr.AbortException("TextLayer task cancelled."))}_processItems(wr,Rr){for(const Ar of wr){if(Ar.str===void 0){if(Ar.type==="beginMarkedContentProps"||Ar.type==="beginMarkedContent"){const Sr=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),Ar.id!==null&&this._container.setAttribute("id",`${Ar.id}`),Sr.append(this._container)}else Ar.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(Ar.str),Er(this,Ar,Rr)}}_layoutText(wr){const Rr=this._layoutTextParams.properties=this._textDivProperties.get(wr);if(this._layoutTextParams.div=wr,vr(this._layoutTextParams),Rr.hasText&&this._container.append(wr),Rr.hasEOL){const Ar=document.createElement("br");Ar.setAttribute("role","presentation"),this._container.append(Ar)}}_render(){const wr=new cr.PromiseCapability;let Rr=Object.create(null);if(this._isReadableStream){const Ar=()=>{this._reader.read().then(({value:Sr,done:kr})=>{if(kr){wr.resolve();return}Object.assign(Rr,Sr.styles),this._processItems(Sr.items,Rr),Ar()},wr.reject)};this._reader=this._textContentSource.getReader(),Ar()}else if(this._textContentSource){const{items:Ar,styles:Sr}=this._textContentSource;this._processItems(Ar,Sr),wr.resolve()}else throw new Error('No "textContentSource" parameter specified.');wr.promise.then(()=>{Rr=null,gr(this)},this._capability.reject)}}or.TextLayerRenderTask=yr;function jr(_r){!_r.textContentSource&&(_r.textContent||_r.textContentStream)&&((0,ur.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),_r.textContentSource=_r.textContent||_r.textContentStream);const{container:wr,viewport:Rr}=_r,Ar=getComputedStyle(wr),Sr=Ar.getPropertyValue("visibility"),kr=parseFloat(Ar.getPropertyValue("--scale-factor"));Sr==="visible"&&(!kr||Math.abs(kr-Rr.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const Nr=new yr(_r);return Nr._render(),Nr}function br({container:_r,viewport:wr,textDivs:Rr,textDivProperties:Ar,isOffscreenCanvasSupported:Sr,mustRotate:kr=!0,mustRescale:Nr=!0}){if(kr&&(0,ur.setLayerDimensions)(_r,{rotation:wr.rotation}),Nr){const Cr=mr(0,Sr),Pr={prevFontSize:null,prevFontFamily:null,div:null,scale:wr.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:Cr};for(const Ir of Rr)Pr.properties=Ar.get(Ir),Pr.div=Ir,vr(Pr)}}},(ar,or,lr)=>{var fr,Er,vr,gr,yr,jr,br,_r,wr,Rr,Ar,Al,Fo,Pl,Ll;Object.defineProperty(or,"__esModule",{value:!0}),or.AnnotationEditorLayer=void 0;var cr=lr(1),ur=lr(4),dr=lr(28),hr=lr(33),pr=lr(6),xr=lr(34);const Tr=class Tr{constructor({uiManager:Ir,pageIndex:Br,div:Wr,accessibilityManager:Yr,annotationLayer:es,viewport:ps,l10n:ts}){Ss(this,Ar);Ss(this,fr);Ss(this,Er,!1);Ss(this,vr,null);Ss(this,gr,this.pointerup.bind(this));Ss(this,yr,this.pointerdown.bind(this));Ss(this,jr,new Map);Ss(this,br,!1);Ss(this,_r,!1);Ss(this,wr,!1);Ss(this,Rr);const Qr=[dr.FreeTextEditor,hr.InkEditor,xr.StampEditor];if(!Tr._initialized){Tr._initialized=!0;for(const Hr of Qr)Hr.initialize(ts)}Ir.registerEditorTypes(Qr),Cs(this,Rr,Ir),this.pageIndex=Br,this.div=Wr,Cs(this,fr,Yr),Cs(this,vr,es),this.viewport=ps,Or(this,Rr).addLayer(this)}get isEmpty(){return Or(this,jr).size===0}updateToolbar(Ir){Or(this,Rr).updateToolbar(Ir)}updateMode(Ir=Or(this,Rr).getMode()){js(this,Ar,Ll).call(this),Ir===cr.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),Ir!==cr.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",Ir===cr.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",Ir===cr.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",Ir===cr.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(Ir){if(!Ir&&Or(this,Rr).getMode()!==cr.AnnotationEditorType.INK)return;if(!Ir){for(const Wr of Or(this,jr).values())if(Wr.isEmpty()){Wr.setInBackground();return}}js(this,Ar,Fo).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(Ir){Or(this,Rr).setEditingState(Ir)}addCommands(Ir){Or(this,Rr).addCommands(Ir)}enable(){this.div.style.pointerEvents="auto";const Ir=new Set;for(const Wr of Or(this,jr).values())Wr.enableEditing(),Wr.annotationElementId&&Ir.add(Wr.annotationElementId);if(!Or(this,vr))return;const Br=Or(this,vr).getEditableAnnotations();for(const Wr of Br){if(Wr.hide(),Or(this,Rr).isDeletedAnnotationElement(Wr.data.id)||Ir.has(Wr.data.id))continue;const Yr=this.deserialize(Wr);Yr&&(this.addOrRebuild(Yr),Yr.enableEditing())}}disable(){var Br;Cs(this,wr,!0),this.div.style.pointerEvents="none";const Ir=new Set;for(const Wr of Or(this,jr).values()){if(Wr.disableEditing(),!Wr.annotationElementId||Wr.serialize()!==null){Ir.add(Wr.annotationElementId);continue}(Br=this.getEditableAnnotation(Wr.annotationElementId))==null||Br.show(),Wr.remove()}if(Or(this,vr)){const Wr=Or(this,vr).getEditableAnnotations();for(const Yr of Wr){const{id:es}=Yr.data;Ir.has(es)||Or(this,Rr).isDeletedAnnotationElement(es)||Yr.show()}}js(this,Ar,Ll).call(this),this.isEmpty&&(this.div.hidden=!0),Cs(this,wr,!1)}getEditableAnnotation(Ir){var Br;return((Br=Or(this,vr))==null?void 0:Br.getEditableAnnotation(Ir))||null}setActiveEditor(Ir){Or(this,Rr).getActive()!==Ir&&Or(this,Rr).setActiveEditor(Ir)}enableClick(){this.div.addEventListener("pointerdown",Or(this,yr)),this.div.addEventListener("pointerup",Or(this,gr))}disableClick(){this.div.removeEventListener("pointerdown",Or(this,yr)),this.div.removeEventListener("pointerup",Or(this,gr))}attach(Ir){Or(this,jr).set(Ir.id,Ir);const{annotationElementId:Br}=Ir;Br&&Or(this,Rr).isDeletedAnnotationElement(Br)&&Or(this,Rr).removeDeletedAnnotationElement(Ir)}detach(Ir){var Br;Or(this,jr).delete(Ir.id),(Br=Or(this,fr))==null||Br.removePointerInTextLayer(Ir.contentDiv),!Or(this,wr)&&Ir.annotationElementId&&Or(this,Rr).addDeletedAnnotationElement(Ir)}remove(Ir){this.detach(Ir),Or(this,Rr).removeEditor(Ir),Ir.div.contains(document.activeElement)&&setTimeout(()=>{Or(this,Rr).focusMainContainer()},0),Ir.div.remove(),Ir.isAttachedToDOM=!1,Or(this,_r)||this.addInkEditorIfNeeded(!1)}changeParent(Ir){var Br;Ir.parent!==this&&(Ir.annotationElementId&&(Or(this,Rr).addDeletedAnnotationElement(Ir.annotationElementId),ur.AnnotationEditor.deleteAnnotationElement(Ir),Ir.annotationElementId=null),this.attach(Ir),(Br=Ir.parent)==null||Br.detach(Ir),Ir.setParent(this),Ir.div&&Ir.isAttachedToDOM&&(Ir.div.remove(),this.div.append(Ir.div)))}add(Ir){if(this.changeParent(Ir),Or(this,Rr).addEditor(Ir),this.attach(Ir),!Ir.isAttachedToDOM){const Br=Ir.render();this.div.append(Br),Ir.isAttachedToDOM=!0}Ir.fixAndSetPosition(),Ir.onceAdded(),Or(this,Rr).addToAnnotationStorage(Ir)}moveEditorInDOM(Ir){var Wr;if(!Ir.isAttachedToDOM)return;const{activeElement:Br}=document;Ir.div.contains(Br)&&(Ir._focusEventsAllowed=!1,setTimeout(()=>{Ir.div.contains(document.activeElement)?Ir._focusEventsAllowed=!0:(Ir.div.addEventListener("focusin",()=>{Ir._focusEventsAllowed=!0},{once:!0}),Br.focus())},0)),Ir._structTreeParentId=(Wr=Or(this,fr))==null?void 0:Wr.moveElementInDOM(this.div,Ir.div,Ir.contentDiv,!0)}addOrRebuild(Ir){Ir.needsToBeRebuilt()?Ir.rebuild():this.add(Ir)}addUndoableEditor(Ir){const Br=()=>Ir._uiManager.rebuild(Ir),Wr=()=>{Ir.remove()};this.addCommands({cmd:Br,undo:Wr,mustExec:!1})}getNextId(){return Or(this,Rr).getId()}pasteEditor(Ir,Br){Or(this,Rr).updateToolbar(Ir),Or(this,Rr).updateMode(Ir);const{offsetX:Wr,offsetY:Yr}=js(this,Ar,Pl).call(this),es=this.getNextId(),ps=js(this,Ar,Al).call(this,{parent:this,id:es,x:Wr,y:Yr,uiManager:Or(this,Rr),isCentered:!0,...Br});ps&&this.add(ps)}deserialize(Ir){switch(Ir.annotationType??Ir.annotationEditorType){case cr.AnnotationEditorType.FREETEXT:return dr.FreeTextEditor.deserialize(Ir,this,Or(this,Rr));case cr.AnnotationEditorType.INK:return hr.InkEditor.deserialize(Ir,this,Or(this,Rr));case cr.AnnotationEditorType.STAMP:return xr.StampEditor.deserialize(Ir,this,Or(this,Rr))}return null}addNewEditor(){js(this,Ar,Fo).call(this,js(this,Ar,Pl).call(this),!0)}setSelected(Ir){Or(this,Rr).setSelected(Ir)}toggleSelected(Ir){Or(this,Rr).toggleSelected(Ir)}isSelected(Ir){return Or(this,Rr).isSelected(Ir)}unselect(Ir){Or(this,Rr).unselect(Ir)}pointerup(Ir){const{isMac:Br}=cr.FeatureTest.platform;if(!(Ir.button!==0||Ir.ctrlKey&&Br)&&Ir.target===this.div&&Or(this,br)){if(Cs(this,br,!1),!Or(this,Er)){Cs(this,Er,!0);return}if(Or(this,Rr).getMode()===cr.AnnotationEditorType.STAMP){Or(this,Rr).unselectAll();return}js(this,Ar,Fo).call(this,Ir,!1)}}pointerdown(Ir){if(Or(this,br)){Cs(this,br,!1);return}const{isMac:Br}=cr.FeatureTest.platform;if(Ir.button!==0||Ir.ctrlKey&&Br||Ir.target!==this.div)return;Cs(this,br,!0);const Wr=Or(this,Rr).getActive();Cs(this,Er,!Wr||Wr.isEmpty())}findNewParent(Ir,Br,Wr){const Yr=Or(this,Rr).findParent(Br,Wr);return Yr===null||Yr===this?!1:(Yr.changeParent(Ir),!0)}destroy(){var Ir,Br;((Ir=Or(this,Rr).getActive())==null?void 0:Ir.parent)===this&&(Or(this,Rr).commitOrRemove(),Or(this,Rr).setActiveEditor(null));for(const Wr of Or(this,jr).values())(Br=Or(this,fr))==null||Br.removePointerInTextLayer(Wr.contentDiv),Wr.setParent(null),Wr.isAttachedToDOM=!1,Wr.div.remove();this.div=null,Or(this,jr).clear(),Or(this,Rr).removeLayer(this)}render({viewport:Ir}){this.viewport=Ir,(0,pr.setLayerDimensions)(this.div,Ir);for(const Br of Or(this,Rr).getEditors(this.pageIndex))this.add(Br);this.updateMode()}update({viewport:Ir}){Or(this,Rr).commitOrRemove(),this.viewport=Ir,(0,pr.setLayerDimensions)(this.div,{rotation:Ir.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:Ir,pageHeight:Br}=this.viewport.rawDims;return[Ir,Br]}};fr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,jr=new WeakMap,br=new WeakMap,_r=new WeakMap,wr=new WeakMap,Rr=new WeakMap,Ar=new WeakSet,Al=function(Ir){switch(Or(this,Rr).getMode()){case cr.AnnotationEditorType.FREETEXT:return new dr.FreeTextEditor(Ir);case cr.AnnotationEditorType.INK:return new hr.InkEditor(Ir);case cr.AnnotationEditorType.STAMP:return new xr.StampEditor(Ir)}return null},Fo=function(Ir,Br){const Wr=this.getNextId(),Yr=js(this,Ar,Al).call(this,{parent:this,id:Wr,x:Ir.offsetX,y:Ir.offsetY,uiManager:Or(this,Rr),isCentered:Br});return Yr&&this.add(Yr),Yr},Pl=function(){const{x:Ir,y:Br,width:Wr,height:Yr}=this.div.getBoundingClientRect(),es=Math.max(0,Ir),ps=Math.max(0,Br),ts=Math.min(window.innerWidth,Ir+Wr),Qr=Math.min(window.innerHeight,Br+Yr),Hr=(es+ts)/2-Ir,Kr=(ps+Qr)/2-Br,[rs,Mr]=this.viewport.rotation%180===0?[Hr,Kr]:[Kr,Hr];return{offsetX:rs,offsetY:Mr}},Ll=function(){Cs(this,_r,!0);for(const Ir of Or(this,jr).values())Ir.isEmpty()&&Ir.remove();Cs(this,_r,!1)},io(Tr,"_initialized",!1);let mr=Tr;or.AnnotationEditorLayer=mr},(ar,or,lr)=>{var xr,mr,fr,Er,vr,gr,yr,jr,br,_r,au,ou,lu,Co,Dl,cu,Il;Object.defineProperty(or,"__esModule",{value:!0}),or.FreeTextEditor=void 0;var cr=lr(1),ur=lr(5),dr=lr(4),hr=lr(29);const Tr=class Tr extends dr.AnnotationEditor{constructor(Br){super({...Br,name:"freeTextEditor"});Ss(this,_r);Ss(this,xr,this.editorDivBlur.bind(this));Ss(this,mr,this.editorDivFocus.bind(this));Ss(this,fr,this.editorDivInput.bind(this));Ss(this,Er,this.editorDivKeydown.bind(this));Ss(this,vr);Ss(this,gr,"");Ss(this,yr,`${this.id}-editor`);Ss(this,jr);Ss(this,br,null);Cs(this,vr,Br.color||Tr._defaultColor||dr.AnnotationEditor._defaultLineColor),Cs(this,jr,Br.fontSize||Tr._defaultFontSize)}static get _keyboardManager(){const Br=Tr.prototype,Wr=ps=>ps.isEmpty(),Yr=ur.AnnotationEditorUIManager.TRANSLATE_SMALL,es=ur.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,cr.shadow)(this,"_keyboardManager",new ur.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],Br.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],Br.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],Br._translateEmpty,{args:[-Yr,0],checker:Wr}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Br._translateEmpty,{args:[-es,0],checker:Wr}],[["ArrowRight","mac+ArrowRight"],Br._translateEmpty,{args:[Yr,0],checker:Wr}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Br._translateEmpty,{args:[es,0],checker:Wr}],[["ArrowUp","mac+ArrowUp"],Br._translateEmpty,{args:[0,-Yr],checker:Wr}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Br._translateEmpty,{args:[0,-es],checker:Wr}],[["ArrowDown","mac+ArrowDown"],Br._translateEmpty,{args:[0,Yr],checker:Wr}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Br._translateEmpty,{args:[0,es],checker:Wr}]]))}static initialize(Br){dr.AnnotationEditor.initialize(Br,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const Wr=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(Wr.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Br,Wr){switch(Br){case cr.AnnotationEditorParamsType.FREETEXT_SIZE:Tr._defaultFontSize=Wr;break;case cr.AnnotationEditorParamsType.FREETEXT_COLOR:Tr._defaultColor=Wr;break}}updateParams(Br,Wr){switch(Br){case cr.AnnotationEditorParamsType.FREETEXT_SIZE:js(this,_r,au).call(this,Wr);break;case cr.AnnotationEditorParamsType.FREETEXT_COLOR:js(this,_r,ou).call(this,Wr);break}}static get defaultPropertiesToUpdate(){return[[cr.AnnotationEditorParamsType.FREETEXT_SIZE,Tr._defaultFontSize],[cr.AnnotationEditorParamsType.FREETEXT_COLOR,Tr._defaultColor||dr.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[cr.AnnotationEditorParamsType.FREETEXT_SIZE,Or(this,jr)],[cr.AnnotationEditorParamsType.FREETEXT_COLOR,Or(this,vr)]]}_translateEmpty(Br,Wr){this._uiManager.translateSelectedEditors(Br,Wr,!0)}getInitialTranslation(){const Br=this.parentScale;return[-Tr._internalPadding*Br,-(Tr._internalPadding+Or(this,jr))*Br]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(cr.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",Or(this,Er)),this.editorDiv.addEventListener("focus",Or(this,mr)),this.editorDiv.addEventListener("blur",Or(this,xr)),this.editorDiv.addEventListener("input",Or(this,fr)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",Or(this,yr)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",Or(this,Er)),this.editorDiv.removeEventListener("focus",Or(this,mr)),this.editorDiv.removeEventListener("blur",Or(this,xr)),this.editorDiv.removeEventListener("input",Or(this,fr)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Br){this._focusEventsAllowed&&(super.focusin(Br),Br.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var Br;if(this.width){js(this,_r,Il).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(Br=this._initialOptions)!=null&&Br.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Br=Or(this,gr),Wr=Cs(this,gr,js(this,_r,lu).call(this).trimEnd());if(Br===Wr)return;const Yr=es=>{if(Cs(this,gr,es),!es){this.remove();return}js(this,_r,Dl).call(this),this._uiManager.rebuild(this),js(this,_r,Co).call(this)};this.addCommands({cmd:()=>{Yr(Wr)},undo:()=>{Yr(Br)},mustExec:!1}),js(this,_r,Co).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(Br){this.enterInEditMode()}keydown(Br){Br.target===this.div&&Br.key==="Enter"&&(this.enterInEditMode(),Br.preventDefault())}editorDivKeydown(Br){Tr._keyboardManager.exec(this,Br)}editorDivFocus(Br){this.isEditing=!0}editorDivBlur(Br){this.isEditing=!1}editorDivInput(Br){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Br,Wr;this.width&&(Br=this.x,Wr=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",Or(this,yr)),this.enableEditing(),dr.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(es=>{var ps;return(ps=this.editorDiv)==null?void 0:ps.setAttribute("aria-label",es)}),dr.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(es=>{var ps;return(ps=this.editorDiv)==null?void 0:ps.setAttribute("default-content",es)}),this.editorDiv.contentEditable=!0;const{style:Yr}=this.editorDiv;if(Yr.fontSize=`calc(${Or(this,jr)}px * var(--scale-factor))`,Yr.color=Or(this,vr),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,ur.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[es,ps]=this.parentDimensions;if(this.annotationElementId){const{position:ts}=Or(this,br);let[Qr,Hr]=this.getInitialTranslation();[Qr,Hr]=this.pageTranslationToScreen(Qr,Hr);const[Kr,rs]=this.pageDimensions,[Mr,Dr]=this.pageTranslation;let Lr,Fr;switch(this.rotation){case 0:Lr=Br+(ts[0]-Mr)/Kr,Fr=Wr+this.height-(ts[1]-Dr)/rs;break;case 90:Lr=Br+(ts[0]-Mr)/Kr,Fr=Wr-(ts[1]-Dr)/rs,[Qr,Hr]=[Hr,-Qr];break;case 180:Lr=Br-this.width+(ts[0]-Mr)/Kr,Fr=Wr-(ts[1]-Dr)/rs,[Qr,Hr]=[-Qr,-Hr];break;case 270:Lr=Br+(ts[0]-Mr-this.height*rs)/Kr,Fr=Wr+(ts[1]-Dr-this.width*Kr)/rs,[Qr,Hr]=[-Hr,Qr];break}this.setAt(Lr*es,Fr*ps,Qr,Hr)}else this.setAt(Br*es,Wr*ps,this.width*es,this.height*ps);js(this,_r,Dl).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Br,Wr,Yr){let es=null;if(Br instanceof hr.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:ts,fontColor:Qr},rect:Hr,rotation:Kr,id:rs},textContent:Mr,textPosition:Dr,parent:{page:{pageNumber:Lr}}}=Br;if(!Mr||Mr.length===0)return null;es=Br={annotationType:cr.AnnotationEditorType.FREETEXT,color:Array.from(Qr),fontSize:ts,value:Mr.join(`
`),position:Dr,pageIndex:Lr-1,rect:Hr,rotation:Kr,id:rs,deleted:!1}}const ps=super.deserialize(Br,Wr,Yr);return Cs(ps,jr,Br.fontSize),Cs(ps,vr,cr.Util.makeHexColor(...Br.color)),Cs(ps,gr,Br.value),ps.annotationElementId=Br.id||null,Cs(ps,br,es),ps}serialize(Br=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const Wr=Tr._internalPadding*this.parentScale,Yr=this.getRect(Wr,Wr),es=dr.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:Or(this,vr)),ps={annotationType:cr.AnnotationEditorType.FREETEXT,color:es,fontSize:Or(this,jr),value:Or(this,gr),pageIndex:this.pageIndex,rect:Yr,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return Br?ps:this.annotationElementId&&!js(this,_r,cu).call(this,ps)?null:(ps.id=this.annotationElementId,ps)}};xr=new WeakMap,mr=new WeakMap,fr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,jr=new WeakMap,br=new WeakMap,_r=new WeakSet,au=function(Br){const Wr=es=>{this.editorDiv.style.fontSize=`calc(${es}px * var(--scale-factor))`,this.translate(0,-(es-Or(this,jr))*this.parentScale),Cs(this,jr,es),js(this,_r,Co).call(this)},Yr=Or(this,jr);this.addCommands({cmd:()=>{Wr(Br)},undo:()=>{Wr(Yr)},mustExec:!0,type:cr.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},ou=function(Br){const Wr=Or(this,vr);this.addCommands({cmd:()=>{Cs(this,vr,this.editorDiv.style.color=Br)},undo:()=>{Cs(this,vr,this.editorDiv.style.color=Wr)},mustExec:!0,type:cr.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},lu=function(){const Br=this.editorDiv.getElementsByTagName("div");if(Br.length===0)return this.editorDiv.innerText;const Wr=[];for(const Yr of Br)Wr.push(Yr.innerText.replace(/\r\n?|\n/,""));return Wr.join(`
`)},Co=function(){const[Br,Wr]=this.parentDimensions;let Yr;if(this.isAttachedToDOM)Yr=this.div.getBoundingClientRect();else{const{currentLayer:es,div:ps}=this,ts=ps.style.display;ps.style.display="hidden",es.div.append(this.div),Yr=ps.getBoundingClientRect(),ps.remove(),ps.style.display=ts}this.rotation%180===this.parentRotation%180?(this.width=Yr.width/Br,this.height=Yr.height/Wr):(this.width=Yr.height/Br,this.height=Yr.width/Wr),this.fixAndSetPosition()},Dl=function(){if(this.editorDiv.replaceChildren(),!!Or(this,gr))for(const Br of Or(this,gr).split(`
`)){const Wr=document.createElement("div");Wr.append(Br?document.createTextNode(Br):document.createElement("br")),this.editorDiv.append(Wr)}},cu=function(Br){const{value:Wr,fontSize:Yr,color:es,rect:ps,pageIndex:ts}=Or(this,br);return Br.value!==Wr||Br.fontSize!==Yr||Br.rect.some((Qr,Hr)=>Math.abs(Qr-ps[Hr])>=1)||Br.color.some((Qr,Hr)=>Qr!==es[Hr])||Br.pageIndex!==ts},Il=function(Br=!1){if(!this.annotationElementId)return;if(js(this,_r,Co).call(this),!Br&&(this.width===0||this.height===0)){setTimeout(()=>js(this,_r,Il).call(this,!0),0);return}const Wr=Tr._internalPadding*this.parentScale;Or(this,br).rect=this.getRect(Wr,Wr)},io(Tr,"_freeTextDefaultContent",""),io(Tr,"_internalPadding",0),io(Tr,"_defaultColor",null),io(Tr,"_defaultFontSize",10),io(Tr,"_type","freetext");let pr=Tr;or.FreeTextEditor=pr},(ar,or,lr)=>{var Fr,Vr,xo,uu,ms,ls,ds,bs,ws,Is,ys,ss,Ur,Xr,cs,xs,Es,Ns,Ts,gs,Hs,Us,du,Oo,Ml,Fl,ga,ro,no,$s,Rs,ks,qs,Ol,eo,fs,Os,zs,hu,Bl;Object.defineProperty(or,"__esModule",{value:!0}),or.StampAnnotationElement=or.InkAnnotationElement=or.FreeTextAnnotationElement=or.AnnotationLayer=void 0;var cr=lr(1),ur=lr(6),dr=lr(3),hr=lr(30),pr=lr(31),xr=lr(32);const mr=1e3,fr=9,Er=new WeakSet;function vr(Ys){return{width:Ys[2]-Ys[0],height:Ys[3]-Ys[1]}}class gr{static create(hs){switch(hs.data.annotationType){case cr.AnnotationType.LINK:return new jr(hs);case cr.AnnotationType.TEXT:return new br(hs);case cr.AnnotationType.WIDGET:switch(hs.data.fieldType){case"Tx":return new wr(hs);case"Btn":return hs.data.radioButton?new Sr(hs):hs.data.checkBox?new Ar(hs):new kr(hs);case"Ch":return new Nr(hs);case"Sig":return new Rr(hs)}return new _r(hs);case cr.AnnotationType.POPUP:return new Cr(hs);case cr.AnnotationType.FREETEXT:return new Pr(hs);case cr.AnnotationType.LINE:return new Ir(hs);case cr.AnnotationType.SQUARE:return new Br(hs);case cr.AnnotationType.CIRCLE:return new Wr(hs);case cr.AnnotationType.POLYLINE:return new Yr(hs);case cr.AnnotationType.CARET:return new ps(hs);case cr.AnnotationType.INK:return new ts(hs);case cr.AnnotationType.POLYGON:return new es(hs);case cr.AnnotationType.HIGHLIGHT:return new Qr(hs);case cr.AnnotationType.UNDERLINE:return new Hr(hs);case cr.AnnotationType.SQUIGGLY:return new Kr(hs);case cr.AnnotationType.STRIKEOUT:return new rs(hs);case cr.AnnotationType.STAMP:return new Mr(hs);case cr.AnnotationType.FILEATTACHMENT:return new Dr(hs);default:return new yr(hs)}}}const $r=class $r{constructor(hs,{isRenderable:as=!1,ignoreBorder:vs=!1,createQuadrilaterals:Ls=!1}={}){Ss(this,Fr,!1);this.isRenderable=as,this.data=hs.data,this.layer=hs.layer,this.linkService=hs.linkService,this.downloadManager=hs.downloadManager,this.imageResourcesPath=hs.imageResourcesPath,this.renderForms=hs.renderForms,this.svgFactory=hs.svgFactory,this.annotationStorage=hs.annotationStorage,this.enableScripting=hs.enableScripting,this.hasJSActions=hs.hasJSActions,this._fieldObjects=hs.fieldObjects,this.parent=hs.parent,as&&(this.container=this._createContainer(vs)),Ls&&this._createQuadrilaterals()}static _hasPopupData({titleObj:hs,contentsObj:as,richText:vs}){return!!(hs!=null&&hs.str||as!=null&&as.str||vs!=null&&vs.str)}get hasPopupData(){return $r._hasPopupData(this.data)}_createContainer(hs){const{data:as,parent:{page:vs,viewport:Ls}}=this,Ds=document.createElement("section");Ds.setAttribute("data-annotation-id",as.id),this instanceof _r||(Ds.tabIndex=mr),Ds.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Ds.setAttribute("aria-haspopup","dialog"),as.noRotate&&Ds.classList.add("norotate");const{pageWidth:Bs,pageHeight:Ws,pageX:_i,pageY:Qs}=Ls.rawDims;if(!as.rect||this instanceof Cr){const{rotation:ns}=as;return!as.hasOwnCanvas&&ns!==0&&this.setRotation(ns,Ds),Ds}const{width:zr,height:os}=vr(as.rect),qr=cr.Util.normalizeRect([as.rect[0],vs.view[3]-as.rect[1]+vs.view[1],as.rect[2],vs.view[3]-as.rect[3]+vs.view[1]]);if(!hs&&as.borderStyle.width>0){Ds.style.borderWidth=`${as.borderStyle.width}px`;const ns=as.borderStyle.horizontalCornerRadius,us=as.borderStyle.verticalCornerRadius;if(ns>0||us>0){const Fs=`calc(${ns}px * var(--scale-factor)) / calc(${us}px * var(--scale-factor))`;Ds.style.borderRadius=Fs}else if(this instanceof Sr){const Fs=`calc(${zr}px * var(--scale-factor)) / calc(${os}px * var(--scale-factor))`;Ds.style.borderRadius=Fs}switch(as.borderStyle.style){case cr.AnnotationBorderStyleType.SOLID:Ds.style.borderStyle="solid";break;case cr.AnnotationBorderStyleType.DASHED:Ds.style.borderStyle="dashed";break;case cr.AnnotationBorderStyleType.BEVELED:(0,cr.warn)("Unimplemented border style: beveled");break;case cr.AnnotationBorderStyleType.INSET:(0,cr.warn)("Unimplemented border style: inset");break;case cr.AnnotationBorderStyleType.UNDERLINE:Ds.style.borderBottomStyle="solid";break}const _s=as.borderColor||null;_s?(Cs(this,Fr,!0),Ds.style.borderColor=cr.Util.makeHexColor(_s[0]|0,_s[1]|0,_s[2]|0)):Ds.style.borderWidth=0}Ds.style.left=`${100*(qr[0]-_i)/Bs}%`,Ds.style.top=`${100*(qr[1]-Qs)/Ws}%`;const{rotation:Zr}=as;return as.hasOwnCanvas||Zr===0?(Ds.style.width=`${100*zr/Bs}%`,Ds.style.height=`${100*os/Ws}%`):this.setRotation(Zr,Ds),Ds}setRotation(hs,as=this.container){if(!this.data.rect)return;const{pageWidth:vs,pageHeight:Ls}=this.parent.viewport.rawDims,{width:Ds,height:Bs}=vr(this.data.rect);let Ws,_i;hs%180===0?(Ws=100*Ds/vs,_i=100*Bs/Ls):(Ws=100*Bs/vs,_i=100*Ds/Ls),as.style.width=`${Ws}%`,as.style.height=`${_i}%`,as.setAttribute("data-main-rotation",(360-hs)%360)}get _commonActions(){const hs=(as,vs,Ls)=>{const Ds=Ls.detail[as],Bs=Ds[0],Ws=Ds.slice(1);Ls.target.style[vs]=hr.ColorConverters[`${Bs}_HTML`](Ws),this.annotationStorage.setValue(this.data.id,{[vs]:hr.ColorConverters[`${Bs}_rgb`](Ws)})};return(0,cr.shadow)(this,"_commonActions",{display:as=>{const{display:vs}=as.detail,Ls=vs%2===1;this.container.style.visibility=Ls?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:Ls,noPrint:vs===1||vs===2})},print:as=>{this.annotationStorage.setValue(this.data.id,{noPrint:!as.detail.print})},hidden:as=>{const{hidden:vs}=as.detail;this.container.style.visibility=vs?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:vs,noView:vs})},focus:as=>{setTimeout(()=>as.target.focus({preventScroll:!1}),0)},userName:as=>{as.target.title=as.detail.userName},readonly:as=>{as.target.disabled=as.detail.readonly},required:as=>{this._setRequired(as.target,as.detail.required)},bgColor:as=>{hs("bgColor","backgroundColor",as)},fillColor:as=>{hs("fillColor","backgroundColor",as)},fgColor:as=>{hs("fgColor","color",as)},textColor:as=>{hs("textColor","color",as)},borderColor:as=>{hs("borderColor","borderColor",as)},strokeColor:as=>{hs("strokeColor","borderColor",as)},rotation:as=>{const vs=as.detail.rotation;this.setRotation(vs),this.annotationStorage.setValue(this.data.id,{rotation:vs})}})}_dispatchEventFromSandbox(hs,as){const vs=this._commonActions;for(const Ls of Object.keys(as.detail)){const Ds=hs[Ls]||vs[Ls];Ds==null||Ds(as)}}_setDefaultPropertiesFromJS(hs){if(!this.enableScripting)return;const as=this.annotationStorage.getRawValue(this.data.id);if(!as)return;const vs=this._commonActions;for(const[Ls,Ds]of Object.entries(as)){const Bs=vs[Ls];if(Bs){const Ws={detail:{[Ls]:Ds},target:hs};Bs(Ws),delete as[Ls]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:hs}=this.data;if(!hs)return;const[as,vs,Ls,Ds]=this.data.rect;if(hs.length===1){const[,{x:us,y:_s},{x:Fs,y:Ps}]=hs[0];if(Ls===us&&Ds===_s&&as===Fs&&vs===Ps)return}const{style:Bs}=this.container;let Ws;if(Or(this,Fr)){const{borderColor:us,borderWidth:_s}=Bs;Bs.borderWidth=0,Ws=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${us}" stroke-width="${_s}">`],this.container.classList.add("hasBorder")}const _i=Ls-as,Qs=Ds-vs,{svgFactory:zr}=this,os=zr.createElement("svg");os.classList.add("quadrilateralsContainer"),os.setAttribute("width",0),os.setAttribute("height",0);const qr=zr.createElement("defs");os.append(qr);const Zr=zr.createElement("clipPath"),ns=`clippath_${this.data.id}`;Zr.setAttribute("id",ns),Zr.setAttribute("clipPathUnits","objectBoundingBox"),qr.append(Zr);for(const[,{x:us,y:_s},{x:Fs,y:Ps}]of hs){const As=zr.createElement("rect"),Ms=(Fs-as)/_i,Vs=(Ds-_s)/Qs,Xs=(us-Fs)/_i,_a=(_s-Ps)/Qs;As.setAttribute("x",Ms),As.setAttribute("y",Vs),As.setAttribute("width",Xs),As.setAttribute("height",_a),Zr.append(As),Ws==null||Ws.push(`<rect vector-effect="non-scaling-stroke" x="${Ms}" y="${Vs}" width="${Xs}" height="${_a}"/>`)}Or(this,Fr)&&(Ws.push("</g></svg>')"),Bs.backgroundImage=Ws.join("")),this.container.append(os),this.container.style.clipPath=`url(#${ns})`}_createPopup(){const{container:hs,data:as}=this;hs.setAttribute("aria-haspopup","dialog");const vs=new Cr({data:{color:as.color,titleObj:as.titleObj,modificationDate:as.modificationDate,contentsObj:as.contentsObj,richText:as.richText,parentRect:as.rect,borderStyle:0,id:`popup_${as.id}`,rotation:as.rotation},parent:this.parent,elements:[this]});this.parent.div.append(vs.render())}render(){(0,cr.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(hs,as=null){const vs=[];if(this._fieldObjects){const Ls=this._fieldObjects[hs];if(Ls)for(const{page:Ds,id:Bs,exportValues:Ws}of Ls){if(Ds===-1||Bs===as)continue;const _i=typeof Ws=="string"?Ws:null,Qs=document.querySelector(`[data-element-id="${Bs}"]`);if(Qs&&!Er.has(Qs)){(0,cr.warn)(`_getElementsByName - element not allowed: ${Bs}`);continue}vs.push({id:Bs,exportValue:_i,domElement:Qs})}return vs}for(const Ls of document.getElementsByName(hs)){const{exportValue:Ds}=Ls,Bs=Ls.getAttribute("data-element-id");Bs!==as&&Er.has(Ls)&&vs.push({id:Bs,exportValue:Ds,domElement:Ls})}return vs}show(){var hs;this.container&&(this.container.hidden=!1),(hs=this.popup)==null||hs.maybeShow()}hide(){var hs;this.container&&(this.container.hidden=!0),(hs=this.popup)==null||hs.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const hs=this.getElementsToTriggerPopup();if(Array.isArray(hs))for(const as of hs)as.classList.add("highlightArea");else hs.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:hs,data:{id:as}}=this;this.container.addEventListener("dblclick",()=>{var vs;(vs=this.linkService.eventBus)==null||vs.dispatch("switchannotationeditormode",{source:this,mode:hs,editId:as})})}};Fr=new WeakMap;let yr=$r;class jr extends yr{constructor(as,vs=null){super(as,{isRenderable:!0,ignoreBorder:!!(vs!=null&&vs.ignoreBorder),createQuadrilaterals:!0});Ss(this,Vr);this.isTooltipOnly=as.data.isTooltipOnly}render(){const{data:as,linkService:vs}=this,Ls=document.createElement("a");Ls.setAttribute("data-element-id",as.id);let Ds=!1;return as.url?(vs.addLinkAttributes(Ls,as.url,as.newWindow),Ds=!0):as.action?(this._bindNamedAction(Ls,as.action),Ds=!0):as.attachment?(this._bindAttachment(Ls,as.attachment),Ds=!0):as.setOCGState?(js(this,Vr,uu).call(this,Ls,as.setOCGState),Ds=!0):as.dest?(this._bindLink(Ls,as.dest),Ds=!0):(as.actions&&(as.actions.Action||as.actions["Mouse Up"]||as.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(Ls,as),Ds=!0),as.resetForm?(this._bindResetFormAction(Ls,as.resetForm),Ds=!0):this.isTooltipOnly&&!Ds&&(this._bindLink(Ls,""),Ds=!0)),this.container.classList.add("linkAnnotation"),Ds&&this.container.append(Ls),this.container}_bindLink(as,vs){as.href=this.linkService.getDestinationHash(vs),as.onclick=()=>(vs&&this.linkService.goToDestination(vs),!1),(vs||vs==="")&&js(this,Vr,xo).call(this)}_bindNamedAction(as,vs){as.href=this.linkService.getAnchorUrl(""),as.onclick=()=>(this.linkService.executeNamedAction(vs),!1),js(this,Vr,xo).call(this)}_bindAttachment(as,vs){as.href=this.linkService.getAnchorUrl(""),as.onclick=()=>{var Ls;return(Ls=this.downloadManager)==null||Ls.openOrDownloadData(this.container,vs.content,vs.filename),!1},js(this,Vr,xo).call(this)}_bindJSAction(as,vs){as.href=this.linkService.getAnchorUrl("");const Ls=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Ds of Object.keys(vs.actions)){const Bs=Ls.get(Ds);Bs&&(as[Bs]=()=>{var Ws;return(Ws=this.linkService.eventBus)==null||Ws.dispatch("dispatcheventinsandbox",{source:this,detail:{id:vs.id,name:Ds}}),!1})}as.onclick||(as.onclick=()=>!1),js(this,Vr,xo).call(this)}_bindResetFormAction(as,vs){const Ls=as.onclick;if(Ls||(as.href=this.linkService.getAnchorUrl("")),js(this,Vr,xo).call(this),!this._fieldObjects){(0,cr.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),Ls||(as.onclick=()=>!1);return}as.onclick=()=>{var os;Ls==null||Ls();const{fields:Ds,refs:Bs,include:Ws}=vs,_i=[];if(Ds.length!==0||Bs.length!==0){const qr=new Set(Bs);for(const Zr of Ds){const ns=this._fieldObjects[Zr]||[];for(const{id:us}of ns)qr.add(us)}for(const Zr of Object.values(this._fieldObjects))for(const ns of Zr)qr.has(ns.id)===Ws&&_i.push(ns)}else for(const qr of Object.values(this._fieldObjects))_i.push(...qr);const Qs=this.annotationStorage,zr=[];for(const qr of _i){const{id:Zr}=qr;switch(zr.push(Zr),qr.type){case"text":{const us=qr.defaultValue||"";Qs.setValue(Zr,{value:us});break}case"checkbox":case"radiobutton":{const us=qr.defaultValue===qr.exportValues;Qs.setValue(Zr,{value:us});break}case"combobox":case"listbox":{const us=qr.defaultValue||"";Qs.setValue(Zr,{value:us});break}default:continue}const ns=document.querySelector(`[data-element-id="${Zr}"]`);if(ns){if(!Er.has(ns)){(0,cr.warn)(`_bindResetFormAction - element not allowed: ${Zr}`);continue}}else continue;ns.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((os=this.linkService.eventBus)==null||os.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:zr,name:"ResetForm"}})),!1}}}Vr=new WeakSet,xo=function(){this.container.setAttribute("data-internal-link","")},uu=function(as,vs){as.href=this.linkService.getAnchorUrl(""),as.onclick=()=>(this.linkService.executeSetOCGState(vs),!1),js(this,Vr,xo).call(this)};class br extends yr{constructor(hs){super(hs,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const hs=document.createElement("img");return hs.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",hs.alt="[{{type}} Annotation]",hs.dataset.l10nId="text_annotation_type",hs.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(hs),this.container}}class _r extends yr{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(hs){var as;this.data.hasOwnCanvas&&(((as=hs.previousSibling)==null?void 0:as.nodeName)==="CANVAS"&&(hs.previousSibling.hidden=!0),hs.hidden=!1)}_getKeyModifier(hs){const{isWin:as,isMac:vs}=cr.FeatureTest.platform;return as&&hs.ctrlKey||vs&&hs.metaKey}_setEventListener(hs,as,vs,Ls,Ds){vs.includes("mouse")?hs.addEventListener(vs,Bs=>{var Ws;(Ws=this.linkService.eventBus)==null||Ws.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ls,value:Ds(Bs),shift:Bs.shiftKey,modifier:this._getKeyModifier(Bs)}})}):hs.addEventListener(vs,Bs=>{var Ws;if(vs==="blur"){if(!as.focused||!Bs.relatedTarget)return;as.focused=!1}else if(vs==="focus"){if(as.focused)return;as.focused=!0}Ds&&((Ws=this.linkService.eventBus)==null||Ws.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ls,value:Ds(Bs)}}))})}_setEventListeners(hs,as,vs,Ls){var Ds,Bs,Ws;for(const[_i,Qs]of vs)(Qs==="Action"||(Ds=this.data.actions)!=null&&Ds[Qs])&&((Qs==="Focus"||Qs==="Blur")&&(as||(as={focused:!1})),this._setEventListener(hs,as,_i,Qs,Ls),Qs==="Focus"&&!((Bs=this.data.actions)!=null&&Bs.Blur)?this._setEventListener(hs,as,"blur","Blur",null):Qs==="Blur"&&!((Ws=this.data.actions)!=null&&Ws.Focus)&&this._setEventListener(hs,as,"focus","Focus",null))}_setBackgroundColor(hs){const as=this.data.backgroundColor||null;hs.style.backgroundColor=as===null?"transparent":cr.Util.makeHexColor(as[0],as[1],as[2])}_setTextStyle(hs){const as=["left","center","right"],{fontColor:vs}=this.data.defaultAppearanceData,Ls=this.data.defaultAppearanceData.fontSize||fr,Ds=hs.style;let Bs;const Ws=2,_i=Qs=>Math.round(10*Qs)/10;if(this.data.multiLine){const Qs=Math.abs(this.data.rect[3]-this.data.rect[1]-Ws),zr=Math.round(Qs/(cr.LINE_FACTOR*Ls))||1,os=Qs/zr;Bs=Math.min(Ls,_i(os/cr.LINE_FACTOR))}else{const Qs=Math.abs(this.data.rect[3]-this.data.rect[1]-Ws);Bs=Math.min(Ls,_i(Qs/cr.LINE_FACTOR))}Ds.fontSize=`calc(${Bs}px * var(--scale-factor))`,Ds.color=cr.Util.makeHexColor(vs[0],vs[1],vs[2]),this.data.textAlignment!==null&&(Ds.textAlign=as[this.data.textAlignment])}_setRequired(hs,as){as?hs.setAttribute("required",!0):hs.removeAttribute("required"),hs.setAttribute("aria-required",as)}}class wr extends _r{constructor(hs){const as=hs.renderForms||!hs.data.hasAppearance&&!!hs.data.fieldValue;super(hs,{isRenderable:as})}setPropertyOnSiblings(hs,as,vs,Ls){const Ds=this.annotationStorage;for(const Bs of this._getElementsByName(hs.name,hs.id))Bs.domElement&&(Bs.domElement[as]=vs),Ds.setValue(Bs.id,{[Ls]:vs})}render(){var Ls,Ds;const hs=this.annotationStorage,as=this.data.id;this.container.classList.add("textWidgetAnnotation");let vs=null;if(this.renderForms){const Bs=hs.getValue(as,{value:this.data.fieldValue});let Ws=Bs.value||"";const _i=hs.getValue(as,{charLimit:this.data.maxLen}).charLimit;_i&&Ws.length>_i&&(Ws=Ws.slice(0,_i));let Qs=Bs.formattedValue||((Ls=this.data.textContent)==null?void 0:Ls.join(`
`))||null;Qs&&this.data.comb&&(Qs=Qs.replaceAll(/\s+/g,""));const zr={userValue:Ws,formattedValue:Qs,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(vs=document.createElement("textarea"),vs.textContent=Qs??Ws,this.data.doNotScroll&&(vs.style.overflowY="hidden")):(vs=document.createElement("input"),vs.type="text",vs.setAttribute("value",Qs??Ws),this.data.doNotScroll&&(vs.style.overflowX="hidden")),this.data.hasOwnCanvas&&(vs.hidden=!0),Er.add(vs),vs.setAttribute("data-element-id",as),vs.disabled=this.data.readOnly,vs.name=this.data.fieldName,vs.tabIndex=mr,this._setRequired(vs,this.data.required),_i&&(vs.maxLength=_i),vs.addEventListener("input",qr=>{hs.setValue(as,{value:qr.target.value}),this.setPropertyOnSiblings(vs,"value",qr.target.value,"value"),zr.formattedValue=null}),vs.addEventListener("resetform",qr=>{const Zr=this.data.defaultFieldValue??"";vs.value=zr.userValue=Zr,zr.formattedValue=null});let os=qr=>{const{formattedValue:Zr}=zr;Zr!=null&&(qr.target.value=Zr),qr.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){vs.addEventListener("focus",Zr=>{if(zr.focused)return;const{target:ns}=Zr;zr.userValue&&(ns.value=zr.userValue),zr.lastCommittedValue=ns.value,zr.commitKey=1,zr.focused=!0}),vs.addEventListener("updatefromsandbox",Zr=>{this.showElementAndHideCanvas(Zr.target);const ns={value(us){zr.userValue=us.detail.value??"",hs.setValue(as,{value:zr.userValue.toString()}),us.target.value=zr.userValue},formattedValue(us){const{formattedValue:_s}=us.detail;zr.formattedValue=_s,_s!=null&&us.target!==document.activeElement&&(us.target.value=_s),hs.setValue(as,{formattedValue:_s})},selRange(us){us.target.setSelectionRange(...us.detail.selRange)},charLimit:us=>{var As;const{charLimit:_s}=us.detail,{target:Fs}=us;if(_s===0){Fs.removeAttribute("maxLength");return}Fs.setAttribute("maxLength",_s);let Ps=zr.userValue;!Ps||Ps.length<=_s||(Ps=Ps.slice(0,_s),Fs.value=zr.userValue=Ps,hs.setValue(as,{value:Ps}),(As=this.linkService.eventBus)==null||As.dispatch("dispatcheventinsandbox",{source:this,detail:{id:as,name:"Keystroke",value:Ps,willCommit:!0,commitKey:1,selStart:Fs.selectionStart,selEnd:Fs.selectionEnd}}))}};this._dispatchEventFromSandbox(ns,Zr)}),vs.addEventListener("keydown",Zr=>{var _s;zr.commitKey=1;let ns=-1;if(Zr.key==="Escape"?ns=0:Zr.key==="Enter"&&!this.data.multiLine?ns=2:Zr.key==="Tab"&&(zr.commitKey=3),ns===-1)return;const{value:us}=Zr.target;zr.lastCommittedValue!==us&&(zr.lastCommittedValue=us,zr.userValue=us,(_s=this.linkService.eventBus)==null||_s.dispatch("dispatcheventinsandbox",{source:this,detail:{id:as,name:"Keystroke",value:us,willCommit:!0,commitKey:ns,selStart:Zr.target.selectionStart,selEnd:Zr.target.selectionEnd}}))});const qr=os;os=null,vs.addEventListener("blur",Zr=>{var us;if(!zr.focused||!Zr.relatedTarget)return;zr.focused=!1;const{value:ns}=Zr.target;zr.userValue=ns,zr.lastCommittedValue!==ns&&((us=this.linkService.eventBus)==null||us.dispatch("dispatcheventinsandbox",{source:this,detail:{id:as,name:"Keystroke",value:ns,willCommit:!0,commitKey:zr.commitKey,selStart:Zr.target.selectionStart,selEnd:Zr.target.selectionEnd}})),qr(Zr)}),(Ds=this.data.actions)!=null&&Ds.Keystroke&&vs.addEventListener("beforeinput",Zr=>{var Vs;zr.lastCommittedValue=null;const{data:ns,target:us}=Zr,{value:_s,selectionStart:Fs,selectionEnd:Ps}=us;let As=Fs,Ms=Ps;switch(Zr.inputType){case"deleteWordBackward":{const Xs=_s.substring(0,Fs).match(/\w*[^\w]*$/);Xs&&(As-=Xs[0].length);break}case"deleteWordForward":{const Xs=_s.substring(Fs).match(/^[^\w]*\w*/);Xs&&(Ms+=Xs[0].length);break}case"deleteContentBackward":Fs===Ps&&(As-=1);break;case"deleteContentForward":Fs===Ps&&(Ms+=1);break}Zr.preventDefault(),(Vs=this.linkService.eventBus)==null||Vs.dispatch("dispatcheventinsandbox",{source:this,detail:{id:as,name:"Keystroke",value:_s,change:ns||"",willCommit:!1,selStart:As,selEnd:Ms}})}),this._setEventListeners(vs,zr,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Zr=>Zr.target.value)}if(os&&vs.addEventListener("blur",os),this.data.comb){const Zr=(this.data.rect[2]-this.data.rect[0])/_i;vs.classList.add("comb"),vs.style.letterSpacing=`calc(${Zr}px * var(--scale-factor) - 1ch)`}}else vs=document.createElement("div"),vs.textContent=this.data.fieldValue,vs.style.verticalAlign="middle",vs.style.display="table-cell";return this._setTextStyle(vs),this._setBackgroundColor(vs),this._setDefaultPropertiesFromJS(vs),this.container.append(vs),this.container}}class Rr extends _r{constructor(hs){super(hs,{isRenderable:!!hs.data.hasOwnCanvas})}}class Ar extends _r{constructor(hs){super(hs,{isRenderable:hs.renderForms})}render(){const hs=this.annotationStorage,as=this.data,vs=as.id;let Ls=hs.getValue(vs,{value:as.exportValue===as.fieldValue}).value;typeof Ls=="string"&&(Ls=Ls!=="Off",hs.setValue(vs,{value:Ls})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Ds=document.createElement("input");return Er.add(Ds),Ds.setAttribute("data-element-id",vs),Ds.disabled=as.readOnly,this._setRequired(Ds,this.data.required),Ds.type="checkbox",Ds.name=as.fieldName,Ls&&Ds.setAttribute("checked",!0),Ds.setAttribute("exportValue",as.exportValue),Ds.tabIndex=mr,Ds.addEventListener("change",Bs=>{const{name:Ws,checked:_i}=Bs.target;for(const Qs of this._getElementsByName(Ws,vs)){const zr=_i&&Qs.exportValue===as.exportValue;Qs.domElement&&(Qs.domElement.checked=zr),hs.setValue(Qs.id,{value:zr})}hs.setValue(vs,{value:_i})}),Ds.addEventListener("resetform",Bs=>{const Ws=as.defaultFieldValue||"Off";Bs.target.checked=Ws===as.exportValue}),this.enableScripting&&this.hasJSActions&&(Ds.addEventListener("updatefromsandbox",Bs=>{const Ws={value(_i){_i.target.checked=_i.detail.value!=="Off",hs.setValue(vs,{value:_i.target.checked})}};this._dispatchEventFromSandbox(Ws,Bs)}),this._setEventListeners(Ds,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Bs=>Bs.target.checked)),this._setBackgroundColor(Ds),this._setDefaultPropertiesFromJS(Ds),this.container.append(Ds),this.container}}class Sr extends _r{constructor(hs){super(hs,{isRenderable:hs.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const hs=this.annotationStorage,as=this.data,vs=as.id;let Ls=hs.getValue(vs,{value:as.fieldValue===as.buttonValue}).value;typeof Ls=="string"&&(Ls=Ls!==as.buttonValue,hs.setValue(vs,{value:Ls}));const Ds=document.createElement("input");if(Er.add(Ds),Ds.setAttribute("data-element-id",vs),Ds.disabled=as.readOnly,this._setRequired(Ds,this.data.required),Ds.type="radio",Ds.name=as.fieldName,Ls&&Ds.setAttribute("checked",!0),Ds.tabIndex=mr,Ds.addEventListener("change",Bs=>{const{name:Ws,checked:_i}=Bs.target;for(const Qs of this._getElementsByName(Ws,vs))hs.setValue(Qs.id,{value:!1});hs.setValue(vs,{value:_i})}),Ds.addEventListener("resetform",Bs=>{const Ws=as.defaultFieldValue;Bs.target.checked=Ws!=null&&Ws===as.buttonValue}),this.enableScripting&&this.hasJSActions){const Bs=as.buttonValue;Ds.addEventListener("updatefromsandbox",Ws=>{const _i={value:Qs=>{const zr=Bs===Qs.detail.value;for(const os of this._getElementsByName(Qs.target.name)){const qr=zr&&os.id===vs;os.domElement&&(os.domElement.checked=qr),hs.setValue(os.id,{value:qr})}}};this._dispatchEventFromSandbox(_i,Ws)}),this._setEventListeners(Ds,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Ws=>Ws.target.checked)}return this._setBackgroundColor(Ds),this._setDefaultPropertiesFromJS(Ds),this.container.append(Ds),this.container}}class kr extends jr{constructor(hs){super(hs,{ignoreBorder:hs.data.hasAppearance})}render(){const hs=super.render();hs.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(hs.title=this.data.alternativeText);const as=hs.lastChild;return this.enableScripting&&this.hasJSActions&&as&&(this._setDefaultPropertiesFromJS(as),as.addEventListener("updatefromsandbox",vs=>{this._dispatchEventFromSandbox({},vs)})),hs}}class Nr extends _r{constructor(hs){super(hs,{isRenderable:hs.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const hs=this.annotationStorage,as=this.data.id,vs=hs.getValue(as,{value:this.data.fieldValue}),Ls=document.createElement("select");Er.add(Ls),Ls.setAttribute("data-element-id",as),Ls.disabled=this.data.readOnly,this._setRequired(Ls,this.data.required),Ls.name=this.data.fieldName,Ls.tabIndex=mr;let Ds=this.data.combo&&this.data.options.length>0;this.data.combo||(Ls.size=this.data.options.length,this.data.multiSelect&&(Ls.multiple=!0)),Ls.addEventListener("resetform",zr=>{const os=this.data.defaultFieldValue;for(const qr of Ls.options)qr.selected=qr.value===os});for(const zr of this.data.options){const os=document.createElement("option");os.textContent=zr.displayValue,os.value=zr.exportValue,vs.value.includes(zr.exportValue)&&(os.setAttribute("selected",!0),Ds=!1),Ls.append(os)}let Bs=null;if(Ds){const zr=document.createElement("option");zr.value=" ",zr.setAttribute("hidden",!0),zr.setAttribute("selected",!0),Ls.prepend(zr),Bs=()=>{zr.remove(),Ls.removeEventListener("input",Bs),Bs=null},Ls.addEventListener("input",Bs)}const Ws=zr=>{const os=zr?"value":"textContent",{options:qr,multiple:Zr}=Ls;return Zr?Array.prototype.filter.call(qr,ns=>ns.selected).map(ns=>ns[os]):qr.selectedIndex===-1?null:qr[qr.selectedIndex][os]};let _i=Ws(!1);const Qs=zr=>{const os=zr.target.options;return Array.prototype.map.call(os,qr=>({displayValue:qr.textContent,exportValue:qr.value}))};return this.enableScripting&&this.hasJSActions?(Ls.addEventListener("updatefromsandbox",zr=>{const os={value(qr){Bs==null||Bs();const Zr=qr.detail.value,ns=new Set(Array.isArray(Zr)?Zr:[Zr]);for(const us of Ls.options)us.selected=ns.has(us.value);hs.setValue(as,{value:Ws(!0)}),_i=Ws(!1)},multipleSelection(qr){Ls.multiple=!0},remove(qr){const Zr=Ls.options,ns=qr.detail.remove;Zr[ns].selected=!1,Ls.remove(ns),Zr.length>0&&Array.prototype.findIndex.call(Zr,_s=>_s.selected)===-1&&(Zr[0].selected=!0),hs.setValue(as,{value:Ws(!0),items:Qs(qr)}),_i=Ws(!1)},clear(qr){for(;Ls.length!==0;)Ls.remove(0);hs.setValue(as,{value:null,items:[]}),_i=Ws(!1)},insert(qr){const{index:Zr,displayValue:ns,exportValue:us}=qr.detail.insert,_s=Ls.children[Zr],Fs=document.createElement("option");Fs.textContent=ns,Fs.value=us,_s?_s.before(Fs):Ls.append(Fs),hs.setValue(as,{value:Ws(!0),items:Qs(qr)}),_i=Ws(!1)},items(qr){const{items:Zr}=qr.detail;for(;Ls.length!==0;)Ls.remove(0);for(const ns of Zr){const{displayValue:us,exportValue:_s}=ns,Fs=document.createElement("option");Fs.textContent=us,Fs.value=_s,Ls.append(Fs)}Ls.options.length>0&&(Ls.options[0].selected=!0),hs.setValue(as,{value:Ws(!0),items:Qs(qr)}),_i=Ws(!1)},indices(qr){const Zr=new Set(qr.detail.indices);for(const ns of qr.target.options)ns.selected=Zr.has(ns.index);hs.setValue(as,{value:Ws(!0)}),_i=Ws(!1)},editable(qr){qr.target.disabled=!qr.detail.editable}};this._dispatchEventFromSandbox(os,zr)}),Ls.addEventListener("input",zr=>{var qr;const os=Ws(!0);hs.setValue(as,{value:os}),zr.preventDefault(),(qr=this.linkService.eventBus)==null||qr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:as,name:"Keystroke",value:_i,changeEx:os,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(Ls,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],zr=>zr.target.value)):Ls.addEventListener("input",function(zr){hs.setValue(as,{value:Ws(!0)})}),this.data.combo&&this._setTextStyle(Ls),this._setBackgroundColor(Ls),this._setDefaultPropertiesFromJS(Ls),this.container.append(Ls),this.container}}class Cr extends yr{constructor(hs){const{data:as,elements:vs}=hs;super(hs,{isRenderable:yr._hasPopupData(as)}),this.elements=vs}render(){this.container.classList.add("popupAnnotation");const hs=new Tr({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),as=[];for(const vs of this.elements)vs.popup=hs,as.push(vs.data.id),vs.addHighlightArea();return this.container.setAttribute("aria-controls",as.map(vs=>`${cr.AnnotationPrefix}${vs}`).join(",")),this.container}}class Tr{constructor({container:hs,color:as,elements:vs,titleObj:Ls,modificationDate:Ds,contentsObj:Bs,richText:Ws,parent:_i,rect:Qs,parentRect:zr,open:os}){Ss(this,Us);Ss(this,ms,null);Ss(this,ls,js(this,Us,du).bind(this));Ss(this,ds,js(this,Us,Fl).bind(this));Ss(this,bs,js(this,Us,Ml).bind(this));Ss(this,ws,js(this,Us,Oo).bind(this));Ss(this,Is,null);Ss(this,ys,null);Ss(this,ss,null);Ss(this,Ur,null);Ss(this,Xr,null);Ss(this,cs,null);Ss(this,xs,!1);Ss(this,Es,null);Ss(this,Ns,null);Ss(this,Ts,null);Ss(this,gs,null);Ss(this,Hs,!1);var Zr;Cs(this,ys,hs),Cs(this,gs,Ls),Cs(this,ss,Bs),Cs(this,Ts,Ws),Cs(this,Xr,_i),Cs(this,Is,as),Cs(this,Ns,Qs),Cs(this,cs,zr),Cs(this,Ur,vs);const qr=ur.PDFDateString.toDateObject(Ds);qr&&Cs(this,ms,_i.l10n.get("annotation_date_string",{date:qr.toLocaleDateString(),time:qr.toLocaleTimeString()})),this.trigger=vs.flatMap(ns=>ns.getElementsToTriggerPopup());for(const ns of this.trigger)ns.addEventListener("click",Or(this,ws)),ns.addEventListener("mouseenter",Or(this,bs)),ns.addEventListener("mouseleave",Or(this,ds)),ns.classList.add("popupTriggerArea");for(const ns of vs)(Zr=ns.container)==null||Zr.addEventListener("keydown",Or(this,ls));Or(this,ys).hidden=!0,os&&js(this,Us,Oo).call(this)}render(){if(Or(this,Es))return;const{page:{view:hs},viewport:{rawDims:{pageWidth:as,pageHeight:vs,pageX:Ls,pageY:Ds}}}=Or(this,Xr),Bs=Cs(this,Es,document.createElement("div"));if(Bs.className="popup",Or(this,Is)){const As=Bs.style.outlineColor=cr.Util.makeHexColor(...Or(this,Is));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?Bs.style.backgroundColor=`color-mix(in srgb, ${As} 30%, white)`:Bs.style.backgroundColor=cr.Util.makeHexColor(...Or(this,Is).map(Vs=>Math.floor(.7*(255-Vs)+Vs)))}const Ws=document.createElement("span");Ws.className="header";const _i=document.createElement("h1");if(Ws.append(_i),{dir:_i.dir,str:_i.textContent}=Or(this,gs),Bs.append(Ws),Or(this,ms)){const As=document.createElement("span");As.classList.add("popupDate"),Or(this,ms).then(Ms=>{As.textContent=Ms}),Ws.append(As)}const Qs=Or(this,ss),zr=Or(this,Ts);if(zr!=null&&zr.str&&(!(Qs!=null&&Qs.str)||Qs.str===zr.str))xr.XfaLayer.render({xfaHtml:zr.html,intent:"richText",div:Bs}),Bs.lastChild.classList.add("richText","popupContent");else{const As=this._formatContents(Qs);Bs.append(As)}let os=!!Or(this,cs),qr=os?Or(this,cs):Or(this,Ns);for(const As of Or(this,Ur))if(!qr||cr.Util.intersect(As.data.rect,qr)!==null){qr=As.data.rect,os=!0;break}const Zr=cr.Util.normalizeRect([qr[0],hs[3]-qr[1]+hs[1],qr[2],hs[3]-qr[3]+hs[1]]),us=os?qr[2]-qr[0]+5:0,_s=Zr[0]+us,Fs=Zr[1],{style:Ps}=Or(this,ys);Ps.left=`${100*(_s-Ls)/as}%`,Ps.top=`${100*(Fs-Ds)/vs}%`,Or(this,ys).append(Bs)}_formatContents({str:hs,dir:as}){const vs=document.createElement("p");vs.classList.add("popupContent"),vs.dir=as;const Ls=hs.split(/(?:\r\n?|\n)/);for(let Ds=0,Bs=Ls.length;Ds<Bs;++Ds){const Ws=Ls[Ds];vs.append(document.createTextNode(Ws)),Ds<Bs-1&&vs.append(document.createElement("br"))}return vs}forceHide(){Cs(this,Hs,this.isVisible),Or(this,Hs)&&(Or(this,ys).hidden=!0)}maybeShow(){Or(this,Hs)&&(Cs(this,Hs,!1),Or(this,ys).hidden=!1)}get isVisible(){return Or(this,ys).hidden===!1}}ms=new WeakMap,ls=new WeakMap,ds=new WeakMap,bs=new WeakMap,ws=new WeakMap,Is=new WeakMap,ys=new WeakMap,ss=new WeakMap,Ur=new WeakMap,Xr=new WeakMap,cs=new WeakMap,xs=new WeakMap,Es=new WeakMap,Ns=new WeakMap,Ts=new WeakMap,gs=new WeakMap,Hs=new WeakMap,Us=new WeakSet,du=function(hs){hs.altKey||hs.shiftKey||hs.ctrlKey||hs.metaKey||(hs.key==="Enter"||hs.key==="Escape"&&Or(this,xs))&&js(this,Us,Oo).call(this)},Oo=function(){Cs(this,xs,!Or(this,xs)),Or(this,xs)?(js(this,Us,Ml).call(this),Or(this,ys).addEventListener("click",Or(this,ws)),Or(this,ys).addEventListener("keydown",Or(this,ls))):(js(this,Us,Fl).call(this),Or(this,ys).removeEventListener("click",Or(this,ws)),Or(this,ys).removeEventListener("keydown",Or(this,ls)))},Ml=function(){Or(this,Es)||this.render(),this.isVisible?Or(this,xs)&&Or(this,ys).classList.add("focused"):(Or(this,ys).hidden=!1,Or(this,ys).style.zIndex=parseInt(Or(this,ys).style.zIndex)+1e3)},Fl=function(){Or(this,ys).classList.remove("focused"),!(Or(this,xs)||!this.isVisible)&&(Or(this,ys).hidden=!0,Or(this,ys).style.zIndex=parseInt(Or(this,ys).style.zIndex)-1e3)};class Pr extends yr{constructor(hs){super(hs,{isRenderable:!0,ignoreBorder:!0}),this.textContent=hs.data.textContent,this.textPosition=hs.data.textPosition,this.annotationEditorType=cr.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const hs=document.createElement("div");hs.classList.add("annotationTextContent"),hs.setAttribute("role","comment");for(const as of this.textContent){const vs=document.createElement("span");vs.textContent=as,hs.append(vs)}this.container.append(hs)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}or.FreeTextAnnotationElement=Pr;class Ir extends yr{constructor(as){super(as,{isRenderable:!0,ignoreBorder:!0});Ss(this,ga,null)}render(){this.container.classList.add("lineAnnotation");const as=this.data,{width:vs,height:Ls}=vr(as.rect),Ds=this.svgFactory.create(vs,Ls,!0),Bs=Cs(this,ga,this.svgFactory.createElement("svg:line"));return Bs.setAttribute("x1",as.rect[2]-as.lineCoordinates[0]),Bs.setAttribute("y1",as.rect[3]-as.lineCoordinates[1]),Bs.setAttribute("x2",as.rect[2]-as.lineCoordinates[2]),Bs.setAttribute("y2",as.rect[3]-as.lineCoordinates[3]),Bs.setAttribute("stroke-width",as.borderStyle.width||1),Bs.setAttribute("stroke","transparent"),Bs.setAttribute("fill","transparent"),Ds.append(Bs),this.container.append(Ds),!as.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Or(this,ga)}addHighlightArea(){this.container.classList.add("highlightArea")}}ga=new WeakMap;class Br extends yr{constructor(as){super(as,{isRenderable:!0,ignoreBorder:!0});Ss(this,ro,null)}render(){this.container.classList.add("squareAnnotation");const as=this.data,{width:vs,height:Ls}=vr(as.rect),Ds=this.svgFactory.create(vs,Ls,!0),Bs=as.borderStyle.width,Ws=Cs(this,ro,this.svgFactory.createElement("svg:rect"));return Ws.setAttribute("x",Bs/2),Ws.setAttribute("y",Bs/2),Ws.setAttribute("width",vs-Bs),Ws.setAttribute("height",Ls-Bs),Ws.setAttribute("stroke-width",Bs||1),Ws.setAttribute("stroke","transparent"),Ws.setAttribute("fill","transparent"),Ds.append(Ws),this.container.append(Ds),!as.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Or(this,ro)}addHighlightArea(){this.container.classList.add("highlightArea")}}ro=new WeakMap;class Wr extends yr{constructor(as){super(as,{isRenderable:!0,ignoreBorder:!0});Ss(this,no,null)}render(){this.container.classList.add("circleAnnotation");const as=this.data,{width:vs,height:Ls}=vr(as.rect),Ds=this.svgFactory.create(vs,Ls,!0),Bs=as.borderStyle.width,Ws=Cs(this,no,this.svgFactory.createElement("svg:ellipse"));return Ws.setAttribute("cx",vs/2),Ws.setAttribute("cy",Ls/2),Ws.setAttribute("rx",vs/2-Bs/2),Ws.setAttribute("ry",Ls/2-Bs/2),Ws.setAttribute("stroke-width",Bs||1),Ws.setAttribute("stroke","transparent"),Ws.setAttribute("fill","transparent"),Ds.append(Ws),this.container.append(Ds),!as.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Or(this,no)}addHighlightArea(){this.container.classList.add("highlightArea")}}no=new WeakMap;class Yr extends yr{constructor(as){super(as,{isRenderable:!0,ignoreBorder:!0});Ss(this,$s,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const as=this.data,{width:vs,height:Ls}=vr(as.rect),Ds=this.svgFactory.create(vs,Ls,!0);let Bs=[];for(const _i of as.vertices){const Qs=_i.x-as.rect[0],zr=as.rect[3]-_i.y;Bs.push(Qs+","+zr)}Bs=Bs.join(" ");const Ws=Cs(this,$s,this.svgFactory.createElement(this.svgElementName));return Ws.setAttribute("points",Bs),Ws.setAttribute("stroke-width",as.borderStyle.width||1),Ws.setAttribute("stroke","transparent"),Ws.setAttribute("fill","transparent"),Ds.append(Ws),this.container.append(Ds),!as.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Or(this,$s)}addHighlightArea(){this.container.classList.add("highlightArea")}}$s=new WeakMap;class es extends Yr{constructor(hs){super(hs),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class ps extends yr{constructor(hs){super(hs,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class ts extends yr{constructor(as){super(as,{isRenderable:!0,ignoreBorder:!0});Ss(this,Rs,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=cr.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const as=this.data,{width:vs,height:Ls}=vr(as.rect),Ds=this.svgFactory.create(vs,Ls,!0);for(const Bs of as.inkLists){let Ws=[];for(const Qs of Bs){const zr=Qs.x-as.rect[0],os=as.rect[3]-Qs.y;Ws.push(`${zr},${os}`)}Ws=Ws.join(" ");const _i=this.svgFactory.createElement(this.svgElementName);Or(this,Rs).push(_i),_i.setAttribute("points",Ws),_i.setAttribute("stroke-width",as.borderStyle.width||1),_i.setAttribute("stroke","transparent"),_i.setAttribute("fill","transparent"),!as.popupRef&&this.hasPopupData&&this._createPopup(),Ds.append(_i)}return this.container.append(Ds),this.container}getElementsToTriggerPopup(){return Or(this,Rs)}addHighlightArea(){this.container.classList.add("highlightArea")}}Rs=new WeakMap,or.InkAnnotationElement=ts;class Qr extends yr{constructor(hs){super(hs,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class Hr extends yr{constructor(hs){super(hs,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Kr extends yr{constructor(hs){super(hs,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class rs extends yr{constructor(hs){super(hs,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Mr extends yr{constructor(hs){super(hs,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}or.StampAnnotationElement=Mr;class Dr extends yr{constructor(as){var Ds;super(as,{isRenderable:!0});Ss(this,qs);Ss(this,ks,null);const{filename:vs,content:Ls}=this.data.file;this.filename=(0,ur.getFilenameFromUrl)(vs,!0),this.content=Ls,(Ds=this.linkService.eventBus)==null||Ds.dispatch("fileattachmentannotation",{source:this,filename:vs,content:Ls})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:as,data:vs}=this;let Ls;vs.hasAppearance||vs.fillAlpha===0?Ls=document.createElement("div"):(Ls=document.createElement("img"),Ls.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(vs.name)?"paperclip":"pushpin"}.svg`,vs.fillAlpha&&vs.fillAlpha<1&&(Ls.style=`filter: opacity(${Math.round(vs.fillAlpha*100)}%);`)),Ls.addEventListener("dblclick",js(this,qs,Ol).bind(this)),Cs(this,ks,Ls);const{isMac:Ds}=cr.FeatureTest.platform;return as.addEventListener("keydown",Bs=>{Bs.key==="Enter"&&(Ds?Bs.metaKey:Bs.ctrlKey)&&js(this,qs,Ol).call(this)}),!vs.popupRef&&this.hasPopupData?this._createPopup():Ls.classList.add("popupTriggerArea"),as.append(Ls),as}getElementsToTriggerPopup(){return Or(this,ks)}addHighlightArea(){this.container.classList.add("highlightArea")}}ks=new WeakMap,qs=new WeakSet,Ol=function(){var as;(as=this.downloadManager)==null||as.openOrDownloadData(this.container,this.content,this.filename)};class Lr{constructor({div:hs,accessibilityManager:as,annotationCanvasMap:vs,l10n:Ls,page:Ds,viewport:Bs}){Ss(this,zs);Ss(this,eo,null);Ss(this,fs,null);Ss(this,Os,new Map);this.div=hs,Cs(this,eo,as),Cs(this,fs,vs),this.l10n=Ls,this.page=Ds,this.viewport=Bs,this.zIndex=0,this.l10n||(this.l10n=pr.NullL10n)}async render(hs){const{annotations:as}=hs,vs=this.div;(0,ur.setLayerDimensions)(vs,this.viewport);const Ls=new Map,Ds={data:null,layer:vs,linkService:hs.linkService,downloadManager:hs.downloadManager,imageResourcesPath:hs.imageResourcesPath||"",renderForms:hs.renderForms!==!1,svgFactory:new ur.DOMSVGFactory,annotationStorage:hs.annotationStorage||new dr.AnnotationStorage,enableScripting:hs.enableScripting===!0,hasJSActions:hs.hasJSActions,fieldObjects:hs.fieldObjects,parent:this,elements:null};for(const Bs of as){if(Bs.noHTML)continue;const Ws=Bs.annotationType===cr.AnnotationType.POPUP;if(Ws){const zr=Ls.get(Bs.id);if(!zr)continue;Ds.elements=zr}else{const{width:zr,height:os}=vr(Bs.rect);if(zr<=0||os<=0)continue}Ds.data=Bs;const _i=gr.create(Ds);if(!_i.isRenderable)continue;if(!Ws&&Bs.popupRef){const zr=Ls.get(Bs.popupRef);zr?zr.push(_i):Ls.set(Bs.popupRef,[_i])}_i.annotationEditorType>0&&Or(this,Os).set(_i.data.id,_i);const Qs=_i.render();Bs.hidden&&(Qs.style.visibility="hidden"),js(this,zs,hu).call(this,Qs,Bs.id)}js(this,zs,Bl).call(this),await this.l10n.translate(vs)}update({viewport:hs}){const as=this.div;this.viewport=hs,(0,ur.setLayerDimensions)(as,{rotation:hs.rotation}),js(this,zs,Bl).call(this),as.hidden=!1}getEditableAnnotations(){return Array.from(Or(this,Os).values())}getEditableAnnotation(hs){return Or(this,Os).get(hs)}}eo=new WeakMap,fs=new WeakMap,Os=new WeakMap,zs=new WeakSet,hu=function(hs,as){var Ls;const vs=hs.firstChild||hs;vs.id=`${cr.AnnotationPrefix}${as}`,this.div.append(hs),(Ls=Or(this,eo))==null||Ls.moveElementInDOM(this.div,hs,vs,!1)},Bl=function(){if(!Or(this,fs))return;const hs=this.div;for(const[as,vs]of Or(this,fs)){const Ls=hs.querySelector(`[data-annotation-id="${as}"]`);if(!Ls)continue;const{firstChild:Ds}=Ls;Ds?Ds.nodeName==="CANVAS"?Ds.replaceWith(vs):Ds.before(vs):Ls.append(vs)}Or(this,fs).clear()},or.AnnotationLayer=Lr},(ar,or)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.ColorConverters=void 0;function lr(dr){return Math.floor(Math.max(0,Math.min(1,dr))*255).toString(16).padStart(2,"0")}function cr(dr){return Math.max(0,Math.min(255,255*dr))}class ur{static CMYK_G([hr,pr,xr,mr]){return["G",1-Math.min(1,.3*hr+.59*xr+.11*pr+mr)]}static G_CMYK([hr]){return["CMYK",0,0,0,1-hr]}static G_RGB([hr]){return["RGB",hr,hr,hr]}static G_rgb([hr]){return hr=cr(hr),[hr,hr,hr]}static G_HTML([hr]){const pr=lr(hr);return`#${pr}${pr}${pr}`}static RGB_G([hr,pr,xr]){return["G",.3*hr+.59*pr+.11*xr]}static RGB_rgb(hr){return hr.map(cr)}static RGB_HTML(hr){return`#${hr.map(lr).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([hr,pr,xr,mr]){return["RGB",1-Math.min(1,hr+mr),1-Math.min(1,xr+mr),1-Math.min(1,pr+mr)]}static CMYK_rgb([hr,pr,xr,mr]){return[cr(1-Math.min(1,hr+mr)),cr(1-Math.min(1,xr+mr)),cr(1-Math.min(1,pr+mr))]}static CMYK_HTML(hr){const pr=this.CMYK_RGB(hr).slice(1);return this.RGB_HTML(pr)}static RGB_CMYK([hr,pr,xr]){const mr=1-hr,fr=1-pr,Er=1-xr,vr=Math.min(mr,fr,Er);return["CMYK",mr,fr,Er,vr]}}or.ColorConverters=ur},(ar,or)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.NullL10n=void 0,or.getL10nFallback=cr;const lr={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}}  {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}}  {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};lr.print_progress_percent="{{progress}}%";function cr(hr,pr){switch(hr){case"find_match_count":hr=`find_match_count[${pr.total===1?"one":"other"}]`;break;case"find_match_count_limit":hr=`find_match_count_limit[${pr.limit===1?"one":"other"}]`;break}return lr[hr]||""}function ur(hr,pr){return pr?hr.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(xr,mr)=>mr in pr?pr[mr]:"{{"+mr+"}}"):hr}const dr={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(hr,pr=null,xr=cr(hr,pr)){return ur(xr,pr)},async translate(hr){}};or.NullL10n=dr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.XfaLayer=void 0;var cr=lr(25);class ur{static setupStorage(hr,pr,xr,mr,fr){const Er=mr.getValue(pr,{value:null});switch(xr.name){case"textarea":if(Er.value!==null&&(hr.textContent=Er.value),fr==="print")break;hr.addEventListener("input",vr=>{mr.setValue(pr,{value:vr.target.value})});break;case"input":if(xr.attributes.type==="radio"||xr.attributes.type==="checkbox"){if(Er.value===xr.attributes.xfaOn?hr.setAttribute("checked",!0):Er.value===xr.attributes.xfaOff&&hr.removeAttribute("checked"),fr==="print")break;hr.addEventListener("change",vr=>{mr.setValue(pr,{value:vr.target.checked?vr.target.getAttribute("xfaOn"):vr.target.getAttribute("xfaOff")})})}else{if(Er.value!==null&&hr.setAttribute("value",Er.value),fr==="print")break;hr.addEventListener("input",vr=>{mr.setValue(pr,{value:vr.target.value})})}break;case"select":if(Er.value!==null){hr.setAttribute("value",Er.value);for(const vr of xr.children)vr.attributes.value===Er.value?vr.attributes.selected=!0:vr.attributes.hasOwnProperty("selected")&&delete vr.attributes.selected}hr.addEventListener("input",vr=>{const gr=vr.target.options,yr=gr.selectedIndex===-1?"":gr[gr.selectedIndex].value;mr.setValue(pr,{value:yr})});break}}static setAttributes({html:hr,element:pr,storage:xr=null,intent:mr,linkService:fr}){const{attributes:Er}=pr,vr=hr instanceof HTMLAnchorElement;Er.type==="radio"&&(Er.name=`${Er.name}-${mr}`);for(const[gr,yr]of Object.entries(Er))if(yr!=null)switch(gr){case"class":yr.length&&hr.setAttribute(gr,yr.join(" "));break;case"dataId":break;case"id":hr.setAttribute("data-element-id",yr);break;case"style":Object.assign(hr.style,yr);break;case"textContent":hr.textContent=yr;break;default:(!vr||gr!=="href"&&gr!=="newWindow")&&hr.setAttribute(gr,yr)}vr&&fr.addLinkAttributes(hr,Er.href,Er.newWindow),xr&&Er.dataId&&this.setupStorage(hr,Er.dataId,pr,xr)}static render(hr){var jr;const pr=hr.annotationStorage,xr=hr.linkService,mr=hr.xfaHtml,fr=hr.intent||"display",Er=document.createElement(mr.name);mr.attributes&&this.setAttributes({html:Er,element:mr,intent:fr,linkService:xr});const vr=[[mr,-1,Er]],gr=hr.div;if(gr.append(Er),hr.viewport){const br=`matrix(${hr.viewport.transform.join(",")})`;gr.style.transform=br}fr!=="richText"&&gr.setAttribute("class","xfaLayer xfaFont");const yr=[];for(;vr.length>0;){const[br,_r,wr]=vr.at(-1);if(_r+1===br.children.length){vr.pop();continue}const Rr=br.children[++vr.at(-1)[1]];if(Rr===null)continue;const{name:Ar}=Rr;if(Ar==="#text"){const kr=document.createTextNode(Rr.value);yr.push(kr),wr.append(kr);continue}const Sr=(jr=Rr==null?void 0:Rr.attributes)!=null&&jr.xmlns?document.createElementNS(Rr.attributes.xmlns,Ar):document.createElement(Ar);if(wr.append(Sr),Rr.attributes&&this.setAttributes({html:Sr,element:Rr,storage:pr,intent:fr,linkService:xr}),Rr.children&&Rr.children.length>0)vr.push([Rr,-1,Sr]);else if(Rr.value){const kr=document.createTextNode(Rr.value);cr.XfaText.shouldBuildText(Ar)&&yr.push(kr),Sr.append(kr)}}for(const br of gr.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))br.setAttribute("readOnly",!0);return{textDivs:yr}}static update(hr){const pr=`matrix(${hr.viewport.transform.join(",")})`;hr.div.style.transform=pr,hr.div.hidden=!1}}or.XfaLayer=ur},(ar,or,lr)=>{var mr,fr,Er,vr,gr,yr,jr,br,_r,wr,Rr,Ar,Sr,kr,Nr,pu,xu,mu,fu,$l,gu,Ul,vu,Eu,yu,ju,bu,ho,Wl,Bo,$o,vo,Hl,Uo,Vr,wu,zl,_u,Ru,Vl,Wo,Eo;Object.defineProperty(or,"__esModule",{value:!0}),or.InkEditor=void 0;var cr=lr(1),ur=lr(4),dr=lr(29),hr=lr(6),pr=lr(5);const Is=class Is extends ur.AnnotationEditor{constructor(Ur){super({...Ur,name:"inkEditor"});Ss(this,Nr);Ss(this,mr,0);Ss(this,fr,0);Ss(this,Er,this.canvasPointermove.bind(this));Ss(this,vr,this.canvasPointerleave.bind(this));Ss(this,gr,this.canvasPointerup.bind(this));Ss(this,yr,this.canvasPointerdown.bind(this));Ss(this,jr,new Path2D);Ss(this,br,!1);Ss(this,_r,!1);Ss(this,wr,!1);Ss(this,Rr,null);Ss(this,Ar,0);Ss(this,Sr,0);Ss(this,kr,null);this.color=Ur.color||null,this.thickness=Ur.thickness||null,this.opacity=Ur.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(Ur){ur.AnnotationEditor.initialize(Ur,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(Ur,Xr){switch(Ur){case cr.AnnotationEditorParamsType.INK_THICKNESS:Is._defaultThickness=Xr;break;case cr.AnnotationEditorParamsType.INK_COLOR:Is._defaultColor=Xr;break;case cr.AnnotationEditorParamsType.INK_OPACITY:Is._defaultOpacity=Xr/100;break}}updateParams(Ur,Xr){switch(Ur){case cr.AnnotationEditorParamsType.INK_THICKNESS:js(this,Nr,pu).call(this,Xr);break;case cr.AnnotationEditorParamsType.INK_COLOR:js(this,Nr,xu).call(this,Xr);break;case cr.AnnotationEditorParamsType.INK_OPACITY:js(this,Nr,mu).call(this,Xr);break}}static get defaultPropertiesToUpdate(){return[[cr.AnnotationEditorParamsType.INK_THICKNESS,Is._defaultThickness],[cr.AnnotationEditorParamsType.INK_COLOR,Is._defaultColor||ur.AnnotationEditor._defaultLineColor],[cr.AnnotationEditorParamsType.INK_OPACITY,Math.round(Is._defaultOpacity*100)]]}get propertiesToUpdate(){return[[cr.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Is._defaultThickness],[cr.AnnotationEditorParamsType.INK_COLOR,this.color||Is._defaultColor||ur.AnnotationEditor._defaultLineColor],[cr.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Is._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(js(this,Nr,Bo).call(this),js(this,Nr,$o).call(this)),this.isAttachedToDOM||(this.parent.add(this),js(this,Nr,vo).call(this)),js(this,Nr,Eo).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,Or(this,Rr).disconnect(),Cs(this,Rr,null),super.remove())}setParent(Ur){!this.parent&&Ur?this._uiManager.removeShouldRescale(this):this.parent&&Ur===null&&this._uiManager.addShouldRescale(this),super.setParent(Ur)}onScaleChanging(){const[Ur,Xr]=this.parentDimensions,cs=this.width*Ur,xs=this.height*Xr;this.setDimensions(cs,xs)}enableEditMode(){Or(this,br)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",Or(this,yr)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",Or(this,yr)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){Or(this,br)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),Cs(this,br,!0),this.div.classList.add("disabled"),js(this,Nr,Eo).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(Ur){this._focusEventsAllowed&&(super.focusin(Ur),this.enableEditMode())}canvasPointerdown(Ur){Ur.button!==0||!this.isInEditMode()||Or(this,br)||(this.setInForeground(),Ur.preventDefault(),Ur.type!=="mouse"&&this.div.focus(),js(this,Nr,gu).call(this,Ur.offsetX,Ur.offsetY))}canvasPointermove(Ur){Ur.preventDefault(),js(this,Nr,Ul).call(this,Ur.offsetX,Ur.offsetY)}canvasPointerup(Ur){Ur.preventDefault(),js(this,Nr,Wl).call(this,Ur)}canvasPointerleave(Ur){js(this,Nr,Wl).call(this,Ur)}get isResizable(){return!this.isEmpty()&&Or(this,br)}render(){if(this.div)return this.div;let Ur,Xr;this.width&&(Ur=this.x,Xr=this.y),super.render(),ur.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(Ts=>{var gs;return(gs=this.div)==null?void 0:gs.setAttribute("aria-label",Ts)});const[cs,xs,Es,Ns]=js(this,Nr,fu).call(this);if(this.setAt(cs,xs,0,0),this.setDims(Es,Ns),js(this,Nr,Bo).call(this),this.width){const[Ts,gs]=this.parentDimensions;this.setAspectRatio(this.width*Ts,this.height*gs),this.setAt(Ur*Ts,Xr*gs,this.width*Ts,this.height*gs),Cs(this,wr,!0),js(this,Nr,vo).call(this),this.setDims(this.width*Ts,this.height*gs),js(this,Nr,ho).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return js(this,Nr,$o).call(this),this.div}setDimensions(Ur,Xr){const cs=Math.round(Ur),xs=Math.round(Xr);if(Or(this,Ar)===cs&&Or(this,Sr)===xs)return;Cs(this,Ar,cs),Cs(this,Sr,xs),this.canvas.style.visibility="hidden";const[Es,Ns]=this.parentDimensions;this.width=Ur/Es,this.height=Xr/Ns,this.fixAndSetPosition(),Or(this,br)&&js(this,Nr,Hl).call(this,Ur,Xr),js(this,Nr,vo).call(this),js(this,Nr,ho).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(Ur,Xr,cs){var ga,ro,no;if(Ur instanceof dr.InkAnnotationElement)return null;const xs=super.deserialize(Ur,Xr,cs);xs.thickness=Ur.thickness,xs.color=cr.Util.makeHexColor(...Ur.color),xs.opacity=Ur.opacity;const[Es,Ns]=xs.pageDimensions,Ts=xs.width*Es,gs=xs.height*Ns,Hs=xs.parentScale,Us=Ur.thickness/2;Cs(xs,br,!0),Cs(xs,Ar,Math.round(Ts)),Cs(xs,Sr,Math.round(gs));const{paths:xa,rect:Gs,rotation:$a}=Ur;for(let{bezier:$s}of xa){$s=js(ga=Is,Vr,_u).call(ga,$s,Gs,$a);const Rs=[];xs.paths.push(Rs);let ks=Hs*($s[0]-Us),qs=Hs*($s[1]-Us);for(let eo=2,fs=$s.length;eo<fs;eo+=6){const Os=Hs*($s[eo]-Us),zs=Hs*($s[eo+1]-Us),Zs=Hs*($s[eo+2]-Us),na=Hs*($s[eo+3]-Us),Ys=Hs*($s[eo+4]-Us),hs=Hs*($s[eo+5]-Us);Rs.push([[ks,qs],[Os,zs],[Zs,na],[Ys,hs]]),ks=Ys,qs=hs}const to=js(this,Vr,wu).call(this,Rs);xs.bezierPath2D.push(to)}const Js=js(ro=xs,Nr,Vl).call(ro);return Cs(xs,fr,Math.max(ur.AnnotationEditor.MIN_SIZE,Js[2]-Js[0])),Cs(xs,mr,Math.max(ur.AnnotationEditor.MIN_SIZE,Js[3]-Js[1])),js(no=xs,Nr,Hl).call(no,Ts,gs),xs}serialize(){if(this.isEmpty())return null;const Ur=this.getRect(0,0),Xr=ur.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:cr.AnnotationEditorType.INK,color:Xr,thickness:this.thickness,opacity:this.opacity,paths:js(this,Nr,Ru).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,Ur),pageIndex:this.pageIndex,rect:Ur,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};mr=new WeakMap,fr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,jr=new WeakMap,br=new WeakMap,_r=new WeakMap,wr=new WeakMap,Rr=new WeakMap,Ar=new WeakMap,Sr=new WeakMap,kr=new WeakMap,Nr=new WeakSet,pu=function(Ur){const Xr=this.thickness;this.addCommands({cmd:()=>{this.thickness=Ur,js(this,Nr,Eo).call(this)},undo:()=>{this.thickness=Xr,js(this,Nr,Eo).call(this)},mustExec:!0,type:cr.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},xu=function(Ur){const Xr=this.color;this.addCommands({cmd:()=>{this.color=Ur,js(this,Nr,ho).call(this)},undo:()=>{this.color=Xr,js(this,Nr,ho).call(this)},mustExec:!0,type:cr.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},mu=function(Ur){Ur/=100;const Xr=this.opacity;this.addCommands({cmd:()=>{this.opacity=Ur,js(this,Nr,ho).call(this)},undo:()=>{this.opacity=Xr,js(this,Nr,ho).call(this)},mustExec:!0,type:cr.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},fu=function(){const{parentRotation:Ur,parentDimensions:[Xr,cs]}=this;switch(Ur){case 90:return[0,cs,cs,Xr];case 180:return[Xr,cs,Xr,cs];case 270:return[Xr,0,cs,Xr];default:return[0,0,Xr,cs]}},$l=function(){const{ctx:Ur,color:Xr,opacity:cs,thickness:xs,parentScale:Es,scaleFactor:Ns}=this;Ur.lineWidth=xs*Es/Ns,Ur.lineCap="round",Ur.lineJoin="round",Ur.miterLimit=10,Ur.strokeStyle=`${Xr}${(0,pr.opacityToHex)(cs)}`},gu=function(Ur,Xr){this.canvas.addEventListener("contextmenu",hr.noContextMenu),this.canvas.addEventListener("pointerleave",Or(this,vr)),this.canvas.addEventListener("pointermove",Or(this,Er)),this.canvas.addEventListener("pointerup",Or(this,gr)),this.canvas.removeEventListener("pointerdown",Or(this,yr)),this.isEditing=!0,Or(this,wr)||(Cs(this,wr,!0),js(this,Nr,vo).call(this),this.thickness||(this.thickness=Is._defaultThickness),this.color||(this.color=Is._defaultColor||ur.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=Is._defaultOpacity)),this.currentPath.push([Ur,Xr]),Cs(this,_r,!1),js(this,Nr,$l).call(this),Cs(this,kr,()=>{js(this,Nr,yu).call(this),Or(this,kr)&&window.requestAnimationFrame(Or(this,kr))}),window.requestAnimationFrame(Or(this,kr))},Ul=function(Ur,Xr){const[cs,xs]=this.currentPath.at(-1);if(this.currentPath.length>1&&Ur===cs&&Xr===xs)return;const Es=this.currentPath;let Ns=Or(this,jr);if(Es.push([Ur,Xr]),Cs(this,_r,!0),Es.length<=2){Ns.moveTo(...Es[0]),Ns.lineTo(Ur,Xr);return}Es.length===3&&(Cs(this,jr,Ns=new Path2D),Ns.moveTo(...Es[0])),js(this,Nr,ju).call(this,Ns,...Es.at(-3),...Es.at(-2),Ur,Xr)},vu=function(){if(this.currentPath.length===0)return;const Ur=this.currentPath.at(-1);Or(this,jr).lineTo(...Ur)},Eu=function(Ur,Xr){Cs(this,kr,null),Ur=Math.min(Math.max(Ur,0),this.canvas.width),Xr=Math.min(Math.max(Xr,0),this.canvas.height),js(this,Nr,Ul).call(this,Ur,Xr),js(this,Nr,vu).call(this);let cs;if(this.currentPath.length!==1)cs=js(this,Nr,bu).call(this);else{const gs=[Ur,Xr];cs=[[gs,gs.slice(),gs.slice(),gs]]}const xs=Or(this,jr),Es=this.currentPath;this.currentPath=[],Cs(this,jr,new Path2D);const Ns=()=>{this.allRawPaths.push(Es),this.paths.push(cs),this.bezierPath2D.push(xs),this.rebuild()},Ts=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(js(this,Nr,Bo).call(this),js(this,Nr,$o).call(this)),js(this,Nr,Eo).call(this))};this.addCommands({cmd:Ns,undo:Ts,mustExec:!0})},yu=function(){if(!Or(this,_r))return;Cs(this,_r,!1);const Ur=Math.ceil(this.thickness*this.parentScale),Xr=this.currentPath.slice(-3),cs=Xr.map(Ns=>Ns[0]),xs=Xr.map(Ns=>Ns[1]);Math.min(...cs)-Ur,Math.max(...cs)+Ur,Math.min(...xs)-Ur,Math.max(...xs)+Ur;const{ctx:Es}=this;Es.save(),Es.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Ns of this.bezierPath2D)Es.stroke(Ns);Es.stroke(Or(this,jr)),Es.restore()},ju=function(Ur,Xr,cs,xs,Es,Ns,Ts){const gs=(Xr+xs)/2,Hs=(cs+Es)/2,Us=(xs+Ns)/2,xa=(Es+Ts)/2;Ur.bezierCurveTo(gs+2*(xs-gs)/3,Hs+2*(Es-Hs)/3,Us+2*(xs-Us)/3,xa+2*(Es-xa)/3,Us,xa)},bu=function(){const Ur=this.currentPath;if(Ur.length<=2)return[[Ur[0],Ur[0],Ur.at(-1),Ur.at(-1)]];const Xr=[];let cs,[xs,Es]=Ur[0];for(cs=1;cs<Ur.length-2;cs++){const[Gs,$a]=Ur[cs],[Js,ga]=Ur[cs+1],ro=(Gs+Js)/2,no=($a+ga)/2,$s=[xs+2*(Gs-xs)/3,Es+2*($a-Es)/3],Rs=[ro+2*(Gs-ro)/3,no+2*($a-no)/3];Xr.push([[xs,Es],$s,Rs,[ro,no]]),[xs,Es]=[ro,no]}const[Ns,Ts]=Ur[cs],[gs,Hs]=Ur[cs+1],Us=[xs+2*(Ns-xs)/3,Es+2*(Ts-Es)/3],xa=[gs+2*(Ns-gs)/3,Hs+2*(Ts-Hs)/3];return Xr.push([[xs,Es],Us,xa,[gs,Hs]]),Xr},ho=function(){if(this.isEmpty()){js(this,Nr,Uo).call(this);return}js(this,Nr,$l).call(this);const{canvas:Ur,ctx:Xr}=this;Xr.setTransform(1,0,0,1,0,0),Xr.clearRect(0,0,Ur.width,Ur.height),js(this,Nr,Uo).call(this);for(const cs of this.bezierPath2D)Xr.stroke(cs)},Wl=function(Ur){this.canvas.removeEventListener("pointerleave",Or(this,vr)),this.canvas.removeEventListener("pointermove",Or(this,Er)),this.canvas.removeEventListener("pointerup",Or(this,gr)),this.canvas.addEventListener("pointerdown",Or(this,yr)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",hr.noContextMenu)},10),js(this,Nr,Eu).call(this,Ur.offsetX,Ur.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Bo=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",ur.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(Ur=>{var Xr;return(Xr=this.canvas)==null?void 0:Xr.setAttribute("aria-label",Ur)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},$o=function(){Cs(this,Rr,new ResizeObserver(Ur=>{const Xr=Ur[0].contentRect;Xr.width&&Xr.height&&this.setDimensions(Xr.width,Xr.height)})),Or(this,Rr).observe(this.div)},vo=function(){if(!Or(this,wr))return;const[Ur,Xr]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*Ur),this.canvas.height=Math.ceil(this.height*Xr),js(this,Nr,Uo).call(this)},Hl=function(Ur,Xr){const cs=js(this,Nr,Wo).call(this),xs=(Ur-cs)/Or(this,fr),Es=(Xr-cs)/Or(this,mr);this.scaleFactor=Math.min(xs,Es)},Uo=function(){const Ur=js(this,Nr,Wo).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+Ur,this.translationY*this.scaleFactor+Ur)},Vr=new WeakSet,wu=function(Ur){const Xr=new Path2D;for(let cs=0,xs=Ur.length;cs<xs;cs++){const[Es,Ns,Ts,gs]=Ur[cs];cs===0&&Xr.moveTo(...Es),Xr.bezierCurveTo(Ns[0],Ns[1],Ts[0],Ts[1],gs[0],gs[1])}return Xr},zl=function(Ur,Xr,cs){const[xs,Es,Ns,Ts]=Xr;switch(cs){case 0:for(let gs=0,Hs=Ur.length;gs<Hs;gs+=2)Ur[gs]+=xs,Ur[gs+1]=Ts-Ur[gs+1];break;case 90:for(let gs=0,Hs=Ur.length;gs<Hs;gs+=2){const Us=Ur[gs];Ur[gs]=Ur[gs+1]+xs,Ur[gs+1]=Us+Es}break;case 180:for(let gs=0,Hs=Ur.length;gs<Hs;gs+=2)Ur[gs]=Ns-Ur[gs],Ur[gs+1]+=Es;break;case 270:for(let gs=0,Hs=Ur.length;gs<Hs;gs+=2){const Us=Ur[gs];Ur[gs]=Ns-Ur[gs+1],Ur[gs+1]=Ts-Us}break;default:throw new Error("Invalid rotation")}return Ur},_u=function(Ur,Xr,cs){const[xs,Es,Ns,Ts]=Xr;switch(cs){case 0:for(let gs=0,Hs=Ur.length;gs<Hs;gs+=2)Ur[gs]-=xs,Ur[gs+1]=Ts-Ur[gs+1];break;case 90:for(let gs=0,Hs=Ur.length;gs<Hs;gs+=2){const Us=Ur[gs];Ur[gs]=Ur[gs+1]-Es,Ur[gs+1]=Us-xs}break;case 180:for(let gs=0,Hs=Ur.length;gs<Hs;gs+=2)Ur[gs]=Ns-Ur[gs],Ur[gs+1]-=Es;break;case 270:for(let gs=0,Hs=Ur.length;gs<Hs;gs+=2){const Us=Ur[gs];Ur[gs]=Ts-Ur[gs+1],Ur[gs+1]=Ns-Us}break;default:throw new Error("Invalid rotation")}return Ur},Ru=function(Ur,Xr,cs,xs){var Hs,Us;const Es=[],Ns=this.thickness/2,Ts=Ur*Xr+Ns,gs=Ur*cs+Ns;for(const xa of this.paths){const Gs=[],$a=[];for(let Js=0,ga=xa.length;Js<ga;Js++){const[ro,no,$s,Rs]=xa[Js],ks=Ur*ro[0]+Ts,qs=Ur*ro[1]+gs,to=Ur*no[0]+Ts,eo=Ur*no[1]+gs,fs=Ur*$s[0]+Ts,Os=Ur*$s[1]+gs,zs=Ur*Rs[0]+Ts,Zs=Ur*Rs[1]+gs;Js===0&&(Gs.push(ks,qs),$a.push(ks,qs)),Gs.push(to,eo,fs,Os,zs,Zs),$a.push(to,eo),Js===ga-1&&$a.push(zs,Zs)}Es.push({bezier:js(Hs=Is,Vr,zl).call(Hs,Gs,xs,this.rotation),points:js(Us=Is,Vr,zl).call(Us,$a,xs,this.rotation)})}return Es},Vl=function(){let Ur=1/0,Xr=-1/0,cs=1/0,xs=-1/0;for(const Es of this.paths)for(const[Ns,Ts,gs,Hs]of Es){const Us=cr.Util.bezierBoundingBox(...Ns,...Ts,...gs,...Hs);Ur=Math.min(Ur,Us[0]),cs=Math.min(cs,Us[1]),Xr=Math.max(Xr,Us[2]),xs=Math.max(xs,Us[3])}return[Ur,cs,Xr,xs]},Wo=function(){return Or(this,br)?Math.ceil(this.thickness*this.parentScale):0},Eo=function(Ur=!1){if(this.isEmpty())return;if(!Or(this,br)){js(this,Nr,ho).call(this);return}const Xr=js(this,Nr,Vl).call(this),cs=js(this,Nr,Wo).call(this);Cs(this,fr,Math.max(ur.AnnotationEditor.MIN_SIZE,Xr[2]-Xr[0])),Cs(this,mr,Math.max(ur.AnnotationEditor.MIN_SIZE,Xr[3]-Xr[1]));const xs=Math.ceil(cs+Or(this,fr)*this.scaleFactor),Es=Math.ceil(cs+Or(this,mr)*this.scaleFactor),[Ns,Ts]=this.parentDimensions;this.width=xs/Ns,this.height=Es/Ts,this.setAspectRatio(xs,Es);const gs=this.translationX,Hs=this.translationY;this.translationX=-Xr[0],this.translationY=-Xr[1],js(this,Nr,vo).call(this),js(this,Nr,ho).call(this),Cs(this,Ar,xs),Cs(this,Sr,Es),this.setDims(xs,Es);const Us=Ur?cs/this.scaleFactor/2:0;this.translate(gs-this.translationX-Us,Hs-this.translationY-Us)},Ss(Is,Vr),io(Is,"_defaultColor",null),io(Is,"_defaultOpacity",1),io(Is,"_defaultThickness",1),io(Is,"_type","ink");let xr=Is;or.InkEditor=xr},(ar,or,lr)=>{var xr,mr,fr,Er,vr,gr,yr,jr,br,_r,wr,ko,To,Ho,Gl,Su,Nu,Xl,zo,Cu;Object.defineProperty(or,"__esModule",{value:!0}),or.StampEditor=void 0;var cr=lr(1),ur=lr(4),dr=lr(6),hr=lr(29);const Br=class Br extends ur.AnnotationEditor{constructor(es){super({...es,name:"stampEditor"});Ss(this,wr);Ss(this,xr,null);Ss(this,mr,null);Ss(this,fr,null);Ss(this,Er,null);Ss(this,vr,null);Ss(this,gr,null);Ss(this,yr,null);Ss(this,jr,null);Ss(this,br,!1);Ss(this,_r,!1);Cs(this,Er,es.bitmapUrl),Cs(this,vr,es.bitmapFile)}static initialize(es){ur.AnnotationEditor.initialize(es)}static get supportedTypes(){const es=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,cr.shadow)(this,"supportedTypes",es.map(ps=>`image/${ps}`))}static get supportedTypesStr(){return(0,cr.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(es){return this.supportedTypes.includes(es)}static paste(es,ps){ps.pasteEditor(cr.AnnotationEditorType.STAMP,{bitmapFile:es.getAsFile()})}remove(){var es,ps;Or(this,mr)&&(Cs(this,xr,null),this._uiManager.imageManager.deleteId(Or(this,mr)),(es=Or(this,gr))==null||es.remove(),Cs(this,gr,null),(ps=Or(this,yr))==null||ps.disconnect(),Cs(this,yr,null)),super.remove()}rebuild(){if(!this.parent){Or(this,mr)&&js(this,wr,Ho).call(this);return}super.rebuild(),this.div!==null&&(Or(this,mr)&&js(this,wr,Ho).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(Or(this,fr)||Or(this,xr)||Or(this,Er)||Or(this,vr))}get isResizable(){return!0}render(){if(this.div)return this.div;let es,ps;if(this.width&&(es=this.x,ps=this.y),super.render(),this.div.hidden=!0,Or(this,xr)?js(this,wr,Gl).call(this):js(this,wr,Ho).call(this),this.width){const[ts,Qr]=this.parentDimensions;this.setAt(es*ts,ps*Qr,this.width*ts,this.height*Qr)}return this.div}static deserialize(es,ps,ts){if(es instanceof hr.StampAnnotationElement)return null;const Qr=super.deserialize(es,ps,ts),{rect:Hr,bitmapUrl:Kr,bitmapId:rs,isSvg:Mr,accessibilityData:Dr}=es;rs&&ts.imageManager.isValidId(rs)?Cs(Qr,mr,rs):Cs(Qr,Er,Kr),Cs(Qr,br,Mr);const[Lr,Fr]=Qr.pageDimensions;return Qr.width=(Hr[2]-Hr[0])/Lr,Qr.height=(Hr[3]-Hr[1])/Fr,Dr&&(Qr.altTextData=Dr),Qr}serialize(es=!1,ps=null){if(this.isEmpty())return null;const ts={annotationType:cr.AnnotationEditorType.STAMP,bitmapId:Or(this,mr),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:Or(this,br),structTreeParentId:this._structTreeParentId};if(es)return ts.bitmapUrl=js(this,wr,zo).call(this,!0),ts.accessibilityData=this.altTextData,ts;const{decorative:Qr,altText:Hr}=this.altTextData;if(!Qr&&Hr&&(ts.accessibilityData={type:"Figure",alt:Hr}),ps===null)return ts;ps.stamps||(ps.stamps=new Map);const Kr=Or(this,br)?(ts.rect[2]-ts.rect[0])*(ts.rect[3]-ts.rect[1]):null;if(!ps.stamps.has(Or(this,mr)))ps.stamps.set(Or(this,mr),{area:Kr,serialized:ts}),ts.bitmap=js(this,wr,zo).call(this,!1);else if(Or(this,br)){const rs=ps.stamps.get(Or(this,mr));Kr>rs.area&&(rs.area=Kr,rs.serialized.bitmap.close(),rs.serialized.bitmap=js(this,wr,zo).call(this,!1))}return ts}};xr=new WeakMap,mr=new WeakMap,fr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,jr=new WeakMap,br=new WeakMap,_r=new WeakMap,wr=new WeakSet,ko=function(es,ps=!1){if(!es){this.remove();return}Cs(this,xr,es.bitmap),ps||(Cs(this,mr,es.id),Cs(this,br,es.isSvg)),js(this,wr,Gl).call(this)},To=function(){Cs(this,fr,null),this._uiManager.enableWaiting(!1),Or(this,gr)&&this.div.focus()},Ho=function(){if(Or(this,mr)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(Or(this,mr)).then(ps=>js(this,wr,ko).call(this,ps,!0)).finally(()=>js(this,wr,To).call(this));return}if(Or(this,Er)){const ps=Or(this,Er);Cs(this,Er,null),this._uiManager.enableWaiting(!0),Cs(this,fr,this._uiManager.imageManager.getFromUrl(ps).then(ts=>js(this,wr,ko).call(this,ts)).finally(()=>js(this,wr,To).call(this)));return}if(Or(this,vr)){const ps=Or(this,vr);Cs(this,vr,null),this._uiManager.enableWaiting(!0),Cs(this,fr,this._uiManager.imageManager.getFromFile(ps).then(ts=>js(this,wr,ko).call(this,ts)).finally(()=>js(this,wr,To).call(this)));return}const es=document.createElement("input");es.type="file",es.accept=Br.supportedTypesStr,Cs(this,fr,new Promise(ps=>{es.addEventListener("change",async()=>{if(!es.files||es.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const ts=await this._uiManager.imageManager.getFromFile(es.files[0]);js(this,wr,ko).call(this,ts)}ps()}),es.addEventListener("cancel",()=>{this.remove(),ps()})}).finally(()=>js(this,wr,To).call(this))),es.click()},Gl=function(){const{div:es}=this;let{width:ps,height:ts}=Or(this,xr);const[Qr,Hr]=this.pageDimensions,Kr=.75;if(this.width)ps=this.width*Qr,ts=this.height*Hr;else if(ps>Kr*Qr||ts>Kr*Hr){const Lr=Math.min(Kr*Qr/ps,Kr*Hr/ts);ps*=Lr,ts*=Lr}const[rs,Mr]=this.parentDimensions;this.setDims(ps*rs/Qr,ts*Mr/Hr),this._uiManager.enableWaiting(!1);const Dr=Cs(this,gr,document.createElement("canvas"));es.append(Dr),es.hidden=!1,js(this,wr,Xl).call(this,ps,ts),js(this,wr,Cu).call(this),Or(this,_r)||(this.parent.addUndoableEditor(this),Cs(this,_r,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},Su=function(es,ps){var Kr;const[ts,Qr]=this.parentDimensions;this.width=es/ts,this.height=ps/Qr,this.setDims(es,ps),(Kr=this._initialOptions)!=null&&Kr.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,Or(this,jr)!==null&&clearTimeout(Or(this,jr)),Cs(this,jr,setTimeout(()=>{Cs(this,jr,null),js(this,wr,Xl).call(this,es,ps)},200))},Nu=function(es,ps){const{width:ts,height:Qr}=Or(this,xr);let Hr=ts,Kr=Qr,rs=Or(this,xr);for(;Hr>2*es||Kr>2*ps;){const Mr=Hr,Dr=Kr;Hr>2*es&&(Hr=Hr>=16384?Math.floor(Hr/2)-1:Math.ceil(Hr/2)),Kr>2*ps&&(Kr=Kr>=16384?Math.floor(Kr/2)-1:Math.ceil(Kr/2));const Lr=new OffscreenCanvas(Hr,Kr);Lr.getContext("2d").drawImage(rs,0,0,Mr,Dr,0,0,Hr,Kr),rs=Lr.transferToImageBitmap()}return rs},Xl=function(es,ps){es=Math.ceil(es),ps=Math.ceil(ps);const ts=Or(this,gr);if(!ts||ts.width===es&&ts.height===ps)return;ts.width=es,ts.height=ps;const Qr=Or(this,br)?Or(this,xr):js(this,wr,Nu).call(this,es,ps),Hr=ts.getContext("2d");Hr.filter=this._uiManager.hcmFilter,Hr.drawImage(Qr,0,0,Qr.width,Qr.height,0,0,es,ps)},zo=function(es){if(es){if(Or(this,br)){const Qr=this._uiManager.imageManager.getSvgUrl(Or(this,mr));if(Qr)return Qr}const ps=document.createElement("canvas");return{width:ps.width,height:ps.height}=Or(this,xr),ps.getContext("2d").drawImage(Or(this,xr),0,0),ps.toDataURL()}if(Or(this,br)){const[ps,ts]=this.pageDimensions,Qr=Math.round(this.width*ps*dr.PixelsPerInch.PDF_TO_CSS_UNITS),Hr=Math.round(this.height*ts*dr.PixelsPerInch.PDF_TO_CSS_UNITS),Kr=new OffscreenCanvas(Qr,Hr);return Kr.getContext("2d").drawImage(Or(this,xr),0,0,Or(this,xr).width,Or(this,xr).height,0,0,Qr,Hr),Kr.transferToImageBitmap()}return structuredClone(Or(this,xr))},Cu=function(){Cs(this,yr,new ResizeObserver(es=>{const ps=es[0].contentRect;ps.width&&ps.height&&js(this,wr,Su).call(this,ps.width,ps.height)})),Or(this,yr).observe(this.div)},io(Br,"_type","stamp");let pr=Br;or.StampEditor=pr}],__webpack_module_cache__={};function __w_pdfjs_require__(ar){var or=__webpack_module_cache__[ar];if(or!==void 0)return or.exports;var lr=__webpack_module_cache__[ar]={exports:{}};return __webpack_modules__[ar](lr,lr.exports,__w_pdfjs_require__),lr.exports}var __webpack_exports__={};return(()=>{var ar=__webpack_exports__;Object.defineProperty(ar,"__esModule",{value:!0}),Object.defineProperty(ar,"AbortException",{enumerable:!0,get:function(){return or.AbortException}}),Object.defineProperty(ar,"AnnotationEditorLayer",{enumerable:!0,get:function(){return dr.AnnotationEditorLayer}}),Object.defineProperty(ar,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return or.AnnotationEditorParamsType}}),Object.defineProperty(ar,"AnnotationEditorType",{enumerable:!0,get:function(){return or.AnnotationEditorType}}),Object.defineProperty(ar,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return hr.AnnotationEditorUIManager}}),Object.defineProperty(ar,"AnnotationLayer",{enumerable:!0,get:function(){return pr.AnnotationLayer}}),Object.defineProperty(ar,"AnnotationMode",{enumerable:!0,get:function(){return or.AnnotationMode}}),Object.defineProperty(ar,"CMapCompressionType",{enumerable:!0,get:function(){return or.CMapCompressionType}}),Object.defineProperty(ar,"DOMSVGFactory",{enumerable:!0,get:function(){return cr.DOMSVGFactory}}),Object.defineProperty(ar,"FeatureTest",{enumerable:!0,get:function(){return or.FeatureTest}}),Object.defineProperty(ar,"GlobalWorkerOptions",{enumerable:!0,get:function(){return xr.GlobalWorkerOptions}}),Object.defineProperty(ar,"ImageKind",{enumerable:!0,get:function(){return or.ImageKind}}),Object.defineProperty(ar,"InvalidPDFException",{enumerable:!0,get:function(){return or.InvalidPDFException}}),Object.defineProperty(ar,"MissingPDFException",{enumerable:!0,get:function(){return or.MissingPDFException}}),Object.defineProperty(ar,"OPS",{enumerable:!0,get:function(){return or.OPS}}),Object.defineProperty(ar,"PDFDataRangeTransport",{enumerable:!0,get:function(){return lr.PDFDataRangeTransport}}),Object.defineProperty(ar,"PDFDateString",{enumerable:!0,get:function(){return cr.PDFDateString}}),Object.defineProperty(ar,"PDFWorker",{enumerable:!0,get:function(){return lr.PDFWorker}}),Object.defineProperty(ar,"PasswordResponses",{enumerable:!0,get:function(){return or.PasswordResponses}}),Object.defineProperty(ar,"PermissionFlag",{enumerable:!0,get:function(){return or.PermissionFlag}}),Object.defineProperty(ar,"PixelsPerInch",{enumerable:!0,get:function(){return cr.PixelsPerInch}}),Object.defineProperty(ar,"PromiseCapability",{enumerable:!0,get:function(){return or.PromiseCapability}}),Object.defineProperty(ar,"RenderingCancelledException",{enumerable:!0,get:function(){return cr.RenderingCancelledException}}),Object.defineProperty(ar,"SVGGraphics",{enumerable:!0,get:function(){return lr.SVGGraphics}}),Object.defineProperty(ar,"UnexpectedResponseException",{enumerable:!0,get:function(){return or.UnexpectedResponseException}}),Object.defineProperty(ar,"Util",{enumerable:!0,get:function(){return or.Util}}),Object.defineProperty(ar,"VerbosityLevel",{enumerable:!0,get:function(){return or.VerbosityLevel}}),Object.defineProperty(ar,"XfaLayer",{enumerable:!0,get:function(){return mr.XfaLayer}}),Object.defineProperty(ar,"build",{enumerable:!0,get:function(){return lr.build}}),Object.defineProperty(ar,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return or.createValidAbsoluteUrl}}),Object.defineProperty(ar,"getDocument",{enumerable:!0,get:function(){return lr.getDocument}}),Object.defineProperty(ar,"getFilenameFromUrl",{enumerable:!0,get:function(){return cr.getFilenameFromUrl}}),Object.defineProperty(ar,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return cr.getPdfFilenameFromUrl}}),Object.defineProperty(ar,"getXfaPageViewport",{enumerable:!0,get:function(){return cr.getXfaPageViewport}}),Object.defineProperty(ar,"isDataScheme",{enumerable:!0,get:function(){return cr.isDataScheme}}),Object.defineProperty(ar,"isPdfFile",{enumerable:!0,get:function(){return cr.isPdfFile}}),Object.defineProperty(ar,"loadScript",{enumerable:!0,get:function(){return cr.loadScript}}),Object.defineProperty(ar,"noContextMenu",{enumerable:!0,get:function(){return cr.noContextMenu}}),Object.defineProperty(ar,"normalizeUnicode",{enumerable:!0,get:function(){return or.normalizeUnicode}}),Object.defineProperty(ar,"renderTextLayer",{enumerable:!0,get:function(){return ur.renderTextLayer}}),Object.defineProperty(ar,"setLayerDimensions",{enumerable:!0,get:function(){return cr.setLayerDimensions}}),Object.defineProperty(ar,"shadow",{enumerable:!0,get:function(){return or.shadow}}),Object.defineProperty(ar,"updateTextLayer",{enumerable:!0,get:function(){return ur.updateTextLayer}}),Object.defineProperty(ar,"version",{enumerable:!0,get:function(){return lr.version}});var or=__w_pdfjs_require__(1),lr=__w_pdfjs_require__(2),cr=__w_pdfjs_require__(6),ur=__w_pdfjs_require__(26),dr=__w_pdfjs_require__(27),hr=__w_pdfjs_require__(5),pr=__w_pdfjs_require__(29),xr=__w_pdfjs_require__(14),mr=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let ar=0;ar<256;++ar)byteToHex.push((ar+256).toString(16).slice(1));function unsafeStringify(ar,or=0){return byteToHex[ar[or+0]]+byteToHex[ar[or+1]]+byteToHex[ar[or+2]]+byteToHex[ar[or+3]]+"-"+byteToHex[ar[or+4]]+byteToHex[ar[or+5]]+"-"+byteToHex[ar[or+6]]+byteToHex[ar[or+7]]+"-"+byteToHex[ar[or+8]]+byteToHex[ar[or+9]]+"-"+byteToHex[ar[or+10]]+byteToHex[ar[or+11]]+byteToHex[ar[or+12]]+byteToHex[ar[or+13]]+byteToHex[ar[or+14]]+byteToHex[ar[or+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(ar,or,lr){if(native.randomUUID&&!ar)return native.randomUUID();ar=ar||{};const cr=ar.random||(ar.rng||rng)();return cr[6]=cr[6]&15|64,cr[8]=cr[8]&63|128,unsafeStringify(cr)}pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;async function parseScheduleStage1(ar){console.time("scheduleParser:stage1");const or=await new Promise(xr=>{const mr=new FileReader;mr.onload=()=>xr(mr.result),mr.readAsDataURL(ar)}),lr=await extractTextFromPDF$2(ar);console.log("Stage 1: Extracted text length:",lr.length);const cr=extractCastListFast(lr);console.log("Stage 1: Found",cr.length,"cast members");const{totalDays:ur,dayTextBlocks:dr}=extractDayCountAndBlocks(lr);console.log("Stage 1: Found",ur,"shooting days");const hr=extractMetadata(lr);console.log("Stage 1: Production name:",hr.productionName);const pr={id:v4(),productionName:hr.productionName,scriptVersion:hr.scriptVersion,scheduleVersion:hr.scheduleVersion,status:"pending",processingProgress:{current:0,total:ur},castList:cr,days:[],totalDays:ur,uploadedAt:new Date,pdfUri:or,rawText:lr};return console.timeEnd("scheduleParser:stage1"),{schedule:pr,rawText:lr,dayTextBlocks:dr}}function extractDayCountAndBlocks(ar){const or=[],lr=/End of Shooting Day\s+(\d+)/gi,cr=[];let ur;for(;(ur=lr.exec(ar))!==null;){const hr=parseInt(ur[1],10);cr.find(pr=>pr.dayNum===hr)||cr.push({dayNum:hr,endPos:ur.index+ur[0].length})}cr.sort((hr,pr)=>hr.endPos-pr.endPos);let dr=0;for(let hr=0;hr<cr.length;hr++){const pr=cr[hr],xr=hr>0?cr[hr-1].endPos:0,mr=ar.slice(xr,pr.endPos+200);or.push(mr),dr=Math.max(dr,pr.dayNum)}if(cr.length===0){const hr=/(?:^|\n)(?:Shooting\s+)?Day\s+(\d+)/gi;for(;(ur=hr.exec(ar))!==null;){const pr=parseInt(ur[1],10);dr=Math.max(dr,pr)}}return{totalDays:dr,dayTextBlocks:or}}async function extractTextFromPDF$2(ar){const or=await ar.arrayBuffer(),lr=await pdfExports.getDocument({data:or}).promise;let cr="";for(let ur=1;ur<=lr.numPages;ur++){const hr=await(await lr.getPage(ur)).getTextContent(),pr=new Map;for(const mr of hr.items){if(!mr.str||mr.str.trim()==="")continue;const fr=Math.round(mr.transform[5]/3)*3,Er=mr.transform[4];pr.has(fr)||pr.set(fr,[]),pr.get(fr).push({x:Er,text:mr.str,width:mr.width||0})}const xr=Array.from(pr.keys()).sort((mr,fr)=>fr-mr);for(const mr of xr){const fr=pr.get(mr);fr.sort((yr,jr)=>yr.x-jr.x);let Er="",vr=0,gr=0;for(const yr of fr){const jr=yr.x-(vr+gr);vr>0&&jr>15?Er+="	":vr>0&&jr>3&&(Er+=" "),Er+=yr.text,vr=yr.x,gr=yr.width}cr+=Er.trimEnd()+`
`}cr+=`
=== PAGE ${ur} ===

`}return cr}function extractCastListFast(ar){const or=[],lr=ar.slice(0,15e3),cr=[/(?:CAST\s*LIST|CAST\s*MEMBERS?|CAST|CHARACTERS?)[:\s]*\n([\s\S]*?)(?=\n\s*\n\s*\n|SHOOTING\s*DAY|END\s*OF|DAY\s+\d|=== PAGE)/i,/(?:CAST\s*LIST|CAST\s*MEMBERS?|CAST|CHARACTERS?)[:\s]*\n([\s\S]*?)(?=\n[A-Z]{3,}\s*\n|\nSCENE|\nDAY\b)/i];for(const xr of cr){const mr=lr.match(xr);if(mr){const fr=mr[1],Er=/(\d{1,3})\s*[.\-)\]:]?\s*([A-Z][A-Za-z'\-.\s]{1,30})/g;let vr;for(;(vr=Er.exec(fr))!==null;)addCastMember(or,vr[1],vr[2]);if(or.length>=2)break}}const ur=/(?:^|\n|\t)\s*(\d{1,3})\s*[.\-)\]:]\s*([A-Z][A-Za-z'\-.\s]{1,30}?)(?=\s*\n|\s*\t|\s{3,})/gm;let dr;for(;(dr=ur.exec(lr))!==null;)addCastMember(or,dr[1],dr[2]);const hr=/(?:^|\n)\s*(\d{1,3})[\t\s]{2,}([A-Z][A-Za-z'\-.\s]{1,30}?)(?=\s*[\t\n]|\s{3,}|$)/gm;for(;(dr=hr.exec(lr))!==null;)addCastMember(or,dr[1],dr[2]);const pr=/\((\d{1,3})\)\s*([A-Z][A-Za-z'\-.\s]{1,30}?)(?=\s*\n|\s*\t|\s{3,})/gm;for(;(dr=pr.exec(lr))!==null;)addCastMember(or,dr[1],dr[2]);if(or.length<3){const xr=/(?:^|\n|\t)\s*(\d{1,2})\s*[.\-)\]:]\s*([A-Z][A-Za-z'\-.\s]{2,25})/gm,mr=[];for(;(dr=xr.exec(ar.slice(0,2e4)))!==null;){const fr=dr[2].trim(),Er=new RegExp(`\\b${escapeRegExpSchedule(fr.split(" ")[0])}\\b`,"gi"),vr=(ar.match(Er)||[]).length;vr>=2&&mr.push({num:dr[1],name:fr,count:vr})}mr.sort((fr,Er)=>Er.count-fr.count);for(const fr of mr)addCastMember(or,fr.num,fr.name)}return or.sort((xr,mr)=>xr.number-mr.number),console.log("extractCastListFast: Found",or.length,"cast members:",or.map(xr=>`${xr.number}.${xr.name}`).join(", ")),or}function escapeRegExpSchedule(ar){return ar.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function addCastMember(ar,or,lr){const cr=parseInt(or,10);let ur=lr.trim().replace(/\s+/g," ").replace(/[.,;:]+$/,"").trim();cr<=0||cr>200||ur.length<2||ur.length>30||/^(INT|EXT|DAY|NIGHT|MORNING|HOURS|PAGE|SCENE|EST|TIME|CALL|UNIT|SET|LOC|END|TOTAL|SHOOT)/i.test(ur)||/^\d+$/.test(ur)||/^\d{1,2}[:/]\d{2}/.test(ur)||ar.find(dr=>dr.number===cr)||(ur=ur.toUpperCase(),ar.push({number:cr,name:ur}))}function extractMetadata(ar){const or=ar.slice(0,2e3),lr=or.match(/^[A-Z][A-Z\s\-']+(?=\s*\n)/m),cr=or.match(/(?:Script|Draft)[:\s]*([A-Za-z]+\s*\d*)/i),ur=or.match(/(?:Schedule|Version)[:\s]*([A-Za-z0-9\s\-\/]+)/i);return{productionName:lr?lr[0].trim():void 0,scriptVersion:cr?cr[1].trim():void 0,scheduleVersion:ur?ur[1].trim():void 0}}function aiDebugLog(...ar){console.log("[AIService]",...ar)}async function callAI(ar,or={}){var pr;const{system:lr,maxTokens:cr=4e3,maxRetries:ur=3}=or;aiDebugLog("callAI started, maxTokens:",cr,"prompt length:",ar.length);const dr=[{role:"user",content:ar}];let hr=null;for(let xr=0;xr<ur;xr++)try{aiDebugLog(`Attempt ${xr+1}/${ur}...`);const fr=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:dr,system:lr,maxTokens:cr,model:"claude-sonnet-4-20250514"})});if(aiDebugLog("Response status:",fr.status),!fr.ok){const vr=await fr.json().catch(()=>({})),gr=((pr=vr.error)==null?void 0:pr.message)||vr.error||"";if(aiDebugLog("API error:",fr.status,gr),fr.status===429){const yr=Math.pow(2,xr+1)*1e3;aiDebugLog(`Rate limited, waiting ${yr}ms before retry...`),await new Promise(jr=>setTimeout(jr,yr));continue}if(fr.status===529){const yr=Math.pow(2,xr+1)*1e3;aiDebugLog(`Server overloaded, waiting ${yr}ms before retry...`),await new Promise(jr=>setTimeout(jr,yr));continue}if(fr.status===400&&(gr.includes("credit balance")||gr.includes("purchase credits")))throw new Error("Insufficient API credits. Please add credits at console.anthropic.com");if(fr.status===401||fr.status===403)throw new Error("Invalid API key. Please check your configuration.");if(fr.status>=500){const yr=Math.pow(2,xr+1)*1e3;aiDebugLog(`Server error ${fr.status}, waiting ${yr}ms before retry...`),await new Promise(jr=>setTimeout(jr,yr));continue}throw new Error(vr.error||`API error: ${fr.status}`)}const Er=await fr.json();if(Er.content&&Er.content.length>0){const vr=Er.content[0].text;return aiDebugLog("AI call successful, response length:",vr.length),Er.usage&&aiDebugLog("Token usage:",Er.usage),vr}throw new Error("Empty response from AI")}catch(mr){hr=mr,aiDebugLog(`AI call attempt ${xr+1} failed:`,mr),console.error(`AI call attempt ${xr+1} failed:`,mr);const fr=hr.message||"";if(fr.includes("Insufficient API credits")||fr.includes("Invalid API key"))throw hr;if(xr<ur-1){const Er=Math.pow(2,xr+1)*1e3;aiDebugLog(`Waiting ${Er}ms before retry...`),await new Promise(vr=>setTimeout(vr,Er))}}throw aiDebugLog("All retries failed, throwing error"),hr||new Error("AI call failed after retries")}async function processDayWithAI(ar,or,lr){const cr=`You are an expert at parsing film/TV production schedules. Extract structured scene data from a single shooting day's schedule text.

The text comes from a PDF extraction and may have table structure lost. Look for patterns:
- Scene numbers (e.g., "Scene 21", "Scene 14", "Scene 61A")
- INT/EXT markers
- Location/set descriptions (e.g., "MARGOT'S BEDROOM - PLUMHILL MANOR")
- Day/Night indicators
- Page counts (e.g., "2 pgs", "1 4/8 pgs", "5/8 pgs")
- Cast numbers (small numbers like 1, 2, 3 that refer to cast members)
- Estimated times (e.g., "3:00", "1:30", ":30")
- Story day markers (e.g., "D5", "N8", "D4")
- Scene descriptions/log lines
- Set moves, lighting changes, load in/out markers
- "End of Shooting Day" summary lines with date and total pages

${lr}

Return ONLY valid JSON with no additional text or markdown.`,ur=`Parse this shooting day text and extract ALL scenes with their details.

SHOOTING DAY TEXT:
---
${ar}
---

Return a JSON object with this structure:
{
  "dayNumber": ${or},
  "date": "YYYY-MM-DD or null if not found",
  "dayOfWeek": "Monday/Tuesday/etc or null",
  "location": "Main location for the day",
  "notes": ["array of notes like 'Set Move :30', 'Lighting Change for Night', 'Load In :30'"],
  "totalPages": "total pages string if found in End of Shooting Day line",
  "scenes": [
    {
      "sceneNumber": "21",
      "pages": "2",
      "intExt": "INT",
      "dayNight": "Day",
      "setLocation": "MARGOT'S BEDROOM - PLUMHILL MANOR",
      "description": "Margot wakes to a call from Calvaux.",
      "castNumbers": [1],
      "estimatedTime": "3:00",
      "storyDay": "D5",
      "remarks": "Calvaux (Phone)"
    }
  ]
}

IMPORTANT:
- Extract EVERY scene entry, including those after "Lighting Change" or "Set Move" markers
- Scene numbers may include letters like "61A", "14pt"
- Pages can be "2", "1 4/8", "2/8", "5/8", "3/8" etc.
- Cast numbers are the small integers (1, 2, 3, 7, etc.) that reference the cast list
- Day/Night is usually "Day", "Night", "Morning" - also look for D/N column
- The description/log line describes what happens in the scene
- estimatedTime is the Est. Time value (e.g., "3:00", "1:30", ":30", "1:00")
- storyDay is the Day marker like "D5", "N8", "D4" from the Day column
- remarks captures any additional notes from the Remarks column
- Include the shootOrder (1-based index within the day)
- Look for the "End of Shooting Day X" line for date and total pages info`,hr=(await callAI(ur,{system:cr,maxTokens:6e3})).match(/\{[\s\S]*\}/);if(!hr)throw new Error(`Failed to parse AI response for day ${or}`);const pr=JSON.parse(hr[0]),xr=(pr.scenes||[]).map((mr,fr)=>{var Er;return{sceneNumber:String(mr.sceneNumber||""),pages:mr.pages||void 0,intExt:((Er=mr.intExt)==null?void 0:Er.toUpperCase())==="EXT"?"EXT":"INT",dayNight:mr.dayNight||mr.storyDay||"Day",setLocation:mr.setLocation||"",description:mr.description||mr.remarks||void 0,castNumbers:Array.isArray(mr.castNumbers)?mr.castNumbers.map(Number).filter(vr=>!isNaN(vr)):[],estimatedTime:mr.estimatedTime||void 0,shootOrder:fr+1}});return{dayNumber:pr.dayNumber||or,date:pr.date||void 0,dayOfWeek:pr.dayOfWeek||void 0,location:pr.location||"",notes:Array.isArray(pr.notes)?pr.notes:void 0,scenes:xr,totalPages:pr.totalPages||void 0}}function extractDayTextBlocks(ar){const or=new Map,lr=/End of Shooting Day\s+(\d+)/gi,cr=[];let ur;for(;(ur=lr.exec(ar))!==null;){const dr=parseInt(ur[1],10),hr=Math.min(ur.index+ur[0].length+200,ar.length);cr.push({dayNum:dr,endPos:hr})}cr.sort((dr,hr)=>dr.endPos-hr.endPos);for(let dr=0;dr<cr.length;dr++){const hr=cr[dr],pr=dr>0?cr[dr-1].endPos:0,xr=ar.slice(pr,hr.endPos);or.set(hr.dayNum,xr)}return or}async function processScheduleStage2(ar,or){const lr=ar.rawText;if(!lr)throw new Error("No raw text available for processing. Please re-upload the schedule.");const cr=ar.castList.length>0?`CAST LIST (number  name):
${ar.castList.map(xr=>`${xr.number}. ${xr.name}`).join(`
`)}

Use these cast numbers when identifying which cast members are in each scene.`:"",ur=extractDayTextBlocks(lr),dr=ar.totalDays||ur.size;if(ur.size===0)return or==null||or({current:1,total:1,message:"Processing schedule..."}),{days:[await processDayWithAI(lr.slice(0,3e4),1,cr)]};const hr=[],pr=Array.from(ur.keys()).sort((xr,mr)=>xr-mr);for(let xr=0;xr<pr.length;xr++){const mr=pr[xr],fr=ur.get(mr);or==null||or({current:xr+1,total:dr,message:`Processing Day ${mr} of ${dr}...`});try{const Er=await processDayWithAI(fr,mr,cr);hr.push(Er)}catch(Er){console.error(`Failed to process day ${mr}:`,Er),hr.push({dayNumber:mr,location:"",scenes:[],notes:[`Processing failed: ${Er instanceof Error?Er.message:"Unknown error"}`]})}}return{days:hr}}function buildSceneMap(ar){const or=new Map;for(const lr of ar.days)for(const cr of lr.scenes){const ur=cr.sceneNumber.replace(/\s+/g,"").toUpperCase();or.set(ur,{day:lr,entry:cr})}return or}function normalizeSceneNumber(ar){return ar.replace(/\s+/g,"").toUpperCase()}function detectCastChanges(ar,or){const lr=new Set(ar.castNumbers),cr=new Set(or.castNumbers),ur=[...cr].filter(hr=>!lr.has(hr)),dr=[...lr].filter(hr=>!cr.has(hr));return ur.length===0&&dr.length===0?null:{added:ur,removed:dr}}function detectTimingChanges(ar,or,lr){return lr?(ar.estimatedTime||"")!==(or.estimatedTime||"")||ar.shootOrder!==or.shootOrder||(ar.pages||"")!==(or.pages||""):!1}function compareScheduleAmendment(ar,or){const lr=buildSceneMap(ar),cr=buildSceneMap(or),ur=[],dr=[],hr=new Set(ar.days.map(Rr=>Rr.dayNumber)),pr=new Set(or.days.map(Rr=>Rr.dayNumber)),xr=new Set;for(const[Rr,{day:Ar,entry:Sr}]of cr){xr.add(Rr);const kr=lr.get(Rr);if(!kr)ur.push({sceneNumber:Sr.sceneNumber,changeType:"scene_added",description:`Scene ${Sr.sceneNumber} added to Day ${Ar.dayNumber}`,newDay:Ar.dayNumber,newEntry:Sr});else{const{day:Nr,entry:Cr}=kr,Tr=Nr.dayNumber===Ar.dayNumber;Tr||ur.push({sceneNumber:Sr.sceneNumber,changeType:"scene_moved",description:`Scene ${Sr.sceneNumber} moved from Day ${Nr.dayNumber} to Day ${Ar.dayNumber}`,oldDay:Nr.dayNumber,newDay:Ar.dayNumber,oldEntry:Cr,newEntry:Sr});const Pr=detectCastChanges(Cr,Sr);if(Pr){const Ir=[];Pr.added.length>0&&Ir.push(`${Pr.added.length} cast added`),Pr.removed.length>0&&Ir.push(`${Pr.removed.length} cast removed`),ur.push({sceneNumber:Sr.sceneNumber,changeType:"cast_changed",description:`Scene ${Sr.sceneNumber}: ${Ir.join(", ")}`,oldDay:Nr.dayNumber,newDay:Ar.dayNumber,oldEntry:Cr,newEntry:Sr,castAdded:Pr.added,castRemoved:Pr.removed})}if(Tr&&detectTimingChanges(Cr,Sr,Tr)){const Ir=[];(Cr.estimatedTime||"")!==(Sr.estimatedTime||"")&&Ir.push(`time: ${Cr.estimatedTime||"none"}  ${Sr.estimatedTime||"none"}`),Cr.shootOrder!==Sr.shootOrder&&Ir.push(`order: ${Cr.shootOrder}  ${Sr.shootOrder}`),(Cr.pages||"")!==(Sr.pages||"")&&Ir.push(`pages: ${Cr.pages||"none"}  ${Sr.pages||"none"}`),ur.push({sceneNumber:Sr.sceneNumber,changeType:"timing_changed",description:`Scene ${Sr.sceneNumber}: ${Ir.join(", ")}`,oldDay:Nr.dayNumber,newDay:Ar.dayNumber,oldEntry:Cr,newEntry:Sr})}}}for(const[Rr,{day:Ar,entry:Sr}]of lr)xr.has(Rr)||ur.push({sceneNumber:Sr.sceneNumber,changeType:"scene_removed",description:`Scene ${Sr.sceneNumber} removed from Day ${Ar.dayNumber}`,oldDay:Ar.dayNumber,oldEntry:Sr});for(const Rr of or.days)if(!hr.has(Rr.dayNumber)){const Ar=ur.filter(Sr=>Sr.newDay===Rr.dayNumber);dr.push({dayNumber:Rr.dayNumber,changeType:"day_added",description:`Day ${Rr.dayNumber} added (${Rr.scenes.length} scene${Rr.scenes.length!==1?"s":""})`,newDay:Rr,sceneChanges:Ar})}for(const Rr of ar.days)if(!pr.has(Rr.dayNumber)){const Ar=ur.filter(Sr=>Sr.oldDay===Rr.dayNumber);dr.push({dayNumber:Rr.dayNumber,changeType:"day_removed",description:`Day ${Rr.dayNumber} removed (${Rr.scenes.length} scene${Rr.scenes.length!==1?"s":""})`,oldDay:Rr,sceneChanges:Ar})}for(const Rr of or.days)if(hr.has(Rr.dayNumber)){const Ar=ur.filter(Sr=>Sr.newDay===Rr.dayNumber||Sr.oldDay===Rr.dayNumber);if(Ar.length>0){const Sr=ar.days.find(kr=>kr.dayNumber===Rr.dayNumber);dr.push({dayNumber:Rr.dayNumber,changeType:"day_modified",description:`Day ${Rr.dayNumber}: ${Ar.length} change${Ar.length!==1?"s":""}`,oldDay:Sr,newDay:Rr,sceneChanges:Ar})}}dr.sort((Rr,Ar)=>Rr.dayNumber-Ar.dayNumber);const mr=ur.filter(Rr=>Rr.changeType==="scene_added"),fr=ur.filter(Rr=>Rr.changeType==="scene_removed"),Er=ur.filter(Rr=>Rr.changeType==="scene_moved"),vr=ur.filter(Rr=>Rr.changeType==="cast_changed"),gr=ur.filter(Rr=>Rr.changeType==="timing_changed"),yr=dr.filter(Rr=>Rr.changeType==="day_added"),jr=dr.filter(Rr=>Rr.changeType==="day_removed"),br=[];mr.length>0&&br.push(`${mr.length} scene${mr.length>1?"s":""} added`),fr.length>0&&br.push(`${fr.length} scene${fr.length>1?"s":""} removed`),Er.length>0&&br.push(`${Er.length} scene${Er.length>1?"s":""} moved`),vr.length>0&&br.push(`${vr.length} cast change${vr.length>1?"s":""}`),gr.length>0&&br.push(`${gr.length} timing change${gr.length>1?"s":""}`),yr.length>0&&br.push(`${yr.length} day${yr.length>1?"s":""} added`),jr.length>0&&br.push(`${jr.length} day${jr.length>1?"s":""} removed`);const _r=br.length>0?br.join(", "):"No changes detected",wr=ur.length>0||dr.length>0;return{dayChanges:dr,allSceneChanges:ur,addedScenes:mr,removedScenes:fr,movedScenes:Er,castChanges:vr,timingChanges:gr,addedDays:yr,removedDays:jr,summary:_r,hasChanges:wr}}function applyScheduleAmendment(ar,or,lr,cr={includeAddedScenes:!0,includeRemovedScenes:!0,includeMovedScenes:!0,includeCastChanges:!0,includeTimingChanges:!0}){const ur=new Map;for(const fr of ar.days)ur.set(fr.dayNumber,{...fr,scenes:[...fr.scenes]});const dr=new Set;if(!cr.includeAddedScenes)for(const fr of lr.addedScenes)dr.add(normalizeSceneNumber(fr.sceneNumber));if(!cr.includeRemovedScenes)for(const fr of lr.removedScenes)dr.add(normalizeSceneNumber(fr.sceneNumber));if(!cr.includeMovedScenes)for(const fr of lr.movedScenes)dr.add(normalizeSceneNumber(fr.sceneNumber));const hr=new Set;if(!cr.includeCastChanges)for(const fr of lr.castChanges)hr.add(normalizeSceneNumber(fr.sceneNumber));const pr=new Set;if(!cr.includeTimingChanges)for(const fr of lr.timingChanges)pr.add(normalizeSceneNumber(fr.sceneNumber));const xr=buildSceneMap(ar),mr=[];for(const fr of or.days){const Er=[];for(const vr of fr.scenes){const gr=normalizeSceneNumber(vr.sceneNumber);if(dr.has(gr)&&lr.addedScenes.some(br=>normalizeSceneNumber(br.sceneNumber)===gr))continue;const yr=xr.get(gr);let jr={...vr};hr.has(gr)&&yr&&(jr.castNumbers=[...yr.entry.castNumbers]),pr.has(gr)&&yr&&(jr.estimatedTime=yr.entry.estimatedTime,jr.shootOrder=yr.entry.shootOrder,jr.pages=yr.entry.pages),Er.push(jr)}if(!cr.includeRemovedScenes){const vr=ar.days.find(gr=>gr.dayNumber===fr.dayNumber);if(vr)for(const gr of vr.scenes){const yr=normalizeSceneNumber(gr.sceneNumber);or.days.some(jr=>jr.scenes.some(br=>normalizeSceneNumber(br.sceneNumber)===yr))||Er.push({...gr})}}mr.push({...fr,scenes:Er})}if(!cr.includeRemovedScenes)for(const fr of ar.days)or.days.some(Er=>Er.dayNumber===fr.dayNumber)||mr.push({...fr,scenes:[...fr.scenes]});return mr.sort((fr,Er)=>fr.dayNumber-Er.dayNumber),{...or,days:mr,status:or.status,castList:mergecastLists(ar.castList,or.castList)}}function mergecastLists(ar,or){const lr=[...or],cr=new Set(or.map(ur=>ur.number));for(const ur of ar)cr.has(ur.number)||lr.push(ur);return lr.sort((ur,dr)=>ur.number-dr.number)}const useScheduleStore=create()(persist((ar,or)=>({schedule:null,savedSchedules:{},isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null,pendingSchedule:null,setSchedule:lr=>{ar({schedule:lr,isUploading:!1,uploadError:null})},uploadScheduleStage1:async lr=>{ar({isUploading:!0,uploadError:null});try{console.log("[ScheduleStore] Starting Stage 1 parsing...");const cr=await parseScheduleStage1(lr);console.log("[ScheduleStore] Stage 1 complete:",{castCount:cr.schedule.castList.length,totalDays:cr.schedule.totalDays,productionName:cr.schedule.productionName});const ur={...cr.schedule,status:"pending"};return ar({schedule:ur,isUploading:!1}),ur}catch(cr){const ur=cr instanceof Error?cr.message:"Failed to parse schedule";throw console.error("[ScheduleStore] Stage 1 failed:",cr),ar({isUploading:!1,uploadError:ur}),cr}},uploadRevisionStage1:async lr=>{ar({isUploading:!0,uploadError:null});try{console.log("[ScheduleStore] Starting revision Stage 1 parsing...");const ur={...(await parseScheduleStage1(lr)).schedule,status:"pending"};return ar({pendingSchedule:ur,isUploading:!1}),ur}catch(cr){const ur=cr instanceof Error?cr.message:"Failed to parse revised schedule";throw console.error("[ScheduleStore] Revision Stage 1 failed:",cr),ar({isUploading:!1,uploadError:ur}),cr}},startRevisionStage2Processing:async()=>{const lr=or();if(!(!lr.pendingSchedule||lr.isProcessingStage2)){ar({isProcessingStage2:!0,stage2Error:null,stage2Progress:{current:0,total:lr.pendingSchedule.totalDays||1}});try{const cr=await processScheduleStage2(lr.pendingSchedule,ur=>{ar({stage2Progress:ur})});ar(ur=>({pendingSchedule:ur.pendingSchedule?{...ur.pendingSchedule,days:cr.days,status:"complete",processingProgress:{current:cr.days.length,total:cr.days.length}}:null,isProcessingStage2:!1,stage2Progress:{current:cr.days.length,total:cr.days.length}})),console.log("[ScheduleStore] Revision Stage 2 complete:",{daysProcessed:cr.days.length,totalScenes:cr.days.reduce((ur,dr)=>ur+dr.scenes.length,0)})}catch(cr){const ur=cr instanceof Error?cr.message:"Failed to process revised schedule";console.error("[ScheduleStore] Revision Stage 2 failed:",cr),ar({isProcessingStage2:!1,stage2Error:ur})}}},compareAmendment:()=>{const lr=or();return!lr.schedule||!lr.pendingSchedule||lr.schedule.days.length===0||lr.pendingSchedule.days.length===0?null:compareScheduleAmendment(lr.schedule,lr.pendingSchedule)},applyAmendment:(lr,cr)=>{const ur=or();if(!ur.schedule||!ur.pendingSchedule)return;const dr=applyScheduleAmendment(ur.schedule,ur.pendingSchedule,lr,cr);ar({schedule:dr,pendingSchedule:null}),console.log("[ScheduleStore] Amendment applied:",{days:dr.days.length,totalScenes:dr.days.reduce((hr,pr)=>hr+pr.scenes.length,0)})},clearPendingSchedule:()=>{ar({pendingSchedule:null})},startStage2Processing:async()=>{const lr=or();if(!(!lr.schedule||lr.isProcessingStage2)){ar({isProcessingStage2:!0,stage2Error:null,stage2Progress:{current:0,total:lr.schedule.totalDays||1}}),ar(cr=>({schedule:cr.schedule?{...cr.schedule,status:"processing"}:null}));try{const cr=await processScheduleStage2(lr.schedule,ur=>{ar({stage2Progress:ur})});ar(ur=>({schedule:ur.schedule?{...ur.schedule,days:cr.days,status:"complete",processingProgress:{current:cr.days.length,total:cr.days.length}}:null,isProcessingStage2:!1,stage2Progress:{current:cr.days.length,total:cr.days.length}})),console.log("[ScheduleStore] Stage 2 complete:",{daysProcessed:cr.days.length,totalScenes:cr.days.reduce((ur,dr)=>ur+dr.scenes.length,0)})}catch(cr){const ur=cr instanceof Error?cr.message:"Failed to process schedule";console.error("[ScheduleStore] Stage 2 failed:",cr),ar({isProcessingStage2:!1,stage2Error:ur,schedule:or().schedule?{...or().schedule,status:"partial",processingError:ur}:null})}}},updateDayData:(lr,cr)=>{ar(ur=>{if(!ur.schedule)return ur;const dr=ur.schedule.days.findIndex(pr=>pr.dayNumber===lr),hr=[...ur.schedule.days];return dr>=0?hr[dr]=cr:(hr.push(cr),hr.sort((pr,xr)=>pr.dayNumber-xr.dayNumber)),{schedule:{...ur.schedule,days:hr}}})},clearSchedule:()=>{ar({schedule:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null})},getCastMemberByNumber:lr=>{const cr=or().schedule;return cr&&cr.castList.find(ur=>ur.number===lr)||null},getCastMemberByName:lr=>{const cr=or().schedule;if(!cr)return null;const ur=lr.toUpperCase().trim();return cr.castList.find(dr=>dr.name.toUpperCase().includes(ur)||dr.character&&dr.character.toUpperCase().includes(ur))||null},getCastNamesForNumbers:lr=>{const cr=or().schedule;return cr?lr.map(ur=>{const dr=cr.castList.find(hr=>hr.number===ur);return dr?dr.character||dr.name:`Cast #${ur}`}):[]},getScenesForShootingDay:lr=>{const cr=or().schedule;return cr&&cr.days.find(ur=>ur.dayNumber===lr)||null},getShootingDayForScene:lr=>{const cr=or().schedule;if(!cr)return null;const ur=lr.replace(/\s+/g,"").toUpperCase();for(const dr of cr.days)for(const hr of dr.scenes)if(hr.sceneNumber.replace(/\s+/g,"").toUpperCase()===ur)return dr.dayNumber;return null},saveScheduleForProject:lr=>{or().schedule&&ar(ur=>({savedSchedules:{...ur.savedSchedules,[lr]:{schedule:ur.schedule}},schedule:null,isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null}))},restoreScheduleForProject:lr=>{const cr=or(),ur=cr.savedSchedules[lr];if(!ur)return!1;const dr={...cr.savedSchedules};return delete dr[lr],ar({schedule:ur.schedule,savedSchedules:dr,isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null}),!0},hasSavedSchedule:lr=>!!or().savedSchedules[lr],clearScheduleForProject:()=>{ar({schedule:null,isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null})}}),{name:"hair-makeup-schedule",storage:createHybridStorage("hair-makeup-schedule"),partialize:ar=>({schedule:ar.schedule,savedSchedules:ar.savedSchedules})})),BETA_MODE=!0,TIER_FEATURES={trainee:{maxProjects:3,maxArchivedProjects:1,maxPhotosPerProject:50,canCreateProjects:!1,offlineMode:!1,exportReports:!1,personalTemplates:!1,teamManagement:!1,characterProgressionTracking:!1,shootingScheduleView:!1,teamPhotoStorage:!1,desktopWebAccess:!1,preProductionBreakdown:!1,characterDesignDocs:!1,exportProductionBooks:!1,budgetSchedulingTools:!1},artist:{maxProjects:10,maxArchivedProjects:-1,maxPhotosPerProject:500,canCreateProjects:!1,offlineMode:!0,exportReports:!0,personalTemplates:!0,teamManagement:!1,characterProgressionTracking:!1,shootingScheduleView:!1,teamPhotoStorage:!1,desktopWebAccess:!1,preProductionBreakdown:!1,characterDesignDocs:!1,exportProductionBooks:!1,budgetSchedulingTools:!1},supervisor:{maxProjects:25,maxArchivedProjects:15,maxPhotosPerProject:1e3,canCreateProjects:!0,offlineMode:!0,exportReports:!0,personalTemplates:!0,teamManagement:!0,characterProgressionTracking:!0,shootingScheduleView:!0,teamPhotoStorage:!1,desktopWebAccess:!1,preProductionBreakdown:!1,characterDesignDocs:!1,exportProductionBooks:!1,budgetSchedulingTools:!1},designer:{maxProjects:-1,maxArchivedProjects:-1,maxPhotosPerProject:-1,canCreateProjects:!0,offlineMode:!0,exportReports:!0,personalTemplates:!0,teamManagement:!0,characterProgressionTracking:!0,shootingScheduleView:!0,teamPhotoStorage:!0,desktopWebAccess:!0,preProductionBreakdown:!0,characterDesignDocs:!0,exportProductionBooks:!0,budgetSchedulingTools:!0}},TIER_PRICING={trainee:{monthly:0,yearly:0,currency:"GBP",currencySymbol:""},artist:{monthly:4.99,yearly:47.9,currency:"GBP",currencySymbol:""},supervisor:{monthly:9.99,yearly:95.9,currency:"GBP",currencySymbol:""},designer:{monthly:29.99,yearly:287.9,perProject:49,currency:"GBP",currencySymbol:""}},SUBSCRIPTION_TIERS=[{id:"trainee",name:"TRAINEE",displayName:"Trainee",description:"Perfect for students and emerging artists",pricing:TIER_PRICING.trainee,features:TIER_FEATURES.trainee,featureList:["Multiple projects simultaneously","50 photos per project","View breakdowns & scenes","Add continuity notes","1 archived project"]},{id:"artist",name:"ARTIST",displayName:"Artist",description:"For working floor artists",pricing:TIER_PRICING.artist,features:TIER_FEATURES.artist,featureList:["Everything in Trainee","500 photos per project","Offline mode with full sync","Export continuity reports (PDF)","Personal templates between projects","Unlimited project archive"],isPopular:!0},{id:"supervisor",name:"SUPERVISOR",displayName:"Supervisor",description:"For supervisors and key artists",pricing:TIER_PRICING.supervisor,features:TIER_FEATURES.supervisor,featureList:["Everything in Artist","1000 photos per project","Create & manage projects","Generate team invite codes","Team management","Character progression tracking","Shooting schedule view"]},{id:"designer",name:"DESIGNER",displayName:"Designer",description:"The complete package for HODs and designers",pricing:TIER_PRICING.designer,features:TIER_FEATURES.designer,featureList:["Everything in Supervisor","Unlimited photo storage","Team photo storage included","Full desktop web access","Pre-production script breakdown","Character design documentation","Export full production books","Budget & scheduling tools"],isPremium:!0}],formatMonthlyEquivalent=(ar,or="")=>{const lr=ar/12;return`${or}${lr.toFixed(2)}`},isTierHigher=(ar,or)=>{const lr=["trainee","artist","supervisor","designer"];return lr.indexOf(ar)>lr.indexOf(or)},getDowngradeWarnings=(ar,or)=>{const lr=TIER_FEATURES[ar],cr=TIER_FEATURES[or],ur=[];if(lr.offlineMode&&!cr.offlineMode&&ur.push("Offline mode with full sync"),lr.exportReports&&!cr.exportReports&&ur.push("Export continuity reports"),lr.personalTemplates&&!cr.personalTemplates&&ur.push("Personal templates"),lr.teamManagement&&!cr.teamManagement&&ur.push("Team management"),lr.canCreateProjects&&!cr.canCreateProjects&&ur.push("Create & manage projects"),lr.characterProgressionTracking&&!cr.characterProgressionTracking&&ur.push("Character progression tracking"),lr.shootingScheduleView&&!cr.shootingScheduleView&&ur.push("Shooting schedule view"),lr.teamPhotoStorage&&!cr.teamPhotoStorage&&ur.push("Team photo storage"),lr.desktopWebAccess&&!cr.desktopWebAccess&&ur.push("Desktop web access"),lr.preProductionBreakdown&&!cr.preProductionBreakdown&&ur.push("Pre-production script breakdown"),lr.characterDesignDocs&&!cr.characterDesignDocs&&ur.push("Character design documentation"),lr.exportProductionBooks&&!cr.exportProductionBooks&&ur.push("Export production books"),lr.budgetSchedulingTools&&!cr.budgetSchedulingTools&&ur.push("Budget & scheduling tools"),lr.maxPhotosPerProject>cr.maxPhotosPerProject){const dr=lr.maxPhotosPerProject===-1?"Unlimited":lr.maxPhotosPerProject,hr=cr.maxPhotosPerProject===-1?"Unlimited":cr.maxPhotosPerProject;ur.push(`Photo limit reduced from ${dr} to ${hr} per project`)}return ur},createDefaultSubscription=()=>({tier:"designer",status:"active",billingPeriod:null}),createEmptyCastProfile=ar=>({id:`cast-${ar}`,characterId:ar,actorName:"",phone:"",email:"",agentName:"",agentPhone:"",agentEmail:"",allergies:"",specialRequirements:"",skinType:"",notes:""}),HAIR_TYPES=["Natural","Wig","Hair Pieces","Extensions"],WIG_TYPES=["Lace Front","Full Lace","Hard Front","U-Part","Closure"],WIG_ATTACHMENTS=["Glue","Tape","Pins","Combs","Clips","Elastic"],HAIRLINE_STYLES=["Natural","Laid","Concealed","Bleached Knots"],SFX_TYPES=["Prosthetics","Wounds","Scars","Tattoos","Aging","Bald Cap","Contact Lenses","Teeth","Body Paint"],BLOOD_TYPES=["Fresh","Dried","Arterial","Mouth Blood","Bruising"],ALL_NAV_ITEMS=[{id:"today",label:"Today",iconName:"calendar"},{id:"breakdown",label:"Breakdown",iconName:"grid"},{id:"lookbook",label:"Lookbook",iconName:"book"},{id:"hours",label:"Hours",iconName:"clock"},{id:"budget",label:"Budget",iconName:"wallet"},{id:"script",label:"Script",iconName:"document"},{id:"schedule",label:"Schedule",iconName:"schedule"},{id:"callsheets",label:"Call Sheets",iconName:"clipboard"},{id:"settings",label:"Settings",iconName:"cog"}],DEFAULT_BOTTOM_NAV=["today","breakdown","hours"],SCENE_FILMING_STATUS_CONFIG={"not-filmed":{label:"Incomplete",shortLabel:"Incomplete",bgClass:"bg-red-100",textClass:"text-red-600",borderClass:"border-red-400",color:"#dc2626",glassOverlay:"rgba(239, 68, 68, 0.15)"},partial:{label:"Part Complete",shortLabel:"Part Complete",bgClass:"bg-amber-100",textClass:"text-amber-600",borderClass:"border-amber-400",color:"#d97706",glassOverlay:"rgba(245, 158, 11, 0.15)"},complete:{label:"Complete",shortLabel:"Complete",bgClass:"bg-green-100",textClass:"text-green-600",borderClass:"border-green-400",color:"#16a34a",glassOverlay:"rgba(34, 197, 94, 0.15)"}},createEmptyMakeupDetails=()=>({foundation:"",coverage:"",concealer:"",concealerPlacement:"",contour:"",contourPlacement:"",highlight:"",highlightPlacement:"",blush:"",blushPlacement:"",browProduct:"",browShape:"",eyePrimer:"",lidColour:"",creaseColour:"",outerV:"",liner:"",lashes:"",lipLiner:"",lipColour:"",setting:""}),createEmptyHairDetails=()=>({style:"",products:"",parting:"",piecesOut:"",pins:"",accessories:"",hairType:"Natural",wigNameId:"",wigType:"",wigCapMethod:"",wigAttachment:[],hairline:"",laceTint:"",edgesBabyHairs:""}),createEmptySFXDetails=()=>({sfxRequired:!1,sfxTypes:[],prostheticPieces:"",prostheticAdhesive:"",bloodTypes:[],bloodProducts:"",bloodPlacement:"",tattooCoverage:"",temporaryTattoos:"",contactLenses:"",teeth:"",agingCharacterNotes:"",sfxApplicationTime:null,sfxReferencePhotos:[]}),createEmptyContinuityFlags=()=>({sweat:!1,dishevelled:!1,blood:!1,dirt:!1,wetHair:!1,tears:!1}),STAGE_SUGGESTIONS=["Fresh","Day 1 Healing","Day 2 Healing","Day 3 Healing","Scabbed","Scarring","Healed","Faded"],CONTINUITY_EVENT_TYPES=["Wound","Bruise","Prosthetic","Scar","Tattoo","Other"],countFilledFields=ar=>Object.entries(ar).filter(([or,lr])=>or==="hairType"||or==="sfxRequired"?!1:Array.isArray(lr)?lr.length>0:typeof lr=="number"?lr>0:lr===null||typeof lr=="boolean"?!1:typeof lr=="string"?lr.trim()!=="":!1).length,countHairFields=ar=>{const or=["style","products","parting","piecesOut","pins","accessories"],lr=["wigNameId","wigType","wigCapMethod","wigAttachment","hairline","laceTint","edgesBabyHairs"];let cr=0;return or.forEach(ur=>{const dr=ar[ur];typeof dr=="string"&&dr.trim()!==""&&cr++}),ar.hairType!=="Natural"&&lr.forEach(ur=>{const dr=ar[ur];(Array.isArray(dr)&&dr.length>0||typeof dr=="string"&&dr.trim()!=="")&&cr++}),cr},countSFXFields=ar=>{if(!ar.sfxRequired)return 0;let or=0;return ar.sfxTypes.length>0&&or++,ar.prostheticPieces.trim()!==""&&or++,ar.prostheticAdhesive.trim()!==""&&or++,ar.bloodTypes.length>0&&or++,ar.bloodProducts.trim()!==""&&or++,ar.bloodPlacement.trim()!==""&&or++,ar.tattooCoverage.trim()!==""&&or++,ar.temporaryTattoos.trim()!==""&&or++,ar.contactLenses.trim()!==""&&or++,ar.teeth.trim()!==""&&or++,ar.agingCharacterNotes.trim()!==""&&or++,ar.sfxApplicationTime!==null&&ar.sfxApplicationTime>0&&or++,ar.sfxReferencePhotos.length>0&&or++,or},DAY_TYPE_LABELS={SWD:"Standard Working Day",CWD:"Continuous Working Day",SCWD:"Semi-Continuous Working Day"};function parseDayTypeFromString(ar){if(!ar)return"SWD";const or=ar.toUpperCase();return or.includes("SEMI-CONTINUOUS")||or.includes("SEMI CONTINUOUS")||or.includes("SCWD")||or.includes("SHORT CONTINUOUS")?"SCWD":or.includes("CONTINUOUS")||or.includes("CWD")?"CWD":"SWD"}const getLunchDurationForDayType=ar=>{switch(ar){case"SWD":return 60;case"SCWD":return 30;case"CWD":return 0;default:return 60}},createDefaultRateCard=()=>({dailyRate:0,baseDayHours:11,baseContract:"11+1",dayType:"SWD",otMultiplier:1.5,lateNightMultiplier:2,preCallMultiplier:1.5,sixthDayMultiplier:1.5,seventhDayMultiplier:2,kitRental:0,lunchDuration:60}),createEmptyTimesheetEntry=ar=>({id:`entry-${ar}`,date:ar,dayType:"SWD",preCall:"",unitCall:"",lunchStart:"",lunchEnd:"",outOfChair:"",wrapOut:"",lunchTaken:60,isSixthDay:!1,isSeventhDay:!1,notes:"",status:"draft"}),CURRENCIES=[{code:"GBP",symbol:"",name:"British Pound",locale:"en-GB"},{code:"USD",symbol:"$",name:"US Dollar",locale:"en-US"},{code:"EUR",symbol:"",name:"Euro",locale:"de-DE"},{code:"CAD",symbol:"C$",name:"Canadian Dollar",locale:"en-CA"},{code:"AUD",symbol:"A$",name:"Australian Dollar",locale:"en-AU"}],DEFAULT_CURRENCY="GBP",getCurrencyByCode=ar=>CURRENCIES.find(or=>or.code===ar)||CURRENCIES[0],formatCurrency=(ar,or=DEFAULT_CURRENCY)=>`${getCurrencyByCode(or).symbol}${ar.toFixed(2)}`,createEmptyBillingDetails=()=>({fullName:"",businessName:"",address:"",phone:"",email:"",bankDetails:{accountName:"",sortCode:"",accountNumber:""},paymentTerms:"Payment within 30 days",vatSettings:{isVATRegistered:!1,vatNumber:"",vatRate:20}}),createEmptyProductionInvoicingDetails=()=>({productionCompany:"",productionAddress:"",productionPhone:"",productionEmail:"",accountsPayableContact:"",accountsPayableEmail:"",accountsPayablePhone:"",poNumber:"",costCode:"",jobReference:"",invoiceAddressDifferent:!1,invoiceAddress:"",invoiceNotes:""}),EXPORT_DOCUMENTS=[{id:"continuity_bible",name:"Continuity Bible",description:"Complete reference document - all characters, all looks, all scenes with photos",format:"pdf",selected:!0},{id:"scene_breakdown",name:"Scene Breakdown",description:"Spreadsheet of all scenes with H&MU details per character",format:"csv",selected:!0},{id:"character_lookbooks",name:"Character Lookbooks",description:"Individual PDFs per character with all their looks",format:"pdf_zip",selected:!0},{id:"photo_archive",name:"Photo Archive",description:"All captured photos organized by character/scene",format:"zip",selected:!0},{id:"timesheets",name:"Timesheets",description:"All logged hours for the production",format:"pdf",selected:!0},{id:"invoice_summary",name:"Invoice Summary",description:"Total hours, rates, kit rental for invoicing",format:"pdf",selected:!1}],PROJECT_RETENTION_DAYS=90,REMINDER_INTERVAL_DAYS=7,INACTIVITY_TRIGGER_DAYS=30,createDefaultLifecycle=()=>({state:"active",lastActivityAt:new Date}),calculateDaysUntilDeletion=ar=>{const or=new Date,lr=new Date(ar);lr.setDate(lr.getDate()+PROJECT_RETENTION_DAYS);const cr=lr.getTime()-or.getTime();return Math.max(0,Math.ceil(cr/(1e3*60*60*24)))},PRODUCTION_TYPES=[{value:"film",label:"Film"},{value:"tv_series",label:"TV Series"},{value:"short_film",label:"Short Film"},{value:"commercial",label:"Commercial"},{value:"music_video",label:"Music Video"},{value:"other",label:"Other"}],PROJECT_CODE_CHARS="ABCDEFGHJKMNPQRSTUVWXYZ23456789",generateProjectCode=()=>{let ar="";for(let or=0;or<3;or++)ar+=PROJECT_CODE_CHARS.charAt(Math.floor(Math.random()*23));ar+="-";for(let or=0;or<4;or++)ar+=PROJECT_CODE_CHARS.charAt(Math.floor(Math.random()*PROJECT_CODE_CHARS.length));return ar},isValidProjectCode=ar=>/^[ABCDEFGHJKMNPQRSTUVWXYZ]{3}-[ABCDEFGHJKMNPQRSTUVWXYZ23456789]{4}$/.test(ar.toUpperCase()),formatProjectCode=ar=>{const or=ar.toUpperCase().replace(/[^ABCDEFGHJKMNPQRSTUVWXYZ23456789]/g,"");return or.length<=3?or:or.slice(0,3)+"-"+or.slice(3,7)},TIER_LIMITS={trainee:{maxProjects:3,maxArchivedProjects:1,canCreateProjects:!1},artist:{maxProjects:10,maxArchivedProjects:-1,canCreateProjects:!1},supervisor:{maxProjects:25,maxArchivedProjects:15,canCreateProjects:!0},designer:{maxProjects:-1,maxArchivedProjects:-1,canCreateProjects:!0}},shouldTriggerWrap=(ar,or)=>{if(or.state!=="active")return{trigger:!1};if(ar.scenes.length>0&&ar.scenes.every(hr=>hr.isComplete))return{trigger:!0,reason:"all_scenes_complete"};const cr=new Date,ur=new Date(or.lastActivityAt);return Math.floor((cr.getTime()-ur.getTime())/(1e3*60*60*24))>=INACTIVITY_TRIGGER_DAYS?{trigger:!0,reason:"inactivity"}:{trigger:!1}},TEAM_MEMBER_ROLES=[{value:"designer",label:"Designer (HoD)",level:8},{value:"supervisor",label:"Supervisor",level:7},{value:"key",label:"Key Artist",level:6},{value:"hair",label:"Hair Artist",level:5},{value:"makeup",label:"Makeup Artist",level:4},{value:"sfx",label:"Special Effects Artist",level:3},{value:"daily",label:"Daily",level:2},{value:"trainee",label:"Trainee",level:1}],getTeamMemberRoleLabel=ar=>{var or;return((or=TEAM_MEMBER_ROLES.find(lr=>lr.value===ar))==null?void 0:or.label)||ar},PERMISSION_LEVELS=[{value:"all",label:"All team members"},{value:"key_plus",label:"Key artists and above"},{value:"supervisor_plus",label:"Supervisors only"}],groupTeamMembersByRole=ar=>{const or=new Map;return TEAM_MEMBER_ROLES.forEach(lr=>{or.set(lr.value,[])}),ar.forEach(lr=>{const cr=or.get(lr.role);cr&&cr.push(lr)}),or.forEach(lr=>{lr.sort((cr,ur)=>cr.name.localeCompare(ur.name))}),TEAM_MEMBER_ROLES.filter(lr=>{var cr;return(((cr=or.get(lr.value))==null?void 0:cr.length)||0)>0}).map(lr=>({role:lr.value,label:lr.label+"s",members:or.get(lr.value)||[]}))},canManageProject=(ar,or)=>{if(!or)return!1;if(or.isOwner)return!0;const lr=["designer","supervisor"];return["supervisor","designer"].includes(ar)&&lr.includes(or.role)},createDefaultProjectPermissions=()=>({addPhotos:"all",editNotes:"all",markComplete:"key_plus"}),formatStorageSize=ar=>{if(ar===0)return"0 B";const or=1024,lr=["B","KB","MB","GB","TB"],cr=Math.floor(Math.log(ar)/Math.log(or));return parseFloat((ar/Math.pow(or,cr)).toFixed(1))+" "+lr[cr]},CHARACTER_COLORS=["#C9A961","#8B5CF6","#EC4899","#10B981","#F59E0B","#EF4444","#3B82F6","#6366F1","#14B8A6","#F97316"];function normalizeNameForMatch(ar){return ar.toUpperCase().replace(/^\d+\.\s*/,"").replace(/[^A-Z\s]/g,"").replace(/\s+/g," ").trim()}function findMatchingCharacter(ar,or){const lr=normalizeNameForMatch(ar);if(!lr)return null;const cr=or.find(dr=>normalizeNameForMatch(dr.name)===lr);return cr||or.find(dr=>{const hr=normalizeNameForMatch(dr.name);return hr.includes(lr)||lr.includes(hr)||hr.split(" ")[0]===lr.split(" ")[0]})||null}function createCharacterFromName(ar,or){const lr=`char-${v4().slice(0,8)}`,cr=ar.replace(/^\d+\.\s*/,"").trim(),ur=cr.split(" ").map(hr=>hr[0]).join("").slice(0,2).toUpperCase(),dr=CHARACTER_COLORS[or%CHARACTER_COLORS.length];return{id:lr,name:cr,initials:ur||"??",avatarColour:dr}}function getTimeOrder(ar){const or=ar.toUpperCase().trim();return or.includes("MORN")||or==="DAWN"||or==="SUNRISE"?0:or.includes("DAY")||or==="D"||or.includes("AFTERNOON")?1:or.includes("EVEN")||or==="DUSK"||or==="SUNSET"?2:or.includes("NIGHT")||or==="N"?3:-1}function isExplicitNewDay(ar){const or=ar.toUpperCase().trim();return!!(/\bNEXT\s+(DAY|MORNING|EVENING|NIGHT|AFTERNOON)\b/.test(or)||/\bFOLLOWING\s+(DAY|MORNING|EVENING|NIGHT|AFTERNOON)\b/.test(or)||/\bNEW\s+DAY\b/.test(or)||/\b\d+\s+(DAYS?|WEEKS?|MONTHS?|YEARS?)\s+LATER\b/.test(or)||/\b(ONE|TWO|THREE|FOUR|FIVE|SIX|SEVEN|SEVERAL|FEW|SOME)\s+(DAYS?|WEEKS?|MONTHS?|YEARS?)\s+LATER\b/.test(or))}function isNewStoryDay(ar,or,lr){return isExplicitNewDay(lr)?!0:ar<0||or<0?!1:ar>=2&&or<=1||ar===1&&or===0}function buildStoryDayMap(ar,or){const lr=new Map,cr=new Map;for(const fr of ar.days)for(const Er of fr.scenes){const vr=Er.sceneNumber.replace(/\s+/g,"").toUpperCase();cr.set(vr,Er.dayNight)}for(const fr of or){const Er=fr.sceneNumber.replace(/\s+/g,"").toUpperCase();cr.has(Er)||cr.set(Er,fr.timeOfDay)}const ur=new Map;for(const fr of or){const Er=fr.sceneNumber.replace(/\s+/g,"").toUpperCase();if(fr.slugline){const vr=fr.slugline.match(/[-]\s*([^-]+)$/);vr&&ur.set(Er,vr[1].trim())}}const dr=/^[DN](\d+)/i;let hr=!1;for(const[fr,Er]of cr){const vr=Er.match(dr);vr&&(hr=!0,lr.set(fr,parseInt(vr[1],10)))}if(hr&&lr.size>0)return console.log("[CastSync] Story days from explicit D1/D2/N1 markers:",lr.size,"scenes mapped"),lr;const pr=Array.from(cr.keys()).sort((fr,Er)=>fr.localeCompare(Er,void 0,{numeric:!0}));let xr=1,mr=-1;for(const fr of pr){const Er=cr.get(fr)||"",vr=ur.get(fr)||"",gr=vr.length>Er.length?vr:Er,yr=getTimeOrder(Er);isNewStoryDay(mr,yr,gr)&&xr++,lr.set(fr,xr),yr>=0&&(mr=yr)}return console.log("[CastSync] Story days inferred from time-of-day transitions:",xr,"days detected"),lr}function createLooksForCharacter(ar,or,lr){const cr=new Map;for(const hr of or){const pr=hr.replace(/\s+/g,"").toUpperCase(),xr=lr.get(pr)||1;cr.has(xr)||cr.set(xr,[]),cr.get(xr).push(hr)}const ur=Array.from(cr.keys()).sort((hr,pr)=>hr-pr),dr=[];for(const hr of ur){const pr=cr.get(hr).sort((xr,mr)=>xr.localeCompare(mr,void 0,{numeric:!0}));dr.push({id:`look-${ar.id}-day${hr}`,characterId:ar.id,name:`Day ${hr}`,scenes:pr,estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()})}return dr.length===0&&dr.push({id:`look-${ar.id}`,characterId:ar.id,name:"Day 1",scenes:[],estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()}),dr}function getCharacterNameFromCastNumber(ar,or){const lr=or.castList.find(cr=>cr.number===ar);return lr?lr.character||lr.name:null}function buildSceneCastMap(ar){const or=new Map;for(const lr of ar.days)for(const cr of lr.scenes){const ur=cr.sceneNumber.replace(/\s+/g,"").toUpperCase();cr.castNumbers&&cr.castNumbers.length>0&&or.set(ur,cr.castNumbers)}return or}function syncCastDataToScenes(ar,or,lr,cr,ur={}){const{createMissingCharacters:dr=!0,overwriteExisting:hr=!1,autoConfirm:pr=!0}=ur,xr={success:!0,scenesUpdated:0,charactersCreated:0,errors:[],sceneResults:[]},mr=buildSceneCastMap(ar),fr=buildStoryDayMap(ar,or);console.log("[CastSync] Scene cast map built:",Object.fromEntries(mr));const Er=[],vr=new Map,gr=or.map(_r=>({..._r})),yr=[...lr];for(const _r of gr){const wr=_r.sceneNumber.replace(/\s+/g,"").toUpperCase(),Rr=mr.get(wr);if(!Rr||Rr.length===0||!hr&&_r.characters.length>0&&_r.characterConfirmationStatus==="confirmed")continue;const Ar=[];for(const Nr of Rr){const Cr=getCharacterNameFromCastNumber(Nr,ar);Cr?Ar.push(Cr):xr.errors.push(`Scene ${_r.sceneNumber}: Cast #${Nr} not found in cast list`)}const Sr=[],kr=[];for(const Nr of Ar){let Cr=findMatchingCharacter(Nr,[...yr,...Er]);!Cr&&dr&&(Cr=createCharacterFromName(Nr,yr.length+Er.length),Er.push(Cr),kr.push(Cr.id),vr.set(Cr.id,[]),xr.charactersCreated++),Cr&&(Sr.push(Cr.id),vr.has(Cr.id)&&vr.get(Cr.id).push(_r.sceneNumber))}Sr.length>0&&(pr?(_r.characters=Sr,_r.characterConfirmationStatus="confirmed",_r.suggestedCharacters=void 0):(_r.suggestedCharacters=Ar,_r.characterConfirmationStatus="ready"),xr.scenesUpdated++),xr.sceneResults.push({sceneNumber:_r.sceneNumber,castNumbers:Rr,characterNames:Ar,matchedCharacterIds:Sr.filter(Nr=>!kr.includes(Nr)),newCharacterIds:kr})}yr.push(...Er);const jr=[];for(const _r of Er){const wr=vr.get(_r.id)||[],Rr=createLooksForCharacter(_r,wr,fr);jr.push(...Rr)}const br=cr.map(_r=>{const wr=[];for(const Rr of gr)Rr.characters.includes(_r.characterId)&&!_r.scenes.includes(Rr.sceneNumber)&&wr.push(Rr.sceneNumber);return wr.length>0?{..._r,scenes:[..._r.scenes,...wr].sort((Rr,Ar)=>Rr.localeCompare(Ar,void 0,{numeric:!0}))}:_r});return br.push(...jr),console.log("[CastSync] Sync complete:",{scenesUpdated:xr.scenesUpdated,charactersCreated:xr.charactersCreated,errors:xr.errors}),{result:xr,updatedScenes:gr,updatedCharacters:yr,updatedLooks:br}}function canSyncCastData(ar){return ar?ar.castList.length===0?{canSync:!1,reason:"Schedule has no cast list"}:ar.status!=="complete"?{canSync:!1,reason:"Schedule processing not complete. Run AI analysis first."}:!ar.days||ar.days.length===0?{canSync:!1,reason:"Schedule has no shooting days. Run AI analysis first."}:ar.days.some(lr=>lr.scenes.some(cr=>cr.castNumbers&&cr.castNumbers.length>0))?{canSync:!0}:{canSync:!1,reason:"No cast data found in schedule scenes"}:{canSync:!1,reason:"No schedule uploaded"}}function calculateTextSimilarity(ar,or){if(!ar&&!or)return 100;if(!ar||!or)return 0;const lr=mr=>mr.toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim(),cr=lr(ar),ur=lr(or);if(cr===ur)return 100;const dr=new Set(cr.split(" ").filter(mr=>mr.length>2)),hr=new Set(ur.split(" ").filter(mr=>mr.length>2));if(dr.size===0&&hr.size===0)return 100;if(dr.size===0||hr.size===0)return 0;const pr=new Set([...dr].filter(mr=>hr.has(mr))),xr=new Set([...dr,...hr]);return Math.round(pr.size/xr.size*100)}function describeChanges(ar,or,lr){return!ar&&or?"New scene added":ar&&!or?"Scene removed from script":lr>=95?"Minor formatting changes":lr>=80?"Minor dialogue or action changes":lr>=50?"Significant content changes":"Major rewrite of scene"}function compareScriptAmendment(ar,or){const lr=[],cr=new Set,ur=new Set,dr=new Map(ar.map(vr=>[vr.sceneNumber,vr]));for(const vr of or){const gr=dr.get(vr.sceneNumber);if(ur.add(vr.sceneNumber),!gr)lr.push({sceneNumber:vr.sceneNumber,status:"new",newScene:vr,changeDescription:"New scene added to script"});else{cr.add(vr.sceneNumber);const yr=calculateTextSimilarity(gr.scriptContent||"",vr.scriptContent||"");yr>=95?lr.push({sceneNumber:vr.sceneNumber,status:"unchanged",existingScene:gr,newScene:vr,changeDescription:"No significant changes",contentSimilarity:yr}):lr.push({sceneNumber:vr.sceneNumber,status:"modified",existingScene:gr,newScene:vr,changeDescription:describeChanges(gr.scriptContent,vr.scriptContent,yr),contentSimilarity:yr})}}for(const vr of ar)cr.has(vr.sceneNumber)||lr.push({sceneNumber:vr.sceneNumber,status:"deleted",existingScene:vr,changeDescription:"Scene removed from script"});lr.sort((vr,gr)=>{const yr=parseFloat(vr.sceneNumber.replace(/[A-Z]/g,".5"))||0,jr=parseFloat(gr.sceneNumber.replace(/[A-Z]/g,".5"))||0;return yr-jr});const hr=lr.filter(vr=>vr.status==="new"),pr=lr.filter(vr=>vr.status==="modified"),xr=lr.filter(vr=>vr.status==="deleted"),mr=lr.filter(vr=>vr.status==="unchanged"),fr=[];hr.length>0&&fr.push(`${hr.length} new scene${hr.length>1?"s":""}`),pr.length>0&&fr.push(`${pr.length} modified scene${pr.length>1?"s":""}`),xr.length>0&&fr.push(`${xr.length} deleted scene${xr.length>1?"s":""}`);const Er=fr.length>0?fr.join(", "):"No changes detected";return{changes:lr,newScenes:hr,modifiedScenes:pr,deletedScenes:xr,unchangedScenes:mr,summary:Er}}function applyAmendmentToScenes(ar,or,lr={includeNew:!0,includeModified:!0,includeDeleted:!1}){const cr=new Date().toISOString(),ur=new Map(ar.map(dr=>[dr.sceneNumber,{...dr}]));for(const dr of or.changes)if(dr.status==="new"&&lr.includeNew&&dr.newScene){const hr={id:`scene-${dr.newScene.sceneNumber}-${Date.now()}`,sceneNumber:dr.newScene.sceneNumber,slugline:dr.newScene.slugline,intExt:dr.newScene.intExt,timeOfDay:dr.newScene.timeOfDay,scriptContent:dr.newScene.scriptContent,characters:[],isComplete:!1,amendmentStatus:"new",amendmentDate:cr,amendmentNotes:"New scene added in script revision"};ur.set(dr.sceneNumber,hr)}else if(dr.status==="modified"&&lr.includeModified&&dr.newScene){const hr=ur.get(dr.sceneNumber);hr&&ur.set(dr.sceneNumber,{...hr,slugline:dr.newScene.slugline,intExt:dr.newScene.intExt,timeOfDay:dr.newScene.timeOfDay,scriptContent:dr.newScene.scriptContent,previousScriptContent:hr.scriptContent,amendmentStatus:"modified",amendmentDate:cr,amendmentNotes:dr.changeDescription})}else if(dr.status==="deleted"&&lr.includeDeleted){const hr=ur.get(dr.sceneNumber);hr&&ur.set(dr.sceneNumber,{...hr,amendmentStatus:"deleted",amendmentDate:cr,amendmentNotes:"Scene removed in script revision"})}else if(dr.status==="unchanged"){const hr=ur.get(dr.sceneNumber);hr&&hr.amendmentStatus&&ur.set(dr.sceneNumber,{...hr,amendmentStatus:"unchanged"})}return Array.from(ur.values()).sort((dr,hr)=>{const pr=parseFloat(dr.sceneNumber.replace(/[A-Z]/g,".5"))||0,xr=parseFloat(hr.sceneNumber.replace(/[A-Z]/g,".5"))||0;return pr-xr})}function clearAmendmentFlags(ar){return ar.map(or=>({...or,amendmentStatus:void 0,previousScriptContent:void 0,amendmentNotes:void 0}))}function getAmendmentCount(ar){const or=ar.filter(ur=>ur.amendmentStatus==="new").length,lr=ar.filter(ur=>ur.amendmentStatus==="modified").length,cr=ar.filter(ur=>ur.amendmentStatus==="deleted").length;return{total:or+lr+cr,new:or,modified:lr,deleted:cr}}const useProjectStore=create()(persist((ar,or)=>({currentProject:null,currentSceneId:null,currentCharacterId:null,currentLookId:null,activeTab:"today",sceneFilter:"all",searchQuery:"",needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null,savedProjects:{},archivedProjects:[],setProject:lr=>ar({currentProject:lr,needsSetup:!1,lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}),setProjectNeedsSetup:lr=>ar({currentProject:lr,needsSetup:!0,lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}),clearNeedsSetup:()=>ar({needsSetup:!1}),setScriptPdf:lr=>ar(cr=>({currentProject:cr.currentProject?{...cr.currentProject,scriptPdfData:lr}:null})),clearProject:()=>ar({currentProject:null,currentSceneId:null,currentCharacterId:null,needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}),saveAndClearProject:()=>{const lr=or();if(lr.currentProject){const cr=lr.currentProject.id,ur=lr.currentProject,dr=lr.sceneCaptures,hr=lr.lifecycle,pr=lr.needsSetup;useScheduleStore.getState().saveScheduleForProject(cr),ar(xr=>({savedProjects:{...xr.savedProjects,[cr]:{project:ur,sceneCaptures:dr,lifecycle:hr,needsSetup:pr}},currentProject:null,currentSceneId:null,currentCharacterId:null,needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}))}else useScheduleStore.getState().clearScheduleForProject(),ar({currentProject:null,currentSceneId:null,currentCharacterId:null,needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null})},restoreSavedProject:lr=>{const cr=or(),ur=cr.savedProjects[lr];if(!ur)return!1;const dr={...cr.savedProjects};return delete dr[lr],useScheduleStore.getState().restoreScheduleForProject(lr),ar({currentProject:ur.project,sceneCaptures:ur.sceneCaptures,lifecycle:ur.lifecycle,needsSetup:ur.needsSetup,savedProjects:dr,currentSceneId:null,currentCharacterId:null,showWrapPopup:!1,wrapTriggerReason:null}),!0},hasSavedProject:lr=>!!or().savedProjects[lr],removeSavedProject:lr=>{const cr={...or().savedProjects};delete cr[lr],ar({savedProjects:cr})},setActiveTab:lr=>ar({activeTab:lr}),setCurrentScene:lr=>ar({currentSceneId:lr}),setCurrentCharacter:lr=>ar({currentCharacterId:lr}),setCurrentLook:lr=>ar({currentLookId:lr}),setSceneFilter:lr=>ar({sceneFilter:lr}),setSearchQuery:lr=>ar({searchQuery:lr}),getOrCreateSceneCapture:(lr,cr)=>{var fr,Er,vr;const ur=or(),dr=`${lr}-${cr}`,hr=ur.sceneCaptures[dr];if(hr)return hr;const pr=(Er=(fr=ur.currentProject)==null?void 0:fr.scenes.find(gr=>gr.id===lr))==null?void 0:Er.sceneNumber,xr=(vr=ur.currentProject)==null?void 0:vr.looks.find(gr=>gr.characterId===cr&&pr!==void 0&&gr.scenes.includes(pr)),mr={id:dr,sceneId:lr,characterId:cr,lookId:(xr==null?void 0:xr.id)??"",capturedAt:new Date,photos:{},additionalPhotos:[],continuityFlags:createEmptyContinuityFlags(),continuityEvents:[],sfxDetails:createEmptySFXDetails(),notes:""};return ar(gr=>({sceneCaptures:{...gr.sceneCaptures,[dr]:mr}})),mr},updateSceneCapture:(lr,cr)=>{ar(ur=>({sceneCaptures:{...ur.sceneCaptures,[lr]:{...ur.sceneCaptures[lr],...cr}}}))},addPhotoToCapture:(lr,cr,ur)=>{ar(dr=>{const hr=dr.sceneCaptures[lr];return hr?ur==="additional"?{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,additionalPhotos:[...hr.additionalPhotos,cr]}}}:{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,photos:{...hr.photos,[ur]:cr}}}}:dr})},removePhotoFromCapture:(lr,cr,ur)=>{ar(dr=>{const hr=dr.sceneCaptures[lr];if(!hr)return dr;if(cr==="additional"&&ur)return{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,additionalPhotos:hr.additionalPhotos.filter(mr=>mr.id!==ur)}}};const pr=cr,xr={...hr.photos};return delete xr[pr],{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,photos:xr}}}})},toggleContinuityFlag:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,continuityFlags:{...dr.continuityFlags,[cr]:!dr.continuityFlags[cr]}}}}:ur})},addContinuityEvent:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,continuityEvents:[...dr.continuityEvents,cr]}}}:ur})},updateContinuityEvent:(lr,cr,ur)=>{ar(dr=>{const hr=dr.sceneCaptures[lr];return hr?{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,continuityEvents:hr.continuityEvents.map(pr=>pr.id===cr?{...pr,...ur}:pr)}}}:dr})},removeContinuityEvent:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,continuityEvents:dr.continuityEvents.filter(hr=>hr.id!==cr)}}}:ur})},updateSFXDetails:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,sfxDetails:cr}}}:ur})},addSFXPhoto:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,sfxDetails:{...dr.sfxDetails,sfxReferencePhotos:[...dr.sfxDetails.sfxReferencePhotos,cr]}}}}:ur})},removeSFXPhoto:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,sfxDetails:{...dr.sfxDetails,sfxReferencePhotos:dr.sfxDetails.sfxReferencePhotos.filter(hr=>hr.id!==cr)}}}}:ur})},addScene:lr=>{const cr={id:`scene-${lr.sceneNumber}-${Date.now()}`,sceneNumber:lr.sceneNumber,slugline:lr.slugline||`Scene ${lr.sceneNumber}`,intExt:lr.intExt||"INT",timeOfDay:lr.timeOfDay||"DAY",synopsis:lr.synopsis,scriptContent:lr.scriptContent,characters:lr.characters||[],isComplete:!1,characterConfirmationStatus:"confirmed",shootingDay:lr.shootingDay};return ar(ur=>{if(!ur.currentProject)return ur;const dr=[...ur.currentProject.scenes,cr].sort((hr,pr)=>{const xr=parseInt(hr.sceneNumber.replace(/\D/g,""))||0,mr=parseInt(pr.sceneNumber.replace(/\D/g,""))||0;return xr!==mr?xr-mr:hr.sceneNumber.localeCompare(pr.sceneNumber)});return{currentProject:{...ur.currentProject,scenes:dr}}}),cr},addCharacterToScene:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,scenes:ur.currentProject.scenes.map(dr=>dr.id===lr&&!dr.characters.includes(cr)?{...dr,characters:[...dr.characters,cr]}:dr)}}:ur)},markSceneComplete:lr=>{ar(cr=>cr.currentProject?{currentProject:{...cr.currentProject,scenes:cr.currentProject.scenes.map(ur=>ur.id===lr?{...ur,isComplete:!0,completedAt:new Date}:ur)}}:cr)},markSceneIncomplete:lr=>{ar(cr=>cr.currentProject?{currentProject:{...cr.currentProject,scenes:cr.currentProject.scenes.map(ur=>ur.id===lr?{...ur,isComplete:!1,completedAt:void 0}:ur)}}:cr)},copyToNextScene:(lr,cr)=>{const ur=or();if(!ur.currentProject)return null;const dr=ur.currentProject.scenes.find(fr=>fr.id===lr);if(!dr)return null;const hr=ur.currentProject.scenes.find(fr=>fr.sceneNumber>dr.sceneNumber&&fr.characters.includes(cr));if(!hr)return null;const pr=ur.sceneCaptures[`${lr}-${cr}`];if(!pr)return hr.id;const xr=`${hr.id}-${cr}`,mr={id:xr,sceneId:hr.id,characterId:cr,lookId:pr.lookId,capturedAt:new Date,photos:{},additionalPhotos:[],continuityFlags:{...pr.continuityFlags},continuityEvents:pr.continuityEvents.map(fr=>({...fr,id:v4()})),sfxDetails:{...pr.sfxDetails,sfxReferencePhotos:[]},notes:pr.notes,applicationTime:pr.applicationTime};return ar(fr=>({sceneCaptures:{...fr.sceneCaptures,[xr]:mr},currentSceneId:hr.id})),hr.id},updateSceneFilmingStatus:(lr,cr,ur)=>{ar(dr=>dr.currentProject?{currentProject:{...dr.currentProject,scenes:dr.currentProject.scenes.map(hr=>hr.sceneNumber===lr?{...hr,filmingStatus:cr,filmingNotes:ur}:hr)}}:dr)},updateSceneSynopsis:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,scenes:ur.currentProject.scenes.map(dr=>dr.id===lr?{...dr,synopsis:cr}:dr)}}:ur)},updateAllSceneSynopses:lr=>{ar(cr=>{if(!cr.currentProject)return cr;const ur=new Map;return lr.forEach(dr=>{dr.synopsis&&ur.set(dr.id,dr.synopsis)}),{currentProject:{...cr.currentProject,scenes:cr.currentProject.scenes.map(dr=>{const hr=ur.get(dr.id);return hr?{...dr,synopsis:hr}:dr})}}})},updateLook:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,looks:ur.currentProject.looks.map(dr=>dr.id===lr?{...dr,...cr}:dr)}}:ur)},updateLookWithPropagation:(lr,cr)=>{const ur=or();if(!ur.currentProject)return;const dr=ur.currentProject.looks.find(xr=>xr.id===lr);if(!dr)return;ar(xr=>xr.currentProject?{currentProject:{...xr.currentProject,looks:xr.currentProject.looks.map(mr=>mr.id===lr?{...mr,...cr}:mr)}}:xr);const hr={...ur.sceneCaptures};let pr=!1;for(const xr of dr.scenes){const mr=ur.currentProject.scenes.find(gr=>gr.sceneNumber===xr);if(!mr)continue;const fr=`${mr.id}-${dr.characterId}`,Er=hr[fr];if(!Er)continue;const vr={};if(cr.continuityFlags){const gr=Er.continuityFlags;!gr.sweat&&!gr.dishevelled&&!gr.blood&&!gr.dirt&&!gr.wetHair&&!gr.tears&&(vr.continuityFlags={...cr.continuityFlags})}cr.notes!==void 0&&!Er.notes&&(vr.notes=cr.notes),cr.sfxDetails&&!Er.sfxDetails.sfxRequired&&Er.sfxDetails.sfxTypes.length===0&&(vr.sfxDetails={...cr.sfxDetails}),Object.keys(vr).length>0&&(hr[fr]={...Er,...vr},pr=!0)}pr&&ar({sceneCaptures:hr})},getCastProfile:lr=>{var ur;const cr=or();if(cr.currentProject)return(ur=cr.currentProject.castProfiles)==null?void 0:ur.find(dr=>dr.characterId===lr)},updateCastProfile:(lr,cr)=>{ar(ur=>{if(!ur.currentProject)return ur;const dr=ur.currentProject.castProfiles||[],hr=dr.findIndex(xr=>xr.characterId===lr);let pr;if(hr>=0)pr=dr.map((xr,mr)=>mr===hr?{...xr,...cr}:xr);else{const xr={...createEmptyCastProfile(lr),...cr};pr=[...dr,xr]}return{currentProject:{...ur.currentProject,castProfiles:pr}}})},startCharacterDetection:()=>{ar(lr=>lr.currentProject?{currentProject:{...lr.currentProject,characterDetectionStatus:"running",scenes:lr.currentProject.scenes.map(cr=>({...cr,characterConfirmationStatus:cr.characterConfirmationStatus==="confirmed"?"confirmed":"detecting"}))}}:lr)},setCharacterDetectionStatus:lr=>{ar(cr=>cr.currentProject?{currentProject:{...cr.currentProject,characterDetectionStatus:lr}}:cr)},updateSceneSuggestedCharacters:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,scenes:ur.currentProject.scenes.map(dr=>dr.id===lr?{...dr,suggestedCharacters:cr,characterConfirmationStatus:dr.characterConfirmationStatus==="confirmed"?"confirmed":"ready"}:dr)}}:ur)},updateSceneConfirmationStatus:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,scenes:ur.currentProject.scenes.map(dr=>dr.id===lr?{...dr,characterConfirmationStatus:cr}:dr)}}:ur)},confirmSceneCharacters:(lr,cr)=>{ar(ur=>{if(!ur.currentProject)return ur;const dr=ur.currentProject.scenes.find(yr=>yr.id===lr),hr=(dr==null?void 0:dr.characters)||[],pr=ur.currentProject.scenes.map(yr=>yr.id===lr?{...yr,characters:cr,characterConfirmationStatus:"confirmed",suggestedCharacters:void 0}:yr),xr=pr.filter(yr=>yr.characterConfirmationStatus==="confirmed").length,mr=pr.find(yr=>yr.id===lr),fr=hr.filter(yr=>!cr.includes(yr)),Er=new Set;for(const yr of ur.currentProject.looks)mr&&yr.scenes.includes(mr.sceneNumber)&&Er.add(yr.characterId);const vr=new Set,gr=ur.currentProject.looks.map(yr=>mr?fr.includes(yr.characterId)&&yr.scenes.includes(mr.sceneNumber)?{...yr,scenes:yr.scenes.filter(jr=>jr!==mr.sceneNumber)}:cr.includes(yr.characterId)&&!Er.has(yr.characterId)&&!vr.has(yr.characterId)?(vr.add(yr.characterId),{...yr,scenes:[...yr.scenes,mr.sceneNumber].sort((jr,br)=>jr.localeCompare(br,void 0,{numeric:!0}))}):yr:yr);return{currentProject:{...ur.currentProject,scenes:pr,looks:gr,scenesConfirmed:xr}}})},addCharacterFromScene:(lr,cr)=>{const ur=or();if(!ur.currentProject)throw new Error("No project loaded");const dr=`char-${v4().slice(0,8)}`,hr=cr.split(" ").map(Er=>Er[0]).join("").slice(0,2),pr=["#C9A961","#8B5CF6","#EC4899","#10B981","#F59E0B","#EF4444","#3B82F6","#6366F1"],xr=pr[ur.currentProject.characters.length%pr.length],mr={id:dr,name:cr,initials:hr,avatarColour:xr},fr=ur.currentProject.scenes.find(Er=>Er.id===lr);return ar(Er=>{if(!Er.currentProject)return Er;const vr={id:`look-${mr.id}`,characterId:mr.id,name:"Day 1",scenes:fr?[fr.sceneNumber]:[],estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()};return{currentProject:{...Er.currentProject,characters:[...Er.currentProject.characters,mr],looks:[...Er.currentProject.looks,vr]}}}),mr},getUnconfirmedScenesCount:()=>{const lr=or();return lr.currentProject?lr.currentProject.scenes.filter(cr=>cr.characterConfirmationStatus!=="confirmed").length:0},getConfirmedScenesCount:()=>{const lr=or();return lr.currentProject?lr.currentProject.scenes.filter(cr=>cr.characterConfirmationStatus==="confirmed").length:0},getScene:lr=>{var cr;return(cr=or().currentProject)==null?void 0:cr.scenes.find(ur=>ur.id===lr)},getCharacter:lr=>{var cr;return(cr=or().currentProject)==null?void 0:cr.characters.find(ur=>ur.id===lr)},getLookForCharacterInScene:(lr,cr)=>{var ur;return(ur=or().currentProject)==null?void 0:ur.looks.find(dr=>dr.characterId===lr&&dr.scenes.includes(cr))},getSceneCapture:(lr,cr)=>or().sceneCaptures[`${lr}-${cr}`],getFilteredScenes:()=>{const lr=or();if(!lr.currentProject)return[];let cr=[...lr.currentProject.scenes];if(lr.sceneFilter==="complete"?cr=cr.filter(ur=>ur.isComplete):lr.sceneFilter==="incomplete"&&(cr=cr.filter(ur=>!ur.isComplete)),lr.searchQuery){const ur=lr.searchQuery.toLowerCase();cr=cr.filter(dr=>dr.sceneNumber.toString().includes(ur)||dr.slugline.toLowerCase().includes(ur))}return cr.sort((ur,dr)=>ur.sceneNumber.localeCompare(dr.sceneNumber,void 0,{numeric:!0}))},getScenesForLook:lr=>{const cr=or();if(!cr.currentProject)return[];const ur=cr.currentProject.looks.find(dr=>dr.id===lr);return ur?cr.currentProject.scenes.filter(dr=>ur.scenes.includes(dr.sceneNumber)).sort((dr,hr)=>dr.sceneNumber.localeCompare(hr.sceneNumber,void 0,{numeric:!0})):[]},syncCastDataFromSchedule:(lr,cr={})=>{const ur=or();if(!ur.currentProject)return null;const{canSync:dr,reason:hr}=canSyncCastData(lr);if(!dr)return console.error("[ProjectStore] Cannot sync cast data:",hr),null;const{result:pr,updatedScenes:xr,updatedCharacters:mr,updatedLooks:fr}=syncCastDataToScenes(lr,ur.currentProject.scenes,ur.currentProject.characters,ur.currentProject.looks,cr);return(pr.scenesUpdated>0||pr.charactersCreated>0)&&(ar(Er=>{if(!Er.currentProject)return{};const gr=(Er.currentProject.castProfiles||[]).map(yr=>{const jr=yr.characterId.match(/^cast-(\d+)$/);if(!jr)return yr;const br=parseInt(jr[1],10),_r=lr.castList.find(Ar=>Ar.number===br);if(!_r)return yr;const wr=(_r.character||_r.name).replace(/^\d+\.\s*/,"").trim().toUpperCase(),Rr=mr.find(Ar=>Ar.name.trim().toUpperCase()===wr);return Rr?(console.log(`[ProjectStore] Migrating cast profile from placeholder ${yr.characterId} to ${Rr.id} (${Rr.name})`),{...yr,characterId:Rr.id,id:`cast-${Rr.id}`}):yr});return{currentProject:{...Er.currentProject,scenes:xr,characters:mr,looks:fr,castProfiles:gr}}}),console.log("[ProjectStore] Cast sync complete:",{scenesUpdated:pr.scenesUpdated,charactersCreated:pr.charactersCreated})),pr},canSyncCastData:lr=>canSyncCastData(lr),compareScriptAmendment:lr=>{const{currentProject:cr}=or();return cr!=null&&cr.scenes?compareScriptAmendment(cr.scenes,lr):null},applyScriptAmendment:(lr,cr={includeNew:!0,includeModified:!0,includeDeleted:!1})=>{const{currentProject:ur}=or();if(!ur)return;const dr=applyAmendmentToScenes(ur.scenes,lr,cr);ar({currentProject:{...ur,scenes:dr,updatedAt:new Date}})},clearSceneAmendmentFlags:()=>{const{currentProject:lr}=or();if(!lr)return;const cr=clearAmendmentFlags(lr.scenes);ar({currentProject:{...lr,scenes:cr}})},clearSingleSceneAmendment:lr=>{const{currentProject:cr}=or();if(!cr)return;const ur=cr.scenes.map(dr=>dr.id===lr?{...dr,amendmentStatus:void 0,amendmentNotes:void 0,previousScriptContent:void 0}:dr);ar({currentProject:{...cr,scenes:ur}})},getAmendmentCounts:()=>{const{currentProject:lr}=or();return lr!=null&&lr.scenes?getAmendmentCount(lr.scenes):{total:0,new:0,modified:0,deleted:0}},updateActivity:()=>{ar(lr=>({lifecycle:{...lr.lifecycle,lastActivityAt:new Date}}))},checkWrapTrigger:()=>{const lr=or();if(!lr.currentProject)return;if(lr.lifecycle.nextReminderAt&&new Date>=new Date(lr.lifecycle.nextReminderAt)){ar({showWrapPopup:!0,wrapTriggerReason:lr.lifecycle.wrapReason||"manual"});return}const cr=shouldTriggerWrap(lr.currentProject,lr.lifecycle);cr.trigger&&cr.reason&&ar({showWrapPopup:!0,wrapTriggerReason:cr.reason})},wrapProject:lr=>{const cr=new Date,ur=new Date(cr);ur.setDate(ur.getDate()+PROJECT_RETENTION_DAYS),ar(dr=>({lifecycle:{...dr.lifecycle,state:"wrapped",wrappedAt:cr,wrapReason:lr,deletionDate:ur},showWrapPopup:!1,wrapTriggerReason:null}))},dismissWrapPopup:lr=>{if(lr){const cr=new Date;cr.setDate(cr.getDate()+REMINDER_INTERVAL_DAYS),ar(ur=>({showWrapPopup:!1,lifecycle:{...ur.lifecycle,reminderDismissedAt:new Date,nextReminderAt:cr}}))}else ar({showWrapPopup:!1})},restoreProject:()=>{ar(lr=>({lifecycle:{...lr.lifecycle,state:"active",wrappedAt:void 0,deletionDate:void 0,archiveDate:void 0,reminderDismissedAt:void 0,nextReminderAt:void 0,lastActivityAt:new Date}}))},archiveProject:()=>{const lr=or();if(!lr.currentProject)return;const cr=new Date,ur={project:lr.currentProject,lifecycle:{...lr.lifecycle,state:"archived",archiveDate:cr},sceneCaptures:lr.sceneCaptures};ar(dr=>({archivedProjects:[...dr.archivedProjects,ur],currentProject:null,sceneCaptures:{},lifecycle:createDefaultLifecycle()}))},permanentlyDeleteProject:()=>{ar({currentProject:null,sceneCaptures:{},lifecycle:createDefaultLifecycle()})},getArchivedProjects:()=>or().archivedProjects.map(cr=>{const ur=Object.values(cr.sceneCaptures).reduce((dr,hr)=>{let pr=0;return hr.photos.front&&pr++,hr.photos.left&&pr++,hr.photos.right&&pr++,hr.photos.back&&pr++,pr+=hr.additionalPhotos.length,dr+pr},0);return{id:cr.project.id,name:cr.project.name,state:cr.lifecycle.state,wrappedAt:cr.lifecycle.wrappedAt,daysUntilDeletion:cr.lifecycle.wrappedAt?calculateDaysUntilDeletion(new Date(cr.lifecycle.wrappedAt)):0,scenesCount:cr.project.scenes.length,charactersCount:cr.project.characters.length,photosCount:ur}}),loadArchivedProject:lr=>{const cr=or(),ur=cr.archivedProjects.findIndex(pr=>pr.project.id===lr);if(ur===-1)return;const dr=cr.archivedProjects[ur],hr=[...cr.archivedProjects];hr.splice(ur,1),ar({currentProject:dr.project,sceneCaptures:dr.sceneCaptures,lifecycle:dr.lifecycle,archivedProjects:hr})},getDaysUntilDeletion:()=>{const lr=or();return lr.lifecycle.state==="active"||!lr.lifecycle.wrappedAt?-1:calculateDaysUntilDeletion(new Date(lr.lifecycle.wrappedAt))},getLifecycleBanner:()=>{const lr=or();if(lr.lifecycle.state==="active")return null;const cr=lr.lifecycle.wrappedAt?calculateDaysUntilDeletion(new Date(lr.lifecycle.wrappedAt)):0;return lr.lifecycle.state==="wrapped"?{show:!0,message:`Project wrapped. ${cr} days until archive.`,daysRemaining:cr}:lr.lifecycle.state==="archived"?{show:!0,message:"Archived. Export to restore.",daysRemaining:cr}:null}}),{name:"hair-makeup-pro-storage",storage:createHybridStorage("hair-makeup-pro-storage"),partialize:ar=>({currentProject:ar.currentProject,sceneCaptures:ar.sceneCaptures,lifecycle:ar.lifecycle,savedProjects:ar.savedProjects,archivedProjects:ar.archivedProjects,needsSetup:ar.needsSetup})}));function __rest(ar,or){var lr={};for(var cr in ar)Object.prototype.hasOwnProperty.call(ar,cr)&&or.indexOf(cr)<0&&(lr[cr]=ar[cr]);if(ar!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ur=0,cr=Object.getOwnPropertySymbols(ar);ur<cr.length;ur++)or.indexOf(cr[ur])<0&&Object.prototype.propertyIsEnumerable.call(ar,cr[ur])&&(lr[cr[ur]]=ar[cr[ur]]);return lr}function __awaiter(ar,or,lr,cr){function ur(dr){return dr instanceof lr?dr:new lr(function(hr){hr(dr)})}return new(lr||(lr=Promise))(function(dr,hr){function pr(fr){try{mr(cr.next(fr))}catch(Er){hr(Er)}}function xr(fr){try{mr(cr.throw(fr))}catch(Er){hr(Er)}}function mr(fr){fr.done?dr(fr.value):ur(fr.value).then(pr,xr)}mr((cr=cr.apply(ar,or||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;const resolveFetch$3=ar=>ar?(...or)=>ar(...or):(...or)=>fetch(...or);class FunctionsError extends Error{constructor(or,lr="FunctionsError",cr){super(or),this.name=lr,this.context=cr}}class FunctionsFetchError extends FunctionsError{constructor(or){super("Failed to send a request to the Edge Function","FunctionsFetchError",or)}}class FunctionsRelayError extends FunctionsError{constructor(or){super("Relay Error invoking the Edge Function","FunctionsRelayError",or)}}class FunctionsHttpError extends FunctionsError{constructor(or){super("Edge Function returned a non-2xx status code","FunctionsHttpError",or)}}var FunctionRegion;(function(ar){ar.Any="any",ar.ApNortheast1="ap-northeast-1",ar.ApNortheast2="ap-northeast-2",ar.ApSouth1="ap-south-1",ar.ApSoutheast1="ap-southeast-1",ar.ApSoutheast2="ap-southeast-2",ar.CaCentral1="ca-central-1",ar.EuCentral1="eu-central-1",ar.EuWest1="eu-west-1",ar.EuWest2="eu-west-2",ar.EuWest3="eu-west-3",ar.SaEast1="sa-east-1",ar.UsEast1="us-east-1",ar.UsWest1="us-west-1",ar.UsWest2="us-west-2"})(FunctionRegion||(FunctionRegion={}));class FunctionsClient{constructor(or,{headers:lr={},customFetch:cr,region:ur=FunctionRegion.Any}={}){this.url=or,this.headers=lr,this.region=ur,this.fetch=resolveFetch$3(cr)}setAuth(or){this.headers.Authorization=`Bearer ${or}`}invoke(or){return __awaiter(this,arguments,void 0,function*(lr,cr={}){var ur;let dr,hr;try{const{headers:pr,method:xr,body:mr,signal:fr,timeout:Er}=cr;let vr={},{region:gr}=cr;gr||(gr=this.region);const yr=new URL(`${this.url}/${lr}`);gr&&gr!=="any"&&(vr["x-region"]=gr,yr.searchParams.set("forceFunctionRegion",gr));let jr;mr&&(pr&&!Object.prototype.hasOwnProperty.call(pr,"Content-Type")||!pr)?typeof Blob<"u"&&mr instanceof Blob||mr instanceof ArrayBuffer?(vr["Content-Type"]="application/octet-stream",jr=mr):typeof mr=="string"?(vr["Content-Type"]="text/plain",jr=mr):typeof FormData<"u"&&mr instanceof FormData?jr=mr:(vr["Content-Type"]="application/json",jr=JSON.stringify(mr)):mr&&typeof mr!="string"&&!(typeof Blob<"u"&&mr instanceof Blob)&&!(mr instanceof ArrayBuffer)&&!(typeof FormData<"u"&&mr instanceof FormData)?jr=JSON.stringify(mr):jr=mr;let br=fr;Er&&(hr=new AbortController,dr=setTimeout(()=>hr.abort(),Er),fr?(br=hr.signal,fr.addEventListener("abort",()=>hr.abort())):br=hr.signal);const _r=yield this.fetch(yr.toString(),{method:xr||"POST",headers:Object.assign(Object.assign(Object.assign({},vr),this.headers),pr),body:jr,signal:br}).catch(Sr=>{throw new FunctionsFetchError(Sr)}),wr=_r.headers.get("x-relay-error");if(wr&&wr==="true")throw new FunctionsRelayError(_r);if(!_r.ok)throw new FunctionsHttpError(_r);let Rr=((ur=_r.headers.get("Content-Type"))!==null&&ur!==void 0?ur:"text/plain").split(";")[0].trim(),Ar;return Rr==="application/json"?Ar=yield _r.json():Rr==="application/octet-stream"||Rr==="application/pdf"?Ar=yield _r.blob():Rr==="text/event-stream"?Ar=_r:Rr==="multipart/form-data"?Ar=yield _r.formData():Ar=yield _r.text(),{data:Ar,error:null,response:_r}}catch(pr){return{data:null,error:pr,response:pr instanceof FunctionsHttpError||pr instanceof FunctionsRelayError?pr.context:void 0}}finally{dr&&clearTimeout(dr)}})}}var PostgrestError=class extends Error{constructor(ar){super(ar.message),this.name="PostgrestError",this.details=ar.details,this.hint=ar.hint,this.code=ar.code}},PostgrestBuilder=class{constructor(ar){var or,lr;this.shouldThrowOnError=!1,this.method=ar.method,this.url=ar.url,this.headers=new Headers(ar.headers),this.schema=ar.schema,this.body=ar.body,this.shouldThrowOnError=(or=ar.shouldThrowOnError)!==null&&or!==void 0?or:!1,this.signal=ar.signal,this.isMaybeSingle=(lr=ar.isMaybeSingle)!==null&&lr!==void 0?lr:!1,ar.fetch?this.fetch=ar.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(ar,or){return this.headers=new Headers(this.headers),this.headers.set(ar,or),this}then(ar,or){var lr=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const cr=this.fetch;let ur=cr(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async dr=>{let hr=null,pr=null,xr=null,mr=dr.status,fr=dr.statusText;if(dr.ok){var Er,vr;if(lr.method!=="HEAD"){var gr;const _r=await dr.text();_r===""||(lr.headers.get("Accept")==="text/csv"||lr.headers.get("Accept")&&(!((gr=lr.headers.get("Accept"))===null||gr===void 0)&&gr.includes("application/vnd.pgrst.plan+text"))?pr=_r:pr=JSON.parse(_r))}const jr=(Er=lr.headers.get("Prefer"))===null||Er===void 0?void 0:Er.match(/count=(exact|planned|estimated)/),br=(vr=dr.headers.get("content-range"))===null||vr===void 0?void 0:vr.split("/");jr&&br&&br.length>1&&(xr=parseInt(br[1])),lr.isMaybeSingle&&lr.method==="GET"&&Array.isArray(pr)&&(pr.length>1?(hr={code:"PGRST116",details:`Results contain ${pr.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},pr=null,xr=null,mr=406,fr="Not Acceptable"):pr.length===1?pr=pr[0]:pr=null)}else{var yr;const jr=await dr.text();try{hr=JSON.parse(jr),Array.isArray(hr)&&dr.status===404&&(pr=[],hr=null,mr=200,fr="OK")}catch{dr.status===404&&jr===""?(mr=204,fr="No Content"):hr={message:jr}}if(hr&&lr.isMaybeSingle&&(!(hr==null||(yr=hr.details)===null||yr===void 0)&&yr.includes("0 rows"))&&(hr=null,mr=200,fr="OK"),hr&&lr.shouldThrowOnError)throw new PostgrestError(hr)}return{error:hr,data:pr,count:xr,status:mr,statusText:fr}});return this.shouldThrowOnError||(ur=ur.catch(dr=>{var hr;let pr="";const xr=dr==null?void 0:dr.cause;if(xr){var mr,fr,Er,vr;const yr=(mr=xr==null?void 0:xr.message)!==null&&mr!==void 0?mr:"",jr=(fr=xr==null?void 0:xr.code)!==null&&fr!==void 0?fr:"";pr=`${(Er=dr==null?void 0:dr.name)!==null&&Er!==void 0?Er:"FetchError"}: ${dr==null?void 0:dr.message}`,pr+=`

Caused by: ${(vr=xr==null?void 0:xr.name)!==null&&vr!==void 0?vr:"Error"}: ${yr}`,jr&&(pr+=` (${jr})`),xr!=null&&xr.stack&&(pr+=`
${xr.stack}`)}else{var gr;pr=(gr=dr==null?void 0:dr.stack)!==null&&gr!==void 0?gr:""}return{error:{message:`${(hr=dr==null?void 0:dr.name)!==null&&hr!==void 0?hr:"FetchError"}: ${dr==null?void 0:dr.message}`,details:pr,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),ur.then(ar,or)}returns(){return this}overrideTypes(){return this}},PostgrestTransformBuilder=class extends PostgrestBuilder{select(ar){let or=!1;const lr=(ar??"*").split("").map(cr=>/\s/.test(cr)&&!or?"":(cr==='"'&&(or=!or),cr)).join("");return this.url.searchParams.set("select",lr),this.headers.append("Prefer","return=representation"),this}order(ar,{ascending:or=!0,nullsFirst:lr,foreignTable:cr,referencedTable:ur=cr}={}){const dr=ur?`${ur}.order`:"order",hr=this.url.searchParams.get(dr);return this.url.searchParams.set(dr,`${hr?`${hr},`:""}${ar}.${or?"asc":"desc"}${lr===void 0?"":lr?".nullsfirst":".nullslast"}`),this}limit(ar,{foreignTable:or,referencedTable:lr=or}={}){const cr=typeof lr>"u"?"limit":`${lr}.limit`;return this.url.searchParams.set(cr,`${ar}`),this}range(ar,or,{foreignTable:lr,referencedTable:cr=lr}={}){const ur=typeof cr>"u"?"offset":`${cr}.offset`,dr=typeof cr>"u"?"limit":`${cr}.limit`;return this.url.searchParams.set(ur,`${ar}`),this.url.searchParams.set(dr,`${or-ar+1}`),this}abortSignal(ar){return this.signal=ar,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:ar=!1,verbose:or=!1,settings:lr=!1,buffers:cr=!1,wal:ur=!1,format:dr="text"}={}){var hr;const pr=[ar?"analyze":null,or?"verbose":null,lr?"settings":null,cr?"buffers":null,ur?"wal":null].filter(Boolean).join("|"),xr=(hr=this.headers.get("Accept"))!==null&&hr!==void 0?hr:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${dr}; for="${xr}"; options=${pr};`),dr==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(ar){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${ar}`),this}};const PostgrestReservedCharsRegexp=new RegExp("[,()]");var PostgrestFilterBuilder=class extends PostgrestTransformBuilder{eq(ar,or){return this.url.searchParams.append(ar,`eq.${or}`),this}neq(ar,or){return this.url.searchParams.append(ar,`neq.${or}`),this}gt(ar,or){return this.url.searchParams.append(ar,`gt.${or}`),this}gte(ar,or){return this.url.searchParams.append(ar,`gte.${or}`),this}lt(ar,or){return this.url.searchParams.append(ar,`lt.${or}`),this}lte(ar,or){return this.url.searchParams.append(ar,`lte.${or}`),this}like(ar,or){return this.url.searchParams.append(ar,`like.${or}`),this}likeAllOf(ar,or){return this.url.searchParams.append(ar,`like(all).{${or.join(",")}}`),this}likeAnyOf(ar,or){return this.url.searchParams.append(ar,`like(any).{${or.join(",")}}`),this}ilike(ar,or){return this.url.searchParams.append(ar,`ilike.${or}`),this}ilikeAllOf(ar,or){return this.url.searchParams.append(ar,`ilike(all).{${or.join(",")}}`),this}ilikeAnyOf(ar,or){return this.url.searchParams.append(ar,`ilike(any).{${or.join(",")}}`),this}regexMatch(ar,or){return this.url.searchParams.append(ar,`match.${or}`),this}regexIMatch(ar,or){return this.url.searchParams.append(ar,`imatch.${or}`),this}is(ar,or){return this.url.searchParams.append(ar,`is.${or}`),this}isDistinct(ar,or){return this.url.searchParams.append(ar,`isdistinct.${or}`),this}in(ar,or){const lr=Array.from(new Set(or)).map(cr=>typeof cr=="string"&&PostgrestReservedCharsRegexp.test(cr)?`"${cr}"`:`${cr}`).join(",");return this.url.searchParams.append(ar,`in.(${lr})`),this}notIn(ar,or){const lr=Array.from(new Set(or)).map(cr=>typeof cr=="string"&&PostgrestReservedCharsRegexp.test(cr)?`"${cr}"`:`${cr}`).join(",");return this.url.searchParams.append(ar,`not.in.(${lr})`),this}contains(ar,or){return typeof or=="string"?this.url.searchParams.append(ar,`cs.${or}`):Array.isArray(or)?this.url.searchParams.append(ar,`cs.{${or.join(",")}}`):this.url.searchParams.append(ar,`cs.${JSON.stringify(or)}`),this}containedBy(ar,or){return typeof or=="string"?this.url.searchParams.append(ar,`cd.${or}`):Array.isArray(or)?this.url.searchParams.append(ar,`cd.{${or.join(",")}}`):this.url.searchParams.append(ar,`cd.${JSON.stringify(or)}`),this}rangeGt(ar,or){return this.url.searchParams.append(ar,`sr.${or}`),this}rangeGte(ar,or){return this.url.searchParams.append(ar,`nxl.${or}`),this}rangeLt(ar,or){return this.url.searchParams.append(ar,`sl.${or}`),this}rangeLte(ar,or){return this.url.searchParams.append(ar,`nxr.${or}`),this}rangeAdjacent(ar,or){return this.url.searchParams.append(ar,`adj.${or}`),this}overlaps(ar,or){return typeof or=="string"?this.url.searchParams.append(ar,`ov.${or}`):this.url.searchParams.append(ar,`ov.{${or.join(",")}}`),this}textSearch(ar,or,{config:lr,type:cr}={}){let ur="";cr==="plain"?ur="pl":cr==="phrase"?ur="ph":cr==="websearch"&&(ur="w");const dr=lr===void 0?"":`(${lr})`;return this.url.searchParams.append(ar,`${ur}fts${dr}.${or}`),this}match(ar){return Object.entries(ar).forEach(([or,lr])=>{this.url.searchParams.append(or,`eq.${lr}`)}),this}not(ar,or,lr){return this.url.searchParams.append(ar,`not.${or}.${lr}`),this}or(ar,{foreignTable:or,referencedTable:lr=or}={}){const cr=lr?`${lr}.or`:"or";return this.url.searchParams.append(cr,`(${ar})`),this}filter(ar,or,lr){return this.url.searchParams.append(ar,`${or}.${lr}`),this}},PostgrestQueryBuilder=class{constructor(ar,{headers:or={},schema:lr,fetch:cr}){this.url=ar,this.headers=new Headers(or),this.schema=lr,this.fetch=cr}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(ar,or){const{head:lr=!1,count:cr}=or??{},ur=lr?"HEAD":"GET";let dr=!1;const hr=(ar??"*").split("").map(mr=>/\s/.test(mr)&&!dr?"":(mr==='"'&&(dr=!dr),mr)).join(""),{url:pr,headers:xr}=this.cloneRequestState();return pr.searchParams.set("select",hr),cr&&xr.append("Prefer",`count=${cr}`),new PostgrestFilterBuilder({method:ur,url:pr,headers:xr,schema:this.schema,fetch:this.fetch})}insert(ar,{count:or,defaultToNull:lr=!0}={}){var cr;const ur="POST",{url:dr,headers:hr}=this.cloneRequestState();if(or&&hr.append("Prefer",`count=${or}`),lr||hr.append("Prefer","missing=default"),Array.isArray(ar)){const pr=ar.reduce((xr,mr)=>xr.concat(Object.keys(mr)),[]);if(pr.length>0){const xr=[...new Set(pr)].map(mr=>`"${mr}"`);dr.searchParams.set("columns",xr.join(","))}}return new PostgrestFilterBuilder({method:ur,url:dr,headers:hr,schema:this.schema,body:ar,fetch:(cr=this.fetch)!==null&&cr!==void 0?cr:fetch})}upsert(ar,{onConflict:or,ignoreDuplicates:lr=!1,count:cr,defaultToNull:ur=!0}={}){var dr;const hr="POST",{url:pr,headers:xr}=this.cloneRequestState();if(xr.append("Prefer",`resolution=${lr?"ignore":"merge"}-duplicates`),or!==void 0&&pr.searchParams.set("on_conflict",or),cr&&xr.append("Prefer",`count=${cr}`),ur||xr.append("Prefer","missing=default"),Array.isArray(ar)){const mr=ar.reduce((fr,Er)=>fr.concat(Object.keys(Er)),[]);if(mr.length>0){const fr=[...new Set(mr)].map(Er=>`"${Er}"`);pr.searchParams.set("columns",fr.join(","))}}return new PostgrestFilterBuilder({method:hr,url:pr,headers:xr,schema:this.schema,body:ar,fetch:(dr=this.fetch)!==null&&dr!==void 0?dr:fetch})}update(ar,{count:or}={}){var lr;const cr="PATCH",{url:ur,headers:dr}=this.cloneRequestState();return or&&dr.append("Prefer",`count=${or}`),new PostgrestFilterBuilder({method:cr,url:ur,headers:dr,schema:this.schema,body:ar,fetch:(lr=this.fetch)!==null&&lr!==void 0?lr:fetch})}delete({count:ar}={}){var or;const lr="DELETE",{url:cr,headers:ur}=this.cloneRequestState();return ar&&ur.append("Prefer",`count=${ar}`),new PostgrestFilterBuilder({method:lr,url:cr,headers:ur,schema:this.schema,fetch:(or=this.fetch)!==null&&or!==void 0?or:fetch})}},PostgrestClient=class ku{constructor(or,{headers:lr={},schema:cr,fetch:ur}={}){this.url=or,this.headers=new Headers(lr),this.schemaName=cr,this.fetch=ur}from(or){if(!or||typeof or!="string"||or.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new PostgrestQueryBuilder(new URL(`${this.url}/${or}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(or){return new ku(this.url,{headers:this.headers,schema:or,fetch:this.fetch})}rpc(or,lr={},{head:cr=!1,get:ur=!1,count:dr}={}){var hr;let pr;const xr=new URL(`${this.url}/rpc/${or}`);let mr;const fr=gr=>gr!==null&&typeof gr=="object"&&(!Array.isArray(gr)||gr.some(fr)),Er=cr&&Object.values(lr).some(fr);Er?(pr="POST",mr=lr):cr||ur?(pr=cr?"HEAD":"GET",Object.entries(lr).filter(([gr,yr])=>yr!==void 0).map(([gr,yr])=>[gr,Array.isArray(yr)?`{${yr.join(",")}}`:`${yr}`]).forEach(([gr,yr])=>{xr.searchParams.append(gr,yr)})):(pr="POST",mr=lr);const vr=new Headers(this.headers);return Er?vr.set("Prefer",dr?`count=${dr},return=minimal`:"return=minimal"):dr&&vr.set("Prefer",`count=${dr}`),new PostgrestFilterBuilder({method:pr,url:xr,headers:vr,schema:this.schemaName,body:mr,fetch:(hr=this.fetch)!==null&&hr!==void 0?hr:fetch})}};class WebSocketFactory{constructor(){}static detectEnvironment(){var or;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((or=navigator.userAgent)===null||or===void 0)&&or.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const lr=globalThis.process;if(lr){const cr=lr.versions;if(cr&&cr.node){const ur=cr.node,dr=parseInt(ur.replace(/^v/,"").split(".")[0]);return dr>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${dr} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${dr} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const or=this.detectEnvironment();if(or.constructor)return or.constructor;let lr=or.error||"WebSocket not supported in this environment.";throw or.workaround&&(lr+=`

Suggested solution: ${or.workaround}`),new Error(lr)}static createWebSocket(or,lr){const cr=this.getWebSocketConstructor();return new cr(or,lr)}static isWebSocketSupported(){try{const or=this.detectEnvironment();return or.type==="native"||or.type==="ws"}catch{return!1}}}const version$3="2.93.1",DEFAULT_VERSION=`realtime-js/${version$3}`,VSN_1_0_0="1.0.0",VSN_2_0_0="2.0.0",DEFAULT_VSN=VSN_2_0_0,DEFAULT_TIMEOUT=1e4,WS_CLOSE_NORMAL=1e3,MAX_PUSH_BUFFER_SIZE=100;var SOCKET_STATES;(function(ar){ar[ar.connecting=0]="connecting",ar[ar.open=1]="open",ar[ar.closing=2]="closing",ar[ar.closed=3]="closed"})(SOCKET_STATES||(SOCKET_STATES={}));var CHANNEL_STATES;(function(ar){ar.closed="closed",ar.errored="errored",ar.joined="joined",ar.joining="joining",ar.leaving="leaving"})(CHANNEL_STATES||(CHANNEL_STATES={}));var CHANNEL_EVENTS;(function(ar){ar.close="phx_close",ar.error="phx_error",ar.join="phx_join",ar.reply="phx_reply",ar.leave="phx_leave",ar.access_token="access_token"})(CHANNEL_EVENTS||(CHANNEL_EVENTS={}));var TRANSPORTS;(function(ar){ar.websocket="websocket"})(TRANSPORTS||(TRANSPORTS={}));var CONNECTION_STATE;(function(ar){ar.Connecting="connecting",ar.Open="open",ar.Closing="closing",ar.Closed="closed"})(CONNECTION_STATE||(CONNECTION_STATE={}));class Serializer{constructor(or){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=or??[]}encode(or,lr){if(or.event===this.BROADCAST_EVENT&&!(or.payload instanceof ArrayBuffer)&&typeof or.payload.event=="string")return lr(this._binaryEncodeUserBroadcastPush(or));let cr=[or.join_ref,or.ref,or.topic,or.event,or.payload];return lr(JSON.stringify(cr))}_binaryEncodeUserBroadcastPush(or){var lr;return this._isArrayBuffer((lr=or.payload)===null||lr===void 0?void 0:lr.payload)?this._encodeBinaryUserBroadcastPush(or):this._encodeJsonUserBroadcastPush(or)}_encodeBinaryUserBroadcastPush(or){var lr,cr;const ur=(cr=(lr=or.payload)===null||lr===void 0?void 0:lr.payload)!==null&&cr!==void 0?cr:new ArrayBuffer(0);return this._encodeUserBroadcastPush(or,this.BINARY_ENCODING,ur)}_encodeJsonUserBroadcastPush(or){var lr,cr;const ur=(cr=(lr=or.payload)===null||lr===void 0?void 0:lr.payload)!==null&&cr!==void 0?cr:{},hr=new TextEncoder().encode(JSON.stringify(ur)).buffer;return this._encodeUserBroadcastPush(or,this.JSON_ENCODING,hr)}_encodeUserBroadcastPush(or,lr,cr){var ur,dr;const hr=or.topic,pr=(ur=or.ref)!==null&&ur!==void 0?ur:"",xr=(dr=or.join_ref)!==null&&dr!==void 0?dr:"",mr=or.payload.event,fr=this.allowedMetadataKeys?this._pick(or.payload,this.allowedMetadataKeys):{},Er=Object.keys(fr).length===0?"":JSON.stringify(fr);if(xr.length>255)throw new Error(`joinRef length ${xr.length} exceeds maximum of 255`);if(pr.length>255)throw new Error(`ref length ${pr.length} exceeds maximum of 255`);if(hr.length>255)throw new Error(`topic length ${hr.length} exceeds maximum of 255`);if(mr.length>255)throw new Error(`userEvent length ${mr.length} exceeds maximum of 255`);if(Er.length>255)throw new Error(`metadata length ${Er.length} exceeds maximum of 255`);const vr=this.USER_BROADCAST_PUSH_META_LENGTH+xr.length+pr.length+hr.length+mr.length+Er.length,gr=new ArrayBuffer(this.HEADER_LENGTH+vr);let yr=new DataView(gr),jr=0;yr.setUint8(jr++,this.KINDS.userBroadcastPush),yr.setUint8(jr++,xr.length),yr.setUint8(jr++,pr.length),yr.setUint8(jr++,hr.length),yr.setUint8(jr++,mr.length),yr.setUint8(jr++,Er.length),yr.setUint8(jr++,lr),Array.from(xr,_r=>yr.setUint8(jr++,_r.charCodeAt(0))),Array.from(pr,_r=>yr.setUint8(jr++,_r.charCodeAt(0))),Array.from(hr,_r=>yr.setUint8(jr++,_r.charCodeAt(0))),Array.from(mr,_r=>yr.setUint8(jr++,_r.charCodeAt(0))),Array.from(Er,_r=>yr.setUint8(jr++,_r.charCodeAt(0)));var br=new Uint8Array(gr.byteLength+cr.byteLength);return br.set(new Uint8Array(gr),0),br.set(new Uint8Array(cr),gr.byteLength),br.buffer}decode(or,lr){if(this._isArrayBuffer(or)){let cr=this._binaryDecode(or);return lr(cr)}if(typeof or=="string"){const cr=JSON.parse(or),[ur,dr,hr,pr,xr]=cr;return lr({join_ref:ur,ref:dr,topic:hr,event:pr,payload:xr})}return lr({})}_binaryDecode(or){const lr=new DataView(or),cr=lr.getUint8(0),ur=new TextDecoder;switch(cr){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(or,lr,ur)}}_decodeUserBroadcast(or,lr,cr){const ur=lr.getUint8(1),dr=lr.getUint8(2),hr=lr.getUint8(3),pr=lr.getUint8(4);let xr=this.HEADER_LENGTH+4;const mr=cr.decode(or.slice(xr,xr+ur));xr=xr+ur;const fr=cr.decode(or.slice(xr,xr+dr));xr=xr+dr;const Er=cr.decode(or.slice(xr,xr+hr));xr=xr+hr;const vr=or.slice(xr,or.byteLength),gr=pr===this.JSON_ENCODING?JSON.parse(cr.decode(vr)):vr,yr={type:this.BROADCAST_EVENT,event:fr,payload:gr};return hr>0&&(yr.meta=JSON.parse(Er)),{join_ref:null,ref:null,topic:mr,event:this.BROADCAST_EVENT,payload:yr}}_isArrayBuffer(or){var lr;return or instanceof ArrayBuffer||((lr=or==null?void 0:or.constructor)===null||lr===void 0?void 0:lr.name)==="ArrayBuffer"}_pick(or,lr){return!or||typeof or!="object"?{}:Object.fromEntries(Object.entries(or).filter(([cr])=>lr.includes(cr)))}}class Timer{constructor(or,lr){this.callback=or,this.timerCalc=lr,this.timer=void 0,this.tries=0,this.callback=or,this.timerCalc=lr}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var PostgresTypes;(function(ar){ar.abstime="abstime",ar.bool="bool",ar.date="date",ar.daterange="daterange",ar.float4="float4",ar.float8="float8",ar.int2="int2",ar.int4="int4",ar.int4range="int4range",ar.int8="int8",ar.int8range="int8range",ar.json="json",ar.jsonb="jsonb",ar.money="money",ar.numeric="numeric",ar.oid="oid",ar.reltime="reltime",ar.text="text",ar.time="time",ar.timestamp="timestamp",ar.timestamptz="timestamptz",ar.timetz="timetz",ar.tsrange="tsrange",ar.tstzrange="tstzrange"})(PostgresTypes||(PostgresTypes={}));const convertChangeData=(ar,or,lr={})=>{var cr;const ur=(cr=lr.skipTypes)!==null&&cr!==void 0?cr:[];return or?Object.keys(or).reduce((dr,hr)=>(dr[hr]=convertColumn(hr,ar,or,ur),dr),{}):{}},convertColumn=(ar,or,lr,cr)=>{const ur=or.find(pr=>pr.name===ar),dr=ur==null?void 0:ur.type,hr=lr[ar];return dr&&!cr.includes(dr)?convertCell(dr,hr):noop$1(hr)},convertCell=(ar,or)=>{if(ar.charAt(0)==="_"){const lr=ar.slice(1,ar.length);return toArray(or,lr)}switch(ar){case PostgresTypes.bool:return toBoolean(or);case PostgresTypes.float4:case PostgresTypes.float8:case PostgresTypes.int2:case PostgresTypes.int4:case PostgresTypes.int8:case PostgresTypes.numeric:case PostgresTypes.oid:return toNumber(or);case PostgresTypes.json:case PostgresTypes.jsonb:return toJson(or);case PostgresTypes.timestamp:return toTimestampString(or);case PostgresTypes.abstime:case PostgresTypes.date:case PostgresTypes.daterange:case PostgresTypes.int4range:case PostgresTypes.int8range:case PostgresTypes.money:case PostgresTypes.reltime:case PostgresTypes.text:case PostgresTypes.time:case PostgresTypes.timestamptz:case PostgresTypes.timetz:case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return noop$1(or);default:return noop$1(or)}},noop$1=ar=>ar,toBoolean=ar=>{switch(ar){case"t":return!0;case"f":return!1;default:return ar}},toNumber=ar=>{if(typeof ar=="string"){const or=parseFloat(ar);if(!Number.isNaN(or))return or}return ar},toJson=ar=>{if(typeof ar=="string")try{return JSON.parse(ar)}catch{return ar}return ar},toArray=(ar,or)=>{if(typeof ar!="string")return ar;const lr=ar.length-1,cr=ar[lr];if(ar[0]==="{"&&cr==="}"){let dr;const hr=ar.slice(1,lr);try{dr=JSON.parse("["+hr+"]")}catch{dr=hr?hr.split(","):[]}return dr.map(pr=>convertCell(or,pr))}return ar},toTimestampString=ar=>typeof ar=="string"?ar.replace(" ","T"):ar,httpEndpointURL=ar=>{const or=new URL(ar);return or.protocol=or.protocol.replace(/^ws/i,"http"),or.pathname=or.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),or.pathname===""||or.pathname==="/"?or.pathname="/api/broadcast":or.pathname=or.pathname+"/api/broadcast",or.href};class Push{constructor(or,lr,cr={},ur=DEFAULT_TIMEOUT){this.channel=or,this.event=lr,this.payload=cr,this.timeout=ur,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(or){this.timeout=or,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(or){this.payload=Object.assign(Object.assign({},this.payload),or)}receive(or,lr){var cr;return this._hasReceived(or)&&lr((cr=this.receivedResp)===null||cr===void 0?void 0:cr.response),this.recHooks.push({status:or,callback:lr}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const or=lr=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=lr,this._matchReceive(lr)};this.channel._on(this.refEvent,{},or),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(or,lr){this.refEvent&&this.channel._trigger(this.refEvent,{status:or,response:lr})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:or,response:lr}){this.recHooks.filter(cr=>cr.status===or).forEach(cr=>cr.callback(lr))}_hasReceived(or){return this.receivedResp&&this.receivedResp.status===or}}var REALTIME_PRESENCE_LISTEN_EVENTS;(function(ar){ar.SYNC="sync",ar.JOIN="join",ar.LEAVE="leave"})(REALTIME_PRESENCE_LISTEN_EVENTS||(REALTIME_PRESENCE_LISTEN_EVENTS={}));class RealtimePresence{constructor(or,lr){this.channel=or,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const cr=(lr==null?void 0:lr.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(cr.state,{},ur=>{const{onJoin:dr,onLeave:hr,onSync:pr}=this.caller;this.joinRef=this.channel._joinRef(),this.state=RealtimePresence.syncState(this.state,ur,dr,hr),this.pendingDiffs.forEach(xr=>{this.state=RealtimePresence.syncDiff(this.state,xr,dr,hr)}),this.pendingDiffs=[],pr()}),this.channel._on(cr.diff,{},ur=>{const{onJoin:dr,onLeave:hr,onSync:pr}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(ur):(this.state=RealtimePresence.syncDiff(this.state,ur,dr,hr),pr())}),this.onJoin((ur,dr,hr)=>{this.channel._trigger("presence",{event:"join",key:ur,currentPresences:dr,newPresences:hr})}),this.onLeave((ur,dr,hr)=>{this.channel._trigger("presence",{event:"leave",key:ur,currentPresences:dr,leftPresences:hr})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(or,lr,cr,ur){const dr=this.cloneDeep(or),hr=this.transformState(lr),pr={},xr={};return this.map(dr,(mr,fr)=>{hr[mr]||(xr[mr]=fr)}),this.map(hr,(mr,fr)=>{const Er=dr[mr];if(Er){const vr=fr.map(br=>br.presence_ref),gr=Er.map(br=>br.presence_ref),yr=fr.filter(br=>gr.indexOf(br.presence_ref)<0),jr=Er.filter(br=>vr.indexOf(br.presence_ref)<0);yr.length>0&&(pr[mr]=yr),jr.length>0&&(xr[mr]=jr)}else pr[mr]=fr}),this.syncDiff(dr,{joins:pr,leaves:xr},cr,ur)}static syncDiff(or,lr,cr,ur){const{joins:dr,leaves:hr}={joins:this.transformState(lr.joins),leaves:this.transformState(lr.leaves)};return cr||(cr=()=>{}),ur||(ur=()=>{}),this.map(dr,(pr,xr)=>{var mr;const fr=(mr=or[pr])!==null&&mr!==void 0?mr:[];if(or[pr]=this.cloneDeep(xr),fr.length>0){const Er=or[pr].map(gr=>gr.presence_ref),vr=fr.filter(gr=>Er.indexOf(gr.presence_ref)<0);or[pr].unshift(...vr)}cr(pr,fr,xr)}),this.map(hr,(pr,xr)=>{let mr=or[pr];if(!mr)return;const fr=xr.map(Er=>Er.presence_ref);mr=mr.filter(Er=>fr.indexOf(Er.presence_ref)<0),or[pr]=mr,ur(pr,mr,xr),mr.length===0&&delete or[pr]}),or}static map(or,lr){return Object.getOwnPropertyNames(or).map(cr=>lr(cr,or[cr]))}static transformState(or){return or=this.cloneDeep(or),Object.getOwnPropertyNames(or).reduce((lr,cr)=>{const ur=or[cr];return"metas"in ur?lr[cr]=ur.metas.map(dr=>(dr.presence_ref=dr.phx_ref,delete dr.phx_ref,delete dr.phx_ref_prev,dr)):lr[cr]=ur,lr},{})}static cloneDeep(or){return JSON.parse(JSON.stringify(or))}onJoin(or){this.caller.onJoin=or}onLeave(or){this.caller.onLeave=or}onSync(or){this.caller.onSync=or}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var REALTIME_POSTGRES_CHANGES_LISTEN_EVENT;(function(ar){ar.ALL="*",ar.INSERT="INSERT",ar.UPDATE="UPDATE",ar.DELETE="DELETE"})(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT||(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT={}));var REALTIME_LISTEN_TYPES;(function(ar){ar.BROADCAST="broadcast",ar.PRESENCE="presence",ar.POSTGRES_CHANGES="postgres_changes",ar.SYSTEM="system"})(REALTIME_LISTEN_TYPES||(REALTIME_LISTEN_TYPES={}));var REALTIME_SUBSCRIBE_STATES;(function(ar){ar.SUBSCRIBED="SUBSCRIBED",ar.TIMED_OUT="TIMED_OUT",ar.CLOSED="CLOSED",ar.CHANNEL_ERROR="CHANNEL_ERROR"})(REALTIME_SUBSCRIBE_STATES||(REALTIME_SUBSCRIBE_STATES={}));class RealtimeChannel{constructor(or,lr={config:{}},cr){var ur,dr;if(this.topic=or,this.params=lr,this.socket=cr,this.bindings={},this.state=CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=or.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},lr.config),this.timeout=this.socket.timeout,this.joinPush=new Push(this,CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Timer(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(hr=>hr.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(hr=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,hr),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",hr=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,hr),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(CHANNEL_EVENTS.reply,{},(hr,pr)=>{this._trigger(this._replyEventName(pr),hr)}),this.presence=new RealtimePresence(this),this.broadcastEndpointURL=httpEndpointURL(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((dr=(ur=this.params.config)===null||ur===void 0?void 0:ur.broadcast)===null||dr===void 0)&&dr.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(or,lr=this.timeout){var cr,ur,dr;if(this.socket.isConnected()||this.socket.connect(),this.state==CHANNEL_STATES.closed){const{config:{broadcast:hr,presence:pr,private:xr}}=this.params,mr=(ur=(cr=this.bindings.postgres_changes)===null||cr===void 0?void 0:cr.map(gr=>gr.filter))!==null&&ur!==void 0?ur:[],fr=!!this.bindings[REALTIME_LISTEN_TYPES.PRESENCE]&&this.bindings[REALTIME_LISTEN_TYPES.PRESENCE].length>0||((dr=this.params.config.presence)===null||dr===void 0?void 0:dr.enabled)===!0,Er={},vr={broadcast:hr,presence:Object.assign(Object.assign({},pr),{enabled:fr}),postgres_changes:mr,private:xr};this.socket.accessTokenValue&&(Er.access_token=this.socket.accessTokenValue),this._onError(gr=>or==null?void 0:or(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,gr)),this._onClose(()=>or==null?void 0:or(REALTIME_SUBSCRIBE_STATES.CLOSED)),this.updateJoinPayload(Object.assign({config:vr},Er)),this.joinedOnce=!0,this._rejoin(lr),this.joinPush.receive("ok",async({postgres_changes:gr})=>{var yr;if(this.socket._isManualToken()||this.socket.setAuth(),gr===void 0){or==null||or(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}else{const jr=this.bindings.postgres_changes,br=(yr=jr==null?void 0:jr.length)!==null&&yr!==void 0?yr:0,_r=[];for(let wr=0;wr<br;wr++){const Rr=jr[wr],{filter:{event:Ar,schema:Sr,table:kr,filter:Nr}}=Rr,Cr=gr&&gr[wr];if(Cr&&Cr.event===Ar&&RealtimeChannel.isFilterValueEqual(Cr.schema,Sr)&&RealtimeChannel.isFilterValueEqual(Cr.table,kr)&&RealtimeChannel.isFilterValueEqual(Cr.filter,Nr))_r.push(Object.assign(Object.assign({},Rr),{id:Cr.id}));else{this.unsubscribe(),this.state=CHANNEL_STATES.errored,or==null||or(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=_r,or&&or(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}}).receive("error",gr=>{this.state=CHANNEL_STATES.errored,or==null||or(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(gr).join(", ")||"error")))}).receive("timeout",()=>{or==null||or(REALTIME_SUBSCRIBE_STATES.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(or,lr={}){return await this.send({type:"presence",event:"track",payload:or},lr.timeout||this.timeout)}async untrack(or={}){return await this.send({type:"presence",event:"untrack"},or)}on(or,lr,cr){return this.state===CHANNEL_STATES.joined&&or===REALTIME_LISTEN_TYPES.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(or,lr,cr)}async httpSend(or,lr,cr={}){var ur;if(lr==null)return Promise.reject("Payload is required for httpSend()");const dr={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(dr.Authorization=`Bearer ${this.socket.accessTokenValue}`);const hr={method:"POST",headers:dr,body:JSON.stringify({messages:[{topic:this.subTopic,event:or,payload:lr,private:this.private}]})},pr=await this._fetchWithTimeout(this.broadcastEndpointURL,hr,(ur=cr.timeout)!==null&&ur!==void 0?ur:this.timeout);if(pr.status===202)return{success:!0};let xr=pr.statusText;try{const mr=await pr.json();xr=mr.error||mr.message||xr}catch{}return Promise.reject(new Error(xr))}async send(or,lr={}){var cr,ur;if(!this._canPush()&&or.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:dr,payload:hr}=or,pr={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(pr.Authorization=`Bearer ${this.socket.accessTokenValue}`);const xr={method:"POST",headers:pr,body:JSON.stringify({messages:[{topic:this.subTopic,event:dr,payload:hr,private:this.private}]})};try{const mr=await this._fetchWithTimeout(this.broadcastEndpointURL,xr,(cr=lr.timeout)!==null&&cr!==void 0?cr:this.timeout);return await((ur=mr.body)===null||ur===void 0?void 0:ur.cancel()),mr.ok?"ok":"error"}catch(mr){return mr.name==="AbortError"?"timed out":"error"}}else return new Promise(dr=>{var hr,pr,xr;const mr=this._push(or.type,or,lr.timeout||this.timeout);or.type==="broadcast"&&!(!((xr=(pr=(hr=this.params)===null||hr===void 0?void 0:hr.config)===null||pr===void 0?void 0:pr.broadcast)===null||xr===void 0)&&xr.ack)&&dr("ok"),mr.receive("ok",()=>dr("ok")),mr.receive("error",()=>dr("error")),mr.receive("timeout",()=>dr("timed out"))})}updateJoinPayload(or){this.joinPush.updatePayload(or)}unsubscribe(or=this.timeout){this.state=CHANNEL_STATES.leaving;const lr=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(CHANNEL_EVENTS.close,"leave",this._joinRef())};this.joinPush.destroy();let cr=null;return new Promise(ur=>{cr=new Push(this,CHANNEL_EVENTS.leave,{},or),cr.receive("ok",()=>{lr(),ur("ok")}).receive("timeout",()=>{lr(),ur("timed out")}).receive("error",()=>{ur("error")}),cr.send(),this._canPush()||cr.trigger("ok",{})}).finally(()=>{cr==null||cr.destroy()})}teardown(){this.pushBuffer.forEach(or=>or.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=CHANNEL_STATES.closed,this.bindings={}}async _fetchWithTimeout(or,lr,cr){const ur=new AbortController,dr=setTimeout(()=>ur.abort(),cr),hr=await this.socket.fetch(or,Object.assign(Object.assign({},lr),{signal:ur.signal}));return clearTimeout(dr),hr}_push(or,lr,cr=this.timeout){if(!this.joinedOnce)throw`tried to push '${or}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let ur=new Push(this,or,lr,cr);return this._canPush()?ur.send():this._addToPushBuffer(ur),ur}_addToPushBuffer(or){if(or.startTimeout(),this.pushBuffer.push(or),this.pushBuffer.length>MAX_PUSH_BUFFER_SIZE){const lr=this.pushBuffer.shift();lr&&(lr.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${lr.event}`,lr.payload))}}_onMessage(or,lr,cr){return lr}_isMember(or){return this.topic===or}_joinRef(){return this.joinPush.ref}_trigger(or,lr,cr){var ur,dr;const hr=or.toLocaleLowerCase(),{close:pr,error:xr,leave:mr,join:fr}=CHANNEL_EVENTS;if(cr&&[pr,xr,mr,fr].indexOf(hr)>=0&&cr!==this._joinRef())return;let vr=this._onMessage(hr,lr,cr);if(lr&&!vr)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(hr)?(ur=this.bindings.postgres_changes)===null||ur===void 0||ur.filter(gr=>{var yr,jr,br;return((yr=gr.filter)===null||yr===void 0?void 0:yr.event)==="*"||((br=(jr=gr.filter)===null||jr===void 0?void 0:jr.event)===null||br===void 0?void 0:br.toLocaleLowerCase())===hr}).map(gr=>gr.callback(vr,cr)):(dr=this.bindings[hr])===null||dr===void 0||dr.filter(gr=>{var yr,jr,br,_r,wr,Rr;if(["broadcast","presence","postgres_changes"].includes(hr))if("id"in gr){const Ar=gr.id,Sr=(yr=gr.filter)===null||yr===void 0?void 0:yr.event;return Ar&&((jr=lr.ids)===null||jr===void 0?void 0:jr.includes(Ar))&&(Sr==="*"||(Sr==null?void 0:Sr.toLocaleLowerCase())===((br=lr.data)===null||br===void 0?void 0:br.type.toLocaleLowerCase()))}else{const Ar=(wr=(_r=gr==null?void 0:gr.filter)===null||_r===void 0?void 0:_r.event)===null||wr===void 0?void 0:wr.toLocaleLowerCase();return Ar==="*"||Ar===((Rr=lr==null?void 0:lr.event)===null||Rr===void 0?void 0:Rr.toLocaleLowerCase())}else return gr.type.toLocaleLowerCase()===hr}).map(gr=>{if(typeof vr=="object"&&"ids"in vr){const yr=vr.data,{schema:jr,table:br,commit_timestamp:_r,type:wr,errors:Rr}=yr;vr=Object.assign(Object.assign({},{schema:jr,table:br,commit_timestamp:_r,eventType:wr,new:{},old:{},errors:Rr}),this._getPayloadRecords(yr))}gr.callback(vr,cr)})}_isClosed(){return this.state===CHANNEL_STATES.closed}_isJoined(){return this.state===CHANNEL_STATES.joined}_isJoining(){return this.state===CHANNEL_STATES.joining}_isLeaving(){return this.state===CHANNEL_STATES.leaving}_replyEventName(or){return`chan_reply_${or}`}_on(or,lr,cr){const ur=or.toLocaleLowerCase(),dr={type:ur,filter:lr,callback:cr};return this.bindings[ur]?this.bindings[ur].push(dr):this.bindings[ur]=[dr],this}_off(or,lr){const cr=or.toLocaleLowerCase();return this.bindings[cr]&&(this.bindings[cr]=this.bindings[cr].filter(ur=>{var dr;return!(((dr=ur.type)===null||dr===void 0?void 0:dr.toLocaleLowerCase())===cr&&RealtimeChannel.isEqual(ur.filter,lr))})),this}static isEqual(or,lr){if(Object.keys(or).length!==Object.keys(lr).length)return!1;for(const cr in or)if(or[cr]!==lr[cr])return!1;return!0}static isFilterValueEqual(or,lr){return(or??void 0)===(lr??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(or){this._on(CHANNEL_EVENTS.close,{},or)}_onError(or){this._on(CHANNEL_EVENTS.error,{},lr=>or(lr))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(or=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=CHANNEL_STATES.joining,this.joinPush.resend(or))}_getPayloadRecords(or){const lr={new:{},old:{}};return(or.type==="INSERT"||or.type==="UPDATE")&&(lr.new=convertChangeData(or.columns,or.record)),(or.type==="UPDATE"||or.type==="DELETE")&&(lr.old=convertChangeData(or.columns,or.old_record)),lr}}const noop=()=>{},CONNECTION_TIMEOUTS={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},RECONNECT_INTERVALS=[1e3,2e3,5e3,1e4],DEFAULT_RECONNECT_FALLBACK=1e4,WORKER_SCRIPT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class RealtimeClient{constructor(or,lr){var cr;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=DEFAULT_TIMEOUT,this.transport=null,this.heartbeatIntervalMs=CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=noop,this.ref=0,this.reconnectTimer=null,this.vsn=DEFAULT_VSN,this.logger=noop,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=ur=>ur?(...dr)=>ur(...dr):(...dr)=>fetch(...dr),!(!((cr=lr==null?void 0:lr.params)===null||cr===void 0)&&cr.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=lr.params.apikey,this.endPoint=`${or}/${TRANSPORTS.websocket}`,this.httpEndpoint=httpEndpointURL(or),this._initializeOptions(lr),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(lr==null?void 0:lr.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=WebSocketFactory.createWebSocket(this.endpointURL())}catch(or){this._setConnectionState("disconnected");const lr=or.message;throw lr.includes("Node.js")?new Error(`${lr}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${lr}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(or,lr){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const cr=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(cr),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(or?this.conn.close(or,lr??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(or){const lr=await or.unsubscribe();return this.channels.length===0&&this.disconnect(),lr}async removeAllChannels(){const or=await Promise.all(this.channels.map(lr=>lr.unsubscribe()));return this.channels=[],this.disconnect(),or}log(or,lr,cr){this.logger(or,lr,cr)}connectionState(){switch(this.conn&&this.conn.readyState){case SOCKET_STATES.connecting:return CONNECTION_STATE.Connecting;case SOCKET_STATES.open:return CONNECTION_STATE.Open;case SOCKET_STATES.closing:return CONNECTION_STATE.Closing;default:return CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===CONNECTION_STATE.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(or,lr={config:{}}){const cr=`realtime:${or}`,ur=this.getChannels().find(dr=>dr.topic===cr);if(ur)return ur;{const dr=new RealtimeChannel(`realtime:${or}`,lr,this);return this.channels.push(dr),dr}}push(or){const{topic:lr,event:cr,payload:ur,ref:dr}=or,hr=()=>{this.encode(or,pr=>{var xr;(xr=this.conn)===null||xr===void 0||xr.send(pr)})};this.log("push",`${lr} ${cr} (${dr})`,ur),this.isConnected()?hr():this.sendBuffer.push(hr)}async setAuth(or=null){this._authPromise=this._performAuth(or);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var or;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(lr){this.log("error","error in heartbeat callback",lr)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(lr){this.log("error","error in heartbeat callback",lr)}this._wasManualDisconnect=!1,(or=this.conn)===null||or===void 0||or.close(WS_CLOSE_NORMAL,"heartbeat timeout"),setTimeout(()=>{var lr;this.isConnected()||(lr=this.reconnectTimer)===null||lr===void 0||lr.scheduleTimeout()},CONNECTION_TIMEOUTS.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(lr){this.log("error","error in heartbeat callback",lr)}this._setAuthSafely("heartbeat")}onHeartbeat(or){this.heartbeatCallback=or}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(or=>or()),this.sendBuffer=[])}_makeRef(){let or=this.ref+1;return or===this.ref?this.ref=0:this.ref=or,this.ref.toString()}_leaveOpenTopic(or){let lr=this.channels.find(cr=>cr.topic===or&&(cr._isJoined()||cr._isJoining()));lr&&(this.log("transport",`leaving duplicate topic "${or}"`),lr.unsubscribe())}_remove(or){this.channels=this.channels.filter(lr=>lr.topic!==or.topic)}_onConnMessage(or){this.decode(or.data,lr=>{if(lr.topic==="phoenix"&&lr.event==="phx_reply"&&lr.ref&&lr.ref===this.pendingHeartbeatRef){const mr=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(lr.payload.status==="ok"?"ok":"error",mr)}catch(fr){this.log("error","error in heartbeat callback",fr)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:cr,event:ur,payload:dr,ref:hr}=lr,pr=hr?`(${hr})`:"",xr=dr.status||"";this.log("receive",`${xr} ${cr} ${ur} ${pr}`.trim(),dr),this.channels.filter(mr=>mr._isMember(cr)).forEach(mr=>mr._trigger(ur,dr,hr)),this._triggerStateCallbacks("message",lr)})}_clearTimer(or){var lr;or==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):or==="reconnect"&&((lr=this.reconnectTimer)===null||lr===void 0||lr.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=or=>this._onConnError(or),this.conn.onmessage=or=>this._onConnMessage(or),this.conn.onclose=or=>this._onConnClose(or),this.conn.readyState===SOCKET_STATES.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===SOCKET_STATES.open||this.conn.readyState===SOCKET_STATES.connecting)try{this.conn.close()}catch(or){this.log("error","Error closing connection",or)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(or=>or.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(lr=>{this.log("error","error waiting for auth on connect",lr),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const or=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(or),this.workerRef.onerror=lr=>{this.log("worker","worker error",lr.message),this._terminateWorker()},this.workerRef.onmessage=lr=>{lr.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(or){var lr;this._setConnectionState("disconnected"),this.log("transport","close",or),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(lr=this.reconnectTimer)===null||lr===void 0||lr.scheduleTimeout(),this._triggerStateCallbacks("close",or)}_onConnError(or){this._setConnectionState("disconnected"),this.log("transport",`${or}`),this._triggerChanError(),this._triggerStateCallbacks("error",or);try{this.heartbeatCallback("error")}catch(lr){this.log("error","error in heartbeat callback",lr)}}_triggerChanError(){this.channels.forEach(or=>or._trigger(CHANNEL_EVENTS.error))}_appendParams(or,lr){if(Object.keys(lr).length===0)return or;const cr=or.match(/\?/)?"&":"?",ur=new URLSearchParams(lr);return`${or}${cr}${ur}`}_workerObjectUrl(or){let lr;if(or)lr=or;else{const cr=new Blob([WORKER_SCRIPT],{type:"application/javascript"});lr=URL.createObjectURL(cr)}return lr}_setConnectionState(or,lr=!1){this._connectionState=or,or==="connecting"?this._wasManualDisconnect=!1:or==="disconnecting"&&(this._wasManualDisconnect=lr)}async _performAuth(or=null){let lr,cr=!1;if(or)lr=or,cr=!0;else if(this.accessToken)try{lr=await this.accessToken()}catch(ur){this.log("error","Error fetching access token from callback",ur),lr=this.accessTokenValue}else lr=this.accessTokenValue;cr?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=lr&&(this.accessTokenValue=lr,this.channels.forEach(ur=>{const dr={access_token:lr,version:DEFAULT_VERSION};lr&&ur.updateJoinPayload(dr),ur.joinedOnce&&ur._isJoined()&&ur._push(CHANNEL_EVENTS.access_token,{access_token:lr})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(or="general"){this._isManualToken()||this.setAuth().catch(lr=>{this.log("error",`Error setting auth in ${or}`,lr)})}_triggerStateCallbacks(or,lr){try{this.stateChangeCallbacks[or].forEach(cr=>{try{cr(lr)}catch(ur){this.log("error",`error in ${or} callback`,ur)}})}catch(cr){this.log("error",`error triggering ${or} callbacks`,cr)}}_setupReconnectionTimer(){this.reconnectTimer=new Timer(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},CONNECTION_TIMEOUTS.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(or){var lr,cr,ur,dr,hr,pr,xr,mr,fr,Er,vr,gr;switch(this.transport=(lr=or==null?void 0:or.transport)!==null&&lr!==void 0?lr:null,this.timeout=(cr=or==null?void 0:or.timeout)!==null&&cr!==void 0?cr:DEFAULT_TIMEOUT,this.heartbeatIntervalMs=(ur=or==null?void 0:or.heartbeatIntervalMs)!==null&&ur!==void 0?ur:CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.worker=(dr=or==null?void 0:or.worker)!==null&&dr!==void 0?dr:!1,this.accessToken=(hr=or==null?void 0:or.accessToken)!==null&&hr!==void 0?hr:null,this.heartbeatCallback=(pr=or==null?void 0:or.heartbeatCallback)!==null&&pr!==void 0?pr:noop,this.vsn=(xr=or==null?void 0:or.vsn)!==null&&xr!==void 0?xr:DEFAULT_VSN,or!=null&&or.params&&(this.params=or.params),or!=null&&or.logger&&(this.logger=or.logger),(or!=null&&or.logLevel||or!=null&&or.log_level)&&(this.logLevel=or.logLevel||or.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(mr=or==null?void 0:or.reconnectAfterMs)!==null&&mr!==void 0?mr:yr=>RECONNECT_INTERVALS[yr-1]||DEFAULT_RECONNECT_FALLBACK,this.vsn){case VSN_1_0_0:this.encode=(fr=or==null?void 0:or.encode)!==null&&fr!==void 0?fr:(yr,jr)=>jr(JSON.stringify(yr)),this.decode=(Er=or==null?void 0:or.decode)!==null&&Er!==void 0?Er:(yr,jr)=>jr(JSON.parse(yr));break;case VSN_2_0_0:this.encode=(vr=or==null?void 0:or.encode)!==null&&vr!==void 0?vr:this.serializer.encode.bind(this.serializer),this.decode=(gr=or==null?void 0:or.decode)!==null&&gr!==void 0?gr:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=or==null?void 0:or.workerUrl}}}var IcebergError=class extends Error{constructor(ar,or){var lr;super(ar),this.name="IcebergError",this.status=or.status,this.icebergType=or.icebergType,this.icebergCode=or.icebergCode,this.details=or.details,this.isCommitStateUnknown=or.icebergType==="CommitStateUnknownException"||[500,502,504].includes(or.status)&&((lr=or.icebergType)==null?void 0:lr.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function buildUrl(ar,or,lr){const cr=new URL(or,ar);if(lr)for(const[ur,dr]of Object.entries(lr))dr!==void 0&&cr.searchParams.set(ur,dr);return cr.toString()}async function buildAuthHeaders(ar){return!ar||ar.type==="none"?{}:ar.type==="bearer"?{Authorization:`Bearer ${ar.token}`}:ar.type==="header"?{[ar.name]:ar.value}:ar.type==="custom"?await ar.getHeaders():{}}function createFetchClient(ar){const or=ar.fetchImpl??globalThis.fetch;return{async request({method:lr,path:cr,query:ur,body:dr,headers:hr}){const pr=buildUrl(ar.baseUrl,cr,ur),xr=await buildAuthHeaders(ar.auth),mr=await or(pr,{method:lr,headers:{...dr?{"Content-Type":"application/json"}:{},...xr,...hr},body:dr?JSON.stringify(dr):void 0}),fr=await mr.text(),Er=(mr.headers.get("content-type")||"").includes("application/json"),vr=Er&&fr?JSON.parse(fr):fr;if(!mr.ok){const gr=Er?vr:void 0,yr=gr==null?void 0:gr.error;throw new IcebergError((yr==null?void 0:yr.message)??`Request failed with status ${mr.status}`,{status:mr.status,icebergType:yr==null?void 0:yr.type,icebergCode:yr==null?void 0:yr.code,details:gr})}return{status:mr.status,headers:mr.headers,data:vr}}}}function namespaceToPath(ar){return ar.join("")}var NamespaceOperations=class{constructor(ar,or=""){this.client=ar,this.prefix=or}async listNamespaces(ar){const or=ar?{parent:namespaceToPath(ar.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:or})).data.namespaces.map(cr=>({namespace:cr}))}async createNamespace(ar,or){const lr={namespace:ar.namespace,properties:or==null?void 0:or.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:lr})).data}async dropNamespace(ar){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${namespaceToPath(ar.namespace)}`})}async loadNamespaceMetadata(ar){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${namespaceToPath(ar.namespace)}`})).data.properties}}async namespaceExists(ar){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${namespaceToPath(ar.namespace)}`}),!0}catch(or){if(or instanceof IcebergError&&or.status===404)return!1;throw or}}async createNamespaceIfNotExists(ar,or){try{return await this.createNamespace(ar,or)}catch(lr){if(lr instanceof IcebergError&&lr.status===409)return;throw lr}}};function namespaceToPath2(ar){return ar.join("")}var TableOperations=class{constructor(ar,or="",lr){this.client=ar,this.prefix=or,this.accessDelegation=lr}async listTables(ar){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables`})).data.identifiers}async createTable(ar,or){const lr={};return this.accessDelegation&&(lr["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables`,body:or,headers:lr})).data.metadata}async updateTable(ar,or){const lr=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables/${ar.name}`,body:or});return{"metadata-location":lr.data["metadata-location"],metadata:lr.data.metadata}}async dropTable(ar,or){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables/${ar.name}`,query:{purgeRequested:String((or==null?void 0:or.purge)??!1)}})}async loadTable(ar){const or={};return this.accessDelegation&&(or["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables/${ar.name}`,headers:or})).data.metadata}async tableExists(ar){const or={};this.accessDelegation&&(or["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables/${ar.name}`,headers:or}),!0}catch(lr){if(lr instanceof IcebergError&&lr.status===404)return!1;throw lr}}async createTableIfNotExists(ar,or){try{return await this.createTable(ar,or)}catch(lr){if(lr instanceof IcebergError&&lr.status===409)return await this.loadTable({namespace:ar.namespace,name:or.name});throw lr}}},IcebergRestCatalog=class{constructor(ar){var cr;let or="v1";ar.catalogName&&(or+=`/${ar.catalogName}`);const lr=ar.baseUrl.endsWith("/")?ar.baseUrl:`${ar.baseUrl}/`;this.client=createFetchClient({baseUrl:lr,auth:ar.auth,fetchImpl:ar.fetch}),this.accessDelegation=(cr=ar.accessDelegation)==null?void 0:cr.join(","),this.namespaceOps=new NamespaceOperations(this.client,or),this.tableOps=new TableOperations(this.client,or,this.accessDelegation)}async listNamespaces(ar){return this.namespaceOps.listNamespaces(ar)}async createNamespace(ar,or){return this.namespaceOps.createNamespace(ar,or)}async dropNamespace(ar){await this.namespaceOps.dropNamespace(ar)}async loadNamespaceMetadata(ar){return this.namespaceOps.loadNamespaceMetadata(ar)}async listTables(ar){return this.tableOps.listTables(ar)}async createTable(ar,or){return this.tableOps.createTable(ar,or)}async updateTable(ar,or){return this.tableOps.updateTable(ar,or)}async dropTable(ar,or){await this.tableOps.dropTable(ar,or)}async loadTable(ar){return this.tableOps.loadTable(ar)}async namespaceExists(ar){return this.namespaceOps.namespaceExists(ar)}async tableExists(ar){return this.tableOps.tableExists(ar)}async createNamespaceIfNotExists(ar,or){return this.namespaceOps.createNamespaceIfNotExists(ar,or)}async createTableIfNotExists(ar,or){return this.tableOps.createTableIfNotExists(ar,or)}},StorageError=class extends Error{constructor(ar,or="storage",lr,cr){super(ar),this.__isStorageError=!0,this.namespace=or,this.name=or==="vectors"?"StorageVectorsError":"StorageError",this.status=lr,this.statusCode=cr}};function isStorageError(ar){return typeof ar=="object"&&ar!==null&&"__isStorageError"in ar}var StorageApiError=class extends StorageError{constructor(ar,or,lr,cr="storage"){super(ar,cr,or,lr),this.name=cr==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=or,this.statusCode=lr}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},StorageUnknownError=class extends StorageError{constructor(ar,or,lr="storage"){super(ar,lr),this.name=lr==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=or}};const resolveFetch$2=ar=>ar?(...or)=>ar(...or):(...or)=>fetch(...or),isPlainObject=ar=>{if(typeof ar!="object"||ar===null)return!1;const or=Object.getPrototypeOf(ar);return(or===null||or===Object.prototype||Object.getPrototypeOf(or)===null)&&!(Symbol.toStringTag in ar)&&!(Symbol.iterator in ar)},recursiveToCamel=ar=>{if(Array.isArray(ar))return ar.map(lr=>recursiveToCamel(lr));if(typeof ar=="function"||ar!==Object(ar))return ar;const or={};return Object.entries(ar).forEach(([lr,cr])=>{const ur=lr.replace(/([-_][a-z])/gi,dr=>dr.toUpperCase().replace(/[-_]/g,""));or[ur]=recursiveToCamel(cr)}),or},isValidBucketName=ar=>!ar||typeof ar!="string"||ar.length===0||ar.length>100||ar.trim()!==ar||ar.includes("/")||ar.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(ar);function _typeof$1(ar){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(or){return typeof or}:function(or){return or&&typeof Symbol=="function"&&or.constructor===Symbol&&or!==Symbol.prototype?"symbol":typeof or},_typeof$1(ar)}function toPrimitive$1(ar,or){if(_typeof$1(ar)!="object"||!ar)return ar;var lr=ar[Symbol.toPrimitive];if(lr!==void 0){var cr=lr.call(ar,or);if(_typeof$1(cr)!="object")return cr;throw new TypeError("@@toPrimitive must return a primitive value.")}return(or==="string"?String:Number)(ar)}function toPropertyKey$1(ar){var or=toPrimitive$1(ar,"string");return _typeof$1(or)=="symbol"?or:or+""}function _defineProperty$1(ar,or,lr){return(or=toPropertyKey$1(or))in ar?Object.defineProperty(ar,or,{value:lr,enumerable:!0,configurable:!0,writable:!0}):ar[or]=lr,ar}function ownKeys$1(ar,or){var lr=Object.keys(ar);if(Object.getOwnPropertySymbols){var cr=Object.getOwnPropertySymbols(ar);or&&(cr=cr.filter(function(ur){return Object.getOwnPropertyDescriptor(ar,ur).enumerable})),lr.push.apply(lr,cr)}return lr}function _objectSpread2$1(ar){for(var or=1;or<arguments.length;or++){var lr=arguments[or]!=null?arguments[or]:{};or%2?ownKeys$1(Object(lr),!0).forEach(function(cr){_defineProperty$1(ar,cr,lr[cr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ar,Object.getOwnPropertyDescriptors(lr)):ownKeys$1(Object(lr)).forEach(function(cr){Object.defineProperty(ar,cr,Object.getOwnPropertyDescriptor(lr,cr))})}return ar}const _getErrorMessage$1=ar=>{var or;return ar.msg||ar.message||ar.error_description||(typeof ar.error=="string"?ar.error:(or=ar.error)===null||or===void 0?void 0:or.message)||JSON.stringify(ar)},handleError$1=async(ar,or,lr,cr)=>{if(ar&&typeof ar=="object"&&"status"in ar&&"ok"in ar&&typeof ar.status=="number"&&!(lr!=null&&lr.noResolveJson)){const ur=ar,dr=ur.status||500;if(typeof ur.json=="function")ur.json().then(hr=>{const pr=(hr==null?void 0:hr.statusCode)||(hr==null?void 0:hr.code)||dr+"";or(new StorageApiError(_getErrorMessage$1(hr),dr,pr,cr))}).catch(()=>{if(cr==="vectors"){const hr=dr+"";or(new StorageApiError(ur.statusText||`HTTP ${dr} error`,dr,hr,cr))}else{const hr=dr+"";or(new StorageApiError(ur.statusText||`HTTP ${dr} error`,dr,hr,cr))}});else{const hr=dr+"";or(new StorageApiError(ur.statusText||`HTTP ${dr} error`,dr,hr,cr))}}else or(new StorageUnknownError(_getErrorMessage$1(ar),ar,cr))},_getRequestParams$1=(ar,or,lr,cr)=>{const ur={method:ar,headers:(or==null?void 0:or.headers)||{}};return ar==="GET"||ar==="HEAD"||!cr?_objectSpread2$1(_objectSpread2$1({},ur),lr):(isPlainObject(cr)?(ur.headers=_objectSpread2$1({"Content-Type":"application/json"},or==null?void 0:or.headers),ur.body=JSON.stringify(cr)):ur.body=cr,or!=null&&or.duplex&&(ur.duplex=or.duplex),_objectSpread2$1(_objectSpread2$1({},ur),lr))};async function _handleRequest$1(ar,or,lr,cr,ur,dr,hr){return new Promise((pr,xr)=>{ar(lr,_getRequestParams$1(or,cr,ur,dr)).then(mr=>{if(!mr.ok)throw mr;if(cr!=null&&cr.noResolveJson)return mr;if(hr==="vectors"){const fr=mr.headers.get("content-type");if(!fr||!fr.includes("application/json"))return{}}return mr.json()}).then(mr=>pr(mr)).catch(mr=>handleError$1(mr,xr,cr,hr))})}function createFetchApi(ar="storage"){return{get:async(or,lr,cr,ur)=>_handleRequest$1(or,"GET",lr,cr,ur,void 0,ar),post:async(or,lr,cr,ur,dr)=>_handleRequest$1(or,"POST",lr,ur,dr,cr,ar),put:async(or,lr,cr,ur,dr)=>_handleRequest$1(or,"PUT",lr,ur,dr,cr,ar),head:async(or,lr,cr,ur)=>_handleRequest$1(or,"HEAD",lr,_objectSpread2$1(_objectSpread2$1({},cr),{},{noResolveJson:!0}),ur,void 0,ar),remove:async(or,lr,cr,ur,dr)=>_handleRequest$1(or,"DELETE",lr,ur,dr,cr,ar)}}const defaultApi=createFetchApi("storage"),{get,post,put,head,remove}=defaultApi;var BaseApiClient=class{constructor(ar,or={},lr,cr="storage"){this.shouldThrowOnError=!1,this.url=ar,this.headers=or,this.fetch=resolveFetch$2(lr),this.namespace=cr}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(ar){var or=this;try{return{data:await ar(),error:null}}catch(lr){if(or.shouldThrowOnError)throw lr;if(isStorageError(lr))return{data:null,error:lr};throw lr}}},StreamDownloadBuilder=class{constructor(ar,or){this.downloadFn=ar,this.shouldThrowOnError=or}then(ar,or){return this.execute().then(ar,or)}async execute(){var ar=this;try{return{data:(await ar.downloadFn()).body,error:null}}catch(or){if(ar.shouldThrowOnError)throw or;if(isStorageError(or))return{data:null,error:or};throw or}}};let _Symbol$toStringTag;_Symbol$toStringTag=Symbol.toStringTag;var BlobDownloadBuilder=class{constructor(ar,or){this.downloadFn=ar,this.shouldThrowOnError=or,this[_Symbol$toStringTag]="BlobDownloadBuilder",this.promise=null}asStream(){return new StreamDownloadBuilder(this.downloadFn,this.shouldThrowOnError)}then(ar,or){return this.getPromise().then(ar,or)}catch(ar){return this.getPromise().catch(ar)}finally(ar){return this.getPromise().finally(ar)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var ar=this;try{return{data:await(await ar.downloadFn()).blob(),error:null}}catch(or){if(ar.shouldThrowOnError)throw or;if(isStorageError(or))return{data:null,error:or};throw or}}};const DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var StorageFileApi=class extends BaseApiClient{constructor(ar,or={},lr,cr){super(ar,or,cr,"storage"),this.bucketId=lr}async uploadOrUpdate(ar,or,lr,cr){var ur=this;return ur.handleOperation(async()=>{let dr;const hr=_objectSpread2$1(_objectSpread2$1({},DEFAULT_FILE_OPTIONS),cr);let pr=_objectSpread2$1(_objectSpread2$1({},ur.headers),ar==="POST"&&{"x-upsert":String(hr.upsert)});const xr=hr.metadata;typeof Blob<"u"&&lr instanceof Blob?(dr=new FormData,dr.append("cacheControl",hr.cacheControl),xr&&dr.append("metadata",ur.encodeMetadata(xr)),dr.append("",lr)):typeof FormData<"u"&&lr instanceof FormData?(dr=lr,dr.has("cacheControl")||dr.append("cacheControl",hr.cacheControl),xr&&!dr.has("metadata")&&dr.append("metadata",ur.encodeMetadata(xr))):(dr=lr,pr["cache-control"]=`max-age=${hr.cacheControl}`,pr["content-type"]=hr.contentType,xr&&(pr["x-metadata"]=ur.toBase64(ur.encodeMetadata(xr))),(typeof ReadableStream<"u"&&dr instanceof ReadableStream||dr&&typeof dr=="object"&&"pipe"in dr&&typeof dr.pipe=="function")&&!hr.duplex&&(hr.duplex="half")),cr!=null&&cr.headers&&(pr=_objectSpread2$1(_objectSpread2$1({},pr),cr.headers));const mr=ur._removeEmptyFolders(or),fr=ur._getFinalPath(mr),Er=await(ar=="PUT"?put:post)(ur.fetch,`${ur.url}/object/${fr}`,dr,_objectSpread2$1({headers:pr},hr!=null&&hr.duplex?{duplex:hr.duplex}:{}));return{path:mr,id:Er.Id,fullPath:Er.Key}})}async upload(ar,or,lr){return this.uploadOrUpdate("POST",ar,or,lr)}async uploadToSignedUrl(ar,or,lr,cr){var ur=this;const dr=ur._removeEmptyFolders(ar),hr=ur._getFinalPath(dr),pr=new URL(ur.url+`/object/upload/sign/${hr}`);return pr.searchParams.set("token",or),ur.handleOperation(async()=>{let xr;const mr=_objectSpread2$1({upsert:DEFAULT_FILE_OPTIONS.upsert},cr),fr=_objectSpread2$1(_objectSpread2$1({},ur.headers),{"x-upsert":String(mr.upsert)});return typeof Blob<"u"&&lr instanceof Blob?(xr=new FormData,xr.append("cacheControl",mr.cacheControl),xr.append("",lr)):typeof FormData<"u"&&lr instanceof FormData?(xr=lr,xr.append("cacheControl",mr.cacheControl)):(xr=lr,fr["cache-control"]=`max-age=${mr.cacheControl}`,fr["content-type"]=mr.contentType),{path:dr,fullPath:(await put(ur.fetch,pr.toString(),xr,{headers:fr})).Key}})}async createSignedUploadUrl(ar,or){var lr=this;return lr.handleOperation(async()=>{let cr=lr._getFinalPath(ar);const ur=_objectSpread2$1({},lr.headers);or!=null&&or.upsert&&(ur["x-upsert"]="true");const dr=await post(lr.fetch,`${lr.url}/object/upload/sign/${cr}`,{},{headers:ur}),hr=new URL(lr.url+dr.url),pr=hr.searchParams.get("token");if(!pr)throw new StorageError("No token returned by API");return{signedUrl:hr.toString(),path:ar,token:pr}})}async update(ar,or,lr){return this.uploadOrUpdate("PUT",ar,or,lr)}async move(ar,or,lr){var cr=this;return cr.handleOperation(async()=>await post(cr.fetch,`${cr.url}/object/move`,{bucketId:cr.bucketId,sourceKey:ar,destinationKey:or,destinationBucket:lr==null?void 0:lr.destinationBucket},{headers:cr.headers}))}async copy(ar,or,lr){var cr=this;return cr.handleOperation(async()=>({path:(await post(cr.fetch,`${cr.url}/object/copy`,{bucketId:cr.bucketId,sourceKey:ar,destinationKey:or,destinationBucket:lr==null?void 0:lr.destinationBucket},{headers:cr.headers})).Key}))}async createSignedUrl(ar,or,lr){var cr=this;return cr.handleOperation(async()=>{let ur=cr._getFinalPath(ar),dr=await post(cr.fetch,`${cr.url}/object/sign/${ur}`,_objectSpread2$1({expiresIn:or},lr!=null&&lr.transform?{transform:lr.transform}:{}),{headers:cr.headers});const hr=lr!=null&&lr.download?`&download=${lr.download===!0?"":lr.download}`:"";return{signedUrl:encodeURI(`${cr.url}${dr.signedURL}${hr}`)}})}async createSignedUrls(ar,or,lr){var cr=this;return cr.handleOperation(async()=>{const ur=await post(cr.fetch,`${cr.url}/object/sign/${cr.bucketId}`,{expiresIn:or,paths:ar},{headers:cr.headers}),dr=lr!=null&&lr.download?`&download=${lr.download===!0?"":lr.download}`:"";return ur.map(hr=>_objectSpread2$1(_objectSpread2$1({},hr),{},{signedUrl:hr.signedURL?encodeURI(`${cr.url}${hr.signedURL}${dr}`):null}))})}download(ar,or){const lr=typeof(or==null?void 0:or.transform)<"u"?"render/image/authenticated":"object",cr=this.transformOptsToQueryString((or==null?void 0:or.transform)||{}),ur=cr?`?${cr}`:"",dr=this._getFinalPath(ar),hr=()=>get(this.fetch,`${this.url}/${lr}/${dr}${ur}`,{headers:this.headers,noResolveJson:!0});return new BlobDownloadBuilder(hr,this.shouldThrowOnError)}async info(ar){var or=this;const lr=or._getFinalPath(ar);return or.handleOperation(async()=>recursiveToCamel(await get(or.fetch,`${or.url}/object/info/${lr}`,{headers:or.headers})))}async exists(ar){var or=this;const lr=or._getFinalPath(ar);try{return await head(or.fetch,`${or.url}/object/${lr}`,{headers:or.headers}),{data:!0,error:null}}catch(cr){if(or.shouldThrowOnError)throw cr;if(isStorageError(cr)&&cr instanceof StorageUnknownError){const ur=cr.originalError;if([400,404].includes(ur==null?void 0:ur.status))return{data:!1,error:cr}}throw cr}}getPublicUrl(ar,or){const lr=this._getFinalPath(ar),cr=[],ur=or!=null&&or.download?`download=${or.download===!0?"":or.download}`:"";ur!==""&&cr.push(ur);const dr=typeof(or==null?void 0:or.transform)<"u"?"render/image":"object",hr=this.transformOptsToQueryString((or==null?void 0:or.transform)||{});hr!==""&&cr.push(hr);let pr=cr.join("&");return pr!==""&&(pr=`?${pr}`),{data:{publicUrl:encodeURI(`${this.url}/${dr}/public/${lr}${pr}`)}}}async remove(ar){var or=this;return or.handleOperation(async()=>await remove(or.fetch,`${or.url}/object/${or.bucketId}`,{prefixes:ar},{headers:or.headers}))}async list(ar,or,lr){var cr=this;return cr.handleOperation(async()=>{const ur=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},DEFAULT_SEARCH_OPTIONS),or),{},{prefix:ar||""});return await post(cr.fetch,`${cr.url}/object/list/${cr.bucketId}`,ur,{headers:cr.headers},lr)})}async listV2(ar,or){var lr=this;return lr.handleOperation(async()=>{const cr=_objectSpread2$1({},ar);return await post(lr.fetch,`${lr.url}/object/list-v2/${lr.bucketId}`,cr,{headers:lr.headers},or)})}encodeMetadata(ar){return JSON.stringify(ar)}toBase64(ar){return typeof Buffer<"u"?Buffer.from(ar).toString("base64"):btoa(ar)}_getFinalPath(ar){return`${this.bucketId}/${ar.replace(/^\/+/,"")}`}_removeEmptyFolders(ar){return ar.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(ar){const or=[];return ar.width&&or.push(`width=${ar.width}`),ar.height&&or.push(`height=${ar.height}`),ar.resize&&or.push(`resize=${ar.resize}`),ar.format&&or.push(`format=${ar.format}`),ar.quality&&or.push(`quality=${ar.quality}`),or.join("&")}};const version$2="2.93.1",DEFAULT_HEADERS$2={"X-Client-Info":`storage-js/${version$2}`};var StorageBucketApi=class extends BaseApiClient{constructor(ar,or={},lr,cr){const ur=new URL(ar);cr!=null&&cr.useNewHostname&&/supabase\.(co|in|red)$/.test(ur.hostname)&&!ur.hostname.includes("storage.supabase.")&&(ur.hostname=ur.hostname.replace("supabase.","storage.supabase."));const dr=ur.href.replace(/\/$/,""),hr=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),or);super(dr,hr,lr,"storage")}async listBuckets(ar){var or=this;return or.handleOperation(async()=>{const lr=or.listBucketOptionsToQueryString(ar);return await get(or.fetch,`${or.url}/bucket${lr}`,{headers:or.headers})})}async getBucket(ar){var or=this;return or.handleOperation(async()=>await get(or.fetch,`${or.url}/bucket/${ar}`,{headers:or.headers}))}async createBucket(ar,or={public:!1}){var lr=this;return lr.handleOperation(async()=>await post(lr.fetch,`${lr.url}/bucket`,{id:ar,name:ar,type:or.type,public:or.public,file_size_limit:or.fileSizeLimit,allowed_mime_types:or.allowedMimeTypes},{headers:lr.headers}))}async updateBucket(ar,or){var lr=this;return lr.handleOperation(async()=>await put(lr.fetch,`${lr.url}/bucket/${ar}`,{id:ar,name:ar,public:or.public,file_size_limit:or.fileSizeLimit,allowed_mime_types:or.allowedMimeTypes},{headers:lr.headers}))}async emptyBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/bucket/${ar}/empty`,{},{headers:or.headers}))}async deleteBucket(ar){var or=this;return or.handleOperation(async()=>await remove(or.fetch,`${or.url}/bucket/${ar}`,{},{headers:or.headers}))}listBucketOptionsToQueryString(ar){const or={};return ar&&("limit"in ar&&(or.limit=String(ar.limit)),"offset"in ar&&(or.offset=String(ar.offset)),ar.search&&(or.search=ar.search),ar.sortColumn&&(or.sortColumn=ar.sortColumn),ar.sortOrder&&(or.sortOrder=ar.sortOrder)),Object.keys(or).length>0?"?"+new URLSearchParams(or).toString():""}},StorageAnalyticsClient=class extends BaseApiClient{constructor(ar,or={},lr){const cr=ar.replace(/\/$/,""),ur=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),or);super(cr,ur,lr,"storage")}async createBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/bucket`,{name:ar},{headers:or.headers}))}async listBuckets(ar){var or=this;return or.handleOperation(async()=>{const lr=new URLSearchParams;(ar==null?void 0:ar.limit)!==void 0&&lr.set("limit",ar.limit.toString()),(ar==null?void 0:ar.offset)!==void 0&&lr.set("offset",ar.offset.toString()),ar!=null&&ar.sortColumn&&lr.set("sortColumn",ar.sortColumn),ar!=null&&ar.sortOrder&&lr.set("sortOrder",ar.sortOrder),ar!=null&&ar.search&&lr.set("search",ar.search);const cr=lr.toString(),ur=cr?`${or.url}/bucket?${cr}`:`${or.url}/bucket`;return await get(or.fetch,ur,{headers:or.headers})})}async deleteBucket(ar){var or=this;return or.handleOperation(async()=>await remove(or.fetch,`${or.url}/bucket/${ar}`,{},{headers:or.headers}))}from(ar){var or=this;if(!isValidBucketName(ar))throw new StorageError("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const lr=new IcebergRestCatalog({baseUrl:this.url,catalogName:ar,auth:{type:"custom",getHeaders:async()=>or.headers},fetch:this.fetch}),cr=this.shouldThrowOnError;return new Proxy(lr,{get(ur,dr){const hr=ur[dr];return typeof hr!="function"?hr:async(...pr)=>{try{return{data:await hr.apply(ur,pr),error:null}}catch(xr){if(cr)throw xr;return{data:null,error:xr}}}}})}},VectorIndexApi=class extends BaseApiClient{constructor(ar,or={},lr){const cr=ar.replace(/\/$/,""),ur=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),{},{"Content-Type":"application/json"},or);super(cr,ur,lr,"vectors")}async createIndex(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/CreateIndex`,ar,{headers:or.headers})||{})}async getIndex(ar,or){var lr=this;return lr.handleOperation(async()=>await post(lr.fetch,`${lr.url}/GetIndex`,{vectorBucketName:ar,indexName:or},{headers:lr.headers}))}async listIndexes(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/ListIndexes`,ar,{headers:or.headers}))}async deleteIndex(ar,or){var lr=this;return lr.handleOperation(async()=>await post(lr.fetch,`${lr.url}/DeleteIndex`,{vectorBucketName:ar,indexName:or},{headers:lr.headers})||{})}},VectorDataApi=class extends BaseApiClient{constructor(ar,or={},lr){const cr=ar.replace(/\/$/,""),ur=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),{},{"Content-Type":"application/json"},or);super(cr,ur,lr,"vectors")}async putVectors(ar){var or=this;if(ar.vectors.length<1||ar.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return or.handleOperation(async()=>await post(or.fetch,`${or.url}/PutVectors`,ar,{headers:or.headers})||{})}async getVectors(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/GetVectors`,ar,{headers:or.headers}))}async listVectors(ar){var or=this;if(ar.segmentCount!==void 0){if(ar.segmentCount<1||ar.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(ar.segmentIndex!==void 0&&(ar.segmentIndex<0||ar.segmentIndex>=ar.segmentCount))throw new Error(`segmentIndex must be between 0 and ${ar.segmentCount-1}`)}return or.handleOperation(async()=>await post(or.fetch,`${or.url}/ListVectors`,ar,{headers:or.headers}))}async queryVectors(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/QueryVectors`,ar,{headers:or.headers}))}async deleteVectors(ar){var or=this;if(ar.keys.length<1||ar.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return or.handleOperation(async()=>await post(or.fetch,`${or.url}/DeleteVectors`,ar,{headers:or.headers})||{})}},VectorBucketApi=class extends BaseApiClient{constructor(ar,or={},lr){const cr=ar.replace(/\/$/,""),ur=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),{},{"Content-Type":"application/json"},or);super(cr,ur,lr,"vectors")}async createBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/CreateVectorBucket`,{vectorBucketName:ar},{headers:or.headers})||{})}async getBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/GetVectorBucket`,{vectorBucketName:ar},{headers:or.headers}))}async listBuckets(ar={}){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/ListVectorBuckets`,ar,{headers:or.headers}))}async deleteBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/DeleteVectorBucket`,{vectorBucketName:ar},{headers:or.headers})||{})}},StorageVectorsClient=class extends VectorBucketApi{constructor(ar,or={}){super(ar,or.headers||{},or.fetch)}from(ar){return new VectorBucketScope(this.url,this.headers,ar,this.fetch)}async createBucket(ar){var or=()=>super.createBucket,lr=this;return or().call(lr,ar)}async getBucket(ar){var or=()=>super.getBucket,lr=this;return or().call(lr,ar)}async listBuckets(ar={}){var or=()=>super.listBuckets,lr=this;return or().call(lr,ar)}async deleteBucket(ar){var or=()=>super.deleteBucket,lr=this;return or().call(lr,ar)}},VectorBucketScope=class extends VectorIndexApi{constructor(ar,or,lr,cr){super(ar,or,cr),this.vectorBucketName=lr}async createIndex(ar){var or=()=>super.createIndex,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName}))}async listIndexes(ar={}){var or=()=>super.listIndexes,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName}))}async getIndex(ar){var or=()=>super.getIndex,lr=this;return or().call(lr,lr.vectorBucketName,ar)}async deleteIndex(ar){var or=()=>super.deleteIndex,lr=this;return or().call(lr,lr.vectorBucketName,ar)}index(ar){return new VectorIndexScope(this.url,this.headers,this.vectorBucketName,ar,this.fetch)}},VectorIndexScope=class extends VectorDataApi{constructor(ar,or,lr,cr,ur){super(ar,or,ur),this.vectorBucketName=lr,this.indexName=cr}async putVectors(ar){var or=()=>super.putVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}async getVectors(ar){var or=()=>super.getVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}async listVectors(ar={}){var or=()=>super.listVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}async queryVectors(ar){var or=()=>super.queryVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}async deleteVectors(ar){var or=()=>super.deleteVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}},StorageClient=class extends StorageBucketApi{constructor(ar,or={},lr,cr){super(ar,or,lr,cr)}from(ar){return new StorageFileApi(this.url,this.headers,ar,this.fetch)}get vectors(){return new StorageVectorsClient(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new StorageAnalyticsClient(this.url+"/iceberg",this.headers,this.fetch)}};const version$1="2.93.1",AUTO_REFRESH_TICK_DURATION_MS=30*1e3,AUTO_REFRESH_TICK_THRESHOLD=3,EXPIRY_MARGIN_MS=AUTO_REFRESH_TICK_THRESHOLD*AUTO_REFRESH_TICK_DURATION_MS,GOTRUE_URL="http://localhost:9999",STORAGE_KEY="supabase.auth.token",DEFAULT_HEADERS$1={"X-Client-Info":`gotrue-js/${version$1}`},API_VERSION_HEADER_NAME="X-Supabase-Api-Version",API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},BASE64URL_REGEX=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,JWKS_TTL=10*60*1e3;class AuthError extends Error{constructor(or,lr,cr){super(or),this.__isAuthError=!0,this.name="AuthError",this.status=lr,this.code=cr}}function isAuthError(ar){return typeof ar=="object"&&ar!==null&&"__isAuthError"in ar}class AuthApiError extends AuthError{constructor(or,lr,cr){super(or,lr,cr),this.name="AuthApiError",this.status=lr,this.code=cr}}function isAuthApiError(ar){return isAuthError(ar)&&ar.name==="AuthApiError"}class AuthUnknownError extends AuthError{constructor(or,lr){super(or),this.name="AuthUnknownError",this.originalError=lr}}class CustomAuthError extends AuthError{constructor(or,lr,cr,ur){super(or,cr,ur),this.name=lr,this.status=cr}}class AuthSessionMissingError extends CustomAuthError{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function isAuthSessionMissingError(ar){return isAuthError(ar)&&ar.name==="AuthSessionMissingError"}class AuthInvalidTokenResponseError extends CustomAuthError{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class AuthInvalidCredentialsError extends CustomAuthError{constructor(or){super(or,"AuthInvalidCredentialsError",400,void 0)}}class AuthImplicitGrantRedirectError extends CustomAuthError{constructor(or,lr=null){super(or,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=lr}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function isAuthImplicitGrantRedirectError(ar){return isAuthError(ar)&&ar.name==="AuthImplicitGrantRedirectError"}class AuthPKCEGrantCodeExchangeError extends CustomAuthError{constructor(or,lr=null){super(or,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=lr}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthPKCECodeVerifierMissingError extends CustomAuthError{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class AuthRetryableFetchError extends CustomAuthError{constructor(or,lr){super(or,"AuthRetryableFetchError",lr,void 0)}}function isAuthRetryableFetchError(ar){return isAuthError(ar)&&ar.name==="AuthRetryableFetchError"}class AuthWeakPasswordError extends CustomAuthError{constructor(or,lr,cr){super(or,"AuthWeakPasswordError",lr,"weak_password"),this.reasons=cr}}class AuthInvalidJwtError extends CustomAuthError{constructor(or){super(or,"AuthInvalidJwtError",400,"invalid_jwt")}}const TO_BASE64URL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),IGNORE_BASE64URL=` 	
\r=`.split(""),FROM_BASE64URL=(()=>{const ar=new Array(128);for(let or=0;or<ar.length;or+=1)ar[or]=-1;for(let or=0;or<IGNORE_BASE64URL.length;or+=1)ar[IGNORE_BASE64URL[or].charCodeAt(0)]=-2;for(let or=0;or<TO_BASE64URL.length;or+=1)ar[TO_BASE64URL[or].charCodeAt(0)]=or;return ar})();function byteToBase64URL(ar,or,lr){if(ar!==null)for(or.queue=or.queue<<8|ar,or.queuedBits+=8;or.queuedBits>=6;){const cr=or.queue>>or.queuedBits-6&63;lr(TO_BASE64URL[cr]),or.queuedBits-=6}else if(or.queuedBits>0)for(or.queue=or.queue<<6-or.queuedBits,or.queuedBits=6;or.queuedBits>=6;){const cr=or.queue>>or.queuedBits-6&63;lr(TO_BASE64URL[cr]),or.queuedBits-=6}}function byteFromBase64URL(ar,or,lr){const cr=FROM_BASE64URL[ar];if(cr>-1)for(or.queue=or.queue<<6|cr,or.queuedBits+=6;or.queuedBits>=8;)lr(or.queue>>or.queuedBits-8&255),or.queuedBits-=8;else{if(cr===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(ar)}"`)}}function stringFromBase64URL(ar){const or=[],lr=hr=>{or.push(String.fromCodePoint(hr))},cr={utf8seq:0,codepoint:0},ur={queue:0,queuedBits:0},dr=hr=>{stringFromUTF8(hr,cr,lr)};for(let hr=0;hr<ar.length;hr+=1)byteFromBase64URL(ar.charCodeAt(hr),ur,dr);return or.join("")}function codepointToUTF8(ar,or){if(ar<=127){or(ar);return}else if(ar<=2047){or(192|ar>>6),or(128|ar&63);return}else if(ar<=65535){or(224|ar>>12),or(128|ar>>6&63),or(128|ar&63);return}else if(ar<=1114111){or(240|ar>>18),or(128|ar>>12&63),or(128|ar>>6&63),or(128|ar&63);return}throw new Error(`Unrecognized Unicode codepoint: ${ar.toString(16)}`)}function stringToUTF8(ar,or){for(let lr=0;lr<ar.length;lr+=1){let cr=ar.charCodeAt(lr);if(cr>55295&&cr<=56319){const ur=(cr-55296)*1024&65535;cr=(ar.charCodeAt(lr+1)-56320&65535|ur)+65536,lr+=1}codepointToUTF8(cr,or)}}function stringFromUTF8(ar,or,lr){if(or.utf8seq===0){if(ar<=127){lr(ar);return}for(let cr=1;cr<6;cr+=1)if(!(ar>>7-cr&1)){or.utf8seq=cr;break}if(or.utf8seq===2)or.codepoint=ar&31;else if(or.utf8seq===3)or.codepoint=ar&15;else if(or.utf8seq===4)or.codepoint=ar&7;else throw new Error("Invalid UTF-8 sequence");or.utf8seq-=1}else if(or.utf8seq>0){if(ar<=127)throw new Error("Invalid UTF-8 sequence");or.codepoint=or.codepoint<<6|ar&63,or.utf8seq-=1,or.utf8seq===0&&lr(or.codepoint)}}function base64UrlToUint8Array(ar){const or=[],lr={queue:0,queuedBits:0},cr=ur=>{or.push(ur)};for(let ur=0;ur<ar.length;ur+=1)byteFromBase64URL(ar.charCodeAt(ur),lr,cr);return new Uint8Array(or)}function stringToUint8Array(ar){const or=[];return stringToUTF8(ar,lr=>or.push(lr)),new Uint8Array(or)}function bytesToBase64URL(ar){const or=[],lr={queue:0,queuedBits:0},cr=ur=>{or.push(ur)};return ar.forEach(ur=>byteToBase64URL(ur,lr,cr)),byteToBase64URL(null,lr,cr),or.join("")}function expiresAt(ar){return Math.round(Date.now()/1e3)+ar}function generateCallbackId(){return Symbol("auth-callback")}const isBrowser=()=>typeof window<"u"&&typeof document<"u",localStorageWriteTests={tested:!1,writable:!1},supportsLocalStorage=()=>{if(!isBrowser())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(localStorageWriteTests.tested)return localStorageWriteTests.writable;const ar=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(ar,ar),globalThis.localStorage.removeItem(ar),localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!0}catch{localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!1}return localStorageWriteTests.writable};function parseParametersFromURL(ar){const or={},lr=new URL(ar);if(lr.hash&&lr.hash[0]==="#")try{new URLSearchParams(lr.hash.substring(1)).forEach((ur,dr)=>{or[dr]=ur})}catch{}return lr.searchParams.forEach((cr,ur)=>{or[ur]=cr}),or}const resolveFetch$1=ar=>ar?(...or)=>ar(...or):(...or)=>fetch(...or),looksLikeFetchResponse=ar=>typeof ar=="object"&&ar!==null&&"status"in ar&&"ok"in ar&&"json"in ar&&typeof ar.json=="function",setItemAsync=async(ar,or,lr)=>{await ar.setItem(or,JSON.stringify(lr))},getItemAsync=async(ar,or)=>{const lr=await ar.getItem(or);if(!lr)return null;try{return JSON.parse(lr)}catch{return lr}},removeItemAsync=async(ar,or)=>{await ar.removeItem(or)};class Deferred{constructor(){this.promise=new Deferred.promiseConstructor((or,lr)=>{this.resolve=or,this.reject=lr})}}Deferred.promiseConstructor=Promise;function decodeJWT(ar){const or=ar.split(".");if(or.length!==3)throw new AuthInvalidJwtError("Invalid JWT structure");for(let cr=0;cr<or.length;cr++)if(!BASE64URL_REGEX.test(or[cr]))throw new AuthInvalidJwtError("JWT not in base64url format");return{header:JSON.parse(stringFromBase64URL(or[0])),payload:JSON.parse(stringFromBase64URL(or[1])),signature:base64UrlToUint8Array(or[2]),raw:{header:or[0],payload:or[1]}}}async function sleep(ar){return await new Promise(or=>{setTimeout(()=>or(null),ar)})}function retryable(ar,or){return new Promise((cr,ur)=>{(async()=>{for(let dr=0;dr<1/0;dr++)try{const hr=await ar(dr);if(!or(dr,null,hr)){cr(hr);return}}catch(hr){if(!or(dr,hr)){ur(hr);return}}})()})}function dec2hex(ar){return("0"+ar.toString(16)).substr(-2)}function generatePKCEVerifier(){const or=new Uint32Array(56);if(typeof crypto>"u"){const lr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",cr=lr.length;let ur="";for(let dr=0;dr<56;dr++)ur+=lr.charAt(Math.floor(Math.random()*cr));return ur}return crypto.getRandomValues(or),Array.from(or,dec2hex).join("")}async function sha256(ar){const lr=new TextEncoder().encode(ar),cr=await crypto.subtle.digest("SHA-256",lr),ur=new Uint8Array(cr);return Array.from(ur).map(dr=>String.fromCharCode(dr)).join("")}async function generatePKCEChallenge(ar){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),ar;const lr=await sha256(ar);return btoa(lr).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function getCodeChallengeAndMethod(ar,or,lr=!1){const cr=generatePKCEVerifier();let ur=cr;lr&&(ur+="/PASSWORD_RECOVERY"),await setItemAsync(ar,`${or}-code-verifier`,ur);const dr=await generatePKCEChallenge(cr);return[dr,cr===dr?"plain":"s256"]}const API_VERSION_REGEX=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function parseResponseAPIVersion(ar){const or=ar.headers.get(API_VERSION_HEADER_NAME);if(!or||!or.match(API_VERSION_REGEX))return null;try{return new Date(`${or}T00:00:00.0Z`)}catch{return null}}function validateExp(ar){if(!ar)throw new Error("Missing exp claim");const or=Math.floor(Date.now()/1e3);if(ar<=or)throw new Error("JWT has expired")}function getAlgorithm(ar){switch(ar){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const UUID_REGEX=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function validateUUID(ar){if(!UUID_REGEX.test(ar))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function userNotAvailableProxy(){const ar={};return new Proxy(ar,{get:(or,lr)=>{if(lr==="__isUserNotAvailableProxy")return!0;if(typeof lr=="symbol"){const cr=lr.toString();if(cr==="Symbol(Symbol.toPrimitive)"||cr==="Symbol(Symbol.toStringTag)"||cr==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${lr}" property of the session object is not supported. Please use getUser() instead.`)},set:(or,lr)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${lr}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(or,lr)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${lr}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function insecureUserWarningProxy(ar,or){return new Proxy(ar,{get:(lr,cr,ur)=>{if(cr==="__isInsecureUserWarningProxy")return!0;if(typeof cr=="symbol"){const dr=cr.toString();if(dr==="Symbol(Symbol.toPrimitive)"||dr==="Symbol(Symbol.toStringTag)"||dr==="Symbol(util.inspect.custom)"||dr==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(lr,cr,ur)}return!or.value&&typeof cr=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),or.value=!0),Reflect.get(lr,cr,ur)}})}function deepClone(ar){return JSON.parse(JSON.stringify(ar))}const _getErrorMessage=ar=>ar.msg||ar.message||ar.error_description||ar.error||JSON.stringify(ar),NETWORK_ERROR_CODES=[502,503,504];async function handleError(ar){var or;if(!looksLikeFetchResponse(ar))throw new AuthRetryableFetchError(_getErrorMessage(ar),0);if(NETWORK_ERROR_CODES.includes(ar.status))throw new AuthRetryableFetchError(_getErrorMessage(ar),ar.status);let lr;try{lr=await ar.json()}catch(dr){throw new AuthUnknownError(_getErrorMessage(dr),dr)}let cr;const ur=parseResponseAPIVersion(ar);if(ur&&ur.getTime()>=API_VERSIONS["2024-01-01"].timestamp&&typeof lr=="object"&&lr&&typeof lr.code=="string"?cr=lr.code:typeof lr=="object"&&lr&&typeof lr.error_code=="string"&&(cr=lr.error_code),cr){if(cr==="weak_password")throw new AuthWeakPasswordError(_getErrorMessage(lr),ar.status,((or=lr.weak_password)===null||or===void 0?void 0:or.reasons)||[]);if(cr==="session_not_found")throw new AuthSessionMissingError}else if(typeof lr=="object"&&lr&&typeof lr.weak_password=="object"&&lr.weak_password&&Array.isArray(lr.weak_password.reasons)&&lr.weak_password.reasons.length&&lr.weak_password.reasons.reduce((dr,hr)=>dr&&typeof hr=="string",!0))throw new AuthWeakPasswordError(_getErrorMessage(lr),ar.status,lr.weak_password.reasons);throw new AuthApiError(_getErrorMessage(lr),ar.status||500,cr)}const _getRequestParams=(ar,or,lr,cr)=>{const ur={method:ar,headers:(or==null?void 0:or.headers)||{}};return ar==="GET"?ur:(ur.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},or==null?void 0:or.headers),ur.body=JSON.stringify(cr),Object.assign(Object.assign({},ur),lr))};async function _request(ar,or,lr,cr){var ur;const dr=Object.assign({},cr==null?void 0:cr.headers);dr[API_VERSION_HEADER_NAME]||(dr[API_VERSION_HEADER_NAME]=API_VERSIONS["2024-01-01"].name),cr!=null&&cr.jwt&&(dr.Authorization=`Bearer ${cr.jwt}`);const hr=(ur=cr==null?void 0:cr.query)!==null&&ur!==void 0?ur:{};cr!=null&&cr.redirectTo&&(hr.redirect_to=cr.redirectTo);const pr=Object.keys(hr).length?"?"+new URLSearchParams(hr).toString():"",xr=await _handleRequest(ar,or,lr+pr,{headers:dr,noResolveJson:cr==null?void 0:cr.noResolveJson},{},cr==null?void 0:cr.body);return cr!=null&&cr.xform?cr==null?void 0:cr.xform(xr):{data:Object.assign({},xr),error:null}}async function _handleRequest(ar,or,lr,cr,ur,dr){const hr=_getRequestParams(or,cr,ur,dr);let pr;try{pr=await ar(lr,Object.assign({},hr))}catch(xr){throw console.error(xr),new AuthRetryableFetchError(_getErrorMessage(xr),0)}if(pr.ok||await handleError(pr),cr!=null&&cr.noResolveJson)return pr;try{return await pr.json()}catch(xr){await handleError(xr)}}function _sessionResponse(ar){var or;let lr=null;hasSession(ar)&&(lr=Object.assign({},ar),ar.expires_at||(lr.expires_at=expiresAt(ar.expires_in)));const cr=(or=ar.user)!==null&&or!==void 0?or:ar;return{data:{session:lr,user:cr},error:null}}function _sessionResponsePassword(ar){const or=_sessionResponse(ar);return!or.error&&ar.weak_password&&typeof ar.weak_password=="object"&&Array.isArray(ar.weak_password.reasons)&&ar.weak_password.reasons.length&&ar.weak_password.message&&typeof ar.weak_password.message=="string"&&ar.weak_password.reasons.reduce((lr,cr)=>lr&&typeof cr=="string",!0)&&(or.data.weak_password=ar.weak_password),or}function _userResponse(ar){var or;return{data:{user:(or=ar.user)!==null&&or!==void 0?or:ar},error:null}}function _ssoResponse(ar){return{data:ar,error:null}}function _generateLinkResponse(ar){const{action_link:or,email_otp:lr,hashed_token:cr,redirect_to:ur,verification_type:dr}=ar,hr=__rest(ar,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),pr={action_link:or,email_otp:lr,hashed_token:cr,redirect_to:ur,verification_type:dr},xr=Object.assign({},hr);return{data:{properties:pr,user:xr},error:null}}function _noResolveJsonResponse(ar){return ar}function hasSession(ar){return ar.access_token&&ar.refresh_token&&ar.expires_in}const SIGN_OUT_SCOPES=["global","local","others"];class GoTrueAdminApi{constructor({url:or="",headers:lr={},fetch:cr}){this.url=or,this.headers=lr,this.fetch=resolveFetch$1(cr),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(or,lr=SIGN_OUT_SCOPES[0]){if(SIGN_OUT_SCOPES.indexOf(lr)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${SIGN_OUT_SCOPES.join(", ")}`);try{return await _request(this.fetch,"POST",`${this.url}/logout?scope=${lr}`,{headers:this.headers,jwt:or,noResolveJson:!0}),{data:null,error:null}}catch(cr){if(isAuthError(cr))return{data:null,error:cr};throw cr}}async inviteUserByEmail(or,lr={}){try{return await _request(this.fetch,"POST",`${this.url}/invite`,{body:{email:or,data:lr.data},headers:this.headers,redirectTo:lr.redirectTo,xform:_userResponse})}catch(cr){if(isAuthError(cr))return{data:{user:null},error:cr};throw cr}}async generateLink(or){try{const{options:lr}=or,cr=__rest(or,["options"]),ur=Object.assign(Object.assign({},cr),lr);return"newEmail"in cr&&(ur.new_email=cr==null?void 0:cr.newEmail,delete ur.newEmail),await _request(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:ur,headers:this.headers,xform:_generateLinkResponse,redirectTo:lr==null?void 0:lr.redirectTo})}catch(lr){if(isAuthError(lr))return{data:{properties:null,user:null},error:lr};throw lr}}async createUser(or){try{return await _request(this.fetch,"POST",`${this.url}/admin/users`,{body:or,headers:this.headers,xform:_userResponse})}catch(lr){if(isAuthError(lr))return{data:{user:null},error:lr};throw lr}}async listUsers(or){var lr,cr,ur,dr,hr,pr,xr;try{const mr={nextPage:null,lastPage:0,total:0},fr=await _request(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(cr=(lr=or==null?void 0:or.page)===null||lr===void 0?void 0:lr.toString())!==null&&cr!==void 0?cr:"",per_page:(dr=(ur=or==null?void 0:or.perPage)===null||ur===void 0?void 0:ur.toString())!==null&&dr!==void 0?dr:""},xform:_noResolveJsonResponse});if(fr.error)throw fr.error;const Er=await fr.json(),vr=(hr=fr.headers.get("x-total-count"))!==null&&hr!==void 0?hr:0,gr=(xr=(pr=fr.headers.get("link"))===null||pr===void 0?void 0:pr.split(","))!==null&&xr!==void 0?xr:[];return gr.length>0&&(gr.forEach(yr=>{const jr=parseInt(yr.split(";")[0].split("=")[1].substring(0,1)),br=JSON.parse(yr.split(";")[1].split("=")[1]);mr[`${br}Page`]=jr}),mr.total=parseInt(vr)),{data:Object.assign(Object.assign({},Er),mr),error:null}}catch(mr){if(isAuthError(mr))return{data:{users:[]},error:mr};throw mr}}async getUserById(or){validateUUID(or);try{return await _request(this.fetch,"GET",`${this.url}/admin/users/${or}`,{headers:this.headers,xform:_userResponse})}catch(lr){if(isAuthError(lr))return{data:{user:null},error:lr};throw lr}}async updateUserById(or,lr){validateUUID(or);try{return await _request(this.fetch,"PUT",`${this.url}/admin/users/${or}`,{body:lr,headers:this.headers,xform:_userResponse})}catch(cr){if(isAuthError(cr))return{data:{user:null},error:cr};throw cr}}async deleteUser(or,lr=!1){validateUUID(or);try{return await _request(this.fetch,"DELETE",`${this.url}/admin/users/${or}`,{headers:this.headers,body:{should_soft_delete:lr},xform:_userResponse})}catch(cr){if(isAuthError(cr))return{data:{user:null},error:cr};throw cr}}async _listFactors(or){validateUUID(or.userId);try{const{data:lr,error:cr}=await _request(this.fetch,"GET",`${this.url}/admin/users/${or.userId}/factors`,{headers:this.headers,xform:ur=>({data:{factors:ur},error:null})});return{data:lr,error:cr}}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _deleteFactor(or){validateUUID(or.userId),validateUUID(or.id);try{return{data:await _request(this.fetch,"DELETE",`${this.url}/admin/users/${or.userId}/factors/${or.id}`,{headers:this.headers}),error:null}}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _listOAuthClients(or){var lr,cr,ur,dr,hr,pr,xr;try{const mr={nextPage:null,lastPage:0,total:0},fr=await _request(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(cr=(lr=or==null?void 0:or.page)===null||lr===void 0?void 0:lr.toString())!==null&&cr!==void 0?cr:"",per_page:(dr=(ur=or==null?void 0:or.perPage)===null||ur===void 0?void 0:ur.toString())!==null&&dr!==void 0?dr:""},xform:_noResolveJsonResponse});if(fr.error)throw fr.error;const Er=await fr.json(),vr=(hr=fr.headers.get("x-total-count"))!==null&&hr!==void 0?hr:0,gr=(xr=(pr=fr.headers.get("link"))===null||pr===void 0?void 0:pr.split(","))!==null&&xr!==void 0?xr:[];return gr.length>0&&(gr.forEach(yr=>{const jr=parseInt(yr.split(";")[0].split("=")[1].substring(0,1)),br=JSON.parse(yr.split(";")[1].split("=")[1]);mr[`${br}Page`]=jr}),mr.total=parseInt(vr)),{data:Object.assign(Object.assign({},Er),mr),error:null}}catch(mr){if(isAuthError(mr))return{data:{clients:[]},error:mr};throw mr}}async _createOAuthClient(or){try{return await _request(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:or,headers:this.headers,xform:lr=>({data:lr,error:null})})}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _getOAuthClient(or){try{return await _request(this.fetch,"GET",`${this.url}/admin/oauth/clients/${or}`,{headers:this.headers,xform:lr=>({data:lr,error:null})})}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _updateOAuthClient(or,lr){try{return await _request(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${or}`,{body:lr,headers:this.headers,xform:cr=>({data:cr,error:null})})}catch(cr){if(isAuthError(cr))return{data:null,error:cr};throw cr}}async _deleteOAuthClient(or){try{return await _request(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${or}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _regenerateOAuthClientSecret(or){try{return await _request(this.fetch,"POST",`${this.url}/admin/oauth/clients/${or}/regenerate_secret`,{headers:this.headers,xform:lr=>({data:lr,error:null})})}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}}function memoryLocalStorageAdapter(ar={}){return{getItem:or=>ar[or]||null,setItem:(or,lr)=>{ar[or]=lr},removeItem:or=>{delete ar[or]}}}const internals={debug:!!(globalThis&&supportsLocalStorage()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class LockAcquireTimeoutError extends Error{constructor(or){super(or),this.isAcquireTimeout=!0}}class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError{}async function navigatorLock(ar,or,lr){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",ar,or);const cr=new globalThis.AbortController;return or>0&&setTimeout(()=>{cr.abort(),internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",ar)},or),await Promise.resolve().then(()=>globalThis.navigator.locks.request(ar,or===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:cr.signal},async ur=>{if(ur){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",ar,ur.name);try{return await lr()}finally{internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",ar,ur.name)}}else{if(or===0)throw internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",ar),new NavigatorLockAcquireTimeoutError(`Acquiring an exclusive Navigator LockManager lock "${ar}" immediately failed`);if(internals.debug)try{const dr=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(dr,null,"  "))}catch(dr){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",dr)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await lr()}}))}function polyfillGlobalThis(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function getAddress(ar){if(!/^0x[a-fA-F0-9]{40}$/.test(ar))throw new Error(`@supabase/auth-js: Address "${ar}" is invalid.`);return ar.toLowerCase()}function fromHex(ar){return parseInt(ar,16)}function toHex(ar){const or=new TextEncoder().encode(ar);return"0x"+Array.from(or,cr=>cr.toString(16).padStart(2,"0")).join("")}function createSiweMessage(ar){var or;const{chainId:lr,domain:cr,expirationTime:ur,issuedAt:dr=new Date,nonce:hr,notBefore:pr,requestId:xr,resources:mr,scheme:fr,uri:Er,version:vr}=ar;{if(!Number.isInteger(lr))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${lr}`);if(!cr)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(hr&&hr.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${hr}`);if(!Er)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(vr!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${vr}`);if(!((or=ar.statement)===null||or===void 0)&&or.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${ar.statement}`)}const gr=getAddress(ar.address),yr=fr?`${fr}://${cr}`:cr,jr=ar.statement?`${ar.statement}
`:"",br=`${yr} wants you to sign in with your Ethereum account:
${gr}

${jr}`;let _r=`URI: ${Er}
Version: ${vr}
Chain ID: ${lr}${hr?`
Nonce: ${hr}`:""}
Issued At: ${dr.toISOString()}`;if(ur&&(_r+=`
Expiration Time: ${ur.toISOString()}`),pr&&(_r+=`
Not Before: ${pr.toISOString()}`),xr&&(_r+=`
Request ID: ${xr}`),mr){let wr=`
Resources:`;for(const Rr of mr){if(!Rr||typeof Rr!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${Rr}`);wr+=`
- ${Rr}`}_r+=wr}return`${br}
${_r}`}class WebAuthnError extends Error{constructor({message:or,code:lr,cause:cr,name:ur}){var dr;super(or,{cause:cr}),this.__isWebAuthnError=!0,this.name=(dr=ur??(cr instanceof Error?cr.name:void 0))!==null&&dr!==void 0?dr:"Unknown Error",this.code=lr}}class WebAuthnUnknownError extends WebAuthnError{constructor(or,lr){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:lr,message:or}),this.name="WebAuthnUnknownError",this.originalError=lr}}function identifyRegistrationError({error:ar,options:or}){var lr,cr,ur;const{publicKey:dr}=or;if(!dr)throw Error("options was missing required publicKey property");if(ar.name==="AbortError"){if(or.signal instanceof AbortSignal)return new WebAuthnError({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:ar})}else if(ar.name==="ConstraintError"){if(((lr=dr.authenticatorSelection)===null||lr===void 0?void 0:lr.requireResidentKey)===!0)return new WebAuthnError({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:ar});if(or.mediation==="conditional"&&((cr=dr.authenticatorSelection)===null||cr===void 0?void 0:cr.userVerification)==="required")return new WebAuthnError({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:ar});if(((ur=dr.authenticatorSelection)===null||ur===void 0?void 0:ur.userVerification)==="required")return new WebAuthnError({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:ar})}else{if(ar.name==="InvalidStateError")return new WebAuthnError({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:ar});if(ar.name==="NotAllowedError")return new WebAuthnError({message:ar.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:ar});if(ar.name==="NotSupportedError")return dr.pubKeyCredParams.filter(pr=>pr.type==="public-key").length===0?new WebAuthnError({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:ar}):new WebAuthnError({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:ar});if(ar.name==="SecurityError"){const hr=window.location.hostname;if(isValidDomain(hr)){if(dr.rp.id!==hr)return new WebAuthnError({message:`The RP ID "${dr.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:ar})}else return new WebAuthnError({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:ar})}else if(ar.name==="TypeError"){if(dr.user.id.byteLength<1||dr.user.id.byteLength>64)return new WebAuthnError({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:ar})}else if(ar.name==="UnknownError")return new WebAuthnError({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:ar})}return new WebAuthnError({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:ar})}function identifyAuthenticationError({error:ar,options:or}){const{publicKey:lr}=or;if(!lr)throw Error("options was missing required publicKey property");if(ar.name==="AbortError"){if(or.signal instanceof AbortSignal)return new WebAuthnError({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:ar})}else{if(ar.name==="NotAllowedError")return new WebAuthnError({message:ar.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:ar});if(ar.name==="SecurityError"){const cr=window.location.hostname;if(isValidDomain(cr)){if(lr.rpId!==cr)return new WebAuthnError({message:`The RP ID "${lr.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:ar})}else return new WebAuthnError({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:ar})}else if(ar.name==="UnknownError")return new WebAuthnError({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:ar})}return new WebAuthnError({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:ar})}class WebAuthnAbortService{createNewAbortSignal(){if(this.controller){const lr=new Error("Cancelling existing WebAuthn API call for new one");lr.name="AbortError",this.controller.abort(lr)}const or=new AbortController;return this.controller=or,or.signal}cancelCeremony(){if(this.controller){const or=new Error("Manually cancelling existing WebAuthn API call");or.name="AbortError",this.controller.abort(or),this.controller=void 0}}}const webAuthnAbortService=new WebAuthnAbortService;function deserializeCredentialCreationOptions(ar){if(!ar)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(ar);const{challenge:or,user:lr,excludeCredentials:cr}=ar,ur=__rest(ar,["challenge","user","excludeCredentials"]),dr=base64UrlToUint8Array(or).buffer,hr=Object.assign(Object.assign({},lr),{id:base64UrlToUint8Array(lr.id).buffer}),pr=Object.assign(Object.assign({},ur),{challenge:dr,user:hr});if(cr&&cr.length>0){pr.excludeCredentials=new Array(cr.length);for(let xr=0;xr<cr.length;xr++){const mr=cr[xr];pr.excludeCredentials[xr]=Object.assign(Object.assign({},mr),{id:base64UrlToUint8Array(mr.id).buffer,type:mr.type||"public-key",transports:mr.transports})}}return pr}function deserializeCredentialRequestOptions(ar){if(!ar)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(ar);const{challenge:or,allowCredentials:lr}=ar,cr=__rest(ar,["challenge","allowCredentials"]),ur=base64UrlToUint8Array(or).buffer,dr=Object.assign(Object.assign({},cr),{challenge:ur});if(lr&&lr.length>0){dr.allowCredentials=new Array(lr.length);for(let hr=0;hr<lr.length;hr++){const pr=lr[hr];dr.allowCredentials[hr]=Object.assign(Object.assign({},pr),{id:base64UrlToUint8Array(pr.id).buffer,type:pr.type||"public-key",transports:pr.transports})}}return dr}function serializeCredentialCreationResponse(ar){var or;if("toJSON"in ar&&typeof ar.toJSON=="function")return ar.toJSON();const lr=ar;return{id:ar.id,rawId:ar.id,response:{attestationObject:bytesToBase64URL(new Uint8Array(ar.response.attestationObject)),clientDataJSON:bytesToBase64URL(new Uint8Array(ar.response.clientDataJSON))},type:"public-key",clientExtensionResults:ar.getClientExtensionResults(),authenticatorAttachment:(or=lr.authenticatorAttachment)!==null&&or!==void 0?or:void 0}}function serializeCredentialRequestResponse(ar){var or;if("toJSON"in ar&&typeof ar.toJSON=="function")return ar.toJSON();const lr=ar,cr=ar.getClientExtensionResults(),ur=ar.response;return{id:ar.id,rawId:ar.id,response:{authenticatorData:bytesToBase64URL(new Uint8Array(ur.authenticatorData)),clientDataJSON:bytesToBase64URL(new Uint8Array(ur.clientDataJSON)),signature:bytesToBase64URL(new Uint8Array(ur.signature)),userHandle:ur.userHandle?bytesToBase64URL(new Uint8Array(ur.userHandle)):void 0},type:"public-key",clientExtensionResults:cr,authenticatorAttachment:(or=lr.authenticatorAttachment)!==null&&or!==void 0?or:void 0}}function isValidDomain(ar){return ar==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(ar)}function browserSupportsWebAuthn(){var ar,or;return!!(isBrowser()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((ar=navigator==null?void 0:navigator.credentials)===null||ar===void 0?void 0:ar.create)=="function"&&typeof((or=navigator==null?void 0:navigator.credentials)===null||or===void 0?void 0:or.get)=="function")}async function createCredential(ar){try{const or=await navigator.credentials.create(ar);return or?or instanceof PublicKeyCredential?{data:or,error:null}:{data:null,error:new WebAuthnUnknownError("Browser returned unexpected credential type",or)}:{data:null,error:new WebAuthnUnknownError("Empty credential response",or)}}catch(or){return{data:null,error:identifyRegistrationError({error:or,options:ar})}}}async function getCredential(ar){try{const or=await navigator.credentials.get(ar);return or?or instanceof PublicKeyCredential?{data:or,error:null}:{data:null,error:new WebAuthnUnknownError("Browser returned unexpected credential type",or)}:{data:null,error:new WebAuthnUnknownError("Empty credential response",or)}}catch(or){return{data:null,error:identifyAuthenticationError({error:or,options:ar})}}}const DEFAULT_CREATION_OPTIONS={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},DEFAULT_REQUEST_OPTIONS={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function deepMerge(...ar){const or=ur=>ur!==null&&typeof ur=="object"&&!Array.isArray(ur),lr=ur=>ur instanceof ArrayBuffer||ArrayBuffer.isView(ur),cr={};for(const ur of ar)if(ur)for(const dr in ur){const hr=ur[dr];if(hr!==void 0)if(Array.isArray(hr))cr[dr]=hr;else if(lr(hr))cr[dr]=hr;else if(or(hr)){const pr=cr[dr];or(pr)?cr[dr]=deepMerge(pr,hr):cr[dr]=deepMerge(hr)}else cr[dr]=hr}return cr}function mergeCredentialCreationOptions(ar,or){return deepMerge(DEFAULT_CREATION_OPTIONS,ar,or||{})}function mergeCredentialRequestOptions(ar,or){return deepMerge(DEFAULT_REQUEST_OPTIONS,ar,or||{})}class WebAuthnApi{constructor(or){this.client=or,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(or){return this.client.mfa.enroll(Object.assign(Object.assign({},or),{factorType:"webauthn"}))}async _challenge({factorId:or,webauthn:lr,friendlyName:cr,signal:ur},dr){try{const{data:hr,error:pr}=await this.client.mfa.challenge({factorId:or,webauthn:lr});if(!hr)return{data:null,error:pr};const xr=ur??webAuthnAbortService.createNewAbortSignal();if(hr.webauthn.type==="create"){const{user:mr}=hr.webauthn.credential_options.publicKey;mr.name||(mr.name=`${mr.id}:${cr}`),mr.displayName||(mr.displayName=mr.name)}switch(hr.webauthn.type){case"create":{const mr=mergeCredentialCreationOptions(hr.webauthn.credential_options.publicKey,dr==null?void 0:dr.create),{data:fr,error:Er}=await createCredential({publicKey:mr,signal:xr});return fr?{data:{factorId:or,challengeId:hr.id,webauthn:{type:hr.webauthn.type,credential_response:fr}},error:null}:{data:null,error:Er}}case"request":{const mr=mergeCredentialRequestOptions(hr.webauthn.credential_options.publicKey,dr==null?void 0:dr.request),{data:fr,error:Er}=await getCredential(Object.assign(Object.assign({},hr.webauthn.credential_options),{publicKey:mr,signal:xr}));return fr?{data:{factorId:or,challengeId:hr.id,webauthn:{type:hr.webauthn.type,credential_response:fr}},error:null}:{data:null,error:Er}}}}catch(hr){return isAuthError(hr)?{data:null,error:hr}:{data:null,error:new AuthUnknownError("Unexpected error in challenge",hr)}}}async _verify({challengeId:or,factorId:lr,webauthn:cr}){return this.client.mfa.verify({factorId:lr,challengeId:or,webauthn:cr})}async _authenticate({factorId:or,webauthn:{rpId:lr=typeof window<"u"?window.location.hostname:void 0,rpOrigins:cr=typeof window<"u"?[window.location.origin]:void 0,signal:ur}={}},dr){if(!lr)return{data:null,error:new AuthError("rpId is required for WebAuthn authentication")};try{if(!browserSupportsWebAuthn())return{data:null,error:new AuthUnknownError("Browser does not support WebAuthn",null)};const{data:hr,error:pr}=await this.challenge({factorId:or,webauthn:{rpId:lr,rpOrigins:cr},signal:ur},{request:dr});if(!hr)return{data:null,error:pr};const{webauthn:xr}=hr;return this._verify({factorId:or,challengeId:hr.challengeId,webauthn:{type:xr.type,rpId:lr,rpOrigins:cr,credential_response:xr.credential_response}})}catch(hr){return isAuthError(hr)?{data:null,error:hr}:{data:null,error:new AuthUnknownError("Unexpected error in authenticate",hr)}}}async _register({friendlyName:or,webauthn:{rpId:lr=typeof window<"u"?window.location.hostname:void 0,rpOrigins:cr=typeof window<"u"?[window.location.origin]:void 0,signal:ur}={}},dr){if(!lr)return{data:null,error:new AuthError("rpId is required for WebAuthn registration")};try{if(!browserSupportsWebAuthn())return{data:null,error:new AuthUnknownError("Browser does not support WebAuthn",null)};const{data:hr,error:pr}=await this._enroll({friendlyName:or});if(!hr)return await this.client.mfa.listFactors().then(fr=>{var Er;return(Er=fr.data)===null||Er===void 0?void 0:Er.all.find(vr=>vr.factor_type==="webauthn"&&vr.friendly_name===or&&vr.status!=="unverified")}).then(fr=>fr?this.client.mfa.unenroll({factorId:fr==null?void 0:fr.id}):void 0),{data:null,error:pr};const{data:xr,error:mr}=await this._challenge({factorId:hr.id,friendlyName:hr.friendly_name,webauthn:{rpId:lr,rpOrigins:cr},signal:ur},{create:dr});return xr?this._verify({factorId:hr.id,challengeId:xr.challengeId,webauthn:{rpId:lr,rpOrigins:cr,type:xr.webauthn.type,credential_response:xr.webauthn.credential_response}}):{data:null,error:mr}}catch(hr){return isAuthError(hr)?{data:null,error:hr}:{data:null,error:new AuthUnknownError("Unexpected error in register",hr)}}}}polyfillGlobalThis();const DEFAULT_OPTIONS={url:GOTRUE_URL,storageKey:STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:DEFAULT_HEADERS$1,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function lockNoOp(ar,or,lr){return await lr()}const GLOBAL_JWKS={};class GoTrueClient{get jwks(){var or,lr;return(lr=(or=GLOBAL_JWKS[this.storageKey])===null||or===void 0?void 0:or.jwks)!==null&&lr!==void 0?lr:{keys:[]}}set jwks(or){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{jwks:or})}get jwks_cached_at(){var or,lr;return(lr=(or=GLOBAL_JWKS[this.storageKey])===null||or===void 0?void 0:or.cachedAt)!==null&&lr!==void 0?lr:Number.MIN_SAFE_INTEGER}set jwks_cached_at(or){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{cachedAt:or})}constructor(or){var lr,cr,ur;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const dr=Object.assign(Object.assign({},DEFAULT_OPTIONS),or);if(this.storageKey=dr.storageKey,this.instanceID=(lr=GoTrueClient.nextInstanceID[this.storageKey])!==null&&lr!==void 0?lr:0,GoTrueClient.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!dr.debug,typeof dr.debug=="function"&&(this.logger=dr.debug),this.instanceID>0&&isBrowser()){const hr=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(hr),this.logDebugMessages&&console.trace(hr)}if(this.persistSession=dr.persistSession,this.autoRefreshToken=dr.autoRefreshToken,this.admin=new GoTrueAdminApi({url:dr.url,headers:dr.headers,fetch:dr.fetch}),this.url=dr.url,this.headers=dr.headers,this.fetch=resolveFetch$1(dr.fetch),this.lock=dr.lock||lockNoOp,this.detectSessionInUrl=dr.detectSessionInUrl,this.flowType=dr.flowType,this.hasCustomAuthorizationHeader=dr.hasCustomAuthorizationHeader,this.throwOnError=dr.throwOnError,this.lockAcquireTimeout=dr.lockAcquireTimeout,dr.lock?this.lock=dr.lock:this.persistSession&&isBrowser()&&(!((cr=globalThis==null?void 0:globalThis.navigator)===null||cr===void 0)&&cr.locks)?this.lock=navigatorLock:this.lock=lockNoOp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new WebAuthnApi(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(dr.storage?this.storage=dr.storage:supportsLocalStorage()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),dr.userStorage&&(this.userStorage=dr.userStorage)):(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),isBrowser()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(hr){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",hr)}(ur=this.broadcastChannel)===null||ur===void 0||ur.addEventListener("message",async hr=>{this._debug("received broadcast notification from other tab or client",hr);try{await this._notifyAllSubscribers(hr.data.event,hr.data.session,!1)}catch(pr){this._debug("#broadcastChannel","error",pr)}})}this.initialize().catch(hr=>{this._debug("#initialize()","error",hr)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(or){if(this.throwOnError&&or&&or.error)throw or.error;return or}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${version$1}) ${new Date().toISOString()}`}_debug(...or){return this.logDebugMessages&&this.logger(this._logPrefix(),...or),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var or;try{let lr={},cr="none";if(isBrowser()&&(lr=parseParametersFromURL(window.location.href),this._isImplicitGrantCallback(lr)?cr="implicit":await this._isPKCECallback(lr)&&(cr="pkce")),isBrowser()&&this.detectSessionInUrl&&cr!=="none"){const{data:ur,error:dr}=await this._getSessionFromURL(lr,cr);if(dr){if(this._debug("#_initialize()","error detecting session from URL",dr),isAuthImplicitGrantRedirectError(dr)){const xr=(or=dr.details)===null||or===void 0?void 0:or.code;if(xr==="identity_already_exists"||xr==="identity_not_found"||xr==="single_identity_not_deletable")return{error:dr}}return{error:dr}}const{session:hr,redirectType:pr}=ur;return this._debug("#_initialize()","detected session in URL",hr,"redirect type",pr),await this._saveSession(hr),setTimeout(async()=>{pr==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",hr):await this._notifyAllSubscribers("SIGNED_IN",hr)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(lr){return isAuthError(lr)?this._returnResult({error:lr}):this._returnResult({error:new AuthUnknownError("Unexpected error during initialization",lr)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(or){var lr,cr,ur;try{const dr=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(cr=(lr=or==null?void 0:or.options)===null||lr===void 0?void 0:lr.data)!==null&&cr!==void 0?cr:{},gotrue_meta_security:{captcha_token:(ur=or==null?void 0:or.options)===null||ur===void 0?void 0:ur.captchaToken}},xform:_sessionResponse}),{data:hr,error:pr}=dr;if(pr||!hr)return this._returnResult({data:{user:null,session:null},error:pr});const xr=hr.session,mr=hr.user;return hr.session&&(await this._saveSession(hr.session),await this._notifyAllSubscribers("SIGNED_IN",xr)),this._returnResult({data:{user:mr,session:xr},error:null})}catch(dr){if(isAuthError(dr))return this._returnResult({data:{user:null,session:null},error:dr});throw dr}}async signUp(or){var lr,cr,ur;try{let dr;if("email"in or){const{email:fr,password:Er,options:vr}=or;let gr=null,yr=null;this.flowType==="pkce"&&([gr,yr]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),dr=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:vr==null?void 0:vr.emailRedirectTo,body:{email:fr,password:Er,data:(lr=vr==null?void 0:vr.data)!==null&&lr!==void 0?lr:{},gotrue_meta_security:{captcha_token:vr==null?void 0:vr.captchaToken},code_challenge:gr,code_challenge_method:yr},xform:_sessionResponse})}else if("phone"in or){const{phone:fr,password:Er,options:vr}=or;dr=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:fr,password:Er,data:(cr=vr==null?void 0:vr.data)!==null&&cr!==void 0?cr:{},channel:(ur=vr==null?void 0:vr.channel)!==null&&ur!==void 0?ur:"sms",gotrue_meta_security:{captcha_token:vr==null?void 0:vr.captchaToken}},xform:_sessionResponse})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:hr,error:pr}=dr;if(pr||!hr)return await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:pr});const xr=hr.session,mr=hr.user;return hr.session&&(await this._saveSession(hr.session),await this._notifyAllSubscribers("SIGNED_IN",xr)),this._returnResult({data:{user:mr,session:xr},error:null})}catch(dr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(dr))return this._returnResult({data:{user:null,session:null},error:dr});throw dr}}async signInWithPassword(or){try{let lr;if("email"in or){const{email:dr,password:hr,options:pr}=or;lr=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:dr,password:hr,gotrue_meta_security:{captcha_token:pr==null?void 0:pr.captchaToken}},xform:_sessionResponsePassword})}else if("phone"in or){const{phone:dr,password:hr,options:pr}=or;lr=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:dr,password:hr,gotrue_meta_security:{captcha_token:pr==null?void 0:pr.captchaToken}},xform:_sessionResponsePassword})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:cr,error:ur}=lr;if(ur)return this._returnResult({data:{user:null,session:null},error:ur});if(!cr||!cr.session||!cr.user){const dr=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:dr})}return cr.session&&(await this._saveSession(cr.session),await this._notifyAllSubscribers("SIGNED_IN",cr.session)),this._returnResult({data:Object.assign({user:cr.user,session:cr.session},cr.weak_password?{weakPassword:cr.weak_password}:null),error:ur})}catch(lr){if(isAuthError(lr))return this._returnResult({data:{user:null,session:null},error:lr});throw lr}}async signInWithOAuth(or){var lr,cr,ur,dr;return await this._handleProviderSignIn(or.provider,{redirectTo:(lr=or.options)===null||lr===void 0?void 0:lr.redirectTo,scopes:(cr=or.options)===null||cr===void 0?void 0:cr.scopes,queryParams:(ur=or.options)===null||ur===void 0?void 0:ur.queryParams,skipBrowserRedirect:(dr=or.options)===null||dr===void 0?void 0:dr.skipBrowserRedirect})}async exchangeCodeForSession(or){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(or))}async signInWithWeb3(or){const{chain:lr}=or;switch(lr){case"ethereum":return await this.signInWithEthereum(or);case"solana":return await this.signInWithSolana(or);default:throw new Error(`@supabase/auth-js: Unsupported chain "${lr}"`)}}async signInWithEthereum(or){var lr,cr,ur,dr,hr,pr,xr,mr,fr,Er,vr;let gr,yr;if("message"in or)gr=or.message,yr=or.signature;else{const{chain:jr,wallet:br,statement:_r,options:wr}=or;let Rr;if(isBrowser())if(typeof br=="object")Rr=br;else{const Tr=window;if("ethereum"in Tr&&typeof Tr.ethereum=="object"&&"request"in Tr.ethereum&&typeof Tr.ethereum.request=="function")Rr=Tr.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof br!="object"||!(wr!=null&&wr.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Rr=br}const Ar=new URL((lr=wr==null?void 0:wr.url)!==null&&lr!==void 0?lr:window.location.href),Sr=await Rr.request({method:"eth_requestAccounts"}).then(Tr=>Tr).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Sr||Sr.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const kr=getAddress(Sr[0]);let Nr=(cr=wr==null?void 0:wr.signInWithEthereum)===null||cr===void 0?void 0:cr.chainId;if(!Nr){const Tr=await Rr.request({method:"eth_chainId"});Nr=fromHex(Tr)}const Cr={domain:Ar.host,address:kr,statement:_r,uri:Ar.href,version:"1",chainId:Nr,nonce:(ur=wr==null?void 0:wr.signInWithEthereum)===null||ur===void 0?void 0:ur.nonce,issuedAt:(hr=(dr=wr==null?void 0:wr.signInWithEthereum)===null||dr===void 0?void 0:dr.issuedAt)!==null&&hr!==void 0?hr:new Date,expirationTime:(pr=wr==null?void 0:wr.signInWithEthereum)===null||pr===void 0?void 0:pr.expirationTime,notBefore:(xr=wr==null?void 0:wr.signInWithEthereum)===null||xr===void 0?void 0:xr.notBefore,requestId:(mr=wr==null?void 0:wr.signInWithEthereum)===null||mr===void 0?void 0:mr.requestId,resources:(fr=wr==null?void 0:wr.signInWithEthereum)===null||fr===void 0?void 0:fr.resources};gr=createSiweMessage(Cr),yr=await Rr.request({method:"personal_sign",params:[toHex(gr),kr]})}try{const{data:jr,error:br}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:gr,signature:yr},!((Er=or.options)===null||Er===void 0)&&Er.captchaToken?{gotrue_meta_security:{captcha_token:(vr=or.options)===null||vr===void 0?void 0:vr.captchaToken}}:null),xform:_sessionResponse});if(br)throw br;if(!jr||!jr.session||!jr.user){const _r=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:_r})}return jr.session&&(await this._saveSession(jr.session),await this._notifyAllSubscribers("SIGNED_IN",jr.session)),this._returnResult({data:Object.assign({},jr),error:br})}catch(jr){if(isAuthError(jr))return this._returnResult({data:{user:null,session:null},error:jr});throw jr}}async signInWithSolana(or){var lr,cr,ur,dr,hr,pr,xr,mr,fr,Er,vr,gr;let yr,jr;if("message"in or)yr=or.message,jr=or.signature;else{const{chain:br,wallet:_r,statement:wr,options:Rr}=or;let Ar;if(isBrowser())if(typeof _r=="object")Ar=_r;else{const kr=window;if("solana"in kr&&typeof kr.solana=="object"&&("signIn"in kr.solana&&typeof kr.solana.signIn=="function"||"signMessage"in kr.solana&&typeof kr.solana.signMessage=="function"))Ar=kr.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof _r!="object"||!(Rr!=null&&Rr.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Ar=_r}const Sr=new URL((lr=Rr==null?void 0:Rr.url)!==null&&lr!==void 0?lr:window.location.href);if("signIn"in Ar&&Ar.signIn){const kr=await Ar.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Rr==null?void 0:Rr.signInWithSolana),{version:"1",domain:Sr.host,uri:Sr.href}),wr?{statement:wr}:null));let Nr;if(Array.isArray(kr)&&kr[0]&&typeof kr[0]=="object")Nr=kr[0];else if(kr&&typeof kr=="object"&&"signedMessage"in kr&&"signature"in kr)Nr=kr;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Nr&&"signature"in Nr&&(typeof Nr.signedMessage=="string"||Nr.signedMessage instanceof Uint8Array)&&Nr.signature instanceof Uint8Array)yr=typeof Nr.signedMessage=="string"?Nr.signedMessage:new TextDecoder().decode(Nr.signedMessage),jr=Nr.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Ar)||typeof Ar.signMessage!="function"||!("publicKey"in Ar)||typeof Ar!="object"||!Ar.publicKey||!("toBase58"in Ar.publicKey)||typeof Ar.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");yr=[`${Sr.host} wants you to sign in with your Solana account:`,Ar.publicKey.toBase58(),...wr?["",wr,""]:[""],"Version: 1",`URI: ${Sr.href}`,`Issued At: ${(ur=(cr=Rr==null?void 0:Rr.signInWithSolana)===null||cr===void 0?void 0:cr.issuedAt)!==null&&ur!==void 0?ur:new Date().toISOString()}`,...!((dr=Rr==null?void 0:Rr.signInWithSolana)===null||dr===void 0)&&dr.notBefore?[`Not Before: ${Rr.signInWithSolana.notBefore}`]:[],...!((hr=Rr==null?void 0:Rr.signInWithSolana)===null||hr===void 0)&&hr.expirationTime?[`Expiration Time: ${Rr.signInWithSolana.expirationTime}`]:[],...!((pr=Rr==null?void 0:Rr.signInWithSolana)===null||pr===void 0)&&pr.chainId?[`Chain ID: ${Rr.signInWithSolana.chainId}`]:[],...!((xr=Rr==null?void 0:Rr.signInWithSolana)===null||xr===void 0)&&xr.nonce?[`Nonce: ${Rr.signInWithSolana.nonce}`]:[],...!((mr=Rr==null?void 0:Rr.signInWithSolana)===null||mr===void 0)&&mr.requestId?[`Request ID: ${Rr.signInWithSolana.requestId}`]:[],...!((Er=(fr=Rr==null?void 0:Rr.signInWithSolana)===null||fr===void 0?void 0:fr.resources)===null||Er===void 0)&&Er.length?["Resources",...Rr.signInWithSolana.resources.map(Nr=>`- ${Nr}`)]:[]].join(`
`);const kr=await Ar.signMessage(new TextEncoder().encode(yr),"utf8");if(!kr||!(kr instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");jr=kr}}try{const{data:br,error:_r}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:yr,signature:bytesToBase64URL(jr)},!((vr=or.options)===null||vr===void 0)&&vr.captchaToken?{gotrue_meta_security:{captcha_token:(gr=or.options)===null||gr===void 0?void 0:gr.captchaToken}}:null),xform:_sessionResponse});if(_r)throw _r;if(!br||!br.session||!br.user){const wr=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:wr})}return br.session&&(await this._saveSession(br.session),await this._notifyAllSubscribers("SIGNED_IN",br.session)),this._returnResult({data:Object.assign({},br),error:_r})}catch(br){if(isAuthError(br))return this._returnResult({data:{user:null,session:null},error:br});throw br}}async _exchangeCodeForSession(or){const lr=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`),[cr,ur]=(lr??"").split("/");try{if(!cr&&this.flowType==="pkce")throw new AuthPKCECodeVerifierMissingError;const{data:dr,error:hr}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:or,code_verifier:cr},xform:_sessionResponse});if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),hr)throw hr;if(!dr||!dr.session||!dr.user){const pr=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null,redirectType:null},error:pr})}return dr.session&&(await this._saveSession(dr.session),await this._notifyAllSubscribers("SIGNED_IN",dr.session)),this._returnResult({data:Object.assign(Object.assign({},dr),{redirectType:ur??null}),error:hr})}catch(dr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(dr))return this._returnResult({data:{user:null,session:null,redirectType:null},error:dr});throw dr}}async signInWithIdToken(or){try{const{options:lr,provider:cr,token:ur,access_token:dr,nonce:hr}=or,pr=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:cr,id_token:ur,access_token:dr,nonce:hr,gotrue_meta_security:{captcha_token:lr==null?void 0:lr.captchaToken}},xform:_sessionResponse}),{data:xr,error:mr}=pr;if(mr)return this._returnResult({data:{user:null,session:null},error:mr});if(!xr||!xr.session||!xr.user){const fr=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:fr})}return xr.session&&(await this._saveSession(xr.session),await this._notifyAllSubscribers("SIGNED_IN",xr.session)),this._returnResult({data:xr,error:mr})}catch(lr){if(isAuthError(lr))return this._returnResult({data:{user:null,session:null},error:lr});throw lr}}async signInWithOtp(or){var lr,cr,ur,dr,hr;try{if("email"in or){const{email:pr,options:xr}=or;let mr=null,fr=null;this.flowType==="pkce"&&([mr,fr]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{error:Er}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:pr,data:(lr=xr==null?void 0:xr.data)!==null&&lr!==void 0?lr:{},create_user:(cr=xr==null?void 0:xr.shouldCreateUser)!==null&&cr!==void 0?cr:!0,gotrue_meta_security:{captcha_token:xr==null?void 0:xr.captchaToken},code_challenge:mr,code_challenge_method:fr},redirectTo:xr==null?void 0:xr.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:Er})}if("phone"in or){const{phone:pr,options:xr}=or,{data:mr,error:fr}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:pr,data:(ur=xr==null?void 0:xr.data)!==null&&ur!==void 0?ur:{},create_user:(dr=xr==null?void 0:xr.shouldCreateUser)!==null&&dr!==void 0?dr:!0,gotrue_meta_security:{captcha_token:xr==null?void 0:xr.captchaToken},channel:(hr=xr==null?void 0:xr.channel)!==null&&hr!==void 0?hr:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:mr==null?void 0:mr.message_id},error:fr})}throw new AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(pr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(pr))return this._returnResult({data:{user:null,session:null},error:pr});throw pr}}async verifyOtp(or){var lr,cr;try{let ur,dr;"options"in or&&(ur=(lr=or.options)===null||lr===void 0?void 0:lr.redirectTo,dr=(cr=or.options)===null||cr===void 0?void 0:cr.captchaToken);const{data:hr,error:pr}=await _request(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},or),{gotrue_meta_security:{captcha_token:dr}}),redirectTo:ur,xform:_sessionResponse});if(pr)throw pr;if(!hr)throw new Error("An error occurred on token verification.");const xr=hr.session,mr=hr.user;return xr!=null&&xr.access_token&&(await this._saveSession(xr),await this._notifyAllSubscribers(or.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",xr)),this._returnResult({data:{user:mr,session:xr},error:null})}catch(ur){if(isAuthError(ur))return this._returnResult({data:{user:null,session:null},error:ur});throw ur}}async signInWithSSO(or){var lr,cr,ur,dr,hr;try{let pr=null,xr=null;this.flowType==="pkce"&&([pr,xr]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const mr=await _request(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in or?{provider_id:or.providerId}:null),"domain"in or?{domain:or.domain}:null),{redirect_to:(cr=(lr=or.options)===null||lr===void 0?void 0:lr.redirectTo)!==null&&cr!==void 0?cr:void 0}),!((ur=or==null?void 0:or.options)===null||ur===void 0)&&ur.captchaToken?{gotrue_meta_security:{captcha_token:or.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:pr,code_challenge_method:xr}),headers:this.headers,xform:_ssoResponse});return!((dr=mr.data)===null||dr===void 0)&&dr.url&&isBrowser()&&!(!((hr=or.options)===null||hr===void 0)&&hr.skipBrowserRedirect)&&window.location.assign(mr.data.url),this._returnResult(mr)}catch(pr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(pr))return this._returnResult({data:null,error:pr});throw pr}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async or=>{const{data:{session:lr},error:cr}=or;if(cr)throw cr;if(!lr)throw new AuthSessionMissingError;const{error:ur}=await _request(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:lr.access_token});return this._returnResult({data:{user:null,session:null},error:ur})})}catch(or){if(isAuthError(or))return this._returnResult({data:{user:null,session:null},error:or});throw or}}async resend(or){try{const lr=`${this.url}/resend`;if("email"in or){const{email:cr,type:ur,options:dr}=or,{error:hr}=await _request(this.fetch,"POST",lr,{headers:this.headers,body:{email:cr,type:ur,gotrue_meta_security:{captcha_token:dr==null?void 0:dr.captchaToken}},redirectTo:dr==null?void 0:dr.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:hr})}else if("phone"in or){const{phone:cr,type:ur,options:dr}=or,{data:hr,error:pr}=await _request(this.fetch,"POST",lr,{headers:this.headers,body:{phone:cr,type:ur,gotrue_meta_security:{captcha_token:dr==null?void 0:dr.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:hr==null?void 0:hr.message_id},error:pr})}throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(lr){if(isAuthError(lr))return this._returnResult({data:{user:null,session:null},error:lr});throw lr}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async lr=>lr))}async _acquireLock(or,lr){this._debug("#_acquireLock","begin",or);try{if(this.lockAcquired){const cr=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),ur=(async()=>(await cr,await lr()))();return this.pendingInLock.push((async()=>{try{await ur}catch{}})()),ur}return await this.lock(`lock:${this.storageKey}`,or,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const cr=lr();for(this.pendingInLock.push((async()=>{try{await cr}catch{}})()),await cr;this.pendingInLock.length;){const ur=[...this.pendingInLock];await Promise.all(ur),this.pendingInLock.splice(0,ur.length)}return await cr}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(or){this._debug("#_useSession","begin");try{const lr=await this.__loadSession();return await or(lr)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let or=null;const lr=await getItemAsync(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",lr),lr!==null&&(this._isValidSession(lr)?or=lr:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!or)return{data:{session:null},error:null};const cr=or.expires_at?or.expires_at*1e3-Date.now()<EXPIRY_MARGIN_MS:!1;if(this._debug("#__loadSession()",`session has${cr?"":" not"} expired`,"expires_at",or.expires_at),!cr){if(this.userStorage){const hr=await getItemAsync(this.userStorage,this.storageKey+"-user");hr!=null&&hr.user?or.user=hr.user:or.user=userNotAvailableProxy()}if(this.storage.isServer&&or.user&&!or.user.__isUserNotAvailableProxy){const hr={value:this.suppressGetSessionWarning};or.user=insecureUserWarningProxy(or.user,hr),hr.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:or},error:null}}const{data:ur,error:dr}=await this._callRefreshToken(or.refresh_token);return dr?this._returnResult({data:{session:null},error:dr}):this._returnResult({data:{session:ur},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(or){if(or)return await this._getUser(or);await this.initializePromise;const lr=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return lr.data.user&&(this.suppressGetSessionWarning=!0),lr}async _getUser(or){try{return or?await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:or,xform:_userResponse}):await this._useSession(async lr=>{var cr,ur,dr;const{data:hr,error:pr}=lr;if(pr)throw pr;return!(!((cr=hr.session)===null||cr===void 0)&&cr.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new AuthSessionMissingError}:await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(dr=(ur=hr.session)===null||ur===void 0?void 0:ur.access_token)!==null&&dr!==void 0?dr:void 0,xform:_userResponse})})}catch(lr){if(isAuthError(lr))return isAuthSessionMissingError(lr)&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:lr});throw lr}}async updateUser(or,lr={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(or,lr))}async _updateUser(or,lr={}){try{return await this._useSession(async cr=>{const{data:ur,error:dr}=cr;if(dr)throw dr;if(!ur.session)throw new AuthSessionMissingError;const hr=ur.session;let pr=null,xr=null;this.flowType==="pkce"&&or.email!=null&&([pr,xr]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{data:mr,error:fr}=await _request(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:lr==null?void 0:lr.emailRedirectTo,body:Object.assign(Object.assign({},or),{code_challenge:pr,code_challenge_method:xr}),jwt:hr.access_token,xform:_userResponse});if(fr)throw fr;return hr.user=mr.user,await this._saveSession(hr),await this._notifyAllSubscribers("USER_UPDATED",hr),this._returnResult({data:{user:hr.user},error:null})})}catch(cr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(cr))return this._returnResult({data:{user:null},error:cr});throw cr}}async setSession(or){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(or))}async _setSession(or){try{if(!or.access_token||!or.refresh_token)throw new AuthSessionMissingError;const lr=Date.now()/1e3;let cr=lr,ur=!0,dr=null;const{payload:hr}=decodeJWT(or.access_token);if(hr.exp&&(cr=hr.exp,ur=cr<=lr),ur){const{data:pr,error:xr}=await this._callRefreshToken(or.refresh_token);if(xr)return this._returnResult({data:{user:null,session:null},error:xr});if(!pr)return{data:{user:null,session:null},error:null};dr=pr}else{const{data:pr,error:xr}=await this._getUser(or.access_token);if(xr)return this._returnResult({data:{user:null,session:null},error:xr});dr={access_token:or.access_token,refresh_token:or.refresh_token,user:pr.user,token_type:"bearer",expires_in:cr-lr,expires_at:cr},await this._saveSession(dr),await this._notifyAllSubscribers("SIGNED_IN",dr)}return this._returnResult({data:{user:dr.user,session:dr},error:null})}catch(lr){if(isAuthError(lr))return this._returnResult({data:{session:null,user:null},error:lr});throw lr}}async refreshSession(or){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(or))}async _refreshSession(or){try{return await this._useSession(async lr=>{var cr;if(!or){const{data:hr,error:pr}=lr;if(pr)throw pr;or=(cr=hr.session)!==null&&cr!==void 0?cr:void 0}if(!(or!=null&&or.refresh_token))throw new AuthSessionMissingError;const{data:ur,error:dr}=await this._callRefreshToken(or.refresh_token);return dr?this._returnResult({data:{user:null,session:null},error:dr}):ur?this._returnResult({data:{user:ur.user,session:ur},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:{user:null,session:null},error:lr});throw lr}}async _getSessionFromURL(or,lr){try{if(!isBrowser())throw new AuthImplicitGrantRedirectError("No browser detected.");if(or.error||or.error_description||or.error_code)throw new AuthImplicitGrantRedirectError(or.error_description||"Error in URL with unspecified error_description",{error:or.error||"unspecified_error",code:or.error_code||"unspecified_code"});switch(lr){case"implicit":if(this.flowType==="pkce")throw new AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");break;default:}if(lr==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!or.code)throw new AuthPKCEGrantCodeExchangeError("No code detected.");const{data:wr,error:Rr}=await this._exchangeCodeForSession(or.code);if(Rr)throw Rr;const Ar=new URL(window.location.href);return Ar.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Ar.toString()),{data:{session:wr.session,redirectType:null},error:null}}const{provider_token:cr,provider_refresh_token:ur,access_token:dr,refresh_token:hr,expires_in:pr,expires_at:xr,token_type:mr}=or;if(!dr||!pr||!hr||!mr)throw new AuthImplicitGrantRedirectError("No session defined in URL");const fr=Math.round(Date.now()/1e3),Er=parseInt(pr);let vr=fr+Er;xr&&(vr=parseInt(xr));const gr=vr-fr;gr*1e3<=AUTO_REFRESH_TICK_DURATION_MS&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${gr}s, should have been closer to ${Er}s`);const yr=vr-Er;fr-yr>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",yr,vr,fr):fr-yr<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",yr,vr,fr);const{data:jr,error:br}=await this._getUser(dr);if(br)throw br;const _r={provider_token:cr,provider_refresh_token:ur,access_token:dr,expires_in:Er,expires_at:vr,refresh_token:hr,token_type:mr,user:jr.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:_r,redirectType:or.type},error:null})}catch(cr){if(isAuthError(cr))return this._returnResult({data:{session:null,redirectType:null},error:cr});throw cr}}_isImplicitGrantCallback(or){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),or):!!(or.access_token||or.error_description)}async _isPKCECallback(or){const lr=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`);return!!(or.code&&lr)}async signOut(or={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(or))}async _signOut({scope:or}={scope:"global"}){return await this._useSession(async lr=>{var cr;const{data:ur,error:dr}=lr;if(dr&&!isAuthSessionMissingError(dr))return this._returnResult({error:dr});const hr=(cr=ur.session)===null||cr===void 0?void 0:cr.access_token;if(hr){const{error:pr}=await this.admin.signOut(hr,or);if(pr&&!(isAuthApiError(pr)&&(pr.status===404||pr.status===401||pr.status===403)||isAuthSessionMissingError(pr)))return this._returnResult({error:pr})}return or!=="others"&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(or){const lr=generateCallbackId(),cr={id:lr,callback:or,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",lr),this.stateChangeEmitters.delete(lr)}};return this._debug("#onAuthStateChange()","registered callback with id",lr),this.stateChangeEmitters.set(lr,cr),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(lr)})))(),{data:{subscription:cr}}}async _emitInitialSession(or){return await this._useSession(async lr=>{var cr,ur;try{const{data:{session:dr},error:hr}=lr;if(hr)throw hr;await((cr=this.stateChangeEmitters.get(or))===null||cr===void 0?void 0:cr.callback("INITIAL_SESSION",dr)),this._debug("INITIAL_SESSION","callback id",or,"session",dr)}catch(dr){await((ur=this.stateChangeEmitters.get(or))===null||ur===void 0?void 0:ur.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",or,"error",dr),console.error(dr)}})}async resetPasswordForEmail(or,lr={}){let cr=null,ur=null;this.flowType==="pkce"&&([cr,ur]=await getCodeChallengeAndMethod(this.storage,this.storageKey,!0));try{return await _request(this.fetch,"POST",`${this.url}/recover`,{body:{email:or,code_challenge:cr,code_challenge_method:ur,gotrue_meta_security:{captcha_token:lr.captchaToken}},headers:this.headers,redirectTo:lr.redirectTo})}catch(dr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(dr))return this._returnResult({data:null,error:dr});throw dr}}async getUserIdentities(){var or;try{const{data:lr,error:cr}=await this.getUser();if(cr)throw cr;return this._returnResult({data:{identities:(or=lr.user.identities)!==null&&or!==void 0?or:[]},error:null})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async linkIdentity(or){return"token"in or?this.linkIdentityIdToken(or):this.linkIdentityOAuth(or)}async linkIdentityOAuth(or){var lr;try{const{data:cr,error:ur}=await this._useSession(async dr=>{var hr,pr,xr,mr,fr;const{data:Er,error:vr}=dr;if(vr)throw vr;const gr=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,or.provider,{redirectTo:(hr=or.options)===null||hr===void 0?void 0:hr.redirectTo,scopes:(pr=or.options)===null||pr===void 0?void 0:pr.scopes,queryParams:(xr=or.options)===null||xr===void 0?void 0:xr.queryParams,skipBrowserRedirect:!0});return await _request(this.fetch,"GET",gr,{headers:this.headers,jwt:(fr=(mr=Er.session)===null||mr===void 0?void 0:mr.access_token)!==null&&fr!==void 0?fr:void 0})});if(ur)throw ur;return isBrowser()&&!(!((lr=or.options)===null||lr===void 0)&&lr.skipBrowserRedirect)&&window.location.assign(cr==null?void 0:cr.url),this._returnResult({data:{provider:or.provider,url:cr==null?void 0:cr.url},error:null})}catch(cr){if(isAuthError(cr))return this._returnResult({data:{provider:or.provider,url:null},error:cr});throw cr}}async linkIdentityIdToken(or){return await this._useSession(async lr=>{var cr;try{const{error:ur,data:{session:dr}}=lr;if(ur)throw ur;const{options:hr,provider:pr,token:xr,access_token:mr,nonce:fr}=or,Er=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(cr=dr==null?void 0:dr.access_token)!==null&&cr!==void 0?cr:void 0,body:{provider:pr,id_token:xr,access_token:mr,nonce:fr,link_identity:!0,gotrue_meta_security:{captcha_token:hr==null?void 0:hr.captchaToken}},xform:_sessionResponse}),{data:vr,error:gr}=Er;return gr?this._returnResult({data:{user:null,session:null},error:gr}):!vr||!vr.session||!vr.user?this._returnResult({data:{user:null,session:null},error:new AuthInvalidTokenResponseError}):(vr.session&&(await this._saveSession(vr.session),await this._notifyAllSubscribers("USER_UPDATED",vr.session)),this._returnResult({data:vr,error:gr}))}catch(ur){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(ur))return this._returnResult({data:{user:null,session:null},error:ur});throw ur}})}async unlinkIdentity(or){try{return await this._useSession(async lr=>{var cr,ur;const{data:dr,error:hr}=lr;if(hr)throw hr;return await _request(this.fetch,"DELETE",`${this.url}/user/identities/${or.identity_id}`,{headers:this.headers,jwt:(ur=(cr=dr.session)===null||cr===void 0?void 0:cr.access_token)!==null&&ur!==void 0?ur:void 0})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async _refreshAccessToken(or){const lr=`#_refreshAccessToken(${or.substring(0,5)}...)`;this._debug(lr,"begin");try{const cr=Date.now();return await retryable(async ur=>(ur>0&&await sleep(200*Math.pow(2,ur-1)),this._debug(lr,"refreshing attempt",ur),await _request(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:or},headers:this.headers,xform:_sessionResponse})),(ur,dr)=>{const hr=200*Math.pow(2,ur);return dr&&isAuthRetryableFetchError(dr)&&Date.now()+hr-cr<AUTO_REFRESH_TICK_DURATION_MS})}catch(cr){if(this._debug(lr,"error",cr),isAuthError(cr))return this._returnResult({data:{session:null,user:null},error:cr});throw cr}finally{this._debug(lr,"end")}}_isValidSession(or){return typeof or=="object"&&or!==null&&"access_token"in or&&"refresh_token"in or&&"expires_at"in or}async _handleProviderSignIn(or,lr){const cr=await this._getUrlForProvider(`${this.url}/authorize`,or,{redirectTo:lr.redirectTo,scopes:lr.scopes,queryParams:lr.queryParams});return this._debug("#_handleProviderSignIn()","provider",or,"options",lr,"url",cr),isBrowser()&&!lr.skipBrowserRedirect&&window.location.assign(cr),{data:{provider:or,url:cr},error:null}}async _recoverAndRefresh(){var or,lr;const cr="#_recoverAndRefresh()";this._debug(cr,"begin");try{const ur=await getItemAsync(this.storage,this.storageKey);if(ur&&this.userStorage){let hr=await getItemAsync(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!hr&&(hr={user:ur.user},await setItemAsync(this.userStorage,this.storageKey+"-user",hr)),ur.user=(or=hr==null?void 0:hr.user)!==null&&or!==void 0?or:userNotAvailableProxy()}else if(ur&&!ur.user&&!ur.user){const hr=await getItemAsync(this.storage,this.storageKey+"-user");hr&&(hr!=null&&hr.user)?(ur.user=hr.user,await removeItemAsync(this.storage,this.storageKey+"-user"),await setItemAsync(this.storage,this.storageKey,ur)):ur.user=userNotAvailableProxy()}if(this._debug(cr,"session from storage",ur),!this._isValidSession(ur)){this._debug(cr,"session is not valid"),ur!==null&&await this._removeSession();return}const dr=((lr=ur.expires_at)!==null&&lr!==void 0?lr:1/0)*1e3-Date.now()<EXPIRY_MARGIN_MS;if(this._debug(cr,`session has${dr?"":" not"} expired with margin of ${EXPIRY_MARGIN_MS}s`),dr){if(this.autoRefreshToken&&ur.refresh_token){const{error:hr}=await this._callRefreshToken(ur.refresh_token);hr&&(console.error(hr),isAuthRetryableFetchError(hr)||(this._debug(cr,"refresh failed with a non-retryable error, removing the session",hr),await this._removeSession()))}}else if(ur.user&&ur.user.__isUserNotAvailableProxy===!0)try{const{data:hr,error:pr}=await this._getUser(ur.access_token);!pr&&(hr!=null&&hr.user)?(ur.user=hr.user,await this._saveSession(ur),await this._notifyAllSubscribers("SIGNED_IN",ur)):this._debug(cr,"could not get user data, skipping SIGNED_IN notification")}catch(hr){console.error("Error getting user data:",hr),this._debug(cr,"error getting user data, skipping SIGNED_IN notification",hr)}else await this._notifyAllSubscribers("SIGNED_IN",ur)}catch(ur){this._debug(cr,"error",ur),console.error(ur);return}finally{this._debug(cr,"end")}}async _callRefreshToken(or){var lr,cr;if(!or)throw new AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const ur=`#_callRefreshToken(${or.substring(0,5)}...)`;this._debug(ur,"begin");try{this.refreshingDeferred=new Deferred;const{data:dr,error:hr}=await this._refreshAccessToken(or);if(hr)throw hr;if(!dr.session)throw new AuthSessionMissingError;await this._saveSession(dr.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",dr.session);const pr={data:dr.session,error:null};return this.refreshingDeferred.resolve(pr),pr}catch(dr){if(this._debug(ur,"error",dr),isAuthError(dr)){const hr={data:null,error:dr};return isAuthRetryableFetchError(dr)||await this._removeSession(),(lr=this.refreshingDeferred)===null||lr===void 0||lr.resolve(hr),hr}throw(cr=this.refreshingDeferred)===null||cr===void 0||cr.reject(dr),dr}finally{this.refreshingDeferred=null,this._debug(ur,"end")}}async _notifyAllSubscribers(or,lr,cr=!0){const ur=`#_notifyAllSubscribers(${or})`;this._debug(ur,"begin",lr,`broadcast = ${cr}`);try{this.broadcastChannel&&cr&&this.broadcastChannel.postMessage({event:or,session:lr});const dr=[],hr=Array.from(this.stateChangeEmitters.values()).map(async pr=>{try{await pr.callback(or,lr)}catch(xr){dr.push(xr)}});if(await Promise.all(hr),dr.length>0){for(let pr=0;pr<dr.length;pr+=1)console.error(dr[pr]);throw dr[0]}}finally{this._debug(ur,"end")}}async _saveSession(or){this._debug("#_saveSession()",or),this.suppressGetSessionWarning=!0,await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`);const lr=Object.assign({},or),cr=lr.user&&lr.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!cr&&lr.user&&await setItemAsync(this.userStorage,this.storageKey+"-user",{user:lr.user});const ur=Object.assign({},lr);delete ur.user;const dr=deepClone(ur);await setItemAsync(this.storage,this.storageKey,dr)}else{const ur=deepClone(lr);await setItemAsync(this.storage,this.storageKey,ur)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await removeItemAsync(this.storage,this.storageKey),await removeItemAsync(this.storage,this.storageKey+"-code-verifier"),await removeItemAsync(this.storage,this.storageKey+"-user"),this.userStorage&&await removeItemAsync(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const or=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{or&&isBrowser()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",or)}catch(lr){console.error("removing visibilitychange callback failed",lr)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const or=setInterval(()=>this._autoRefreshTokenTick(),AUTO_REFRESH_TICK_DURATION_MS);this.autoRefreshTicker=or,or&&typeof or=="object"&&typeof or.unref=="function"?or.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(or);const lr=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=lr,lr&&typeof lr=="object"&&typeof lr.unref=="function"?lr.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(lr)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const or=this.autoRefreshTicker;this.autoRefreshTicker=null,or&&clearInterval(or);const lr=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,lr&&clearTimeout(lr)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const or=Date.now();try{return await this._useSession(async lr=>{const{data:{session:cr}}=lr;if(!cr||!cr.refresh_token||!cr.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const ur=Math.floor((cr.expires_at*1e3-or)/AUTO_REFRESH_TICK_DURATION_MS);this._debug("#_autoRefreshTokenTick()",`access token expires in ${ur} ticks, a tick lasts ${AUTO_REFRESH_TICK_DURATION_MS}ms, refresh threshold is ${AUTO_REFRESH_TICK_THRESHOLD} ticks`),ur<=AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(cr.refresh_token)})}catch(lr){console.error("Auto refresh tick failed with error. This is likely a transient error.",lr)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(or){if(or.isAcquireTimeout||or instanceof LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw or}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!isBrowser()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(or){this._debug("#visibilityChangedCallback","error",or)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(or){console.error("_handleVisibilityChange",or)}}async _onVisibilityChanged(or){const lr=`#_onVisibilityChanged(${or})`;this._debug(lr,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),or||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(lr,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(or,lr,cr){const ur=[`provider=${encodeURIComponent(lr)}`];if(cr!=null&&cr.redirectTo&&ur.push(`redirect_to=${encodeURIComponent(cr.redirectTo)}`),cr!=null&&cr.scopes&&ur.push(`scopes=${encodeURIComponent(cr.scopes)}`),this.flowType==="pkce"){const[dr,hr]=await getCodeChallengeAndMethod(this.storage,this.storageKey),pr=new URLSearchParams({code_challenge:`${encodeURIComponent(dr)}`,code_challenge_method:`${encodeURIComponent(hr)}`});ur.push(pr.toString())}if(cr!=null&&cr.queryParams){const dr=new URLSearchParams(cr.queryParams);ur.push(dr.toString())}return cr!=null&&cr.skipBrowserRedirect&&ur.push(`skip_http_redirect=${cr.skipBrowserRedirect}`),`${or}?${ur.join("&")}`}async _unenroll(or){try{return await this._useSession(async lr=>{var cr;const{data:ur,error:dr}=lr;return dr?this._returnResult({data:null,error:dr}):await _request(this.fetch,"DELETE",`${this.url}/factors/${or.factorId}`,{headers:this.headers,jwt:(cr=ur==null?void 0:ur.session)===null||cr===void 0?void 0:cr.access_token})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async _enroll(or){try{return await this._useSession(async lr=>{var cr,ur;const{data:dr,error:hr}=lr;if(hr)return this._returnResult({data:null,error:hr});const pr=Object.assign({friendly_name:or.friendlyName,factor_type:or.factorType},or.factorType==="phone"?{phone:or.phone}:or.factorType==="totp"?{issuer:or.issuer}:{}),{data:xr,error:mr}=await _request(this.fetch,"POST",`${this.url}/factors`,{body:pr,headers:this.headers,jwt:(cr=dr==null?void 0:dr.session)===null||cr===void 0?void 0:cr.access_token});return mr?this._returnResult({data:null,error:mr}):(or.factorType==="totp"&&xr.type==="totp"&&(!((ur=xr==null?void 0:xr.totp)===null||ur===void 0)&&ur.qr_code)&&(xr.totp.qr_code=`data:image/svg+xml;utf-8,${xr.totp.qr_code}`),this._returnResult({data:xr,error:null}))})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async _verify(or){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async lr=>{var cr;const{data:ur,error:dr}=lr;if(dr)return this._returnResult({data:null,error:dr});const hr=Object.assign({challenge_id:or.challengeId},"webauthn"in or?{webauthn:Object.assign(Object.assign({},or.webauthn),{credential_response:or.webauthn.type==="create"?serializeCredentialCreationResponse(or.webauthn.credential_response):serializeCredentialRequestResponse(or.webauthn.credential_response)})}:{code:or.code}),{data:pr,error:xr}=await _request(this.fetch,"POST",`${this.url}/factors/${or.factorId}/verify`,{body:hr,headers:this.headers,jwt:(cr=ur==null?void 0:ur.session)===null||cr===void 0?void 0:cr.access_token});return xr?this._returnResult({data:null,error:xr}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+pr.expires_in},pr)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",pr),this._returnResult({data:pr,error:xr}))})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}})}async _challenge(or){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async lr=>{var cr;const{data:ur,error:dr}=lr;if(dr)return this._returnResult({data:null,error:dr});const hr=await _request(this.fetch,"POST",`${this.url}/factors/${or.factorId}/challenge`,{body:or,headers:this.headers,jwt:(cr=ur==null?void 0:ur.session)===null||cr===void 0?void 0:cr.access_token});if(hr.error)return hr;const{data:pr}=hr;if(pr.type!=="webauthn")return{data:pr,error:null};switch(pr.webauthn.type){case"create":return{data:Object.assign(Object.assign({},pr),{webauthn:Object.assign(Object.assign({},pr.webauthn),{credential_options:Object.assign(Object.assign({},pr.webauthn.credential_options),{publicKey:deserializeCredentialCreationOptions(pr.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},pr),{webauthn:Object.assign(Object.assign({},pr.webauthn),{credential_options:Object.assign(Object.assign({},pr.webauthn.credential_options),{publicKey:deserializeCredentialRequestOptions(pr.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}})}async _challengeAndVerify(or){const{data:lr,error:cr}=await this._challenge({factorId:or.factorId});return cr?this._returnResult({data:null,error:cr}):await this._verify({factorId:or.factorId,challengeId:lr.id,code:or.code})}async _listFactors(){var or;const{data:{user:lr},error:cr}=await this.getUser();if(cr)return{data:null,error:cr};const ur={all:[],phone:[],totp:[],webauthn:[]};for(const dr of(or=lr==null?void 0:lr.factors)!==null&&or!==void 0?or:[])ur.all.push(dr),dr.status==="verified"&&ur[dr.factor_type].push(dr);return{data:ur,error:null}}async _getAuthenticatorAssuranceLevel(or){var lr,cr,ur,dr;if(or)try{const{payload:gr}=decodeJWT(or);let yr=null;gr.aal&&(yr=gr.aal);let jr=yr;const{data:{user:br},error:_r}=await this.getUser(or);if(_r)return this._returnResult({data:null,error:_r});((cr=(lr=br==null?void 0:br.factors)===null||lr===void 0?void 0:lr.filter(Ar=>Ar.status==="verified"))!==null&&cr!==void 0?cr:[]).length>0&&(jr="aal2");const Rr=gr.amr||[];return{data:{currentLevel:yr,nextLevel:jr,currentAuthenticationMethods:Rr},error:null}}catch(gr){if(isAuthError(gr))return this._returnResult({data:null,error:gr});throw gr}const{data:{session:hr},error:pr}=await this.getSession();if(pr)return this._returnResult({data:null,error:pr});if(!hr)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:xr}=decodeJWT(hr.access_token);let mr=null;xr.aal&&(mr=xr.aal);let fr=mr;((dr=(ur=hr.user.factors)===null||ur===void 0?void 0:ur.filter(gr=>gr.status==="verified"))!==null&&dr!==void 0?dr:[]).length>0&&(fr="aal2");const vr=xr.amr||[];return{data:{currentLevel:mr,nextLevel:fr,currentAuthenticationMethods:vr},error:null}}async _getAuthorizationDetails(or){try{return await this._useSession(async lr=>{const{data:{session:cr},error:ur}=lr;return ur?this._returnResult({data:null,error:ur}):cr?await _request(this.fetch,"GET",`${this.url}/oauth/authorizations/${or}`,{headers:this.headers,jwt:cr.access_token,xform:dr=>({data:dr,error:null})}):this._returnResult({data:null,error:new AuthSessionMissingError})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async _approveAuthorization(or,lr){try{return await this._useSession(async cr=>{const{data:{session:ur},error:dr}=cr;if(dr)return this._returnResult({data:null,error:dr});if(!ur)return this._returnResult({data:null,error:new AuthSessionMissingError});const hr=await _request(this.fetch,"POST",`${this.url}/oauth/authorizations/${or}/consent`,{headers:this.headers,jwt:ur.access_token,body:{action:"approve"},xform:pr=>({data:pr,error:null})});return hr.data&&hr.data.redirect_url&&isBrowser()&&!(lr!=null&&lr.skipBrowserRedirect)&&window.location.assign(hr.data.redirect_url),hr})}catch(cr){if(isAuthError(cr))return this._returnResult({data:null,error:cr});throw cr}}async _denyAuthorization(or,lr){try{return await this._useSession(async cr=>{const{data:{session:ur},error:dr}=cr;if(dr)return this._returnResult({data:null,error:dr});if(!ur)return this._returnResult({data:null,error:new AuthSessionMissingError});const hr=await _request(this.fetch,"POST",`${this.url}/oauth/authorizations/${or}/consent`,{headers:this.headers,jwt:ur.access_token,body:{action:"deny"},xform:pr=>({data:pr,error:null})});return hr.data&&hr.data.redirect_url&&isBrowser()&&!(lr!=null&&lr.skipBrowserRedirect)&&window.location.assign(hr.data.redirect_url),hr})}catch(cr){if(isAuthError(cr))return this._returnResult({data:null,error:cr});throw cr}}async _listOAuthGrants(){try{return await this._useSession(async or=>{const{data:{session:lr},error:cr}=or;return cr?this._returnResult({data:null,error:cr}):lr?await _request(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:lr.access_token,xform:ur=>({data:ur,error:null})}):this._returnResult({data:null,error:new AuthSessionMissingError})})}catch(or){if(isAuthError(or))return this._returnResult({data:null,error:or});throw or}}async _revokeOAuthGrant(or){try{return await this._useSession(async lr=>{const{data:{session:cr},error:ur}=lr;return ur?this._returnResult({data:null,error:ur}):cr?(await _request(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:cr.access_token,query:{client_id:or.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new AuthSessionMissingError})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async fetchJwk(or,lr={keys:[]}){let cr=lr.keys.find(pr=>pr.kid===or);if(cr)return cr;const ur=Date.now();if(cr=this.jwks.keys.find(pr=>pr.kid===or),cr&&this.jwks_cached_at+JWKS_TTL>ur)return cr;const{data:dr,error:hr}=await _request(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(hr)throw hr;return!dr.keys||dr.keys.length===0||(this.jwks=dr,this.jwks_cached_at=ur,cr=dr.keys.find(pr=>pr.kid===or),!cr)?null:cr}async getClaims(or,lr={}){try{let cr=or;if(!cr){const{data:gr,error:yr}=await this.getSession();if(yr||!gr.session)return this._returnResult({data:null,error:yr});cr=gr.session.access_token}const{header:ur,payload:dr,signature:hr,raw:{header:pr,payload:xr}}=decodeJWT(cr);lr!=null&&lr.allowExpired||validateExp(dr.exp);const mr=!ur.alg||ur.alg.startsWith("HS")||!ur.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(ur.kid,lr!=null&&lr.keys?{keys:lr.keys}:lr==null?void 0:lr.jwks);if(!mr){const{error:gr}=await this.getUser(cr);if(gr)throw gr;return{data:{claims:dr,header:ur,signature:hr},error:null}}const fr=getAlgorithm(ur.alg),Er=await crypto.subtle.importKey("jwk",mr,fr,!0,["verify"]);if(!await crypto.subtle.verify(fr,Er,hr,stringToUint8Array(`${pr}.${xr}`)))throw new AuthInvalidJwtError("Invalid JWT signature");return{data:{claims:dr,header:ur,signature:hr},error:null}}catch(cr){if(isAuthError(cr))return this._returnResult({data:null,error:cr});throw cr}}}GoTrueClient.nextInstanceID={};const AuthClient=GoTrueClient,version="2.93.1";let JS_ENV="";typeof Deno<"u"?JS_ENV="deno":typeof document<"u"?JS_ENV="web":typeof navigator<"u"&&navigator.product==="ReactNative"?JS_ENV="react-native":JS_ENV="node";function getClientPlatform(){const ar=globalThis.process;if(ar&&ar.platform){const or=ar.platform;if(or==="darwin")return"macOS";if(or==="win32")return"Windows";if(or==="linux")return"Linux";if(or==="android")return"Android"}if(typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platform){const or=navigator.userAgentData.platform;if(or==="macOS")return"macOS";if(or==="Windows")return"Windows";if(or==="Linux")return"Linux";if(or==="Android")return"Android";if(or==="iOS")return"iOS"}return null}function getClientPlatformVersion(){const ar=globalThis.process;if(ar){const or=ar.versions;if(or&&or.node&&typeof window>"u")try{const lr=globalThis.require;if(lr)return lr("os").release()}catch{return null}}if(typeof Deno<"u"&&Deno.osRelease)try{return Deno.osRelease()}catch{return null}return typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platformVersion?navigator.userAgentData.platformVersion:null}function getClientRuntime(){if(typeof Deno<"u")return"deno";if(typeof Bun<"u")return"bun";const ar=globalThis.process;if(ar){const or=ar.versions;if(or&&or.node)return"node"}return null}function getClientRuntimeVersion(){if(typeof Deno<"u"&&Deno.version)return Deno.version.deno;if(typeof Bun<"u"&&Bun.version)return Bun.version;const ar=globalThis.process;if(ar){const or=ar.versions;if(or&&or.node)return or.node}return null}function buildHeaders(){const ar={"X-Client-Info":`supabase-js-${JS_ENV}/${version}`},or=getClientPlatform();or&&(ar["X-Supabase-Client-Platform"]=or);const lr=getClientPlatformVersion();lr&&(ar["X-Supabase-Client-Platform-Version"]=lr);const cr=getClientRuntime();cr&&(ar["X-Supabase-Client-Runtime"]=cr);const ur=getClientRuntimeVersion();return ur&&(ar["X-Supabase-Client-Runtime-Version"]=ur),ar}const DEFAULT_HEADERS=buildHeaders(),DEFAULT_GLOBAL_OPTIONS={headers:DEFAULT_HEADERS},DEFAULT_DB_OPTIONS={schema:"public"},DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},DEFAULT_REALTIME_OPTIONS={};function _typeof(ar){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(or){return typeof or}:function(or){return or&&typeof Symbol=="function"&&or.constructor===Symbol&&or!==Symbol.prototype?"symbol":typeof or},_typeof(ar)}function toPrimitive(ar,or){if(_typeof(ar)!="object"||!ar)return ar;var lr=ar[Symbol.toPrimitive];if(lr!==void 0){var cr=lr.call(ar,or);if(_typeof(cr)!="object")return cr;throw new TypeError("@@toPrimitive must return a primitive value.")}return(or==="string"?String:Number)(ar)}function toPropertyKey(ar){var or=toPrimitive(ar,"string");return _typeof(or)=="symbol"?or:or+""}function _defineProperty(ar,or,lr){return(or=toPropertyKey(or))in ar?Object.defineProperty(ar,or,{value:lr,enumerable:!0,configurable:!0,writable:!0}):ar[or]=lr,ar}function ownKeys(ar,or){var lr=Object.keys(ar);if(Object.getOwnPropertySymbols){var cr=Object.getOwnPropertySymbols(ar);or&&(cr=cr.filter(function(ur){return Object.getOwnPropertyDescriptor(ar,ur).enumerable})),lr.push.apply(lr,cr)}return lr}function _objectSpread2(ar){for(var or=1;or<arguments.length;or++){var lr=arguments[or]!=null?arguments[or]:{};or%2?ownKeys(Object(lr),!0).forEach(function(cr){_defineProperty(ar,cr,lr[cr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ar,Object.getOwnPropertyDescriptors(lr)):ownKeys(Object(lr)).forEach(function(cr){Object.defineProperty(ar,cr,Object.getOwnPropertyDescriptor(lr,cr))})}return ar}const resolveFetch=ar=>ar?(...or)=>ar(...or):(...or)=>fetch(...or),resolveHeadersConstructor=()=>Headers,fetchWithAuth=(ar,or,lr)=>{const cr=resolveFetch(lr),ur=resolveHeadersConstructor();return async(dr,hr)=>{var pr;const xr=(pr=await or())!==null&&pr!==void 0?pr:ar;let mr=new ur(hr==null?void 0:hr.headers);return mr.has("apikey")||mr.set("apikey",ar),mr.has("Authorization")||mr.set("Authorization",`Bearer ${xr}`),cr(dr,_objectSpread2(_objectSpread2({},hr),{},{headers:mr}))}};function ensureTrailingSlash(ar){return ar.endsWith("/")?ar:ar+"/"}function applySettingDefaults(ar,or){var lr,cr;const{db:ur,auth:dr,realtime:hr,global:pr}=ar,{db:xr,auth:mr,realtime:fr,global:Er}=or,vr={db:_objectSpread2(_objectSpread2({},xr),ur),auth:_objectSpread2(_objectSpread2({},mr),dr),realtime:_objectSpread2(_objectSpread2({},fr),hr),storage:{},global:_objectSpread2(_objectSpread2(_objectSpread2({},Er),pr),{},{headers:_objectSpread2(_objectSpread2({},(lr=Er==null?void 0:Er.headers)!==null&&lr!==void 0?lr:{}),(cr=pr==null?void 0:pr.headers)!==null&&cr!==void 0?cr:{})}),accessToken:async()=>""};return ar.accessToken?vr.accessToken=ar.accessToken:delete vr.accessToken,vr}function validateSupabaseUrl(ar){const or=ar==null?void 0:ar.trim();if(!or)throw new Error("supabaseUrl is required.");if(!or.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(ensureTrailingSlash(or))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var SupabaseAuthClient=class extends AuthClient{constructor(ar){super(ar)}},SupabaseClient=class{constructor(ar,or,lr){var cr,ur;this.supabaseUrl=ar,this.supabaseKey=or;const dr=validateSupabaseUrl(ar);if(!or)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",dr),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",dr),this.storageUrl=new URL("storage/v1",dr),this.functionsUrl=new URL("functions/v1",dr);const hr=`sb-${dr.hostname.split(".")[0]}-auth-token`,pr={db:DEFAULT_DB_OPTIONS,realtime:DEFAULT_REALTIME_OPTIONS,auth:_objectSpread2(_objectSpread2({},DEFAULT_AUTH_OPTIONS),{},{storageKey:hr}),global:DEFAULT_GLOBAL_OPTIONS},xr=applySettingDefaults(lr??{},pr);if(this.storageKey=(cr=xr.auth.storageKey)!==null&&cr!==void 0?cr:"",this.headers=(ur=xr.global.headers)!==null&&ur!==void 0?ur:{},xr.accessToken)this.accessToken=xr.accessToken,this.auth=new Proxy({},{get:(fr,Er)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(Er)} is not possible`)}});else{var mr;this.auth=this._initSupabaseAuthClient((mr=xr.auth)!==null&&mr!==void 0?mr:{},this.headers,xr.global.fetch)}this.fetch=fetchWithAuth(or,this._getAccessToken.bind(this),xr.global.fetch),this.realtime=this._initRealtimeClient(_objectSpread2({headers:this.headers,accessToken:this._getAccessToken.bind(this)},xr.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(fr=>this.realtime.setAuth(fr)).catch(fr=>console.warn("Failed to set initial Realtime auth token:",fr)),this.rest=new PostgrestClient(new URL("rest/v1",dr).href,{headers:this.headers,schema:xr.db.schema,fetch:this.fetch}),this.storage=new StorageClient(this.storageUrl.href,this.headers,this.fetch,lr==null?void 0:lr.storage),xr.accessToken||this._listenForAuthEvents()}get functions(){return new FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(ar){return this.rest.from(ar)}schema(ar){return this.rest.schema(ar)}rpc(ar,or={},lr={head:!1,get:!1,count:void 0}){return this.rest.rpc(ar,or,lr)}channel(ar,or={config:{}}){return this.realtime.channel(ar,or)}getChannels(){return this.realtime.getChannels()}removeChannel(ar){return this.realtime.removeChannel(ar)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var ar=this,or,lr;if(ar.accessToken)return await ar.accessToken();const{data:cr}=await ar.auth.getSession();return(or=(lr=cr.session)===null||lr===void 0?void 0:lr.access_token)!==null&&or!==void 0?or:ar.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:ar,persistSession:or,detectSessionInUrl:lr,storage:cr,userStorage:ur,storageKey:dr,flowType:hr,lock:pr,debug:xr,throwOnError:mr},fr,Er){const vr={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl.href,headers:_objectSpread2(_objectSpread2({},vr),fr),storageKey:dr,autoRefreshToken:ar,persistSession:or,detectSessionInUrl:lr,storage:cr,userStorage:ur,flowType:hr,lock:pr,debug:xr,throwOnError:mr,fetch:Er,hasCustomAuthorizationHeader:Object.keys(this.headers).some(gr=>gr.toLowerCase()==="authorization")})}_initRealtimeClient(ar){return new RealtimeClient(this.realtimeUrl.href,_objectSpread2(_objectSpread2({},ar),{},{params:_objectSpread2(_objectSpread2({},{apikey:this.supabaseKey}),ar==null?void 0:ar.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((ar,or)=>{this._handleTokenChanged(ar,"CLIENT",or==null?void 0:or.access_token)})}_handleTokenChanged(ar,or,lr){(ar==="TOKEN_REFRESHED"||ar==="SIGNED_IN")&&this.changedAccessToken!==lr?(this.changedAccessToken=lr,this.realtime.setAuth(lr)):ar==="SIGNED_OUT"&&(this.realtime.setAuth(),or=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const createClient=(ar,or,lr)=>new SupabaseClient(ar,or,lr);function shouldShowDeprecationWarning(){if(typeof window<"u")return!1;const ar=globalThis.process;if(!ar)return!1;const or=ar.version;if(or==null)return!1;const lr=or.match(/^v(\d+)\./);return lr?parseInt(lr[1],10)<=18:!1}shouldShowDeprecationWarning()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const supabaseUrl=void 0,supabaseAnonKey=void 0,isSupabaseConfigured=!!supabaseUrl,supabase=isSupabaseConfigured?createClient(supabaseUrl,supabaseAnonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:localStorage,storageKey:"checks-happy-auth"}}):createClient("https://placeholder.supabase.co","placeholder-key",{auth:{autoRefreshToken:!1,persistSession:!1}});async function signUp({email:ar,password:or,name:lr}){try{const{data:cr,error:ur}=await supabase.auth.signUp({email:ar,password:or,options:{data:{name:lr}}});if(ur)throw ur;if(!cr.user)throw new Error("No user returned from sign up");const{error:dr}=await supabase.from("users").insert({id:cr.user.id,email:ar,name:lr,tier:"trainee"});return dr&&console.error("Error creating user profile:",dr),{user:cr.user,error:null}}catch(cr){return{user:null,error:cr}}}async function signIn({email:ar,password:or}){try{const{data:lr,error:cr}=await supabase.auth.signInWithPassword({email:ar,password:or});if(cr)throw cr;return{user:lr.user,error:null}}catch(lr){return{user:null,error:lr}}}async function signOut(){try{const{error:ar}=await supabase.auth.signOut();if(ar)throw ar;return{error:null}}catch(ar){return{error:ar}}}async function getUserProfile(ar){try{const{data:or,error:lr}=await supabase.from("users").select("*").eq("id",ar).single();if(lr)throw lr;return{profile:or,error:null}}catch(or){return{profile:null,error:or}}}async function updateUserProfile(ar,or){try{const{error:lr}=await supabase.from("users").update(or).eq("id",ar);if(lr)throw lr;return{error:null}}catch(lr){return{error:lr}}}async function updateUserTier(ar,or){return updateUserProfile(ar,{tier:or})}async function resetPassword(ar){try{const{error:or}=await supabase.auth.resetPasswordForEmail(ar,{redirectTo:`${window.location.origin}/reset-password`});if(or)throw or;return{error:null}}catch(or){return{error:or}}}async function getSession(){const{data:{session:ar},error:or}=await supabase.auth.getSession();if(or)throw or;return ar}function generateInviteCode(){const ar="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let or="";for(let lr=0;lr<3;lr++)or+=ar[Math.floor(Math.random()*ar.length)];or+="-";for(let lr=0;lr<4;lr++)or+=ar[Math.floor(Math.random()*ar.length)];return or}async function createProject(ar,or,lr){try{const cr=generateInviteCode(),{data:ur,error:dr}=await supabase.from("projects").insert({name:ar,production_type:or,invite_code:cr,created_by:lr}).select().single();if(dr)throw dr;const{error:hr}=await supabase.from("project_members").insert({project_id:ur.id,user_id:lr,role:"designer",is_owner:!0});if(hr)throw await supabase.from("projects").delete().eq("id",ur.id),hr;return{project:ur,inviteCode:cr,error:null}}catch(cr){return{project:null,inviteCode:null,error:cr}}}async function joinProject(ar,or,lr="floor"){try{const{data:cr,error:ur}=await supabase.from("projects").select("*").eq("invite_code",ar.toUpperCase()).single();if(ur)throw ur.code==="PGRST116"?new Error("Invalid invite code"):ur;const{data:dr}=await supabase.from("project_members").select("id").eq("project_id",cr.id).eq("user_id",or).single();if(dr)return{project:cr,error:null};const{error:hr}=await supabase.from("project_members").insert({project_id:cr.id,user_id:or,role:lr,is_owner:!1});if(hr)throw hr;return{project:cr,error:null}}catch(cr){return{project:null,error:cr}}}async function getUserProjects(ar){try{const{data:or,error:lr}=await supabase.from("project_members").select(`
        role,
        is_owner,
        joined_at,
        projects (*)
      `).eq("user_id",ar).order("joined_at",{ascending:!1});if(lr)throw lr;return{projects:(or||[]).map(ur=>({...ur.projects,role:ur.role,is_owner:ur.is_owner})),error:null}}catch(or){return{projects:[],error:or}}}async function deleteProject(ar,or){try{const{data:lr,error:cr}=await supabase.from("project_members").select("is_owner").eq("project_id",ar).eq("user_id",or).single();if(cr)throw new Error("Failed to verify project ownership");if(!(lr!=null&&lr.is_owner))throw new Error("Only project owners can delete projects");const{data:ur}=await supabase.from("scenes").select("id").eq("project_id",ar),dr=(ur==null?void 0:ur.map(mr=>mr.id))||[],{data:hr}=await supabase.from("looks").select("id").eq("project_id",ar),pr=(hr==null?void 0:hr.map(mr=>mr.id))||[];dr.length>0&&await supabase.from("scene_characters").delete().in("scene_id",dr),pr.length>0&&await supabase.from("look_scenes").delete().in("look_id",pr),await supabase.from("looks").delete().eq("project_id",ar),await supabase.from("characters").delete().eq("project_id",ar),await supabase.from("scenes").delete().eq("project_id",ar),await supabase.from("project_members").delete().eq("project_id",ar);const{error:xr}=await supabase.from("projects").delete().eq("id",ar);if(xr)throw xr;return{error:null}}catch(lr){return{error:lr}}}async function leaveProject(ar,or){try{const{data:lr,error:cr}=await supabase.from("project_members").select("is_owner").eq("project_id",ar).eq("user_id",or).single();if(cr)throw new Error("Failed to verify membership");if(lr!=null&&lr.is_owner)throw new Error("Owners cannot leave their own project. Transfer ownership or delete the project instead.");const{error:ur}=await supabase.from("project_members").delete().eq("project_id",ar).eq("user_id",or);if(ur)throw ur;return{error:null}}catch(lr){return{error:lr}}}const VALID_TIERS=["trainee","artist","supervisor","designer"];function toAppUser(ar){const or=VALID_TIERS.includes(ar.tier)?ar.tier:"trainee";return{id:ar.id,email:ar.email,name:ar.name,tier:or,createdAt:new Date(ar.created_at)}}function toProjectMembership(ar){return{projectId:ar.id,projectName:ar.name,productionType:ar.production_type,role:ar.is_owner?"owner":ar.role,joinedAt:new Date(ar.created_at),lastAccessedAt:new Date,teamMemberCount:0,sceneCount:0,projectCode:ar.invite_code,status:ar.status==="wrapped"?"wrapped":"active"}}const useAuthStore=create()(persist((ar,or)=>({isAuthenticated:!1,user:null,isLoading:!1,error:null,currentScreen:"welcome",screenHistory:[],hasCompletedOnboarding:!1,hasSelectedPlan:!1,subscription:createDefaultSubscription(),projectMemberships:[],guestProjectCode:null,settingsProjectId:null,initializeAuth:async()=>{try{const lr=await getSession();if(lr!=null&&lr.user){const{profile:cr,error:ur}=await getUserProfile(lr.user.id);if(cr&&!ur){const dr=toAppUser(cr),{projects:hr}=await getUserProjects(lr.user.id),pr=hr.map(toProjectMembership);ar({isAuthenticated:!0,user:dr,projectMemberships:pr,hasCompletedOnboarding:!0,hasSelectedPlan:!0,currentScreen:"hub"})}}}catch(lr){console.error("Error initializing auth:",lr)}},refreshUserProjects:async()=>{const{user:lr}=or();if(lr)try{const{projects:cr}=await getUserProjects(lr.id),ur=cr.map(toProjectMembership);ar({projectMemberships:ur})}catch(cr){console.error("Error refreshing projects:",cr)}},setScreen:(lr,cr=!0)=>{const{currentScreen:ur,screenHistory:dr}=or();lr!==ur&&ar(cr?{currentScreen:lr,screenHistory:[...dr,ur],error:null}:{currentScreen:lr,error:null})},goBack:()=>{const{screenHistory:lr,isAuthenticated:cr}=or();if(lr.length>0){const ur=[...lr],dr=ur.pop();ar({currentScreen:dr,screenHistory:ur,error:null})}else ar({currentScreen:cr?"hub":"welcome",error:null})},signIn:async(lr,cr)=>{var ur,dr;ar({isLoading:!0,error:null});try{const{user:hr,error:pr}=await signIn({email:lr,password:cr});if(pr){const fr=pr.message.includes("Invalid login")?"Invalid email or password":pr.message;return ar({isLoading:!1,error:fr}),!1}if(!hr)return ar({isLoading:!1,error:"Sign in failed. Please try again."}),!1;const{profile:xr,error:mr}=await getUserProfile(hr.id);if(mr||!xr){await supabase.from("users").insert({id:hr.id,email:hr.email,name:((ur=hr.user_metadata)==null?void 0:ur.name)||lr.split("@")[0],tier:"trainee"});const fr={id:hr.id,email:hr.email,name:((dr=hr.user_metadata)==null?void 0:dr.name)||lr.split("@")[0],tier:"trainee",createdAt:new Date};ar({isAuthenticated:!0,user:fr,isLoading:!1,error:null,currentScreen:"hub",hasCompletedOnboarding:!0,hasSelectedPlan:!0})}else{const fr=toAppUser(xr),{projects:Er}=await getUserProjects(hr.id),vr=Er.map(toProjectMembership);ar({isAuthenticated:!0,user:fr,projectMemberships:vr,isLoading:!1,error:null,currentScreen:"hub",hasCompletedOnboarding:!0,hasSelectedPlan:!0})}return!0}catch(hr){return console.error("Sign in error:",hr),ar({isLoading:!1,error:"An error occurred. Please try again."}),!1}},signUp:async(lr,cr,ur)=>{ar({isLoading:!0,error:null});try{const{user:dr,error:hr}=await signUp({email:cr,password:ur,name:lr});if(hr){const xr=hr.message.includes("already registered")?"An account with this email already exists":hr.message;return ar({isLoading:!1,error:xr}),!1}if(!dr)return ar({isLoading:!1,error:"Sign up failed. Please try again."}),!1;const pr={id:dr.id,email:dr.email,name:lr,tier:BETA_MODE?"designer":"trainee",createdAt:new Date};return ar({isAuthenticated:!0,user:pr,isLoading:!1,error:null,currentScreen:BETA_MODE?"hub":"select-plan",hasCompletedOnboarding:BETA_MODE,hasSelectedPlan:BETA_MODE,subscription:createDefaultSubscription(),projectMemberships:[]}),!0}catch(dr){return console.error("Sign up error:",dr),ar({isLoading:!1,error:"An error occurred. Please try again."}),!1}},signOut:async()=>{try{await signOut()}catch(lr){console.error("Sign out error:",lr)}ar({isAuthenticated:!1,user:null,currentScreen:"welcome",screenHistory:[],hasCompletedOnboarding:!1,hasSelectedPlan:!1,subscription:createDefaultSubscription(),projectMemberships:[],guestProjectCode:null})},joinProject:async lr=>{const{user:cr,projectMemberships:ur,isAuthenticated:dr}=or();ar({isLoading:!0,error:null});try{if(!dr||!cr)return ar({isLoading:!1,guestProjectCode:lr.toUpperCase()}),{success:!0,projectName:"Project"};const{project:hr,error:pr}=await joinProject(lr,cr.id);if(pr)return ar({isLoading:!1,error:pr.message}),{success:!1,error:pr.message};if(!hr)return ar({isLoading:!1,error:"Failed to join project"}),{success:!1,error:"Failed to join project"};const xr={projectId:hr.id,projectName:hr.name,productionType:hr.production_type,role:"floor",joinedAt:new Date,lastAccessedAt:new Date,teamMemberCount:1,sceneCount:0,projectCode:hr.invite_code,status:"active"};return ar({isLoading:!1,projectMemberships:[...ur,xr],currentScreen:"hub"}),{success:!0,projectName:hr.name}}catch(hr){return console.error("Join project error:",hr),ar({isLoading:!1,error:"Failed to join project. Please try again."}),{success:!1,error:"Failed to join project"}}},createProject:async(lr,cr)=>{const{user:ur,projectMemberships:dr}=or(),hr=ur?TIER_LIMITS[ur.tier]:null;if(!ur||!(hr!=null&&hr.canCreateProjects))return ar({error:"Your account tier does not allow creating projects"}),{success:!1,error:"Insufficient permissions"};ar({isLoading:!0,error:null});try{const{project:pr,inviteCode:xr,error:mr}=await createProject(lr,cr,ur.id);if(mr||!pr||!xr)return ar({isLoading:!1,error:(mr==null?void 0:mr.message)||"Failed to create project"}),{success:!1,error:(mr==null?void 0:mr.message)||"Failed to create project"};const fr={projectId:pr.id,projectName:pr.name,productionType:cr,role:"owner",joinedAt:new Date,lastAccessedAt:new Date,teamMemberCount:1,sceneCount:0,projectCode:xr,status:"active"};return ar({isLoading:!1,projectMemberships:[...dr,fr]}),{success:!0,code:xr}}catch(pr){return console.error("Create project error:",pr),ar({isLoading:!1,error:"Failed to create project. Please try again."}),{success:!1,error:"Failed to create project"}}},clearError:()=>{ar({error:null})},setHasCompletedOnboarding:lr=>{ar({hasCompletedOnboarding:lr})},canCreateProjects:()=>{const{user:lr}=or();if(!lr)return!1;const cr=TIER_LIMITS[lr.tier];return cr?cr.canCreateProjects:!1},updateLastAccessed:lr=>{const{projectMemberships:cr}=or(),ur=cr.map(dr=>dr.projectId===lr?{...dr,lastAccessedAt:new Date}:dr);ar({projectMemberships:ur})},selectTier:async(lr,cr)=>{const{user:ur}=or();if(!ur)return!1;ar({isLoading:!0,error:null});try{const{error:dr}=await updateUserTier(ur.id,lr);if(dr)return ar({isLoading:!1,error:dr.message}),!1;const hr={...ur,tier:lr},pr={tier:lr,status:lr==="trainee"?null:"active",billingPeriod:lr==="trainee"?null:cr,subscriptionStartedAt:lr!=="trainee"?new Date:void 0,currentPeriodEndsAt:lr!=="trainee"?new Date(Date.now()+(cr==="yearly"?365:30)*24*60*60*1e3):void 0};return ar({user:hr,subscription:pr,hasSelectedPlan:!0,hasCompletedOnboarding:!0,currentScreen:"hub",isLoading:!1,error:null}),!0}catch(dr){return console.error("Select tier error:",dr),ar({isLoading:!1,error:"Failed to update subscription. Please try again."}),!1}},updateSubscription:lr=>{const{subscription:cr,user:ur}=or(),dr={...cr,...lr};if(lr.tier&&ur){const hr={...ur,tier:lr.tier};updateUserTier(ur.id,lr.tier).catch(console.error),ar({subscription:dr,user:hr})}else ar({subscription:dr})},deleteProject:async lr=>{const{user:cr,projectMemberships:ur}=or();if(!cr)return{success:!1,error:"Not authenticated"};ar({isLoading:!0,error:null});try{if(!lr.startsWith("project-")){const{error:pr}=await deleteProject(lr,cr.id);if(pr)return ar({isLoading:!1,error:pr.message}),{success:!1,error:pr.message}}const hr=ur.filter(pr=>pr.projectId!==lr);return ar({isLoading:!1,projectMemberships:hr,error:null}),{success:!0}}catch(dr){return console.error("Delete project error:",dr),ar({isLoading:!1,error:"Failed to delete project. Please try again."}),{success:!1,error:"Failed to delete project"}}},leaveProject:async lr=>{const{user:cr,projectMemberships:ur}=or();if(!cr)return{success:!1,error:"Not authenticated"};ar({isLoading:!0,error:null});try{if(!lr.startsWith("project-")){const{error:pr}=await leaveProject(lr,cr.id);if(pr)return ar({isLoading:!1,error:pr.message}),{success:!1,error:pr.message}}const hr=ur.filter(pr=>pr.projectId!==lr);return ar({isLoading:!1,projectMemberships:hr,error:null}),{success:!0}}catch(dr){return console.error("Leave project error:",dr),ar({isLoading:!1,error:"Failed to leave project. Please try again."}),{success:!1,error:"Failed to leave project"}}},setSettingsProjectId:lr=>{ar({settingsProjectId:lr})}}),{name:"checks-happy-auth-storage",storage:createJSONStorage(()=>localStorage),partialize:ar=>({isAuthenticated:ar.isAuthenticated,user:ar.user,currentScreen:ar.currentScreen,hasCompletedOnboarding:ar.hasCompletedOnboarding,hasSelectedPlan:ar.hasSelectedPlan,subscription:ar.subscription,projectMemberships:ar.projectMemberships,guestProjectCode:ar.guestProjectCode})}));isSupabaseConfigured&&supabase.auth.onAuthStateChange(async(ar,or)=>{ar==="SIGNED_IN"&&(or!=null&&or.user)?useAuthStore.getState().initializeAuth():ar==="TOKEN_REFRESHED"&&(or!=null&&or.user)?useAuthStore.getState().isAuthenticated||useAuthStore.getState().initializeAuth():ar==="USER_UPDATED"&&(or!=null&&or.user)?useAuthStore.getState().initializeAuth():ar==="SIGNED_OUT"&&useAuthStore.setState({isAuthenticated:!1,user:null,projectMemberships:[],currentScreen:"welcome",screenHistory:[],hasCompletedOnboarding:!1,hasSelectedPlan:!1,subscription:createDefaultSubscription(),guestProjectCode:null})});const useSyncStore=create()(ar=>({status:"idle",lastSyncedAt:null,pendingChanges:0,error:null,activeProjectId:null,realtimeConnected:!1,onlineMembers:0,setStatus:or=>ar({status:or,error:or==="error"?void 0:null}),setSynced:()=>ar({status:"synced",lastSyncedAt:new Date,error:null}),setSyncing:()=>ar({status:"syncing",error:null}),setError:or=>ar({status:"error",error:or}),setOffline:()=>ar({status:"offline"}),setActiveProject:or=>ar({activeProjectId:or}),setRealtimeConnected:or=>ar({realtimeConnected:or}),setOnlineMembers:or=>ar({onlineMembers:or}),incrementPending:()=>ar(or=>({pendingChanges:or.pendingChanges+1})),decrementPending:()=>ar(or=>({pendingChanges:Math.max(0,or.pendingChanges-1)})),clearPending:()=>ar({pendingChanges:0}),reset:()=>ar({status:"idle",lastSyncedAt:null,pendingChanges:0,error:null,activeProjectId:null,realtimeConnected:!1,onlineMembers:0})})),BUCKET_NAME="continuity-photos";async function uploadPhoto(ar,or,lr,cr){try{const ur=lr instanceof File?lr.name.split(".").pop():"jpg",dr=v4(),hr=`${ar}/${or}/${dr}.${ur}`,{data:pr,error:xr}=await supabase.storage.from(BUCKET_NAME).upload(hr,lr,{contentType:lr.type||"image/jpeg",cacheControl:"3600",upsert:!1});if(xr)throw xr;const{data:mr}=supabase.storage.from(BUCKET_NAME).getPublicUrl(hr);return{result:{path:pr.path,url:mr.publicUrl},error:null}}catch(ur){return{result:null,error:ur}}}async function uploadBase64Photo(ar,or,lr,cr="image/jpeg"){try{const dr=await(await fetch(lr)).blob();return uploadPhoto(ar,or,dr)}catch(ur){return{result:null,error:ur}}}async function downloadPhoto(ar){try{const{data:or,error:lr}=await supabase.storage.from(BUCKET_NAME).download(ar);if(lr)throw lr;return{blob:or,error:null}}catch(or){return{blob:null,error:or}}}const CLIENT_ID=v4(),PUSH_DEBOUNCE_MS=800;let activeChannel=null,activeProjectId=null,pushTimers={},pushingTables=new Set;function sceneToDb(ar,or){return{id:ar.id,project_id:or,scene_number:ar.sceneNumber,int_ext:ar.intExt||null,location:ar.slugline||null,time_of_day:ar.timeOfDay||null,synopsis:ar.synopsis||null,page_count:null,story_day:(ar.shootingDay,null),shooting_day:ar.shootingDay||null,filming_status:ar.filmingStatus||null,filming_notes:ar.filmingNotes||null,is_complete:ar.isComplete,completed_at:ar.completedAt?new Date(ar.completedAt).toISOString():null}}function characterToDb(ar,or){return{id:ar.id,project_id:or,name:ar.name,actor_name:null,initials:ar.initials,avatar_colour:ar.avatarColour||"#6366f1",base_look_description:null}}function lookToDb(ar,or){return{id:ar.id,project_id:or,character_id:ar.characterId,name:ar.name,description:ar.notes||null,estimated_time:ar.estimatedTime,makeup_details:ar.makeup,hair_details:ar.hair}}function sceneCaptureToDb(ar,or,lr){return{id:ar.id,scene_id:ar.sceneId,character_id:ar.characterId,look_id:ar.lookId||null,shooting_day:null,status:"in_progress",hair_notes:null,makeup_notes:null,prosthetics_notes:null,wounds_blood_notes:null,general_notes:ar.notes||null,application_time:ar.applicationTime||null,continuity_flags:ar.continuityFlags,continuity_events_data:ar.continuityEvents,sfx_details:ar.sfxDetails,checked_by:lr,checked_at:null}}function dbToScene(ar,or,lr){return{id:ar.id,sceneNumber:ar.scene_number,slugline:ar.location||"",intExt:ar.int_ext||"INT",timeOfDay:ar.time_of_day||"DAY",synopsis:ar.synopsis||void 0,characters:or,isComplete:ar.is_complete,completedAt:ar.completed_at?new Date(ar.completed_at):void 0,filmingStatus:ar.filming_status||void 0,filmingNotes:ar.filming_notes||void 0,shootingDay:ar.shooting_day||void 0,scriptContent:lr==null?void 0:lr.scriptContent,hasScheduleDiscrepancy:lr==null?void 0:lr.hasScheduleDiscrepancy,characterConfirmationStatus:lr==null?void 0:lr.characterConfirmationStatus,suggestedCharacters:lr==null?void 0:lr.suggestedCharacters,amendmentStatus:lr==null?void 0:lr.amendmentStatus,previousScriptContent:lr==null?void 0:lr.previousScriptContent,amendmentDate:lr==null?void 0:lr.amendmentDate,amendmentNotes:lr==null?void 0:lr.amendmentNotes}}function dbToCharacter(ar,or){return{id:ar.id,name:ar.name,initials:ar.initials,avatarColour:ar.avatar_colour,actorNumber:or==null?void 0:or.actorNumber}}function dbToLook(ar,or,lr){return{id:ar.id,characterId:ar.character_id,name:ar.name,scenes:or,estimatedTime:ar.estimated_time,makeup:ar.makeup_details||{foundation:"",coverage:"",concealer:"",concealerPlacement:"",contour:"",contourPlacement:"",highlight:"",highlightPlacement:"",blush:"",blushPlacement:"",browProduct:"",browShape:"",eyePrimer:"",lidColour:"",creaseColour:"",outerV:"",liner:"",lashes:"",lipLiner:"",lipColour:"",setting:""},hair:ar.hair_details||{style:"",products:"",parting:"",piecesOut:"",pins:"",accessories:"",hairType:"Natural",wigNameId:"",wigType:"",wigCapMethod:"",wigAttachment:[],hairline:"",laceTint:"",edgesBabyHairs:""},notes:ar.description||void 0,masterReference:lr==null?void 0:lr.masterReference,continuityFlags:lr==null?void 0:lr.continuityFlags,continuityEvents:lr==null?void 0:lr.continuityEvents,sfxDetails:lr==null?void 0:lr.sfxDetails}}function dbToSceneCapture(ar,or,lr){return{id:ar.id,sceneId:ar.scene_id,characterId:ar.character_id,lookId:ar.look_id||"",capturedAt:new Date(ar.created_at),photos:or,additionalPhotos:lr,continuityFlags:ar.continuity_flags||{sweat:!1,dishevelled:!1,blood:!1,dirt:!1,wetHair:!1,tears:!1},continuityEvents:ar.continuity_events_data||[],sfxDetails:ar.sfx_details||{sfxRequired:!1,sfxTypes:[],prostheticPieces:"",prostheticAdhesive:"",bloodTypes:[],bloodProducts:"",bloodPlacement:"",tattooCoverage:"",temporaryTattoos:"",contactLenses:"",teeth:"",agingCharacterNotes:"",sfxApplicationTime:null,sfxReferencePhotos:[]},notes:ar.general_notes||"",applicationTime:ar.application_time||void 0}}async function pullProjectData(ar){if(!isSupabaseConfigured)return!1;const or=useSyncStore.getState();or.setSyncing();try{const[lr,cr,ur,dr]=await Promise.all([supabase.from("scenes").select("*").eq("project_id",ar).order("scene_number"),supabase.from("characters").select("*").eq("project_id",ar).order("name"),supabase.from("looks").select("*").eq("project_id",ar),supabase.from("schedule_data").select("*").eq("project_id",ar).order("created_at",{ascending:!1}).limit(1)]);if(lr.error)throw lr.error;if(cr.error)throw cr.error;if(ur.error)throw ur.error;const hr=lr.data||[],pr=cr.data||[],xr=ur.data||[],mr=dr.data||[],fr=hr.map(Qr=>Qr.id),Er=xr.map(Qr=>Qr.id),[vr,gr,yr]=await Promise.all([fr.length>0?supabase.from("scene_characters").select("scene_id, character_id").in("scene_id",fr):Promise.resolve({data:[],error:null}),Er.length>0?supabase.from("look_scenes").select("look_id, scene_number").in("look_id",Er):Promise.resolve({data:[],error:null}),fr.length>0?supabase.from("continuity_events").select("*").in("scene_id",fr):Promise.resolve({data:[],error:null})]),jr=vr.data||[],br=gr.data||[],_r=yr.data||[],wr=_r.map(Qr=>Qr.id),Ar=(wr.length>0?await supabase.from("photos").select("*").in("continuity_event_id",wr):{data:[],error:null}).data||[];if(hr.length===0&&pr.length===0&&xr.length===0)return or.setSynced(),!0;const Sr=new Map;for(const Qr of jr){const Hr=Sr.get(Qr.scene_id)||[];Hr.push(Qr.character_id),Sr.set(Qr.scene_id,Hr)}const kr=new Map;for(const Qr of br){const Hr=kr.get(Qr.look_id)||[];Hr.push(Qr.scene_number),kr.set(Qr.look_id,Hr)}const Nr=new Map;for(const Qr of Ar){const Hr=Nr.get(Qr.continuity_event_id)||[];Hr.push(Qr),Nr.set(Qr.continuity_event_id,Hr)}const Cr=useProjectStore.getState(),Tr=Cr.currentProject;if(!Tr)return or.setSynced(),!0;const Pr=new Map(Tr.scenes.map(Qr=>[Qr.id,Qr])),Ir=new Map(Tr.characters.map(Qr=>[Qr.id,Qr])),Br=new Map(Tr.looks.map(Qr=>[Qr.id,Qr])),Wr=hr.map(Qr=>dbToScene(Qr,Sr.get(Qr.id)||[],Pr.get(Qr.id))),Yr=pr.map(Qr=>dbToCharacter(Qr,Ir.get(Qr.id))),es=xr.map(Qr=>dbToLook(Qr,kr.get(Qr.id)||[],Br.get(Qr.id))),ps={};for(const Qr of _r){const Hr=Nr.get(Qr.id)||[],Kr={},rs=[];for(const Mr of Hr){const Dr=await downloadAndCachePhoto(Mr);Dr&&(Mr.angle!=="additional"&&Mr.angle!=="detail"?Kr[Mr.angle]=Dr:rs.push(Dr))}ps[Qr.id]=dbToSceneCapture(Qr,Kr,rs)}const ts={...Tr,scenes:Wr,characters:Yr,looks:es};if(Cr.setProject(ts),Object.keys(ps).length>0)for(const[Qr,Hr]of Object.entries(ps))Cr.updateSceneCapture(Qr,Hr);if(mr.length>0){const Qr=mr[0];mergeScheduleData(Qr,ar)}return or.setSynced(),!0}catch(lr){return console.error("[SyncService] Pull failed:",lr),or.setError(lr instanceof Error?lr.message:"Pull failed"),!1}}async function downloadAndCachePhoto(ar){try{const or=await getPhotoBlob(ar.id);if(or)return{id:ar.id,uri:"",thumbnail:or.thumbnail,capturedAt:or.capturedAt,angle:ar.angle};const{blob:lr,error:cr}=await downloadPhoto(ar.storage_path);if(cr||!lr)return null;const ur=await createThumbnail(lr);return await savePhotoBlob(ar.id,lr,ur,ar.angle),{id:ar.id,uri:URL.createObjectURL(lr),thumbnail:ur,capturedAt:new Date(ar.taken_at),angle:ar.angle}}catch(or){return console.error("[SyncService] Photo download failed:",or),null}}async function createThumbnail(ar){return new Promise(or=>{const lr=new Image,cr=URL.createObjectURL(ar);lr.onload=()=>{const ur=document.createElement("canvas"),dr=80;ur.width=dr,ur.height=dr;const hr=ur.getContext("2d"),pr=Math.max(dr/lr.width,dr/lr.height),xr=(dr-lr.width*pr)/2,mr=(dr-lr.height*pr)/2;hr.drawImage(lr,xr,mr,lr.width*pr,lr.height*pr),URL.revokeObjectURL(cr),or(ur.toDataURL("image/jpeg",.6))},lr.onerror=()=>{URL.revokeObjectURL(cr),or("")},lr.src=cr})}function mergeScheduleData(ar,or){const lr=useScheduleStore.getState(),cr=lr.schedule;if(!ar.days&&!ar.cast_list||cr&&cr.days.length>0)return;const ur={id:ar.id,status:ar.status==="complete"?"complete":"pending",castList:ar.cast_list||[],days:ar.days||[],totalDays:(ar.days||[]).length,uploadedAt:new Date(ar.created_at),rawText:ar.raw_pdf_text||void 0};lr.setSchedule(ur)}function debouncedPush(ar,or){pushTimers[ar]&&clearTimeout(pushTimers[ar]),useSyncStore.getState().incrementPending(),pushTimers[ar]=setTimeout(async()=>{pushingTables.add(ar);try{useSyncStore.getState().setSyncing(),await or(),useSyncStore.getState().decrementPending(),useSyncStore.getState().pendingChanges===0&&useSyncStore.getState().setSynced()}catch(lr){console.error(`[SyncService] Push ${ar} failed:`,lr),useSyncStore.getState().setError(`Failed to sync ${ar}`)}finally{pushingTables.delete(ar)}},PUSH_DEBOUNCE_MS)}async function pushScenes(ar,or){isSupabaseConfigured&&debouncedPush("scenes",async()=>{const lr=or.map(hr=>sceneToDb(hr,ar)),{error:cr}=await supabase.from("scenes").upsert(lr,{onConflict:"id"});if(cr)throw cr;const ur=or.map(hr=>hr.id);ur.length>0&&await supabase.from("scene_characters").delete().in("scene_id",ur);const dr=[];for(const hr of or)for(const pr of hr.characters)dr.push({scene_id:hr.id,character_id:pr});if(dr.length>0){const{error:hr}=await supabase.from("scene_characters").insert(dr);if(hr)throw hr}})}async function pushCharacters(ar,or){isSupabaseConfigured&&debouncedPush("characters",async()=>{const lr=or.map(ur=>characterToDb(ur,ar)),{error:cr}=await supabase.from("characters").upsert(lr,{onConflict:"id"});if(cr)throw cr})}async function pushLooks(ar,or){isSupabaseConfigured&&debouncedPush("looks",async()=>{const lr=or.map(hr=>lookToDb(hr,ar)),{error:cr}=await supabase.from("looks").upsert(lr,{onConflict:"id"});if(cr)throw cr;const ur=or.map(hr=>hr.id);ur.length>0&&await supabase.from("look_scenes").delete().in("look_id",ur);const dr=[];for(const hr of or)for(const pr of hr.scenes)dr.push({look_id:hr.id,scene_number:pr});if(dr.length>0){const{error:hr}=await supabase.from("look_scenes").insert(dr);if(hr)throw hr}})}async function pushSceneCapture(ar,or,lr){isSupabaseConfigured&&debouncedPush(`capture_${or.id}`,async()=>{const cr=sceneCaptureToDb(or,ar,lr),{error:ur}=await supabase.from("continuity_events").upsert(cr,{onConflict:"id"});if(ur)throw ur;await syncCapturePhotos(ar,or)})}async function syncCapturePhotos(ar,or){const lr=[];for(const[cr,ur]of Object.entries(or.photos))ur&&lr.push({photo:ur,angle:cr});for(const cr of or.additionalPhotos)lr.push({photo:cr,angle:"additional"});for(const{photo:cr,angle:ur}of lr){const{data:dr}=await supabase.from("photos").select("id").eq("id",cr.id).single();if(dr)continue;let hr=null;const pr=await getPhotoBlob(cr.id);if(pr){const{result:xr,error:mr}=await uploadPhoto(ar,or.characterId,pr.blob);!mr&&xr&&(hr=xr.path)}else if(cr.uri&&cr.uri.startsWith("data:")){const{result:xr,error:mr}=await uploadBase64Photo(ar,or.characterId,cr.uri);!mr&&xr&&(hr=xr.path)}hr&&await supabase.from("photos").insert({id:cr.id,continuity_event_id:or.id,storage_path:hr,photo_type:"on_set",angle:ur,taken_at:cr.capturedAt?new Date(cr.capturedAt).toISOString():new Date().toISOString()})}}async function pushScheduleData(ar,or){isSupabaseConfigured&&debouncedPush("schedule",async()=>{const{error:lr}=await supabase.from("schedule_data").upsert({id:or.id,project_id:ar,raw_pdf_text:or.rawText||null,cast_list:or.castList,days:or.days,status:or.status==="complete"?"complete":"pending"},{onConflict:"id"});if(lr)throw lr})}function subscribeToProject(ar,or){if(!isSupabaseConfigured)return;activeChannel&&unsubscribeFromProject(),activeProjectId=ar;const lr=supabase.channel(`project:${ar}`,{config:{broadcast:{self:!1},presence:{key:or||CLIENT_ID}}});lr.on("postgres_changes",{event:"*",schema:"public",table:"scenes",filter:`project_id=eq.${ar}`},cr=>{pushingTables.has("scenes")||handleSceneChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"characters",filter:`project_id=eq.${ar}`},cr=>{pushingTables.has("characters")||handleCharacterChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"looks",filter:`project_id=eq.${ar}`},cr=>{pushingTables.has("looks")||handleLookChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"continuity_events"},cr=>{const ur=cr.new||cr.old;if(!(ur!=null&&ur.scene_id))return;const dr=useProjectStore.getState().currentProject;dr!=null&&dr.scenes.some(hr=>hr.id===ur.scene_id)&&(pushingTables.has(`capture_${ur.id}`)||handleContinuityEventChange(cr))}),lr.on("postgres_changes",{event:"*",schema:"public",table:"schedule_data",filter:`project_id=eq.${ar}`},cr=>{pushingTables.has("schedule")||handleScheduleChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"photos"},cr=>{const ur=cr.new||cr.old;!(ur!=null&&ur.continuity_event_id)||!useProjectStore.getState().sceneCaptures[ur.continuity_event_id]||handlePhotoChange(cr)}),lr.on("presence",{event:"sync"},()=>{const cr=lr.presenceState(),ur=Object.keys(cr).length;useSyncStore.getState().setOnlineMembers(ur)}),lr.subscribe(async cr=>{cr==="SUBSCRIBED"?(useSyncStore.getState().setRealtimeConnected(!0),or&&await lr.track({user_id:or,client_id:CLIENT_ID,online_at:new Date().toISOString()})):(cr==="CLOSED"||cr==="CHANNEL_ERROR")&&useSyncStore.getState().setRealtimeConnected(!1)}),activeChannel=lr,useSyncStore.getState().setActiveProject(ar)}function unsubscribeFromProject(){activeChannel&&(supabase.removeChannel(activeChannel),activeChannel=null),activeProjectId=null;for(const ar of Object.values(pushTimers))clearTimeout(ar);pushTimers={},pushingTables.clear(),useSyncStore.getState().setRealtimeConnected(!1),useSyncStore.getState().setActiveProject(null)}function handleSceneChange(ar){const or=useProjectStore.getState(),lr=or.currentProject;if(lr){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const cr=ar.new,ur=lr.scenes.find(dr=>dr.id===cr.id);fetchSceneCharacters(cr.id).then(dr=>{const hr=dbToScene(cr,dr,ur),pr=ur?lr.scenes.map(xr=>xr.id===hr.id?hr:xr):[...lr.scenes,hr];or.setProject({...lr,scenes:pr})})}else if(ar.eventType==="DELETE"){const cr=ar.old;or.setProject({...lr,scenes:lr.scenes.filter(ur=>ur.id!==cr.id)})}}}function handleCharacterChange(ar){const or=useProjectStore.getState(),lr=or.currentProject;if(lr){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const cr=ar.new,ur=lr.characters.find(pr=>pr.id===cr.id),dr=dbToCharacter(cr,ur),hr=ur?lr.characters.map(pr=>pr.id===dr.id?dr:pr):[...lr.characters,dr];or.setProject({...lr,characters:hr})}else if(ar.eventType==="DELETE"){const cr=ar.old;or.setProject({...lr,characters:lr.characters.filter(ur=>ur.id!==cr.id)})}}}function handleLookChange(ar){const or=useProjectStore.getState(),lr=or.currentProject;if(lr){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const cr=ar.new,ur=lr.looks.find(dr=>dr.id===cr.id);fetchLookScenes(cr.id).then(dr=>{const hr=dbToLook(cr,dr,ur),pr=ur?lr.looks.map(xr=>xr.id===hr.id?hr:xr):[...lr.looks,hr];or.setProject({...lr,looks:pr})})}else if(ar.eventType==="DELETE"){const cr=ar.old;or.setProject({...lr,looks:lr.looks.filter(ur=>ur.id!==cr.id)})}}}function handleContinuityEventChange(ar,or){const lr=useProjectStore.getState();if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const cr=ar.new;fetchCapturePhotos(cr.id).then(async ur=>{const dr={},hr=[];for(const xr of ur){const mr=await downloadAndCachePhoto(xr);mr&&(xr.angle!=="additional"&&xr.angle!=="detail"?dr[xr.angle]=mr:hr.push(mr))}const pr=dbToSceneCapture(cr,dr,hr);lr.updateSceneCapture(pr.id,pr)})}}function handleScheduleChange(ar,or){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const lr=ar.new;mergeScheduleData(lr)}}function handlePhotoChange(ar,or){if(ar.eventType==="INSERT"){const lr=ar.new;downloadAndCachePhoto(lr).then(cr=>{if(!cr)return;const ur=useProjectStore.getState(),dr=ur.sceneCaptures;for(const[hr,pr]of Object.entries(dr))if(hr===lr.continuity_event_id){lr.angle!=="additional"&&lr.angle!=="detail"?ur.addPhotoToCapture(hr,cr,lr.angle):ur.addPhotoToCapture(hr,cr,"additional");break}})}}async function fetchSceneCharacters(ar){const{data:or}=await supabase.from("scene_characters").select("character_id").eq("scene_id",ar);return(or||[]).map(lr=>lr.character_id)}async function fetchLookScenes(ar){const{data:or}=await supabase.from("look_scenes").select("scene_number").eq("look_id",ar);return(or||[]).map(lr=>lr.scene_number)}async function fetchCapturePhotos(ar){const{data:or}=await supabase.from("photos").select("*").eq("continuity_event_id",ar);return or||[]}async function startSync(ar,or){if(!isSupabaseConfigured){useSyncStore.getState().setOffline();return}if(!navigator.onLine){useSyncStore.getState().setOffline(),window.addEventListener("online",()=>{startSync(ar,or)},{once:!0});return}await pullProjectData(ar),subscribeToProject(ar,or),window.addEventListener("offline",()=>{useSyncStore.getState().setOffline()}),window.addEventListener("online",()=>{useSyncStore.getState().setStatus("syncing"),pullProjectData(ar).then(()=>{subscribeToProject(ar,or)})})}function stopSync(){unsubscribeFromProject(),useSyncStore.getState().reset()}function getActiveProjectId(){return activeProjectId}let initialized=!1;function initSyncSubscriptions(){initialized||(initialized=!0,useProjectStore.subscribe((ar,or)=>{var dr;const lr=getActiveProjectId();if(!lr||!ar.currentProject)return;const cr=or.currentProject,ur=ar.currentProject;if(!(!cr||!ur)&&(cr.scenes!==ur.scenes&&pushScenes(lr,ur.scenes),cr.characters!==ur.characters&&pushCharacters(lr,ur.characters),cr.looks!==ur.looks&&pushLooks(lr,ur.looks),or.sceneCaptures!==ar.sceneCaptures)){const hr=((dr=useAuthStore.getState().user)==null?void 0:dr.id)||null;for(const[pr,xr]of Object.entries(ar.sceneCaptures))or.sceneCaptures[pr]!==xr&&pushSceneCapture(lr,xr,hr)}}),useScheduleStore.subscribe((ar,or)=>{const lr=getActiveProjectId();lr&&ar.schedule!==or.schedule&&ar.schedule&&ar.schedule.status==="complete"&&pushScheduleData(lr,ar.schedule)}))}function r(ar){var or,lr,cr="";if(typeof ar=="string"||typeof ar=="number")cr+=ar;else if(typeof ar=="object")if(Array.isArray(ar)){var ur=ar.length;for(or=0;or<ur;or++)ar[or]&&(lr=r(ar[or]))&&(cr&&(cr+=" "),cr+=lr)}else for(lr in ar)ar[lr]&&(cr&&(cr+=" "),cr+=lr);return cr}function clsx(){for(var ar,or,lr=0,cr="",ur=arguments.length;lr<ur;lr++)(ar=arguments[lr])&&(or=r(ar))&&(cr&&(cr+=" "),cr+=or);return cr}const MAX_BOTTOM_NAV_ITEMS=5,useNavigationStore=create()(persist((ar,or)=>({bottomNavItems:DEFAULT_BOTTOM_NAV,isEditMenuOpen:!1,setBottomNavItems:lr=>{const cr=lr.slice(0,MAX_BOTTOM_NAV_ITEMS);ar({bottomNavItems:cr})},openEditMenu:()=>ar({isEditMenuOpen:!0}),closeEditMenu:()=>ar({isEditMenuOpen:!1}),moveToBottomNav:(lr,cr)=>{const ur=[...or().bottomNavItems],dr=ur.indexOf(lr);dr!==-1?(ur.splice(dr,1),ur.splice(cr,0,lr)):ur.length<MAX_BOTTOM_NAV_ITEMS?ur.splice(cr,0,lr):ur[cr]=lr,ar({bottomNavItems:ur.slice(0,MAX_BOTTOM_NAV_ITEMS)})},moveToMoreMenu:lr=>{const cr=or().bottomNavItems.filter(ur=>ur!==lr);cr.length!==0&&ar({bottomNavItems:cr})},reorderBottomNav:(lr,cr)=>{const ur=[...or().bottomNavItems],[dr]=ur.splice(lr,1);ur.splice(cr,0,dr),ar({bottomNavItems:ur})},getMoreMenuItems:()=>{const lr=or().bottomNavItems;return ALL_NAV_ITEMS.filter(cr=>!lr.includes(cr.id)).map(cr=>cr.id)},resetToDefaults:()=>{ar({bottomNavItems:DEFAULT_BOTTOM_NAV})}}),{name:"hair-makeup-navigation",storage:createJSONStorage(()=>localStorage),partialize:ar=>({bottomNavItems:ar.bottomNavItems})}));function BottomNav({activeTab:ar,onTabChange:or}){const{bottomNavItems:lr}=useNavigationStore(),cr=[...lr.map(ur=>{const dr=ALL_NAV_ITEMS.find(hr=>hr.id===ur);return dr?{id:dr.id,label:dr.label,icon:jsxRuntimeExports.jsx(NavIcon,{name:dr.iconName})}:null}).filter(Boolean),{id:"more",label:"More",icon:jsxRuntimeExports.jsx(NavIcon,{name:"ellipsis"})}];return jsxRuntimeExports.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-40 bg-card shadow-nav border-t border-border",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-around bottom-nav-safe",children:cr.map(ur=>{const dr=ar===ur.id;return jsxRuntimeExports.jsxs("button",{onClick:()=>or(ur.id),className:clsx("flex flex-col items-center justify-center py-2 px-3 min-w-[56px] tap-target touch-manipulation transition-colors",{"text-gold":dr,"text-text-light hover:text-text-muted":!dr}),"aria-current":dr?"page":void 0,children:[jsxRuntimeExports.jsx("span",{className:"w-6 h-6 mb-1",children:ur.icon}),jsxRuntimeExports.jsx("span",{className:clsx("text-[10px] font-medium",{"font-semibold":dr}),children:ur.label})]},ur.id)})})})})}function NavIcon({name:ar,className:or="w-full h-full"}){switch(ar){case"calendar":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})});case"grid":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 10h18M3 14h18M10 3v18M14 3v18M3 6a3 3 0 013-3h12a3 3 0 013 3v12a3 3 0 01-3 3H6a3 3 0 01-3-3V6z"})});case"book":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})});case"clock":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})});case"wallet":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v3"})});case"document":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})});case"schedule":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V15zm0 2.25h.008v.008h-.008v-.008zm2.25-4.5h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z"})});case"clipboard":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"})});case"cog":return jsxRuntimeExports.jsxs("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});case"ellipsis":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"})});default:return null}}function Header({title:ar,showBack:or=!1,onBack:lr,showSearch:cr=!1,onSearch:ur,rightContent:dr,className:hr}){return jsxRuntimeExports.jsx("header",{className:clsx("sticky top-0 z-30 bg-card border-b border-border safe-top",hr),children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between h-14 px-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[or&&jsxRuntimeExports.jsx("button",{onClick:lr,className:"flex items-center gap-1 text-gold tap-target touch-manipulation -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary truncate",children:ar})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[dr,cr&&jsxRuntimeExports.jsx("button",{onClick:ur,className:"p-2 text-text-muted hover:text-text-primary tap-target touch-manipulation","aria-label":"Search",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]})})})}function SyncStatusBanner(){const{status:ar,onlineMembers:or,lastSyncedAt:lr}=useSyncStore(),cr={idle:{color:"bg-gray-400",label:"Not connected"},syncing:{color:"bg-warning animate-pulse",label:"Syncing..."},synced:{color:"bg-success",label:"Synced"},error:{color:"bg-destructive",label:"Sync error"},offline:{color:"bg-gray-400",label:"Working offline"}},{color:ur,label:dr}=cr[ar],hr=lr?getTimeAgo(lr):null;return jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-[10px] px-4 py-3 mb-4 flex items-center justify-between shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2.5",children:[jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${ur}`}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-secondary",children:dr}),hr&&ar==="synced"&&jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:hr})]}),or>1&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("div",{className:"flex -space-x-1",children:Array.from({length:Math.min(or,3)}).map((pr,xr)=>jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-gold/20 border border-card flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px] text-gold font-medium",children:xr+1})},xr))}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[or," online"]})]})]})}function SyncDot(){const{status:ar}=useSyncStore(),or={idle:"bg-gray-400",syncing:"bg-warning animate-pulse",synced:"bg-success",error:"bg-destructive",offline:"bg-gray-400"};return jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${or[ar]}`})}function getTimeAgo(ar){const or=Math.floor((Date.now()-ar.getTime())/1e3);if(or<10)return"just now";if(or<60)return`${or}s ago`;const lr=Math.floor(or/60);return lr<60?`${lr}m ago`:`${Math.floor(lr/60)}h ago`}function ProjectHeader({onSwitchProject:ar,onNavigateToProfile:or}){const{currentProject:lr}=useProjectStore(),{user:cr}=useAuthStore();if(!lr)return null;const ur=()=>{if(!(cr!=null&&cr.name))return"U";const dr=cr.name.split(" ");return dr.length>=2?`${dr[0][0]}${dr[1][0]}`.toUpperCase():cr.name.substring(0,2).toUpperCase()};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-12 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("button",{onClick:ar,className:"flex items-center gap-2 min-w-0 active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsx("div",{className:"w-7 h-7 rounded-lg gold-gradient flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary truncate max-w-[200px]",children:lr.name}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-muted flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(SyncDot,{}),jsxRuntimeExports.jsx("button",{onClick:or,className:"w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center text-gold text-xs font-bold active:scale-95 transition-transform",children:ur()})]})]})})})})}const Button=reactExports.forwardRef(({className:ar,variant:or="primary",size:lr="md",fullWidth:cr=!1,children:ur,disabled:dr,...hr},pr)=>jsxRuntimeExports.jsx("button",{ref:pr,className:clsx("inline-flex items-center justify-center font-semibold transition-all duration-200 touch-manipulation tap-target","focus:outline-none focus:ring-2 focus:ring-gold/50 focus:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",{"btn-gold text-white active:scale-[0.98]":or==="primary","bg-input-bg text-text-primary border border-border hover:bg-gray-100 dark:hover:bg-gray-800 active:scale-[0.98]":or==="secondary","btn-outline-gold active:scale-[0.98]":or==="outline","text-gold hover:bg-gold/10 active:scale-[0.98]":or==="ghost","bg-red-500 text-white hover:bg-red-600 active:scale-[0.98]":or==="danger","px-3 py-1.5 text-sm rounded-lg":lr==="sm","px-4 py-2.5 text-base rounded-lg":lr==="md","px-6 py-3.5 text-lg rounded-lg":lr==="lg","w-full":cr},ar),disabled:dr,...hr,children:ur}));Button.displayName="Button";const Input=reactExports.forwardRef(({className:ar,label:or,error:lr,helperText:cr,id:ur,...dr},hr)=>{const pr=ur||(or==null?void 0:or.toLowerCase().replace(/\s+/g,"-"));return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[or&&jsxRuntimeExports.jsx("label",{htmlFor:pr,className:"field-label block mb-1.5",children:or}),jsxRuntimeExports.jsx("input",{ref:hr,id:pr,className:clsx("input-field w-full",{"border-error focus:border-error focus:ring-error/30":lr},ar),...dr}),lr&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-error",children:lr}),cr&&!lr&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-text-muted",children:cr})]})});Input.displayName="Input";const Textarea=reactExports.forwardRef(({className:ar,label:or,error:lr,helperText:cr,id:ur,rows:dr=3,...hr},pr)=>{const xr=ur||(or==null?void 0:or.toLowerCase().replace(/\s+/g,"-"));return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[or&&jsxRuntimeExports.jsx("label",{htmlFor:xr,className:"field-label block mb-1.5",children:or}),jsxRuntimeExports.jsx("textarea",{ref:pr,id:xr,rows:dr,className:clsx("input-field w-full resize-none",{"border-error focus:border-error focus:ring-error/30":lr},ar),...hr}),lr&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-error",children:lr}),cr&&!lr&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-text-muted",children:cr})]})});Textarea.displayName="Textarea";const Card=reactExports.forwardRef(({className:ar,variant:or="default",padding:lr="md",children:cr,...ur},dr)=>jsxRuntimeExports.jsx("div",{ref:dr,className:clsx("rounded-card",{"bg-card shadow-card":or==="default","bg-card":or==="flat","bg-card border border-border":or==="bordered","p-0":lr==="none","p-3":lr==="sm","p-card-padding":lr==="md","p-6":lr==="lg"},ar),...ur,children:cr}));Card.displayName="Card";const CardHeader=reactExports.forwardRef(({className:ar,children:or,...lr},cr)=>jsxRuntimeExports.jsx("div",{ref:cr,className:clsx("flex items-center justify-between mb-3",ar),...lr,children:or}));CardHeader.displayName="CardHeader";const CardTitle=reactExports.forwardRef(({className:ar,children:or,...lr},cr)=>jsxRuntimeExports.jsx("h3",{ref:cr,className:clsx("section-header",ar),...lr,children:or}));CardTitle.displayName="CardTitle";const CardContent=reactExports.forwardRef(({className:ar,children:or,...lr},cr)=>jsxRuntimeExports.jsx("div",{ref:cr,className:clsx(ar),...lr,children:or}));CardContent.displayName="CardContent";const Badge=reactExports.forwardRef(({className:ar,variant:or="default",size:lr="sm",children:cr,...ur},dr)=>jsxRuntimeExports.jsx("span",{ref:dr,className:clsx("inline-flex items-center justify-center font-semibold uppercase tracking-wide",{"bg-gray-100 text-text-muted":or==="default","bg-gold text-white":or==="gold","bg-blue-100 text-blue-700":or==="int","bg-gold-100 text-gold-700":or==="ext","bg-green-100 text-green-700":or==="success","bg-orange-100 text-orange-700":or==="warning","bg-red-100 text-red-700":or==="error","bg-transparent border border-current":or==="outline","px-1.5 py-0.5 text-[9px] rounded":lr==="sm","px-2.5 py-1 text-[10px] rounded-md":lr==="md"},ar),...ur,children:cr}));Badge.displayName="Badge";const CountBadge=reactExports.forwardRef(({className:ar,count:or,label:lr="fields",...cr},ur)=>jsxRuntimeExports.jsxs("span",{ref:ur,className:clsx("inline-flex items-center justify-center px-2.5 py-0.5 text-[10px] font-semibold rounded-xl","bg-gold-100/60 text-gold",ar),...cr,children:[or," ",lr]}));CountBadge.displayName="CountBadge";const TogglePill=reactExports.forwardRef(({className:ar,isActive:or,label:lr,onClick:cr,...ur},dr)=>jsxRuntimeExports.jsx("button",{ref:dr,type:"button",role:"switch","aria-checked":or,onClick:cr,className:clsx("px-3 py-1.5 text-xs font-medium rounded-pill border transition-all duration-200 touch-manipulation","focus:outline-none focus:ring-2 focus:ring-gold/50",{"bg-gold-50 text-gold border-gold":or,"bg-gray-100 text-text-muted border-gray-200 hover:bg-gray-200":!or},ar),...ur,children:lr}));TogglePill.displayName="TogglePill";const Switch=reactExports.forwardRef(({className:ar,isOn:or,label:lr,onToggle:cr,...ur},dr)=>jsxRuntimeExports.jsxs("button",{ref:dr,type:"button",role:"switch","aria-checked":or,onClick:cr,className:clsx("relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2",{"bg-gold":or,"bg-gray-200":!or},ar),...ur,children:[lr&&jsxRuntimeExports.jsx("span",{className:"sr-only",children:lr}),jsxRuntimeExports.jsx("span",{"aria-hidden":"true",className:clsx("pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",{"translate-x-5":or,"translate-x-0":!or})})]}));Switch.displayName="Switch";function Accordion({title:ar,count:or,badge:lr,defaultOpen:cr=!1,children:ur,className:dr}){const[hr,pr]=reactExports.useState(cr);return jsxRuntimeExports.jsxs("div",{className:clsx("bg-card rounded-card shadow-card overflow-hidden",dr),children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>pr(!hr),className:"w-full flex items-center justify-between px-[18px] py-4 text-left touch-manipulation","aria-expanded":hr,children:[jsxRuntimeExports.jsx("span",{className:"section-header",children:ar}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2.5",children:[lr&&jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:lr}),or!==void 0&&or>0&&jsxRuntimeExports.jsx(CountBadge,{count:or}),jsxRuntimeExports.jsx(ChevronIcon,{isOpen:hr})]})]}),jsxRuntimeExports.jsx("div",{className:clsx("overflow-hidden transition-all duration-300 ease-in-out",{"max-h-0 opacity-0":!hr,"max-h-[2000px] opacity-100":hr}),children:jsxRuntimeExports.jsx("div",{className:"px-[18px] pb-[18px]",children:ur})})]})}function ChevronIcon({isOpen:ar}){return jsxRuntimeExports.jsx("svg",{className:clsx("w-5 h-5 text-text-muted transition-transform duration-200",{"rotate-180":ar}),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}function Modal({isOpen:ar,onClose:or,title:lr,children:cr,className:ur,showCloseButton:dr=!0}){const hr=reactExports.useRef(null);reactExports.useEffect(()=>{const xr=mr=>{mr.key==="Escape"&&ar&&or()};return document.addEventListener("keydown",xr),()=>document.removeEventListener("keydown",xr)},[ar,or]),reactExports.useEffect(()=>(ar?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[ar]);const pr=xr=>{xr.target===hr.current&&or()};return ar?jsxRuntimeExports.jsx("div",{ref:hr,onClick:pr,className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm animate-fadeIn",children:jsxRuntimeExports.jsxs("div",{className:clsx("w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp","max-h-[90vh] overflow-hidden flex flex-col",ur),children:[(lr||dr)&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[lr&&jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:lr}),dr&&jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -m-2 text-text-muted hover:text-text-primary transition-colors tap-target","aria-label":"Close modal",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:cr})]})}):null}function BottomSheet({isOpen:ar,onClose:or,title:lr,children:cr,className:ur,showCloseButton:dr=!0,height:hr="auto"}){return jsxRuntimeExports.jsx(Modal,{isOpen:ar,onClose:or,title:lr,showCloseButton:dr,className:clsx({"max-h-[50vh]":hr==="half","h-[90vh]":hr==="full"},ur),children:cr})}function FormField({label:ar,value:or,onChange:lr,readOnly:cr=!1,placeholder:ur,multiline:dr=!1,rows:hr=2}){if(cr)return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:ar}),jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:or||jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})})]});const pr="w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] placeholder:text-[#999] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors";return dr?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:ar}),jsxRuntimeExports.jsx("textarea",{value:or,onChange:xr=>lr(xr.target.value),placeholder:ur,rows:hr,className:`${pr} resize-none`})]}):jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:ar}),jsxRuntimeExports.jsx("input",{type:"text",value:or,onChange:xr=>lr(xr.target.value),placeholder:ur,className:pr})]})}function getCaptureStatus(ar){return!ar||!(ar.photos.front||ar.photos.left||ar.photos.right||ar.photos.back||ar.additionalPhotos.length>0)?"not-started":ar.photos.front?"complete":"in-progress"}function parseSceneRange(ar){const or=[],lr=ar.split(",").map(cr=>cr.trim());for(const cr of lr)if(cr.includes("-")){const[ur,dr]=cr.split("-").map(hr=>parseInt(hr.trim(),10));if(!isNaN(ur)&&!isNaN(dr))for(let hr=ur;hr<=dr;hr++)or.push(hr)}else{const ur=parseInt(cr,10);isNaN(ur)||or.push(ur)}return[...new Set(or)].sort((cr,ur)=>cr-ur)}function formatSceneRange(ar){if(ar.length===0)return"";if(ar.length===1)return ar[0];const or=[...ar].sort((pr,xr)=>pr.localeCompare(xr,void 0,{numeric:!0})),lr=[];let cr=or[0],ur=or[0],dr=parseInt(cr,10),hr=dr;for(let pr=1;pr<or.length;pr++){const xr=or[pr],mr=parseInt(xr,10);!isNaN(hr)&&!isNaN(mr)&&xr===String(mr)&&ur===String(hr)&&mr===hr+1?(ur=xr,hr=mr):(lr.push(cr===ur?cr:`${cr}-${ur}`),cr=xr,ur=xr,dr=mr,hr=mr)}return lr.push(cr===ur?cr:`${cr}-${ur}`),lr.join(", ")}function formatEstimatedTime(ar){if(ar<60)return`~${ar} min`;const or=Math.floor(ar/60),lr=ar%60;return lr===0?`~${or}h`:`~${or}h ${lr}m`}function formatShortDate(ar){const or=typeof ar=="string"?new Date(ar):ar,lr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],cr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${lr[or.getDay()]} ${or.getDate()} ${cr[or.getMonth()]}`}const MAX_IMAGE_DIMENSION=1920,IMAGE_QUALITY=.8,THUMBNAIL_SIZE=200,THUMBNAIL_QUALITY=.6,SUPPORTED_IMAGE_TYPES=new Set(["image/jpeg","image/png","image/gif","image/webp"]);function isSupportedImageType(ar){return SUPPORTED_IMAGE_TYPES.has(ar.toLowerCase())}async function ensureSupportedImageFormat(ar){const or=ar.match(/^data:([^;]+);base64,/);if(!or)return ar;const lr=or[1].toLowerCase();if(isSupportedImageType(lr))return ar;const cr=base64ToBlob(ar),ur=await compressImage(cr,MAX_IMAGE_DIMENSION,IMAGE_QUALITY);return blobToBase64(ur)}async function compressImage(ar,or=MAX_IMAGE_DIMENSION,lr=IMAGE_QUALITY){return new Promise((cr,ur)=>{const dr=new Image,hr=URL.createObjectURL(ar);dr.onload=()=>{URL.revokeObjectURL(hr);let{width:pr,height:xr}=dr;(pr>or||xr>or)&&(pr>xr?(xr=Math.round(xr*or/pr),pr=or):(pr=Math.round(pr*or/xr),xr=or));const mr=document.createElement("canvas");mr.width=pr,mr.height=xr;const fr=mr.getContext("2d");if(!fr){ur(new Error("Failed to get canvas context"));return}fr.drawImage(dr,0,0,pr,xr),mr.toBlob(Er=>{Er?cr(Er):ur(new Error("Failed to compress image"))},"image/jpeg",lr)},dr.onerror=()=>{URL.revokeObjectURL(hr),ur(new Error("Failed to load image"))},dr.src=hr})}async function generateThumbnail(ar){const or=await compressImage(ar,THUMBNAIL_SIZE,THUMBNAIL_QUALITY);return blobToBase64(or)}function blobToBase64(ar){return new Promise((or,lr)=>{const cr=new FileReader;cr.onloadend=()=>{const ur=cr.result;or(ur)},cr.onerror=lr,cr.readAsDataURL(ar)})}function base64ToBlob(ar){const[or,lr]=ar.split(","),cr=or.match(/:(.*?);/),ur=cr?cr[1]:"image/jpeg",dr=atob(lr),hr=new ArrayBuffer(dr.length),pr=new Uint8Array(hr);for(let xr=0;xr<dr.length;xr++)pr[xr]=dr.charCodeAt(xr);return new Blob([pr],{type:ur})}async function createPhotoFromBlob(ar,or){const lr=await compressImage(ar),cr=await blobToBase64(lr),ur=await generateThumbnail(ar);return{id:v4(),uri:cr,thumbnail:ur,capturedAt:new Date,angle:or}}function CharacterAvatar({character:ar,size:or="md",className:lr}){const cr=ar.avatarColour??"#C9A962";return jsxRuntimeExports.jsx("div",{className:clsx("rounded-full flex items-center justify-center font-bold text-white flex-shrink-0",{"w-5 h-5 text-[8px]":or==="xs","w-8 h-8 text-xs":or==="sm","w-10 h-10 text-sm":or==="md","w-14 h-14 text-lg":or==="lg","w-20 h-20 text-2xl":or==="xl"},lr),style:{background:`linear-gradient(135deg, ${cr} 0%, ${adjustColor$1(cr,-20)} 100%)`},children:ar.initials})}function adjustColor$1(ar,or){const lr=parseInt(ar.replace("#",""),16),cr=Math.max(0,Math.min(255,(lr>>16)+or)),ur=Math.max(0,Math.min(255,(lr>>8&255)+or)),dr=Math.max(0,Math.min(255,(lr&255)+or));return`#${((1<<24)+(cr<<16)+(ur<<8)+dr).toString(16).slice(1)}`}const angleLabels$1={front:"Front",left:"Left",right:"Right",back:"Back",additional:""};function PhotoSlot({photo:ar,angle:or,onCapture:lr,onView:cr,size:ur="md",showLabel:dr=!0,isPrimary:hr=!1}){const pr=!!ar,xr=angleLabels$1[or],mr=()=>{pr&&cr?cr():lr()};return jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsx("button",{type:"button",onClick:mr,className:clsx("relative rounded-[10px] overflow-hidden touch-manipulation transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2",{"w-full aspect-square":ur==="sm","w-full aspect-[4/3]":ur==="md","w-full aspect-[16/9]":ur==="lg","w-full aspect-[3/4]":ur==="portrait","border-2 border-dashed":!pr,"border-gold":!pr&&hr,"border-gray-300":!pr&&!hr,"border-2 border-solid border-gold":pr}),children:pr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("img",{src:ar.thumbnail||ar.uri,alt:`${xr} view`,className:"w-full h-full object-cover"}),dr&&xr&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent px-2 py-1.5",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-medium text-white uppercase tracking-wide",children:xr})})]}):jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-50",children:[jsxRuntimeExports.jsx(CameraIcon$1,{className:clsx("text-gray-400",{"w-5 h-5":ur==="sm"||ur==="portrait","w-6 h-6":ur==="md","w-8 h-8":ur==="lg"})}),dr&&xr&&jsxRuntimeExports.jsx("span",{className:clsx("font-bold uppercase tracking-widest text-gray-400 mt-2",{"text-[9px]":ur==="sm"||ur==="portrait","text-[10px]":ur==="md","text-xs":ur==="lg"}),children:xr})]})})})}function SceneThumbnailSlot({sceneNumber:ar,hasCaptured:or,isActive:lr,onClick:cr,thumbnailUrl:ur}){return jsxRuntimeExports.jsxs("button",{type:"button",onClick:cr,className:clsx("flex flex-col items-center gap-1.5 touch-manipulation","focus:outline-none"),children:[jsxRuntimeExports.jsx("div",{className:clsx("w-[70px] h-[70px] rounded-lg flex items-center justify-center transition-all overflow-hidden",{"border-2 border-solid border-gold":or,"border-2 border-dashed border-gray-300 bg-gray-50":!or,"ring-2 ring-gold ring-offset-2":lr}),children:or&&ur?jsxRuntimeExports.jsx("img",{src:ur,alt:`Scene ${ar}`,className:"w-full h-full object-cover"}):or?jsxRuntimeExports.jsx(CheckIcon$1,{className:"w-6 h-6 text-gold"}):jsxRuntimeExports.jsx(CameraIcon$1,{className:"w-5 h-5 text-gray-400"})}),jsxRuntimeExports.jsx("span",{className:clsx("text-xs font-medium",{"text-gold":lr,"text-text-secondary":!lr}),children:ar})]})}function CameraIcon$1({className:ar}){return jsxRuntimeExports.jsxs("svg",{className:ar,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}function CheckIcon$1({className:ar}){return jsxRuntimeExports.jsx("svg",{className:ar,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}function PhotoGrid({photos:ar,onCapture:or,onView:lr,className:cr}){const ur=[{angle:"front",photo:ar.front},{angle:"left",photo:ar.left},{angle:"right",photo:ar.right},{angle:"back",photo:ar.back}];return jsxRuntimeExports.jsx("div",{className:clsx("grid grid-cols-4 gap-2.5",cr),children:ur.map(({angle:dr,photo:hr})=>jsxRuntimeExports.jsx(PhotoSlot,{photo:hr,angle:dr,onCapture:()=>or(dr),onView:hr&&lr?()=>lr(hr,dr):void 0,size:"portrait",showLabel:!0,isPrimary:dr==="front"},dr))})}function AdditionalPhotosGrid({photos:ar,onCapture:or,onView:lr,maxVisible:cr=8,className:ur}){const dr=ar.slice(0,cr),hr=ar.length-cr,pr=Math.max(0,4-(dr.length%4||4)),xr=dr.length<cr;return jsxRuntimeExports.jsxs("div",{className:clsx("grid grid-cols-4 gap-2",ur),children:[dr.map((mr,fr)=>jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>lr==null?void 0:lr(mr,fr),className:"w-full aspect-square rounded-lg overflow-hidden border-2 border-gold touch-manipulation focus:outline-none focus:ring-2 focus:ring-gold",children:jsxRuntimeExports.jsx("img",{src:mr.thumbnail||mr.uri,alt:`Additional photo ${fr+1}`,className:"w-full h-full object-cover"})}),fr===cr-1&&hr>0&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/60 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsxs("span",{className:"text-white font-semibold text-lg",children:["+",hr]})})]},mr.id)),xr&&Array.from({length:Math.min(pr+1,cr-dr.length)}).map((mr,fr)=>jsxRuntimeExports.jsx("button",{type:"button",onClick:or,className:clsx("w-full aspect-square rounded-lg flex items-center justify-center touch-manipulation","focus:outline-none focus:ring-2 focus:ring-gold",{"border-2 border-dashed border-gold bg-gold-50/50":fr===0,"border-2 border-dashed border-gray-300 bg-gray-50":fr>0}),children:jsxRuntimeExports.jsx("svg",{className:clsx("w-5 h-5",{"text-gold":fr===0,"text-gray-400":fr>0}),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})},`empty-${fr}`))]})}function useCamera(ar={}){const{facingMode:or="environment",onCapture:lr,onError:cr}=ar,ur=reactExports.useRef(null),dr=reactExports.useRef(null),hr=reactExports.useRef(null),[pr,xr]=reactExports.useState(!1),[mr,fr]=reactExports.useState(!1),[Er,vr]=reactExports.useState(null),[gr,yr]=reactExports.useState(or);reactExports.useEffect(()=>(hr.current=document.createElement("canvas"),()=>{hr.current=null}),[]);const jr=reactExports.useCallback(()=>{dr.current&&(dr.current.getTracks().forEach(Rr=>Rr.stop()),dr.current=null),ur.current&&(ur.current.srcObject=null),xr(!1)},[]);reactExports.useEffect(()=>()=>{dr.current&&(dr.current.getTracks().forEach(Rr=>Rr.stop()),dr.current=null),ur.current&&(ur.current.srcObject=null)},[]);const br=reactExports.useCallback(async()=>{try{if(vr(null),xr(!1),jr(),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported on this device");const Rr={video:{facingMode:{ideal:gr},width:{ideal:1920},height:{ideal:1080}},audio:!1},Ar=await navigator.mediaDevices.getUserMedia(Rr);dr.current=Ar,ur.current&&(ur.current.srcObject=Ar,await ur.current.play(),xr(!0))}catch(Rr){const Ar=Rr instanceof Error?Rr.message:"Failed to access camera";vr(Ar),cr==null||cr(Rr instanceof Error?Rr:new Error(Ar))}},[gr,jr,cr]),_r=reactExports.useCallback(async()=>{const Rr=gr==="user"?"environment":"user";if(yr(Rr),dr.current){jr(),await new Promise(Ar=>setTimeout(Ar,100));try{const Ar={video:{facingMode:{ideal:Rr},width:{ideal:1920},height:{ideal:1080}},audio:!1},Sr=await navigator.mediaDevices.getUserMedia(Ar);dr.current=Sr,ur.current&&(ur.current.srcObject=Sr,await ur.current.play(),xr(!0))}catch(Ar){const Sr=Ar instanceof Error?Ar.message:"Failed to switch camera";vr(Sr),cr==null||cr(Ar instanceof Error?Ar:new Error(Sr))}}},[gr,jr,cr]),wr=reactExports.useCallback(async()=>{if(!ur.current||!hr.current||!pr)return null;try{fr(!0);const Rr=ur.current,Ar=hr.current;Ar.width=Rr.videoWidth,Ar.height=Rr.videoHeight;const Sr=Ar.getContext("2d");if(!Sr)throw new Error("Failed to get canvas context");gr==="user"&&(Sr.translate(Ar.width,0),Sr.scale(-1,1)),Sr.drawImage(Rr,0,0);const kr=await new Promise((Nr,Cr)=>{Ar.toBlob(Tr=>{Tr?Nr(Tr):Cr(new Error("Failed to capture photo"))},"image/jpeg",.9)});return lr==null||lr(kr),kr}catch(Rr){const Ar=Rr instanceof Error?Rr.message:"Failed to capture photo";return vr(Ar),cr==null||cr(Rr instanceof Error?Rr:new Error(Ar)),null}finally{fr(!1)}},[pr,gr,lr,cr]);return{videoRef:ur,isReady:pr,isCapturing:mr,error:Er,facingMode:gr,startCamera:br,stopCamera:jr,capturePhoto:wr,switchCamera:_r}}const angleLabels={front:"Front View",left:"Left View",right:"Right View",back:"Back View",additional:"Additional"};function PhotoCapture({isOpen:ar,onClose:or,onCapture:lr,angle:cr="additional",characterName:ur,sceneNumber:dr,lookName:hr}){const[pr,xr]=reactExports.useState(null),[mr,fr]=reactExports.useState(null),[Er,vr]=reactExports.useState("choose"),gr=reactExports.useRef(null),{videoRef:yr,isReady:jr,isCapturing:br,error:_r,facingMode:wr,startCamera:Rr,stopCamera:Ar,capturePhoto:Sr,switchCamera:kr}=useCamera({facingMode:"environment",onError:Wr=>console.error("Camera error:",Wr)});reactExports.useEffect(()=>{ar?(vr("choose"),xr(null),fr(null)):(Ar(),xr(null),fr(null))},[ar,Ar]),reactExports.useEffect(()=>{Er==="camera"?Rr():Ar()},[Er,Rr,Ar]),reactExports.useEffect(()=>()=>{mr&&URL.revokeObjectURL(mr)},[mr]);const Nr=async()=>{const Wr=await Sr();if(Wr){const Yr=URL.createObjectURL(Wr);xr(Wr),fr(Yr),vr("preview")}},Cr=()=>{mr&&URL.revokeObjectURL(mr),xr(null),fr(null),vr("choose")},Tr=()=>{pr&&(lr(pr),or())},Pr=Wr=>{var es;const Yr=(es=Wr.target.files)==null?void 0:es[0];if(Yr){const ps=Yr,ts=URL.createObjectURL(ps);xr(ps),fr(ts),vr("preview")}gr.current&&(gr.current.value="")},Ir=()=>{var Wr;(Wr=gr.current)==null||Wr.click()},Br=()=>{vr("camera")};return ar?Er==="choose"?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-background flex flex-col",children:[jsxRuntimeExports.jsx("input",{ref:gr,type:"file",accept:"image/*",capture:void 0,onChange:Pr,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3 safe-top",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"text-white tap-target touch-manipulation","aria-label":"Close",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[ur&&jsxRuntimeExports.jsx("div",{className:"text-white font-semibold text-sm",children:ur}),jsxRuntimeExports.jsxs("div",{className:"text-white/80 text-xs",children:[dr&&`Scene ${dr}`,hr&&`  ${hr}`]})]}),jsxRuntimeExports.jsx("div",{className:"w-6"})]})}),jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border px-4 py-3 text-center",children:jsxRuntimeExports.jsx("span",{className:"text-text-primary text-sm font-medium",children:angleLabels[cr]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 rounded-full bg-gold/10 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsxs("svg",{className:"w-12 h-12 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Add Photo"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary text-center text-sm mb-8",children:"Take a new photo or choose one from your library"}),jsxRuntimeExports.jsxs(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:Br,className:"max-w-xs",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"13",r:"4"})]}),"Take Photo"]}),jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"lg",fullWidth:!0,onClick:Ir,className:"max-w-xs",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]}),"Choose from Library"]})]})]}):Er==="preview"&&mr?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3 safe-top",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:Cr,className:"text-white tap-target touch-manipulation","aria-label":"Back",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[ur&&jsxRuntimeExports.jsx("div",{className:"text-white font-semibold text-sm",children:ur}),jsxRuntimeExports.jsx("div",{className:"text-white/80 text-xs",children:angleLabels[cr]})]}),jsxRuntimeExports.jsx("div",{className:"w-6"})]})}),jsxRuntimeExports.jsx("div",{className:"flex-1 relative overflow-hidden bg-black",children:jsxRuntimeExports.jsx("img",{src:mr,alt:"Captured preview",className:"w-full h-full object-contain"})}),jsxRuntimeExports.jsx("div",{className:"bg-black px-4 py-6 safe-bottom",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-6",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"lg",onClick:Cr,className:"flex-1 max-w-[140px]",children:"Change"}),jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",onClick:Tr,className:"flex-1 max-w-[140px]",children:"Use Photo"})]})})]}):jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[jsxRuntimeExports.jsx("input",{ref:gr,type:"file",accept:"image/*",onChange:Pr,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3 safe-top",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:()=>vr("choose"),className:"text-white tap-target touch-manipulation","aria-label":"Back",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[ur&&jsxRuntimeExports.jsx("div",{className:"text-white font-semibold text-sm",children:ur}),jsxRuntimeExports.jsxs("div",{className:"text-white/80 text-xs",children:[dr&&`Scene ${dr}`,hr&&`  ${hr}`]})]}),jsxRuntimeExports.jsx("div",{className:"w-6"})]})}),jsxRuntimeExports.jsx("div",{className:"bg-black/50 px-4 py-2 text-center",children:jsxRuntimeExports.jsx("span",{className:"text-white/90 text-sm font-medium",children:angleLabels[cr]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[jsxRuntimeExports.jsx("video",{ref:yr,autoPlay:!0,playsInline:!0,muted:!0,className:clsx("w-full h-full object-cover",{"scale-x-[-1]":wr==="user"})}),!jr&&!_r&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:jsxRuntimeExports.jsxs("div",{className:"text-white text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),jsxRuntimeExports.jsx("div",{className:"text-sm",children:"Starting camera..."})]})}),_r&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:jsxRuntimeExports.jsxs("div",{className:"text-white text-center px-8",children:[jsxRuntimeExports.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),jsxRuntimeExports.jsx("div",{className:"text-sm mb-4",children:_r.includes("permission")||_r.includes("Permission")?"Camera access denied. Please allow camera access in your browser settings.":_r}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"primary",size:"sm",onClick:Rr,children:"Try Again"}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:Ir,children:"Choose from Library Instead"})]})]})})]}),jsxRuntimeExports.jsx("div",{className:"bg-black px-4 py-6 safe-bottom",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-8",children:[jsxRuntimeExports.jsx("button",{onClick:Ir,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center tap-target touch-manipulation","aria-label":"Choose from library",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),jsxRuntimeExports.jsx("button",{onClick:Nr,disabled:!jr||br,className:clsx("w-20 h-20 rounded-full border-4 border-white flex items-center justify-center tap-target touch-manipulation","transition-transform active:scale-95",{"opacity-50":!jr||br}),"aria-label":"Take photo",children:jsxRuntimeExports.jsx("div",{className:clsx("w-16 h-16 rounded-full bg-white",{"animate-pulse":br})})}),jsxRuntimeExports.jsx("button",{onClick:kr,disabled:!jr,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center tap-target touch-manipulation disabled:opacity-50","aria-label":"Switch camera",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})})]}):null}function MasterReference({photo:ar,onCapture:or,onView:lr,onRemove:cr,className:ur}){const dr=!!ar,hr=()=>{dr&&lr?lr():or()};return jsxRuntimeExports.jsxs("div",{className:clsx("relative",ur),children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:hr,className:clsx("w-full aspect-[16/9] rounded-lg overflow-hidden touch-manipulation transition-all","focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2",{"border-2 border-dashed border-gray-300 bg-gray-50":!dr,"border-2 border-solid border-gold":dr}),children:dr?jsxRuntimeExports.jsx("img",{src:ar.uri,alt:"Master reference",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx(CameraIcon,{className:"w-8 h-8 text-gray-400 mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500",children:"Tap to set master reference"})]})}),dr&&cr&&jsxRuntimeExports.jsx("button",{type:"button",onClick:pr=>{pr.stopPropagation(),cr()},className:"absolute top-2 right-2 w-8 h-8 bg-black/50 text-white rounded-full flex items-center justify-center tap-target touch-manipulation hover:bg-black/70","aria-label":"Remove master reference",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),dr&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent px-3 py-2",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-white uppercase tracking-wide",children:"Master Reference"})})]})}function CameraIcon({className:ar}){return jsxRuntimeExports.jsxs("svg",{className:ar,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}function PhotoViewer({isOpen:ar,photos:or,initialIndex:lr=0,onClose:cr,onDelete:ur}){const[dr,hr]=reactExports.useState(lr),[pr,xr]=reactExports.useState(!0),[mr,fr]=reactExports.useState(!1),Er=reactExports.useRef(null),vr=reactExports.useRef(null),gr=reactExports.useRef(null);reactExports.useEffect(()=>{ar&&(hr(Math.min(lr,or.length-1)),xr(!0))},[ar,lr,or.length]),reactExports.useEffect(()=>{if(!ar)return;const kr=Nr=>{Nr.key==="ArrowLeft"?yr():Nr.key==="ArrowRight"?jr():Nr.key==="Escape"&&cr()};return window.addEventListener("keydown",kr),()=>window.removeEventListener("keydown",kr)},[ar,dr,or.length]);const yr=reactExports.useCallback(()=>{dr>0&&hr(dr-1)},[dr]),jr=reactExports.useCallback(()=>{dr<or.length-1&&hr(dr+1)},[dr,or.length]),br=kr=>{Er.current=kr.touches[0].clientX},_r=kr=>{vr.current=kr.touches[0].clientX},wr=()=>{if(Er.current===null||vr.current===null)return;const kr=Er.current-vr.current;Math.abs(kr)>50&&(kr>0?jr():yr()),Er.current=null,vr.current=null},Rr=async()=>{if(!ur||mr)return;const kr=or[dr];fr(!0);try{ur(kr.id),dr>=or.length-1&&dr>0&&hr(dr-1),or.length<=1&&cr()}finally{fr(!1)}},Ar=()=>{xr(!pr)};if(!ar||or.length===0)return null;const Sr=or[dr];return Sr?jsxRuntimeExports.jsxs("div",{ref:gr,className:"fixed inset-0 z-50 bg-black",onTouchStart:br,onTouchMove:_r,onTouchEnd:wr,children:[jsxRuntimeExports.jsx("div",{className:clsx("absolute top-0 left-0 right-0 z-10 transition-opacity duration-200","bg-gradient-to-b from-black/60 to-transparent","safe-top",{"opacity-100":pr,"opacity-0 pointer-events-none":!pr}),children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 pt-[calc(env(safe-area-inset-top)+12px)]",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:cr,className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation","aria-label":"Close",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsxs("span",{className:"text-white text-sm font-medium px-3 py-1 rounded-full bg-black/30 backdrop-blur-sm",children:[dr+1," / ",or.length]}),ur&&jsxRuntimeExports.jsx("button",{type:"button",onClick:Rr,disabled:mr,className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation disabled:opacity-50","aria-label":"Delete photo",children:mr?jsxRuntimeExports.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",onClick:Ar,children:jsxRuntimeExports.jsx("img",{src:Sr.uri,alt:`Photo ${dr+1}`,className:"max-w-full max-h-full object-contain",draggable:!1})}),or.length>1&&pr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[dr>0&&jsxRuntimeExports.jsx("button",{type:"button",onClick:kr=>{kr.stopPropagation(),yr()},className:"absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation hidden sm:flex","aria-label":"Previous photo",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),dr<or.length-1&&jsxRuntimeExports.jsx("button",{type:"button",onClick:kr=>{kr.stopPropagation(),jr()},className:"absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation hidden sm:flex","aria-label":"Next photo",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),or.length>1&&pr&&jsxRuntimeExports.jsx("div",{className:clsx("absolute bottom-0 left-0 right-0 z-10","bg-gradient-to-t from-black/60 to-transparent","safe-bottom"),children:jsxRuntimeExports.jsx("div",{className:"flex justify-center gap-1.5 pb-[calc(env(safe-area-inset-bottom)+16px)] pt-6",children:or.map((kr,Nr)=>jsxRuntimeExports.jsx("button",{type:"button",onClick:Cr=>{Cr.stopPropagation(),hr(Nr)},className:clsx("w-2 h-2 rounded-full transition-all touch-manipulation",{"bg-white w-6":Nr===dr,"bg-white/50":Nr!==dr}),"aria-label":`Go to photo ${Nr+1}`},Nr))})}),or.length>1&&pr&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-24 left-0 right-0 flex justify-center pointer-events-none sm:hidden",children:jsxRuntimeExports.jsx("span",{className:"text-white/60 text-xs",children:"Swipe to navigate"})})]}):null}const flagLabels=[{key:"sweat",label:"Sweat"},{key:"dishevelled",label:"Dishevelled"},{key:"blood",label:"Blood"},{key:"dirt",label:"Dirt"},{key:"wetHair",label:"Wet Hair"},{key:"tears",label:"Tears"}];function QuickFlags({flags:ar,onToggle:or}){return jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:flagLabels.map(({key:lr,label:cr})=>jsxRuntimeExports.jsx(TogglePill,{isActive:ar[lr],label:cr,onClick:()=>or(lr)},lr))})}function EventCard({event:ar,onRemove:or}){const[lr,cr]=reactExports.useState(!1),ur=ar.progression&&ar.progression.length>0,dr=ar.scenes&&ar.scenes.length>0?ar.scenes:null;return jsxRuntimeExports.jsxs("div",{className:"bg-card border border-border rounded-[10px] p-3.5 relative",children:[or&&jsxRuntimeExports.jsx("button",{onClick:or,className:"absolute top-3 right-3 p-1 text-text-light hover:text-text-muted transition-colors touch-manipulation","aria-label":"Remove event",children:jsxRuntimeExports.jsx("svg",{className:"w-[18px] h-[18px]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsx("span",{className:"inline-block text-[9px] font-bold tracking-widest uppercase text-gold bg-gold-100/50 px-2 py-0.5 rounded mb-2",children:ar.type}),jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary text-[15px] mb-1 pr-6",children:ar.name}),ar.description&&jsxRuntimeExports.jsx("p",{className:"text-[13px] text-text-secondary leading-snug mb-2.5",children:ar.description}),dr&&jsxRuntimeExports.jsxs("div",{className:"mb-2.5",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide block mb-1.5",children:"SCENES"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:dr.map(hr=>{const pr=ur&&ar.progression.some(xr=>xr.scene===hr);return jsxRuntimeExports.jsx("span",{className:`inline-block min-w-[32px] text-center px-2 py-0.5 text-[11px] font-medium rounded ${pr?"bg-gold text-white":"bg-gray-100 text-text-secondary"}`,children:hr},hr)})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Stage:"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary font-medium ml-1.5",children:ar.stage||""})]}),!dr&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Scenes:"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary font-medium ml-1.5",children:ar.sceneRange||""})]})]}),ar.products&&jsxRuntimeExports.jsxs("div",{className:"text-xs mt-2",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Products:"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary ml-1.5",children:ar.products})]}),ar.referencePhotos.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-3",children:[jsxRuntimeExports.jsx("div",{className:"field-label mb-2",children:"REFERENCE PHOTOS"}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar",children:ar.referencePhotos.map(hr=>jsxRuntimeExports.jsx("img",{src:hr.thumbnail||hr.uri,alt:"Reference",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"},hr.id))})]}),ur&&jsxRuntimeExports.jsxs("div",{className:"mt-3 border-t border-border pt-3",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>cr(!lr),className:"flex items-center gap-1.5 text-[11px] font-semibold text-gold mb-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),"Progression (",ar.progression.length," stage",ar.progression.length!==1?"s":"",")",jsxRuntimeExports.jsx("svg",{className:`w-3.5 h-3.5 transition-transform ${lr?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),lr&&jsxRuntimeExports.jsxs("div",{className:"relative pl-4",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-[7px] top-1 bottom-1 w-[2px] bg-gold-200 rounded"}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:ar.progression.map((hr,pr)=>jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute -left-4 top-0.5 w-4 h-4 rounded-full bg-gold flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px] text-white font-bold",children:pr+1})}),jsxRuntimeExports.jsxs("div",{className:"ml-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[jsxRuntimeExports.jsx("span",{className:"text-[11px] font-semibold text-text-primary",children:hr.stage||`Stage ${pr+1}`}),hr.scene&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-muted bg-gray-100 px-1.5 py-0.5 rounded",children:["Sc ",hr.scene]})]}),hr.notes&&jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-secondary leading-snug",children:hr.notes}),hr.referencePhotos&&hr.referencePhotos.length>0&&jsxRuntimeExports.jsx("div",{className:"flex gap-1.5 mt-1.5",children:hr.referencePhotos.map(xr=>jsxRuntimeExports.jsx("img",{src:xr.thumbnail||xr.uri,alt:"Stage reference",className:"w-10 h-10 rounded object-cover"},xr.id))})]})]},hr.id))})]})]})]})}function ContinuityEvents({events:ar,onAddEvent:or,onRemoveEvent:lr}){return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3.5",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"CONTINUITY EVENTS"}),jsxRuntimeExports.jsxs("button",{onClick:or,className:"flex items-center gap-1 px-3 py-1.5 rounded-md bg-gold-100/50 text-gold text-[11px] font-semibold hover:bg-gold-100 transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Event"]})]}),ar.length===0?jsxRuntimeExports.jsx(EmptyState$3,{onAdd:or}):jsxRuntimeExports.jsx("div",{className:"space-y-2.5",children:ar.map(cr=>jsxRuntimeExports.jsx(EventCard,{event:cr,onRemove:()=>lr(cr.id)},cr.id))})]})}function EmptyState$3({onAdd:ar}){return jsxRuntimeExports.jsxs("button",{onClick:ar,className:"w-full flex flex-col items-center justify-center py-6 text-center touch-manipulation",children:[jsxRuntimeExports.jsxs("svg",{className:"w-8 h-8 text-gray-300 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),jsxRuntimeExports.jsx("polyline",{points:"14 2 14 8 20 8",strokeLinecap:"round",strokeLinejoin:"round"}),jsxRuntimeExports.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"12",strokeLinecap:"round"}),jsxRuntimeExports.jsx("line",{x1:"9",y1:"15",x2:"15",y2:"15",strokeLinecap:"round"})]}),jsxRuntimeExports.jsx("span",{className:"text-[13px] text-text-light",children:"No continuity events"}),jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-placeholder mt-1",children:"Add wounds, bruises, prosthetics etc."})]})}function AddEventModal({isOpen:ar,onClose:or,onAdd:lr,availableScenes:cr=[]}){const[ur,dr]=reactExports.useState("Wound"),[hr,pr]=reactExports.useState(""),[xr,mr]=reactExports.useState(""),[fr,Er]=reactExports.useState(""),[vr,gr]=reactExports.useState([]),[yr,jr]=reactExports.useState(""),[br,_r]=reactExports.useState(!1),[wr,Rr]=reactExports.useState([]),[Ar,Sr]=reactExports.useState(!1),[kr,Nr]=reactExports.useState(!1),Cr=reactExports.useRef(null),[Tr,Pr]=reactExports.useState([]),[Ir,Br]=reactExports.useState(!1),Wr=()=>{dr("Wound"),pr(""),mr(""),Er(""),gr([]),jr(""),Rr([]),Nr(!1),Pr([]),Br(!1)},Yr=()=>{hr.trim()&&(lr({type:ur,name:hr.trim(),description:xr.trim(),stage:fr.trim(),sceneRange:vr.length>0?vr.join(", "):"",scenes:vr,products:yr.trim(),referencePhotos:wr,progression:Tr}),Wr())},es=()=>{Wr(),or()},ps=$r=>{gr(Vr=>Vr.includes($r)?Vr.filter(Gr=>Gr!==$r):[...Vr,$r])},ts=()=>{vr.length===cr.length?gr([]):gr([...cr])},Qr=()=>{const $r=vr.find(Vr=>!Tr.some(Gr=>Gr.scene===Vr))||"";Pr(Vr=>[...Vr,{id:`stage-${Date.now()}`,scene:$r,stage:"",notes:"",referencePhotos:[]}])},Hr=($r,Vr)=>{Pr(Gr=>Gr.map(Jr=>Jr.id===$r?{...Jr,...Vr}:Jr))},Kr=$r=>{Pr(Vr=>Vr.filter(Gr=>Gr.id!==$r))},rs=async $r=>{var Gr;const Vr=(Gr=$r.target.files)==null?void 0:Gr[0];if(Vr){Sr(!0);try{const Jr=await createPhotoFromBlob(Vr,"additional");Rr(ms=>[...ms,Jr])}catch(Jr){console.error("Failed to process photo:",Jr)}finally{Sr(!1)}}Cr.current&&(Cr.current.value="")},Mr=$r=>{Rr(Vr=>Vr.filter(Gr=>Gr.id!==$r))},Dr=async $r=>{Sr(!0);try{const Vr=await createPhotoFromBlob($r,"additional");Rr(Gr=>[...Gr,Vr])}catch(Vr){console.error("Failed to process captured photo:",Vr)}finally{Sr(!1),Nr(!1)}},Lr=()=>{Nr(!0)},Fr=ur==="Wound"||ur==="Bruise"||ur==="Other";return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(PhotoCapture,{isOpen:kr,onClose:()=>Nr(!1),onCapture:Dr,angle:"additional"}),jsxRuntimeExports.jsxs(BottomSheet,{isOpen:ar&&!kr,onClose:es,title:"Add Continuity Event",height:"auto",children:[jsxRuntimeExports.jsx("input",{ref:Cr,type:"file",accept:"image/*",onChange:rs,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"TYPE"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:CONTINUITY_EVENT_TYPES.map($r=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>dr($r),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full border transition-colors touch-manipulation",{"bg-gold text-white border-gold":ur===$r,"bg-gray-100 text-text-secondary border-gray-200 hover:bg-gray-200":ur!==$r}),children:$r},$r))})]}),jsxRuntimeExports.jsx(Input,{label:"NAME",value:hr,onChange:$r=>pr($r.target.value),placeholder:"e.g., Forehead Cut"}),jsxRuntimeExports.jsx(Textarea,{label:"DESCRIPTION",value:xr,onChange:$r=>mr($r.target.value),placeholder:"Describe the makeup effect...",rows:2}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"SCENES"}),cr.length>0&&jsxRuntimeExports.jsx("button",{type:"button",onClick:ts,className:"text-[11px] text-gold font-medium",children:vr.length===cr.length?"Deselect All":"Select All"})]}),cr.length>0?jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1.5",children:cr.map($r=>{const Vr=vr.includes($r);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ps($r),className:clsx("min-w-[44px] px-2.5 py-1.5 text-xs font-medium rounded-lg border transition-colors touch-manipulation",{"bg-gold text-white border-gold":Vr,"bg-gray-50 text-text-secondary border-gray-200":!Vr}),children:$r},$r)})}):jsxRuntimeExports.jsx(Input,{value:vr.join(", "),onChange:$r=>gr($r.target.value.split(",").map(Vr=>Vr.trim()).filter(Boolean)),placeholder:"e.g., 12, 13, 14, 15"}),vr.length>0&&jsxRuntimeExports.jsxs("p",{className:"text-[11px] text-text-muted mt-1.5",children:[vr.length," scene",vr.length!==1?"s":""," selected"]})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{label:"CURRENT STAGE",value:fr,onChange:$r=>Er($r.target.value),onFocus:()=>_r(!0),onBlur:()=>setTimeout(()=>_r(!1),200),placeholder:"e.g., Fresh, Day 2 Healing"}),br&&jsxRuntimeExports.jsx("div",{className:"absolute z-10 top-full left-0 right-0 mt-1 bg-card rounded-lg shadow-lg border border-border overflow-hidden max-h-40 overflow-y-auto",children:STAGE_SUGGESTIONS.map($r=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{Er($r),_r(!1)},className:"w-full px-3 py-2 text-left text-sm text-text-secondary hover:bg-gray-50 touch-manipulation",children:$r},$r))})]}),Fr&&vr.length>1&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"PROGRESSION TIMELINE"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Br(!Ir),className:"text-[11px] text-gold font-medium",children:Ir?"Hide":"Plan changes over scenes"})]}),Ir&&jsxRuntimeExports.jsxs("div",{className:"space-y-2.5",children:[Tr.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-2",children:Tr.map(($r,Vr)=>jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-gold text-white text-[10px] font-bold flex items-center justify-center flex-shrink-0",children:Vr+1}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] font-semibold text-text-muted uppercase tracking-wide",children:["Stage ",Vr+1]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Kr($r.id),className:"ml-auto p-0.5 text-text-light hover:text-red-500 transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide block mb-1",children:"From Scene"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:vr.map(Gr=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Hr($r.id,{scene:Gr}),className:clsx("min-w-[36px] px-2 py-1 text-[11px] font-medium rounded border transition-colors touch-manipulation",{"bg-gold text-white border-gold":$r.scene===Gr,"bg-white text-text-secondary border-gray-200":$r.scene!==Gr}),children:Gr},Gr))})]}),jsxRuntimeExports.jsx("div",{className:"mb-2 relative",children:jsxRuntimeExports.jsx(ProgressionStagePicker,{value:$r.stage,onChange:Gr=>Hr($r.id,{stage:Gr})})}),jsxRuntimeExports.jsx(Textarea,{value:$r.notes,onChange:Gr=>Hr($r.id,{notes:Gr.target.value}),placeholder:"Application notes for this stage...",rows:1})]},$r.id))}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:Qr,className:"w-full py-2.5 flex items-center justify-center gap-1.5 text-[12px] font-medium text-gold bg-gold-100/30 border border-dashed border-gold-300 rounded-lg hover:bg-gold-100/50 transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Stage"]}),Tr.length===0&&jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light text-center",children:"Plan how this event changes across scenes  e.g. fresh wound in Sc 5, scabbing by Sc 12, healed by Sc 20"})]})]}),jsxRuntimeExports.jsx(Textarea,{label:"PRODUCTS",value:yr,onChange:$r=>jr($r.target.value),placeholder:"List products used...",rows:2}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"REFERENCE PHOTOS"}),wr.length>0&&jsxRuntimeExports.jsx("div",{className:"grid grid-cols-4 gap-2 mb-3",children:wr.map($r=>jsxRuntimeExports.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100",children:[jsxRuntimeExports.jsx("img",{src:$r.thumbnail||$r.uri,alt:"Reference",className:"w-full h-full object-cover"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Mr($r.id),className:"absolute top-1 right-1 w-5 h-5 bg-black/60 rounded-full flex items-center justify-center","aria-label":"Remove photo",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},$r.id))}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",fullWidth:!0,onClick:Lr,disabled:Ar,children:Ar?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 mr-1.5 border-2 border-gold border-t-transparent rounded-full animate-spin"}),"Processing..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),wr.length>0?"Add Another Photo":"Add Reference Photo"]})})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"lg",fullWidth:!0,onClick:es,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:Yr,disabled:!hr.trim(),children:"Add Event"})]})]})]})]})}function ProgressionStagePicker({value:ar,onChange:or}){const[lr,cr]=reactExports.useState(!1);return jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{label:"STAGE",value:ar,onChange:ur=>or(ur.target.value),onFocus:()=>cr(!0),onBlur:()=>setTimeout(()=>cr(!1),200),placeholder:"e.g., Fresh, Scabbed"}),lr&&jsxRuntimeExports.jsx("div",{className:"absolute z-10 top-full left-0 right-0 mt-1 bg-card rounded-lg shadow-lg border border-border overflow-hidden max-h-32 overflow-y-auto",children:STAGE_SUGGESTIONS.map(ur=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{or(ur),cr(!1)},className:"w-full px-3 py-1.5 text-left text-[12px] text-text-secondary hover:bg-gray-50 touch-manipulation",children:ur},ur))})]})}function MakeupForm({makeup:ar,onChange:or,readOnly:lr=!1}){const cr=ar||createEmptyMakeupDetails(),ur=(dr,hr)=>{or&&!lr&&or({...cr,[dr]:hr})};return!ar&&lr?jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No makeup details available for this look."})}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"BASE"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Foundation",value:cr.foundation,onChange:dr=>ur("foundation",dr),readOnly:lr,placeholder:"e.g., MAC Studio Fix NC25"}),jsxRuntimeExports.jsx(FormField,{label:"Coverage",value:cr.coverage,onChange:dr=>ur("coverage",dr),readOnly:lr,placeholder:"e.g., Medium"})]}),jsxRuntimeExports.jsx(FormField,{label:"Concealer",value:cr.concealer,onChange:dr=>ur("concealer",dr),readOnly:lr,placeholder:"e.g., NARS Radiant Creamy"}),jsxRuntimeExports.jsx(FormField,{label:"Concealer Placement",value:cr.concealerPlacement,onChange:dr=>ur("concealerPlacement",dr),readOnly:lr,placeholder:"e.g., Under eyes, bridge of nose"}),jsxRuntimeExports.jsx(FormField,{label:"Contour",value:cr.contour,onChange:dr=>ur("contour",dr),readOnly:lr,placeholder:"e.g., Charlotte Tilbury Sculpt"}),jsxRuntimeExports.jsx(FormField,{label:"Contour Placement",value:cr.contourPlacement,onChange:dr=>ur("contourPlacement",dr),readOnly:lr,placeholder:"e.g., Hollows of cheeks, jawline"}),jsxRuntimeExports.jsx(FormField,{label:"Highlight",value:cr.highlight,onChange:dr=>ur("highlight",dr),readOnly:lr,placeholder:"e.g., Becca Champagne Pop"}),jsxRuntimeExports.jsx(FormField,{label:"Highlight Placement",value:cr.highlightPlacement,onChange:dr=>ur("highlightPlacement",dr),readOnly:lr,placeholder:"e.g., Cheekbones, brow bone"}),jsxRuntimeExports.jsx(FormField,{label:"Blush",value:cr.blush,onChange:dr=>ur("blush",dr),readOnly:lr,placeholder:"e.g., NARS Orgasm"}),jsxRuntimeExports.jsx(FormField,{label:"Blush Placement",value:cr.blushPlacement,onChange:dr=>ur("blushPlacement",dr),readOnly:lr,placeholder:"e.g., Apples of cheeks"})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"EYES"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Brow Product",value:cr.browProduct,onChange:dr=>ur("browProduct",dr),readOnly:lr,placeholder:"e.g., ABH Dipbrow Taupe"}),jsxRuntimeExports.jsx(FormField,{label:"Brow Shape",value:cr.browShape,onChange:dr=>ur("browShape",dr),readOnly:lr,placeholder:"e.g., Natural arch"})]}),jsxRuntimeExports.jsx(FormField,{label:"Eye Primer",value:cr.eyePrimer,onChange:dr=>ur("eyePrimer",dr),readOnly:lr,placeholder:"e.g., Urban Decay Primer Potion"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Lid Colour",value:cr.lidColour,onChange:dr=>ur("lidColour",dr),readOnly:lr,placeholder:"e.g., Champagne"}),jsxRuntimeExports.jsx(FormField,{label:"Crease",value:cr.creaseColour,onChange:dr=>ur("creaseColour",dr),readOnly:lr,placeholder:"e.g., Warm brown"}),jsxRuntimeExports.jsx(FormField,{label:"Outer V",value:cr.outerV,onChange:dr=>ur("outerV",dr),readOnly:lr,placeholder:"e.g., Deep brown"})]}),jsxRuntimeExports.jsx(FormField,{label:"Liner Style",value:cr.liner,onChange:dr=>ur("liner",dr),readOnly:lr,placeholder:"e.g., Thin black line, tight line"}),jsxRuntimeExports.jsx(FormField,{label:"Lashes",value:cr.lashes,onChange:dr=>ur("lashes",dr),readOnly:lr,placeholder:"e.g., Ardell Wispies, 2 coats mascara"})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"LIPS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Lip Liner",value:cr.lipLiner,onChange:dr=>ur("lipLiner",dr),readOnly:lr,placeholder:"e.g., MAC Spice"}),jsxRuntimeExports.jsx(FormField,{label:"Lip Colour",value:cr.lipColour,onChange:dr=>ur("lipColour",dr),readOnly:lr,placeholder:"e.g., Charlotte Tilbury Pillow Talk"})]}),jsxRuntimeExports.jsx(FormField,{label:"Setting",value:cr.setting,onChange:dr=>ur("setting",dr),readOnly:lr,placeholder:"e.g., MAC Fix+, light powder"})]})]})]})}function HairForm({hair:ar,onChange:or,readOnly:lr=!1}){const cr=ar||createEmptyHairDetails(),ur=cr.hairType!=="Natural",dr=(pr,xr)=>{or&&!lr&&or({...cr,[pr]:xr})},hr=pr=>{if(lr)return;const xr=cr.wigAttachment||[],mr=xr.includes(pr)?xr.filter(fr=>fr!==pr):[...xr,pr];dr("wigAttachment",mr)};return!ar&&lr?jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No hair details available for this look."})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Hair Type"}),lr?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:cr.hairType}):jsxRuntimeExports.jsx("select",{value:cr.hairType,onChange:pr=>dr("hairType",pr.target.value),className:"w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",children:HAIR_TYPES.map(pr=>jsxRuntimeExports.jsx("option",{value:pr,children:pr},pr))})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Style Description",value:cr.style,onChange:pr=>dr("style",pr),readOnly:lr,placeholder:"e.g., Loose waves, half-up half-down",multiline:!0}),jsxRuntimeExports.jsx(FormField,{label:"Products Used",value:cr.products,onChange:pr=>dr("products",pr),readOnly:lr,placeholder:"e.g., Oribe Dry Texturizing Spray, heat protectant",multiline:!0}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Parting",value:cr.parting,onChange:pr=>dr("parting",pr),readOnly:lr,placeholder:"e.g., Centre part"}),jsxRuntimeExports.jsx(FormField,{label:"Pieces Out",value:cr.piecesOut,onChange:pr=>dr("piecesOut",pr),readOnly:lr,placeholder:"e.g., Face-framing layers"})]}),jsxRuntimeExports.jsx(FormField,{label:"Pins / Grips / Ties",value:cr.pins,onChange:pr=>dr("pins",pr),readOnly:lr,placeholder:"e.g., 6 bobby pins at crown, clear elastic"}),jsxRuntimeExports.jsx(FormField,{label:"Accessories",value:cr.accessories,onChange:pr=>dr("accessories",pr),readOnly:lr,placeholder:"e.g., Gold barrette, silk ribbon"})]}),ur&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-4 mt-4",children:jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"WIG / HAIRPIECE DETAILS"})}),jsxRuntimeExports.jsx(FormField,{label:"Wig Name / ID",value:cr.wigNameId,onChange:pr=>dr("wigNameId",pr),readOnly:lr,placeholder:"e.g., WIG-042 Auburn Bob"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Wig Type"}),lr?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:cr.wigType||jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsxs("select",{value:cr.wigType,onChange:pr=>dr("wigType",pr.target.value),className:"w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select type..."}),WIG_TYPES.map(pr=>jsxRuntimeExports.jsx("option",{value:pr,children:pr},pr))]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Hairline"}),lr?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:cr.hairline||jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsxs("select",{value:cr.hairline,onChange:pr=>dr("hairline",pr.target.value),className:"w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select style..."}),HAIRLINE_STYLES.map(pr=>jsxRuntimeExports.jsx("option",{value:pr,children:pr},pr))]})]})]}),jsxRuntimeExports.jsx(FormField,{label:"Wig Cap Method",value:cr.wigCapMethod,onChange:pr=>dr("wigCapMethod",pr),readOnly:lr,placeholder:"e.g., Cornrows, bald cap, braided flat"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Attachment Method"}),lr?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:cr.wigAttachment.length>0?cr.wigAttachment.join(", "):jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:WIG_ATTACHMENTS.map(pr=>{const xr=cr.wigAttachment.includes(pr);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>hr(pr),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${xr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:pr},pr)})})]}),jsxRuntimeExports.jsx(FormField,{label:"Lace Tint",value:cr.laceTint,onChange:pr=>dr("laceTint",pr),readOnly:lr,placeholder:"e.g., Ebin Lace Tint Medium Brown"}),jsxRuntimeExports.jsx(FormField,{label:"Edges / Baby Hairs",value:cr.edgesBabyHairs,onChange:pr=>dr("edgesBabyHairs",pr),readOnly:lr,placeholder:"e.g., Laid with Got2b, swoop on left side"})]})]})}function SFXForm({sfx:ar,onChange:or,onCapturePhoto:lr,onRemovePhoto:cr,readOnly:ur=!1}){const dr=ar||createEmptySFXDetails(),hr=(mr,fr)=>{or&&!ur&&or({...dr,[mr]:fr})},pr=mr=>{if(ur)return;const fr=dr.sfxTypes||[],Er=fr.includes(mr)?fr.filter(vr=>vr!==mr):[...fr,mr];hr("sfxTypes",Er)},xr=mr=>{if(ur)return;const fr=dr.bloodTypes||[],Er=fr.includes(mr)?fr.filter(vr=>vr!==mr):[...fr,mr];hr("bloodTypes",Er)};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"SFX Required"}),jsxRuntimeExports.jsx(Switch,{isOn:dr.sfxRequired,onToggle:()=>!ur&&hr("sfxRequired",!dr.sfxRequired),disabled:ur})]}),dr.sfxRequired&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"SFX Type"}),ur?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:dr.sfxTypes.length>0?dr.sfxTypes.join(", "):jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:SFX_TYPES.map(mr=>{const fr=dr.sfxTypes.includes(mr);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>pr(mr),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${fr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:mr},mr)})})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"PROSTHETICS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Prosthetic Pieces",value:dr.prostheticPieces,onChange:mr=>hr("prostheticPieces",mr),readOnly:ur,placeholder:"e.g., Brow piece #3, nose tip, chin extension",multiline:!0}),jsxRuntimeExports.jsx(FormField,{label:"Prosthetic Adhesive",value:dr.prostheticAdhesive,onChange:mr=>hr("prostheticAdhesive",mr),readOnly:ur,placeholder:"e.g., Pros-Aide, Telesis 5"})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"BLOOD"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Blood Type"}),ur?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:dr.bloodTypes.length>0?dr.bloodTypes.join(", "):jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:BLOOD_TYPES.map(mr=>{const fr=dr.bloodTypes.includes(mr);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>xr(mr),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${fr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:mr},mr)})})]}),jsxRuntimeExports.jsx(FormField,{label:"Blood Products",value:dr.bloodProducts,onChange:mr=>hr("bloodProducts",mr),readOnly:ur,placeholder:"e.g., Kryolan Dark Blood, Fleet Street Drying Blood"}),jsxRuntimeExports.jsx(FormField,{label:"Blood Placement",value:dr.bloodPlacement,onChange:mr=>hr("bloodPlacement",mr),readOnly:ur,placeholder:"e.g., Left temple wound, splatter on collar",multiline:!0})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"TATTOOS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Tattoo Coverage",value:dr.tattooCoverage,onChange:mr=>hr("tattooCoverage",mr),readOnly:ur,placeholder:"e.g., Dermablend on right arm sleeve"}),jsxRuntimeExports.jsx(FormField,{label:"Temporary Tattoos",value:dr.temporaryTattoos,onChange:mr=>hr("temporaryTattoos",mr),readOnly:ur,placeholder:"e.g., Neck tattoo transfer, left forearm design"})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"EYES & TEETH"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Contact Lenses",value:dr.contactLenses,onChange:mr=>hr("contactLenses",mr),readOnly:ur,placeholder:"e.g., 9mm Mesmer Ghostly White, plano"}),jsxRuntimeExports.jsx(FormField,{label:"Teeth",value:dr.teeth,onChange:mr=>hr("teeth",mr),readOnly:ur,placeholder:"e.g., Custom vampire fangs, coffee staining"})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"AGING & CHARACTER"}),jsxRuntimeExports.jsx(FormField,{label:"Aging / Character Notes",value:dr.agingCharacterNotes,onChange:mr=>hr("agingCharacterNotes",mr),readOnly:ur,placeholder:"e.g., Stipple aging on hands and neck, sunken cheeks with highlight/shadow",multiline:!0,rows:3})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("label",{className:"field-label whitespace-nowrap",children:"SFX APPLICATION TIME"}),ur?jsxRuntimeExports.jsxs("span",{className:"text-sm text-text-primary font-semibold",children:[dr.sfxApplicationTime??""," min"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("input",{type:"number",value:dr.sfxApplicationTime??"",onChange:mr=>hr("sfxApplicationTime",mr.target.value?parseInt(mr.target.value,10):null),className:"w-16 bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-2 text-sm text-center font-semibold text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",placeholder:"--",min:"0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold",children:"SFX REFERENCE PHOTOS"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-light",children:[dr.sfxReferencePhotos.length," photos"]})]}),jsxRuntimeExports.jsx(SFXPhotoGrid,{photos:dr.sfxReferencePhotos,onCapture:lr,onRemove:cr,readOnly:ur})]})]}),!dr.sfxRequired&&jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Toggle SFX Required to add special effects details."})})]})}function SFXPhotoGrid({photos:ar,onCapture:or,onRemove:lr,readOnly:cr}){return jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[ar.map(ur=>jsxRuntimeExports.jsxs("div",{className:"relative aspect-square",children:[jsxRuntimeExports.jsx("img",{src:ur.thumbnail||ur.uri,alt:"SFX reference",className:"w-full h-full object-cover rounded-lg"}),!cr&&lr&&jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>lr(ur.id),className:"absolute -top-1.5 -right-1.5 w-5 h-5 rounded-full bg-error text-white flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},ur.id)),!cr&&or&&jsxRuntimeExports.jsxs("button",{type:"button",onClick:or,className:"aspect-square rounded-lg border-2 border-dashed border-border flex flex-col items-center justify-center gap-1 text-text-light hover:border-gold hover:text-gold transition-colors",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"})]}),jsxRuntimeExports.jsx("span",{className:"text-[10px] font-medium",children:"Add"})]}),ar.length===0&&cr&&jsxRuntimeExports.jsx("div",{className:"col-span-4 text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No SFX reference photos."})})]})}function NotesForm({notes:ar,onChange:or}){const[lr,cr]=reactExports.useState(ar),ur=reactExports.useRef(null),dr=reactExports.useRef(null),hr=reactExports.useRef(or);reactExports.useEffect(()=>{hr.current=or},[or]),reactExports.useEffect(()=>{cr(ar)},[ar]);const pr=()=>{dr.current&&(clearTimeout(dr.current),dr.current=null),ur.current!==null&&(hr.current(ur.current),ur.current=null)};reactExports.useEffect(()=>()=>{pr()},[]);const xr=fr=>{cr(fr),ur.current=fr,dr.current&&clearTimeout(dr.current),dr.current=setTimeout(()=>{ur.current!==null&&(hr.current(ur.current),ur.current=null)},300)},mr=()=>{pr()};return jsxRuntimeExports.jsx(Textarea,{value:lr,onChange:fr=>xr(fr.target.value),onBlur:mr,placeholder:"Add continuity notes, anomalies, director requests...",rows:4,className:"resize-none"})}function CharacterProfile({sceneId:ar,characterId:or}){const{currentProject:lr,getCharacter:cr,getScene:ur,getLookForCharacterInScene:dr,getOrCreateSceneCapture:hr,getSceneCapture:pr,updateSceneCapture:xr,addPhotoToCapture:mr,removePhotoFromCapture:fr,toggleContinuityFlag:Er,addContinuityEvent:vr,removeContinuityEvent:gr,updateSFXDetails:yr,addSFXPhoto:jr,removeSFXPhoto:br,markSceneComplete:_r,copyToNextScene:wr,setCurrentScene:Rr,sceneCaptures:Ar,updateLook:Sr}=useProjectStore(),kr=cr(or),Nr=ur(ar),Cr=Nr?dr(or,Nr.sceneNumber):void 0,Tr=pr(ar,or)||hr(ar,or),[Pr,Ir]=reactExports.useState(!1),[Br,Wr]=reactExports.useState("front"),[Yr,es]=reactExports.useState(!1),[ps,ts]=reactExports.useState(!1),[Qr,Hr]=reactExports.useState(!1),[Kr,rs]=reactExports.useState(!1),[Mr,Dr]=reactExports.useState([]),[Lr,Fr]=reactExports.useState(0),[$r,Vr]=reactExports.useState("scene");if(!kr||!Nr||!lr)return null;const Gr=Tr.id,Jr=(Xr,cs=!1,xs=!1)=>{Wr(Xr),es(cs),ts(xs),Ir(!0)},ms=async Xr=>{const cs=await createPhotoFromBlob(Xr,Yr||ps?void 0:Br);ps?jr(Gr,cs):Yr&&Cr?mr(Gr,cs,"additional"):mr(Gr,cs,Br==="additional"?"additional":Br)},ls=Xr=>{yr(Gr,Xr)},ds=()=>{_r(ar)},bs=()=>{const Xr=wr(ar,or);Xr&&Rr(Xr)},ws=Xr=>{const cs={...Xr,id:`event-${Date.now()}`};vr(Gr,cs),Hr(!1)},Is=(Xr,cs)=>{const xs=[],Es=["front","left","right","back"];let Ns=0;Es.forEach(Ts=>{const gs=Tr.photos[Ts];gs&&(Ts===cs&&(Ns=xs.length),xs.push(gs))}),Dr(xs),Fr(Ns),Vr("scene"),rs(!0)},ys=(Xr,cs)=>{Dr(Tr.additionalPhotos),Fr(cs),Vr("additional"),rs(!0)},ss=Xr=>{if($r==="scene"){const cs=["front","left","right","back"];for(const xs of cs){const Es=Tr.photos[xs];if((Es==null?void 0:Es.id)===Xr){fr(Gr,xs);break}}Dr(xs=>xs.filter(Es=>Es.id!==Xr))}else $r==="additional"?(fr(Gr,"additional",Xr),Dr(cs=>cs.filter(xs=>xs.id!==Xr))):$r==="sfx"&&(br(Gr,Xr),Dr(cs=>cs.filter(xs=>xs.id!==Xr)))},Ur=Cr?lr.scenes.filter(Xr=>Cr.scenes.includes(Xr.sceneNumber)):[];return jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-4 space-y-2.5 pb-32",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3.5",children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:kr,size:"xl"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h2",{className:"text-character-name text-gold font-bold truncate",children:kr.name}),jsxRuntimeExports.jsxs("p",{className:"text-[13px] text-text-muted mt-0.5",children:["Scene ",Nr.sceneNumber," | ",formatSluglineShort(Nr.slugline)]})]})]}),Cr&&jsxRuntimeExports.jsxs("div",{className:"bg-input-bg rounded-[10px] px-4 py-3 flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-gold",children:Cr.name}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted ml-2.5",children:["Scenes ",formatSceneRange(Cr.scenes)]})]}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted font-medium",children:["~",formatEstimatedTime(Cr.estimatedTime)]})]}),(()=>{const Xr=[{key:"sweat",label:"Sweat"},{key:"dishevelled",label:"Dishevelled"},{key:"blood",label:"Blood"},{key:"dirt",label:"Dirt"},{key:"wetHair",label:"Wet Hair"},{key:"tears",label:"Tears"}].filter(({key:cs})=>Tr.continuityFlags[cs]);return Xr.length===0?null:jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:Xr.map(({key:cs,label:xs})=>jsxRuntimeExports.jsx("span",{className:"px-3 py-1.5 text-xs font-semibold rounded-full bg-gold text-white",children:xs},cs))})})(),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"SCENE PHOTOS"}),jsxRuntimeExports.jsx(PhotoGrid,{photos:Tr.photos,onCapture:Xr=>Jr(Xr),onView:Is})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"MASTER REFERENCE"}),jsxRuntimeExports.jsx(MasterReference,{photo:Cr==null?void 0:Cr.masterReference,onCapture:()=>Jr("front",!0)})]}),Ur.length>1&&jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"SCENES IN THIS LOOK"}),jsxRuntimeExports.jsx("div",{className:"flex gap-3 overflow-x-auto hide-scrollbar p-1 -m-1",children:Ur.map(Xr=>{const cs=Ar[`${Xr.id}-${or}`],xs=cs?getCaptureStatus(cs)!=="not-started":!1;let Es;if(cs){const{photos:Ns,additionalPhotos:Ts}=cs,gs=Ns.front||Ns.left||Ns.right||Ns.back||Ts[0];Es=(gs==null?void 0:gs.thumbnail)||(gs==null?void 0:gs.uri)}return jsxRuntimeExports.jsx(SceneThumbnailSlot,{sceneNumber:Xr.sceneNumber,hasCaptured:xs,isActive:Xr.id===ar,onClick:()=>Rr(Xr.id),thumbnailUrl:Es},Xr.id)})})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"ADDITIONAL PHOTOS"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-light",children:[Tr.additionalPhotos.length," photos"]})]}),jsxRuntimeExports.jsx(AdditionalPhotosGrid,{photos:Tr.additionalPhotos,onCapture:()=>Jr("additional"),onView:ys})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"QUICK FLAGS"}),jsxRuntimeExports.jsx(QuickFlags,{flags:Tr.continuityFlags,onToggle:Xr=>Er(Gr,Xr)})]}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx(ContinuityEvents,{events:Tr.continuityEvents,onAddEvent:()=>Hr(!0),onRemoveEvent:Xr=>gr(Gr,Xr)})}),jsxRuntimeExports.jsx(Accordion,{title:"MAKEUP",count:Cr?countFilledFields(Cr.makeup):0,children:jsxRuntimeExports.jsx(MakeupForm,{makeup:Cr==null?void 0:Cr.makeup,onChange:Cr?Xr=>Sr(Cr.id,{makeup:Xr}):void 0})}),jsxRuntimeExports.jsx(Accordion,{title:"HAIR",count:Cr?countHairFields(Cr.hair):0,children:jsxRuntimeExports.jsx(HairForm,{hair:Cr==null?void 0:Cr.hair,onChange:Cr?Xr=>Sr(Cr.id,{hair:Xr}):void 0})}),jsxRuntimeExports.jsx(Accordion,{title:"SPECIAL EFFECTS",count:countSFXFields(Tr.sfxDetails),badge:Tr.sfxDetails.sfxRequired?void 0:"None",children:jsxRuntimeExports.jsx(SFXForm,{sfx:Tr.sfxDetails,onChange:ls,onCapturePhoto:()=>Jr("additional",!1,!0),onRemovePhoto:Xr=>br(Gr,Xr)})}),jsxRuntimeExports.jsx(Accordion,{title:"SCENE NOTES",children:jsxRuntimeExports.jsx(NotesForm,{notes:Tr.notes,onChange:Xr=>xr(Gr,{notes:Xr})})}),jsxRuntimeExports.jsxs("div",{className:"card flex items-center gap-3.5",children:[jsxRuntimeExports.jsx("label",{className:"field-label whitespace-nowrap",children:"APPLICATION TIME"}),jsxRuntimeExports.jsx("input",{type:"number",value:Tr.applicationTime??(Cr==null?void 0:Cr.estimatedTime)??"",onChange:Xr=>xr(Gr,{applicationTime:Xr.target.value?parseInt(Xr.target.value,10):void 0}),className:"input-field w-16 text-center font-semibold",placeholder:"--",min:"0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2.5 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:ds,disabled:Nr.isComplete,children:Nr.isComplete?"Scene Completed":"Mark Scene Complete"}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"lg",fullWidth:!0,onClick:bs,children:"Copy to Next Scene"})]})]}),jsxRuntimeExports.jsx(PhotoCapture,{isOpen:Pr,onClose:()=>Ir(!1),onCapture:ms,angle:Br,characterName:kr.name,sceneNumber:Nr.sceneNumber,lookName:Cr==null?void 0:Cr.name}),jsxRuntimeExports.jsx(AddEventModal,{isOpen:Qr,onClose:()=>Hr(!1),onAdd:ws}),jsxRuntimeExports.jsx(PhotoViewer,{isOpen:Kr,photos:Mr,initialIndex:Lr,onClose:()=>rs(!1),onDelete:ss})]})}function formatSluglineShort(ar){return ar.replace(/^(INT\.|EXT\.)\s*/i,"").replace(/\s*-\s*(DAY|NIGHT|MORNING|EVENING|CONTINUOUS)\s*$/i,"").split(" - ")[0]}function SceneView({sceneId:ar,onBack:or}){const{currentProject:lr,currentCharacterId:cr,setCurrentCharacter:ur,getScene:dr,getCharacter:hr,addCharacterToScene:pr}=useProjectStore(),xr=dr(ar),[mr,fr]=reactExports.useState(!1),[Er,vr]=reactExports.useState(!1);reactExports.useEffect(()=>{xr&&xr.characters.length>0&&!cr&&ur(xr.characters[0])},[xr,cr,ur]);const gr=reactExports.useMemo(()=>!xr||!cr?!0:xr.characters.includes(cr),[xr,cr]),yr=cr?hr(cr):null,jr=reactExports.useCallback(()=>{xr&&cr&&pr(xr.id,cr)},[xr,cr,pr]),br=reactExports.useCallback(()=>{!gr&&cr?vr(!0):or()},[gr,cr,or]);if(!xr||!lr)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-text-muted",children:"Scene not found"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",onClick:or,className:"mt-2",children:"Go Back"})]})});const _r=reactExports.useMemo(()=>xr.characters.map(wr=>hr(wr)).filter(Boolean),[xr.characters,hr]);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx(Header,{title:`Scene ${xr.sceneNumber}`,showBack:!0,onBack:br}),!gr&&yr&&jsxRuntimeExports.jsx("div",{className:"bg-amber-50 border-b border-amber-200 px-4 py-3",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium text-amber-800",children:[yr.name," is not in the breakdown"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-600 mt-0.5",children:"Add them to track continuity for this scene"})]}),jsxRuntimeExports.jsx("button",{onClick:jr,className:"flex-shrink-0 px-3 py-1.5 rounded-lg bg-amber-600 text-white text-xs font-semibold active:scale-95 transition-transform",children:"Add to Breakdown"})]})})}),jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border px-4 py-3",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold text-text-primary mb-2",children:xr.slugline}),xr.synopsis?jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mb-3",children:xr.synopsis}):jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted italic mb-3",children:"No synopsis available. Sync from desktop or tap to add."}),xr.scriptContent&&jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:()=>fr(!0),children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"View Full Scene"]})]})}),_r.length>0&&jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border overflow-x-auto hide-scrollbar",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"flex gap-2 px-4 py-3",children:_r.map(wr=>jsxRuntimeExports.jsx("button",{onClick:()=>ur(wr.id),className:clsx("flex-shrink-0 px-4 py-2 rounded-pill text-sm font-medium transition-colors touch-manipulation",{"gold-gradient text-white":cr===wr.id,"bg-gray-100 text-text-secondary hover:bg-gray-200":cr!==wr.id}),children:wr.name},wr.id))})})}),cr&&jsxRuntimeExports.jsx(CharacterProfile,{sceneId:ar,characterId:cr}),Er&&yr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:()=>vr(!1),children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-t-2xl overflow-hidden animate-slideUp",onClick:wr=>wr.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"p-5",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM3 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 019.374 21c-2.331 0-4.512-.645-6.374-1.766z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Add ",yr.name," to Breakdown?"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"This character hasn't been added to the scene breakdown yet"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-5 pb-5 flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{vr(!1),or()},className:"flex-1 py-2.5 rounded-button border border-border text-text-muted text-sm font-medium",children:"Leave Without Adding"}),jsxRuntimeExports.jsx("button",{onClick:()=>{jr(),vr(!1),or()},className:"flex-1 py-2.5 rounded-button gold-gradient text-white text-sm font-medium",children:"Add to Breakdown"})]})]})}),mr&&xr.scriptContent&&jsxRuntimeExports.jsx(FullScriptModal,{content:xr.scriptContent,sceneNumber:xr.sceneNumber,onClose:()=>fr(!1)})]})}function FullScriptModal({content:ar,sceneNumber:or,onClose:lr}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col bg-card animate-slideUp",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-text-primary",children:["Scene ",or]}),jsxRuntimeExports.jsx("button",{onClick:lr,className:"p-2 -m-2 text-text-muted hover:text-text-primary tap-target touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-text-primary leading-relaxed",children:ar})})]})})}function SceneScriptModal({scene:ar,onClose:or}){return reactExports.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),reactExports.useEffect(()=>{const lr=cr=>{cr.key==="Escape"&&or()};return document.addEventListener("keydown",lr),()=>document.removeEventListener("keydown",lr)},[or]),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",onClick:or,children:jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col bg-card animate-slideUp",onClick:lr=>lr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border safe-top",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-text-primary",children:["Scene ",ar.sceneNumber]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted truncate",children:ar.slugline})]}),jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -m-2 text-text-muted hover:text-text-primary tap-target touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-border/50 bg-gray-50",children:[jsxRuntimeExports.jsx("span",{className:clsx("px-2 py-0.5 text-xs font-bold rounded",ar.intExt==="INT"?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"),children:ar.intExt}),jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-gray-200 text-text-secondary",children:ar.timeOfDay}),ar.filmingStatus&&jsxRuntimeExports.jsx("span",{className:clsx("px-2 py-0.5 text-xs font-medium rounded",ar.filmingStatus==="complete"?"bg-green-100 text-green-700":ar.filmingStatus==="partial"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"),children:ar.filmingStatus==="complete"?"Complete":ar.filmingStatus==="partial"?"Partial":"Incomplete"})]}),ar.synopsis&&jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border/50 bg-gold-100/30",children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-1",children:"SYNOPSIS"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary italic",children:ar.synopsis})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto",children:ar.scriptContent?jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"FULL SCENE"}),jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-text-primary leading-relaxed",children:ar.scriptContent})]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Script Content"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted text-center",children:["Script content is not available for this scene.",!ar.synopsis&&" Upload a script to view full scene content."]})]})}),jsxRuntimeExports.jsx("div",{className:"border-t border-border p-4 safe-bottom bg-card",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-full py-3 rounded-button gold-gradient text-white font-medium active:scale-[0.98] transition-transform",children:"Close"})})]})})}pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;function debugLog(...ar){console.log("[CallSheetParser]",...ar)}async function extractTextFromPDF$1(ar){const or=await ar.arrayBuffer(),lr=await pdfExports.getDocument({data:or}).promise;let cr="";for(let ur=1;ur<=lr.numPages;ur++){const pr=(await(await lr.getPage(ur)).getTextContent()).items.map(xr=>xr.str).join(" ");cr+=pr+`
`}return cr}async function parseCallSheetText(ar,or){var ur,dr,hr;const lr=`You are an expert at parsing film/TV production call sheets. Your job is to extract structured data from call sheet text that has been extracted from a PDF.

IMPORTANT: Call sheets vary significantly between productions and ADs. The text extraction may lose table structure, so look for patterns and context clues.

Common patterns to look for:
- Production day: "DAY X" or "DAY X OF Y" or "SHOOT DAY X" or "CALL SHEET X OF Y"
- Dates: Various formats like "MONDAY 24TH NOVEMBER 2025" or "24/11/25"
- Unit call time: "UNIT CALL" or "UNIT CALL TIME" followed by time
- Pre-calls: HMU, COSTUME, ADs, LIGHTING, CAMERA times (often earlier than unit call)
  - May include location like "07:45 @ UB" (at Unit Base)
- Meal times: BREAKFAST, LUNCH with times and possibly locations (HOTBOX, IN HAND, etc.)
- Wrap estimates: "EST. WRAP", "CAMERA WRAP", "WRAP"
- Weather: Temperature (High/Low), conditions, sunrise/sunset times
- Locations: UNIT BASE, LOCATION, LOC 1, LOC 2, CREW PARKING with addresses and What3Words (///word.word.word)
- Scene schedules: Usually in table format with scene numbers, INT/EXT, location, D/N, pages, cast numbers, timings
- Cast information: Actor names, characters, call times, H&MU times, costume times, travel, on-set times

Time formats vary: "0730", "07:30", "7:30 AM", "7.30", "08:00 AM"

Return ONLY valid JSON with no additional text or markdown.`,cr=`Parse this call sheet text and extract ALL available information including locations, weather, and timing details.

CALL SHEET TEXT:
---
${ar.slice(0,15e3)}
---

Return a JSON object with this structure (include only fields that have data in the call sheet):
{
  "date": "YYYY-MM-DD format",
  "productionDay": number,
  "totalProductionDays": number or null,
  "dayType": "e.g., 10 HRS CONTINUOUS WORKING DAY, STANDARD WORKING DAY, SEMI-CONTINUOUS",
  "unitCallTime": "HH:MM 24-hour format",
  "rehearsalsTime": "HH:MM or null (REHEARSALS ON SET FOR)",
  "firstShotTime": "HH:MM or null (TO SHOOT FOR)",
  "preCalls": {
    "ads": "HH:MM or null",
    "hmu": "HH:MM or null",
    "costume": "HH:MM or null",
    "production": "HH:MM or null",
    "lighting": "HH:MM or null",
    "camera": "HH:MM or null",
    "location": "where pre-calls happen e.g., 'Unit Base', 'UB', 'On Set'"
  },
  "breakfastTime": "HH:MM or HH:MM - HH:MM",
  "breakfastLocation": "location description or null",
  "lunchTime": "HH:MM or HH:MM - HH:MM",
  "lunchLocation": "HOTBOX, IN HAND, location name, etc.",
  "cameraWrapEstimate": "HH:MM",
  "wrapEstimate": "HH:MM",
  "weather": {
    "conditions": "Overcast, Sunny, Showers, Mostly Cloudy, Scattered Showers, etc.",
    "tempHigh": number in Celsius,
    "tempLow": number in Celsius,
    "sunrise": "HH:MM",
    "sunset": "HH:MM"
  },
  "unitBase": {
    "name": "Location name",
    "address": "Full street address",
    "what3words": "///word.word.word format if present"
  },
  "shootLocations": [
    {
      "id": "LOC 1 or LOC1 or main",
      "name": "Location name",
      "address": "Full street address",
      "what3words": "///word.word.word format if present"
    }
  ],
  "crewParking": {
    "name": "Parking location name",
    "address": "Address if different from unit base",
    "notes": "Any parking instructions"
  },
  "unitNotes": ["array of important notes from UNIT NOTES section"],
  "scenes": [
    {
      "sceneNumber": "1" or "1A" (string, exactly as shown),
      "locationId": "LOC 1, LOC 2, etc. if shown",
      "setDescription": "The INT/EXT location line ONLY, e.g. 'EXT. FARMHOUSE' or 'INT. FARMHOUSE - KITCHEN'. Do NOT include the scene description here.",
      "action": "REQUIRED: The scene description/log line that describes WHAT HAPPENS in the scene. Examples: 'PETER and GWEN meet the AOKI's', 'PETER tells GWEN to go', 'PETER & GWEN watch the helicopter take off'. This is usually below the location or after a separator. Extract this for EVERY scene.",
      "dayNight": "D" or "N" or "D/N" or "D1" or "D2" or "D11" etc (from D/N column)",
      "pages": "1/8" or "2" or "1 5/8" or "1 2/8" etc (from PAGES column)",
      "cast": ["1", "2", "4"] (cast ID numbers from CAST column, as strings),
      "estimatedTime": "08:20 - 09:00 or 09:20 - 10:30 (from TIMINGS column)",
      "notes": "CRITICAL: Extract ALL notes from the NOTES column, especially HMU (hair/makeup), VFX, SFX, STUNTS notes. Format as 'HMU: description, VFX: description, SFX: description'. These are essential for continuity tracking."
    }
  ],
  "castCalls": [
    {
      "id": "1" (cast number from ID column),
      "name": "ACTOR NAME",
      "character": "CHARACTER NAME or ROLE",
      "status": "SW" or "SWF" or "W" or "WF" etc,
      "pickup": "HH:MM or null",
      "driver": "RW, LW, MINIBUS, etc. or null",
      "callTime": "HH:MM (CALL column)",
      "breakfastTime": "HH:MM (B/FAST column) or null",
      "costumeCall": "HH:MM (COSTUME column) or null",
      "hmuCall": "HH:MM (H&MU column) or null",
      "travelTime": "HH:MM (TRAVEL column) or null",
      "onSetTime": "HH:MM (ON SET column) or null",
      "notes": "any notes for this cast member"
    }
  ],
  "supportingArtists": [
    {
      "id": "SA1 or number",
      "name": "NAME",
      "designation": "Role description",
      "callTime": "HH:MM"
    }
  ]
}

IMPORTANT:
- All times should be in 24-hour HH:MM format (convert "0730" to "07:30", "8:00 AM" to "08:00")
- Scene numbers should be extracted exactly as shown (may be numeric or alphanumeric like "4A", "18B")
- Extract What3Words addresses - they look like "///word.word.word" or "W3W - ///word.word.word"
- Look for LOCATION: and UNIT BASE: lines for address information
- Camera wrap and estimated wrap are often separate times
- Pre-calls may be listed as "PRE-CALLS" or "PRE CALLS" with department times
- Extract weather including conditions like "Overcast with Scattered Showers"
- If a field has no data, omit it or use null
- CRITICAL: Only extract scenes for the CURRENT shooting day. Do NOT include scenes from "ADVANCE SCHEDULE", "ADVANCE", "NEXT DAYS", or any section showing future production days. These appear at the end of call sheets and show upcoming days - ignore them completely.

SCENE DATA EXTRACTION (VERY IMPORTANT):
- The "SET & DESCRIPTION" column typically has TWO parts per scene:
  1. setDescription = The INT/EXT location line ONLY (e.g., "EXT. FARMHOUSE", "INT. FARMHOUSE - KITCHEN")
  2. action = The scene description/log line that describes WHAT HAPPENS (e.g., "PETER and GWEN meet the AOKI's", "PETER tells GWEN to go")
- CRITICAL: The "action" field MUST contain the description of what happens in the scene, NOT the location
- If the description appears on a separate line below the location, that is the "action"
- If the description appears after a dash or colon after the location, extract it as the "action"
- Examples of action: "PETER and GWEN watch the helicopter take off", "PETER tells GWEN to go", "PETER & GWEN make the poison, the house rocks"
- ALWAYS extract cast numbers from the CAST column (e.g., "1, 2, 9, 10, 14")
- ALWAYS extract notes from NOTES column, especially HMU (hair/makeup), VFX, SFX notes
- ALWAYS extract page counts and timings when available`;try{debugLog("Starting AI call sheet parsing..."),debugLog("Text length:",ar.length,"characters");const pr=await callAI(cr,{system:lr,maxTokens:8e3});debugLog("AI response received, length:",pr.length);const xr=pr.match(/\{[\s\S]*\}/);if(!xr)throw console.error("No JSON found in AI response:",pr),debugLog("ERROR: No JSON found in AI response"),new Error("Failed to parse call sheet - invalid AI response");const mr=JSON.parse(xr[0]);if(debugLog("JSON parsed successfully"),debugLog("Scenes extracted:",((ur=mr.scenes)==null?void 0:ur.length)||0),debugLog("Cast calls extracted:",((dr=mr.castCalls)==null?void 0:dr.length)||0),((hr=mr.scenes)==null?void 0:hr.length)>0){const Rr=mr.scenes[0];debugLog("Sample scene:",{sceneNumber:Rr.sceneNumber,setDescription:Rr.setDescription,action:Rr.action,cast:Rr.cast,estimatedTime:Rr.estimatedTime,pages:Rr.pages})}const Er=(mr.scenes||[]).filter(Rr=>{const Ar=(Rr.notes||"").toLowerCase();return!(Ar.includes("advance schedule")||Ar.includes("advance day")||Rr.productionDay&&mr.productionDay&&Rr.productionDay!==mr.productionDay)}).map((Rr,Ar)=>({sceneNumber:String(Rr.sceneNumber||Ar+1),location:Rr.locationId||Rr.location||void 0,setDescription:Rr.setDescription||"Unknown Scene",action:Rr.action||void 0,dayNight:Rr.dayNight||"D",pages:Rr.pages||void 0,cast:Array.isArray(Rr.cast)?Rr.cast.map(String):[],notes:Rr.notes||void 0,estimatedTime:Rr.estimatedTime||void 0,startTime:Rr.startTime||void 0,endTime:Rr.endTime||void 0,shootOrder:Ar+1,status:"upcoming"})),vr=(mr.castCalls||[]).map(Rr=>({id:String(Rr.id||""),name:Rr.name||"",character:Rr.character||"",status:Rr.status||"W",pickup:Rr.pickup||void 0,driver:Rr.driver||void 0,callTime:Rr.callTime||"",makeupCall:Rr.makeupCall||Rr.breakfastTime||void 0,costumeCall:Rr.costumeCall||void 0,hmuCall:Rr.hmuCall||void 0,travelTime:Rr.travelTime||void 0,onSetTime:Rr.onSetTime||void 0,notes:Rr.notes||void 0})),gr=(mr.supportingArtists||[]).map(Rr=>({id:String(Rr.id||""),name:Rr.name||"",designation:Rr.designation||"",status:Rr.status||"-",callTime:Rr.callTime||"",makeupCall:Rr.makeupCall||void 0,costumeCall:Rr.costumeCall||void 0,hmuCall:Rr.hmuCall||void 0,travelTime:Rr.travelTime||void 0,onSetTime:Rr.onSetTime||void 0,notes:Rr.notes||void 0})),yr=mr.weather?{conditions:mr.weather.conditions||void 0,tempHigh:mr.weather.tempHigh||void 0,tempLow:mr.weather.tempLow||void 0,sunrise:mr.weather.sunrise||void 0,sunset:mr.weather.sunset||void 0}:void 0,jr=mr.preCalls?{ads:mr.preCalls.ads||void 0,hmu:mr.preCalls.hmu||void 0,costume:mr.preCalls.costume||void 0,production:mr.preCalls.production||void 0,lighting:mr.preCalls.lighting||void 0,camera:mr.preCalls.camera||void 0,location:mr.preCalls.location||void 0}:void 0,br=mr.unitBase?{name:mr.unitBase.name||"",address:mr.unitBase.address||void 0,what3words:mr.unitBase.what3words||void 0,notes:mr.unitBase.notes||void 0}:void 0;let _r;if(mr.shootLocation)_r={name:mr.shootLocation.name||"",address:mr.shootLocation.address||void 0,what3words:mr.shootLocation.what3words||void 0,notes:mr.shootLocation.notes||void 0};else if(mr.shootLocations&&mr.shootLocations.length>0){const Rr=mr.shootLocations[0],Ar=mr.shootLocations.slice(1),Sr=Ar.length>0?Ar.map(kr=>`${kr.id||""}: ${kr.name||""} ${kr.address||""}`).join("; "):void 0;_r={name:Rr.name||Rr.id||"",address:Rr.address||void 0,what3words:Rr.what3words||void 0,notes:Sr||Rr.notes||void 0}}const wr=mr.crewParking?{name:mr.crewParking.name||"Crew Parking",address:mr.crewParking.address||void 0,what3words:mr.crewParking.what3words||void 0,notes:mr.crewParking.notes||void 0}:void 0;return{id:v4(),date:mr.date||new Date().toISOString().split("T")[0],productionDay:mr.productionDay||1,totalProductionDays:mr.totalProductionDays||void 0,dayType:mr.dayType||void 0,unitCallTime:mr.unitCallTime||"06:00",rehearsalsTime:mr.rehearsalsTime||void 0,firstShotTime:mr.firstShotTime||void 0,preCalls:jr,breakfastTime:mr.breakfastTime||void 0,lunchTime:mr.lunchTime||void 0,lunchLocation:mr.lunchLocation||mr.breakfastLocation||void 0,cameraWrapEstimate:mr.cameraWrapEstimate||void 0,wrapEstimate:mr.wrapEstimate||void 0,weather:yr,unitBase:br,shootLocation:_r,crewParking:wr,unitNotes:Array.isArray(mr.unitNotes)?mr.unitNotes:void 0,scenes:Er,castCalls:vr,supportingArtists:gr,uploadedAt:new Date,pdfUri:or,rawText:ar}}catch(pr){return console.error("AI call sheet parsing failed:",pr),debugLog("ERROR: AI parsing failed, falling back to regex parser"),debugLog("Error details:",pr),fallbackParseCallSheetText(ar,or)}}function fallbackParseCallSheetText(ar,or){debugLog("Using FALLBACK regex parser (AI parsing failed)"),debugLog("NOTE: Fallback parser has limited extraction - cast, timing, action fields may be missing");const lr=Lr=>{if(!Lr)return;const Fr=Lr[1].padStart(2,"0"),$r=Lr[2]||"00";return`${Fr}:${$r}`},cr=ar.match(/DAY\s*(\d+)\s*(?:OF\s*(\d+))?/i);let ur=1,dr;cr&&(ur=parseInt(cr[1],10),dr=cr[2]?parseInt(cr[2],10):void 0);const hr=ar.match(/CALL\s*SHEET\s*(\d+)\s*OF\s*(\d+)/i);hr&&!cr&&(ur=parseInt(hr[1],10),dr=parseInt(hr[2],10));let pr=new Date().toISOString().split("T")[0];const xr=ar.match(/(\d{1,2})(?:ST|ND|RD|TH)?\s*(JANUARY|FEBRUARY|MARCH|APRIL|MAY|JUNE|JULY|AUGUST|SEPTEMBER|OCTOBER|NOVEMBER|DECEMBER)\s*(\d{4})/i);if(xr){const Lr={JANUARY:"01",FEBRUARY:"02",MARCH:"03",APRIL:"04",MAY:"05",JUNE:"06",JULY:"07",AUGUST:"08",SEPTEMBER:"09",OCTOBER:"10",NOVEMBER:"11",DECEMBER:"12"},Fr=xr[1].padStart(2,"0"),$r=Lr[xr[2].toUpperCase()]||"01";pr=`${xr[3]}-${$r}-${Fr}`}const mr=ar.match(/UNIT\s*CALL[:\s]*TIME?[:\s]*(\d{1,2})[:\.]?(\d{2})/i),fr=lr(mr)||"06:00",Er=ar.match(/(?:EST\.?\s*)?WRAP[:\s]*(\d{1,2})[:\.]?(\d{2})/i),vr=lr(Er),gr=ar.match(/CAMERA\s*WRAP[:\s]*(\d{1,2})[:\.]?(\d{2})/i),yr=lr(gr),jr=ar.match(/BREAKFAST[:\s]*(\d{1,2})[:\.]?(\d{2})/i),br=lr(jr),_r=ar.match(/(?:EST\.?\s*)?LUNCH[:\s]*(\d{1,2})[:\.]?(\d{2})/i),wr=lr(_r);let Rr;const Ar=ar.match(/(?:HIGH|TEMP)[:\s]*(\d+)\s*[]?/i),Sr=ar.match(/LOW[:\s]*(\d+)\s*[]?/i),kr=ar.match(/(?:SUN\s*)?RISE[S]?[:\s]*(\d{1,2})[:\.]?(\d{2})/i),Nr=ar.match(/(?:SUN\s*)?SET[S]?[:\s]*(\d{1,2})[:\.]?(\d{2})/i),Cr=ar.match(/WEATHER[:\s]*([A-Za-z\s,]+?)(?:\s*(?:TEMP|HIGH|LOW|\d))/i);(Ar||Sr||kr||Nr)&&(Rr={conditions:Cr?Cr[1].trim():void 0,tempHigh:Ar?parseInt(Ar[1],10):void 0,tempLow:Sr?parseInt(Sr[1],10):void 0,sunrise:lr(kr),sunset:lr(Nr)});let Tr;const Pr=ar.match(/HMU[:\s]*(\d{1,2})[:\.]?(\d{2})/i),Ir=ar.match(/COSTUME[:\s]*(\d{1,2})[:\.]?(\d{2})/i),Br=ar.match(/ADs?[:\s]*(\d{1,2})[:\.]?(\d{2})/i);(Pr||Ir||Br)&&(Tr={hmu:lr(Pr),costume:lr(Ir),ads:lr(Br)});let Wr;const Yr=ar.match(/(?:LOCATION|UNIT\s*BASE)[:\s]*([^,\n]+(?:,[^,\n]+)*)/i),es=ar.match(/(?:W3W|what3words)[:\s-]*\/\/\/([a-z]+\.[a-z]+\.[a-z]+)/i);Yr&&(Wr={name:Yr[1].trim().split(",")[0],address:Yr[1].trim(),what3words:es?`///${es[1]}`:void 0});const ps=ar.search(/ADVANCE\s*SCHEDULE/i),ts=ps>0?ar.slice(0,ps):ar,Qr=[],Hr=/(?:SC|SCENE)?\s*(\d+[A-Z]?)\s+((?:INT|EXT)[.\s/][^D\d]*?)\s*(D\d*|N\d*|D\/N)/gi;let Kr,rs=1;for(;(Kr=Hr.exec(ts))!==null;)Qr.push({sceneNumber:Kr[1],setDescription:Kr[2].trim(),dayNight:Kr[3],shootOrder:rs++,status:"upcoming"});const Mr=[],Dr=ar.match(/CAST\s*INFORMATION[^]*?(?=MINIBUS|TRANSPORT|DEPARTURE|ADVANCE|$)/i);if(Dr){const Lr=Dr[0];debugLog("Found CAST INFORMATION section, length:",Lr.length);const Fr=/\b(\d{1,2})\s+([A-Z][A-Z\s.'-]+?)\s+([A-Z][A-Z\s'-]+?)\s+(SW?F?|W|WF|H|T|R|SWF?)\s+/gi;let $r;for(;($r=Fr.exec(Lr))!==null;){const Vr=$r[1],Gr=$r[2].trim(),Jr=$r[3].trim(),ms=$r[4];if(Gr==="NAME"||Gr==="ID"||Jr==="ROLE"||Jr==="CHARACTER")continue;const ls=Lr.slice($r.index+$r[0].length,$r.index+200),ds=/(\d{1,2}:\d{2})/g,bs=ls.match(ds)||[];Mr.push({id:Vr,name:Gr,character:Jr,status:ms,callTime:bs[0]||"",makeupCall:bs[1]||void 0,costumeCall:bs[2]||void 0,hmuCall:bs[3]||void 0,onSetTime:bs[4]||void 0})}debugLog("Extracted cast calls:",Mr.length),Mr.length>0&&debugLog("Sample cast call:",Mr[0])}return Qr.forEach((Lr,Fr)=>{const $r=ts.indexOf(Lr.sceneNumber);if($r>=0){const Gr=ts.slice($r,$r+500).match(/(?:CAST|cast)?[:\s]*(\d+(?:\s*,\s*\d+)+)/);if(Gr){const Jr=Gr[1].split(/\s*,\s*/).map(ms=>ms.trim());Qr[Fr]={...Lr,cast:Jr},debugLog(`Scene ${Lr.sceneNumber} cast:`,Jr)}}}),{id:v4(),date:pr,productionDay:ur,totalProductionDays:dr,unitCallTime:fr,breakfastTime:br,lunchTime:wr,cameraWrapEstimate:yr,wrapEstimate:vr,weather:Rr,preCalls:Tr,unitBase:Wr,scenes:Qr,castCalls:Mr,supportingArtists:[],uploadedAt:new Date,pdfUri:or,rawText:ar}}async function parseCallSheetPDF(ar){const or=await new Promise(cr=>{const ur=new FileReader;ur.onload=()=>cr(ur.result),ur.readAsDataURL(ar)}),lr=await extractTextFromPDF$1(ar);return parseCallSheetText(lr,or)}function timeToMinutes(ar){if(!ar)return 0;const[or,lr]=ar.split(":").map(Number);return isNaN(or)||isNaN(lr)?0:or*60+lr}function minutesToTime(ar){const or=(ar%1440+1440)%1440,lr=Math.floor(or/60),cr=or%60;return`${lr.toString().padStart(2,"0")}:${cr.toString().padStart(2,"0")}`}function timeDiffHours(ar,or){if(!ar||!or)return 0;let lr=timeToMinutes(ar),cr=timeToMinutes(or);return cr<lr&&(cr+=24*60),(cr-lr)/60}function addHoursToTime(ar,or){const lr=timeToMinutes(ar)+or*60;return minutesToTime(lr)}const BASE_CONTRACTS={"10+1":{baseWorkHours:10,label:"10+1 (10 hours + 1hr lunch)"},"11+1":{baseWorkHours:11,label:"11+1 (11 hours + 1hr lunch)"}},DAY_TYPES$1={SWD:{name:"Standard Working Day",lunchMins:60,hourReduction:0},SCWD:{name:"Semi-Continuous Working Day",lunchMins:30,hourReduction:.5},CWD:{name:"Continuous Working Day",lunchMins:0,hourReduction:1}};function getContractedWorkHours(ar,or){const lr=BASE_CONTRACTS[ar].baseWorkHours,cr=DAY_TYPES$1[or].hourReduction;return lr-cr}function getLunchDuration(ar){return DAY_TYPES$1[ar].lunchMins}function getHourlyRate(ar,or,lr){const cr=getContractedWorkHours(or,lr);return cr<=0?0:ar/cr}function calculatePreCall(ar,or,lr,cr=1.5){if(!ar||!or)return{hours:0,pay:0};const ur=timeDiffHours(ar,or);return ur<=0?{hours:0,pay:0}:{hours:ur,pay:ur*(lr*cr)}}function calculateOvertime(ar,or,lr,cr=1.5){const ur=Math.max(0,ar-or),dr=lr*cr;return{hours:ur,pay:ur*dr}}function calculateBrokenLunch(ar,or,lr,cr,ur=1.5){if(lr==="CWD"||!or||!ar)return{hours:0,pay:0};const dr=addHoursToTime(ar,6),hr=timeToMinutes(or),pr=timeToMinutes(dr);if(hr<=pr)return{hours:0,pay:0};const xr=timeDiffHours(dr,or),mr=cr*ur;return{hours:xr,pay:xr*mr}}function calculateBrokenTurnaround(ar,or,lr,cr,ur=1.5,dr=11){if(!ar||!lr)return{hours:0,pay:0};let pr=timeDiffHours(ar,or||lr);if(pr<0&&(pr+=24),pr>=dr)return{hours:0,pay:0};const xr=dr-pr,mr=cr*ur;return{hours:xr,pay:xr*mr}}function calculateLateNight(ar,or,lr,cr,ur,dr=2,hr="23:00"){if(!or||!ar)return{hours:0,pay:0};const pr=timeToMinutes(or),xr=timeToMinutes(hr);let mr=pr;if(pr<timeToMinutes(ar)&&(mr=pr+24*60),mr<=xr&&pr>=timeToMinutes(ar))return{hours:0,pay:0};let fr;mr>xr,fr=mr-xr;let Er=fr/60;if(lr){const gr=timeToMinutes(lr);(gr>xr||gr<timeToMinutes(ar))&&(Er-=cr/60)}Er=Math.max(0,Er);const vr=ur*(dr-1);return{hours:Er,pay:Er*vr}}function applyDayMultiplier(ar,or,lr,cr=1.5,ur=2){return lr?{multiplier:ur,total:ar*ur}:or?{multiplier:cr,total:ar*cr}:{multiplier:1,total:ar}}function calculateBECTUTimesheet(ar){if(!ar.unitCallTime||!ar.wrapOutTime)return createEmptyCalculation$1();const or=getContractedWorkHours(ar.baseContract,ar.dayType),lr=getHourlyRate(ar.dayRate,ar.baseContract,ar.dayType),cr=lr*ar.otMultiplier,ur=ar.preCallTime||ar.unitCallTime,dr=timeDiffHours(ur,ar.wrapOutTime),hr=ar.lunchDuration/60,pr=Math.max(0,dr-hr),xr=calculatePreCall(ar.preCallTime,ar.unitCallTime,lr,ar.preCallMultiplier),mr=timeDiffHours(ar.unitCallTime,ar.wrapOutTime)-hr,fr=calculateOvertime(Math.max(0,mr),or,lr,ar.otMultiplier),Er=calculateBrokenLunch(ar.unitCallTime,ar.lunchTime,ar.dayType,lr,ar.otMultiplier),vr=calculateBrokenTurnaround(ar.previousWrapOut,ar.preCallTime,ar.unitCallTime,lr,ar.otMultiplier),gr=calculateLateNight(ar.unitCallTime,ar.wrapOutTime,ar.lunchTime,ar.lunchDuration,lr,ar.lateNightMultiplier),yr=ar.dayRate,jr=yr+xr.pay+fr.pay+Er.pay+vr.pay+gr.pay,br=applyDayMultiplier(jr,ar.is6thDay,ar.is7thDay,ar.sixthDayMultiplier,ar.seventhDayMultiplier);return{contractedHours:round2(or),hourlyRate:round2(lr),otRate:round2(cr),actualWorkHours:round2(pr),preCallHours:round2(xr.hours),overtimeHours:round2(fr.hours),brokenLunchHours:round2(Er.hours),brokenTurnaroundHours:round2(vr.hours),lateNightHours:round2(gr.hours),basePay:round2(yr),preCallPay:round2(xr.pay),overtimePay:round2(fr.pay),brokenLunchPay:round2(Er.pay),brokenTurnaroundPay:round2(vr.pay),lateNightPay:round2(gr.pay),subtotal:round2(jr),dayMultiplier:br.multiplier,totalPay:round2(br.total),hasBrokenLunch:Er.hours>0,hasBrokenTurnaround:vr.hours>0,hasLateNight:gr.hours>0,hasOvertime:fr.hours>0}}function createEmptyCalculation$1(){return{contractedHours:0,hourlyRate:0,otRate:0,actualWorkHours:0,preCallHours:0,overtimeHours:0,brokenLunchHours:0,brokenTurnaroundHours:0,lateNightHours:0,basePay:0,preCallPay:0,overtimePay:0,brokenLunchPay:0,brokenTurnaroundPay:0,lateNightPay:0,subtotal:0,dayMultiplier:1,totalPay:0,hasBrokenLunch:!1,hasBrokenTurnaround:!1,hasLateNight:!1,hasOvertime:!1}}function round2(ar){return Math.round(ar*100)/100}function baseDayHoursToContract(ar){return ar===10?"10+1":"11+1"}function createEmptyCalculation(){return{contractedHours:0,hourlyRate:0,otRate:0,preCallHours:0,preCallEarnings:0,workingHours:0,actualWorkHours:0,baseHours:0,otHours:0,brokenLunchHours:0,brokenTurnaroundHours:0,lateNightHours:0,totalHours:0,dailyEarnings:0,basePay:0,otEarnings:0,overtimePay:0,brokenLunchPay:0,brokenTurnaroundPay:0,lateNightEarnings:0,lateNightPay:0,sixthDayBonus:0,seventhDayBonus:0,dayMultiplier:1,subtotal:0,kitRental:0,totalEarnings:0,totalPay:0,brokenLunch:!1,hasBrokenLunch:!1,brokenTurnaround:!1,hasBrokenTurnaround:!1,hasLateNight:!1,hasOvertime:!1}}function toBECTUEntry(ar,or,lr){const cr=or.baseContract||baseDayHoursToContract(or.baseDayHours);return{date:ar.date,dayRate:or.dailyRate,baseContract:cr,dayType:ar.dayType,preCallTime:ar.preCall||null,unitCallTime:ar.unitCall,lunchTime:ar.lunchStart||ar.callSheetLunch||null,lunchDuration:ar.lunchTaken||getLunchDuration(ar.dayType),wrapOutTime:ar.wrapOut,is6thDay:ar.isSixthDay,is7thDay:ar.isSeventhDay,previousWrapOut:ar.previousWrapOut||lr||null,preCallMultiplier:or.preCallMultiplier,otMultiplier:or.otMultiplier,lateNightMultiplier:or.lateNightMultiplier,sixthDayMultiplier:or.sixthDayMultiplier,seventhDayMultiplier:or.seventhDayMultiplier}}function formatDateString(ar){return ar.toISOString().split("T")[0]}function addDays(ar,or){const lr=new Date(ar);return lr.setDate(lr.getDate()+or),formatDateString(lr)}function getWeekStart(ar){const or=new Date(ar),lr=or.getDay(),cr=or.getDate()-lr+(lr===0?-6:1);return or.setDate(cr),formatDateString(or)}const useTimesheetStore=create()(persist((ar,or)=>({rateCard:createDefaultRateCard(),entries:{},selectedDate:formatDateString(new Date),viewMode:"week",editingEntry:!1,updateRateCard:lr=>{ar(cr=>({rateCard:{...cr.rateCard,...lr}}))},getEntry:lr=>or().entries[lr]||createEmptyTimesheetEntry(lr),saveEntry:lr=>{ar(cr=>({entries:{...cr.entries,[lr.date]:lr}}))},deleteEntry:lr=>{ar(cr=>{const ur={...cr.entries};return delete ur[lr],{entries:ur}})},clearAll:()=>{ar({rateCard:createDefaultRateCard(),entries:{},selectedDate:formatDateString(new Date),viewMode:"week",editingEntry:!1})},setSelectedDate:lr=>ar({selectedDate:lr}),setViewMode:lr=>ar({viewMode:lr}),setEditingEntry:lr=>ar({editingEntry:lr}),navigateDay:lr=>{const cr=or(),ur=addDays(cr.selectedDate,lr==="next"?1:-1);ar({selectedDate:ur})},autoFillFromCallSheet:(lr,cr)=>{var mr;const ur=or().entries[lr]||createEmptyTimesheetEntry(lr),dr=parseDayTypeFromString(cr.dayType),hr=getLunchDurationForDayType(dr),pr=((mr=cr.preCalls)==null?void 0:mr.hmu)||"";return{...ur,preCall:pr||ur.preCall,unitCall:cr.unitCallTime||ur.unitCall,dayType:dr,wrapOut:ur.wrapOut||"",outOfChair:ur.outOfChair||"",lunchTaken:hr,productionDay:cr.productionDay,autoFilledFrom:cr.id,callSheetUnitCall:cr.unitCallTime,callSheetLunch:cr.lunchTime,callSheetWrap:cr.wrapEstimate}},calculateEntry:(lr,cr)=>{const{rateCard:ur}=or();if(!lr.unitCall||!lr.wrapOut)return createEmptyCalculation();const dr=toBECTUEntry(lr,ur,cr),hr=calculateBECTUTimesheet(dr);let pr=0,xr=0;lr.isSeventhDay?xr=hr.subtotal*(ur.seventhDayMultiplier-1):lr.isSixthDay&&(pr=hr.subtotal*(ur.sixthDayMultiplier-1));const mr=ur.kitRental,fr=hr.totalPay+mr;return{contractedHours:hr.contractedHours,hourlyRate:hr.hourlyRate,otRate:hr.otRate,preCallHours:hr.preCallHours,workingHours:hr.actualWorkHours,actualWorkHours:hr.actualWorkHours,baseHours:hr.contractedHours,otHours:hr.overtimeHours,brokenLunchHours:hr.brokenLunchHours,brokenTurnaroundHours:hr.brokenTurnaroundHours,lateNightHours:hr.lateNightHours,totalHours:hr.actualWorkHours+hr.preCallHours,preCallEarnings:hr.preCallPay,dailyEarnings:hr.basePay,basePay:hr.basePay,otEarnings:hr.overtimePay,overtimePay:hr.overtimePay,brokenLunchPay:hr.brokenLunchPay,brokenTurnaroundPay:hr.brokenTurnaroundPay,lateNightEarnings:hr.lateNightPay,lateNightPay:hr.lateNightPay,sixthDayBonus:Math.round(pr*100)/100,seventhDayBonus:Math.round(xr*100)/100,dayMultiplier:hr.dayMultiplier,subtotal:hr.subtotal,kitRental:mr,totalEarnings:Math.round(fr*100)/100,totalPay:Math.round(fr*100)/100,brokenLunch:hr.hasBrokenLunch,hasBrokenLunch:hr.hasBrokenLunch,brokenTurnaround:hr.hasBrokenTurnaround,hasBrokenTurnaround:hr.hasBrokenTurnaround,hasLateNight:hr.hasLateNight,hasOvertime:hr.hasOvertime}},getPreviousWrapOut:lr=>{const cr=addDays(lr,-1),ur=or().entries[cr];return(ur==null?void 0:ur.wrapOut)||void 0},getWeekSummary:lr=>{const cr=or(),ur=[];for(let Nr=0;Nr<7;Nr++){const Cr=addDays(lr,Nr);cr.entries[Cr]&&ur.push(cr.entries[Cr])}let dr=0,hr=0,pr=0,xr=0,mr=0,fr=0,Er=0,vr=0,gr=0,yr=0,jr=0,br=0,_r=0,wr=0,Rr=0,Ar=0,Sr=0;const kr=[...ur].sort((Nr,Cr)=>Nr.date.localeCompare(Cr.date));return kr.forEach((Nr,Cr)=>{const Tr=Cr>0?kr[Cr-1].wrapOut:cr.getPreviousWrapOut(Nr.date),Pr=cr.calculateEntry(Nr,Tr);dr+=Pr.totalHours,hr+=Pr.preCallHours,pr+=Pr.baseHours,xr+=Pr.otHours,mr+=Pr.lateNightHours,fr+=Pr.brokenLunchHours,Er+=Pr.brokenTurnaroundHours,Nr.isSixthDay&&!Nr.isSeventhDay&&(vr+=Pr.totalHours),Nr.isSeventhDay&&(gr+=Pr.totalHours),yr+=Pr.totalEarnings,br+=Pr.basePay,_r+=Pr.overtimePay,wr+=Pr.preCallEarnings,Rr+=Pr.brokenLunchPay,Ar+=Pr.brokenTurnaroundPay,Sr+=Pr.lateNightPay,Nr.unitCall&&Nr.wrapOut&&(jr+=cr.rateCard.kitRental)}),{startDate:lr,endDate:addDays(lr,6),totalHours:Math.round(dr*10)/10,preCallHours:Math.round(hr*10)/10,baseHours:Math.round(pr*10)/10,otHours:Math.round(xr*10)/10,sixthDayHours:Math.round(vr*10)/10,seventhDayHours:Math.round(gr*10)/10,lateNightHours:Math.round(mr*10)/10,brokenLunchHours:Math.round(fr*10)/10,brokenTurnaroundHours:Math.round(Er*10)/10,kitRentalTotal:jr,totalEarnings:Math.round(yr*100)/100,entries:ur,basePay:Math.round(br*100)/100,overtimePay:Math.round(_r*100)/100,preCallPay:Math.round(wr*100)/100,brokenLunchPay:Math.round(Rr*100)/100,brokenTurnaroundPay:Math.round(Ar*100)/100,lateNightPay:Math.round(Sr*100)/100}},getMonthEntries:(lr,cr)=>{const ur=or(),dr=[],hr=new Date(lr,cr,1),pr=new Date(lr,cr+1,0),xr=new Date(hr);for(;xr<=pr;){const mr=formatDateString(xr);ur.entries[mr]&&dr.push(ur.entries[mr]),xr.setDate(xr.getDate()+1)}return dr}}),{name:"hair-makeup-timesheet-storage",storage:createHybridStorage("hair-makeup-timesheet-storage"),merge:(ar,or)=>({...or,...ar,entries:{...or.entries,...(ar==null?void 0:ar.entries)||{}}})})),STORE_VERSION=2;function validateCallSheet(ar){return!ar.id||!ar.date||!Array.isArray(ar.scenes)?!1:ar.scenes.length>50?(console.warn(`Call sheet ${ar.id} has ${ar.scenes.length} scenes - possible data corruption`),!1):!0}const useCallSheetStore=create()(persist((ar,or)=>({callSheets:[],activeCallSheetId:null,isUploading:!1,uploadError:null,uploadCallSheet:async lr=>{ar({isUploading:!0,uploadError:null});try{const cr=await parseCallSheetPDF(lr),ur={...cr,scenes:[...cr.scenes]},dr=or().callSheets.find(xr=>xr.date===ur.date||xr.productionDay===ur.productionDay),hr=xr=>{if(xr.date){const mr=useTimesheetStore.getState(),fr=mr.autoFillFromCallSheet(xr.date,xr);mr.saveEntry(fr)}},pr=xr=>{const mr=useProjectStore.getState(),fr=mr.currentProject;fr!=null&&fr.scenes&&xr.scenes.forEach(Er=>{if(!Er.action)return;const vr=fr.scenes.find(gr=>gr.sceneNumber===Er.sceneNumber);vr&&!vr.synopsis&&mr.updateSceneSynopsis(vr.id,Er.action)})};if(dr){const xr={...ur,id:dr.id};return ar(mr=>({callSheets:mr.callSheets.map(fr=>fr.id===dr.id?xr:fr),isUploading:!1,activeCallSheetId:dr.id})),hr(xr),pr(xr),xr}return ar(xr=>({callSheets:[...xr.callSheets,ur].sort((mr,fr)=>mr.productionDay-fr.productionDay),isUploading:!1,activeCallSheetId:ur.id})),hr(ur),pr(ur),ur}catch(cr){const ur=cr instanceof Error?cr.message:"Failed to parse call sheet";throw ar({isUploading:!1,uploadError:ur}),cr}},setActiveCallSheet:lr=>{ar({activeCallSheetId:lr})},getActiveCallSheet:()=>{const lr=or();return lr.activeCallSheetId?lr.callSheets.find(cr=>cr.id===lr.activeCallSheetId)||null:[...lr.callSheets].sort((ur,dr)=>new Date(dr.date).getTime()-new Date(ur.date).getTime())[0]||null},getCallSheetByDate:lr=>or().callSheets.find(cr=>cr.date===lr)||null,getCallSheetByDay:lr=>or().callSheets.find(cr=>cr.productionDay===lr)||null,deleteCallSheet:lr=>{ar(cr=>({callSheets:cr.callSheets.filter(ur=>ur.id!==lr),activeCallSheetId:cr.activeCallSheetId===lr?null:cr.activeCallSheetId}))},updateSceneStatus:(lr,cr,ur)=>{ar(dr=>({callSheets:dr.callSheets.map(hr=>hr.id!==lr?hr:{...hr,scenes:hr.scenes.map(pr=>pr.sceneNumber===cr?{...pr,status:ur,completedAt:ur==="wrapped"?new Date().toISOString():pr.completedAt}:pr)})}))},updateSceneFilmingStatus:(lr,cr,ur,dr)=>{ar(hr=>({callSheets:hr.callSheets.map(pr=>pr.id!==lr?pr:{...pr,scenes:pr.scenes.map(xr=>xr.sceneNumber===cr?{...xr,filmingStatus:ur,filmingNotes:dr,status:"wrapped",completedAt:new Date().toISOString()}:xr)})}))},clearAll:()=>{ar({callSheets:[],activeCallSheetId:null})}}),{name:"hair-makeup-callsheets",version:STORE_VERSION,storage:createHybridStorage("hair-makeup-callsheets"),partialize:ar=>({callSheets:ar.callSheets,activeCallSheetId:ar.activeCallSheetId}),migrate:(ar,or)=>{const lr=ar;if(or<STORE_VERSION){console.log(`Migrating call sheet store from version ${or} to ${STORE_VERSION}`);const cr=(lr.callSheets||[]).filter(validateCallSheet);return cr.length!==(lr.callSheets||[]).length&&console.warn("Removed corrupted call sheet data during migration"),{callSheets:cr,activeCallSheetId:lr.activeCallSheetId||null,isUploading:!1,uploadError:null}}return lr},merge:(ar,or)=>{const lr=ar,cr=(lr.callSheets||[]).filter(validateCallSheet);return{...or,callSheets:cr,activeCallSheetId:lr.activeCallSheetId||null}}}));function formatDuration(ar){if(ar<60)return`${ar}m`;const or=Math.floor(ar/60),lr=ar%60;return lr===0?`${or}hr`:`${or}hr ${lr}m`}function splitCombinedSceneNumber(ar){const or=new Set;or.add(ar),ar.split(/[\/]/).map(pr=>pr.trim()).filter(Boolean).forEach(pr=>or.add(pr)),ar.split(/[,]/).map(pr=>pr.trim()).filter(Boolean).forEach(pr=>or.add(pr));const ur=ar.match(/^(\d+[A-Za-z]?)(?:pt|part|PT|PART|-|\s)/i);ur&&or.add(ur[1]);const dr=ar.match(/^(\d+)/);dr&&dr[1]!==ar&&or.add(dr[1]);const hr=[...or];for(const pr of hr){const xr=pr.match(/^(\d+)[A-Za-z]$/);xr&&or.add(xr[1])}return[...or]}function Today({onSceneSelect:ar,onNavigateToTab:or}){var ss;const{currentProject:lr,updateSceneFilmingStatus:cr,addScene:ur,addCharacterToScene:dr,addCharacterFromScene:hr,setCurrentCharacter:pr}=useProjectStore(),xr=useCallSheetStore(Ur=>Ur.callSheets),mr=useCallSheetStore(Ur=>Ur.activeCallSheetId),fr=useCallSheetStore(Ur=>Ur.getCallSheetByDate),Er=useCallSheetStore(Ur=>Ur.uploadCallSheet),vr=useCallSheetStore(Ur=>Ur.isUploading),gr=useCallSheetStore(Ur=>Ur.uploadError),yr=useCallSheetStore(Ur=>Ur.updateSceneStatus),[jr,br]=reactExports.useState(new Date),[_r,wr]=reactExports.useState(!1),[Rr,Ar]=reactExports.useState(!1),[Sr,kr]=reactExports.useState(new Map),Nr=reactExports.useMemo(()=>{const Ur=jr.toISOString().split("T")[0];return fr(Ur)},[jr,fr,xr]),Cr=reactExports.useMemo(()=>mr?xr.find(Ur=>Ur.id===mr)||null:[...xr].sort((Xr,cs)=>new Date(cs.date).getTime()-new Date(Xr.date).getTime())[0]||null,[xr,mr]),Tr=Nr||Cr,Pr=reactExports.useMemo(()=>Tr?Sr.size===0?Tr:{...Tr,scenes:Tr.scenes.map(Ur=>{const Xr=Sr.get(Ur.sceneNumber);return Xr?{...Ur,...Xr}:Ur})}:null,[Tr,Sr]);reactExports.useEffect(()=>{kr(new Map)},[Tr==null?void 0:Tr.id]),reactExports.useEffect(()=>{Cr!=null&&Cr.date&&br(new Date(Cr.date))},[Cr==null?void 0:Cr.id,Cr==null?void 0:Cr.date]);const[Ir,Br]=reactExports.useState(null),[Wr,Yr]=reactExports.useState(null),es=reactExports.useRef(null),ps=async Ur=>{var cs;const Xr=(cs=Ur.target.files)==null?void 0:cs[0];if(Xr&&Xr.type==="application/pdf")try{await Er(Xr)}catch(xs){console.error("Failed to upload call sheet:",xs)}es.current&&(es.current.value="")},ts=Ur=>{const Xr=new Date(jr);Xr.setDate(Xr.getDate()+Ur),br(Xr),kr(new Map)},Qr=reactExports.useMemo(()=>{if(!Pr)return[];if(_r)return[...Pr.scenes].sort((Xr,cs)=>Xr.shootOrder-cs.shootOrder);const Ur={"in-progress":0,upcoming:1,wrapped:2};return[...Pr.scenes].sort((Xr,cs)=>{const xs=Ur[Xr.status]-Ur[cs.status];return xs!==0?xs:Xr.shootOrder-cs.shootOrder})},[Pr,_r]),Hr=(Ur,Xr)=>{if(!Pr)return;const cs=[...Pr.scenes].sort((Hs,Us)=>Hs.shootOrder-Us.shootOrder),xs=cs.findIndex(Hs=>Hs.sceneNumber===Ur);if(xs===-1||Xr==="up"&&xs===0||Xr==="down"&&xs===cs.length-1)return;const Es=Xr==="up"?xs-1:xs+1,Ns=cs[xs].shootOrder,Ts=cs[Es].shootOrder,gs=cs[Es].sceneNumber;kr(Hs=>{const Us=new Map(Hs),xa=Us.get(Ur)||{},Gs=Us.get(gs)||{};return Us.set(Ur,{...xa,shootOrder:Ts}),Us.set(gs,{...Gs,shootOrder:Ns}),Us})},Kr=reactExports.useMemo(()=>lr?new Map(lr.scenes.map(Ur=>[Ur.sceneNumber,Ur])):new Map,[lr==null?void 0:lr.scenes]),rs=reactExports.useMemo(()=>lr?new Map(lr.characters.map(Ur=>[Ur.id,Ur])):new Map,[lr==null?void 0:lr.characters]),Mr=reactExports.useMemo(()=>{if(!lr)return new Map;const Ur=new Map;for(const Xr of lr.scenes){const cs=Xr.characters.map(xs=>rs.get(xs)).filter(xs=>xs!==void 0);Ur.set(Xr.sceneNumber,cs)}return Ur},[lr==null?void 0:lr.scenes,rs]),Dr=reactExports.useMemo(()=>{if(!lr)return new Map;const Ur=new Map;for(const Xr of lr.looks)for(const cs of Xr.scenes)Ur.set(`${Xr.characterId}-${cs}`,Xr);return Ur},[lr==null?void 0:lr.looks]),Lr=reactExports.useMemo(()=>{if(!lr)return new Map;const Ur=new Map;for(const Xr of lr.looks){const cs=rs.get(Xr.characterId);if(cs!=null&&cs.actorNumber)for(const xs of Xr.scenes)Ur.set(`${cs.actorNumber}-${xs}`,Xr)}return Ur},[lr==null?void 0:lr.looks,rs]),Fr=reactExports.useMemo(()=>Pr!=null&&Pr.castCalls?new Map(Pr.castCalls.map(Ur=>[Ur.id,Ur])):new Map,[Pr==null?void 0:Pr.castCalls]),$r=reactExports.useMemo(()=>{if(!Pr)return new Map;const Ur=new Map;for(const Xr of Pr.scenes){if(!Xr.cast||Xr.cast.length===0)continue;const cs=[];for(const xs of Xr.cast){const Es=Fr.get(xs);if(Es){const Ns=Es.character||Es.name||`Cast #${xs}`,Ts=Ns.split(" ").map(gs=>gs.charAt(0).toUpperCase()).join("").slice(0,2);cs.push({id:`cast-${xs}`,name:Ns,initials:Ts,actorNumber:parseInt(xs,10)||void 0})}else cs.push({id:`cast-${xs}`,name:`Cast #${xs}`,initials:xs.slice(0,2),actorNumber:parseInt(xs,10)||void 0})}Ur.set(Xr.sceneNumber,cs)}return Ur},[Pr==null?void 0:Pr.scenes,Fr]),Vr=Ur=>{const Xr=Kr.get(Ur);if(Xr)return Xr;const cs=splitCombinedSceneNumber(Ur);for(const xs of cs){const Es=Kr.get(xs);if(Es)return Es}},Gr=Ur=>{if(!lr||!Ur)return;const Xr=Ur.toUpperCase().trim(),cs=lr.characters.find(Ts=>Ts.name.toUpperCase().trim()===Xr);if(cs)return cs;const xs=lr.characters.find(Ts=>Ts.name.toUpperCase().trim().split(" ")[0]===Xr);if(xs)return xs;const Es=lr.characters.find(Ts=>Ts.name.toUpperCase().trim().startsWith(Xr+" "));if(Es)return Es;const Ns=lr.characters.find(Ts=>{const gs=Ts.name.toUpperCase().trim().split(" ")[0];return Xr.includes(gs)&&gs.length>2});if(Ns)return Ns},Jr=Ur=>{const Xr=Mr.get(Ur)||[];if(Xr.length>0)return Xr;const cs=splitCombinedSceneNumber(Ur);for(const Es of cs){const Ns=Mr.get(Es)||[];if(Ns.length>0)return Ns}const xs=$r.get(Ur)||[];return xs.length>0?xs.map(Es=>{const Ns=Gr(Es.name);return Ns?{...Ns,actorNumber:Es.actorNumber}:Es}):[]},ms=(Ur,Xr,cs)=>{const xs=splitCombinedSceneNumber(Xr);for(const Es of xs){const Ns=Dr.get(`${Ur}-${Es}`);if(Ns)return Ns}if(cs)for(const Es of xs){const Ns=Lr.get(`${cs}-${Es}`);if(Ns)return Ns}if(lr&&!Ur.startsWith("cast-"))return lr.looks.find(Es=>Es.characterId===Ur)},ls=reactExports.useMemo(()=>Pr!=null&&Pr.castCalls?Pr.castCalls.filter(Ur=>Ur.hmuCall||Ur.makeupCall).sort((Ur,Xr)=>{const cs=Ur.hmuCall||Ur.makeupCall||"",xs=Xr.hmuCall||Xr.makeupCall||"";return cs.localeCompare(xs)}):[],[Pr==null?void 0:Pr.castCalls]),ds=reactExports.useMemo(()=>{if(!(Pr!=null&&Pr.scenes)||!Pr.firstShotTime)return null;const Ur=Gs=>{const $a=Gs.match(/(\d{1,2}):(\d{2})/);return $a?parseInt($a[1],10)*60+parseInt($a[2],10):null},Xr=[...Pr.scenes].sort((Gs,$a)=>Gs.shootOrder-$a.shootOrder),cs=Xr.filter(Gs=>Gs.status==="wrapped"&&Gs.completedAt);if(cs.length===0)return{status:"not-started",completedCount:0,totalCount:Pr.scenes.length};const xs=cs[cs.length-1];let Es=null;if(xs.estimatedTime){const Gs=xs.estimatedTime.match(/-\s*(\d{1,2}:\d{2})/);Gs&&(Es=Ur(Gs[1]))}const Ns=new Date(xs.completedAt),Ts=Ns.getHours()*60+Ns.getMinutes();if(Es!==null&&Ts<Es-2)return{status:"ahead",diffMinutes:Es-Ts,completedCount:cs.length,totalCount:Pr.scenes.length};const gs=Xr.find(Gs=>Gs.status!=="wrapped");if(!gs)return{status:"completed",completedCount:cs.length,totalCount:Pr.scenes.length};let Hs=null;if(gs.estimatedTime){const Gs=gs.estimatedTime.match(/^(\d{1,2}:\d{2})/);Gs&&(Hs=Ur(Gs[1]))}if(Hs===null)return{status:"unknown",completedCount:cs.length,totalCount:Pr.scenes.length};const Us=new Date,xa=Us.getHours()*60+Us.getMinutes();return xa>Hs+2?{status:"behind",diffMinutes:xa-Hs,completedCount:cs.length,totalCount:Pr.scenes.length}:{status:"on-track",completedCount:cs.length,totalCount:Pr.scenes.length}},[Pr==null?void 0:Pr.scenes,Pr==null?void 0:Pr.firstShotTime]),bs=(Ur,Xr)=>{Tr&&(kr(cs=>{const xs=new Map(cs),Es=xs.get(Ur)||{};return xs.set(Ur,{...Es,status:Xr}),xs}),yr(Tr.id,Ur,Xr))},ws=(Ur,Xr,cs)=>{Tr&&(kr(xs=>{const Es=new Map(xs),Ns=Es.get(Ur)||{};return Es.set(Ur,{...Ns,status:"wrapped"}),Es}),yr(Tr.id,Ur,"wrapped"),cr(Ur,Xr,cs))},Is=Ur=>{const Xr=Vr(Ur);Xr&&ar(Xr.id)},ys=(Ur,Xr,cs)=>{const xs=Ur.id.startsWith("cast-"),Es=Vr(Xr);if(Es){if(xs){const Ts=hr(Es.id,Ur.name);if(Ur.actorNumber){const gs=useProjectStore.getState();if(gs.currentProject){const Hs=gs.currentProject.characters.map(Us=>Us.id===Ts.id?{...Us,actorNumber:Ur.actorNumber}:Us);useProjectStore.setState({currentProject:{...gs.currentProject,characters:Hs}})}}dr(Es.id,Ts.id),pr(Ts.id)}else pr(Ur.id);ar(Es.id);return}const Ns=[];if(lr){const Ts=splitCombinedSceneNumber(Xr);for(const gs of lr.scenes){const Hs=splitCombinedSceneNumber(gs.sceneNumber);Ts.some(xa=>Hs.some(Gs=>Gs===xa||Gs.startsWith(xa)||xa.startsWith(Gs)))&&!Ns.includes(gs)&&Ns.push(gs)}}if(xs){let Ts=Ur;if(lr){const gs=Gr(Ur.name);gs&&(Ts=gs)}Yr({sceneNumber:Xr,character:Ts,callSheetScene:cs,suggestedMergeScenes:Ns});return}Yr({sceneNumber:Xr,character:Ur,callSheetScene:cs,suggestedMergeScenes:Ns})};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("input",{ref:es,type:"file",accept:".pdf",onChange:ps,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ts(-1),className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:formatShortDate(jr)}),jsxRuntimeExports.jsx("button",{onClick:()=>ts(1),className:"p-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{var Ur;return(Ur=es.current)==null?void 0:Ur.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:vr,title:"Upload call sheet",children:vr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),Pr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>wr(!_r),className:clsx("p-2 rounded-lg transition-colors touch-manipulation",_r?"bg-gold text-white":"text-text-muted hover:text-gold"),title:_r?"Done reordering":"Reorder scenes",children:_r?jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})}),jsxRuntimeExports.jsxs("button",{onClick:()=>or==null?void 0:or("callsheets"),className:"flex items-center gap-1.5 px-2.5 py-1 text-xs font-semibold rounded-full bg-gold-100 text-gold active:bg-gold-200 transition-colors",title:"View call sheet PDF",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Day ",Pr.productionDay]})]})]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 space-y-4",children:[gr&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:gr})}),Pr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-3",children:jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"CALL TIMES"})}),(()=>{const Ur=parseDayTypeFromString(Pr.dayType);return jsxRuntimeExports.jsxs("div",{className:"mb-3 pb-3 border-b border-border/50 flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:clsx("px-2 py-0.5 text-xs font-bold rounded",Ur==="CWD"&&"bg-amber-100 text-amber-700",Ur==="SCWD"&&"bg-orange-100 text-orange-700",Ur==="SWD"&&"bg-blue-100 text-blue-700"),children:Ur}),ds&&(ds.status==="ahead"||ds.status==="behind")&&jsxRuntimeExports.jsxs("div",{className:clsx("flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium",ds.status==="ahead"&&"bg-blue-50 text-blue-600",ds.status==="behind"&&"bg-red-50 text-red-600"),children:[ds.status==="ahead"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 10l7-7m0 0l7 7m-7-7v18"})}),jsxRuntimeExports.jsxs("span",{children:[formatDuration(ds.diffMinutes)," ahead"]})]}),ds.status==="behind"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}),jsxRuntimeExports.jsxs("span",{children:[formatDuration(ds.diffMinutes)," behind"]})]})]})]})})(),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Unit Call"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Pr.unitCallTime})]}),((ss=Pr.preCalls)==null?void 0:ss.hmu)&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"HMU Pre-call"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-gold",children:Pr.preCalls.hmu})]}),Pr.firstShotTime&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"First Shot"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Pr.firstShotTime})]}),Pr.lunchTime&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Lunch"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Pr.lunchTime})]}),Pr.cameraWrapEstimate&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Camera Wrap"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Pr.cameraWrapEstimate})]}),Pr.wrapEstimate&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Est. Wrap"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Pr.wrapEstimate})]})]})]}),ls.length>0&&jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Ar(!Rr),className:"w-full flex items-center justify-between touch-manipulation",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"HMU CALLS"}),jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-semibold rounded-full bg-gold-100 text-gold",children:ls.length})]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 text-text-muted transition-transform",Rr&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),Rr&&jsxRuntimeExports.jsx("div",{className:"space-y-2 mt-3 pt-3 border-t border-border/30",children:ls.map(Ur=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-border/30 last:border-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary truncate block",children:Ur.character}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate block",children:Ur.name})]}),jsxRuntimeExports.jsxs("div",{className:"text-right ml-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-gold",children:Ur.hmuCall||Ur.makeupCall}),Ur.onSetTime&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:["On set: ",Ur.onSetTime]})]})]},Ur.id))})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between",children:jsxRuntimeExports.jsxs("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:["TODAY'S SCENES (",Qr.length,")"]})}),_r&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Drag to reorder shooting schedule"}),jsxRuntimeExports.jsx("button",{onClick:()=>wr(!1),className:"text-sm font-medium text-gold",children:"Done"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2.5",children:Qr.map((Ur,Xr)=>{const cs=Vr(Ur.sceneNumber),xs=Jr(Ur.sceneNumber);return jsxRuntimeExports.jsx(TodaySceneCard,{shootingScene:Ur,scene:cs,characters:xs,getLookForCharacter:ms,onTap:()=>Is(Ur.sceneNumber),onCharacterTap:Es=>ys(Es,Ur.sceneNumber,Ur),onSynopsisClick:Es=>Br(Es),onStatusChange:Es=>bs(Ur.sceneNumber,Es),onFilmingStatusChange:(Es,Ns)=>ws(Ur.sceneNumber,Es,Ns),isReorderMode:_r,isFirst:Xr===0,isLast:Xr===Qr.length-1,onMoveUp:()=>Hr(Ur.sceneNumber,"up"),onMoveDown:()=>Hr(Ur.sceneNumber,"down")},Ur.sceneNumber)})})]}):jsxRuntimeExports.jsx(EmptyState$2,{hasAnyCallSheets:xr.length>0,onUploadClick:()=>{var Ur;return(Ur=es.current)==null?void 0:Ur.click()},isUploading:vr})]}),Ir&&jsxRuntimeExports.jsx(SceneScriptModal,{scene:Ir,onClose:()=>Br(null)}),Wr&&jsxRuntimeExports.jsx(UnmatchedSceneModal,{info:Wr,onClose:()=>Yr(null),onAddScene:Ur=>{const Xr=ur(Ur);dr(Xr.id,Wr.character.id),Yr(null),ar(Xr.id)},onMergeWithScene:Ur=>{Ur.characters.includes(Wr.character.id)||dr(Ur.id,Wr.character.id),Yr(null),ar(Ur.id)}})]})}const TodaySceneCard=reactExports.memo(function ar({shootingScene:or,scene:lr,characters:cr,getLookForCharacter:ur,onTap:dr,onCharacterTap:hr,onSynopsisClick:pr,onStatusChange:xr,onFilmingStatusChange:mr,isReorderMode:fr=!1,isFirst:Er=!1,isLast:vr=!1,onMoveUp:gr,onMoveDown:yr}){const[jr,br]=reactExports.useState(!1),[_r,wr]=reactExports.useState(!1),[Rr,Ar]=reactExports.useState(!1),[Sr,kr]=reactExports.useState((lr==null?void 0:lr.filmingNotes)||""),Nr=reactExports.useRef(null);reactExports.useEffect(()=>{const Hr=Kr=>{Nr.current&&!Nr.current.contains(Kr.target)&&Ar(!1)};return document.addEventListener("mousedown",Hr),()=>document.removeEventListener("mousedown",Hr)},[]);const Cr=reactExports.useMemo(()=>{if(lr)return null;const Hr=or.setDescription||"",Kr=Hr.match(/^(INT|EXT)\./i),rs=Hr.match(/- (DAY|NIGHT|MORNING|EVENING|DUSK|DAWN|CONTINUOUS)$/i),Mr=Hr.match(/^(?:INT|EXT)\.\s*(.+?)(?:\s*-\s*(?:DAY|NIGHT|MORNING|EVENING|DUSK|DAWN|CONTINUOUS))?$/i);return{intExt:Kr?Kr[1].toUpperCase():null,timeOfDay:rs?rs[1].toUpperCase():null,location:Mr?Mr[1].trim():Hr}},[lr,or.setDescription]),Tr=lr==null?void 0:lr.filmingStatus,Pr=lr==null?void 0:lr.filmingNotes,Br=(()=>{if(!Tr)return null;switch(Tr){case"complete":return"scene-glass-complete";case"partial":return"scene-glass-partial";case"not-filmed":return"scene-glass-incomplete";default:return null}})(),Wr={upcoming:"Upcoming","in-progress":"In Progress",wrapped:"Wrapped"},es=(()=>{if(Tr){const Kr=SCENE_FILMING_STATUS_CONFIG[Tr];return{bg:Kr.bgClass,text:Kr.textClass,label:Kr.shortLabel,color:Kr.color}}return{...{upcoming:{bg:"bg-gray-100",text:"text-text-muted",color:"#6b7280"},"in-progress":{bg:"bg-gold-100/50",text:"text-gold",color:"#C9A962"},wrapped:{bg:"bg-green-50",text:"text-green-600",color:"#22c55e"}}[or.status],label:Wr[or.status]}})(),ps=()=>{br(!0)},ts=Hr=>{Hr==="not-filmed"||Hr==="partial"?(wr(!0),Ar(!1)):(mr(Hr),Ar(!1))},Qr=Hr=>{mr(Hr,Sr),wr(!1),br(!1)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:clsx("relative",Rr&&"z-40"),children:[fr&&jsxRuntimeExports.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 z-20 flex flex-col gap-1",children:[jsxRuntimeExports.jsx("button",{onClick:Hr=>{Hr.stopPropagation(),gr==null||gr()},disabled:Er,className:clsx("p-2 rounded-lg transition-all touch-manipulation",Er?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-gold hover:bg-gold/10 active:scale-95"),children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),jsxRuntimeExports.jsx("button",{onClick:Hr=>{Hr.stopPropagation(),yr==null||yr()},disabled:vr,className:clsx("p-2 rounded-lg transition-all touch-manipulation",vr?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-gold hover:bg-gold/10 active:scale-95"),children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]}),jsxRuntimeExports.jsxs("div",{onClick:fr?void 0:dr,onContextMenu:Hr=>{fr||(Hr.preventDefault(),ps())},className:clsx("w-full text-left card transition-all relative",!Rr&&"overflow-hidden",fr?"pr-16":"active:scale-[0.98] cursor-pointer"),children:[Br&&jsxRuntimeExports.jsx("div",{className:clsx("scene-glass-overlay",Br)}),jsxRuntimeExports.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 rounded-l-card",style:{background:or.status==="in-progress"?"linear-gradient(180deg, #d4a853 0%, #c9a962 100%)":or.status==="wrapped"?Tr==="complete"?"linear-gradient(180deg, #10b981 0%, #059669 100%)":Tr==="partial"?"linear-gradient(180deg, #d4a853 0%, #c9a962 100%)":Tr==="not-filmed"?"linear-gradient(180deg, #f87171 0%, #ef4444 100%)":"linear-gradient(180deg, #d1d5db 0%, #9ca3af 100%)":"transparent"}}),jsxRuntimeExports.jsxs("div",{className:"relative z-10 pl-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xl font-bold text-text-primary",children:or.sceneNumber}),jsxRuntimeExports.jsxs("div",{ref:Nr,className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:Hr=>{Hr.stopPropagation(),Ar(!Rr)},className:"status-dropdown-btn touch-manipulation",style:{borderColor:Tr?es.color:void 0},children:[jsxRuntimeExports.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:es.color}}),jsxRuntimeExports.jsx("span",{className:es.text,children:es.label}),jsxRuntimeExports.jsx("svg",{className:clsx("w-3 h-3 text-text-muted transition-transform",Rr&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),Rr&&jsxRuntimeExports.jsx("div",{className:"absolute right-0 top-full mt-1 w-44 bg-card border border-border rounded-lg shadow-lg z-50 overflow-hidden animate-fadeIn",children:["complete","partial","not-filmed"].map(Hr=>{const Kr=SCENE_FILMING_STATUS_CONFIG[Hr],rs=Tr===Hr;return jsxRuntimeExports.jsxs("button",{onClick:Mr=>{Mr.stopPropagation(),ts(Hr)},className:clsx("w-full px-3 py-2.5 text-left text-sm flex items-center gap-2.5 transition-colors",rs?Kr.bgClass:"hover:bg-gray-50"),children:[jsxRuntimeExports.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Kr.color}}),jsxRuntimeExports.jsx("span",{className:clsx("font-medium",rs&&Kr.textClass),children:Kr.label}),rs&&jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 ml-auto",Kr.textClass),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},Hr)})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 mb-2 flex-wrap",children:[((lr==null?void 0:lr.intExt)||(Cr==null?void 0:Cr.intExt))&&jsxRuntimeExports.jsx("span",{className:`px-1.5 py-0.5 text-[10px] font-bold rounded ${((lr==null?void 0:lr.intExt)||(Cr==null?void 0:Cr.intExt))==="INT"?"bg-slate-100 text-slate-600":"bg-stone-100 text-stone-600"}`,children:(lr==null?void 0:lr.intExt)||(Cr==null?void 0:Cr.intExt)}),or.dayNight&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-100 text-amber-700",children:or.dayNight}),or.pages&&jsxRuntimeExports.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-gray-100 text-text-muted",children:[or.pages," pgs"]}),or.estimatedTime&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-blue-50 text-blue-600",children:or.estimatedTime})]}),or.setDescription&&jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:or.setDescription}),(or.action||(lr==null?void 0:lr.synopsis))&&jsxRuntimeExports.jsxs("button",{onClick:Hr=>{Hr.stopPropagation(),lr&&pr(lr)},className:"w-full text-left group",disabled:!(lr!=null&&lr.scriptContent),children:[jsxRuntimeExports.jsx("p",{className:clsx("text-xs text-text-muted italic line-clamp-2",(lr==null?void 0:lr.scriptContent)&&"group-hover:text-gold transition-colors"),children:or.action||(lr==null?void 0:lr.synopsis)}),(lr==null?void 0:lr.scriptContent)&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-gold flex items-center gap-1 mt-0.5",children:[jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Tap to view full scene"]})]}),or.notes&&jsxRuntimeExports.jsx("div",{className:"mt-2 px-2.5 py-2 rounded-lg bg-gold-50 border border-gold-100",children:jsxRuntimeExports.jsx("div",{className:"text-xs text-gold-700 font-medium leading-relaxed",children:or.notes})}),Tr&&Tr!=="complete"&&Pr&&jsxRuntimeExports.jsxs("div",{className:clsx("mt-2 px-2.5 py-2 rounded-lg text-xs",Tr==="partial"?"bg-amber-50 text-amber-700 border border-amber-100":"bg-red-50 text-red-700 border border-red-100"),children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Note:"})," ",Pr]}),cr.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2.5 pt-2 border-t border-border/50",children:cr.map(Hr=>{const Kr=ur(Hr.id,or.sceneNumber,Hr.actorNumber),rs=Hr.avatarColour??"#C9A962";return jsxRuntimeExports.jsxs("button",{onClick:Mr=>{Mr.stopPropagation(),hr(Hr)},className:"flex items-center gap-1 rounded-full pl-0.5 pr-2 py-0.5 transition-colors bg-gray-50 hover:bg-gold/10 active:bg-gold/20 cursor-pointer",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold text-white flex-shrink-0",style:{backgroundColor:rs},children:Hr.actorNumber||Hr.initials}),jsxRuntimeExports.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:Hr.name.split(" ")[0]}),Kr&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-gold",children:[" ",Kr.name]})]},Hr.id)})})]})]})]}),jr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-4",onClick:()=>br(!1),children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl overflow-hidden",onClick:Hr=>Hr.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Scene ",or.sceneNumber]})}),jsxRuntimeExports.jsxs("div",{className:"py-2",children:[or.status!=="in-progress"&&jsxRuntimeExports.jsxs("button",{onClick:()=>{xr("in-progress"),br(!1)},className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"})}),"Mark In Progress"]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border mt-2 pt-2",children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-2",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"FILMING STATUS"})}),jsxRuntimeExports.jsxs("button",{onClick:()=>Qr("complete"),className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-green-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Complete"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Scene fully filmed"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>wr(!0),className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-amber-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Part Complete"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Some shots still needed"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>wr(!0),className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-red-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Incomplete"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Scene not filmed"})]})]})]}),or.status!=="upcoming"&&jsxRuntimeExports.jsxs("button",{onClick:()=>{xr("upcoming"),br(!1)},className:"w-full px-4 py-3 text-left text-sm text-text-muted hover:bg-gray-50 flex items-center gap-3 border-t border-border mt-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})}),"Revert to Upcoming"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>br(!1),className:"w-full p-4 text-center text-sm font-medium text-gold border-t border-border",children:"Cancel"})]})}),_r&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",onClick:()=>wr(!1),children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl overflow-hidden",onClick:Hr=>Hr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Scene ",or.sceneNumber," - Add Notes"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Why wasn't this scene fully filmed?"})]}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsx("textarea",{value:Sr,onChange:Hr=>kr(Hr.target.value),placeholder:"e.g., Ran out of time, weather issues, actor unavailable...",rows:3,className:"w-full p-3 border border-border rounded-lg text-sm bg-input-bg text-text-primary resize-none"})}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-border flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Qr("partial"),className:"flex-1 py-2.5 rounded-button bg-amber-500 text-white text-sm font-medium",children:"Part Complete"}),jsxRuntimeExports.jsx("button",{onClick:()=>Qr("not-filmed"),className:"flex-1 py-2.5 rounded-button bg-red-500 text-white text-sm font-medium",children:"Incomplete"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>wr(!1),className:"w-full p-3 text-center text-sm text-text-muted border-t border-border",children:"Cancel"})]})})]})}),EmptyState$2=reactExports.memo(function ar({hasAnyCallSheets:or,onUploadClick:lr,isUploading:cr}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:or?jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"}):jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),or?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"No Call Sheet for This Date"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload a call sheet for this production day to see today's scenes"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"Upload a Call Sheet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload your first call sheet to see today's scenes and start tracking continuity"})]}),jsxRuntimeExports.jsx("button",{onClick:lr,disabled:cr,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:cr?"Uploading...":"Upload Call Sheet PDF"})]})}),UnmatchedSceneModal=reactExports.memo(function ar({info:or,onClose:lr,onAddScene:cr,onMergeWithScene:ur}){const{sceneNumber:dr,character:hr,callSheetScene:pr,suggestedMergeScenes:xr}=or,mr=()=>{var gr,yr;let fr="INT",Er=pr.setDescription||`Scene ${dr}`;const vr=(gr=pr.setDescription)==null?void 0:gr.match(/^(INT|EXT)\./i);vr&&(fr=vr[1].toUpperCase()),cr({sceneNumber:dr,slugline:Er,intExt:fr,timeOfDay:((yr=pr.dayNight)==null?void 0:yr.toUpperCase())||"DAY",synopsis:pr.action,characters:[hr.id]})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-4",onClick:lr,children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl overflow-hidden animate-slideUp",onClick:fr=>fr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Scene ",dr," Not in Breakdown"]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["This scene from the call sheet doesn't exist in your script breakdown. Choose how to handle continuity for ",jsxRuntimeExports.jsx("span",{className:"font-medium text-gold",children:hr.name}),"."]})]}),jsxRuntimeExports.jsxs("div",{className:"py-2",children:[jsxRuntimeExports.jsxs("button",{onClick:mr,className:"w-full px-4 py-3.5 text-left hover:bg-gray-50 flex items-center gap-3 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-gold-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-text-primary block",children:["Add Scene ",dr," to Breakdown"]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Create a new scene and track continuity there"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}),xr.length>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-2 border-t border-border/50 mt-1",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"OR MERGE WITH EXISTING SCENE"})}),xr.map(fr=>jsxRuntimeExports.jsxs("button",{onClick:()=>ur(fr),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-blue-600",children:fr.sceneNumber})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-text-primary block truncate",children:["Merge with Scene ",fr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate block",children:fr.slugline})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},fr.id))]})]}),jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-full p-4 text-center text-sm font-medium text-text-muted border-t border-border hover:bg-gray-50 transition-colors",children:"Cancel"})]})})});/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var XLSX={};XLSX.version="0.18.5";var current_ansi=1252,VALID_ANSI=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],set_ansi=function(ar){VALID_ANSI.indexOf(ar)!=-1&&(current_ansi=ar)};function reset_ansi(){set_ansi(1252)}var set_cp=function(ar){set_ansi(ar)};function reset_cp(){set_cp(1200),reset_ansi()}var _getchar=function ar(or){return String.fromCharCode(or)},_getansi=function ar(or){return String.fromCharCode(or)},$cptable,Base64_map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Base64_encode(ar){for(var or="",lr=0,cr=0,ur=0,dr=0,hr=0,pr=0,xr=0,mr=0;mr<ar.length;)lr=ar.charCodeAt(mr++),dr=lr>>2,cr=ar.charCodeAt(mr++),hr=(lr&3)<<4|cr>>4,ur=ar.charCodeAt(mr++),pr=(cr&15)<<2|ur>>6,xr=ur&63,isNaN(cr)?pr=xr=64:isNaN(ur)&&(xr=64),or+=Base64_map.charAt(dr)+Base64_map.charAt(hr)+Base64_map.charAt(pr)+Base64_map.charAt(xr);return or}function Base64_decode(ar){var or="",lr=0,cr=0,ur=0,dr=0,hr=0,pr=0,xr=0;ar=ar.replace(/[^\w\+\/\=]/g,"");for(var mr=0;mr<ar.length;)dr=Base64_map.indexOf(ar.charAt(mr++)),hr=Base64_map.indexOf(ar.charAt(mr++)),lr=dr<<2|hr>>4,or+=String.fromCharCode(lr),pr=Base64_map.indexOf(ar.charAt(mr++)),cr=(hr&15)<<4|pr>>2,pr!==64&&(or+=String.fromCharCode(cr)),xr=Base64_map.indexOf(ar.charAt(mr++)),ur=(pr&3)<<6|xr,xr!==64&&(or+=String.fromCharCode(ur));return or}var has_buf=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Buffer_from=function(){if(typeof Buffer<"u"){var ar=!Buffer.from;if(!ar)try{Buffer.from("foo","utf8")}catch{ar=!0}return ar?function(or,lr){return lr?new Buffer(or,lr):new Buffer(or)}:Buffer.from.bind(Buffer)}return function(){}}();function new_raw_buf(ar){return has_buf?Buffer.alloc?Buffer.alloc(ar):new Buffer(ar):typeof Uint8Array<"u"?new Uint8Array(ar):new Array(ar)}function new_unsafe_buf(ar){return has_buf?Buffer.allocUnsafe?Buffer.allocUnsafe(ar):new Buffer(ar):typeof Uint8Array<"u"?new Uint8Array(ar):new Array(ar)}var s2a=function ar(or){return has_buf?Buffer_from(or,"binary"):or.split("").map(function(lr){return lr.charCodeAt(0)&255})};function s2ab(ar){if(typeof ArrayBuffer>"u")return s2a(ar);for(var or=new ArrayBuffer(ar.length),lr=new Uint8Array(or),cr=0;cr!=ar.length;++cr)lr[cr]=ar.charCodeAt(cr)&255;return or}function a2s(ar){if(Array.isArray(ar))return ar.map(function(cr){return String.fromCharCode(cr)}).join("");for(var or=[],lr=0;lr<ar.length;++lr)or[lr]=String.fromCharCode(ar[lr]);return or.join("")}function a2u(ar){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(ar)}var bconcat=has_buf?function(ar){return Buffer.concat(ar.map(function(or){return Buffer.isBuffer(or)?or:Buffer_from(or)}))}:function(ar){if(typeof Uint8Array<"u"){var or=0,lr=0;for(or=0;or<ar.length;++or)lr+=ar[or].length;var cr=new Uint8Array(lr),ur=0;for(or=0,lr=0;or<ar.length;lr+=ur,++or)if(ur=ar[or].length,ar[or]instanceof Uint8Array)cr.set(ar[or],lr);else{if(typeof ar[or]=="string")throw"wtf";cr.set(new Uint8Array(ar[or]),lr)}return cr}return[].concat.apply([],ar.map(function(dr){return Array.isArray(dr)?dr:[].slice.call(dr)}))};function utf8decode(ar){for(var or=[],lr=0,cr=ar.length+250,ur=new_raw_buf(ar.length+255),dr=0;dr<ar.length;++dr){var hr=ar.charCodeAt(dr);if(hr<128)ur[lr++]=hr;else if(hr<2048)ur[lr++]=192|hr>>6&31,ur[lr++]=128|hr&63;else if(hr>=55296&&hr<57344){hr=(hr&1023)+64;var pr=ar.charCodeAt(++dr)&1023;ur[lr++]=240|hr>>8&7,ur[lr++]=128|hr>>2&63,ur[lr++]=128|pr>>6&15|(hr&3)<<4,ur[lr++]=128|pr&63}else ur[lr++]=224|hr>>12&15,ur[lr++]=128|hr>>6&63,ur[lr++]=128|hr&63;lr>cr&&(or.push(ur.slice(0,lr)),lr=0,ur=new_raw_buf(65535),cr=65530)}return or.push(ur.slice(0,lr)),bconcat(or)}var chr0=/\u0000/g,chr1=/[\u0001-\u0006]/g;function _strrev(ar){for(var or="",lr=ar.length-1;lr>=0;)or+=ar.charAt(lr--);return or}function pad0(ar,or){var lr=""+ar;return lr.length>=or?lr:fill("0",or-lr.length)+lr}function pad_(ar,or){var lr=""+ar;return lr.length>=or?lr:fill(" ",or-lr.length)+lr}function rpad_(ar,or){var lr=""+ar;return lr.length>=or?lr:lr+fill(" ",or-lr.length)}function pad0r1(ar,or){var lr=""+Math.round(ar);return lr.length>=or?lr:fill("0",or-lr.length)+lr}function pad0r2(ar,or){var lr=""+ar;return lr.length>=or?lr:fill("0",or-lr.length)+lr}var p2_32=Math.pow(2,32);function pad0r(ar,or){if(ar>p2_32||ar<-p2_32)return pad0r1(ar,or);var lr=Math.round(ar);return pad0r2(lr,or)}function SSF_isgeneral(ar,or){return or=or||0,ar.length>=7+or&&(ar.charCodeAt(or)|32)===103&&(ar.charCodeAt(or+1)|32)===101&&(ar.charCodeAt(or+2)|32)===110&&(ar.charCodeAt(or+3)|32)===101&&(ar.charCodeAt(or+4)|32)===114&&(ar.charCodeAt(or+5)|32)===97&&(ar.charCodeAt(or+6)|32)===108}var days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function SSF_init_table(ar){return ar||(ar={}),ar[0]="General",ar[1]="0",ar[2]="0.00",ar[3]="#,##0",ar[4]="#,##0.00",ar[9]="0%",ar[10]="0.00%",ar[11]="0.00E+00",ar[12]="# ?/?",ar[13]="# ??/??",ar[14]="m/d/yy",ar[15]="d-mmm-yy",ar[16]="d-mmm",ar[17]="mmm-yy",ar[18]="h:mm AM/PM",ar[19]="h:mm:ss AM/PM",ar[20]="h:mm",ar[21]="h:mm:ss",ar[22]="m/d/yy h:mm",ar[37]="#,##0 ;(#,##0)",ar[38]="#,##0 ;[Red](#,##0)",ar[39]="#,##0.00;(#,##0.00)",ar[40]="#,##0.00;[Red](#,##0.00)",ar[45]="mm:ss",ar[46]="[h]:mm:ss",ar[47]="mmss.0",ar[48]="##0.0E+0",ar[49]="@",ar[56]='"/ "hh""mm""ss" "',ar}var table_fmt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},SSF_default_map={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},SSF_default_str={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function SSF_frac(ar,or,lr){for(var cr=ar<0?-1:1,ur=ar*cr,dr=0,hr=1,pr=0,xr=1,mr=0,fr=0,Er=Math.floor(ur);mr<or&&(Er=Math.floor(ur),pr=Er*hr+dr,fr=Er*mr+xr,!(ur-Er<5e-8));)ur=1/(ur-Er),dr=hr,hr=pr,xr=mr,mr=fr;if(fr>or&&(mr>or?(fr=xr,pr=dr):(fr=mr,pr=hr)),!lr)return[0,cr*pr,fr];var vr=Math.floor(cr*pr/fr);return[vr,cr*pr-vr*fr,fr]}function SSF_parse_date_code(ar,or,lr){if(ar>2958465||ar<0)return null;var cr=ar|0,ur=Math.floor(86400*(ar-cr)),dr=0,hr=[],pr={D:cr,T:ur,u:86400*(ar-cr)-ur,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(pr.u)<1e-6&&(pr.u=0),or&&or.date1904&&(cr+=1462),pr.u>.9999&&(pr.u=0,++ur==86400&&(pr.T=ur=0,++cr,++pr.D)),cr===60)hr=lr?[1317,10,29]:[1900,2,29],dr=3;else if(cr===0)hr=lr?[1317,8,29]:[1900,1,0],dr=6;else{cr>60&&--cr;var xr=new Date(1900,0,1);xr.setDate(xr.getDate()+cr-1),hr=[xr.getFullYear(),xr.getMonth()+1,xr.getDate()],dr=xr.getDay(),cr<60&&(dr=(dr+6)%7),lr&&(dr=SSF_fix_hijri(xr,hr))}return pr.y=hr[0],pr.m=hr[1],pr.d=hr[2],pr.S=ur%60,ur=Math.floor(ur/60),pr.M=ur%60,ur=Math.floor(ur/60),pr.H=ur,pr.q=dr,pr}var SSFbasedate=new Date(1899,11,31,0,0,0),SSFdnthresh=SSFbasedate.getTime(),SSFbase1904=new Date(1900,2,1,0,0,0);function datenum_local(ar,or){var lr=ar.getTime();return or?lr-=1461*24*60*60*1e3:ar>=SSFbase1904&&(lr+=24*60*60*1e3),(lr-(SSFdnthresh+(ar.getTimezoneOffset()-SSFbasedate.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function SSF_strip_decimal(ar){return ar.indexOf(".")==-1?ar:ar.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function SSF_normalize_exp(ar){return ar.indexOf("E")==-1?ar:ar.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function SSF_small_exp(ar){var or=ar<0?12:11,lr=SSF_strip_decimal(ar.toFixed(12));return lr.length<=or||(lr=ar.toPrecision(10),lr.length<=or)?lr:ar.toExponential(5)}function SSF_large_exp(ar){var or=SSF_strip_decimal(ar.toFixed(11));return or.length>(ar<0?12:11)||or==="0"||or==="-0"?ar.toPrecision(6):or}function SSF_general_num(ar){var or=Math.floor(Math.log(Math.abs(ar))*Math.LOG10E),lr;return or>=-4&&or<=-1?lr=ar.toPrecision(10+or):Math.abs(or)<=9?lr=SSF_small_exp(ar):or===10?lr=ar.toFixed(10).substr(0,12):lr=SSF_large_exp(ar),SSF_strip_decimal(SSF_normalize_exp(lr.toUpperCase()))}function SSF_general(ar,or){switch(typeof ar){case"string":return ar;case"boolean":return ar?"TRUE":"FALSE";case"number":return(ar|0)===ar?ar.toString(10):SSF_general_num(ar);case"undefined":return"";case"object":if(ar==null)return"";if(ar instanceof Date)return SSF_format(14,datenum_local(ar,or&&or.date1904),or)}throw new Error("unsupported value in General format: "+ar)}function SSF_fix_hijri(ar,or){or[0]-=581;var lr=ar.getDay();return ar<60&&(lr=(lr+6)%7),lr}function SSF_write_date(ar,or,lr,cr){var ur="",dr=0,hr=0,pr=lr.y,xr,mr=0;switch(ar){case 98:pr=lr.y+543;case 121:switch(or.length){case 1:case 2:xr=pr%100,mr=2;break;default:xr=pr%1e4,mr=4;break}break;case 109:switch(or.length){case 1:case 2:xr=lr.m,mr=or.length;break;case 3:return months[lr.m-1][1];case 5:return months[lr.m-1][0];default:return months[lr.m-1][2]}break;case 100:switch(or.length){case 1:case 2:xr=lr.d,mr=or.length;break;case 3:return days[lr.q][0];default:return days[lr.q][1]}break;case 104:switch(or.length){case 1:case 2:xr=1+(lr.H+11)%12,mr=or.length;break;default:throw"bad hour format: "+or}break;case 72:switch(or.length){case 1:case 2:xr=lr.H,mr=or.length;break;default:throw"bad hour format: "+or}break;case 77:switch(or.length){case 1:case 2:xr=lr.M,mr=or.length;break;default:throw"bad minute format: "+or}break;case 115:if(or!="s"&&or!="ss"&&or!=".0"&&or!=".00"&&or!=".000")throw"bad second format: "+or;return lr.u===0&&(or=="s"||or=="ss")?pad0(lr.S,or.length):(cr>=2?hr=cr===3?1e3:100:hr=cr===1?10:1,dr=Math.round(hr*(lr.S+lr.u)),dr>=60*hr&&(dr=0),or==="s"?dr===0?"0":""+dr/hr:(ur=pad0(dr,2+cr),or==="ss"?ur.substr(0,2):"."+ur.substr(2,or.length-1)));case 90:switch(or){case"[h]":case"[hh]":xr=lr.D*24+lr.H;break;case"[m]":case"[mm]":xr=(lr.D*24+lr.H)*60+lr.M;break;case"[s]":case"[ss]":xr=((lr.D*24+lr.H)*60+lr.M)*60+Math.round(lr.S+lr.u);break;default:throw"bad abstime format: "+or}mr=or.length===3?1:2;break;case 101:xr=pr,mr=1;break}var fr=mr>0?pad0(xr,mr):"";return fr}function commaify(ar){var or=3;if(ar.length<=or)return ar;for(var lr=ar.length%or,cr=ar.substr(0,lr);lr!=ar.length;lr+=or)cr+=(cr.length>0?",":"")+ar.substr(lr,or);return cr}var pct1=/%/g;function write_num_pct(ar,or,lr){var cr=or.replace(pct1,""),ur=or.length-cr.length;return write_num(ar,cr,lr*Math.pow(10,2*ur))+fill("%",ur)}function write_num_cm(ar,or,lr){for(var cr=or.length-1;or.charCodeAt(cr-1)===44;)--cr;return write_num(ar,or.substr(0,cr),lr/Math.pow(10,3*(or.length-cr)))}function write_num_exp(ar,or){var lr,cr=ar.indexOf("E")-ar.indexOf(".")-1;if(ar.match(/^#+0.0E\+0$/)){if(or==0)return"0.0E+0";if(or<0)return"-"+write_num_exp(ar,-or);var ur=ar.indexOf(".");ur===-1&&(ur=ar.indexOf("E"));var dr=Math.floor(Math.log(or)*Math.LOG10E)%ur;if(dr<0&&(dr+=ur),lr=(or/Math.pow(10,dr)).toPrecision(cr+1+(ur+dr)%ur),lr.indexOf("e")===-1){var hr=Math.floor(Math.log(or)*Math.LOG10E);for(lr.indexOf(".")===-1?lr=lr.charAt(0)+"."+lr.substr(1)+"E+"+(hr-lr.length+dr):lr+="E+"+(hr-dr);lr.substr(0,2)==="0.";)lr=lr.charAt(0)+lr.substr(2,ur)+"."+lr.substr(2+ur),lr=lr.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");lr=lr.replace(/\+-/,"-")}lr=lr.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(pr,xr,mr,fr){return xr+mr+fr.substr(0,(ur+dr)%ur)+"."+fr.substr(dr)+"E"})}else lr=or.toExponential(cr);return ar.match(/E\+00$/)&&lr.match(/e[+-]\d$/)&&(lr=lr.substr(0,lr.length-1)+"0"+lr.charAt(lr.length-1)),ar.match(/E\-/)&&lr.match(/e\+/)&&(lr=lr.replace(/e\+/,"e")),lr.replace("e","E")}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(ar,or,lr){var cr=parseInt(ar[4],10),ur=Math.round(or*cr),dr=Math.floor(ur/cr),hr=ur-dr*cr,pr=cr;return lr+(dr===0?"":""+dr)+" "+(hr===0?fill(" ",ar[1].length+1+ar[4].length):pad_(hr,ar[1].length)+ar[2]+"/"+ar[3]+pad0(pr,ar[4].length))}function write_num_f2(ar,or,lr){return lr+(or===0?"":""+or)+fill(" ",ar[1].length+2+ar[4].length)}var dec1=/^#*0*\.([0#]+)/,closeparen=/\).*[0#]/,phone=/\(###\) ###\\?-####/;function hashq(ar){for(var or="",lr,cr=0;cr!=ar.length;++cr)switch(lr=ar.charCodeAt(cr)){case 35:break;case 63:or+=" ";break;case 48:or+="0";break;default:or+=String.fromCharCode(lr)}return or}function rnd(ar,or){var lr=Math.pow(10,or);return""+Math.round(ar*lr)/lr}function dec(ar,or){var lr=ar-Math.floor(ar),cr=Math.pow(10,or);return or<(""+Math.round(lr*cr)).length?0:Math.round(lr*cr)}function carry(ar,or){return or<(""+Math.round((ar-Math.floor(ar))*Math.pow(10,or))).length?1:0}function flr(ar){return ar<2147483647&&ar>-2147483648?""+(ar>=0?ar|0:ar-1|0):""+Math.floor(ar)}function write_num_flt(ar,or,lr){if(ar.charCodeAt(0)===40&&!or.match(closeparen)){var cr=or.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return lr>=0?write_num_flt("n",cr,lr):"("+write_num_flt("n",cr,-lr)+")"}if(or.charCodeAt(or.length-1)===44)return write_num_cm(ar,or,lr);if(or.indexOf("%")!==-1)return write_num_pct(ar,or,lr);if(or.indexOf("E")!==-1)return write_num_exp(or,lr);if(or.charCodeAt(0)===36)return"$"+write_num_flt(ar,or.substr(or.charAt(1)==" "?2:1),lr);var ur,dr,hr,pr,xr=Math.abs(lr),mr=lr<0?"-":"";if(or.match(/^00+$/))return mr+pad0r(xr,or.length);if(or.match(/^[#?]+$/))return ur=pad0r(lr,0),ur==="0"&&(ur=""),ur.length>or.length?ur:hashq(or.substr(0,or.length-ur.length))+ur;if(dr=or.match(frac1))return write_num_f1(dr,xr,mr);if(or.match(/^#+0+$/))return mr+pad0r(xr,or.length-or.indexOf("0"));if(dr=or.match(dec1))return ur=rnd(lr,dr[1].length).replace(/^([^\.]+)$/,"$1."+hashq(dr[1])).replace(/\.$/,"."+hashq(dr[1])).replace(/\.(\d*)$/,function(yr,jr){return"."+jr+fill("0",hashq(dr[1]).length-jr.length)}),or.indexOf("0.")!==-1?ur:ur.replace(/^0\./,".");if(or=or.replace(/^#+([0.])/,"$1"),dr=or.match(/^(0*)\.(#*)$/))return mr+rnd(xr,dr[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,dr[1].length?"0.":".");if(dr=or.match(/^#{1,3},##0(\.?)$/))return mr+commaify(pad0r(xr,0));if(dr=or.match(/^#,##0\.([#0]*0)$/))return lr<0?"-"+write_num_flt(ar,or,-lr):commaify(""+(Math.floor(lr)+carry(lr,dr[1].length)))+"."+pad0(dec(lr,dr[1].length),dr[1].length);if(dr=or.match(/^#,#*,#0/))return write_num_flt(ar,or.replace(/^#,#*,/,""),lr);if(dr=or.match(/^([0#]+)(\\?-([0#]+))+$/))return ur=_strrev(write_num_flt(ar,or.replace(/[\\-]/g,""),lr)),hr=0,_strrev(_strrev(or.replace(/\\/g,"")).replace(/[0#]/g,function(yr){return hr<ur.length?ur.charAt(hr++):yr==="0"?"0":""}));if(or.match(phone))return ur=write_num_flt(ar,"##########",lr),"("+ur.substr(0,3)+") "+ur.substr(3,3)+"-"+ur.substr(6);var fr="";if(dr=or.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return hr=Math.min(dr[4].length,7),pr=SSF_frac(xr,Math.pow(10,hr)-1,!1),ur=""+mr,fr=write_num("n",dr[1],pr[1]),fr.charAt(fr.length-1)==" "&&(fr=fr.substr(0,fr.length-1)+"0"),ur+=fr+dr[2]+"/"+dr[3],fr=rpad_(pr[2],hr),fr.length<dr[4].length&&(fr=hashq(dr[4].substr(dr[4].length-fr.length))+fr),ur+=fr,ur;if(dr=or.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return hr=Math.min(Math.max(dr[1].length,dr[4].length),7),pr=SSF_frac(xr,Math.pow(10,hr)-1,!0),mr+(pr[0]||(pr[1]?"":"0"))+" "+(pr[1]?pad_(pr[1],hr)+dr[2]+"/"+dr[3]+rpad_(pr[2],hr):fill(" ",2*hr+1+dr[2].length+dr[3].length));if(dr=or.match(/^[#0?]+$/))return ur=pad0r(lr,0),or.length<=ur.length?ur:hashq(or.substr(0,or.length-ur.length))+ur;if(dr=or.match(/^([#0?]+)\.([#0]+)$/)){ur=""+lr.toFixed(Math.min(dr[2].length,10)).replace(/([^0])0+$/,"$1"),hr=ur.indexOf(".");var Er=or.indexOf(".")-hr,vr=or.length-ur.length-Er;return hashq(or.substr(0,Er)+ur+or.substr(or.length-vr))}if(dr=or.match(/^00,000\.([#0]*0)$/))return hr=dec(lr,dr[1].length),lr<0?"-"+write_num_flt(ar,or,-lr):commaify(flr(lr)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(yr){return"00,"+(yr.length<3?pad0(0,3-yr.length):"")+yr})+"."+pad0(hr,dr[1].length);switch(or){case"###,##0.00":return write_num_flt(ar,"#,##0.00",lr);case"###,###":case"##,###":case"#,###":var gr=commaify(pad0r(xr,0));return gr!=="0"?mr+gr:"";case"###,###.00":return write_num_flt(ar,"###,##0.00",lr).replace(/^0\./,".");case"#,###.00":return write_num_flt(ar,"#,##0.00",lr).replace(/^0\./,".")}throw new Error("unsupported format |"+or+"|")}function write_num_cm2(ar,or,lr){for(var cr=or.length-1;or.charCodeAt(cr-1)===44;)--cr;return write_num(ar,or.substr(0,cr),lr/Math.pow(10,3*(or.length-cr)))}function write_num_pct2(ar,or,lr){var cr=or.replace(pct1,""),ur=or.length-cr.length;return write_num(ar,cr,lr*Math.pow(10,2*ur))+fill("%",ur)}function write_num_exp2(ar,or){var lr,cr=ar.indexOf("E")-ar.indexOf(".")-1;if(ar.match(/^#+0.0E\+0$/)){if(or==0)return"0.0E+0";if(or<0)return"-"+write_num_exp2(ar,-or);var ur=ar.indexOf(".");ur===-1&&(ur=ar.indexOf("E"));var dr=Math.floor(Math.log(or)*Math.LOG10E)%ur;if(dr<0&&(dr+=ur),lr=(or/Math.pow(10,dr)).toPrecision(cr+1+(ur+dr)%ur),!lr.match(/[Ee]/)){var hr=Math.floor(Math.log(or)*Math.LOG10E);lr.indexOf(".")===-1?lr=lr.charAt(0)+"."+lr.substr(1)+"E+"+(hr-lr.length+dr):lr+="E+"+(hr-dr),lr=lr.replace(/\+-/,"-")}lr=lr.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(pr,xr,mr,fr){return xr+mr+fr.substr(0,(ur+dr)%ur)+"."+fr.substr(dr)+"E"})}else lr=or.toExponential(cr);return ar.match(/E\+00$/)&&lr.match(/e[+-]\d$/)&&(lr=lr.substr(0,lr.length-1)+"0"+lr.charAt(lr.length-1)),ar.match(/E\-/)&&lr.match(/e\+/)&&(lr=lr.replace(/e\+/,"e")),lr.replace("e","E")}function write_num_int(ar,or,lr){if(ar.charCodeAt(0)===40&&!or.match(closeparen)){var cr=or.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return lr>=0?write_num_int("n",cr,lr):"("+write_num_int("n",cr,-lr)+")"}if(or.charCodeAt(or.length-1)===44)return write_num_cm2(ar,or,lr);if(or.indexOf("%")!==-1)return write_num_pct2(ar,or,lr);if(or.indexOf("E")!==-1)return write_num_exp2(or,lr);if(or.charCodeAt(0)===36)return"$"+write_num_int(ar,or.substr(or.charAt(1)==" "?2:1),lr);var ur,dr,hr,pr,xr=Math.abs(lr),mr=lr<0?"-":"";if(or.match(/^00+$/))return mr+pad0(xr,or.length);if(or.match(/^[#?]+$/))return ur=""+lr,lr===0&&(ur=""),ur.length>or.length?ur:hashq(or.substr(0,or.length-ur.length))+ur;if(dr=or.match(frac1))return write_num_f2(dr,xr,mr);if(or.match(/^#+0+$/))return mr+pad0(xr,or.length-or.indexOf("0"));if(dr=or.match(dec1))return ur=(""+lr).replace(/^([^\.]+)$/,"$1."+hashq(dr[1])).replace(/\.$/,"."+hashq(dr[1])),ur=ur.replace(/\.(\d*)$/,function(yr,jr){return"."+jr+fill("0",hashq(dr[1]).length-jr.length)}),or.indexOf("0.")!==-1?ur:ur.replace(/^0\./,".");if(or=or.replace(/^#+([0.])/,"$1"),dr=or.match(/^(0*)\.(#*)$/))return mr+(""+xr).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,dr[1].length?"0.":".");if(dr=or.match(/^#{1,3},##0(\.?)$/))return mr+commaify(""+xr);if(dr=or.match(/^#,##0\.([#0]*0)$/))return lr<0?"-"+write_num_int(ar,or,-lr):commaify(""+lr)+"."+fill("0",dr[1].length);if(dr=or.match(/^#,#*,#0/))return write_num_int(ar,or.replace(/^#,#*,/,""),lr);if(dr=or.match(/^([0#]+)(\\?-([0#]+))+$/))return ur=_strrev(write_num_int(ar,or.replace(/[\\-]/g,""),lr)),hr=0,_strrev(_strrev(or.replace(/\\/g,"")).replace(/[0#]/g,function(yr){return hr<ur.length?ur.charAt(hr++):yr==="0"?"0":""}));if(or.match(phone))return ur=write_num_int(ar,"##########",lr),"("+ur.substr(0,3)+") "+ur.substr(3,3)+"-"+ur.substr(6);var fr="";if(dr=or.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return hr=Math.min(dr[4].length,7),pr=SSF_frac(xr,Math.pow(10,hr)-1,!1),ur=""+mr,fr=write_num("n",dr[1],pr[1]),fr.charAt(fr.length-1)==" "&&(fr=fr.substr(0,fr.length-1)+"0"),ur+=fr+dr[2]+"/"+dr[3],fr=rpad_(pr[2],hr),fr.length<dr[4].length&&(fr=hashq(dr[4].substr(dr[4].length-fr.length))+fr),ur+=fr,ur;if(dr=or.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return hr=Math.min(Math.max(dr[1].length,dr[4].length),7),pr=SSF_frac(xr,Math.pow(10,hr)-1,!0),mr+(pr[0]||(pr[1]?"":"0"))+" "+(pr[1]?pad_(pr[1],hr)+dr[2]+"/"+dr[3]+rpad_(pr[2],hr):fill(" ",2*hr+1+dr[2].length+dr[3].length));if(dr=or.match(/^[#0?]+$/))return ur=""+lr,or.length<=ur.length?ur:hashq(or.substr(0,or.length-ur.length))+ur;if(dr=or.match(/^([#0]+)\.([#0]+)$/)){ur=""+lr.toFixed(Math.min(dr[2].length,10)).replace(/([^0])0+$/,"$1"),hr=ur.indexOf(".");var Er=or.indexOf(".")-hr,vr=or.length-ur.length-Er;return hashq(or.substr(0,Er)+ur+or.substr(or.length-vr))}if(dr=or.match(/^00,000\.([#0]*0)$/))return lr<0?"-"+write_num_int(ar,or,-lr):commaify(""+lr).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(yr){return"00,"+(yr.length<3?pad0(0,3-yr.length):"")+yr})+"."+pad0(0,dr[1].length);switch(or){case"###,###":case"##,###":case"#,###":var gr=commaify(""+xr);return gr!=="0"?mr+gr:"";default:if(or.match(/\.[0#?]*$/))return write_num_int(ar,or.slice(0,or.lastIndexOf(".")),lr)+hashq(or.slice(or.lastIndexOf(".")))}throw new Error("unsupported format |"+or+"|")}function write_num(ar,or,lr){return(lr|0)===lr?write_num_int(ar,or,lr):write_num_flt(ar,or,lr)}function SSF_split_fmt(ar){for(var or=[],lr=!1,cr=0,ur=0;cr<ar.length;++cr)switch(ar.charCodeAt(cr)){case 34:lr=!lr;break;case 95:case 42:case 92:++cr;break;case 59:or[or.length]=ar.substr(ur,cr-ur),ur=cr+1}if(or[or.length]=ar.substr(ur),lr===!0)throw new Error("Format |"+ar+"| unterminated string ");return or}var SSF_abstime=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function fmt_is_date(ar){for(var or=0,lr="",cr="";or<ar.length;)switch(lr=ar.charAt(or)){case"G":SSF_isgeneral(ar,or)&&(or+=6),or++;break;case'"':for(;ar.charCodeAt(++or)!==34&&or<ar.length;);++or;break;case"\\":or+=2;break;case"_":or+=2;break;case"@":++or;break;case"B":case"b":if(ar.charAt(or+1)==="1"||ar.charAt(or+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(ar.substr(or,3).toUpperCase()==="A/P"||ar.substr(or,5).toUpperCase()==="AM/PM"||ar.substr(or,5).toUpperCase()==="/")return!0;++or;break;case"[":for(cr=lr;ar.charAt(or++)!=="]"&&or<ar.length;)cr+=ar.charAt(or);if(cr.match(SSF_abstime))return!0;break;case".":case"0":case"#":for(;or<ar.length&&("0#?.,E+-%".indexOf(lr=ar.charAt(++or))>-1||lr=="\\"&&ar.charAt(or+1)=="-"&&"0#".indexOf(ar.charAt(or+2))>-1););break;case"?":for(;ar.charAt(++or)===lr;);break;case"*":++or,(ar.charAt(or)==" "||ar.charAt(or)=="*")&&++or;break;case"(":case")":++or;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;or<ar.length&&"0123456789".indexOf(ar.charAt(++or))>-1;);break;case" ":++or;break;default:++or;break}return!1}function eval_fmt(ar,or,lr,cr){for(var ur=[],dr="",hr=0,pr="",xr="t",mr,fr,Er,vr="H";hr<ar.length;)switch(pr=ar.charAt(hr)){case"G":if(!SSF_isgeneral(ar,hr))throw new Error("unrecognized character "+pr+" in "+ar);ur[ur.length]={t:"G",v:"General"},hr+=7;break;case'"':for(dr="";(Er=ar.charCodeAt(++hr))!==34&&hr<ar.length;)dr+=String.fromCharCode(Er);ur[ur.length]={t:"t",v:dr},++hr;break;case"\\":var gr=ar.charAt(++hr),yr=gr==="("||gr===")"?gr:"t";ur[ur.length]={t:yr,v:gr},++hr;break;case"_":ur[ur.length]={t:"t",v:" "},hr+=2;break;case"@":ur[ur.length]={t:"T",v:or},++hr;break;case"B":case"b":if(ar.charAt(hr+1)==="1"||ar.charAt(hr+1)==="2"){if(mr==null&&(mr=SSF_parse_date_code(or,lr,ar.charAt(hr+1)==="2"),mr==null))return"";ur[ur.length]={t:"X",v:ar.substr(hr,2)},xr=pr,hr+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":pr=pr.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(or<0||mr==null&&(mr=SSF_parse_date_code(or,lr),mr==null))return"";for(dr=pr;++hr<ar.length&&ar.charAt(hr).toLowerCase()===pr;)dr+=pr;pr==="m"&&xr.toLowerCase()==="h"&&(pr="M"),pr==="h"&&(pr=vr),ur[ur.length]={t:pr,v:dr},xr=pr;break;case"A":case"a":case"":var jr={t:pr,v:pr};if(mr==null&&(mr=SSF_parse_date_code(or,lr)),ar.substr(hr,3).toUpperCase()==="A/P"?(mr!=null&&(jr.v=mr.H>=12?"P":"A"),jr.t="T",vr="h",hr+=3):ar.substr(hr,5).toUpperCase()==="AM/PM"?(mr!=null&&(jr.v=mr.H>=12?"PM":"AM"),jr.t="T",hr+=5,vr="h"):ar.substr(hr,5).toUpperCase()==="/"?(mr!=null&&(jr.v=mr.H>=12?"":""),jr.t="T",hr+=5,vr="h"):(jr.t="t",++hr),mr==null&&jr.t==="T")return"";ur[ur.length]=jr,xr=pr;break;case"[":for(dr=pr;ar.charAt(hr++)!=="]"&&hr<ar.length;)dr+=ar.charAt(hr);if(dr.slice(-1)!=="]")throw'unterminated "[" block: |'+dr+"|";if(dr.match(SSF_abstime)){if(mr==null&&(mr=SSF_parse_date_code(or,lr),mr==null))return"";ur[ur.length]={t:"Z",v:dr.toLowerCase()},xr=dr.charAt(1)}else dr.indexOf("$")>-1&&(dr=(dr.match(/\$([^-\[\]]*)/)||[])[1]||"$",fmt_is_date(ar)||(ur[ur.length]={t:"t",v:dr}));break;case".":if(mr!=null){for(dr=pr;++hr<ar.length&&(pr=ar.charAt(hr))==="0";)dr+=pr;ur[ur.length]={t:"s",v:dr};break}case"0":case"#":for(dr=pr;++hr<ar.length&&"0#?.,E+-%".indexOf(pr=ar.charAt(hr))>-1;)dr+=pr;ur[ur.length]={t:"n",v:dr};break;case"?":for(dr=pr;ar.charAt(++hr)===pr;)dr+=pr;ur[ur.length]={t:pr,v:dr},xr=pr;break;case"*":++hr,(ar.charAt(hr)==" "||ar.charAt(hr)=="*")&&++hr;break;case"(":case")":ur[ur.length]={t:cr===1?"t":pr,v:pr},++hr;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(dr=pr;hr<ar.length&&"0123456789".indexOf(ar.charAt(++hr))>-1;)dr+=ar.charAt(hr);ur[ur.length]={t:"D",v:dr};break;case" ":ur[ur.length]={t:pr,v:pr},++hr;break;case"$":ur[ur.length]={t:"t",v:"$"},++hr;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(pr)===-1)throw new Error("unrecognized character "+pr+" in "+ar);ur[ur.length]={t:"t",v:pr},++hr;break}var br=0,_r=0,wr;for(hr=ur.length-1,xr="t";hr>=0;--hr)switch(ur[hr].t){case"h":case"H":ur[hr].t=vr,xr="h",br<1&&(br=1);break;case"s":(wr=ur[hr].v.match(/\.0+$/))&&(_r=Math.max(_r,wr[0].length-1)),br<3&&(br=3);case"d":case"y":case"M":case"e":xr=ur[hr].t;break;case"m":xr==="s"&&(ur[hr].t="M",br<2&&(br=2));break;case"X":break;case"Z":br<1&&ur[hr].v.match(/[Hh]/)&&(br=1),br<2&&ur[hr].v.match(/[Mm]/)&&(br=2),br<3&&ur[hr].v.match(/[Ss]/)&&(br=3)}switch(br){case 0:break;case 1:mr.u>=.5&&(mr.u=0,++mr.S),mr.S>=60&&(mr.S=0,++mr.M),mr.M>=60&&(mr.M=0,++mr.H);break;case 2:mr.u>=.5&&(mr.u=0,++mr.S),mr.S>=60&&(mr.S=0,++mr.M);break}var Rr="",Ar;for(hr=0;hr<ur.length;++hr)switch(ur[hr].t){case"t":case"T":case" ":case"D":break;case"X":ur[hr].v="",ur[hr].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":ur[hr].v=SSF_write_date(ur[hr].t.charCodeAt(0),ur[hr].v,mr,_r),ur[hr].t="t";break;case"n":case"?":for(Ar=hr+1;ur[Ar]!=null&&((pr=ur[Ar].t)==="?"||pr==="D"||(pr===" "||pr==="t")&&ur[Ar+1]!=null&&(ur[Ar+1].t==="?"||ur[Ar+1].t==="t"&&ur[Ar+1].v==="/")||ur[hr].t==="("&&(pr===" "||pr==="n"||pr===")")||pr==="t"&&(ur[Ar].v==="/"||ur[Ar].v===" "&&ur[Ar+1]!=null&&ur[Ar+1].t=="?"));)ur[hr].v+=ur[Ar].v,ur[Ar]={v:"",t:";"},++Ar;Rr+=ur[hr].v,hr=Ar-1;break;case"G":ur[hr].t="t",ur[hr].v=SSF_general(or,lr);break}var Sr="",kr,Nr;if(Rr.length>0){Rr.charCodeAt(0)==40?(kr=or<0&&Rr.charCodeAt(0)===45?-or:or,Nr=write_num("n",Rr,kr)):(kr=or<0&&cr>1?-or:or,Nr=write_num("n",Rr,kr),kr<0&&ur[0]&&ur[0].t=="t"&&(Nr=Nr.substr(1),ur[0].v="-"+ur[0].v)),Ar=Nr.length-1;var Cr=ur.length;for(hr=0;hr<ur.length;++hr)if(ur[hr]!=null&&ur[hr].t!="t"&&ur[hr].v.indexOf(".")>-1){Cr=hr;break}var Tr=ur.length;if(Cr===ur.length&&Nr.indexOf("E")===-1){for(hr=ur.length-1;hr>=0;--hr)ur[hr]==null||"n?".indexOf(ur[hr].t)===-1||(Ar>=ur[hr].v.length-1?(Ar-=ur[hr].v.length,ur[hr].v=Nr.substr(Ar+1,ur[hr].v.length)):Ar<0?ur[hr].v="":(ur[hr].v=Nr.substr(0,Ar+1),Ar=-1),ur[hr].t="t",Tr=hr);Ar>=0&&Tr<ur.length&&(ur[Tr].v=Nr.substr(0,Ar+1)+ur[Tr].v)}else if(Cr!==ur.length&&Nr.indexOf("E")===-1){for(Ar=Nr.indexOf(".")-1,hr=Cr;hr>=0;--hr)if(!(ur[hr]==null||"n?".indexOf(ur[hr].t)===-1)){for(fr=ur[hr].v.indexOf(".")>-1&&hr===Cr?ur[hr].v.indexOf(".")-1:ur[hr].v.length-1,Sr=ur[hr].v.substr(fr+1);fr>=0;--fr)Ar>=0&&(ur[hr].v.charAt(fr)==="0"||ur[hr].v.charAt(fr)==="#")&&(Sr=Nr.charAt(Ar--)+Sr);ur[hr].v=Sr,ur[hr].t="t",Tr=hr}for(Ar>=0&&Tr<ur.length&&(ur[Tr].v=Nr.substr(0,Ar+1)+ur[Tr].v),Ar=Nr.indexOf(".")+1,hr=Cr;hr<ur.length;++hr)if(!(ur[hr]==null||"n?(".indexOf(ur[hr].t)===-1&&hr!==Cr)){for(fr=ur[hr].v.indexOf(".")>-1&&hr===Cr?ur[hr].v.indexOf(".")+1:0,Sr=ur[hr].v.substr(0,fr);fr<ur[hr].v.length;++fr)Ar<Nr.length&&(Sr+=Nr.charAt(Ar++));ur[hr].v=Sr,ur[hr].t="t",Tr=hr}}}for(hr=0;hr<ur.length;++hr)ur[hr]!=null&&"n?".indexOf(ur[hr].t)>-1&&(kr=cr>1&&or<0&&hr>0&&ur[hr-1].v==="-"?-or:or,ur[hr].v=write_num(ur[hr].t,ur[hr].v,kr),ur[hr].t="t");var Pr="";for(hr=0;hr!==ur.length;++hr)ur[hr]!=null&&(Pr+=ur[hr].v);return Pr}var cfregex2=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function chkcond(ar,or){if(or==null)return!1;var lr=parseFloat(or[2]);switch(or[1]){case"=":if(ar==lr)return!0;break;case">":if(ar>lr)return!0;break;case"<":if(ar<lr)return!0;break;case"<>":if(ar!=lr)return!0;break;case">=":if(ar>=lr)return!0;break;case"<=":if(ar<=lr)return!0;break}return!1}function choose_fmt(ar,or){var lr=SSF_split_fmt(ar),cr=lr.length,ur=lr[cr-1].indexOf("@");if(cr<4&&ur>-1&&--cr,lr.length>4)throw new Error("cannot find right format for |"+lr.join("|")+"|");if(typeof or!="number")return[4,lr.length===4||ur>-1?lr[lr.length-1]:"@"];switch(lr.length){case 1:lr=ur>-1?["General","General","General",lr[0]]:[lr[0],lr[0],lr[0],"@"];break;case 2:lr=ur>-1?[lr[0],lr[0],lr[0],lr[1]]:[lr[0],lr[1],lr[0],"@"];break;case 3:lr=ur>-1?[lr[0],lr[1],lr[0],lr[2]]:[lr[0],lr[1],lr[2],"@"];break}var dr=or>0?lr[0]:or<0?lr[1]:lr[2];if(lr[0].indexOf("[")===-1&&lr[1].indexOf("[")===-1)return[cr,dr];if(lr[0].match(/\[[=<>]/)!=null||lr[1].match(/\[[=<>]/)!=null){var hr=lr[0].match(cfregex2),pr=lr[1].match(cfregex2);return chkcond(or,hr)?[cr,lr[0]]:chkcond(or,pr)?[cr,lr[1]]:[cr,lr[hr!=null&&pr!=null?2:1]]}return[cr,dr]}function SSF_format(ar,or,lr){lr==null&&(lr={});var cr="";switch(typeof ar){case"string":ar=="m/d/yy"&&lr.dateNF?cr=lr.dateNF:cr=ar;break;case"number":ar==14&&lr.dateNF?cr=lr.dateNF:cr=(lr.table!=null?lr.table:table_fmt)[ar],cr==null&&(cr=lr.table&&lr.table[SSF_default_map[ar]]||table_fmt[SSF_default_map[ar]]),cr==null&&(cr=SSF_default_str[ar]||"General");break}if(SSF_isgeneral(cr,0))return SSF_general(or,lr);or instanceof Date&&(or=datenum_local(or,lr.date1904));var ur=choose_fmt(cr,or);if(SSF_isgeneral(ur[1]))return SSF_general(or,lr);if(or===!0)or="TRUE";else if(or===!1)or="FALSE";else if(or===""||or==null)return"";return eval_fmt(ur[1],or,lr,ur[0])}function SSF_load(ar,or){if(typeof or!="number"){or=+or||-1;for(var lr=0;lr<392;++lr){if(table_fmt[lr]==null){or<0&&(or=lr);continue}if(table_fmt[lr]==ar){or=lr;break}}or<0&&(or=391)}return table_fmt[or]=ar,or}function SSF_load_table(ar){for(var or=0;or!=392;++or)ar[or]!==void 0&&SSF_load(ar[or],or)}function make_ssf(){table_fmt=SSF_init_table()}var dateNFregex=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function dateNF_regex(ar){var or=typeof ar=="number"?table_fmt[ar]:ar;return or=or.replace(dateNFregex,"(\\d+)"),new RegExp("^"+or+"$")}function dateNF_fix(ar,or,lr){var cr=-1,ur=-1,dr=-1,hr=-1,pr=-1,xr=-1;(or.match(dateNFregex)||[]).forEach(function(Er,vr){var gr=parseInt(lr[vr+1],10);switch(Er.toLowerCase().charAt(0)){case"y":cr=gr;break;case"d":dr=gr;break;case"h":hr=gr;break;case"s":xr=gr;break;case"m":hr>=0?pr=gr:ur=gr;break}}),xr>=0&&pr==-1&&ur>=0&&(pr=ur,ur=-1);var mr=(""+(cr>=0?cr:new Date().getFullYear())).slice(-4)+"-"+("00"+(ur>=1?ur:1)).slice(-2)+"-"+("00"+(dr>=1?dr:1)).slice(-2);mr.length==7&&(mr="0"+mr),mr.length==8&&(mr="20"+mr);var fr=("00"+(hr>=0?hr:0)).slice(-2)+":"+("00"+(pr>=0?pr:0)).slice(-2)+":"+("00"+(xr>=0?xr:0)).slice(-2);return hr==-1&&pr==-1&&xr==-1?mr:cr==-1&&ur==-1&&dr==-1?fr:mr+"T"+fr}var CRC32=function(){var ar={};ar.version="1.2.0";function or(){for(var Nr=0,Cr=new Array(256),Tr=0;Tr!=256;++Tr)Nr=Tr,Nr=Nr&1?-306674912^Nr>>>1:Nr>>>1,Nr=Nr&1?-306674912^Nr>>>1:Nr>>>1,Nr=Nr&1?-306674912^Nr>>>1:Nr>>>1,Nr=Nr&1?-306674912^Nr>>>1:Nr>>>1,Nr=Nr&1?-306674912^Nr>>>1:Nr>>>1,Nr=Nr&1?-306674912^Nr>>>1:Nr>>>1,Nr=Nr&1?-306674912^Nr>>>1:Nr>>>1,Nr=Nr&1?-306674912^Nr>>>1:Nr>>>1,Cr[Tr]=Nr;return typeof Int32Array<"u"?new Int32Array(Cr):Cr}var lr=or();function cr(Nr){var Cr=0,Tr=0,Pr=0,Ir=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(Pr=0;Pr!=256;++Pr)Ir[Pr]=Nr[Pr];for(Pr=0;Pr!=256;++Pr)for(Tr=Nr[Pr],Cr=256+Pr;Cr<4096;Cr+=256)Tr=Ir[Cr]=Tr>>>8^Nr[Tr&255];var Br=[];for(Pr=1;Pr!=16;++Pr)Br[Pr-1]=typeof Int32Array<"u"?Ir.subarray(Pr*256,Pr*256+256):Ir.slice(Pr*256,Pr*256+256);return Br}var ur=cr(lr),dr=ur[0],hr=ur[1],pr=ur[2],xr=ur[3],mr=ur[4],fr=ur[5],Er=ur[6],vr=ur[7],gr=ur[8],yr=ur[9],jr=ur[10],br=ur[11],_r=ur[12],wr=ur[13],Rr=ur[14];function Ar(Nr,Cr){for(var Tr=Cr^-1,Pr=0,Ir=Nr.length;Pr<Ir;)Tr=Tr>>>8^lr[(Tr^Nr.charCodeAt(Pr++))&255];return~Tr}function Sr(Nr,Cr){for(var Tr=Cr^-1,Pr=Nr.length-15,Ir=0;Ir<Pr;)Tr=Rr[Nr[Ir++]^Tr&255]^wr[Nr[Ir++]^Tr>>8&255]^_r[Nr[Ir++]^Tr>>16&255]^br[Nr[Ir++]^Tr>>>24]^jr[Nr[Ir++]]^yr[Nr[Ir++]]^gr[Nr[Ir++]]^vr[Nr[Ir++]]^Er[Nr[Ir++]]^fr[Nr[Ir++]]^mr[Nr[Ir++]]^xr[Nr[Ir++]]^pr[Nr[Ir++]]^hr[Nr[Ir++]]^dr[Nr[Ir++]]^lr[Nr[Ir++]];for(Pr+=15;Ir<Pr;)Tr=Tr>>>8^lr[(Tr^Nr[Ir++])&255];return~Tr}function kr(Nr,Cr){for(var Tr=Cr^-1,Pr=0,Ir=Nr.length,Br=0,Wr=0;Pr<Ir;)Br=Nr.charCodeAt(Pr++),Br<128?Tr=Tr>>>8^lr[(Tr^Br)&255]:Br<2048?(Tr=Tr>>>8^lr[(Tr^(192|Br>>6&31))&255],Tr=Tr>>>8^lr[(Tr^(128|Br&63))&255]):Br>=55296&&Br<57344?(Br=(Br&1023)+64,Wr=Nr.charCodeAt(Pr++)&1023,Tr=Tr>>>8^lr[(Tr^(240|Br>>8&7))&255],Tr=Tr>>>8^lr[(Tr^(128|Br>>2&63))&255],Tr=Tr>>>8^lr[(Tr^(128|Wr>>6&15|(Br&3)<<4))&255],Tr=Tr>>>8^lr[(Tr^(128|Wr&63))&255]):(Tr=Tr>>>8^lr[(Tr^(224|Br>>12&15))&255],Tr=Tr>>>8^lr[(Tr^(128|Br>>6&63))&255],Tr=Tr>>>8^lr[(Tr^(128|Br&63))&255]);return~Tr}return ar.table=lr,ar.bstr=Ar,ar.buf=Sr,ar.str=kr,ar}(),CFB=function ar(){var or={};or.version="1.2.1";function lr(zr,os){for(var qr=zr.split("/"),Zr=os.split("/"),ns=0,us=0,_s=Math.min(qr.length,Zr.length);ns<_s;++ns){if(us=qr[ns].length-Zr[ns].length)return us;if(qr[ns]!=Zr[ns])return qr[ns]<Zr[ns]?-1:1}return qr.length-Zr.length}function cr(zr){if(zr.charAt(zr.length-1)=="/")return zr.slice(0,-1).indexOf("/")===-1?zr:cr(zr.slice(0,-1));var os=zr.lastIndexOf("/");return os===-1?zr:zr.slice(0,os+1)}function ur(zr){if(zr.charAt(zr.length-1)=="/")return ur(zr.slice(0,-1));var os=zr.lastIndexOf("/");return os===-1?zr:zr.slice(os+1)}function dr(zr,os){typeof os=="string"&&(os=new Date(os));var qr=os.getHours();qr=qr<<6|os.getMinutes(),qr=qr<<5|os.getSeconds()>>>1,zr.write_shift(2,qr);var Zr=os.getFullYear()-1980;Zr=Zr<<4|os.getMonth()+1,Zr=Zr<<5|os.getDate(),zr.write_shift(2,Zr)}function hr(zr){var os=zr.read_shift(2)&65535,qr=zr.read_shift(2)&65535,Zr=new Date,ns=qr&31;qr>>>=5;var us=qr&15;qr>>>=4,Zr.setMilliseconds(0),Zr.setFullYear(qr+1980),Zr.setMonth(us-1),Zr.setDate(ns);var _s=os&31;os>>>=5;var Fs=os&63;return os>>>=6,Zr.setHours(os),Zr.setMinutes(Fs),Zr.setSeconds(_s<<1),Zr}function pr(zr){prep_blob(zr,0);for(var os={},qr=0;zr.l<=zr.length-4;){var Zr=zr.read_shift(2),ns=zr.read_shift(2),us=zr.l+ns,_s={};switch(Zr){case 21589:qr=zr.read_shift(1),qr&1&&(_s.mtime=zr.read_shift(4)),ns>5&&(qr&2&&(_s.atime=zr.read_shift(4)),qr&4&&(_s.ctime=zr.read_shift(4))),_s.mtime&&(_s.mt=new Date(_s.mtime*1e3));break}zr.l=us,os[Zr]=_s}return os}var xr;function mr(){return xr||(xr={})}function fr(zr,os){if(zr[0]==80&&zr[1]==75)return eo(zr,os);if((zr[0]|32)==109&&(zr[1]|32)==105)return vs(zr,os);if(zr.length<512)throw new Error("CFB file size "+zr.length+" < 512");var qr=3,Zr=512,ns=0,us=0,_s=0,Fs=0,Ps=0,As=[],Ms=zr.slice(0,512);prep_blob(Ms,0);var Vs=Er(Ms);switch(qr=Vs[0],qr){case 3:Zr=512;break;case 4:Zr=4096;break;case 0:if(Vs[1]==0)return eo(zr,os);default:throw new Error("Major Version: Expected 3 or 4 saw "+qr)}Zr!==512&&(Ms=zr.slice(0,Zr),prep_blob(Ms,28));var Xs=zr.slice(0,Zr);vr(Ms,qr);var _a=Ms.read_shift(4,"i");if(qr===3&&_a!==0)throw new Error("# Directory Sectors: Expected 0 saw "+_a);Ms.l+=4,_s=Ms.read_shift(4,"i"),Ms.l+=4,Ms.chk("00100000","Mini Stream Cutoff Size: "),Fs=Ms.read_shift(4,"i"),ns=Ms.read_shift(4,"i"),Ps=Ms.read_shift(4,"i"),us=Ms.read_shift(4,"i");for(var Ks=-1,ba=0;ba<109&&(Ks=Ms.read_shift(4,"i"),!(Ks<0));++ba)As[ba]=Ks;var so=gr(zr,Zr);br(Ps,us,so,Zr,As);var ao=wr(so,_s,As,Zr);ao[_s].name="!Directory",ns>0&&Fs!==Wr&&(ao[Fs].name="!MiniFAT"),ao[As[0]].name="!FAT",ao.fat_addrs=As,ao.ssz=Zr;var oo={},lo=[],yo=[],jo=[];Rr(_s,ao,so,lo,ns,oo,yo,Fs),yr(yo,jo,lo),lo.shift();var bo={FileIndex:yo,FullPaths:jo};return os&&os.raw&&(bo.raw={header:Xs,sectors:so}),bo}function Er(zr){if(zr[zr.l]==80&&zr[zr.l+1]==75)return[0,0];zr.chk(Yr,"Header Signature: "),zr.l+=16;var os=zr.read_shift(2,"u");return[zr.read_shift(2,"u"),os]}function vr(zr,os){var qr=9;switch(zr.l+=2,qr=zr.read_shift(2)){case 9:if(os!=3)throw new Error("Sector Shift: Expected 9 saw "+qr);break;case 12:if(os!=4)throw new Error("Sector Shift: Expected 12 saw "+qr);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+qr)}zr.chk("0600","Mini Sector Shift: "),zr.chk("000000000000","Reserved: ")}function gr(zr,os){for(var qr=Math.ceil(zr.length/os)-1,Zr=[],ns=1;ns<qr;++ns)Zr[ns-1]=zr.slice(ns*os,(ns+1)*os);return Zr[qr-1]=zr.slice(qr*os),Zr}function yr(zr,os,qr){for(var Zr=0,ns=0,us=0,_s=0,Fs=0,Ps=qr.length,As=[],Ms=[];Zr<Ps;++Zr)As[Zr]=Ms[Zr]=Zr,os[Zr]=qr[Zr];for(;Fs<Ms.length;++Fs)Zr=Ms[Fs],ns=zr[Zr].L,us=zr[Zr].R,_s=zr[Zr].C,As[Zr]===Zr&&(ns!==-1&&As[ns]!==ns&&(As[Zr]=As[ns]),us!==-1&&As[us]!==us&&(As[Zr]=As[us])),_s!==-1&&(As[_s]=Zr),ns!==-1&&Zr!=As[Zr]&&(As[ns]=As[Zr],Ms.lastIndexOf(ns)<Fs&&Ms.push(ns)),us!==-1&&Zr!=As[Zr]&&(As[us]=As[Zr],Ms.lastIndexOf(us)<Fs&&Ms.push(us));for(Zr=1;Zr<Ps;++Zr)As[Zr]===Zr&&(us!==-1&&As[us]!==us?As[Zr]=As[us]:ns!==-1&&As[ns]!==ns&&(As[Zr]=As[ns]));for(Zr=1;Zr<Ps;++Zr)if(zr[Zr].type!==0){if(Fs=Zr,Fs!=As[Fs])do Fs=As[Fs],os[Zr]=os[Fs]+"/"+os[Zr];while(Fs!==0&&As[Fs]!==-1&&Fs!=As[Fs]);As[Zr]=-1}for(os[0]+="/",Zr=1;Zr<Ps;++Zr)zr[Zr].type!==2&&(os[Zr]+="/")}function jr(zr,os,qr){for(var Zr=zr.start,ns=zr.size,us=[],_s=Zr;qr&&ns>0&&_s>=0;)us.push(os.slice(_s*Br,_s*Br+Br)),ns-=Br,_s=__readInt32LE(qr,_s*4);return us.length===0?new_buf(0):bconcat(us).slice(0,zr.size)}function br(zr,os,qr,Zr,ns){var us=Wr;if(zr===Wr){if(os!==0)throw new Error("DIFAT chain shorter than expected")}else if(zr!==-1){var _s=qr[zr],Fs=(Zr>>>2)-1;if(!_s)return;for(var Ps=0;Ps<Fs&&(us=__readInt32LE(_s,Ps*4))!==Wr;++Ps)ns.push(us);br(__readInt32LE(_s,Zr-4),os-1,qr,Zr,ns)}}function _r(zr,os,qr,Zr,ns){var us=[],_s=[];ns||(ns=[]);var Fs=Zr-1,Ps=0,As=0;for(Ps=os;Ps>=0;){ns[Ps]=!0,us[us.length]=Ps,_s.push(zr[Ps]);var Ms=qr[Math.floor(Ps*4/Zr)];if(As=Ps*4&Fs,Zr<4+As)throw new Error("FAT boundary crossed: "+Ps+" 4 "+Zr);if(!zr[Ms])break;Ps=__readInt32LE(zr[Ms],As)}return{nodes:us,data:__toBuffer([_s])}}function wr(zr,os,qr,Zr){var ns=zr.length,us=[],_s=[],Fs=[],Ps=[],As=Zr-1,Ms=0,Vs=0,Xs=0,_a=0;for(Ms=0;Ms<ns;++Ms)if(Fs=[],Xs=Ms+os,Xs>=ns&&(Xs-=ns),!_s[Xs]){Ps=[];var Ks=[];for(Vs=Xs;Vs>=0;){Ks[Vs]=!0,_s[Vs]=!0,Fs[Fs.length]=Vs,Ps.push(zr[Vs]);var ba=qr[Math.floor(Vs*4/Zr)];if(_a=Vs*4&As,Zr<4+_a)throw new Error("FAT boundary crossed: "+Vs+" 4 "+Zr);if(!zr[ba]||(Vs=__readInt32LE(zr[ba],_a),Ks[Vs]))break}us[Xs]={nodes:Fs,data:__toBuffer([Ps])}}return us}function Rr(zr,os,qr,Zr,ns,us,_s,Fs){for(var Ps=0,As=Zr.length?2:0,Ms=os[zr].data,Vs=0,Xs=0,_a;Vs<Ms.length;Vs+=128){var Ks=Ms.slice(Vs,Vs+128);prep_blob(Ks,64),Xs=Ks.read_shift(2),_a=__utf16le(Ks,0,Xs-As),Zr.push(_a);var ba={name:_a,type:Ks.read_shift(1),color:Ks.read_shift(1),L:Ks.read_shift(4,"i"),R:Ks.read_shift(4,"i"),C:Ks.read_shift(4,"i"),clsid:Ks.read_shift(16),state:Ks.read_shift(4,"i"),start:0,size:0},so=Ks.read_shift(2)+Ks.read_shift(2)+Ks.read_shift(2)+Ks.read_shift(2);so!==0&&(ba.ct=Ar(Ks,Ks.l-8));var ao=Ks.read_shift(2)+Ks.read_shift(2)+Ks.read_shift(2)+Ks.read_shift(2);ao!==0&&(ba.mt=Ar(Ks,Ks.l-8)),ba.start=Ks.read_shift(4,"i"),ba.size=Ks.read_shift(4,"i"),ba.size<0&&ba.start<0&&(ba.size=ba.type=0,ba.start=Wr,ba.name=""),ba.type===5?(Ps=ba.start,ns>0&&Ps!==Wr&&(os[Ps].name="!StreamData")):ba.size>=4096?(ba.storage="fat",os[ba.start]===void 0&&(os[ba.start]=_r(qr,ba.start,os.fat_addrs,os.ssz)),os[ba.start].name=ba.name,ba.content=os[ba.start].data.slice(0,ba.size)):(ba.storage="minifat",ba.size<0?ba.size=0:Ps!==Wr&&ba.start!==Wr&&os[Ps]&&(ba.content=jr(ba,os[Ps].data,(os[Fs]||{}).data))),ba.content&&prep_blob(ba.content,0),us[_a]=ba,_s.push(ba)}}function Ar(zr,os){return new Date((__readUInt32LE(zr,os+4)/1e7*Math.pow(2,32)+__readUInt32LE(zr,os)/1e7-11644473600)*1e3)}function Sr(zr,os){return mr(),fr(xr.readFileSync(zr),os)}function kr(zr,os){var qr=os&&os.type;switch(qr||has_buf&&Buffer.isBuffer(zr)&&(qr="buffer"),qr||"base64"){case"file":return Sr(zr,os);case"base64":return fr(s2a(Base64_decode(zr)),os);case"binary":return fr(s2a(zr),os)}return fr(zr,os)}function Nr(zr,os){var qr=os||{},Zr=qr.root||"Root Entry";if(zr.FullPaths||(zr.FullPaths=[]),zr.FileIndex||(zr.FileIndex=[]),zr.FullPaths.length!==zr.FileIndex.length)throw new Error("inconsistent CFB structure");zr.FullPaths.length===0&&(zr.FullPaths[0]=Zr+"/",zr.FileIndex[0]={name:Zr,type:5}),qr.CLSID&&(zr.FileIndex[0].clsid=qr.CLSID),Cr(zr)}function Cr(zr){var os="Sh33tJ5";if(!CFB.find(zr,"/"+os)){var qr=new_buf(4);qr[0]=55,qr[1]=qr[3]=50,qr[2]=54,zr.FileIndex.push({name:os,type:2,content:qr,size:4,L:69,R:69,C:69}),zr.FullPaths.push(zr.FullPaths[0]+os),Tr(zr)}}function Tr(zr,os){Nr(zr);for(var qr=!1,Zr=!1,ns=zr.FullPaths.length-1;ns>=0;--ns){var us=zr.FileIndex[ns];switch(us.type){case 0:Zr?qr=!0:(zr.FileIndex.pop(),zr.FullPaths.pop());break;case 1:case 2:case 5:Zr=!0,isNaN(us.R*us.L*us.C)&&(qr=!0),us.R>-1&&us.L>-1&&us.R==us.L&&(qr=!0);break;default:qr=!0;break}}if(!(!qr&&!os)){var _s=new Date(1987,1,19),Fs=0,Ps=Object.create?Object.create(null):{},As=[];for(ns=0;ns<zr.FullPaths.length;++ns)Ps[zr.FullPaths[ns]]=!0,zr.FileIndex[ns].type!==0&&As.push([zr.FullPaths[ns],zr.FileIndex[ns]]);for(ns=0;ns<As.length;++ns){var Ms=cr(As[ns][0]);Zr=Ps[Ms],Zr||(As.push([Ms,{name:ur(Ms).replace("/",""),type:1,clsid:ps,ct:_s,mt:_s,content:null}]),Ps[Ms]=!0)}for(As.sort(function(_a,Ks){return lr(_a[0],Ks[0])}),zr.FullPaths=[],zr.FileIndex=[],ns=0;ns<As.length;++ns)zr.FullPaths[ns]=As[ns][0],zr.FileIndex[ns]=As[ns][1];for(ns=0;ns<As.length;++ns){var Vs=zr.FileIndex[ns],Xs=zr.FullPaths[ns];if(Vs.name=ur(Xs).replace("/",""),Vs.L=Vs.R=Vs.C=-(Vs.color=1),Vs.size=Vs.content?Vs.content.length:0,Vs.start=0,Vs.clsid=Vs.clsid||ps,ns===0)Vs.C=As.length>1?1:-1,Vs.size=0,Vs.type=5;else if(Xs.slice(-1)=="/"){for(Fs=ns+1;Fs<As.length&&cr(zr.FullPaths[Fs])!=Xs;++Fs);for(Vs.C=Fs>=As.length?-1:Fs,Fs=ns+1;Fs<As.length&&cr(zr.FullPaths[Fs])!=cr(Xs);++Fs);Vs.R=Fs>=As.length?-1:Fs,Vs.type=1}else cr(zr.FullPaths[ns+1]||"")==cr(Xs)&&(Vs.R=ns+1),Vs.type=2}}}function Pr(zr,os){var qr=os||{};if(qr.fileType=="mad")return Ls(zr,qr);switch(Tr(zr),qr.fileType){case"zip":return Os(zr,qr)}var Zr=function(_a){for(var Ks=0,ba=0,so=0;so<_a.FileIndex.length;++so){var ao=_a.FileIndex[so];if(ao.content){var oo=ao.content.length;oo>0&&(oo<4096?Ks+=oo+63>>6:ba+=oo+511>>9)}}for(var lo=_a.FullPaths.length+3>>2,yo=Ks+7>>3,jo=Ks+127>>7,bo=yo+ba+lo+jo,po=bo+127>>7,Vo=po<=109?0:Math.ceil((po-109)/127);bo+po+Vo+127>>7>po;)Vo=++po<=109?0:Math.ceil((po-109)/127);var uo=[1,Vo,po,jo,lo,ba,Ks,0];return _a.FileIndex[0].size=Ks<<6,uo[7]=(_a.FileIndex[0].start=uo[0]+uo[1]+uo[2]+uo[3]+uo[4]+uo[5])+(uo[6]+7>>3),uo}(zr),ns=new_buf(Zr[7]<<9),us=0,_s=0;{for(us=0;us<8;++us)ns.write_shift(1,es[us]);for(us=0;us<8;++us)ns.write_shift(2,0);for(ns.write_shift(2,62),ns.write_shift(2,3),ns.write_shift(2,65534),ns.write_shift(2,9),ns.write_shift(2,6),us=0;us<3;++us)ns.write_shift(2,0);for(ns.write_shift(4,0),ns.write_shift(4,Zr[2]),ns.write_shift(4,Zr[0]+Zr[1]+Zr[2]+Zr[3]-1),ns.write_shift(4,0),ns.write_shift(4,4096),ns.write_shift(4,Zr[3]?Zr[0]+Zr[1]+Zr[2]-1:Wr),ns.write_shift(4,Zr[3]),ns.write_shift(-4,Zr[1]?Zr[0]-1:Wr),ns.write_shift(4,Zr[1]),us=0;us<109;++us)ns.write_shift(-4,us<Zr[2]?Zr[1]+us:-1)}if(Zr[1])for(_s=0;_s<Zr[1];++_s){for(;us<236+_s*127;++us)ns.write_shift(-4,us<Zr[2]?Zr[1]+us:-1);ns.write_shift(-4,_s===Zr[1]-1?Wr:_s+1)}var Fs=function(_a){for(_s+=_a;us<_s-1;++us)ns.write_shift(-4,us+1);_a&&(++us,ns.write_shift(-4,Wr))};for(_s=us=0,_s+=Zr[1];us<_s;++us)ns.write_shift(-4,ts.DIFSECT);for(_s+=Zr[2];us<_s;++us)ns.write_shift(-4,ts.FATSECT);Fs(Zr[3]),Fs(Zr[4]);for(var Ps=0,As=0,Ms=zr.FileIndex[0];Ps<zr.FileIndex.length;++Ps)Ms=zr.FileIndex[Ps],Ms.content&&(As=Ms.content.length,!(As<4096)&&(Ms.start=_s,Fs(As+511>>9)));for(Fs(Zr[6]+7>>3);ns.l&511;)ns.write_shift(-4,ts.ENDOFCHAIN);for(_s=us=0,Ps=0;Ps<zr.FileIndex.length;++Ps)Ms=zr.FileIndex[Ps],Ms.content&&(As=Ms.content.length,!(!As||As>=4096)&&(Ms.start=_s,Fs(As+63>>6)));for(;ns.l&511;)ns.write_shift(-4,ts.ENDOFCHAIN);for(us=0;us<Zr[4]<<2;++us){var Vs=zr.FullPaths[us];if(!Vs||Vs.length===0){for(Ps=0;Ps<17;++Ps)ns.write_shift(4,0);for(Ps=0;Ps<3;++Ps)ns.write_shift(4,-1);for(Ps=0;Ps<12;++Ps)ns.write_shift(4,0);continue}Ms=zr.FileIndex[us],us===0&&(Ms.start=Ms.size?Ms.start-1:Wr);var Xs=us===0&&qr.root||Ms.name;if(As=2*(Xs.length+1),ns.write_shift(64,Xs,"utf16le"),ns.write_shift(2,As),ns.write_shift(1,Ms.type),ns.write_shift(1,Ms.color),ns.write_shift(-4,Ms.L),ns.write_shift(-4,Ms.R),ns.write_shift(-4,Ms.C),Ms.clsid)ns.write_shift(16,Ms.clsid,"hex");else for(Ps=0;Ps<4;++Ps)ns.write_shift(4,0);ns.write_shift(4,Ms.state||0),ns.write_shift(4,0),ns.write_shift(4,0),ns.write_shift(4,0),ns.write_shift(4,0),ns.write_shift(4,Ms.start),ns.write_shift(4,Ms.size),ns.write_shift(4,0)}for(us=1;us<zr.FileIndex.length;++us)if(Ms=zr.FileIndex[us],Ms.size>=4096)if(ns.l=Ms.start+1<<9,has_buf&&Buffer.isBuffer(Ms.content))Ms.content.copy(ns,ns.l,0,Ms.size),ns.l+=Ms.size+511&-512;else{for(Ps=0;Ps<Ms.size;++Ps)ns.write_shift(1,Ms.content[Ps]);for(;Ps&511;++Ps)ns.write_shift(1,0)}for(us=1;us<zr.FileIndex.length;++us)if(Ms=zr.FileIndex[us],Ms.size>0&&Ms.size<4096)if(has_buf&&Buffer.isBuffer(Ms.content))Ms.content.copy(ns,ns.l,0,Ms.size),ns.l+=Ms.size+63&-64;else{for(Ps=0;Ps<Ms.size;++Ps)ns.write_shift(1,Ms.content[Ps]);for(;Ps&63;++Ps)ns.write_shift(1,0)}if(has_buf)ns.l=ns.length;else for(;ns.l<ns.length;)ns.write_shift(1,0);return ns}function Ir(zr,os){var qr=zr.FullPaths.map(function(Ps){return Ps.toUpperCase()}),Zr=qr.map(function(Ps){var As=Ps.split("/");return As[As.length-(Ps.slice(-1)=="/"?2:1)]}),ns=!1;os.charCodeAt(0)===47?(ns=!0,os=qr[0].slice(0,-1)+os):ns=os.indexOf("/")!==-1;var us=os.toUpperCase(),_s=ns===!0?qr.indexOf(us):Zr.indexOf(us);if(_s!==-1)return zr.FileIndex[_s];var Fs=!us.match(chr1);for(us=us.replace(chr0,""),Fs&&(us=us.replace(chr1,"!")),_s=0;_s<qr.length;++_s)if((Fs?qr[_s].replace(chr1,"!"):qr[_s]).replace(chr0,"")==us||(Fs?Zr[_s].replace(chr1,"!"):Zr[_s]).replace(chr0,"")==us)return zr.FileIndex[_s];return null}var Br=64,Wr=-2,Yr="d0cf11e0a1b11ae1",es=[208,207,17,224,161,177,26,225],ps="00000000000000000000000000000000",ts={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:Wr,FREESECT:-1,HEADER_SIGNATURE:Yr,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:ps,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Qr(zr,os,qr){mr();var Zr=Pr(zr,qr);xr.writeFileSync(os,Zr)}function Hr(zr){for(var os=new Array(zr.length),qr=0;qr<zr.length;++qr)os[qr]=String.fromCharCode(zr[qr]);return os.join("")}function Kr(zr,os){var qr=Pr(zr,os);switch(os&&os.type||"buffer"){case"file":return mr(),xr.writeFileSync(os.filename,qr),qr;case"binary":return typeof qr=="string"?qr:Hr(qr);case"base64":return Base64_encode(typeof qr=="string"?qr:Hr(qr));case"buffer":if(has_buf)return Buffer.isBuffer(qr)?qr:Buffer_from(qr);case"array":return typeof qr=="string"?s2a(qr):qr}return qr}var rs;function Mr(zr){try{var os=zr.InflateRaw,qr=new os;if(qr._processChunk(new Uint8Array([3,0]),qr._finishFlushFlag),qr.bytesRead)rs=zr;else throw new Error("zlib does not expose bytesRead")}catch(Zr){console.error("cannot use native zlib: "+(Zr.message||Zr))}}function Dr(zr,os){if(!rs)return qs(zr,os);var qr=rs.InflateRaw,Zr=new qr,ns=Zr._processChunk(zr.slice(zr.l),Zr._finishFlushFlag);return zr.l+=Zr.bytesRead,ns}function Lr(zr){return rs?rs.deflateRawSync(zr):$a(zr)}var Fr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Vr=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function Gr(zr){var os=(zr<<1|zr<<11)&139536|(zr<<5|zr<<15)&558144;return(os>>16|os>>8|os)&255}for(var Jr=typeof Uint8Array<"u",ms=Jr?new Uint8Array(256):[],ls=0;ls<256;++ls)ms[ls]=Gr(ls);function ds(zr,os){var qr=ms[zr&255];return os<=8?qr>>>8-os:(qr=qr<<8|ms[zr>>8&255],os<=16?qr>>>16-os:(qr=qr<<8|ms[zr>>16&255],qr>>>24-os))}function bs(zr,os){var qr=os&7,Zr=os>>>3;return(zr[Zr]|(qr<=6?0:zr[Zr+1]<<8))>>>qr&3}function ws(zr,os){var qr=os&7,Zr=os>>>3;return(zr[Zr]|(qr<=5?0:zr[Zr+1]<<8))>>>qr&7}function Is(zr,os){var qr=os&7,Zr=os>>>3;return(zr[Zr]|(qr<=4?0:zr[Zr+1]<<8))>>>qr&15}function ys(zr,os){var qr=os&7,Zr=os>>>3;return(zr[Zr]|(qr<=3?0:zr[Zr+1]<<8))>>>qr&31}function ss(zr,os){var qr=os&7,Zr=os>>>3;return(zr[Zr]|(qr<=1?0:zr[Zr+1]<<8))>>>qr&127}function Ur(zr,os,qr){var Zr=os&7,ns=os>>>3,us=(1<<qr)-1,_s=zr[ns]>>>Zr;return qr<8-Zr||(_s|=zr[ns+1]<<8-Zr,qr<16-Zr)||(_s|=zr[ns+2]<<16-Zr,qr<24-Zr)||(_s|=zr[ns+3]<<24-Zr),_s&us}function Xr(zr,os,qr){var Zr=os&7,ns=os>>>3;return Zr<=5?zr[ns]|=(qr&7)<<Zr:(zr[ns]|=qr<<Zr&255,zr[ns+1]=(qr&7)>>8-Zr),os+3}function cs(zr,os,qr){var Zr=os&7,ns=os>>>3;return qr=(qr&1)<<Zr,zr[ns]|=qr,os+1}function xs(zr,os,qr){var Zr=os&7,ns=os>>>3;return qr<<=Zr,zr[ns]|=qr&255,qr>>>=8,zr[ns+1]=qr,os+8}function Es(zr,os,qr){var Zr=os&7,ns=os>>>3;return qr<<=Zr,zr[ns]|=qr&255,qr>>>=8,zr[ns+1]=qr&255,zr[ns+2]=qr>>>8,os+16}function Ns(zr,os){var qr=zr.length,Zr=2*qr>os?2*qr:os+5,ns=0;if(qr>=os)return zr;if(has_buf){var us=new_unsafe_buf(Zr);if(zr.copy)zr.copy(us);else for(;ns<zr.length;++ns)us[ns]=zr[ns];return us}else if(Jr){var _s=new Uint8Array(Zr);if(_s.set)_s.set(zr);else for(;ns<qr;++ns)_s[ns]=zr[ns];return _s}return zr.length=Zr,zr}function Ts(zr){for(var os=new Array(zr),qr=0;qr<zr;++qr)os[qr]=0;return os}function gs(zr,os,qr){var Zr=1,ns=0,us=0,_s=0,Fs=0,Ps=zr.length,As=Jr?new Uint16Array(32):Ts(32);for(us=0;us<32;++us)As[us]=0;for(us=Ps;us<qr;++us)zr[us]=0;Ps=zr.length;var Ms=Jr?new Uint16Array(Ps):Ts(Ps);for(us=0;us<Ps;++us)As[ns=zr[us]]++,Zr<ns&&(Zr=ns),Ms[us]=0;for(As[0]=0,us=1;us<=Zr;++us)As[us+16]=Fs=Fs+As[us-1]<<1;for(us=0;us<Ps;++us)Fs=zr[us],Fs!=0&&(Ms[us]=As[Fs+16]++);var Vs=0;for(us=0;us<Ps;++us)if(Vs=zr[us],Vs!=0)for(Fs=ds(Ms[us],Zr)>>Zr-Vs,_s=(1<<Zr+4-Vs)-1;_s>=0;--_s)os[Fs|_s<<Vs]=Vs&15|us<<4;return Zr}var Hs=Jr?new Uint16Array(512):Ts(512),Us=Jr?new Uint16Array(32):Ts(32);if(!Jr){for(var xa=0;xa<512;++xa)Hs[xa]=0;for(xa=0;xa<32;++xa)Us[xa]=0}(function(){for(var zr=[],os=0;os<32;os++)zr.push(5);gs(zr,Us,32);var qr=[];for(os=0;os<=143;os++)qr.push(8);for(;os<=255;os++)qr.push(9);for(;os<=279;os++)qr.push(7);for(;os<=287;os++)qr.push(8);gs(qr,Hs,288)})();var Gs=function(){for(var os=Jr?new Uint8Array(32768):[],qr=0,Zr=0;qr<Vr.length-1;++qr)for(;Zr<Vr[qr+1];++Zr)os[Zr]=qr;for(;Zr<32768;++Zr)os[Zr]=29;var ns=Jr?new Uint8Array(259):[];for(qr=0,Zr=0;qr<$r.length-1;++qr)for(;Zr<$r[qr+1];++Zr)ns[Zr]=qr;function us(Fs,Ps){for(var As=0;As<Fs.length;){var Ms=Math.min(65535,Fs.length-As),Vs=As+Ms==Fs.length;for(Ps.write_shift(1,+Vs),Ps.write_shift(2,Ms),Ps.write_shift(2,~Ms&65535);Ms-- >0;)Ps[Ps.l++]=Fs[As++]}return Ps.l}function _s(Fs,Ps){for(var As=0,Ms=0,Vs=Jr?new Uint16Array(32768):[];Ms<Fs.length;){var Xs=Math.min(65535,Fs.length-Ms);if(Xs<10){for(As=Xr(Ps,As,+(Ms+Xs==Fs.length)),As&7&&(As+=8-(As&7)),Ps.l=As/8|0,Ps.write_shift(2,Xs),Ps.write_shift(2,~Xs&65535);Xs-- >0;)Ps[Ps.l++]=Fs[Ms++];As=Ps.l*8;continue}As=Xr(Ps,As,+(Ms+Xs==Fs.length)+2);for(var _a=0;Xs-- >0;){var Ks=Fs[Ms];_a=(_a<<5^Ks)&32767;var ba=-1,so=0;if((ba=Vs[_a])&&(ba|=Ms&-32768,ba>Ms&&(ba-=32768),ba<Ms))for(;Fs[ba+so]==Fs[Ms+so]&&so<250;)++so;if(so>2){Ks=ns[so],Ks<=22?As=xs(Ps,As,ms[Ks+1]>>1)-1:(xs(Ps,As,3),As+=5,xs(Ps,As,ms[Ks-23]>>5),As+=3);var ao=Ks<8?0:Ks-4>>2;ao>0&&(Es(Ps,As,so-$r[Ks]),As+=ao),Ks=os[Ms-ba],As=xs(Ps,As,ms[Ks]>>3),As-=3;var oo=Ks<4?0:Ks-2>>1;oo>0&&(Es(Ps,As,Ms-ba-Vr[Ks]),As+=oo);for(var lo=0;lo<so;++lo)Vs[_a]=Ms&32767,_a=(_a<<5^Fs[Ms])&32767,++Ms;Xs-=so-1}else Ks<=143?Ks=Ks+48:As=cs(Ps,As,1),As=xs(Ps,As,ms[Ks]),Vs[_a]=Ms&32767,++Ms}As=xs(Ps,As,0)-1}return Ps.l=(As+7)/8|0,Ps.l}return function(Ps,As){return Ps.length<8?us(Ps,As):_s(Ps,As)}}();function $a(zr){var os=new_buf(50+Math.floor(zr.length*1.1)),qr=Gs(zr,os);return os.slice(0,qr)}var Js=Jr?new Uint16Array(32768):Ts(32768),ga=Jr?new Uint16Array(32768):Ts(32768),ro=Jr?new Uint16Array(128):Ts(128),no=1,$s=1;function Rs(zr,os){var qr=ys(zr,os)+257;os+=5;var Zr=ys(zr,os)+1;os+=5;var ns=Is(zr,os)+4;os+=4;for(var us=0,_s=Jr?new Uint8Array(19):Ts(19),Fs=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ps=1,As=Jr?new Uint8Array(8):Ts(8),Ms=Jr?new Uint8Array(8):Ts(8),Vs=_s.length,Xs=0;Xs<ns;++Xs)_s[Fr[Xs]]=us=ws(zr,os),Ps<us&&(Ps=us),As[us]++,os+=3;var _a=0;for(As[0]=0,Xs=1;Xs<=Ps;++Xs)Ms[Xs]=_a=_a+As[Xs-1]<<1;for(Xs=0;Xs<Vs;++Xs)(_a=_s[Xs])!=0&&(Fs[Xs]=Ms[_a]++);var Ks=0;for(Xs=0;Xs<Vs;++Xs)if(Ks=_s[Xs],Ks!=0){_a=ms[Fs[Xs]]>>8-Ks;for(var ba=(1<<7-Ks)-1;ba>=0;--ba)ro[_a|ba<<Ks]=Ks&7|Xs<<3}var so=[];for(Ps=1;so.length<qr+Zr;)switch(_a=ro[ss(zr,os)],os+=_a&7,_a>>>=3){case 16:for(us=3+bs(zr,os),os+=2,_a=so[so.length-1];us-- >0;)so.push(_a);break;case 17:for(us=3+ws(zr,os),os+=3;us-- >0;)so.push(0);break;case 18:for(us=11+ss(zr,os),os+=7;us-- >0;)so.push(0);break;default:so.push(_a),Ps<_a&&(Ps=_a);break}var ao=so.slice(0,qr),oo=so.slice(qr);for(Xs=qr;Xs<286;++Xs)ao[Xs]=0;for(Xs=Zr;Xs<30;++Xs)oo[Xs]=0;return no=gs(ao,Js,286),$s=gs(oo,ga,30),os}function ks(zr,os){if(zr[0]==3&&!(zr[1]&3))return[new_raw_buf(os),2];for(var qr=0,Zr=0,ns=new_unsafe_buf(os||1<<18),us=0,_s=ns.length>>>0,Fs=0,Ps=0;!(Zr&1);){if(Zr=ws(zr,qr),qr+=3,Zr>>>1)Zr>>1==1?(Fs=9,Ps=5):(qr=Rs(zr,qr),Fs=no,Ps=$s);else{qr&7&&(qr+=8-(qr&7));var As=zr[qr>>>3]|zr[(qr>>>3)+1]<<8;if(qr+=32,As>0)for(!os&&_s<us+As&&(ns=Ns(ns,us+As),_s=ns.length);As-- >0;)ns[us++]=zr[qr>>>3],qr+=8;continue}for(;;){!os&&_s<us+32767&&(ns=Ns(ns,us+32767),_s=ns.length);var Ms=Ur(zr,qr,Fs),Vs=Zr>>>1==1?Hs[Ms]:Js[Ms];if(qr+=Vs&15,Vs>>>=4,!(Vs>>>8&255))ns[us++]=Vs;else{if(Vs==256)break;Vs-=257;var Xs=Vs<8?0:Vs-4>>2;Xs>5&&(Xs=0);var _a=us+$r[Vs];Xs>0&&(_a+=Ur(zr,qr,Xs),qr+=Xs),Ms=Ur(zr,qr,Ps),Vs=Zr>>>1==1?Us[Ms]:ga[Ms],qr+=Vs&15,Vs>>>=4;var Ks=Vs<4?0:Vs-2>>1,ba=Vr[Vs];for(Ks>0&&(ba+=Ur(zr,qr,Ks),qr+=Ks),!os&&_s<_a&&(ns=Ns(ns,_a+100),_s=ns.length);us<_a;)ns[us]=ns[us-ba],++us}}}return os?[ns,qr+7>>>3]:[ns.slice(0,us),qr+7>>>3]}function qs(zr,os){var qr=zr.slice(zr.l||0),Zr=ks(qr,os);return zr.l+=Zr[1],Zr[0]}function to(zr,os){if(zr)typeof console<"u"&&console.error(os);else throw new Error(os)}function eo(zr,os){var qr=zr;prep_blob(qr,0);var Zr=[],ns=[],us={FileIndex:Zr,FullPaths:ns};Nr(us,{root:os.root});for(var _s=qr.length-4;(qr[_s]!=80||qr[_s+1]!=75||qr[_s+2]!=5||qr[_s+3]!=6)&&_s>=0;)--_s;qr.l=_s+4,qr.l+=4;var Fs=qr.read_shift(2);qr.l+=6;var Ps=qr.read_shift(4);for(qr.l=Ps,_s=0;_s<Fs;++_s){qr.l+=20;var As=qr.read_shift(4),Ms=qr.read_shift(4),Vs=qr.read_shift(2),Xs=qr.read_shift(2),_a=qr.read_shift(2);qr.l+=8;var Ks=qr.read_shift(4),ba=pr(qr.slice(qr.l+Vs,qr.l+Vs+Xs));qr.l+=Vs+Xs+_a;var so=qr.l;qr.l=Ks+4,fs(qr,As,Ms,us,ba),qr.l=so}return us}function fs(zr,os,qr,Zr,ns){zr.l+=2;var us=zr.read_shift(2),_s=zr.read_shift(2),Fs=hr(zr);if(us&8257)throw new Error("Unsupported ZIP encryption");for(var Ps=zr.read_shift(4),As=zr.read_shift(4),Ms=zr.read_shift(4),Vs=zr.read_shift(2),Xs=zr.read_shift(2),_a="",Ks=0;Ks<Vs;++Ks)_a+=String.fromCharCode(zr[zr.l++]);if(Xs){var ba=pr(zr.slice(zr.l,zr.l+Xs));(ba[21589]||{}).mt&&(Fs=ba[21589].mt),((ns||{})[21589]||{}).mt&&(Fs=ns[21589].mt)}zr.l+=Xs;var so=zr.slice(zr.l,zr.l+As);switch(_s){case 8:so=Dr(zr,Ms);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+_s)}var ao=!1;us&8&&(Ps=zr.read_shift(4),Ps==134695760&&(Ps=zr.read_shift(4),ao=!0),As=zr.read_shift(4),Ms=zr.read_shift(4)),As!=os&&to(ao,"Bad compressed size: "+os+" != "+As),Ms!=qr&&to(ao,"Bad uncompressed size: "+qr+" != "+Ms),Bs(Zr,_a,so,{unsafe:!0,mt:Fs})}function Os(zr,os){var qr=os||{},Zr=[],ns=[],us=new_buf(1),_s=qr.compression?8:0,Fs=0,Ps=0,As=0,Ms=0,Vs=0,Xs=zr.FullPaths[0],_a=Xs,Ks=zr.FileIndex[0],ba=[],so=0;for(Ps=1;Ps<zr.FullPaths.length;++Ps)if(_a=zr.FullPaths[Ps].slice(Xs.length),Ks=zr.FileIndex[Ps],!(!Ks.size||!Ks.content||_a=="Sh33tJ5")){var ao=Ms,oo=new_buf(_a.length);for(As=0;As<_a.length;++As)oo.write_shift(1,_a.charCodeAt(As)&127);oo=oo.slice(0,oo.l),ba[Vs]=CRC32.buf(Ks.content,0);var lo=Ks.content;_s==8&&(lo=Lr(lo)),us=new_buf(30),us.write_shift(4,67324752),us.write_shift(2,20),us.write_shift(2,Fs),us.write_shift(2,_s),Ks.mt?dr(us,Ks.mt):us.write_shift(4,0),us.write_shift(-4,ba[Vs]),us.write_shift(4,lo.length),us.write_shift(4,Ks.content.length),us.write_shift(2,oo.length),us.write_shift(2,0),Ms+=us.length,Zr.push(us),Ms+=oo.length,Zr.push(oo),Ms+=lo.length,Zr.push(lo),us=new_buf(46),us.write_shift(4,33639248),us.write_shift(2,0),us.write_shift(2,20),us.write_shift(2,Fs),us.write_shift(2,_s),us.write_shift(4,0),us.write_shift(-4,ba[Vs]),us.write_shift(4,lo.length),us.write_shift(4,Ks.content.length),us.write_shift(2,oo.length),us.write_shift(2,0),us.write_shift(2,0),us.write_shift(2,0),us.write_shift(2,0),us.write_shift(4,0),us.write_shift(4,ao),so+=us.l,ns.push(us),so+=oo.length,ns.push(oo),++Vs}return us=new_buf(22),us.write_shift(4,101010256),us.write_shift(2,0),us.write_shift(2,0),us.write_shift(2,Vs),us.write_shift(2,Vs),us.write_shift(4,so),us.write_shift(4,Ms),us.write_shift(2,0),bconcat([bconcat(Zr),bconcat(ns),us])}var zs={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Zs(zr,os){if(zr.ctype)return zr.ctype;var qr=zr.name||"",Zr=qr.match(/\.([^\.]+)$/);return Zr&&zs[Zr[1]]||os&&(Zr=(qr=os).match(/[\.\\]([^\.\\])+$/),Zr&&zs[Zr[1]])?zs[Zr[1]]:"application/octet-stream"}function na(zr){for(var os=Base64_encode(zr),qr=[],Zr=0;Zr<os.length;Zr+=76)qr.push(os.slice(Zr,Zr+76));return qr.join(`\r
`)+`\r
`}function Ys(zr){var os=zr.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(As){var Ms=As.charCodeAt(0).toString(16).toUpperCase();return"="+(Ms.length==1?"0"+Ms:Ms)});os=os.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),os.charAt(0)==`
`&&(os="=0D"+os.slice(1)),os=os.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var qr=[],Zr=os.split(`\r
`),ns=0;ns<Zr.length;++ns){var us=Zr[ns];if(us.length==0){qr.push("");continue}for(var _s=0;_s<us.length;){var Fs=76,Ps=us.slice(_s,_s+Fs);Ps.charAt(Fs-1)=="="?Fs--:Ps.charAt(Fs-2)=="="?Fs-=2:Ps.charAt(Fs-3)=="="&&(Fs-=3),Ps=us.slice(_s,_s+Fs),_s+=Fs,_s<us.length&&(Ps+="="),qr.push(Ps)}}return qr.join(`\r
`)}function hs(zr){for(var os=[],qr=0;qr<zr.length;++qr){for(var Zr=zr[qr];qr<=zr.length&&Zr.charAt(Zr.length-1)=="=";)Zr=Zr.slice(0,Zr.length-1)+zr[++qr];os.push(Zr)}for(var ns=0;ns<os.length;++ns)os[ns]=os[ns].replace(/[=][0-9A-Fa-f]{2}/g,function(us){return String.fromCharCode(parseInt(us.slice(1),16))});return s2a(os.join(`\r
`))}function as(zr,os,qr){for(var Zr="",ns="",us="",_s,Fs=0;Fs<10;++Fs){var Ps=os[Fs];if(!Ps||Ps.match(/^\s*$/))break;var As=Ps.match(/^(.*?):\s*([^\s].*)$/);if(As)switch(As[1].toLowerCase()){case"content-location":Zr=As[2].trim();break;case"content-type":us=As[2].trim();break;case"content-transfer-encoding":ns=As[2].trim();break}}switch(++Fs,ns.toLowerCase()){case"base64":_s=s2a(Base64_decode(os.slice(Fs).join("")));break;case"quoted-printable":_s=hs(os.slice(Fs));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+ns)}var Ms=Bs(zr,Zr.slice(qr.length),_s,{unsafe:!0});us&&(Ms.ctype=us)}function vs(zr,os){if(Hr(zr.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var qr=os&&os.root||"",Zr=(has_buf&&Buffer.isBuffer(zr)?zr.toString("binary"):Hr(zr)).split(`\r
`),ns=0,us="";for(ns=0;ns<Zr.length;++ns)if(us=Zr[ns],!!/^Content-Location:/i.test(us)&&(us=us.slice(us.indexOf("file")),qr||(qr=us.slice(0,us.lastIndexOf("/")+1)),us.slice(0,qr.length)!=qr))for(;qr.length>0&&(qr=qr.slice(0,qr.length-1),qr=qr.slice(0,qr.lastIndexOf("/")+1),us.slice(0,qr.length)!=qr););var _s=(Zr[1]||"").match(/boundary="(.*?)"/);if(!_s)throw new Error("MAD cannot find boundary");var Fs="--"+(_s[1]||""),Ps=[],As=[],Ms={FileIndex:Ps,FullPaths:As};Nr(Ms);var Vs,Xs=0;for(ns=0;ns<Zr.length;++ns){var _a=Zr[ns];_a!==Fs&&_a!==Fs+"--"||(Xs++&&as(Ms,Zr.slice(Vs,ns),qr),Vs=ns)}return Ms}function Ls(zr,os){var qr=os||{},Zr=qr.boundary||"SheetJS";Zr="------="+Zr;for(var ns=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+Zr.slice(2)+'"',"","",""],us=zr.FullPaths[0],_s=us,Fs=zr.FileIndex[0],Ps=1;Ps<zr.FullPaths.length;++Ps)if(_s=zr.FullPaths[Ps].slice(us.length),Fs=zr.FileIndex[Ps],!(!Fs.size||!Fs.content||_s=="Sh33tJ5")){_s=_s.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(so){return"_x"+so.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(so){return"_u"+so.charCodeAt(0).toString(16)+"_"});for(var As=Fs.content,Ms=has_buf&&Buffer.isBuffer(As)?As.toString("binary"):Hr(As),Vs=0,Xs=Math.min(1024,Ms.length),_a=0,Ks=0;Ks<=Xs;++Ks)(_a=Ms.charCodeAt(Ks))>=32&&_a<128&&++Vs;var ba=Vs>=Xs*4/5;ns.push(Zr),ns.push("Content-Location: "+(qr.root||"file:///C:/SheetJS/")+_s),ns.push("Content-Transfer-Encoding: "+(ba?"quoted-printable":"base64")),ns.push("Content-Type: "+Zs(Fs,_s)),ns.push(""),ns.push(ba?Ys(Ms):na(Ms))}return ns.push(Zr+`--\r
`),ns.join(`\r
`)}function Ds(zr){var os={};return Nr(os,zr),os}function Bs(zr,os,qr,Zr){var ns=Zr&&Zr.unsafe;ns||Nr(zr);var us=!ns&&CFB.find(zr,os);if(!us){var _s=zr.FullPaths[0];os.slice(0,_s.length)==_s?_s=os:(_s.slice(-1)!="/"&&(_s+="/"),_s=(_s+os).replace("//","/")),us={name:ur(os),type:2},zr.FileIndex.push(us),zr.FullPaths.push(_s),ns||CFB.utils.cfb_gc(zr)}return us.content=qr,us.size=qr?qr.length:0,Zr&&(Zr.CLSID&&(us.clsid=Zr.CLSID),Zr.mt&&(us.mt=Zr.mt),Zr.ct&&(us.ct=Zr.ct)),us}function Ws(zr,os){Nr(zr);var qr=CFB.find(zr,os);if(qr){for(var Zr=0;Zr<zr.FileIndex.length;++Zr)if(zr.FileIndex[Zr]==qr)return zr.FileIndex.splice(Zr,1),zr.FullPaths.splice(Zr,1),!0}return!1}function _i(zr,os,qr){Nr(zr);var Zr=CFB.find(zr,os);if(Zr){for(var ns=0;ns<zr.FileIndex.length;++ns)if(zr.FileIndex[ns]==Zr)return zr.FileIndex[ns].name=ur(qr),zr.FullPaths[ns]=qr,!0}return!1}function Qs(zr){Tr(zr,!0)}return or.find=Ir,or.read=kr,or.parse=fr,or.write=Kr,or.writeFile=Qr,or.utils={cfb_new:Ds,cfb_add:Bs,cfb_del:Ws,cfb_mov:_i,cfb_gc:Qs,ReadShift,CheckField,prep_blob,bconcat,use_zlib:Mr,_deflateRaw:$a,_inflateRaw:qs,consts:ts},or}();function blobify(ar){return typeof ar=="string"?s2ab(ar):Array.isArray(ar)?a2u(ar):ar}function write_dl(ar,or,lr){if(typeof Deno<"u"){if(lr&&typeof or=="string")switch(lr){case"utf8":or=new TextEncoder(lr).encode(or);break;case"binary":or=s2ab(or);break;default:throw new Error("Unsupported encoding "+lr)}return Deno.writeFileSync(ar,or)}var cr=lr=="utf8"?utf8write(or):or;if(typeof IE_SaveFile<"u")return IE_SaveFile(cr,ar);if(typeof Blob<"u"){var ur=new Blob([blobify(cr)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(ur,ar);if(typeof saveAs<"u")return saveAs(ur,ar);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var dr=URL.createObjectURL(ur);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(dr)},6e4),chrome.downloads.download({url:dr,filename:ar,saveAs:!0});var hr=document.createElement("a");if(hr.download!=null)return hr.download=ar,hr.href=dr,document.body.appendChild(hr),hr.click(),document.body.removeChild(hr),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(dr)},6e4),dr}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var pr=File(ar);return pr.open("w"),pr.encoding="binary",Array.isArray(or)&&(or=a2s(or)),pr.write(or),pr.close(),or}catch(xr){if(!xr.message||!xr.message.match(/onstruct/))throw xr}throw new Error("cannot save file "+ar)}function keys(ar){for(var or=Object.keys(ar),lr=[],cr=0;cr<or.length;++cr)Object.prototype.hasOwnProperty.call(ar,or[cr])&&lr.push(or[cr]);return lr}function evert_key(ar,or){for(var lr=[],cr=keys(ar),ur=0;ur!==cr.length;++ur)lr[ar[cr[ur]][or]]==null&&(lr[ar[cr[ur]][or]]=cr[ur]);return lr}function evert(ar){for(var or=[],lr=keys(ar),cr=0;cr!==lr.length;++cr)or[ar[lr[cr]]]=lr[cr];return or}function evert_num(ar){for(var or=[],lr=keys(ar),cr=0;cr!==lr.length;++cr)or[ar[lr[cr]]]=parseInt(lr[cr],10);return or}function evert_arr(ar){for(var or=[],lr=keys(ar),cr=0;cr!==lr.length;++cr)or[ar[lr[cr]]]==null&&(or[ar[lr[cr]]]=[]),or[ar[lr[cr]]].push(lr[cr]);return or}var basedate=new Date(1899,11,30,0,0,0);function datenum(ar,or){var lr=ar.getTime(),cr=basedate.getTime()+(ar.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4;return(lr-cr)/(24*60*60*1e3)}var refdate=new Date,dnthresh=basedate.getTime()+(refdate.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4,refoffset=refdate.getTimezoneOffset();function numdate(ar){var or=new Date;return or.setTime(ar*24*60*60*1e3+dnthresh),or.getTimezoneOffset()!==refoffset&&or.setTime(or.getTime()+(or.getTimezoneOffset()-refoffset)*6e4),or}var good_pd_date_1=new Date("2017-02-19T19:06:09.000Z"),good_pd_date=isNaN(good_pd_date_1.getFullYear())?new Date("2/19/17"):good_pd_date_1,good_pd=good_pd_date.getFullYear()==2017;function parseDate(ar,or){var lr=new Date(ar);if(good_pd)return or>0?lr.setTime(lr.getTime()+lr.getTimezoneOffset()*60*1e3):or<0&&lr.setTime(lr.getTime()-lr.getTimezoneOffset()*60*1e3),lr;if(ar instanceof Date)return ar;if(good_pd_date.getFullYear()==1917&&!isNaN(lr.getFullYear())){var cr=lr.getFullYear();return ar.indexOf(""+cr)>-1||lr.setFullYear(lr.getFullYear()+100),lr}var ur=ar.match(/\d+/g)||["2017","2","19","0","0","0"],dr=new Date(+ur[0],+ur[1]-1,+ur[2],+ur[3]||0,+ur[4]||0,+ur[5]||0);return ar.indexOf("Z")>-1&&(dr=new Date(dr.getTime()-dr.getTimezoneOffset()*60*1e3)),dr}function cc2str(ar,or){if(has_buf&&Buffer.isBuffer(ar))return ar.toString("binary");if(typeof TextDecoder<"u")try{var lr={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(ar)&&(ar=new Uint8Array(ar)),new TextDecoder("latin1").decode(ar).replace(/[]/g,function(dr){return lr[dr]||dr})}catch{}for(var cr=[],ur=0;ur!=ar.length;++ur)cr.push(String.fromCharCode(ar[ur]));return cr.join("")}function dup(ar){if(typeof JSON<"u"&&!Array.isArray(ar))return JSON.parse(JSON.stringify(ar));if(typeof ar!="object"||ar==null)return ar;if(ar instanceof Date)return new Date(ar.getTime());var or={};for(var lr in ar)Object.prototype.hasOwnProperty.call(ar,lr)&&(or[lr]=dup(ar[lr]));return or}function fill(ar,or){for(var lr="";lr.length<or;)lr+=ar;return lr}function fuzzynum(ar){var or=Number(ar);if(!isNaN(or))return isFinite(or)?or:NaN;if(!/\d/.test(ar))return or;var lr=1,cr=ar.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return lr*=100,""});return!isNaN(or=Number(cr))||(cr=cr.replace(/[(](.*)[)]/,function(ur,dr){return lr=-lr,dr}),!isNaN(or=Number(cr)))?or/lr:or}var lower_months=["january","february","march","april","may","june","july","august","september","october","november","december"];function fuzzydate(ar){var or=new Date(ar),lr=new Date(NaN),cr=or.getYear(),ur=or.getMonth(),dr=or.getDate();if(isNaN(dr))return lr;var hr=ar.toLowerCase();if(hr.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(hr=hr.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),hr.length>3&&lower_months.indexOf(hr)==-1)return lr}else if(hr.match(/[a-z]/))return lr;return cr<0||cr>8099?lr:(ur>0||dr>1)&&cr!=101?or:ar.match(/[^-0-9:,\/\\]/)?lr:or}function zip_add_file(ar,or,lr){if(ar.FullPaths){if(typeof lr=="string"){var cr;return has_buf?cr=Buffer_from(lr):cr=utf8decode(lr),CFB.utils.cfb_add(ar,or,cr)}CFB.utils.cfb_add(ar,or,lr)}else ar.file(or,lr)}function zip_new(){return CFB.utils.cfb_new()}var XML_HEADER=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},rencoding=evert(encodings),decregex=/[&<>'"]/g,charegex=/[\u0000-\u0008\u000b-\u001f]/g;function escapexml(ar){var or=ar+"";return or.replace(decregex,function(lr){return rencoding[lr]}).replace(charegex,function(lr){return"_x"+("000"+lr.charCodeAt(0).toString(16)).slice(-4)+"_"})}function escapexmltag(ar){return escapexml(ar).replace(/ /g,"_x0020_")}var htmlcharegex=/[\u0000-\u001f]/g;function escapehtml(ar){var or=ar+"";return or.replace(decregex,function(lr){return rencoding[lr]}).replace(/\n/g,"<br/>").replace(htmlcharegex,function(lr){return"&#x"+("000"+lr.charCodeAt(0).toString(16)).slice(-4)+";"})}function escapexlml(ar){var or=ar+"";return or.replace(decregex,function(lr){return rencoding[lr]}).replace(htmlcharegex,function(lr){return"&#x"+lr.charCodeAt(0).toString(16).toUpperCase()+";"})}function xlml_unfixstr(ar){return ar.replace(/(\r\n|[\r\n])/g,"&#10;")}function parsexmlbool(ar){switch(ar){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function utf8reada(ar){for(var or="",lr=0,cr=0,ur=0,dr=0,hr=0,pr=0;lr<ar.length;){if(cr=ar.charCodeAt(lr++),cr<128){or+=String.fromCharCode(cr);continue}if(ur=ar.charCodeAt(lr++),cr>191&&cr<224){hr=(cr&31)<<6,hr|=ur&63,or+=String.fromCharCode(hr);continue}if(dr=ar.charCodeAt(lr++),cr<240){or+=String.fromCharCode((cr&15)<<12|(ur&63)<<6|dr&63);continue}hr=ar.charCodeAt(lr++),pr=((cr&7)<<18|(ur&63)<<12|(dr&63)<<6|hr&63)-65536,or+=String.fromCharCode(55296+(pr>>>10&1023)),or+=String.fromCharCode(56320+(pr&1023))}return or}function utf8readb(ar){var or=new_raw_buf(2*ar.length),lr,cr,ur=1,dr=0,hr=0,pr;for(cr=0;cr<ar.length;cr+=ur)ur=1,(pr=ar.charCodeAt(cr))<128?lr=pr:pr<224?(lr=(pr&31)*64+(ar.charCodeAt(cr+1)&63),ur=2):pr<240?(lr=(pr&15)*4096+(ar.charCodeAt(cr+1)&63)*64+(ar.charCodeAt(cr+2)&63),ur=3):(ur=4,lr=(pr&7)*262144+(ar.charCodeAt(cr+1)&63)*4096+(ar.charCodeAt(cr+2)&63)*64+(ar.charCodeAt(cr+3)&63),lr-=65536,hr=55296+(lr>>>10&1023),lr=56320+(lr&1023)),hr!==0&&(or[dr++]=hr&255,or[dr++]=hr>>>8,hr=0),or[dr++]=lr%256,or[dr++]=lr>>>8;return or.slice(0,dr).toString("ucs2")}function utf8readc(ar){return Buffer_from(ar,"binary").toString("utf8")}var utf8corpus="foo bar baz",utf8read=has_buf&&(utf8readc(utf8corpus)==utf8reada(utf8corpus)&&utf8readc||utf8readb(utf8corpus)==utf8reada(utf8corpus)&&utf8readb)||utf8reada,utf8write=has_buf?function(ar){return Buffer_from(ar,"utf8").toString("binary")}:function(ar){for(var or=[],lr=0,cr=0,ur=0;lr<ar.length;)switch(cr=ar.charCodeAt(lr++),!0){case cr<128:or.push(String.fromCharCode(cr));break;case cr<2048:or.push(String.fromCharCode(192+(cr>>6))),or.push(String.fromCharCode(128+(cr&63)));break;case(cr>=55296&&cr<57344):cr-=55296,ur=ar.charCodeAt(lr++)-56320+(cr<<10),or.push(String.fromCharCode(240+(ur>>18&7))),or.push(String.fromCharCode(144+(ur>>12&63))),or.push(String.fromCharCode(128+(ur>>6&63))),or.push(String.fromCharCode(128+(ur&63)));break;default:or.push(String.fromCharCode(224+(cr>>12))),or.push(String.fromCharCode(128+(cr>>6&63))),or.push(String.fromCharCode(128+(cr&63)))}return or.join("")},htmldecode=function(){var ar=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(or){return[new RegExp("&"+or[0]+";","ig"),or[1]]});return function(lr){for(var cr=lr.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),ur=0;ur<ar.length;++ur)cr=cr.replace(ar[ur][0],ar[ur][1]);return cr}}(),wtregex=/(^\s|\s$|\n)/;function writetag(ar,or){return"<"+ar+(or.match(wtregex)?' xml:space="preserve"':"")+">"+or+"</"+ar+">"}function wxt_helper(ar){return keys(ar).map(function(or){return" "+or+'="'+ar[or]+'"'}).join("")}function writextag(ar,or,lr){return"<"+ar+(lr!=null?wxt_helper(lr):"")+(or!=null?(or.match(wtregex)?' xml:space="preserve"':"")+">"+or+"</"+ar:"/")+">"}function write_w3cdtf(ar,or){try{return ar.toISOString().replace(/\.\d*/,"")}catch(lr){if(or)throw lr}return""}function write_vt(ar,or){switch(typeof ar){case"string":var lr=writextag("vt:lpwstr",escapexml(ar));return lr=lr.replace(/&quot;/g,"_x0022_"),lr;case"number":return writextag((ar|0)==ar?"vt:i4":"vt:r8",escapexml(String(ar)));case"boolean":return writextag("vt:bool",ar?"true":"false")}if(ar instanceof Date)return writextag("vt:filetime",write_w3cdtf(ar));throw new Error("Unable to serialize "+ar)}var XMLNS={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},XMLNS_main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],XLMLNS={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function read_double_le(ar,or){for(var lr=1-2*(ar[or+7]>>>7),cr=((ar[or+7]&127)<<4)+(ar[or+6]>>>4&15),ur=ar[or+6]&15,dr=5;dr>=0;--dr)ur=ur*256+ar[or+dr];return cr==2047?ur==0?lr*(1/0):NaN:(cr==0?cr=-1022:(cr-=1023,ur+=Math.pow(2,52)),lr*Math.pow(2,cr-52)*ur)}function write_double_le(ar,or,lr){var cr=(or<0||1/or==-1/0?1:0)<<7,ur=0,dr=0,hr=cr?-or:or;isFinite(hr)?hr==0?ur=dr=0:(ur=Math.floor(Math.log(hr)/Math.LN2),dr=hr*Math.pow(2,52-ur),ur<=-1023&&(!isFinite(dr)||dr<Math.pow(2,52))?ur=-1022:(dr-=Math.pow(2,52),ur+=1023)):(ur=2047,dr=isNaN(or)?26985:0);for(var pr=0;pr<=5;++pr,dr/=256)ar[lr+pr]=dr&255;ar[lr+6]=(ur&15)<<4|dr&15,ar[lr+7]=ur>>4|cr}var ___toBuffer=function(ar){for(var or=[],lr=10240,cr=0;cr<ar[0].length;++cr)if(ar[0][cr])for(var ur=0,dr=ar[0][cr].length;ur<dr;ur+=lr)or.push.apply(or,ar[0][cr].slice(ur,ur+lr));return or},__toBuffer=has_buf?function(ar){return ar[0].length>0&&Buffer.isBuffer(ar[0][0])?Buffer.concat(ar[0].map(function(or){return Buffer.isBuffer(or)?or:Buffer_from(or)})):___toBuffer(ar)}:___toBuffer,___utf16le=function(ar,or,lr){for(var cr=[],ur=or;ur<lr;ur+=2)cr.push(String.fromCharCode(__readUInt16LE(ar,ur)));return cr.join("").replace(chr0,"")},__utf16le=has_buf?function(ar,or,lr){return Buffer.isBuffer(ar)?ar.toString("utf16le",or,lr).replace(chr0,""):___utf16le(ar,or,lr)}:___utf16le,___hexlify=function(ar,or,lr){for(var cr=[],ur=or;ur<or+lr;++ur)cr.push(("0"+ar[ur].toString(16)).slice(-2));return cr.join("")},__hexlify=has_buf?function(ar,or,lr){return Buffer.isBuffer(ar)?ar.toString("hex",or,or+lr):___hexlify(ar,or,lr)}:___hexlify,___utf8=function(ar,or,lr){for(var cr=[],ur=or;ur<lr;ur++)cr.push(String.fromCharCode(__readUInt8(ar,ur)));return cr.join("")},__utf8=has_buf?function ar(or,lr,cr){return Buffer.isBuffer(or)?or.toString("utf8",lr,cr):___utf8(or,lr,cr)}:___utf8,___lpstr=function(ar,or){var lr=__readUInt32LE(ar,or);return lr>0?__utf8(ar,or+4,or+4+lr-1):""},__lpstr=___lpstr,___cpstr=function(ar,or){var lr=__readUInt32LE(ar,or);return lr>0?__utf8(ar,or+4,or+4+lr-1):""},__cpstr=___cpstr,___lpwstr=function(ar,or){var lr=2*__readUInt32LE(ar,or);return lr>0?__utf8(ar,or+4,or+4+lr-1):""},__lpwstr=___lpwstr,___lpp4=function ar(or,lr){var cr=__readUInt32LE(or,lr);return cr>0?__utf16le(or,lr+4,lr+4+cr):""},__lpp4=___lpp4,___8lpp4=function(ar,or){var lr=__readUInt32LE(ar,or);return lr>0?__utf8(ar,or+4,or+4+lr):""},__8lpp4=___8lpp4,___double=function(ar,or){return read_double_le(ar,or)},__double=___double,is_buf=function ar(or){return Array.isArray(or)||typeof Uint8Array<"u"&&or instanceof Uint8Array};has_buf&&(__lpstr=function(or,lr){if(!Buffer.isBuffer(or))return ___lpstr(or,lr);var cr=or.readUInt32LE(lr);return cr>0?or.toString("utf8",lr+4,lr+4+cr-1):""},__cpstr=function(or,lr){if(!Buffer.isBuffer(or))return ___cpstr(or,lr);var cr=or.readUInt32LE(lr);return cr>0?or.toString("utf8",lr+4,lr+4+cr-1):""},__lpwstr=function(or,lr){if(!Buffer.isBuffer(or))return ___lpwstr(or,lr);var cr=2*or.readUInt32LE(lr);return or.toString("utf16le",lr+4,lr+4+cr-1)},__lpp4=function(or,lr){if(!Buffer.isBuffer(or))return ___lpp4(or,lr);var cr=or.readUInt32LE(lr);return or.toString("utf16le",lr+4,lr+4+cr)},__8lpp4=function(or,lr){if(!Buffer.isBuffer(or))return ___8lpp4(or,lr);var cr=or.readUInt32LE(lr);return or.toString("utf8",lr+4,lr+4+cr)},__double=function(or,lr){return Buffer.isBuffer(or)?or.readDoubleLE(lr):___double(or,lr)},is_buf=function(or){return Buffer.isBuffer(or)||Array.isArray(or)||typeof Uint8Array<"u"&&or instanceof Uint8Array});var __readUInt8=function(ar,or){return ar[or]},__readUInt16LE=function(ar,or){return ar[or+1]*256+ar[or]},__readInt16LE=function(ar,or){var lr=ar[or+1]*256+ar[or];return lr<32768?lr:(65535-lr+1)*-1},__readUInt32LE=function(ar,or){return ar[or+3]*(1<<24)+(ar[or+2]<<16)+(ar[or+1]<<8)+ar[or]},__readInt32LE=function(ar,or){return ar[or+3]<<24|ar[or+2]<<16|ar[or+1]<<8|ar[or]},__readInt32BE=function(ar,or){return ar[or]<<24|ar[or+1]<<16|ar[or+2]<<8|ar[or+3]};function ReadShift(ar,or){var lr="",cr,ur,dr=[],hr,pr,xr,mr;switch(or){case"dbcs":if(mr=this.l,has_buf&&Buffer.isBuffer(this))lr=this.slice(this.l,this.l+2*ar).toString("utf16le");else for(xr=0;xr<ar;++xr)lr+=String.fromCharCode(__readUInt16LE(this,mr)),mr+=2;ar*=2;break;case"utf8":lr=__utf8(this,this.l,this.l+ar);break;case"utf16le":ar*=2,lr=__utf16le(this,this.l,this.l+ar);break;case"wstr":return ReadShift.call(this,ar,"dbcs");case"lpstr-ansi":lr=__lpstr(this,this.l),ar=4+__readUInt32LE(this,this.l);break;case"lpstr-cp":lr=__cpstr(this,this.l),ar=4+__readUInt32LE(this,this.l);break;case"lpwstr":lr=__lpwstr(this,this.l),ar=4+2*__readUInt32LE(this,this.l);break;case"lpp4":ar=4+__readUInt32LE(this,this.l),lr=__lpp4(this,this.l),ar&2&&(ar+=2);break;case"8lpp4":ar=4+__readUInt32LE(this,this.l),lr=__8lpp4(this,this.l),ar&3&&(ar+=4-(ar&3));break;case"cstr":for(ar=0,lr="";(hr=__readUInt8(this,this.l+ar++))!==0;)dr.push(_getchar(hr));lr=dr.join("");break;case"_wstr":for(ar=0,lr="";(hr=__readUInt16LE(this,this.l+ar))!==0;)dr.push(_getchar(hr)),ar+=2;ar+=2,lr=dr.join("");break;case"dbcs-cont":for(lr="",mr=this.l,xr=0;xr<ar;++xr){if(this.lens&&this.lens.indexOf(mr)!==-1)return hr=__readUInt8(this,mr),this.l=mr+1,pr=ReadShift.call(this,ar-xr,hr?"dbcs-cont":"sbcs-cont"),dr.join("")+pr;dr.push(_getchar(__readUInt16LE(this,mr))),mr+=2}lr=dr.join(""),ar*=2;break;case"cpstr":case"sbcs-cont":for(lr="",mr=this.l,xr=0;xr!=ar;++xr){if(this.lens&&this.lens.indexOf(mr)!==-1)return hr=__readUInt8(this,mr),this.l=mr+1,pr=ReadShift.call(this,ar-xr,hr?"dbcs-cont":"sbcs-cont"),dr.join("")+pr;dr.push(_getchar(__readUInt8(this,mr))),mr+=1}lr=dr.join("");break;default:switch(ar){case 1:return cr=__readUInt8(this,this.l),this.l++,cr;case 2:return cr=(or==="i"?__readInt16LE:__readUInt16LE)(this,this.l),this.l+=2,cr;case 4:case-4:return or==="i"||!(this[this.l+3]&128)?(cr=(ar>0?__readInt32LE:__readInt32BE)(this,this.l),this.l+=4,cr):(ur=__readUInt32LE(this,this.l),this.l+=4,ur);case 8:case-8:if(or==="f")return ar==8?ur=__double(this,this.l):ur=__double([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,ur;ar=8;case 16:lr=__hexlify(this,this.l,ar);break}}return this.l+=ar,lr}var __writeUInt32LE=function(ar,or,lr){ar[lr]=or&255,ar[lr+1]=or>>>8&255,ar[lr+2]=or>>>16&255,ar[lr+3]=or>>>24&255},__writeInt32LE=function(ar,or,lr){ar[lr]=or&255,ar[lr+1]=or>>8&255,ar[lr+2]=or>>16&255,ar[lr+3]=or>>24&255},__writeUInt16LE=function(ar,or,lr){ar[lr]=or&255,ar[lr+1]=or>>>8&255};function WriteShift(ar,or,lr){var cr=0,ur=0;if(lr==="dbcs"){for(ur=0;ur!=or.length;++ur)__writeUInt16LE(this,or.charCodeAt(ur),this.l+2*ur);cr=2*or.length}else if(lr==="sbcs"){for(or=or.replace(/[^\x00-\x7F]/g,"_"),ur=0;ur!=or.length;++ur)this[this.l+ur]=or.charCodeAt(ur)&255;cr=or.length}else if(lr==="hex"){for(;ur<ar;++ur)this[this.l++]=parseInt(or.slice(2*ur,2*ur+2),16)||0;return this}else if(lr==="utf16le"){var dr=Math.min(this.l+ar,this.length);for(ur=0;ur<Math.min(or.length,ar);++ur){var hr=or.charCodeAt(ur);this[this.l++]=hr&255,this[this.l++]=hr>>8}for(;this.l<dr;)this[this.l++]=0;return this}else switch(ar){case 1:cr=1,this[this.l]=or&255;break;case 2:cr=2,this[this.l]=or&255,or>>>=8,this[this.l+1]=or&255;break;case 3:cr=3,this[this.l]=or&255,or>>>=8,this[this.l+1]=or&255,or>>>=8,this[this.l+2]=or&255;break;case 4:cr=4,__writeUInt32LE(this,or,this.l);break;case 8:if(cr=8,lr==="f"){write_double_le(this,or,this.l);break}case 16:break;case-4:cr=4,__writeInt32LE(this,or,this.l);break}return this.l+=cr,this}function CheckField(ar,or){var lr=__hexlify(this,this.l,ar.length>>1);if(lr!==ar)throw new Error(or+"Expected "+ar+" saw "+lr);this.l+=ar.length>>1}function prep_blob(ar,or){ar.l=or,ar.read_shift=ReadShift,ar.chk=CheckField,ar.write_shift=WriteShift}function parsenoop(ar,or){ar.l+=or}function new_buf(ar){var or=new_raw_buf(ar);return prep_blob(or,0),or}function buf_array(){var ar=[],or=has_buf?256:2048,lr=function(mr){var fr=new_buf(mr);return prep_blob(fr,0),fr},cr=lr(or),ur=function(){cr&&(cr.length>cr.l&&(cr=cr.slice(0,cr.l),cr.l=cr.length),cr.length>0&&ar.push(cr),cr=null)},dr=function(mr){return cr&&mr<cr.length-cr.l?cr:(ur(),cr=lr(Math.max(mr+1,or)))},hr=function(){return ur(),bconcat(ar)},pr=function(mr){ur(),cr=mr,cr.l==null&&(cr.l=cr.length),dr(or)};return{next:dr,push:pr,end:hr,_bufs:ar}}function write_record(ar,or,lr,cr){var ur=+or,dr;if(!isNaN(ur)){cr||(cr=XLSBRecordEnum[ur].p||(lr||[]).length||0),dr=1+(ur>=128?1:0)+1,cr>=128&&++dr,cr>=16384&&++dr,cr>=2097152&&++dr;var hr=ar.next(dr);ur<=127?hr.write_shift(1,ur):(hr.write_shift(1,(ur&127)+128),hr.write_shift(1,ur>>7));for(var pr=0;pr!=4;++pr)if(cr>=128)hr.write_shift(1,(cr&127)+128),cr>>=7;else{hr.write_shift(1,cr);break}cr>0&&is_buf(lr)&&ar.push(lr)}}function shift_cell_xls(ar,or,lr){var cr=dup(ar);if(or.s?(cr.cRel&&(cr.c+=or.s.c),cr.rRel&&(cr.r+=or.s.r)):(cr.cRel&&(cr.c+=or.c),cr.rRel&&(cr.r+=or.r)),!lr||lr.biff<12){for(;cr.c>=256;)cr.c-=256;for(;cr.r>=65536;)cr.r-=65536}return cr}function shift_range_xls(ar,or,lr){var cr=dup(ar);return cr.s=shift_cell_xls(cr.s,or.s,lr),cr.e=shift_cell_xls(cr.e,or.s,lr),cr}function encode_cell_xls(ar,or){if(ar.cRel&&ar.c<0)for(ar=dup(ar);ar.c<0;)ar.c+=or>8?16384:256;if(ar.rRel&&ar.r<0)for(ar=dup(ar);ar.r<0;)ar.r+=or>8?1048576:or>5?65536:16384;var lr=encode_cell(ar);return!ar.cRel&&ar.cRel!=null&&(lr=fix_col(lr)),!ar.rRel&&ar.rRel!=null&&(lr=fix_row(lr)),lr}function encode_range_xls(ar,or){return ar.s.r==0&&!ar.s.rRel&&ar.e.r==(or.biff>=12?1048575:or.biff>=8?65536:16384)&&!ar.e.rRel?(ar.s.cRel?"":"$")+encode_col(ar.s.c)+":"+(ar.e.cRel?"":"$")+encode_col(ar.e.c):ar.s.c==0&&!ar.s.cRel&&ar.e.c==(or.biff>=12?16383:255)&&!ar.e.cRel?(ar.s.rRel?"":"$")+encode_row(ar.s.r)+":"+(ar.e.rRel?"":"$")+encode_row(ar.e.r):encode_cell_xls(ar.s,or.biff)+":"+encode_cell_xls(ar.e,or.biff)}function decode_row(ar){return parseInt(unfix_row(ar),10)-1}function encode_row(ar){return""+(ar+1)}function fix_row(ar){return ar.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function unfix_row(ar){return ar.replace(/\$(\d+)$/,"$1")}function decode_col(ar){for(var or=unfix_col(ar),lr=0,cr=0;cr!==or.length;++cr)lr=26*lr+or.charCodeAt(cr)-64;return lr-1}function encode_col(ar){if(ar<0)throw new Error("invalid column "+ar);var or="";for(++ar;ar;ar=Math.floor((ar-1)/26))or=String.fromCharCode((ar-1)%26+65)+or;return or}function fix_col(ar){return ar.replace(/^([A-Z])/,"$$$1")}function unfix_col(ar){return ar.replace(/^\$([A-Z])/,"$1")}function split_cell(ar){return ar.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(ar){for(var or=0,lr=0,cr=0;cr<ar.length;++cr){var ur=ar.charCodeAt(cr);ur>=48&&ur<=57?or=10*or+(ur-48):ur>=65&&ur<=90&&(lr=26*lr+(ur-64))}return{c:lr-1,r:or-1}}function encode_cell(ar){for(var or=ar.c+1,lr="";or;or=(or-1)/26|0)lr=String.fromCharCode((or-1)%26+65)+lr;return lr+(ar.r+1)}function decode_range(ar){var or=ar.indexOf(":");return or==-1?{s:decode_cell(ar),e:decode_cell(ar)}:{s:decode_cell(ar.slice(0,or)),e:decode_cell(ar.slice(or+1))}}function encode_range(ar,or){return typeof or>"u"||typeof or=="number"?encode_range(ar.s,ar.e):(typeof ar!="string"&&(ar=encode_cell(ar)),typeof or!="string"&&(or=encode_cell(or)),ar==or?ar:ar+":"+or)}function safe_decode_range(ar){var or={s:{c:0,r:0},e:{c:0,r:0}},lr=0,cr=0,ur=0,dr=ar.length;for(lr=0;cr<dr&&!((ur=ar.charCodeAt(cr)-64)<1||ur>26);++cr)lr=26*lr+ur;for(or.s.c=--lr,lr=0;cr<dr&&!((ur=ar.charCodeAt(cr)-48)<0||ur>9);++cr)lr=10*lr+ur;if(or.s.r=--lr,cr===dr||ur!=10)return or.e.c=or.s.c,or.e.r=or.s.r,or;for(++cr,lr=0;cr!=dr&&!((ur=ar.charCodeAt(cr)-64)<1||ur>26);++cr)lr=26*lr+ur;for(or.e.c=--lr,lr=0;cr!=dr&&!((ur=ar.charCodeAt(cr)-48)<0||ur>9);++cr)lr=10*lr+ur;return or.e.r=--lr,or}function safe_format_cell(ar,or){var lr=ar.t=="d"&&or instanceof Date;if(ar.z!=null)try{return ar.w=SSF_format(ar.z,lr?datenum(or):or)}catch{}try{return ar.w=SSF_format((ar.XF||{}).numFmtId||(lr?14:0),lr?datenum(or):or)}catch{return""+or}}function format_cell(ar,or,lr){return ar==null||ar.t==null||ar.t=="z"?"":ar.w!==void 0?ar.w:(ar.t=="d"&&!ar.z&&lr&&lr.dateNF&&(ar.z=lr.dateNF),ar.t=="e"?BErr[ar.v]||ar.v:or==null?safe_format_cell(ar,ar.v):safe_format_cell(ar,or))}function sheet_to_workbook(ar,or){var lr=or&&or.sheet?or.sheet:"Sheet1",cr={};return cr[lr]=ar,{SheetNames:[lr],Sheets:cr}}function sheet_add_aoa(ar,or,lr){var cr=lr||{},ur=ar?Array.isArray(ar):cr.dense,dr=ar||(ur?[]:{}),hr=0,pr=0;if(dr&&cr.origin!=null){if(typeof cr.origin=="number")hr=cr.origin;else{var xr=typeof cr.origin=="string"?decode_cell(cr.origin):cr.origin;hr=xr.r,pr=xr.c}dr["!ref"]||(dr["!ref"]="A1:A1")}var mr={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(dr["!ref"]){var fr=safe_decode_range(dr["!ref"]);mr.s.c=fr.s.c,mr.s.r=fr.s.r,mr.e.c=Math.max(mr.e.c,fr.e.c),mr.e.r=Math.max(mr.e.r,fr.e.r),hr==-1&&(mr.e.r=hr=fr.e.r+1)}for(var Er=0;Er!=or.length;++Er)if(or[Er]){if(!Array.isArray(or[Er]))throw new Error("aoa_to_sheet expects an array of arrays");for(var vr=0;vr!=or[Er].length;++vr)if(!(typeof or[Er][vr]>"u")){var gr={v:or[Er][vr]},yr=hr+Er,jr=pr+vr;if(mr.s.r>yr&&(mr.s.r=yr),mr.s.c>jr&&(mr.s.c=jr),mr.e.r<yr&&(mr.e.r=yr),mr.e.c<jr&&(mr.e.c=jr),or[Er][vr]&&typeof or[Er][vr]=="object"&&!Array.isArray(or[Er][vr])&&!(or[Er][vr]instanceof Date))gr=or[Er][vr];else if(Array.isArray(gr.v)&&(gr.f=or[Er][vr][1],gr.v=gr.v[0]),gr.v===null)if(gr.f)gr.t="n";else if(cr.nullError)gr.t="e",gr.v=0;else if(cr.sheetStubs)gr.t="z";else continue;else typeof gr.v=="number"?gr.t="n":typeof gr.v=="boolean"?gr.t="b":gr.v instanceof Date?(gr.z=cr.dateNF||table_fmt[14],cr.cellDates?(gr.t="d",gr.w=SSF_format(gr.z,datenum(gr.v))):(gr.t="n",gr.v=datenum(gr.v),gr.w=SSF_format(gr.z,gr.v))):gr.t="s";if(ur)dr[yr]||(dr[yr]=[]),dr[yr][jr]&&dr[yr][jr].z&&(gr.z=dr[yr][jr].z),dr[yr][jr]=gr;else{var br=encode_cell({c:jr,r:yr});dr[br]&&dr[br].z&&(gr.z=dr[br].z),dr[br]=gr}}}return mr.s.c<1e7&&(dr["!ref"]=encode_range(mr)),dr}function aoa_to_sheet(ar,or){return sheet_add_aoa(null,ar,or)}function parse_Int32LE(ar){return ar.read_shift(4,"i")}function write_UInt32LE(ar,or){return or||(or=new_buf(4)),or.write_shift(4,ar),or}function parse_XLWideString(ar){var or=ar.read_shift(4);return or===0?"":ar.read_shift(or,"dbcs")}function write_XLWideString(ar,or){var lr=!1;return or==null&&(lr=!0,or=new_buf(4+2*ar.length)),or.write_shift(4,ar.length),ar.length>0&&or.write_shift(0,ar,"dbcs"),lr?or.slice(0,or.l):or}function parse_StrRun(ar){return{ich:ar.read_shift(2),ifnt:ar.read_shift(2)}}function write_StrRun(ar,or){return or||(or=new_buf(4)),or.write_shift(2,0),or.write_shift(2,0),or}function parse_RichStr(ar,or){var lr=ar.l,cr=ar.read_shift(1),ur=parse_XLWideString(ar),dr=[],hr={t:ur,h:ur};if(cr&1){for(var pr=ar.read_shift(4),xr=0;xr!=pr;++xr)dr.push(parse_StrRun(ar));hr.r=dr}else hr.r=[{ich:0,ifnt:0}];return ar.l=lr+or,hr}function write_RichStr(ar,or){var lr=!1;return or==null&&(lr=!0,or=new_buf(15+4*ar.t.length)),or.write_shift(1,0),write_XLWideString(ar.t,or),lr?or.slice(0,or.l):or}var parse_BrtCommentText=parse_RichStr;function write_BrtCommentText(ar,or){var lr=!1;return or==null&&(lr=!0,or=new_buf(23+4*ar.t.length)),or.write_shift(1,1),write_XLWideString(ar.t,or),or.write_shift(4,1),write_StrRun({},or),lr?or.slice(0,or.l):or}function parse_XLSBCell(ar){var or=ar.read_shift(4),lr=ar.read_shift(2);return lr+=ar.read_shift(1)<<16,ar.l++,{c:or,iStyleRef:lr}}function write_XLSBCell(ar,or){return or==null&&(or=new_buf(8)),or.write_shift(-4,ar.c),or.write_shift(3,ar.iStyleRef||ar.s),or.write_shift(1,0),or}function parse_XLSBShortCell(ar){var or=ar.read_shift(2);return or+=ar.read_shift(1)<<16,ar.l++,{c:-1,iStyleRef:or}}function write_XLSBShortCell(ar,or){return or==null&&(or=new_buf(4)),or.write_shift(3,ar.iStyleRef||ar.s),or.write_shift(1,0),or}var parse_XLSBCodeName=parse_XLWideString,write_XLSBCodeName=write_XLWideString;function parse_XLNullableWideString(ar){var or=ar.read_shift(4);return or===0||or===4294967295?"":ar.read_shift(or,"dbcs")}function write_XLNullableWideString(ar,or){var lr=!1;return or==null&&(lr=!0,or=new_buf(127)),or.write_shift(4,ar.length>0?ar.length:4294967295),ar.length>0&&or.write_shift(0,ar,"dbcs"),lr?or.slice(0,or.l):or}var parse_XLNameWideString=parse_XLWideString,parse_RelID=parse_XLNullableWideString,write_RelID=write_XLNullableWideString;function parse_RkNumber(ar){var or=ar.slice(ar.l,ar.l+4),lr=or[0]&1,cr=or[0]&2;ar.l+=4;var ur=cr===0?__double([0,0,0,0,or[0]&252,or[1],or[2],or[3]],0):__readInt32LE(or,0)>>2;return lr?ur/100:ur}function write_RkNumber(ar,or){or==null&&(or=new_buf(4));var lr=0,cr=0,ur=ar*100;if(ar==(ar|0)&&ar>=-536870912&&ar<1<<29?cr=1:ur==(ur|0)&&ur>=-536870912&&ur<1<<29&&(cr=1,lr=1),cr)or.write_shift(-4,((lr?ur:ar)<<2)+(lr+2));else throw new Error("unsupported RkNumber "+ar)}function parse_RfX(ar){var or={s:{},e:{}};return or.s.r=ar.read_shift(4),or.e.r=ar.read_shift(4),or.s.c=ar.read_shift(4),or.e.c=ar.read_shift(4),or}function write_RfX(ar,or){return or||(or=new_buf(16)),or.write_shift(4,ar.s.r),or.write_shift(4,ar.e.r),or.write_shift(4,ar.s.c),or.write_shift(4,ar.e.c),or}var parse_UncheckedRfX=parse_RfX,write_UncheckedRfX=write_RfX;function parse_Xnum(ar){if(ar.length-ar.l<8)throw"XLS Xnum Buffer underflow";return ar.read_shift(8,"f")}function write_Xnum(ar,or){return(or||new_buf(8)).write_shift(8,ar,"f")}function parse_BrtColor(ar){var or={},lr=ar.read_shift(1),cr=lr>>>1,ur=ar.read_shift(1),dr=ar.read_shift(2,"i"),hr=ar.read_shift(1),pr=ar.read_shift(1),xr=ar.read_shift(1);switch(ar.l++,cr){case 0:or.auto=1;break;case 1:or.index=ur;var mr=XLSIcv[ur];mr&&(or.rgb=rgb2Hex(mr));break;case 2:or.rgb=rgb2Hex([hr,pr,xr]);break;case 3:or.theme=ur;break}return dr!=0&&(or.tint=dr>0?dr/32767:dr/32768),or}function write_BrtColor(ar,or){if(or||(or=new_buf(8)),!ar||ar.auto)return or.write_shift(4,0),or.write_shift(4,0),or;ar.index!=null?(or.write_shift(1,2),or.write_shift(1,ar.index)):ar.theme!=null?(or.write_shift(1,6),or.write_shift(1,ar.theme)):(or.write_shift(1,5),or.write_shift(1,0));var lr=ar.tint||0;if(lr>0?lr*=32767:lr<0&&(lr*=32768),or.write_shift(2,lr),!ar.rgb||ar.theme!=null)or.write_shift(2,0),or.write_shift(1,0),or.write_shift(1,0);else{var cr=ar.rgb||"FFFFFF";typeof cr=="number"&&(cr=("000000"+cr.toString(16)).slice(-6)),or.write_shift(1,parseInt(cr.slice(0,2),16)),or.write_shift(1,parseInt(cr.slice(2,4),16)),or.write_shift(1,parseInt(cr.slice(4,6),16)),or.write_shift(1,255)}return or}function parse_FontFlags(ar){var or=ar.read_shift(1);ar.l++;var lr={fBold:or&1,fItalic:or&2,fUnderline:or&4,fStrikeout:or&8,fOutline:or&16,fShadow:or&32,fCondense:or&64,fExtend:or&128};return lr}function write_FontFlags(ar,or){or||(or=new_buf(2));var lr=(ar.italic?2:0)|(ar.strike?8:0)|(ar.outline?16:0)|(ar.shadow?32:0)|(ar.condense?64:0)|(ar.extend?128:0);return or.write_shift(1,lr),or.write_shift(1,0),or}var VT_I2=2,VT_I4=3,VT_BOOL=11,VT_UI4=19,VT_FILETIME=64,VT_BLOB=65,VT_CF=71,VT_VECTOR_VARIANT=4108,VT_VECTOR_LPSTR=4126,VT_STRING=80,DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:VT_STRING},3:{n:"PresentationFormat",t:VT_STRING},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"ScaleCrop",t:VT_BOOL},12:{n:"HeadingPairs",t:VT_VECTOR_VARIANT},13:{n:"TitlesOfParts",t:VT_VECTOR_LPSTR},14:{n:"Manager",t:VT_STRING},15:{n:"Company",t:VT_STRING},16:{n:"LinksUpToDate",t:VT_BOOL},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:VT_BOOL},22:{n:"HyperlinksChanged",t:VT_BOOL},23:{n:"AppVersion",t:VT_I4,p:"version"},24:{n:"DigSig",t:VT_BLOB},26:{n:"ContentType",t:VT_STRING},27:{n:"ContentStatus",t:VT_STRING},28:{n:"Language",t:VT_STRING},29:{n:"Version",t:VT_STRING},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:VT_STRING},3:{n:"Subject",t:VT_STRING},4:{n:"Author",t:VT_STRING},5:{n:"Keywords",t:VT_STRING},6:{n:"Comments",t:VT_STRING},7:{n:"Template",t:VT_STRING},8:{n:"LastAuthor",t:VT_STRING},9:{n:"RevNumber",t:VT_STRING},10:{n:"EditTime",t:VT_FILETIME},11:{n:"LastPrinted",t:VT_FILETIME},12:{n:"CreatedDate",t:VT_FILETIME},13:{n:"ModifiedDate",t:VT_FILETIME},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:VT_CF},18:{n:"Application",t:VT_STRING},19:{n:"DocSecurity",t:VT_I4},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}};function rgbify(ar){return ar.map(function(or){return[or>>16&255,or>>8&255,or&255]})}var _XLSIcv=rgbify([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),XLSIcv=dup(_XLSIcv),BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},CT_LIST={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function new_ct(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function write_ct(ar,or){var lr=evert_arr(ct2type),cr=[],ur;cr[cr.length]=XML_HEADER,cr[cr.length]=writextag("Types",null,{xmlns:XMLNS.CT,"xmlns:xsd":XMLNS.xsd,"xmlns:xsi":XMLNS.xsi}),cr=cr.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(xr){return writextag("Default",null,{Extension:xr[0],ContentType:xr[1]})}));var dr=function(xr){ar[xr]&&ar[xr].length>0&&(ur=ar[xr][0],cr[cr.length]=writextag("Override",null,{PartName:(ur[0]=="/"?"":"/")+ur,ContentType:CT_LIST[xr][or.bookType]||CT_LIST[xr].xlsx}))},hr=function(xr){(ar[xr]||[]).forEach(function(mr){cr[cr.length]=writextag("Override",null,{PartName:(mr[0]=="/"?"":"/")+mr,ContentType:CT_LIST[xr][or.bookType]||CT_LIST[xr].xlsx})})},pr=function(xr){(ar[xr]||[]).forEach(function(mr){cr[cr.length]=writextag("Override",null,{PartName:(mr[0]=="/"?"":"/")+mr,ContentType:lr[xr][0]})})};return dr("workbooks"),hr("sheets"),hr("charts"),pr("themes"),["strs","styles"].forEach(dr),["coreprops","extprops","custprops"].forEach(pr),pr("vba"),pr("comments"),pr("threadedcomments"),pr("drawings"),hr("metadata"),pr("people"),cr.length>2&&(cr[cr.length]="</Types>",cr[1]=cr[1].replace("/>",">")),cr.join("")}var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function get_rels_path(ar){var or=ar.lastIndexOf("/");return ar.slice(0,or+1)+"_rels/"+ar.slice(or+1)+".rels"}function write_rels(ar){var or=[XML_HEADER,writextag("Relationships",null,{xmlns:XMLNS.RELS})];return keys(ar["!id"]).forEach(function(lr){or[or.length]=writextag("Relationship",null,ar["!id"][lr])}),or.length>2&&(or[or.length]="</Relationships>",or[1]=or[1].replace("/>",">")),or.join("")}function add_rels(ar,or,lr,cr,ur,dr){if(ur||(ur={}),ar["!id"]||(ar["!id"]={}),ar["!idx"]||(ar["!idx"]=1),or<0)for(or=ar["!idx"];ar["!id"]["rId"+or];++or);if(ar["!idx"]=or+1,ur.Id="rId"+or,ur.Type=cr,ur.Target=lr,[RELS.HLINK,RELS.XPATH,RELS.XMISS].indexOf(ur.Type)>-1&&(ur.TargetMode="External"),ar["!id"][ur.Id])throw new Error("Cannot rewrite rId "+or);return ar["!id"][ur.Id]=ur,ar[("/"+ur.Target).replace("//","/")]=ur,or}function write_manifest(ar){var or=[XML_HEADER];or.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),or.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var lr=0;lr<ar.length;++lr)or.push('  <manifest:file-entry manifest:full-path="'+ar[lr][0]+'" manifest:media-type="'+ar[lr][1]+`"/>
`);return or.push("</manifest:manifest>"),or.join("")}function write_rdf_type(ar,or,lr){return['  <rdf:Description rdf:about="'+ar+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(lr||"odf")+"#"+or+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf_has(ar,or){return['  <rdf:Description rdf:about="'+ar+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+or+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf(ar){var or=[XML_HEADER];or.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var lr=0;lr!=ar.length;++lr)or.push(write_rdf_type(ar[lr][0],ar[lr][1])),or.push(write_rdf_has("",ar[lr][0]));return or.push(write_rdf_type("","Document","pkg")),or.push("</rdf:RDF>"),or.join("")}function write_meta_ods(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+XLSX.version+"</meta:generator></office:meta></office:document-meta>"}var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function cp_doit(ar,or,lr,cr,ur){ur[ar]!=null||or==null||or===""||(ur[ar]=or,or=escapexml(or),cr[cr.length]=lr?writextag(ar,or,lr):writetag(ar,or))}function write_core_props(ar,or){var lr=or||{},cr=[XML_HEADER,writextag("cp:coreProperties",null,{"xmlns:cp":XMLNS.CORE_PROPS,"xmlns:dc":XMLNS.dc,"xmlns:dcterms":XMLNS.dcterms,"xmlns:dcmitype":XMLNS.dcmitype,"xmlns:xsi":XMLNS.xsi})],ur={};if(!ar&&!lr.Props)return cr.join("");ar&&(ar.CreatedDate!=null&&cp_doit("dcterms:created",typeof ar.CreatedDate=="string"?ar.CreatedDate:write_w3cdtf(ar.CreatedDate,lr.WTF),{"xsi:type":"dcterms:W3CDTF"},cr,ur),ar.ModifiedDate!=null&&cp_doit("dcterms:modified",typeof ar.ModifiedDate=="string"?ar.ModifiedDate:write_w3cdtf(ar.ModifiedDate,lr.WTF),{"xsi:type":"dcterms:W3CDTF"},cr,ur));for(var dr=0;dr!=CORE_PROPS.length;++dr){var hr=CORE_PROPS[dr],pr=lr.Props&&lr.Props[hr[1]]!=null?lr.Props[hr[1]]:ar?ar[hr[1]]:null;pr===!0?pr="1":pr===!1?pr="0":typeof pr=="number"&&(pr=String(pr)),pr!=null&&cp_doit(hr[0],pr,null,cr,ur)}return cr.length>2&&(cr[cr.length]="</cp:coreProperties>",cr[1]=cr[1].replace("/>",">")),cr.join("")}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],PseudoPropsPairs=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function write_ext_props(ar){var or=[],lr=writextag;return ar||(ar={}),ar.Application="SheetJS",or[or.length]=XML_HEADER,or[or.length]=writextag("Properties",null,{xmlns:XMLNS.EXT_PROPS,"xmlns:vt":XMLNS.vt}),EXT_PROPS.forEach(function(cr){if(ar[cr[1]]!==void 0){var ur;switch(cr[2]){case"string":ur=escapexml(String(ar[cr[1]]));break;case"bool":ur=ar[cr[1]]?"true":"false";break}ur!==void 0&&(or[or.length]=lr(cr[0],ur))}}),or[or.length]=lr("HeadingPairs",lr("vt:vector",lr("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+lr("vt:variant",lr("vt:i4",String(ar.Worksheets))),{size:2,baseType:"variant"})),or[or.length]=lr("TitlesOfParts",lr("vt:vector",ar.SheetNames.map(function(cr){return"<vt:lpstr>"+escapexml(cr)+"</vt:lpstr>"}).join(""),{size:ar.Worksheets,baseType:"lpstr"})),or.length>2&&(or[or.length]="</Properties>",or[1]=or[1].replace("/>",">")),or.join("")}function write_cust_props(ar){var or=[XML_HEADER,writextag("Properties",null,{xmlns:XMLNS.CUST_PROPS,"xmlns:vt":XMLNS.vt})];if(!ar)return or.join("");var lr=1;return keys(ar).forEach(function(ur){++lr,or[or.length]=writextag("property",write_vt(ar[ur]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:lr,name:escapexml(ur)})}),or.length>2&&(or[or.length]="</Properties>",or[1]=or[1].replace("/>",">")),or.join("")}var XLMLDocPropsMap={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function xlml_write_docprops(ar,or){var lr=[];return keys(XLMLDocPropsMap).map(function(cr){for(var ur=0;ur<CORE_PROPS.length;++ur)if(CORE_PROPS[ur][1]==cr)return CORE_PROPS[ur];for(ur=0;ur<EXT_PROPS.length;++ur)if(EXT_PROPS[ur][1]==cr)return EXT_PROPS[ur];throw cr}).forEach(function(cr){if(ar[cr[1]]!=null){var ur=or&&or.Props&&or.Props[cr[1]]!=null?or.Props[cr[1]]:ar[cr[1]];switch(cr[2]){case"date":ur=new Date(ur).toISOString().replace(/\.\d*Z/,"Z");break}typeof ur=="number"?ur=String(ur):ur===!0||ur===!1?ur=ur?"1":"0":ur instanceof Date&&(ur=new Date(ur).toISOString().replace(/\.\d*Z/,"")),lr.push(writetag(XLMLDocPropsMap[cr[1]]||cr[1],ur))}}),writextag("DocumentProperties",lr.join(""),{xmlns:XLMLNS.o})}function xlml_write_custprops(ar,or){var lr=["Worksheets","SheetNames"],cr="CustomDocumentProperties",ur=[];return ar&&keys(ar).forEach(function(dr){if(Object.prototype.hasOwnProperty.call(ar,dr)){for(var hr=0;hr<CORE_PROPS.length;++hr)if(dr==CORE_PROPS[hr][1])return;for(hr=0;hr<EXT_PROPS.length;++hr)if(dr==EXT_PROPS[hr][1])return;for(hr=0;hr<lr.length;++hr)if(dr==lr[hr])return;var pr=ar[dr],xr="string";typeof pr=="number"?(xr="float",pr=String(pr)):pr===!0||pr===!1?(xr="boolean",pr=pr?"1":"0"):pr=String(pr),ur.push(writextag(escapexmltag(dr),pr,{"dt:dt":xr}))}}),or&&keys(or).forEach(function(dr){if(Object.prototype.hasOwnProperty.call(or,dr)&&!(ar&&Object.prototype.hasOwnProperty.call(ar,dr))){var hr=or[dr],pr="string";typeof hr=="number"?(pr="float",hr=String(hr)):hr===!0||hr===!1?(pr="boolean",hr=hr?"1":"0"):hr instanceof Date?(pr="dateTime.tz",hr=hr.toISOString()):hr=String(hr),ur.push(writextag(escapexmltag(dr),hr,{"dt:dt":pr}))}}),"<"+cr+' xmlns="'+XLMLNS.o+'">'+ur.join("")+"</"+cr+">"}function write_FILETIME(ar){var or=typeof ar=="string"?new Date(Date.parse(ar)):ar,lr=or.getTime()/1e3+11644473600,cr=lr%Math.pow(2,32),ur=(lr-cr)/Math.pow(2,32);cr*=1e7,ur*=1e7;var dr=cr/Math.pow(2,32)|0;dr>0&&(cr=cr%Math.pow(2,32),ur+=dr);var hr=new_buf(8);return hr.write_shift(4,cr),hr.write_shift(4,ur),hr}function write_TypedPropertyValue(ar,or){var lr=new_buf(4),cr=new_buf(4);switch(lr.write_shift(4,ar==80?31:ar),ar){case 3:cr.write_shift(-4,or);break;case 5:cr=new_buf(8),cr.write_shift(8,or,"f");break;case 11:cr.write_shift(4,or?1:0);break;case 64:cr=write_FILETIME(or);break;case 31:case 80:for(cr=new_buf(4+2*(or.length+1)+(or.length%2?0:2)),cr.write_shift(4,or.length+1),cr.write_shift(0,or,"dbcs");cr.l!=cr.length;)cr.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+ar+" "+or)}return bconcat([lr,cr])}var XLSPSSkip=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function guess_property_type(ar){switch(typeof ar){case"boolean":return 11;case"number":return(ar|0)==ar?3:5;case"string":return 31;case"object":if(ar instanceof Date)return 64;break}return-1}function write_PropertySet(ar,or,lr){var cr=new_buf(8),ur=[],dr=[],hr=8,pr=0,xr=new_buf(8),mr=new_buf(8);if(xr.write_shift(4,2),xr.write_shift(4,1200),mr.write_shift(4,1),dr.push(xr),ur.push(mr),hr+=8+xr.length,!or){mr=new_buf(8),mr.write_shift(4,0),ur.unshift(mr);var fr=[new_buf(4)];for(fr[0].write_shift(4,ar.length),pr=0;pr<ar.length;++pr){var Er=ar[pr][0];for(xr=new_buf(8+2*(Er.length+1)+(Er.length%2?0:2)),xr.write_shift(4,pr+2),xr.write_shift(4,Er.length+1),xr.write_shift(0,Er,"dbcs");xr.l!=xr.length;)xr.write_shift(1,0);fr.push(xr)}xr=bconcat(fr),dr.unshift(xr),hr+=8+xr.length}for(pr=0;pr<ar.length;++pr)if(!(or&&!or[ar[pr][0]])&&!(XLSPSSkip.indexOf(ar[pr][0])>-1||PseudoPropsPairs.indexOf(ar[pr][0])>-1)&&ar[pr][1]!=null){var vr=ar[pr][1],gr=0;if(or){gr=+or[ar[pr][0]];var yr=lr[gr];if(yr.p=="version"&&typeof vr=="string"){var jr=vr.split(".");vr=(+jr[0]<<16)+(+jr[1]||0)}xr=write_TypedPropertyValue(yr.t,vr)}else{var br=guess_property_type(vr);br==-1&&(br=31,vr=String(vr)),xr=write_TypedPropertyValue(br,vr)}dr.push(xr),mr=new_buf(8),mr.write_shift(4,or?gr:2+pr),ur.push(mr),hr+=8+xr.length}var _r=8*(dr.length+1);for(pr=0;pr<dr.length;++pr)ur[pr].write_shift(4,_r),_r+=dr[pr].length;return cr.write_shift(4,hr),cr.write_shift(4,dr.length),bconcat([cr].concat(ur).concat(dr))}function write_PropertySetStream(ar,or,lr,cr,ur,dr){var hr=new_buf(ur?68:48),pr=[hr];hr.write_shift(2,65534),hr.write_shift(2,0),hr.write_shift(4,842412599),hr.write_shift(16,CFB.utils.consts.HEADER_CLSID,"hex"),hr.write_shift(4,ur?2:1),hr.write_shift(16,or,"hex"),hr.write_shift(4,ur?68:48);var xr=write_PropertySet(ar,lr,cr);if(pr.push(xr),ur){var mr=write_PropertySet(ur,null,null);hr.write_shift(16,dr,"hex"),hr.write_shift(4,68+xr.length),pr.push(mr)}return bconcat(pr)}function writezeroes(ar,or){or||(or=new_buf(ar));for(var lr=0;lr<ar;++lr)or.write_shift(1,0);return or}function parsebool(ar,or){return ar.read_shift(or)===1}function writebool(ar,or){return or||(or=new_buf(2)),or.write_shift(2,+!!ar),or}function parseuint16(ar){return ar.read_shift(2,"u")}function writeuint16(ar,or){return or||(or=new_buf(2)),or.write_shift(2,ar),or}function write_Bes(ar,or,lr){return lr||(lr=new_buf(2)),lr.write_shift(1,or=="e"?+ar:+!!ar),lr.write_shift(1,or=="e"?1:0),lr}function parse_ShortXLUnicodeString(ar,or,lr){var cr=ar.read_shift(lr&&lr.biff>=12?2:1),ur="sbcs-cont";if(lr&&lr.biff>=8,!lr||lr.biff==8){var dr=ar.read_shift(1);dr&&(ur="dbcs-cont")}else lr.biff==12&&(ur="wstr");lr.biff>=2&&lr.biff<=5&&(ur="cpstr");var hr=cr?ar.read_shift(cr,ur):"";return hr}function write_XLUnicodeRichExtendedString(ar){var or=ar.t||"",lr=new_buf(3);lr.write_shift(2,or.length),lr.write_shift(1,1);var cr=new_buf(2*or.length);cr.write_shift(2*or.length,or,"utf16le");var ur=[lr,cr];return bconcat(ur)}function parse_XLUnicodeStringNoCch(ar,or,lr){var cr;if(lr){if(lr.biff>=2&&lr.biff<=5)return ar.read_shift(or,"cpstr");if(lr.biff>=12)return ar.read_shift(or,"dbcs-cont")}var ur=ar.read_shift(1);return ur===0?cr=ar.read_shift(or,"sbcs-cont"):cr=ar.read_shift(or,"dbcs-cont"),cr}function parse_XLUnicodeString(ar,or,lr){var cr=ar.read_shift(lr&&lr.biff==2?1:2);return cr===0?(ar.l++,""):parse_XLUnicodeStringNoCch(ar,cr,lr)}function parse_XLUnicodeString2(ar,or,lr){if(lr.biff>5)return parse_XLUnicodeString(ar,or,lr);var cr=ar.read_shift(1);return cr===0?(ar.l++,""):ar.read_shift(cr,lr.biff<=4||!ar.lens?"cpstr":"sbcs-cont")}function write_XLUnicodeString(ar,or,lr){return lr||(lr=new_buf(3+2*ar.length)),lr.write_shift(2,ar.length),lr.write_shift(1,1),lr.write_shift(31,ar,"utf16le"),lr}function write_HyperlinkString(ar,or){or||(or=new_buf(6+ar.length*2)),or.write_shift(4,1+ar.length);for(var lr=0;lr<ar.length;++lr)or.write_shift(2,ar.charCodeAt(lr));return or.write_shift(2,0),or}function write_Hyperlink(ar){var or=new_buf(512),lr=0,cr=ar.Target;cr.slice(0,7)=="file://"&&(cr=cr.slice(7));var ur=cr.indexOf("#"),dr=ur>-1?31:23;switch(cr.charAt(0)){case"#":dr=28;break;case".":dr&=-3;break}or.write_shift(4,2),or.write_shift(4,dr);var hr=[8,6815827,6619237,4849780,83];for(lr=0;lr<hr.length;++lr)or.write_shift(4,hr[lr]);if(dr==28)cr=cr.slice(1),write_HyperlinkString(cr,or);else if(dr&2){for(hr="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),lr=0;lr<hr.length;++lr)or.write_shift(1,parseInt(hr[lr],16));var pr=ur>-1?cr.slice(0,ur):cr;for(or.write_shift(4,2*(pr.length+1)),lr=0;lr<pr.length;++lr)or.write_shift(2,pr.charCodeAt(lr));or.write_shift(2,0),dr&8&&write_HyperlinkString(ur>-1?cr.slice(ur+1):"",or)}else{for(hr="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),lr=0;lr<hr.length;++lr)or.write_shift(1,parseInt(hr[lr],16));for(var xr=0;cr.slice(xr*3,xr*3+3)=="../"||cr.slice(xr*3,xr*3+3)=="..\\";)++xr;for(or.write_shift(2,xr),or.write_shift(4,cr.length-3*xr+1),lr=0;lr<cr.length-3*xr;++lr)or.write_shift(1,cr.charCodeAt(lr+3*xr)&255);for(or.write_shift(1,0),or.write_shift(2,65535),or.write_shift(2,57005),lr=0;lr<6;++lr)or.write_shift(4,0)}return or.slice(0,or.l)}function write_XLSCell(ar,or,lr,cr){return cr||(cr=new_buf(6)),cr.write_shift(2,ar),cr.write_shift(2,or),cr.write_shift(2,lr||0),cr}function parse_XTI(ar,or,lr){var cr=lr.biff>8?4:2,ur=ar.read_shift(cr),dr=ar.read_shift(cr,"i"),hr=ar.read_shift(cr,"i");return[ur,dr,hr]}function parse_Ref8U(ar){var or=ar.read_shift(2),lr=ar.read_shift(2),cr=ar.read_shift(2),ur=ar.read_shift(2);return{s:{c:cr,r:or},e:{c:ur,r:lr}}}function write_Ref8U(ar,or){return or||(or=new_buf(8)),or.write_shift(2,ar.s.r),or.write_shift(2,ar.e.r),or.write_shift(2,ar.s.c),or.write_shift(2,ar.e.c),or}function write_BOF(ar,or,lr){var cr=1536,ur=16;switch(lr.bookType){case"biff8":break;case"biff5":cr=1280,ur=8;break;case"biff4":cr=4,ur=6;break;case"biff3":cr=3,ur=6;break;case"biff2":cr=2,ur=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var dr=new_buf(ur);return dr.write_shift(2,cr),dr.write_shift(2,or),ur>4&&dr.write_shift(2,29282),ur>6&&dr.write_shift(2,1997),ur>8&&(dr.write_shift(2,49161),dr.write_shift(2,1),dr.write_shift(2,1798),dr.write_shift(2,0)),dr}function write_WriteAccess(ar,or){var lr=!or||or.biff==8,cr=new_buf(lr?112:54);for(cr.write_shift(or.biff==8?2:1,7),lr&&cr.write_shift(1,0),cr.write_shift(4,859007059),cr.write_shift(4,5458548|(lr?0:536870912));cr.l<cr.length;)cr.write_shift(1,lr?0:32);return cr}function write_BoundSheet8(ar,or){var lr=!or||or.biff>=8?2:1,cr=new_buf(8+lr*ar.name.length);cr.write_shift(4,ar.pos),cr.write_shift(1,ar.hs||0),cr.write_shift(1,ar.dt),cr.write_shift(1,ar.name.length),or.biff>=8&&cr.write_shift(1,1),cr.write_shift(lr*ar.name.length,ar.name,or.biff<8?"sbcs":"utf16le");var ur=cr.slice(0,cr.l);return ur.l=cr.l,ur}function write_SST(ar,or){var lr=new_buf(8);lr.write_shift(4,ar.Count),lr.write_shift(4,ar.Unique);for(var cr=[],ur=0;ur<ar.length;++ur)cr[ur]=write_XLUnicodeRichExtendedString(ar[ur]);var dr=bconcat([lr].concat(cr));return dr.parts=[lr.length].concat(cr.map(function(hr){return hr.length})),dr}function write_Window1(){var ar=new_buf(18);return ar.write_shift(2,0),ar.write_shift(2,0),ar.write_shift(2,29280),ar.write_shift(2,17600),ar.write_shift(2,56),ar.write_shift(2,0),ar.write_shift(2,0),ar.write_shift(2,1),ar.write_shift(2,500),ar}function write_Window2(ar){var or=new_buf(18),lr=1718;return ar&&ar.RTL&&(lr|=64),or.write_shift(2,lr),or.write_shift(4,0),or.write_shift(4,64),or.write_shift(4,0),or.write_shift(4,0),or}function write_Font(ar,or){var lr=ar.name||"Arial",cr=or&&or.biff==5,ur=cr?15+lr.length:16+2*lr.length,dr=new_buf(ur);return dr.write_shift(2,ar.sz*20),dr.write_shift(4,0),dr.write_shift(2,400),dr.write_shift(4,0),dr.write_shift(2,0),dr.write_shift(1,lr.length),cr||dr.write_shift(1,1),dr.write_shift((cr?1:2)*lr.length,lr,cr?"sbcs":"utf16le"),dr}function write_LabelSst(ar,or,lr,cr){var ur=new_buf(10);return write_XLSCell(ar,or,cr,ur),ur.write_shift(4,lr),ur}function write_Label(ar,or,lr,cr,ur){var dr=!ur||ur.biff==8,hr=new_buf(8+ +dr+(1+dr)*lr.length);return write_XLSCell(ar,or,cr,hr),hr.write_shift(2,lr.length),dr&&hr.write_shift(1,1),hr.write_shift((1+dr)*lr.length,lr,dr?"utf16le":"sbcs"),hr}function write_Format(ar,or,lr,cr){var ur=lr&&lr.biff==5;cr||(cr=new_buf(ur?3+or.length:5+2*or.length)),cr.write_shift(2,ar),cr.write_shift(ur?1:2,or.length),ur||cr.write_shift(1,1),cr.write_shift((ur?1:2)*or.length,or,ur?"sbcs":"utf16le");var dr=cr.length>cr.l?cr.slice(0,cr.l):cr;return dr.l==null&&(dr.l=dr.length),dr}function write_Dimensions(ar,or){var lr=or.biff==8||!or.biff?4:2,cr=new_buf(2*lr+6);return cr.write_shift(lr,ar.s.r),cr.write_shift(lr,ar.e.r+1),cr.write_shift(2,ar.s.c),cr.write_shift(2,ar.e.c+1),cr.write_shift(2,0),cr}function write_XF(ar,or,lr,cr){var ur=lr&&lr.biff==5;cr||(cr=new_buf(ur?16:20)),cr.write_shift(2,0),ar.style?(cr.write_shift(2,ar.numFmtId||0),cr.write_shift(2,65524)):(cr.write_shift(2,ar.numFmtId||0),cr.write_shift(2,or<<4));var dr=0;return ar.numFmtId>0&&ur&&(dr|=1024),cr.write_shift(4,dr),cr.write_shift(4,0),ur||cr.write_shift(4,0),cr.write_shift(2,0),cr}function write_Guts(ar){var or=new_buf(8);return or.write_shift(4,0),or.write_shift(2,0),or.write_shift(2,0),or}function write_BoolErr(ar,or,lr,cr,ur,dr){var hr=new_buf(8);return write_XLSCell(ar,or,cr,hr),write_Bes(lr,dr,hr),hr}function write_Number(ar,or,lr,cr){var ur=new_buf(14);return write_XLSCell(ar,or,cr,ur),write_Xnum(lr,ur),ur}function parse_ExternSheet(ar,or,lr){if(lr.biff<8)return parse_BIFF5ExternSheet(ar,or,lr);for(var cr=[],ur=ar.l+or,dr=ar.read_shift(lr.biff>8?4:2);dr--!==0;)cr.push(parse_XTI(ar,lr.biff>8?12:6,lr));if(ar.l!=ur)throw new Error("Bad ExternSheet: "+ar.l+" != "+ur);return cr}function parse_BIFF5ExternSheet(ar,or,lr){ar[ar.l+1]==3&&ar[ar.l]++;var cr=parse_ShortXLUnicodeString(ar,or,lr);return cr.charCodeAt(0)==3?cr.slice(1):cr}function write_MergeCells(ar){var or=new_buf(2+ar.length*8);or.write_shift(2,ar.length);for(var lr=0;lr<ar.length;++lr)write_Ref8U(ar[lr],or);return or}function write_HLink(ar){var or=new_buf(24),lr=decode_cell(ar[0]);or.write_shift(2,lr.r),or.write_shift(2,lr.r),or.write_shift(2,lr.c),or.write_shift(2,lr.c);for(var cr="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),ur=0;ur<16;++ur)or.write_shift(1,parseInt(cr[ur],16));return bconcat([or,write_Hyperlink(ar[1])])}function write_HLinkTooltip(ar){var or=ar[1].Tooltip,lr=new_buf(10+2*(or.length+1));lr.write_shift(2,2048);var cr=decode_cell(ar[0]);lr.write_shift(2,cr.r),lr.write_shift(2,cr.r),lr.write_shift(2,cr.c),lr.write_shift(2,cr.c);for(var ur=0;ur<or.length;++ur)lr.write_shift(2,or.charCodeAt(ur));return lr.write_shift(2,0),lr}function write_Country(ar){return ar||(ar=new_buf(4)),ar.write_shift(2,1),ar.write_shift(2,1),ar}function parse_ColInfo(ar,or,lr){if(!lr.cellStyles)return parsenoop(ar,or);var cr=lr&&lr.biff>=12?4:2,ur=ar.read_shift(cr),dr=ar.read_shift(cr),hr=ar.read_shift(cr),pr=ar.read_shift(cr),xr=ar.read_shift(2);cr==2&&(ar.l+=2);var mr={s:ur,e:dr,w:hr,ixfe:pr,flags:xr};return(lr.biff>=5||!lr.biff)&&(mr.level=xr>>8&7),mr}function write_ColInfo(ar,or){var lr=new_buf(12);lr.write_shift(2,or),lr.write_shift(2,or),lr.write_shift(2,ar.width*256),lr.write_shift(2,0);var cr=0;return ar.hidden&&(cr|=1),lr.write_shift(1,cr),cr=ar.level||0,lr.write_shift(1,cr),lr.write_shift(2,0),lr}function write_RRTabId(ar){for(var or=new_buf(2*ar),lr=0;lr<ar;++lr)or.write_shift(2,lr+1);return or}function write_BIFF2NUM(ar,or,lr){var cr=new_buf(15);return write_BIFF2Cell(cr,ar,or),cr.write_shift(8,lr,"f"),cr}function write_BIFF2INT(ar,or,lr){var cr=new_buf(9);return write_BIFF2Cell(cr,ar,or),cr.write_shift(2,lr),cr}var DBF=function(){var ar={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},or=evert({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function lr(pr,xr){var mr=[],fr=new_raw_buf(1);switch(xr.type){case"base64":fr=s2a(Base64_decode(pr));break;case"binary":fr=s2a(pr);break;case"buffer":case"array":fr=pr;break}prep_blob(fr,0);var Er=fr.read_shift(1),vr=!!(Er&136),gr=!1,yr=!1;switch(Er){case 2:break;case 3:break;case 48:gr=!0,vr=!0;break;case 49:gr=!0,vr=!0;break;case 131:break;case 139:break;case 140:yr=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+Er.toString(16))}var jr=0,br=521;Er==2&&(jr=fr.read_shift(2)),fr.l+=3,Er!=2&&(jr=fr.read_shift(4)),jr>1048576&&(jr=1e6),Er!=2&&(br=fr.read_shift(2));var _r=fr.read_shift(2),wr=xr.codepage||1252;Er!=2&&(fr.l+=16,fr.read_shift(1),fr[fr.l]!==0&&(wr=ar[fr[fr.l]]),fr.l+=1,fr.l+=2),yr&&(fr.l+=36);for(var Rr=[],Ar={},Sr=Math.min(fr.length,Er==2?521:br-10-(gr?264:0)),kr=yr?32:11;fr.l<Sr&&fr[fr.l]!=13;)switch(Ar={},Ar.name=$cptable.utils.decode(wr,fr.slice(fr.l,fr.l+kr)).replace(/[\u0000\r\n].*$/g,""),fr.l+=kr,Ar.type=String.fromCharCode(fr.read_shift(1)),Er!=2&&!yr&&(Ar.offset=fr.read_shift(4)),Ar.len=fr.read_shift(1),Er==2&&(Ar.offset=fr.read_shift(2)),Ar.dec=fr.read_shift(1),Ar.name.length&&Rr.push(Ar),Er!=2&&(fr.l+=yr?13:14),Ar.type){case"B":(!gr||Ar.len!=8)&&xr.WTF&&console.log("Skipping "+Ar.name+":"+Ar.type);break;case"G":case"P":xr.WTF&&console.log("Skipping "+Ar.name+":"+Ar.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+Ar.type)}if(fr[fr.l]!==13&&(fr.l=br-1),fr.read_shift(1)!==13)throw new Error("DBF Terminator not found "+fr.l+" "+fr[fr.l]);fr.l=br;var Nr=0,Cr=0;for(mr[0]=[],Cr=0;Cr!=Rr.length;++Cr)mr[0][Cr]=Rr[Cr].name;for(;jr-- >0;){if(fr[fr.l]===42){fr.l+=_r;continue}for(++fr.l,mr[++Nr]=[],Cr=0,Cr=0;Cr!=Rr.length;++Cr){var Tr=fr.slice(fr.l,fr.l+Rr[Cr].len);fr.l+=Rr[Cr].len,prep_blob(Tr,0);var Pr=$cptable.utils.decode(wr,Tr);switch(Rr[Cr].type){case"C":Pr.trim().length&&(mr[Nr][Cr]=Pr.replace(/\s+$/,""));break;case"D":Pr.length===8?mr[Nr][Cr]=new Date(+Pr.slice(0,4),+Pr.slice(4,6)-1,+Pr.slice(6,8)):mr[Nr][Cr]=Pr;break;case"F":mr[Nr][Cr]=parseFloat(Pr.trim());break;case"+":case"I":mr[Nr][Cr]=yr?Tr.read_shift(-4,"i")^2147483648:Tr.read_shift(4,"i");break;case"L":switch(Pr.trim().toUpperCase()){case"Y":case"T":mr[Nr][Cr]=!0;break;case"N":case"F":mr[Nr][Cr]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+Pr+"|")}break;case"M":if(!vr)throw new Error("DBF Unexpected MEMO for type "+Er.toString(16));mr[Nr][Cr]="##MEMO##"+(yr?parseInt(Pr.trim(),10):Tr.read_shift(4));break;case"N":Pr=Pr.replace(/\u0000/g,"").trim(),Pr&&Pr!="."&&(mr[Nr][Cr]=+Pr||0);break;case"@":mr[Nr][Cr]=new Date(Tr.read_shift(-8,"f")-621356832e5);break;case"T":mr[Nr][Cr]=new Date((Tr.read_shift(4)-2440588)*864e5+Tr.read_shift(4));break;case"Y":mr[Nr][Cr]=Tr.read_shift(4,"i")/1e4+Tr.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":mr[Nr][Cr]=-Tr.read_shift(-8,"f");break;case"B":if(gr&&Rr[Cr].len==8){mr[Nr][Cr]=Tr.read_shift(8,"f");break}case"G":case"P":Tr.l+=Rr[Cr].len;break;case"0":if(Rr[Cr].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+Rr[Cr].type)}}}if(Er!=2&&fr.l<fr.length&&fr[fr.l++]!=26)throw new Error("DBF EOF Marker missing "+(fr.l-1)+" of "+fr.length+" "+fr[fr.l-1].toString(16));return xr&&xr.sheetRows&&(mr=mr.slice(0,xr.sheetRows)),xr.DBF=Rr,mr}function cr(pr,xr){var mr=xr||{};mr.dateNF||(mr.dateNF="yyyymmdd");var fr=aoa_to_sheet(lr(pr,mr),mr);return fr["!cols"]=mr.DBF.map(function(Er){return{wch:Er.len,DBF:Er}}),delete mr.DBF,fr}function ur(pr,xr){try{return sheet_to_workbook(cr(pr,xr),xr)}catch(mr){if(xr&&xr.WTF)throw mr}return{SheetNames:[],Sheets:{}}}var dr={B:8,C:250,L:1,D:8,"?":0,"":0};function hr(pr,xr){var mr=xr||{};if(+mr.codepage>=0&&set_cp(+mr.codepage),mr.type=="string")throw new Error("Cannot write DBF to JS string");var fr=buf_array(),Er=sheet_to_json(pr,{header:1,raw:!0,cellDates:!0}),vr=Er[0],gr=Er.slice(1),yr=pr["!cols"]||[],jr=0,br=0,_r=0,wr=1;for(jr=0;jr<vr.length;++jr){if(((yr[jr]||{}).DBF||{}).name){vr[jr]=yr[jr].DBF.name,++_r;continue}if(vr[jr]!=null){if(++_r,typeof vr[jr]=="number"&&(vr[jr]=vr[jr].toString(10)),typeof vr[jr]!="string")throw new Error("DBF Invalid column name "+vr[jr]+" |"+typeof vr[jr]+"|");if(vr.indexOf(vr[jr])!==jr){for(br=0;br<1024;++br)if(vr.indexOf(vr[jr]+"_"+br)==-1){vr[jr]+="_"+br;break}}}}var Rr=safe_decode_range(pr["!ref"]),Ar=[],Sr=[],kr=[];for(jr=0;jr<=Rr.e.c-Rr.s.c;++jr){var Nr="",Cr="",Tr=0,Pr=[];for(br=0;br<gr.length;++br)gr[br][jr]!=null&&Pr.push(gr[br][jr]);if(Pr.length==0||vr[jr]==null){Ar[jr]="?";continue}for(br=0;br<Pr.length;++br){switch(typeof Pr[br]){case"number":Cr="B";break;case"string":Cr="C";break;case"boolean":Cr="L";break;case"object":Cr=Pr[br]instanceof Date?"D":"C";break;default:Cr="C"}Tr=Math.max(Tr,String(Pr[br]).length),Nr=Nr&&Nr!=Cr?"C":Cr}Tr>250&&(Tr=250),Cr=((yr[jr]||{}).DBF||{}).type,Cr=="C"&&yr[jr].DBF.len>Tr&&(Tr=yr[jr].DBF.len),Nr=="B"&&Cr=="N"&&(Nr="N",kr[jr]=yr[jr].DBF.dec,Tr=yr[jr].DBF.len),Sr[jr]=Nr=="C"||Cr=="N"?Tr:dr[Nr]||0,wr+=Sr[jr],Ar[jr]=Nr}var Ir=fr.next(32);for(Ir.write_shift(4,318902576),Ir.write_shift(4,gr.length),Ir.write_shift(2,296+32*_r),Ir.write_shift(2,wr),jr=0;jr<4;++jr)Ir.write_shift(4,0);for(Ir.write_shift(4,0|(+or[current_ansi]||3)<<8),jr=0,br=0;jr<vr.length;++jr)if(vr[jr]!=null){var Br=fr.next(32),Wr=(vr[jr].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Br.write_shift(1,Wr,"sbcs"),Br.write_shift(1,Ar[jr]=="?"?"C":Ar[jr],"sbcs"),Br.write_shift(4,br),Br.write_shift(1,Sr[jr]||dr[Ar[jr]]||0),Br.write_shift(1,kr[jr]||0),Br.write_shift(1,2),Br.write_shift(4,0),Br.write_shift(1,0),Br.write_shift(4,0),Br.write_shift(4,0),br+=Sr[jr]||dr[Ar[jr]]||0}var Yr=fr.next(264);for(Yr.write_shift(4,13),jr=0;jr<65;++jr)Yr.write_shift(4,0);for(jr=0;jr<gr.length;++jr){var es=fr.next(wr);for(es.write_shift(1,0),br=0;br<vr.length;++br)if(vr[br]!=null)switch(Ar[br]){case"L":es.write_shift(1,gr[jr][br]==null?63:gr[jr][br]?84:70);break;case"B":es.write_shift(8,gr[jr][br]||0,"f");break;case"N":var ps="0";for(typeof gr[jr][br]=="number"&&(ps=gr[jr][br].toFixed(kr[br]||0)),_r=0;_r<Sr[br]-ps.length;++_r)es.write_shift(1,32);es.write_shift(1,ps,"sbcs");break;case"D":gr[jr][br]?(es.write_shift(4,("0000"+gr[jr][br].getFullYear()).slice(-4),"sbcs"),es.write_shift(2,("00"+(gr[jr][br].getMonth()+1)).slice(-2),"sbcs"),es.write_shift(2,("00"+gr[jr][br].getDate()).slice(-2),"sbcs")):es.write_shift(8,"00000000","sbcs");break;case"C":var ts=String(gr[jr][br]!=null?gr[jr][br]:"").slice(0,Sr[br]);for(es.write_shift(1,ts,"sbcs"),_r=0;_r<Sr[br]-ts.length;++_r)es.write_shift(1,32);break}}return fr.next(1).write_shift(1,26),fr.end()}return{to_workbook:ur,to_sheet:cr,from_sheet:hr}}(),SYLK=function(){var ar={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},or=new RegExp("\x1BN("+keys(ar).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),lr=function(vr,gr){var yr=ar[gr];return typeof yr=="number"?_getansi(yr):yr},cr=function(vr,gr,yr){var jr=gr.charCodeAt(0)-32<<4|yr.charCodeAt(0)-48;return jr==59?vr:_getansi(jr)};ar["|"]=254;function ur(vr,gr){switch(gr.type){case"base64":return dr(Base64_decode(vr),gr);case"binary":return dr(vr,gr);case"buffer":return dr(has_buf&&Buffer.isBuffer(vr)?vr.toString("binary"):a2s(vr),gr);case"array":return dr(cc2str(vr),gr)}throw new Error("Unrecognized type "+gr.type)}function dr(vr,gr){var yr=vr.split(/[\n\r]+/),jr=-1,br=-1,_r=0,wr=0,Rr=[],Ar=[],Sr=null,kr={},Nr=[],Cr=[],Tr=[],Pr=0,Ir;for(+gr.codepage>=0&&set_cp(+gr.codepage);_r!==yr.length;++_r){Pr=0;var Br=yr[_r].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,cr).replace(or,lr),Wr=Br.replace(/;;/g,"\0").split(";").map(function(Fr){return Fr.replace(/\u0000/g,";")}),Yr=Wr[0],es;if(Br.length>0)switch(Yr){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":Wr[1].charAt(0)=="P"&&Ar.push(Br.slice(3).replace(/;;/g,";"));break;case"C":var ps=!1,ts=!1,Qr=!1,Hr=!1,Kr=-1,rs=-1;for(wr=1;wr<Wr.length;++wr)switch(Wr[wr].charAt(0)){case"A":break;case"X":br=parseInt(Wr[wr].slice(1))-1,ts=!0;break;case"Y":for(jr=parseInt(Wr[wr].slice(1))-1,ts||(br=0),Ir=Rr.length;Ir<=jr;++Ir)Rr[Ir]=[];break;case"K":es=Wr[wr].slice(1),es.charAt(0)==='"'?es=es.slice(1,es.length-1):es==="TRUE"?es=!0:es==="FALSE"?es=!1:isNaN(fuzzynum(es))?isNaN(fuzzydate(es).getDate())||(es=parseDate(es)):(es=fuzzynum(es),Sr!==null&&fmt_is_date(Sr)&&(es=numdate(es))),ps=!0;break;case"E":Hr=!0;var Mr=rc_to_a1(Wr[wr].slice(1),{r:jr,c:br});Rr[jr][br]=[Rr[jr][br],Mr];break;case"S":Qr=!0,Rr[jr][br]=[Rr[jr][br],"S5S"];break;case"G":break;case"R":Kr=parseInt(Wr[wr].slice(1))-1;break;case"C":rs=parseInt(Wr[wr].slice(1))-1;break;default:if(gr&&gr.WTF)throw new Error("SYLK bad record "+Br)}if(ps&&(Rr[jr][br]&&Rr[jr][br].length==2?Rr[jr][br][0]=es:Rr[jr][br]=es,Sr=null),Qr){if(Hr)throw new Error("SYLK shared formula cannot have own formula");var Dr=Kr>-1&&Rr[Kr][rs];if(!Dr||!Dr[1])throw new Error("SYLK shared formula cannot find base");Rr[jr][br][1]=shift_formula_str(Dr[1],{r:jr-Kr,c:br-rs})}break;case"F":var Lr=0;for(wr=1;wr<Wr.length;++wr)switch(Wr[wr].charAt(0)){case"X":br=parseInt(Wr[wr].slice(1))-1,++Lr;break;case"Y":for(jr=parseInt(Wr[wr].slice(1))-1,Ir=Rr.length;Ir<=jr;++Ir)Rr[Ir]=[];break;case"M":Pr=parseInt(Wr[wr].slice(1))/20;break;case"F":break;case"G":break;case"P":Sr=Ar[parseInt(Wr[wr].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(Tr=Wr[wr].slice(1).split(" "),Ir=parseInt(Tr[0],10);Ir<=parseInt(Tr[1],10);++Ir)Pr=parseInt(Tr[2],10),Cr[Ir-1]=Pr===0?{hidden:!0}:{wch:Pr},process_col(Cr[Ir-1]);break;case"C":br=parseInt(Wr[wr].slice(1))-1,Cr[br]||(Cr[br]={});break;case"R":jr=parseInt(Wr[wr].slice(1))-1,Nr[jr]||(Nr[jr]={}),Pr>0?(Nr[jr].hpt=Pr,Nr[jr].hpx=pt2px(Pr)):Pr===0&&(Nr[jr].hidden=!0);break;default:if(gr&&gr.WTF)throw new Error("SYLK bad record "+Br)}Lr<1&&(Sr=null);break;default:if(gr&&gr.WTF)throw new Error("SYLK bad record "+Br)}}return Nr.length>0&&(kr["!rows"]=Nr),Cr.length>0&&(kr["!cols"]=Cr),gr&&gr.sheetRows&&(Rr=Rr.slice(0,gr.sheetRows)),[Rr,kr]}function hr(vr,gr){var yr=ur(vr,gr),jr=yr[0],br=yr[1],_r=aoa_to_sheet(jr,gr);return keys(br).forEach(function(wr){_r[wr]=br[wr]}),_r}function pr(vr,gr){return sheet_to_workbook(hr(vr,gr),gr)}function xr(vr,gr,yr,jr){var br="C;Y"+(yr+1)+";X"+(jr+1)+";K";switch(vr.t){case"n":br+=vr.v||0,vr.f&&!vr.F&&(br+=";E"+a1_to_rc(vr.f,{r:yr,c:jr}));break;case"b":br+=vr.v?"TRUE":"FALSE";break;case"e":br+=vr.w||vr.v;break;case"d":br+='"'+(vr.w||vr.v)+'"';break;case"s":br+='"'+vr.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return br}function mr(vr,gr){gr.forEach(function(yr,jr){var br="F;W"+(jr+1)+" "+(jr+1)+" ";yr.hidden?br+="0":(typeof yr.width=="number"&&!yr.wpx&&(yr.wpx=width2px(yr.width)),typeof yr.wpx=="number"&&!yr.wch&&(yr.wch=px2char(yr.wpx)),typeof yr.wch=="number"&&(br+=Math.round(yr.wch))),br.charAt(br.length-1)!=" "&&vr.push(br)})}function fr(vr,gr){gr.forEach(function(yr,jr){var br="F;";yr.hidden?br+="M0;":yr.hpt?br+="M"+20*yr.hpt+";":yr.hpx&&(br+="M"+20*px2pt(yr.hpx)+";"),br.length>2&&vr.push(br+"R"+(jr+1))})}function Er(vr,gr){var yr=["ID;PWXL;N;E"],jr=[],br=safe_decode_range(vr["!ref"]),_r,wr=Array.isArray(vr),Rr=`\r
`;yr.push("P;PGeneral"),yr.push("F;P0;DG0G8;M255"),vr["!cols"]&&mr(yr,vr["!cols"]),vr["!rows"]&&fr(yr,vr["!rows"]),yr.push("B;Y"+(br.e.r-br.s.r+1)+";X"+(br.e.c-br.s.c+1)+";D"+[br.s.c,br.s.r,br.e.c,br.e.r].join(" "));for(var Ar=br.s.r;Ar<=br.e.r;++Ar)for(var Sr=br.s.c;Sr<=br.e.c;++Sr){var kr=encode_cell({r:Ar,c:Sr});_r=wr?(vr[Ar]||[])[Sr]:vr[kr],!(!_r||_r.v==null&&(!_r.f||_r.F))&&jr.push(xr(_r,vr,Ar,Sr))}return yr.join(Rr)+Rr+jr.join(Rr)+Rr+"E"+Rr}return{to_workbook:pr,to_sheet:hr,from_sheet:Er}}(),DIF=function(){function ar(dr,hr){switch(hr.type){case"base64":return or(Base64_decode(dr),hr);case"binary":return or(dr,hr);case"buffer":return or(has_buf&&Buffer.isBuffer(dr)?dr.toString("binary"):a2s(dr),hr);case"array":return or(cc2str(dr),hr)}throw new Error("Unrecognized type "+hr.type)}function or(dr,hr){for(var pr=dr.split(`
`),xr=-1,mr=-1,fr=0,Er=[];fr!==pr.length;++fr){if(pr[fr].trim()==="BOT"){Er[++xr]=[],mr=0;continue}if(!(xr<0)){var vr=pr[fr].trim().split(","),gr=vr[0],yr=vr[1];++fr;for(var jr=pr[fr]||"";(jr.match(/["]/g)||[]).length&1&&fr<pr.length-1;)jr+=`
`+pr[++fr];switch(jr=jr.trim(),+gr){case-1:if(jr==="BOT"){Er[++xr]=[],mr=0;continue}else if(jr!=="EOD")throw new Error("Unrecognized DIF special command "+jr);break;case 0:jr==="TRUE"?Er[xr][mr]=!0:jr==="FALSE"?Er[xr][mr]=!1:isNaN(fuzzynum(yr))?isNaN(fuzzydate(yr).getDate())?Er[xr][mr]=yr:Er[xr][mr]=parseDate(yr):Er[xr][mr]=fuzzynum(yr),++mr;break;case 1:jr=jr.slice(1,jr.length-1),jr=jr.replace(/""/g,'"'),jr&&jr.match(/^=".*"$/)&&(jr=jr.slice(2,-1)),Er[xr][mr++]=jr!==""?jr:null;break}if(jr==="EOD")break}}return hr&&hr.sheetRows&&(Er=Er.slice(0,hr.sheetRows)),Er}function lr(dr,hr){return aoa_to_sheet(ar(dr,hr),hr)}function cr(dr,hr){return sheet_to_workbook(lr(dr,hr),hr)}var ur=function(){var dr=function(xr,mr,fr,Er,vr){xr.push(mr),xr.push(fr+","+Er),xr.push('"'+vr.replace(/"/g,'""')+'"')},hr=function(xr,mr,fr,Er){xr.push(mr+","+fr),xr.push(mr==1?'"'+Er.replace(/"/g,'""')+'"':Er)};return function(xr){var mr=[],fr=safe_decode_range(xr["!ref"]),Er,vr=Array.isArray(xr);dr(mr,"TABLE",0,1,"sheetjs"),dr(mr,"VECTORS",0,fr.e.r-fr.s.r+1,""),dr(mr,"TUPLES",0,fr.e.c-fr.s.c+1,""),dr(mr,"DATA",0,0,"");for(var gr=fr.s.r;gr<=fr.e.r;++gr){hr(mr,-1,0,"BOT");for(var yr=fr.s.c;yr<=fr.e.c;++yr){var jr=encode_cell({r:gr,c:yr});if(Er=vr?(xr[gr]||[])[yr]:xr[jr],!Er){hr(mr,1,0,"");continue}switch(Er.t){case"n":var br=Er.w;!br&&Er.v!=null&&(br=Er.v),br==null?Er.f&&!Er.F?hr(mr,1,0,"="+Er.f):hr(mr,1,0,""):hr(mr,0,br,"V");break;case"b":hr(mr,0,Er.v?1:0,Er.v?"TRUE":"FALSE");break;case"s":hr(mr,1,0,isNaN(Er.v)?Er.v:'="'+Er.v+'"');break;case"d":Er.w||(Er.w=SSF_format(Er.z||table_fmt[14],datenum(parseDate(Er.v)))),hr(mr,0,Er.w,"V");break;default:hr(mr,1,0,"")}}}hr(mr,-1,0,"EOD");var _r=`\r
`,wr=mr.join(_r);return wr}}();return{to_workbook:cr,to_sheet:lr,from_sheet:ur}}(),ETH=function(){function ar(Er){return Er.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function or(Er){return Er.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function lr(Er,vr){for(var gr=Er.split(`
`),yr=-1,jr=-1,br=0,_r=[];br!==gr.length;++br){var wr=gr[br].trim().split(":");if(wr[0]==="cell"){var Rr=decode_cell(wr[1]);if(_r.length<=Rr.r)for(yr=_r.length;yr<=Rr.r;++yr)_r[yr]||(_r[yr]=[]);switch(yr=Rr.r,jr=Rr.c,wr[2]){case"t":_r[yr][jr]=ar(wr[3]);break;case"v":_r[yr][jr]=+wr[3];break;case"vtf":var Ar=wr[wr.length-1];case"vtc":switch(wr[3]){case"nl":_r[yr][jr]=!!+wr[4];break;default:_r[yr][jr]=+wr[4];break}wr[2]=="vtf"&&(_r[yr][jr]=[_r[yr][jr],Ar])}}}return vr&&vr.sheetRows&&(_r=_r.slice(0,vr.sheetRows)),_r}function cr(Er,vr){return aoa_to_sheet(lr(Er,vr),vr)}function ur(Er,vr){return sheet_to_workbook(cr(Er,vr),vr)}var dr=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),hr=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,pr=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),xr="--SocialCalcSpreadsheetControlSave--";function mr(Er){if(!Er||!Er["!ref"])return"";for(var vr=[],gr=[],yr,jr="",br=decode_range(Er["!ref"]),_r=Array.isArray(Er),wr=br.s.r;wr<=br.e.r;++wr)for(var Rr=br.s.c;Rr<=br.e.c;++Rr)if(jr=encode_cell({r:wr,c:Rr}),yr=_r?(Er[wr]||[])[Rr]:Er[jr],!(!yr||yr.v==null||yr.t==="z")){switch(gr=["cell",jr,"t"],yr.t){case"s":case"str":gr.push(or(yr.v));break;case"n":yr.f?(gr[2]="vtf",gr[3]="n",gr[4]=yr.v,gr[5]=or(yr.f)):(gr[2]="v",gr[3]=yr.v);break;case"b":gr[2]="vt"+(yr.f?"f":"c"),gr[3]="nl",gr[4]=yr.v?"1":"0",gr[5]=or(yr.f||(yr.v?"TRUE":"FALSE"));break;case"d":var Ar=datenum(parseDate(yr.v));gr[2]="vtc",gr[3]="nd",gr[4]=""+Ar,gr[5]=yr.w||SSF_format(yr.z||table_fmt[14],Ar);break;case"e":continue}vr.push(gr.join(":"))}return vr.push("sheet:c:"+(br.e.c-br.s.c+1)+":r:"+(br.e.r-br.s.r+1)+":tvf:1"),vr.push("valueformat:1:text-wiki"),vr.join(`
`)}function fr(Er){return[dr,hr,pr,hr,mr(Er),xr].join(`
`)}return{to_workbook:ur,to_sheet:cr,from_sheet:fr}}(),PRN=function(){function ar(fr,Er,vr,gr,yr){yr.raw?Er[vr][gr]=fr:fr===""||(fr==="TRUE"?Er[vr][gr]=!0:fr==="FALSE"?Er[vr][gr]=!1:isNaN(fuzzynum(fr))?isNaN(fuzzydate(fr).getDate())?Er[vr][gr]=fr:Er[vr][gr]=parseDate(fr):Er[vr][gr]=fuzzynum(fr))}function or(fr,Er){var vr=Er||{},gr=[];if(!fr||fr.length===0)return gr;for(var yr=fr.split(/[\r\n]/),jr=yr.length-1;jr>=0&&yr[jr].length===0;)--jr;for(var br=10,_r=0,wr=0;wr<=jr;++wr)_r=yr[wr].indexOf(" "),_r==-1?_r=yr[wr].length:_r++,br=Math.max(br,_r);for(wr=0;wr<=jr;++wr){gr[wr]=[];var Rr=0;for(ar(yr[wr].slice(0,br).trim(),gr,wr,Rr,vr),Rr=1;Rr<=(yr[wr].length-br)/10+1;++Rr)ar(yr[wr].slice(br+(Rr-1)*10,br+Rr*10).trim(),gr,wr,Rr,vr)}return vr.sheetRows&&(gr=gr.slice(0,vr.sheetRows)),gr}var lr={44:",",9:"	",59:";",124:"|"},cr={44:3,9:2,59:1,124:0};function ur(fr){for(var Er={},vr=!1,gr=0,yr=0;gr<fr.length;++gr)(yr=fr.charCodeAt(gr))==34?vr=!vr:!vr&&yr in lr&&(Er[yr]=(Er[yr]||0)+1);yr=[];for(gr in Er)Object.prototype.hasOwnProperty.call(Er,gr)&&yr.push([Er[gr],gr]);if(!yr.length){Er=cr;for(gr in Er)Object.prototype.hasOwnProperty.call(Er,gr)&&yr.push([Er[gr],gr])}return yr.sort(function(jr,br){return jr[0]-br[0]||cr[jr[1]]-cr[br[1]]}),lr[yr.pop()[1]]||44}function dr(fr,Er){var vr=Er||{},gr="",yr=vr.dense?[]:{},jr={s:{c:0,r:0},e:{c:0,r:0}};fr.slice(0,4)=="sep="?fr.charCodeAt(5)==13&&fr.charCodeAt(6)==10?(gr=fr.charAt(4),fr=fr.slice(7)):fr.charCodeAt(5)==13||fr.charCodeAt(5)==10?(gr=fr.charAt(4),fr=fr.slice(6)):gr=ur(fr.slice(0,1024)):vr&&vr.FS?gr=vr.FS:gr=ur(fr.slice(0,1024));var br=0,_r=0,wr=0,Rr=0,Ar=0,Sr=gr.charCodeAt(0),kr=!1,Nr=0,Cr=fr.charCodeAt(0);fr=fr.replace(/\r\n/mg,`
`);var Tr=vr.dateNF!=null?dateNF_regex(vr.dateNF):null;function Pr(){var Ir=fr.slice(Rr,Ar),Br={};if(Ir.charAt(0)=='"'&&Ir.charAt(Ir.length-1)=='"'&&(Ir=Ir.slice(1,-1).replace(/""/g,'"')),Ir.length===0)Br.t="z";else if(vr.raw)Br.t="s",Br.v=Ir;else if(Ir.trim().length===0)Br.t="s",Br.v=Ir;else if(Ir.charCodeAt(0)==61)Ir.charCodeAt(1)==34&&Ir.charCodeAt(Ir.length-1)==34?(Br.t="s",Br.v=Ir.slice(2,-1).replace(/""/g,'"')):fuzzyfmla(Ir)?(Br.t="n",Br.f=Ir.slice(1)):(Br.t="s",Br.v=Ir);else if(Ir=="TRUE")Br.t="b",Br.v=!0;else if(Ir=="FALSE")Br.t="b",Br.v=!1;else if(!isNaN(wr=fuzzynum(Ir)))Br.t="n",vr.cellText!==!1&&(Br.w=Ir),Br.v=wr;else if(!isNaN(fuzzydate(Ir).getDate())||Tr&&Ir.match(Tr)){Br.z=vr.dateNF||table_fmt[14];var Wr=0;Tr&&Ir.match(Tr)&&(Ir=dateNF_fix(Ir,vr.dateNF,Ir.match(Tr)||[]),Wr=1),vr.cellDates?(Br.t="d",Br.v=parseDate(Ir,Wr)):(Br.t="n",Br.v=datenum(parseDate(Ir,Wr))),vr.cellText!==!1&&(Br.w=SSF_format(Br.z,Br.v instanceof Date?datenum(Br.v):Br.v)),vr.cellNF||delete Br.z}else Br.t="s",Br.v=Ir;if(Br.t=="z"||(vr.dense?(yr[br]||(yr[br]=[]),yr[br][_r]=Br):yr[encode_cell({c:_r,r:br})]=Br),Rr=Ar+1,Cr=fr.charCodeAt(Rr),jr.e.c<_r&&(jr.e.c=_r),jr.e.r<br&&(jr.e.r=br),Nr==Sr)++_r;else if(_r=0,++br,vr.sheetRows&&vr.sheetRows<=br)return!0}e:for(;Ar<fr.length;++Ar)switch(Nr=fr.charCodeAt(Ar)){case 34:Cr===34&&(kr=!kr);break;case Sr:case 10:case 13:if(!kr&&Pr())break e;break}return Ar-Rr>0&&Pr(),yr["!ref"]=encode_range(jr),yr}function hr(fr,Er){return!(Er&&Er.PRN)||Er.FS||fr.slice(0,4)=="sep="||fr.indexOf("	")>=0||fr.indexOf(",")>=0||fr.indexOf(";")>=0?dr(fr,Er):aoa_to_sheet(or(fr,Er),Er)}function pr(fr,Er){var vr="",gr=Er.type=="string"?[0,0,0,0]:firstbyte(fr,Er);switch(Er.type){case"base64":vr=Base64_decode(fr);break;case"binary":vr=fr;break;case"buffer":Er.codepage==65001?vr=fr.toString("utf8"):Er.codepage&&typeof $cptable<"u"||(vr=has_buf&&Buffer.isBuffer(fr)?fr.toString("binary"):a2s(fr));break;case"array":vr=cc2str(fr);break;case"string":vr=fr;break;default:throw new Error("Unrecognized type "+Er.type)}return gr[0]==239&&gr[1]==187&&gr[2]==191?vr=utf8read(vr.slice(3)):Er.type!="string"&&Er.type!="buffer"&&Er.codepage==65001?vr=utf8read(vr):Er.type=="binary"&&typeof $cptable<"u",vr.slice(0,19)=="socialcalc:version:"?ETH.to_sheet(Er.type=="string"?vr:utf8read(vr),Er):hr(vr,Er)}function xr(fr,Er){return sheet_to_workbook(pr(fr,Er),Er)}function mr(fr){for(var Er=[],vr=safe_decode_range(fr["!ref"]),gr,yr=Array.isArray(fr),jr=vr.s.r;jr<=vr.e.r;++jr){for(var br=[],_r=vr.s.c;_r<=vr.e.c;++_r){var wr=encode_cell({r:jr,c:_r});if(gr=yr?(fr[jr]||[])[_r]:fr[wr],!gr||gr.v==null){br.push("          ");continue}for(var Rr=(gr.w||(format_cell(gr),gr.w)||"").slice(0,10);Rr.length<10;)Rr+=" ";br.push(Rr+(_r===0?" ":""))}Er.push(br.join(""))}return Er.join(`
`)}return{to_workbook:xr,to_sheet:pr,from_sheet:mr}}(),WK_=function(){function ar(Mr,Dr,Lr){if(Mr){prep_blob(Mr,Mr.l||0);for(var Fr=Lr.Enum||Kr;Mr.l<Mr.length;){var $r=Mr.read_shift(2),Vr=Fr[$r]||Fr[65535],Gr=Mr.read_shift(2),Jr=Mr.l+Gr,ms=Vr.f&&Vr.f(Mr,Gr,Lr);if(Mr.l=Jr,Dr(ms,Vr,$r))return}}}function or(Mr,Dr){switch(Dr.type){case"base64":return lr(s2a(Base64_decode(Mr)),Dr);case"binary":return lr(s2a(Mr),Dr);case"buffer":case"array":return lr(Mr,Dr)}throw"Unsupported type "+Dr.type}function lr(Mr,Dr){if(!Mr)return Mr;var Lr=Dr||{},Fr=Lr.dense?[]:{},$r="Sheet1",Vr="",Gr=0,Jr={},ms=[],ls=[],ds={s:{r:0,c:0},e:{r:0,c:0}},bs=Lr.sheetRows||0;if(Mr[2]==0&&(Mr[3]==8||Mr[3]==9)&&Mr.length>=16&&Mr[14]==5&&Mr[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(Mr[2]==2)Lr.Enum=Kr,ar(Mr,function(ss,Ur,Xr){switch(Xr){case 0:Lr.vers=ss,ss>=4096&&(Lr.qpro=!0);break;case 6:ds=ss;break;case 204:ss&&(Vr=ss);break;case 222:Vr=ss;break;case 15:case 51:Lr.qpro||(ss[1].v=ss[1].v.slice(1));case 13:case 14:case 16:Xr==14&&(ss[2]&112)==112&&(ss[2]&15)>1&&(ss[2]&15)<15&&(ss[1].z=Lr.dateNF||table_fmt[14],Lr.cellDates&&(ss[1].t="d",ss[1].v=numdate(ss[1].v))),Lr.qpro&&ss[3]>Gr&&(Fr["!ref"]=encode_range(ds),Jr[$r]=Fr,ms.push($r),Fr=Lr.dense?[]:{},ds={s:{r:0,c:0},e:{r:0,c:0}},Gr=ss[3],$r=Vr||"Sheet"+(Gr+1),Vr="");var cs=Lr.dense?(Fr[ss[0].r]||[])[ss[0].c]:Fr[encode_cell(ss[0])];if(cs){cs.t=ss[1].t,cs.v=ss[1].v,ss[1].z!=null&&(cs.z=ss[1].z),ss[1].f!=null&&(cs.f=ss[1].f);break}Lr.dense?(Fr[ss[0].r]||(Fr[ss[0].r]=[]),Fr[ss[0].r][ss[0].c]=ss[1]):Fr[encode_cell(ss[0])]=ss[1];break}},Lr);else if(Mr[2]==26||Mr[2]==14)Lr.Enum=rs,Mr[2]==14&&(Lr.qpro=!0,Mr.l=0),ar(Mr,function(ss,Ur,Xr){switch(Xr){case 204:$r=ss;break;case 22:ss[1].v=ss[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(ss[3]>Gr&&(Fr["!ref"]=encode_range(ds),Jr[$r]=Fr,ms.push($r),Fr=Lr.dense?[]:{},ds={s:{r:0,c:0},e:{r:0,c:0}},Gr=ss[3],$r="Sheet"+(Gr+1)),bs>0&&ss[0].r>=bs)break;Lr.dense?(Fr[ss[0].r]||(Fr[ss[0].r]=[]),Fr[ss[0].r][ss[0].c]=ss[1]):Fr[encode_cell(ss[0])]=ss[1],ds.e.c<ss[0].c&&(ds.e.c=ss[0].c),ds.e.r<ss[0].r&&(ds.e.r=ss[0].r);break;case 27:ss[14e3]&&(ls[ss[14e3][0]]=ss[14e3][1]);break;case 1537:ls[ss[0]]=ss[1],ss[0]==Gr&&($r=ss[1]);break}},Lr);else throw new Error("Unrecognized LOTUS BOF "+Mr[2]);if(Fr["!ref"]=encode_range(ds),Jr[Vr||$r]=Fr,ms.push(Vr||$r),!ls.length)return{SheetNames:ms,Sheets:Jr};for(var ws={},Is=[],ys=0;ys<ls.length;++ys)Jr[ms[ys]]?(Is.push(ls[ys]||ms[ys]),ws[ls[ys]]=Jr[ls[ys]]||Jr[ms[ys]]):(Is.push(ls[ys]),ws[ls[ys]]={"!ref":"A1"});return{SheetNames:Is,Sheets:ws}}function cr(Mr,Dr){var Lr=Dr||{};if(+Lr.codepage>=0&&set_cp(+Lr.codepage),Lr.type=="string")throw new Error("Cannot write WK1 to JS string");var Fr=buf_array(),$r=safe_decode_range(Mr["!ref"]),Vr=Array.isArray(Mr),Gr=[];write_biff_rec(Fr,0,dr(1030)),write_biff_rec(Fr,6,xr($r));for(var Jr=Math.min($r.e.r,8191),ms=$r.s.r;ms<=Jr;++ms)for(var ls=encode_row(ms),ds=$r.s.c;ds<=$r.e.c;++ds){ms===$r.s.r&&(Gr[ds]=encode_col(ds));var bs=Gr[ds]+ls,ws=Vr?(Mr[ms]||[])[ds]:Mr[bs];if(!(!ws||ws.t=="z"))if(ws.t=="n")(ws.v|0)==ws.v&&ws.v>=-32768&&ws.v<=32767?write_biff_rec(Fr,13,gr(ms,ds,ws.v)):write_biff_rec(Fr,14,jr(ms,ds,ws.v));else{var Is=format_cell(ws);write_biff_rec(Fr,15,Er(ms,ds,Is.slice(0,239)))}}return write_biff_rec(Fr,1),Fr.end()}function ur(Mr,Dr){var Lr=Dr||{};if(+Lr.codepage>=0&&set_cp(+Lr.codepage),Lr.type=="string")throw new Error("Cannot write WK3 to JS string");var Fr=buf_array();write_biff_rec(Fr,0,hr(Mr));for(var $r=0,Vr=0;$r<Mr.SheetNames.length;++$r)(Mr.Sheets[Mr.SheetNames[$r]]||{})["!ref"]&&write_biff_rec(Fr,27,Hr(Mr.SheetNames[$r],Vr++));var Gr=0;for($r=0;$r<Mr.SheetNames.length;++$r){var Jr=Mr.Sheets[Mr.SheetNames[$r]];if(!(!Jr||!Jr["!ref"])){for(var ms=safe_decode_range(Jr["!ref"]),ls=Array.isArray(Jr),ds=[],bs=Math.min(ms.e.r,8191),ws=ms.s.r;ws<=bs;++ws)for(var Is=encode_row(ws),ys=ms.s.c;ys<=ms.e.c;++ys){ws===ms.s.r&&(ds[ys]=encode_col(ys));var ss=ds[ys]+Is,Ur=ls?(Jr[ws]||[])[ys]:Jr[ss];if(!(!Ur||Ur.t=="z"))if(Ur.t=="n")write_biff_rec(Fr,23,Pr(ws,ys,Gr,Ur.v));else{var Xr=format_cell(Ur);write_biff_rec(Fr,22,Nr(ws,ys,Gr,Xr.slice(0,239)))}}++Gr}}return write_biff_rec(Fr,1),Fr.end()}function dr(Mr){var Dr=new_buf(2);return Dr.write_shift(2,Mr),Dr}function hr(Mr){var Dr=new_buf(26);Dr.write_shift(2,4096),Dr.write_shift(2,4),Dr.write_shift(4,0);for(var Lr=0,Fr=0,$r=0,Vr=0;Vr<Mr.SheetNames.length;++Vr){var Gr=Mr.SheetNames[Vr],Jr=Mr.Sheets[Gr];if(!(!Jr||!Jr["!ref"])){++$r;var ms=decode_range(Jr["!ref"]);Lr<ms.e.r&&(Lr=ms.e.r),Fr<ms.e.c&&(Fr=ms.e.c)}}return Lr>8191&&(Lr=8191),Dr.write_shift(2,Lr),Dr.write_shift(1,$r),Dr.write_shift(1,Fr),Dr.write_shift(2,0),Dr.write_shift(2,0),Dr.write_shift(1,1),Dr.write_shift(1,2),Dr.write_shift(4,0),Dr.write_shift(4,0),Dr}function pr(Mr,Dr,Lr){var Fr={s:{c:0,r:0},e:{c:0,r:0}};return Dr==8&&Lr.qpro?(Fr.s.c=Mr.read_shift(1),Mr.l++,Fr.s.r=Mr.read_shift(2),Fr.e.c=Mr.read_shift(1),Mr.l++,Fr.e.r=Mr.read_shift(2),Fr):(Fr.s.c=Mr.read_shift(2),Fr.s.r=Mr.read_shift(2),Dr==12&&Lr.qpro&&(Mr.l+=2),Fr.e.c=Mr.read_shift(2),Fr.e.r=Mr.read_shift(2),Dr==12&&Lr.qpro&&(Mr.l+=2),Fr.s.c==65535&&(Fr.s.c=Fr.e.c=Fr.s.r=Fr.e.r=0),Fr)}function xr(Mr){var Dr=new_buf(8);return Dr.write_shift(2,Mr.s.c),Dr.write_shift(2,Mr.s.r),Dr.write_shift(2,Mr.e.c),Dr.write_shift(2,Mr.e.r),Dr}function mr(Mr,Dr,Lr){var Fr=[{c:0,r:0},{t:"n",v:0},0,0];return Lr.qpro&&Lr.vers!=20768?(Fr[0].c=Mr.read_shift(1),Fr[3]=Mr.read_shift(1),Fr[0].r=Mr.read_shift(2),Mr.l+=2):(Fr[2]=Mr.read_shift(1),Fr[0].c=Mr.read_shift(2),Fr[0].r=Mr.read_shift(2)),Fr}function fr(Mr,Dr,Lr){var Fr=Mr.l+Dr,$r=mr(Mr,Dr,Lr);if($r[1].t="s",Lr.vers==20768){Mr.l++;var Vr=Mr.read_shift(1);return $r[1].v=Mr.read_shift(Vr,"utf8"),$r}return Lr.qpro&&Mr.l++,$r[1].v=Mr.read_shift(Fr-Mr.l,"cstr"),$r}function Er(Mr,Dr,Lr){var Fr=new_buf(7+Lr.length);Fr.write_shift(1,255),Fr.write_shift(2,Dr),Fr.write_shift(2,Mr),Fr.write_shift(1,39);for(var $r=0;$r<Fr.length;++$r){var Vr=Lr.charCodeAt($r);Fr.write_shift(1,Vr>=128?95:Vr)}return Fr.write_shift(1,0),Fr}function vr(Mr,Dr,Lr){var Fr=mr(Mr,Dr,Lr);return Fr[1].v=Mr.read_shift(2,"i"),Fr}function gr(Mr,Dr,Lr){var Fr=new_buf(7);return Fr.write_shift(1,255),Fr.write_shift(2,Dr),Fr.write_shift(2,Mr),Fr.write_shift(2,Lr,"i"),Fr}function yr(Mr,Dr,Lr){var Fr=mr(Mr,Dr,Lr);return Fr[1].v=Mr.read_shift(8,"f"),Fr}function jr(Mr,Dr,Lr){var Fr=new_buf(13);return Fr.write_shift(1,255),Fr.write_shift(2,Dr),Fr.write_shift(2,Mr),Fr.write_shift(8,Lr,"f"),Fr}function br(Mr,Dr,Lr){var Fr=Mr.l+Dr,$r=mr(Mr,Dr,Lr);if($r[1].v=Mr.read_shift(8,"f"),Lr.qpro)Mr.l=Fr;else{var Vr=Mr.read_shift(2);Ar(Mr.slice(Mr.l,Mr.l+Vr),$r),Mr.l+=Vr}return $r}function _r(Mr,Dr,Lr){var Fr=Dr&32768;return Dr&=-32769,Dr=(Fr?Mr:0)+(Dr>=8192?Dr-16384:Dr),(Fr?"":"$")+(Lr?encode_col(Dr):encode_row(Dr))}var wr={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},Rr=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function Ar(Mr,Dr){prep_blob(Mr,0);for(var Lr=[],Fr=0,$r="",Vr="",Gr="",Jr="";Mr.l<Mr.length;){var ms=Mr[Mr.l++];switch(ms){case 0:Lr.push(Mr.read_shift(8,"f"));break;case 1:Vr=_r(Dr[0].c,Mr.read_shift(2),!0),$r=_r(Dr[0].r,Mr.read_shift(2),!1),Lr.push(Vr+$r);break;case 2:{var ls=_r(Dr[0].c,Mr.read_shift(2),!0),ds=_r(Dr[0].r,Mr.read_shift(2),!1);Vr=_r(Dr[0].c,Mr.read_shift(2),!0),$r=_r(Dr[0].r,Mr.read_shift(2),!1),Lr.push(ls+ds+":"+Vr+$r)}break;case 3:if(Mr.l<Mr.length){console.error("WK1 premature formula end");return}break;case 4:Lr.push("("+Lr.pop()+")");break;case 5:Lr.push(Mr.read_shift(2));break;case 6:{for(var bs="";ms=Mr[Mr.l++];)bs+=String.fromCharCode(ms);Lr.push('"'+bs.replace(/"/g,'""')+'"')}break;case 8:Lr.push("-"+Lr.pop());break;case 23:Lr.push("+"+Lr.pop());break;case 22:Lr.push("NOT("+Lr.pop()+")");break;case 20:case 21:Jr=Lr.pop(),Gr=Lr.pop(),Lr.push(["AND","OR"][ms-20]+"("+Gr+","+Jr+")");break;default:if(ms<32&&Rr[ms])Jr=Lr.pop(),Gr=Lr.pop(),Lr.push(Gr+Rr[ms]+Jr);else if(wr[ms]){if(Fr=wr[ms][1],Fr==69&&(Fr=Mr[Mr.l++]),Fr>Lr.length){console.error("WK1 bad formula parse 0x"+ms.toString(16)+":|"+Lr.join("|")+"|");return}var ws=Lr.slice(-Fr);Lr.length-=Fr,Lr.push(wr[ms][0]+"("+ws.join(",")+")")}else return ms<=7?console.error("WK1 invalid opcode "+ms.toString(16)):ms<=24?console.error("WK1 unsupported op "+ms.toString(16)):ms<=30?console.error("WK1 invalid opcode "+ms.toString(16)):ms<=115?console.error("WK1 unsupported function opcode "+ms.toString(16)):console.error("WK1 unrecognized opcode "+ms.toString(16))}}Lr.length==1?Dr[1].f=""+Lr[0]:console.error("WK1 bad formula parse |"+Lr.join("|")+"|")}function Sr(Mr){var Dr=[{c:0,r:0},{t:"n",v:0},0];return Dr[0].r=Mr.read_shift(2),Dr[3]=Mr[Mr.l++],Dr[0].c=Mr[Mr.l++],Dr}function kr(Mr,Dr){var Lr=Sr(Mr);return Lr[1].t="s",Lr[1].v=Mr.read_shift(Dr-4,"cstr"),Lr}function Nr(Mr,Dr,Lr,Fr){var $r=new_buf(6+Fr.length);$r.write_shift(2,Mr),$r.write_shift(1,Lr),$r.write_shift(1,Dr),$r.write_shift(1,39);for(var Vr=0;Vr<Fr.length;++Vr){var Gr=Fr.charCodeAt(Vr);$r.write_shift(1,Gr>=128?95:Gr)}return $r.write_shift(1,0),$r}function Cr(Mr,Dr){var Lr=Sr(Mr);Lr[1].v=Mr.read_shift(2);var Fr=Lr[1].v>>1;if(Lr[1].v&1)switch(Fr&7){case 0:Fr=(Fr>>3)*5e3;break;case 1:Fr=(Fr>>3)*500;break;case 2:Fr=(Fr>>3)/20;break;case 3:Fr=(Fr>>3)/200;break;case 4:Fr=(Fr>>3)/2e3;break;case 5:Fr=(Fr>>3)/2e4;break;case 6:Fr=(Fr>>3)/16;break;case 7:Fr=(Fr>>3)/64;break}return Lr[1].v=Fr,Lr}function Tr(Mr,Dr){var Lr=Sr(Mr),Fr=Mr.read_shift(4),$r=Mr.read_shift(4),Vr=Mr.read_shift(2);if(Vr==65535)return Fr===0&&$r===3221225472?(Lr[1].t="e",Lr[1].v=15):Fr===0&&$r===3489660928?(Lr[1].t="e",Lr[1].v=42):Lr[1].v=0,Lr;var Gr=Vr&32768;return Vr=(Vr&32767)-16446,Lr[1].v=(1-Gr*2)*($r*Math.pow(2,Vr+32)+Fr*Math.pow(2,Vr)),Lr}function Pr(Mr,Dr,Lr,Fr){var $r=new_buf(14);if($r.write_shift(2,Mr),$r.write_shift(1,Lr),$r.write_shift(1,Dr),Fr==0)return $r.write_shift(4,0),$r.write_shift(4,0),$r.write_shift(2,65535),$r;var Vr=0,Gr=0,Jr=0,ms=0;return Fr<0&&(Vr=1,Fr=-Fr),Gr=Math.log2(Fr)|0,Fr/=Math.pow(2,Gr-31),ms=Fr>>>0,ms&2147483648||(Fr/=2,++Gr,ms=Fr>>>0),Fr-=ms,ms|=2147483648,ms>>>=0,Fr*=Math.pow(2,32),Jr=Fr>>>0,$r.write_shift(4,Jr),$r.write_shift(4,ms),Gr+=16383+(Vr?32768:0),$r.write_shift(2,Gr),$r}function Ir(Mr,Dr){var Lr=Tr(Mr);return Mr.l+=Dr-14,Lr}function Br(Mr,Dr){var Lr=Sr(Mr),Fr=Mr.read_shift(4);return Lr[1].v=Fr>>6,Lr}function Wr(Mr,Dr){var Lr=Sr(Mr),Fr=Mr.read_shift(8,"f");return Lr[1].v=Fr,Lr}function Yr(Mr,Dr){var Lr=Wr(Mr);return Mr.l+=Dr-10,Lr}function es(Mr,Dr){return Mr[Mr.l+Dr-1]==0?Mr.read_shift(Dr,"cstr"):""}function ps(Mr,Dr){var Lr=Mr[Mr.l++];Lr>Dr-1&&(Lr=Dr-1);for(var Fr="";Fr.length<Lr;)Fr+=String.fromCharCode(Mr[Mr.l++]);return Fr}function ts(Mr,Dr,Lr){if(!(!Lr.qpro||Dr<21)){var Fr=Mr.read_shift(1);Mr.l+=17,Mr.l+=1,Mr.l+=2;var $r=Mr.read_shift(Dr-21,"cstr");return[Fr,$r]}}function Qr(Mr,Dr){for(var Lr={},Fr=Mr.l+Dr;Mr.l<Fr;){var $r=Mr.read_shift(2);if($r==14e3){for(Lr[$r]=[0,""],Lr[$r][0]=Mr.read_shift(2);Mr[Mr.l];)Lr[$r][1]+=String.fromCharCode(Mr[Mr.l]),Mr.l++;Mr.l++}}return Lr}function Hr(Mr,Dr){var Lr=new_buf(5+Mr.length);Lr.write_shift(2,14e3),Lr.write_shift(2,Dr);for(var Fr=0;Fr<Mr.length;++Fr){var $r=Mr.charCodeAt(Fr);Lr[Lr.l++]=$r>127?95:$r}return Lr[Lr.l++]=0,Lr}var Kr={0:{n:"BOF",f:parseuint16},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:pr},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:vr},14:{n:"NUMBER",f:yr},15:{n:"LABEL",f:fr},16:{n:"FORMULA",f:br},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:fr},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:es},222:{n:"SHEETNAMELP",f:ps},65535:{n:""}},rs={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:kr},23:{n:"NUMBER17",f:Tr},24:{n:"NUMBER18",f:Cr},25:{n:"FORMULA19",f:Ir},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:Qr},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Br},38:{n:"??"},39:{n:"NUMBER27",f:Wr},40:{n:"FORMULA28",f:Yr},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:es},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:ts},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:cr,book_to_wk3:ur,to_workbook:or}}(),straywsregex=/^\s|\s$|[\t\n\r]/;function write_sst_xml(ar,or){if(!or.bookSST)return"";var lr=[XML_HEADER];lr[lr.length]=writextag("sst",null,{xmlns:XMLNS_main[0],count:ar.Count,uniqueCount:ar.Unique});for(var cr=0;cr!=ar.length;++cr)if(ar[cr]!=null){var ur=ar[cr],dr="<si>";ur.r?dr+=ur.r:(dr+="<t",ur.t||(ur.t=""),ur.t.match(straywsregex)&&(dr+=' xml:space="preserve"'),dr+=">"+escapexml(ur.t)+"</t>"),dr+="</si>",lr[lr.length]=dr}return lr.length>2&&(lr[lr.length]="</sst>",lr[1]=lr[1].replace("/>",">")),lr.join("")}function parse_BrtBeginSst(ar){return[ar.read_shift(4),ar.read_shift(4)]}function write_BrtBeginSst(ar,or){return or||(or=new_buf(8)),or.write_shift(4,ar.Count),or.write_shift(4,ar.Unique),or}var write_BrtSSTItem=write_RichStr;function write_sst_bin(ar){var or=buf_array();write_record(or,159,write_BrtBeginSst(ar));for(var lr=0;lr<ar.length;++lr)write_record(or,19,write_BrtSSTItem(ar[lr]));return write_record(or,160),or.end()}function _JS2ANSI(ar){for(var or=[],lr=ar.split(""),cr=0;cr<lr.length;++cr)or[cr]=lr[cr].charCodeAt(0);return or}function crypto_CreatePasswordVerifier_Method1(ar){var or=0,lr,cr=_JS2ANSI(ar),ur=cr.length+1,dr,hr,pr,xr,mr;for(lr=new_raw_buf(ur),lr[0]=cr.length,dr=1;dr!=ur;++dr)lr[dr]=cr[dr-1];for(dr=ur-1;dr>=0;--dr)hr=lr[dr],pr=or&16384?1:0,xr=or<<1&32767,mr=pr|xr,or=mr^hr;return or^52811}var RTF=function(){function ar(ur,dr){switch(dr.type){case"base64":return or(Base64_decode(ur),dr);case"binary":return or(ur,dr);case"buffer":return or(has_buf&&Buffer.isBuffer(ur)?ur.toString("binary"):a2s(ur),dr);case"array":return or(cc2str(ur),dr)}throw new Error("Unrecognized type "+dr.type)}function or(ur,dr){var hr=dr||{},pr=hr.dense?[]:{},xr=ur.match(/\\trowd.*?\\row\b/g);if(!xr.length)throw new Error("RTF missing table");var mr={s:{c:0,r:0},e:{c:0,r:xr.length-1}};return xr.forEach(function(fr,Er){Array.isArray(pr)&&(pr[Er]=[]);for(var vr=/\\\w+\b/g,gr=0,yr,jr=-1;yr=vr.exec(fr);){switch(yr[0]){case"\\cell":var br=fr.slice(gr,vr.lastIndex-yr[0].length);if(br[0]==" "&&(br=br.slice(1)),++jr,br.length){var _r={v:br,t:"s"};Array.isArray(pr)?pr[Er][jr]=_r:pr[encode_cell({r:Er,c:jr})]=_r}break}gr=vr.lastIndex}jr>mr.e.c&&(mr.e.c=jr)}),pr["!ref"]=encode_range(mr),pr}function lr(ur,dr){return sheet_to_workbook(ar(ur,dr),dr)}function cr(ur){for(var dr=["{\\rtf1\\ansi"],hr=safe_decode_range(ur["!ref"]),pr,xr=Array.isArray(ur),mr=hr.s.r;mr<=hr.e.r;++mr){dr.push("\\trowd\\trautofit1");for(var fr=hr.s.c;fr<=hr.e.c;++fr)dr.push("\\cellx"+(fr+1));for(dr.push("\\pard\\intbl"),fr=hr.s.c;fr<=hr.e.c;++fr){var Er=encode_cell({r:mr,c:fr});pr=xr?(ur[mr]||[])[fr]:ur[Er],!(!pr||pr.v==null&&(!pr.f||pr.F))&&(dr.push(" "+(pr.w||(format_cell(pr),pr.w))),dr.push("\\cell"))}dr.push("\\pard\\intbl\\row")}return dr.join("")+"}"}return{to_workbook:lr,to_sheet:ar,from_sheet:cr}}();function rgb2Hex(ar){for(var or=0,lr=1;or!=3;++or)lr=lr*256+(ar[or]>255?255:ar[or]<0?0:ar[or]);return lr.toString(16).toUpperCase().slice(1)}var DEF_MDW=6,MDW=DEF_MDW;function width2px(ar){return Math.floor((ar+Math.round(128/MDW)/256)*MDW)}function px2char(ar){return Math.floor((ar-5)/MDW*100+.5)/100}function char2width(ar){return Math.round((ar*MDW+5)/MDW*256)/256}function process_col(ar){ar.width?(ar.wpx=width2px(ar.width),ar.wch=px2char(ar.wpx),ar.MDW=MDW):ar.wpx?(ar.wch=px2char(ar.wpx),ar.width=char2width(ar.wch),ar.MDW=MDW):typeof ar.wch=="number"&&(ar.width=char2width(ar.wch),ar.wpx=width2px(ar.width),ar.MDW=MDW),ar.customWidth&&delete ar.customWidth}var DEF_PPI=96,PPI=DEF_PPI;function px2pt(ar){return ar*96/PPI}function pt2px(ar){return ar*PPI/96}function write_numFmts(ar){var or=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(lr){for(var cr=lr[0];cr<=lr[1];++cr)ar[cr]!=null&&(or[or.length]=writextag("numFmt",null,{numFmtId:cr,formatCode:escapexml(ar[cr])}))}),or.length===1?"":(or[or.length]="</numFmts>",or[0]=writextag("numFmts",null,{count:or.length-2}).replace("/>",">"),or.join(""))}function write_cellXfs(ar){var or=[];return or[or.length]=writextag("cellXfs",null),ar.forEach(function(lr){or[or.length]=writextag("xf",null,lr)}),or[or.length]="</cellXfs>",or.length===2?"":(or[0]=writextag("cellXfs",null,{count:or.length-2}).replace("/>",">"),or.join(""))}function write_sty_xml(ar,or){var lr=[XML_HEADER,writextag("styleSheet",null,{xmlns:XMLNS_main[0],"xmlns:vt":XMLNS.vt})],cr;return ar.SSF&&(cr=write_numFmts(ar.SSF))!=null&&(lr[lr.length]=cr),lr[lr.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',lr[lr.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',lr[lr.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',lr[lr.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(cr=write_cellXfs(or.cellXfs))&&(lr[lr.length]=cr),lr[lr.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',lr[lr.length]='<dxfs count="0"/>',lr[lr.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',lr.length>2&&(lr[lr.length]="</styleSheet>",lr[1]=lr[1].replace("/>",">")),lr.join("")}function parse_BrtFmt(ar,or){var lr=ar.read_shift(2),cr=parse_XLWideString(ar);return[lr,cr]}function write_BrtFmt(ar,or,lr){lr||(lr=new_buf(6+4*or.length)),lr.write_shift(2,ar),write_XLWideString(or,lr);var cr=lr.length>lr.l?lr.slice(0,lr.l):lr;return lr.l==null&&(lr.l=lr.length),cr}function parse_BrtFont(ar,or,lr){var cr={};cr.sz=ar.read_shift(2)/20;var ur=parse_FontFlags(ar);ur.fItalic&&(cr.italic=1),ur.fCondense&&(cr.condense=1),ur.fExtend&&(cr.extend=1),ur.fShadow&&(cr.shadow=1),ur.fOutline&&(cr.outline=1),ur.fStrikeout&&(cr.strike=1);var dr=ar.read_shift(2);switch(dr===700&&(cr.bold=1),ar.read_shift(2)){case 1:cr.vertAlign="superscript";break;case 2:cr.vertAlign="subscript";break}var hr=ar.read_shift(1);hr!=0&&(cr.underline=hr);var pr=ar.read_shift(1);pr>0&&(cr.family=pr);var xr=ar.read_shift(1);switch(xr>0&&(cr.charset=xr),ar.l++,cr.color=parse_BrtColor(ar),ar.read_shift(1)){case 1:cr.scheme="major";break;case 2:cr.scheme="minor";break}return cr.name=parse_XLWideString(ar),cr}function write_BrtFont(ar,or){or||(or=new_buf(25+4*32)),or.write_shift(2,ar.sz*20),write_FontFlags(ar,or),or.write_shift(2,ar.bold?700:400);var lr=0;ar.vertAlign=="superscript"?lr=1:ar.vertAlign=="subscript"&&(lr=2),or.write_shift(2,lr),or.write_shift(1,ar.underline||0),or.write_shift(1,ar.family||0),or.write_shift(1,ar.charset||0),or.write_shift(1,0),write_BrtColor(ar.color,or);var cr=0;return cr=2,or.write_shift(1,cr),write_XLWideString(ar.name,or),or.length>or.l?or.slice(0,or.l):or}var XLSBFillPTNames=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],rev_XLSBFillPTNames,parse_BrtFill=parsenoop;function write_BrtFill(ar,or){or||(or=new_buf(4*3+8*7+16*1)),rev_XLSBFillPTNames||(rev_XLSBFillPTNames=evert(XLSBFillPTNames));var lr=rev_XLSBFillPTNames[ar.patternType];lr==null&&(lr=40),or.write_shift(4,lr);var cr=0;if(lr!=40)for(write_BrtColor({auto:1},or),write_BrtColor({auto:1},or);cr<12;++cr)or.write_shift(4,0);else{for(;cr<4;++cr)or.write_shift(4,0);for(;cr<12;++cr)or.write_shift(4,0)}return or.length>or.l?or.slice(0,or.l):or}function parse_BrtXF(ar,or){var lr=ar.l+or,cr=ar.read_shift(2),ur=ar.read_shift(2);return ar.l=lr,{ixfe:cr,numFmtId:ur}}function write_BrtXF(ar,or,lr){lr||(lr=new_buf(16)),lr.write_shift(2,or||0),lr.write_shift(2,ar.numFmtId||0),lr.write_shift(2,0),lr.write_shift(2,0),lr.write_shift(2,0),lr.write_shift(1,0),lr.write_shift(1,0);var cr=0;return lr.write_shift(1,cr),lr.write_shift(1,0),lr.write_shift(1,0),lr.write_shift(1,0),lr}function write_Blxf(ar,or){return or||(or=new_buf(10)),or.write_shift(1,0),or.write_shift(1,0),or.write_shift(4,0),or.write_shift(4,0),or}var parse_BrtBorder=parsenoop;function write_BrtBorder(ar,or){return or||(or=new_buf(51)),or.write_shift(1,0),write_Blxf(null,or),write_Blxf(null,or),write_Blxf(null,or),write_Blxf(null,or),write_Blxf(null,or),or.length>or.l?or.slice(0,or.l):or}function write_BrtStyle(ar,or){return or||(or=new_buf(12+4*10)),or.write_shift(4,ar.xfId),or.write_shift(2,1),or.write_shift(1,0),or.write_shift(1,0),write_XLNullableWideString(ar.name||"",or),or.length>or.l?or.slice(0,or.l):or}function write_BrtBeginTableStyles(ar,or,lr){var cr=new_buf(2052);return cr.write_shift(4,ar),write_XLNullableWideString(or,cr),write_XLNullableWideString(lr,cr),cr.length>cr.l?cr.slice(0,cr.l):cr}function write_FMTS_bin(ar,or){if(or){var lr=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(cr){for(var ur=cr[0];ur<=cr[1];++ur)or[ur]!=null&&++lr}),lr!=0&&(write_record(ar,615,write_UInt32LE(lr)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(cr){for(var ur=cr[0];ur<=cr[1];++ur)or[ur]!=null&&write_record(ar,44,write_BrtFmt(ur,or[ur]))}),write_record(ar,616))}}function write_FONTS_bin(ar){var or=1;write_record(ar,611,write_UInt32LE(or)),write_record(ar,43,write_BrtFont({sz:12,color:{theme:1},name:"Calibri",family:2})),write_record(ar,612)}function write_FILLS_bin(ar){var or=2;write_record(ar,603,write_UInt32LE(or)),write_record(ar,45,write_BrtFill({patternType:"none"})),write_record(ar,45,write_BrtFill({patternType:"gray125"})),write_record(ar,604)}function write_BORDERS_bin(ar){var or=1;write_record(ar,613,write_UInt32LE(or)),write_record(ar,46,write_BrtBorder()),write_record(ar,614)}function write_CELLSTYLEXFS_bin(ar){var or=1;write_record(ar,626,write_UInt32LE(or)),write_record(ar,47,write_BrtXF({numFmtId:0},65535)),write_record(ar,627)}function write_CELLXFS_bin(ar,or){write_record(ar,617,write_UInt32LE(or.length)),or.forEach(function(lr){write_record(ar,47,write_BrtXF(lr,0))}),write_record(ar,618)}function write_STYLES_bin(ar){var or=1;write_record(ar,619,write_UInt32LE(or)),write_record(ar,48,write_BrtStyle({xfId:0,name:"Normal"})),write_record(ar,620)}function write_DXFS_bin(ar){var or=0;write_record(ar,505,write_UInt32LE(or)),write_record(ar,506)}function write_TABLESTYLES_bin(ar){var or=0;write_record(ar,508,write_BrtBeginTableStyles(or,"TableStyleMedium9","PivotStyleMedium4")),write_record(ar,509)}function write_sty_bin(ar,or){var lr=buf_array();return write_record(lr,278),write_FMTS_bin(lr,ar.SSF),write_FONTS_bin(lr),write_FILLS_bin(lr),write_BORDERS_bin(lr),write_CELLSTYLEXFS_bin(lr),write_CELLXFS_bin(lr,or.cellXfs),write_STYLES_bin(lr),write_DXFS_bin(lr),write_TABLESTYLES_bin(lr),write_record(lr,279),lr.end()}function write_theme(ar,or){if(or&&or.themeXLSX)return or.themeXLSX;if(ar&&typeof ar.raw=="string")return ar.raw;var lr=[XML_HEADER];return lr[lr.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',lr[lr.length]="<a:themeElements>",lr[lr.length]='<a:clrScheme name="Office">',lr[lr.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',lr[lr.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',lr[lr.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',lr[lr.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',lr[lr.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',lr[lr.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',lr[lr.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',lr[lr.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',lr[lr.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',lr[lr.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',lr[lr.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',lr[lr.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',lr[lr.length]="</a:clrScheme>",lr[lr.length]='<a:fontScheme name="Office">',lr[lr.length]="<a:majorFont>",lr[lr.length]='<a:latin typeface="Cambria"/>',lr[lr.length]='<a:ea typeface=""/>',lr[lr.length]='<a:cs typeface=""/>',lr[lr.length]='<a:font script="Jpan" typeface=" "/>',lr[lr.length]='<a:font script="Hang" typeface=" "/>',lr[lr.length]='<a:font script="Hans" typeface=""/>',lr[lr.length]='<a:font script="Hant" typeface=""/>',lr[lr.length]='<a:font script="Arab" typeface="Times New Roman"/>',lr[lr.length]='<a:font script="Hebr" typeface="Times New Roman"/>',lr[lr.length]='<a:font script="Thai" typeface="Tahoma"/>',lr[lr.length]='<a:font script="Ethi" typeface="Nyala"/>',lr[lr.length]='<a:font script="Beng" typeface="Vrinda"/>',lr[lr.length]='<a:font script="Gujr" typeface="Shruti"/>',lr[lr.length]='<a:font script="Khmr" typeface="MoolBoran"/>',lr[lr.length]='<a:font script="Knda" typeface="Tunga"/>',lr[lr.length]='<a:font script="Guru" typeface="Raavi"/>',lr[lr.length]='<a:font script="Cans" typeface="Euphemia"/>',lr[lr.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',lr[lr.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',lr[lr.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',lr[lr.length]='<a:font script="Thaa" typeface="MV Boli"/>',lr[lr.length]='<a:font script="Deva" typeface="Mangal"/>',lr[lr.length]='<a:font script="Telu" typeface="Gautami"/>',lr[lr.length]='<a:font script="Taml" typeface="Latha"/>',lr[lr.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',lr[lr.length]='<a:font script="Orya" typeface="Kalinga"/>',lr[lr.length]='<a:font script="Mlym" typeface="Kartika"/>',lr[lr.length]='<a:font script="Laoo" typeface="DokChampa"/>',lr[lr.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',lr[lr.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',lr[lr.length]='<a:font script="Viet" typeface="Times New Roman"/>',lr[lr.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',lr[lr.length]='<a:font script="Geor" typeface="Sylfaen"/>',lr[lr.length]="</a:majorFont>",lr[lr.length]="<a:minorFont>",lr[lr.length]='<a:latin typeface="Calibri"/>',lr[lr.length]='<a:ea typeface=""/>',lr[lr.length]='<a:cs typeface=""/>',lr[lr.length]='<a:font script="Jpan" typeface=" "/>',lr[lr.length]='<a:font script="Hang" typeface=" "/>',lr[lr.length]='<a:font script="Hans" typeface=""/>',lr[lr.length]='<a:font script="Hant" typeface=""/>',lr[lr.length]='<a:font script="Arab" typeface="Arial"/>',lr[lr.length]='<a:font script="Hebr" typeface="Arial"/>',lr[lr.length]='<a:font script="Thai" typeface="Tahoma"/>',lr[lr.length]='<a:font script="Ethi" typeface="Nyala"/>',lr[lr.length]='<a:font script="Beng" typeface="Vrinda"/>',lr[lr.length]='<a:font script="Gujr" typeface="Shruti"/>',lr[lr.length]='<a:font script="Khmr" typeface="DaunPenh"/>',lr[lr.length]='<a:font script="Knda" typeface="Tunga"/>',lr[lr.length]='<a:font script="Guru" typeface="Raavi"/>',lr[lr.length]='<a:font script="Cans" typeface="Euphemia"/>',lr[lr.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',lr[lr.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',lr[lr.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',lr[lr.length]='<a:font script="Thaa" typeface="MV Boli"/>',lr[lr.length]='<a:font script="Deva" typeface="Mangal"/>',lr[lr.length]='<a:font script="Telu" typeface="Gautami"/>',lr[lr.length]='<a:font script="Taml" typeface="Latha"/>',lr[lr.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',lr[lr.length]='<a:font script="Orya" typeface="Kalinga"/>',lr[lr.length]='<a:font script="Mlym" typeface="Kartika"/>',lr[lr.length]='<a:font script="Laoo" typeface="DokChampa"/>',lr[lr.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',lr[lr.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',lr[lr.length]='<a:font script="Viet" typeface="Arial"/>',lr[lr.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',lr[lr.length]='<a:font script="Geor" typeface="Sylfaen"/>',lr[lr.length]="</a:minorFont>",lr[lr.length]="</a:fontScheme>",lr[lr.length]='<a:fmtScheme name="Office">',lr[lr.length]="<a:fillStyleLst>",lr[lr.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',lr[lr.length]='<a:gradFill rotWithShape="1">',lr[lr.length]="<a:gsLst>",lr[lr.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',lr[lr.length]="</a:gsLst>",lr[lr.length]='<a:lin ang="16200000" scaled="1"/>',lr[lr.length]="</a:gradFill>",lr[lr.length]='<a:gradFill rotWithShape="1">',lr[lr.length]="<a:gsLst>",lr[lr.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',lr[lr.length]="</a:gsLst>",lr[lr.length]='<a:lin ang="16200000" scaled="0"/>',lr[lr.length]="</a:gradFill>",lr[lr.length]="</a:fillStyleLst>",lr[lr.length]="<a:lnStyleLst>",lr[lr.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',lr[lr.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',lr[lr.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',lr[lr.length]="</a:lnStyleLst>",lr[lr.length]="<a:effectStyleLst>",lr[lr.length]="<a:effectStyle>",lr[lr.length]="<a:effectLst>",lr[lr.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',lr[lr.length]="</a:effectLst>",lr[lr.length]="</a:effectStyle>",lr[lr.length]="<a:effectStyle>",lr[lr.length]="<a:effectLst>",lr[lr.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',lr[lr.length]="</a:effectLst>",lr[lr.length]="</a:effectStyle>",lr[lr.length]="<a:effectStyle>",lr[lr.length]="<a:effectLst>",lr[lr.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',lr[lr.length]="</a:effectLst>",lr[lr.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',lr[lr.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',lr[lr.length]="</a:effectStyle>",lr[lr.length]="</a:effectStyleLst>",lr[lr.length]="<a:bgFillStyleLst>",lr[lr.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',lr[lr.length]='<a:gradFill rotWithShape="1">',lr[lr.length]="<a:gsLst>",lr[lr.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',lr[lr.length]="</a:gsLst>",lr[lr.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',lr[lr.length]="</a:gradFill>",lr[lr.length]='<a:gradFill rotWithShape="1">',lr[lr.length]="<a:gsLst>",lr[lr.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',lr[lr.length]="</a:gsLst>",lr[lr.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',lr[lr.length]="</a:gradFill>",lr[lr.length]="</a:bgFillStyleLst>",lr[lr.length]="</a:fmtScheme>",lr[lr.length]="</a:themeElements>",lr[lr.length]="<a:objectDefaults>",lr[lr.length]="<a:spDef>",lr[lr.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',lr[lr.length]="</a:spDef>",lr[lr.length]="<a:lnDef>",lr[lr.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',lr[lr.length]="</a:lnDef>",lr[lr.length]="</a:objectDefaults>",lr[lr.length]="<a:extraClrSchemeLst/>",lr[lr.length]="</a:theme>",lr.join("")}function parse_BrtMdtinfo(ar,or){return{flags:ar.read_shift(4),version:ar.read_shift(4),name:parse_XLWideString(ar)}}function write_BrtMdtinfo(ar){var or=new_buf(12+2*ar.name.length);return or.write_shift(4,ar.flags),or.write_shift(4,ar.version),write_XLWideString(ar.name,or),or.slice(0,or.l)}function parse_BrtMdb(ar){for(var or=[],lr=ar.read_shift(4);lr-- >0;)or.push([ar.read_shift(4),ar.read_shift(4)]);return or}function write_BrtMdb(ar){var or=new_buf(4+8*ar.length);or.write_shift(4,ar.length);for(var lr=0;lr<ar.length;++lr)or.write_shift(4,ar[lr][0]),or.write_shift(4,ar[lr][1]);return or}function write_BrtBeginEsfmd(ar,or){var lr=new_buf(8+2*or.length);return lr.write_shift(4,ar),write_XLWideString(or,lr),lr.slice(0,lr.l)}function parse_BrtBeginEsmdb(ar){return ar.l+=4,ar.read_shift(4)!=0}function write_BrtBeginEsmdb(ar,or){var lr=new_buf(8);return lr.write_shift(4,ar),lr.write_shift(4,1),lr}function write_xlmeta_bin(){var ar=buf_array();return write_record(ar,332),write_record(ar,334,write_UInt32LE(1)),write_record(ar,335,write_BrtMdtinfo({name:"XLDAPR",version:12e4,flags:3496657072})),write_record(ar,336),write_record(ar,339,write_BrtBeginEsfmd(1,"XLDAPR")),write_record(ar,52),write_record(ar,35,write_UInt32LE(514)),write_record(ar,4096,write_UInt32LE(0)),write_record(ar,4097,writeuint16(1)),write_record(ar,36),write_record(ar,53),write_record(ar,340),write_record(ar,337,write_BrtBeginEsmdb(1)),write_record(ar,51,write_BrtMdb([[1,0]])),write_record(ar,338),write_record(ar,333),ar.end()}function write_xlmeta_xml(){var ar=[XML_HEADER];return ar.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),ar.join("")}function parse_BrtCalcChainItem$(ar){var or={};or.i=ar.read_shift(4);var lr={};lr.r=ar.read_shift(4),lr.c=ar.read_shift(4),or.r=encode_cell(lr);var cr=ar.read_shift(1);return cr&2&&(or.l="1"),cr&8&&(or.a="1"),or}var _shapeid=1024;function write_comments_vml(ar,or){for(var lr=[21600,21600],cr=["m0,0l0",lr[1],lr[0],lr[1],lr[0],"0xe"].join(","),ur=[writextag("xml",null,{"xmlns:v":XLMLNS.v,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:mv":XLMLNS.mv}).replace(/\/>/,">"),writextag("o:shapelayout",writextag("o:idmap",null,{"v:ext":"edit",data:ar}),{"v:ext":"edit"}),writextag("v:shapetype",[writextag("v:stroke",null,{joinstyle:"miter"}),writextag("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:lr.join(","),path:cr})];_shapeid<ar*1e3;)_shapeid+=1e3;return or.forEach(function(dr){var hr=decode_cell(dr[0]),pr={color2:"#BEFF82",type:"gradient"};pr.type=="gradient"&&(pr.angle="-180");var xr=pr.type=="gradient"?writextag("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,mr=writextag("v:fill",xr,pr),fr={on:"t",obscured:"t"};++_shapeid,ur=ur.concat(["<v:shape"+wxt_helper({id:"_x0000_s"+_shapeid,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(dr[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",mr,writextag("v:shadow",null,fr),writextag("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",writetag("x:Anchor",[hr.c+1,0,hr.r+1,0,hr.c+3,20,hr.r+5,20].join(",")),writetag("x:AutoFill","False"),writetag("x:Row",String(hr.r)),writetag("x:Column",String(hr.c)),dr[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),ur.push("</xml>"),ur.join("")}function write_comments_xml(ar){var or=[XML_HEADER,writextag("comments",null,{xmlns:XMLNS_main[0]})],lr=[];return or.push("<authors>"),ar.forEach(function(cr){cr[1].forEach(function(ur){var dr=escapexml(ur.a);lr.indexOf(dr)==-1&&(lr.push(dr),or.push("<author>"+dr+"</author>")),ur.T&&ur.ID&&lr.indexOf("tc="+ur.ID)==-1&&(lr.push("tc="+ur.ID),or.push("<author>tc="+ur.ID+"</author>"))})}),lr.length==0&&(lr.push("SheetJ5"),or.push("<author>SheetJ5</author>")),or.push("</authors>"),or.push("<commentList>"),ar.forEach(function(cr){var ur=0,dr=[];if(cr[1][0]&&cr[1][0].T&&cr[1][0].ID?ur=lr.indexOf("tc="+cr[1][0].ID):cr[1].forEach(function(xr){xr.a&&(ur=lr.indexOf(escapexml(xr.a))),dr.push(xr.t||"")}),or.push('<comment ref="'+cr[0]+'" authorId="'+ur+'"><text>'),dr.length<=1)or.push(writetag("t",escapexml(dr[0]||"")));else{for(var hr=`Comment:
    `+dr[0]+`
`,pr=1;pr<dr.length;++pr)hr+=`Reply:
    `+dr[pr]+`
`;or.push(writetag("t",escapexml(hr)))}or.push("</text></comment>")}),or.push("</commentList>"),or.length>2&&(or[or.length]="</comments>",or[1]=or[1].replace("/>",">")),or.join("")}function write_tcmnt_xml(ar,or,lr){var cr=[XML_HEADER,writextag("ThreadedComments",null,{xmlns:XMLNS.TCMNT}).replace(/[\/]>/,">")];return ar.forEach(function(ur){var dr="";(ur[1]||[]).forEach(function(hr,pr){if(!hr.T){delete hr.ID;return}hr.a&&or.indexOf(hr.a)==-1&&or.push(hr.a);var xr={ref:ur[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+lr.tcid++).slice(-12)+"}"};pr==0?dr=xr.id:xr.parentId=dr,hr.ID=xr.id,hr.a&&(xr.personId="{54EE7950-7262-4200-6969-"+("000000000000"+or.indexOf(hr.a)).slice(-12)+"}"),cr.push(writextag("threadedComment",writetag("text",hr.t||""),xr))})}),cr.push("</ThreadedComments>"),cr.join("")}function write_people_xml(ar){var or=[XML_HEADER,writextag("personList",null,{xmlns:XMLNS.TCMNT,"xmlns:x":XMLNS_main[0]}).replace(/[\/]>/,">")];return ar.forEach(function(lr,cr){or.push(writextag("person",null,{displayName:lr,id:"{54EE7950-7262-4200-6969-"+("000000000000"+cr).slice(-12)+"}",userId:lr,providerId:"None"}))}),or.push("</personList>"),or.join("")}function parse_BrtBeginComment(ar){var or={};or.iauthor=ar.read_shift(4);var lr=parse_UncheckedRfX(ar);return or.rfx=lr.s,or.ref=encode_cell(lr.s),ar.l+=16,or}function write_BrtBeginComment(ar,or){return or==null&&(or=new_buf(36)),or.write_shift(4,ar[1].iauthor),write_UncheckedRfX(ar[0],or),or.write_shift(4,0),or.write_shift(4,0),or.write_shift(4,0),or.write_shift(4,0),or}var parse_BrtCommentAuthor=parse_XLWideString;function write_BrtCommentAuthor(ar){return write_XLWideString(ar.slice(0,54))}function write_comments_bin(ar){var or=buf_array(),lr=[];return write_record(or,628),write_record(or,630),ar.forEach(function(cr){cr[1].forEach(function(ur){lr.indexOf(ur.a)>-1||(lr.push(ur.a.slice(0,54)),write_record(or,632,write_BrtCommentAuthor(ur.a)))})}),write_record(or,631),write_record(or,633),ar.forEach(function(cr){cr[1].forEach(function(ur){ur.iauthor=lr.indexOf(ur.a);var dr={s:decode_cell(cr[0]),e:decode_cell(cr[0])};write_record(or,635,write_BrtBeginComment([dr,ur])),ur.t&&ur.t.length>0&&write_record(or,637,write_BrtCommentText(ur)),write_record(or,636),delete ur.iauthor})}),write_record(or,634),write_record(or,629),or.end()}function fill_vba_xls(ar,or){or.FullPaths.forEach(function(lr,cr){if(cr!=0){var ur=lr.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");ur.slice(-1)!=="/"&&CFB.utils.cfb_add(ar,ur,or.FileIndex[cr].content)}})}var VBAFMTS=["xlsb","xlsm","xlam","biff8","xla"],rc_to_a1=function(){var ar=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,or={r:0,c:0};function lr(cr,ur,dr,hr){var pr=!1,xr=!1;dr.length==0?xr=!0:dr.charAt(0)=="["&&(xr=!0,dr=dr.slice(1,-1)),hr.length==0?pr=!0:hr.charAt(0)=="["&&(pr=!0,hr=hr.slice(1,-1));var mr=dr.length>0?parseInt(dr,10)|0:0,fr=hr.length>0?parseInt(hr,10)|0:0;return pr?fr+=or.c:--fr,xr?mr+=or.r:--mr,ur+(pr?"":"$")+encode_col(fr)+(xr?"":"$")+encode_row(mr)}return function(ur,dr){return or=dr,ur.replace(ar,lr)}}(),crefregex=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,a1_to_rc=function(){return function(or,lr){return or.replace(crefregex,function(cr,ur,dr,hr,pr,xr){var mr=decode_col(hr)-(dr?0:lr.c),fr=decode_row(xr)-(pr?0:lr.r),Er=fr==0?"":pr?fr+1:"["+fr+"]",vr=mr==0?"":dr?mr+1:"["+mr+"]";return ur+"R"+Er+"C"+vr})}}();function shift_formula_str(ar,or){return ar.replace(crefregex,function(lr,cr,ur,dr,hr,pr){return cr+(ur=="$"?ur+dr:encode_col(decode_col(dr)+or.c))+(hr=="$"?hr+pr:encode_row(decode_row(pr)+or.r))})}function fuzzyfmla(ar){return ar.length!=1}function parseread1(ar){ar.l+=1}function parse_ColRelU(ar,or){var lr=ar.read_shift(2);return[lr&16383,lr>>14&1,lr>>15&1]}function parse_RgceArea(ar,or,lr){var cr=2;if(lr){if(lr.biff>=2&&lr.biff<=5)return parse_RgceArea_BIFF2(ar);lr.biff==12&&(cr=4)}var ur=ar.read_shift(cr),dr=ar.read_shift(cr),hr=parse_ColRelU(ar),pr=parse_ColRelU(ar);return{s:{r:ur,c:hr[0],cRel:hr[1],rRel:hr[2]},e:{r:dr,c:pr[0],cRel:pr[1],rRel:pr[2]}}}function parse_RgceArea_BIFF2(ar){var or=parse_ColRelU(ar),lr=parse_ColRelU(ar),cr=ar.read_shift(1),ur=ar.read_shift(1);return{s:{r:or[0],c:cr,cRel:or[1],rRel:or[2]},e:{r:lr[0],c:ur,cRel:lr[1],rRel:lr[2]}}}function parse_RgceAreaRel(ar,or,lr){if(lr.biff<8)return parse_RgceArea_BIFF2(ar);var cr=ar.read_shift(lr.biff==12?4:2),ur=ar.read_shift(lr.biff==12?4:2),dr=parse_ColRelU(ar),hr=parse_ColRelU(ar);return{s:{r:cr,c:dr[0],cRel:dr[1],rRel:dr[2]},e:{r:ur,c:hr[0],cRel:hr[1],rRel:hr[2]}}}function parse_RgceLoc(ar,or,lr){if(lr&&lr.biff>=2&&lr.biff<=5)return parse_RgceLoc_BIFF2(ar);var cr=ar.read_shift(lr&&lr.biff==12?4:2),ur=parse_ColRelU(ar);return{r:cr,c:ur[0],cRel:ur[1],rRel:ur[2]}}function parse_RgceLoc_BIFF2(ar){var or=parse_ColRelU(ar),lr=ar.read_shift(1);return{r:or[0],c:lr,cRel:or[1],rRel:or[2]}}function parse_RgceElfLoc(ar){var or=ar.read_shift(2),lr=ar.read_shift(2);return{r:or,c:lr&255,fQuoted:!!(lr&16384),cRel:lr>>15,rRel:lr>>15}}function parse_RgceLocRel(ar,or,lr){var cr=lr&&lr.biff?lr.biff:8;if(cr>=2&&cr<=5)return parse_RgceLocRel_BIFF2(ar);var ur=ar.read_shift(cr>=12?4:2),dr=ar.read_shift(2),hr=(dr&16384)>>14,pr=(dr&32768)>>15;if(dr&=16383,pr==1)for(;ur>524287;)ur-=1048576;if(hr==1)for(;dr>8191;)dr=dr-16384;return{r:ur,c:dr,cRel:hr,rRel:pr}}function parse_RgceLocRel_BIFF2(ar){var or=ar.read_shift(2),lr=ar.read_shift(1),cr=(or&32768)>>15,ur=(or&16384)>>14;return or&=16383,cr==1&&or>=8192&&(or=or-16384),ur==1&&lr>=128&&(lr=lr-256),{r:or,c:lr,cRel:ur,rRel:cr}}function parse_PtgArea(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=parse_RgceArea(ar,lr.biff>=2&&lr.biff<=5?6:8,lr);return[cr,ur]}function parse_PtgArea3d(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=ar.read_shift(2,"i"),dr=8;if(lr)switch(lr.biff){case 5:ar.l+=12,dr=6;break;case 12:dr=12;break}var hr=parse_RgceArea(ar,dr,lr);return[cr,ur,hr]}function parse_PtgAreaErr(ar,or,lr){var cr=(ar[ar.l++]&96)>>5;return ar.l+=lr&&lr.biff>8?12:lr.biff<8?6:8,[cr]}function parse_PtgAreaErr3d(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=ar.read_shift(2),dr=8;if(lr)switch(lr.biff){case 5:ar.l+=12,dr=6;break;case 12:dr=12;break}return ar.l+=dr,[cr,ur]}function parse_PtgAreaN(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=parse_RgceAreaRel(ar,or-1,lr);return[cr,ur]}function parse_PtgArray(ar,or,lr){var cr=(ar[ar.l++]&96)>>5;return ar.l+=lr.biff==2?6:lr.biff==12?14:7,[cr]}function parse_PtgAttrBaxcel(ar){var or=ar[ar.l+1]&1,lr=1;return ar.l+=4,[or,lr]}function parse_PtgAttrChoose(ar,or,lr){ar.l+=2;for(var cr=ar.read_shift(lr&&lr.biff==2?1:2),ur=[],dr=0;dr<=cr;++dr)ur.push(ar.read_shift(lr&&lr.biff==2?1:2));return ur}function parse_PtgAttrGoto(ar,or,lr){var cr=ar[ar.l+1]&255?1:0;return ar.l+=2,[cr,ar.read_shift(lr&&lr.biff==2?1:2)]}function parse_PtgAttrIf(ar,or,lr){var cr=ar[ar.l+1]&255?1:0;return ar.l+=2,[cr,ar.read_shift(lr&&lr.biff==2?1:2)]}function parse_PtgAttrIfError(ar){var or=ar[ar.l+1]&255?1:0;return ar.l+=2,[or,ar.read_shift(2)]}function parse_PtgAttrSemi(ar,or,lr){var cr=ar[ar.l+1]&255?1:0;return ar.l+=lr&&lr.biff==2?3:4,[cr]}function parse_PtgAttrSpaceType(ar){var or=ar.read_shift(1),lr=ar.read_shift(1);return[or,lr]}function parse_PtgAttrSpace(ar){return ar.read_shift(2),parse_PtgAttrSpaceType(ar)}function parse_PtgAttrSpaceSemi(ar){return ar.read_shift(2),parse_PtgAttrSpaceType(ar)}function parse_PtgRef(ar,or,lr){var cr=(ar[ar.l]&96)>>5;ar.l+=1;var ur=parse_RgceLoc(ar,0,lr);return[cr,ur]}function parse_PtgRefN(ar,or,lr){var cr=(ar[ar.l]&96)>>5;ar.l+=1;var ur=parse_RgceLocRel(ar,0,lr);return[cr,ur]}function parse_PtgRef3d(ar,or,lr){var cr=(ar[ar.l]&96)>>5;ar.l+=1;var ur=ar.read_shift(2);lr&&lr.biff==5&&(ar.l+=12);var dr=parse_RgceLoc(ar,0,lr);return[cr,ur,dr]}function parse_PtgFunc(ar,or,lr){var cr=(ar[ar.l]&96)>>5;ar.l+=1;var ur=ar.read_shift(lr&&lr.biff<=3?1:2);return[FtabArgc[ur],Ftab[ur],cr]}function parse_PtgFuncVar(ar,or,lr){var cr=ar[ar.l++],ur=ar.read_shift(1),dr=lr&&lr.biff<=3?[cr==88?-1:0,ar.read_shift(1)]:parsetab(ar);return[ur,(dr[0]===0?Ftab:Cetab)[dr[1]]]}function parsetab(ar){return[ar[ar.l+1]>>7,ar.read_shift(2)&32767]}function parse_PtgAttrSum(ar,or,lr){ar.l+=lr&&lr.biff==2?3:4}function parse_PtgExp(ar,or,lr){if(ar.l++,lr&&lr.biff==12)return[ar.read_shift(4,"i"),0];var cr=ar.read_shift(2),ur=ar.read_shift(lr&&lr.biff==2?1:2);return[cr,ur]}function parse_PtgErr(ar){return ar.l++,BErr[ar.read_shift(1)]}function parse_PtgInt(ar){return ar.l++,ar.read_shift(2)}function parse_PtgBool(ar){return ar.l++,ar.read_shift(1)!==0}function parse_PtgNum(ar){return ar.l++,parse_Xnum(ar)}function parse_PtgStr(ar,or,lr){return ar.l++,parse_ShortXLUnicodeString(ar,or-1,lr)}function parse_SerAr(ar,or){var lr=[ar.read_shift(1)];if(or==12)switch(lr[0]){case 2:lr[0]=4;break;case 4:lr[0]=16;break;case 0:lr[0]=1;break;case 1:lr[0]=2;break}switch(lr[0]){case 4:lr[1]=parsebool(ar,1)?"TRUE":"FALSE",or!=12&&(ar.l+=7);break;case 37:case 16:lr[1]=BErr[ar[ar.l]],ar.l+=or==12?4:8;break;case 0:ar.l+=8;break;case 1:lr[1]=parse_Xnum(ar);break;case 2:lr[1]=parse_XLUnicodeString2(ar,0,{biff:or>0&&or<8?2:or});break;default:throw new Error("Bad SerAr: "+lr[0])}return lr}function parse_PtgExtraMem(ar,or,lr){for(var cr=ar.read_shift(lr.biff==12?4:2),ur=[],dr=0;dr!=cr;++dr)ur.push((lr.biff==12?parse_UncheckedRfX:parse_Ref8U)(ar));return ur}function parse_PtgExtraArray(ar,or,lr){var cr=0,ur=0;lr.biff==12?(cr=ar.read_shift(4),ur=ar.read_shift(4)):(ur=1+ar.read_shift(1),cr=1+ar.read_shift(2)),lr.biff>=2&&lr.biff<8&&(--cr,--ur==0&&(ur=256));for(var dr=0,hr=[];dr!=cr&&(hr[dr]=[]);++dr)for(var pr=0;pr!=ur;++pr)hr[dr][pr]=parse_SerAr(ar,lr.biff);return hr}function parse_PtgName(ar,or,lr){var cr=ar.read_shift(1)>>>5&3,ur=!lr||lr.biff>=8?4:2,dr=ar.read_shift(ur);switch(lr.biff){case 2:ar.l+=5;break;case 3:case 4:ar.l+=8;break;case 5:ar.l+=12;break}return[cr,0,dr]}function parse_PtgNameX(ar,or,lr){if(lr.biff==5)return parse_PtgNameX_BIFF5(ar);var cr=ar.read_shift(1)>>>5&3,ur=ar.read_shift(2),dr=ar.read_shift(4);return[cr,ur,dr]}function parse_PtgNameX_BIFF5(ar){var or=ar.read_shift(1)>>>5&3,lr=ar.read_shift(2,"i");ar.l+=8;var cr=ar.read_shift(2);return ar.l+=12,[or,lr,cr]}function parse_PtgMemArea(ar,or,lr){var cr=ar.read_shift(1)>>>5&3;ar.l+=lr&&lr.biff==2?3:4;var ur=ar.read_shift(lr&&lr.biff==2?1:2);return[cr,ur]}function parse_PtgMemFunc(ar,or,lr){var cr=ar.read_shift(1)>>>5&3,ur=ar.read_shift(lr&&lr.biff==2?1:2);return[cr,ur]}function parse_PtgRefErr(ar,or,lr){var cr=ar.read_shift(1)>>>5&3;return ar.l+=4,lr.biff<8&&ar.l--,lr.biff==12&&(ar.l+=2),[cr]}function parse_PtgRefErr3d(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=ar.read_shift(2),dr=4;if(lr)switch(lr.biff){case 5:dr=15;break;case 12:dr=6;break}return ar.l+=dr,[cr,ur]}var parse_PtgMemErr=parsenoop,parse_PtgMemNoMem=parsenoop,parse_PtgTbl=parsenoop;function parse_PtgElfLoc(ar,or,lr){return ar.l+=2,[parse_RgceElfLoc(ar)]}function parse_PtgElfNoop(ar){return ar.l+=6,[]}var parse_PtgElfCol=parse_PtgElfLoc,parse_PtgElfColS=parse_PtgElfNoop,parse_PtgElfColSV=parse_PtgElfNoop,parse_PtgElfColV=parse_PtgElfLoc;function parse_PtgElfLel(ar){return ar.l+=2,[parseuint16(ar),ar.read_shift(2)&1]}var parse_PtgElfRadical=parse_PtgElfLoc,parse_PtgElfRadicalLel=parse_PtgElfLel,parse_PtgElfRadicalS=parse_PtgElfNoop,parse_PtgElfRw=parse_PtgElfLoc,parse_PtgElfRwV=parse_PtgElfLoc,PtgListRT=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function parse_PtgList(ar){ar.l+=2;var or=ar.read_shift(2),lr=ar.read_shift(2),cr=ar.read_shift(4),ur=ar.read_shift(2),dr=ar.read_shift(2),hr=PtgListRT[lr>>2&31];return{ixti:or,coltype:lr&3,rt:hr,idx:cr,c:ur,C:dr}}function parse_PtgSxName(ar){return ar.l+=2,[ar.read_shift(4)]}function parse_PtgSheet(ar,or,lr){return ar.l+=5,ar.l+=2,ar.l+=lr.biff==2?1:4,["PTGSHEET"]}function parse_PtgEndSheet(ar,or,lr){return ar.l+=lr.biff==2?4:5,["PTGENDSHEET"]}function parse_PtgMemAreaN(ar){var or=ar.read_shift(1)>>>5&3,lr=ar.read_shift(2);return[or,lr]}function parse_PtgMemNoMemN(ar){var or=ar.read_shift(1)>>>5&3,lr=ar.read_shift(2);return[or,lr]}function parse_PtgAttrNoop(ar){return ar.l+=4,[0,0]}var PtgTypes={1:{n:"PtgExp",f:parse_PtgExp},2:{n:"PtgTbl",f:parse_PtgTbl},3:{n:"PtgAdd",f:parseread1},4:{n:"PtgSub",f:parseread1},5:{n:"PtgMul",f:parseread1},6:{n:"PtgDiv",f:parseread1},7:{n:"PtgPower",f:parseread1},8:{n:"PtgConcat",f:parseread1},9:{n:"PtgLt",f:parseread1},10:{n:"PtgLe",f:parseread1},11:{n:"PtgEq",f:parseread1},12:{n:"PtgGe",f:parseread1},13:{n:"PtgGt",f:parseread1},14:{n:"PtgNe",f:parseread1},15:{n:"PtgIsect",f:parseread1},16:{n:"PtgUnion",f:parseread1},17:{n:"PtgRange",f:parseread1},18:{n:"PtgUplus",f:parseread1},19:{n:"PtgUminus",f:parseread1},20:{n:"PtgPercent",f:parseread1},21:{n:"PtgParen",f:parseread1},22:{n:"PtgMissArg",f:parseread1},23:{n:"PtgStr",f:parse_PtgStr},26:{n:"PtgSheet",f:parse_PtgSheet},27:{n:"PtgEndSheet",f:parse_PtgEndSheet},28:{n:"PtgErr",f:parse_PtgErr},29:{n:"PtgBool",f:parse_PtgBool},30:{n:"PtgInt",f:parse_PtgInt},31:{n:"PtgNum",f:parse_PtgNum},32:{n:"PtgArray",f:parse_PtgArray},33:{n:"PtgFunc",f:parse_PtgFunc},34:{n:"PtgFuncVar",f:parse_PtgFuncVar},35:{n:"PtgName",f:parse_PtgName},36:{n:"PtgRef",f:parse_PtgRef},37:{n:"PtgArea",f:parse_PtgArea},38:{n:"PtgMemArea",f:parse_PtgMemArea},39:{n:"PtgMemErr",f:parse_PtgMemErr},40:{n:"PtgMemNoMem",f:parse_PtgMemNoMem},41:{n:"PtgMemFunc",f:parse_PtgMemFunc},42:{n:"PtgRefErr",f:parse_PtgRefErr},43:{n:"PtgAreaErr",f:parse_PtgAreaErr},44:{n:"PtgRefN",f:parse_PtgRefN},45:{n:"PtgAreaN",f:parse_PtgAreaN},46:{n:"PtgMemAreaN",f:parse_PtgMemAreaN},47:{n:"PtgMemNoMemN",f:parse_PtgMemNoMemN},57:{n:"PtgNameX",f:parse_PtgNameX},58:{n:"PtgRef3d",f:parse_PtgRef3d},59:{n:"PtgArea3d",f:parse_PtgArea3d},60:{n:"PtgRefErr3d",f:parse_PtgRefErr3d},61:{n:"PtgAreaErr3d",f:parse_PtgAreaErr3d},255:{}},PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Ptg18={1:{n:"PtgElfLel",f:parse_PtgElfLel},2:{n:"PtgElfRw",f:parse_PtgElfRw},3:{n:"PtgElfCol",f:parse_PtgElfCol},6:{n:"PtgElfRwV",f:parse_PtgElfRwV},7:{n:"PtgElfColV",f:parse_PtgElfColV},10:{n:"PtgElfRadical",f:parse_PtgElfRadical},11:{n:"PtgElfRadicalS",f:parse_PtgElfRadicalS},13:{n:"PtgElfColS",f:parse_PtgElfColS},15:{n:"PtgElfColSV",f:parse_PtgElfColSV},16:{n:"PtgElfRadicalLel",f:parse_PtgElfRadicalLel},25:{n:"PtgList",f:parse_PtgList},29:{n:"PtgSxName",f:parse_PtgSxName},255:{}},Ptg19={0:{n:"PtgAttrNoop",f:parse_PtgAttrNoop},1:{n:"PtgAttrSemi",f:parse_PtgAttrSemi},2:{n:"PtgAttrIf",f:parse_PtgAttrIf},4:{n:"PtgAttrChoose",f:parse_PtgAttrChoose},8:{n:"PtgAttrGoto",f:parse_PtgAttrGoto},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},33:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},64:{n:"PtgAttrSpace",f:parse_PtgAttrSpace},65:{n:"PtgAttrSpaceSemi",f:parse_PtgAttrSpaceSemi},128:{n:"PtgAttrIfError",f:parse_PtgAttrIfError},255:{}};function parse_RgbExtra(ar,or,lr,cr){if(cr.biff<8)return parsenoop(ar,or);for(var ur=ar.l+or,dr=[],hr=0;hr!==lr.length;++hr)switch(lr[hr][0]){case"PtgArray":lr[hr][1]=parse_PtgExtraArray(ar,0,cr),dr.push(lr[hr][1]);break;case"PtgMemArea":lr[hr][2]=parse_PtgExtraMem(ar,lr[hr][1],cr),dr.push(lr[hr][2]);break;case"PtgExp":cr&&cr.biff==12&&(lr[hr][1][1]=ar.read_shift(4),dr.push(lr[hr][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+lr[hr][0]}return or=ur-ar.l,or!==0&&dr.push(parsenoop(ar,or)),dr}function parse_Rgce(ar,or,lr){for(var cr=ar.l+or,ur,dr,hr=[];cr!=ar.l;)or=cr-ar.l,dr=ar[ar.l],ur=PtgTypes[dr]||PtgTypes[PtgDupes[dr]],(dr===24||dr===25)&&(ur=(dr===24?Ptg18:Ptg19)[ar[ar.l+1]]),!ur||!ur.f?parsenoop(ar,or):hr.push([ur.n,ur.f(ar,or,lr)]);return hr}function stringify_array(ar){for(var or=[],lr=0;lr<ar.length;++lr){for(var cr=ar[lr],ur=[],dr=0;dr<cr.length;++dr){var hr=cr[dr];if(hr)switch(hr[0]){case 2:ur.push('"'+hr[1].replace(/"/g,'""')+'"');break;default:ur.push(hr[1])}else ur.push("")}or.push(ur.join(","))}return or.join(";")}var PtgBinOp={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function formula_quote_sheet_name(ar,or){if(!ar&&!(or&&or.biff<=5&&or.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(ar)?"'"+ar+"'":ar}function get_ixti_raw(ar,or,lr){if(!ar)return"SH33TJSERR0";if(lr.biff>8&&(!ar.XTI||!ar.XTI[or]))return ar.SheetNames[or];if(!ar.XTI)return"SH33TJSERR6";var cr=ar.XTI[or];if(lr.biff<8)return or>1e4&&(or-=65536),or<0&&(or=-or),or==0?"":ar.XTI[or-1];if(!cr)return"SH33TJSERR1";var ur="";if(lr.biff>8)switch(ar[cr[0]][0]){case 357:return ur=cr[1]==-1?"#REF":ar.SheetNames[cr[1]],cr[1]==cr[2]?ur:ur+":"+ar.SheetNames[cr[2]];case 358:return lr.SID!=null?ar.SheetNames[lr.SID]:"SH33TJSSAME"+ar[cr[0]][0];case 355:default:return"SH33TJSSRC"+ar[cr[0]][0]}switch(ar[cr[0]][0][0]){case 1025:return ur=cr[1]==-1?"#REF":ar.SheetNames[cr[1]]||"SH33TJSERR3",cr[1]==cr[2]?ur:ur+":"+ar.SheetNames[cr[2]];case 14849:return ar[cr[0]].slice(1).map(function(dr){return dr.Name}).join(";;");default:return ar[cr[0]][0][3]?(ur=cr[1]==-1?"#REF":ar[cr[0]][0][3][cr[1]]||"SH33TJSERR4",cr[1]==cr[2]?ur:ur+":"+ar[cr[0]][0][3][cr[2]]):"SH33TJSERR2"}}function get_ixti(ar,or,lr){var cr=get_ixti_raw(ar,or,lr);return cr=="#REF"?cr:formula_quote_sheet_name(cr,lr)}function stringify_formula(ar,or,lr,cr,ur){var dr=ur&&ur.biff||8,hr={s:{c:0,r:0}},pr=[],xr,mr,fr,Er=0,vr=0,gr,yr="";if(!ar[0]||!ar[0][0])return"";for(var jr=-1,br="",_r=0,wr=ar[0].length;_r<wr;++_r){var Rr=ar[0][_r];switch(Rr[0]){case"PtgUminus":pr.push("-"+pr.pop());break;case"PtgUplus":pr.push("+"+pr.pop());break;case"PtgPercent":pr.push(pr.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(xr=pr.pop(),mr=pr.pop(),jr>=0){switch(ar[0][jr][1][0]){case 0:br=fill(" ",ar[0][jr][1][1]);break;case 1:br=fill("\r",ar[0][jr][1][1]);break;default:if(br="",ur.WTF)throw new Error("Unexpected PtgAttrSpaceType "+ar[0][jr][1][0])}mr=mr+br,jr=-1}pr.push(mr+PtgBinOp[Rr[0]]+xr);break;case"PtgIsect":xr=pr.pop(),mr=pr.pop(),pr.push(mr+" "+xr);break;case"PtgUnion":xr=pr.pop(),mr=pr.pop(),pr.push(mr+","+xr);break;case"PtgRange":xr=pr.pop(),mr=pr.pop(),pr.push(mr+":"+xr);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":fr=shift_cell_xls(Rr[1][1],hr,ur),pr.push(encode_cell_xls(fr,dr));break;case"PtgRefN":fr=lr?shift_cell_xls(Rr[1][1],lr,ur):Rr[1][1],pr.push(encode_cell_xls(fr,dr));break;case"PtgRef3d":Er=Rr[1][1],fr=shift_cell_xls(Rr[1][2],hr,ur),yr=get_ixti(cr,Er,ur),pr.push(yr+"!"+encode_cell_xls(fr,dr));break;case"PtgFunc":case"PtgFuncVar":var Ar=Rr[1][0],Sr=Rr[1][1];Ar||(Ar=0),Ar&=127;var kr=Ar==0?[]:pr.slice(-Ar);pr.length-=Ar,Sr==="User"&&(Sr=kr.shift()),pr.push(Sr+"("+kr.join(",")+")");break;case"PtgBool":pr.push(Rr[1]?"TRUE":"FALSE");break;case"PtgInt":pr.push(Rr[1]);break;case"PtgNum":pr.push(String(Rr[1]));break;case"PtgStr":pr.push('"'+Rr[1].replace(/"/g,'""')+'"');break;case"PtgErr":pr.push(Rr[1]);break;case"PtgAreaN":gr=shift_range_xls(Rr[1][1],lr?{s:lr}:hr,ur),pr.push(encode_range_xls(gr,ur));break;case"PtgArea":gr=shift_range_xls(Rr[1][1],hr,ur),pr.push(encode_range_xls(gr,ur));break;case"PtgArea3d":Er=Rr[1][1],gr=Rr[1][2],yr=get_ixti(cr,Er,ur),pr.push(yr+"!"+encode_range_xls(gr,ur));break;case"PtgAttrSum":pr.push("SUM("+pr.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":vr=Rr[1][2];var Nr=(cr.names||[])[vr-1]||(cr[0]||[])[vr],Cr=Nr?Nr.Name:"SH33TJSNAME"+String(vr);Cr&&Cr.slice(0,6)=="_xlfn."&&!ur.xlfn&&(Cr=Cr.slice(6)),pr.push(Cr);break;case"PtgNameX":var Tr=Rr[1][1];vr=Rr[1][2];var Pr;if(ur.biff<=5)Tr<0&&(Tr=-Tr),cr[Tr]&&(Pr=cr[Tr][vr]);else{var Ir="";if(((cr[Tr]||[])[0]||[])[0]==14849||(((cr[Tr]||[])[0]||[])[0]==1025?cr[Tr][vr]&&cr[Tr][vr].itab>0&&(Ir=cr.SheetNames[cr[Tr][vr].itab-1]+"!"):Ir=cr.SheetNames[vr-1]+"!"),cr[Tr]&&cr[Tr][vr])Ir+=cr[Tr][vr].Name;else if(cr[0]&&cr[0][vr])Ir+=cr[0][vr].Name;else{var Br=(get_ixti_raw(cr,Tr,ur)||"").split(";;");Br[vr-1]?Ir=Br[vr-1]:Ir+="SH33TJSERRX"}pr.push(Ir);break}Pr||(Pr={Name:"SH33TJSERRY"}),pr.push(Pr.Name);break;case"PtgParen":var Wr="(",Yr=")";if(jr>=0){switch(br="",ar[0][jr][1][0]){case 2:Wr=fill(" ",ar[0][jr][1][1])+Wr;break;case 3:Wr=fill("\r",ar[0][jr][1][1])+Wr;break;case 4:Yr=fill(" ",ar[0][jr][1][1])+Yr;break;case 5:Yr=fill("\r",ar[0][jr][1][1])+Yr;break;default:if(ur.WTF)throw new Error("Unexpected PtgAttrSpaceType "+ar[0][jr][1][0])}jr=-1}pr.push(Wr+pr.pop()+Yr);break;case"PtgRefErr":pr.push("#REF!");break;case"PtgRefErr3d":pr.push("#REF!");break;case"PtgExp":fr={c:Rr[1][1],r:Rr[1][0]};var es={c:lr.c,r:lr.r};if(cr.sharedf[encode_cell(fr)]){var ps=cr.sharedf[encode_cell(fr)];pr.push(stringify_formula(ps,hr,es,cr,ur))}else{var ts=!1;for(xr=0;xr!=cr.arrayf.length;++xr)if(mr=cr.arrayf[xr],!(fr.c<mr[0].s.c||fr.c>mr[0].e.c)&&!(fr.r<mr[0].s.r||fr.r>mr[0].e.r)){pr.push(stringify_formula(mr[1],hr,es,cr,ur)),ts=!0;break}ts||pr.push(Rr[1])}break;case"PtgArray":pr.push("{"+stringify_array(Rr[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":jr=_r;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":pr.push("");break;case"PtgAreaErr":pr.push("#REF!");break;case"PtgAreaErr3d":pr.push("#REF!");break;case"PtgList":pr.push("Table"+Rr[1].idx+"[#"+Rr[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(Rr));default:throw new Error("Unrecognized Formula Token: "+String(Rr))}var Qr=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(ur.biff!=3&&jr>=0&&Qr.indexOf(ar[0][_r][0])==-1){Rr=ar[0][jr];var Hr=!0;switch(Rr[1][0]){case 4:Hr=!1;case 0:br=fill(" ",Rr[1][1]);break;case 5:Hr=!1;case 1:br=fill("\r",Rr[1][1]);break;default:if(br="",ur.WTF)throw new Error("Unexpected PtgAttrSpaceType "+Rr[1][0])}pr.push((Hr?br:"")+pr.pop()+(Hr?"":br)),jr=-1}}if(pr.length>1&&ur.WTF)throw new Error("bad formula stack");return pr[0]}function write_FormulaValue(ar){if(ar==null){var or=new_buf(8);return or.write_shift(1,3),or.write_shift(1,0),or.write_shift(2,0),or.write_shift(2,0),or.write_shift(2,65535),or}else if(typeof ar=="number")return write_Xnum(ar);return write_Xnum(0)}function write_Formula(ar,or,lr,cr,ur){var dr=write_XLSCell(or,lr,ur),hr=write_FormulaValue(ar.v),pr=new_buf(6),xr=33;pr.write_shift(2,xr),pr.write_shift(4,0);for(var mr=new_buf(ar.bf.length),fr=0;fr<ar.bf.length;++fr)mr[fr]=ar.bf[fr];var Er=bconcat([dr,hr,pr,mr]);return Er}function parse_XLSBParsedFormula(ar,or,lr){var cr=ar.read_shift(4),ur=parse_Rgce(ar,cr,lr),dr=ar.read_shift(4),hr=dr>0?parse_RgbExtra(ar,dr,ur,lr):null;return[ur,hr]}var parse_XLSBArrayParsedFormula=parse_XLSBParsedFormula,parse_XLSBCellParsedFormula=parse_XLSBParsedFormula,parse_XLSBNameParsedFormula=parse_XLSBParsedFormula,parse_XLSBSharedParsedFormula=parse_XLSBParsedFormula,Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},FtabArgc={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function csf_to_ods_formula(ar){var or="of:="+ar.replace(crefregex,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return or.replace(/;/g,"|").replace(/,/g,";")}function csf_to_ods_3D(ar){return ar.replace(/\./,"!")}var browser_has_Map=typeof Map<"u";function get_sst_id(ar,or,lr){var cr=0,ur=ar.length;if(lr){if(browser_has_Map?lr.has(or):Object.prototype.hasOwnProperty.call(lr,or)){for(var dr=browser_has_Map?lr.get(or):lr[or];cr<dr.length;++cr)if(ar[dr[cr]].t===or)return ar.Count++,dr[cr]}}else for(;cr<ur;++cr)if(ar[cr].t===or)return ar.Count++,cr;return ar[ur]={t:or},ar.Count++,ar.Unique++,lr&&(browser_has_Map?(lr.has(or)||lr.set(or,[]),lr.get(or).push(ur)):(Object.prototype.hasOwnProperty.call(lr,or)||(lr[or]=[]),lr[or].push(ur))),ur}function col_obj_w(ar,or){var lr={min:ar+1,max:ar+1},cr=-1;return or.MDW&&(MDW=or.MDW),or.width!=null?lr.customWidth=1:or.wpx!=null?cr=px2char(or.wpx):or.wch!=null&&(cr=or.wch),cr>-1?(lr.width=char2width(cr),lr.customWidth=1):or.width!=null&&(lr.width=or.width),or.hidden&&(lr.hidden=!0),or.level!=null&&(lr.outlineLevel=lr.level=or.level),lr}function default_margins(ar,or){if(ar){var lr=[.7,.7,.75,.75,.3,.3];ar.left==null&&(ar.left=lr[0]),ar.right==null&&(ar.right=lr[1]),ar.top==null&&(ar.top=lr[2]),ar.bottom==null&&(ar.bottom=lr[3]),ar.header==null&&(ar.header=lr[4]),ar.footer==null&&(ar.footer=lr[5])}}function get_cell_style(ar,or,lr){var cr=lr.revssf[or.z!=null?or.z:"General"],ur=60,dr=ar.length;if(cr==null&&lr.ssf){for(;ur<392;++ur)if(lr.ssf[ur]==null){SSF_load(or.z,ur),lr.ssf[ur]=or.z,lr.revssf[or.z]=cr=ur;break}}for(ur=0;ur!=dr;++ur)if(ar[ur].numFmtId===cr)return ur;return ar[dr]={numFmtId:cr,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},dr}function check_ws(ar,or,lr){if(ar&&ar["!ref"]){var cr=safe_decode_range(ar["!ref"]);if(cr.e.c<cr.s.c||cr.e.r<cr.s.r)throw new Error("Bad range ("+lr+"): "+ar["!ref"])}}function write_ws_xml_merges(ar){if(ar.length===0)return"";for(var or='<mergeCells count="'+ar.length+'">',lr=0;lr!=ar.length;++lr)or+='<mergeCell ref="'+encode_range(ar[lr])+'"/>';return or+"</mergeCells>"}function write_ws_xml_sheetpr(ar,or,lr,cr,ur){var dr=!1,hr={},pr=null;if(cr.bookType!=="xlsx"&&or.vbaraw){var xr=or.SheetNames[lr];try{or.Workbook&&(xr=or.Workbook.Sheets[lr].CodeName||xr)}catch{}dr=!0,hr.codeName=utf8write(escapexml(xr))}if(ar&&ar["!outline"]){var mr={summaryBelow:1,summaryRight:1};ar["!outline"].above&&(mr.summaryBelow=0),ar["!outline"].left&&(mr.summaryRight=0),pr=(pr||"")+writextag("outlinePr",null,mr)}!dr&&!pr||(ur[ur.length]=writextag("sheetPr",pr,hr))}var sheetprot_deffalse=["objects","scenarios","selectLockedCells","selectUnlockedCells"],sheetprot_deftrue=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function write_ws_xml_protection(ar){var or={sheet:1};return sheetprot_deffalse.forEach(function(lr){ar[lr]!=null&&ar[lr]&&(or[lr]="1")}),sheetprot_deftrue.forEach(function(lr){ar[lr]!=null&&!ar[lr]&&(or[lr]="0")}),ar.password&&(or.password=crypto_CreatePasswordVerifier_Method1(ar.password).toString(16).toUpperCase()),writextag("sheetProtection",null,or)}function write_ws_xml_margins(ar){return default_margins(ar),writextag("pageMargins",null,ar)}function write_ws_xml_cols(ar,or){for(var lr=["<cols>"],cr,ur=0;ur!=or.length;++ur)(cr=or[ur])&&(lr[lr.length]=writextag("col",null,col_obj_w(ur,cr)));return lr[lr.length]="</cols>",lr.join("")}function write_ws_xml_autofilter(ar,or,lr,cr){var ur=typeof ar.ref=="string"?ar.ref:encode_range(ar.ref);lr.Workbook||(lr.Workbook={Sheets:[]}),lr.Workbook.Names||(lr.Workbook.Names=[]);var dr=lr.Workbook.Names,hr=decode_range(ur);hr.s.r==hr.e.r&&(hr.e.r=decode_range(or["!ref"]).e.r,ur=encode_range(hr));for(var pr=0;pr<dr.length;++pr){var xr=dr[pr];if(xr.Name=="_xlnm._FilterDatabase"&&xr.Sheet==cr){xr.Ref="'"+lr.SheetNames[cr]+"'!"+ur;break}}return pr==dr.length&&dr.push({Name:"_xlnm._FilterDatabase",Sheet:cr,Ref:"'"+lr.SheetNames[cr]+"'!"+ur}),writextag("autoFilter",null,{ref:ur})}function write_ws_xml_sheetviews(ar,or,lr,cr){var ur={workbookViewId:"0"};return(((cr||{}).Workbook||{}).Views||[])[0]&&(ur.rightToLeft=cr.Workbook.Views[0].RTL?"1":"0"),writextag("sheetViews",writextag("sheetView",null,ur),{})}function write_ws_xml_cell(ar,or,lr,cr){if(ar.c&&lr["!comments"].push([or,ar.c]),ar.v===void 0&&typeof ar.f!="string"||ar.t==="z"&&!ar.f)return"";var ur="",dr=ar.t,hr=ar.v;if(ar.t!=="z")switch(ar.t){case"b":ur=ar.v?"1":"0";break;case"n":ur=""+ar.v;break;case"e":ur=BErr[ar.v];break;case"d":cr&&cr.cellDates?ur=parseDate(ar.v,-1).toISOString():(ar=dup(ar),ar.t="n",ur=""+(ar.v=datenum(parseDate(ar.v)))),typeof ar.z>"u"&&(ar.z=table_fmt[14]);break;default:ur=ar.v;break}var pr=writetag("v",escapexml(ur)),xr={r:or},mr=get_cell_style(cr.cellXfs,ar,cr);switch(mr!==0&&(xr.s=mr),ar.t){case"n":break;case"d":xr.t="d";break;case"b":xr.t="b";break;case"e":xr.t="e";break;case"z":break;default:if(ar.v==null){delete ar.t;break}if(ar.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(cr&&cr.bookSST){pr=writetag("v",""+get_sst_id(cr.Strings,ar.v,cr.revStrings)),xr.t="s";break}xr.t="str";break}if(ar.t!=dr&&(ar.t=dr,ar.v=hr),typeof ar.f=="string"&&ar.f){var fr=ar.F&&ar.F.slice(0,or.length)==or?{t:"array",ref:ar.F}:null;pr=writextag("f",escapexml(ar.f),fr)+(ar.v!=null?pr:"")}return ar.l&&lr["!links"].push([or,ar.l]),ar.D&&(xr.cm=1),writextag("c",pr,xr)}function write_ws_xml_data(ar,or,lr,cr){var ur=[],dr=[],hr=safe_decode_range(ar["!ref"]),pr="",xr,mr="",fr=[],Er=0,vr=0,gr=ar["!rows"],yr=Array.isArray(ar),jr={r:mr},br,_r=-1;for(vr=hr.s.c;vr<=hr.e.c;++vr)fr[vr]=encode_col(vr);for(Er=hr.s.r;Er<=hr.e.r;++Er){for(dr=[],mr=encode_row(Er),vr=hr.s.c;vr<=hr.e.c;++vr){xr=fr[vr]+mr;var wr=yr?(ar[Er]||[])[vr]:ar[xr];wr!==void 0&&(pr=write_ws_xml_cell(wr,xr,ar,or))!=null&&dr.push(pr)}(dr.length>0||gr&&gr[Er])&&(jr={r:mr},gr&&gr[Er]&&(br=gr[Er],br.hidden&&(jr.hidden=1),_r=-1,br.hpx?_r=px2pt(br.hpx):br.hpt&&(_r=br.hpt),_r>-1&&(jr.ht=_r,jr.customHeight=1),br.level&&(jr.outlineLevel=br.level)),ur[ur.length]=writextag("row",dr.join(""),jr))}if(gr)for(;Er<gr.length;++Er)gr&&gr[Er]&&(jr={r:Er+1},br=gr[Er],br.hidden&&(jr.hidden=1),_r=-1,br.hpx?_r=px2pt(br.hpx):br.hpt&&(_r=br.hpt),_r>-1&&(jr.ht=_r,jr.customHeight=1),br.level&&(jr.outlineLevel=br.level),ur[ur.length]=writextag("row","",jr));return ur.join("")}function write_ws_xml(ar,or,lr,cr){var ur=[XML_HEADER,writextag("worksheet",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r})],dr=lr.SheetNames[ar],hr=0,pr="",xr=lr.Sheets[dr];xr==null&&(xr={});var mr=xr["!ref"]||"A1",fr=safe_decode_range(mr);if(fr.e.c>16383||fr.e.r>1048575){if(or.WTF)throw new Error("Range "+mr+" exceeds format limit A1:XFD1048576");fr.e.c=Math.min(fr.e.c,16383),fr.e.r=Math.min(fr.e.c,1048575),mr=encode_range(fr)}cr||(cr={}),xr["!comments"]=[];var Er=[];write_ws_xml_sheetpr(xr,lr,ar,or,ur),ur[ur.length]=writextag("dimension",null,{ref:mr}),ur[ur.length]=write_ws_xml_sheetviews(xr,or,ar,lr),or.sheetFormat&&(ur[ur.length]=writextag("sheetFormatPr",null,{defaultRowHeight:or.sheetFormat.defaultRowHeight||"16",baseColWidth:or.sheetFormat.baseColWidth||"10",outlineLevelRow:or.sheetFormat.outlineLevelRow||"7"})),xr["!cols"]!=null&&xr["!cols"].length>0&&(ur[ur.length]=write_ws_xml_cols(xr,xr["!cols"])),ur[hr=ur.length]="<sheetData/>",xr["!links"]=[],xr["!ref"]!=null&&(pr=write_ws_xml_data(xr,or),pr.length>0&&(ur[ur.length]=pr)),ur.length>hr+1&&(ur[ur.length]="</sheetData>",ur[hr]=ur[hr].replace("/>",">")),xr["!protect"]&&(ur[ur.length]=write_ws_xml_protection(xr["!protect"])),xr["!autofilter"]!=null&&(ur[ur.length]=write_ws_xml_autofilter(xr["!autofilter"],xr,lr,ar)),xr["!merges"]!=null&&xr["!merges"].length>0&&(ur[ur.length]=write_ws_xml_merges(xr["!merges"]));var vr=-1,gr,yr=-1;return xr["!links"].length>0&&(ur[ur.length]="<hyperlinks>",xr["!links"].forEach(function(jr){jr[1].Target&&(gr={ref:jr[0]},jr[1].Target.charAt(0)!="#"&&(yr=add_rels(cr,-1,escapexml(jr[1].Target).replace(/#.*$/,""),RELS.HLINK),gr["r:id"]="rId"+yr),(vr=jr[1].Target.indexOf("#"))>-1&&(gr.location=escapexml(jr[1].Target.slice(vr+1))),jr[1].Tooltip&&(gr.tooltip=escapexml(jr[1].Tooltip)),ur[ur.length]=writextag("hyperlink",null,gr))}),ur[ur.length]="</hyperlinks>"),delete xr["!links"],xr["!margins"]!=null&&(ur[ur.length]=write_ws_xml_margins(xr["!margins"])),(!or||or.ignoreEC||or.ignoreEC==null)&&(ur[ur.length]=writetag("ignoredErrors",writextag("ignoredError",null,{numberStoredAsText:1,sqref:mr}))),Er.length>0&&(yr=add_rels(cr,-1,"../drawings/drawing"+(ar+1)+".xml",RELS.DRAW),ur[ur.length]=writextag("drawing",null,{"r:id":"rId"+yr}),xr["!drawing"]=Er),xr["!comments"].length>0&&(yr=add_rels(cr,-1,"../drawings/vmlDrawing"+(ar+1)+".vml",RELS.VML),ur[ur.length]=writextag("legacyDrawing",null,{"r:id":"rId"+yr}),xr["!legacy"]=yr),ur.length>1&&(ur[ur.length]="</worksheet>",ur[1]=ur[1].replace("/>",">")),ur.join("")}function parse_BrtRowHdr(ar,or){var lr={},cr=ar.l+or;lr.r=ar.read_shift(4),ar.l+=4;var ur=ar.read_shift(2);ar.l+=1;var dr=ar.read_shift(1);return ar.l=cr,dr&7&&(lr.level=dr&7),dr&16&&(lr.hidden=!0),dr&32&&(lr.hpt=ur/20),lr}function write_BrtRowHdr(ar,or,lr){var cr=new_buf(145),ur=(lr["!rows"]||[])[ar]||{};cr.write_shift(4,ar),cr.write_shift(4,0);var dr=320;ur.hpx?dr=px2pt(ur.hpx)*20:ur.hpt&&(dr=ur.hpt*20),cr.write_shift(2,dr),cr.write_shift(1,0);var hr=0;ur.level&&(hr|=ur.level),ur.hidden&&(hr|=16),(ur.hpx||ur.hpt)&&(hr|=32),cr.write_shift(1,hr),cr.write_shift(1,0);var pr=0,xr=cr.l;cr.l+=4;for(var mr={r:ar,c:0},fr=0;fr<16;++fr)if(!(or.s.c>fr+1<<10||or.e.c<fr<<10)){for(var Er=-1,vr=-1,gr=fr<<10;gr<fr+1<<10;++gr){mr.c=gr;var yr=Array.isArray(lr)?(lr[mr.r]||[])[mr.c]:lr[encode_cell(mr)];yr&&(Er<0&&(Er=gr),vr=gr)}Er<0||(++pr,cr.write_shift(4,Er),cr.write_shift(4,vr))}var jr=cr.l;return cr.l=xr,cr.write_shift(4,pr),cr.l=jr,cr.length>cr.l?cr.slice(0,cr.l):cr}function write_row_header(ar,or,lr,cr){var ur=write_BrtRowHdr(cr,lr,or);(ur.length>17||(or["!rows"]||[])[cr])&&write_record(ar,0,ur)}var parse_BrtWsDim=parse_UncheckedRfX,write_BrtWsDim=write_UncheckedRfX;function parse_BrtWsFmtInfo(){}function parse_BrtWsProp(ar,or){var lr={},cr=ar[ar.l];return++ar.l,lr.above=!(cr&64),lr.left=!(cr&128),ar.l+=18,lr.name=parse_XLSBCodeName(ar),lr}function write_BrtWsProp(ar,or,lr){lr==null&&(lr=new_buf(84+4*ar.length));var cr=192;or&&(or.above&&(cr&=-65),or.left&&(cr&=-129)),lr.write_shift(1,cr);for(var ur=1;ur<3;++ur)lr.write_shift(1,0);return write_BrtColor({auto:1},lr),lr.write_shift(-4,-1),lr.write_shift(-4,-1),write_XLSBCodeName(ar,lr),lr.slice(0,lr.l)}function parse_BrtCellBlank(ar){var or=parse_XLSBCell(ar);return[or]}function write_BrtCellBlank(ar,or,lr){return lr==null&&(lr=new_buf(8)),write_XLSBCell(or,lr)}function parse_BrtShortBlank(ar){var or=parse_XLSBShortCell(ar);return[or]}function write_BrtShortBlank(ar,or,lr){return lr==null&&(lr=new_buf(4)),write_XLSBShortCell(or,lr)}function parse_BrtCellBool(ar){var or=parse_XLSBCell(ar),lr=ar.read_shift(1);return[or,lr,"b"]}function write_BrtCellBool(ar,or,lr){return lr==null&&(lr=new_buf(9)),write_XLSBCell(or,lr),lr.write_shift(1,ar.v?1:0),lr}function parse_BrtShortBool(ar){var or=parse_XLSBShortCell(ar),lr=ar.read_shift(1);return[or,lr,"b"]}function write_BrtShortBool(ar,or,lr){return lr==null&&(lr=new_buf(5)),write_XLSBShortCell(or,lr),lr.write_shift(1,ar.v?1:0),lr}function parse_BrtCellError(ar){var or=parse_XLSBCell(ar),lr=ar.read_shift(1);return[or,lr,"e"]}function write_BrtCellError(ar,or,lr){return lr==null&&(lr=new_buf(9)),write_XLSBCell(or,lr),lr.write_shift(1,ar.v),lr}function parse_BrtShortError(ar){var or=parse_XLSBShortCell(ar),lr=ar.read_shift(1);return[or,lr,"e"]}function write_BrtShortError(ar,or,lr){return lr==null&&(lr=new_buf(8)),write_XLSBShortCell(or,lr),lr.write_shift(1,ar.v),lr.write_shift(2,0),lr.write_shift(1,0),lr}function parse_BrtCellIsst(ar){var or=parse_XLSBCell(ar),lr=ar.read_shift(4);return[or,lr,"s"]}function write_BrtCellIsst(ar,or,lr){return lr==null&&(lr=new_buf(12)),write_XLSBCell(or,lr),lr.write_shift(4,or.v),lr}function parse_BrtShortIsst(ar){var or=parse_XLSBShortCell(ar),lr=ar.read_shift(4);return[or,lr,"s"]}function write_BrtShortIsst(ar,or,lr){return lr==null&&(lr=new_buf(8)),write_XLSBShortCell(or,lr),lr.write_shift(4,or.v),lr}function parse_BrtCellReal(ar){var or=parse_XLSBCell(ar),lr=parse_Xnum(ar);return[or,lr,"n"]}function write_BrtCellReal(ar,or,lr){return lr==null&&(lr=new_buf(16)),write_XLSBCell(or,lr),write_Xnum(ar.v,lr),lr}function parse_BrtShortReal(ar){var or=parse_XLSBShortCell(ar),lr=parse_Xnum(ar);return[or,lr,"n"]}function write_BrtShortReal(ar,or,lr){return lr==null&&(lr=new_buf(12)),write_XLSBShortCell(or,lr),write_Xnum(ar.v,lr),lr}function parse_BrtCellRk(ar){var or=parse_XLSBCell(ar),lr=parse_RkNumber(ar);return[or,lr,"n"]}function write_BrtCellRk(ar,or,lr){return lr==null&&(lr=new_buf(12)),write_XLSBCell(or,lr),write_RkNumber(ar.v,lr),lr}function parse_BrtShortRk(ar){var or=parse_XLSBShortCell(ar),lr=parse_RkNumber(ar);return[or,lr,"n"]}function write_BrtShortRk(ar,or,lr){return lr==null&&(lr=new_buf(8)),write_XLSBShortCell(or,lr),write_RkNumber(ar.v,lr),lr}function parse_BrtCellRString(ar){var or=parse_XLSBCell(ar),lr=parse_RichStr(ar);return[or,lr,"is"]}function parse_BrtCellSt(ar){var or=parse_XLSBCell(ar),lr=parse_XLWideString(ar);return[or,lr,"str"]}function write_BrtCellSt(ar,or,lr){return lr==null&&(lr=new_buf(12+4*ar.v.length)),write_XLSBCell(or,lr),write_XLWideString(ar.v,lr),lr.length>lr.l?lr.slice(0,lr.l):lr}function parse_BrtShortSt(ar){var or=parse_XLSBShortCell(ar),lr=parse_XLWideString(ar);return[or,lr,"str"]}function write_BrtShortSt(ar,or,lr){return lr==null&&(lr=new_buf(8+4*ar.v.length)),write_XLSBShortCell(or,lr),write_XLWideString(ar.v,lr),lr.length>lr.l?lr.slice(0,lr.l):lr}function parse_BrtFmlaBool(ar,or,lr){var cr=ar.l+or,ur=parse_XLSBCell(ar);ur.r=lr["!row"];var dr=ar.read_shift(1),hr=[ur,dr,"b"];if(lr.cellFormula){ar.l+=2;var pr=parse_XLSBCellParsedFormula(ar,cr-ar.l,lr);hr[3]=stringify_formula(pr,null,ur,lr.supbooks,lr)}else ar.l=cr;return hr}function parse_BrtFmlaError(ar,or,lr){var cr=ar.l+or,ur=parse_XLSBCell(ar);ur.r=lr["!row"];var dr=ar.read_shift(1),hr=[ur,dr,"e"];if(lr.cellFormula){ar.l+=2;var pr=parse_XLSBCellParsedFormula(ar,cr-ar.l,lr);hr[3]=stringify_formula(pr,null,ur,lr.supbooks,lr)}else ar.l=cr;return hr}function parse_BrtFmlaNum(ar,or,lr){var cr=ar.l+or,ur=parse_XLSBCell(ar);ur.r=lr["!row"];var dr=parse_Xnum(ar),hr=[ur,dr,"n"];if(lr.cellFormula){ar.l+=2;var pr=parse_XLSBCellParsedFormula(ar,cr-ar.l,lr);hr[3]=stringify_formula(pr,null,ur,lr.supbooks,lr)}else ar.l=cr;return hr}function parse_BrtFmlaString(ar,or,lr){var cr=ar.l+or,ur=parse_XLSBCell(ar);ur.r=lr["!row"];var dr=parse_XLWideString(ar),hr=[ur,dr,"str"];if(lr.cellFormula){ar.l+=2;var pr=parse_XLSBCellParsedFormula(ar,cr-ar.l,lr);hr[3]=stringify_formula(pr,null,ur,lr.supbooks,lr)}else ar.l=cr;return hr}var parse_BrtMergeCell=parse_UncheckedRfX,write_BrtMergeCell=write_UncheckedRfX;function write_BrtBeginMergeCells(ar,or){return or==null&&(or=new_buf(4)),or.write_shift(4,ar),or}function parse_BrtHLink(ar,or){var lr=ar.l+or,cr=parse_UncheckedRfX(ar),ur=parse_XLNullableWideString(ar),dr=parse_XLWideString(ar),hr=parse_XLWideString(ar),pr=parse_XLWideString(ar);ar.l=lr;var xr={rfx:cr,relId:ur,loc:dr,display:pr};return hr&&(xr.Tooltip=hr),xr}function write_BrtHLink(ar,or){var lr=new_buf(50+4*(ar[1].Target.length+(ar[1].Tooltip||"").length));write_UncheckedRfX({s:decode_cell(ar[0]),e:decode_cell(ar[0])},lr),write_RelID("rId"+or,lr);var cr=ar[1].Target.indexOf("#"),ur=cr==-1?"":ar[1].Target.slice(cr+1);return write_XLWideString(ur||"",lr),write_XLWideString(ar[1].Tooltip||"",lr),write_XLWideString("",lr),lr.slice(0,lr.l)}function parse_BrtPane(){}function parse_BrtArrFmla(ar,or,lr){var cr=ar.l+or,ur=parse_RfX(ar),dr=ar.read_shift(1),hr=[ur];if(hr[2]=dr,lr.cellFormula){var pr=parse_XLSBArrayParsedFormula(ar,cr-ar.l,lr);hr[1]=pr}else ar.l=cr;return hr}function parse_BrtShrFmla(ar,or,lr){var cr=ar.l+or,ur=parse_UncheckedRfX(ar),dr=[ur];if(lr.cellFormula){var hr=parse_XLSBSharedParsedFormula(ar,cr-ar.l,lr);dr[1]=hr,ar.l=cr}else ar.l=cr;return dr}function write_BrtColInfo(ar,or,lr){lr==null&&(lr=new_buf(18));var cr=col_obj_w(ar,or);lr.write_shift(-4,ar),lr.write_shift(-4,ar),lr.write_shift(4,(cr.width||10)*256),lr.write_shift(4,0);var ur=0;return or.hidden&&(ur|=1),typeof cr.width=="number"&&(ur|=2),or.level&&(ur|=or.level<<8),lr.write_shift(2,ur),lr}var BrtMarginKeys=["left","right","top","bottom","header","footer"];function parse_BrtMargins(ar){var or={};return BrtMarginKeys.forEach(function(lr){or[lr]=parse_Xnum(ar)}),or}function write_BrtMargins(ar,or){return or==null&&(or=new_buf(6*8)),default_margins(ar),BrtMarginKeys.forEach(function(lr){write_Xnum(ar[lr],or)}),or}function parse_BrtBeginWsView(ar){var or=ar.read_shift(2);return ar.l+=28,{RTL:or&32}}function write_BrtBeginWsView(ar,or,lr){lr==null&&(lr=new_buf(30));var cr=924;return(((or||{}).Views||[])[0]||{}).RTL&&(cr|=32),lr.write_shift(2,cr),lr.write_shift(4,0),lr.write_shift(4,0),lr.write_shift(4,0),lr.write_shift(1,0),lr.write_shift(1,0),lr.write_shift(2,0),lr.write_shift(2,100),lr.write_shift(2,0),lr.write_shift(2,0),lr.write_shift(2,0),lr.write_shift(4,0),lr}function write_BrtCellIgnoreEC(ar){var or=new_buf(24);return or.write_shift(4,4),or.write_shift(4,1),write_UncheckedRfX(ar,or),or}function write_BrtSheetProtection(ar,or){return or==null&&(or=new_buf(16*4+2)),or.write_shift(2,ar.password?crypto_CreatePasswordVerifier_Method1(ar.password):0),or.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(lr){lr[1]?or.write_shift(4,ar[lr[0]]!=null&&!ar[lr[0]]?1:0):or.write_shift(4,ar[lr[0]]!=null&&ar[lr[0]]?0:1)}),or}function parse_BrtDVal(){}function parse_BrtDVal14(){}function write_ws_bin_cell(ar,or,lr,cr,ur,dr,hr){if(or.v===void 0)return!1;var pr="";switch(or.t){case"b":pr=or.v?"1":"0";break;case"d":or=dup(or),or.z=or.z||table_fmt[14],or.v=datenum(parseDate(or.v)),or.t="n";break;case"n":case"e":pr=""+or.v;break;default:pr=or.v;break}var xr={r:lr,c:cr};switch(xr.s=get_cell_style(ur.cellXfs,or,ur),or.l&&dr["!links"].push([encode_cell(xr),or.l]),or.c&&dr["!comments"].push([encode_cell(xr),or.c]),or.t){case"s":case"str":return ur.bookSST?(pr=get_sst_id(ur.Strings,or.v,ur.revStrings),xr.t="s",xr.v=pr,hr?write_record(ar,18,write_BrtShortIsst(or,xr)):write_record(ar,7,write_BrtCellIsst(or,xr))):(xr.t="str",hr?write_record(ar,17,write_BrtShortSt(or,xr)):write_record(ar,6,write_BrtCellSt(or,xr))),!0;case"n":return or.v==(or.v|0)&&or.v>-1e3&&or.v<1e3?hr?write_record(ar,13,write_BrtShortRk(or,xr)):write_record(ar,2,write_BrtCellRk(or,xr)):hr?write_record(ar,16,write_BrtShortReal(or,xr)):write_record(ar,5,write_BrtCellReal(or,xr)),!0;case"b":return xr.t="b",hr?write_record(ar,15,write_BrtShortBool(or,xr)):write_record(ar,4,write_BrtCellBool(or,xr)),!0;case"e":return xr.t="e",hr?write_record(ar,14,write_BrtShortError(or,xr)):write_record(ar,3,write_BrtCellError(or,xr)),!0}return hr?write_record(ar,12,write_BrtShortBlank(or,xr)):write_record(ar,1,write_BrtCellBlank(or,xr)),!0}function write_CELLTABLE(ar,or,lr,cr){var ur=safe_decode_range(or["!ref"]||"A1"),dr,hr="",pr=[];write_record(ar,145);var xr=Array.isArray(or),mr=ur.e.r;or["!rows"]&&(mr=Math.max(ur.e.r,or["!rows"].length-1));for(var fr=ur.s.r;fr<=mr;++fr){hr=encode_row(fr),write_row_header(ar,or,ur,fr);var Er=!1;if(fr<=ur.e.r)for(var vr=ur.s.c;vr<=ur.e.c;++vr){fr===ur.s.r&&(pr[vr]=encode_col(vr)),dr=pr[vr]+hr;var gr=xr?(or[fr]||[])[vr]:or[dr];if(!gr){Er=!1;continue}Er=write_ws_bin_cell(ar,gr,fr,vr,cr,or,Er)}}write_record(ar,146)}function write_MERGECELLS(ar,or){!or||!or["!merges"]||(write_record(ar,177,write_BrtBeginMergeCells(or["!merges"].length)),or["!merges"].forEach(function(lr){write_record(ar,176,write_BrtMergeCell(lr))}),write_record(ar,178))}function write_COLINFOS(ar,or){!or||!or["!cols"]||(write_record(ar,390),or["!cols"].forEach(function(lr,cr){lr&&write_record(ar,60,write_BrtColInfo(cr,lr))}),write_record(ar,391))}function write_IGNOREECS(ar,or){!or||!or["!ref"]||(write_record(ar,648),write_record(ar,649,write_BrtCellIgnoreEC(safe_decode_range(or["!ref"]))),write_record(ar,650))}function write_HLINKS(ar,or,lr){or["!links"].forEach(function(cr){if(cr[1].Target){var ur=add_rels(lr,-1,cr[1].Target.replace(/#.*$/,""),RELS.HLINK);write_record(ar,494,write_BrtHLink(cr,ur))}}),delete or["!links"]}function write_LEGACYDRAWING(ar,or,lr,cr){if(or["!comments"].length>0){var ur=add_rels(cr,-1,"../drawings/vmlDrawing"+(lr+1)+".vml",RELS.VML);write_record(ar,551,write_RelID("rId"+ur)),or["!legacy"]=ur}}function write_AUTOFILTER(ar,or,lr,cr){if(or["!autofilter"]){var ur=or["!autofilter"],dr=typeof ur.ref=="string"?ur.ref:encode_range(ur.ref);lr.Workbook||(lr.Workbook={Sheets:[]}),lr.Workbook.Names||(lr.Workbook.Names=[]);var hr=lr.Workbook.Names,pr=decode_range(dr);pr.s.r==pr.e.r&&(pr.e.r=decode_range(or["!ref"]).e.r,dr=encode_range(pr));for(var xr=0;xr<hr.length;++xr){var mr=hr[xr];if(mr.Name=="_xlnm._FilterDatabase"&&mr.Sheet==cr){mr.Ref="'"+lr.SheetNames[cr]+"'!"+dr;break}}xr==hr.length&&hr.push({Name:"_xlnm._FilterDatabase",Sheet:cr,Ref:"'"+lr.SheetNames[cr]+"'!"+dr}),write_record(ar,161,write_UncheckedRfX(safe_decode_range(dr))),write_record(ar,162)}}function write_WSVIEWS2(ar,or,lr){write_record(ar,133),write_record(ar,137,write_BrtBeginWsView(or,lr)),write_record(ar,138),write_record(ar,134)}function write_SHEETPROTECT(ar,or){or["!protect"]&&write_record(ar,535,write_BrtSheetProtection(or["!protect"]))}function write_ws_bin(ar,or,lr,cr){var ur=buf_array(),dr=lr.SheetNames[ar],hr=lr.Sheets[dr]||{},pr=dr;try{lr&&lr.Workbook&&(pr=lr.Workbook.Sheets[ar].CodeName||pr)}catch{}var xr=safe_decode_range(hr["!ref"]||"A1");if(xr.e.c>16383||xr.e.r>1048575){if(or.WTF)throw new Error("Range "+(hr["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");xr.e.c=Math.min(xr.e.c,16383),xr.e.r=Math.min(xr.e.c,1048575)}return hr["!links"]=[],hr["!comments"]=[],write_record(ur,129),(lr.vbaraw||hr["!outline"])&&write_record(ur,147,write_BrtWsProp(pr,hr["!outline"])),write_record(ur,148,write_BrtWsDim(xr)),write_WSVIEWS2(ur,hr,lr.Workbook),write_COLINFOS(ur,hr),write_CELLTABLE(ur,hr,ar,or),write_SHEETPROTECT(ur,hr),write_AUTOFILTER(ur,hr,lr,ar),write_MERGECELLS(ur,hr),write_HLINKS(ur,hr,cr),hr["!margins"]&&write_record(ur,476,write_BrtMargins(hr["!margins"])),(!or||or.ignoreEC||or.ignoreEC==null)&&write_IGNOREECS(ur,hr),write_LEGACYDRAWING(ur,hr,ar,cr),write_record(ur,130),ur.end()}function parse_BrtCsProp(ar,or){ar.l+=10;var lr=parse_XLWideString(ar);return{name:lr}}var WBPropsDef=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function safe1904(ar){return!ar.Workbook||!ar.Workbook.WBProps?"false":parsexmlbool(ar.Workbook.WBProps.date1904)?"true":"false"}var badchars="][*?/\\".split("");function check_ws_name(ar,or){if(ar.length>31)throw new Error("Sheet names cannot exceed 31 chars");var lr=!0;return badchars.forEach(function(cr){if(ar.indexOf(cr)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),lr}function check_wb_names(ar,or,lr){ar.forEach(function(cr,ur){check_ws_name(cr);for(var dr=0;dr<ur;++dr)if(cr==ar[dr])throw new Error("Duplicate Sheet Name: "+cr);if(lr){var hr=or&&or[ur]&&or[ur].CodeName||cr;if(hr.charCodeAt(0)==95&&hr.length>22)throw new Error("Bad Code Name: Worksheet"+hr)}})}function check_wb(ar){if(!ar||!ar.SheetNames||!ar.Sheets)throw new Error("Invalid Workbook");if(!ar.SheetNames.length)throw new Error("Workbook is empty");var or=ar.Workbook&&ar.Workbook.Sheets||[];check_wb_names(ar.SheetNames,or,!!ar.vbaraw);for(var lr=0;lr<ar.SheetNames.length;++lr)check_ws(ar.Sheets[ar.SheetNames[lr]],ar.SheetNames[lr],lr)}function write_wb_xml(ar){var or=[XML_HEADER];or[or.length]=writextag("workbook",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r});var lr=ar.Workbook&&(ar.Workbook.Names||[]).length>0,cr={codeName:"ThisWorkbook"};ar.Workbook&&ar.Workbook.WBProps&&(WBPropsDef.forEach(function(pr){ar.Workbook.WBProps[pr[0]]!=null&&ar.Workbook.WBProps[pr[0]]!=pr[1]&&(cr[pr[0]]=ar.Workbook.WBProps[pr[0]])}),ar.Workbook.WBProps.CodeName&&(cr.codeName=ar.Workbook.WBProps.CodeName,delete cr.CodeName)),or[or.length]=writextag("workbookPr",null,cr);var ur=ar.Workbook&&ar.Workbook.Sheets||[],dr=0;if(ur&&ur[0]&&ur[0].Hidden){for(or[or.length]="<bookViews>",dr=0;dr!=ar.SheetNames.length&&!(!ur[dr]||!ur[dr].Hidden);++dr);dr==ar.SheetNames.length&&(dr=0),or[or.length]='<workbookView firstSheet="'+dr+'" activeTab="'+dr+'"/>',or[or.length]="</bookViews>"}for(or[or.length]="<sheets>",dr=0;dr!=ar.SheetNames.length;++dr){var hr={name:escapexml(ar.SheetNames[dr].slice(0,31))};if(hr.sheetId=""+(dr+1),hr["r:id"]="rId"+(dr+1),ur[dr])switch(ur[dr].Hidden){case 1:hr.state="hidden";break;case 2:hr.state="veryHidden";break}or[or.length]=writextag("sheet",null,hr)}return or[or.length]="</sheets>",lr&&(or[or.length]="<definedNames>",ar.Workbook&&ar.Workbook.Names&&ar.Workbook.Names.forEach(function(pr){var xr={name:pr.Name};pr.Comment&&(xr.comment=pr.Comment),pr.Sheet!=null&&(xr.localSheetId=""+pr.Sheet),pr.Hidden&&(xr.hidden="1"),pr.Ref&&(or[or.length]=writextag("definedName",escapexml(pr.Ref),xr))}),or[or.length]="</definedNames>"),or.length>2&&(or[or.length]="</workbook>",or[1]=or[1].replace("/>",">")),or.join("")}function parse_BrtBundleSh(ar,or){var lr={};return lr.Hidden=ar.read_shift(4),lr.iTabID=ar.read_shift(4),lr.strRelID=parse_RelID(ar),lr.name=parse_XLWideString(ar),lr}function write_BrtBundleSh(ar,or){return or||(or=new_buf(127)),or.write_shift(4,ar.Hidden),or.write_shift(4,ar.iTabID),write_RelID(ar.strRelID,or),write_XLWideString(ar.name.slice(0,31),or),or.length>or.l?or.slice(0,or.l):or}function parse_BrtWbProp(ar,or){var lr={},cr=ar.read_shift(4);lr.defaultThemeVersion=ar.read_shift(4);var ur=or>8?parse_XLWideString(ar):"";return ur.length>0&&(lr.CodeName=ur),lr.autoCompressPictures=!!(cr&65536),lr.backupFile=!!(cr&64),lr.checkCompatibility=!!(cr&4096),lr.date1904=!!(cr&1),lr.filterPrivacy=!!(cr&8),lr.hidePivotFieldList=!!(cr&1024),lr.promptedSolutions=!!(cr&16),lr.publishItems=!!(cr&2048),lr.refreshAllConnections=!!(cr&262144),lr.saveExternalLinkValues=!!(cr&128),lr.showBorderUnselectedTables=!!(cr&4),lr.showInkAnnotation=!!(cr&32),lr.showObjects=["all","placeholders","none"][cr>>13&3],lr.showPivotChartFilter=!!(cr&32768),lr.updateLinks=["userSet","never","always"][cr>>8&3],lr}function write_BrtWbProp(ar,or){or||(or=new_buf(72));var lr=0;return ar&&ar.filterPrivacy&&(lr|=8),or.write_shift(4,lr),or.write_shift(4,0),write_XLSBCodeName(ar&&ar.CodeName||"ThisWorkbook",or),or.slice(0,or.l)}function parse_BrtName(ar,or,lr){var cr=ar.l+or;ar.l+=4,ar.l+=1;var ur=ar.read_shift(4),dr=parse_XLNameWideString(ar),hr=parse_XLSBNameParsedFormula(ar,0,lr),pr=parse_XLNullableWideString(ar);ar.l=cr;var xr={Name:dr,Ptg:hr};return ur<268435455&&(xr.Sheet=ur),pr&&(xr.Comment=pr),xr}function write_BUNDLESHS(ar,or){write_record(ar,143);for(var lr=0;lr!=or.SheetNames.length;++lr){var cr=or.Workbook&&or.Workbook.Sheets&&or.Workbook.Sheets[lr]&&or.Workbook.Sheets[lr].Hidden||0,ur={Hidden:cr,iTabID:lr+1,strRelID:"rId"+(lr+1),name:or.SheetNames[lr]};write_record(ar,156,write_BrtBundleSh(ur))}write_record(ar,144)}function write_BrtFileVersion(ar,or){or||(or=new_buf(127));for(var lr=0;lr!=4;++lr)or.write_shift(4,0);return write_XLWideString("SheetJS",or),write_XLWideString(XLSX.version,or),write_XLWideString(XLSX.version,or),write_XLWideString("7262",or),or.length>or.l?or.slice(0,or.l):or}function write_BrtBookView(ar,or){or||(or=new_buf(29)),or.write_shift(-4,0),or.write_shift(-4,460),or.write_shift(4,28800),or.write_shift(4,17600),or.write_shift(4,500),or.write_shift(4,ar),or.write_shift(4,ar);var lr=120;return or.write_shift(1,lr),or.length>or.l?or.slice(0,or.l):or}function write_BOOKVIEWS(ar,or){if(!(!or.Workbook||!or.Workbook.Sheets)){for(var lr=or.Workbook.Sheets,cr=0,ur=-1,dr=-1;cr<lr.length;++cr)!lr[cr]||!lr[cr].Hidden&&ur==-1?ur=cr:lr[cr].Hidden==1&&dr==-1&&(dr=cr);dr>ur||(write_record(ar,135),write_record(ar,158,write_BrtBookView(ur)),write_record(ar,136))}}function write_wb_bin(ar,or){var lr=buf_array();return write_record(lr,131),write_record(lr,128,write_BrtFileVersion()),write_record(lr,153,write_BrtWbProp(ar.Workbook&&ar.Workbook.WBProps||null)),write_BOOKVIEWS(lr,ar),write_BUNDLESHS(lr,ar),write_record(lr,132),lr.end()}function write_wb(ar,or,lr){return(or.slice(-4)===".bin"?write_wb_bin:write_wb_xml)(ar)}function write_ws(ar,or,lr,cr,ur){return(or.slice(-4)===".bin"?write_ws_bin:write_ws_xml)(ar,lr,cr,ur)}function write_sty(ar,or,lr){return(or.slice(-4)===".bin"?write_sty_bin:write_sty_xml)(ar,lr)}function write_sst(ar,or,lr){return(or.slice(-4)===".bin"?write_sst_bin:write_sst_xml)(ar,lr)}function write_cmnt(ar,or,lr){return(or.slice(-4)===".bin"?write_comments_bin:write_comments_xml)(ar)}function write_xlmeta(ar){return(ar.slice(-4)===".bin"?write_xlmeta_bin:write_xlmeta_xml)()}function write_props_xlml(ar,or){var lr=[];return ar.Props&&lr.push(xlml_write_docprops(ar.Props,or)),ar.Custprops&&lr.push(xlml_write_custprops(ar.Props,ar.Custprops)),lr.join("")}function write_wb_xlml(){return""}function write_sty_xlml(ar,or){var lr=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return or.cellXfs.forEach(function(cr,ur){var dr=[];dr.push(writextag("NumberFormat",null,{"ss:Format":escapexml(table_fmt[cr.numFmtId])}));var hr={"ss:ID":"s"+(21+ur)};lr.push(writextag("Style",dr.join(""),hr))}),writextag("Styles",lr.join(""))}function write_name_xlml(ar){return writextag("NamedRange",null,{"ss:Name":ar.Name,"ss:RefersTo":"="+a1_to_rc(ar.Ref,{r:0,c:0})})}function write_names_xlml(ar){if(!((ar||{}).Workbook||{}).Names)return"";for(var or=ar.Workbook.Names,lr=[],cr=0;cr<or.length;++cr){var ur=or[cr];ur.Sheet==null&&(ur.Name.match(/^_xlfn\./)||lr.push(write_name_xlml(ur)))}return writextag("Names",lr.join(""))}function write_ws_xlml_names(ar,or,lr,cr){if(!ar||!((cr||{}).Workbook||{}).Names)return"";for(var ur=cr.Workbook.Names,dr=[],hr=0;hr<ur.length;++hr){var pr=ur[hr];pr.Sheet==lr&&(pr.Name.match(/^_xlfn\./)||dr.push(write_name_xlml(pr)))}return dr.join("")}function write_ws_xlml_wsopts(ar,or,lr,cr){if(!ar)return"";var ur=[];if(ar["!margins"]&&(ur.push("<PageSetup>"),ar["!margins"].header&&ur.push(writextag("Header",null,{"x:Margin":ar["!margins"].header})),ar["!margins"].footer&&ur.push(writextag("Footer",null,{"x:Margin":ar["!margins"].footer})),ur.push(writextag("PageMargins",null,{"x:Bottom":ar["!margins"].bottom||"0.75","x:Left":ar["!margins"].left||"0.7","x:Right":ar["!margins"].right||"0.7","x:Top":ar["!margins"].top||"0.75"})),ur.push("</PageSetup>")),cr&&cr.Workbook&&cr.Workbook.Sheets&&cr.Workbook.Sheets[lr])if(cr.Workbook.Sheets[lr].Hidden)ur.push(writextag("Visible",cr.Workbook.Sheets[lr].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var dr=0;dr<lr&&!(cr.Workbook.Sheets[dr]&&!cr.Workbook.Sheets[dr].Hidden);++dr);dr==lr&&ur.push("<Selected/>")}return((((cr||{}).Workbook||{}).Views||[])[0]||{}).RTL&&ur.push("<DisplayRightToLeft/>"),ar["!protect"]&&(ur.push(writetag("ProtectContents","True")),ar["!protect"].objects&&ur.push(writetag("ProtectObjects","True")),ar["!protect"].scenarios&&ur.push(writetag("ProtectScenarios","True")),ar["!protect"].selectLockedCells!=null&&!ar["!protect"].selectLockedCells?ur.push(writetag("EnableSelection","NoSelection")):ar["!protect"].selectUnlockedCells!=null&&!ar["!protect"].selectUnlockedCells&&ur.push(writetag("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(hr){ar["!protect"][hr[0]]&&ur.push("<"+hr[1]+"/>")})),ur.length==0?"":writextag("WorksheetOptions",ur.join(""),{xmlns:XLMLNS.x})}function write_ws_xlml_comment(ar){return ar.map(function(or){var lr=xlml_unfixstr(or.t||""),cr=writextag("ss:Data",lr,{xmlns:"http://www.w3.org/TR/REC-html40"});return writextag("Comment",cr,{"ss:Author":or.a})}).join("")}function write_ws_xlml_cell(ar,or,lr,cr,ur,dr,hr){if(!ar||ar.v==null&&ar.f==null)return"";var pr={};if(ar.f&&(pr["ss:Formula"]="="+escapexml(a1_to_rc(ar.f,hr))),ar.F&&ar.F.slice(0,or.length)==or){var xr=decode_cell(ar.F.slice(or.length+1));pr["ss:ArrayRange"]="RC:R"+(xr.r==hr.r?"":"["+(xr.r-hr.r)+"]")+"C"+(xr.c==hr.c?"":"["+(xr.c-hr.c)+"]")}if(ar.l&&ar.l.Target&&(pr["ss:HRef"]=escapexml(ar.l.Target),ar.l.Tooltip&&(pr["x:HRefScreenTip"]=escapexml(ar.l.Tooltip))),lr["!merges"])for(var mr=lr["!merges"],fr=0;fr!=mr.length;++fr)mr[fr].s.c!=hr.c||mr[fr].s.r!=hr.r||(mr[fr].e.c>mr[fr].s.c&&(pr["ss:MergeAcross"]=mr[fr].e.c-mr[fr].s.c),mr[fr].e.r>mr[fr].s.r&&(pr["ss:MergeDown"]=mr[fr].e.r-mr[fr].s.r));var Er="",vr="";switch(ar.t){case"z":if(!cr.sheetStubs)return"";break;case"n":Er="Number",vr=String(ar.v);break;case"b":Er="Boolean",vr=ar.v?"1":"0";break;case"e":Er="Error",vr=BErr[ar.v];break;case"d":Er="DateTime",vr=new Date(ar.v).toISOString(),ar.z==null&&(ar.z=ar.z||table_fmt[14]);break;case"s":Er="String",vr=escapexlml(ar.v||"");break}var gr=get_cell_style(cr.cellXfs,ar,cr);pr["ss:StyleID"]="s"+(21+gr),pr["ss:Index"]=hr.c+1;var yr=ar.v!=null?vr:"",jr=ar.t=="z"?"":'<Data ss:Type="'+Er+'">'+yr+"</Data>";return(ar.c||[]).length>0&&(jr+=write_ws_xlml_comment(ar.c)),writextag("Cell",jr,pr)}function write_ws_xlml_row(ar,or){var lr='<Row ss:Index="'+(ar+1)+'"';return or&&(or.hpt&&!or.hpx&&(or.hpx=pt2px(or.hpt)),or.hpx&&(lr+=' ss:AutoFitHeight="0" ss:Height="'+or.hpx+'"'),or.hidden&&(lr+=' ss:Hidden="1"')),lr+">"}function write_ws_xlml_table(ar,or,lr,cr){if(!ar["!ref"])return"";var ur=safe_decode_range(ar["!ref"]),dr=ar["!merges"]||[],hr=0,pr=[];ar["!cols"]&&ar["!cols"].forEach(function(br,_r){process_col(br);var wr=!!br.width,Rr=col_obj_w(_r,br),Ar={"ss:Index":_r+1};wr&&(Ar["ss:Width"]=width2px(Rr.width)),br.hidden&&(Ar["ss:Hidden"]="1"),pr.push(writextag("Column",null,Ar))});for(var xr=Array.isArray(ar),mr=ur.s.r;mr<=ur.e.r;++mr){for(var fr=[write_ws_xlml_row(mr,(ar["!rows"]||[])[mr])],Er=ur.s.c;Er<=ur.e.c;++Er){var vr=!1;for(hr=0;hr!=dr.length;++hr)if(!(dr[hr].s.c>Er)&&!(dr[hr].s.r>mr)&&!(dr[hr].e.c<Er)&&!(dr[hr].e.r<mr)){(dr[hr].s.c!=Er||dr[hr].s.r!=mr)&&(vr=!0);break}if(!vr){var gr={r:mr,c:Er},yr=encode_cell(gr),jr=xr?(ar[mr]||[])[Er]:ar[yr];fr.push(write_ws_xlml_cell(jr,yr,ar,or,lr,cr,gr))}}fr.push("</Row>"),fr.length>2&&pr.push(fr.join(""))}return pr.join("")}function write_ws_xlml(ar,or,lr){var cr=[],ur=lr.SheetNames[ar],dr=lr.Sheets[ur],hr=dr?write_ws_xlml_names(dr,or,ar,lr):"";return hr.length>0&&cr.push("<Names>"+hr+"</Names>"),hr=dr?write_ws_xlml_table(dr,or,ar,lr):"",hr.length>0&&cr.push("<Table>"+hr+"</Table>"),cr.push(write_ws_xlml_wsopts(dr,or,ar,lr)),cr.join("")}function write_xlml(ar,or){or||(or={}),ar.SSF||(ar.SSF=dup(table_fmt)),ar.SSF&&(make_ssf(),SSF_load_table(ar.SSF),or.revssf=evert_num(ar.SSF),or.revssf[ar.SSF[65535]]=0,or.ssf=ar.SSF,or.cellXfs=[],get_cell_style(or.cellXfs,{},{revssf:{General:0}}));var lr=[];lr.push(write_props_xlml(ar,or)),lr.push(write_wb_xlml()),lr.push(""),lr.push("");for(var cr=0;cr<ar.SheetNames.length;++cr)lr.push(writextag("Worksheet",write_ws_xlml(cr,or,ar),{"ss:Name":escapexml(ar.SheetNames[cr])}));return lr[2]=write_sty_xlml(ar,or),lr[3]=write_names_xlml(ar),XML_HEADER+writextag("Workbook",lr.join(""),{xmlns:XLMLNS.ss,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:ss":XLMLNS.ss,"xmlns:dt":XLMLNS.dt,"xmlns:html":XLMLNS.html})}var PSCLSID={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function write_xls_props(ar,or){var lr=[],cr=[],ur=[],dr=0,hr,pr=evert_key(DocSummaryPIDDSI,"n"),xr=evert_key(SummaryPIDSI,"n");if(ar.Props)for(hr=keys(ar.Props),dr=0;dr<hr.length;++dr)(Object.prototype.hasOwnProperty.call(pr,hr[dr])?lr:Object.prototype.hasOwnProperty.call(xr,hr[dr])?cr:ur).push([hr[dr],ar.Props[hr[dr]]]);if(ar.Custprops)for(hr=keys(ar.Custprops),dr=0;dr<hr.length;++dr)Object.prototype.hasOwnProperty.call(ar.Props||{},hr[dr])||(Object.prototype.hasOwnProperty.call(pr,hr[dr])?lr:Object.prototype.hasOwnProperty.call(xr,hr[dr])?cr:ur).push([hr[dr],ar.Custprops[hr[dr]]]);var mr=[];for(dr=0;dr<ur.length;++dr)XLSPSSkip.indexOf(ur[dr][0])>-1||PseudoPropsPairs.indexOf(ur[dr][0])>-1||ur[dr][1]!=null&&mr.push(ur[dr]);cr.length&&CFB.utils.cfb_add(or,"/SummaryInformation",write_PropertySetStream(cr,PSCLSID.SI,xr,SummaryPIDSI)),(lr.length||mr.length)&&CFB.utils.cfb_add(or,"/DocumentSummaryInformation",write_PropertySetStream(lr,PSCLSID.DSI,pr,DocSummaryPIDDSI,mr.length?mr:null,PSCLSID.UDI))}function write_xlscfb(ar,or){var lr=or||{},cr=CFB.utils.cfb_new({root:"R"}),ur="/Workbook";switch(lr.bookType||"xls"){case"xls":lr.bookType="biff8";case"xla":lr.bookType||(lr.bookType="xla");case"biff8":ur="/Workbook",lr.biff=8;break;case"biff5":ur="/Book",lr.biff=5;break;default:throw new Error("invalid type "+lr.bookType+" for XLS CFB")}return CFB.utils.cfb_add(cr,ur,write_biff_buf(ar,lr)),lr.biff==8&&(ar.Props||ar.Custprops)&&write_xls_props(ar,cr),lr.biff==8&&ar.vbaraw&&fill_vba_xls(cr,CFB.read(ar.vbaraw,{type:typeof ar.vbaraw=="string"?"binary":"buffer"})),cr}var XLSBRecordEnum={0:{f:parse_BrtRowHdr},1:{f:parse_BrtCellBlank},2:{f:parse_BrtCellRk},3:{f:parse_BrtCellError},4:{f:parse_BrtCellBool},5:{f:parse_BrtCellReal},6:{f:parse_BrtCellSt},7:{f:parse_BrtCellIsst},8:{f:parse_BrtFmlaString},9:{f:parse_BrtFmlaNum},10:{f:parse_BrtFmlaBool},11:{f:parse_BrtFmlaError},12:{f:parse_BrtShortBlank},13:{f:parse_BrtShortRk},14:{f:parse_BrtShortError},15:{f:parse_BrtShortBool},16:{f:parse_BrtShortReal},17:{f:parse_BrtShortSt},18:{f:parse_BrtShortIsst},19:{f:parse_RichStr},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:parse_BrtName},40:{},42:{},43:{f:parse_BrtFont},44:{f:parse_BrtFmt},45:{f:parse_BrtFill},46:{f:parse_BrtBorder},47:{f:parse_BrtXF},48:{},49:{f:parse_Int32LE},50:{},51:{f:parse_BrtMdb},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:parse_ColInfo},62:{f:parse_BrtCellRString},63:{f:parse_BrtCalcChainItem$},64:{f:parse_BrtDVal},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:parsenoop,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:parse_BrtBeginWsView},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:parse_BrtWsProp},148:{f:parse_BrtWsDim,p:16},151:{f:parse_BrtPane},152:{},153:{f:parse_BrtWbProp},154:{},155:{},156:{f:parse_BrtBundleSh},157:{},158:{},159:{T:1,f:parse_BrtBeginSst},160:{T:-1},161:{T:1,f:parse_UncheckedRfX},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:parse_BrtMergeCell},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:parse_BrtMdtinfo},336:{T:-1},337:{f:parse_BrtBeginEsmdb,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:parse_RelID},357:{},358:{},359:{},360:{T:1},361:{},362:{f:parse_ExternSheet},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:parse_BrtArrFmla},427:{f:parse_BrtShrFmla},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:parse_BrtMargins},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:parse_BrtWsFmtInfo},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:parse_BrtHLink},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:parse_RelID},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:parse_BrtCommentAuthor},633:{T:1},634:{T:-1},635:{T:1,f:parse_BrtBeginComment},636:{T:-1},637:{f:parse_BrtCommentText},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:parse_BrtCsProp},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:parse_BrtDVal14},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function write_biff_rec(ar,or,lr,cr){var ur=or;if(!isNaN(ur)){var dr=cr||(lr||[]).length||0,hr=ar.next(4);hr.write_shift(2,ur),hr.write_shift(2,dr),dr>0&&is_buf(lr)&&ar.push(lr)}}function write_biff_continue(ar,or,lr,cr){var ur=(lr||[]).length||0;if(ur<=8224)return write_biff_rec(ar,or,lr,ur);var dr=or;if(!isNaN(dr)){for(var hr=lr.parts||[],pr=0,xr=0,mr=0;mr+(hr[pr]||8224)<=8224;)mr+=hr[pr]||8224,pr++;var fr=ar.next(4);for(fr.write_shift(2,dr),fr.write_shift(2,mr),ar.push(lr.slice(xr,xr+mr)),xr+=mr;xr<ur;){for(fr=ar.next(4),fr.write_shift(2,60),mr=0;mr+(hr[pr]||8224)<=8224;)mr+=hr[pr]||8224,pr++;fr.write_shift(2,mr),ar.push(lr.slice(xr,xr+mr)),xr+=mr}}}function write_BIFF2Cell(ar,or,lr){return ar||(ar=new_buf(7)),ar.write_shift(2,or),ar.write_shift(2,lr),ar.write_shift(2,0),ar.write_shift(1,0),ar}function write_BIFF2BERR(ar,or,lr,cr){var ur=new_buf(9);return write_BIFF2Cell(ur,ar,or),write_Bes(lr,cr||"b",ur),ur}function write_BIFF2LABEL(ar,or,lr){var cr=new_buf(8+2*lr.length);return write_BIFF2Cell(cr,ar,or),cr.write_shift(1,lr.length),cr.write_shift(lr.length,lr,"sbcs"),cr.l<cr.length?cr.slice(0,cr.l):cr}function write_ws_biff2_cell(ar,or,lr,cr){if(or.v!=null)switch(or.t){case"d":case"n":var ur=or.t=="d"?datenum(parseDate(or.v)):or.v;ur==(ur|0)&&ur>=0&&ur<65536?write_biff_rec(ar,2,write_BIFF2INT(lr,cr,ur)):write_biff_rec(ar,3,write_BIFF2NUM(lr,cr,ur));return;case"b":case"e":write_biff_rec(ar,5,write_BIFF2BERR(lr,cr,or.v,or.t));return;case"s":case"str":write_biff_rec(ar,4,write_BIFF2LABEL(lr,cr,(or.v||"").slice(0,255)));return}write_biff_rec(ar,1,write_BIFF2Cell(null,lr,cr))}function write_ws_biff2(ar,or,lr,cr){var ur=Array.isArray(or),dr=safe_decode_range(or["!ref"]||"A1"),hr,pr="",xr=[];if(dr.e.c>255||dr.e.r>16383){if(cr.WTF)throw new Error("Range "+(or["!ref"]||"A1")+" exceeds format limit A1:IV16384");dr.e.c=Math.min(dr.e.c,255),dr.e.r=Math.min(dr.e.c,16383),hr=encode_range(dr)}for(var mr=dr.s.r;mr<=dr.e.r;++mr){pr=encode_row(mr);for(var fr=dr.s.c;fr<=dr.e.c;++fr){mr===dr.s.r&&(xr[fr]=encode_col(fr)),hr=xr[fr]+pr;var Er=ur?(or[mr]||[])[fr]:or[hr];Er&&write_ws_biff2_cell(ar,Er,mr,fr)}}}function write_biff2_buf(ar,or){for(var lr=or||{},cr=buf_array(),ur=0,dr=0;dr<ar.SheetNames.length;++dr)ar.SheetNames[dr]==lr.sheet&&(ur=dr);if(ur==0&&lr.sheet&&ar.SheetNames[0]!=lr.sheet)throw new Error("Sheet not found: "+lr.sheet);return write_biff_rec(cr,lr.biff==4?1033:lr.biff==3?521:9,write_BOF(ar,16,lr)),write_ws_biff2(cr,ar.Sheets[ar.SheetNames[ur]],ur,lr),write_biff_rec(cr,10),cr.end()}function write_FONTS_biff8(ar,or,lr){write_biff_rec(ar,49,write_Font({sz:12,name:"Arial"},lr))}function write_FMTS_biff8(ar,or,lr){or&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(cr){for(var ur=cr[0];ur<=cr[1];++ur)or[ur]!=null&&write_biff_rec(ar,1054,write_Format(ur,or[ur],lr))})}function write_FEAT(ar,or){var lr=new_buf(19);lr.write_shift(4,2151),lr.write_shift(4,0),lr.write_shift(4,0),lr.write_shift(2,3),lr.write_shift(1,1),lr.write_shift(4,0),write_biff_rec(ar,2151,lr),lr=new_buf(39),lr.write_shift(4,2152),lr.write_shift(4,0),lr.write_shift(4,0),lr.write_shift(2,3),lr.write_shift(1,0),lr.write_shift(4,0),lr.write_shift(2,1),lr.write_shift(4,4),lr.write_shift(2,0),write_Ref8U(safe_decode_range(or["!ref"]||"A1"),lr),lr.write_shift(4,4),write_biff_rec(ar,2152,lr)}function write_CELLXFS_biff8(ar,or){for(var lr=0;lr<16;++lr)write_biff_rec(ar,224,write_XF({numFmtId:0,style:!0},0,or));or.cellXfs.forEach(function(cr){write_biff_rec(ar,224,write_XF(cr,0,or))})}function write_ws_biff8_hlinks(ar,or){for(var lr=0;lr<or["!links"].length;++lr){var cr=or["!links"][lr];write_biff_rec(ar,440,write_HLink(cr)),cr[1].Tooltip&&write_biff_rec(ar,2048,write_HLinkTooltip(cr))}delete or["!links"]}function write_ws_cols_biff8(ar,or){if(or){var lr=0;or.forEach(function(cr,ur){++lr<=256&&cr&&write_biff_rec(ar,125,write_ColInfo(col_obj_w(ur,cr),ur))})}}function write_ws_biff8_cell(ar,or,lr,cr,ur){var dr=16+get_cell_style(ur.cellXfs,or,ur);if(or.v==null&&!or.bf){write_biff_rec(ar,513,write_XLSCell(lr,cr,dr));return}if(or.bf)write_biff_rec(ar,6,write_Formula(or,lr,cr,ur,dr));else switch(or.t){case"d":case"n":var hr=or.t=="d"?datenum(parseDate(or.v)):or.v;write_biff_rec(ar,515,write_Number(lr,cr,hr,dr));break;case"b":case"e":write_biff_rec(ar,517,write_BoolErr(lr,cr,or.v,dr,ur,or.t));break;case"s":case"str":if(ur.bookSST){var pr=get_sst_id(ur.Strings,or.v,ur.revStrings);write_biff_rec(ar,253,write_LabelSst(lr,cr,pr,dr))}else write_biff_rec(ar,516,write_Label(lr,cr,(or.v||"").slice(0,255),dr,ur));break;default:write_biff_rec(ar,513,write_XLSCell(lr,cr,dr))}}function write_ws_biff8(ar,or,lr){var cr=buf_array(),ur=lr.SheetNames[ar],dr=lr.Sheets[ur]||{},hr=(lr||{}).Workbook||{},pr=(hr.Sheets||[])[ar]||{},xr=Array.isArray(dr),mr=or.biff==8,fr,Er="",vr=[],gr=safe_decode_range(dr["!ref"]||"A1"),yr=mr?65536:16384;if(gr.e.c>255||gr.e.r>=yr){if(or.WTF)throw new Error("Range "+(dr["!ref"]||"A1")+" exceeds format limit A1:IV16384");gr.e.c=Math.min(gr.e.c,255),gr.e.r=Math.min(gr.e.c,yr-1)}write_biff_rec(cr,2057,write_BOF(lr,16,or)),write_biff_rec(cr,13,writeuint16(1)),write_biff_rec(cr,12,writeuint16(100)),write_biff_rec(cr,15,writebool(!0)),write_biff_rec(cr,17,writebool(!1)),write_biff_rec(cr,16,write_Xnum(.001)),write_biff_rec(cr,95,writebool(!0)),write_biff_rec(cr,42,writebool(!1)),write_biff_rec(cr,43,writebool(!1)),write_biff_rec(cr,130,writeuint16(1)),write_biff_rec(cr,128,write_Guts()),write_biff_rec(cr,131,writebool(!1)),write_biff_rec(cr,132,writebool(!1)),mr&&write_ws_cols_biff8(cr,dr["!cols"]),write_biff_rec(cr,512,write_Dimensions(gr,or)),mr&&(dr["!links"]=[]);for(var jr=gr.s.r;jr<=gr.e.r;++jr){Er=encode_row(jr);for(var br=gr.s.c;br<=gr.e.c;++br){jr===gr.s.r&&(vr[br]=encode_col(br)),fr=vr[br]+Er;var _r=xr?(dr[jr]||[])[br]:dr[fr];_r&&(write_ws_biff8_cell(cr,_r,jr,br,or),mr&&_r.l&&dr["!links"].push([fr,_r.l]))}}var wr=pr.CodeName||pr.name||ur;return mr&&write_biff_rec(cr,574,write_Window2((hr.Views||[])[0])),mr&&(dr["!merges"]||[]).length&&write_biff_rec(cr,229,write_MergeCells(dr["!merges"])),mr&&write_ws_biff8_hlinks(cr,dr),write_biff_rec(cr,442,write_XLUnicodeString(wr)),mr&&write_FEAT(cr,dr),write_biff_rec(cr,10),cr.end()}function write_biff8_global(ar,or,lr){var cr=buf_array(),ur=(ar||{}).Workbook||{},dr=ur.Sheets||[],hr=ur.WBProps||{},pr=lr.biff==8,xr=lr.biff==5;if(write_biff_rec(cr,2057,write_BOF(ar,5,lr)),lr.bookType=="xla"&&write_biff_rec(cr,135),write_biff_rec(cr,225,pr?writeuint16(1200):null),write_biff_rec(cr,193,writezeroes(2)),xr&&write_biff_rec(cr,191),xr&&write_biff_rec(cr,192),write_biff_rec(cr,226),write_biff_rec(cr,92,write_WriteAccess("SheetJS",lr)),write_biff_rec(cr,66,writeuint16(pr?1200:1252)),pr&&write_biff_rec(cr,353,writeuint16(0)),pr&&write_biff_rec(cr,448),write_biff_rec(cr,317,write_RRTabId(ar.SheetNames.length)),pr&&ar.vbaraw&&write_biff_rec(cr,211),pr&&ar.vbaraw){var mr=hr.CodeName||"ThisWorkbook";write_biff_rec(cr,442,write_XLUnicodeString(mr))}write_biff_rec(cr,156,writeuint16(17)),write_biff_rec(cr,25,writebool(!1)),write_biff_rec(cr,18,writebool(!1)),write_biff_rec(cr,19,writeuint16(0)),pr&&write_biff_rec(cr,431,writebool(!1)),pr&&write_biff_rec(cr,444,writeuint16(0)),write_biff_rec(cr,61,write_Window1()),write_biff_rec(cr,64,writebool(!1)),write_biff_rec(cr,141,writeuint16(0)),write_biff_rec(cr,34,writebool(safe1904(ar)=="true")),write_biff_rec(cr,14,writebool(!0)),pr&&write_biff_rec(cr,439,writebool(!1)),write_biff_rec(cr,218,writeuint16(0)),write_FONTS_biff8(cr,ar,lr),write_FMTS_biff8(cr,ar.SSF,lr),write_CELLXFS_biff8(cr,lr),pr&&write_biff_rec(cr,352,writebool(!1));var fr=cr.end(),Er=buf_array();pr&&write_biff_rec(Er,140,write_Country()),pr&&lr.Strings&&write_biff_continue(Er,252,write_SST(lr.Strings)),write_biff_rec(Er,10);var vr=Er.end(),gr=buf_array(),yr=0,jr=0;for(jr=0;jr<ar.SheetNames.length;++jr)yr+=(pr?12:11)+(pr?2:1)*ar.SheetNames[jr].length;var br=fr.length+yr+vr.length;for(jr=0;jr<ar.SheetNames.length;++jr){var _r=dr[jr]||{};write_biff_rec(gr,133,write_BoundSheet8({pos:br,hs:_r.Hidden||0,dt:0,name:ar.SheetNames[jr]},lr)),br+=or[jr].length}var wr=gr.end();if(yr!=wr.length)throw new Error("BS8 "+yr+" != "+wr.length);var Rr=[];return fr.length&&Rr.push(fr),wr.length&&Rr.push(wr),vr.length&&Rr.push(vr),bconcat(Rr)}function write_biff8_buf(ar,or){var lr=or||{},cr=[];ar&&!ar.SSF&&(ar.SSF=dup(table_fmt)),ar&&ar.SSF&&(make_ssf(),SSF_load_table(ar.SSF),lr.revssf=evert_num(ar.SSF),lr.revssf[ar.SSF[65535]]=0,lr.ssf=ar.SSF),lr.Strings=[],lr.Strings.Count=0,lr.Strings.Unique=0,fix_write_opts(lr),lr.cellXfs=[],get_cell_style(lr.cellXfs,{},{revssf:{General:0}}),ar.Props||(ar.Props={});for(var ur=0;ur<ar.SheetNames.length;++ur)cr[cr.length]=write_ws_biff8(ur,lr,ar);return cr.unshift(write_biff8_global(ar,cr,lr)),bconcat(cr)}function write_biff_buf(ar,or){for(var lr=0;lr<=ar.SheetNames.length;++lr){var cr=ar.Sheets[ar.SheetNames[lr]];if(!(!cr||!cr["!ref"])){var ur=decode_range(cr["!ref"]);ur.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+ar.SheetNames[lr]+"' extends beyond column IV (255).  Data may be lost.")}}var dr=or||{};switch(dr.biff||2){case 8:case 5:return write_biff8_buf(ar,or);case 4:case 3:case 2:return write_biff2_buf(ar,or)}throw new Error("invalid type "+dr.bookType+" for BIFF")}function make_html_row(ar,or,lr,cr){for(var ur=ar["!merges"]||[],dr=[],hr=or.s.c;hr<=or.e.c;++hr){for(var pr=0,xr=0,mr=0;mr<ur.length;++mr)if(!(ur[mr].s.r>lr||ur[mr].s.c>hr)&&!(ur[mr].e.r<lr||ur[mr].e.c<hr)){if(ur[mr].s.r<lr||ur[mr].s.c<hr){pr=-1;break}pr=ur[mr].e.r-ur[mr].s.r+1,xr=ur[mr].e.c-ur[mr].s.c+1;break}if(!(pr<0)){var fr=encode_cell({r:lr,c:hr}),Er=cr.dense?(ar[lr]||[])[hr]:ar[fr],vr=Er&&Er.v!=null&&(Er.h||escapehtml(Er.w||(format_cell(Er),Er.w)||""))||"",gr={};pr>1&&(gr.rowspan=pr),xr>1&&(gr.colspan=xr),cr.editable?vr='<span contenteditable="true">'+vr+"</span>":Er&&(gr["data-t"]=Er&&Er.t||"z",Er.v!=null&&(gr["data-v"]=Er.v),Er.z!=null&&(gr["data-z"]=Er.z),Er.l&&(Er.l.Target||"#").charAt(0)!="#"&&(vr='<a href="'+Er.l.Target+'">'+vr+"</a>")),gr.id=(cr.id||"sjs")+"-"+fr,dr.push(writextag("td",vr,gr))}}var yr="<tr>";return yr+dr.join("")+"</tr>"}var HTML_BEGIN='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',HTML_END="</body></html>";function make_html_preamble(ar,or,lr){var cr=[];return cr.join("")+"<table"+(lr&&lr.id?' id="'+lr.id+'"':"")+">"}function sheet_to_html(ar,or){var lr=or||{},cr=lr.header!=null?lr.header:HTML_BEGIN,ur=lr.footer!=null?lr.footer:HTML_END,dr=[cr],hr=decode_range(ar["!ref"]);lr.dense=Array.isArray(ar),dr.push(make_html_preamble(ar,hr,lr));for(var pr=hr.s.r;pr<=hr.e.r;++pr)dr.push(make_html_row(ar,hr,pr,lr));return dr.push("</table>"+ur),dr.join("")}function sheet_add_dom(ar,or,lr){var cr=lr||{},ur=0,dr=0;if(cr.origin!=null)if(typeof cr.origin=="number")ur=cr.origin;else{var hr=typeof cr.origin=="string"?decode_cell(cr.origin):cr.origin;ur=hr.r,dr=hr.c}var pr=or.getElementsByTagName("tr"),xr=Math.min(cr.sheetRows||1e7,pr.length),mr={s:{r:0,c:0},e:{r:ur,c:dr}};if(ar["!ref"]){var fr=decode_range(ar["!ref"]);mr.s.r=Math.min(mr.s.r,fr.s.r),mr.s.c=Math.min(mr.s.c,fr.s.c),mr.e.r=Math.max(mr.e.r,fr.e.r),mr.e.c=Math.max(mr.e.c,fr.e.c),ur==-1&&(mr.e.r=ur=fr.e.r+1)}var Er=[],vr=0,gr=ar["!rows"]||(ar["!rows"]=[]),yr=0,jr=0,br=0,_r=0,wr=0,Rr=0;for(ar["!cols"]||(ar["!cols"]=[]);yr<pr.length&&jr<xr;++yr){var Ar=pr[yr];if(is_dom_element_hidden(Ar)){if(cr.display)continue;gr[jr]={hidden:!0}}var Sr=Ar.children;for(br=_r=0;br<Sr.length;++br){var kr=Sr[br];if(!(cr.display&&is_dom_element_hidden(kr))){var Nr=kr.hasAttribute("data-v")?kr.getAttribute("data-v"):kr.hasAttribute("v")?kr.getAttribute("v"):htmldecode(kr.innerHTML),Cr=kr.getAttribute("data-z")||kr.getAttribute("z");for(vr=0;vr<Er.length;++vr){var Tr=Er[vr];Tr.s.c==_r+dr&&Tr.s.r<jr+ur&&jr+ur<=Tr.e.r&&(_r=Tr.e.c+1-dr,vr=-1)}Rr=+kr.getAttribute("colspan")||1,((wr=+kr.getAttribute("rowspan")||1)>1||Rr>1)&&Er.push({s:{r:jr+ur,c:_r+dr},e:{r:jr+ur+(wr||1)-1,c:_r+dr+(Rr||1)-1}});var Pr={t:"s",v:Nr},Ir=kr.getAttribute("data-t")||kr.getAttribute("t")||"";Nr!=null&&(Nr.length==0?Pr.t=Ir||"z":cr.raw||Nr.trim().length==0||Ir=="s"||(Nr==="TRUE"?Pr={t:"b",v:!0}:Nr==="FALSE"?Pr={t:"b",v:!1}:isNaN(fuzzynum(Nr))?isNaN(fuzzydate(Nr).getDate())||(Pr={t:"d",v:parseDate(Nr)},cr.cellDates||(Pr={t:"n",v:datenum(Pr.v)}),Pr.z=cr.dateNF||table_fmt[14]):Pr={t:"n",v:fuzzynum(Nr)})),Pr.z===void 0&&Cr!=null&&(Pr.z=Cr);var Br="",Wr=kr.getElementsByTagName("A");if(Wr&&Wr.length)for(var Yr=0;Yr<Wr.length&&!(Wr[Yr].hasAttribute("href")&&(Br=Wr[Yr].getAttribute("href"),Br.charAt(0)!="#"));++Yr);Br&&Br.charAt(0)!="#"&&(Pr.l={Target:Br}),cr.dense?(ar[jr+ur]||(ar[jr+ur]=[]),ar[jr+ur][_r+dr]=Pr):ar[encode_cell({c:_r+dr,r:jr+ur})]=Pr,mr.e.c<_r+dr&&(mr.e.c=_r+dr),_r+=Rr}}++jr}return Er.length&&(ar["!merges"]=(ar["!merges"]||[]).concat(Er)),mr.e.r=Math.max(mr.e.r,jr-1+ur),ar["!ref"]=encode_range(mr),jr>=xr&&(ar["!fullref"]=encode_range((mr.e.r=pr.length-yr+jr-1+ur,mr))),ar}function parse_dom_table(ar,or){var lr=or||{},cr=lr.dense?[]:{};return sheet_add_dom(cr,ar,or)}function table_to_book(ar,or){return sheet_to_workbook(parse_dom_table(ar,or),or)}function is_dom_element_hidden(ar){var or="",lr=get_get_computed_style_function(ar);return lr&&(or=lr(ar).getPropertyValue("display")),or||(or=ar.style&&ar.style.display),or==="none"}function get_get_computed_style_function(ar){return ar.ownerDocument.defaultView&&typeof ar.ownerDocument.defaultView.getComputedStyle=="function"?ar.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var write_styles_ods=function(){var ar=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),or="<office:document-styles "+wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+ar+"</office:document-styles>";return function(){return XML_HEADER+or}}(),write_content_ods=function(){var ar=function(dr){return escapexml(dr).replace(/  +/g,function(hr){return'<text:s text:c="'+hr.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},or=`          <table:table-cell />
`,lr=`          <table:covered-table-cell/>
`,cr=function(dr,hr,pr){var xr=[];xr.push('      <table:table table:name="'+escapexml(hr.SheetNames[pr])+`" table:style-name="ta1">
`);var mr=0,fr=0,Er=decode_range(dr["!ref"]||"A1"),vr=dr["!merges"]||[],gr=0,yr=Array.isArray(dr);if(dr["!cols"])for(fr=0;fr<=Er.e.c;++fr)xr.push("        <table:table-column"+(dr["!cols"][fr]?' table:style-name="co'+dr["!cols"][fr].ods+'"':"")+`></table:table-column>
`);var jr="",br=dr["!rows"]||[];for(mr=0;mr<Er.s.r;++mr)jr=br[mr]?' table:style-name="ro'+br[mr].ods+'"':"",xr.push("        <table:table-row"+jr+`></table:table-row>
`);for(;mr<=Er.e.r;++mr){for(jr=br[mr]?' table:style-name="ro'+br[mr].ods+'"':"",xr.push("        <table:table-row"+jr+`>
`),fr=0;fr<Er.s.c;++fr)xr.push(or);for(;fr<=Er.e.c;++fr){var _r=!1,wr={},Rr="";for(gr=0;gr!=vr.length;++gr)if(!(vr[gr].s.c>fr)&&!(vr[gr].s.r>mr)&&!(vr[gr].e.c<fr)&&!(vr[gr].e.r<mr)){(vr[gr].s.c!=fr||vr[gr].s.r!=mr)&&(_r=!0),wr["table:number-columns-spanned"]=vr[gr].e.c-vr[gr].s.c+1,wr["table:number-rows-spanned"]=vr[gr].e.r-vr[gr].s.r+1;break}if(_r){xr.push(lr);continue}var Ar=encode_cell({r:mr,c:fr}),Sr=yr?(dr[mr]||[])[fr]:dr[Ar];if(Sr&&Sr.f&&(wr["table:formula"]=escapexml(csf_to_ods_formula(Sr.f)),Sr.F&&Sr.F.slice(0,Ar.length)==Ar)){var kr=decode_range(Sr.F);wr["table:number-matrix-columns-spanned"]=kr.e.c-kr.s.c+1,wr["table:number-matrix-rows-spanned"]=kr.e.r-kr.s.r+1}if(!Sr){xr.push(or);continue}switch(Sr.t){case"b":Rr=Sr.v?"TRUE":"FALSE",wr["office:value-type"]="boolean",wr["office:boolean-value"]=Sr.v?"true":"false";break;case"n":Rr=Sr.w||String(Sr.v||0),wr["office:value-type"]="float",wr["office:value"]=Sr.v||0;break;case"s":case"str":Rr=Sr.v==null?"":Sr.v,wr["office:value-type"]="string";break;case"d":Rr=Sr.w||parseDate(Sr.v).toISOString(),wr["office:value-type"]="date",wr["office:date-value"]=parseDate(Sr.v).toISOString(),wr["table:style-name"]="ce1";break;default:xr.push(or);continue}var Nr=ar(Rr);if(Sr.l&&Sr.l.Target){var Cr=Sr.l.Target;Cr=Cr.charAt(0)=="#"?"#"+csf_to_ods_3D(Cr.slice(1)):Cr,Cr.charAt(0)!="#"&&!Cr.match(/^\w+:/)&&(Cr="../"+Cr),Nr=writextag("text:a",Nr,{"xlink:href":Cr.replace(/&/g,"&amp;")})}xr.push("          "+writextag("table:table-cell",writextag("text:p",Nr,{}),wr)+`
`)}xr.push(`        </table:table-row>
`)}return xr.push(`      </table:table>
`),xr.join("")},ur=function(dr,hr){dr.push(` <office:automatic-styles>
`),dr.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),dr.push(`   <number:month number:style="long"/>
`),dr.push(`   <number:text>/</number:text>
`),dr.push(`   <number:day number:style="long"/>
`),dr.push(`   <number:text>/</number:text>
`),dr.push(`   <number:year/>
`),dr.push(`  </number:date-style>
`);var pr=0;hr.SheetNames.map(function(mr){return hr.Sheets[mr]}).forEach(function(mr){if(mr&&mr["!cols"]){for(var fr=0;fr<mr["!cols"].length;++fr)if(mr["!cols"][fr]){var Er=mr["!cols"][fr];if(Er.width==null&&Er.wpx==null&&Er.wch==null)continue;process_col(Er),Er.ods=pr;var vr=mr["!cols"][fr].wpx+"px";dr.push('  <style:style style:name="co'+pr+`" style:family="table-column">
`),dr.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+vr+`"/>
`),dr.push(`  </style:style>
`),++pr}}});var xr=0;hr.SheetNames.map(function(mr){return hr.Sheets[mr]}).forEach(function(mr){if(mr&&mr["!rows"]){for(var fr=0;fr<mr["!rows"].length;++fr)if(mr["!rows"][fr]){mr["!rows"][fr].ods=xr;var Er=mr["!rows"][fr].hpx+"px";dr.push('  <style:style style:name="ro'+xr+`" style:family="table-row">
`),dr.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+Er+`"/>
`),dr.push(`  </style:style>
`),++xr}}}),dr.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),dr.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),dr.push(`  </style:style>
`),dr.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),dr.push(` </office:automatic-styles>
`)};return function(hr,pr){var xr=[XML_HEADER],mr=wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),fr=wxt_helper({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});pr.bookType=="fods"?(xr.push("<office:document"+mr+fr+`>
`),xr.push(write_meta_ods().replace(/office:document-meta/g,"office:meta"))):xr.push("<office:document-content"+mr+`>
`),ur(xr,hr),xr.push(`  <office:body>
`),xr.push(`    <office:spreadsheet>
`);for(var Er=0;Er!=hr.SheetNames.length;++Er)xr.push(cr(hr.Sheets[hr.SheetNames[Er]],hr,Er));return xr.push(`    </office:spreadsheet>
`),xr.push(`  </office:body>
`),pr.bookType=="fods"?xr.push("</office:document>"):xr.push("</office:document-content>"),xr.join("")}}();function write_ods(ar,or){if(or.bookType=="fods")return write_content_ods(ar,or);var lr=zip_new(),cr="",ur=[],dr=[];return cr="mimetype",zip_add_file(lr,cr,"application/vnd.oasis.opendocument.spreadsheet"),cr="content.xml",zip_add_file(lr,cr,write_content_ods(ar,or)),ur.push([cr,"text/xml"]),dr.push([cr,"ContentFile"]),cr="styles.xml",zip_add_file(lr,cr,write_styles_ods(ar,or)),ur.push([cr,"text/xml"]),dr.push([cr,"StylesFile"]),cr="meta.xml",zip_add_file(lr,cr,XML_HEADER+write_meta_ods()),ur.push([cr,"text/xml"]),dr.push([cr,"MetadataFile"]),cr="manifest.rdf",zip_add_file(lr,cr,write_rdf(dr)),ur.push([cr,"application/rdf+xml"]),cr="META-INF/manifest.xml",zip_add_file(lr,cr,write_manifest(ur)),lr}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function u8_to_dataview(ar){return new DataView(ar.buffer,ar.byteOffset,ar.byteLength)}function stru8(ar){return typeof TextEncoder<"u"?new TextEncoder().encode(ar):s2a(utf8write(ar))}function u8contains(ar,or){e:for(var lr=0;lr<=ar.length-or.length;++lr){for(var cr=0;cr<or.length;++cr)if(ar[lr+cr]!=or[cr])continue e;return!0}return!1}function u8concat(ar){var or=ar.reduce(function(ur,dr){return ur+dr.length},0),lr=new Uint8Array(or),cr=0;return ar.forEach(function(ur){lr.set(ur,cr),cr+=ur.length}),lr}function writeDecimal128LE(ar,or,lr){var cr=Math.floor(lr==0?0:Math.LOG10E*Math.log(Math.abs(lr)))+6176-20,ur=lr/Math.pow(10,cr-6176);ar[or+15]|=cr>>7,ar[or+14]|=(cr&127)<<1;for(var dr=0;ur>=1;++dr,ur/=256)ar[or+dr]=ur&255;ar[or+15]|=lr>=0?0:128}function parse_varint49(ar,or){var lr=or?or[0]:0,cr=ar[lr]&127;e:if(ar[lr++]>=128&&(cr|=(ar[lr]&127)<<7,ar[lr++]<128||(cr|=(ar[lr]&127)<<14,ar[lr++]<128)||(cr|=(ar[lr]&127)<<21,ar[lr++]<128)||(cr+=(ar[lr]&127)*Math.pow(2,28),++lr,ar[lr++]<128)||(cr+=(ar[lr]&127)*Math.pow(2,35),++lr,ar[lr++]<128)||(cr+=(ar[lr]&127)*Math.pow(2,42),++lr,ar[lr++]<128)))break e;return or&&(or[0]=lr),cr}function write_varint49(ar){var or=new Uint8Array(7);or[0]=ar&127;var lr=1;e:if(ar>127){if(or[lr-1]|=128,or[lr]=ar>>7&127,++lr,ar<=16383||(or[lr-1]|=128,or[lr]=ar>>14&127,++lr,ar<=2097151)||(or[lr-1]|=128,or[lr]=ar>>21&127,++lr,ar<=268435455)||(or[lr-1]|=128,or[lr]=ar/256>>>21&127,++lr,ar<=34359738367)||(or[lr-1]|=128,or[lr]=ar/65536>>>21&127,++lr,ar<=4398046511103))break e;or[lr-1]|=128,or[lr]=ar/16777216>>>21&127,++lr}return or.slice(0,lr)}function varint_to_i32(ar){var or=0,lr=ar[or]&127;e:if(ar[or++]>=128){if(lr|=(ar[or]&127)<<7,ar[or++]<128||(lr|=(ar[or]&127)<<14,ar[or++]<128)||(lr|=(ar[or]&127)<<21,ar[or++]<128))break e;lr|=(ar[or]&127)<<28}return lr}function parse_shallow(ar){for(var or=[],lr=[0];lr[0]<ar.length;){var cr=lr[0],ur=parse_varint49(ar,lr),dr=ur&7;ur=Math.floor(ur/8);var hr=0,pr;if(ur==0)break;switch(dr){case 0:{for(var xr=lr[0];ar[lr[0]++]>=128;);pr=ar.slice(xr,lr[0])}break;case 5:hr=4,pr=ar.slice(lr[0],lr[0]+hr),lr[0]+=hr;break;case 1:hr=8,pr=ar.slice(lr[0],lr[0]+hr),lr[0]+=hr;break;case 2:hr=parse_varint49(ar,lr),pr=ar.slice(lr[0],lr[0]+hr),lr[0]+=hr;break;case 3:case 4:default:throw new Error("PB Type ".concat(dr," for Field ").concat(ur," at offset ").concat(cr))}var mr={data:pr,type:dr};or[ur]==null?or[ur]=[mr]:or[ur].push(mr)}return or}function write_shallow(ar){var or=[];return ar.forEach(function(lr,cr){lr.forEach(function(ur){ur.data&&(or.push(write_varint49(cr*8+ur.type)),ur.type==2&&or.push(write_varint49(ur.data.length)),or.push(ur.data))})}),u8concat(or)}function parse_iwa_file(ar){for(var or,lr=[],cr=[0];cr[0]<ar.length;){var ur=parse_varint49(ar,cr),dr=parse_shallow(ar.slice(cr[0],cr[0]+ur));cr[0]+=ur;var hr={id:varint_to_i32(dr[1][0].data),messages:[]};dr[2].forEach(function(pr){var xr=parse_shallow(pr.data),mr=varint_to_i32(xr[3][0].data);hr.messages.push({meta:xr,data:ar.slice(cr[0],cr[0]+mr)}),cr[0]+=mr}),(or=dr[3])!=null&&or[0]&&(hr.merge=varint_to_i32(dr[3][0].data)>>>0>0),lr.push(hr)}return lr}function write_iwa_file(ar){var or=[];return ar.forEach(function(lr){var cr=[];cr[1]=[{data:write_varint49(lr.id),type:0}],cr[2]=[],lr.merge!=null&&(cr[3]=[{data:write_varint49(+!!lr.merge),type:0}]);var ur=[];lr.messages.forEach(function(hr){ur.push(hr.data),hr.meta[3]=[{type:0,data:write_varint49(hr.data.length)}],cr[2].push({data:write_shallow(hr.meta),type:2})});var dr=write_shallow(cr);or.push(write_varint49(dr.length)),or.push(dr),ur.forEach(function(hr){return or.push(hr)})}),u8concat(or)}function parse_snappy_chunk(ar,or){if(ar!=0)throw new Error("Unexpected Snappy chunk type ".concat(ar));for(var lr=[0],cr=parse_varint49(or,lr),ur=[];lr[0]<or.length;){var dr=or[lr[0]]&3;if(dr==0){var hr=or[lr[0]++]>>2;if(hr<60)++hr;else{var pr=hr-59;hr=or[lr[0]],pr>1&&(hr|=or[lr[0]+1]<<8),pr>2&&(hr|=or[lr[0]+2]<<16),pr>3&&(hr|=or[lr[0]+3]<<24),hr>>>=0,hr++,lr[0]+=pr}ur.push(or.slice(lr[0],lr[0]+hr)),lr[0]+=hr;continue}else{var xr=0,mr=0;if(dr==1?(mr=(or[lr[0]]>>2&7)+4,xr=(or[lr[0]++]&224)<<3,xr|=or[lr[0]++]):(mr=(or[lr[0]++]>>2)+1,dr==2?(xr=or[lr[0]]|or[lr[0]+1]<<8,lr[0]+=2):(xr=(or[lr[0]]|or[lr[0]+1]<<8|or[lr[0]+2]<<16|or[lr[0]+3]<<24)>>>0,lr[0]+=4)),ur=[u8concat(ur)],xr==0)throw new Error("Invalid offset 0");if(xr>ur[0].length)throw new Error("Invalid offset beyond length");if(mr>=xr)for(ur.push(ur[0].slice(-xr)),mr-=xr;mr>=ur[ur.length-1].length;)ur.push(ur[ur.length-1]),mr-=ur[ur.length-1].length;ur.push(ur[0].slice(-xr,-xr+mr))}}var fr=u8concat(ur);if(fr.length!=cr)throw new Error("Unexpected length: ".concat(fr.length," != ").concat(cr));return fr}function decompress_iwa_file(ar){for(var or=[],lr=0;lr<ar.length;){var cr=ar[lr++],ur=ar[lr]|ar[lr+1]<<8|ar[lr+2]<<16;lr+=3,or.push(parse_snappy_chunk(cr,ar.slice(lr,lr+ur))),lr+=ur}if(lr!==ar.length)throw new Error("data is not a valid framed stream!");return u8concat(or)}function compress_iwa_file(ar){for(var or=[],lr=0;lr<ar.length;){var cr=Math.min(ar.length-lr,268435455),ur=new Uint8Array(4);or.push(ur);var dr=write_varint49(cr),hr=dr.length;or.push(dr),cr<=60?(hr++,or.push(new Uint8Array([cr-1<<2]))):cr<=256?(hr+=2,or.push(new Uint8Array([240,cr-1&255]))):cr<=65536?(hr+=3,or.push(new Uint8Array([244,cr-1&255,cr-1>>8&255]))):cr<=16777216?(hr+=4,or.push(new Uint8Array([248,cr-1&255,cr-1>>8&255,cr-1>>16&255]))):cr<=4294967296&&(hr+=5,or.push(new Uint8Array([252,cr-1&255,cr-1>>8&255,cr-1>>16&255,cr-1>>>24&255]))),or.push(ar.slice(lr,lr+cr)),hr+=cr,ur[0]=0,ur[1]=hr&255,ur[2]=hr>>8&255,ur[3]=hr>>16&255,lr+=cr}return u8concat(or)}function write_new_storage(ar,or){var lr=new Uint8Array(32),cr=u8_to_dataview(lr),ur=12,dr=0;switch(lr[0]=5,ar.t){case"n":lr[1]=2,writeDecimal128LE(lr,ur,ar.v),dr|=1,ur+=16;break;case"b":lr[1]=6,cr.setFloat64(ur,ar.v?1:0,!0),dr|=2,ur+=8;break;case"s":if(or.indexOf(ar.v)==-1)throw new Error("Value ".concat(ar.v," missing from SST!"));lr[1]=3,cr.setUint32(ur,or.indexOf(ar.v),!0),dr|=8,ur+=4;break;default:throw"unsupported cell type "+ar.t}return cr.setUint32(8,dr,!0),lr.slice(0,ur)}function write_old_storage(ar,or){var lr=new Uint8Array(32),cr=u8_to_dataview(lr),ur=12,dr=0;switch(lr[0]=3,ar.t){case"n":lr[2]=2,cr.setFloat64(ur,ar.v,!0),dr|=32,ur+=8;break;case"b":lr[2]=6,cr.setFloat64(ur,ar.v?1:0,!0),dr|=32,ur+=8;break;case"s":if(or.indexOf(ar.v)==-1)throw new Error("Value ".concat(ar.v," missing from SST!"));lr[2]=3,cr.setUint32(ur,or.indexOf(ar.v),!0),dr|=16,ur+=4;break;default:throw"unsupported cell type "+ar.t}return cr.setUint32(4,dr,!0),lr.slice(0,ur)}function parse_TSP_Reference(ar){var or=parse_shallow(ar);return parse_varint49(or[1][0].data)}function write_tile_row(ar,or,lr){var cr,ur,dr,hr;if(!((cr=ar[6])!=null&&cr[0])||!((ur=ar[7])!=null&&ur[0]))throw"Mutation only works on post-BNC storages!";var pr=((hr=(dr=ar[8])==null?void 0:dr[0])==null?void 0:hr.data)&&varint_to_i32(ar[8][0].data)>0||!1;if(pr)throw"Math only works with normal offsets";for(var xr=0,mr=u8_to_dataview(ar[7][0].data),fr=0,Er=[],vr=u8_to_dataview(ar[4][0].data),gr=0,yr=[],jr=0;jr<or.length;++jr){if(or[jr]==null){mr.setUint16(jr*2,65535,!0),vr.setUint16(jr*2,65535);continue}mr.setUint16(jr*2,fr,!0),vr.setUint16(jr*2,gr,!0);var br,_r;switch(typeof or[jr]){case"string":br=write_new_storage({t:"s",v:or[jr]},lr),_r=write_old_storage({t:"s",v:or[jr]},lr);break;case"number":br=write_new_storage({t:"n",v:or[jr]},lr),_r=write_old_storage({t:"n",v:or[jr]},lr);break;case"boolean":br=write_new_storage({t:"b",v:or[jr]},lr),_r=write_old_storage({t:"b",v:or[jr]},lr);break;default:throw new Error("Unsupported value "+or[jr])}Er.push(br),fr+=br.length,yr.push(_r),gr+=_r.length,++xr}for(ar[2][0].data=write_varint49(xr);jr<ar[7][0].data.length/2;++jr)mr.setUint16(jr*2,65535,!0),vr.setUint16(jr*2,65535,!0);return ar[6][0].data=u8concat(Er),ar[3][0].data=u8concat(yr),xr}function write_numbers_iwa(ar,or){if(!or||!or.numbers)throw new Error("Must pass a `numbers` option -- check the README");var lr=ar.Sheets[ar.SheetNames[0]];ar.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var cr=decode_range(lr["!ref"]);cr.s.r=cr.s.c=0;var ur=!1;cr.e.c>9&&(ur=!0,cr.e.c=9),cr.e.r>49&&(ur=!0,cr.e.r=49),ur&&console.error("The Numbers writer is currently limited to ".concat(encode_range(cr)));var dr=sheet_to_json(lr,{range:cr,header:1}),hr=["~Sh33tJ5~"];dr.forEach(function(Dr){return Dr.forEach(function(Lr){typeof Lr=="string"&&hr.push(Lr)})});var pr={},xr=[],mr=CFB.read(or.numbers,{type:"base64"});mr.FileIndex.map(function(Dr,Lr){return[Dr,mr.FullPaths[Lr]]}).forEach(function(Dr){var Lr=Dr[0],Fr=Dr[1];if(Lr.type==2&&Lr.name.match(/\.iwa/)){var $r=Lr.content,Vr=decompress_iwa_file($r),Gr=parse_iwa_file(Vr);Gr.forEach(function(Jr){xr.push(Jr.id),pr[Jr.id]={deps:[],location:Fr,type:varint_to_i32(Jr.messages[0].meta[1][0].data)}})}}),xr.sort(function(Dr,Lr){return Dr-Lr});var fr=xr.filter(function(Dr){return Dr>1}).map(function(Dr){return[Dr,write_varint49(Dr)]});mr.FileIndex.map(function(Dr,Lr){return[Dr,mr.FullPaths[Lr]]}).forEach(function(Dr){var Lr=Dr[0];if(Dr[1],!!Lr.name.match(/\.iwa/)){var Fr=parse_iwa_file(decompress_iwa_file(Lr.content));Fr.forEach(function($r){$r.messages.forEach(function(Vr){fr.forEach(function(Gr){$r.messages.some(function(Jr){return varint_to_i32(Jr.meta[1][0].data)!=11006&&u8contains(Jr.data,Gr[1])})&&pr[Gr[0]].deps.push($r.id)})})})}});for(var Er=CFB.find(mr,pr[1].location),vr=parse_iwa_file(decompress_iwa_file(Er.content)),gr,yr=0;yr<vr.length;++yr){var jr=vr[yr];jr.id==1&&(gr=jr)}var br=parse_TSP_Reference(parse_shallow(gr.messages[0].data)[1][0].data);for(Er=CFB.find(mr,pr[br].location),vr=parse_iwa_file(decompress_iwa_file(Er.content)),yr=0;yr<vr.length;++yr)jr=vr[yr],jr.id==br&&(gr=jr);for(br=parse_TSP_Reference(parse_shallow(gr.messages[0].data)[2][0].data),Er=CFB.find(mr,pr[br].location),vr=parse_iwa_file(decompress_iwa_file(Er.content)),yr=0;yr<vr.length;++yr)jr=vr[yr],jr.id==br&&(gr=jr);for(br=parse_TSP_Reference(parse_shallow(gr.messages[0].data)[2][0].data),Er=CFB.find(mr,pr[br].location),vr=parse_iwa_file(decompress_iwa_file(Er.content)),yr=0;yr<vr.length;++yr)jr=vr[yr],jr.id==br&&(gr=jr);var _r=parse_shallow(gr.messages[0].data);{_r[6][0].data=write_varint49(cr.e.r+1),_r[7][0].data=write_varint49(cr.e.c+1);var wr=parse_TSP_Reference(_r[46][0].data),Rr=CFB.find(mr,pr[wr].location),Ar=parse_iwa_file(decompress_iwa_file(Rr.content));{for(var Sr=0;Sr<Ar.length&&Ar[Sr].id!=wr;++Sr);if(Ar[Sr].id!=wr)throw"Bad ColumnRowUIDMapArchive";var kr=parse_shallow(Ar[Sr].messages[0].data);kr[1]=[],kr[2]=[],kr[3]=[];for(var Nr=0;Nr<=cr.e.c;++Nr){var Cr=[];Cr[1]=Cr[2]=[{type:0,data:write_varint49(Nr+420690)}],kr[1].push({type:2,data:write_shallow(Cr)}),kr[2].push({type:0,data:write_varint49(Nr)}),kr[3].push({type:0,data:write_varint49(Nr)})}kr[4]=[],kr[5]=[],kr[6]=[];for(var Tr=0;Tr<=cr.e.r;++Tr)Cr=[],Cr[1]=Cr[2]=[{type:0,data:write_varint49(Tr+726270)}],kr[4].push({type:2,data:write_shallow(Cr)}),kr[5].push({type:0,data:write_varint49(Tr)}),kr[6].push({type:0,data:write_varint49(Tr)});Ar[Sr].messages[0].data=write_shallow(kr)}Rr.content=compress_iwa_file(write_iwa_file(Ar)),Rr.size=Rr.content.length,delete _r[46];var Pr=parse_shallow(_r[4][0].data);{Pr[7][0].data=write_varint49(cr.e.r+1);var Ir=parse_shallow(Pr[1][0].data),Br=parse_TSP_Reference(Ir[2][0].data);Rr=CFB.find(mr,pr[Br].location),Ar=parse_iwa_file(decompress_iwa_file(Rr.content));{if(Ar[0].id!=Br)throw"Bad HeaderStorageBucket";var Wr=parse_shallow(Ar[0].messages[0].data);for(Tr=0;Tr<dr.length;++Tr){var Yr=parse_shallow(Wr[2][0].data);Yr[1][0].data=write_varint49(Tr),Yr[4][0].data=write_varint49(dr[Tr].length),Wr[2][Tr]={type:Wr[2][0].type,data:write_shallow(Yr)}}Ar[0].messages[0].data=write_shallow(Wr)}Rr.content=compress_iwa_file(write_iwa_file(Ar)),Rr.size=Rr.content.length;var es=parse_TSP_Reference(Pr[2][0].data);Rr=CFB.find(mr,pr[es].location),Ar=parse_iwa_file(decompress_iwa_file(Rr.content));{if(Ar[0].id!=es)throw"Bad HeaderStorageBucket";for(Wr=parse_shallow(Ar[0].messages[0].data),Nr=0;Nr<=cr.e.c;++Nr)Yr=parse_shallow(Wr[2][0].data),Yr[1][0].data=write_varint49(Nr),Yr[4][0].data=write_varint49(cr.e.r+1),Wr[2][Nr]={type:Wr[2][0].type,data:write_shallow(Yr)};Ar[0].messages[0].data=write_shallow(Wr)}Rr.content=compress_iwa_file(write_iwa_file(Ar)),Rr.size=Rr.content.length;var ps=parse_TSP_Reference(Pr[4][0].data);(function(){for(var Dr=CFB.find(mr,pr[ps].location),Lr=parse_iwa_file(decompress_iwa_file(Dr.content)),Fr,$r=0;$r<Lr.length;++$r){var Vr=Lr[$r];Vr.id==ps&&(Fr=Vr)}var Gr=parse_shallow(Fr.messages[0].data);{Gr[3]=[];var Jr=[];hr.forEach(function(ds,bs){Jr[1]=[{type:0,data:write_varint49(bs)}],Jr[2]=[{type:0,data:write_varint49(1)}],Jr[3]=[{type:2,data:stru8(ds)}],Gr[3].push({type:2,data:write_shallow(Jr)})})}Fr.messages[0].data=write_shallow(Gr);var ms=write_iwa_file(Lr),ls=compress_iwa_file(ms);Dr.content=ls,Dr.size=Dr.content.length})();var ts=parse_shallow(Pr[3][0].data);{var Qr=ts[1][0];delete ts[2];var Hr=parse_shallow(Qr.data);{var Kr=parse_TSP_Reference(Hr[2][0].data);(function(){for(var Dr=CFB.find(mr,pr[Kr].location),Lr=parse_iwa_file(decompress_iwa_file(Dr.content)),Fr,$r=0;$r<Lr.length;++$r){var Vr=Lr[$r];Vr.id==Kr&&(Fr=Vr)}var Gr=parse_shallow(Fr.messages[0].data);{delete Gr[6],delete ts[7];var Jr=new Uint8Array(Gr[5][0].data);Gr[5]=[];for(var ms=0,ls=0;ls<=cr.e.r;++ls){var ds=parse_shallow(Jr);ms+=write_tile_row(ds,dr[ls],hr),ds[1][0].data=write_varint49(ls),Gr[5].push({data:write_shallow(ds),type:2})}Gr[1]=[{type:0,data:write_varint49(cr.e.c+1)}],Gr[2]=[{type:0,data:write_varint49(cr.e.r+1)}],Gr[3]=[{type:0,data:write_varint49(ms)}],Gr[4]=[{type:0,data:write_varint49(cr.e.r+1)}]}Fr.messages[0].data=write_shallow(Gr);var bs=write_iwa_file(Lr),ws=compress_iwa_file(bs);Dr.content=ws,Dr.size=Dr.content.length})()}Qr.data=write_shallow(Hr)}Pr[3][0].data=write_shallow(ts)}_r[4][0].data=write_shallow(Pr)}gr.messages[0].data=write_shallow(_r);var rs=write_iwa_file(vr),Mr=compress_iwa_file(rs);return Er.content=Mr,Er.size=Er.content.length,mr}function fix_opts_func(ar){return function(lr){for(var cr=0;cr!=ar.length;++cr){var ur=ar[cr];lr[ur[0]]===void 0&&(lr[ur[0]]=ur[1]),ur[2]==="n"&&(lr[ur[0]]=Number(lr[ur[0]]))}}}function fix_write_opts(ar){fix_opts_func([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(ar)}function write_zip(ar,or){return or.bookType=="ods"?write_ods(ar,or):or.bookType=="numbers"?write_numbers_iwa(ar,or):or.bookType=="xlsb"?write_zip_xlsxb(ar,or):write_zip_xlsx(ar,or)}function write_zip_xlsxb(ar,or){_shapeid=1024,ar&&!ar.SSF&&(ar.SSF=dup(table_fmt)),ar&&ar.SSF&&(make_ssf(),SSF_load_table(ar.SSF),or.revssf=evert_num(ar.SSF),or.revssf[ar.SSF[65535]]=0,or.ssf=ar.SSF),or.rels={},or.wbrels={},or.Strings=[],or.Strings.Count=0,or.Strings.Unique=0,browser_has_Map?or.revStrings=new Map:(or.revStrings={},or.revStrings.foo=[],delete or.revStrings.foo);var lr=or.bookType=="xlsb"?"bin":"xml",cr=VBAFMTS.indexOf(or.bookType)>-1,ur=new_ct();fix_write_opts(or=or||{});var dr=zip_new(),hr="",pr=0;if(or.cellXfs=[],get_cell_style(or.cellXfs,{},{revssf:{General:0}}),ar.Props||(ar.Props={}),hr="docProps/core.xml",zip_add_file(dr,hr,write_core_props(ar.Props,or)),ur.coreprops.push(hr),add_rels(or.rels,2,hr,RELS.CORE_PROPS),hr="docProps/app.xml",!(ar.Props&&ar.Props.SheetNames))if(!ar.Workbook||!ar.Workbook.Sheets)ar.Props.SheetNames=ar.SheetNames;else{for(var xr=[],mr=0;mr<ar.SheetNames.length;++mr)(ar.Workbook.Sheets[mr]||{}).Hidden!=2&&xr.push(ar.SheetNames[mr]);ar.Props.SheetNames=xr}for(ar.Props.Worksheets=ar.Props.SheetNames.length,zip_add_file(dr,hr,write_ext_props(ar.Props)),ur.extprops.push(hr),add_rels(or.rels,3,hr,RELS.EXT_PROPS),ar.Custprops!==ar.Props&&keys(ar.Custprops||{}).length>0&&(hr="docProps/custom.xml",zip_add_file(dr,hr,write_cust_props(ar.Custprops)),ur.custprops.push(hr),add_rels(or.rels,4,hr,RELS.CUST_PROPS)),pr=1;pr<=ar.SheetNames.length;++pr){var fr={"!id":{}},Er=ar.Sheets[ar.SheetNames[pr-1]],vr=(Er||{})["!type"]||"sheet";switch(vr){case"chart":default:hr="xl/worksheets/sheet"+pr+"."+lr,zip_add_file(dr,hr,write_ws(pr-1,hr,or,ar,fr)),ur.sheets.push(hr),add_rels(or.wbrels,-1,"worksheets/sheet"+pr+"."+lr,RELS.WS[0])}if(Er){var gr=Er["!comments"],yr=!1,jr="";gr&&gr.length>0&&(jr="xl/comments"+pr+"."+lr,zip_add_file(dr,jr,write_cmnt(gr,jr)),ur.comments.push(jr),add_rels(fr,-1,"../comments"+pr+"."+lr,RELS.CMNT),yr=!0),Er["!legacy"]&&yr&&zip_add_file(dr,"xl/drawings/vmlDrawing"+pr+".vml",write_comments_vml(pr,Er["!comments"])),delete Er["!comments"],delete Er["!legacy"]}fr["!id"].rId1&&zip_add_file(dr,get_rels_path(hr),write_rels(fr))}return or.Strings!=null&&or.Strings.length>0&&(hr="xl/sharedStrings."+lr,zip_add_file(dr,hr,write_sst(or.Strings,hr,or)),ur.strs.push(hr),add_rels(or.wbrels,-1,"sharedStrings."+lr,RELS.SST)),hr="xl/workbook."+lr,zip_add_file(dr,hr,write_wb(ar,hr)),ur.workbooks.push(hr),add_rels(or.rels,1,hr,RELS.WB),hr="xl/theme/theme1.xml",zip_add_file(dr,hr,write_theme(ar.Themes,or)),ur.themes.push(hr),add_rels(or.wbrels,-1,"theme/theme1.xml",RELS.THEME),hr="xl/styles."+lr,zip_add_file(dr,hr,write_sty(ar,hr,or)),ur.styles.push(hr),add_rels(or.wbrels,-1,"styles."+lr,RELS.STY),ar.vbaraw&&cr&&(hr="xl/vbaProject.bin",zip_add_file(dr,hr,ar.vbaraw),ur.vba.push(hr),add_rels(or.wbrels,-1,"vbaProject.bin",RELS.VBA)),hr="xl/metadata."+lr,zip_add_file(dr,hr,write_xlmeta(hr)),ur.metadata.push(hr),add_rels(or.wbrels,-1,"metadata."+lr,RELS.XLMETA),zip_add_file(dr,"[Content_Types].xml",write_ct(ur,or)),zip_add_file(dr,"_rels/.rels",write_rels(or.rels)),zip_add_file(dr,"xl/_rels/workbook."+lr+".rels",write_rels(or.wbrels)),delete or.revssf,delete or.ssf,dr}function write_zip_xlsx(ar,or){_shapeid=1024,ar&&!ar.SSF&&(ar.SSF=dup(table_fmt)),ar&&ar.SSF&&(make_ssf(),SSF_load_table(ar.SSF),or.revssf=evert_num(ar.SSF),or.revssf[ar.SSF[65535]]=0,or.ssf=ar.SSF),or.rels={},or.wbrels={},or.Strings=[],or.Strings.Count=0,or.Strings.Unique=0,browser_has_Map?or.revStrings=new Map:(or.revStrings={},or.revStrings.foo=[],delete or.revStrings.foo);var lr="xml",cr=VBAFMTS.indexOf(or.bookType)>-1,ur=new_ct();fix_write_opts(or=or||{});var dr=zip_new(),hr="",pr=0;if(or.cellXfs=[],get_cell_style(or.cellXfs,{},{revssf:{General:0}}),ar.Props||(ar.Props={}),hr="docProps/core.xml",zip_add_file(dr,hr,write_core_props(ar.Props,or)),ur.coreprops.push(hr),add_rels(or.rels,2,hr,RELS.CORE_PROPS),hr="docProps/app.xml",!(ar.Props&&ar.Props.SheetNames))if(!ar.Workbook||!ar.Workbook.Sheets)ar.Props.SheetNames=ar.SheetNames;else{for(var xr=[],mr=0;mr<ar.SheetNames.length;++mr)(ar.Workbook.Sheets[mr]||{}).Hidden!=2&&xr.push(ar.SheetNames[mr]);ar.Props.SheetNames=xr}ar.Props.Worksheets=ar.Props.SheetNames.length,zip_add_file(dr,hr,write_ext_props(ar.Props)),ur.extprops.push(hr),add_rels(or.rels,3,hr,RELS.EXT_PROPS),ar.Custprops!==ar.Props&&keys(ar.Custprops||{}).length>0&&(hr="docProps/custom.xml",zip_add_file(dr,hr,write_cust_props(ar.Custprops)),ur.custprops.push(hr),add_rels(or.rels,4,hr,RELS.CUST_PROPS));var fr=["SheetJ5"];for(or.tcid=0,pr=1;pr<=ar.SheetNames.length;++pr){var Er={"!id":{}},vr=ar.Sheets[ar.SheetNames[pr-1]],gr=(vr||{})["!type"]||"sheet";switch(gr){case"chart":default:hr="xl/worksheets/sheet"+pr+"."+lr,zip_add_file(dr,hr,write_ws_xml(pr-1,or,ar,Er)),ur.sheets.push(hr),add_rels(or.wbrels,-1,"worksheets/sheet"+pr+"."+lr,RELS.WS[0])}if(vr){var yr=vr["!comments"],jr=!1,br="";if(yr&&yr.length>0){var _r=!1;yr.forEach(function(wr){wr[1].forEach(function(Rr){Rr.T==!0&&(_r=!0)})}),_r&&(br="xl/threadedComments/threadedComment"+pr+"."+lr,zip_add_file(dr,br,write_tcmnt_xml(yr,fr,or)),ur.threadedcomments.push(br),add_rels(Er,-1,"../threadedComments/threadedComment"+pr+"."+lr,RELS.TCMNT)),br="xl/comments"+pr+"."+lr,zip_add_file(dr,br,write_comments_xml(yr)),ur.comments.push(br),add_rels(Er,-1,"../comments"+pr+"."+lr,RELS.CMNT),jr=!0}vr["!legacy"]&&jr&&zip_add_file(dr,"xl/drawings/vmlDrawing"+pr+".vml",write_comments_vml(pr,vr["!comments"])),delete vr["!comments"],delete vr["!legacy"]}Er["!id"].rId1&&zip_add_file(dr,get_rels_path(hr),write_rels(Er))}return or.Strings!=null&&or.Strings.length>0&&(hr="xl/sharedStrings."+lr,zip_add_file(dr,hr,write_sst_xml(or.Strings,or)),ur.strs.push(hr),add_rels(or.wbrels,-1,"sharedStrings."+lr,RELS.SST)),hr="xl/workbook."+lr,zip_add_file(dr,hr,write_wb_xml(ar)),ur.workbooks.push(hr),add_rels(or.rels,1,hr,RELS.WB),hr="xl/theme/theme1.xml",zip_add_file(dr,hr,write_theme(ar.Themes,or)),ur.themes.push(hr),add_rels(or.wbrels,-1,"theme/theme1.xml",RELS.THEME),hr="xl/styles."+lr,zip_add_file(dr,hr,write_sty_xml(ar,or)),ur.styles.push(hr),add_rels(or.wbrels,-1,"styles."+lr,RELS.STY),ar.vbaraw&&cr&&(hr="xl/vbaProject.bin",zip_add_file(dr,hr,ar.vbaraw),ur.vba.push(hr),add_rels(or.wbrels,-1,"vbaProject.bin",RELS.VBA)),hr="xl/metadata."+lr,zip_add_file(dr,hr,write_xlmeta_xml()),ur.metadata.push(hr),add_rels(or.wbrels,-1,"metadata."+lr,RELS.XLMETA),fr.length>1&&(hr="xl/persons/person.xml",zip_add_file(dr,hr,write_people_xml(fr)),ur.people.push(hr),add_rels(or.wbrels,-1,"persons/person.xml",RELS.PEOPLE)),zip_add_file(dr,"[Content_Types].xml",write_ct(ur,or)),zip_add_file(dr,"_rels/.rels",write_rels(or.rels)),zip_add_file(dr,"xl/_rels/workbook."+lr+".rels",write_rels(or.wbrels)),delete or.revssf,delete or.ssf,dr}function firstbyte(ar,or){var lr="";switch((or||{}).type||"base64"){case"buffer":return[ar[0],ar[1],ar[2],ar[3],ar[4],ar[5],ar[6],ar[7]];case"base64":lr=Base64_decode(ar.slice(0,12));break;case"binary":lr=ar;break;case"array":return[ar[0],ar[1],ar[2],ar[3],ar[4],ar[5],ar[6],ar[7]];default:throw new Error("Unrecognized type "+(or&&or.type||"undefined"))}return[lr.charCodeAt(0),lr.charCodeAt(1),lr.charCodeAt(2),lr.charCodeAt(3),lr.charCodeAt(4),lr.charCodeAt(5),lr.charCodeAt(6),lr.charCodeAt(7)]}function write_cfb_ctr(ar,or){switch(or.type){case"base64":case"binary":break;case"buffer":case"array":or.type="";break;case"file":return write_dl(or.file,CFB.write(ar,{type:has_buf?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+or.bookType+"' files");default:throw new Error("Unrecognized type "+or.type)}return CFB.write(ar,or)}function write_zip_type(ar,or){var lr=dup(or||{}),cr=write_zip(ar,lr);return write_zip_denouement(cr,lr)}function write_zip_denouement(ar,or){var lr={},cr=has_buf?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(or.compression&&(lr.compression="DEFLATE"),or.password)lr.type=cr;else switch(or.type){case"base64":lr.type="base64";break;case"binary":lr.type="string";break;case"string":throw new Error("'string' output type invalid for '"+or.bookType+"' files");case"buffer":case"file":lr.type=cr;break;default:throw new Error("Unrecognized type "+or.type)}var ur=ar.FullPaths?CFB.write(ar,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[lr.type]||lr.type,compression:!!or.compression}):ar.generate(lr);if(typeof Deno<"u"&&typeof ur=="string"){if(or.type=="binary"||or.type=="base64")return ur;ur=new Uint8Array(s2ab(ur))}return or.password&&typeof encrypt_agile<"u"?write_cfb_ctr(encrypt_agile(ur,or.password),or):or.type==="file"?write_dl(or.file,ur):or.type=="string"?utf8read(ur):ur}function write_cfb_type(ar,or){var lr=or||{},cr=write_xlscfb(ar,lr);return write_cfb_ctr(cr,lr)}function write_string_type(ar,or,lr){lr||(lr="");var cr=lr+ar;switch(or.type){case"base64":return Base64_encode(utf8write(cr));case"binary":return utf8write(cr);case"string":return ar;case"file":return write_dl(or.file,cr,"utf8");case"buffer":return has_buf?Buffer_from(cr,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(cr):write_string_type(cr,{type:"binary"}).split("").map(function(ur){return ur.charCodeAt(0)})}throw new Error("Unrecognized type "+or.type)}function write_stxt_type(ar,or){switch(or.type){case"base64":return Base64_encode(ar);case"binary":return ar;case"string":return ar;case"file":return write_dl(or.file,ar,"binary");case"buffer":return has_buf?Buffer_from(ar,"binary"):ar.split("").map(function(lr){return lr.charCodeAt(0)})}throw new Error("Unrecognized type "+or.type)}function write_binary_type(ar,or){switch(or.type){case"string":case"base64":case"binary":for(var lr="",cr=0;cr<ar.length;++cr)lr+=String.fromCharCode(ar[cr]);return or.type=="base64"?Base64_encode(lr):or.type=="string"?utf8read(lr):lr;case"file":return write_dl(or.file,ar);case"buffer":return ar;default:throw new Error("Unrecognized type "+or.type)}}function writeSync(ar,or){reset_cp(),check_wb(ar);var lr=dup(or||{});if(lr.cellStyles&&(lr.cellNF=!0,lr.sheetStubs=!0),lr.type=="array"){lr.type="binary";var cr=writeSync(ar,lr);return lr.type="array",s2ab(cr)}var ur=0;if(lr.sheet&&(typeof lr.sheet=="number"?ur=lr.sheet:ur=ar.SheetNames.indexOf(lr.sheet),!ar.SheetNames[ur]))throw new Error("Sheet not found: "+lr.sheet+" : "+typeof lr.sheet);switch(lr.bookType||"xlsb"){case"xml":case"xlml":return write_string_type(write_xlml(ar,lr),lr);case"slk":case"sylk":return write_string_type(SYLK.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"htm":case"html":return write_string_type(sheet_to_html(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"txt":return write_stxt_type(sheet_to_txt(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"csv":return write_string_type(sheet_to_csv(ar.Sheets[ar.SheetNames[ur]],lr),lr,"\uFEFF");case"dif":return write_string_type(DIF.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"dbf":return write_binary_type(DBF.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"prn":return write_string_type(PRN.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"rtf":return write_string_type(RTF.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"eth":return write_string_type(ETH.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"fods":return write_string_type(write_ods(ar,lr),lr);case"wk1":return write_binary_type(WK_.sheet_to_wk1(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"wk3":return write_binary_type(WK_.book_to_wk3(ar,lr),lr);case"biff2":lr.biff||(lr.biff=2);case"biff3":lr.biff||(lr.biff=3);case"biff4":return lr.biff||(lr.biff=4),write_binary_type(write_biff_buf(ar,lr),lr);case"biff5":lr.biff||(lr.biff=5);case"biff8":case"xla":case"xls":return lr.biff||(lr.biff=8),write_cfb_type(ar,lr);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return write_zip_type(ar,lr);default:throw new Error("Unrecognized bookType |"+lr.bookType+"|")}}function make_json_row(ar,or,lr,cr,ur,dr,hr,pr){var xr=encode_row(lr),mr=pr.defval,fr=pr.raw||!Object.prototype.hasOwnProperty.call(pr,"raw"),Er=!0,vr=ur===1?[]:{};if(ur!==1)if(Object.defineProperty)try{Object.defineProperty(vr,"__rowNum__",{value:lr,enumerable:!1})}catch{vr.__rowNum__=lr}else vr.__rowNum__=lr;if(!hr||ar[lr])for(var gr=or.s.c;gr<=or.e.c;++gr){var yr=hr?ar[lr][gr]:ar[cr[gr]+xr];if(yr===void 0||yr.t===void 0){if(mr===void 0)continue;dr[gr]!=null&&(vr[dr[gr]]=mr);continue}var jr=yr.v;switch(yr.t){case"z":if(jr==null)break;continue;case"e":jr=jr==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+yr.t)}if(dr[gr]!=null){if(jr==null)if(yr.t=="e"&&jr===null)vr[dr[gr]]=null;else if(mr!==void 0)vr[dr[gr]]=mr;else if(fr&&jr===null)vr[dr[gr]]=null;else continue;else vr[dr[gr]]=fr&&(yr.t!=="n"||yr.t==="n"&&pr.rawNumbers!==!1)?jr:format_cell(yr,jr,pr);jr!=null&&(Er=!1)}}return{row:vr,isempty:Er}}function sheet_to_json(ar,or){if(ar==null||ar["!ref"]==null)return[];var lr={t:"n",v:0},cr=0,ur=1,dr=[],hr=0,pr="",xr={s:{r:0,c:0},e:{r:0,c:0}},mr=or||{},fr=mr.range!=null?mr.range:ar["!ref"];switch(mr.header===1?cr=1:mr.header==="A"?cr=2:Array.isArray(mr.header)?cr=3:mr.header==null&&(cr=0),typeof fr){case"string":xr=safe_decode_range(fr);break;case"number":xr=safe_decode_range(ar["!ref"]),xr.s.r=fr;break;default:xr=fr}cr>0&&(ur=0);var Er=encode_row(xr.s.r),vr=[],gr=[],yr=0,jr=0,br=Array.isArray(ar),_r=xr.s.r,wr=0,Rr={};br&&!ar[_r]&&(ar[_r]=[]);var Ar=mr.skipHidden&&ar["!cols"]||[],Sr=mr.skipHidden&&ar["!rows"]||[];for(wr=xr.s.c;wr<=xr.e.c;++wr)if(!(Ar[wr]||{}).hidden)switch(vr[wr]=encode_col(wr),lr=br?ar[_r][wr]:ar[vr[wr]+Er],cr){case 1:dr[wr]=wr-xr.s.c;break;case 2:dr[wr]=vr[wr];break;case 3:dr[wr]=mr.header[wr-xr.s.c];break;default:if(lr==null&&(lr={w:"__EMPTY",t:"s"}),pr=hr=format_cell(lr,null,mr),jr=Rr[hr]||0,!jr)Rr[hr]=1;else{do pr=hr+"_"+jr++;while(Rr[pr]);Rr[hr]=jr,Rr[pr]=1}dr[wr]=pr}for(_r=xr.s.r+ur;_r<=xr.e.r;++_r)if(!(Sr[_r]||{}).hidden){var kr=make_json_row(ar,xr,_r,vr,cr,dr,br,mr);(kr.isempty===!1||(cr===1?mr.blankrows!==!1:mr.blankrows))&&(gr[yr++]=kr.row)}return gr.length=yr,gr}var qreg=/"/g;function make_csv_row(ar,or,lr,cr,ur,dr,hr,pr){for(var xr=!0,mr=[],fr="",Er=encode_row(lr),vr=or.s.c;vr<=or.e.c;++vr)if(cr[vr]){var gr=pr.dense?(ar[lr]||[])[vr]:ar[cr[vr]+Er];if(gr==null)fr="";else if(gr.v!=null){xr=!1,fr=""+(pr.rawNumbers&&gr.t=="n"?gr.v:format_cell(gr,null,pr));for(var yr=0,jr=0;yr!==fr.length;++yr)if((jr=fr.charCodeAt(yr))===ur||jr===dr||jr===34||pr.forceQuotes){fr='"'+fr.replace(qreg,'""')+'"';break}fr=="ID"&&(fr='"ID"')}else gr.f!=null&&!gr.F?(xr=!1,fr="="+gr.f,fr.indexOf(",")>=0&&(fr='"'+fr.replace(qreg,'""')+'"')):fr="";mr.push(fr)}return pr.blankrows===!1&&xr?null:mr.join(hr)}function sheet_to_csv(ar,or){var lr=[],cr=or??{};if(ar==null||ar["!ref"]==null)return"";var ur=safe_decode_range(ar["!ref"]),dr=cr.FS!==void 0?cr.FS:",",hr=dr.charCodeAt(0),pr=cr.RS!==void 0?cr.RS:`
`,xr=pr.charCodeAt(0),mr=new RegExp((dr=="|"?"\\|":dr)+"+$"),fr="",Er=[];cr.dense=Array.isArray(ar);for(var vr=cr.skipHidden&&ar["!cols"]||[],gr=cr.skipHidden&&ar["!rows"]||[],yr=ur.s.c;yr<=ur.e.c;++yr)(vr[yr]||{}).hidden||(Er[yr]=encode_col(yr));for(var jr=0,br=ur.s.r;br<=ur.e.r;++br)(gr[br]||{}).hidden||(fr=make_csv_row(ar,ur,br,Er,hr,xr,dr,cr),fr!=null&&(cr.strip&&(fr=fr.replace(mr,"")),(fr||cr.blankrows!==!1)&&lr.push((jr++?pr:"")+fr)));return delete cr.dense,lr.join("")}function sheet_to_txt(ar,or){or||(or={}),or.FS="	",or.RS=`
`;var lr=sheet_to_csv(ar,or);return lr}function sheet_to_formulae(ar){var or="",lr,cr="";if(ar==null||ar["!ref"]==null)return[];var ur=safe_decode_range(ar["!ref"]),dr="",hr=[],pr,xr=[],mr=Array.isArray(ar);for(pr=ur.s.c;pr<=ur.e.c;++pr)hr[pr]=encode_col(pr);for(var fr=ur.s.r;fr<=ur.e.r;++fr)for(dr=encode_row(fr),pr=ur.s.c;pr<=ur.e.c;++pr)if(or=hr[pr]+dr,lr=mr?(ar[fr]||[])[pr]:ar[or],cr="",lr!==void 0){if(lr.F!=null){if(or=lr.F,!lr.f)continue;cr=lr.f,or.indexOf(":")==-1&&(or=or+":"+or)}if(lr.f!=null)cr=lr.f;else{if(lr.t=="z")continue;if(lr.t=="n"&&lr.v!=null)cr=""+lr.v;else if(lr.t=="b")cr=lr.v?"TRUE":"FALSE";else if(lr.w!==void 0)cr="'"+lr.w;else{if(lr.v===void 0)continue;lr.t=="s"?cr="'"+lr.v:cr=""+lr.v}}xr[xr.length]=or+"="+cr}return xr}function sheet_add_json(ar,or,lr){var cr=lr||{},ur=+!cr.skipHeader,dr=ar||{},hr=0,pr=0;if(dr&&cr.origin!=null)if(typeof cr.origin=="number")hr=cr.origin;else{var xr=typeof cr.origin=="string"?decode_cell(cr.origin):cr.origin;hr=xr.r,pr=xr.c}var mr,fr={s:{c:0,r:0},e:{c:pr,r:hr+or.length-1+ur}};if(dr["!ref"]){var Er=safe_decode_range(dr["!ref"]);fr.e.c=Math.max(fr.e.c,Er.e.c),fr.e.r=Math.max(fr.e.r,Er.e.r),hr==-1&&(hr=Er.e.r+1,fr.e.r=hr+or.length-1+ur)}else hr==-1&&(hr=0,fr.e.r=or.length-1+ur);var vr=cr.header||[],gr=0;or.forEach(function(jr,br){keys(jr).forEach(function(_r){(gr=vr.indexOf(_r))==-1&&(vr[gr=vr.length]=_r);var wr=jr[_r],Rr="z",Ar="",Sr=encode_cell({c:pr+gr,r:hr+br+ur});mr=ws_get_cell_stub(dr,Sr),wr&&typeof wr=="object"&&!(wr instanceof Date)?dr[Sr]=wr:(typeof wr=="number"?Rr="n":typeof wr=="boolean"?Rr="b":typeof wr=="string"?Rr="s":wr instanceof Date?(Rr="d",cr.cellDates||(Rr="n",wr=datenum(wr)),Ar=cr.dateNF||table_fmt[14]):wr===null&&cr.nullError&&(Rr="e",wr=0),mr?(mr.t=Rr,mr.v=wr,delete mr.w,delete mr.R,Ar&&(mr.z=Ar)):dr[Sr]=mr={t:Rr,v:wr},Ar&&(mr.z=Ar))})}),fr.e.c=Math.max(fr.e.c,pr+vr.length-1);var yr=encode_row(hr);if(ur)for(gr=0;gr<vr.length;++gr)dr[encode_col(gr+pr)+yr]={t:"s",v:vr[gr]};return dr["!ref"]=encode_range(fr),dr}function json_to_sheet(ar,or){return sheet_add_json(null,ar,or)}function ws_get_cell_stub(ar,or,lr){if(typeof or=="string"){if(Array.isArray(ar)){var cr=decode_cell(or);return ar[cr.r]||(ar[cr.r]=[]),ar[cr.r][cr.c]||(ar[cr.r][cr.c]={t:"z"})}return ar[or]||(ar[or]={t:"z"})}return typeof or!="number"?ws_get_cell_stub(ar,encode_cell(or)):ws_get_cell_stub(ar,encode_cell({r:or,c:lr||0}))}function wb_sheet_idx(ar,or){if(typeof or=="number"){if(or>=0&&ar.SheetNames.length>or)return or;throw new Error("Cannot find sheet # "+or)}else if(typeof or=="string"){var lr=ar.SheetNames.indexOf(or);if(lr>-1)return lr;throw new Error("Cannot find sheet name |"+or+"|")}else throw new Error("Cannot find sheet |"+or+"|")}function book_new(){return{SheetNames:[],Sheets:{}}}function book_append_sheet(ar,or,lr,cr){var ur=1;if(!lr)for(;ur<=65535&&ar.SheetNames.indexOf(lr="Sheet"+ur)!=-1;++ur,lr=void 0);if(!lr||ar.SheetNames.length>=65535)throw new Error("Too many worksheets");if(cr&&ar.SheetNames.indexOf(lr)>=0){var dr=lr.match(/(^.*?)(\d+)$/);ur=dr&&+dr[2]||0;var hr=dr&&dr[1]||lr;for(++ur;ur<=65535&&ar.SheetNames.indexOf(lr=hr+ur)!=-1;++ur);}if(check_ws_name(lr),ar.SheetNames.indexOf(lr)>=0)throw new Error("Worksheet with name |"+lr+"| already exists!");return ar.SheetNames.push(lr),ar.Sheets[lr]=or,lr}function book_set_sheet_visibility(ar,or,lr){ar.Workbook||(ar.Workbook={}),ar.Workbook.Sheets||(ar.Workbook.Sheets=[]);var cr=wb_sheet_idx(ar,or);switch(ar.Workbook.Sheets[cr]||(ar.Workbook.Sheets[cr]={}),lr){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+lr)}ar.Workbook.Sheets[cr].Hidden=lr}function cell_set_number_format(ar,or){return ar.z=or,ar}function cell_set_hyperlink(ar,or,lr){return or?(ar.l={Target:or},lr&&(ar.l.Tooltip=lr)):delete ar.l,ar}function cell_set_internal_link(ar,or,lr){return cell_set_hyperlink(ar,"#"+or,lr)}function cell_add_comment(ar,or,lr){ar.c||(ar.c=[]),ar.c.push({t:or,a:lr||"SheetJS"})}function sheet_set_array_formula(ar,or,lr,cr){for(var ur=typeof or!="string"?or:safe_decode_range(or),dr=typeof or=="string"?or:encode_range(or),hr=ur.s.r;hr<=ur.e.r;++hr)for(var pr=ur.s.c;pr<=ur.e.c;++pr){var xr=ws_get_cell_stub(ar,hr,pr);xr.t="n",xr.F=dr,delete xr.v,hr==ur.s.r&&pr==ur.s.c&&(xr.f=lr,cr&&(xr.D=!0))}return ar}var utils={encode_col,encode_row,encode_cell,encode_range,decode_col,decode_row,split_cell,decode_cell,decode_range,format_cell,sheet_add_aoa,sheet_add_json,sheet_add_dom,aoa_to_sheet,json_to_sheet,table_to_sheet:parse_dom_table,table_to_book,sheet_to_csv,sheet_to_txt,sheet_to_json,sheet_to_html,sheet_to_formulae,sheet_to_row_object_array:sheet_to_json,sheet_get_cell:ws_get_cell_stub,book_new,book_append_sheet,book_set_sheet_visibility,cell_set_number_format,cell_set_hyperlink,cell_set_internal_link,cell_add_comment,sheet_set_array_formula,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function generateContinuityBiblePDF(ar,or,lr){const cr=(lr==null?void 0:lr.preparedBy)||"Hair & Makeup Department",ur=(lr==null?void 0:lr.firstShootDate)||new Date,dr=(lr==null?void 0:lr.lastShootDate)||new Date,hr=ar.characters.map(gr=>{const yr=ar.looks.filter(jr=>jr.characterId===gr.id);return generateCharacterSection(gr,yr,ar.scenes,or)}).join(""),pr=ar.scenes.sort((gr,yr)=>gr.sceneNumber.localeCompare(yr.sceneNumber,void 0,{numeric:!0})),xr=pr.map(gr=>generateSceneSection(gr,ar.characters,ar.looks,or)).join(""),mr=ar.characters.map(gr=>`<li><a href="#character-${gr.id}">${gr.name}</a></li>`).join(""),fr=pr.map(gr=>`<li><a href="#scene-${gr.id}">Sc ${gr.sceneNumber}  ${gr.slugline||"Untitled"}</a></li>`).join(""),Er=ar.looks.length,vr=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>${ar.name} - Continuity Bible</title>
      <style>
        @media print {
          .page-break { page-break-before: always; }
          .no-break { page-break-inside: avoid; }
          .no-print { display: none; }
          body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          padding: 0;
          max-width: 900px;
          margin: 0 auto;
          color: #2c2c2c;
          line-height: 1.5;
          font-size: 13px;
        }

        /*  Cover Page  */
        .cover-page {
          text-align: center;
          min-height: 95vh;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          padding: 60px 40px;
        }
        .cover-rule { width: 80px; height: 3px; background: #C9A962; margin: 0 auto 40px; }
        .cover-title { font-size: 38px; font-weight: 700; color: #1a1a1a; letter-spacing: -0.5px; margin-bottom: 6px; }
        .cover-subtitle { font-size: 18px; font-weight: 400; color: #C9A962; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 50px; }
        .cover-stats { display: flex; gap: 40px; justify-content: center; margin-bottom: 50px; }
        .cover-stat { text-align: center; }
        .cover-stat-value { font-size: 28px; font-weight: 700; color: #C9A962; display: block; }
        .cover-stat-label { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .cover-meta { font-size: 12px; color: #999; line-height: 1.8; }
        .cover-meta strong { color: #666; }

        /*  Section Headings  */
        .section-heading {
          font-size: 22px;
          font-weight: 700;
          color: #1a1a1a;
          margin: 0 0 6px 0;
          padding: 30px 40px 0;
        }
        .section-heading-rule { width: 50px; height: 3px; background: #C9A962; margin: 0 0 30px 40px; }

        /*  Table of Contents  */
        .toc { padding: 30px 40px; }
        .toc h2 { font-size: 22px; font-weight: 700; color: #1a1a1a; margin-bottom: 4px; }
        .toc-rule { width: 50px; height: 3px; background: #C9A962; margin-bottom: 30px; }
        .toc h3 { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: #C9A962; margin-bottom: 10px; }
        .toc ul { list-style: none; padding: 0; margin: 0 0 24px 0; }
        .toc li { padding: 3px 0; font-size: 12px; border-bottom: 1px dotted #e5e5e5; }
        .toc li:last-child { border-bottom: none; }
        .toc a { color: #444; text-decoration: none; }
        .toc a:hover { color: #C9A962; }
        .toc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .toc-scenes-list { columns: 2; column-gap: 24px; }
        .toc-scenes-list li { break-inside: avoid; }

        /*  Character Section  */
        .character-section { padding: 0 40px; margin-bottom: 20px; page-break-inside: avoid; }
        .character-header {
          background: linear-gradient(135deg, #C9A962, #B8975A);
          color: white;
          padding: 16px 20px;
          border-radius: 8px 8px 0 0;
        }
        .character-name { font-size: 20px; font-weight: 700; margin: 0; }
        .character-look-count { font-size: 12px; opacity: 0.85; margin-top: 2px; }

        /*  Look Card  */
        .look-section {
          border: 1px solid #e0e0e0;
          border-top: none;
          padding: 20px;
          margin-bottom: 0;
          page-break-inside: avoid;
        }
        .look-section:last-child { border-radius: 0 0 8px 8px; }
        .look-header {
          display: flex;
          justify-content: space-between;
          align-items: baseline;
          margin-bottom: 14px;
          padding-bottom: 10px;
          border-bottom: 1px solid #f0f0f0;
        }
        .look-name { font-size: 16px; font-weight: 600; color: #1a1a1a; }
        .look-scenes { font-size: 11px; color: #777; margin-top: 2px; }
        .look-time {
          font-size: 11px;
          color: #C9A962;
          font-weight: 500;
          white-space: nowrap;
        }

        /*  Photo Grid  */
        .photo-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 8px;
          margin: 0 0 16px;
          page-break-inside: avoid;
        }
        .photo-placeholder {
          aspect-ratio: 3/4;
          background: #fafafa;
          border: 1px dashed #d5d5d5;
          border-radius: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 10px;
          color: #bbb;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }
        .photo-img {
          width: 100%;
          aspect-ratio: 3/4;
          object-fit: cover;
          border-radius: 4px;
        }
        .master-photo {
          grid-column: span 2;
          grid-row: span 2;
        }
        .master-photo .photo-img,
        .master-photo .photo-placeholder {
          aspect-ratio: auto;
          height: 100%;
        }

        /*  Details Tables  */
        .details-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          margin-top: 16px;
        }
        .details-section h4 {
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1.5px;
          color: #C9A962;
          font-weight: 600;
          margin: 0 0 8px 0;
          padding-bottom: 6px;
          border-bottom: 1px solid #f0f0f0;
        }
        .details-table { width: 100%; font-size: 12px; border-collapse: collapse; }
        .details-table td { padding: 3px 0; vertical-align: top; }
        .details-table td:first-child { color: #888; width: 42%; }
        .details-table td:last-child { color: #2c2c2c; font-weight: 500; }

        /*  Notes  */
        .notes-section {
          margin-top: 14px;
          padding: 10px 14px;
          background: #f8f8f8;
          border-radius: 6px;
          border-left: 3px solid #C9A962;
        }
        .notes-section h4 {
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
          color: #888;
          margin: 0 0 6px 0;
        }
        .notes-section p { font-size: 12px; color: #555; margin: 0; }

        /*  Scene Section  */
        .scene-section {
          margin: 0 40px 16px;
          border: 1px solid #e0e0e0;
          border-radius: 8px;
          overflow: hidden;
          page-break-inside: avoid;
        }
        .scene-header {
          background: #f7f7f7;
          padding: 12px 16px;
          border-bottom: 1px solid #e0e0e0;
        }
        .scene-number {
          font-size: 11px;
          color: #C9A962;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 1px;
        }
        .scene-slugline { font-size: 15px; font-weight: 600; color: #1a1a1a; margin: 4px 0 0; }
        .scene-synopsis { font-size: 12px; color: #777; margin-top: 4px; }
        .scene-content { padding: 14px 16px; }
        .scene-content h4 {
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
          color: #999;
          margin: 0 0 10px;
        }
        .scene-characters { display: flex; flex-wrap: wrap; gap: 8px; }
        .scene-character-card {
          flex: 1;
          min-width: 180px;
          padding: 10px 12px;
          background: #fafafa;
          border: 1px solid #eee;
          border-radius: 6px;
        }
        .scene-character-name { font-weight: 600; font-size: 13px; color: #1a1a1a; }
        .scene-character-look { font-size: 11px; color: #777; margin-top: 2px; }

        /*  Continuity Flags  */
        .flags-list { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .flag-badge {
          padding: 3px 8px;
          border-radius: 10px;
          font-size: 10px;
          font-weight: 600;
          letter-spacing: 0.3px;
        }
        .flag-sweat { background: #e3f2fd; color: #1565c0; }
        .flag-dishevelled { background: #fff3e0; color: #ef6c00; }
        .flag-blood { background: #ffebee; color: #c62828; }
        .flag-dirt { background: #efebe9; color: #5d4037; }
        .flag-wetHair { background: #e0f7fa; color: #00838f; }
        .flag-tears { background: #e8eaf6; color: #3949ab; }

        /*  SFX  */
        .sfx-section {
          margin-top: 14px;
          padding: 10px 14px;
          background: #fffbf0;
          border: 1px solid #f0e0b0;
          border-radius: 6px;
        }
        .sfx-section h4 {
          color: #d48806;
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
          margin: 0 0 6px 0;
        }
      </style>
    </head>
    <body>
      <!-- Cover Page -->
      <div class="cover-page">
        <div class="cover-rule"></div>
        <h1 class="cover-title">${ar.name}</h1>
        <h2 class="cover-subtitle">Continuity Bible</h2>
        <div class="cover-stats">
          <div class="cover-stat">
            <span class="cover-stat-value">${ar.scenes.length}</span>
            <span class="cover-stat-label">Scenes</span>
          </div>
          <div class="cover-stat">
            <span class="cover-stat-value">${ar.characters.length}</span>
            <span class="cover-stat-label">Characters</span>
          </div>
          <div class="cover-stat">
            <span class="cover-stat-value">${Er}</span>
            <span class="cover-stat-label">Looks</span>
          </div>
        </div>
        <div class="cover-meta">
          <p><strong>Prepared by:</strong> ${cr}</p>
          <p><strong>Production Dates:</strong> ${formatDate(ur)}  ${formatDate(dr)}</p>
          <p><strong>Exported:</strong> ${vr}</p>
        </div>
      </div>

      <div class="page-break"></div>

      <!-- Table of Contents -->
      <div class="toc">
        <h2>Contents</h2>
        <div class="toc-rule"></div>
        <div class="toc-grid">
          <div>
            <h3>Characters (${ar.characters.length})</h3>
            <ul>${mr}</ul>
          </div>
          <div>
            <h3>Scenes (${pr.length})</h3>
            <ul class="toc-scenes-list">${fr}</ul>
          </div>
        </div>
      </div>

      <div class="page-break"></div>

      <!-- Character Sections -->
      <div class="section-heading">Character Reference</div>
      <div class="section-heading-rule"></div>
      ${hr}

      <div class="page-break"></div>

      <!-- Scene Sections -->
      <div class="section-heading">Scene Index</div>
      <div class="section-heading-rule"></div>
      ${xr}
    </body>
    </html>
  `}function generateCharacterSection(ar,or,lr,cr){const ur=or.map(dr=>{var mr;const hr=lr.filter(fr=>dr.scenes.includes(fr.sceneNumber)).map(fr=>fr.sceneNumber).join(", "),pr=Object.keys(cr).find(fr=>fr.includes(ar.id)&&cr[fr].lookId===dr.id),xr=pr?cr[pr]:null;return`
      <div class="look-section">
        <div class="look-header">
          <div>
            <div class="look-name">${dr.name}</div>
            <div class="look-scenes">Scenes: ${hr||"None assigned"}</div>
          </div>
          <div class="look-time">Application Time: ~${dr.estimatedTime} min</div>
        </div>

        <!-- Photos Grid -->
        <div class="photo-grid">
          <div class="master-photo">
            ${dr.masterReference?`<img class="photo-img" src="${dr.masterReference.uri}" alt="Master Reference" />`:'<div class="photo-placeholder">Master Reference<br/>No Photo</div>'}
          </div>
          ${["front","left","right","back"].map(fr=>{const Er=xr==null?void 0:xr.photos[fr];return Er?`<img class="photo-img" src="${Er.uri}" alt="${fr}" />`:`<div class="photo-placeholder">${fr.charAt(0).toUpperCase()+fr.slice(1)}</div>`}).join("")}
        </div>

        <!-- Details -->
        <div class="details-grid">
          <div class="details-section">
            <h4>Makeup</h4>
            <table class="details-table">
              ${formatMakeupDetails(dr.makeup)}
            </table>
          </div>
          <div class="details-section">
            <h4>Hair</h4>
            <table class="details-table">
              ${formatHairDetails(dr.hair)}
            </table>
          </div>
        </div>

        ${(mr=xr==null?void 0:xr.sfxDetails)!=null&&mr.sfxRequired?`
          <div class="sfx-section">
            <h4>Special Effects</h4>
            <table class="details-table">
              ${formatSFXDetails(xr.sfxDetails)}
            </table>
          </div>
        `:""}

        ${xr!=null&&xr.notes?`
          <div class="notes-section">
            <h4>Notes</h4>
            <p>${xr.notes}</p>
          </div>
        `:""}
      </div>
    `}).join("");return`
    <div class="character-section" id="character-${ar.id}">
      <div class="character-header">
        <h3 class="character-name">${ar.name}</h3>
        <div class="character-look-count">${or.length} Look${or.length!==1?"s":""}</div>
      </div>
      ${ur}
    </div>
  `}function generateSceneSection(ar,or,lr,cr){const dr=or.filter(hr=>ar.characters.includes(hr.id)).map(hr=>{const pr=lr.find(Er=>Er.characterId===hr.id&&Er.scenes.includes(ar.sceneNumber)),xr=`${ar.id}-${hr.id}`,mr=cr[xr],fr=mr?formatContinuityFlags(mr.continuityFlags):"";return`
      <div class="scene-character-card">
        <div class="scene-character-name">${hr.name}</div>
        <div class="scene-character-look">${(pr==null?void 0:pr.name)||"No Look Assigned"}</div>
        ${fr?`<div class="flags-list">${fr}</div>`:""}
      </div>
    `}).join("");return`
    <div class="scene-section" id="scene-${ar.id}">
      <div class="scene-header">
        <div class="scene-number">SCENE ${ar.sceneNumber}</div>
        <div class="scene-slugline">${ar.intExt}. ${ar.slugline} - ${ar.timeOfDay}</div>
        ${ar.synopsis?`<div class="scene-synopsis">${ar.synopsis}</div>`:""}
      </div>
      <div class="scene-content">
        <h4 style="font-size: 12px; color: #666; margin: 0 0 10px;">Characters in Scene:</h4>
        <div class="scene-characters">
          ${dr||'<p style="color: #999; font-size: 13px;">No characters assigned</p>'}
        </div>
      </div>
    </div>
  `}const BREAKDOWN_GROUP_HEADERS=[{label:"Scene",span:4},{label:"Character",span:2},{label:"Makeup",span:7},{label:"Hair",span:5},{label:"SFX",span:1},{label:"Continuity Events",span:1},{label:"Notes & Status",span:3}],BREAKDOWN_HEADERS=["Scene #","INT/EXT","Slugline","Time of Day","Character","Look","Base","Concealer","Contour & Highlight","Blush","Brows","Eyes","Lips","Style & Parting","Products","Pieces & Pins","Accessories","Wig Details","SFX","Continuity Events","Flags","Notes","Status"];function joinParts(ar,or=", "){return ar.filter(Boolean).join(or)}function formatMakeupGroups(ar){return[joinParts([ar.foundation&&`Foundation: ${ar.foundation}`,ar.coverage&&`Coverage: ${ar.coverage}`]),joinParts([ar.concealer&&`${ar.concealer}`,ar.concealerPlacement&&`(${ar.concealerPlacement})`]," "),joinParts([ar.contour&&`Contour: ${ar.contour}`,ar.contourPlacement&&`(${ar.contourPlacement})`,ar.highlight&&`Highlight: ${ar.highlight}`,ar.highlightPlacement&&`(${ar.highlightPlacement})`]," | "),joinParts([ar.blush&&`${ar.blush}`,ar.blushPlacement&&`(${ar.blushPlacement})`]," "),joinParts([ar.browProduct&&`Product: ${ar.browProduct}`,ar.browShape&&`Shape: ${ar.browShape}`]),joinParts([ar.eyePrimer&&`Primer: ${ar.eyePrimer}`,ar.lidColour&&`Lid: ${ar.lidColour}`,ar.creaseColour&&`Crease: ${ar.creaseColour}`,ar.outerV&&`Outer V: ${ar.outerV}`,ar.liner&&`Liner: ${ar.liner}`,ar.lashes&&`Lashes: ${ar.lashes}`]),joinParts([ar.lipLiner&&`Liner: ${ar.lipLiner}`,ar.lipColour&&`Colour: ${ar.lipColour}`])]}function formatHairGroups(ar){var or;return[joinParts([ar.style,ar.parting&&`Parting: ${ar.parting}`]),ar.products||"",joinParts([ar.piecesOut&&`Pieces out: ${ar.piecesOut}`,ar.pins&&`Pins: ${ar.pins}`]),ar.accessories||"",ar.hairType==="Wig"?joinParts([ar.wigNameId&&`Name: ${ar.wigNameId}`,ar.wigType&&`Type: ${ar.wigType}`,ar.wigCapMethod&&`Cap: ${ar.wigCapMethod}`,(or=ar.wigAttachment)!=null&&or.length?`Attachment: ${ar.wigAttachment.join(", ")}`:null,ar.hairline&&`Hairline: ${ar.hairline}`,ar.laceTint&&`Lace tint: ${ar.laceTint}`,ar.edgesBabyHairs&&`Edges: ${ar.edgesBabyHairs}`]," | "):""]}function formatSFX(ar){var or;return ar.sfxRequired?joinParts([ar.sfxTypes.length?`Types: ${ar.sfxTypes.join(", ")}`:null,ar.prostheticPieces&&`Prosthetics: ${ar.prostheticPieces}`,ar.prostheticAdhesive&&`Adhesive: ${ar.prostheticAdhesive}`,(or=ar.bloodTypes)!=null&&or.length?`Blood: ${ar.bloodTypes.join(", ")}`:null,ar.bloodProducts&&`Blood products: ${ar.bloodProducts}`,ar.bloodPlacement&&`Placement: ${ar.bloodPlacement}`,ar.tattooCoverage&&`Tattoo coverage: ${ar.tattooCoverage}`,ar.temporaryTattoos&&`Temp tattoos: ${ar.temporaryTattoos}`,ar.contactLenses&&`Contacts: ${ar.contactLenses}`,ar.teeth&&`Teeth: ${ar.teeth}`,ar.agingCharacterNotes&&`Aging: ${ar.agingCharacterNotes}`]," | "):""}function formatContinuityEvents(ar,or){const lr=ar.filter(cr=>cr.scenes&&cr.scenes.includes(or)||!cr.scenes&&cr.sceneRange);return lr.length?lr.map(cr=>{const ur=[cr.type,cr.name];return cr.stage&&ur.push(`Stage: ${cr.stage}`),cr.description&&ur.push(cr.description),ur.join(" - ")}).join("; "):""}function formatFlags(ar){return Object.entries(ar).filter(([lr,cr])=>cr).map(([lr])=>lr).join(", ")}function buildBreakdownRows(ar,or){const lr=[],cr=[...ar.scenes].sort((ur,dr)=>ur.sceneNumber.localeCompare(dr.sceneNumber,void 0,{numeric:!0}));for(const ur of cr){const dr=ar.characters.filter(hr=>ur.characters.includes(hr.id));if(dr.length===0){lr.push([ur.sceneNumber,ur.intExt,ur.slugline,ur.timeOfDay,"","","","","","","","","","","","","","","","","","",ur.isComplete?"Complete":"Incomplete"]);continue}for(const hr of dr){const pr=ar.looks.find(wr=>wr.characterId===hr.id&&wr.scenes.includes(ur.sceneNumber)),xr=`${ur.id}-${hr.id}`,mr=or[xr],fr=pr?formatMakeupGroups(pr.makeup):["","","","","","",""],Er=pr?formatHairGroups(pr.hair):["","","","",""],vr=(mr==null?void 0:mr.sfxDetails)||(pr==null?void 0:pr.sfxDetails),gr=vr?formatSFX(vr):"",yr=[...(mr==null?void 0:mr.continuityEvents)||[],...(pr==null?void 0:pr.continuityEvents)||[]],jr=formatContinuityEvents(yr,ur.sceneNumber),br=mr?formatFlags(mr.continuityFlags):pr!=null&&pr.continuityFlags?formatFlags(pr.continuityFlags):"",_r=(mr==null?void 0:mr.notes)||(pr==null?void 0:pr.notes)||"";lr.push([ur.sceneNumber,ur.intExt,ur.slugline,ur.timeOfDay,hr.name,(pr==null?void 0:pr.name)||"",...fr,...Er,gr,jr,br,_r,ur.isComplete?"Complete":"Incomplete"])}}return lr}function generateSceneBreakdownCSV(ar,or){const lr=buildBreakdownRows(ar,or),cr=dr=>dr.includes(",")||dr.includes('"')||dr.includes(`
`)?`"${dr.replace(/"/g,'""')}"`:dr;return[BREAKDOWN_HEADERS.join(","),...lr.map(dr=>dr.map(cr).join(","))].join(`
`)}const GROUP_COLOURS={Scene:{fill:"2C3E50",font:"FFFFFF"},Character:{fill:"8E44AD",font:"FFFFFF"},Makeup:{fill:"E74C3C",font:"FFFFFF"},Hair:{fill:"2980B9",font:"FFFFFF"},SFX:{fill:"D35400",font:"FFFFFF"},"Continuity Events":{fill:"27AE60",font:"FFFFFF"},"Notes & Status":{fill:"7F8C8D",font:"FFFFFF"}};function generateSceneBreakdownXLSX(ar,or){var vr,gr;const lr=buildBreakdownRows(ar,or),cr=utils.book_new(),ur=[];for(const yr of BREAKDOWN_GROUP_HEADERS){ur.push(yr.label);for(let jr=1;jr<yr.span;jr++)ur.push("")}const dr=[ur,BREAKDOWN_HEADERS,...lr],hr=utils.aoa_to_sheet(dr),pr=[];let xr=0;for(const yr of BREAKDOWN_GROUP_HEADERS)yr.span>1&&pr.push({s:{r:0,c:xr},e:{r:0,c:xr+yr.span-1}}),xr+=yr.span;hr["!merges"]=pr;const mr=BREAKDOWN_HEADERS.length,fr=[];for(let yr=0;yr<mr;yr++){const jr=BREAKDOWN_HEADERS[yr];let br=14;jr==="Slugline"?br=28:jr==="Eyes"||jr==="Wig Details"||jr==="SFX"?br=30:jr==="Contour & Highlight"?br=22:jr==="Continuity Events"||jr==="Notes"?br=25:(jr==="Scene #"||jr==="INT/EXT"||jr==="Status")&&(br=10),fr.push({wch:br})}hr["!cols"]=fr,xr=0;for(const yr of BREAKDOWN_GROUP_HEADERS){const jr=utils.encode_cell({r:0,c:xr});hr[jr]||(hr[jr]={v:yr.label,t:"s"}),hr[jr].s={fill:{fgColor:{rgb:((vr=GROUP_COLOURS[yr.label])==null?void 0:vr.fill)||"333333"}},font:{bold:!0,color:{rgb:((gr=GROUP_COLOURS[yr.label])==null?void 0:gr.font)||"FFFFFF"},sz:11},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}},xr+=yr.span}for(let yr=0;yr<mr;yr++){const jr=utils.encode_cell({r:1,c:yr});hr[jr]||(hr[jr]={v:BREAKDOWN_HEADERS[yr],t:"s"}),hr[jr].s={fill:{fgColor:{rgb:"ECF0F1"}},font:{bold:!0,sz:10},alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"BDBDBD"}},right:{style:"thin",color:{rgb:"BDBDBD"}}}}}for(let yr=0;yr<lr.length;yr++){const jr=yr%2===0;for(let br=0;br<mr;br++){const _r=utils.encode_cell({r:yr+2,c:br});hr[_r]||(hr[_r]={v:lr[yr][br]||"",t:"s"}),hr[_r].s={fill:{fgColor:{rgb:jr?"FFFFFF":"F7F9FA"}},font:{sz:9},alignment:{vertical:"top",wrapText:!0},border:{top:{style:"thin",color:{rgb:"E0E0E0"}},bottom:{style:"thin",color:{rgb:"E0E0E0"}},left:{style:"thin",color:{rgb:"E0E0E0"}},right:{style:"thin",color:{rgb:"E0E0E0"}}}}}}return hr["!freeze"]={xSplit:6,ySplit:2},utils.book_append_sheet(cr,hr,"Scene Breakdown"),writeSync(cr,{bookType:"xlsx",type:"array",cellStyles:!0})}function generateCharacterLookbookPDF(ar,or,lr,cr){const ur=or.map(dr=>{const hr=lr.filter(mr=>dr.scenes.includes(mr.sceneNumber)).map(mr=>`Scene ${mr.sceneNumber}`).join(", "),pr=Object.keys(cr).find(mr=>mr.includes(ar.id)&&cr[mr].lookId===dr.id),xr=pr?cr[pr]:null;return`
      <div class="look-page">
        <div class="look-header">
          <h2>${dr.name}</h2>
          <p class="scenes-list">${hr||"No scenes assigned"}</p>
          <p class="app-time">Estimated Application: ${dr.estimatedTime} minutes</p>
        </div>

        <div class="photo-section">
          ${dr.masterReference?`<img class="master-photo" src="${dr.masterReference.uri}" alt="Master Reference" />`:'<div class="photo-placeholder master">No Master Reference</div>'}
          <div class="angle-photos">
            ${["front","left","right","back"].map(mr=>{const fr=xr==null?void 0:xr.photos[mr];return fr?`<img src="${fr.uri}" alt="${mr}" />`:`<div class="photo-placeholder">${mr}</div>`}).join("")}
          </div>
        </div>

        <div class="details-section">
          <div class="makeup-details">
            <h3>Makeup</h3>
            ${formatMakeupDetailsHTML(dr.makeup)}
          </div>
          <div class="hair-details">
            <h3>Hair</h3>
            ${formatHairDetailsHTML(dr.hair)}
          </div>
        </div>

        ${xr!=null&&xr.notes?`
          <div class="notes-section">
            <h3>Notes</h3>
            <p>${xr.notes}</p>
          </div>
        `:""}
      </div>
    `}).join('<div class="page-break"></div>');return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>${ar.name} - Lookbook</title>
      <style>
        @media print { .page-break { page-break-before: always; } }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
        .character-cover { text-align: center; padding: 100px 20px; }
        .character-name { font-size: 48px; color: #C9A962; margin-bottom: 10px; }
        .character-subtitle { font-size: 18px; color: #666; }
        .look-page { margin-bottom: 40px; }
        .look-header { margin-bottom: 20px; }
        .look-header h2 { color: #C9A962; margin: 0 0 5px; }
        .scenes-list { color: #666; font-size: 14px; margin: 0; }
        .app-time { color: #999; font-size: 12px; margin: 5px 0 0; }
        .photo-section { display: flex; gap: 20px; margin-bottom: 20px; }
        .master-photo { width: 250px; height: auto; border-radius: 8px; }
        .angle-photos { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; flex: 1; }
        .angle-photos img { width: 100%; border-radius: 4px; }
        .photo-placeholder { background: #f5f5f5; border: 1px dashed #ccc; border-radius: 4px; padding: 40px; text-align: center; color: #999; }
        .photo-placeholder.master { width: 250px; min-height: 300px; display: flex; align-items: center; justify-content: center; }
        .details-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .details-section h3 { font-size: 14px; color: #C9A962; border-bottom: 1px solid #eee; padding-bottom: 5px; margin: 0 0 10px; }
        .detail-row { display: flex; justify-content: space-between; font-size: 12px; padding: 4px 0; border-bottom: 1px solid #f5f5f5; }
        .detail-label { color: #666; }
        .detail-value { color: #333; font-weight: 500; }
        .notes-section { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; }
        .notes-section h3 { font-size: 12px; color: #666; margin: 0 0 8px; }
      </style>
    </head>
    <body>
      <div class="character-cover">
        <h1 class="character-name">${ar.name}</h1>
        <p class="character-subtitle">Hair & Makeup Lookbook</p>
        <p style="color: #999; margin-top: 20px;">${or.length} Look${or.length!==1?"s":""}</p>
      </div>
      <div class="page-break"></div>
      ${ur}
    </body>
    </html>
  `}function formatDate(ar){return new Date(ar).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})}function formatMakeupDetails(ar){return[["Foundation",ar.foundation],["Coverage",ar.coverage],["Concealer",ar.concealer],["Blush",ar.blush],["Lips",ar.lipColour],["Eyes",[ar.lidColour,ar.liner,ar.lashes].filter(Boolean).join(", ")],["Setting",ar.setting]].filter(([lr,cr])=>cr).map(([lr,cr])=>`
    <tr><td>${lr}:</td><td>${cr}</td></tr>
  `).join("")}function formatHairDetails(ar){const or=[["Style",ar.style],["Parting",ar.parting],["Products",ar.products],["Pieces Out",ar.piecesOut],["Accessories",ar.accessories],["Type",ar.hairType!=="Natural"?ar.hairType:null]].filter(([lr,cr])=>cr);return ar.hairType!=="Natural"&&(ar.wigNameId&&or.push(["Wig",ar.wigNameId]),ar.wigType&&or.push(["Wig Type",ar.wigType])),or.map(([lr,cr])=>`
    <tr><td>${lr}:</td><td>${cr}</td></tr>
  `).join("")}function formatSFXDetails(ar){return[["Types",ar.sfxTypes.join(", ")],["Prosthetics",ar.prostheticPieces],["Adhesive",ar.prostheticAdhesive],["Blood Types",ar.bloodTypes.join(", ")],["Blood Products",ar.bloodProducts],["Contact Lenses",ar.contactLenses],["Teeth",ar.teeth]].filter(([lr,cr])=>cr&&cr.length>0).map(([lr,cr])=>`
    <tr><td>${lr}:</td><td>${cr}</td></tr>
  `).join("")}function formatMakeupDetailsHTML(ar){return[["Foundation",ar.foundation],["Coverage",ar.coverage],["Concealer",ar.concealer],["Blush",ar.blush],["Lip Colour",ar.lipColour],["Lid Colour",ar.lidColour],["Liner",ar.liner],["Lashes",ar.lashes],["Setting",ar.setting]].filter(([lr,cr])=>cr).map(([lr,cr])=>`
    <div class="detail-row">
      <span class="detail-label">${lr}</span>
      <span class="detail-value">${cr}</span>
    </div>
  `).join("")}function formatHairDetailsHTML(ar){const or=[["Style",ar.style],["Parting",ar.parting],["Products",ar.products],["Pieces Out",ar.piecesOut],["Pins",ar.pins],["Accessories",ar.accessories],["Type",ar.hairType]].filter(([lr,cr])=>cr);return ar.hairType!=="Natural"&&(ar.wigNameId&&or.push(["Wig ID",ar.wigNameId]),ar.wigType&&or.push(["Wig Type",ar.wigType]),ar.hairline&&or.push(["Hairline",ar.hairline])),or.map(([lr,cr])=>`
    <div class="detail-row">
      <span class="detail-label">${lr}</span>
      <span class="detail-value">${cr}</span>
    </div>
  `).join("")}function formatContinuityFlags(ar){const or=[];return ar.sweat&&or.push('<span class="flag-badge flag-sweat">Sweat</span>'),ar.dishevelled&&or.push('<span class="flag-badge flag-dishevelled">Dishevelled</span>'),ar.blood&&or.push('<span class="flag-badge flag-blood">Blood</span>'),ar.dirt&&or.push('<span class="flag-badge flag-dirt">Dirt</span>'),ar.wetHair&&or.push('<span class="flag-badge flag-wetHair">Wet Hair</span>'),ar.tears&&or.push('<span class="flag-badge flag-tears">Tears</span>'),or.join("")}const exportUtils=Object.freeze(Object.defineProperty({__proto__:null,generateCharacterLookbookPDF,generateContinuityBiblePDF,generateSceneBreakdownCSV,generateSceneBreakdownXLSX},Symbol.toStringTag,{value:"Module"}));function SceneCharacterConfirmation({scene:ar,onClose:or,onConfirm:lr}){var Ar;const{currentProject:cr,confirmSceneCharacters:ur,addCharacterFromScene:dr}=useProjectStore(),[hr,pr]=reactExports.useState(()=>new Set(ar.characters||[])),[xr,mr]=reactExports.useState(()=>{var Nr;const Sr=new Set;return cr&&((Nr=ar.characters)==null||Nr.forEach(Cr=>{const Tr=cr.characters.find(Pr=>Pr.id===Cr);Tr&&Sr.add(Tr.name)})),(ar.suggestedCharacters||[]).forEach(Cr=>Sr.add(Cr)),Sr}),[fr,Er]=reactExports.useState(""),[vr,gr]=reactExports.useState(!1),yr=(cr==null?void 0:cr.characters)||[],jr=reactExports.useMemo(()=>(ar.suggestedCharacters||[]).map(kr=>{const Nr=yr.find(Cr=>Cr.name.toUpperCase()===kr.toUpperCase());return{name:kr,existingCharacter:Nr||null,isInProject:!!Nr}}),[ar.suggestedCharacters,yr]),br=(Sr,kr)=>{mr(Nr=>{const Cr=new Set(Nr);return Cr.has(Sr)?(Cr.delete(Sr),kr&&pr(Tr=>{const Pr=new Set(Tr);return Pr.delete(kr.id),Pr})):(Cr.add(Sr),kr&&pr(Tr=>new Set([...Tr,kr.id]))),Cr})},_r=()=>{const Sr=fr.trim().toUpperCase();if(!Sr)return;if(xr.has(Sr)){Er(""),gr(!1);return}const kr=yr.find(Nr=>Nr.name.toUpperCase()===Sr);kr?pr(Nr=>new Set([...Nr,kr.id])):mr(Nr=>new Set([...Nr,Sr])),Er(""),gr(!1)},wr=()=>{const Sr=new Set(hr);xr.forEach(kr=>{const Nr=yr.find(Cr=>Cr.name.toUpperCase()===kr.toUpperCase());if(Nr)Sr.add(Nr.id);else{const Cr=dr(ar.id,kr);Sr.add(Cr.id)}}),ur(ar.id,Array.from(Sr)),lr()},Rr=xr.size;return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[85vh] flex flex-col safe-bottom",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary truncate",children:["Scene ",ar.sceneNumber]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted truncate",children:ar.slugline})]}),jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -mr-2 text-text-muted active:text-gold",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),ar.scriptContent&&jsxRuntimeExports.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-border max-h-48 overflow-y-auto shrink-0",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-secondary font-mono whitespace-pre-wrap",children:ar.scriptContent})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[ar.characters&&ar.characters.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("h4",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"CURRENT CHARACTERS"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ar.characters.map(Sr=>{const kr=yr.find(Cr=>Cr.id===Sr);if(!kr)return null;const Nr=hr.has(Sr);return jsxRuntimeExports.jsxs("div",{className:clsx("flex items-center gap-3 p-3 rounded-xl border transition-all",Nr?"border-gold bg-gold/5":"border-red-200 bg-red-50"),children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:kr,size:"sm"}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:jsxRuntimeExports.jsx("span",{className:clsx("font-medium",Nr?"text-text-primary":"text-red-400 line-through"),children:kr.name})}),jsxRuntimeExports.jsx("button",{onClick:()=>{pr(Tr=>{const Pr=new Set(Tr);return Pr.has(Sr)?Pr.delete(Sr):Pr.add(Sr),Pr});const Cr=kr.name.toUpperCase();mr(Tr=>{const Pr=new Set(Tr);return Nr?Pr.delete(Cr):Pr.add(Cr),Pr})},className:clsx("p-1.5 rounded-lg transition-colors flex-shrink-0",Nr?"text-red-500 hover:bg-red-50 active:bg-red-100":"text-green-600 hover:bg-green-50 active:bg-green-100"),title:Nr?"Remove from scene":"Add back to scene",children:Nr?jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]},Sr)})})]}),jr.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("h4",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"SUGGESTED CHARACTERS"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:jr.map(({name:Sr,existingCharacter:kr})=>{const Nr=xr.has(Sr);return jsxRuntimeExports.jsxs("button",{onClick:()=>br(Sr,kr),className:clsx("w-full flex items-center gap-3 p-3 rounded-xl border transition-all text-left",Nr?"border-gold bg-gold/5":"border-border bg-card"),children:[jsxRuntimeExports.jsx("div",{className:clsx("w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 transition-all",Nr?"border-gold bg-gold":"border-gray-300"),children:Nr&&jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}),kr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:kr,size:"sm"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:kr.name}),jsxRuntimeExports.jsx("span",{className:"text-xs text-green-600 ml-2",children:"In project"})]})]}):jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:Sr}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted ml-2",children:"New character"})]})]},Sr)})})]}),ar.characterConfirmationStatus==="detecting"&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-sm mb-4 p-3 bg-gray-50 rounded-lg",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Detecting characters..."]}),ar.characterConfirmationStatus==="pending"&&!((Ar=ar.suggestedCharacters)!=null&&Ar.length)&&jsxRuntimeExports.jsx("div",{className:"text-text-muted text-sm mb-4 p-3 bg-gray-50 rounded-lg",children:"No characters detected yet. Add characters manually below."}),jsxRuntimeExports.jsx("div",{className:"mt-4",children:vr?jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:fr,onChange:Sr=>Er(Sr.target.value.toUpperCase()),placeholder:"CHARACTER NAME",className:"flex-1 px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary uppercase",autoFocus:!0,onKeyDown:Sr=>{Sr.key==="Enter"&&_r(),Sr.key==="Escape"&&gr(!1)}}),jsxRuntimeExports.jsx("button",{onClick:_r,disabled:!fr.trim(),className:"px-3 py-2 bg-gold text-white rounded-lg text-sm font-medium disabled:opacity-50",children:"Add"}),jsxRuntimeExports.jsx("button",{onClick:()=>{gr(!1),Er("")},className:"px-3 py-2 text-text-muted",children:"Cancel"})]}):jsxRuntimeExports.jsxs("button",{onClick:()=>gr(!0),className:"w-full flex items-center justify-center gap-2 p-3 rounded-xl border border-dashed border-border text-text-muted hover:border-gold hover:text-gold transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add character not detected"]})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-t border-border shrink-0",children:jsxRuntimeExports.jsxs("button",{onClick:wr,className:"w-full py-3 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform",children:["Confirm ",Rr," Character",Rr!==1?"s":""]})})]})})}function CharacterConfirmationProgress({totalScenes:ar,confirmedScenes:or}){const lr=ar>0?Math.round(or/ar*100):0;return or>=ar?null:jsxRuntimeExports.jsxs("div",{className:"mx-4 mb-3 p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-amber-700",children:"Character Confirmation"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-amber-600",children:[or," / ",ar," scenes"]})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 bg-amber-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-amber-500 rounded-full transition-all duration-300",style:{width:`${lr}%`}})}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-amber-600 mt-1.5",children:"Confirm characters in each scene to track continuity"})]})}function AmendmentReviewModal({amendmentResult:ar,onApply:or,onCancel:lr}){const[cr,ur]=reactExports.useState(!0),[dr,hr]=reactExports.useState(!0),[pr,xr]=reactExports.useState(!1),[mr,fr]=reactExports.useState(null),{newScenes:Er,modifiedScenes:vr,deletedScenes:gr,summary:yr}=ar,jr=Er.length>0||vr.length>0||gr.length>0,br=()=>{or({includeNew:cr,includeModified:dr,includeDeleted:pr})},_r=(wr,Rr)=>{const Ar=mr===wr.sceneNumber,Sr=Rr==="new"?"bg-green-50 border-green-200":Rr==="modified"?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200",kr=Rr==="new"?"text-green-700":Rr==="modified"?"text-amber-700":"text-red-700",Nr=Rr==="new"?"bg-green-100 text-green-700":Rr==="modified"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700",Cr=Rr==="new"?"NEW":Rr==="modified"?"MODIFIED":"DELETED";return jsxRuntimeExports.jsxs("div",{className:clsx("border rounded-lg overflow-hidden",Sr),children:[jsxRuntimeExports.jsxs("button",{onClick:()=>fr(Ar?null:wr.sceneNumber),className:"w-full p-3 flex items-center justify-between text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"font-semibold text-text-primary",children:["Scene ",wr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:clsx("px-1.5 py-0.5 text-[10px] font-bold rounded",Nr),children:Cr})]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 text-text-muted transition-transform",Ar&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),Ar&&jsxRuntimeExports.jsxs("div",{className:"px-3 pb-3 border-t border-border/30",children:[jsxRuntimeExports.jsx("p",{className:clsx("text-xs mt-2",kr),children:wr.changeDescription}),wr.contentSimilarity!==void 0&&jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted mb-1",children:[jsxRuntimeExports.jsx("span",{children:"Content similarity"}),jsxRuntimeExports.jsxs("span",{children:[wr.contentSimilarity,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:clsx("h-full rounded-full",wr.contentSimilarity>=80?"bg-green-500":wr.contentSimilarity>=50?"bg-amber-500":"bg-red-500"),style:{width:`${wr.contentSimilarity}%`}})})]}),Rr==="modified"&&wr.existingScene&&jsxRuntimeExports.jsxs("div",{className:"mt-3 p-2 bg-white/50 rounded text-xs",children:[jsxRuntimeExports.jsx("p",{className:"text-text-muted mb-1",children:"Existing data preserved:"}),jsxRuntimeExports.jsxs("ul",{className:"text-text-secondary space-y-0.5",children:[wr.existingScene.characters.length>0&&jsxRuntimeExports.jsxs("li",{children:["- ",wr.existingScene.characters.length," confirmed character(s)"]}),wr.existingScene.synopsis&&jsxRuntimeExports.jsx("li",{children:"- Scene synopsis"}),wr.existingScene.filmingStatus&&jsxRuntimeExports.jsxs("li",{children:["- Filming status: ",wr.existingScene.filmingStatus]})]})]}),wr.newScene&&jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Slugline:"}),jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-primary",children:wr.newScene.slugline})]})]})]},wr.sceneNumber)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[90vh] flex flex-col safe-bottom",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Script Amendment Detected"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:yr})]}),jsxRuntimeExports.jsx("button",{onClick:lr,className:"p-2 -mr-2 text-text-muted active:text-gold",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:jr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-700",children:"Your existing breakdown data (confirmed characters, looks, continuity photos) will be preserved for modified scenes."})}),Er.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("h4",{className:"text-xs font-bold tracking-wider uppercase text-green-700",children:["New Scenes (",Er.length,")"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:cr,onChange:wr=>ur(wr.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Include"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:Er.map(wr=>_r(wr,"new"))})]}),vr.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("h4",{className:"text-xs font-bold tracking-wider uppercase text-amber-700",children:["Modified Scenes (",vr.length,")"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:dr,onChange:wr=>hr(wr.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Include"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:vr.map(wr=>_r(wr,"modified"))})]}),gr.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("h4",{className:"text-xs font-bold tracking-wider uppercase text-red-700",children:["Deleted Scenes (",gr.length,")"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:pr,onChange:wr=>xr(wr.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Mark as deleted"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:gr.map(wr=>_r(wr,"deleted"))})]})]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsx("p",{className:"text-text-primary font-medium",children:"No Changes Detected"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-1",children:"The script appears to be identical to your current breakdown."})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-t border-border shrink-0 space-y-2",children:jr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:br,disabled:!cr&&!dr&&!pr,className:"w-full py-3 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50",children:"Apply Selected Changes"}),jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-full py-2 text-sm text-text-muted",children:"Cancel - Keep Current Version"})]}):jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-full py-3 rounded-button bg-gray-100 text-text-primary font-semibold text-base active:scale-[0.98] transition-transform",children:"Close"})})]})})}function AmendmentBadge({status:ar,onDismiss:or}){if(!ar||ar==="unchanged")return null;const cr={new:{bg:"bg-green-100",text:"text-green-700",border:"border-green-200",label:"NEW",icon:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})},modified:{bg:"bg-amber-100",text:"text-amber-700",border:"border-amber-200",label:"AMENDED",icon:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})},deleted:{bg:"bg-red-100",text:"text-red-700",border:"border-red-200",label:"REMOVED",icon:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}}[ar];return jsxRuntimeExports.jsxs("div",{className:clsx("inline-flex items-center gap-1 px-2 py-1 rounded-full border",cr.bg,cr.border),children:[jsxRuntimeExports.jsx("span",{className:cr.text,children:cr.icon}),jsxRuntimeExports.jsx("span",{className:clsx("text-[10px] font-bold",cr.text),children:cr.label}),or&&jsxRuntimeExports.jsx("button",{onClick:ur=>{ur.stopPropagation(),or()},className:clsx("ml-1 hover:opacity-70",cr.text),children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}function FilmingStatusDropdown({scene:ar,onStatusChange:or,onNotesModalOpen:lr}){const[cr,ur]=reactExports.useState(!1),dr=reactExports.useRef(null);reactExports.useEffect(()=>{const xr=mr=>{dr.current&&!dr.current.contains(mr.target)&&ur(!1)};if(cr)return document.addEventListener("mousedown",xr),()=>document.removeEventListener("mousedown",xr)},[cr]);const hr=ar.filmingStatus?SCENE_FILMING_STATUS_CONFIG[ar.filmingStatus]:null,pr=xr=>{ur(!1),xr==="complete"?or(ar.sceneNumber,xr):lr(ar.sceneNumber,xr)};return jsxRuntimeExports.jsxs("div",{ref:dr,className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:xr=>{xr.stopPropagation(),ur(!cr)},className:clsx("flex items-center gap-1.5 px-2 py-1 text-[10px] font-semibold rounded-lg flex-shrink-0 border transition-colors",hr?[hr.bgClass,hr.textClass,ar.filmingStatus==="complete"&&"border-green-200",ar.filmingStatus==="partial"&&"border-amber-200",ar.filmingStatus==="not-filmed"&&"border-red-200"]:"bg-gray-100 text-text-muted border-gray-200 hover:border-gray-300"),children:[hr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:clsx("w-2 h-2 rounded-full",ar.filmingStatus==="complete"&&"bg-green-500",ar.filmingStatus==="partial"&&"bg-amber-500",ar.filmingStatus==="not-filmed"&&"bg-red-500")}),hr.shortLabel]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),"Set Status"]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-3 h-3 transition-transform",cr&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),cr&&jsxRuntimeExports.jsx("div",{className:"absolute right-0 top-full mt-1 z-50 bg-white rounded-lg shadow-lg border border-border overflow-hidden min-w-[140px]",children:["complete","partial","not-filmed"].map(xr=>{const mr=SCENE_FILMING_STATUS_CONFIG[xr],fr=ar.filmingStatus===xr;return jsxRuntimeExports.jsxs("button",{onClick:Er=>{Er.stopPropagation(),pr(xr)},className:clsx("w-full flex items-center gap-2 px-3 py-2 text-xs font-medium transition-colors text-left",fr?`${mr.bgClass} ${mr.textClass}`:"hover:bg-gray-50 text-text-primary"),children:[jsxRuntimeExports.jsx("span",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{backgroundColor:mr.color}}),mr.label,fr&&jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 ml-auto text-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},xr)})})]})}function FilmingNotesModal({sceneNumber:ar,status:or,onConfirm:lr,onClose:cr}){const[ur,dr]=reactExports.useState(""),hr=SCENE_FILMING_STATUS_CONFIG[or];return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:cr,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg max-h-[80vh] overflow-y-auto",onClick:pr=>pr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:hr.color}}),jsxRuntimeExports.jsxs("h2",{className:"text-lg font-semibold text-text-primary",children:["Scene ",ar," - ",hr.label]})]}),jsxRuntimeExports.jsx("button",{onClick:cr,className:"p-2 -mr-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:or==="partial"?"What still needs to be filmed?":"Why wasn't this scene filmed?"}),jsxRuntimeExports.jsx("textarea",{value:ur,onChange:pr=>dr(pr.target.value),placeholder:"e.g., Ran out of time, weather issues, actor unavailable...",className:"w-full px-3 py-2.5 text-sm border border-border rounded-lg bg-card text-text-primary resize-none focus:outline-none focus:ring-2 focus:ring-gold/50 focus:border-gold",rows:4,autoFocus:!0})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:cr,className:"flex-1 py-2.5 rounded-button border border-border text-text-muted text-sm font-medium",children:"Cancel"}),jsxRuntimeExports.jsxs("button",{onClick:()=>lr(ur),className:clsx("flex-1 py-2.5 rounded-button text-white text-sm font-medium",or==="partial"?"bg-amber-500":"bg-red-500"),children:["Mark as ",hr.label]})]})]})]})})}function Breakdown({onSceneSelect:ar}){const{currentProject:or,sceneCaptures:lr,updateSceneFilmingStatus:cr,clearSingleSceneAmendment:ur}=useProjectStore(),dr=useScheduleStore(ls=>ls.schedule),[hr,pr]=reactExports.useState("scene-number"),[xr,mr]=reactExports.useState(!1),[fr,Er]=reactExports.useState({characters:[],location:null,completionStatus:"all",filmingStatus:"all",lookId:null}),[vr,gr]=reactExports.useState(null),[yr,jr]=reactExports.useState(null),[br,_r]=reactExports.useState(null),[wr,Rr]=reactExports.useState(!1),[Ar,Sr]=reactExports.useState(!1),kr=reactExports.useCallback((ls,ds)=>{const bs=URL.createObjectURL(ls),ws=document.createElement("a");ws.href=bs,ws.download=ds,document.body.appendChild(ws),ws.click(),document.body.removeChild(ws),URL.revokeObjectURL(bs)},[]),Nr=reactExports.useCallback(async()=>{if(!(!or||wr)){Rr(!0),Sr(!1);try{const ls=generateSceneBreakdownCSV(or,lr),ds=new Blob([ls],{type:"text/csv"});kr(ds,`${or.name}_Scene_Breakdown.csv`)}finally{Rr(!1)}}},[or,lr,wr,kr]),Cr=reactExports.useCallback(async()=>{if(!(!or||wr)){Rr(!0),Sr(!1);try{const ls=generateSceneBreakdownXLSX(or,lr),ds=new Blob([ls],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});kr(ds,`${or.name}_Scene_Breakdown.xlsx`)}finally{Rr(!1)}}},[or,lr,wr,kr]),Tr=reactExports.useCallback(async()=>{!or||wr||Sr(ls=>!ls)},[or,wr]),[Pr,Ir]=reactExports.useState(null),Br=(ls,ds,bs)=>{cr(ls,ds,bs)},Wr=(ls,ds)=>{Ir({sceneNumber:ls,status:ds})},Yr=ls=>{Pr&&(cr(Pr.sceneNumber,Pr.status,ls),Ir(null))},es=reactExports.useMemo(()=>!yr||!or?null:or.scenes.find(ls=>ls.id===yr)||null,[yr,or]),ps=reactExports.useMemo(()=>!br||!or?null:or.scenes.find(ls=>ls.id===br)||null,[br,or]),ts=reactExports.useMemo(()=>{if(!or)return{total:0,confirmed:0};const ls=or.scenes.length,ds=or.scenes.filter(bs=>bs.characterConfirmationStatus==="confirmed").length;return{total:ls,confirmed:ds}},[or]),Qr=reactExports.useMemo(()=>{if(!or)return[];const ls=new Set;return or.scenes.forEach(ds=>{const bs=ds.slugline.match(/^(?:INT|EXT)\.\s*(.+?)\s*-/);bs&&ls.add(bs[1].trim())}),Array.from(ls).sort()},[or]),Hr=reactExports.useMemo(()=>{if(!or)return[];let ls=[...or.scenes];if(fr.characters.length>0&&(ls=ls.filter(ds=>fr.characters.some(bs=>ds.characters.includes(bs)))),fr.completionStatus==="complete"?ls=ls.filter(ds=>ds.isComplete):fr.completionStatus==="incomplete"&&(ls=ls.filter(ds=>!ds.isComplete)),fr.filmingStatus!=="all"&&(ls=ls.filter(ds=>ds.filmingStatus===fr.filmingStatus)),fr.location&&(ls=ls.filter(ds=>ds.slugline.toLowerCase().includes(fr.location.toLowerCase()))),fr.lookId){const ds=or.looks.find(bs=>bs.id===fr.lookId);ds&&(ls=ls.filter(bs=>ds.scenes.includes(bs.sceneNumber)))}if(hr==="shooting-order"&&(dr!=null&&dr.days)&&dr.days.length>0){const ds=new Map;for(const bs of dr.days)for(const ws of bs.scenes){const Is=ws.sceneNumber.replace(/\s+/g,"").toUpperCase();ds.set(Is,{day:bs.dayNumber,order:ws.shootOrder})}return ls.sort((bs,ws)=>{const Is=bs.sceneNumber.replace(/\s+/g,"").toUpperCase(),ys=ws.sceneNumber.replace(/\s+/g,"").toUpperCase(),ss=ds.get(Is),Ur=ds.get(ys);return!ss&&!Ur?bs.sceneNumber.localeCompare(ws.sceneNumber,void 0,{numeric:!0}):ss?Ur?ss.day!==Ur.day?ss.day-Ur.day:ss.order-Ur.order:-1:1})}return ls.sort((ds,bs)=>ds.sceneNumber.localeCompare(bs.sceneNumber,void 0,{numeric:!0}))},[or,fr,hr,dr]),Kr=reactExports.useMemo(()=>or?new Map(or.characters.map(ls=>[ls.id,ls])):new Map,[or==null?void 0:or.characters]),rs=reactExports.useMemo(()=>{if(!or)return new Map;const ls=new Map;for(const ds of or.scenes){const bs=ds.characters.map(ws=>Kr.get(ws)).filter(ws=>ws!==void 0);ls.set(ds.id,bs)}return ls},[or==null?void 0:or.scenes,Kr]),Mr=reactExports.useMemo(()=>{if(!or)return new Map;const ls=new Map;for(const ds of or.scenes){const bs=ds.characters.length;let ws=0;ds.characters.forEach(Is=>{const ys=`${ds.id}-${Is}`,ss=lr[ys];ss&&Object.keys(ss.photos).length>0&&ws++}),ls.set(ds.id,{captured:ws,total:bs})}return ls},[or==null?void 0:or.scenes,lr]),Dr=reactExports.useMemo(()=>{if(!or)return new Map;const ls=new Map;for(const ds of or.looks)for(const bs of ds.scenes)ls.set(`${ds.characterId}-${bs}`,ds);return ls},[or==null?void 0:or.looks]),Lr=ls=>Mr.get(ls.id)||{captured:0,total:0},Fr=ls=>rs.get(ls.id)||[],$r=(ls,ds)=>Dr.get(`${ls}-${ds}`),Vr=(ls,ds)=>lr[`${ls}-${ds}`],Gr=()=>{Er({characters:[],location:null,completionStatus:"all",filmingStatus:"all",lookId:null})},Jr=fr.characters.length>0||fr.location!==null||fr.completionStatus!=="all"||fr.filmingStatus!=="all"||fr.lookId!==null,ms=!!(dr!=null&&dr.days&&dr.days.length>0);return or?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Breakdown"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[ms&&jsxRuntimeExports.jsx("button",{onClick:()=>pr(hr==="scene-number"?"shooting-order":"scene-number"),className:clsx("p-2 rounded-lg transition-colors touch-manipulation",hr==="shooting-order"?"text-gold bg-gold-100/50":"text-text-muted hover:text-gold"),title:hr==="shooting-order"?"Sorted by shooting order":"Sort by shooting order",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5-3L16.5 18m0 0L12 13.5M16.5 18V4.5"})})}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:Tr,disabled:wr,className:"p-2 rounded-lg transition-colors touch-manipulation text-text-muted hover:text-gold disabled:opacity-50",title:"Export Scene Breakdown",children:wr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),Ar&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>Sr(!1)}),jsxRuntimeExports.jsxs("div",{className:"absolute right-0 top-full mt-1 z-50 bg-card border border-border rounded-lg shadow-lg overflow-hidden min-w-[180px]",children:[jsxRuntimeExports.jsxs("button",{onClick:Cr,className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-background flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M10.875 12c-.621 0-1.125.504-1.125 1.125M12 12c.621 0 1.125.504 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 0v1.5c0 .621-.504 1.125-1.125 1.125M12 15.375c.621 0 1.125-.504 1.125-1.125"})}),"Excel (.xlsx)"]}),jsxRuntimeExports.jsxs("button",{onClick:Nr,className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-background flex items-center gap-2 border-t border-border",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-blue-500 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})}),"CSV (.csv)"]})]})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>mr(!0),className:clsx("p-2 rounded-lg transition-colors touch-manipulation relative",Jr?"text-gold bg-gold-100/50":"text-text-muted hover:text-gold"),children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75"})}),Jr&&jsxRuntimeExports.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full bg-gold"})]})]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Hr.length," scene",Hr.length!==1?"s":"",Jr&&" (filtered)"]}),hr==="shooting-order"&&jsxRuntimeExports.jsx("span",{className:"text-xs text-gold font-medium",children:"Shooting Order"})]}),ts.total>0&&ts.confirmed<ts.total&&jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx(CharacterConfirmationProgress,{totalScenes:ts.total,confirmedScenes:ts.confirmed})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 pb-4",children:Hr.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("p",{className:"text-text-muted",children:"No scenes match your filters"}),jsxRuntimeExports.jsx("button",{onClick:Gr,className:"mt-3 text-sm text-gold font-medium",children:"Clear Filters"})]}):jsxRuntimeExports.jsx(BreakdownListView,{scenes:Hr,expandedSceneId:vr,onToggleExpand:ls=>gr(vr===ls?null:ls),onSceneSelect:ar,onSynopsisClick:ls=>jr(ls),getCharactersForScene:Fr,getLookForCharacter:$r,getCapture:Vr,getSceneProgress:Lr,onCharacterConfirm:ls=>_r(ls),onFilmingStatusChange:Br,onNotesModalOpen:Wr,onDismissAmendment:ls=>ur(ls)})}),xr&&jsxRuntimeExports.jsx(FilterDrawer,{filters:fr,characters:or.characters,locations:Qr,looks:or.looks,onFiltersChange:Er,onClose:()=>mr(!1),onClear:Gr}),es&&jsxRuntimeExports.jsx(SceneScriptModal,{scene:es,onClose:()=>jr(null)}),ps&&jsxRuntimeExports.jsx(SceneCharacterConfirmation,{scene:ps,onClose:()=>_r(null),onConfirm:()=>_r(null)}),Pr&&jsxRuntimeExports.jsx(FilmingNotesModal,{sceneNumber:Pr.sceneNumber,status:Pr.status,onConfirm:Yr,onClose:()=>Ir(null)})]}):jsxRuntimeExports.jsx(EmptyState$1,{})}const getGlassOverlayClass=ar=>{if(!ar)return null;switch(ar){case"complete":return"scene-glass-complete";case"partial":return"scene-glass-partial";case"not-filmed":return"scene-glass-incomplete";default:return null}};function BreakdownListView({scenes:ar,expandedSceneId:or,onToggleExpand:lr,onSceneSelect:cr,onSynopsisClick:ur,getCharactersForScene:dr,getLookForCharacter:hr,getCapture:pr,getSceneProgress:xr,onCharacterConfirm:mr,onFilmingStatusChange:fr,onNotesModalOpen:Er,onDismissAmendment:vr}){return jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ar.map(gr=>{const yr=or===gr.id,jr=dr(gr),br=xr(gr),_r=br.total>0&&br.captured===br.total,wr=gr.filmingStatus?SCENE_FILMING_STATUS_CONFIG[gr.filmingStatus]:null,Rr=getGlassOverlayClass(gr.filmingStatus),Ar=()=>{if(!gr.filmingStatus)return"accent-bar-neutral";switch(gr.filmingStatus){case"complete":return"accent-bar-complete";case"partial":return"accent-bar-partial";case"not-filmed":return"accent-bar-incomplete";default:return"accent-bar-neutral"}};return jsxRuntimeExports.jsxs("div",{className:"card overflow-hidden relative",children:[Rr&&jsxRuntimeExports.jsx("div",{className:clsx("scene-glass-overlay",Rr)}),jsxRuntimeExports.jsx("div",{className:clsx("absolute left-0 top-0 bottom-0 w-1 rounded-l-card",Ar())}),jsxRuntimeExports.jsxs("button",{onClick:()=>lr(gr.id),className:"w-full flex items-center gap-3 p-3 text-left touch-manipulation",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-text-primary min-w-[2rem]",children:gr.sceneNumber}),gr.amendmentStatus&&gr.amendmentStatus!=="unchanged"&&jsxRuntimeExports.jsx(AmendmentBadge,{status:gr.amendmentStatus,notes:gr.amendmentNotes,onDismiss:()=>vr(gr.id)})]}),jsxRuntimeExports.jsx("span",{className:clsx("px-1.5 py-0.5 text-[10px] font-bold rounded flex-shrink-0",gr.intExt==="INT"?"bg-slate-100 text-slate-600":"bg-stone-100 text-stone-600"),children:gr.intExt}),jsxRuntimeExports.jsx("span",{className:"flex-1 text-sm text-text-secondary truncate",children:gr.slugline.replace(/^(INT|EXT)\.\s*/,"").replace(/\s*-\s*(DAY|NIGHT|MORNING|EVENING|CONTINUOUS)$/i,"")}),jsxRuntimeExports.jsxs("span",{className:"flex-shrink-0 flex items-center -space-x-1.5",children:[jr.slice(0,3).map(Sr=>jsxRuntimeExports.jsx(CharacterAvatar,{character:Sr,size:"xs"},Sr.id)),jr.length>3&&jsxRuntimeExports.jsxs("span",{className:"w-5 h-5 rounded-full bg-gray-200 flex items-center justify-center text-[9px] font-bold text-text-muted",children:["+",jr.length-3]})]}),jsxRuntimeExports.jsx(FilmingStatusDropdown,{scene:gr,onStatusChange:fr,onNotesModalOpen:Er}),_r&&jsxRuntimeExports.jsx("span",{className:"text-green-500 flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),!_r&&br.captured>0&&jsxRuntimeExports.jsx("span",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0 bg-gold"}),jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 text-text-light transition-transform flex-shrink-0",yr&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),jsxRuntimeExports.jsxs("div",{className:"px-3 pb-3 pt-1 border-t border-border/50",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:gr.slugline}),(gr.synopsis||gr.scriptContent)&&jsxRuntimeExports.jsxs("button",{onClick:Sr=>{Sr.stopPropagation(),ur(gr.id)},className:"w-full text-left group mt-1.5",children:[gr.synopsis&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted italic line-clamp-2 group-hover:text-gold transition-colors",children:gr.synopsis}),gr.scriptContent&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-gold flex items-center gap-1 mt-1",children:[jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Tap to view full scene"]})]}),jsxRuntimeExports.jsx("div",{className:"mt-2 pt-2 border-t border-border/30",children:jsxRuntimeExports.jsxs("button",{onClick:Sr=>{Sr.stopPropagation(),mr(gr.id)},className:"inline-flex items-center gap-1 text-xs text-gold font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),jr.length>0?"Edit characters":"Add characters"]})})]}),yr&&jsxRuntimeExports.jsxs("div",{className:"border-t border-border px-3 pb-3 pt-3 space-y-3",children:[gr.filmingStatus&&jsxRuntimeExports.jsxs("div",{className:clsx("p-2.5 rounded-lg",wr==null?void 0:wr.bgClass),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(FilmingStatusIcon,{status:gr.filmingStatus}),jsxRuntimeExports.jsx("span",{className:clsx("text-sm font-medium",wr==null?void 0:wr.textClass),children:wr==null?void 0:wr.label})]}),gr.filmingNotes&&jsxRuntimeExports.jsx("p",{className:clsx("text-xs mt-1.5",wr==null?void 0:wr.textClass),children:gr.filmingNotes})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:jr.map(Sr=>{const kr=hr(Sr.id,gr.sceneNumber),Nr=pr(gr.id,Sr.id),Cr=Nr&&Object.keys(Nr.photos).length>0,Tr=Nr?Object.entries(Nr.continuityFlags).filter(([Pr,Ir])=>Ir).map(([Pr])=>Pr):[];return jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:Sr,size:"sm"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:Sr.name}),kr&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-gold ml-2",children:[" ",kr.name]})]}),Cr&&jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),kr&&jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[11px]",children:[kr.makeup.foundation&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-light",children:"Makeup:"})," ",jsxRuntimeExports.jsx("span",{className:"text-text-secondary",children:kr.makeup.foundation})]}),kr.hair.style&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-light",children:"Hair:"})," ",jsxRuntimeExports.jsx("span",{className:"text-text-secondary",children:kr.hair.style})]})]}),Tr.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Tr.map(Pr=>jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[9px] font-medium rounded bg-amber-100 text-amber-700 capitalize",children:Pr.replace(/([A-Z])/g," $1").trim()},Pr))}),Nr&&Object.keys(Nr.photos).length>0&&jsxRuntimeExports.jsx("div",{className:"flex gap-1 mt-2",children:["front","left","right","back"].map(Pr=>{const Ir=Nr.photos[Pr];return jsxRuntimeExports.jsx("div",{className:clsx("w-10 h-10 rounded overflow-hidden bg-gray-200",!Ir&&"opacity-30"),children:Ir&&jsxRuntimeExports.jsx("img",{src:Ir.thumbnail||Ir.uri,alt:Pr,className:"w-full h-full object-cover"})},Pr)})})]},Sr.id)})}),jsxRuntimeExports.jsx("button",{onClick:()=>cr(gr.id),className:"w-full py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-[0.98] transition-transform",children:br.captured>0?"Edit Details":"Capture Continuity"})]})]},gr.id)})})}function FilmingStatusIcon({status:ar}){const or=SCENE_FILMING_STATUS_CONFIG[ar];return ar==="complete"?jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:or.color},children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}):ar==="partial"?jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:or.color},children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}):jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:or.color},children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})}function FilterDrawer({filters:ar,characters:or,locations:lr,looks:cr,onFiltersChange:ur,onClose:dr,onClear:hr}){const pr=xr=>{const mr=ar.characters.includes(xr)?ar.characters.filter(fr=>fr!==xr):[...ar.characters,xr];ur({...ar,characters:mr})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:dr,children:jsxRuntimeExports.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-80 max-w-full bg-card shadow-xl overflow-y-auto",onClick:xr=>xr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold text-text-primary",children:"Filters"}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"p-1 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-5",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"FILMING STATUS"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ur({...ar,filmingStatus:"all"}),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full transition-colors",ar.filmingStatus==="all"?"bg-gold text-white":"bg-gray-100 text-text-muted"),children:"All"}),["complete","partial","not-filmed"].map(xr=>{const mr=SCENE_FILMING_STATUS_CONFIG[xr];return jsxRuntimeExports.jsxs("button",{onClick:()=>ur({...ar,filmingStatus:xr}),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full transition-colors flex items-center gap-1.5",ar.filmingStatus===xr?`${mr.bgClass} ${mr.textClass}`:"bg-gray-100 text-text-muted"),children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:mr.color}}),mr.shortLabel]},xr)})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"CONTINUITY STATUS"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:["all","complete","incomplete"].map(xr=>jsxRuntimeExports.jsx("button",{onClick:()=>ur({...ar,completionStatus:xr}),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full transition-colors",ar.completionStatus===xr?"bg-gold text-white":"bg-gray-100 text-text-muted"),children:xr==="all"?"All":xr==="complete"?"Captured":"Not Captured"},xr))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"CHARACTERS"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:or.map(xr=>jsxRuntimeExports.jsxs("button",{onClick:()=>pr(xr.id),className:clsx("flex items-center gap-1.5 px-2.5 py-1.5 rounded-full text-xs font-medium transition-colors",ar.characters.includes(xr.id)?"bg-gold text-white":"bg-gray-100 text-text-muted"),children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:xr,size:"xs"}),xr.name.split(" ")[0]]},xr.id))})]}),lr.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"LOCATION"}),jsxRuntimeExports.jsxs("select",{value:ar.location||"",onChange:xr=>ur({...ar,location:xr.target.value||null}),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary",children:[jsxRuntimeExports.jsx("option",{value:"",children:"All Locations"}),lr.map(xr=>jsxRuntimeExports.jsx("option",{value:xr,children:xr},xr))]})]}),cr.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"LOOK"}),jsxRuntimeExports.jsxs("select",{value:ar.lookId||"",onChange:xr=>ur({...ar,lookId:xr.target.value||null}),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary",children:[jsxRuntimeExports.jsx("option",{value:"",children:"All Looks"}),cr.map(xr=>{const mr=or.find(fr=>fr.id===xr.characterId);return jsxRuntimeExports.jsxs("option",{value:xr.id,children:[mr==null?void 0:mr.name.split(" ")[0]," - ",xr.name]},xr.id)})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"sticky bottom-0 bg-card border-t border-border p-4 flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:hr,className:"flex-1 py-2.5 rounded-button border border-border text-text-muted text-sm font-medium",children:"Clear All"}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"flex-1 py-2.5 rounded-button gold-gradient text-white text-sm font-medium",children:"Apply"})]})]})})}function EmptyState$1(){return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"h-14 px-4 flex items-center",children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Breakdown"})})})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125"})})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"No Breakdown Data"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Sync from desktop or upload a script to generate scenes"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{className:"px-4 py-2.5 rounded-button border border-gold text-gold text-sm font-medium active:scale-95 transition-transform",children:"Sync Now"}),jsxRuntimeExports.jsx("button",{className:"px-4 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform",children:"Upload Script"})]})]})]})}function LookCard({look:ar,character:or,progress:lr}){const{currentProject:cr,sceneCaptures:ur,setCurrentLook:dr}=useProjectStore(),hr=lr.total>0?lr.captured/lr.total*100:0,pr=lr.captured===lr.total&&lr.total>0,mr=(()=>{if(!cr)return null;for(let fr=ar.scenes.length-1;fr>=0;fr--){const Er=ar.scenes[fr],vr=cr.scenes.find(gr=>gr.sceneNumber===Er);if(vr){const gr=`${vr.id}-${ar.characterId}`,yr=ur[gr];if(yr&&(yr.photos.front||yr.additionalPhotos.length>0))return{sceneNum:Er,capture:yr}}}return null})();return jsxRuntimeExports.jsx("div",{className:"bg-card rounded-card overflow-hidden shadow-card",children:jsxRuntimeExports.jsxs("button",{onClick:()=>dr(ar.id),className:"w-full p-4 text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-2 mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h4",{className:"text-[15px] font-bold text-text-primary",children:ar.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Scenes ",ar.scenes.join(", "),"  ~",ar.estimatedTime," min"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:`text-[11px] font-semibold ${pr?"text-success":"text-gold"}`,children:[lr.captured,"/",lr.total]}),jsxRuntimeExports.jsx("svg",{className:"w-[18px] h-[18px] text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]}),jsxRuntimeExports.jsx("div",{className:"mb-3",children:jsxRuntimeExports.jsx("div",{className:"h-[3px] bg-gray-100 rounded-sm overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:`h-full rounded-sm transition-all duration-300 ${pr?"bg-success":"gold-gradient"}`,style:{width:`${hr}%`}})})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-[60px] h-[60px] rounded-lg bg-input-bg border border-border flex-shrink-0 overflow-hidden flex items-center justify-center",children:ar.masterReference?jsxRuntimeExports.jsx("img",{src:ar.masterReference.thumbnail||ar.masterReference.uri,alt:"Master reference",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),mr?jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("span",{className:"text-[9px] font-semibold tracking-wider uppercase text-text-light block mb-1.5",children:["Scene ",mr.sceneNum]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-4 gap-1",children:["front","left","right","back"].map(fr=>{const Er=mr.capture.photos[fr];return jsxRuntimeExports.jsx("div",{className:`aspect-[3/4] rounded ${Er?"bg-gray-200 border border-gold":"bg-input-bg border border-border"} flex items-center justify-center`,children:Er?jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}):jsxRuntimeExports.jsx("svg",{className:"w-2.5 h-2.5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"})})},fr)})})]}):jsxRuntimeExports.jsx("div",{className:"flex-1 bg-input-bg rounded-lg p-3 text-center",children:jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-light",children:"No captures yet"})})]})]})})}function CharacterSection({character:ar,looks:or,capturedScenes:lr,totalScenes:cr,getCaptureProgress:ur,onAddLook:dr}){const[hr,pr]=reactExports.useState(!1),[xr,mr]=reactExports.useState(!1),[fr,Er]=reactExports.useState(!1),{getCastProfile:vr,updateCastProfile:gr}=useProjectStore(),yr=vr(ar.id)||createEmptyCastProfile(ar.id),jr=yr.actorName||yr.phone||yr.email||yr.allergies||yr.specialRequirements||yr.profilePhotoUri;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>pr(!hr),className:"w-full py-3 flex items-center justify-between text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[yr.profilePhotoUri?jsxRuntimeExports.jsx("img",{src:yr.profilePhotoUri,alt:ar.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-semibold flex-shrink-0",style:{background:`linear-gradient(135deg, ${ar.avatarColour||"#C9A962"} 0%, ${adjustColor(ar.avatarColour||"#C9A962",-20)} 100%)`},children:ar.actorNumber??ar.initials}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-[17px] font-bold text-gold truncate",children:ar.name}),ar.actorNumber&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-muted font-medium",children:["#",ar.actorNumber]})]}),yr.actorName&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-secondary truncate",children:yr.actorName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-0.5",children:[or.length," look",or.length!==1?"s":"","  ",lr,"/",cr," scenes"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[jr&&jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full bg-success",title:"Profile complete"}),yr.allergies&&jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500",title:"Has allergies"})]})]}),jsxRuntimeExports.jsx("svg",{className:`w-5 h-5 text-text-light transition-transform duration-200 flex-shrink-0 ${hr?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),jsxRuntimeExports.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${hr?"max-h-[3000px] opacity-100":"max-h-0 opacity-0"}`,children:jsxRuntimeExports.jsxs("div",{className:"pl-[52px] space-y-2.5",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-card shadow-card overflow-hidden",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>mr(!xr),className:"w-full px-4 py-3 flex items-center justify-between text-left touch-manipulation",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-text-muted uppercase tracking-wide",children:"Cast Profile"}),jsxRuntimeExports.jsx("svg",{className:`w-4 h-4 text-text-muted transition-transform ${xr?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),xr&&jsxRuntimeExports.jsxs("div",{className:"px-4 pb-4 pt-1 space-y-3 border-t border-border",children:[yr.profilePhotoUri&&jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("img",{src:yr.profilePhotoUri,alt:yr.actorName||ar.name,className:"w-20 h-20 rounded-full object-cover border-2 border-gold"})}),yr.actorName&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"ACTOR"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary mt-0.5",children:yr.actorName})]}),(yr.phone||yr.email)&&jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[yr.phone&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"PHONE"}),jsxRuntimeExports.jsx("a",{href:`tel:${yr.phone}`,className:"text-sm text-gold mt-0.5 block",children:yr.phone})]}),yr.email&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"EMAIL"}),jsxRuntimeExports.jsx("a",{href:`mailto:${yr.email}`,className:"text-sm text-gold mt-0.5 block truncate",children:yr.email})]})]}),(yr.agentName||yr.agentPhone||yr.agentEmail)&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"AGENT"}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-sm",children:[yr.agentName&&jsxRuntimeExports.jsx("p",{className:"text-text-primary",children:yr.agentName}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mt-0.5",children:[yr.agentPhone&&jsxRuntimeExports.jsx("a",{href:`tel:${yr.agentPhone}`,className:"text-gold",children:yr.agentPhone}),yr.agentEmail&&jsxRuntimeExports.jsx("a",{href:`mailto:${yr.agentEmail}`,className:"text-gold truncate",children:yr.agentEmail})]})]})]}),yr.allergies&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-red-600 uppercase tracking-wide",children:"ALLERGIES"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700 mt-0.5",children:yr.allergies})]}),yr.specialRequirements&&jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-amber-600 uppercase tracking-wide",children:"SPECIAL REQUIREMENTS"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-700 mt-0.5",children:yr.specialRequirements})]}),yr.skinType&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"SKIN TYPE"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary mt-0.5",children:yr.skinType})]}),yr.notes&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"NOTES"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mt-0.5",children:yr.notes})]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",fullWidth:!0,onClick:()=>Er(!0),children:jr?"Edit Profile":"Add Profile Information"})]})]}),or.length>0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[or.map(br=>jsxRuntimeExports.jsx(LookCard,{look:br,character:ar,progress:ur(br)},br.id)),jsxRuntimeExports.jsxs("button",{onClick:dr,className:"w-full py-3.5 flex items-center justify-center gap-1.5 text-[13px] font-medium text-text-muted bg-card border-2 border-dashed border-gray-200 rounded-card hover:border-gold-300 hover:text-gold transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add New Look"]})]}):jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-card p-6 text-center",children:[jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300 mx-auto mb-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253",strokeLinecap:"round",strokeLinejoin:"round"})}),jsxRuntimeExports.jsx("p",{className:"text-[13px] text-text-muted mb-1",children:"No looks defined"}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mb-3",children:"Sync from desktop or create manually"}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"px-5 py-2.5 rounded-full bg-gold-100/50 text-gold text-xs font-semibold",children:"+ Add Look"})]})]})})]}),jsxRuntimeExports.jsx(EditCastProfileModal,{isOpen:fr,onClose:()=>Er(!1),character:ar,profile:yr,onSave:br=>{gr(ar.id,br),Er(!1)}})]})}function EditCastProfileModal({isOpen:ar,onClose:or,character:lr,profile:cr,onSave:ur}){const[dr,hr]=reactExports.useState(cr.actorName),[pr,xr]=reactExports.useState(cr.phone),[mr,fr]=reactExports.useState(cr.email),[Er,vr]=reactExports.useState(cr.agentName),[gr,yr]=reactExports.useState(cr.agentPhone),[jr,br]=reactExports.useState(cr.agentEmail),[_r,wr]=reactExports.useState(cr.allergies),[Rr,Ar]=reactExports.useState(cr.specialRequirements),[Sr,kr]=reactExports.useState(cr.skinType),[Nr,Cr]=reactExports.useState(cr.notes),[Tr,Pr]=reactExports.useState(cr.profilePhotoUri||""),Ir=reactExports.useRef(null),Br=Yr=>{var ts;const es=(ts=Yr.target.files)==null?void 0:ts[0];if(!es)return;const ps=new FileReader;ps.onload=()=>{const Qr=new Image;Qr.onload=()=>{const Hr=document.createElement("canvas"),Kr=256;Hr.width=Kr,Hr.height=Kr;const rs=Hr.getContext("2d"),Mr=Math.min(Qr.width,Qr.height),Dr=(Qr.width-Mr)/2,Lr=(Qr.height-Mr)/2;rs.drawImage(Qr,Dr,Lr,Mr,Mr,0,0,Kr,Kr),Pr(Hr.toDataURL("image/jpeg",.8))},Qr.src=ps.result},ps.readAsDataURL(es),Yr.target.value=""},Wr=()=>{ur({actorName:dr,phone:pr,email:mr,agentName:Er,agentPhone:gr,agentEmail:jr,allergies:_r,specialRequirements:Rr,skinType:Sr,notes:Nr,profilePhotoUri:Tr||void 0})};return jsxRuntimeExports.jsx(BottomSheet,{isOpen:ar,onClose:or,title:`${lr.name} - Cast Profile`,height:"auto",children:jsxRuntimeExports.jsxs("div",{className:"space-y-4 pb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-2",children:[jsxRuntimeExports.jsx("input",{ref:Ir,type:"file",accept:"image/*",onChange:Br,className:"hidden"}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>{var Yr;return(Yr=Ir.current)==null?void 0:Yr.click()},className:"relative group",children:[Tr?jsxRuntimeExports.jsx("img",{src:Tr,alt:"Headshot",className:"w-20 h-20 rounded-full object-cover border-2 border-gold"}):jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-input-bg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 right-0 w-6 h-6 rounded-full bg-gold flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]}),jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-muted",children:Tr?"Tap to change headshot":"Add headshot"}),Tr&&jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Pr(""),className:"text-[11px] text-red-500 font-medium",children:"Remove photo"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Actor Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Input,{label:"ACTOR NAME",value:dr,onChange:Yr=>hr(Yr.target.value),placeholder:"Full name"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{label:"PHONE",value:pr,onChange:Yr=>xr(Yr.target.value),placeholder:"+44...",type:"tel"}),jsxRuntimeExports.jsx(Input,{label:"EMAIL",value:mr,onChange:Yr=>fr(Yr.target.value),placeholder:"actor@email.com",type:"email"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Agent Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Input,{label:"AGENT NAME",value:Er,onChange:Yr=>vr(Yr.target.value),placeholder:"Agent or agency name"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{label:"AGENT PHONE",value:gr,onChange:Yr=>yr(Yr.target.value),placeholder:"+44...",type:"tel"}),jsxRuntimeExports.jsx(Input,{label:"AGENT EMAIL",value:jr,onChange:Yr=>br(Yr.target.value),placeholder:"agent@agency.com",type:"email"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Health & Requirements"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Textarea,{label:"ALLERGIES",value:_r,onChange:Yr=>wr(Yr.target.value),placeholder:"List any allergies (latex, adhesives, specific products...)",rows:2}),jsxRuntimeExports.jsx(Textarea,{label:"SPECIAL REQUIREMENTS",value:Rr,onChange:Yr=>Ar(Yr.target.value),placeholder:"Sensitive skin, prefers certain products, etc.",rows:2}),jsxRuntimeExports.jsx(Input,{label:"SKIN TYPE",value:Sr,onChange:Yr=>kr(Yr.target.value),placeholder:"Oily, dry, combination, sensitive..."})]})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Textarea,{label:"ADDITIONAL NOTES",value:Nr,onChange:Yr=>Cr(Yr.target.value),placeholder:"Any other relevant information...",rows:3})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"lg",fullWidth:!0,onClick:or,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:Wr,children:"Save Profile"})]})]})})}function adjustColor(ar,or){const lr=parseInt(ar.replace("#",""),16),cr=Math.max(0,Math.min(255,(lr>>16)+or)),ur=Math.max(0,Math.min(255,(lr>>8&255)+or)),dr=Math.max(0,Math.min(255,(lr&255)+or));return`#${((1<<24)+(cr<<16)+(ur<<8)+dr).toString(16).slice(1)}`}function AddLookModal({isOpen:ar,onClose:or,preselectedCharacterId:lr}){const{currentProject:cr,setProject:ur}=useProjectStore(),[dr,hr]=reactExports.useState(""),[pr,xr]=reactExports.useState(""),[mr,fr]=reactExports.useState(""),[Er,vr]=reactExports.useState(""),[gr,yr]=reactExports.useState("30");reactExports.useEffect(()=>{var br;ar&&(hr(lr||((br=cr==null?void 0:cr.characters[0])==null?void 0:br.id)||""),xr(""),fr(""),vr(""),yr("30"))},[ar,lr,cr]),reactExports.useEffect(()=>{if(dr&&cr){const _r=cr.looks.filter(wr=>wr.characterId===dr).length+1;xr(`Day ${_r}`)}},[dr,cr]);const jr=()=>{if(!cr||!dr||!pr.trim())return;const br=parseInt(mr,10)||1,_r=parseInt(Er,10)||br,wr=[];for(let Sr=Math.min(br,_r);Sr<=Math.max(br,_r);Sr++)wr.push(String(Sr));const Rr={id:v4(),characterId:dr,name:pr.trim(),scenes:wr,estimatedTime:parseInt(gr,10)||30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()},Ar=cr.looks.map(Sr=>{if(Sr.characterId===dr&&wr.length>0){const kr=Sr.scenes.filter(Nr=>!wr.includes(Nr));if(kr.length!==Sr.scenes.length)return{...Sr,scenes:kr}}return Sr});ur({...cr,looks:[...Ar,Rr],updatedAt:new Date}),or()};return reactExports.useEffect(()=>(ar?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[ar]),ar?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm animate-fadeIn",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp max-h-[85vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Add New Look"}),jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -m-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"CHARACTER"}),jsxRuntimeExports.jsx("select",{value:dr,onChange:br=>hr(br.target.value),className:"input-field w-full",children:cr==null?void 0:cr.characters.map(br=>jsxRuntimeExports.jsx("option",{value:br.id,children:br.name},br.id))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"LOOK NAME"}),jsxRuntimeExports.jsx("input",{type:"text",value:pr,onChange:br=>xr(br.target.value),placeholder:"e.g., Day 1 - Professional",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:'Suggest descriptive names like "Day 1 - Office", "Post-Fight", etc.'})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"SCENE RANGE"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("input",{type:"number",value:mr,onChange:br=>fr(br.target.value),placeholder:"Start",min:"1",className:"input-field w-24 text-center"}),jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"to"}),jsxRuntimeExports.jsx("input",{type:"number",value:Er,onChange:br=>vr(br.target.value),placeholder:"End",min:"1",className:"input-field w-24 text-center"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Which scenes use this look? You can adjust later."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"ESTIMATED APPLICATION TIME"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{type:"number",value:gr,onChange:br=>yr(br.target.value),min:"5",step:"5",className:"input-field w-24 text-center"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-gold-50 rounded-lg p-3",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gold-dark font-medium",children:"Standalone Mode"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"You can add makeup and hair details after creating the look, or sync from desktop for full specifications."})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-border flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"flex-1 py-3 px-4 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:jr,disabled:!dr||!pr.trim(),className:"flex-1 py-3 px-4 rounded-button gold-gradient text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Look"})]})]})}):null}function LookOverview({lookId:ar,onBack:or,onSceneClick:lr}){const{currentProject:cr,getCharacter:ur,sceneCaptures:dr,updateLookWithPropagation:hr,updateLook:pr}=useProjectStore(),[xr,mr]=reactExports.useState(!1),[fr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(!1),[yr,jr]=reactExports.useState([]),[br,_r]=reactExports.useState(0),[wr,Rr]=reactExports.useState(!1),[Ar,Sr]=reactExports.useState(!1),[kr,Nr]=reactExports.useState(""),[Cr,Tr]=reactExports.useState(!1),[Pr,Ir]=reactExports.useState(""),Br=reactExports.useRef(null),Wr=reactExports.useRef(null),Yr=cr==null?void 0:cr.looks.find(ss=>ss.id===ar),es=Yr?ur(Yr.characterId):void 0;if(!Yr||!es||!cr)return null;const ts=cr.scenes.filter(ss=>Yr.scenes.includes(ss.sceneNumber)).map(ss=>{const Ur=`${ss.id}-${Yr.characterId}`,Xr=dr[Ur],cs=Xr==null?void 0:Xr.photos.front;return{scene:ss,frontPhoto:cs,hasCaptured:!!Xr&&!!(Xr.photos.front||Xr.additionalPhotos.length>0)}}),Qr=Yr.continuityFlags||createEmptyContinuityFlags(),Hr=Yr.sfxDetails||createEmptySFXDetails(),Kr=Yr.notes||"",rs=Yr.continuityEvents||[],Mr=(ss=!1)=>{Rr(ss),mr(!0)},Dr=async ss=>{const Ur=await createPhotoFromBlob(ss);if(wr){const Xr=Yr.sfxDetails||createEmptySFXDetails();hr(Yr.id,{sfxDetails:{...Xr,sfxReferencePhotos:[...Xr.sfxReferencePhotos,Ur]}})}else pr(Yr.id,{masterReference:Ur})},Lr=()=>{pr(Yr.id,{masterReference:void 0})},Fr=()=>{Yr.masterReference&&(jr([Yr.masterReference]),_r(0),gr(!0))},$r=ss=>{const Ur={...Qr,[ss]:!Qr[ss]};hr(Yr.id,{continuityFlags:Ur})},Vr=ss=>{const Ur={...ss,id:`event-${Date.now()}`};pr(Yr.id,{continuityEvents:[...rs,Ur]}),Er(!1)},Gr=ss=>{pr(Yr.id,{continuityEvents:rs.filter(Ur=>Ur.id!==ss)})},Jr=ss=>{hr(Yr.id,{sfxDetails:ss})},ms=ss=>{const Ur=Yr.sfxDetails||createEmptySFXDetails();pr(Yr.id,{sfxDetails:{...Ur,sfxReferencePhotos:Ur.sfxReferencePhotos.filter(Xr=>Xr.id!==ss)}})},ls=ss=>{hr(Yr.id,{notes:ss})},ds=()=>{Nr(Yr.name),Sr(!0)};reactExports.useEffect(()=>{Ar&&Br.current&&(Br.current.focus(),Br.current.select())},[Ar]);const bs=()=>{const ss=kr.trim();ss&&ss!==Yr.name&&pr(Yr.id,{name:ss}),Sr(!1)},ws=()=>{Ir(formatSceneRange(Yr.scenes)),Tr(!0)};reactExports.useEffect(()=>{Cr&&Wr.current&&Wr.current.focus()},[Cr]);const Is=()=>{const ss=parseSceneRange(Pr);if(ss.length>0){const Ur=ss.map(String);if(cr)if(cr.looks.filter(xs=>xs.characterId===Yr.characterId&&xs.id!==Yr.id).some(xs=>xs.scenes.some(Es=>Ur.includes(Es)))){const xs=cr.looks.map(Ns=>{if(Ns.id===Yr.id)return{...Ns,scenes:Ur};if(Ns.characterId===Yr.characterId){const Ts=Ns.scenes.filter(gs=>!Ur.includes(gs));if(Ts.length!==Ns.scenes.length)return{...Ns,scenes:Ts}}return Ns}),{setProject:Es}=useProjectStore.getState();Es({...cr,looks:xs,updatedAt:new Date})}else pr(Yr.id,{scenes:Ur})}Tr(!1)},ys=ss=>{var Ur;((Ur=Yr.masterReference)==null?void 0:Ur.id)===ss&&Lr(),jr(Xr=>Xr.filter(cs=>cs.id!==ss))};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"w-8 h-8 flex items-center justify-center -ml-1",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-[17px] font-bold text-text-primary flex-1",children:"Look Overview"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"px-4 py-4 space-y-2.5 pb-32",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3.5",children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:es,size:"xl"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h2",{className:"text-character-name text-gold font-bold truncate",children:es.name}),Ar?jsxRuntimeExports.jsx("div",{className:"mt-0.5 flex items-center gap-1.5",children:jsxRuntimeExports.jsx("input",{ref:Br,type:"text",value:kr,onChange:ss=>Nr(ss.target.value),onBlur:bs,onKeyDown:ss=>{ss.key==="Enter"&&bs(),ss.key==="Escape"&&Sr(!1)},className:"input-field text-sm font-semibold py-1 px-2 w-full",placeholder:"Look name"})}):jsxRuntimeExports.jsxs("button",{onClick:ds,className:"flex items-center gap-1 mt-0.5 group",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-text-primary",children:Yr.name}),jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-text-light group-active:text-gold transition-colors flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})]}),Cr?jsxRuntimeExports.jsxs("div",{className:"mt-1 flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted flex-shrink-0",children:"Scenes"}),jsxRuntimeExports.jsx("input",{ref:Wr,type:"text",value:Pr,onChange:ss=>Ir(ss.target.value),onBlur:Is,onKeyDown:ss=>{ss.key==="Enter"&&Is(),ss.key==="Escape"&&Tr(!1)},className:"input-field text-xs py-1 px-2 flex-1 min-w-0",placeholder:"e.g. 1-4, 6-12"})]}):jsxRuntimeExports.jsxs("button",{onClick:ws,className:"flex items-center gap-1 mt-0.5 group",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:["Scenes ",formatSceneRange(Yr.scenes)," "," ","~",formatEstimatedTime(Yr.estimatedTime)]}),jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-text-light group-active:text-gold transition-colors flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})]})]})]}),(()=>{const ss=[{key:"sweat",label:"Sweat"},{key:"dishevelled",label:"Dishevelled"},{key:"blood",label:"Blood"},{key:"dirt",label:"Dirt"},{key:"wetHair",label:"Wet Hair"},{key:"tears",label:"Tears"}].filter(({key:Ur})=>Qr[Ur]);return ss.length===0?null:jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:ss.map(({key:Ur,label:Xr})=>jsxRuntimeExports.jsx("span",{className:"px-3 py-1.5 text-xs font-semibold rounded-full bg-gold text-white",children:Xr},Ur))})})(),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"MASTER REFERENCE"}),jsxRuntimeExports.jsx(MasterReference,{photo:Yr.masterReference,onCapture:()=>Mr(!1),onView:Fr,onRemove:Yr.masterReference?Lr:void 0}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-2",children:"This reference applies to all scenes in this look"})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"SCENE CONTINUITY"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-light",children:[ts.filter(ss=>ss.hasCaptured).length,"/",ts.length," captured"]})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-3 overflow-x-auto hide-scrollbar pb-1 -mx-1 px-1",children:ts.map(({scene:ss,frontPhoto:Ur,hasCaptured:Xr})=>jsxRuntimeExports.jsxs("button",{onClick:()=>lr(ss.id),className:"flex-shrink-0 w-20 group",children:[jsxRuntimeExports.jsx("div",{className:`aspect-[3/4] rounded-lg overflow-hidden border-2 transition-colors ${Xr?"border-gold bg-gray-100":"border-gray-200 bg-gray-50"}`,children:Ur?jsxRuntimeExports.jsx("img",{src:Ur.thumbnail||Ur.uri,alt:`Scene ${ss.sceneNumber}`,className:"w-full h-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-full h-full flex items-center justify-center",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})})}),jsxRuntimeExports.jsxs("div",{className:`text-center mt-1.5 text-[10px] font-semibold ${Xr?"text-gold":"text-text-muted"}`,children:["Sc ",ss.sceneNumber]})]},ss.id))})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"QUICK FLAGS"}),jsxRuntimeExports.jsx(QuickFlags,{flags:Qr,onToggle:$r}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-2",children:"Flags set here apply to all scenes in this look"})]}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx(ContinuityEvents,{events:rs,onAddEvent:()=>Er(!0),onRemoveEvent:Gr})}),jsxRuntimeExports.jsx(Accordion,{title:"MAKEUP",count:countFilledFields(Yr.makeup),children:jsxRuntimeExports.jsx(MakeupForm,{makeup:Yr.makeup,onChange:ss=>hr(Yr.id,{makeup:ss})})}),jsxRuntimeExports.jsx(Accordion,{title:"HAIR",count:countHairFields(Yr.hair),children:jsxRuntimeExports.jsx(HairForm,{hair:Yr.hair,onChange:ss=>hr(Yr.id,{hair:ss})})}),jsxRuntimeExports.jsx(Accordion,{title:"SPECIAL EFFECTS",count:countSFXFields(Hr),badge:Hr.sfxRequired?void 0:"None",children:jsxRuntimeExports.jsx(SFXForm,{sfx:Hr,onChange:Jr,onCapturePhoto:()=>Mr(!0),onRemovePhoto:ms})}),jsxRuntimeExports.jsxs(Accordion,{title:"LOOK NOTES",children:[jsxRuntimeExports.jsx(NotesForm,{notes:Kr,onChange:ls}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-2",children:"Notes set here auto-fill into all scenes for this look"})]}),jsxRuntimeExports.jsxs("div",{className:"card flex items-center gap-3.5",children:[jsxRuntimeExports.jsx("label",{className:"field-label whitespace-nowrap",children:"APPLICATION TIME"}),jsxRuntimeExports.jsx("input",{type:"number",value:Yr.estimatedTime||"",onChange:ss=>pr(Yr.id,{estimatedTime:ss.target.value?parseInt(ss.target.value,10):0}),className:"input-field w-16 text-center font-semibold",placeholder:"--",min:"0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]})]})}),jsxRuntimeExports.jsx(PhotoCapture,{isOpen:xr,onClose:()=>mr(!1),onCapture:Dr,angle:"front",characterName:es.name,sceneNumber:Yr.scenes[0]||"",lookName:Yr.name}),jsxRuntimeExports.jsx(AddEventModal,{isOpen:fr,onClose:()=>Er(!1),onAdd:Vr,availableScenes:Yr.scenes}),jsxRuntimeExports.jsx(PhotoViewer,{isOpen:vr,photos:yr,initialIndex:br,onClose:()=>gr(!1),onDelete:ys})]})}function Lookbooks(){const{currentProject:ar,sceneCaptures:or,currentLookId:lr,setCurrentLook:cr,setActiveTab:ur,setCurrentScene:dr}=useProjectStore(),{schedule:hr}=useScheduleStore(),{callSheets:pr}=useCallSheetStore(),[xr,mr]=reactExports.useState(!1),[fr,Er]=reactExports.useState(null),vr=reactExports.useMemo(()=>{const Cr=new Map;for(const Tr of pr)for(const Pr of Tr.scenes)if(Pr.cast)for(const Ir of Pr.cast){const Br=parseInt(Ir,10);isNaN(Br)||(Cr.has(Br)||Cr.set(Br,new Set),Cr.get(Br).add(Pr.sceneNumber))}return Cr},[pr]),gr=reactExports.useMemo(()=>{const Cr=new Map;return ar!=null&&ar.characters&&ar.characters.forEach(Tr=>{Cr.set(Tr.id,{...Tr})}),hr!=null&&hr.castList&&hr.castList.forEach(Tr=>{const Pr=(Tr.character||Tr.name).toUpperCase(),Ir=ar==null?void 0:ar.characters.find(Br=>Br.name.toUpperCase()===Pr);if(Ir){const Br=Cr.get(Ir.id);Br&&(Br.actorNumber=Tr.number,Cr.set(Ir.id,Br))}else{const Br=Tr.character||Tr.name,Wr=`cast-${Tr.number}`,Yr=Br.split(/\s+/).filter(Boolean),es=Yr.length>=2?`${Yr[0][0]}${Yr[Yr.length-1][0]}`.toUpperCase():Br.substring(0,2).toUpperCase(),ps=["#C9A962","#8B5CF6","#EC4899","#14B8A6","#F59E0B","#6366F1","#22C55E","#EF4444"],ts=ps[Tr.number%ps.length];Cr.set(Wr,{id:Wr,name:Br,initials:es,avatarColour:ts,actorNumber:Tr.number})}}),Array.from(Cr.values()).sort((Tr,Pr)=>{const Ir=Tr.actorNumber??999,Br=Pr.actorNumber??999;return Ir!==Br?Ir-Br:Tr.name.localeCompare(Pr.name)})},[ar==null?void 0:ar.characters,hr==null?void 0:hr.castList]),yr=reactExports.useCallback(()=>{const Cr=new Map;return gr.forEach(Tr=>{Cr.set(Tr.id,[])}),ar!=null&&ar.looks&&ar.looks.forEach(Tr=>{const Pr=Cr.get(Tr.characterId)||[];Cr.set(Tr.characterId,[...Pr,Tr])}),Cr},[ar==null?void 0:ar.looks,gr]),jr=reactExports.useCallback(Cr=>{if(!ar)return{captured:0,total:0};const Tr=Cr.scenes.length;let Pr=0;return Cr.scenes.forEach(Ir=>{const Br=ar.scenes.find(Wr=>Wr.sceneNumber===Ir);if(Br){const Wr=`${Br.id}-${Cr.characterId}`,Yr=or[Wr];Yr&&(Yr.photos.front||Yr.additionalPhotos.length>0)&&Pr++}}),{captured:Pr,total:Tr}},[ar,or]),br=Cr=>gr.find(Tr=>Tr.id===Cr),_r=Cr=>{Er(Cr||null),mr(!0)},[wr,Rr]=reactExports.useState(!1),Ar=reactExports.useCallback(async()=>{if(!(!ar||wr)){Rr(!0);try{const Cr=ar.characters.filter(Wr=>ar.looks.some(Yr=>Yr.characterId===Wr.id)).map(Wr=>{const Yr=ar.looks.filter(es=>es.characterId===Wr.id);return generateCharacterLookbookPDF(Wr,Yr,ar.scenes,or)});if(Cr.length===0)return;let Tr;if(Cr.length===1)Tr=Cr[0];else{const Wr=Cr.map(ps=>{const ts=ps.match(/<body>([\s\S]*?)<\/body>/);return ts?ts[1]:""}),Yr=Cr[0].match(/<style>([\s\S]*?)<\/style>/),es=Yr?Yr[1]:"";Tr=`<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>${ar.name} - Lookbooks</title><style>${es}</style></head><body>${Wr.join('<div class="page-break"></div>')}</body></html>`}const Pr=new Blob([Tr],{type:"text/html;charset=utf-8"}),Ir=URL.createObjectURL(Pr),Br=window.open(Ir,"_blank");Br&&Br.addEventListener("load",()=>{setTimeout(()=>Br.print(),500)}),URL.revokeObjectURL(Ir)}finally{Rr(!1)}}},[ar,or,wr]);if(lr)return jsxRuntimeExports.jsx(LookOverview,{lookId:lr,onBack:()=>cr(null),onSceneClick:Cr=>{cr(null),ur("breakdown"),dr(Cr)}});if(!ar)return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx(LookbooksHeader,{}),jsxRuntimeExports.jsx(EmptyState,{onAddLook:()=>_r()})]});const Sr=yr(),kr=gr.length>0,Nr=gr.length;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx(LookbooksHeader,{onExport:Ar,isExporting:wr}),jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"px-4 pt-4 pb-24",children:[jsxRuntimeExports.jsx(SyncStatusBanner,{}),kr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"section-header mb-3",children:["CAST & LOOKBOOKS (",Nr,")"]}),jsxRuntimeExports.jsx("div",{className:"space-y-5",children:Array.from(Sr.entries()).map(([Cr,Tr])=>{const Pr=br(Cr);if(!Pr)return null;let Ir=0,Br=0;Tr.forEach(ps=>{const ts=jr(ps);Ir+=ts.captured,Br+=ts.total});const Wr=Pr.actorNumber?vr.get(Pr.actorNumber):void 0,Yr=(Wr==null?void 0:Wr.size)||0,es=Math.max(Br,Yr);return jsxRuntimeExports.jsx(CharacterSection,{character:Pr,looks:Tr,capturedScenes:Ir,totalScenes:es,getCaptureProgress:jr,onAddLook:()=>_r(Cr)},Cr)})})]}):jsxRuntimeExports.jsx(EmptyState,{onAddLook:()=>_r()})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>_r(),className:"fixed bottom-24 right-4 w-14 h-14 rounded-full gold-gradient shadow-lg flex items-center justify-center text-white z-40 active:scale-95 transition-transform","aria-label":"Add Look",children:jsxRuntimeExports.jsx("svg",{className:"w-7 h-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),jsxRuntimeExports.jsx(AddLookModal,{isOpen:xr,onClose:()=>mr(!1),preselectedCharacterId:fr})]})}function LookbooksHeader({onExport:ar,isExporting:or}){return jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:"w-9"}),jsxRuntimeExports.jsx("h1",{className:"text-[17px] font-bold text-text-primary",children:"Lookbook"}),ar?jsxRuntimeExports.jsx("button",{onClick:ar,disabled:or,className:"p-2 rounded-lg transition-colors touch-manipulation text-text-muted hover:text-gold disabled:opacity-50",title:"Export Lookbooks",children:or?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})})}):jsxRuntimeExports.jsx("div",{className:"w-9"})]})})})}function EmptyState({onAddLook:ar}){return jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-[60vh] px-8",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gold-100 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"No looks defined"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-6",children:"Sync from desktop or create looks manually"}),jsxRuntimeExports.jsxs("button",{onClick:ar,className:"inline-flex items-center gap-2 px-6 py-3 rounded-button gold-gradient text-white font-medium shadow-sm active:scale-95 transition-transform",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Look"]})]})})}function parseTimeShorthand(ar){if(!ar)return"";let or=ar.trim().toLowerCase(),lr=!1,cr=!1;/p\.?m\.?$/.test(or)||/p$/.test(or)?(lr=!0,or=or.replace(/p\.?m\.?$|p$/,"").trim()):(/a\.?m\.?$/.test(or)||/a$/.test(or))&&(cr=!0,or=or.replace(/a\.?m\.?$|a$/,"").trim());let ur,dr;if(or.includes(":")){const hr=or.split(":");ur=parseInt(hr[0],10),dr=parseInt(hr[1]||"0",10)}else{const hr=or.replace(/\D/g,"");if(!hr)return"";if(hr.length<=2)ur=parseInt(hr,10),dr=0;else if(hr.length===3)ur=parseInt(hr[0],10),dr=parseInt(hr.slice(1),10);else if(hr.length===4)ur=parseInt(hr.slice(0,2),10),dr=parseInt(hr.slice(2),10);else return""}return lr&&ur<12&&(ur+=12),cr&&ur===12&&(ur=0),isNaN(ur)||isNaN(dr)||ur<0||ur>23||dr<0||dr>59?"":`${ur.toString().padStart(2,"0")}:${dr.toString().padStart(2,"0")}`}const TIME_SLOTS=[];for(let ar=5;ar<=23;ar++)TIME_SLOTS.push(`${ar.toString().padStart(2,"0")}:00`),TIME_SLOTS.push(`${ar.toString().padStart(2,"0")}:30`);function formatSlotLabel(ar){const[or,lr]=ar.split(":"),cr=parseInt(or,10),ur=cr<12?"am":"pm";return`${cr===0?12:cr>12?cr-12:cr}:${lr}${ur}`}function SmartTimeInput({value:ar,onChange:or,placeholder:lr,className:cr,style:ur}){const[dr,hr]=reactExports.useState(ar||""),[pr,xr]=reactExports.useState(!1),[mr,fr]=reactExports.useState(!1),Er=reactExports.useRef(null),vr=reactExports.useRef(null);reactExports.useEffect(()=>{pr||hr(ar||"")},[ar,pr]),reactExports.useEffect(()=>{if(mr&&vr.current&&ar){const _r=TIME_SLOTS.indexOf(ar);if(_r>=0){const wr=vr.current.children[_r];wr==null||wr.scrollIntoView({block:"center"})}}},[mr,ar]),reactExports.useEffect(()=>{if(!mr)return;const _r=wr=>{Er.current&&!Er.current.contains(wr.target)&&fr(!1)};return document.addEventListener("mousedown",_r),()=>document.removeEventListener("mousedown",_r)},[mr]);const gr=reactExports.useCallback(()=>{const _r=parseTimeShorthand(dr);hr(_r),_r!==ar&&or(_r)},[dr,ar,or]),yr=()=>{xr(!1),gr()},jr=_r=>{_r.key==="Enter"&&_r.currentTarget.blur()},br=_r=>{hr(_r),or(_r),fr(!1)};return jsxRuntimeExports.jsxs("div",{ref:Er,className:"relative flex items-center gap-1",children:[jsxRuntimeExports.jsx("input",{type:"text",inputMode:"numeric",value:dr,onChange:_r=>hr(_r.target.value),onBlur:yr,onFocus:()=>{xr(!0),fr(!1)},onKeyDown:jr,placeholder:lr||"00:00",className:cr,style:{...ur,flex:1}}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[jsxRuntimeExports.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider px-1 py-px rounded",style:{backgroundColor:"var(--color-border)",color:"var(--color-text-muted)"},children:"24hr"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:_r=>{_r.preventDefault(),fr(!mr)},className:"p-0.5 rounded",style:{color:"var(--color-text-muted)"},"aria-label":"Pick time",children:jsxRuntimeExports.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("polyline",{points:"12 6 12 12 16 14"})]})})]}),mr&&jsxRuntimeExports.jsx("div",{ref:vr,className:"absolute left-0 right-0 z-50 rounded-lg shadow-lg overflow-y-auto",style:{top:"100%",marginTop:4,maxHeight:200,backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)"},children:TIME_SLOTS.map(_r=>{const wr=_r===ar;return jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>br(_r),className:`w-full px-3 py-2 text-left text-[13px] flex justify-between items-center ${wr?"font-bold":""}`,style:{backgroundColor:wr?"var(--color-input-bg)":"transparent",color:wr?"var(--color-gold)":"var(--color-text-primary)",borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("span",{className:"font-mono",children:_r}),jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:11},children:formatSlotLabel(_r)})]},_r)})})]})}const DAY_LABELS$1=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],DAY_TYPES=["SWD","CWD","SCWD"];function WeekView({weekStartDate:ar,onNavigate:or}){const{entries:lr,calculateEntry:cr,saveEntry:ur,getEntry:dr,rateCard:hr}=useTimesheetStore(),[pr,xr]=reactExports.useState(null),[mr,fr]=reactExports.useState(null),Er=()=>{const br=new Date(ar),_r=new Date(addDays(ar,6)),wr=br.getDate(),Rr=_r.getDate(),Ar=br.toLocaleDateString("en-GB",{month:"short"}),Sr=_r.toLocaleDateString("en-GB",{month:"short"}),kr=DAY_LABELS$1[0][0],Nr=DAY_LABELS$1[6][0];return Ar===Sr?`${kr} ${wr} - ${Nr} ${Rr} ${Ar}`:`${kr} ${wr} ${Ar} - ${Nr} ${Rr} ${Sr}`},vr=Array.from({length:7},(br,_r)=>{const wr=addDays(ar,_r),Rr=lr[wr],Ar=Rr?cr(Rr):null,Sr=new Date().toISOString().split("T")[0];return{date:wr,dayLabel:DAY_LABELS$1[_r],dayNumber:new Date(wr).getDate(),entry:Rr,calc:Ar,isToday:wr===Sr,isWeekend:_r>=5}}),gr=br=>{pr===br?(mr&&mr.date===br&&ur(mr),xr(null),fr(null)):(mr&&ur(mr),xr(br),fr(dr(br)||createEmptyTimesheetEntry(br)))},yr=(br,_r)=>{if(!mr)return;const wr={[br]:_r};if(br==="dayType"){const Ar=_r;wr.lunchTaken=getLunchDurationForDayType(Ar)}const Rr={...mr,...wr};fr(Rr),ur(Rr)},jr=br=>!(br!=null&&br.unitCall)||!(br!=null&&br.wrapOut)?null:`${br.preCall||br.unitCall}  ${br.wrapOut}`;return jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>or("prev"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:Er()}),jsxRuntimeExports.jsx("button",{onClick:()=>or("next"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:vr.map(({date:br,dayLabel:_r,dayNumber:wr,entry:Rr,calc:Ar,isToday:Sr,isWeekend:kr})=>{const Nr=Rr&&Rr.unitCall&&Rr.wrapOut,Cr=pr===br,Tr=jr(Rr),Pr=[];return Nr&&(Rr.dayType!=="SWD"&&Pr.push(Rr.dayType),Ar&&Ar.preCallHours>0&&Pr.push(`${Ar.preCallHours.toFixed(1)}h pre`),Ar&&Ar.otHours>0&&Pr.push(`${Ar.otHours.toFixed(1)}h OT`),Rr.isSixthDay&&!Rr.isSeventhDay&&Pr.push("6th day"),Rr.isSeventhDay&&Pr.push("7th day")),jsxRuntimeExports.jsxs("div",{className:`rounded-xl overflow-hidden border transition-all ${Sr?"border-2 border-gold":"border-border"}`,style:{backgroundColor:"var(--color-card)"},children:[jsxRuntimeExports.jsxs("div",{onClick:()=>gr(br),className:"px-3.5 py-3 flex items-center cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 w-11 text-center mr-3",children:[jsxRuntimeExports.jsx("div",{className:`text-[10px] font-medium uppercase ${Sr||kr?"text-gold":""}`,style:{color:Sr||kr?void 0:"var(--color-text-muted)"},children:_r}),jsxRuntimeExports.jsx("div",{className:`text-xl font-bold ${Sr?"text-gold":""}`,style:{color:Sr?void 0:"var(--color-text-primary)"},children:wr})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:Nr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"text-[14px] font-semibold",style:{color:"var(--color-text-primary)"},children:Tr}),Pr.length>0&&jsxRuntimeExports.jsx("div",{className:"text-[11px] mt-0.5 truncate",style:{color:"var(--color-text-muted)"},children:Pr.join("  ")})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:`text-[14px] font-medium ${Sr?"text-gold":""}`,style:{color:Sr?void 0:"var(--color-text-muted)"},children:Sr?"Today":""}),jsxRuntimeExports.jsx("div",{className:"text-[12px] text-gold font-medium mt-0.5",children:"+ Add hours"})]})}),Ar&&Ar.totalHours>0&&jsxRuntimeExports.jsxs("div",{className:"text-right ml-3 flex-shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"text-[17px] font-bold text-gold leading-tight",children:[Ar.totalHours.toFixed(Ar.totalHours%1===0?0:1),"h"]}),Ar.totalEarnings>0&&jsxRuntimeExports.jsxs("div",{className:"text-[11px] font-medium leading-tight",style:{color:"var(--color-text-muted)"},children:["",Ar.totalEarnings.toFixed(0)]})]}),jsxRuntimeExports.jsx("svg",{className:`w-3 h-3 ml-2.5 flex-shrink-0 transition-transform ${Cr?"rotate-180":""}`,style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),Cr&&mr&&jsxRuntimeExports.jsx(ExpandedDayContent,{entry:mr,updateField:yr,calculation:cr(mr),rateCard:hr})]},br)})})]})}function ExpandedDayContent({entry:ar,updateField:or,calculation:lr,rateCard:cr}){const ur=!!ar.autoFilledFrom;return jsxRuntimeExports.jsxs("div",{className:"px-4 pb-4 pt-3 space-y-3",style:{borderTop:"1px solid var(--color-border)"},onClick:dr=>dr.stopPropagation(),children:[ur&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-emerald-600 bg-emerald-50 px-3 py-2 rounded-lg",children:[jsxRuntimeExports.jsx("span",{children:""}),jsxRuntimeExports.jsxs("span",{children:["Times auto-filled from Day ",ar.productionDay," call sheet"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-[11px] uppercase tracking-wide font-medium min-w-[70px]",style:{color:"var(--color-text-muted)"},children:"Day Type"}),jsxRuntimeExports.jsx("select",{value:ar.dayType,onChange:dr=>or("dayType",dr.target.value),className:"flex-1 py-2.5 px-3 rounded-lg text-sm font-medium appearance-none bg-no-repeat",style:{backgroundColor:"var(--color-input-bg)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E")`,backgroundPosition:"right 12px center"},children:DAY_TYPES.map(dr=>jsxRuntimeExports.jsxs("option",{value:dr,children:[dr," - ",DAY_TYPE_LABELS[dr]]},dr))})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs("label",{className:`flex items-center gap-2 px-3.5 py-2.5 rounded-lg cursor-pointer border ${ar.isSixthDay?"bg-orange-50 border-orange-400":""}`,style:ar.isSixthDay?void 0:{backgroundColor:"var(--color-input-bg)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:`w-[18px] h-[18px] rounded flex items-center justify-center text-xs ${ar.isSixthDay?"bg-orange-500 border-orange-500 text-white":"border-2"}`,style:ar.isSixthDay?void 0:{borderColor:"#ccc"},children:ar.isSixthDay&&""}),jsxRuntimeExports.jsx("span",{className:"text-[13px] font-medium",style:{color:"var(--color-text-primary)"},children:"6th Day"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-orange-500",children:["(",cr.sixthDayMultiplier,"x)"]}),jsxRuntimeExports.jsx("input",{type:"checkbox",checked:ar.isSixthDay,onChange:dr=>{or("isSixthDay",dr.target.checked),dr.target.checked&&or("isSeventhDay",!1)},className:"sr-only"})]}),jsxRuntimeExports.jsxs("label",{className:`flex items-center gap-2 px-3.5 py-2.5 rounded-lg cursor-pointer border ${ar.isSeventhDay?"bg-red-50 border-red-400":""}`,style:ar.isSeventhDay?void 0:{backgroundColor:"var(--color-input-bg)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:`w-[18px] h-[18px] rounded flex items-center justify-center text-xs ${ar.isSeventhDay?"bg-red-600 border-red-600 text-white":"border-2"}`,style:ar.isSeventhDay?void 0:{borderColor:"#ccc"},children:ar.isSeventhDay&&""}),jsxRuntimeExports.jsx("span",{className:"text-[13px] font-medium",style:{color:"var(--color-text-primary)"},children:"7th Day"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-red-600",children:["(",cr.seventhDayMultiplier,"x)"]}),jsxRuntimeExports.jsx("input",{type:"checkbox",checked:ar.isSeventhDay,onChange:dr=>{or("isSeventhDay",dr.target.checked),dr.target.checked&&or("isSixthDay",!1)},className:"sr-only"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[jsxRuntimeExports.jsx(TimeInputCell,{label:"Pre-Call",value:ar.preCall,onChange:dr=>or("preCall",dr),highlight:"gold",hint:`@ ${cr.preCallMultiplier}x`}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Unit Call",value:ar.unitCall,onChange:dr=>or("unitCall",dr)}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Lunch",value:ar.lunchStart||"",onChange:dr=>or("lunchStart",dr)}),jsxRuntimeExports.jsxs("div",{className:"p-2.5 rounded-lg",style:{backgroundColor:"var(--color-input-bg)",border:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:"text-[10px] uppercase tracking-wide mb-0.5",style:{color:"var(--color-text-muted)"},children:"Lunch Duration"}),jsxRuntimeExports.jsxs("select",{value:ar.lunchTaken,onChange:dr=>or("lunchTaken",parseInt(dr.target.value)),className:"text-[15px] font-semibold bg-transparent w-full appearance-none",style:{color:"var(--color-text-primary)"},children:[jsxRuntimeExports.jsx("option",{value:30,children:"30 min"}),jsxRuntimeExports.jsx("option",{value:45,children:"45 min"}),jsxRuntimeExports.jsx("option",{value:60,children:"1 hr"}),jsxRuntimeExports.jsx("option",{value:0,children:"None"})]})]}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Unit Wrap",value:ar.outOfChair,onChange:dr=>or("outOfChair",dr)}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Wrap Out",value:ar.wrapOut,onChange:dr=>or("wrapOut",dr),highlight:lr.otHours>0?"orange":void 0,hint:lr.otHours>0?"OT":void 0})]}),lr.totalHours>0&&jsxRuntimeExports.jsxs("div",{className:"rounded-lg p-3.5",style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsx("div",{className:"text-[10px] uppercase tracking-wide font-medium mb-2.5",style:{color:"var(--color-text-muted)"},children:"Hours Breakdown"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1.5",children:[lr.preCallHours>0&&jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Pre-Call",hours:lr.preCallHours,rate:`@ ${cr.preCallMultiplier}x`}),jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Base Hours",hours:lr.baseHours,rate:"@ 1x"}),lr.otHours>0&&jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Overtime",hours:lr.otHours,rate:`@ ${cr.otMultiplier}x`}),lr.lateNightHours>0&&jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Late Night",hours:lr.lateNightHours,rate:`@ ${cr.lateNightMultiplier}x`}),jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Lunch (unpaid)",hours:-(ar.lunchTaken/60)}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pt-2.5 mt-2.5",style:{borderTop:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold",style:{color:"var(--color-text-primary)"},children:"Total Worked"}),jsxRuntimeExports.jsxs("span",{className:"text-base font-bold",style:{color:"var(--color-text-primary)"},children:[lr.totalHours.toFixed(1)," hrs"]})]})]})]}),lr.totalEarnings>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg gold-gradient text-white",children:[jsxRuntimeExports.jsx("span",{className:"text-[11px] uppercase tracking-wide opacity-90",children:"Day Earnings"}),jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold",children:["",lr.totalEarnings.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"text-[10px] uppercase tracking-wide font-medium mb-1.5",style:{color:"var(--color-text-muted)"},children:["Notes / OT Reason",lr.otHours>0&&jsxRuntimeExports.jsx("span",{className:"text-orange-500 ml-1",children:"(Required for OT)"})]}),jsxRuntimeExports.jsx("textarea",{value:ar.notes,onChange:dr=>or("notes",dr.target.value),placeholder:"e.g., Extended for reshoots, rain delay...",rows:2,className:"w-full p-3 rounded-lg text-[13px] resize-none",style:{backgroundColor:"var(--color-input-bg)",border:`1px solid ${lr.otHours>0&&!ar.notes?"rgba(249, 115, 22, 0.5)":"var(--color-border)"}`,color:"var(--color-text-primary)"}})]})]})}function TimeInputCell({label:ar,value:or,onChange:lr,highlight:cr,hint:ur}){const dr=cr==="gold"?{backgroundColor:"#fffbeb",border:"1px solid var(--color-gold)"}:cr==="orange"?{backgroundColor:"#fff7ed",border:"1px solid #f97316"}:{backgroundColor:"var(--color-input-bg)",border:"1px solid var(--color-border)"};return jsxRuntimeExports.jsxs("div",{className:"p-2.5 rounded-lg relative",style:{...dr,overflow:"visible"},children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] uppercase tracking-wide",style:{color:"var(--color-text-muted)"},children:ar}),ur&&jsxRuntimeExports.jsx("span",{className:"text-[9px] font-semibold",style:{color:cr==="orange"?"#f97316":"var(--color-gold)"},children:ur})]}),jsxRuntimeExports.jsx(SmartTimeInput,{value:or,onChange:lr,className:"text-[15px] font-semibold bg-transparent outline-none min-w-0",style:{color:or?"var(--color-text-primary)":"var(--color-text-muted)"}})]})}function BreakdownRow$1({label:ar,hours:or,rate:lr}){return jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-[13px]",children:[jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1.5",style:{color:"var(--color-text-muted)"},children:[ar,lr&&jsxRuntimeExports.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:lr})]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:[(or>0,""),or.toFixed(1)," hrs"]})]})}const DAY_LABELS=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function TimesheetDocument({weekStartDate:ar,onNavigate:or}){const{entries:lr,calculateEntry:cr,getWeekSummary:ur,getPreviousWrapOut:dr,rateCard:hr}=useTimesheetStore(),pr=ur(ar),xr=()=>{const gr=new Date(ar),yr=new Date(addDays(ar,6)),jr=gr.getDate(),br=yr.getDate(),_r=gr.toLocaleDateString("en-GB",{month:"short"}),wr=yr.toLocaleDateString("en-GB",{month:"short"}),Rr=yr.getFullYear();return _r===wr?`${jr} - ${br} ${_r} ${Rr}`:`${jr} ${_r} - ${br} ${wr} ${Rr}`},mr=Array.from({length:7},(gr,yr)=>{const jr=addDays(ar,yr),br=lr[jr],_r=dr(jr),wr=br?cr(br,_r):null,Rr=new Date().toISOString().split("T")[0];return{date:jr,dayLabel:DAY_LABELS[yr],dayNumber:new Date(jr).getDate(),entry:br,calc:wr,isToday:jr===Rr,hasData:!!(br!=null&&br.unitCall&&(br!=null&&br.wrapOut))}}),fr=mr.filter(gr=>gr.hasData).length,Er=gr=>gr||"",vr=gr=>{switch(gr){case"CWD":return"bg-blue-100 text-blue-700";case"SCWD":return"bg-pink-100 text-pink-700";default:return"bg-gray-100 text-gray-600"}};return jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>or("prev"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:xr()}),jsxRuntimeExports.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-muted)"},children:[fr," day",fr!==1?"s":""," logged"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>or("next"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl border overflow-hidden",style:{backgroundColor:"var(--color-card)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-white font-semibold text-sm",children:"WEEKLY TIMESHEET"}),jsxRuntimeExports.jsx("p",{className:"text-white/70 text-xs",children:xr()})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("div",{className:"text-white/70 text-xs",children:"Week Total"}),jsxRuntimeExports.jsxs("div",{className:"text-white font-bold text-lg",children:[pr.totalHours.toFixed(1)," hrs"]})]})]})}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full min-w-[600px] text-xs",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsx("th",{className:"text-left py-2 px-3 font-medium sticky left-0 z-10",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-text-muted)",minWidth:"80px"},children:""}),mr.map(gr=>jsxRuntimeExports.jsxs("th",{className:`text-center py-2 px-2 font-medium ${gr.isToday?"text-gold":""}`,style:{color:gr.isToday?void 0:"var(--color-text-muted)",minWidth:"70px"},children:[jsxRuntimeExports.jsx("div",{className:"font-semibold",children:gr.dayLabel}),jsxRuntimeExports.jsx("div",{className:`text-lg ${gr.isToday?"text-gold":""}`,style:{color:gr.isToday?void 0:"var(--color-text-primary)"},children:gr.dayNumber})]},gr.date)),jsxRuntimeExports.jsx("th",{className:"text-center py-2 px-3 font-semibold",style:{backgroundColor:"var(--color-gold-light)",color:"var(--color-gold)",minWidth:"70px"},children:"Total"})]})}),jsxRuntimeExports.jsxs("tbody",{children:[jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Day Type"}),mr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",children:(yr=gr.entry)!=null&&yr.dayType?jsxRuntimeExports.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${vr(gr.entry.dayType)}`,children:gr.entry.dayType}):jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-placeholder)"},children:""})},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("span",{className:"text-gold",children:"Pre-Call"})}),mr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",style:{color:"var(--color-text-primary)"},children:Er((yr=gr.entry)==null?void 0:yr.preCall)},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3 font-medium",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-gold)"},children:pr.preCallHours>0?`${pr.preCallHours.toFixed(1)}h`:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Unit Call"}),mr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2 font-medium",style:{color:"var(--color-text-primary)"},children:Er((yr=gr.entry)==null?void 0:yr.unitCall)},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Lunch"}),mr.map(gr=>{var yr,jr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",style:{color:"var(--color-text-muted)"},children:((yr=gr.entry)==null?void 0:yr.dayType)==="CWD"?jsxRuntimeExports.jsx("span",{className:"text-[10px]",children:"W.I.H"}):(jr=gr.entry)!=null&&jr.lunchTaken?`${gr.entry.lunchTaken}m`:""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Wrap Out"}),mr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2 font-medium",style:{color:"var(--color-text-primary)"},children:Er((yr=gr.entry)==null?void 0:yr.wrapOut)},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:9,className:"py-1",style:{backgroundColor:"var(--color-input-bg)"}})}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Base Hrs"}),mr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",style:{color:"var(--color-text-primary)"},children:(yr=gr.calc)!=null&&yr.baseHours?gr.calc.baseHours.toFixed(1):""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3 font-semibold",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-text-primary)"},children:pr.baseHours.toFixed(1)})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("span",{className:"text-orange-500",children:"Overtime"})}),mr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2 text-orange-500",children:(yr=gr.calc)!=null&&yr.otHours?`+${gr.calc.otHours.toFixed(1)}`:""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3 font-semibold text-orange-500",style:{backgroundColor:"var(--color-input-bg)"},children:pr.otHours>0?`+${pr.otHours.toFixed(1)}`:""})]}),jsxRuntimeExports.jsxs("tr",{style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3 font-semibold sticky left-0",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-text-primary)"},children:"Total Hrs"}),mr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-2 font-bold",style:{color:"var(--color-text-primary)"},children:(yr=gr.calc)!=null&&yr.totalHours?gr.calc.totalHours.toFixed(1):""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-3 font-bold text-gold",style:{backgroundColor:"var(--color-gold-light)"},children:pr.totalHours.toFixed(1)})]}),(pr.sixthDayHours>0||pr.seventhDayHours>0)&&jsxRuntimeExports.jsxs("tr",{style:{borderTop:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Premium"}),mr.map(gr=>{var yr,jr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",children:(yr=gr.entry)!=null&&yr.isSeventhDay?jsxRuntimeExports.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-red-100 text-red-600",children:"7th"}):(jr=gr.entry)!=null&&jr.isSixthDay?jsxRuntimeExports.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-orange-100 text-orange-600",children:"6th"}):jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-placeholder)"},children:""})},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{className:"gold-gradient",children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3 font-semibold text-white sticky left-0",style:{background:"inherit"},children:"Earnings"}),mr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-2 text-white font-medium",children:(yr=gr.calc)!=null&&yr.totalEarnings?formatCurrency(gr.calc.totalEarnings):""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-3 font-bold text-white text-base",children:formatCurrency(pr.totalEarnings)})]})]})]})})]}),pr.totalEarnings>0&&jsxRuntimeExports.jsxs("div",{className:"mt-4 rounded-xl border p-4",style:{backgroundColor:"var(--color-card)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("h4",{className:"text-xs font-medium uppercase tracking-wide mb-3",style:{color:"var(--color-text-muted)"},children:"Earnings Breakdown"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(BreakdownRow,{label:"Base Pay",value:pr.basePay}),pr.preCallPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:`Pre-Call (${hr.preCallMultiplier}x)`,value:pr.preCallPay,highlight:"gold"}),pr.overtimePay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:`Overtime (${hr.otMultiplier}x)`,value:pr.overtimePay,highlight:"orange"}),pr.brokenLunchPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:"Broken Lunch",value:pr.brokenLunchPay,highlight:"amber"}),pr.brokenTurnaroundPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:"Broken Turnaround",value:pr.brokenTurnaroundPay,highlight:"purple"}),pr.lateNightPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:`Late Night (${hr.lateNightMultiplier}x)`,value:pr.lateNightPay,highlight:"red"}),pr.kitRentalTotal>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:"Kit Rental",value:pr.kitRentalTotal}),jsxRuntimeExports.jsx("div",{className:"pt-2 mt-2",style:{borderTop:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:"Week Total"}),jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-gold",children:formatCurrency(pr.totalEarnings)})]})})]})]}),fr===0&&jsxRuntimeExports.jsxs("div",{className:"mt-6 text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",style:{backgroundColor:"var(--color-input-bg)"},children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8",style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),jsxRuntimeExports.jsx("h3",{className:"font-semibold mb-1",style:{color:"var(--color-text-primary)"},children:"No hours logged this week"}),jsxRuntimeExports.jsx("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:"Switch to Day view to log your hours"})]})]})}function BreakdownRow({label:ar,value:or,highlight:lr}){const cr={gold:"text-gold",orange:"text-orange-500",amber:"text-amber-500",red:"text-red-500",purple:"text-purple-500"};return jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm",children:[jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-muted)"},children:ar}),jsxRuntimeExports.jsx("span",{className:`font-medium ${lr?cr[lr]:""}`,style:lr?void 0:{color:"var(--color-text-primary)"},children:formatCurrency(or)})]})}function SummaryCard({summary:ar}){const{rateCard:or}=useTimesheetStore();return ar.entries.length>0?jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center",children:[jsxRuntimeExports.jsx(SummaryItem,{label:"Days",value:ar.entries.length.toString()}),jsxRuntimeExports.jsx(SummaryItem,{label:"Base Hrs",value:ar.baseHours.toFixed(0)}),jsxRuntimeExports.jsx(SummaryItem,{label:"Pre-Call",value:ar.preCallHours.toFixed(1),subtext:`@ ${or.preCallMultiplier}x`}),jsxRuntimeExports.jsx(SummaryItem,{label:"Overtime",value:ar.otHours.toFixed(1),subtext:`@ ${or.otMultiplier}x`,highlight:!0})]}),(ar.sixthDayHours>0||ar.seventhDayHours>0||ar.lateNightHours>0)&&jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center mt-3 pt-3",style:{borderTop:"1px solid var(--color-border)"},children:[ar.sixthDayHours>0&&jsxRuntimeExports.jsx(SummaryItem,{label:"6th Day",value:ar.sixthDayHours.toFixed(1),subtext:`@ ${or.sixthDayMultiplier}x`}),ar.seventhDayHours>0&&jsxRuntimeExports.jsx(SummaryItem,{label:"7th Day",value:ar.seventhDayHours.toFixed(1),subtext:`@ ${or.seventhDayMultiplier}x`}),ar.lateNightHours>0&&jsxRuntimeExports.jsx(SummaryItem,{label:"Late Night",value:ar.lateNightHours.toFixed(1),subtext:`@ ${or.lateNightMultiplier}x`})]}),ar.totalEarnings>0&&jsxRuntimeExports.jsxs("details",{className:"group mt-4",children:[jsxRuntimeExports.jsxs("summary",{className:"flex items-center justify-between cursor-pointer py-2",style:{borderTop:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("span",{className:"text-xs uppercase tracking-wide font-semibold",style:{color:"var(--color-text-muted)"},children:"Earnings Preview"}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 transition-transform group-open:rotate-180",style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),jsxRuntimeExports.jsxs("div",{className:"pt-3 space-y-2",children:[ar.kitRentalTotal>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Kit Rental"}),jsxRuntimeExports.jsxs("span",{style:{color:"var(--color-text-primary)"},children:["",ar.kitRentalTotal.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Est. Total"}),jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold text-gold",children:["",ar.totalEarnings.toLocaleString("en-GB",{minimumFractionDigits:2})]})]})]})]})]}):jsxRuntimeExports.jsxs("div",{className:"card text-center py-8",children:[jsxRuntimeExports.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",style:{color:"var(--color-text-placeholder)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsx("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:"No entries this week"}),jsxRuntimeExports.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-placeholder)"},children:"Tap a day to log your hours"})]})}function SummaryItem({label:ar,value:or,subtext:lr,highlight:cr}){return jsxRuntimeExports.jsxs("div",{className:"py-2 px-1",children:[jsxRuntimeExports.jsx("div",{className:"text-[9px] uppercase tracking-wide font-medium mb-1",style:{color:"var(--color-text-placeholder)"},children:ar}),jsxRuntimeExports.jsx("div",{className:`text-lg font-bold ${cr?"text-gold":""}`,style:{color:cr?void 0:"var(--color-text-primary)"},children:or}),lr&&jsxRuntimeExports.jsx("div",{className:"text-[10px]",style:{color:"var(--color-text-placeholder)"},children:lr})]})}function ExportModal({isOpen:ar,onClose:or,weekSummary:lr,weekStartDate:cr}){const{entries:ur,calculateEntry:dr,rateCard:hr}=useTimesheetStore(),[pr,xr]=reactExports.useState("pdf"),[mr,fr]=reactExports.useState(!1),[Er,vr]=reactExports.useState(!1);if(!ar)return null;const gr=()=>{const Nr=[];for(let Cr=0;Cr<7;Cr++){const Tr=addDays(cr,Cr),Pr=ur[Tr];Pr&&Nr.push({date:Tr,entry:Pr,calc:dr(Pr)})}return Nr},yr=lr.entries.length,br=(()=>{let Nr=0,Cr=0,Tr=0,Pr=0,Ir=0,Br=0,Wr=0,Yr=0;return lr.entries.forEach(es=>{const ps=dr(es);Nr+=ps.preCallHours,Cr+=ps.preCallEarnings,Tr+=ps.workingHours,Pr+=ps.lateNightHours,Ir+=ps.dailyEarnings,Br+=ps.otEarnings,Wr+=ps.lateNightEarnings,Yr+=ps.sixthDayBonus}),{preCallHours:Nr,preCallPay:Cr,workingHours:Tr,lateNightHours:Pr,basePay:Ir,otPay:Br,lateNightPay:Wr,sixthDayBonus:Yr}})(),_r=Nr=>new Date(Nr).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}),wr=()=>{const Nr=new Date(cr),Cr=new Date(addDays(cr,6));return`${Nr.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${Cr.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}`},Rr=()=>{const Nr=gr(),Cr=["Date","Day Type","Pre-Call","Unit Call","Out of Chair","Wrap Out","6th Day","Lunch (mins)","Pre-Call Hours","Working Hours","OT Hours","Late Night Hours","Total Hours","Pre-Call Pay","Base Pay","OT Pay","Late Night Pay","6th Day Bonus","Kit Rental","Total Earnings","Notes"],Tr=Nr.map(({date:Pr,entry:Ir,calc:Br})=>[_r(Pr),Ir.dayType,Ir.preCall||"",Ir.unitCall||"",Ir.outOfChair||"",Ir.wrapOut||"",Ir.isSixthDay?"Yes":"No",String(Ir.lunchTaken??60),Br.preCallHours.toFixed(2),Br.workingHours.toFixed(2),Br.otHours.toFixed(2),Br.lateNightHours.toFixed(2),Br.totalHours.toFixed(2),Br.preCallEarnings.toFixed(2),Br.dailyEarnings.toFixed(2),Br.otEarnings.toFixed(2),Br.lateNightEarnings.toFixed(2),Br.sixthDayBonus.toFixed(2),Br.kitRental.toFixed(2),Br.totalEarnings.toFixed(2),Ir.notes||""]);return Tr.push(["TOTAL","","","","","","","",br.preCallHours.toFixed(2),br.workingHours.toFixed(2),lr.otHours.toFixed(2),br.lateNightHours.toFixed(2),lr.totalHours.toFixed(2),br.preCallPay.toFixed(2),br.basePay.toFixed(2),br.otPay.toFixed(2),br.lateNightPay.toFixed(2),br.sixthDayBonus.toFixed(2),lr.kitRentalTotal.toFixed(2),lr.totalEarnings.toFixed(2),""]),[Cr.join(","),...Tr.map(Pr=>Pr.join(","))].join(`
`)},Ar=()=>{const Nr=gr(),Cr=hr.dailyRate/hr.baseDayHours,Tr="&pound;";return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Timesheet - ${wr()}</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 32px; max-width: 800px; margin: 0 auto; color: #1a1a1a; font-size: 13px; line-height: 1.5; }

    .header { margin-bottom: 24px; }
    .header h1 { font-size: 22px; font-weight: 700; margin-bottom: 2px; }
    .header .period { font-size: 14px; color: #C9A962; font-weight: 600; }

    .rate-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 24px; }
    .rate-card { background: #f8f8f8; border: 1px solid #e5e5e5; border-radius: 8px; padding: 10px 12px; text-align: center; }
    .rate-card .label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 2px; }
    .rate-card .value { font-size: 15px; font-weight: 700; }

    table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
    thead th { background: #f8f8f8; padding: 10px 8px; text-align: left; font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; color: #666; border-bottom: 2px solid #e5e5e5; }
    tbody td { padding: 10px 8px; border-bottom: 1px solid #f0f0f0; }
    tbody tr:last-child td { border-bottom: none; }
    .day-name { font-weight: 600; }
    .sixth-tag { display: inline-block; font-size: 9px; font-weight: 600; color: #C9A962; background: #faf6ed; border: 1px solid #C9A962; border-radius: 3px; padding: 1px 4px; margin-left: 4px; vertical-align: middle; }
    .amt { text-align: right; font-weight: 600; }
    .muted { color: #ccc; }
    tfoot td { border-top: 2px solid #C9A962; font-weight: 700; padding-top: 12px; }

    .summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px; }
    .summary-card { border: 1px solid #e5e5e5; border-radius: 8px; padding: 14px 12px; text-align: center; }
    .summary-card .label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 4px; }
    .summary-card .value { font-size: 20px; font-weight: 700; }
    .summary-card.gold { border-color: #C9A962; background: #faf6ed; }
    .summary-card.gold .value { color: #C9A962; }

    .sign-off { margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
    .sign-line { border-top: 1px solid #ccc; padding-top: 8px; font-size: 11px; color: #888; }

    .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #e5e5e5; font-size: 11px; color: #aaa; text-align: center; }

    @media print {
      body { padding: 16px; }
      .rate-card, .summary-card.gold, thead th { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>Timesheet</h1>
    <div class="period">${wr()}</div>
  </div>

  <div class="rate-cards">
    <div class="rate-card">
      <div class="label">Daily Rate</div>
      <div class="value">${Tr}${hr.dailyRate.toFixed(2)}</div>
    </div>
    <div class="rate-card">
      <div class="label">Base Day</div>
      <div class="value">${hr.baseDayHours} hrs</div>
    </div>
    <div class="rate-card">
      <div class="label">Hourly Rate</div>
      <div class="value">${Tr}${Cr.toFixed(2)}</div>
    </div>
    <div class="rate-card">
      <div class="label">Kit Rental</div>
      <div class="value">${Tr}${hr.kitRental.toFixed(2)}/day</div>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Pre-Call</th>
        <th>Unit Call</th>
        <th>Wrap</th>
        <th>Hours</th>
        <th>OT</th>
        <th class="amt">Earnings</th>
      </tr>
    </thead>
    <tbody>
      ${Nr.map(({date:Pr,entry:Ir,calc:Br})=>`
      <tr>
        <td><span class="day-name">${_r(Pr)}</span>${Ir.isSixthDay?'<span class="sixth-tag">6th Day</span>':""}</td>
        <td>${Ir.preCall||'<span class="muted">&mdash;</span>'}</td>
        <td>${Ir.unitCall||'<span class="muted">&mdash;</span>'}</td>
        <td>${Ir.wrapOut||'<span class="muted">&mdash;</span>'}</td>
        <td>${Br.totalHours.toFixed(1)}</td>
        <td>${Br.otHours>0?Br.otHours.toFixed(1):'<span class="muted">&mdash;</span>'}</td>
        <td class="amt">${Tr}${Br.totalEarnings.toFixed(2)}</td>
      </tr>`).join("")}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4">Total (${yr} days)</td>
        <td>${lr.totalHours.toFixed(1)}</td>
        <td>${lr.otHours>0?lr.otHours.toFixed(1):"&mdash;"}</td>
        <td class="amt">${Tr}${lr.totalEarnings.toFixed(2)}</td>
      </tr>
    </tfoot>
  </table>

  <div class="summary">
    <div class="summary-card">
      <div class="label">Days Worked</div>
      <div class="value">${yr}</div>
    </div>
    <div class="summary-card">
      <div class="label">Total Hours</div>
      <div class="value">${lr.totalHours.toFixed(1)}</div>
    </div>
    <div class="summary-card">
      <div class="label">OT Hours</div>
      <div class="value">${lr.otHours.toFixed(1)}</div>
    </div>
    <div class="summary-card gold">
      <div class="label">Total Earnings</div>
      <div class="value">${Tr}${lr.totalEarnings.toFixed(2)}</div>
    </div>
  </div>

  <div class="sign-off">
    <div>
      <div class="sign-line">Employee Signature</div>
    </div>
    <div>
      <div class="sign-line">Date</div>
    </div>
  </div>

  <div class="footer">
    Generated by Hair &amp; Makeup Pro
  </div>

</body>
</html>`},Sr=()=>{const Nr=hr.dailyRate/hr.baseDayHours,Cr=`INV-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`,Tr=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),Pr="&pound;";return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice ${Cr}</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; color: #1a1a1a; font-size: 14px; line-height: 1.5; }

    .inv-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 36px; padding-bottom: 20px; border-bottom: 3px solid #C9A962; }
    .inv-brand { font-size: 20px; font-weight: 700; color: #1a1a1a; }
    .inv-brand-sub { font-size: 12px; color: #888; margin-top: 2px; }
    .inv-title-block { text-align: right; }
    .inv-title { font-size: 28px; font-weight: 800; color: #C9A962; letter-spacing: 2px; }
    .inv-number { font-size: 13px; color: #666; margin-top: 2px; }

    .inv-details { display: flex; justify-content: space-between; margin-bottom: 32px; }
    .inv-col h3 { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 8px; font-weight: 600; }
    .inv-col p { font-size: 13px; color: #333; line-height: 1.7; }
    .inv-col strong { font-weight: 600; }
    .inv-placeholder { color: #bbb; font-style: italic; }

    table.inv-table { width: 100%; border-collapse: collapse; margin-bottom: 28px; }
    table.inv-table thead th { text-align: left; padding: 10px 10px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; color: #666; border-bottom: 2px solid #e5e5e5; }
    table.inv-table tbody td { padding: 14px 10px; border-bottom: 1px solid #f0f0f0; vertical-align: top; }
    table.inv-table tbody tr:last-child td { border-bottom: none; }
    table.inv-table .desc-sub { font-size: 12px; color: #888; margin-top: 2px; }
    table.inv-table .amt { text-align: right; font-weight: 600; white-space: nowrap; }

    .inv-totals { width: 280px; margin-left: auto; margin-bottom: 40px; }
    .inv-totals .row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px; }
    .inv-totals .row .lbl { color: #666; }
    .inv-totals .row .val { font-weight: 600; }
    .inv-totals .total-row { border-top: 2px solid #C9A962; padding-top: 10px; margin-top: 6px; }
    .inv-totals .total-row .lbl { font-weight: 700; font-size: 14px; color: #1a1a1a; }
    .inv-totals .total-row .val { font-weight: 800; font-size: 18px; color: #C9A962; }

    .inv-terms { background: #f8f8f8; border-radius: 8px; padding: 16px 20px; margin-bottom: 32px; font-size: 12px; color: #666; }
    .inv-terms strong { color: #333; }

    .inv-footer { padding-top: 16px; border-top: 1px solid #e5e5e5; font-size: 11px; color: #aaa; text-align: center; }

    @media print {
      body { padding: 20px; }
      .inv-header { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
</head>
<body>

  <div class="inv-header">
    <div>
      <div class="inv-brand">Hair &amp; Makeup Pro</div>
      <div class="inv-brand-sub">Freelance Services</div>
    </div>
    <div class="inv-title-block">
      <div class="inv-title">INVOICE</div>
      <div class="inv-number">${Cr}</div>
    </div>
  </div>

  <div class="inv-details">
    <div class="inv-col">
      <h3>From</h3>
      <p>
        <span class="inv-placeholder">[Your Name]</span><br>
        <span class="inv-placeholder">[Your Address]</span><br>
        <span class="inv-placeholder">[City, Postcode]</span>
      </p>
    </div>
    <div class="inv-col">
      <h3>Bill To</h3>
      <p>
        <span class="inv-placeholder">[Production Company]</span><br>
        <span class="inv-placeholder">[Address]</span><br>
        <span class="inv-placeholder">[City, Postcode]</span>
      </p>
    </div>
    <div class="inv-col" style="text-align: right;">
      <h3>Invoice Details</h3>
      <p>
        <strong>Date:</strong> ${Tr}<br>
        <strong>Due:</strong> 30 days from receipt<br>
        <strong>Period:</strong> ${wr()}
      </p>
    </div>
  </div>

  <table class="inv-table">
    <thead>
      <tr>
        <th>Description</th>
        <th>Qty</th>
        <th>Rate</th>
        <th class="amt">Amount</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Hair &amp; Makeup Services &mdash; Base Day Rate<div class="desc-sub">${yr} days &times; ${hr.baseDayHours} hours</div></td>
        <td>${yr}</td>
        <td>${Pr}${hr.dailyRate.toFixed(2)}</td>
        <td class="amt">${Pr}${br.basePay.toFixed(2)}</td>
      </tr>
      ${br.preCallPay>0?`
      <tr>
        <td>Pre-Call Hours<div class="desc-sub">${br.preCallHours.toFixed(1)} hours at hourly rate</div></td>
        <td>${br.preCallHours.toFixed(1)} hrs</td>
        <td>${Pr}${Nr.toFixed(2)}</td>
        <td class="amt">${Pr}${br.preCallPay.toFixed(2)}</td>
      </tr>`:""}
      ${br.otPay>0?`
      <tr>
        <td>Overtime<div class="desc-sub">At ${hr.otMultiplier}&times; hourly rate (${Pr}${(Nr*hr.otMultiplier).toFixed(2)}/hr)</div></td>
        <td>${lr.otHours.toFixed(1)} hrs</td>
        <td>${Pr}${(Nr*hr.otMultiplier).toFixed(2)}</td>
        <td class="amt">${Pr}${br.otPay.toFixed(2)}</td>
      </tr>`:""}
      ${br.lateNightPay>0?`
      <tr>
        <td>Late Night Hours<div class="desc-sub">${br.lateNightHours.toFixed(1)} hours after midnight</div></td>
        <td>${br.lateNightHours.toFixed(1)} hrs</td>
        <td>&mdash;</td>
        <td class="amt">${Pr}${br.lateNightPay.toFixed(2)}</td>
      </tr>`:""}
      ${br.sixthDayBonus>0?`
      <tr>
        <td>6th Day Premium<div class="desc-sub">Additional 50% for 6th consecutive working day</div></td>
        <td>&mdash;</td>
        <td>&mdash;</td>
        <td class="amt">${Pr}${br.sixthDayBonus.toFixed(2)}</td>
      </tr>`:""}
      ${lr.kitRentalTotal>0?`
      <tr>
        <td>Kit / Box Rental<div class="desc-sub">${yr} days at ${Pr}${hr.kitRental.toFixed(2)}/day</div></td>
        <td>${yr}</td>
        <td>${Pr}${hr.kitRental.toFixed(2)}</td>
        <td class="amt">${Pr}${lr.kitRentalTotal.toFixed(2)}</td>
      </tr>`:""}
    </tbody>
  </table>

  <div class="inv-totals">
    <div class="row">
      <span class="lbl">Base Pay</span>
      <span class="val">${Pr}${br.basePay.toFixed(2)}</span>
    </div>
    ${br.preCallPay>0?`<div class="row"><span class="lbl">Pre-Call</span><span class="val">${Pr}${br.preCallPay.toFixed(2)}</span></div>`:""}
    ${br.otPay>0?`<div class="row"><span class="lbl">Overtime</span><span class="val">${Pr}${br.otPay.toFixed(2)}</span></div>`:""}
    ${br.lateNightPay>0?`<div class="row"><span class="lbl">Late Night</span><span class="val">${Pr}${br.lateNightPay.toFixed(2)}</span></div>`:""}
    ${br.sixthDayBonus>0?`<div class="row"><span class="lbl">6th Day Premium</span><span class="val">${Pr}${br.sixthDayBonus.toFixed(2)}</span></div>`:""}
    ${lr.kitRentalTotal>0?`<div class="row"><span class="lbl">Kit Rental</span><span class="val">${Pr}${lr.kitRentalTotal.toFixed(2)}</span></div>`:""}
    <div class="row total-row">
      <span class="lbl">Total Due</span>
      <span class="val">${Pr}${lr.totalEarnings.toFixed(2)}</span>
    </div>
  </div>

  <div class="inv-terms">
    <strong>Payment Terms:</strong> 30 days from invoice date. Please reference invoice number <strong>${Cr}</strong> with payment.
  </div>

  <div class="inv-footer">
    Generated by Hair &amp; Makeup Pro
  </div>

</body>
</html>`},kr=async()=>{fr(!0),vr(!1);try{let Nr,Cr,Tr;switch(pr){case"csv":Nr=Rr(),Cr=`timesheet-${cr}.csv`,Tr="text/csv";break;case"pdf":Nr=Ar(),Cr=`timesheet-${cr}.html`,Tr="text/html";break;case"invoice":Nr=Sr(),Cr=`invoice-${cr}.html`,Tr="text/html";break}const Pr=new Blob([Nr],{type:Tr==="text/html"?"text/html;charset=utf-8":Tr}),Ir=URL.createObjectURL(Pr);if(pr==="pdf"||pr==="invoice"){const Br=window.open(Ir,"_blank");Br&&Br.addEventListener("load",()=>{setTimeout(()=>Br.print(),500)})}else{const Br=document.createElement("a");Br.href=Ir,Br.download=Cr,document.body.appendChild(Br),Br.click(),document.body.removeChild(Br)}URL.revokeObjectURL(Ir),vr(!0),setTimeout(()=>vr(!1),2e3)}catch(Nr){console.error("Export failed:",Nr)}finally{fr(!1)}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl w-full max-w-sm overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:"Export Timesheet"}),jsxRuntimeExports.jsx("button",{onClick:or,className:"p-1 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted mb-4",children:["Week of ",wr()]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 mb-6",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"EXPORT FORMAT"}),jsxRuntimeExports.jsx("button",{onClick:()=>xr("pdf"),className:`w-full p-3 rounded-card border-2 text-left transition-all ${pr==="pdf"?"border-gold bg-gold-50":"border-border bg-input-bg hover:border-gold/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${pr==="pdf"?"bg-gold text-white":"bg-gray-200 text-text-muted"}`,children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-text-primary",children:"PDF Timesheet"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Print-ready document"})]})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>xr("csv"),className:`w-full p-3 rounded-card border-2 text-left transition-all ${pr==="csv"?"border-gold bg-gold-50":"border-border bg-input-bg hover:border-gold/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${pr==="csv"?"bg-gold text-white":"bg-gray-200 text-text-muted"}`,children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-text-primary",children:"CSV Spreadsheet"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"For Excel/Google Sheets"})]})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>xr("invoice"),className:`w-full p-3 rounded-card border-2 text-left transition-all ${pr==="invoice"?"border-gold bg-gold-50":"border-border bg-input-bg hover:border-gold/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${pr==="invoice"?"bg-gold text-white":"bg-gray-200 text-text-muted"}`,children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-text-primary",children:"Invoice"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Ready to send to production"})]})]})})]}),jsxRuntimeExports.jsx("div",{className:"bg-input-bg rounded-card p-3 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center text-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-text-muted text-xs",children:"Days"}),jsxRuntimeExports.jsx("div",{className:"font-semibold text-text-primary",children:yr})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-text-muted text-xs",children:"Hours"}),jsxRuntimeExports.jsx("div",{className:"font-semibold text-text-primary",children:lr.totalHours.toFixed(1)})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-text-muted text-xs",children:"Total"}),jsxRuntimeExports.jsxs("div",{className:"font-semibold text-gold",children:["",lr.totalEarnings.toFixed(2)]})]})]})}),jsxRuntimeExports.jsx("button",{onClick:kr,disabled:mr,className:`w-full py-3 rounded-button font-medium transition-all ${Er?"bg-success text-white":"gold-gradient text-white active:scale-[0.98]"} ${mr?"opacity-70":""}`,children:mr?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Exporting..."]}):Er?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Exported!"]}):`Export ${pr==="pdf"?"PDF":pr==="csv"?"CSV":"Invoice"}`})]})]})})}const BASE_CONTRACT_OPTIONS=[{value:"10+1",label:"10+1 (10 hours work + 1hr lunch)",hours:10},{value:"11+1",label:"11+1 (11 hours work + 1hr lunch)",hours:11}];function RateCardSettings(){const{rateCard:ar,updateRateCard:or}=useTimesheetStore(),lr=cr=>{const ur=BASE_CONTRACT_OPTIONS.find(dr=>dr.value===cr);or({baseContract:cr,baseDayHours:(ur==null?void 0:ur.hours)||11})};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"DAILY RATE"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:""}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.dailyRate||"",onChange:cr=>or({dailyRate:cr.target.value?parseFloat(cr.target.value):0}),placeholder:"0.00",min:"0",step:"0.01",className:"input-field flex-1"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Your agreed daily rate (BECTU minimum guarantee)"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"BASE CONTRACT (BECTU)"}),jsxRuntimeExports.jsx("select",{value:ar.baseContract||"11+1",onChange:cr=>lr(cr.target.value),className:"input-field w-full",children:BASE_CONTRACT_OPTIONS.map(cr=>jsxRuntimeExports.jsx("option",{value:cr.value,children:cr.label},cr.value))}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Standard UK film industry contract. Hours worked beyond this trigger overtime."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-card p-4 space-y-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label",children:"RATE MULTIPLIERS"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Pre-Call"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.preCallMultiplier,onChange:cr=>or({preCallMultiplier:parseFloat(cr.target.value)||1.5}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-1",children:"Hours before unit call"})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Overtime (after base hours)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.otMultiplier,onChange:cr=>or({otMultiplier:parseFloat(cr.target.value)||1.5}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Late Night (after 23:00)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.lateNightMultiplier,onChange:cr=>or({lateNightMultiplier:parseFloat(cr.target.value)||2}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"6th Day"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.sixthDayMultiplier,onChange:cr=>or({sixthDayMultiplier:parseFloat(cr.target.value)||1.5}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-1",children:"Applied to entire day's earnings"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"7th Day"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.seventhDayMultiplier,onChange:cr=>or({seventhDayMultiplier:parseFloat(cr.target.value)||2}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-orange-500 font-medium"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-1",children:"7th consecutive day worked"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"KIT / BOX RENTAL"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:""}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.kitRental||"",onChange:cr=>or({kitRental:cr.target.value?parseFloat(cr.target.value):0}),placeholder:"0.00",min:"0",step:"0.01",className:"input-field flex-1"}),jsxRuntimeExports.jsx("span",{className:"text-text-muted text-sm",children:"/day"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Daily kit rental added to each working day"})]}),ar.dailyRate>0&&jsxRuntimeExports.jsxs("div",{className:"bg-gold-50 rounded-card p-4 mt-6",children:[jsxRuntimeExports.jsx("h4",{className:"field-label mb-3",children:"RATE SUMMARY"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Hourly Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(ar.dailyRate/ar.baseDayHours).toFixed(2),"/hr"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Pre-Call Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(ar.dailyRate/ar.baseDayHours*ar.preCallMultiplier).toFixed(2),"/hr"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"OT Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(ar.dailyRate/ar.baseDayHours*ar.otMultiplier).toFixed(2),"/hr"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Late Night Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(ar.dailyRate/ar.baseDayHours*ar.lateNightMultiplier).toFixed(2),"/hr"]})]})]})]})]})}function Timesheet(){const{viewMode:ar,setViewMode:or,selectedDate:lr,getWeekSummary:cr,rateCard:ur}=useTimesheetStore(),[dr,hr]=reactExports.useState(()=>getWeekStart(lr)),[pr,xr]=reactExports.useState(!1),[mr,fr]=reactExports.useState(!1),Er=yr=>{const jr=addDays(dr,yr==="next"?7:-7);hr(jr)},vr=cr(dr),gr=()=>{const yr=[];return ur.dailyRate>0&&yr.push(`${ur.dailyRate}/day`),yr.push(`${ur.baseDayHours}+1`),ur.kitRental>0&&yr.push(`Kit ${ur.kitRental}`),yr.join("  ")};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Timesheet"}),jsxRuntimeExports.jsx("button",{onClick:()=>xr(!0),className:"p-2 text-text-muted hover:text-gold transition-colors","aria-label":"Export",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 pb-3",children:jsxRuntimeExports.jsxs("div",{className:"flex bg-input-bg rounded-pill p-1 border border-border",children:[jsxRuntimeExports.jsx("button",{onClick:()=>or("week"),className:`flex-1 py-2 px-3 rounded-pill text-sm font-medium transition-all ${ar==="week"?"bg-card text-text-primary border-2 border-gold":"text-text-muted"}`,children:"Day"}),jsxRuntimeExports.jsx("button",{onClick:()=>or("sheet"),className:`flex-1 py-2 px-3 rounded-pill text-sm font-medium transition-all ${ar==="sheet"?"bg-card text-text-primary border-2 border-gold":"text-text-muted"}`,children:"Sheet"})]})})]})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsx("div",{className:"mx-4 mt-4 mb-3",children:jsxRuntimeExports.jsxs("div",{className:`rounded-xl border overflow-hidden transition-all ${mr?"border-gold":"border-border"}`,style:{backgroundColor:"var(--color-card)"},children:[jsxRuntimeExports.jsxs("div",{onClick:()=>fr(!mr),className:"px-4 py-3 flex items-center justify-between cursor-pointer",style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-medium flex items-center gap-2",style:{color:"var(--color-text-muted)"},children:[jsxRuntimeExports.jsx("span",{children:""})," Rate Card"]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs",style:{color:"var(--color-text-placeholder)"},children:gr()}),jsxRuntimeExports.jsx("svg",{className:`w-2.5 h-2.5 transition-transform ${mr?"rotate-180":""}`,style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),mr&&jsxRuntimeExports.jsx("div",{className:"px-4 py-3",style:{borderTop:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsx(RateCardSettings,{})})]})}),ar==="week"&&jsxRuntimeExports.jsx(WeekView,{weekStartDate:dr,onNavigate:Er,selectedDate:lr}),ar==="sheet"&&jsxRuntimeExports.jsx(TimesheetDocument,{weekStartDate:dr,onNavigate:Er}),jsxRuntimeExports.jsx("div",{className:"px-4 pb-24",children:jsxRuntimeExports.jsx(SummaryCard,{summary:vr})})]}),jsxRuntimeExports.jsx(ExportModal,{isOpen:pr,onClose:()=>xr(!1),weekSummary:vr,weekStartDate:dr})]})}async function extractReceiptData(ar){var or;try{const cr=(await ensureSupportedImageFormat(ar)).match(/^data:([^;]+);base64,(.+)$/);if(!cr)return{success:!1,data:null,error:"Invalid image data format"};const[,ur,dr]=cr,xr=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:[{type:"image",source:{type:"base64",media_type:ur,data:dr}},{type:"text",text:`Analyze this receipt image and extract the following information in JSON format:

{
  "vendor": "Store or supplier name",
  "amount": 123.45,
  "vat": 20.58,
  "date": "YYYY-MM-DD",
  "items": [
    { "name": "Item description", "price": 12.34 }
  ],
  "currency": "GBP",
  "confidence": "high"
}

IMPORTANT INSTRUCTIONS:
1. "vendor" - Extract the store/supplier name (e.g., "Amazon", "Catwalk Hair & Cosmetics", "Boots")
2. "amount" - The TOTAL amount paid (as a number, not string). Look for "Total", "Grand Total", "Amount Due", etc. This should be the final amount INCLUDING VAT.
3. "vat" - The VAT amount (as a number, not string). Look for "VAT", "Tax", "Sales Tax", "GST", or similar. If multiple VAT lines, sum them. If the receipt shows a VAT rate but no amount, calculate it from the subtotal. Set to null if no VAT information is visible.
4. "date" - The receipt date in YYYY-MM-DD format. Convert from any format you see (e.g., "23 November 2025"  "2025-11-23")
5. "items" - List individual items with their prices. Include product names and individual prices.
6. "currency" - Detect currency from symbols (=GBP, $=USD, =EUR) or text. Default to "GBP" if unclear.
7. "confidence" - Set to "high" if all fields are clearly visible, "medium" if some are unclear, "low" if the image is hard to read.

If a field cannot be determined, use null for that field (except items which should be an empty array).
Return ONLY the JSON object, no markdown or explanation.`}]}],system:`You are an expert receipt parser. Extract structured data from receipt images accurately.
Always return valid JSON. Be precise with numbers - do not include currency symbols in numeric fields.
For dates, always convert to YYYY-MM-DD format regardless of the source format.`,maxTokens:2e3,model:"claude-sonnet-4-20250514"})});if(!xr.ok){const yr=await xr.json().catch(()=>({}));throw new Error(((or=yr.error)==null?void 0:or.message)||yr.error||`API error: ${xr.status}`)}const mr=await xr.json();if(!mr.content||mr.content.length===0)throw new Error("Empty response from AI");const fr=mr.content[0].text;console.log("[ReceiptAI] Raw response:",fr);const Er=fr.match(/\{[\s\S]*\}/);if(!Er)throw new Error("Failed to parse receipt data from AI response");const vr=JSON.parse(Er[0]),gr={vendor:typeof vr.vendor=="string"?vr.vendor.trim():"",amount:typeof vr.amount=="number"?vr.amount:parseFloat(vr.amount)||null,vat:typeof vr.vat=="number"?vr.vat:parseFloat(vr.vat)||null,date:validateDate(vr.date),items:Array.isArray(vr.items)?vr.items.filter(yr=>yr&&typeof yr.name=="string").map(yr=>({name:yr.name.trim(),price:typeof yr.price=="number"?yr.price:parseFloat(yr.price)||0})):[],currency:typeof vr.currency=="string"?vr.currency.toUpperCase():"GBP",confidence:["high","medium","low"].includes(vr.confidence)?vr.confidence:"medium"};return console.log("[ReceiptAI] Extracted data:",gr),{success:!0,data:gr}}catch(lr){return console.error("[ReceiptAI] Extraction failed:",lr),{success:!1,data:null,error:lr instanceof Error?lr.message:"Failed to extract receipt data"}}}function validateDate(ar){if(!ar||typeof ar!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(ar)){const lr=new Date(ar);if(!isNaN(lr.getTime()))return ar}const or=new Date(ar);return isNaN(or.getTime())?null:or.toISOString().split("T")[0]}function buildDescriptionFromItems(ar){if(!ar||ar.length===0)return"";let lr=ar.slice(0,3).map(cr=>cr.name).join(", ");return ar.length>3&&(lr+=` +${ar.length-3} more`),lr}const CATEGORIES=["Kit Supplies","Consumables","Transportation","Equipment","Other"],BUDGET_STORAGE_KEY="hairandmakeup_budget";function Budget(){const[ar,or]=reactExports.useState([]),[lr,cr]=reactExports.useState(0),[ur,dr]=reactExports.useState(0),[hr,pr]=reactExports.useState(!1),[xr,mr]=reactExports.useState(null),[fr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(!1),[yr,jr]=reactExports.useState(DEFAULT_CURRENCY),[br,_r]=reactExports.useState(!1),[wr,Rr]=reactExports.useState(!1),[Ar,Sr]=reactExports.useState(null),kr=reactExports.useRef(null),Nr=reactExports.useRef(null),{currentProject:Cr}=useProjectStore();reactExports.useEffect(()=>{try{const $r=localStorage.getItem(BUDGET_STORAGE_KEY);if($r){const Vr=JSON.parse($r);Vr.budgetTotal!==void 0&&cr(Vr.budgetTotal),Vr.floatReceived!==void 0&&dr(Vr.floatReceived),Vr.receipts&&or(Vr.receipts),Vr.currency&&jr(Vr.currency)}}catch($r){console.error("Failed to load budget data:",$r)}},[]),reactExports.useEffect(()=>{try{localStorage.setItem(BUDGET_STORAGE_KEY,JSON.stringify({budgetTotal:lr,floatReceived:ur,receipts:ar,currency:yr}))}catch($r){console.error("Failed to save budget data:",$r)}},[lr,ur,ar,yr]);const Tr=getCurrencyByCode(yr),{totalSpent:Pr,totalVat:Ir,byCategory:Br}=reactExports.useMemo(()=>{const $r=ar.reduce((Jr,ms)=>Jr+ms.amount,0),Vr=ar.reduce((Jr,ms)=>Jr+(ms.vat||0),0),Gr={"Kit Supplies":0,Consumables:0,Transportation:0,Equipment:0,Other:0};return ar.forEach(Jr=>{Gr[Jr.category]+=Jr.amount}),{totalSpent:$r,totalVat:Vr,byCategory:Gr}},[ar]),Wr=lr-Pr,Yr=lr>0?Pr/lr*100:0,es=()=>{gr(!0)},ps=()=>{var $r;gr(!1),($r=kr.current)==null||$r.click()},ts=()=>{var $r;gr(!1),($r=Nr.current)==null||$r.click()},Qr=$r=>{var Gr;const Vr=(Gr=$r.target.files)==null?void 0:Gr[0];if(Vr){const Jr=new FileReader;Jr.onloadend=()=>{mr(Jr.result),Er(!0)},Jr.readAsDataURL(Vr)}$r.target.value=""},Hr=$r=>{const Vr={...$r,id:`r-${Date.now()}`,synced:!1};or([Vr,...ar]),Er(!1),mr(null)},Kr=()=>{gr(!1),mr(null),Er(!0)},rs=$r=>{or(ar.map(Vr=>Vr.id===$r.id?$r:Vr)),Sr(null)},Mr=$r=>{or(ar.filter(Vr=>Vr.id!==$r)),Sr(null)},Dr=()=>{const $r=(Cr==null?void 0:Cr.name)||"Production",Vr=getCurrencyByCode(yr),Gr=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),Jr=[];return Jr.push("SPENDING RECONCILIATION REPORT"),Jr.push(`Project: ${$r}`),Jr.push(`Export Date: ${Gr}`),Jr.push(`Currency: ${yr} (${Vr.symbol})`),Jr.push(""),Jr.push("BUDGET SUMMARY"),Jr.push(`Total Budget,${Vr.symbol}${lr.toFixed(2)}`),Jr.push(`Float Received,${Vr.symbol}${ur.toFixed(2)}`),Jr.push(`Total Spent,${Vr.symbol}${Pr.toFixed(2)}`),Jr.push(`Total VAT,${Vr.symbol}${Ir.toFixed(2)}`),Jr.push(`Remaining Budget,${Vr.symbol}${Wr.toFixed(2)}`),Jr.push(`Float Remaining,${Vr.symbol}${(ur-Pr).toFixed(2)}`),Jr.push(`Percentage Used,${Yr.toFixed(1)}%`),Jr.push(""),Jr.push("SPENDING BY CATEGORY"),Jr.push("Category,Amount"),CATEGORIES.forEach(ls=>{Br[ls]>0&&Jr.push(`${ls},${Vr.symbol}${Br[ls].toFixed(2)}`)}),Jr.push(`TOTAL,${Vr.symbol}${Pr.toFixed(2)}`),Jr.push(""),Jr.push("RECEIPT DETAILS"),Jr.push("Date,Vendor,Category,Description,Amount,VAT"),[...ar].sort((ls,ds)=>new Date(ls.date).getTime()-new Date(ds.date).getTime()).forEach(ls=>{const ds=new Date(ls.date).toLocaleDateString("en-GB"),bs=ls.vendor.includes(",")?`"${ls.vendor}"`:ls.vendor,ws=ls.description.includes(",")?`"${ls.description}"`:ls.description,Is=ls.vat>0?`${Vr.symbol}${ls.vat.toFixed(2)}`:"";Jr.push(`${ds},${bs},${ls.category},${ws},${Vr.symbol}${ls.amount.toFixed(2)},${Is}`)}),Jr.push(""),Jr.push(`Total Receipts: ${ar.length}`),Jr.join(`
`)},Lr=$r=>{const Vr=(Cr==null?void 0:Cr.name)||"Production",Gr=new Date().toISOString().split("T")[0];if($r==="csv"){const Jr=Dr(),ms=new Blob([Jr],{type:"text/csv"}),ls=URL.createObjectURL(ms),ds=document.createElement("a");ds.href=ls,ds.download=`spending-reconciliation-${Vr.replace(/\s+/g,"-").toLowerCase()}-${Gr}.csv`,document.body.appendChild(ds),ds.click(),document.body.removeChild(ds),URL.revokeObjectURL(ls)}else{const Jr=Fr(),ms=new Blob([Jr],{type:"text/html;charset=utf-8"}),ls=URL.createObjectURL(ms),ds=window.open(ls,"_blank");ds&&ds.addEventListener("load",()=>{setTimeout(()=>ds.print(),500)}),URL.revokeObjectURL(ls)}Rr(!1)},Fr=()=>{const $r=(Cr==null?void 0:Cr.name)||"Production",Gr=getCurrencyByCode(yr).symbol,Jr=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),ms=[...ar].sort((ds,bs)=>new Date(ds.date).getTime()-new Date(bs.date).getTime()),ls=ms.filter(ds=>ds.imageUri);return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spending Reconciliation - ${$r}</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 32px;
      max-width: 800px;
      margin: 0 auto;
      color: #1a1a1a;
      font-size: 13px;
      line-height: 1.5;
    }

    /* Header */
    .header { margin-bottom: 28px; }
    .header h1 { font-size: 22px; font-weight: 700; color: #1a1a1a; margin-bottom: 2px; }
    .header .project { font-size: 15px; color: #C9A962; font-weight: 600; margin-bottom: 4px; }
    .header .date { font-size: 12px; color: #888; }

    /* Summary Cards */
    .summary {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 28px;
    }
    .summary-card {
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 14px 12px;
      text-align: center;
    }
    .summary-card .label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 4px; }
    .summary-card .value { font-size: 20px; font-weight: 700; color: #1a1a1a; }
    .summary-card.gold { border-color: #C9A962; background: #faf6ed; }
    .summary-card.gold .value { color: #C9A962; }
    .summary-card.over .value { color: #dc3545; }

    /* Progress Bar */
    .progress-wrap { margin-bottom: 28px; }
    .progress-bar { height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 4px; background: #C9A962; }
    .progress-fill.over { background: #dc3545; }
    .progress-label { display: flex; justify-content: space-between; margin-top: 4px; font-size: 11px; color: #888; }

    /* Sections */
    .section { margin-bottom: 28px; }
    .section-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #888;
      padding-bottom: 6px;
      border-bottom: 2px solid #C9A962;
      margin-bottom: 12px;
    }

    /* Category Breakdown */
    .cat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
    .cat-row .name { color: #333; }
    .cat-row .bar-wrap { flex: 1; margin: 0 16px; display: flex; align-items: center; }
    .cat-bar { height: 6px; background: #C9A962; border-radius: 3px; opacity: 0.6; }
    .cat-row .amt { font-weight: 600; color: #1a1a1a; min-width: 80px; text-align: right; }
    .cat-total { display: flex; justify-content: space-between; padding: 10px 0; border-top: 2px solid #C9A962; font-weight: 700; margin-top: 4px; }

    /* Receipts Table */
    table.receipts { width: 100%; border-collapse: collapse; }
    table.receipts th {
      background: #f8f8f8;
      padding: 10px 8px;
      text-align: left;
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      color: #666;
      border-bottom: 2px solid #e5e5e5;
    }
    table.receipts td {
      padding: 10px 8px;
      border-bottom: 1px solid #f0f0f0;
      vertical-align: top;
    }
    table.receipts tr:last-child td { border-bottom: none; }
    table.receipts .num { text-align: center; color: #aaa; font-size: 11px; }
    table.receipts .amt { text-align: right; font-weight: 600; white-space: nowrap; }
    table.receipts .cat { font-size: 11px; color: #666; }
    table.receipts .desc { font-size: 11px; color: #999; }
    table.receipts tfoot td { border-top: 2px solid #C9A962; font-weight: 700; padding-top: 12px; }

    /* Receipt Filing */
    .filing-entry {
      page-break-inside: avoid;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .filing-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background: #f8f8f8;
      border-bottom: 1px solid #e5e5e5;
    }
    .filing-header .vendor { font-weight: 600; font-size: 14px; }
    .filing-header .amount { font-weight: 700; font-size: 14px; }
    .filing-meta {
      display: flex;
      gap: 16px;
      padding: 8px 14px;
      font-size: 11px;
      color: #666;
      border-bottom: 1px solid #f0f0f0;
    }
    .filing-meta span { display: flex; align-items: center; gap: 4px; }
    .filing-image {
      padding: 12px;
      text-align: center;
      background: #fafafa;
    }
    .filing-image img {
      max-width: 100%;
      max-height: 500px;
      object-fit: contain;
      border-radius: 4px;
    }

    /* Footer */
    .footer {
      margin-top: 32px;
      padding-top: 12px;
      border-top: 1px solid #e5e5e5;
      font-size: 11px;
      color: #aaa;
      text-align: center;
    }

    @media print {
      body { padding: 16px; }
      .summary-card.gold, table.receipts th, .filing-header {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      .filing-entry { page-break-inside: avoid; }
      .receipt-filing { page-break-before: always; }
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>Spending Reconciliation</h1>
    <div class="project">${$r}</div>
    <div class="date">Exported ${Jr}</div>
  </div>

  <div class="summary">
    <div class="summary-card">
      <div class="label">Budget</div>
      <div class="value">${Gr}${lr.toFixed(2)}</div>
    </div>
    <div class="summary-card">
      <div class="label">Spent</div>
      <div class="value">${Gr}${Pr.toFixed(2)}</div>
    </div>
    <div class="summary-card ${Wr>=0?"gold":"over"}">
      <div class="label">${Wr>=0?"Remaining":"Over Budget"}</div>
      <div class="value">${Gr}${Math.abs(Wr).toFixed(2)}</div>
    </div>
    <div class="summary-card">
      <div class="label">Used</div>
      <div class="value">${Yr.toFixed(1)}%</div>
    </div>
  </div>

  <div class="progress-wrap">
    <div class="progress-bar">
      <div class="progress-fill ${Yr>100?"over":""}" style="width: ${Math.min(Yr,100)}%"></div>
    </div>
    <div class="progress-label">
      <span>0%</span>
      <span>Budget utilisation</span>
      <span>100%</span>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Financial Reconciliation</div>
    <table style="width:100%; border-collapse:collapse; font-size:13px;">
      <tbody>
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Total Budget</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Gr}${lr.toFixed(2)}</td>
        </tr>
        ${ur>0?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Float Received</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Gr}${ur.toFixed(2)}</td>
        </tr>`:""}
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Total Spent</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Gr}${Pr.toFixed(2)}</td>
        </tr>
        ${Ir>0?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Total VAT (included in spent)</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Gr}${Ir.toFixed(2)}</td>
        </tr>
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Spend excl. VAT</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${Gr}${(Pr-Ir).toFixed(2)}</td>
        </tr>`:""}
        ${ur>0?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Float Remaining</td>
          <td style="padding:8px 0; text-align:right; font-weight:700; color:${ur-Pr>=0?"#198754":"#dc3545"}">${Gr}${(ur-Pr).toFixed(2)}</td>
        </tr>`:""}
        ${ur>0&&ur<lr?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Outstanding from Production</td>
          <td style="padding:8px 0; text-align:right; font-weight:700; color:#C9A962">${Gr}${(lr-ur).toFixed(2)}</td>
        </tr>`:""}
        ${ur>0&&Pr>ur?`
        <tr>
          <td style="padding:8px 0; color:#666">Owed by Production (overspend on float)</td>
          <td style="padding:8px 0; text-align:right; font-weight:700; color:#dc3545">${Gr}${(Pr-ur).toFixed(2)}</td>
        </tr>`:""}
      </tbody>
    </table>
  </div>

  <div class="section">
    <div class="section-title">Spending by Category</div>
    ${CATEGORIES.filter(ds=>Br[ds]>0).map(ds=>{const bs=Pr>0?Br[ds]/Pr*100:0;return`
      <div class="cat-row">
        <span class="name">${ds}</span>
        <span class="bar-wrap"><span class="cat-bar" style="width: ${bs}%"></span></span>
        <span class="amt">${Gr}${Br[ds].toFixed(2)}</span>
      </div>`}).join("")}
    <div class="cat-total">
      <span>Total</span>
      <span>${Gr}${Pr.toFixed(2)}</span>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Receipt Log (${ar.length} receipts)</div>
    <table class="receipts">
      <thead>
        <tr>
          <th style="width:30px">#</th>
          <th>Date</th>
          <th>Vendor</th>
          <th>Category</th>
          <th>Description</th>
          <th class="amt">VAT</th>
          <th class="amt">Amount</th>
        </tr>
      </thead>
      <tbody>
        ${ms.map((ds,bs)=>`
        <tr>
          <td class="num">${bs+1}</td>
          <td>${new Date(ds.date).toLocaleDateString("en-GB")}</td>
          <td>${ds.vendor}</td>
          <td class="cat">${ds.category}</td>
          <td class="desc">${ds.description||"&mdash;"}</td>
          <td class="amt">${ds.vat>0?`${Gr}${ds.vat.toFixed(2)}`:"&mdash;"}</td>
          <td class="amt">${Gr}${ds.amount.toFixed(2)}</td>
        </tr>`).join("")}
      </tbody>
      <tfoot>
        <tr>
          <td colspan="5">Total (${ar.length} receipts)</td>
          <td class="amt">${Ir>0?`${Gr}${Ir.toFixed(2)}`:"&mdash;"}</td>
          <td class="amt">${Gr}${Pr.toFixed(2)}</td>
        </tr>
      </tfoot>
    </table>
  </div>

  ${ls.length>0?`
  <div class="section receipt-filing">
    <div class="section-title">Receipt Filing (${ls.length} images)</div>
    ${ls.map((ds,bs)=>`
    <div class="filing-entry">
      <div class="filing-header">
        <span class="vendor">${bs+1}. ${ds.vendor}</span>
        <span class="amount">${Gr}${ds.amount.toFixed(2)}</span>
      </div>
      <div class="filing-meta">
        <span>${new Date(ds.date).toLocaleDateString("en-GB")}</span>
        <span>${ds.category}</span>
        ${ds.description?`<span>${ds.description}</span>`:""}
      </div>
      <div class="filing-image">
        <img src="${ds.imageUri}" alt="Receipt from ${ds.vendor}">
      </div>
    </div>`).join("")}
  </div>`:""}

  <div class="footer">
    Generated by Hair &amp; Makeup Pro &middot; ${Jr}
  </div>

</body>
</html>`};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Budget"}),jsxRuntimeExports.jsxs("button",{onClick:()=>_r(!0),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-text-muted bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:[jsxRuntimeExports.jsx("span",{children:Tr.symbol}),jsxRuntimeExports.jsx("span",{children:yr}),jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[ar.length>0&&jsxRuntimeExports.jsx("button",{onClick:()=>Rr(!0),className:"p-2 text-text-muted active:text-gold transition-colors",title:"Export reconciliation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})})}),jsxRuntimeExports.jsxs("button",{onClick:es,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gold active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"})]}),"Scan"]})]})]})})}),jsxRuntimeExports.jsx("input",{ref:kr,type:"file",accept:"image/*",capture:"environment",onChange:Qr,className:"hidden"}),jsxRuntimeExports.jsx("input",{ref:Nr,type:"file",accept:"image/*",onChange:Qr,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"section-header",children:"SPENDING OVERVIEW"}),jsxRuntimeExports.jsxs("button",{onClick:()=>pr(!0),className:"flex items-center gap-1 text-xs text-gold font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})}),lr>0?"Edit Budget":"Set Budget"]})]}),jsxRuntimeExports.jsx("div",{className:"relative h-3 bg-gray-100 rounded-full overflow-hidden mb-3",children:lr>0?jsxRuntimeExports.jsx("div",{className:`absolute left-0 top-0 h-full rounded-full transition-all ${Yr>90?"bg-error":Yr>70?"bg-amber-500":"bg-gold"}`,style:{width:`${Math.min(Yr,100)}%`}}):jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-light",children:"Set a budget to track spending"})})}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-end",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-text-primary",children:formatCurrency(Pr,yr)}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted ml-1",children:"spent"})]}),jsxRuntimeExports.jsx("div",{className:"text-right",children:lr>0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:`text-lg font-semibold ${Wr<0?"text-error":"text-green-600"}`,children:formatCurrency(Wr,yr)}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:["remaining of ",formatCurrency(lr,yr)]})]}):jsxRuntimeExports.jsx("button",{onClick:()=>pr(!0),className:"text-sm text-gold font-medium",children:"Tap to set budget"})})]}),(ur>0||Ir>0)&&jsxRuntimeExports.jsxs("div",{className:"mt-3 pt-3 border-t border-border space-y-1.5",children:[ur>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Float received"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:formatCurrency(ur,yr)})]}),ur>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Float remaining"}),jsxRuntimeExports.jsx("span",{className:`font-semibold ${ur-Pr<0?"text-error":"text-green-600"}`,children:formatCurrency(ur-Pr,yr)})]}),Ir>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Total VAT"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:formatCurrency(Ir,yr)})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h2",{className:"section-header mb-3",children:"BY CATEGORY"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[CATEGORIES.filter($r=>Br[$r]>0).map($r=>{const Vr=Br[$r],Gr=Pr>0?Vr/Pr*100:0;return jsxRuntimeExports.jsx("div",{className:"flex items-center gap-3",children:jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-text-primary",children:$r}),jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:formatCurrency(Vr,yr)})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 bg-gray-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gold/60 rounded-full",style:{width:`${Gr}%`}})})]})},$r)}),Pr===0&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light text-center py-2",children:"No expenses recorded yet"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"section-header",children:"RECENT RECEIPTS"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[ar.length," total"]})]}),ar.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ar.map($r=>jsxRuntimeExports.jsx("div",{className:"card cursor-pointer active:scale-[0.98] transition-transform",onClick:()=>Sr($r),children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary truncate",children:$r.vendor}),!$r.synced&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[9px] font-medium rounded bg-amber-100 text-amber-700",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:$r.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium rounded-full bg-gray-100 text-text-muted",children:$r.category}),jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-light",children:formatShortDate($r.date)})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-bold text-text-primary",children:formatCurrency($r.amount,yr)}),$r.vat>0&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-light block",children:["VAT ",formatCurrency($r.vat,yr)]})]}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})},$r.id))})]}),jsxRuntimeExports.jsxs("button",{onClick:es,className:"w-full card flex items-center justify-center gap-3 py-4 border-2 border-dashed border-gold/30 hover:border-gold hover:bg-gold/5 transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-gold",children:"Add Receipt"})]}),jsxRuntimeExports.jsx("div",{className:"text-center py-2",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light",children:"Syncs with website budget page"})})]}),br&&jsxRuntimeExports.jsx(CurrencyPickerModal,{currentCurrency:yr,onSelect:$r=>{jr($r),_r(!1)},onClose:()=>_r(!1)}),fr&&jsxRuntimeExports.jsx(AddReceiptModal,{imageUri:xr,currencySymbol:Tr.symbol,onAdd:Hr,onClose:()=>{Er(!1),mr(null)}}),vr&&jsxRuntimeExports.jsx(ScanOptionsModal,{onTakePhoto:ps,onChooseFromLibrary:ts,onManualEntry:Kr,onClose:()=>gr(!1)}),hr&&jsxRuntimeExports.jsx(BudgetEditModal,{currentBudget:lr,currentFloat:ur,currencySymbol:Tr.symbol,onSave:($r,Vr)=>{cr($r),dr(Vr),pr(!1)},onClose:()=>pr(!1)}),wr&&jsxRuntimeExports.jsx(ExportReconciliationModal,{onExport:Lr,onClose:()=>Rr(!1),receiptsCount:ar.length,totalSpent:Pr,currencySymbol:Tr.symbol}),Ar&&jsxRuntimeExports.jsx(ReceiptDetailModal,{receipt:Ar,currencySymbol:Tr.symbol,onSave:rs,onDelete:Mr,onClose:()=>Sr(null)})]})}function CurrencyPickerModal({currentCurrency:ar,onSelect:or,onClose:lr}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:lr,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg",onClick:cr=>cr.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-3 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Select Currency"})}),jsxRuntimeExports.jsx("div",{className:"p-2 max-h-[60vh] overflow-y-auto",children:CURRENCIES.map(cr=>jsxRuntimeExports.jsxs("button",{onClick:()=>or(cr.code),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${ar===cr.code?"bg-gold/10":"hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx("span",{className:"text-xl font-medium text-text-primary w-8",children:cr.symbol}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:cr.code}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted ml-2",children:cr.name})]}),ar===cr.code&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},cr.code))}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border",children:jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-full px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"})})]})})}function ScanOptionsModal({onTakePhoto:ar,onChooseFromLibrary:or,onManualEntry:lr,onClose:cr}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:cr,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg animate-slideUp",onClick:ur=>ur.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Add Receipt"})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:ar,className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gold/10 hover:bg-gold/20 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-gold/20 flex items-center justify-center",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Take Photo"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Capture receipt with camera"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:or,className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Choose from Library"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Select existing photo"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:lr,className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Manual Entry"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Enter details without photo"})]})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border",children:jsxRuntimeExports.jsx("button",{onClick:cr,className:"w-full px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"})})]})})}function AddReceiptModal({imageUri:ar,currencySymbol:or,onAdd:lr,onClose:cr}){const[ur,dr]=reactExports.useState(""),[hr,pr]=reactExports.useState(""),[xr,mr]=reactExports.useState(""),[fr,Er]=reactExports.useState("Kit Supplies"),[vr,gr]=reactExports.useState(""),[yr,jr]=reactExports.useState(new Date().toISOString().split("T")[0]),[br,_r]=reactExports.useState(!1),[wr,Rr]=reactExports.useState(null),[Ar,Sr]=reactExports.useState([]);reactExports.useEffect(()=>{ar&&kr(ar)},[ar]);const kr=async Cr=>{_r(!0),Rr(null);try{const Tr=await extractReceiptData(Cr);if(Tr.success&&Tr.data){const{data:Pr}=Tr;Pr.vendor&&dr(Pr.vendor),Pr.amount!==null&&pr(Pr.amount.toFixed(2)),Pr.vat!==null&&Pr.vat!==void 0&&mr(Pr.vat.toFixed(2)),Pr.date&&jr(Pr.date),Pr.items&&Pr.items.length>0&&(Sr(Pr.items),gr(buildDescriptionFromItems(Pr.items))),Pr.confidence==="low"&&Rr("Some values may be inaccurate. Please review carefully.")}else Rr(Tr.error||"Failed to extract receipt data. Please enter manually.")}catch(Tr){console.error("Extraction error:",Tr),Rr("Failed to analyze receipt. Please enter details manually.")}finally{_r(!1)}},Nr=Cr=>{Cr.preventDefault(),!(!ur||!hr)&&lr({date:yr,vendor:ur,amount:parseFloat(hr),vat:parseFloat(xr)||0,category:fr,description:vr,imageUri:ar||void 0})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Add Receipt"}),jsxRuntimeExports.jsx("button",{onClick:cr,className:"p-2 -mr-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("form",{onSubmit:Nr,className:"p-4 space-y-4",children:[ar&&jsxRuntimeExports.jsxs("div",{className:"relative aspect-[4/3] rounded-lg overflow-hidden bg-gray-100",children:[jsxRuntimeExports.jsx("img",{src:ar,alt:"Receipt",className:"w-full h-full object-contain"}),br&&jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 bg-black/60 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-3 border-white/30 border-t-white rounded-full animate-spin mb-3"}),jsxRuntimeExports.jsx("span",{className:"text-white text-sm font-medium",children:"Analyzing receipt..."})]})]}),wr&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 rounded-lg bg-amber-50 border border-amber-200",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-700",children:wr})}),!br&&!wr&&ar&&ur&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 rounded-lg bg-green-50 border border-green-200",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-green-700",children:"Receipt data extracted. Please review and edit if needed."})}),Ar.length>0&&jsxRuntimeExports.jsxs("div",{className:"rounded-lg border border-gray-200 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-secondary",children:"Detected Items:"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Sr([...Ar,{name:"",price:0}]),disabled:br,className:"text-[10px] font-medium text-gold hover:text-gold-dark",children:"+ Add Item"})]}),jsxRuntimeExports.jsx("div",{className:"divide-y divide-gray-100 max-h-48 overflow-y-auto",children:Ar.map((Cr,Tr)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:Cr.name,onChange:Pr=>{const Ir=[...Ar];Ir[Tr]={...Cr,name:Pr.target.value},Sr(Ir),gr(buildDescriptionFromItems(Ir))},className:"flex-1 text-xs bg-transparent border-b border-transparent focus:border-gold outline-none py-1 text-text-primary",placeholder:"Item name",disabled:br}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:Cr.price||"",onChange:Pr=>{const Ir=[...Ar];Ir[Tr]={...Cr,price:parseFloat(Pr.target.value)||0},Sr(Ir)},className:"w-16 text-xs text-right bg-transparent border-b border-transparent focus:border-gold outline-none py-1 text-text-primary",placeholder:"0.00",disabled:br})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const Pr=Ar.filter((Ir,Br)=>Br!==Tr);Sr(Pr),gr(buildDescriptionFromItems(Pr))},disabled:br,className:"p-1 text-text-light hover:text-red-500 transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},Tr))}),jsxRuntimeExports.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-200 flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-text-secondary",children:"Items Total:"}),jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-text-primary",children:[or,Ar.reduce((Cr,Tr)=>Cr+(Tr.price||0),0).toFixed(2)]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Vendor / Store"}),jsxRuntimeExports.jsx("input",{type:"text",value:ur,onChange:Cr=>dr(Cr.target.value),className:"input-field w-full",placeholder:"e.g., Camera Ready Cosmetics",required:!0,disabled:br})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Amount"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:hr,onChange:Cr=>pr(Cr.target.value),className:"input-field w-full pl-7",placeholder:"0.00",required:!0,disabled:br})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"VAT"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:xr,onChange:Cr=>mr(Cr.target.value),className:"input-field w-full pl-7",placeholder:"0.00",disabled:br})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Date"}),jsxRuntimeExports.jsx("input",{type:"date",value:yr,onChange:Cr=>jr(Cr.target.value),className:"input-field w-full",disabled:br})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Category"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:CATEGORIES.map(Cr=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Er(Cr),disabled:br,className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${fr===Cr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"} ${br?"opacity-50 cursor-not-allowed":""}`,children:Cr},Cr))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Description (optional)"}),jsxRuntimeExports.jsx("input",{type:"text",value:vr,onChange:Cr=>gr(Cr.target.value),className:"input-field w-full",placeholder:"e.g., Foundation restocks",disabled:br})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:cr,className:"flex-1 px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",disabled:br,children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 rounded-button gold-gradient text-white font-medium disabled:opacity-50",disabled:!ur||!hr||br,children:br?"Analyzing...":"Add Receipt"})]})]})]})})}function ReceiptDetailModal({receipt:ar,currencySymbol:or,onSave:lr,onDelete:cr,onClose:ur}){const[dr,hr]=reactExports.useState(!1),[pr,xr]=reactExports.useState(ar.vendor),[mr,fr]=reactExports.useState(ar.amount.toFixed(2)),[Er,vr]=reactExports.useState((ar.vat||0).toFixed(2)),[gr,yr]=reactExports.useState(ar.category),[jr,br]=reactExports.useState(ar.description),[_r,wr]=reactExports.useState(ar.date),[Rr,Ar]=reactExports.useState(!1),Sr=kr=>{kr.preventDefault(),!(!pr||!mr)&&lr({...ar,vendor:pr,amount:parseFloat(mr),vat:parseFloat(Er)||0,category:gr,description:jr,date:_r})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:ur,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto animate-slideUp",onClick:kr=>kr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between z-10",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:dr?"Edit Receipt":"Receipt Details"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[!dr&&jsxRuntimeExports.jsx("button",{onClick:()=>hr(!0),className:"p-2 text-gold hover:text-gold-dark transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),jsxRuntimeExports.jsx("button",{onClick:ur,className:"p-2 -mr-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),ar.imageUri&&jsxRuntimeExports.jsx("div",{className:"relative aspect-[4/3] bg-gray-100",children:jsxRuntimeExports.jsx("img",{src:ar.imageUri,alt:"Receipt",className:"w-full h-full object-contain"})}),dr?jsxRuntimeExports.jsxs("form",{onSubmit:Sr,className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Vendor / Store"}),jsxRuntimeExports.jsx("input",{type:"text",value:pr,onChange:kr=>xr(kr.target.value),className:"input-field w-full",placeholder:"e.g., Camera Ready Cosmetics",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Amount"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:mr,onChange:kr=>fr(kr.target.value),className:"input-field w-full pl-7",placeholder:"0.00",required:!0})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"VAT"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:Er,onChange:kr=>vr(kr.target.value),className:"input-field w-full pl-7",placeholder:"0.00"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Date"}),jsxRuntimeExports.jsx("input",{type:"date",value:_r,onChange:kr=>wr(kr.target.value),className:"input-field w-full"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Category"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:CATEGORIES.map(kr=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>yr(kr),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${gr===kr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:kr},kr))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Description"}),jsxRuntimeExports.jsx("input",{type:"text",value:jr,onChange:kr=>br(kr.target.value),className:"input-field w-full",placeholder:"e.g., Foundation restocks"})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{xr(ar.vendor),fr(ar.amount.toFixed(2)),vr((ar.vat||0).toFixed(2)),yr(ar.category),br(ar.description),wr(ar.date),hr(!1)},className:"flex-1 px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 rounded-button gold-gradient text-white font-medium disabled:opacity-50",disabled:!pr||!mr,children:"Save Changes"})]})]}):jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-text-primary",children:ar.vendor}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-0.5",children:formatShortDate(ar.date)})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("span",{className:"text-xl font-bold text-text-primary",children:[or,ar.amount.toFixed(2)]}),ar.vat>0&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:["incl. ",or,ar.vat.toFixed(2)," VAT"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[ar.vat>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"VAT"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-text-primary",children:[or,ar.vat.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Category"}),jsxRuntimeExports.jsx("span",{className:"px-2.5 py-1 text-xs font-medium rounded-full bg-gray-100 text-text-secondary",children:ar.category})]}),ar.description&&jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Description"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-primary text-right max-w-[60%]",children:ar.description})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Status"}),jsxRuntimeExports.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${ar.synced?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:ar.synced?"Synced":"Pending"})]})]}),jsxRuntimeExports.jsx("div",{className:"pt-2",children:Rr?jsxRuntimeExports.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Delete this receipt? This cannot be undone."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ar(!1),className:"flex-1 px-4 py-2.5 rounded-button bg-white border border-border text-text-primary text-sm font-medium",children:"Keep"}),jsxRuntimeExports.jsx("button",{onClick:()=>cr(ar.id),className:"flex-1 px-4 py-2.5 rounded-button bg-red-500 text-white text-sm font-medium",children:"Delete"})]})]}):jsxRuntimeExports.jsx("button",{onClick:()=>Ar(!0),className:"w-full px-4 py-3 rounded-button text-red-500 text-sm font-medium hover:bg-red-50 transition-colors",children:"Delete Receipt"})})]})]})})}function BudgetEditModal({currentBudget:ar,currentFloat:or,currencySymbol:lr,onSave:cr,onClose:ur}){const[dr,hr]=reactExports.useState(ar>0?ar.toString():""),[pr,xr]=reactExports.useState(or>0?or.toString():""),mr=fr=>{fr.preventDefault();const Er=parseFloat(dr),vr=parseFloat(pr)||0;!isNaN(Er)&&Er>=0&&cr(Er,vr)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:ur,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg animate-slideUp",onClick:fr=>fr.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-3 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Budget Settings"})}),jsxRuntimeExports.jsxs("form",{onSubmit:mr,className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Total Budget"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mb-2",children:"The overall budget allocated for this production."}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-lg",children:lr}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:dr,onChange:fr=>hr(fr.target.value),className:"input-field w-full pl-8 text-2xl font-bold",placeholder:"0.00",autoFocus:!0})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Float Received"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mb-2",children:"Money received in advance from production. This could be the full budget or a partial payment."}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-lg",children:lr}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:pr,onChange:fr=>xr(fr.target.value),className:"input-field w-full pl-8 text-xl font-bold",placeholder:"0.00"})]})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:ur,className:"flex-1 px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 rounded-button gold-gradient text-white font-medium",children:"Save"})]})]})]})})}function ExportReconciliationModal({onExport:ar,onClose:or,receiptsCount:lr,totalSpent:cr,currencySymbol:ur}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:or,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg animate-slideUp",onClick:dr=>dr.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Export Spending Report"})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Reconciliation Summary"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[lr," receipts recorded"]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("p",{className:"text-lg font-bold text-gold",children:[ur,cr.toFixed(2)]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"total spent"})]})]})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Export a spending reconciliation report to send to production. Choose your preferred format:"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>ar("csv"),className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Spreadsheet (CSV)"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Opens in Excel, Google Sheets"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>ar("pdf"),className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"PDF Report"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Print-ready document"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-full px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"})})]})})}const scriptRel="modulepreload",assetsURL=function(ar){return"/mobile/"+ar},seen={},__vitePreload=function ar(or,lr,cr){let ur=Promise.resolve();if(lr&&lr.length>0){document.getElementsByTagName("link");const hr=document.querySelector("meta[property=csp-nonce]"),pr=(hr==null?void 0:hr.nonce)||(hr==null?void 0:hr.getAttribute("nonce"));ur=Promise.allSettled(lr.map(xr=>{if(xr=assetsURL(xr),xr in seen)return;seen[xr]=!0;const mr=xr.endsWith(".css"),fr=mr?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${xr}"]${fr}`))return;const Er=document.createElement("link");if(Er.rel=mr?"stylesheet":scriptRel,mr||(Er.as="script"),Er.crossOrigin="",Er.href=xr,pr&&Er.setAttribute("nonce",pr),document.head.appendChild(Er),mr)return new Promise((vr,gr)=>{Er.addEventListener("load",vr),Er.addEventListener("error",()=>gr(new Error(`Unable to preload CSS for ${xr}`)))})}))}function dr(hr){const pr=new Event("vite:preloadError",{cancelable:!0});if(pr.payload=hr,window.dispatchEvent(pr),!pr.defaultPrevented)throw hr}return ur.then(hr=>{for(const pr of hr||[])pr.status==="rejected"&&dr(pr.reason);return or().catch(dr)})},useBillingStore=create()(persist((ar,or)=>({billingDetails:createEmptyBillingDetails(),isLoading:!1,isSaving:!1,lastError:null,setBillingDetails:lr=>{ar({billingDetails:{...lr,lastUpdated:new Date},lastError:null})},updatePersonalInfo:lr=>{ar(cr=>({billingDetails:{...cr.billingDetails,...lr,lastUpdated:new Date},lastError:null}))},updateBankDetails:lr=>{ar(cr=>({billingDetails:{...cr.billingDetails,bankDetails:{...cr.billingDetails.bankDetails,...lr},lastUpdated:new Date},lastError:null}))},updatePaymentTerms:lr=>{ar(cr=>({billingDetails:{...cr.billingDetails,paymentTerms:lr,lastUpdated:new Date},lastError:null}))},updateVATSettings:lr=>{ar(cr=>({billingDetails:{...cr.billingDetails,vatSettings:{...cr.billingDetails.vatSettings,...lr},lastUpdated:new Date},lastError:null}))},toggleVATRegistered:()=>{ar(lr=>({billingDetails:{...lr.billingDetails,vatSettings:{...lr.billingDetails.vatSettings,isVATRegistered:!lr.billingDetails.vatSettings.isVATRegistered},lastUpdated:new Date},lastError:null}))},resetBillingDetails:()=>{ar({billingDetails:createEmptyBillingDetails(),lastError:null})},isBillingComplete:()=>{const{billingDetails:lr}=or(),{bankDetails:cr,vatSettings:ur}=lr,dr=!!(lr.fullName&&lr.address&&lr.email),hr=!!(cr.accountName&&cr.sortCode&&cr.accountNumber),pr=!ur.isVATRegistered||!!ur.vatNumber;return dr&&hr&&pr},getValidationErrors:()=>{const{billingDetails:lr}=or(),{bankDetails:cr,vatSettings:ur}=lr,dr=[];return lr.fullName||dr.push("Full name is required"),lr.address||dr.push("Address is required"),lr.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(lr.email)||dr.push("Email format is invalid"):dr.push("Email is required"),cr.accountName||dr.push("Bank account name is required"),cr.sortCode?/^\d{2}-?\d{2}-?\d{2}$/.test(cr.sortCode.replace(/\s/g,""))||dr.push("Sort code should be 6 digits (e.g., 12-34-56)"):dr.push("Sort code is required"),cr.accountNumber?/^\d{8}$/.test(cr.accountNumber.replace(/\s/g,""))||dr.push("Account number should be 8 digits"):dr.push("Account number is required"),ur.isVATRegistered&&!ur.vatNumber&&dr.push("VAT number is required when VAT registered"),(ur.vatRate<0||ur.vatRate>100)&&dr.push("VAT rate must be between 0 and 100"),dr}}),{name:"checks-happy-billing",storage:createJSONStorage(()=>localStorage),partialize:ar=>({billingDetails:ar.billingDetails})})),formatSortCode=ar=>{const or=ar.replace(/\D/g,"");return or.length<=2?or:or.length<=4?`${or.slice(0,2)}-${or.slice(2)}`:`${or.slice(0,2)}-${or.slice(2,4)}-${or.slice(4,6)}`},formatAccountNumber=ar=>ar.replace(/\D/g,"").slice(0,8),INVOICE_TIERS=["supervisor","designer"];function ProjectExportScreen({onBack:ar,onExportComplete:or,onNavigateToBilling:lr}){var Ir,Br;const{currentProject:cr,lifecycle:ur,sceneCaptures:dr}=useProjectStore(),{isBillingComplete:hr}=useBillingStore(),{user:pr}=useAuthStore(),[xr,mr]=reactExports.useState(EXPORT_DOCUMENTS.map(Wr=>({...Wr}))),fr=pr&&INVOICE_TIERS.includes(pr.tier),Er=(Ir=xr.find(Wr=>Wr.id==="invoice_summary"))==null?void 0:Ir.selected,vr=hr(),[gr,yr]=reactExports.useState("download"),[jr,br]=reactExports.useState({status:"idle",progress:0}),_r=()=>{let Wr=0;return xr.filter(es=>es.selected).forEach(es=>{switch(es.id){case"continuity_bible":Wr+=2*1024*1024;break;case"scene_breakdown":Wr+=50*1024;break;case"character_lookbooks":Wr+=((cr==null?void 0:cr.characters.length)||0)*1024*1024;break;case"photo_archive":const ps=Object.values(dr).reduce((ts,Qr)=>{let Hr=0;return Qr.photos.front&&Hr++,Qr.photos.left&&Hr++,Qr.photos.right&&Hr++,Qr.photos.back&&Hr++,Hr+=Qr.additionalPhotos.length,ts+Hr},0);Wr+=ps*500*1024;break;case"timesheets":Wr+=200*1024;break;case"invoice_summary":Wr+=100*1024;break}}),Wr<1024*1024?`~${Math.round(Wr/1024)} KB`:`~${Math.round(Wr/(1024*1024))} MB`},wr=Wr=>{mr(Yr=>Yr.map(es=>es.id===Wr?{...es,selected:!es.selected}:es))},Rr=()=>{const Wr=xr.every(Yr=>Yr.selected);mr(Yr=>Yr.map(es=>({...es,selected:!Wr})))},Ar=Wr=>{switch(Wr){case"pdf":return"bg-red-100 text-red-700";case"csv":case"excel":return"bg-green-100 text-green-700";case"zip":case"pdf_zip":return"bg-blue-100 text-blue-700";default:return"bg-gray-100 text-gray-700"}},Sr=Wr=>{switch(Wr){case"pdf":return"PDF";case"csv":return"CSV";case"excel":return"Excel";case"zip":return"ZIP";case"pdf_zip":return"PDF (zip)";default:return Wr.toUpperCase()}},kr=async()=>{const Wr=xr.filter(Yr=>Yr.selected).map(Yr=>Yr.id);if(Wr.length!==0){br({status:"preparing",progress:0});try{for(let Yr=0;Yr<Wr.length;Yr++){const es=Wr[Yr];br({status:"generating",currentDocument:es,progress:Math.round(Yr/Wr.length*80)}),await new Promise(ps=>setTimeout(ps,500))}br({status:"packaging",progress:90}),await new Promise(Yr=>setTimeout(Yr,500)),await Nr(Wr),br({status:"complete",progress:100}),setTimeout(()=>{or==null||or()},1500)}catch(Yr){br({status:"error",progress:0,error:Yr instanceof Error?Yr.message:"Export failed"})}}},Nr=async Wr=>{const{generateContinuityBiblePDF:Yr}=await __vitePreload(async()=>{const{generateContinuityBiblePDF:ts}=await Promise.resolve().then(()=>exportUtils);return{generateContinuityBiblePDF:ts}},void 0),{generateSceneBreakdownCSV:es}=await __vitePreload(async()=>{const{generateSceneBreakdownCSV:ts}=await Promise.resolve().then(()=>exportUtils);return{generateSceneBreakdownCSV:ts}},void 0),ps=[];if(cr){for(const ts of Wr)switch(ts){case"continuity_bible":const Qr=Yr(cr,dr);ps.push({filename:`${cr.name}_Continuity_Bible.html`,content:Qr,mimeType:"text/html"});break;case"scene_breakdown":const Hr=es(cr,dr);ps.push({filename:`${cr.name}_Scene_Breakdown.csv`,content:Hr,mimeType:"text/csv"});break}for(const ts of ps){const Qr=new Blob([ts.content],{type:ts.mimeType==="text/html"?"text/html;charset=utf-8":ts.mimeType}),Hr=URL.createObjectURL(Qr);if(ts.mimeType==="text/html"){const Kr=window.open(Hr,"_blank");Kr&&Kr.addEventListener("load",()=>{setTimeout(()=>Kr.print(),500)})}else{const Kr=document.createElement("a");Kr.href=Hr,Kr.download=ts.filename,document.body.appendChild(Kr),Kr.click(),document.body.removeChild(Kr)}URL.revokeObjectURL(Hr)}}},Cr=xr.filter(Wr=>Wr.selected).length,Tr=xr.every(Wr=>Wr.selected),Pr=()=>ur.wrappedAt?new Date(ur.wrappedAt).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}):new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});return cr?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Export Project"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[cr.name,"  Wrapped ",Pr()]})]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"SELECT DOCUMENTS"}),jsxRuntimeExports.jsx("button",{onClick:Rr,className:"text-sm font-medium text-gold active:opacity-70 transition-opacity",children:Tr?"Deselect All":"Select All"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2 mb-6",children:xr.map(Wr=>jsxRuntimeExports.jsxs("button",{onClick:()=>wr(Wr.id),className:`w-full card flex items-start gap-3 text-left transition-all ${Wr.selected?"border-2 border-gold bg-gold/5":""}`,children:[jsxRuntimeExports.jsx("div",{className:`mt-0.5 w-5 h-5 rounded flex-shrink-0 flex items-center justify-center border-2 transition-colors ${Wr.selected?"bg-gold border-gold":"border-border"}`,children:Wr.selected&&jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Wr.name}),jsxRuntimeExports.jsx("span",{className:`px-2 py-0.5 text-[10px] font-medium rounded ${Ar(Wr.format)}`,children:Sr(Wr.format)})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:Wr.description})]})]},Wr.id))}),Er&&fr&&lr&&jsxRuntimeExports.jsx("div",{className:`mb-6 p-4 rounded-xl border ${vr?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${vr?"bg-green-100":"bg-amber-100"}`,children:vr?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:`text-sm font-medium ${vr?"text-green-700":"text-amber-700"}`,children:vr?"Billing details complete":"Billing details incomplete"}),jsxRuntimeExports.jsx("p",{className:`text-xs mt-0.5 ${vr?"text-green-600":"text-amber-600"}`,children:vr?"Your personal info, bank details, and VAT settings will appear on the invoice.":"Complete your billing details to generate professional invoices."}),jsxRuntimeExports.jsx("button",{onClick:lr,className:`mt-2 text-xs font-medium ${vr?"text-green-700":"text-amber-700"} underline`,children:vr?"Edit billing details":"Complete billing details"})]})]})}),Er&&!fr&&jsxRuntimeExports.jsx("div",{className:"mb-6 p-4 rounded-xl border bg-gray-50 border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 bg-gold/10",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Supervisor Feature"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"Upgrade to Supervisor or Designer to generate professional invoices with your billing details."})]})]})}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"DELIVERY METHOD"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"download",label:"Save to Device",icon:"download"},{id:"share",label:"Share",icon:"share"}].map(Wr=>jsxRuntimeExports.jsxs("button",{onClick:()=>yr(Wr.id),className:`p-3 rounded-xl border-2 text-center transition-all ${gr===Wr.id?"border-gold bg-gold/5":"border-border bg-card"}`,children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 mx-auto mb-2 rounded-lg flex items-center justify-center ${gr===Wr.id?"bg-gold text-white":"bg-gray-100 text-text-muted"}`,children:Wr.icon==="download"?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-text-primary",children:Wr.label})]},Wr.id))})]}),jr.status!=="idle"&&jsxRuntimeExports.jsx("div",{className:"mb-6 p-4 bg-card rounded-xl border border-border",children:jr.status==="error"?jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-red-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-error",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-error font-medium",children:jr.error})]}):jr.status==="complete"?jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-green-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary font-medium",children:"Export Complete!"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm text-text-primary font-medium",children:[jr.status==="preparing"&&"Preparing export...",jr.status==="generating"&&`Generating ${((Br=xr.find(Wr=>Wr.id===jr.currentDocument))==null?void 0:Br.name)||""}...`,jr.status==="packaging"&&"Packaging files..."]}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-text-muted",children:[jr.progress,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gold rounded-full transition-all duration-300",style:{width:`${jr.progress}%`}})})]})}),jsxRuntimeExports.jsx("button",{onClick:kr,disabled:Cr===0||["preparing","generating","packaging"].includes(jr.status),className:`w-full py-4 rounded-button font-semibold text-base shadow-lg transition-all ${Cr===0?"bg-gray-200 text-text-light cursor-not-allowed":["preparing","generating","packaging"].includes(jr.status)?"bg-gold/70 text-white cursor-wait":"gold-gradient text-white active:scale-[0.98]"}`,children:["preparing","generating","packaging"].includes(jr.status)?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Exporting..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Export ",Cr>0?`${Cr} Selected`:"Documents",Cr>0&&jsxRuntimeExports.jsxs("span",{className:"ml-2 opacity-80",children:["(",_r(),")"]})]})}),jsxRuntimeExports.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-xs font-semibold text-text-muted uppercase mb-3",children:"Project Summary"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold text-text-primary",children:cr.scenes.length}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Scenes"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold text-text-primary",children:cr.characters.length}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Characters"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold text-text-primary",children:cr.looks.length}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Looks"})]})]})]})]})]}):null}function BillingDetailsScreen({onBack:ar}){const{billingDetails:or,updatePersonalInfo:lr,updateBankDetails:cr,updatePaymentTerms:ur,updateVATSettings:dr,toggleVATRegistered:hr,isBillingComplete:pr,getValidationErrors:xr}=useBillingStore(),[mr,fr]=reactExports.useState(!1),[Er,vr]=reactExports.useState(null);reactExports.useEffect(()=>{if(Er){const br=setTimeout(()=>vr(null),2e3);return()=>clearTimeout(br)}},[Er]);const gr=()=>{fr(!0),xr().length===0&&vr("Details saved successfully")},yr=mr?xr():[],jr=pr();return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Billing Details"})]}),jr&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Complete"]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:[Er&&jsxRuntimeExports.jsx("div",{className:"mb-4 px-4 py-2 bg-green-50 border border-green-200 rounded-lg text-sm text-green-700",children:Er}),yr.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4 px-4 py-3 bg-red-50 border border-red-200 rounded-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-700 mb-2",children:"Please fix the following:"}),jsxRuntimeExports.jsx("ul",{className:"text-xs text-red-600 space-y-1",children:yr.map((br,_r)=>jsxRuntimeExports.jsxs("li",{children:[" ",br]},_r))})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PERSONAL / BUSINESS INFORMATION"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"FULL NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.fullName,onChange:br=>lr({fullName:br.target.value}),placeholder:"John Smith",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"BUSINESS NAME"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.businessName,onChange:br=>lr({businessName:br.target.value}),placeholder:"Optional - if trading under a business name",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"For freelancers trading under a company or trading name"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ADDRESS *"}),jsxRuntimeExports.jsx("textarea",{value:or.address,onChange:br=>lr({address:br.target.value}),placeholder:`123 High Street
London
SW1A 1AA`,rows:3,className:"input-field w-full resize-none"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"PHONE"}),jsxRuntimeExports.jsx("input",{type:"tel",value:or.phone,onChange:br=>lr({phone:br.target.value}),placeholder:"+44 7700 900000",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"EMAIL *"}),jsxRuntimeExports.jsx("input",{type:"email",value:or.email,onChange:br=>lr({email:br.target.value}),placeholder:"john@example.com",className:"input-field w-full"})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"BANK DETAILS FOR PAYMENT"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ACCOUNT NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.bankDetails.accountName,onChange:br=>cr({accountName:br.target.value}),placeholder:"John Smith",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Name as it appears on your bank account"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"SORT CODE *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.bankDetails.sortCode,onChange:br=>{const _r=formatSortCode(br.target.value);cr({sortCode:_r})},placeholder:"12-34-56",maxLength:8,className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ACCOUNT NUMBER *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.bankDetails.accountNumber,onChange:br=>{const _r=formatAccountNumber(br.target.value);cr({accountNumber:_r})},placeholder:"12345678",maxLength:8,className:"input-field w-full"})]})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PAYMENT TERMS"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"TERMS"}),jsxRuntimeExports.jsxs("select",{value:or.paymentTerms,onChange:br=>ur(br.target.value),className:"input-field w-full",children:[jsxRuntimeExports.jsx("option",{value:"Payment upon receipt",children:"Payment upon receipt"}),jsxRuntimeExports.jsx("option",{value:"Payment within 7 days",children:"Payment within 7 days"}),jsxRuntimeExports.jsx("option",{value:"Payment within 14 days",children:"Payment within 14 days"}),jsxRuntimeExports.jsx("option",{value:"Payment within 30 days",children:"Payment within 30 days"}),jsxRuntimeExports.jsx("option",{value:"Payment within 60 days",children:"Payment within 60 days"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-2",children:"This will appear on generated invoices"})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"VAT / TAX SETTINGS"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:"VAT Registered"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Are you registered for VAT?"})]}),jsxRuntimeExports.jsx("button",{onClick:hr,className:`relative w-12 h-7 rounded-full transition-colors ${or.vatSettings.isVATRegistered?"bg-gold":"bg-gray-200"}`,children:jsxRuntimeExports.jsx("span",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform ${or.vatSettings.isVATRegistered?"left-6":"left-1"}`})})]}),or.vatSettings.isVATRegistered&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"VAT NUMBER *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.vatSettings.vatNumber,onChange:br=>dr({vatNumber:br.target.value.toUpperCase()}),placeholder:"GB123456789",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"UK format: GB followed by 9 digits"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"VAT RATE (%)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{type:"number",value:or.vatSettings.vatRate,onChange:br=>dr({vatRate:parseFloat(br.target.value)||0}),min:"0",max:"100",step:"0.1",className:"input-field w-24"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"%"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Standard UK rate is 20%"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-border",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-muted mb-2",children:"INVOICE PREVIEW"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Subtotal (ex VAT)"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary",children:"1,000.00"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsxs("span",{className:"text-text-muted",children:["VAT (",or.vatSettings.vatRate,"%)"]}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary",children:["",(1e3*or.vatSettings.vatRate/100).toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-semibold pt-1 border-t border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-text-primary",children:"Total (inc VAT)"}),jsxRuntimeExports.jsxs("span",{className:"text-gold",children:["",(1e3*(1+or.vatSettings.vatRate/100)).toFixed(2)]})]})]})]})]}),!or.vatSettings.isVATRegistered&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"If you're not VAT registered, your invoices will not include VAT calculations. You can register for VAT at any time if your taxable turnover exceeds the threshold."})]})]}),jsxRuntimeExports.jsxs("div",{className:"sticky bottom-0 bg-background pt-4 pb-safe-bottom",children:[jsxRuntimeExports.jsx("button",{onClick:gr,className:"w-full py-3 rounded-button gold-gradient text-white font-medium active:scale-98 transition-transform",children:"Save Details"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center mt-2",children:"Details are saved automatically and will appear on your invoices"})]})]})]})}function ConfirmationModal({isOpen:ar,onClose:or,onConfirm:lr,title:cr,message:ur,confirmText:dr="Confirm",cancelText:hr="Cancel",variant:pr="default",requiresTextConfirmation:xr,isLoading:mr=!1}){const[fr,Er]=reactExports.useState(""),vr=xr!==void 0&&fr.toLowerCase()!==xr.toLowerCase(),gr=()=>{Er(""),or()},yr=()=>{!vr&&!mr&&(lr(),Er(""))};return jsxRuntimeExports.jsx(Modal,{isOpen:ar,onClose:gr,title:cr,children:jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-text-muted",children:ur}),xr&&jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:['Type "',jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:xr}),'" to confirm:']}),jsxRuntimeExports.jsx(Input,{type:"text",value:fr,onChange:jr=>Er(jr.target.value),placeholder:xr,autoComplete:"off"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:gr,fullWidth:!0,disabled:mr,children:hr}),jsxRuntimeExports.jsx(Button,{variant:pr==="danger"?"outline":"primary",onClick:yr,fullWidth:!0,disabled:vr||mr,className:pr==="danger"?"border-red-500 text-red-500 hover:bg-red-50":"",children:mr?"Loading...":dr})]})]})})}function TeamMemberCard({member:ar,canManage:or,onChangeRole:lr,onRemove:cr}){const[ur,dr]=reactExports.useState(!1),[hr,pr]=reactExports.useState(!1),xr=reactExports.useRef(null),mr=br=>new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(new Date(br)),fr=br=>br.split(" ").map(_r=>_r[0]).join("").toUpperCase().slice(0,2),Er=br=>{const _r=["bg-blue-500","bg-green-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500","bg-orange-500","bg-cyan-500"];let wr=0;for(let Rr=0;Rr<br.length;Rr++)wr=br.charCodeAt(Rr)+((wr<<5)-wr);return _r[Math.abs(wr)%_r.length]};reactExports.useEffect(()=>{const br=_r=>{xr.current&&!xr.current.contains(_r.target)&&(dr(!1),pr(!1))};if(ur)return document.addEventListener("mousedown",br),()=>document.removeEventListener("mousedown",br)},[ur]);const vr=()=>{or&&!ar.isOwner&&(dr(!0),"vibrate"in navigator&&navigator.vibrate(50))},gr=reactExports.useRef(null),yr=()=>{gr.current=setTimeout(vr,500)},jr=()=>{gr.current&&(clearTimeout(gr.current),gr.current=null)};return jsxRuntimeExports.jsxs("div",{className:"relative",ref:xr,children:[jsxRuntimeExports.jsxs("div",{className:"card flex items-center gap-3 mb-2",onTouchStart:yr,onTouchEnd:jr,onTouchCancel:jr,onContextMenu:br=>{or&&!ar.isOwner&&(br.preventDefault(),dr(!0))},children:[ar.avatarUrl?jsxRuntimeExports.jsx("img",{src:ar.avatarUrl,alt:ar.name,className:"w-12 h-12 rounded-full object-cover"}):jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold ${Er(ar.name)}`,children:fr(ar.name)}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary truncate",children:ar.name}),ar.isOwner&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium bg-gold-100 text-gold rounded-full",children:"Owner"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:getTeamMemberRoleLabel(ar.role)}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-light",children:["Joined ",mr(ar.joinedAt)]})]}),or&&!ar.isOwner&&jsxRuntimeExports.jsx("button",{onClick:()=>dr(!ur),className:"p-2 -m-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]}),ur&&jsxRuntimeExports.jsxs("div",{className:"absolute right-4 top-full mt-1 z-10 bg-card rounded-xl shadow-lg border border-border overflow-hidden min-w-[160px]",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{dr(!1),pr(!0)},className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Change Role"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{dr(!1),cr==null||cr(ar.userId)},className:"w-full px-4 py-3 text-left text-sm text-red-500 hover:bg-red-50 flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remove from Project"]})]}),hr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Change Role"}),jsxRuntimeExports.jsx("button",{onClick:()=>pr(!1),className:"p-2 -m-2 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted mt-1",children:["Select a new role for ",ar.name]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:TEAM_MEMBER_ROLES.map(br=>jsxRuntimeExports.jsxs("button",{onClick:()=>{lr==null||lr(ar.userId,br.value),pr(!1)},className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${ar.role===br.value?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${ar.role===br.value?"text-gold":"text-text-primary"}`,children:br.label}),ar.role===br.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},br.value))})})]})})]})}function TeamMemberList({members:ar,canManage:or,onChangeRole:lr,onRemoveMember:cr}){const[ur,dr]=reactExports.useState(null),hr=groupTeamMembersByRole(ar),pr=fr=>{const Er=ar.find(vr=>vr.userId===fr);Er&&dr(Er)},xr=()=>{ur&&(cr==null||cr(ur.userId),dr(null))},mr=fr=>{const Er=fr.members.length;switch(fr.role){case"designer":return`DESIGNERS (HOD) (${Er})`;case"supervisor":return`SUPERVISORS (${Er})`;case"key":return`KEY ARTISTS (${Er})`;case"hair":return`HAIR ARTISTS (${Er})`;case"makeup":return`MAKEUP ARTISTS (${Er})`;case"sfx":return`SPECIAL EFFECTS ARTISTS (${Er})`;case"daily":return`DAILIES (${Er})`;case"trainee":return`TRAINEES (${Er})`;default:return`${fr.label.toUpperCase()} (${Er})`}};return ar.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No team members yet"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-1",children:"Share the invite code to add team members"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"space-y-6",children:hr.map(fr=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3 px-1",children:mr(fr)}),jsxRuntimeExports.jsx("div",{children:fr.members.map(Er=>jsxRuntimeExports.jsx(TeamMemberCard,{member:Er,canManage:or,onChangeRole:lr,onRemove:pr},Er.userId))})]},fr.role))}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:!!ur,onClose:()=>dr(null),onConfirm:xr,title:`Remove ${ur==null?void 0:ur.name}?`,message:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("p",{children:"They will lose access to this project immediately."}),jsxRuntimeExports.jsx("p",{children:"Their contributions will remain."})]}),confirmText:"Remove",variant:"danger"})]})}function InviteCodeShare({inviteCode:ar,isOwner:or,onRegenerateCode:lr}){const[cr,ur]=reactExports.useState(null),[dr,hr]=reactExports.useState(!1),[pr,xr]=reactExports.useState(!1),[mr,fr]=reactExports.useState(ar),Er=`checkshappy.app/join/${mr}`,vr=async(jr,br)=>{try{await navigator.clipboard.writeText(jr),ur(br),setTimeout(()=>ur(null),2e3)}catch{const _r=document.createElement("textarea");_r.value=jr,document.body.appendChild(_r),_r.select(),document.execCommand("copy"),document.body.removeChild(_r),ur(br),setTimeout(()=>ur(null),2e3)}},gr=async()=>{if(navigator.share)try{await navigator.share({title:"Join my project on Checks Happy",text:`Use code ${mr} to join my production on Checks Happy!`,url:`https://${Er}`})}catch{}else vr(`https://${Er}`,"link")},yr=async()=>{if(lr){xr(!0);try{const jr=await lr();fr(jr),hr(!1)}finally{xr(!1)}}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Share this code with your team:"}),jsxRuntimeExports.jsx("div",{className:"bg-gray-50 rounded-2xl p-6 mb-4",children:jsxRuntimeExports.jsx("span",{className:"text-3xl font-bold tracking-widest text-text-primary",children:mr})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>vr(mr,"code"),fullWidth:!0,children:cr==="code"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy"]})}),jsxRuntimeExports.jsxs(Button,{variant:"primary",onClick:gr,fullWidth:!0,children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]})]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-3",children:"Or share this link:"}),jsxRuntimeExports.jsx("div",{className:"bg-gray-50 rounded-xl p-3 mb-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary font-mono break-all",children:Er})}),jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:()=>vr(`https://${Er}`,"link"),fullWidth:!0,children:cr==="link"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Link Copied!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Copy Link"]})})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 p-4 bg-gold-50/50 rounded-xl",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:"Tip:"})," Add the code to your call sheet so the whole team can join easily."]})]}),or&&lr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-border"}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-amber-50 rounded-xl",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-medium text-amber-800 mb-1",children:"Regenerate Code"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-700 mb-3",children:"Create a new code if the current one has been shared too widely. Existing team members won't be affected."}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>hr(!0),className:"border-amber-600 text-amber-700 hover:bg-amber-100",children:"Regenerate Code"})]})]})})]})]}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:dr,onClose:()=>hr(!1),onConfirm:yr,title:"Regenerate invite code?",message:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("p",{children:["The current code (",jsxRuntimeExports.jsx("span",{className:"font-mono font-medium",children:mr}),") will stop working immediately."]}),jsxRuntimeExports.jsx("p",{children:"Team members already joined won't be affected."})]}),confirmText:"Regenerate",isLoading:pr})]})}function ProjectStatsCard({stats:ar}){const or=lr=>{if(!lr)return"No activity";const ur=new Date().getTime()-new Date(lr).getTime(),dr=Math.floor(ur/(1e3*60)),hr=Math.floor(ur/(1e3*60*60)),pr=Math.floor(ur/(1e3*60*60*24));return dr<1?"Just now":dr<60?`${dr} minutes ago`:hr<24?`${hr} hours ago`:pr===1?"Yesterday":pr<7?`${pr} days ago`:new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short"}).format(new Date(lr))};return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"SCRIPT"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Scenes"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.sceneCount})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Story Days"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.storyDays})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Characters"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.characterCount})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"CONTINUITY"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Progress"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:[ar.completionPercentage,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"w-full h-3 bg-gray-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full gold-gradient rounded-full transition-all duration-500",style:{width:`${ar.completionPercentage}%`}})}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-2",children:[ar.completedScenes," of ",ar.sceneCount," scenes checked"]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PHOTOS"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Photos Uploaded"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.photoCount.toLocaleString()})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Storage Used"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:formatStorageSize(ar.storageUsed)})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"TEAM ACTIVITY"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Team Members"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.teamMemberCount})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Last Activity"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:or(ar.lastActivity)})]}),ar.mostActiveUser&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Most Active"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:[ar.mostActiveUser.name," (",ar.mostActiveUser.editCount.toLocaleString()," edits)"]})]})]})]})]})}function PermissionPicker({label:ar,value:or,onChange:lr,disabled:cr=!1}){var pr;const[ur,dr]=reactExports.useState(!1),hr=((pr=PERMISSION_LEVELS.find(xr=>xr.value===or))==null?void 0:pr.label)||or;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>!cr&&dr(!0),disabled:cr,className:`w-full card flex items-center justify-between ${cr?"opacity-50 cursor-not-allowed":"active:scale-[0.98] transition-transform"}`,children:[jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:ar}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:hr})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsx(BottomSheet,{isOpen:ur,onClose:()=>dr(!1),title:ar,children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:PERMISSION_LEVELS.map(xr=>jsxRuntimeExports.jsxs("button",{onClick:()=>{lr(xr.value),dr(!1)},className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${or===xr.value?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${or===xr.value?"text-gold":"text-text-primary"}`,children:xr.label}),or===xr.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},xr.value))})})]})}const PRODUCTION_TYPE_OPTIONS=[{value:"film",label:"Feature Film"},{value:"tv_series",label:"TV Series"},{value:"short_film",label:"Short Film"},{value:"commercial",label:"Commercial"},{value:"music_video",label:"Music Video"},{value:"theatre",label:"Theatre"},{value:"other",label:"Other"}];function ProductionTypeSelector({value:ar,onChange:or,disabled:lr=!1}){var hr;const[cr,ur]=reactExports.useState(!1),dr=((hr=PRODUCTION_TYPE_OPTIONS.find(pr=>pr.value===ar))==null?void 0:hr.label)||ar;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>!lr&&ur(!0),disabled:lr,className:`w-full card flex items-center justify-between ${lr?"opacity-50 cursor-not-allowed":"active:scale-[0.98] transition-transform"}`,children:[jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Production Type"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:dr})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsx(BottomSheet,{isOpen:cr,onClose:()=>ur(!1),title:"Production Type",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:PRODUCTION_TYPE_OPTIONS.map(pr=>jsxRuntimeExports.jsxs("button",{onClick:()=>{or(pr.value),ur(!1)},className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${ar===pr.value?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${ar===pr.value?"text-gold":"text-text-primary"}`,children:pr.label}),ar===pr.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},pr.value))})})]})}function ScheduleEditor({scenes:ar,onSave:or,initialDayNumber:lr=1,initialDate:cr=new Date,initialSceneIds:ur=[]}){const[dr,hr]=reactExports.useState(lr),[pr,xr]=reactExports.useState(jr(cr)),[mr,fr]=reactExports.useState(new Set(ur)),[Er,vr]=reactExports.useState(""),[gr,yr]=reactExports.useState(!1);function jr(Sr){return Sr.toISOString().split("T")[0]}function br(Sr){const kr=new Date(Sr);return new Intl.DateTimeFormat("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}).format(kr)}const _r=reactExports.useMemo(()=>{if(!Er.trim())return ar;const Sr=Er.toLowerCase();return ar.filter(kr=>kr.sceneNumber.toLowerCase().includes(Sr)||kr.slugline.toLowerCase().includes(Sr))},[ar,Er]),wr=Sr=>{const kr=new Set(mr);kr.has(Sr)?kr.delete(Sr):kr.add(Sr),fr(kr)},Rr=async()=>{yr(!0);try{const Sr=new Date(pr);or(dr,Sr,Array.from(mr))}finally{yr(!1)}},Ar=reactExports.useMemo(()=>ar.filter(Sr=>mr.has(Sr.id)),[ar,mr]);return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"Shooting Day"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("select",{value:dr,onChange:Sr=>hr(Number(Sr.target.value)),className:"input-field w-full appearance-none pr-10",children:Array.from({length:100},(Sr,kr)=>kr+1).map(Sr=>jsxRuntimeExports.jsxs("option",{value:Sr,children:["Day ",Sr]},Sr))}),jsxRuntimeExports.jsx("svg",{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"Date"}),jsxRuntimeExports.jsx("input",{type:"date",value:pr,onChange:Sr=>xr(Sr.target.value),className:"input-field w-full"})]})]}),jsxRuntimeExports.jsx("div",{className:"text-center py-2 px-4 bg-gold-50 rounded-xl",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gold",children:br(pr)})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"SELECT SCENES FOR TODAY:"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),jsxRuntimeExports.jsx(Input,{type:"text",value:Er,onChange:Sr=>vr(Sr.target.value),placeholder:"Search scenes...",className:"pl-10"})]})]}),jsxRuntimeExports.jsxs("div",{className:"max-h-[40vh] overflow-y-auto -mx-4 px-4",children:[jsxRuntimeExports.jsx("div",{className:"space-y-2",children:_r.map(Sr=>{const kr=mr.has(Sr.id);return jsxRuntimeExports.jsxs("button",{onClick:()=>wr(Sr.id),className:`w-full px-4 py-3 rounded-xl text-left flex items-center gap-3 transition-colors ${kr?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-md border-2 flex items-center justify-center transition-colors ${kr?"bg-gold border-gold text-white":"border-gray-300"}`,children:kr&&jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:["Scene ",Sr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:Sr.intExt})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted truncate",children:Sr.slugline})]}),Sr.isComplete&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium bg-green-100 text-green-600 rounded-full",children:"Complete"})]},Sr.id)})}),_r.length===0&&jsxRuntimeExports.jsx("div",{className:"text-center py-8",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No scenes found"})})]}),jsxRuntimeExports.jsx("div",{className:"py-2 border-t border-border",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted text-center",children:[mr.size," scene",mr.size!==1?"s":""," selected"]})}),Ar.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-muted mb-2",children:"Shot Order:"}),jsxRuntimeExports.jsx("div",{className:"space-y-1",children:Ar.map((Sr,kr)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-bold text-text-muted w-5",children:[kr+1,"."]}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-primary",children:["Scene ",Sr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate flex-1",children:Sr.slugline})]},Sr.id))}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-2 text-center",children:"Tip: Drag to reorder scenes for shot order"})]}),jsxRuntimeExports.jsx(Button,{variant:"primary",onClick:Rr,fullWidth:!0,disabled:mr.size===0||gr,children:gr?"Saving...":"Save Today's Schedule"})]})}function DangerZone({projectName:ar,photoCount:or,onArchive:lr,onDelete:cr}){const[ur,dr]=reactExports.useState(!1),[hr,pr]=reactExports.useState(!1),[xr,mr]=reactExports.useState(!1),[fr,Er]=reactExports.useState(!1),vr=async()=>{mr(!0);try{await lr(),dr(!1)}finally{mr(!1)}},gr=async()=>{Er(!0);try{await cr(),pr(!1)}finally{Er(!1)}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-red-500 mb-3",children:"DANGER ZONE"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>dr(!0),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-50 flex items-center justify-center text-amber-600",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Archive Project"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Mark as wrapped, make read-only"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>pr(!0),className:"w-full card flex items-center gap-4 border-red-200 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-50 flex items-center justify-center text-red-500",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-500",children:"Delete Project"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Permanently delete all data"})]}),jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})]})]})]}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:ur,onClose:()=>dr(!1),onConfirm:vr,title:`Archive "${ar}"?`,message:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("p",{children:"The project will become read-only."}),jsxRuntimeExports.jsx("p",{children:"Team members can still view continuity data and photos, but can't make changes."}),jsxRuntimeExports.jsx("p",{className:"font-medium",children:"You can restore it later from your Dashboard."})]}),confirmText:"Archive Project",isLoading:xr}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:hr,onClose:()=>pr(!1),onConfirm:gr,title:`Delete "${ar}"?`,message:jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:"This cannot be undone."})]}),jsxRuntimeExports.jsx("p",{children:"This will permanently delete:"}),jsxRuntimeExports.jsxs("ul",{className:"list-disc list-inside space-y-1 text-text-muted",children:[jsxRuntimeExports.jsx("li",{children:"All scenes and breakdowns"}),jsxRuntimeExports.jsx("li",{children:"All continuity notes"}),jsxRuntimeExports.jsxs("li",{children:["All ",or.toLocaleString()," photos"]}),jsxRuntimeExports.jsx("li",{children:"Team member access"})]})]}),confirmText:"Delete Forever",variant:"danger",requiresTextConfirmation:ar,isLoading:fr})]})}const mockDelay=ar=>new Promise(or=>setTimeout(or,ar)),generateMockTeamMembers=ar=>[{name:"Sarah Chen",role:"designer",isOwner:!0},{name:"Mike Torres",role:"supervisor",isOwner:!1},{name:"Emma Wright",role:"key",isOwner:!1},{name:"David Park",role:"key",isOwner:!1},{name:"Lucy Hammond",role:"hair",isOwner:!1},{name:"Alex Rivera",role:"makeup",isOwner:!1},{name:"Jordan Lee",role:"sfx",isOwner:!1},{name:"James Cole",role:"daily",isOwner:!1}].map((lr,cr)=>({userId:`user-${cr+1}`,projectId:ar,name:lr.name,email:`${lr.name.toLowerCase().replace(" ",".")}@example.com`,role:lr.role,isOwner:lr.isOwner,joinedAt:new Date(Date.now()-(30-cr)*24*60*60*1e3),lastActiveAt:new Date(Date.now()-cr*60*60*1e3),editCount:Math.floor(Math.random()*500)+50})),generateMockStats=()=>({sceneCount:142,storyDays:23,characterCount:14,completedScenes:94,completionPercentage:67,photoCount:1247,storageUsed:2.3*1024*1024*1024,teamMemberCount:8,lastActivity:new Date(Date.now()-2*60*60*1e3),mostActiveUser:{name:"Sarah Chen",editCount:342}}),useProjectSettingsStore=create((ar,or)=>({projectSettings:null,teamMembers:[],projectStats:null,shootingDays:[],isLoading:!1,error:null,loadProjectSettings:async lr=>{ar({isLoading:!0,error:null});try{await mockDelay(400);const cr={id:lr,name:"The Punishing",type:"film",status:"shooting",inviteCode:"TMK-4827",ownerId:"user-1",permissions:createDefaultProjectPermissions(),createdAt:new Date(Date.now()-30*24*60*60*1e3),archivedAt:null},ur=generateMockStats();ar({projectSettings:cr,projectStats:ur,isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to load project settings"})}},updateProjectName:async lr=>{const{projectSettings:cr}=or();if(cr){ar({isLoading:!0});try{await mockDelay(300),ar({projectSettings:{...cr,name:lr},isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to update project name"})}}},updateProjectType:async lr=>{const{projectSettings:cr}=or();if(cr){ar({isLoading:!0});try{await mockDelay(300),ar({projectSettings:{...cr,type:lr},isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to update project type"})}}},updateProjectStatus:async lr=>{const{projectSettings:cr}=or();if(cr){ar({isLoading:!0});try{await mockDelay(300),ar({projectSettings:{...cr,status:lr},isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to update project status"})}}},updatePermission:async(lr,cr)=>{const{projectSettings:ur}=or();if(ur){ar({isLoading:!0});try{await mockDelay(300),ar({projectSettings:{...ur,permissions:{...ur.permissions,[lr]:cr}},isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to update permission"})}}},regenerateInviteCode:async()=>{const{projectSettings:lr}=or();if(!lr)throw new Error("No project loaded");ar({isLoading:!0});try{await mockDelay(500);const cr=generateProjectCode();return ar({projectSettings:{...lr,inviteCode:cr},isLoading:!1}),cr}catch{throw ar({isLoading:!1,error:"Failed to regenerate invite code"}),new Error("Failed to regenerate invite code")}},archiveProject:async()=>{const{projectSettings:lr}=or();if(lr){ar({isLoading:!0});try{await mockDelay(500),ar({projectSettings:{...lr,status:"archived",archivedAt:new Date},isLoading:!1})}catch{throw ar({isLoading:!1,error:"Failed to archive project"}),new Error("Failed to archive project")}}},deleteProject:async()=>{ar({isLoading:!0});try{await mockDelay(800),ar({projectSettings:null,teamMembers:[],projectStats:null,shootingDays:[],isLoading:!1})}catch{throw ar({isLoading:!1,error:"Failed to delete project"}),new Error("Failed to delete project")}},loadTeamMembers:async lr=>{ar({isLoading:!0,error:null});try{await mockDelay(400);const cr=generateMockTeamMembers(lr);ar({teamMembers:cr,isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to load team members"})}},changeTeamMemberRole:async(lr,cr)=>{const{teamMembers:ur}=or();ar({isLoading:!0});try{await mockDelay(300);const dr=ur.map(hr=>hr.userId===lr?{...hr,role:cr}:hr);ar({teamMembers:dr,isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to change role"})}},removeTeamMember:async lr=>{const{teamMembers:cr,projectStats:ur}=or();ar({isLoading:!0});try{await mockDelay(400);const dr=cr.filter(hr=>hr.userId!==lr);ar({teamMembers:dr,projectStats:ur?{...ur,teamMemberCount:dr.length}:null,isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to remove team member"})}},saveShootingDay:async(lr,cr,ur)=>{const{shootingDays:dr,projectSettings:hr}=or();if(hr){ar({isLoading:!0});try{await mockDelay(400);const pr={id:`day-${lr}`,projectId:hr.id,dayNumber:lr,date:cr,sceneIds:ur,createdBy:"current-user",createdAt:new Date},xr=dr.findIndex(fr=>fr.dayNumber===lr),mr=xr>=0?dr.map((fr,Er)=>Er===xr?pr:fr):[...dr,pr];ar({shootingDays:mr,isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to save shooting day"})}}},clearState:()=>{ar({projectSettings:null,teamMembers:[],projectStats:null,shootingDays:[],isLoading:!1,error:null})}}));function TeamScreen({projectId:ar,canManage:or,isOwner:lr,onBack:cr,onInvite:ur}){const{teamMembers:dr,isLoading:hr,loadTeamMembers:pr,changeTeamMemberRole:xr,removeTeamMember:mr}=useProjectSettingsStore();reactExports.useEffect(()=>{pr(ar)},[ar,pr]);const fr=(vr,gr)=>{xr(vr,gr)},Er=vr=>{mr(vr)};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:cr,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Team"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[dr.length," members"]})]})]}),lr&&jsxRuntimeExports.jsxs(Button,{variant:"primary",size:"sm",onClick:ur,children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Invite"]})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:hr&&dr.length===0?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"})}):jsxRuntimeExports.jsx(TeamMemberList,{members:dr,canManage:or,onChangeRole:fr,onRemoveMember:Er})})]})}function InviteScreen({inviteCode:ar,isOwner:or,onBack:lr}){const{regenerateInviteCode:cr}=useProjectSettingsStore();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:lr,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Invite Team"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-6",children:jsxRuntimeExports.jsx(InviteCodeShare,{inviteCode:ar,isOwner:or,onRegenerateCode:or?cr:void 0})})]})}function ProjectStatsScreen({projectId:ar,onBack:or}){const{projectStats:lr,isLoading:cr,loadProjectSettings:ur}=useProjectSettingsStore();return reactExports.useEffect(()=>{lr||ur(ar)},[ar,lr,ur]),jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Stats"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:cr&&!lr?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"})}):lr?jsxRuntimeExports.jsx(ProjectStatsCard,{stats:lr}):jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No stats available"})})})]})}function ScheduleScreen({onBack:ar,onSaved:or}){const{currentProject:lr}=useProjectStore(),{saveShootingDay:cr}=useProjectSettingsStore(),ur=(lr==null?void 0:lr.scenes)||[],dr=async(hr,pr,xr)=>{await cr(hr,pr,xr),or==null||or()};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Today's Scenes"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:ur.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No scenes available"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-1",children:"Import a script to add scenes"})]}):jsxRuntimeExports.jsx(ScheduleEditor,{scenes:ur,onSave:dr})})]})}const REQUIRED_FIELDS=["productionCompany","productionAddress","productionEmail","accountsPayableContact","accountsPayableEmail"],useProductionDetailsStore=create()(persist((ar,or)=>({projectDetails:{},getDetails:lr=>or().projectDetails[lr]||createEmptyProductionInvoicingDetails(),updateDetails:(lr,cr)=>{const ur=or().projectDetails[lr]||createEmptyProductionInvoicingDetails();ar({projectDetails:{...or().projectDetails,[lr]:{...ur,...cr}}})},isComplete:lr=>{const cr=or().projectDetails[lr];return cr?REQUIRED_FIELDS.every(ur=>{const dr=cr[ur];return typeof dr=="string"?dr.trim().length>0:!!dr}):!1},getCompletionCount:lr=>{const cr=or().projectDetails[lr]||createEmptyProductionInvoicingDetails(),ur=REQUIRED_FIELDS.length;return{filled:REQUIRED_FIELDS.filter(hr=>{const pr=cr[hr];return typeof pr=="string"?pr.trim().length>0:!!pr}).length,total:ur}}}),{name:"hmk-production-details"}));function ProjectSettingsScreen({projectId:ar,onBack:or,onNavigateToTeam:lr,onNavigateToStats:cr,onNavigateToExport:ur,onNavigateToProductionDetails:dr,onProjectArchived:hr,onProjectDeleted:pr}){const{projectSettings:xr,projectStats:mr,isLoading:fr,loadProjectSettings:Er,updateProjectName:vr,updateProjectType:gr,updatePermission:yr,archiveProject:jr,deleteProject:br}=useProjectSettingsStore(),{currentProject:_r,lifecycle:wr,wrapProject:Rr,restoreProject:Ar,getDaysUntilDeletion:Sr}=useProjectStore(),{user:kr}=useAuthStore(),{isComplete:Nr,getCompletionCount:Cr}=useProductionDetailsStore(),Tr=Nr(ar),Pr=Cr(ar),Ir=kr&&xr?kr.id===xr.ownerId:!1,[Br,Wr]=reactExports.useState(!1),[Yr,es]=reactExports.useState(""),[ps,ts]=reactExports.useState(!1),[Qr,Hr]=reactExports.useState(!1),Kr=Sr();reactExports.useEffect(()=>{Er(ar)},[ar,Er]),reactExports.useEffect(()=>{xr&&es(xr.name)},[xr]);const rs=async()=>{Yr.trim()&&Yr!==(xr==null?void 0:xr.name)&&await vr(Yr.trim()),Wr(!1)},Mr=async()=>{await jr(),hr==null||hr()},Dr=async()=>{await br(),pr==null||pr()},Lr=()=>{Rr("manual"),ts(!1)};return fr&&!xr?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Settings"})]})})}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"})})]}):xr?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Settings"})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 space-y-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PROJECT DETAILS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[Br?jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"Production Name"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Input,{value:Yr,onChange:Fr=>es(Fr.target.value),autoFocus:!0,className:"flex-1"}),jsxRuntimeExports.jsx("button",{onClick:rs,className:"px-3 py-2 text-sm font-medium text-gold hover:bg-gold-50 rounded-lg transition-colors",children:"Save"}),jsxRuntimeExports.jsx("button",{onClick:()=>{es(xr.name),Wr(!1)},className:"px-3 py-2 text-sm text-text-muted hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"})]})]}):jsxRuntimeExports.jsxs("button",{onClick:()=>Wr(!0),className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Production Name"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:xr.name})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsx(ProductionTypeSelector,{value:xr.type,onChange:gr}),jsxRuntimeExports.jsxs("button",{onClick:dr,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-emerald-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Production & Invoicing"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:Tr?"Production details complete":`${Pr.filled}/${Pr.total} required fields filled`})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[Tr&&jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4"})}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"TEAM"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:lr,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Team Members"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"View and manage team"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>Hr(!Qr),className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Share Invite Code"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Invite team members to join"})]})]}),jsxRuntimeExports.jsx("svg",{className:`w-5 h-5 text-text-light transition-transform ${Qr?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),Qr&&jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx(InviteCodeShare,{inviteCode:xr.inviteCode,isOwner:Ir})}),jsxRuntimeExports.jsxs("button",{onClick:cr,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Project Stats"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"View project statistics"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"TEAM PERMISSIONS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(PermissionPicker,{label:"Who can add photos",value:xr.permissions.addPhotos,onChange:Fr=>yr("addPhotos",Fr)}),jsxRuntimeExports.jsx(PermissionPicker,{label:"Who can edit continuity notes",value:xr.permissions.editNotes,onChange:Fr=>yr("editNotes",Fr)}),jsxRuntimeExports.jsx(PermissionPicker,{label:"Who can mark scenes complete",value:xr.permissions.markComplete,onChange:Fr=>yr("markComplete",Fr)})]})]}),_r&&jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"EXPORT & WRAP"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:ur,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Export Project"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Download continuity documents"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),wr.state==="active"&&jsxRuntimeExports.jsxs("button",{onClick:()=>ts(!0),className:"w-full card flex items-center justify-between hover:bg-amber-50 active:scale-[0.98] transition-all",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.875 1.875 0 0118 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-amber-700",children:"Mark as Wrapped"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Production complete"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),wr.state==="wrapped"&&jsxRuntimeExports.jsx("div",{className:"card bg-amber-50 border border-amber-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Project Wrapped"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-amber-600",children:[Kr," days until archive"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>Ar(),className:"px-3 py-1.5 text-xs font-medium text-gold bg-white rounded-lg border border-gold",children:"Restore"})]})}),wr.state==="archived"&&jsxRuntimeExports.jsx("div",{className:"card bg-red-50 border border-red-200",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-800",children:"Project Archived - Read Only"})})]})]}),jsxRuntimeExports.jsx(DangerZone,{projectName:xr.name,photoCount:(mr==null?void 0:mr.photoCount)||0,onArchive:Mr,onDelete:Dr})]}),ps&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>ts(!1)}),jsxRuntimeExports.jsxs("div",{className:"relative bg-card rounded-2xl p-6 max-w-sm w-full shadow-xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-text-primary mb-2",children:"Mark Project as Wrapped?"}),jsxRuntimeExports.jsxs("p",{className:"text-text-secondary text-sm mb-4",children:['This will mark "',xr.name,'" as wrapped. The project will be archived after ',PROJECT_RETENTION_DAYS," days."]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mb-6",children:"You can restore the project at any time before it's archived."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ts(!1),className:"flex-1 py-2.5 px-4 rounded-button border border-border text-text-muted text-sm font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Lr,className:"flex-1 py-2.5 px-4 rounded-button bg-amber-500 text-white text-sm font-medium",children:"Wrap Project"})]})]})]})]}):null}function ProductionDetailsScreen({projectId:ar,onBack:or}){const{getDetails:lr,updateDetails:cr,isComplete:ur,getCompletionCount:dr}=useProductionDetailsStore(),hr=lr(ar),pr=ur(ar),{filled:xr,total:mr}=dr(ar),[fr,Er]=reactExports.useState(null);reactExports.useEffect(()=>{if(fr){const gr=setTimeout(()=>Er(null),2e3);return()=>clearTimeout(gr)}},[fr]);const vr=gr=>{cr(ar,gr)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Production Details"})]}),pr?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Complete"]}):jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[xr,"/",mr," required"]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:[fr&&jsxRuntimeExports.jsx("div",{className:"mb-4 px-4 py-2 bg-green-50 border border-green-200 rounded-lg text-sm text-green-700",children:fr}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mb-4",children:"Enter the production company details and invoicing information for this project. These details are specific to this job."}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PRODUCTION COMPANY"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"COMPANY NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.productionCompany,onChange:gr=>vr({productionCompany:gr.target.value}),placeholder:"e.g. NBC Universal, BBC Studios",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ADDRESS *"}),jsxRuntimeExports.jsx("textarea",{value:hr.productionAddress,onChange:gr=>vr({productionAddress:gr.target.value}),placeholder:"Production office address",rows:3,className:"input-field w-full resize-none"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"PHONE"}),jsxRuntimeExports.jsx("input",{type:"tel",value:hr.productionPhone,onChange:gr=>vr({productionPhone:gr.target.value}),placeholder:"Production office number",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"EMAIL *"}),jsxRuntimeExports.jsx("input",{type:"email",value:hr.productionEmail,onChange:gr=>vr({productionEmail:gr.target.value}),placeholder:"production@example.com",className:"input-field w-full"})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"ACCOUNTS PAYABLE"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"CONTACT NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.accountsPayableContact,onChange:gr=>vr({accountsPayableContact:gr.target.value}),placeholder:"Accounts payable contact",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"EMAIL *"}),jsxRuntimeExports.jsx("input",{type:"email",value:hr.accountsPayableEmail,onChange:gr=>vr({accountsPayableEmail:gr.target.value}),placeholder:"accounts@production.com",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Where invoices should be sent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"PHONE"}),jsxRuntimeExports.jsx("input",{type:"tel",value:hr.accountsPayablePhone,onChange:gr=>vr({accountsPayablePhone:gr.target.value}),placeholder:"Accounts department number",className:"input-field w-full"})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"JOB & CONTRACT REFERENCES"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"PO NUMBER"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.poNumber,onChange:gr=>vr({poNumber:gr.target.value}),placeholder:"Purchase order number",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Required on most invoices  check your deal memo"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"COST CODE"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.costCode,onChange:gr=>vr({costCode:gr.target.value}),placeholder:"Department or cost code",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Production cost code for your department (e.g. 4001, HMU-01)"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"JOB REFERENCE"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.jobReference,onChange:gr=>vr({jobReference:gr.target.value}),placeholder:"Contract or job reference number",className:"input-field w-full"})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"INVOICE ADDRESS"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:"Different invoice address"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Send invoices to a different address"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>vr({invoiceAddressDifferent:!hr.invoiceAddressDifferent}),className:`relative w-12 h-7 rounded-full transition-colors ${hr.invoiceAddressDifferent?"bg-gold":"bg-gray-200"}`,children:jsxRuntimeExports.jsx("span",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform ${hr.invoiceAddressDifferent?"left-6":"left-1"}`})})]}),hr.invoiceAddressDifferent&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ADDRESS"}),jsxRuntimeExports.jsx("textarea",{value:hr.invoiceAddress,onChange:gr=>vr({invoiceAddress:gr.target.value}),placeholder:"Invoice delivery address",rows:3,className:"input-field w-full resize-none"})]}),!hr.invoiceAddressDifferent&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Invoices will use the production company address above."})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"SPECIAL INSTRUCTIONS"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"INVOICE NOTES"}),jsxRuntimeExports.jsx("textarea",{value:hr.invoiceNotes,onChange:gr=>vr({invoiceNotes:gr.target.value}),placeholder:"Any special requirements for invoicing this production (e.g. 'Reference PO number on all invoices', 'Submit via portal', etc.)",rows:3,className:"input-field w-full resize-none"})]})]}),jsxRuntimeExports.jsx("div",{className:"pb-4",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center",children:"Details are saved automatically for this project"})})]})]})}pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;async function extractTextFromPDF(ar){const or=await ar.arrayBuffer(),lr=await pdfExports.getDocument({data:or}).promise;let cr="";for(let ur=1;ur<=lr.numPages;ur++){const hr=await(await lr.getPage(ur)).getTextContent(),pr=new Map;for(const mr of hr.items){if(!mr.str||mr.str.trim()==="")continue;const fr=Math.round(mr.transform[5]/2)*2,Er=mr.transform[4];pr.has(fr)||pr.set(fr,[]),pr.get(fr).push({x:Er,text:mr.str,width:mr.width||0})}const xr=Array.from(pr.keys()).sort((mr,fr)=>fr-mr);for(const mr of xr){const fr=pr.get(mr);fr.sort((yr,jr)=>yr.x-jr.x);let Er="",vr=0,gr=0;for(const yr of fr){const jr=yr.x-(vr+gr);vr>0&&jr>3&&(jr>20?Er+="    ":Er+=" "),Er+=yr.text,vr=yr.x,gr=yr.width}cr+=Er.trimEnd()+`
`}cr+=`
`}return normalizeScriptText(cr)}function normalizeScriptText(ar){return ar.replace(/\b(INT|EXT)\s*\n\s*\./g,"$1.").replace(/\b(INT|EXT)\s*\n\s*\/\s*(INT|EXT)/g,"$1/$2").replace(/CONTIN\s*\n\s*UED?/gi,"CONTINUOUS").replace(/CONT['']?D/gi,"CONT'D").replace(/\(\s*V\s*\.\s*O\s*\.\s*\)/gi,"(V.O.)").replace(/\(\s*O\s*\.\s*S\s*\.\s*\)/gi,"(O.S.)").replace(/[ \t]+/g," ").replace(/\n{4,}/g,`


`).replace(/(\d+[A-Z]?)\s+\./g,"$1.").trim()}function extractTextFromFDX(ar){try{const cr=new DOMParser().parseFromString(ar,"text/xml").querySelectorAll("Paragraph");let ur="";return cr.forEach(dr=>{const hr=dr.getAttribute("Type"),pr=dr.querySelectorAll("Text");let xr="";pr.forEach(mr=>{xr+=mr.textContent||""}),hr==="Scene Heading"?ur+=`
`+xr.trim()+`
`:hr==="Character"?ur+=`
`+xr.trim().toUpperCase()+`
`:hr==="Dialogue"?ur+=xr.trim()+`
`:hr==="Action"?ur+=`
`+xr.trim()+`
`:ur+=xr.trim()+`
`}),ur}catch(or){return console.error("Error parsing FDX:",or),ar}}function normalizeTimeOfDayForScene(ar){const or=(ar||"DAY").toUpperCase();return or==="NIGHT"||or==="NIGHTMARE"?"NIGHT":or==="MORNING"||or==="DAWN"||or==="SUNRISE"?"MORNING":or==="EVENING"||or==="DUSK"||or==="SUNSET"||or==="MAGIC HOUR"||or==="GOLDEN HOUR"?"EVENING":or==="CONTINUOUS"||or==="CONT"||or==="LATER"||or==="SAME"||or==="SAME TIME"||or==="MOMENTS LATER"||or==="SIMULTANEOUS"?"CONTINUOUS":"DAY"}function normalizeCharacterName(ar){let or=ar.toUpperCase();if(or=or.replace(/\s*\(.*?\)\s*/g,""),or.includes("/")&&!or.startsWith("INT")&&!or.startsWith("EXT")){const lr=or.split("/");lr[0].length>=2&&lr[0].length<=20&&(or=lr[0].trim())}return or.replace(/\s+/g," ").trim()}function extractCharactersFromActionLine(ar){const or=[],lr=ar.trim();if(lr.length<5||/^(INT\.|EXT\.|INT\/EXT|CUT TO|FADE|DISSOLVE|CONTINUED)/i.test(lr))return or;const cr=new Set(["INT","EXT","ROAD","STREET","AVENUE","HIGHWAY","PATH","TRAIL","LANE","DAY","NIGHT","MORNING","EVENING","CONTINUOUS","LATER","SAME","CONT","DAWN","DUSK","CONTINUED","CUT","FADE","DISSOLVE","SMASH","MATCH","WIPE","THE","AND","BUT","FOR","NOT","YOU","ALL","CAN","HER","HIS","HIM","SHE","HAS","HAD","WAS","ARE","BEEN","HAVE","THEIR","WHAT","WHEN","WHERE","WHICH","WHO","THIS","THAT","WITH","FROM","INTO","ONTO","UPON","BACK","OVER","UNDER","VERY","MUCH","MORE","MOST","JUST","ONLY","ALSO","EVEN","STILL","WELL","SUCH","SOME","MANY","BOTH","EACH","OTHER","CLOSE","WIDE","ANGLE","VIEW","SHOT","POV","INSERT","FLASHBACK","DREAM","TITLE","SUPER","CHYRON","SUBTITLE","TV","DVD","VHS","USA","NYC","NYPD","FBI","CIA","NSA","TAXI","STAND","CAR","DOOR","ROOM","HOUSE","BOAT","PHONE","GUN","KNIFE","TABLE","CHAIR","PARKA","WHEELCHAIR","VEHICLE","WINDOW","WALL","FLOOR","CEILING","BED","DESK","LAMP","MOUNTAINS","MOUNTAIN","HILLS","HILLSIDES","VALLEY","RIVER","RIVERS","STREAM","STREAMS","LAKE","OCEAN","SEA","BEACH","FOREST","WOODS","TREE","TREES","SKY","SUN","MOON","CLOUDS","RAIN","SNOW","WIND","WATER","MELTWATER","WILDFLOWER","FLOWERS","GRASS","EDENIC","VERDANT","LONELY","QUIET","LOUD","DARK","BRIGHT","SMALL","LARGE","BIG","TALL","SHORT","LONG","WIDE","NARROW","THICK","THIN","HEAVY","LIGHT","HARD","SOFT","HOT","COLD","WARM","COOL","WET","DRY","CLEAN","DIRTY","NEW","OLD","FRESH","STALE","GOOD","BAD","GREAT","POOR","RICH","SIMPLE","COMPLEX","EASY","DIFFICULT","FAST","SLOW","HIGH","LOW","NEAR","FAR","CLOSE","DISTANT","OPEN","CLOSED","EMPTY","FULL","BEAUTIFUL","GORGEOUS","STUNNING","SERENE","PEACEFUL","CALM","WILD","FIERCE","RED","BLUE","GREEN","YELLOW","ORANGE","PURPLE","PINK","BLACK","WHITE","GREY","GRAY","BROWN","GOLDEN","SILVER","ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN","FIRST","SECOND","THIRD","LAST","NEXT","ANOTHER","FEW","SEVERAL"]),ur=/^[A-Z]+(ING|ED|LY|TION|SION|NESS|MENT|ABLE|IBLE|ICAL|IOUS|EOUS|ULAR|TERN|ERN|WARD|WARDS|LIKE|LESS|FUL|IC|AL|ARY|ORY|IVE|OUS|ANT|ENT)$/,dr=/^(INT|EXT)\s*[.\/]/,hr=/\b([A-Z][A-Z.'-]+(?:\s+[A-Z][A-Z.'-]+){0,2})\b/g;let pr;for(;(pr=hr.exec(lr))!==null;){const mr=pr[1].trim();if(dr.test(mr)||mr.split(/\s+/).length===1&&cr.has(mr)||cr.has(mr)||ur.test(mr))continue;const fr=mr.split(/\s+/);if(fr.some(yr=>ur.test(yr)||cr.has(yr))||/\b(TAXI|CAR|DOOR|ROOM|HOUSE|BOAT|PHONE|GUN|KNIFE|TABLE|CHAIR|STAND|PARKA|WHEELCHAIR|VEHICLE|ROAD|STREET|MOUNTAIN|RIVER|TREE)\b/i.test(mr))continue;const gr=/\b(MAN|WOMAN|PERSON|DRIVER|OFFICER|DOCTOR|NURSE|GUARD|SOLDIER|WORKER|GIRL|BOY|LADY|GUY|KID|CHILD|TEEN|TEENAGER|CLERK|WAITER|WAITRESS|COP|DETECTIVE|AGENT|STRANGER|FIGURE)\b/i;if(fr.length>=2&&gr.test(mr)){or.push(mr);continue}if(fr.length===1&&mr.length>=3&&mr.length<=15){const yr=lr.slice(pr.index+mr.length),jr=/^\s*(enters|exits|walks|runs|stands|sits|looks|turns|moves|says|speaks|watches|stares|smiles|nods|shakes|reaches|grabs|holds|opens|closes|steps|crosses|approaches|leaves|arrives|appears|disappears|rises|falls|jumps|climbs|crawls|lies|kneels|bends|leans|waves|points|gestures|signals|calls|shouts|whispers|laughs|cries|sighs|groans|screams|freezes|pauses|stops|starts|continues|begins|finishes|waits|hesitates)/i.test(yr),br=/^('s\s|'s$)/i.test(yr),_r=/^\s+and\s+[A-Z][a-z]/i.test(yr);(jr||br||_r)&&or.push(mr)}}const xr=/(?:^|[,;]\s*|\.\s+)([A-Z][a-z]+(?:\s+(?:and|&)\s+[A-Z][a-z]+)*)\s+(and\s+)?(?=enters|exits|walks|runs|stands|sits|looks|turns|moves|says|speaks|watches|stares|smiles|nods|shakes|reaches|grabs|holds|opens|closes|steps|crosses|approaches|leaves|arrives|appears|disappears|rises|falls|jumps|climbs|crawls|lies|kneels|bends|leans|waves|points|gestures|signals|calls|shouts|whispers|laughs|cries|sighs|groans|screams|freezes|pauses|stops|starts|continues|begins|finishes|waits|hesitates|[a-z])/gi;for(;(pr=xr.exec(lr))!==null;){const mr=pr[1].split(/\s+(?:and|&)\s+/i);for(const fr of mr){const Er=fr.trim().toUpperCase();Er.length>=3&&Er.length<=20&&!cr.has(Er)&&!ur.test(Er)&&!["THE","AND","BUT","FOR","NOT","THIS","THAT","WHEN","WHERE","WHILE","THEN","THERE","HERE"].includes(Er)&&or.push(Er)}}return[...new Set(or)]}function isCharacterCue(ar){const or=ar.trim();if(or!==or.toUpperCase()||or.length>50)return!1;const lr=[/^(INT\.|EXT\.|INT\/EXT|EXT\/INT|I\/E\.)/i,/^(CUT TO|FADE|DISSOLVE|SMASH|MATCH|WIPE)/i,/^(THE END|CONTINUED|MORE|\(MORE\))/i,/^\d+\s*$/,/^\s*$/,/^(TITLE:|SUPER:|CHYRON:|CARD:|INSERT:|INTERCUT)/i,/^(FLASHBACK|END FLASHBACK|FLASH BACK|DREAM SEQUENCE)/i,/^(BACK TO|RESUME|ANGLE ON|CLOSE ON|WIDE ON|POV)/i,/^(LATER|CONTINUOUS|MOMENTS LATER|SAME TIME)/i,/^(SUPERIMPOSE|SUBTITLE|CAPTION)/i];for(const hr of lr)if(hr.test(or))return!1;if(!/[A-Z]/.test(or))return!1;const cr=[/^(A |AN |THE |HE |SHE |THEY |WE |IT |HIS |HER |THEIR )/,/^(IN THE |AT THE |ON THE |FROM THE |TO THE |INTO THE )/,/^(ARRIVING|ENTERING|LEAVING|WALKING|RUNNING|STANDING|SITTING)/,/ (ENTERS|EXITS|WALKS|RUNS|STANDS|SITS|LOOKS|TURNS|MOVES)$/,/ (IS |ARE |WAS |WERE |HAS |HAVE |THE |A |AN )/,/^[A-Z]+ [A-Z]+ [A-Z]+ [A-Z]+ [A-Z]+/,/\.$/,/^\d+[A-Z]?\s+/];for(const hr of cr)if(hr.test(or))return!1;const ur=or.replace(/\s*\(.*?\)\s*/g,"").trim(),dr=ur.split(/\s+/).length;return dr>4||dr===1&&(/^[A-Z]+(ING|ED|LY|TION|SION|NESS|MENT|ABLE|IBLE|ICAL|IOUS|EOUS|ULAR|TERN|ERN|WARD|WARDS|LIKE|LESS|FUL|IC|AL|ARY|ORY|IVE|OUS|ANT|ENT)$/.test(ur)||new Set(["INT","EXT","ROAD","STREET","HOUSE","ROOM","OFFICE","BUILDING","DAY","NIGHT","MORNING","EVENING","DAWN","DUSK","LATER","CONTINUOUS","EDENIC","VERDANT","TOWERING","LONELY","BEAUTIFUL","GORGEOUS","STUNNING","SERENE","PEACEFUL","WILD","FIERCE","ANCIENT","MODERN","RUSTIC","MOUNTAINS","MOUNTAIN","HILLS","VALLEY","RIVER","STREAM","LAKE","OCEAN","FOREST","WOODS","TREE","TREES","SKY","SUN","MOON","MELTWATER","RED","BLUE","GREEN","YELLOW","ORANGE","PURPLE","BLACK","WHITE","GOLDEN","VERY","MUCH","MORE","MOST","JUST","ONLY","ALSO","EVEN","STILL","WELL","ONE","TWO","THREE","FIRST","SECOND","THIRD","LAST","NEXT","ANOTHER","CONTINUED","FADE","CUT","DISSOLVE","ANGLE","SHOT","VIEW","CLOSE","WIDE"]).has(ur))?!1:ur.length>=2&&ur.length<=35}function parseSceneHeadingLine(ar){const or=ar.trim(),lr={sceneNumber:null,intExt:"INT",location:"",timeOfDay:"DAY",rawSlugline:or,isValid:!1};if(!or||or.length<5)return lr;let cr=or.replace(/\s*\*+\s*$/,"").trim();const ur=/^(\d+[A-Z]?)\s+/i,dr=/\s+(\d+[A-Z]?)\s*$/i;let hr=null,pr=cr;const xr=pr.match(ur);xr&&(hr=xr[1].toUpperCase(),pr=pr.slice(xr[0].length).trim());const mr=pr.match(dr);if(mr){const wr=mr[1].toUpperCase();hr||(hr=wr),pr=pr.slice(0,-mr[0].length).trim()}const fr=/^(INT\.?\/EXT\.?|EXT\.?\/INT\.?|I\/E\.?|INT\.?|EXT\.?)\s*/i,Er=pr.match(fr);if(!Er)return lr;const gr=Er[1].toUpperCase().replace(/\.$/,"").startsWith("EXT")?"EXT":"INT";pr=pr.slice(Er[0].length).trim(),pr=pr.replace(/^[\.\-]\s*/,"").trim();const yr=/(?:\s*[-\.]+\s*|\s+)(DAY|NIGHT|MORNING|EVENING|AFTERNOON|DAWN|DUSK|SUNSET|SUNRISE|CONTINUOUS|CONT|LATER|SAME|SAME TIME|MOMENTS LATER|SIMULTANEOUS|MAGIC HOUR|GOLDEN HOUR|FLASHBACK|PRESENT|DREAM|FANTASY|NIGHTMARE|ESTABLISHING)(?:\s*[-]?\s*(?:FLASHBACK|PRESENT|CONT(?:'D)?)?)?$/i;let jr="DAY",br=pr;const _r=pr.match(yr);return _r&&(jr=_r[1].toUpperCase(),jr==="CONT"&&(jr="CONTINUOUS"),br=pr.slice(0,_r.index).trim(),br=br.replace(/[\s\-\.,]+$/,"").trim()),!_r&&pr.length>0&&(br=pr.replace(/[\s\-\.,]+$/,"").trim()),!br||br.length<2?lr:{sceneNumber:hr,intExt:gr,location:br,timeOfDay:jr,rawSlugline:or,isValid:!0}}function convertParsedScriptToProject(ar,or){const lr=new Map,cr=or.map((dr,hr)=>{const pr=`char-${v4().slice(0,8)}`;lr.set(dr,pr);const xr=dr.split(" ").map(Er=>Er[0]).join("").slice(0,2),mr=["#C9A961","#8B5CF6","#EC4899","#10B981","#F59E0B","#EF4444","#3B82F6","#6366F1"],fr=mr[hr%mr.length];return{id:pr,name:dr,initials:xr,avatarColour:fr}});return{scenes:ar.scenes.map(dr=>{const hr=dr.characters.filter(pr=>lr.has(pr)).map(pr=>lr.get(pr));return{id:`scene-${dr.sceneNumber}`,sceneNumber:dr.sceneNumber,slugline:`${dr.intExt}. ${dr.location} - ${dr.timeOfDay}`,intExt:dr.intExt,timeOfDay:dr.timeOfDay,synopsis:dr.synopsis,scriptContent:dr.content,characters:hr,isComplete:!1}}),characters:cr}}async function parseScenesFast(ar){const or=ar.name.toLowerCase();let lr;if(or.endsWith(".pdf"))lr=await extractTextFromPDF(ar);else if(or.endsWith(".fdx")){const fr=await ar.text();lr=extractTextFromFDX(fr)}else lr=await ar.text();const cr=lr.split(`
`),ur=[];let dr=null,hr=0,pr="";for(let fr=0;fr<cr.length;fr++){const Er=cr[fr],vr=Er.trim(),gr=parseSceneHeadingLine(vr);if(gr.isValid){dr&&(dr.scriptContent=pr.trim(),ur.push(dr)),hr++;const yr=gr.sceneNumber||String(hr),jr=normalizeTimeOfDayForScene(gr.timeOfDay);dr={sceneNumber:yr,slugline:vr,intExt:gr.intExt,location:gr.location,timeOfDay:jr,scriptContent:""},pr=vr+`
`;continue}dr&&(pr+=Er+`
`)}dr&&(dr.scriptContent=pr.trim(),ur.push(dr));const xr=lr.slice(0,1e3).match(/^(?:title[:\s]*)?([A-Z][A-Z\s\d\-\'\"]+)(?:\n|by)/im);return{title:xr?xr[1].trim():"Untitled Script",scenes:ur,rawText:lr}}async function detectCharactersForScene(ar,or,lr){const cr=(lr==null?void 0:lr.knownCharacters)??[],ur=[],dr=new Set;if(cr.length>0){const xr=ar.toUpperCase();for(const mr of cr){const fr=normalizeCharacterName(mr);if(fr.length<2)continue;new RegExp(`\\b${escapeRegExp(fr)}\\b`,"i").test(xr)&&!dr.has(fr)&&(dr.add(fr),ur.push(fr))}}const hr=ar.split(`
`);let pr=!1;for(let xr=0;xr<hr.length;xr++){const fr=hr[xr].trim();if(isCharacterCue(fr)){const Er=normalizeCharacterName(fr);Er.length>=2&&!dr.has(Er)&&(dr.add(Er),ur.push(Er)),pr=!0}else if(!(pr&&fr.length>0)){if(pr=!1,fr.length>10&&cr.length===0){const Er=extractCharactersFromActionLine(fr);for(const vr of Er){const gr=normalizeCharacterName(vr);gr.length>=2&&!dr.has(gr)&&(dr.add(gr),ur.push(gr))}}}}return ur}function escapeRegExp(ar){return ar.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async function detectCharactersForScenesBatch(ar,or,lr){var pr;const cr=new Map,ur=ar.length;let dr=0;const hr=5;for(let xr=0;xr<ar.length;xr+=hr){const mr=ar.slice(xr,xr+hr),fr=await Promise.all(mr.map(async Er=>{const vr=await detectCharactersForScene(Er.scriptContent,or,{knownCharacters:lr==null?void 0:lr.knownCharacters});return{sceneNumber:Er.sceneNumber,characters:vr}}));for(const Er of fr)cr.set(Er.sceneNumber,Er.characters),dr++,(pr=lr==null?void 0:lr.onProgress)==null||pr.call(lr,dr,ur)}return cr}function ScheduleAmendmentModal({amendmentResult:ar,getCastNamesForNumbers:or,onApply:lr,onCancel:cr}){const[ur,dr]=reactExports.useState(!0),[hr,pr]=reactExports.useState(!0),[xr,mr]=reactExports.useState(!0),[fr,Er]=reactExports.useState(!0),[vr,gr]=reactExports.useState(!0),[yr,jr]=reactExports.useState(null),{addedScenes:br,removedScenes:_r,movedScenes:wr,castChanges:Rr,timingChanges:Ar,addedDays:Sr,removedDays:kr,summary:Nr,hasChanges:Cr}=ar,Tr=()=>{lr({includeAddedScenes:ur,includeRemovedScenes:hr,includeMovedScenes:xr,includeCastChanges:fr,includeTimingChanges:vr})},Pr=ur||hr||xr||fr||vr,Ir=Yr=>{switch(Yr){case"scene_added":case"day_added":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})});case"scene_removed":case"day_removed":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})});case"scene_moved":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})});case"cast_changed":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})})});case"timing_changed":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})});default:return null}},Br=Yr=>jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2 py-2",children:[Ir(Yr.changeType),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-text-primary",children:["Sc ",Yr.sceneNumber]}),Yr.newEntry&&jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted truncate",children:Yr.newEntry.setLocation})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-muted mt-0.5",children:Yr.description}),Yr.changeType==="cast_changed"&&jsxRuntimeExports.jsxs("div",{className:"mt-1 space-y-0.5",children:[Yr.castAdded&&Yr.castAdded.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:or(Yr.castAdded).map((es,ps)=>jsxRuntimeExports.jsxs("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded",children:["+ ",es]},ps))}),Yr.castRemoved&&Yr.castRemoved.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:or(Yr.castRemoved).map((es,ps)=>jsxRuntimeExports.jsxs("span",{className:"text-[10px] bg-red-100 text-red-700 px-1.5 py-0.5 rounded",children:["- ",es]},ps))})]})]})]},`${Yr.sceneNumber}-${Yr.changeType}`),Wr=(Yr,es,ps,ts,Qr,Hr,Kr="Include")=>{if(ps.length===0)return null;const rs=yr===es,Mr={green:{heading:"text-green-700",border:"border-green-200",bg:"bg-green-50"},red:{heading:"text-red-700",border:"border-red-200",bg:"bg-red-50"},blue:{heading:"text-blue-700",border:"border-blue-200",bg:"bg-blue-50"},purple:{heading:"text-purple-700",border:"border-purple-200",bg:"bg-purple-50"},amber:{heading:"text-amber-700",border:"border-amber-200",bg:"bg-amber-50"}},Dr=Mr[ts]||Mr.amber;return jsxRuntimeExports.jsxs("div",{className:clsx("border rounded-lg overflow-hidden",Dr.border),children:[jsxRuntimeExports.jsx("div",{className:clsx("px-3 py-2",Dr.bg),children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>jr(rs?null:es),className:"flex items-center gap-2 flex-1 text-left",children:[jsxRuntimeExports.jsxs("h4",{className:clsx("text-xs font-bold tracking-wider uppercase",Dr.heading),children:[Yr," (",ps.length,")"]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-3.5 h-3.5 text-text-muted transition-transform",rs&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:Qr,onChange:Lr=>Hr(Lr.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:Kr})]})]})}),rs&&jsxRuntimeExports.jsx("div",{className:"px-3 divide-y divide-border/30",children:ps.map(Br)})]})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[90vh] flex flex-col safe-bottom",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Schedule Changes Detected"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:Nr})]}),jsxRuntimeExports.jsx("button",{onClick:cr,className:"p-2 -mr-2 text-text-muted active:text-gold",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:Cr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-700",children:"Select which changes to apply. Unchecked changes will be ignored and your current data will be preserved."})}),(Sr.length>0||kr.length>0)&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[Sr.length>0&&jsxRuntimeExports.jsx("div",{className:"flex-1 p-2 bg-green-50 border border-green-200 rounded-lg",children:jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-green-700",children:["+",Sr.length," day",Sr.length>1?"s":""]})}),kr.length>0&&jsxRuntimeExports.jsx("div",{className:"flex-1 p-2 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-red-700",children:["-",kr.length," day",kr.length>1?"s":""]})})]}),Wr("Scenes Added","added",br,"green",ur,dr),Wr("Scenes Removed","removed",_r,"red",hr,pr,"Remove"),Wr("Scenes Moved","moved",wr,"blue",xr,mr),Wr("Cast Changes","cast",Rr,"purple",fr,Er),Wr("Timing Changes","timing",Ar,"amber",vr,gr)]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsx("p",{className:"text-text-primary font-medium",children:"No Changes Detected"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-1",children:"The new schedule appears identical to your current one."})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-t border-border shrink-0 space-y-2",children:Cr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:Tr,disabled:!Pr,className:"w-full py-3 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50",children:"Apply Selected Changes"}),jsxRuntimeExports.jsx("button",{onClick:cr,className:"w-full py-2 text-sm text-text-muted",children:"Cancel - Keep Current Schedule"})]}):jsxRuntimeExports.jsx("button",{onClick:cr,className:"w-full py-3 rounded-button bg-gray-100 text-text-primary font-semibold text-base active:scale-[0.98] transition-transform",children:"Close"})})]})})}const getSystemTheme=()=>typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",resolveTheme=ar=>ar==="system"?getSystemTheme():ar,applyTheme=ar=>{if(typeof document<"u"){const or=document.documentElement;or.classList.remove("light","dark"),or.classList.add(ar);const lr=document.querySelector('meta[name="theme-color"]');lr&&lr.setAttribute("content",ar==="dark"?"#000000":"#f5f4f2")}},useThemeStore=create()(persist(ar=>({theme:"light",resolvedTheme:"light",setTheme:or=>{const lr=resolveTheme(or);applyTheme(lr),ar({theme:or,resolvedTheme:lr})}}),{name:"hair-makeup-theme-storage",storage:createJSONStorage(()=>localStorage),onRehydrateStorage:()=>ar=>{if(ar){const or=resolveTheme(ar.theme);applyTheme(or),ar.resolvedTheme=or}}}));typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",ar=>{if(useThemeStore.getState().theme==="system"){const lr=ar.matches?"dark":"light";applyTheme(lr),useThemeStore.setState({resolvedTheme:lr})}});function UserProfileScreen({onBack:ar,onNavigateToBilling:or}){const{user:lr,signOut:cr}=useAuthStore(),{theme:ur,setTheme:dr}=useThemeStore(),[hr,pr]=reactExports.useState(!1),[xr,mr]=reactExports.useState((lr==null?void 0:lr.name)||""),[fr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(null),[yr,jr]=reactExports.useState(!1),br=[{value:"light",label:"Light",icon:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})},{value:"dark",label:"Dark",icon:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})},{value:"system",label:"System",icon:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}],_r=()=>{if(!(lr!=null&&lr.name))return"U";const kr=lr.name.split(" ");return kr.length>=2?`${kr[0][0]}${kr[1][0]}`.toUpperCase():lr.name.substring(0,2).toUpperCase()},wr=()=>"Beta Tester",Rr=async()=>{if(!xr.trim()||!lr){gr({type:"error",text:"Name cannot be empty"});return}Er(!0);try{const{error:kr}=await updateUserProfile(lr.id,{name:xr.trim()});if(kr)throw kr;useAuthStore.setState({user:{...lr,name:xr.trim()}}),pr(!1),gr({type:"success",text:"Profile updated successfully"})}catch{gr({type:"error",text:"Failed to update profile"})}finally{Er(!1)}},Ar=async()=>{if(!(lr!=null&&lr.email)){gr({type:"error",text:"No email address found"});return}jr(!0);try{const{error:kr}=await supabase.auth.resetPasswordForEmail(lr.email,{redirectTo:`${window.location.origin}/reset-password`});if(kr)throw kr;gr({type:"success",text:"Password reset email sent! Check your inbox."})}catch{gr({type:"error",text:"Failed to send password reset email"})}finally{jr(!1)}},Sr=()=>{cr()};return vr&&setTimeout(()=>gr(null),4e3),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"My Account"})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:[vr&&jsxRuntimeExports.jsx("div",{className:`mb-4 px-4 py-2 rounded-lg text-sm ${vr.type==="success"?"bg-green-50 border border-green-200 text-green-700":"bg-red-50 border border-red-200 text-red-700"}`,children:vr.text}),jsxRuntimeExports.jsx("section",{className:"mb-6",children:jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-border mb-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gold-100 flex items-center justify-center text-gold text-xl font-bold",children:_r()}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[hr?jsxRuntimeExports.jsx("input",{type:"text",value:xr,onChange:kr=>mr(kr.target.value),className:"input-field w-full text-lg font-bold",autoFocus:!0}):jsxRuntimeExports.jsx("h2",{className:"text-lg font-bold text-text-primary truncate",children:(lr==null?void 0:lr.name)||"User"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted truncate",children:(lr==null?void 0:lr.email)||""}),jsxRuntimeExports.jsx("div",{className:"inline-flex items-center gap-1 mt-1 px-2 py-0.5 bg-gold-50 rounded-full",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-gold",children:wr()})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:hr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>{pr(!1),mr((lr==null?void 0:lr.name)||"")},className:"flex-1 py-2 px-4 rounded-button border border-border text-text-muted text-sm font-medium active:scale-98 transition-transform",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Rr,disabled:fr,className:"flex-1 py-2 px-4 rounded-button gold-gradient text-white text-sm font-medium active:scale-98 transition-transform disabled:opacity-50",children:fr?"Saving...":"Save"})]}):jsxRuntimeExports.jsx("button",{onClick:()=>pr(!0),className:"flex-1 py-2 px-4 rounded-button border border-border text-text-primary text-sm font-medium active:scale-98 transition-transform",children:"Edit Profile"})})]})}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"ACCOUNT SETTINGS"}),jsxRuntimeExports.jsxs("div",{className:"card divide-y divide-border",children:[jsxRuntimeExports.jsxs("button",{onClick:Ar,disabled:yr,className:"w-full flex items-center gap-4 px-4 py-3 active:bg-gray-50 transition-colors disabled:opacity-50",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:yr?"Sending...":"Reset Password"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Send password reset email"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsxs("button",{onClick:or,className:"w-full flex items-center gap-4 px-4 py-3 active:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Billing & Bank Details"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"For timesheets and invoices"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"BETA ACCESS"}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-gold-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.745 3.745 0 011.043 3.296A3.745 3.745 0 0121 12z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Full Access Enabled"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Thank you for beta testing!"})]})]})})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"APPEARANCE"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Theme"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted capitalize",children:ur})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-3 gap-2",children:br.map(kr=>jsxRuntimeExports.jsxs("button",{onClick:()=>dr(kr.value),className:`flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all ${ur===kr.value?"border-gold bg-gold/10 text-gold":"border-border text-text-muted hover:border-gold/50"}`,children:[kr.icon,jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:kr.label})]},kr.value))})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"SESSION"}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsxs("button",{onClick:Sr,className:"w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-red-50 active:bg-red-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-50 flex items-center justify-center text-red-500",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-red-500",children:"Sign Out"})]})})]}),jsxRuntimeExports.jsx("div",{className:"text-center text-xs text-text-muted py-4",children:jsxRuntimeExports.jsx("p",{children:"Checks Happy v1.0.0"})})]})]})}function More({onNavigateToTab:ar,onStartNewProject:or,initialView:lr,resetKey:cr,subView:ur}){const dr=()=>ur||(lr&&["script","schedule","callsheets"].includes(lr)?lr:"menu"),[hr,pr]=reactExports.useState(dr),{isEditMenuOpen:xr,closeEditMenu:mr,openEditMenu:fr}=useNavigationStore(),{projectMemberships:Er,user:vr}=useAuthStore(),{projectSettings:gr,clearState:yr}=useProjectSettingsStore(),jr=Er.length>0?Er[0]:null,br=(jr==null?void 0:jr.role)==="owner",_r=jr&&vr?canManageProject(vr.tier,{isOwner:br,role:br?"designer":jr.role==="supervisor"?"supervisor":"trainee"}):!1;reactExports.useEffect(()=>{ur?pr(ur):lr&&["script","schedule","callsheets"].includes(lr)?pr(lr):lr==="more"&&pr("menu")},[lr,cr,ur]);const wr=xr?"editMenu":hr,Rr=Nr=>{Nr==="editMenu"?fr():pr(Nr)},Ar=()=>{mr(),pr("menu")},Sr=()=>{lr&&["script","schedule","callsheets"].includes(lr)?ar==null||ar("today"):pr("menu")},kr=()=>{switch(wr){case"script":return jsxRuntimeExports.jsx(ScriptViewer,{onBack:Sr});case"schedule":return jsxRuntimeExports.jsx(ScheduleViewer,{onBack:Sr});case"callsheets":return jsxRuntimeExports.jsx(CallSheetArchive,{onBack:Sr});case"editMenu":return jsxRuntimeExports.jsx(EditMenuScreen,{onDone:Ar});case"export":return jsxRuntimeExports.jsx(ProjectExportScreen,{onBack:()=>pr("projectSettings"),onExportComplete:()=>pr("projectSettings"),onNavigateToBilling:()=>pr("billing")});case"archivedProjects":return jsxRuntimeExports.jsx(ArchivedProjectsScreen,{onBack:()=>pr("menu")});case"projectSettings":return jsxRuntimeExports.jsx(ProjectSettingsScreen,{projectId:(jr==null?void 0:jr.projectId)||"",onBack:()=>pr("menu"),onNavigateToTeam:()=>pr("team"),onNavigateToStats:()=>pr("projectStats"),onNavigateToExport:()=>pr("export"),onNavigateToProductionDetails:()=>pr("productionDetails"),onProjectArchived:()=>{yr(),pr("menu")},onProjectDeleted:()=>{yr(),or==null||or()}});case"productionDetails":return jsxRuntimeExports.jsx(ProductionDetailsScreen,{projectId:(jr==null?void 0:jr.projectId)||"",onBack:()=>pr("projectSettings")});case"team":return jsxRuntimeExports.jsx(TeamScreen,{projectId:(jr==null?void 0:jr.projectId)||"",canManage:_r,isOwner:br,onBack:()=>pr("projectSettings"),onInvite:()=>pr("invite")});case"invite":return jsxRuntimeExports.jsx(InviteScreen,{inviteCode:(gr==null?void 0:gr.inviteCode)||(jr==null?void 0:jr.projectCode)||"",isOwner:br,onBack:()=>pr("team")});case"projectStats":return jsxRuntimeExports.jsx(ProjectStatsScreen,{projectId:(jr==null?void 0:jr.projectId)||"",onBack:()=>pr("projectSettings")});case"manualSchedule":return jsxRuntimeExports.jsx(ScheduleScreen,{onBack:()=>pr("projectSettings"),onSaved:()=>pr("projectSettings")});case"billing":return jsxRuntimeExports.jsx(BillingDetailsScreen,{onBack:()=>pr("menu"),onUpgrade:()=>{useAuthStore.getState().setScreen("select-plan")}});case"userProfile":return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:()=>pr("menu"),onNavigateToBilling:()=>pr("billing")});default:return jsxRuntimeExports.jsx(MoreMenu,{onNavigate:Rr,onNavigateToTab:ar,canManage:_r})}};return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background pb-safe-bottom",children:kr()})}function MoreMenu({onNavigate:ar,onNavigateToTab:or,canManage:lr}){const{getMoreMenuItems:cr}=useNavigationStore(),dr=cr().map(mr=>ALL_NAV_ITEMS.find(fr=>fr.id===mr)).filter(Boolean),hr=mr=>{switch(mr){case"lookbook":return"Character looks and styles";case"script":return"View script PDF with scene search";case"schedule":return"Shooting schedule day-by-day";case"callsheets":return"Upload and manage call sheets";case"today":return"Today's shooting schedule";case"breakdown":return"Scene breakdown by character";case"hours":return"Timesheet and earnings";case"budget":return"Expenses overview, scan receipts";default:return""}},pr=mr=>{["script","schedule","callsheets"].includes(mr)?ar(mr):or&&or(mr)},xr=dr.filter(mr=>mr.id!=="settings");return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"h-14 px-4 flex items-center",children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"More"})})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[xr.map(mr=>jsxRuntimeExports.jsxs("button",{onClick:()=>pr(mr.id),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold-100/50 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(NavIcon,{name:mr.iconName,className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:mr.label}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:hr(mr.id)})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},mr.id)),lr&&jsxRuntimeExports.jsxs("button",{onClick:()=>ar("projectSettings"),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold-100/50 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(NavIcon,{name:"cog",className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Settings"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Project settings and management"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}),jsxRuntimeExports.jsx("div",{className:"pt-4 border-t border-border mt-4",children:jsxRuntimeExports.jsxs("button",{onClick:()=>ar("editMenu"),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Edit Menu"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Customize bottom navigation"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})})]})})]})}function EditMenuScreen({onDone:ar}){var Qr,Hr;const{bottomNavItems:or,setBottomNavItems:lr,moveToBottomNav:cr,moveToMoreMenu:ur}=useNavigationStore(),[dr,hr]=reactExports.useState(null),[pr,xr]=reactExports.useState(null),[mr,fr]=reactExports.useState(null),[Er,vr]=reactExports.useState(!1),[gr,yr]=reactExports.useState(null),jr=reactExports.useRef(null),br=reactExports.useRef(null),_r=reactExports.useRef(new Map),wr=reactExports.useRef(null),Rr=reactExports.useRef(null),Ar=ALL_NAV_ITEMS.filter(Kr=>!or.includes(Kr.id)),Sr=or.map(Kr=>ALL_NAV_ITEMS.find(rs=>rs.id===Kr)).filter(Boolean),kr=reactExports.useCallback(Kr=>{hr(Kr)},[]),Nr=reactExports.useCallback(()=>{dr&&pr!==null&&mr&&(mr==="bottom"?cr(dr,pr):mr==="more"&&ur(dr)),hr(null),xr(null),fr(null),vr(!1),yr(null)},[dr,pr,mr,cr,ur]),Cr=reactExports.useCallback((Kr,rs)=>{fr(Kr),xr(rs)},[]),Tr=reactExports.useCallback(Kr=>{const rs=wr.current,Mr=Rr.current;if(rs){const Dr=rs.getBoundingClientRect();if(Kr>=Dr.top&&Kr<=Dr.bottom){let Lr=Sr.length;for(let Fr=0;Fr<Sr.length;Fr++){const $r=_r.current.get(`bottom-${Sr[Fr].id}`);if($r){const Vr=$r.getBoundingClientRect(),Gr=Vr.top+Vr.height/2;if(Kr<Gr){Lr=Fr;break}}}fr("bottom"),xr(Lr);return}}if(Mr){const Dr=Mr.getBoundingClientRect();if(Kr>=Dr.top&&Kr<=Dr.bottom){fr("more"),xr(0);return}}fr(null),xr(null)},[Sr]),Pr=reactExports.useCallback((Kr,rs)=>{const Mr=Kr.touches[0];jr.current={x:Mr.clientX,y:Mr.clientY,item:rs},br.current=setTimeout(()=>{hr(rs),vr(!0),yr({x:Mr.clientX,y:Mr.clientY}),"vibrate"in navigator&&navigator.vibrate(50)},200)},[]),Ir=reactExports.useCallback(Kr=>{const rs=Kr.touches[0];if(!jr.current)return;const Mr=Math.abs(rs.clientX-jr.current.x),Dr=Math.abs(rs.clientY-jr.current.y);if(!Er&&(Mr>10||Dr>10)&&br.current){clearTimeout(br.current),br.current=null;return}Er&&(Kr.preventDefault(),yr({x:rs.clientX,y:rs.clientY}),Tr(rs.clientY))},[Er,Tr]),Br=reactExports.useCallback(()=>{br.current&&(clearTimeout(br.current),br.current=null),jr.current=null,Er&&Nr()},[Er,Nr]),Wr=reactExports.useCallback(()=>{br.current&&(clearTimeout(br.current),br.current=null),jr.current=null,hr(null),xr(null),fr(null),vr(!1),yr(null)},[]),Yr=reactExports.useCallback(Kr=>{Kr.preventDefault(),Kr.stopPropagation();const rs=Kr.touches[0];yr({x:rs.clientX,y:rs.clientY}),Tr(rs.clientY)},[Tr]),es=reactExports.useCallback(Kr=>{Kr.preventDefault(),Br()},[Br]),ps=(Kr,rs)=>{const Mr=[...or],[Dr]=Mr.splice(Kr,1);Mr.splice(rs,0,Dr),lr(Mr)},ts=reactExports.useCallback((Kr,rs)=>{rs?_r.current.set(Kr,rs):_r.current.delete(Kr)},[]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Customize Menu"}),jsxRuntimeExports.jsx("button",{onClick:ar,className:"px-4 py-1.5 text-sm font-semibold text-gold active:opacity-70 transition-opacity",children:"Done"})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted mb-6",children:["Drag items to reorder. Up to ",MAX_BOTTOM_NAV_ITEMS," appear in bottom nav."]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",ref:wr,children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"BOTTOM NAV"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[Sr.map((Kr,rs)=>jsxRuntimeExports.jsx(DraggableItem,{item:Kr,index:rs,section:"bottom",isDragging:dr===Kr.id,isDragOver:mr==="bottom"&&pr===rs,onDragStart:()=>kr(Kr.id),onDragEnd:Nr,onDragOver:()=>Cr("bottom",rs),onTouchStart:Mr=>Pr(Mr,Kr.id),onTouchMove:Ir,onTouchEnd:Br,onTouchCancel:Wr,onMoveUp:rs>0?()=>ps(rs,rs-1):void 0,onMoveDown:rs<Sr.length-1?()=>ps(rs,rs+1):void 0,onRemove:Sr.length>1?()=>ur(Kr.id):void 0,refCallback:Mr=>ts(`bottom-${Kr.id}`,Mr)},Kr.id)),or.length<MAX_BOTTOM_NAV_ITEMS&&jsxRuntimeExports.jsx("div",{className:`border-2 border-dashed rounded-xl p-4 text-center transition-colors ${mr==="bottom"&&pr===or.length?"border-gold bg-gold/5":"border-border"}`,onDragOver:Kr=>{Kr.preventDefault(),Cr("bottom",or.length)},onDrop:Nr,children:jsxRuntimeExports.jsx("span",{className:"text-sm text-text-light",children:"Drop here to add"})})]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border mb-6"}),jsxRuntimeExports.jsxs("div",{ref:Rr,children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"MORE MENU"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[Ar.map((Kr,rs)=>jsxRuntimeExports.jsx(DraggableItem,{item:Kr,index:rs,section:"more",isDragging:dr===Kr.id,isDragOver:mr==="more"&&pr===rs,onDragStart:()=>kr(Kr.id),onDragEnd:Nr,onDragOver:()=>Cr("more",rs),onTouchStart:Mr=>Pr(Mr,Kr.id),onTouchMove:Ir,onTouchEnd:Br,onTouchCancel:Wr,onAddToNav:or.length<MAX_BOTTOM_NAV_ITEMS?()=>cr(Kr.id,or.length):void 0,refCallback:Mr=>ts(`more-${Kr.id}`,Mr)},Kr.id)),Ar.length===0&&jsxRuntimeExports.jsx("div",{className:"text-center py-6 text-text-light text-sm",children:"All items are in the bottom nav"})]})]}),Er&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-30",style:{touchAction:"none"},onTouchMove:Yr,onTouchEnd:es,onTouchCancel:Wr}),Er&&gr&&dr&&jsxRuntimeExports.jsxs("div",{className:"fixed z-50 pointer-events-none",style:{left:gr.x-100,top:gr.y-30},children:[jsxRuntimeExports.jsxs("div",{className:"bg-gold text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 opacity-90",children:[jsxRuntimeExports.jsx(NavIcon,{name:((Qr=ALL_NAV_ITEMS.find(Kr=>Kr.id===dr))==null?void 0:Qr.iconName)||"ellipsis",className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:(Hr=ALL_NAV_ITEMS.find(Kr=>Kr.id===dr))==null?void 0:Hr.label})]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-center mt-1 text-gold font-medium",children:mr==="bottom"?"Drop in Bottom Nav":mr==="more"?"Drop in More Menu":"Drag to reorder"})]}),jsxRuntimeExports.jsx("div",{className:"mt-6 p-3 bg-gray-50 rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[jsxRuntimeExports.jsx(NavIcon,{name:"ellipsis",className:"w-5 h-5"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"More"})," button is always last and cannot be moved."]})]})})]})]})}function DraggableItem({item:ar,isDragging:or,isDragOver:lr,onDragStart:cr,onDragEnd:ur,onDragOver:dr,onTouchStart:hr,onTouchMove:pr,onTouchEnd:xr,onTouchCancel:mr,onMoveUp:fr,onMoveDown:Er,onRemove:vr,onAddToNav:gr,refCallback:yr}){return jsxRuntimeExports.jsxs("div",{ref:yr,className:`card flex items-center gap-3 transition-all cursor-grab active:cursor-grabbing select-none ${or?"opacity-50 scale-95":""} ${lr?"ring-2 ring-gold ring-offset-2":""}`,draggable:!0,onDragStart:cr,onDragEnd:ur,onDragOver:jr=>{jr.preventDefault(),dr()},onTouchStart:hr,onTouchMove:pr,onTouchEnd:xr,onTouchCancel:mr,children:[jsxRuntimeExports.jsx("div",{className:"text-text-light touch-none",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{d:"M8 6a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 18a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM14 6a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM14 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM14 18a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"})})}),jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-gold-100/50 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(NavIcon,{name:ar.iconName,className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 text-sm font-medium text-text-primary",children:ar.label}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[fr&&jsxRuntimeExports.jsx("button",{onClick:jr=>{jr.stopPropagation(),fr()},className:"p-1.5 rounded-lg hover:bg-gray-100 text-text-light",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),Er&&jsxRuntimeExports.jsx("button",{onClick:jr=>{jr.stopPropagation(),Er()},className:"p-1.5 rounded-lg hover:bg-gray-100 text-text-light",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),vr&&jsxRuntimeExports.jsx("button",{onClick:jr=>{jr.stopPropagation(),vr()},className:"p-1.5 rounded-lg hover:bg-red-50 text-text-light hover:text-error",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),gr&&jsxRuntimeExports.jsx("button",{onClick:jr=>{jr.stopPropagation(),gr()},className:"p-1.5 rounded-lg hover:bg-green-50 text-text-light hover:text-green-600",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]})]})}function ScriptViewer({onBack:ar}){const[or,lr]=reactExports.useState(""),[cr,ur]=reactExports.useState(null),[dr,hr]=reactExports.useState("full"),{currentProject:pr,compareScriptAmendment:xr,applyScriptAmendment:mr}=useProjectStore(),fr=reactExports.useRef(new Map),Er=reactExports.useRef(null),[vr,gr]=reactExports.useState(!1),[yr,jr]=reactExports.useState(null),br=async kr=>{var Cr;const Nr=(Cr=kr.target.files)==null?void 0:Cr[0];if(Nr){gr(!0);try{const Tr=await parseScenesFast(Nr),Pr=xr(Tr.scenes);Pr&&jr(Pr)}catch(Tr){console.error("Error processing revised script:",Tr),alert("Failed to process the script. Please try again.")}finally{gr(!1),Er.current&&(Er.current.value="")}}},_r=kr=>{yr&&(mr(yr,kr),jr(null))},wr=reactExports.useMemo(()=>pr!=null&&pr.scenes?[...pr.scenes].sort((kr,Nr)=>kr.sceneNumber.localeCompare(Nr.sceneNumber,void 0,{numeric:!0})):[],[pr==null?void 0:pr.scenes]),Rr=wr.some(kr=>kr.scriptContent),Ar=reactExports.useMemo(()=>{if(!or.trim())return wr;const kr=or.toLowerCase();return wr.filter(Nr=>{var Cr,Tr;return((Cr=Nr.scriptContent)==null?void 0:Cr.toLowerCase().includes(kr))||Nr.slugline.toLowerCase().includes(kr)||((Tr=Nr.synopsis)==null?void 0:Tr.toLowerCase().includes(kr))})},[wr,or]);reactExports.useEffect(()=>{if(cr){const kr=fr.current.get(cr);kr&&kr.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>ur(null),500)}},[cr]);const Sr=(kr,Nr)=>Nr.trim()?kr.split(new RegExp(`(${Nr.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi")).map((Tr,Pr)=>Tr.toLowerCase()===Nr.toLowerCase()?jsxRuntimeExports.jsx("mark",{className:"bg-gold/30 text-text-primary px-0.5 rounded",children:Tr},Pr):Tr):kr;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Script"}),Rr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("span",{className:"ml-auto text-xs text-text-muted",children:[wr.length," scenes"]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var kr;return(kr=Er.current)==null?void 0:kr.click()},disabled:vr,className:"ml-2 px-2 py-1 text-[10px] font-medium text-gold border border-gold rounded-lg active:bg-gold/10 transition-colors disabled:opacity-50",children:vr?"Processing...":"Upload New Draft"}),jsxRuntimeExports.jsx("input",{ref:Er,type:"file",accept:".pdf,.fdx,.txt,.fountain",onChange:br,className:"hidden"})]})]}),Rr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"px-4 pb-3 flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>hr("full"),className:`flex-1 py-1.5 text-xs font-medium rounded-lg transition-colors ${dr==="full"?"bg-gold text-white":"bg-gray-100 text-text-muted"}`,children:"Full Script"}),jsxRuntimeExports.jsx("button",{onClick:()=>hr("pdf"),disabled:!(pr!=null&&pr.scriptPdfData),className:`flex-1 py-1.5 text-xs font-medium rounded-lg transition-colors ${dr==="pdf"?"bg-gold text-white":"bg-gray-100 text-text-muted"} ${pr!=null&&pr.scriptPdfData?"":"opacity-50 cursor-not-allowed"}`,children:"PDF Script"})]}),dr==="full"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"px-4 pb-2 flex gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 relative",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search script...",value:or,onChange:kr=>lr(kr.target.value),className:"w-full pl-9 pr-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary"}),or&&jsxRuntimeExports.jsx("button",{onClick:()=>lr(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-light hover:text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("select",{value:cr||"",onChange:kr=>ur(kr.target.value||null),className:"px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary min-w-[100px]",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Jump to..."}),wr.map(kr=>jsxRuntimeExports.jsxs("option",{value:kr.sceneNumber,children:["Scene ",kr.sceneNumber]},kr.sceneNumber))]})]}),or&&jsxRuntimeExports.jsx("div",{className:"px-4 pb-2",children:jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Ar.length," scene",Ar.length!==1?"s":""," found"]})})]})]})]})}),jsxRuntimeExports.jsx("div",{className:"mobile-container pb-safe-bottom",children:Rr?dr==="full"?jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:Ar.map(kr=>jsxRuntimeExports.jsxs("div",{ref:Nr=>{Nr&&fr.current.set(kr.sceneNumber,Nr)},className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-[120px] z-10 bg-gold/10 backdrop-blur-sm border-l-4 border-gold px-3 py-2 mb-2 rounded-r-lg",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-bold text-gold",children:["SCENE ",kr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:`px-1.5 py-0.5 text-[10px] font-bold rounded ${kr.intExt==="INT"?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"}`,children:kr.intExt}),jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-gray-100 text-text-muted",children:kr.timeOfDay})]}),jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-text-primary mt-1",children:kr.slugline}),kr.synopsis&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted italic mt-1",children:Sr(kr.synopsis,or)})]}),kr.scriptContent?jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-text-primary leading-relaxed pl-3",children:or?Sr(kr.scriptContent,or):kr.scriptContent}):jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted italic pl-3",children:"No script content available for this scene"})]},kr.id))}):jsxRuntimeExports.jsx("div",{className:"h-[calc(100vh-180px)]",children:pr!=null&&pr.scriptPdfData?jsxRuntimeExports.jsx("iframe",{src:pr.scriptPdfData,className:"w-full h-full border-0",title:"Script PDF"}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full px-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No PDF Available"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center",children:"Upload a PDF script to view the original document here"})]})}):jsxRuntimeExports.jsx("div",{className:"px-4 py-8",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(NavIcon,{name:"document",className:"w-8 h-8 text-gray-300"})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Script Content"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload a script (PDF, FDX, or Fountain) to view it here"}),jsxRuntimeExports.jsx("button",{className:"px-4 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform",children:"Upload Script"})]})})}),yr&&jsxRuntimeExports.jsx(AmendmentReviewModal,{amendmentResult:yr,onApply:_r,onCancel:()=>jr(null)})]})}function ScheduleViewer({onBack:ar}){const{schedule:or,isUploading:lr,uploadError:cr,uploadScheduleStage1:ur,uploadRevisionStage1:dr,startRevisionStage2Processing:hr,compareAmendment:pr,applyAmendment:xr,clearPendingSchedule:mr,clearSchedule:fr,isProcessingStage2:Er,stage2Progress:vr,stage2Error:gr,startStage2Processing:yr,getCastNamesForNumbers:jr}=useScheduleStore(),{currentProject:br,syncCastDataFromSchedule:_r}=useProjectStore(),wr=reactExports.useRef(null),Rr=reactExports.useRef(null),[Ar,Sr]=reactExports.useState(!1),[kr,Nr]=reactExports.useState("breakdown"),[Cr,Tr]=reactExports.useState(null),[Pr,Ir]=reactExports.useState(null),[Br,Wr]=reactExports.useState(!1),Yr=async Mr=>{var Lr;const Dr=(Lr=Mr.target.files)==null?void 0:Lr[0];if(Dr&&Dr.type==="application/pdf")try{await ur(Dr),Nr("breakdown"),await yr(),br&&Kr({autoConfirm:!0})}catch(Fr){console.error("Failed to upload schedule:",Fr)}wr.current&&(wr.current.value="")},es=async Mr=>{var Lr;const Dr=(Lr=Mr.target.files)==null?void 0:Lr[0];if(!(!Dr||Dr.type!=="application/pdf")){try{Wr(!0),await dr(Dr),await hr();const Fr=pr();Fr&&Ir(Fr),Wr(!1)}catch(Fr){console.error("Failed to process schedule revision:",Fr),Wr(!1),mr()}Rr.current&&(Rr.current.value="")}},ps=Mr=>{Pr&&(xr(Pr,Mr),Ir(null),br&&Kr({autoConfirm:!0}))},ts=()=>{Ir(null),mr()},Qr=()=>{fr(),Sr(!1),Nr("pdf")},Hr=async()=>{Nr("breakdown"),await yr(),br&&Kr({autoConfirm:!0})},Kr=Mr=>{const Dr=useScheduleStore.getState().schedule;if(!(!Dr||!br))try{const Lr=_r(Dr,{createMissingCharacters:(Mr==null?void 0:Mr.createMissingCharacters)??!0,overwriteExisting:(Mr==null?void 0:Mr.overwriteExisting)??!1,autoConfirm:(Mr==null?void 0:Mr.autoConfirm)??!0});Lr&&(console.log("[ScheduleViewer] Cast data synced:",{scenesUpdated:Lr.scenesUpdated,charactersCreated:Lr.charactersCreated}),Lr.errors.length>0&&console.warn("[ScheduleViewer] Sync had some errors:",Lr.errors))}catch(Lr){console.error("[ScheduleViewer] Failed to sync cast data:",Lr)}};reactExports.useEffect(()=>{or&&!Er&&!Br&&(!or.days||or.days.length===0)&&or.rawText&&(console.log("[ScheduleViewer] Auto-starting processing for unprocessed schedule"),Hr())},[]);const rs=(or==null?void 0:or.days)&&or.days.length>0;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Schedule"})]}),or?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[rs&&jsxRuntimeExports.jsx("button",{onClick:()=>{var Mr;return(Mr=Rr.current)==null?void 0:Mr.click()},disabled:lr||Er||Br,className:"px-2 py-1 text-[10px] font-medium text-gold border border-gold rounded-lg active:bg-gold/10 transition-colors disabled:opacity-50",children:Br?"Processing...":"Upload New Draft"}),jsxRuntimeExports.jsx("button",{onClick:()=>Sr(!0),className:"p-2 text-red-500 active:opacity-70 transition-opacity touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),jsxRuntimeExports.jsx("button",{onClick:()=>{var Mr;return(Mr=wr.current)==null?void 0:Mr.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:lr,children:lr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})})]}):jsxRuntimeExports.jsx("button",{onClick:()=>{var Mr;return(Mr=wr.current)==null?void 0:Mr.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:lr,children:lr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),or&&jsxRuntimeExports.jsxs("div",{className:"px-4 pb-3 flex gap-1 bg-card",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Nr("breakdown"),className:`flex-1 py-2 text-xs font-medium rounded-lg transition-colors ${kr==="breakdown"?"gold-gradient text-white":"bg-gray-100 text-text-muted"}`,children:"Breakdown"}),jsxRuntimeExports.jsx("button",{onClick:()=>Nr("pdf"),className:`flex-1 py-2 text-xs font-medium rounded-lg transition-colors ${kr==="pdf"?"gold-gradient text-white":"bg-gray-100 text-text-muted"}`,children:"PDF"})]})]})}),jsxRuntimeExports.jsx("input",{ref:wr,type:"file",accept:".pdf",onChange:Yr,className:"hidden"}),jsxRuntimeExports.jsx("input",{ref:Rr,type:"file",accept:".pdf",onChange:es,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[cr&&jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:cr})}),gr&&jsxRuntimeExports.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:gr}),jsxRuntimeExports.jsx("button",{onClick:Hr,className:"mt-2 text-xs text-red-700 underline",children:"Retry Processing"})]}),or?kr==="pdf"?or.pdfUri?jsxRuntimeExports.jsx("iframe",{src:or.pdfUri,className:"w-full h-[calc(100vh-180px)] border-0 -mx-4 -mt-4",style:{width:"calc(100% + 2rem)"},title:"Schedule PDF"}):jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"PDF preview not available"})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[Er&&jsxRuntimeExports.jsxs("div",{className:"card p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin text-gold",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:vr.message||`Processing Day ${vr.current} of ${vr.total}...`}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"You can navigate away - processing continues in the background"})]})]}),vr.total>0&&jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:jsxRuntimeExports.jsx("div",{className:"gold-gradient h-2 rounded-full transition-all duration-300",style:{width:`${vr.current/vr.total*100}%`}})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Characters will be automatically confirmed once processing completes."})]}),Br&&jsxRuntimeExports.jsxs("div",{className:"card p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin text-gold",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:"Processing New Draft..."}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:vr.message||(vr.total>0?`Day ${vr.current} of ${vr.total}`:"Parsing schedule PDF")})]})]}),vr.total>0&&jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:jsxRuntimeExports.jsx("div",{className:"gold-gradient h-2 rounded-full transition-all duration-300",style:{width:`${vr.current/vr.total*100}%`}})})]}),!rs&&!Er&&!Br&&or&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gold/10 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsxs("svg",{className:"w-8 h-8 text-gold animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"Processing Schedule"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6 max-w-xs",children:or.totalDays>0?`Preparing to process ${or.totalDays} shooting day${or.totalDays!==1?"s":""}...`:"Starting schedule processing..."}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center max-w-xs",children:"Characters will be automatically synced to your breakdown once processing completes."})]}),rs&&or.days.map(Mr=>jsxRuntimeExports.jsxs("div",{className:"card overflow-hidden",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Tr(Cr===Mr.dayNumber?null:Mr.dayNumber),className:"w-full p-3 flex items-center justify-between text-left active:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:["Day ",Mr.dayNumber]}),Mr.date&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Mr.dayOfWeek?`${Mr.dayOfWeek}, `:"",Mr.date]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[Mr.location&&jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate",children:Mr.location}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-gold font-medium",children:[Mr.scenes.length," scene",Mr.scenes.length!==1?"s":""]}),Mr.totalPages&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Mr.totalPages," pages"]})]})]}),jsxRuntimeExports.jsx("svg",{className:`w-4 h-4 text-text-muted transition-transform flex-shrink-0 ${Cr===Mr.dayNumber?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),Cr===Mr.dayNumber&&jsxRuntimeExports.jsxs("div",{className:"border-t border-border",children:[Mr.notes&&Mr.notes.length>0&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 bg-amber-50 border-b border-border",children:Mr.notes.map((Dr,Lr)=>jsxRuntimeExports.jsx("span",{className:"text-xs text-amber-700 block",children:Dr},Lr))}),Mr.scenes.map((Dr,Lr)=>jsxRuntimeExports.jsx("div",{className:`px-3 py-2.5 ${Lr>0?"border-t border-border/50":""}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-gray-100 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted leading-none",children:"Sc"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-text-primary leading-tight",children:Dr.sceneNumber})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:`text-[10px] font-medium px-1 py-0.5 rounded ${Dr.intExt==="EXT"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:Dr.intExt}),jsxRuntimeExports.jsx("span",{className:`text-[10px] font-medium px-1 py-0.5 rounded ${Dr.dayNight.toLowerCase().includes("night")||Dr.dayNight.startsWith("N")?"bg-indigo-100 text-indigo-700":"bg-amber-100 text-amber-700"}`,children:Dr.dayNight}),Dr.pages&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-muted",children:[Dr.pages," pgs"]}),Dr.estimatedTime&&jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted ml-auto",children:Dr.estimatedTime})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-primary mt-0.5 truncate",children:Dr.setLocation}),Dr.description&&jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-muted mt-0.5 line-clamp-2",children:Dr.description}),Dr.castNumbers.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:jr(Dr.castNumbers).map((Fr,$r)=>jsxRuntimeExports.jsx("span",{className:"text-[10px] bg-gray-100 text-text-muted px-1.5 py-0.5 rounded",children:Fr},$r))})]})]})},`${Dr.sceneNumber}-${Lr}`)),Mr.scenes.length===0&&jsxRuntimeExports.jsx("div",{className:"px-3 py-4 text-center",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"No scenes extracted for this day"})})]})]},Mr.dayNumber))]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(NavIcon,{name:"schedule",className:"w-8 h-8 text-gray-300"})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Schedule Uploaded"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6 max-w-xs",children:"Upload your production schedule PDF to view it here"}),jsxRuntimeExports.jsx("button",{onClick:()=>{var Mr;return(Mr=wr.current)==null?void 0:Mr.click()},disabled:lr,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50 mb-6",children:lr?"Uploading...":"Upload Schedule PDF"}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4 max-w-xs",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-text-secondary",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Automatic Processing"}),jsxRuntimeExports.jsx("p",{children:"The schedule will process automatically in the background. Characters will be confirmed within a few minutes."})]})]})})]})]}),Ar&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 max-w-sm w-full",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-2",children:"Delete Schedule?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-4",children:"This will remove the schedule and all cross-reference data. You can upload a new schedule at any time."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Sr(!1),className:"flex-1 px-4 py-2.5 rounded-button text-sm font-medium text-text-primary bg-gray-100 active:bg-gray-200 transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Qr,className:"flex-1 px-4 py-2.5 rounded-button text-sm font-medium text-white bg-red-500 active:bg-red-600 transition-colors",children:"Delete"})]})]})}),Pr&&jsxRuntimeExports.jsx(ScheduleAmendmentModal,{amendmentResult:Pr,getCastNamesForNumbers:jr,onApply:ps,onCancel:ts})]})}function CallSheetArchive({onBack:ar}){const{callSheets:or,activeCallSheetId:lr,setActiveCallSheet:cr,uploadCallSheet:ur,deleteCallSheet:dr,isUploading:hr,uploadError:pr}=useCallSheetStore(),xr=reactExports.useRef(null),[mr,fr]=reactExports.useState(null),[Er,vr]=reactExports.useState(null),gr=async _r=>{var Rr;const wr=(Rr=_r.target.files)==null?void 0:Rr[0];if(wr&&wr.type==="application/pdf")try{await ur(wr)}catch(Ar){console.error("Failed to upload call sheet:",Ar)}xr.current&&(xr.current.value="")},yr=(_r,wr)=>{wr.stopPropagation(),cr(_r)},jr=_r=>{dr(_r),vr(null)},br=mr?or.find(_r=>_r.id===mr):null;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Call Sheets"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var _r;return(_r=xr.current)==null?void 0:_r.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:hr,children:hr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]})})}),jsxRuntimeExports.jsx("input",{ref:xr,type:"file",accept:".pdf",onChange:gr,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[pr&&jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:pr})}),or.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(NavIcon,{name:"document",className:"w-8 h-8 text-gray-300"})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Call Sheets"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload your daily call sheet PDFs to track scenes and times"}),jsxRuntimeExports.jsx("button",{onClick:()=>{var _r;return(_r=xr.current)==null?void 0:_r.click()},disabled:hr,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:hr?"Uploading...":"Upload Call Sheet PDF"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"space-y-2",children:or.map(_r=>jsxRuntimeExports.jsxs("div",{onClick:()=>fr(_r.id),className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${_r.id===lr?"bg-gold-100":"bg-gray-100"}`,children:jsxRuntimeExports.jsx(NavIcon,{name:"document",className:`w-5 h-5 ${_r.id===lr?"text-gold":"text-text-light"}`})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsxs("h3",{className:"text-sm font-semibold text-text-primary",children:["Day ",_r.productionDay,_r.totalProductionDays&&` of ${_r.totalProductionDays}`]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[formatShortDate(_r.date),"  ",_r.scenes.length," scene",_r.scenes.length!==1?"s":"",_r.unitCallTime&&`  Call: ${_r.unitCallTime}`]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[_r.id===lr?jsxRuntimeExports.jsx("span",{className:"px-2.5 py-1 text-[10px] font-medium rounded-full bg-green-100 text-green-600",children:"Active"}):jsxRuntimeExports.jsx("button",{onClick:wr=>yr(_r.id,wr),className:"px-2.5 py-1 text-[10px] font-medium rounded-full bg-gold-100 text-gold hover:bg-gold-200 transition-colors",children:"Set Active"}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]},_r.id))}),jsxRuntimeExports.jsx("div",{className:"mt-6 text-center",children:jsxRuntimeExports.jsx("button",{onClick:()=>{var _r;return(_r=xr.current)==null?void 0:_r.click()},disabled:hr,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:hr?"Uploading...":"Upload Call Sheet PDF"})})]})]}),br&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-black/90 flex flex-col",onClick:()=>fr(null),children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between safe-top",onClick:_r=>_r.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-base font-semibold text-text-primary",children:["Day ",br.productionDay," Call Sheet"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:formatShortDate(br.date)})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[Er===br.id?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>vr(null),className:"px-3 py-1.5 text-xs text-text-muted",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:()=>{jr(br.id),fr(null)},className:"px-3 py-1.5 text-xs bg-red-500 text-white rounded-lg",children:"Delete"})]}):jsxRuntimeExports.jsx("button",{onClick:()=>vr(br.id),className:"p-2 text-red-400 hover:text-red-500",title:"Delete call sheet",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}),jsxRuntimeExports.jsx("button",{onClick:()=>fr(null),className:"p-2 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-hidden",onClick:_r=>_r.stopPropagation(),children:br.pdfUri?jsxRuntimeExports.jsx("iframe",{src:br.pdfUri,className:"w-full h-full border-0",title:`Day ${br.productionDay} Call Sheet`}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"PDF Not Available"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"The original PDF for this call sheet was not saved."}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500",children:["Day ",br.productionDay,"  ",br.scenes.length," scenes  Unit call ",br.unitCallTime]})]})})]})]})}function ArchivedProjectsScreen({onBack:ar}){const{getArchivedProjects:or,loadArchivedProject:lr}=useProjectStore(),cr=or();return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Archived Projects"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:cr.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Archived Projects"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted",children:["Wrapped projects will appear here after ",PROJECT_RETENTION_DAYS," days."]})]}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:cr.map(ur=>jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary",children:ur.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[ur.scenesCount," scenes  ",ur.charactersCount," characters  ",ur.photosCount," photos"]})]}),jsxRuntimeExports.jsx("span",{className:`px-2 py-1 text-[10px] font-medium rounded-full ${ur.state==="wrapped"?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"}`,children:ur.state==="wrapped"?"Wrapped":"Archived"})]}),ur.wrappedAt&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-light mb-3",children:["Wrapped ",formatShortDate(new Date(ur.wrappedAt).toISOString().split("T")[0]),ur.daysUntilDeletion>0&&`  ${ur.daysUntilDeletion} days until deletion`]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>lr(ur.id),className:"flex-1 px-3 py-2 text-sm font-medium rounded-button bg-gold/10 text-gold active:scale-[0.98] transition-transform",children:"Restore Project"}),jsxRuntimeExports.jsx("button",{className:"px-3 py-2 text-sm font-medium rounded-button bg-gray-100 text-text-secondary active:scale-[0.98] transition-transform",children:"Export"})]})]},ur.id))})})]})}function WrapPopupModal({onExport:ar}){const{currentProject:or,showWrapPopup:lr,wrapTriggerReason:cr,lifecycle:ur,wrapProject:dr,dismissWrapPopup:hr}=useProjectStore();if(!lr||!or)return null;const pr=()=>{if(ur.state==="wrapped"&&ur.deletionDate)return new Date(ur.deletionDate).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});const Er=new Date;return Er.setDate(Er.getDate()+PROJECT_RETENTION_DAYS),Er.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})},xr=()=>{switch(cr){case"all_scenes_complete":return`All scenes for "${or.name}" are marked complete.`;case"inactivity":return`"${or.name}" has been inactive for 30 days.`;case"manual":return`"${or.name}" has been marked as wrapped.`;default:return`"${or.name}" is ready to be wrapped.`}},mr=()=>{ur.state==="active"&&cr&&dr(cr),ar()},fr=()=>{ur.state==="active"&&cr&&dr(cr),hr(!0)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"pt-8 pb-4 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.875 1.875 0 0118 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0118 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 016 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-text-primary mb-1",children:"That's a Wrap!"})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-6",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary text-center mb-4",children:xr()}),jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-amber-800",children:["Your project will be stored for ",PROJECT_RETENTION_DAYS," days in case of pickups, then automatically deleted."]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-900 font-medium mt-2",children:"Export your continuity documents now to keep a permanent backup."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:mr,className:"w-full py-3.5 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Export Documents"]}),jsxRuntimeExports.jsx("button",{onClick:fr,className:"w-full py-3 rounded-button bg-gray-100 text-text-secondary font-medium text-base active:scale-[0.98] transition-transform",children:"Remind Me Later"})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-light text-center mt-4",children:["Project deletion: ",pr()]})]})]})})}function LifecycleBanner({onExport:ar}){const{lifecycle:or,getLifecycleBanner:lr,restoreProject:cr}=useProjectStore(),ur=lr();if(!(ur!=null&&ur.show))return null;const dr=or.state==="wrapped",hr=or.state==="archived";return jsxRuntimeExports.jsx("div",{className:`${hr?"bg-red-50 border-b border-red-200":"bg-amber-50 border-b border-amber-200"}`,children:jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-2",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[hr?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-red-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsx("span",{className:`text-xs font-medium truncate ${hr?"text-red-800":"text-amber-800"}`,children:ur.message})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[dr&&jsxRuntimeExports.jsx("button",{onClick:cr,className:"text-xs font-medium text-amber-700 hover:text-amber-900",children:"Restore"}),jsxRuntimeExports.jsx("button",{onClick:ar,className:`px-2 py-1 text-[10px] font-semibold rounded ${hr?"bg-red-600 text-white":"bg-amber-600 text-white"}`,children:"Export"})]})]})})})}function Home({onProjectReady:ar,onBack:or}){const[lr,cr]=reactExports.useState("upload"),[ur,dr]=reactExports.useState(""),[hr,pr]=reactExports.useState(null),[xr,mr]=reactExports.useState(null),[,fr]=reactExports.useState(null),[Er,vr]=reactExports.useState(0),[gr,yr]=reactExports.useState("Reading document..."),[jr,br]=reactExports.useState(null),[_r,wr]=reactExports.useState(new Set),[Rr,Ar]=reactExports.useState(new Map),Sr=reactExports.useRef(null),kr=reactExports.useRef(null),{setProject:Nr,setScriptPdf:Cr,currentProject:Tr}=useProjectStore(),{setSchedule:Pr}=useScheduleStore(),Ir=reactExports.useCallback(async(rs,Mr)=>{var Dr;try{vr(10),yr("Reading script..."),await new Promise(ls=>setTimeout(ls,200));let Lr=null;if(Mr){vr(15),yr("Processing schedule...");try{Lr=(await parseScheduleStage1(Mr)).schedule,fr(Lr),Pr(Lr),console.log(`Schedule parsed: ${Lr.castList.length} cast members identified`),Lr.castList.length===0?console.warn("Schedule uploaded but no cast members extracted - character detection will use script regex fallback"):console.log("Cast list:",Lr.castList.map(ds=>`${ds.number}.${ds.name}`).join(", "))}catch(ls){console.warn("Schedule parsing failed, continuing without:",ls)}}vr(30),yr("Detecting scenes...");const Fr=await parseScenesFast(rs);vr(70),yr("Creating project..."),await new Promise(ls=>setTimeout(ls,100));const $r=Fr.scenes.map(ls=>({id:`scene-${ls.sceneNumber}`,sceneNumber:ls.sceneNumber,slugline:ls.slugline,intExt:ls.intExt,timeOfDay:ls.timeOfDay,scriptContent:ls.scriptContent,characters:[],isComplete:!1,characterConfirmationStatus:"pending",suggestedCharacters:void 0,shootingDay:void 0})),Vr=(Tr==null?void 0:Tr.id)||`project-${Date.now()}`,Gr=ur||(Tr==null?void 0:Tr.name)||Fr.title||rs.name.replace(/\.[^/.]+$/,"").replace(/[-_]/g," ")||"Untitled Project",Jr={id:Vr,name:Gr,createdAt:(Tr==null?void 0:Tr.createdAt)||new Date,updatedAt:new Date,scenes:$r,characters:(Tr==null?void 0:Tr.characters)||[],looks:(Tr==null?void 0:Tr.looks)||[],characterDetectionStatus:"idle",scenesConfirmed:0};if(vr(90),yr("Almost done..."),await new Promise(ls=>setTimeout(ls,200)),vr(100),yr("Complete!"),Jr._rawText=Fr.rawText,Lr&&(Jr._scheduleCastList=Lr.castList),Nr(Jr),rs.type==="application/pdf"){const ls=new FileReader;ls.onload=()=>{const ds=ls.result;Cr(ds)},ls.readAsDataURL(rs)}const ms=((Dr=Lr==null?void 0:Lr.castList)==null?void 0:Dr.map(ls=>ls.name))||[];setTimeout(()=>{Br(Jr,Fr.rawText,ms)},500),setTimeout(()=>ar(),500)}catch(Lr){console.error("Script parsing error:",Lr),alert(Lr instanceof Error?Lr.message:"Failed to parse script"),cr("upload")}},[ur,Nr,Cr,Pr,ar,Tr]),Br=reactExports.useCallback(async(rs,Mr,Dr=[])=>{var Lr;try{useProjectStore.getState().startCharacterDetection();const Fr=rs.scenes.map(Jr=>({sceneNumber:Jr.sceneNumber,scriptContent:Jr.scriptContent||""}));console.log(`Starting character detection for ${Fr.length} scenes`),Dr.length>0&&console.log(`Using ${Dr.length} known characters from schedule:`,Dr);const $r=await detectCharactersForScenesBatch(Fr,Mr,{useAI:!1,knownCharacters:Dr.length>0?Dr:void 0,onProgress:(Jr,ms)=>{console.log(`Character detection: ${Jr}/${ms}`)}}),Vr=useProjectStore.getState(),Gr=((Lr=Vr.currentProject)==null?void 0:Lr.scenes)||rs.scenes;$r.forEach((Jr,ms)=>{const ls=Gr.find(ds=>ds.sceneNumber===ms);ls&&Vr.updateSceneSuggestedCharacters(ls.id,Jr)}),Vr.setCharacterDetectionStatus("complete")}catch(Fr){console.error("Background character detection failed:",Fr),useProjectStore.getState().setCharacterDetectionStatus("complete")}},[]),Wr=reactExports.useCallback(async(rs,Mr)=>Ir(rs,Mr),[Ir]),Yr=rs=>{var Dr;const Mr=(Dr=rs.target.files)==null?void 0:Dr[0];if(Mr){pr(Mr);const Lr=Mr.name.replace(/\.[^/.]+$/,"").replace(/[-_]/g," ");dr(Lr)}},es=rs=>{var Dr;const Mr=(Dr=rs.target.files)==null?void 0:Dr[0];Mr&&mr(Mr)},ps=()=>{hr&&(cr("processing"),Wr(hr,xr))},ts=()=>{if(!jr){const Gr={id:`project-${Date.now()}`,name:ur||"Untitled Project",createdAt:new Date,updatedAt:new Date,scenes:[],characters:[],looks:[]};Nr(Gr),ar();return}const rs=Array.from(_r).filter(Gr=>!Rr.has(Gr)),{scenes:Mr,characters:Dr}=convertParsedScriptToProject(jr,rs),Lr=Dr.map(Gr=>({id:`look-${Gr.id}`,characterId:Gr.id,name:"Look 1",scenes:Mr.filter(Jr=>Jr.characters.includes(Gr.id)).map(Jr=>Jr.sceneNumber),estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()})),Fr=(Tr==null?void 0:Tr.id)||`project-${Date.now()}`,$r=ur||(Tr==null?void 0:Tr.name)||jr.title||"Untitled Project",Vr={id:Fr,name:$r,createdAt:(Tr==null?void 0:Tr.createdAt)||new Date,updatedAt:new Date,scenes:Mr,characters:Dr,looks:Lr};Nr(Vr),ar()},Qr=()=>{br(null),wr(new Set),cr("setup")},Hr=rs=>{wr(Mr=>{const Dr=new Set(Mr);return Dr.has(rs)?Dr.delete(rs):Dr.add(rs),Dr})},Kr=(rs,Mr)=>{Ar(Dr=>{const Lr=new Map(Dr);return rs===Mr?Lr.delete(rs):Lr.set(rs,Mr),Lr}),wr(Dr=>{const Lr=new Set(Dr);return Lr.add(Mr),Lr})};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background safe-top safe-bottom",children:[lr==="upload"&&jsxRuntimeExports.jsx(UploadScreen,{fileInputRef:Sr,scheduleInputRef:kr,uploadedFile:hr,uploadedScheduleFile:xr,onBack:or,onSkip:Qr,onStartWithFiles:ps}),lr==="processing"&&jsxRuntimeExports.jsx(ProcessingScreen,{fileName:(hr==null?void 0:hr.name)||"",progress:Er,status:gr}),lr==="characters"&&jr&&jsxRuntimeExports.jsx(CharacterSelectionScreen,{parsedScript:jr,selectedCharacters:_r,mergeMap:Rr,onToggleCharacter:Hr,onMergeCharacter:Kr,onContinue:()=>cr("setup"),onBack:()=>cr("upload")}),lr==="setup"&&jsxRuntimeExports.jsx(SetupScreen,{projectName:ur,onNameChange:dr,detectedScenes:(jr==null?void 0:jr.scenes.length)||0,detectedCharacters:Array.from(_r).filter(rs=>!Rr.has(rs)),onStart:ts,onBack:()=>cr(jr?"characters":"upload")}),jsxRuntimeExports.jsx("input",{ref:Sr,type:"file",accept:".pdf,.fdx,.fountain,.txt",onChange:Yr,className:"hidden"}),jsxRuntimeExports.jsx("input",{ref:kr,type:"file",accept:".pdf",onChange:es,className:"hidden"})]})}function UploadScreen({fileInputRef:ar,scheduleInputRef:or,uploadedFile:lr,uploadedScheduleFile:cr,onBack:ur,onSkip:dr,onStartWithFiles:hr}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 flex items-center gap-3 border-b border-border",children:[ur&&jsxRuntimeExports.jsx("button",{onClick:ur,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Upload Files"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Script"}),jsxRuntimeExports.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gold/10 text-gold",children:"Required"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var pr;return(pr=ar.current)==null?void 0:pr.click()},className:`w-full rounded-2xl border-2 border-dashed transition-colors p-6 ${lr?"border-green-400 bg-green-50":"border-gold/40 bg-gold/5 active:bg-gold/10"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${lr?"bg-green-100":"bg-gold/10"}`,children:lr?jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 text-left",children:lr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-green-700 truncate",children:lr.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600",children:"Tap to change"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Tap to upload script"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"PDF, Final Draft, or Fountain"})]})})]})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Production Schedule"}),jsxRuntimeExports.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-100 text-text-muted",children:"Optional"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var pr;return(pr=or.current)==null?void 0:pr.click()},className:`w-full rounded-2xl border-2 border-dashed transition-colors p-6 ${cr?"border-green-400 bg-green-50":"border-gray-300 bg-gray-50 active:bg-gray-100"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${cr?"bg-green-100":"bg-gray-100"}`,children:cr?jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 text-left",children:cr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-green-700 truncate",children:cr.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600",children:"Tap to change"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-secondary",children:"Tap to upload schedule"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"PDF (strips, one-liner)"})]})})]})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-2 px-2",children:"Uploading a schedule gives you accurate character assignments per scene and shooting day info"})]}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-blue-50 border border-blue-100 p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-blue-700",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Faster with Schedule"}),jsxRuntimeExports.jsx("p",{children:"The schedule contains the official cast list with character numbers. This allows instant, accurate character detection per scene without AI processing."})]})]})}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-text-secondary",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Background Processing"}),jsxRuntimeExports.jsx("p",{children:"The schedule will process automatically in the background. Character assignments will be confirmed within a few minutes - you can start using the app right away."})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-8 pt-4 border-t border-border space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:hr,disabled:!lr,className:"w-full py-4 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50 disabled:active:scale-100",children:lr?"Start Processing":"Upload a script to continue"}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"py-3 text-sm text-text-muted font-medium active:text-gold transition-colors",children:"Skip - add manually"})]})]})}function ProcessingScreen({fileName:ar,progress:or,status:lr}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen items-center justify-center px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gold/10 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gold animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary mb-2",children:"Processing Script"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-6 truncate max-w-full",children:ar}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-xs",children:[jsxRuntimeExports.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden mb-2",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gold rounded-full transition-all duration-300",style:{width:`${or}%`}})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light text-center mb-4",children:lr}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center leading-relaxed",children:"Detecting scenes in your script. You'll be able to confirm characters scene-by-scene."})]})]})}function CharacterSelectionScreen({parsedScript:ar,selectedCharacters:or,mergeMap:lr,onToggleCharacter:cr,onMergeCharacter:ur,onContinue:dr,onBack:hr}){const[pr,xr]=reactExports.useState(!1),[mr,fr]=reactExports.useState(null),Er=[...ar.characters].sort((gr,yr)=>yr.sceneCount-gr.sceneCount),vr=gr=>{fr(gr),xr(!0)};return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 flex items-center gap-3 border-b border-border",children:[jsxRuntimeExports.jsx("button",{onClick:hr,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Select Characters"})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-4 bg-gold/5 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-around text-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gold",children:ar.scenes.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Scenes"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gold",children:ar.characters.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Characters Found"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gold",children:or.size-lr.size}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Selected"})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 py-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Select the characters you want to track. Tap the merge icon to combine similar characters."})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:Er.map(gr=>{const yr=or.has(gr.name),jr=lr.get(gr.name),br=!!jr;return jsxRuntimeExports.jsx("div",{className:`rounded-xl border transition-all ${br?"border-gray-200 bg-gray-50 opacity-60":yr?"border-gold bg-gold/5":"border-border bg-card"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 p-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>!br&&cr(gr.name),disabled:br,className:`w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all ${br?"border-gray-300 bg-gray-200":yr?"border-gold bg-gold":"border-gray-300"}`,children:(yr||br)&&jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`font-medium truncate ${br?"text-text-muted line-through":"text-text-primary"}`,children:gr.name}),br&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[" ",jr]})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[gr.sceneCount," scene",gr.sceneCount!==1?"s":"",gr.variants.length>1&&`  ${gr.variants.length} variants`]})]}),!br&&jsxRuntimeExports.jsx("button",{onClick:()=>vr(gr.name),className:"p-2 text-text-muted hover:text-gold transition-colors",title:"Merge with another character",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 16.875h3.375m0 0h3.375m-3.375 0V13.5m0 3.375v3.375M6 10.5h2.25a2.25 2.25 0 002.25-2.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v2.25A2.25 2.25 0 006 10.5zm0 9.75h2.25A2.25 2.25 0 0010.5 18v-2.25a2.25 2.25 0 00-2.25-2.25H6a2.25 2.25 0 00-2.25 2.25V18A2.25 2.25 0 006 20.25zm9.75-9.75H18a2.25 2.25 0 002.25-2.25V6A2.25 2.25 0 0018 3.75h-2.25A2.25 2.25 0 0013.5 6v2.25a2.25 2.25 0 002.25 2.25z"})})})]})},gr.name)})})}),jsxRuntimeExports.jsx("div",{className:"px-6 pb-8 pt-4 border-t border-border",children:jsxRuntimeExports.jsxs("button",{onClick:dr,disabled:or.size-lr.size===0,className:"w-full py-4 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50",children:["Continue with ",or.size-lr.size," Character",or.size-lr.size!==1?"s":""]})}),pr&&mr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[70vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 border-b border-border flex items-center justify-between",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-semibold text-text-primary",children:['Merge "',mr,'" into...']}),jsxRuntimeExports.jsx("button",{onClick:()=>xr(!1),className:"p-2 text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[lr.has(mr)&&jsxRuntimeExports.jsxs("button",{onClick:()=>{ur(mr,mr),xr(!1)},className:"w-full p-3 text-left rounded-lg border border-red-200 bg-red-50 text-red-700",children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Remove merge"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-red-500 block",children:"Keep as separate character"})]}),Er.filter(gr=>gr.name!==mr&&!lr.has(gr.name)).map(gr=>jsxRuntimeExports.jsxs("button",{onClick:()=>{ur(mr,gr.name),xr(!1)},className:"w-full p-3 text-left rounded-lg border border-border bg-card hover:border-gold transition-colors",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:gr.name}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:[gr.sceneCount," scenes"]})]},gr.name))]})})]})})]})}function SetupScreen({projectName:ar,onNameChange:or,detectedScenes:lr,detectedCharacters:cr,onStart:ur,onBack:dr}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 flex items-center gap-3 border-b border-border",children:[jsxRuntimeExports.jsx("button",{onClick:dr,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Setup"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 py-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Project Name"}),jsxRuntimeExports.jsx("input",{type:"text",value:ar,onChange:hr=>or(hr.target.value),placeholder:"Enter project name",className:"input-field w-full text-base"})]}),(lr>0||cr.length>0)&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"DETECTED FROM SCRIPT"}),lr>0&&jsxRuntimeExports.jsxs("div",{className:"card flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.875 1.875 0 0118 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0118 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 016 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Scenes"})]}),jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-gold",children:lr})]}),cr.length>0&&jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Characters"}),jsxRuntimeExports.jsx("span",{className:"ml-auto text-lg font-bold text-gold",children:cr.length})]}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:cr.map(hr=>jsxRuntimeExports.jsx("span",{className:"px-3 py-1 text-xs font-medium rounded-full bg-gray-100 text-text-secondary",children:hr},hr))})]})]}),lr===0&&cr.length===0&&jsxRuntimeExports.jsxs("div",{className:"card text-center py-8",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-2",children:"No script uploaded"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light",children:"You can add scenes and characters manually after setup"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 pb-8",children:jsxRuntimeExports.jsx("button",{onClick:ur,disabled:!ar.trim(),className:"w-full py-4 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50 disabled:active:scale-100",children:"Start Project"})})]})}const API_ENDPOINT="/api/ai",SYSTEM_PROMPT=`You are Claude, an AI assistant specialized in film and television hair, makeup, and continuity production. You're helping a hair and makeup professional manage their work on set.

You have access to their project data including:
- Characters and their looks
- Scene breakdowns with H&MU requirements
- Continuity tracking and events
- Timesheet and hours data
- Budget information

Be helpful, concise, and production-focused. Use industry terminology appropriately. When discussing looks or continuity, be specific about products, techniques, and timing.

Keep responses focused and practical - these users are often on set and need quick, actionable information.`,useChatStore=create()(persist((ar,or)=>({messages:[],isOpen:!1,isLoading:!1,error:null,toggleChat:()=>ar(lr=>({isOpen:!lr.isOpen})),openChat:()=>ar({isOpen:!0}),closeChat:()=>ar({isOpen:!1}),addMessage:(lr,cr)=>{const ur={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,role:lr,content:cr,timestamp:new Date};ar(dr=>({messages:[...dr.messages.slice(-49),ur]}))},clearMessages:()=>ar({messages:[],error:null}),setLoading:lr=>ar({isLoading:lr}),setError:lr=>ar({error:lr}),sendMessage:async(lr,cr)=>{var pr,xr;const{addMessage:ur,setLoading:dr,setError:hr}=or();ur("user",lr),dr(!0),hr(null);try{const mr=or().messages.slice(-10).map(yr=>({role:yr.role,content:yr.content})),fr=`${SYSTEM_PROMPT}

Current Project Context:
${cr}`,Er=await fetch(API_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:mr,system:fr,maxTokens:1024,model:"claude-sonnet-4-20250514"})});if(!Er.ok){const yr=await Er.json().catch(()=>({}));throw new Error(yr.error||`API error: ${Er.status}`)}const vr=await Er.json(),gr=((xr=(pr=vr.content)==null?void 0:pr[0])==null?void 0:xr.text)||vr.completion||"Sorry, I could not generate a response.";ur("assistant",gr)}catch(mr){const fr=mr instanceof Error?mr.message:"Failed to send message";hr(fr),ur("assistant",`Sorry, I encountered an error: ${fr}`)}finally{dr(!1)}}}),{name:"hair-makeup-chat-storage",storage:createJSONStorage(()=>localStorage),partialize:ar=>({messages:ar.messages.slice(-50)})})),SUGGESTIONS=[{label:"Character overview",prompt:"Give me an overview of all characters and their looks in this project"},{label:"Continuity tracking",prompt:"What continuity events should I track across scenes?"},{label:"Complex H&MU scenes",prompt:"Which scenes have the most complex hair and makeup requirements?"}];function ChatAssistant(){const{messages:ar,isOpen:or,isLoading:lr,error:cr,toggleChat:ur,closeChat:dr,sendMessage:hr,clearMessages:pr}=useChatStore(),[xr,mr]=reactExports.useState(""),fr=reactExports.useRef(null),Er=reactExports.useRef(null);reactExports.useEffect(()=>{or&&fr.current&&fr.current.scrollIntoView({behavior:"smooth"})},[ar,or]),reactExports.useEffect(()=>{or&&Er.current&&Er.current.focus()},[or]);const vr=()=>{const wr=useProjectStore.getState(),Rr=useTimesheetStore.getState(),Ar=[];if(wr.currentProject){const kr=wr.currentProject;Ar.push(`Project: ${kr.name}`),Ar.push(`Characters: ${kr.characters.length}`),Ar.push(`Scenes: ${kr.scenes.length}`),Ar.push(`Looks: ${kr.looks.length}`),kr.characters.length>0&&(Ar.push(`
Characters:`),kr.characters.slice(0,10).forEach(Cr=>{const Tr=kr.looks.filter(Pr=>Pr.characterId===Cr.id);Ar.push(`- ${Cr.name} (${Cr.initials}): ${Tr.length} looks`)}));const Nr=kr.scenes.filter(Cr=>Cr.isComplete).length;Ar.push(`
Scenes: ${Nr}/${kr.scenes.length} complete`)}const Sr=Object.values(Rr.entries);if(Sr.length>0){const kr=Sr.reduce((Nr,Cr)=>{const Tr=Rr.calculateEntry(Cr);return Nr+Tr.totalHours},0);Ar.push(`
Timesheet: ${Sr.length} days logged, ${kr.toFixed(1)} total hours`)}return Ar.join(`
`)||"No project data available yet."},gr=async()=>{const wr=xr.trim();if(!wr||lr)return;mr("");const Rr=vr();await hr(wr,Rr)},yr=wr=>{mr(wr);const Rr=vr();hr(wr,Rr)},jr=wr=>{wr.key==="Enter"&&!wr.shiftKey&&(wr.preventDefault(),gr())},br=wr=>wr.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,'<code class="bg-black/20 px-1 rounded text-sm">$1</code>').replace(/\n/g,"<br />"),_r=ar.length>0;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:ur,className:`fixed bottom-24 right-4 z-50 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all active:scale-95 ${or?"gold-gradient rotate-0":"gold-gradient"}`,style:{boxShadow:"0 4px 20px rgba(201, 169, 97, 0.4)"},"aria-label":or?"Close chat":"Open chat assistant",children:or?jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),or&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-30 flex flex-col",style:{backgroundColor:"var(--color-background)"},children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",style:{backgroundColor:"var(--color-card)",borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-success animate-pulse"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:"Claude Assistant"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:pr,className:"p-2 rounded-lg transition-colors",style:{color:"var(--color-text-muted)"},title:"Clear chat",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"p-2 rounded-lg transition-colors",style:{color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:_r?jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[ar.map(wr=>jsxRuntimeExports.jsx("div",{className:`flex ${wr.role==="user"?"justify-end":"justify-start"}`,children:jsxRuntimeExports.jsx("div",{className:`max-w-[85%] rounded-2xl px-4 py-3 ${wr.role==="user"?"gold-gradient text-white rounded-br-sm":"rounded-bl-sm"}`,style:wr.role==="assistant"?{backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"}:void 0,children:jsxRuntimeExports.jsx("div",{className:"text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:br(wr.content)}})})},wr.id)),lr&&jsxRuntimeExports.jsx("div",{className:"flex justify-start",children:jsxRuntimeExports.jsx("div",{className:"rounded-2xl rounded-bl-sm px-4 py-3",style:{backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsxs("div",{className:"flex gap-1",children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"var(--color-text-muted)",animationDelay:"0ms"}}),jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"var(--color-text-muted)",animationDelay:"150ms"}}),jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"var(--color-text-muted)",animationDelay:"300ms"}})]})})}),cr&&jsxRuntimeExports.jsx("div",{className:"text-center py-2",children:jsxRuntimeExports.jsx("span",{className:"text-sm text-error",children:cr})}),jsxRuntimeExports.jsx("div",{ref:fr})]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4",children:[jsxRuntimeExports.jsx("div",{className:"text-5xl mb-4",children:""}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--color-text-primary)"},children:"Project Assistant"}),jsxRuntimeExports.jsx("p",{className:"text-sm mb-6",style:{color:"var(--color-text-muted)"},children:"I have access to your project data including characters, looks, scenes, and timesheets. How can I help?"}),jsxRuntimeExports.jsx("div",{className:"space-y-2 w-full max-w-sm",children:SUGGESTIONS.map((wr,Rr)=>jsxRuntimeExports.jsx("button",{onClick:()=>yr(wr.prompt),className:"w-full p-3 rounded-card text-left transition-all active:scale-[0.98]",style:{backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:wr.label})},Rr))})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 pt-3 pb-24",style:{backgroundColor:"var(--color-card)",borderTop:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsxs("div",{className:"flex items-end gap-2",children:[jsxRuntimeExports.jsx("textarea",{ref:Er,value:xr,onChange:wr=>mr(wr.target.value),onKeyDown:jr,placeholder:"Ask about your project...",rows:1,className:"flex-1 input-field resize-none max-h-32",style:{minHeight:"44px"},disabled:lr}),jsxRuntimeExports.jsx("button",{onClick:gr,disabled:!xr.trim()||lr,className:"p-3 rounded-button gold-gradient text-white disabled:opacity-50 transition-all active:scale-95",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]})]})}class ErrorBoundary extends reactExports.Component{constructor(lr){super(lr);io(this,"handleTryAgain",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});io(this,"handleReload",()=>{window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(lr){return{hasError:!0,error:lr}}componentDidCatch(lr,cr){console.error("ErrorBoundary caught an error:",lr,cr),this.setState({errorInfo:cr})}render(){return this.state.hasError?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md w-full text-center",children:[jsxRuntimeExports.jsx("div",{className:"mx-auto w-16 h-16 mb-6 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold text-text-primary mb-2",children:"Something went wrong"}),jsxRuntimeExports.jsx("p",{className:"text-text-muted mb-6",children:"The app encountered an unexpected error. Please try again or reload the page."}),!1,jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:this.handleTryAgain,className:"w-full py-3 px-4 rounded-button gold-gradient text-white font-semibold shadow-md active:scale-[0.98] transition-transform",children:"Try Again"}),jsxRuntimeExports.jsx("button",{onClick:this.handleReload,className:"w-full py-3 px-4 rounded-button bg-card border border-border text-text-primary font-medium hover:bg-background-secondary transition-colors",children:"Reload Page"})]})]})}):this.props.children}}const logoTick="/mobile/logo-tick.png";function WelcomeScreen(){const{setScreen:ar}=useAuthStore();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col",style:{background:"linear-gradient(180deg, #fffdfb 0%, #fefcfb 30%, #faf6f0 70%, #f5efe5 100%)"},children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-8",children:[jsxRuntimeExports.jsx("img",{src:logoTick,alt:"Checks Happy Logo",className:"w-32 h-32 mb-3 object-contain",style:{maskImage:"radial-gradient(ellipse 70% 70% at center, black 50%, transparent 100%)",WebkitMaskImage:"radial-gradient(ellipse 70% 70% at center, black 50%, transparent 100%)"}}),jsxRuntimeExports.jsx("h1",{className:"text-[34px] font-serif font-medium tracking-wide text-[#1a1a1a]",children:"CHECKS HAPPY"}),jsxRuntimeExports.jsxs("svg",{width:"280",height:"10",viewBox:"0 0 280 10",className:"mt-3 mb-8",children:[jsxRuntimeExports.jsx("defs",{children:jsxRuntimeExports.jsxs("linearGradient",{id:"underlineGold",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[jsxRuntimeExports.jsx("stop",{offset:"0%",stopColor:"#C9A962",stopOpacity:"0.3"}),jsxRuntimeExports.jsx("stop",{offset:"10%",stopColor:"#C9A962"}),jsxRuntimeExports.jsx("stop",{offset:"50%",stopColor:"#D4B86A"}),jsxRuntimeExports.jsx("stop",{offset:"90%",stopColor:"#C9A962"}),jsxRuntimeExports.jsx("stop",{offset:"100%",stopColor:"#C9A962",stopOpacity:"0.3"})]})}),jsxRuntimeExports.jsx("path",{d:`M 0 5
               Q 40 5, 70 4.25
               Q 100 3.5, 140 3
               Q 180 3.5, 210 4.25
               Q 240 5, 280 5
               Q 240 5, 210 5.75
               Q 180 6.5, 140 7
               Q 100 6.5, 70 5.75
               Q 40 5, 0 5
               Z`,fill:"url(#underlineGold)"})]}),jsxRuntimeExports.jsx("p",{className:"text-lg text-[#4a4a4a] mb-10",children:"Your personal onset assistant"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center w-full max-w-md mb-12",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center flex-1",children:[jsxRuntimeExports.jsxs("svg",{className:"w-14 h-14 mb-3",viewBox:"0 0 56 56",fill:"none",children:[jsxRuntimeExports.jsx("path",{d:"M4 18C4 15.79 5.79 14 8 14H14L18 8H38L42 14H48C50.21 14 52 15.79 52 18V44C52 46.21 50.21 48 48 48H8C5.79 48 4 46.21 4 44V18Z",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("circle",{cx:"28",cy:"30",r:"10",fill:"#fefcfb"}),jsxRuntimeExports.jsx("circle",{cx:"28",cy:"30",r:"5",fill:"#1a1a1a"})]}),jsxRuntimeExports.jsx("span",{className:"text-base font-serif text-[#1a1a1a]",children:"Capture"})]}),jsxRuntimeExports.jsx("div",{className:"w-px h-24 bg-[#c5c0b5]"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center flex-1",children:[jsxRuntimeExports.jsxs("svg",{className:"w-14 h-14 mb-3",viewBox:"0 0 56 56",fill:"none",children:[jsxRuntimeExports.jsx("path",{d:"M28 8C16.954 8 8 16.954 8 28c0 4.5 1.5 8.6 4 12",stroke:"#1a1a1a",strokeWidth:"4",strokeLinecap:"round",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M28 48c11.046 0 20-8.954 20-20 0-4.5-1.5-8.6-4-12",stroke:"#1a1a1a",strokeWidth:"4",strokeLinecap:"round",fill:"none"}),jsxRuntimeExports.jsx("polygon",{points:"4,36 14,44 16,32",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("polygon",{points:"52,20 42,12 40,24",fill:"#1a1a1a"})]}),jsxRuntimeExports.jsx("span",{className:"text-base font-serif text-[#1a1a1a]",children:"Track"})]}),jsxRuntimeExports.jsx("div",{className:"w-px h-24 bg-[#c5c0b5]"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center flex-1",children:[jsxRuntimeExports.jsxs("svg",{className:"w-14 h-14 mb-3",viewBox:"0 0 56 56",fill:"none",children:[jsxRuntimeExports.jsx("circle",{cx:"28",cy:"14",r:"8",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("path",{d:"M14 48v-10c0-7.732 6.268-14 14-14s14 6.268 14 14v10",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("circle",{cx:"10",cy:"20",r:"6",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("path",{d:"M0 48v-8c0-5.523 4.477-10 10-10 2.5 0 4.8.9 6.5 2.4",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("circle",{cx:"46",cy:"20",r:"6",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("path",{d:"M56 48v-8c0-5.523-4.477-10-10-10-2.5 0-4.8.9-6.5 2.4",fill:"#1a1a1a"})]}),jsxRuntimeExports.jsx("span",{className:"text-base font-serif text-[#1a1a1a]",children:"Collaborate"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-8 pb-10 space-y-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ar("signin"),className:`w-full h-14 rounded font-semibold text-lg transition-all duration-200
            bg-gradient-to-b from-[#E2C87D] via-[#C9A962] to-[#A8893D] text-white active:scale-[0.98] shadow-md`,children:"Sign In"}),jsxRuntimeExports.jsx("button",{onClick:()=>ar("signup"),className:`w-full h-14 rounded font-semibold text-lg transition-all duration-200
            border border-[#1a1a1a] text-[#1a1a1a] bg-[#fefcfb] active:scale-[0.98]`,children:"Create Account"}),jsxRuntimeExports.jsxs("div",{className:"pt-8 flex items-center justify-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-[#c5c0b5]"}),jsxRuntimeExports.jsx("button",{className:"text-sm text-[#7a7a7a] hover:text-[#4a4a4a] transition-colors whitespace-nowrap",onClick:()=>ar("join"),children:"Join with Project Code"}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-[#c5c0b5]"})]})]})]})}function SignInScreen(){const{setScreen:ar,goBack:or,signIn:lr,isLoading:cr,error:ur,clearError:dr}=useAuthStore(),[hr,pr]=reactExports.useState(""),[xr,mr]=reactExports.useState(""),[fr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(!1),[yr,jr]=reactExports.useState(!1),[br,_r]=reactExports.useState(null),wr=async Ar=>{Ar.preventDefault(),dr(),hr.trim()&&xr&&await lr(hr.trim(),xr)},Rr=hr.trim()&&xr;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Welcome back"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Sign in to access your projects"}),jsxRuntimeExports.jsxs("form",{onSubmit:wr,className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{type:"email",label:"Email",placeholder:"your@email.com",value:hr,onChange:Ar=>pr(Ar.target.value),autoComplete:"email",autoCapitalize:"none",disabled:cr}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{type:fr?"text":"password",label:"Password",placeholder:"Enter your password",value:xr,onChange:Ar=>mr(Ar.target.value),autoComplete:"current-password",disabled:cr}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Er(!fr),className:"absolute right-3 top-8 text-text-muted hover:text-text-secondary",tabIndex:-1,children:fr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"}),jsxRuntimeExports.jsx("path",{d:"M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"}),jsxRuntimeExports.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),(ur||br)&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:ur||br})}),jsxRuntimeExports.jsx("div",{className:"text-right",children:jsxRuntimeExports.jsx("button",{type:"button",className:"text-sm text-gold hover:underline",disabled:yr,onClick:async()=>{if(!hr.trim()){_r('Enter your email address first, then tap "Forgot password?"');return}jr(!0),gr(!1),_r(null),dr();const{error:Ar}=await resetPassword(hr.trim());jr(!1),Ar?_r(Ar.message):gr(!0)},children:yr?"Sending...":"Forgot password?"})}),vr&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-700",children:["Password reset link sent to ",hr,". Check your inbox."]})}),jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,size:"lg",disabled:!Rr||cr,children:cr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Signing in..."]}):"Sign In"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-6 pb-safe-bottom text-center",children:jsxRuntimeExports.jsxs("p",{className:"text-text-secondary",children:["Don't have an account?"," ",jsxRuntimeExports.jsx("button",{onClick:()=>ar("signup"),className:"text-gold font-medium hover:underline",children:"Sign up"})]})})]})}function SignUpScreen(){const{setScreen:ar,goBack:or,signUp:lr,isLoading:cr,error:ur,clearError:dr}=useAuthStore(),[hr,pr]=reactExports.useState(""),[xr,mr]=reactExports.useState(""),[fr,Er]=reactExports.useState(""),[vr,gr]=reactExports.useState(""),[yr,jr]=reactExports.useState(!1),[br,_r]=reactExports.useState({}),wr=()=>{const Sr={};return hr.trim()||(Sr.name="Name is required"),xr.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(xr)||(Sr.email="Please enter a valid email"):Sr.email="Email is required",fr?fr.length<8&&(Sr.password="Password must be at least 8 characters"):Sr.password="Password is required",vr?fr!==vr&&(Sr.confirmPassword="Passwords do not match"):Sr.confirmPassword="Please confirm your password",_r(Sr),Object.keys(Sr).length===0},Rr=async Sr=>{Sr.preventDefault(),dr(),wr()&&await lr(hr.trim(),xr.trim(),fr)},Ar=hr.trim()&&xr.trim()&&fr&&vr;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4 overflow-y-auto",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Create account"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Join Checks Happy and start tracking"}),jsxRuntimeExports.jsxs("form",{onSubmit:Rr,className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{type:"text",label:"Name",placeholder:"Your name",value:hr,onChange:Sr=>{pr(Sr.target.value),br.name&&_r(kr=>({...kr,name:void 0}))},autoComplete:"name",disabled:cr,error:br.name}),jsxRuntimeExports.jsx(Input,{type:"email",label:"Email",placeholder:"your@email.com",value:xr,onChange:Sr=>{mr(Sr.target.value),br.email&&_r(kr=>({...kr,email:void 0}))},autoComplete:"email",autoCapitalize:"none",disabled:cr,error:br.email}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{type:yr?"text":"password",label:"Password",placeholder:"At least 8 characters",value:fr,onChange:Sr=>{Er(Sr.target.value),br.password&&_r(kr=>({...kr,password:void 0}))},autoComplete:"new-password",disabled:cr,error:br.password}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>jr(!yr),className:"absolute right-3 top-8 text-text-muted hover:text-text-secondary",tabIndex:-1,children:yr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"}),jsxRuntimeExports.jsx("path",{d:"M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"}),jsxRuntimeExports.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),jsxRuntimeExports.jsx(Input,{type:yr?"text":"password",label:"Confirm Password",placeholder:"Re-enter your password",value:vr,onChange:Sr=>{gr(Sr.target.value),br.confirmPassword&&_r(kr=>({...kr,confirmPassword:void 0}))},autoComplete:"new-password",disabled:cr,error:br.confirmPassword}),ur&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:ur})}),jsxRuntimeExports.jsx("div",{className:"pt-2",children:jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,size:"lg",disabled:!Ar||cr,children:cr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Creating account..."]}):"Create Account"})})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-6 pb-safe-bottom text-center",children:jsxRuntimeExports.jsxs("p",{className:"text-text-secondary",children:["Already have an account?"," ",jsxRuntimeExports.jsx("button",{onClick:()=>ar("signin"),className:"text-gold font-medium hover:underline",children:"Sign in"})]})})]})}function JoinProjectScreen(){const{setScreen:ar,goBack:or,joinProject:lr,isLoading:cr,error:ur,clearError:dr,isAuthenticated:hr}=useAuthStore(),[pr,xr]=reactExports.useState(""),[mr,fr]=reactExports.useState(null),Er=jr=>{const br=formatProjectCode(jr.target.value);xr(br),ur&&dr()},vr=async jr=>{if(jr.preventDefault(),dr(),fr(null),!isValidProjectCode(pr))return;const br=await lr(pr);br.success&&br.projectName&&fr({projectName:br.projectName})},gr=isValidProjectCode(pr),yr=mr&&!hr;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 px-6 pt-4",children:yr?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-green-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M20 6L9 17l-5-5"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-text-primary mb-2",children:"You're in!"}),jsxRuntimeExports.jsxs("p",{className:"text-text-secondary text-center mb-8",children:["Joined ",jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:mr.projectName})]}),jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"lg",onClick:()=>{ar("hub")},children:"Open Project"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Join a Team"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Enter the project code shared by your supervisor"}),jsxRuntimeExports.jsxs("div",{className:"mb-8",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Project Code"}),jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"ABC-1234",value:pr,onChange:Er,className:"text-center text-2xl tracking-[0.2em] font-mono uppercase",maxLength:8,disabled:cr,autoComplete:"off",autoCapitalize:"characters"})}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-xs text-text-muted text-center",children:"Format: ABC-1234"})]}),ur&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg mb-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:ur})}),jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"lg",disabled:!gr||cr,onClick:vr,children:cr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Joining..."]}):"Join"}),jsxRuntimeExports.jsx("div",{className:"mt-8 p-4 bg-gold-50 border border-gold-200 rounded-xl",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("path",{d:"M12 16v-4"}),jsxRuntimeExports.jsx("path",{d:"M12 8h.01"})]})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("p",{className:"text-sm text-gold-800",children:hr?"The project will be added to your hub.":"You can join without an account. Create one later to access multiple projects."})})]})})]})}),!yr&&!hr&&jsxRuntimeExports.jsx("div",{className:"px-6 py-6 pb-safe-bottom text-center",children:jsxRuntimeExports.jsxs("p",{className:"text-text-secondary",children:["Want to manage multiple projects?"," ",jsxRuntimeExports.jsx("button",{onClick:()=>ar("signup"),className:"text-gold font-medium hover:underline",children:"Create an account"})]})})]})}function UpgradeModal({isOpen:ar,onClose:or,onUpgrade:lr}){return jsxRuntimeExports.jsx(Modal,{isOpen:ar,onClose:or,title:"Upgrade to Create Projects",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gold-50 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),jsxRuntimeExports.jsxs("p",{className:"text-text-secondary mb-6",children:["Creating projects requires a"," ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-text-primary",children:"Supervisor"})," or"," ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-text-primary",children:"Designer"})," subscription."]}),jsxRuntimeExports.jsxs("div",{className:"bg-gold-50/50 rounded-lg p-4 mb-6 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary mb-2",children:"With Supervisor or higher, you can:"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-1.5 text-sm text-text-secondary",children:[jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Create and manage projects"]}),jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Generate team invite codes"]}),jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Team management tools"]}),jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"1000+ photos per project"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"lg",variant:"primary",onClick:lr,children:"Upgrade Now"}),jsxRuntimeExports.jsx("button",{onClick:or,className:"w-full py-2 text-sm text-text-muted hover:text-text-secondary",children:"Not now"})]})]})})}const formatRelativeTime=ar=>{const or=new Date,lr=new Date(ar),cr=or.getTime()-lr.getTime(),ur=Math.floor(cr/6e4),dr=Math.floor(ur/60),hr=Math.floor(dr/24);return ur<1?"Just now":ur<60?`${ur}m ago`:dr<24?`${dr}h ago`:hr===1?"Yesterday":hr<7?`${hr}d ago`:lr.toLocaleDateString()},getRoleLabel=ar=>({owner:"Owner",designer:"Designer",hod:"HOD",supervisor:"Supervisor",key:"Key",floor:"Floor",daily:"Daily",trainee:"Trainee",artist:"Artist",viewer:"Viewer"})[ar]||ar,getTypeLabel=ar=>({film:"Feature Film",tv_series:"TV Series",short_film:"Short Film",commercial:"Commercial",music_video:"Music Video",other:"Production"})[ar]||"Production";function createProjectFromMembership(ar){return{id:ar.projectId,name:ar.projectName,createdAt:ar.joinedAt,updatedAt:ar.lastAccessedAt,scenes:[],characters:[],looks:[]}}function DeleteProjectModal({isOpen:ar,onClose:or,onConfirm:lr,projectName:cr,isOwner:ur,isLoading:dr}){return ar?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center px-4 pb-8",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:or}),jsxRuntimeExports.jsxs("div",{className:"relative bg-card rounded-2xl p-5 max-w-sm w-full shadow-xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1.5",children:ur?"Delete project?":"Leave project?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mb-5",children:ur?`This will permanently delete "${cr}" and all its data for everyone.`:`You'll need a new invite code to rejoin "${cr}".`}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,disabled:dr,className:"flex-1 h-11 rounded-xl border border-border text-sm font-medium text-text-primary active:scale-[0.98] transition-transform",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:lr,disabled:dr,className:"flex-1 h-11 rounded-xl bg-red-600 text-sm font-medium text-white active:scale-[0.98] transition-transform",children:dr?"Deleting...":ur?"Delete":"Leave"})]})]})]}):null}function ProjectMenu({isOpen:ar,onClose:or,onSettings:lr,onDelete:cr,isOwner:ur}){return ar?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-40",onClick:or}),jsxRuntimeExports.jsxs("div",{className:"absolute right-0 top-full mt-1 z-50 bg-card rounded-xl shadow-lg border border-border py-1 min-w-[160px]",children:[lr&&jsxRuntimeExports.jsx("button",{onClick:()=>{lr(),or()},className:"w-full text-left px-4 py-2.5 text-sm text-text-primary hover:bg-gray-50 transition-colors",children:"Settings"}),jsxRuntimeExports.jsx("button",{onClick:()=>{cr(),or()},className:"w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors",children:ur?"Delete project":"Leave project"})]})]}):null}function ProjectHubScreen(){const{user:ar,setScreen:or,goBack:lr,signOut:cr,projectMemberships:ur,canCreateProjects:dr,updateLastAccessed:hr,hasCompletedOnboarding:pr,deleteProject:xr,leaveProject:mr,isLoading:fr,setSettingsProjectId:Er}=useAuthStore(),[vr,gr]=reactExports.useState(!1),[yr,jr]=reactExports.useState(null),[br,_r]=reactExports.useState(null),wr=[...ur].sort((Pr,Ir)=>new Date(Ir.lastAccessedAt).getTime()-new Date(Pr.lastAccessedAt).getTime()),Rr=wr.length>0?wr[0]:null,Ar=wr.slice(1),Sr=Pr=>{var Wr;hr(Pr.projectId);const Ir=useProjectStore.getState();if(Ir.hasSavedProject(Pr.projectId)){Ir.restoreSavedProject(Pr.projectId),Ir.setActiveTab("today");return}if(((Wr=Ir.currentProject)==null?void 0:Wr.id)===Pr.projectId){Ir.setActiveTab("today");return}if(Ir.currentProject&&Ir.currentProject.scenes.length>0){const Yr={...Ir.currentProject,id:Pr.projectId,name:Pr.projectName};Ir.setProject(Yr),Ir.setActiveTab("today");return}const Br=createProjectFromMembership(Pr);Ir.setProjectNeedsSetup(Br),Ir.setActiveTab("today")},kr=()=>{dr()?or("create-project"):gr(!0)},Nr=async()=>{var Br;if(!yr)return;if((yr.role==="owner"?await xr(yr.projectId):await mr(yr.projectId)).success){const Wr=useProjectStore.getState();((Br=Wr.currentProject)==null?void 0:Br.id)===yr.projectId&&Wr.clearProject(),Wr.hasSavedProject(yr.projectId)&&Wr.removeSavedProject(yr.projectId),jr(null)}},Cr=()=>{if(!(ar!=null&&ar.name))return"?";const Pr=ar.name.split(" ");return Pr.length>=2?`${Pr[0][0]}${Pr[1][0]}`.toUpperCase():ar.name.slice(0,2).toUpperCase()},Tr=Pr=>Pr==="owner"||Pr==="supervisor";return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[!pr&&jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-9 h-9 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2",children:jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})}),jsxRuntimeExports.jsx("h1",{className:"text-[17px] font-bold text-text-primary",children:"Projects"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>or("profile"),className:"w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center text-gold text-xs font-bold active:scale-95 transition-transform",children:Cr()})]})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-4",children:wr.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-16 px-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-2xl bg-card border border-border flex items-center justify-center mb-5",children:jsxRuntimeExports.jsx("svg",{className:"w-7 h-7 text-text-muted",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold text-text-primary mb-1",children:"No projects yet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-8 max-w-[240px]",children:"Create a new project or join your team with an invite code."}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[280px] space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:kr,className:"w-full h-11 rounded-xl gold-gradient text-white text-sm font-medium active:scale-[0.98] transition-transform",children:"Create Project"}),jsxRuntimeExports.jsx("button",{onClick:()=>or("join"),className:"w-full h-11 rounded-xl border border-border text-sm font-medium text-text-primary active:scale-[0.98] transition-transform",children:"Join with Code"})]})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[Rr&&jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"text-[11px] font-medium tracking-wider text-text-muted uppercase mb-2.5",children:"Current"}),jsxRuntimeExports.jsxs("button",{onClick:()=>Sr(Rr),className:"w-full text-left bg-card rounded-2xl p-4 shadow-sm border border-border active:scale-[0.99] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary leading-tight pr-2",children:Rr.projectName}),jsxRuntimeExports.jsxs("div",{className:"relative flex-shrink-0",onClick:Pr=>Pr.stopPropagation(),children:[jsxRuntimeExports.jsx("button",{onClick:Pr=>{Pr.stopPropagation(),_r(br===Rr.projectId?null:Rr.projectId)},className:"w-7 h-7 flex items-center justify-center rounded-lg hover:bg-gray-100 -mr-1 -mt-0.5",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-text-muted",viewBox:"0 0 24 24",fill:"currentColor",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"5",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"19",r:"1.5"})]})}),jsxRuntimeExports.jsx(ProjectMenu,{isOpen:br===Rr.projectId,onClose:()=>_r(null),onSettings:Tr(Rr.role)?()=>{Er(Rr.projectId),or("project-settings")}:void 0,onDelete:()=>jr(Rr),isOwner:Rr.role==="owner"})]})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[getTypeLabel(Rr.productionType),jsxRuntimeExports.jsx("span",{className:"mx-1.5 text-text-light",children:""}),getRoleLabel(Rr.role)]}),(Rr.sceneCount>0||Rr.teamMemberCount>0)&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-1.5",children:[Rr.sceneCount>0&&`${Rr.sceneCount} scene${Rr.sceneCount!==1?"s":""}`,Rr.sceneCount>0&&Rr.teamMemberCount>0&&jsxRuntimeExports.jsx("span",{className:"mx-1.5 text-text-light",children:""}),Rr.teamMemberCount>0&&`${Rr.teamMemberCount} team`]})]})]}),Ar.length>0&&jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"text-[11px] font-medium tracking-wider text-text-muted uppercase mb-2.5",children:"Other Projects"}),jsxRuntimeExports.jsx("div",{className:"bg-card rounded-2xl border border-border overflow-hidden divide-y divide-border",children:Ar.map(Pr=>jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsxs("button",{onClick:()=>Sr(Pr),className:"w-full text-left px-4 py-3.5 flex items-center justify-between active:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-medium text-text-primary truncate",children:Pr.projectName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-0.5",children:[getTypeLabel(Pr.productionType),jsxRuntimeExports.jsx("span",{className:"mx-1.5 text-text-light",children:""}),formatRelativeTime(Pr.lastAccessedAt)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 ml-3 flex-shrink-0",children:[jsxRuntimeExports.jsxs("div",{onClick:Ir=>Ir.stopPropagation(),className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:Ir=>{Ir.stopPropagation(),_r(br===Pr.projectId?null:Pr.projectId)},className:"w-7 h-7 flex items-center justify-center rounded-lg hover:bg-gray-100",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-text-muted",viewBox:"0 0 24 24",fill:"currentColor",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"5",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"19",r:"1.5"})]})}),jsxRuntimeExports.jsx(ProjectMenu,{isOpen:br===Pr.projectId,onClose:()=>_r(null),onSettings:Tr(Pr.role)?()=>{Er(Pr.projectId),or("project-settings")}:void 0,onDelete:()=>jr(Pr),isOwner:Pr.role==="owner"})]}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-light",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:jsxRuntimeExports.jsx("path",{d:"M9 18l6-6-6-6"})})]})]})},Pr.projectId))})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-5 pt-2 pb-4",children:[jsxRuntimeExports.jsxs("button",{onClick:kr,className:"flex items-center gap-1.5 text-sm font-medium text-gold active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[jsxRuntimeExports.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),jsxRuntimeExports.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Create"]}),jsxRuntimeExports.jsx("div",{className:"w-px h-4 bg-border"}),jsxRuntimeExports.jsxs("button",{onClick:()=>or("join"),className:"flex items-center gap-1.5 text-sm font-medium text-text-secondary active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),jsxRuntimeExports.jsx("polyline",{points:"10 17 15 12 10 7"}),jsxRuntimeExports.jsx("line",{x1:"15",y1:"12",x2:"3",y2:"12"})]}),"Join"]})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-3 pb-safe-bottom",children:jsxRuntimeExports.jsx("button",{onClick:cr,className:"w-full text-center text-xs text-text-muted active:opacity-70 transition-opacity",children:"Sign out"})}),jsxRuntimeExports.jsx(UpgradeModal,{isOpen:vr,onClose:()=>gr(!1),onUpgrade:()=>{gr(!1),or("select-plan")}}),jsxRuntimeExports.jsx(DeleteProjectModal,{isOpen:yr!==null,onClose:()=>jr(null),onConfirm:Nr,projectName:(yr==null?void 0:yr.projectName)||"",isOwner:(yr==null?void 0:yr.role)==="owner",isLoading:fr})]})}function CreateProjectScreen(){const{goBack:ar,createProject:or,isLoading:lr,error:cr,clearError:ur}=useAuthStore(),[dr,hr]=reactExports.useState(""),[pr,xr]=reactExports.useState("film"),mr=async Er=>{if(Er.preventDefault(),ur(),!dr.trim())return;const vr=await or(dr.trim(),pr);if(vr.success&&vr.code){const{projectMemberships:gr}=useAuthStore.getState(),yr=gr.find(jr=>jr.projectCode===vr.code);if(yr){const jr={id:yr.projectId,name:yr.projectName,createdAt:yr.joinedAt,updatedAt:yr.lastAccessedAt,scenes:[],characters:[],looks:[]};useProjectStore.getState().setProjectNeedsSetup(jr)}}},fr=dr.trim();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:ar,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Create Project"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Set up a new production for your team"}),jsxRuntimeExports.jsxs("form",{onSubmit:mr,className:"space-y-6",children:[jsxRuntimeExports.jsx(Input,{type:"text",label:"Production Name",placeholder:"e.g., The Crown S6",value:dr,onChange:Er=>hr(Er.target.value),disabled:lr,autoComplete:"off"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Production Type"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-2",children:PRODUCTION_TYPES.map(Er=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>xr(Er.value),className:`px-4 py-3 rounded-lg border text-sm font-medium transition-colors ${pr===Er.value?"border-gold bg-gold-50 text-gold":"border-border bg-card text-text-secondary hover:border-gold-300"}`,children:Er.label},Er.value))})]}),cr&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:cr})}),jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,size:"lg",disabled:!fr||lr,children:lr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Creating..."]}):"Create Project"})]})]})]})}function FeatureList({features:ar,variant:or="default",showCheckmarks:lr=!0}){return jsxRuntimeExports.jsx("ul",{className:clsx("space-y-2",or==="compact"&&"space-y-1.5"),children:ar.map((cr,ur)=>jsxRuntimeExports.jsxs("li",{className:clsx("flex items-start gap-2",or==="compact"?"text-xs":"text-sm","text-text-secondary"),children:[lr&&jsxRuntimeExports.jsx("span",{className:"flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsx("svg",{className:clsx("text-gold",or==="compact"?"w-3.5 h-3.5":"w-4 h-4"),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}),jsxRuntimeExports.jsx("span",{children:cr})]},ur))})}function FeatureLossList({features:ar}){return ar.length===0?null:jsxRuntimeExports.jsx("ul",{className:"space-y-2",children:ar.map((or,lr)=>jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2 text-sm text-red-600",children:[jsxRuntimeExports.jsx("span",{className:"flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),jsxRuntimeExports.jsx("span",{children:or})]},lr))})}function TierCard({tier:ar,billingPeriod:or,isSelected:lr=!1,isCurrentPlan:cr=!1,onSelect:ur,disabled:dr=!1}){const{id:hr,name:pr,description:xr,pricing:mr,featureList:fr,isPopular:Er,isPremium:vr}=ar,gr=()=>hr==="trainee"||or!=="yearly"?null:`${formatMonthlyEquivalent(mr.yearly,mr.currencySymbol)}/mo`,yr=()=>cr?"Current Plan":hr==="trainee"?"Start Free":"Subscribe",jr=()=>lr||cr?"primary":"outline";return gr(),jsxRuntimeExports.jsxs("div",{className:clsx("relative rounded-xl p-4 transition-all duration-200","border-2",{"border-gold bg-gold-50/50":lr&&!cr,"border-gold bg-gold-50/30":cr,"border-gold/30 bg-gradient-to-br from-gold-50/20 to-transparent":vr&&!lr&&!cr,"border-border bg-card":!lr&&!cr&&!vr,"hover:border-gold/50":!lr&&!cr}),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[Er&&jsxRuntimeExports.jsx(Badge,{variant:"gold",size:"md",children:"Most Popular"}),vr&&jsxRuntimeExports.jsx(Badge,{variant:"gold",size:"md",children:"Premium"}),cr&&jsxRuntimeExports.jsx(Badge,{variant:"success",size:"md",children:"Current Plan"})]}),jsxRuntimeExports.jsx("h3",{className:clsx("text-lg font-bold mb-1",vr?"gold-text-gradient":"text-text-primary"),children:pr}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mb-4",children:xr}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-gold",children:"Beta Access"}),jsxRuntimeExports.jsx(Badge,{variant:"gold",size:"sm",children:"Free"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Full access during beta testing"})]}),jsxRuntimeExports.jsx(FeatureList,{features:fr}),jsxRuntimeExports.jsx(Button,{variant:jr(),size:"md",fullWidth:!0,onClick:()=>ur(hr),disabled:dr||cr,className:"mt-4",children:yr()}),lr&&!cr&&jsxRuntimeExports.jsx("div",{className:"absolute top-3 right-3",children:jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-gold flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})})})]})}const COMPARISON_FEATURES=[{label:"Photos per project",trainee:"50",artist:"500",supervisor:"1,000",designer:"Unlimited"},{label:"Projects",trainee:"3",artist:"10",supervisor:"25",designer:"Unlimited"},{label:"Archived projects",trainee:"1",artist:"Unlimited",supervisor:"15",designer:"Unlimited"},{label:"Offline mode",trainee:!1,artist:!0,supervisor:!0,designer:!0},{label:"Export PDF reports",trainee:!1,artist:!0,supervisor:!0,designer:!0},{label:"Personal templates",trainee:!1,artist:!0,supervisor:!0,designer:!0},{label:"Create projects",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Team management",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Team invite codes",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Character progression",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Shooting schedule",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Team photo storage",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Desktop web access",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Pre-production breakdown",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Character design docs",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Production books export",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Budget & scheduling",trainee:!1,artist:!1,supervisor:!1,designer:!0}],tierOrder=["trainee","artist","supervisor","designer"];function CheckIcon(){return jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}function CrossIcon(){return jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-text-muted",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function ComparisonModal({isOpen:ar,onClose:or,currentTier:lr}){const cr=SUBSCRIPTION_TIERS,ur=(dr,hr)=>typeof dr=="boolean"?dr?jsxRuntimeExports.jsx(CheckIcon,{}):jsxRuntimeExports.jsx(CrossIcon,{}):jsxRuntimeExports.jsx("span",{className:clsx("text-xs font-medium",hr===lr?"text-gold":"text-text-secondary"),children:dr});return jsxRuntimeExports.jsxs(BottomSheet,{isOpen:ar,onClose:or,title:"Compare Plans",height:"full",children:[jsxRuntimeExports.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:jsxRuntimeExports.jsxs("table",{className:"w-full min-w-[500px]",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"border-b border-border",children:[jsxRuntimeExports.jsx("th",{className:"text-left py-3 pr-4 text-xs font-semibold text-text-muted uppercase tracking-wide",children:"Feature"}),cr.map(dr=>jsxRuntimeExports.jsxs("th",{className:clsx("text-center py-3 px-2 text-xs font-bold uppercase tracking-wide",dr.id===lr?"text-gold":"text-text-primary"),children:[dr.name,dr.id===lr&&jsxRuntimeExports.jsx("div",{className:"text-[9px] text-gold font-normal mt-0.5",children:"Current"})]},dr.id))]})}),jsxRuntimeExports.jsxs("tbody",{children:[jsxRuntimeExports.jsxs("tr",{className:"border-b border-border bg-gold-50/30",children:[jsxRuntimeExports.jsx("td",{className:"py-3 pr-4 text-sm font-medium text-text-primary",children:"Beta Access"}),cr.map(dr=>jsxRuntimeExports.jsx("td",{className:clsx("text-center py-3 px-2",dr.id===lr?"bg-gold-50/50":""),children:jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-gold",children:"Free"})},dr.id))]}),COMPARISON_FEATURES.map((dr,hr)=>jsxRuntimeExports.jsxs("tr",{className:clsx("border-b border-border",hr%2===0?"bg-transparent":"bg-input-bg/30"),children:[jsxRuntimeExports.jsx("td",{className:"py-2.5 pr-4 text-sm text-text-secondary",children:dr.label}),tierOrder.map(pr=>jsxRuntimeExports.jsx("td",{className:clsx("text-center py-2.5 px-2",pr===lr?"bg-gold-50/30":""),children:jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:ur(dr[pr],pr)})},pr))]},dr.label))]})]})}),jsxRuntimeExports.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center",children:"All features available during beta testing. Thank you for testing!"})})]})}function SelectPlanScreen({isOnboarding:ar=!0,currentTier:or,onSelectTier:lr,onSkip:cr,onBack:ur,isLoading:dr=!1}){const[hr,pr]=reactExports.useState(ar?null:or||null),[xr,mr]=reactExports.useState("monthly"),[fr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(!1),yr=or&&hr&&isTierHigher(or,hr)?getDowngradeWarnings(or,hr):[],jr=Sr=>{pr(Sr),or&&isTierHigher(or,Sr)?gr(!0):gr(!1)},br=()=>{hr&&lr&&lr(hr,xr)},_r=()=>{cr?cr():lr&&lr("trainee","monthly")},wr=hr!==null&&!dr,Rr=or&&hr&&isTierHigher(hr,or),Ar=or&&hr&&isTierHigher(or,hr);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsxs("header",{className:"flex items-center px-4 py-3 safe-top border-b border-border bg-card",children:[ur&&jsxRuntimeExports.jsx("button",{onClick:ur,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})}),jsxRuntimeExports.jsx("div",{className:clsx("flex-1",ur?"text-center pr-10":"text-center"),children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-text-primary",children:"Choose Your Plan"})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 pt-4 pb-2 text-center",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary",children:"All features are available during beta testing. Select your preferred tier."})}),!BETA_MODE,jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4",children:[jsxRuntimeExports.jsx("div",{className:"space-y-4 max-w-md mx-auto",children:SUBSCRIPTION_TIERS.map(Sr=>jsxRuntimeExports.jsx(TierCard,{tier:Sr,billingPeriod:xr,isSelected:hr===Sr.id,isCurrentPlan:or===Sr.id,onSelect:jr,disabled:dr},Sr.id))}),jsxRuntimeExports.jsx("div",{className:"text-center mt-6",children:jsxRuntimeExports.jsx("button",{onClick:()=>Er(!0),className:"text-sm text-gold font-medium hover:underline",children:"Compare all features"})}),jsxRuntimeExports.jsxs("div",{className:"mt-6 text-center space-y-1",children:[jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Full access during beta"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Thank you for testing!"})]}),jsxRuntimeExports.jsx("button",{className:"text-xs text-gold hover:underline",children:"Questions? Contact us"})]}),vr&&yr.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg max-w-md mx-auto",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-semibold text-red-700 mb-2",children:"You'll lose access to:"}),jsxRuntimeExports.jsx(FeatureLossList,{features:yr}),jsxRuntimeExports.jsx("p",{className:"text-xs text-red-600 mt-3",children:"Changes take effect at the end of your billing period."})]})]}),jsxRuntimeExports.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 pb-safe-bottom bg-card border-t border-border",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:br,disabled:!wr,children:dr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Processing..."]}):hr==="trainee"?"Start Free":Ar?"Downgrade Plan":Rr?"Upgrade Plan":hr?"Subscribe":"Select a Plan"}),ar&&jsxRuntimeExports.jsx("button",{onClick:_r,className:"w-full text-center text-sm text-text-muted hover:text-text-secondary",disabled:dr,children:"Continue with Free for now"}),!ar&&or&&or!=="trainee"&&jsxRuntimeExports.jsx("button",{className:"w-full text-center text-sm text-gold hover:underline",children:"Manage billing"})]})}),jsxRuntimeExports.jsx(ComparisonModal,{isOpen:fr,onClose:()=>Er(!1),currentTier:or})]})}initSyncSubscriptions();function ConfigurationError(){return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md text-center space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"text-6xl",children:""}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"Configuration Required"}),jsxRuntimeExports.jsxs("p",{className:"text-muted-foreground",children:["The application is missing required environment variables. Please ensure",jsxRuntimeExports.jsx("code",{className:"mx-1 px-1.5 py-0.5 bg-muted rounded text-sm",children:"VITE_SUPABASE_URL"}),"and",jsxRuntimeExports.jsx("code",{className:"mx-1 px-1.5 py-0.5 bg-muted rounded text-sm",children:"VITE_SUPABASE_ANON_KEY"}),"are configured in your deployment environment."]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground/70",children:"If you're the administrator, check your Vercel environment variables or .env file."})]})})}function AppContent(){var cs;if(!isSupabaseConfigured)return jsxRuntimeExports.jsx(ConfigurationError,{});const{currentProject:ar,activeTab:or,setActiveTab:lr,currentSceneId:cr,currentLookId:ur,setCurrentScene:dr,setCurrentCharacter:hr,setCurrentLook:pr,checkWrapTrigger:xr,lifecycle:mr,updateActivity:fr,needsSetup:Er,clearNeedsSetup:vr}=useProjectStore(),{isAuthenticated:gr,hasCompletedOnboarding:yr,currentScreen:jr,guestProjectCode:br,selectTier:_r,setScreen:wr,goBack:Rr,user:Ar,settingsProjectId:Sr,setSettingsProjectId:kr}=useAuthStore(),[Nr,Cr]=reactExports.useState(!1),[Tr,Pr]=reactExports.useState(!1),[Ir,Br]=reactExports.useState(!1),Wr=reactExports.useRef(!1);reactExports.useEffect(()=>{if(Wr.current)return;Wr.current=!0,migrateToIndexedDB().then(({migrated:Es,errors:Ns})=>{Es.length>0&&console.log("[Storage] Migrated to IndexedDB:",Es),Ns.length>0&&console.warn("[Storage] Migration errors:",Ns)}).catch(Es=>{console.error("[Storage] Migration failed:",Es)});const xs=()=>{flushPendingWrites()};return window.addEventListener("beforeunload",xs),()=>window.removeEventListener("beforeunload",xs)},[]);const[Yr,es]=reactExports.useState(0),[ps,ts]=reactExports.useState(void 0);reactExports.useEffect(()=>{yr&&!gr&&!ar&&!br&&wr("hub")},[yr,gr,ar,br,wr]);const Qr=reactExports.useMemo(()=>(ar==null?void 0:ar.scenes.filter(xs=>xs.isComplete).length)??0,[ar==null?void 0:ar.scenes]);reactExports.useEffect(()=>{ar&&xr()},[ar,Qr,xr]),reactExports.useEffect(()=>{ar&&fr()},[ar,cr,or,fr]);const Hr=reactExports.useRef(null);reactExports.useEffect(()=>(ar&&ar.id!==Hr.current&&(Hr.current=ar.id,startSync(ar.id,Ar==null?void 0:Ar.id)),!ar&&Hr.current&&(Hr.current=null,stopSync()),()=>{Hr.current&&stopSync()}),[ar==null?void 0:ar.id,Ar==null?void 0:Ar.id]);const{schedule:Kr,isProcessingStage2:rs,startStage2Processing:Mr}=useScheduleStore(),{syncCastDataFromSchedule:Dr}=useProjectStore(),Lr=reactExports.useRef(!1);reactExports.useEffect(()=>{Kr&&!rs&&(!Kr.days||Kr.days.length===0)&&Kr.rawText&&!Lr.current&&(Lr.current=!0,console.log("[App] Starting background schedule Stage 2 processing..."),Mr())},[Kr,rs,Mr]);const Fr=reactExports.useRef(null);reactExports.useEffect(()=>{if(Kr&&Kr.status==="complete"&&!rs&&Kr.days&&Kr.days.length>0&&ar&&Fr.current!==Kr.id){Fr.current=Kr.id;const xs=useScheduleStore.getState().schedule;xs&&(console.log("[App] Schedule processing complete, auto-syncing cast data..."),Dr(xs,{createMissingCharacters:!0,overwriteExisting:!1,autoConfirm:!0}))}},[Kr==null?void 0:Kr.status,(cs=Kr==null?void 0:Kr.days)==null?void 0:cs.length,Kr==null?void 0:Kr.id,rs,ar,Dr]);const $r=()=>{Cr(!1),vr(),lr("today"),Br(!0)},Vr=()=>{stopSync(),Hr.current=null,useProjectStore.getState().saveAndClearProject(),Cr(!1),wr("hub")},Gr=()=>{Cr(!0)},Jr=xs=>{dr(xs),hr(null)},ms=()=>{dr(null),hr(null)},ls=xs=>{xs===or&&es(Es=>Es+1),lr(xs),ts(void 0),cr&&(dr(null),hr(null)),ur&&pr(null)},[ds,bs]=reactExports.useState(!1),ws=xs=>{ls(xs)},Is=async(xs,Es)=>{await _r(xs,Es)},ys=async()=>{await _r("trainee","monthly")};if(!yr&&!br)switch(jr){case"welcome":return jsxRuntimeExports.jsx(WelcomeScreen,{});case"signin":return jsxRuntimeExports.jsx(SignInScreen,{});case"signup":return jsxRuntimeExports.jsx(SignUpScreen,{});case"join":return jsxRuntimeExports.jsx(JoinProjectScreen,{});case"hub":return jsxRuntimeExports.jsx(ProjectHubScreen,{});case"create-project":return jsxRuntimeExports.jsx(CreateProjectScreen,{});case"select-plan":return jsxRuntimeExports.jsx(SelectPlanScreen,{isOnboarding:!0,currentTier:Ar==null?void 0:Ar.tier,onSelectTier:Is,onSkip:ys,onBack:Rr});case"profile":return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:Rr,onNavigateToBilling:()=>wr("select-plan")});case"project-settings":return Sr?jsxRuntimeExports.jsx(ProjectSettingsScreen,{projectId:Sr,onBack:()=>{kr(null),wr("hub")},onProjectDeleted:()=>{kr(null),wr("hub")},onProjectArchived:()=>{kr(null),wr("hub")}}):jsxRuntimeExports.jsx(ProjectHubScreen,{});default:return jsxRuntimeExports.jsx(WelcomeScreen,{})}if(gr&&!ar&&!Nr)switch(jr){case"hub":return jsxRuntimeExports.jsx(ProjectHubScreen,{});case"join":return jsxRuntimeExports.jsx(JoinProjectScreen,{});case"create-project":return jsxRuntimeExports.jsx(CreateProjectScreen,{});case"select-plan":return jsxRuntimeExports.jsx(SelectPlanScreen,{isOnboarding:!1,currentTier:Ar==null?void 0:Ar.tier,onSelectTier:Is,onBack:Rr});case"profile":return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:Rr,onNavigateToBilling:()=>wr("select-plan")});case"project-settings":return Sr?jsxRuntimeExports.jsx(ProjectSettingsScreen,{projectId:Sr,onBack:()=>{kr(null),wr("hub")},onProjectDeleted:()=>{kr(null),wr("hub")},onProjectArchived:()=>{kr(null),wr("hub")}}):jsxRuntimeExports.jsx(ProjectHubScreen,{});default:return jsxRuntimeExports.jsx(ProjectHubScreen,{})}if(yr&&!gr&&!ar&&!br)return jsxRuntimeExports.jsx(ProjectHubScreen,{});const ss=()=>{Cr(!1),vr(),Rr()};if(Nr||!ar||Er)return jsxRuntimeExports.jsx(Home,{onProjectReady:$r,onBack:ss});if(Tr)return jsxRuntimeExports.jsx(ProjectExportScreen,{onBack:()=>Pr(!1),onExportComplete:()=>Pr(!1)});if(ds)return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:()=>bs(!1),onNavigateToBilling:()=>{bs(!1),lr("more"),ts("billing")}});const Ur=()=>{if(cr&&(or==="today"||or==="breakdown"))return jsxRuntimeExports.jsx(SceneView,{sceneId:cr,onBack:ms});switch(or){case"today":return jsxRuntimeExports.jsx(Today,{onSceneSelect:Jr,onNavigateToTab:ws});case"breakdown":return jsxRuntimeExports.jsx(Breakdown,{onSceneSelect:Jr});case"lookbook":return jsxRuntimeExports.jsx(Lookbooks,{});case"hours":return jsxRuntimeExports.jsx(Timesheet,{});case"budget":return jsxRuntimeExports.jsx(Budget,{});case"script":case"schedule":case"callsheets":case"settings":case"more":return jsxRuntimeExports.jsx(More,{onNavigateToTab:ws,onStartNewProject:Gr,initialView:or,resetKey:Yr,subView:ps});default:return jsxRuntimeExports.jsx(Today,{onSceneSelect:Jr,onNavigateToTab:ws})}},Xr=!cr&&!["more","settings","script","schedule","callsheets"].includes(or);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[mr.state!=="active"&&jsxRuntimeExports.jsx(LifecycleBanner,{onExport:()=>Pr(!0)}),Xr&&jsxRuntimeExports.jsx(ProjectHeader,{onSwitchProject:Vr,onNavigateToProfile:()=>bs(!0)}),Ur(),jsxRuntimeExports.jsx(BottomNav,{activeTab:or,onTabChange:ls}),jsxRuntimeExports.jsx(ChatAssistant,{}),jsxRuntimeExports.jsx(WrapPopupModal,{onExport:()=>Pr(!0)}),Ir&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"pt-8 pb-4 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-text-primary mb-1",children:"You're All Set!"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted px-6",children:"Your project is ready to explore"})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-6",children:[jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 text-gold animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-text-secondary",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Schedule Processing"}),jsxRuntimeExports.jsx("p",{children:"Your schedule is being processed in the background. Character assignments will be confirmed automatically once complete."})]})]})}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-blue-50 border border-blue-100 p-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-blue-700",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Start Working Now"}),jsxRuntimeExports.jsx("p",{children:"You can browse scenes, add looks, and set up your continuity bible while the schedule finishes processing."})]})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>Br(!1),className:"w-full py-3.5 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform",children:"Got It"})]})]})})]})}function App(){return jsxRuntimeExports.jsx(ErrorBoundary,{children:jsxRuntimeExports.jsx(AppContent,{})})}const initTheme=()=>{const or=useThemeStore.getState().theme,lr=or==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":or;document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(lr);const cr=document.querySelector('meta[name="theme-color"]');cr&&cr.setAttribute("content",lr==="dark"?"#000000":"#f5f4f2")};initTheme();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(ar=>{console.log("SW registration failed:",ar)})});client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React$2.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
