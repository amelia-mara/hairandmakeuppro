var Tu=Object.defineProperty;var Kl=ar=>{throw TypeError(ar)};var Au=(ar,or,lr)=>or in ar?Tu(ar,or,{enumerable:!0,configurable:!0,writable:!0,value:lr}):ar[or]=lr;var io=(ar,or,lr)=>Au(ar,typeof or!="symbol"?or+"":or,lr),Go=(ar,or,lr)=>or.has(ar)||Kl("Cannot "+lr);var $r=(ar,or,lr)=>(Go(ar,or,"read from private field"),lr?lr.call(ar):or.get(ar)),Ns=(ar,or,lr)=>or.has(ar)?Kl("Cannot add the same private member more than once"):or instanceof WeakSet?or.add(ar):or.set(ar,lr),ks=(ar,or,lr,cr)=>(Go(ar,or,"write to private field"),cr?cr.call(ar,lr):or.set(ar,lr),lr),ws=(ar,or,lr)=>(Go(ar,or,"access private method"),lr);var wo=(ar,or,lr,cr)=>({set _(ur){ks(ar,or,ur,lr)},get _(){return $r(ar,or,cr)}});(function(){const or=document.createElement("link").relList;if(or&&or.supports&&or.supports("modulepreload"))return;for(const ur of document.querySelectorAll('link[rel="modulepreload"]'))cr(ur);new MutationObserver(ur=>{for(const dr of ur)if(dr.type==="childList")for(const hr of dr.addedNodes)hr.tagName==="LINK"&&hr.rel==="modulepreload"&&cr(hr)}).observe(document,{childList:!0,subtree:!0});function lr(ur){const dr={};return ur.integrity&&(dr.integrity=ur.integrity),ur.referrerPolicy&&(dr.referrerPolicy=ur.referrerPolicy),ur.crossOrigin==="use-credentials"?dr.credentials="include":ur.crossOrigin==="anonymous"?dr.credentials="omit":dr.credentials="same-origin",dr}function cr(ur){if(ur.ep)return;ur.ep=!0;const dr=lr(ur);fetch(ur.href,dr)}})();function getDefaultExportFromCjs(ar){return ar&&ar.__esModule&&Object.prototype.hasOwnProperty.call(ar,"default")?ar.default:ar}function getAugmentedNamespace(ar){if(ar.__esModule)return ar;var or=ar.default;if(typeof or=="function"){var lr=function cr(){return this instanceof cr?Reflect.construct(or,arguments,this.constructor):or.apply(this,arguments)};lr.prototype=or.prototype}else lr={};return Object.defineProperty(lr,"__esModule",{value:!0}),Object.keys(ar).forEach(function(cr){var ur=Object.getOwnPropertyDescriptor(ar,cr);Object.defineProperty(lr,cr,ur.get?ur:{enumerable:!0,get:function(){return ar[cr]}})}),lr}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$2=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$2=Symbol.for("react.strict_mode"),r$2=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$2=Symbol.iterator;function A$2(ar){return ar===null||typeof ar!="object"?null:(ar=z$2&&ar[z$2]||ar["@@iterator"],typeof ar=="function"?ar:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$2={};function E$2(ar,or,lr){this.props=ar,this.context=or,this.refs=D$2,this.updater=lr||B$2}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(ar,or){if(typeof ar!="object"&&typeof ar!="function"&&ar!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ar,or,"setState")};E$2.prototype.forceUpdate=function(ar){this.updater.enqueueForceUpdate(this,ar,"forceUpdate")};function F$1(){}F$1.prototype=E$2.prototype;function G$2(ar,or,lr){this.props=ar,this.context=or,this.refs=D$2,this.updater=lr||B$2}var H$2=G$2.prototype=new F$1;H$2.constructor=G$2;C$2(H$2,E$2.prototype);H$2.isPureReactComponent=!0;var I$2=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$2={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(ar,or,lr){var cr,ur={},dr=null,hr=null;if(or!=null)for(cr in or.ref!==void 0&&(hr=or.ref),or.key!==void 0&&(dr=""+or.key),or)J$1.call(or,cr)&&!L$2.hasOwnProperty(cr)&&(ur[cr]=or[cr]);var pr=arguments.length-2;if(pr===1)ur.children=lr;else if(1<pr){for(var mr=Array(pr),fr=0;fr<pr;fr++)mr[fr]=arguments[fr+2];ur.children=mr}if(ar&&ar.defaultProps)for(cr in pr=ar.defaultProps,pr)ur[cr]===void 0&&(ur[cr]=pr[cr]);return{$$typeof:l$2,type:ar,key:dr,ref:hr,props:ur,_owner:K$2.current}}function N$2(ar,or){return{$$typeof:l$2,type:ar.type,key:or,ref:ar.ref,props:ar.props,_owner:ar._owner}}function O$2(ar){return typeof ar=="object"&&ar!==null&&ar.$$typeof===l$2}function escape$1(ar){var or={"=":"=0",":":"=2"};return"$"+ar.replace(/[=:]/g,function(lr){return or[lr]})}var P$2=/\/+/g;function Q$2(ar,or){return typeof ar=="object"&&ar!==null&&ar.key!=null?escape$1(""+ar.key):or.toString(36)}function R$2(ar,or,lr,cr,ur){var dr=typeof ar;(dr==="undefined"||dr==="boolean")&&(ar=null);var hr=!1;if(ar===null)hr=!0;else switch(dr){case"string":case"number":hr=!0;break;case"object":switch(ar.$$typeof){case l$2:case n$2:hr=!0}}if(hr)return hr=ar,ur=ur(hr),ar=cr===""?"."+Q$2(hr,0):cr,I$2(ur)?(lr="",ar!=null&&(lr=ar.replace(P$2,"$&/")+"/"),R$2(ur,or,lr,"",function(fr){return fr})):ur!=null&&(O$2(ur)&&(ur=N$2(ur,lr+(!ur.key||hr&&hr.key===ur.key?"":(""+ur.key).replace(P$2,"$&/")+"/")+ar)),or.push(ur)),1;if(hr=0,cr=cr===""?".":cr+":",I$2(ar))for(var pr=0;pr<ar.length;pr++){dr=ar[pr];var mr=cr+Q$2(dr,pr);hr+=R$2(dr,or,lr,mr,ur)}else if(mr=A$2(ar),typeof mr=="function")for(ar=mr.call(ar),pr=0;!(dr=ar.next()).done;)dr=dr.value,mr=cr+Q$2(dr,pr++),hr+=R$2(dr,or,lr,mr,ur);else if(dr==="object")throw or=String(ar),Error("Objects are not valid as a React child (found: "+(or==="[object Object]"?"object with keys {"+Object.keys(ar).join(", ")+"}":or)+"). If you meant to render a collection of children, use an array instead.");return hr}function S$2(ar,or,lr){if(ar==null)return ar;var cr=[],ur=0;return R$2(ar,cr,"","",function(dr){return or.call(lr,dr,ur++)}),cr}function T$2(ar){if(ar._status===-1){var or=ar._result;or=or(),or.then(function(lr){(ar._status===0||ar._status===-1)&&(ar._status=1,ar._result=lr)},function(lr){(ar._status===0||ar._status===-1)&&(ar._status=2,ar._result=lr)}),ar._status===-1&&(ar._status=0,ar._result=or)}if(ar._status===1)return ar._result.default;throw ar._result}var U$2={current:null},V$2={transition:null},W$2={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$2};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(ar,or,lr){S$2(ar,function(){or.apply(this,arguments)},lr)},count:function(ar){var or=0;return S$2(ar,function(){or++}),or},toArray:function(ar){return S$2(ar,function(or){return or})||[]},only:function(ar){if(!O$2(ar))throw Error("React.Children.only expected to receive a single React element child.");return ar}};react_production_min.Component=E$2;react_production_min.Fragment=p$3;react_production_min.Profiler=r$2;react_production_min.PureComponent=G$2;react_production_min.StrictMode=q$2;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$2;react_production_min.act=X$2;react_production_min.cloneElement=function(ar,or,lr){if(ar==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ar+".");var cr=C$2({},ar.props),ur=ar.key,dr=ar.ref,hr=ar._owner;if(or!=null){if(or.ref!==void 0&&(dr=or.ref,hr=K$2.current),or.key!==void 0&&(ur=""+or.key),ar.type&&ar.type.defaultProps)var pr=ar.type.defaultProps;for(mr in or)J$1.call(or,mr)&&!L$2.hasOwnProperty(mr)&&(cr[mr]=or[mr]===void 0&&pr!==void 0?pr[mr]:or[mr])}var mr=arguments.length-2;if(mr===1)cr.children=lr;else if(1<mr){pr=Array(mr);for(var fr=0;fr<mr;fr++)pr[fr]=arguments[fr+2];cr.children=pr}return{$$typeof:l$2,type:ar.type,key:ur,ref:dr,props:cr,_owner:hr}};react_production_min.createContext=function(ar){return ar={$$typeof:u$1,_currentValue:ar,_currentValue2:ar,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ar.Provider={$$typeof:t$1,_context:ar},ar.Consumer=ar};react_production_min.createElement=M$2;react_production_min.createFactory=function(ar){var or=M$2.bind(null,ar);return or.type=ar,or};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(ar){return{$$typeof:v$2,render:ar}};react_production_min.isValidElement=O$2;react_production_min.lazy=function(ar){return{$$typeof:y$1,_payload:{_status:-1,_result:ar},_init:T$2}};react_production_min.memo=function(ar,or){return{$$typeof:x$1,type:ar,compare:or===void 0?null:or}};react_production_min.startTransition=function(ar){var or=V$2.transition;V$2.transition={};try{ar()}finally{V$2.transition=or}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(ar,or){return U$2.current.useCallback(ar,or)};react_production_min.useContext=function(ar){return U$2.current.useContext(ar)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(ar){return U$2.current.useDeferredValue(ar)};react_production_min.useEffect=function(ar,or){return U$2.current.useEffect(ar,or)};react_production_min.useId=function(){return U$2.current.useId()};react_production_min.useImperativeHandle=function(ar,or,lr){return U$2.current.useImperativeHandle(ar,or,lr)};react_production_min.useInsertionEffect=function(ar,or){return U$2.current.useInsertionEffect(ar,or)};react_production_min.useLayoutEffect=function(ar,or){return U$2.current.useLayoutEffect(ar,or)};react_production_min.useMemo=function(ar,or){return U$2.current.useMemo(ar,or)};react_production_min.useReducer=function(ar,or,lr){return U$2.current.useReducer(ar,or,lr)};react_production_min.useRef=function(ar){return U$2.current.useRef(ar)};react_production_min.useState=function(ar){return U$2.current.useState(ar)};react_production_min.useSyncExternalStore=function(ar,or,lr){return U$2.current.useSyncExternalStore(ar,or,lr)};react_production_min.useTransition=function(){return U$2.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React$2=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$1=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q$1(ar,or,lr){var cr,ur={},dr=null,hr=null;lr!==void 0&&(dr=""+lr),or.key!==void 0&&(dr=""+or.key),or.ref!==void 0&&(hr=or.ref);for(cr in or)m$2.call(or,cr)&&!p$2.hasOwnProperty(cr)&&(ur[cr]=or[cr]);if(ar&&ar.defaultProps)for(cr in or=ar.defaultProps,or)ur[cr]===void 0&&(ur[cr]=or[cr]);return{$$typeof:k$1,type:ar,key:dr,ref:hr,props:ur,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1;reactJsxRuntime_production_min.jsx=q$1;reactJsxRuntime_production_min.jsxs=q$1;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(ar){function or(os,Ur){var Vr=os.length;os.push(Ur);e:for(;0<Vr;){var es=Vr-1>>>1,Ir=os[es];if(0<ur(Ir,Ur))os[es]=Ur,os[Vr]=Ir,Vr=es;else break e}}function lr(os){return os.length===0?null:os[0]}function cr(os){if(os.length===0)return null;var Ur=os[0],Vr=os.pop();if(Vr!==Ur){os[0]=Vr;e:for(var es=0,Ir=os.length,Dr=Ir>>>1;es<Dr;){var Pr=2*(es+1)-1,Mr=os[Pr],Br=Pr+1,Xr=os[Br];if(0>ur(Mr,Vr))Br<Ir&&0>ur(Xr,Mr)?(os[es]=Xr,os[Br]=Vr,es=Br):(os[es]=Mr,os[Pr]=Vr,es=Pr);else if(Br<Ir&&0>ur(Xr,Vr))os[es]=Xr,os[Br]=Vr,es=Br;else break e}}return Ur}function ur(os,Ur){var Vr=os.sortIndex-Ur.sortIndex;return Vr!==0?Vr:os.id-Ur.id}if(typeof performance=="object"&&typeof performance.now=="function"){var dr=performance;ar.unstable_now=function(){return dr.now()}}else{var hr=Date,pr=hr.now();ar.unstable_now=function(){return hr.now()-pr}}var mr=[],fr=[],xr=1,Er=null,vr=3,gr=!1,yr=!1,br=!1,_r=typeof setTimeout=="function"?setTimeout:null,jr=typeof clearTimeout=="function"?clearTimeout:null,wr=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Sr(os){for(var Ur=lr(fr);Ur!==null;){if(Ur.callback===null)cr(fr);else if(Ur.startTime<=os)cr(fr),Ur.sortIndex=Ur.expirationTime,or(mr,Ur);else break;Ur=lr(fr)}}function Tr(os){if(br=!1,Sr(os),!yr)if(lr(mr)!==null)yr=!0,Zr(Rr);else{var Ur=lr(fr);Ur!==null&&Jr(Tr,Ur.startTime-os)}}function Rr(os,Ur){yr=!1,br&&(br=!1,jr(kr),kr=-1),gr=!0;var Vr=vr;try{for(Sr(Ur),Er=lr(mr);Er!==null&&(!(Er.expirationTime>Ur)||os&&!Lr());){var es=Er.callback;if(typeof es=="function"){Er.callback=null,vr=Er.priorityLevel;var Ir=es(Er.expirationTime<=Ur);Ur=ar.unstable_now(),typeof Ir=="function"?Er.callback=Ir:Er===lr(mr)&&cr(mr),Sr(Ur)}else cr(mr);Er=lr(mr)}if(Er!==null)var Dr=!0;else{var Pr=lr(fr);Pr!==null&&Jr(Tr,Pr.startTime-Ur),Dr=!1}return Dr}finally{Er=null,vr=Vr,gr=!1}}var Nr=!1,Cr=null,kr=-1,Ar=5,Or=-1;function Lr(){return!(ar.unstable_now()-Or<Ar)}function Fr(){if(Cr!==null){var os=ar.unstable_now();Or=os;var Ur=!0;try{Ur=Cr(!0,os)}finally{Ur?Hr():(Nr=!1,Cr=null)}}else Nr=!1}var Hr;if(typeof wr=="function")Hr=function(){wr(Fr)};else if(typeof MessageChannel<"u"){var Kr=new MessageChannel,Gr=Kr.port2;Kr.port1.onmessage=Fr,Hr=function(){Gr.postMessage(null)}}else Hr=function(){_r(Fr,0)};function Zr(os){Cr=os,Nr||(Nr=!0,Hr())}function Jr(os,Ur){kr=_r(function(){os(ar.unstable_now())},Ur)}ar.unstable_IdlePriority=5,ar.unstable_ImmediatePriority=1,ar.unstable_LowPriority=4,ar.unstable_NormalPriority=3,ar.unstable_Profiling=null,ar.unstable_UserBlockingPriority=2,ar.unstable_cancelCallback=function(os){os.callback=null},ar.unstable_continueExecution=function(){yr||gr||(yr=!0,Zr(Rr))},ar.unstable_forceFrameRate=function(os){0>os||125<os?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ar=0<os?Math.floor(1e3/os):5},ar.unstable_getCurrentPriorityLevel=function(){return vr},ar.unstable_getFirstCallbackNode=function(){return lr(mr)},ar.unstable_next=function(os){switch(vr){case 1:case 2:case 3:var Ur=3;break;default:Ur=vr}var Vr=vr;vr=Ur;try{return os()}finally{vr=Vr}},ar.unstable_pauseExecution=function(){},ar.unstable_requestPaint=function(){},ar.unstable_runWithPriority=function(os,Ur){switch(os){case 1:case 2:case 3:case 4:case 5:break;default:os=3}var Vr=vr;vr=os;try{return Ur()}finally{vr=Vr}},ar.unstable_scheduleCallback=function(os,Ur,Vr){var es=ar.unstable_now();switch(typeof Vr=="object"&&Vr!==null?(Vr=Vr.delay,Vr=typeof Vr=="number"&&0<Vr?es+Vr:es):Vr=es,os){case 1:var Ir=-1;break;case 2:Ir=250;break;case 5:Ir=1073741823;break;case 4:Ir=1e4;break;default:Ir=5e3}return Ir=Vr+Ir,os={id:xr++,callback:Ur,priorityLevel:os,startTime:Vr,expirationTime:Ir,sortIndex:-1},Vr>es?(os.sortIndex=Vr,or(fr,os),lr(mr)===null&&os===lr(fr)&&(br?(jr(kr),kr=-1):br=!0,Jr(Tr,Vr-es))):(os.sortIndex=Ir,or(mr,os),yr||gr||(yr=!0,Zr(Rr))),os},ar.unstable_shouldYield=Lr,ar.unstable_wrapCallback=function(os){var Ur=vr;return function(){var Vr=vr;vr=Ur;try{return os.apply(this,arguments)}finally{vr=Vr}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(ar){for(var or="https://reactjs.org/docs/error-decoder.html?invariant="+ar,lr=1;lr<arguments.length;lr++)or+="&args[]="+encodeURIComponent(arguments[lr]);return"Minified React error #"+ar+"; visit "+or+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(ar,or){ha(ar,or),ha(ar+"Capture",or)}function ha(ar,or){for(ea[ar]=or,ar=0;ar<or.length;ar++)da.add(or[ar])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(ar){return ja.call(ma,ar)?!0:ja.call(la,ar)?!1:ka.test(ar)?ma[ar]=!0:(la[ar]=!0,!1)}function pa(ar,or,lr,cr){if(lr!==null&&lr.type===0)return!1;switch(typeof or){case"function":case"symbol":return!0;case"boolean":return cr?!1:lr!==null?!lr.acceptsBooleans:(ar=ar.toLowerCase().slice(0,5),ar!=="data-"&&ar!=="aria-");default:return!1}}function qa(ar,or,lr,cr){if(or===null||typeof or>"u"||pa(ar,or,lr,cr))return!0;if(cr)return!1;if(lr!==null)switch(lr.type){case 3:return!or;case 4:return or===!1;case 5:return isNaN(or);case 6:return isNaN(or)||1>or}return!1}function v$1(ar,or,lr,cr,ur,dr,hr){this.acceptsBooleans=or===2||or===3||or===4,this.attributeName=cr,this.attributeNamespace=ur,this.mustUseProperty=lr,this.propertyName=ar,this.type=or,this.sanitizeURL=dr,this.removeEmptyString=hr}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(ar){z$1[ar]=new v$1(ar,0,!1,ar,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(ar){var or=ar[0];z$1[or]=new v$1(or,1,!1,ar[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(ar){z$1[ar]=new v$1(ar,2,!1,ar.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(ar){z$1[ar]=new v$1(ar,2,!1,ar,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(ar){z$1[ar]=new v$1(ar,3,!1,ar.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(ar){z$1[ar]=new v$1(ar,3,!0,ar,null,!1,!1)});["capture","download"].forEach(function(ar){z$1[ar]=new v$1(ar,4,!1,ar,null,!1,!1)});["cols","rows","size","span"].forEach(function(ar){z$1[ar]=new v$1(ar,6,!1,ar,null,!1,!1)});["rowSpan","start"].forEach(function(ar){z$1[ar]=new v$1(ar,5,!1,ar.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(ar){return ar[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(ar){var or=ar.replace(ra,sa);z$1[or]=new v$1(or,1,!1,ar,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(ar){var or=ar.replace(ra,sa);z$1[or]=new v$1(or,1,!1,ar,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(ar){var or=ar.replace(ra,sa);z$1[or]=new v$1(or,1,!1,ar,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(ar){z$1[ar]=new v$1(ar,1,!1,ar.toLowerCase(),null,!1,!1)});z$1.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(ar){z$1[ar]=new v$1(ar,1,!1,ar.toLowerCase(),null,!0,!0)});function ta(ar,or,lr,cr){var ur=z$1.hasOwnProperty(or)?z$1[or]:null;(ur!==null?ur.type!==0:cr||!(2<or.length)||or[0]!=="o"&&or[0]!=="O"||or[1]!=="n"&&or[1]!=="N")&&(qa(or,lr,ur,cr)&&(lr=null),cr||ur===null?oa(or)&&(lr===null?ar.removeAttribute(or):ar.setAttribute(or,""+lr)):ur.mustUseProperty?ar[ur.propertyName]=lr===null?ur.type===3?!1:"":lr:(or=ur.attributeName,cr=ur.attributeNamespace,lr===null?ar.removeAttribute(or):(ur=ur.type,lr=ur===3||ur===4&&lr===!0?"":""+lr,cr?ar.setAttributeNS(cr,or,lr):ar.setAttribute(or,lr))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(ar){return ar===null||typeof ar!="object"?null:(ar=Ja&&ar[Ja]||ar["@@iterator"],typeof ar=="function"?ar:null)}var A$1=Object.assign,La;function Ma(ar){if(La===void 0)try{throw Error()}catch(lr){var or=lr.stack.trim().match(/\n( *(at )?)/);La=or&&or[1]||""}return`
`+La+ar}var Na=!1;function Oa(ar,or){if(!ar||Na)return"";Na=!0;var lr=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(or)if(or=function(){throw Error()},Object.defineProperty(or.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(or,[])}catch(fr){var cr=fr}Reflect.construct(ar,[],or)}else{try{or.call()}catch(fr){cr=fr}ar.call(or.prototype)}else{try{throw Error()}catch(fr){cr=fr}ar()}}catch(fr){if(fr&&cr&&typeof fr.stack=="string"){for(var ur=fr.stack.split(`
`),dr=cr.stack.split(`
`),hr=ur.length-1,pr=dr.length-1;1<=hr&&0<=pr&&ur[hr]!==dr[pr];)pr--;for(;1<=hr&&0<=pr;hr--,pr--)if(ur[hr]!==dr[pr]){if(hr!==1||pr!==1)do if(hr--,pr--,0>pr||ur[hr]!==dr[pr]){var mr=`
`+ur[hr].replace(" at new "," at ");return ar.displayName&&mr.includes("<anonymous>")&&(mr=mr.replace("<anonymous>",ar.displayName)),mr}while(1<=hr&&0<=pr);break}}}finally{Na=!1,Error.prepareStackTrace=lr}return(ar=ar?ar.displayName||ar.name:"")?Ma(ar):""}function Pa(ar){switch(ar.tag){case 5:return Ma(ar.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return ar=Oa(ar.type,!1),ar;case 11:return ar=Oa(ar.type.render,!1),ar;case 1:return ar=Oa(ar.type,!0),ar;default:return""}}function Qa(ar){if(ar==null)return null;if(typeof ar=="function")return ar.displayName||ar.name||null;if(typeof ar=="string")return ar;switch(ar){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof ar=="object")switch(ar.$$typeof){case Ca:return(ar.displayName||"Context")+".Consumer";case Ba:return(ar._context.displayName||"Context")+".Provider";case Da:var or=ar.render;return ar=ar.displayName,ar||(ar=or.displayName||or.name||"",ar=ar!==""?"ForwardRef("+ar+")":"ForwardRef"),ar;case Ga:return or=ar.displayName||null,or!==null?or:Qa(ar.type)||"Memo";case Ha:or=ar._payload,ar=ar._init;try{return Qa(ar(or))}catch{}}return null}function Ra(ar){var or=ar.type;switch(ar.tag){case 24:return"Cache";case 9:return(or.displayName||"Context")+".Consumer";case 10:return(or._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return ar=or.render,ar=ar.displayName||ar.name||"",or.displayName||(ar!==""?"ForwardRef("+ar+")":"ForwardRef");case 7:return"Fragment";case 5:return or;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(or);case 8:return or===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof or=="function")return or.displayName||or.name||null;if(typeof or=="string")return or}return null}function Sa(ar){switch(typeof ar){case"boolean":case"number":case"string":case"undefined":return ar;case"object":return ar;default:return""}}function Ta(ar){var or=ar.type;return(ar=ar.nodeName)&&ar.toLowerCase()==="input"&&(or==="checkbox"||or==="radio")}function Ua(ar){var or=Ta(ar)?"checked":"value",lr=Object.getOwnPropertyDescriptor(ar.constructor.prototype,or),cr=""+ar[or];if(!ar.hasOwnProperty(or)&&typeof lr<"u"&&typeof lr.get=="function"&&typeof lr.set=="function"){var ur=lr.get,dr=lr.set;return Object.defineProperty(ar,or,{configurable:!0,get:function(){return ur.call(this)},set:function(hr){cr=""+hr,dr.call(this,hr)}}),Object.defineProperty(ar,or,{enumerable:lr.enumerable}),{getValue:function(){return cr},setValue:function(hr){cr=""+hr},stopTracking:function(){ar._valueTracker=null,delete ar[or]}}}}function Va(ar){ar._valueTracker||(ar._valueTracker=Ua(ar))}function Wa(ar){if(!ar)return!1;var or=ar._valueTracker;if(!or)return!0;var lr=or.getValue(),cr="";return ar&&(cr=Ta(ar)?ar.checked?"true":"false":ar.value),ar=cr,ar!==lr?(or.setValue(ar),!0):!1}function Xa(ar){if(ar=ar||(typeof document<"u"?document:void 0),typeof ar>"u")return null;try{return ar.activeElement||ar.body}catch{return ar.body}}function Ya(ar,or){var lr=or.checked;return A$1({},or,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:lr??ar._wrapperState.initialChecked})}function Za(ar,or){var lr=or.defaultValue==null?"":or.defaultValue,cr=or.checked!=null?or.checked:or.defaultChecked;lr=Sa(or.value!=null?or.value:lr),ar._wrapperState={initialChecked:cr,initialValue:lr,controlled:or.type==="checkbox"||or.type==="radio"?or.checked!=null:or.value!=null}}function ab(ar,or){or=or.checked,or!=null&&ta(ar,"checked",or,!1)}function bb(ar,or){ab(ar,or);var lr=Sa(or.value),cr=or.type;if(lr!=null)cr==="number"?(lr===0&&ar.value===""||ar.value!=lr)&&(ar.value=""+lr):ar.value!==""+lr&&(ar.value=""+lr);else if(cr==="submit"||cr==="reset"){ar.removeAttribute("value");return}or.hasOwnProperty("value")?cb(ar,or.type,lr):or.hasOwnProperty("defaultValue")&&cb(ar,or.type,Sa(or.defaultValue)),or.checked==null&&or.defaultChecked!=null&&(ar.defaultChecked=!!or.defaultChecked)}function db$1(ar,or,lr){if(or.hasOwnProperty("value")||or.hasOwnProperty("defaultValue")){var cr=or.type;if(!(cr!=="submit"&&cr!=="reset"||or.value!==void 0&&or.value!==null))return;or=""+ar._wrapperState.initialValue,lr||or===ar.value||(ar.value=or),ar.defaultValue=or}lr=ar.name,lr!==""&&(ar.name=""),ar.defaultChecked=!!ar._wrapperState.initialChecked,lr!==""&&(ar.name=lr)}function cb(ar,or,lr){(or!=="number"||Xa(ar.ownerDocument)!==ar)&&(lr==null?ar.defaultValue=""+ar._wrapperState.initialValue:ar.defaultValue!==""+lr&&(ar.defaultValue=""+lr))}var eb=Array.isArray;function fb(ar,or,lr,cr){if(ar=ar.options,or){or={};for(var ur=0;ur<lr.length;ur++)or["$"+lr[ur]]=!0;for(lr=0;lr<ar.length;lr++)ur=or.hasOwnProperty("$"+ar[lr].value),ar[lr].selected!==ur&&(ar[lr].selected=ur),ur&&cr&&(ar[lr].defaultSelected=!0)}else{for(lr=""+Sa(lr),or=null,ur=0;ur<ar.length;ur++){if(ar[ur].value===lr){ar[ur].selected=!0,cr&&(ar[ur].defaultSelected=!0);return}or!==null||ar[ur].disabled||(or=ar[ur])}or!==null&&(or.selected=!0)}}function gb(ar,or){if(or.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},or,{value:void 0,defaultValue:void 0,children:""+ar._wrapperState.initialValue})}function hb(ar,or){var lr=or.value;if(lr==null){if(lr=or.children,or=or.defaultValue,lr!=null){if(or!=null)throw Error(p$1(92));if(eb(lr)){if(1<lr.length)throw Error(p$1(93));lr=lr[0]}or=lr}or==null&&(or=""),lr=or}ar._wrapperState={initialValue:Sa(lr)}}function ib(ar,or){var lr=Sa(or.value),cr=Sa(or.defaultValue);lr!=null&&(lr=""+lr,lr!==ar.value&&(ar.value=lr),or.defaultValue==null&&ar.defaultValue!==lr&&(ar.defaultValue=lr)),cr!=null&&(ar.defaultValue=""+cr)}function jb(ar){var or=ar.textContent;or===ar._wrapperState.initialValue&&or!==""&&or!==null&&(ar.value=or)}function kb(ar){switch(ar){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(ar,or){return ar==null||ar==="http://www.w3.org/1999/xhtml"?kb(or):ar==="http://www.w3.org/2000/svg"&&or==="foreignObject"?"http://www.w3.org/1999/xhtml":ar}var mb,nb=function(ar){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(or,lr,cr,ur){MSApp.execUnsafeLocalFunction(function(){return ar(or,lr,cr,ur)})}:ar}(function(ar,or){if(ar.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in ar)ar.innerHTML=or;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+or.valueOf().toString()+"</svg>",or=mb.firstChild;ar.firstChild;)ar.removeChild(ar.firstChild);for(;or.firstChild;)ar.appendChild(or.firstChild)}});function ob(ar,or){if(or){var lr=ar.firstChild;if(lr&&lr===ar.lastChild&&lr.nodeType===3){lr.nodeValue=or;return}}ar.textContent=or}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(ar){qb.forEach(function(or){or=or+ar.charAt(0).toUpperCase()+ar.substring(1),pb[or]=pb[ar]})});function rb(ar,or,lr){return or==null||typeof or=="boolean"||or===""?"":lr||typeof or!="number"||or===0||pb.hasOwnProperty(ar)&&pb[ar]?(""+or).trim():or+"px"}function sb(ar,or){ar=ar.style;for(var lr in or)if(or.hasOwnProperty(lr)){var cr=lr.indexOf("--")===0,ur=rb(lr,or[lr],cr);lr==="float"&&(lr="cssFloat"),cr?ar.setProperty(lr,ur):ar[lr]=ur}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(ar,or){if(or){if(tb[ar]&&(or.children!=null||or.dangerouslySetInnerHTML!=null))throw Error(p$1(137,ar));if(or.dangerouslySetInnerHTML!=null){if(or.children!=null)throw Error(p$1(60));if(typeof or.dangerouslySetInnerHTML!="object"||!("__html"in or.dangerouslySetInnerHTML))throw Error(p$1(61))}if(or.style!=null&&typeof or.style!="object")throw Error(p$1(62))}}function vb(ar,or){if(ar.indexOf("-")===-1)return typeof or.is=="string";switch(ar){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(ar){return ar=ar.target||ar.srcElement||window,ar.correspondingUseElement&&(ar=ar.correspondingUseElement),ar.nodeType===3?ar.parentNode:ar}var yb=null,zb=null,Ab=null;function Bb(ar){if(ar=Cb(ar)){if(typeof yb!="function")throw Error(p$1(280));var or=ar.stateNode;or&&(or=Db(or),yb(ar.stateNode,ar.type,or))}}function Eb(ar){zb?Ab?Ab.push(ar):Ab=[ar]:zb=ar}function Fb(){if(zb){var ar=zb,or=Ab;if(Ab=zb=null,Bb(ar),or)for(ar=0;ar<or.length;ar++)Bb(or[ar])}}function Gb(ar,or){return ar(or)}function Hb(){}var Ib=!1;function Jb(ar,or,lr){if(Ib)return ar(or,lr);Ib=!0;try{return Gb(ar,or,lr)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(ar,or){var lr=ar.stateNode;if(lr===null)return null;var cr=Db(lr);if(cr===null)return null;lr=cr[or];e:switch(or){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(cr=!cr.disabled)||(ar=ar.type,cr=!(ar==="button"||ar==="input"||ar==="select"||ar==="textarea")),ar=!cr;break e;default:ar=!1}if(ar)return null;if(lr&&typeof lr!="function")throw Error(p$1(231,or,typeof lr));return lr}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(ar,or,lr,cr,ur,dr,hr,pr,mr){var fr=Array.prototype.slice.call(arguments,3);try{or.apply(lr,fr)}catch(xr){this.onError(xr)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(ar){Ob=!0,Pb=ar}};function Tb(ar,or,lr,cr,ur,dr,hr,pr,mr){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(ar,or,lr,cr,ur,dr,hr,pr,mr){if(Tb.apply(this,arguments),Ob){if(Ob){var fr=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=fr)}}function Vb(ar){var or=ar,lr=ar;if(ar.alternate)for(;or.return;)or=or.return;else{ar=or;do or=ar,or.flags&4098&&(lr=or.return),ar=or.return;while(ar)}return or.tag===3?lr:null}function Wb(ar){if(ar.tag===13){var or=ar.memoizedState;if(or===null&&(ar=ar.alternate,ar!==null&&(or=ar.memoizedState)),or!==null)return or.dehydrated}return null}function Xb(ar){if(Vb(ar)!==ar)throw Error(p$1(188))}function Yb(ar){var or=ar.alternate;if(!or){if(or=Vb(ar),or===null)throw Error(p$1(188));return or!==ar?null:ar}for(var lr=ar,cr=or;;){var ur=lr.return;if(ur===null)break;var dr=ur.alternate;if(dr===null){if(cr=ur.return,cr!==null){lr=cr;continue}break}if(ur.child===dr.child){for(dr=ur.child;dr;){if(dr===lr)return Xb(ur),ar;if(dr===cr)return Xb(ur),or;dr=dr.sibling}throw Error(p$1(188))}if(lr.return!==cr.return)lr=ur,cr=dr;else{for(var hr=!1,pr=ur.child;pr;){if(pr===lr){hr=!0,lr=ur,cr=dr;break}if(pr===cr){hr=!0,cr=ur,lr=dr;break}pr=pr.sibling}if(!hr){for(pr=dr.child;pr;){if(pr===lr){hr=!0,lr=dr,cr=ur;break}if(pr===cr){hr=!0,cr=dr,lr=ur;break}pr=pr.sibling}if(!hr)throw Error(p$1(189))}}if(lr.alternate!==cr)throw Error(p$1(190))}if(lr.tag!==3)throw Error(p$1(188));return lr.stateNode.current===lr?ar:or}function Zb(ar){return ar=Yb(ar),ar!==null?$b(ar):null}function $b(ar){if(ar.tag===5||ar.tag===6)return ar;for(ar=ar.child;ar!==null;){var or=$b(ar);if(or!==null)return or;ar=ar.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(ar){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,ar,void 0,(ar.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(ar){return ar>>>=0,ar===0?32:31-(pc(ar)/qc|0)|0}var rc=64,sc=4194304;function tc(ar){switch(ar&-ar){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return ar&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return ar&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return ar}}function uc(ar,or){var lr=ar.pendingLanes;if(lr===0)return 0;var cr=0,ur=ar.suspendedLanes,dr=ar.pingedLanes,hr=lr&268435455;if(hr!==0){var pr=hr&~ur;pr!==0?cr=tc(pr):(dr&=hr,dr!==0&&(cr=tc(dr)))}else hr=lr&~ur,hr!==0?cr=tc(hr):dr!==0&&(cr=tc(dr));if(cr===0)return 0;if(or!==0&&or!==cr&&!(or&ur)&&(ur=cr&-cr,dr=or&-or,ur>=dr||ur===16&&(dr&4194240)!==0))return or;if(cr&4&&(cr|=lr&16),or=ar.entangledLanes,or!==0)for(ar=ar.entanglements,or&=cr;0<or;)lr=31-oc(or),ur=1<<lr,cr|=ar[lr],or&=~ur;return cr}function vc(ar,or){switch(ar){case 1:case 2:case 4:return or+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return or+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(ar,or){for(var lr=ar.suspendedLanes,cr=ar.pingedLanes,ur=ar.expirationTimes,dr=ar.pendingLanes;0<dr;){var hr=31-oc(dr),pr=1<<hr,mr=ur[hr];mr===-1?(!(pr&lr)||pr&cr)&&(ur[hr]=vc(pr,or)):mr<=or&&(ar.expiredLanes|=pr),dr&=~pr}}function xc(ar){return ar=ar.pendingLanes&-1073741825,ar!==0?ar:ar&1073741824?1073741824:0}function yc(){var ar=rc;return rc<<=1,!(rc&4194240)&&(rc=64),ar}function zc(ar){for(var or=[],lr=0;31>lr;lr++)or.push(ar);return or}function Ac(ar,or,lr){ar.pendingLanes|=or,or!==536870912&&(ar.suspendedLanes=0,ar.pingedLanes=0),ar=ar.eventTimes,or=31-oc(or),ar[or]=lr}function Bc(ar,or){var lr=ar.pendingLanes&~or;ar.pendingLanes=or,ar.suspendedLanes=0,ar.pingedLanes=0,ar.expiredLanes&=or,ar.mutableReadLanes&=or,ar.entangledLanes&=or,or=ar.entanglements;var cr=ar.eventTimes;for(ar=ar.expirationTimes;0<lr;){var ur=31-oc(lr),dr=1<<ur;or[ur]=0,cr[ur]=-1,ar[ur]=-1,lr&=~dr}}function Cc(ar,or){var lr=ar.entangledLanes|=or;for(ar=ar.entanglements;lr;){var cr=31-oc(lr),ur=1<<cr;ur&or|ar[cr]&or&&(ar[cr]|=or),lr&=~ur}}var C$1=0;function Dc(ar){return ar&=-ar,1<ar?4<ar?ar&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(ar,or){switch(ar){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(or.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(or.pointerId)}}function Tc(ar,or,lr,cr,ur,dr){return ar===null||ar.nativeEvent!==dr?(ar={blockedOn:or,domEventName:lr,eventSystemFlags:cr,nativeEvent:dr,targetContainers:[ur]},or!==null&&(or=Cb(or),or!==null&&Fc(or)),ar):(ar.eventSystemFlags|=cr,or=ar.targetContainers,ur!==null&&or.indexOf(ur)===-1&&or.push(ur),ar)}function Uc(ar,or,lr,cr,ur){switch(or){case"focusin":return Lc=Tc(Lc,ar,or,lr,cr,ur),!0;case"dragenter":return Mc=Tc(Mc,ar,or,lr,cr,ur),!0;case"mouseover":return Nc=Tc(Nc,ar,or,lr,cr,ur),!0;case"pointerover":var dr=ur.pointerId;return Oc.set(dr,Tc(Oc.get(dr)||null,ar,or,lr,cr,ur)),!0;case"gotpointercapture":return dr=ur.pointerId,Pc.set(dr,Tc(Pc.get(dr)||null,ar,or,lr,cr,ur)),!0}return!1}function Vc(ar){var or=Wc(ar.target);if(or!==null){var lr=Vb(or);if(lr!==null){if(or=lr.tag,or===13){if(or=Wb(lr),or!==null){ar.blockedOn=or,Ic(ar.priority,function(){Gc(lr)});return}}else if(or===3&&lr.stateNode.current.memoizedState.isDehydrated){ar.blockedOn=lr.tag===3?lr.stateNode.containerInfo:null;return}}}ar.blockedOn=null}function Xc(ar){if(ar.blockedOn!==null)return!1;for(var or=ar.targetContainers;0<or.length;){var lr=Yc(ar.domEventName,ar.eventSystemFlags,or[0],ar.nativeEvent);if(lr===null){lr=ar.nativeEvent;var cr=new lr.constructor(lr.type,lr);wb=cr,lr.target.dispatchEvent(cr),wb=null}else return or=Cb(lr),or!==null&&Fc(or),ar.blockedOn=lr,!1;or.shift()}return!0}function Zc(ar,or,lr){Xc(ar)&&lr.delete(or)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(ar,or){ar.blockedOn===or&&(ar.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(ar){function or(ur){return ad(ur,ar)}if(0<Kc.length){ad(Kc[0],ar);for(var lr=1;lr<Kc.length;lr++){var cr=Kc[lr];cr.blockedOn===ar&&(cr.blockedOn=null)}}for(Lc!==null&&ad(Lc,ar),Mc!==null&&ad(Mc,ar),Nc!==null&&ad(Nc,ar),Oc.forEach(or),Pc.forEach(or),lr=0;lr<Qc.length;lr++)cr=Qc[lr],cr.blockedOn===ar&&(cr.blockedOn=null);for(;0<Qc.length&&(lr=Qc[0],lr.blockedOn===null);)Vc(lr),lr.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(ar,or,lr,cr){var ur=C$1,dr=cd.transition;cd.transition=null;try{C$1=1,fd(ar,or,lr,cr)}finally{C$1=ur,cd.transition=dr}}function gd(ar,or,lr,cr){var ur=C$1,dr=cd.transition;cd.transition=null;try{C$1=4,fd(ar,or,lr,cr)}finally{C$1=ur,cd.transition=dr}}function fd(ar,or,lr,cr){if(dd){var ur=Yc(ar,or,lr,cr);if(ur===null)hd(ar,or,cr,id,lr),Sc(ar,cr);else if(Uc(ur,ar,or,lr,cr))cr.stopPropagation();else if(Sc(ar,cr),or&4&&-1<Rc.indexOf(ar)){for(;ur!==null;){var dr=Cb(ur);if(dr!==null&&Ec(dr),dr=Yc(ar,or,lr,cr),dr===null&&hd(ar,or,cr,id,lr),dr===ur)break;ur=dr}ur!==null&&cr.stopPropagation()}else hd(ar,or,cr,null,lr)}}var id=null;function Yc(ar,or,lr,cr){if(id=null,ar=xb(cr),ar=Wc(ar),ar!==null)if(or=Vb(ar),or===null)ar=null;else if(lr=or.tag,lr===13){if(ar=Wb(or),ar!==null)return ar;ar=null}else if(lr===3){if(or.stateNode.current.memoizedState.isDehydrated)return or.tag===3?or.stateNode.containerInfo:null;ar=null}else or!==ar&&(ar=null);return id=ar,null}function jd(ar){switch(ar){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var ar,or=ld,lr=or.length,cr,ur="value"in kd?kd.value:kd.textContent,dr=ur.length;for(ar=0;ar<lr&&or[ar]===ur[ar];ar++);var hr=lr-ar;for(cr=1;cr<=hr&&or[lr-cr]===ur[dr-cr];cr++);return md=ur.slice(ar,1<cr?1-cr:void 0)}function od(ar){var or=ar.keyCode;return"charCode"in ar?(ar=ar.charCode,ar===0&&or===13&&(ar=13)):ar=or,ar===10&&(ar=13),32<=ar||ar===13?ar:0}function pd(){return!0}function qd(){return!1}function rd(ar){function or(lr,cr,ur,dr,hr){this._reactName=lr,this._targetInst=ur,this.type=cr,this.nativeEvent=dr,this.target=hr,this.currentTarget=null;for(var pr in ar)ar.hasOwnProperty(pr)&&(lr=ar[pr],this[pr]=lr?lr(dr):dr[pr]);return this.isDefaultPrevented=(dr.defaultPrevented!=null?dr.defaultPrevented:dr.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(or.prototype,{preventDefault:function(){this.defaultPrevented=!0;var lr=this.nativeEvent;lr&&(lr.preventDefault?lr.preventDefault():typeof lr.returnValue!="unknown"&&(lr.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var lr=this.nativeEvent;lr&&(lr.stopPropagation?lr.stopPropagation():typeof lr.cancelBubble!="unknown"&&(lr.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),or}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(ar){return ar.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(ar){return ar.relatedTarget===void 0?ar.fromElement===ar.srcElement?ar.toElement:ar.fromElement:ar.relatedTarget},movementX:function(ar){return"movementX"in ar?ar.movementX:(ar!==yd&&(yd&&ar.type==="mousemove"?(wd=ar.screenX-yd.screenX,xd=ar.screenY-yd.screenY):xd=wd=0,yd=ar),wd)},movementY:function(ar){return"movementY"in ar?ar.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(ar){return"clipboardData"in ar?ar.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(ar){var or=this.nativeEvent;return or.getModifierState?or.getModifierState(ar):(ar=Od[ar])?!!or[ar]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(ar){if(ar.key){var or=Md[ar.key]||ar.key;if(or!=="Unidentified")return or}return ar.type==="keypress"?(ar=od(ar),ar===13?"Enter":String.fromCharCode(ar)):ar.type==="keydown"||ar.type==="keyup"?Nd[ar.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(ar){return ar.type==="keypress"?od(ar):0},keyCode:function(ar){return ar.type==="keydown"||ar.type==="keyup"?ar.keyCode:0},which:function(ar){return ar.type==="keypress"?od(ar):ar.type==="keydown"||ar.type==="keyup"?ar.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(ar){return"deltaX"in ar?ar.deltaX:"wheelDeltaX"in ar?-ar.wheelDeltaX:0},deltaY:function(ar){return"deltaY"in ar?ar.deltaY:"wheelDeltaY"in ar?-ar.wheelDeltaY:"wheelDelta"in ar?-ar.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe$1=!1;function ge$1(ar,or){switch(ar){case"keyup":return $d.indexOf(or.keyCode)!==-1;case"keydown":return or.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(ar){return ar=ar.detail,typeof ar=="object"&&"data"in ar?ar.data:null}var ie$1=!1;function je$1(ar,or){switch(ar){case"compositionend":return he$1(or);case"keypress":return or.which!==32?null:(fe$1=!0,ee$1);case"textInput":return ar=or.data,ar===ee$1&&fe$1?null:ar;default:return null}}function ke$1(ar,or){if(ie$1)return ar==="compositionend"||!ae$1&&ge$1(ar,or)?(ar=nd(),md=ld=kd=null,ie$1=!1,ar):null;switch(ar){case"paste":return null;case"keypress":if(!(or.ctrlKey||or.altKey||or.metaKey)||or.ctrlKey&&or.altKey){if(or.char&&1<or.char.length)return or.char;if(or.which)return String.fromCharCode(or.which)}return null;case"compositionend":return de$1&&or.locale!=="ko"?null:or.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(ar){var or=ar&&ar.nodeName&&ar.nodeName.toLowerCase();return or==="input"?!!le$1[ar.type]:or==="textarea"}function ne$1(ar,or,lr,cr){Eb(cr),or=oe$1(or,"onChange"),0<or.length&&(lr=new td("onChange","change",null,lr,cr),ar.push({event:lr,listeners:or}))}var pe$1=null,qe$1=null;function re$1(ar){se$1(ar,0)}function te$1(ar){var or=ue$1(ar);if(Wa(or))return ar}function ve$1(ar,or){if(ar==="change")return or}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye$1=typeof ze$1.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(ar){if(ar.propertyName==="value"&&te$1(qe$1)){var or=[];ne$1(or,qe$1,ar,xb(ar)),Jb(re$1,or)}}function Ce$1(ar,or,lr){ar==="focusin"?(Ae$1(),pe$1=or,qe$1=lr,pe$1.attachEvent("onpropertychange",Be$1)):ar==="focusout"&&Ae$1()}function De$1(ar){if(ar==="selectionchange"||ar==="keyup"||ar==="keydown")return te$1(qe$1)}function Ee$1(ar,or){if(ar==="click")return te$1(or)}function Fe$1(ar,or){if(ar==="input"||ar==="change")return te$1(or)}function Ge$1(ar,or){return ar===or&&(ar!==0||1/ar===1/or)||ar!==ar&&or!==or}var He$1=typeof Object.is=="function"?Object.is:Ge$1;function Ie$1(ar,or){if(He$1(ar,or))return!0;if(typeof ar!="object"||ar===null||typeof or!="object"||or===null)return!1;var lr=Object.keys(ar),cr=Object.keys(or);if(lr.length!==cr.length)return!1;for(cr=0;cr<lr.length;cr++){var ur=lr[cr];if(!ja.call(or,ur)||!He$1(ar[ur],or[ur]))return!1}return!0}function Je$1(ar){for(;ar&&ar.firstChild;)ar=ar.firstChild;return ar}function Ke$1(ar,or){var lr=Je$1(ar);ar=0;for(var cr;lr;){if(lr.nodeType===3){if(cr=ar+lr.textContent.length,ar<=or&&cr>=or)return{node:lr,offset:or-ar};ar=cr}e:{for(;lr;){if(lr.nextSibling){lr=lr.nextSibling;break e}lr=lr.parentNode}lr=void 0}lr=Je$1(lr)}}function Le$1(ar,or){return ar&&or?ar===or?!0:ar&&ar.nodeType===3?!1:or&&or.nodeType===3?Le$1(ar,or.parentNode):"contains"in ar?ar.contains(or):ar.compareDocumentPosition?!!(ar.compareDocumentPosition(or)&16):!1:!1}function Me$1(){for(var ar=window,or=Xa();or instanceof ar.HTMLIFrameElement;){try{var lr=typeof or.contentWindow.location.href=="string"}catch{lr=!1}if(lr)ar=or.contentWindow;else break;or=Xa(ar.document)}return or}function Ne$1(ar){var or=ar&&ar.nodeName&&ar.nodeName.toLowerCase();return or&&(or==="input"&&(ar.type==="text"||ar.type==="search"||ar.type==="tel"||ar.type==="url"||ar.type==="password")||or==="textarea"||ar.contentEditable==="true")}function Oe$1(ar){var or=Me$1(),lr=ar.focusedElem,cr=ar.selectionRange;if(or!==lr&&lr&&lr.ownerDocument&&Le$1(lr.ownerDocument.documentElement,lr)){if(cr!==null&&Ne$1(lr)){if(or=cr.start,ar=cr.end,ar===void 0&&(ar=or),"selectionStart"in lr)lr.selectionStart=or,lr.selectionEnd=Math.min(ar,lr.value.length);else if(ar=(or=lr.ownerDocument||document)&&or.defaultView||window,ar.getSelection){ar=ar.getSelection();var ur=lr.textContent.length,dr=Math.min(cr.start,ur);cr=cr.end===void 0?dr:Math.min(cr.end,ur),!ar.extend&&dr>cr&&(ur=cr,cr=dr,dr=ur),ur=Ke$1(lr,dr);var hr=Ke$1(lr,cr);ur&&hr&&(ar.rangeCount!==1||ar.anchorNode!==ur.node||ar.anchorOffset!==ur.offset||ar.focusNode!==hr.node||ar.focusOffset!==hr.offset)&&(or=or.createRange(),or.setStart(ur.node,ur.offset),ar.removeAllRanges(),dr>cr?(ar.addRange(or),ar.extend(hr.node,hr.offset)):(or.setEnd(hr.node,hr.offset),ar.addRange(or)))}}for(or=[],ar=lr;ar=ar.parentNode;)ar.nodeType===1&&or.push({element:ar,left:ar.scrollLeft,top:ar.scrollTop});for(typeof lr.focus=="function"&&lr.focus(),lr=0;lr<or.length;lr++)ar=or[lr],ar.element.scrollLeft=ar.left,ar.element.scrollTop=ar.top}}var Pe$1=ia&&"documentMode"in document&&11>=document.documentMode,Qe$1=null,Re$1=null,Se$1=null,Te$1=!1;function Ue$1(ar,or,lr){var cr=lr.window===lr?lr.document:lr.nodeType===9?lr:lr.ownerDocument;Te$1||Qe$1==null||Qe$1!==Xa(cr)||(cr=Qe$1,"selectionStart"in cr&&Ne$1(cr)?cr={start:cr.selectionStart,end:cr.selectionEnd}:(cr=(cr.ownerDocument&&cr.ownerDocument.defaultView||window).getSelection(),cr={anchorNode:cr.anchorNode,anchorOffset:cr.anchorOffset,focusNode:cr.focusNode,focusOffset:cr.focusOffset}),Se$1&&Ie$1(Se$1,cr)||(Se$1=cr,cr=oe$1(Re$1,"onSelect"),0<cr.length&&(or=new td("onSelect","select",null,or,lr),ar.push({event:or,listeners:cr}),or.target=Qe$1)))}function Ve$1(ar,or){var lr={};return lr[ar.toLowerCase()]=or.toLowerCase(),lr["Webkit"+ar]="webkit"+or,lr["Moz"+ar]="moz"+or,lr}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe$1={},Ye$1={};ia&&(Ye$1=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);function Ze$1(ar){if(Xe$1[ar])return Xe$1[ar];if(!We$1[ar])return ar;var or=We$1[ar],lr;for(lr in or)if(or.hasOwnProperty(lr)&&lr in Ye$1)return Xe$1[ar]=or[lr];return ar}var $e$1=Ze$1("animationend"),af=Ze$1("animationiteration"),bf=Ze$1("animationstart"),cf=Ze$1("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(ar,or){df.set(ar,or),fa(or,[ar])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(ar,or,lr){var cr=ar.type||"unknown-event";ar.currentTarget=lr,Ub(cr,or,void 0,ar),ar.currentTarget=null}function se$1(ar,or){or=(or&4)!==0;for(var lr=0;lr<ar.length;lr++){var cr=ar[lr],ur=cr.event;cr=cr.listeners;e:{var dr=void 0;if(or)for(var hr=cr.length-1;0<=hr;hr--){var pr=cr[hr],mr=pr.instance,fr=pr.currentTarget;if(pr=pr.listener,mr!==dr&&ur.isPropagationStopped())break e;nf(ur,pr,fr),dr=mr}else for(hr=0;hr<cr.length;hr++){if(pr=cr[hr],mr=pr.instance,fr=pr.currentTarget,pr=pr.listener,mr!==dr&&ur.isPropagationStopped())break e;nf(ur,pr,fr),dr=mr}}}if(Qb)throw ar=Rb,Qb=!1,Rb=null,ar}function D$1(ar,or){var lr=or[of];lr===void 0&&(lr=or[of]=new Set);var cr=ar+"__bubble";lr.has(cr)||(pf(or,ar,2,!1),lr.add(cr))}function qf(ar,or,lr){var cr=0;or&&(cr|=4),pf(lr,ar,cr,or)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(ar){if(!ar[rf]){ar[rf]=!0,da.forEach(function(lr){lr!=="selectionchange"&&(mf.has(lr)||qf(lr,!1,ar),qf(lr,!0,ar))});var or=ar.nodeType===9?ar:ar.ownerDocument;or===null||or[rf]||(or[rf]=!0,qf("selectionchange",!1,or))}}function pf(ar,or,lr,cr){switch(jd(or)){case 1:var ur=ed;break;case 4:ur=gd;break;default:ur=fd}lr=ur.bind(null,or,lr,ar),ur=void 0,!Lb||or!=="touchstart"&&or!=="touchmove"&&or!=="wheel"||(ur=!0),cr?ur!==void 0?ar.addEventListener(or,lr,{capture:!0,passive:ur}):ar.addEventListener(or,lr,!0):ur!==void 0?ar.addEventListener(or,lr,{passive:ur}):ar.addEventListener(or,lr,!1)}function hd(ar,or,lr,cr,ur){var dr=cr;if(!(or&1)&&!(or&2)&&cr!==null)e:for(;;){if(cr===null)return;var hr=cr.tag;if(hr===3||hr===4){var pr=cr.stateNode.containerInfo;if(pr===ur||pr.nodeType===8&&pr.parentNode===ur)break;if(hr===4)for(hr=cr.return;hr!==null;){var mr=hr.tag;if((mr===3||mr===4)&&(mr=hr.stateNode.containerInfo,mr===ur||mr.nodeType===8&&mr.parentNode===ur))return;hr=hr.return}for(;pr!==null;){if(hr=Wc(pr),hr===null)return;if(mr=hr.tag,mr===5||mr===6){cr=dr=hr;continue e}pr=pr.parentNode}}cr=cr.return}Jb(function(){var fr=dr,xr=xb(lr),Er=[];e:{var vr=df.get(ar);if(vr!==void 0){var gr=td,yr=ar;switch(ar){case"keypress":if(od(lr)===0)break e;case"keydown":case"keyup":gr=Rd;break;case"focusin":yr="focus",gr=Fd;break;case"focusout":yr="blur",gr=Fd;break;case"beforeblur":case"afterblur":gr=Fd;break;case"click":if(lr.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":gr=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":gr=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":gr=Vd;break;case $e$1:case af:case bf:gr=Hd;break;case cf:gr=Xd;break;case"scroll":gr=vd;break;case"wheel":gr=Zd;break;case"copy":case"cut":case"paste":gr=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":gr=Td}var br=(or&4)!==0,_r=!br&&ar==="scroll",jr=br?vr!==null?vr+"Capture":null:vr;br=[];for(var wr=fr,Sr;wr!==null;){Sr=wr;var Tr=Sr.stateNode;if(Sr.tag===5&&Tr!==null&&(Sr=Tr,jr!==null&&(Tr=Kb(wr,jr),Tr!=null&&br.push(tf(wr,Tr,Sr)))),_r)break;wr=wr.return}0<br.length&&(vr=new gr(vr,yr,null,lr,xr),Er.push({event:vr,listeners:br}))}}if(!(or&7)){e:{if(vr=ar==="mouseover"||ar==="pointerover",gr=ar==="mouseout"||ar==="pointerout",vr&&lr!==wb&&(yr=lr.relatedTarget||lr.fromElement)&&(Wc(yr)||yr[uf]))break e;if((gr||vr)&&(vr=xr.window===xr?xr:(vr=xr.ownerDocument)?vr.defaultView||vr.parentWindow:window,gr?(yr=lr.relatedTarget||lr.toElement,gr=fr,yr=yr?Wc(yr):null,yr!==null&&(_r=Vb(yr),yr!==_r||yr.tag!==5&&yr.tag!==6)&&(yr=null)):(gr=null,yr=fr),gr!==yr)){if(br=Bd,Tr="onMouseLeave",jr="onMouseEnter",wr="mouse",(ar==="pointerout"||ar==="pointerover")&&(br=Td,Tr="onPointerLeave",jr="onPointerEnter",wr="pointer"),_r=gr==null?vr:ue$1(gr),Sr=yr==null?vr:ue$1(yr),vr=new br(Tr,wr+"leave",gr,lr,xr),vr.target=_r,vr.relatedTarget=Sr,Tr=null,Wc(xr)===fr&&(br=new br(jr,wr+"enter",yr,lr,xr),br.target=Sr,br.relatedTarget=_r,Tr=br),_r=Tr,gr&&yr)t:{for(br=gr,jr=yr,wr=0,Sr=br;Sr;Sr=vf(Sr))wr++;for(Sr=0,Tr=jr;Tr;Tr=vf(Tr))Sr++;for(;0<wr-Sr;)br=vf(br),wr--;for(;0<Sr-wr;)jr=vf(jr),Sr--;for(;wr--;){if(br===jr||jr!==null&&br===jr.alternate)break t;br=vf(br),jr=vf(jr)}br=null}else br=null;gr!==null&&wf(Er,vr,gr,br,!1),yr!==null&&_r!==null&&wf(Er,_r,yr,br,!0)}}e:{if(vr=fr?ue$1(fr):window,gr=vr.nodeName&&vr.nodeName.toLowerCase(),gr==="select"||gr==="input"&&vr.type==="file")var Rr=ve$1;else if(me$1(vr))if(we$1)Rr=Fe$1;else{Rr=De$1;var Nr=Ce$1}else(gr=vr.nodeName)&&gr.toLowerCase()==="input"&&(vr.type==="checkbox"||vr.type==="radio")&&(Rr=Ee$1);if(Rr&&(Rr=Rr(ar,fr))){ne$1(Er,Rr,lr,xr);break e}Nr&&Nr(ar,vr,fr),ar==="focusout"&&(Nr=vr._wrapperState)&&Nr.controlled&&vr.type==="number"&&cb(vr,"number",vr.value)}switch(Nr=fr?ue$1(fr):window,ar){case"focusin":(me$1(Nr)||Nr.contentEditable==="true")&&(Qe$1=Nr,Re$1=fr,Se$1=null);break;case"focusout":Se$1=Re$1=Qe$1=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue$1(Er,lr,xr);break;case"selectionchange":if(Pe$1)break;case"keydown":case"keyup":Ue$1(Er,lr,xr)}var Cr;if(ae$1)e:{switch(ar){case"compositionstart":var kr="onCompositionStart";break e;case"compositionend":kr="onCompositionEnd";break e;case"compositionupdate":kr="onCompositionUpdate";break e}kr=void 0}else ie$1?ge$1(ar,lr)&&(kr="onCompositionEnd"):ar==="keydown"&&lr.keyCode===229&&(kr="onCompositionStart");kr&&(de$1&&lr.locale!=="ko"&&(ie$1||kr!=="onCompositionStart"?kr==="onCompositionEnd"&&ie$1&&(Cr=nd()):(kd=xr,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),Nr=oe$1(fr,kr),0<Nr.length&&(kr=new Ld(kr,ar,null,lr,xr),Er.push({event:kr,listeners:Nr}),Cr?kr.data=Cr:(Cr=he$1(lr),Cr!==null&&(kr.data=Cr)))),(Cr=ce$1?je$1(ar,lr):ke$1(ar,lr))&&(fr=oe$1(fr,"onBeforeInput"),0<fr.length&&(xr=new Ld("onBeforeInput","beforeinput",null,lr,xr),Er.push({event:xr,listeners:fr}),xr.data=Cr))}se$1(Er,or)})}function tf(ar,or,lr){return{instance:ar,listener:or,currentTarget:lr}}function oe$1(ar,or){for(var lr=or+"Capture",cr=[];ar!==null;){var ur=ar,dr=ur.stateNode;ur.tag===5&&dr!==null&&(ur=dr,dr=Kb(ar,lr),dr!=null&&cr.unshift(tf(ar,dr,ur)),dr=Kb(ar,or),dr!=null&&cr.push(tf(ar,dr,ur))),ar=ar.return}return cr}function vf(ar){if(ar===null)return null;do ar=ar.return;while(ar&&ar.tag!==5);return ar||null}function wf(ar,or,lr,cr,ur){for(var dr=or._reactName,hr=[];lr!==null&&lr!==cr;){var pr=lr,mr=pr.alternate,fr=pr.stateNode;if(mr!==null&&mr===cr)break;pr.tag===5&&fr!==null&&(pr=fr,ur?(mr=Kb(lr,dr),mr!=null&&hr.unshift(tf(lr,mr,pr))):ur||(mr=Kb(lr,dr),mr!=null&&hr.push(tf(lr,mr,pr)))),lr=lr.return}hr.length!==0&&ar.push({event:or,listeners:hr})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(ar){return(typeof ar=="string"?ar:""+ar).replace(xf,`
`).replace(yf,"")}function Af(ar,or,lr){if(or=zf(or),zf(ar)!==or&&lr)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(ar,or){return ar==="textarea"||ar==="noscript"||typeof or.children=="string"||typeof or.children=="number"||typeof or.dangerouslySetInnerHTML=="object"&&or.dangerouslySetInnerHTML!==null&&or.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(ar){return Hf.resolve(null).then(ar).catch(If)}:Ff;function If(ar){setTimeout(function(){throw ar})}function Kf(ar,or){var lr=or,cr=0;do{var ur=lr.nextSibling;if(ar.removeChild(lr),ur&&ur.nodeType===8)if(lr=ur.data,lr==="/$"){if(cr===0){ar.removeChild(ur),bd(or);return}cr--}else lr!=="$"&&lr!=="$?"&&lr!=="$!"||cr++;lr=ur}while(lr);bd(or)}function Lf(ar){for(;ar!=null;ar=ar.nextSibling){var or=ar.nodeType;if(or===1||or===3)break;if(or===8){if(or=ar.data,or==="$"||or==="$!"||or==="$?")break;if(or==="/$")return null}}return ar}function Mf(ar){ar=ar.previousSibling;for(var or=0;ar;){if(ar.nodeType===8){var lr=ar.data;if(lr==="$"||lr==="$!"||lr==="$?"){if(or===0)return ar;or--}else lr==="/$"&&or++}ar=ar.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(ar){var or=ar[Of];if(or)return or;for(var lr=ar.parentNode;lr;){if(or=lr[uf]||lr[Of]){if(lr=or.alternate,or.child!==null||lr!==null&&lr.child!==null)for(ar=Mf(ar);ar!==null;){if(lr=ar[Of])return lr;ar=Mf(ar)}return or}ar=lr,lr=ar.parentNode}return null}function Cb(ar){return ar=ar[Of]||ar[uf],!ar||ar.tag!==5&&ar.tag!==6&&ar.tag!==13&&ar.tag!==3?null:ar}function ue$1(ar){if(ar.tag===5||ar.tag===6)return ar.stateNode;throw Error(p$1(33))}function Db(ar){return ar[Pf]||null}var Sf=[],Tf=-1;function Uf(ar){return{current:ar}}function E$1(ar){0>Tf||(ar.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(ar,or){Tf++,Sf[Tf]=ar.current,ar.current=or}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(ar,or){var lr=ar.type.contextTypes;if(!lr)return Vf;var cr=ar.stateNode;if(cr&&cr.__reactInternalMemoizedUnmaskedChildContext===or)return cr.__reactInternalMemoizedMaskedChildContext;var ur={},dr;for(dr in lr)ur[dr]=or[dr];return cr&&(ar=ar.stateNode,ar.__reactInternalMemoizedUnmaskedChildContext=or,ar.__reactInternalMemoizedMaskedChildContext=ur),ur}function Zf(ar){return ar=ar.childContextTypes,ar!=null}function $f(){E$1(Wf),E$1(H$1)}function ag(ar,or,lr){if(H$1.current!==Vf)throw Error(p$1(168));G$1(H$1,or),G$1(Wf,lr)}function bg(ar,or,lr){var cr=ar.stateNode;if(or=or.childContextTypes,typeof cr.getChildContext!="function")return lr;cr=cr.getChildContext();for(var ur in cr)if(!(ur in or))throw Error(p$1(108,Ra(ar)||"Unknown",ur));return A$1({},lr,cr)}function cg(ar){return ar=(ar=ar.stateNode)&&ar.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G$1(H$1,ar),G$1(Wf,Wf.current),!0}function dg(ar,or,lr){var cr=ar.stateNode;if(!cr)throw Error(p$1(169));lr?(ar=bg(ar,or,Xf),cr.__reactInternalMemoizedMergedChildContext=ar,E$1(Wf),E$1(H$1),G$1(H$1,ar)):E$1(Wf),G$1(Wf,lr)}var eg=null,fg=!1,gg=!1;function hg(ar){eg===null?eg=[ar]:eg.push(ar)}function ig(ar){fg=!0,hg(ar)}function jg(){if(!gg&&eg!==null){gg=!0;var ar=0,or=C$1;try{var lr=eg;for(C$1=1;ar<lr.length;ar++){var cr=lr[ar];do cr=cr(!0);while(cr!==null)}eg=null,fg=!1}catch(ur){throw eg!==null&&(eg=eg.slice(ar+1)),ac(fc,jg),ur}finally{C$1=or,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(ar,or){kg[lg++]=ng,kg[lg++]=mg,mg=ar,ng=or}function ug(ar,or,lr){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=ar;var cr=rg;ar=sg;var ur=32-oc(cr)-1;cr&=~(1<<ur),lr+=1;var dr=32-oc(or)+ur;if(30<dr){var hr=ur-ur%5;dr=(cr&(1<<hr)-1).toString(32),cr>>=hr,ur-=hr,rg=1<<32-oc(or)+ur|lr<<ur|cr,sg=dr+ar}else rg=1<<dr|lr<<ur|cr,sg=ar}function vg(ar){ar.return!==null&&(tg(ar,1),ug(ar,1,0))}function wg(ar){for(;ar===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;ar===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$1=!1,zg=null;function Ag(ar,or){var lr=Bg(5,null,null,0);lr.elementType="DELETED",lr.stateNode=or,lr.return=ar,or=ar.deletions,or===null?(ar.deletions=[lr],ar.flags|=16):or.push(lr)}function Cg(ar,or){switch(ar.tag){case 5:var lr=ar.type;return or=or.nodeType!==1||lr.toLowerCase()!==or.nodeName.toLowerCase()?null:or,or!==null?(ar.stateNode=or,xg=ar,yg=Lf(or.firstChild),!0):!1;case 6:return or=ar.pendingProps===""||or.nodeType!==3?null:or,or!==null?(ar.stateNode=or,xg=ar,yg=null,!0):!1;case 13:return or=or.nodeType!==8?null:or,or!==null?(lr=qg!==null?{id:rg,overflow:sg}:null,ar.memoizedState={dehydrated:or,treeContext:lr,retryLane:1073741824},lr=Bg(18,null,null,0),lr.stateNode=or,lr.return=ar,ar.child=lr,xg=ar,yg=null,!0):!1;default:return!1}}function Dg(ar){return(ar.mode&1)!==0&&(ar.flags&128)===0}function Eg(ar){if(I$1){var or=yg;if(or){var lr=or;if(!Cg(ar,or)){if(Dg(ar))throw Error(p$1(418));or=Lf(lr.nextSibling);var cr=xg;or&&Cg(ar,or)?Ag(cr,lr):(ar.flags=ar.flags&-4097|2,I$1=!1,xg=ar)}}else{if(Dg(ar))throw Error(p$1(418));ar.flags=ar.flags&-4097|2,I$1=!1,xg=ar}}}function Fg(ar){for(ar=ar.return;ar!==null&&ar.tag!==5&&ar.tag!==3&&ar.tag!==13;)ar=ar.return;xg=ar}function Gg(ar){if(ar!==xg)return!1;if(!I$1)return Fg(ar),I$1=!0,!1;var or;if((or=ar.tag!==3)&&!(or=ar.tag!==5)&&(or=ar.type,or=or!=="head"&&or!=="body"&&!Ef(ar.type,ar.memoizedProps)),or&&(or=yg)){if(Dg(ar))throw Hg(),Error(p$1(418));for(;or;)Ag(ar,or),or=Lf(or.nextSibling)}if(Fg(ar),ar.tag===13){if(ar=ar.memoizedState,ar=ar!==null?ar.dehydrated:null,!ar)throw Error(p$1(317));e:{for(ar=ar.nextSibling,or=0;ar;){if(ar.nodeType===8){var lr=ar.data;if(lr==="/$"){if(or===0){yg=Lf(ar.nextSibling);break e}or--}else lr!=="$"&&lr!=="$!"&&lr!=="$?"||or++}ar=ar.nextSibling}yg=null}}else yg=xg?Lf(ar.stateNode.nextSibling):null;return!0}function Hg(){for(var ar=yg;ar;)ar=Lf(ar.nextSibling)}function Ig(){yg=xg=null,I$1=!1}function Jg(ar){zg===null?zg=[ar]:zg.push(ar)}var Kg=ua.ReactCurrentBatchConfig;function Lg(ar,or,lr){if(ar=lr.ref,ar!==null&&typeof ar!="function"&&typeof ar!="object"){if(lr._owner){if(lr=lr._owner,lr){if(lr.tag!==1)throw Error(p$1(309));var cr=lr.stateNode}if(!cr)throw Error(p$1(147,ar));var ur=cr,dr=""+ar;return or!==null&&or.ref!==null&&typeof or.ref=="function"&&or.ref._stringRef===dr?or.ref:(or=function(hr){var pr=ur.refs;hr===null?delete pr[dr]:pr[dr]=hr},or._stringRef=dr,or)}if(typeof ar!="string")throw Error(p$1(284));if(!lr._owner)throw Error(p$1(290,ar))}return ar}function Mg(ar,or){throw ar=Object.prototype.toString.call(or),Error(p$1(31,ar==="[object Object]"?"object with keys {"+Object.keys(or).join(", ")+"}":ar))}function Ng(ar){var or=ar._init;return or(ar._payload)}function Og(ar){function or(jr,wr){if(ar){var Sr=jr.deletions;Sr===null?(jr.deletions=[wr],jr.flags|=16):Sr.push(wr)}}function lr(jr,wr){if(!ar)return null;for(;wr!==null;)or(jr,wr),wr=wr.sibling;return null}function cr(jr,wr){for(jr=new Map;wr!==null;)wr.key!==null?jr.set(wr.key,wr):jr.set(wr.index,wr),wr=wr.sibling;return jr}function ur(jr,wr){return jr=Pg(jr,wr),jr.index=0,jr.sibling=null,jr}function dr(jr,wr,Sr){return jr.index=Sr,ar?(Sr=jr.alternate,Sr!==null?(Sr=Sr.index,Sr<wr?(jr.flags|=2,wr):Sr):(jr.flags|=2,wr)):(jr.flags|=1048576,wr)}function hr(jr){return ar&&jr.alternate===null&&(jr.flags|=2),jr}function pr(jr,wr,Sr,Tr){return wr===null||wr.tag!==6?(wr=Qg(Sr,jr.mode,Tr),wr.return=jr,wr):(wr=ur(wr,Sr),wr.return=jr,wr)}function mr(jr,wr,Sr,Tr){var Rr=Sr.type;return Rr===ya?xr(jr,wr,Sr.props.children,Tr,Sr.key):wr!==null&&(wr.elementType===Rr||typeof Rr=="object"&&Rr!==null&&Rr.$$typeof===Ha&&Ng(Rr)===wr.type)?(Tr=ur(wr,Sr.props),Tr.ref=Lg(jr,wr,Sr),Tr.return=jr,Tr):(Tr=Rg(Sr.type,Sr.key,Sr.props,null,jr.mode,Tr),Tr.ref=Lg(jr,wr,Sr),Tr.return=jr,Tr)}function fr(jr,wr,Sr,Tr){return wr===null||wr.tag!==4||wr.stateNode.containerInfo!==Sr.containerInfo||wr.stateNode.implementation!==Sr.implementation?(wr=Sg(Sr,jr.mode,Tr),wr.return=jr,wr):(wr=ur(wr,Sr.children||[]),wr.return=jr,wr)}function xr(jr,wr,Sr,Tr,Rr){return wr===null||wr.tag!==7?(wr=Tg(Sr,jr.mode,Tr,Rr),wr.return=jr,wr):(wr=ur(wr,Sr),wr.return=jr,wr)}function Er(jr,wr,Sr){if(typeof wr=="string"&&wr!==""||typeof wr=="number")return wr=Qg(""+wr,jr.mode,Sr),wr.return=jr,wr;if(typeof wr=="object"&&wr!==null){switch(wr.$$typeof){case va:return Sr=Rg(wr.type,wr.key,wr.props,null,jr.mode,Sr),Sr.ref=Lg(jr,null,wr),Sr.return=jr,Sr;case wa:return wr=Sg(wr,jr.mode,Sr),wr.return=jr,wr;case Ha:var Tr=wr._init;return Er(jr,Tr(wr._payload),Sr)}if(eb(wr)||Ka(wr))return wr=Tg(wr,jr.mode,Sr,null),wr.return=jr,wr;Mg(jr,wr)}return null}function vr(jr,wr,Sr,Tr){var Rr=wr!==null?wr.key:null;if(typeof Sr=="string"&&Sr!==""||typeof Sr=="number")return Rr!==null?null:pr(jr,wr,""+Sr,Tr);if(typeof Sr=="object"&&Sr!==null){switch(Sr.$$typeof){case va:return Sr.key===Rr?mr(jr,wr,Sr,Tr):null;case wa:return Sr.key===Rr?fr(jr,wr,Sr,Tr):null;case Ha:return Rr=Sr._init,vr(jr,wr,Rr(Sr._payload),Tr)}if(eb(Sr)||Ka(Sr))return Rr!==null?null:xr(jr,wr,Sr,Tr,null);Mg(jr,Sr)}return null}function gr(jr,wr,Sr,Tr,Rr){if(typeof Tr=="string"&&Tr!==""||typeof Tr=="number")return jr=jr.get(Sr)||null,pr(wr,jr,""+Tr,Rr);if(typeof Tr=="object"&&Tr!==null){switch(Tr.$$typeof){case va:return jr=jr.get(Tr.key===null?Sr:Tr.key)||null,mr(wr,jr,Tr,Rr);case wa:return jr=jr.get(Tr.key===null?Sr:Tr.key)||null,fr(wr,jr,Tr,Rr);case Ha:var Nr=Tr._init;return gr(jr,wr,Sr,Nr(Tr._payload),Rr)}if(eb(Tr)||Ka(Tr))return jr=jr.get(Sr)||null,xr(wr,jr,Tr,Rr,null);Mg(wr,Tr)}return null}function yr(jr,wr,Sr,Tr){for(var Rr=null,Nr=null,Cr=wr,kr=wr=0,Ar=null;Cr!==null&&kr<Sr.length;kr++){Cr.index>kr?(Ar=Cr,Cr=null):Ar=Cr.sibling;var Or=vr(jr,Cr,Sr[kr],Tr);if(Or===null){Cr===null&&(Cr=Ar);break}ar&&Cr&&Or.alternate===null&&or(jr,Cr),wr=dr(Or,wr,kr),Nr===null?Rr=Or:Nr.sibling=Or,Nr=Or,Cr=Ar}if(kr===Sr.length)return lr(jr,Cr),I$1&&tg(jr,kr),Rr;if(Cr===null){for(;kr<Sr.length;kr++)Cr=Er(jr,Sr[kr],Tr),Cr!==null&&(wr=dr(Cr,wr,kr),Nr===null?Rr=Cr:Nr.sibling=Cr,Nr=Cr);return I$1&&tg(jr,kr),Rr}for(Cr=cr(jr,Cr);kr<Sr.length;kr++)Ar=gr(Cr,jr,kr,Sr[kr],Tr),Ar!==null&&(ar&&Ar.alternate!==null&&Cr.delete(Ar.key===null?kr:Ar.key),wr=dr(Ar,wr,kr),Nr===null?Rr=Ar:Nr.sibling=Ar,Nr=Ar);return ar&&Cr.forEach(function(Lr){return or(jr,Lr)}),I$1&&tg(jr,kr),Rr}function br(jr,wr,Sr,Tr){var Rr=Ka(Sr);if(typeof Rr!="function")throw Error(p$1(150));if(Sr=Rr.call(Sr),Sr==null)throw Error(p$1(151));for(var Nr=Rr=null,Cr=wr,kr=wr=0,Ar=null,Or=Sr.next();Cr!==null&&!Or.done;kr++,Or=Sr.next()){Cr.index>kr?(Ar=Cr,Cr=null):Ar=Cr.sibling;var Lr=vr(jr,Cr,Or.value,Tr);if(Lr===null){Cr===null&&(Cr=Ar);break}ar&&Cr&&Lr.alternate===null&&or(jr,Cr),wr=dr(Lr,wr,kr),Nr===null?Rr=Lr:Nr.sibling=Lr,Nr=Lr,Cr=Ar}if(Or.done)return lr(jr,Cr),I$1&&tg(jr,kr),Rr;if(Cr===null){for(;!Or.done;kr++,Or=Sr.next())Or=Er(jr,Or.value,Tr),Or!==null&&(wr=dr(Or,wr,kr),Nr===null?Rr=Or:Nr.sibling=Or,Nr=Or);return I$1&&tg(jr,kr),Rr}for(Cr=cr(jr,Cr);!Or.done;kr++,Or=Sr.next())Or=gr(Cr,jr,kr,Or.value,Tr),Or!==null&&(ar&&Or.alternate!==null&&Cr.delete(Or.key===null?kr:Or.key),wr=dr(Or,wr,kr),Nr===null?Rr=Or:Nr.sibling=Or,Nr=Or);return ar&&Cr.forEach(function(Fr){return or(jr,Fr)}),I$1&&tg(jr,kr),Rr}function _r(jr,wr,Sr,Tr){if(typeof Sr=="object"&&Sr!==null&&Sr.type===ya&&Sr.key===null&&(Sr=Sr.props.children),typeof Sr=="object"&&Sr!==null){switch(Sr.$$typeof){case va:e:{for(var Rr=Sr.key,Nr=wr;Nr!==null;){if(Nr.key===Rr){if(Rr=Sr.type,Rr===ya){if(Nr.tag===7){lr(jr,Nr.sibling),wr=ur(Nr,Sr.props.children),wr.return=jr,jr=wr;break e}}else if(Nr.elementType===Rr||typeof Rr=="object"&&Rr!==null&&Rr.$$typeof===Ha&&Ng(Rr)===Nr.type){lr(jr,Nr.sibling),wr=ur(Nr,Sr.props),wr.ref=Lg(jr,Nr,Sr),wr.return=jr,jr=wr;break e}lr(jr,Nr);break}else or(jr,Nr);Nr=Nr.sibling}Sr.type===ya?(wr=Tg(Sr.props.children,jr.mode,Tr,Sr.key),wr.return=jr,jr=wr):(Tr=Rg(Sr.type,Sr.key,Sr.props,null,jr.mode,Tr),Tr.ref=Lg(jr,wr,Sr),Tr.return=jr,jr=Tr)}return hr(jr);case wa:e:{for(Nr=Sr.key;wr!==null;){if(wr.key===Nr)if(wr.tag===4&&wr.stateNode.containerInfo===Sr.containerInfo&&wr.stateNode.implementation===Sr.implementation){lr(jr,wr.sibling),wr=ur(wr,Sr.children||[]),wr.return=jr,jr=wr;break e}else{lr(jr,wr);break}else or(jr,wr);wr=wr.sibling}wr=Sg(Sr,jr.mode,Tr),wr.return=jr,jr=wr}return hr(jr);case Ha:return Nr=Sr._init,_r(jr,wr,Nr(Sr._payload),Tr)}if(eb(Sr))return yr(jr,wr,Sr,Tr);if(Ka(Sr))return br(jr,wr,Sr,Tr);Mg(jr,Sr)}return typeof Sr=="string"&&Sr!==""||typeof Sr=="number"?(Sr=""+Sr,wr!==null&&wr.tag===6?(lr(jr,wr.sibling),wr=ur(wr,Sr),wr.return=jr,jr=wr):(lr(jr,wr),wr=Qg(Sr,jr.mode,Tr),wr.return=jr,jr=wr),hr(jr)):lr(jr,wr)}return _r}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(ar){var or=Wg.current;E$1(Wg),ar._currentValue=or}function bh(ar,or,lr){for(;ar!==null;){var cr=ar.alternate;if((ar.childLanes&or)!==or?(ar.childLanes|=or,cr!==null&&(cr.childLanes|=or)):cr!==null&&(cr.childLanes&or)!==or&&(cr.childLanes|=or),ar===lr)break;ar=ar.return}}function ch(ar,or){Xg=ar,Zg=Yg=null,ar=ar.dependencies,ar!==null&&ar.firstContext!==null&&(ar.lanes&or&&(dh=!0),ar.firstContext=null)}function eh(ar){var or=ar._currentValue;if(Zg!==ar)if(ar={context:ar,memoizedValue:or,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=ar,Xg.dependencies={lanes:0,firstContext:ar}}else Yg=Yg.next=ar;return or}var fh=null;function gh(ar){fh===null?fh=[ar]:fh.push(ar)}function hh(ar,or,lr,cr){var ur=or.interleaved;return ur===null?(lr.next=lr,gh(or)):(lr.next=ur.next,ur.next=lr),or.interleaved=lr,ih(ar,cr)}function ih(ar,or){ar.lanes|=or;var lr=ar.alternate;for(lr!==null&&(lr.lanes|=or),lr=ar,ar=ar.return;ar!==null;)ar.childLanes|=or,lr=ar.alternate,lr!==null&&(lr.childLanes|=or),lr=ar,ar=ar.return;return lr.tag===3?lr.stateNode:null}var jh=!1;function kh(ar){ar.updateQueue={baseState:ar.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(ar,or){ar=ar.updateQueue,or.updateQueue===ar&&(or.updateQueue={baseState:ar.baseState,firstBaseUpdate:ar.firstBaseUpdate,lastBaseUpdate:ar.lastBaseUpdate,shared:ar.shared,effects:ar.effects})}function mh(ar,or){return{eventTime:ar,lane:or,tag:0,payload:null,callback:null,next:null}}function nh(ar,or,lr){var cr=ar.updateQueue;if(cr===null)return null;if(cr=cr.shared,K$1&2){var ur=cr.pending;return ur===null?or.next=or:(or.next=ur.next,ur.next=or),cr.pending=or,ih(ar,lr)}return ur=cr.interleaved,ur===null?(or.next=or,gh(cr)):(or.next=ur.next,ur.next=or),cr.interleaved=or,ih(ar,lr)}function oh(ar,or,lr){if(or=or.updateQueue,or!==null&&(or=or.shared,(lr&4194240)!==0)){var cr=or.lanes;cr&=ar.pendingLanes,lr|=cr,or.lanes=lr,Cc(ar,lr)}}function ph(ar,or){var lr=ar.updateQueue,cr=ar.alternate;if(cr!==null&&(cr=cr.updateQueue,lr===cr)){var ur=null,dr=null;if(lr=lr.firstBaseUpdate,lr!==null){do{var hr={eventTime:lr.eventTime,lane:lr.lane,tag:lr.tag,payload:lr.payload,callback:lr.callback,next:null};dr===null?ur=dr=hr:dr=dr.next=hr,lr=lr.next}while(lr!==null);dr===null?ur=dr=or:dr=dr.next=or}else ur=dr=or;lr={baseState:cr.baseState,firstBaseUpdate:ur,lastBaseUpdate:dr,shared:cr.shared,effects:cr.effects},ar.updateQueue=lr;return}ar=lr.lastBaseUpdate,ar===null?lr.firstBaseUpdate=or:ar.next=or,lr.lastBaseUpdate=or}function qh(ar,or,lr,cr){var ur=ar.updateQueue;jh=!1;var dr=ur.firstBaseUpdate,hr=ur.lastBaseUpdate,pr=ur.shared.pending;if(pr!==null){ur.shared.pending=null;var mr=pr,fr=mr.next;mr.next=null,hr===null?dr=fr:hr.next=fr,hr=mr;var xr=ar.alternate;xr!==null&&(xr=xr.updateQueue,pr=xr.lastBaseUpdate,pr!==hr&&(pr===null?xr.firstBaseUpdate=fr:pr.next=fr,xr.lastBaseUpdate=mr))}if(dr!==null){var Er=ur.baseState;hr=0,xr=fr=mr=null,pr=dr;do{var vr=pr.lane,gr=pr.eventTime;if((cr&vr)===vr){xr!==null&&(xr=xr.next={eventTime:gr,lane:0,tag:pr.tag,payload:pr.payload,callback:pr.callback,next:null});e:{var yr=ar,br=pr;switch(vr=or,gr=lr,br.tag){case 1:if(yr=br.payload,typeof yr=="function"){Er=yr.call(gr,Er,vr);break e}Er=yr;break e;case 3:yr.flags=yr.flags&-65537|128;case 0:if(yr=br.payload,vr=typeof yr=="function"?yr.call(gr,Er,vr):yr,vr==null)break e;Er=A$1({},Er,vr);break e;case 2:jh=!0}}pr.callback!==null&&pr.lane!==0&&(ar.flags|=64,vr=ur.effects,vr===null?ur.effects=[pr]:vr.push(pr))}else gr={eventTime:gr,lane:vr,tag:pr.tag,payload:pr.payload,callback:pr.callback,next:null},xr===null?(fr=xr=gr,mr=Er):xr=xr.next=gr,hr|=vr;if(pr=pr.next,pr===null){if(pr=ur.shared.pending,pr===null)break;vr=pr,pr=vr.next,vr.next=null,ur.lastBaseUpdate=vr,ur.shared.pending=null}}while(!0);if(xr===null&&(mr=Er),ur.baseState=mr,ur.firstBaseUpdate=fr,ur.lastBaseUpdate=xr,or=ur.shared.interleaved,or!==null){ur=or;do hr|=ur.lane,ur=ur.next;while(ur!==or)}else dr===null&&(ur.shared.lanes=0);rh|=hr,ar.lanes=hr,ar.memoizedState=Er}}function sh(ar,or,lr){if(ar=or.effects,or.effects=null,ar!==null)for(or=0;or<ar.length;or++){var cr=ar[or],ur=cr.callback;if(ur!==null){if(cr.callback=null,cr=lr,typeof ur!="function")throw Error(p$1(191,ur));ur.call(cr)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(ar){if(ar===th)throw Error(p$1(174));return ar}function yh(ar,or){switch(G$1(wh,or),G$1(vh,ar),G$1(uh,th),ar=or.nodeType,ar){case 9:case 11:or=(or=or.documentElement)?or.namespaceURI:lb(null,"");break;default:ar=ar===8?or.parentNode:or,or=ar.namespaceURI||null,ar=ar.tagName,or=lb(or,ar)}E$1(uh),G$1(uh,or)}function zh(){E$1(uh),E$1(vh),E$1(wh)}function Ah(ar){xh(wh.current);var or=xh(uh.current),lr=lb(or,ar.type);or!==lr&&(G$1(vh,ar),G$1(uh,lr))}function Bh(ar){vh.current===ar&&(E$1(uh),E$1(vh))}var L$1=Uf(0);function Ch(ar){for(var or=ar;or!==null;){if(or.tag===13){var lr=or.memoizedState;if(lr!==null&&(lr=lr.dehydrated,lr===null||lr.data==="$?"||lr.data==="$!"))return or}else if(or.tag===19&&or.memoizedProps.revealOrder!==void 0){if(or.flags&128)return or}else if(or.child!==null){or.child.return=or,or=or.child;continue}if(or===ar)break;for(;or.sibling===null;){if(or.return===null||or.return===ar)return null;or=or.return}or.sibling.return=or.return,or=or.sibling}return null}var Dh=[];function Eh(){for(var ar=0;ar<Dh.length;ar++)Dh[ar]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N$1=null,O$1=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P$1(){throw Error(p$1(321))}function Mh(ar,or){if(or===null)return!1;for(var lr=0;lr<or.length&&lr<ar.length;lr++)if(!He$1(ar[lr],or[lr]))return!1;return!0}function Nh(ar,or,lr,cr,ur,dr){if(Hh=dr,M$1=or,or.memoizedState=null,or.updateQueue=null,or.lanes=0,Fh.current=ar===null||ar.memoizedState===null?Oh:Ph,ar=lr(cr,ur),Jh){dr=0;do{if(Jh=!1,Kh=0,25<=dr)throw Error(p$1(301));dr+=1,O$1=N$1=null,or.updateQueue=null,Fh.current=Qh,ar=lr(cr,ur)}while(Jh)}if(Fh.current=Rh,or=N$1!==null&&N$1.next!==null,Hh=0,O$1=N$1=M$1=null,Ih=!1,or)throw Error(p$1(300));return ar}function Sh(){var ar=Kh!==0;return Kh=0,ar}function Th(){var ar={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O$1===null?M$1.memoizedState=O$1=ar:O$1=O$1.next=ar,O$1}function Uh(){if(N$1===null){var ar=M$1.alternate;ar=ar!==null?ar.memoizedState:null}else ar=N$1.next;var or=O$1===null?M$1.memoizedState:O$1.next;if(or!==null)O$1=or,N$1=ar;else{if(ar===null)throw Error(p$1(310));N$1=ar,ar={memoizedState:N$1.memoizedState,baseState:N$1.baseState,baseQueue:N$1.baseQueue,queue:N$1.queue,next:null},O$1===null?M$1.memoizedState=O$1=ar:O$1=O$1.next=ar}return O$1}function Vh(ar,or){return typeof or=="function"?or(ar):or}function Wh(ar){var or=Uh(),lr=or.queue;if(lr===null)throw Error(p$1(311));lr.lastRenderedReducer=ar;var cr=N$1,ur=cr.baseQueue,dr=lr.pending;if(dr!==null){if(ur!==null){var hr=ur.next;ur.next=dr.next,dr.next=hr}cr.baseQueue=ur=dr,lr.pending=null}if(ur!==null){dr=ur.next,cr=cr.baseState;var pr=hr=null,mr=null,fr=dr;do{var xr=fr.lane;if((Hh&xr)===xr)mr!==null&&(mr=mr.next={lane:0,action:fr.action,hasEagerState:fr.hasEagerState,eagerState:fr.eagerState,next:null}),cr=fr.hasEagerState?fr.eagerState:ar(cr,fr.action);else{var Er={lane:xr,action:fr.action,hasEagerState:fr.hasEagerState,eagerState:fr.eagerState,next:null};mr===null?(pr=mr=Er,hr=cr):mr=mr.next=Er,M$1.lanes|=xr,rh|=xr}fr=fr.next}while(fr!==null&&fr!==dr);mr===null?hr=cr:mr.next=pr,He$1(cr,or.memoizedState)||(dh=!0),or.memoizedState=cr,or.baseState=hr,or.baseQueue=mr,lr.lastRenderedState=cr}if(ar=lr.interleaved,ar!==null){ur=ar;do dr=ur.lane,M$1.lanes|=dr,rh|=dr,ur=ur.next;while(ur!==ar)}else ur===null&&(lr.lanes=0);return[or.memoizedState,lr.dispatch]}function Xh(ar){var or=Uh(),lr=or.queue;if(lr===null)throw Error(p$1(311));lr.lastRenderedReducer=ar;var cr=lr.dispatch,ur=lr.pending,dr=or.memoizedState;if(ur!==null){lr.pending=null;var hr=ur=ur.next;do dr=ar(dr,hr.action),hr=hr.next;while(hr!==ur);He$1(dr,or.memoizedState)||(dh=!0),or.memoizedState=dr,or.baseQueue===null&&(or.baseState=dr),lr.lastRenderedState=dr}return[dr,cr]}function Yh(){}function Zh(ar,or){var lr=M$1,cr=Uh(),ur=or(),dr=!He$1(cr.memoizedState,ur);if(dr&&(cr.memoizedState=ur,dh=!0),cr=cr.queue,$h(ai.bind(null,lr,cr,ar),[ar]),cr.getSnapshot!==or||dr||O$1!==null&&O$1.memoizedState.tag&1){if(lr.flags|=2048,bi(9,ci.bind(null,lr,cr,ur,or),void 0,null),Q$1===null)throw Error(p$1(349));Hh&30||di(lr,or,ur)}return ur}function di(ar,or,lr){ar.flags|=16384,ar={getSnapshot:or,value:lr},or=M$1.updateQueue,or===null?(or={lastEffect:null,stores:null},M$1.updateQueue=or,or.stores=[ar]):(lr=or.stores,lr===null?or.stores=[ar]:lr.push(ar))}function ci(ar,or,lr,cr){or.value=lr,or.getSnapshot=cr,ei(or)&&fi(ar)}function ai(ar,or,lr){return lr(function(){ei(or)&&fi(ar)})}function ei(ar){var or=ar.getSnapshot;ar=ar.value;try{var lr=or();return!He$1(ar,lr)}catch{return!0}}function fi(ar){var or=ih(ar,1);or!==null&&gi(or,ar,1,-1)}function hi(ar){var or=Th();return typeof ar=="function"&&(ar=ar()),or.memoizedState=or.baseState=ar,ar={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:ar},or.queue=ar,ar=ar.dispatch=ii.bind(null,M$1,ar),[or.memoizedState,ar]}function bi(ar,or,lr,cr){return ar={tag:ar,create:or,destroy:lr,deps:cr,next:null},or=M$1.updateQueue,or===null?(or={lastEffect:null,stores:null},M$1.updateQueue=or,or.lastEffect=ar.next=ar):(lr=or.lastEffect,lr===null?or.lastEffect=ar.next=ar:(cr=lr.next,lr.next=ar,ar.next=cr,or.lastEffect=ar)),ar}function ji(){return Uh().memoizedState}function ki(ar,or,lr,cr){var ur=Th();M$1.flags|=ar,ur.memoizedState=bi(1|or,lr,void 0,cr===void 0?null:cr)}function li(ar,or,lr,cr){var ur=Uh();cr=cr===void 0?null:cr;var dr=void 0;if(N$1!==null){var hr=N$1.memoizedState;if(dr=hr.destroy,cr!==null&&Mh(cr,hr.deps)){ur.memoizedState=bi(or,lr,dr,cr);return}}M$1.flags|=ar,ur.memoizedState=bi(1|or,lr,dr,cr)}function mi(ar,or){return ki(8390656,8,ar,or)}function $h(ar,or){return li(2048,8,ar,or)}function ni(ar,or){return li(4,2,ar,or)}function oi(ar,or){return li(4,4,ar,or)}function pi(ar,or){if(typeof or=="function")return ar=ar(),or(ar),function(){or(null)};if(or!=null)return ar=ar(),or.current=ar,function(){or.current=null}}function qi(ar,or,lr){return lr=lr!=null?lr.concat([ar]):null,li(4,4,pi.bind(null,or,ar),lr)}function ri(){}function si(ar,or){var lr=Uh();or=or===void 0?null:or;var cr=lr.memoizedState;return cr!==null&&or!==null&&Mh(or,cr[1])?cr[0]:(lr.memoizedState=[ar,or],ar)}function ti(ar,or){var lr=Uh();or=or===void 0?null:or;var cr=lr.memoizedState;return cr!==null&&or!==null&&Mh(or,cr[1])?cr[0]:(ar=ar(),lr.memoizedState=[ar,or],ar)}function ui(ar,or,lr){return Hh&21?(He$1(lr,or)||(lr=yc(),M$1.lanes|=lr,rh|=lr,ar.baseState=!0),or):(ar.baseState&&(ar.baseState=!1,dh=!0),ar.memoizedState=lr)}function vi(ar,or){var lr=C$1;C$1=lr!==0&&4>lr?lr:4,ar(!0);var cr=Gh.transition;Gh.transition={};try{ar(!1),or()}finally{C$1=lr,Gh.transition=cr}}function wi(){return Uh().memoizedState}function xi(ar,or,lr){var cr=yi(ar);if(lr={lane:cr,action:lr,hasEagerState:!1,eagerState:null,next:null},zi(ar))Ai(or,lr);else if(lr=hh(ar,or,lr,cr),lr!==null){var ur=R$1();gi(lr,ar,cr,ur),Bi(lr,or,cr)}}function ii(ar,or,lr){var cr=yi(ar),ur={lane:cr,action:lr,hasEagerState:!1,eagerState:null,next:null};if(zi(ar))Ai(or,ur);else{var dr=ar.alternate;if(ar.lanes===0&&(dr===null||dr.lanes===0)&&(dr=or.lastRenderedReducer,dr!==null))try{var hr=or.lastRenderedState,pr=dr(hr,lr);if(ur.hasEagerState=!0,ur.eagerState=pr,He$1(pr,hr)){var mr=or.interleaved;mr===null?(ur.next=ur,gh(or)):(ur.next=mr.next,mr.next=ur),or.interleaved=ur;return}}catch{}finally{}lr=hh(ar,or,ur,cr),lr!==null&&(ur=R$1(),gi(lr,ar,cr,ur),Bi(lr,or,cr))}}function zi(ar){var or=ar.alternate;return ar===M$1||or!==null&&or===M$1}function Ai(ar,or){Jh=Ih=!0;var lr=ar.pending;lr===null?or.next=or:(or.next=lr.next,lr.next=or),ar.pending=or}function Bi(ar,or,lr){if(lr&4194240){var cr=or.lanes;cr&=ar.pendingLanes,lr|=cr,or.lanes=lr,Cc(ar,lr)}}var Rh={readContext:eh,useCallback:P$1,useContext:P$1,useEffect:P$1,useImperativeHandle:P$1,useInsertionEffect:P$1,useLayoutEffect:P$1,useMemo:P$1,useReducer:P$1,useRef:P$1,useState:P$1,useDebugValue:P$1,useDeferredValue:P$1,useTransition:P$1,useMutableSource:P$1,useSyncExternalStore:P$1,useId:P$1,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(ar,or){return Th().memoizedState=[ar,or===void 0?null:or],ar},useContext:eh,useEffect:mi,useImperativeHandle:function(ar,or,lr){return lr=lr!=null?lr.concat([ar]):null,ki(4194308,4,pi.bind(null,or,ar),lr)},useLayoutEffect:function(ar,or){return ki(4194308,4,ar,or)},useInsertionEffect:function(ar,or){return ki(4,2,ar,or)},useMemo:function(ar,or){var lr=Th();return or=or===void 0?null:or,ar=ar(),lr.memoizedState=[ar,or],ar},useReducer:function(ar,or,lr){var cr=Th();return or=lr!==void 0?lr(or):or,cr.memoizedState=cr.baseState=or,ar={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ar,lastRenderedState:or},cr.queue=ar,ar=ar.dispatch=xi.bind(null,M$1,ar),[cr.memoizedState,ar]},useRef:function(ar){var or=Th();return ar={current:ar},or.memoizedState=ar},useState:hi,useDebugValue:ri,useDeferredValue:function(ar){return Th().memoizedState=ar},useTransition:function(){var ar=hi(!1),or=ar[0];return ar=vi.bind(null,ar[1]),Th().memoizedState=ar,[or,ar]},useMutableSource:function(){},useSyncExternalStore:function(ar,or,lr){var cr=M$1,ur=Th();if(I$1){if(lr===void 0)throw Error(p$1(407));lr=lr()}else{if(lr=or(),Q$1===null)throw Error(p$1(349));Hh&30||di(cr,or,lr)}ur.memoizedState=lr;var dr={value:lr,getSnapshot:or};return ur.queue=dr,mi(ai.bind(null,cr,dr,ar),[ar]),cr.flags|=2048,bi(9,ci.bind(null,cr,dr,lr,or),void 0,null),lr},useId:function(){var ar=Th(),or=Q$1.identifierPrefix;if(I$1){var lr=sg,cr=rg;lr=(cr&~(1<<32-oc(cr)-1)).toString(32)+lr,or=":"+or+"R"+lr,lr=Kh++,0<lr&&(or+="H"+lr.toString(32)),or+=":"}else lr=Lh++,or=":"+or+"r"+lr.toString(32)+":";return ar.memoizedState=or},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(ar){var or=Uh();return ui(or,N$1.memoizedState,ar)},useTransition:function(){var ar=Wh(Vh)[0],or=Uh().memoizedState;return[ar,or]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(ar){var or=Uh();return N$1===null?or.memoizedState=ar:ui(or,N$1.memoizedState,ar)},useTransition:function(){var ar=Xh(Vh)[0],or=Uh().memoizedState;return[ar,or]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(ar,or){if(ar&&ar.defaultProps){or=A$1({},or),ar=ar.defaultProps;for(var lr in ar)or[lr]===void 0&&(or[lr]=ar[lr]);return or}return or}function Di(ar,or,lr,cr){or=ar.memoizedState,lr=lr(cr,or),lr=lr==null?or:A$1({},or,lr),ar.memoizedState=lr,ar.lanes===0&&(ar.updateQueue.baseState=lr)}var Ei={isMounted:function(ar){return(ar=ar._reactInternals)?Vb(ar)===ar:!1},enqueueSetState:function(ar,or,lr){ar=ar._reactInternals;var cr=R$1(),ur=yi(ar),dr=mh(cr,ur);dr.payload=or,lr!=null&&(dr.callback=lr),or=nh(ar,dr,ur),or!==null&&(gi(or,ar,ur,cr),oh(or,ar,ur))},enqueueReplaceState:function(ar,or,lr){ar=ar._reactInternals;var cr=R$1(),ur=yi(ar),dr=mh(cr,ur);dr.tag=1,dr.payload=or,lr!=null&&(dr.callback=lr),or=nh(ar,dr,ur),or!==null&&(gi(or,ar,ur,cr),oh(or,ar,ur))},enqueueForceUpdate:function(ar,or){ar=ar._reactInternals;var lr=R$1(),cr=yi(ar),ur=mh(lr,cr);ur.tag=2,or!=null&&(ur.callback=or),or=nh(ar,ur,cr),or!==null&&(gi(or,ar,cr,lr),oh(or,ar,cr))}};function Fi(ar,or,lr,cr,ur,dr,hr){return ar=ar.stateNode,typeof ar.shouldComponentUpdate=="function"?ar.shouldComponentUpdate(cr,dr,hr):or.prototype&&or.prototype.isPureReactComponent?!Ie$1(lr,cr)||!Ie$1(ur,dr):!0}function Gi(ar,or,lr){var cr=!1,ur=Vf,dr=or.contextType;return typeof dr=="object"&&dr!==null?dr=eh(dr):(ur=Zf(or)?Xf:H$1.current,cr=or.contextTypes,dr=(cr=cr!=null)?Yf(ar,ur):Vf),or=new or(lr,dr),ar.memoizedState=or.state!==null&&or.state!==void 0?or.state:null,or.updater=Ei,ar.stateNode=or,or._reactInternals=ar,cr&&(ar=ar.stateNode,ar.__reactInternalMemoizedUnmaskedChildContext=ur,ar.__reactInternalMemoizedMaskedChildContext=dr),or}function Hi(ar,or,lr,cr){ar=or.state,typeof or.componentWillReceiveProps=="function"&&or.componentWillReceiveProps(lr,cr),typeof or.UNSAFE_componentWillReceiveProps=="function"&&or.UNSAFE_componentWillReceiveProps(lr,cr),or.state!==ar&&Ei.enqueueReplaceState(or,or.state,null)}function Ii(ar,or,lr,cr){var ur=ar.stateNode;ur.props=lr,ur.state=ar.memoizedState,ur.refs={},kh(ar);var dr=or.contextType;typeof dr=="object"&&dr!==null?ur.context=eh(dr):(dr=Zf(or)?Xf:H$1.current,ur.context=Yf(ar,dr)),ur.state=ar.memoizedState,dr=or.getDerivedStateFromProps,typeof dr=="function"&&(Di(ar,or,dr,lr),ur.state=ar.memoizedState),typeof or.getDerivedStateFromProps=="function"||typeof ur.getSnapshotBeforeUpdate=="function"||typeof ur.UNSAFE_componentWillMount!="function"&&typeof ur.componentWillMount!="function"||(or=ur.state,typeof ur.componentWillMount=="function"&&ur.componentWillMount(),typeof ur.UNSAFE_componentWillMount=="function"&&ur.UNSAFE_componentWillMount(),or!==ur.state&&Ei.enqueueReplaceState(ur,ur.state,null),qh(ar,lr,ur,cr),ur.state=ar.memoizedState),typeof ur.componentDidMount=="function"&&(ar.flags|=4194308)}function Ji(ar,or){try{var lr="",cr=or;do lr+=Pa(cr),cr=cr.return;while(cr);var ur=lr}catch(dr){ur=`
Error generating stack: `+dr.message+`
`+dr.stack}return{value:ar,source:or,stack:ur,digest:null}}function Ki(ar,or,lr){return{value:ar,source:null,stack:lr??null,digest:or??null}}function Li(ar,or){try{console.error(or.value)}catch(lr){setTimeout(function(){throw lr})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(ar,or,lr){lr=mh(-1,lr),lr.tag=3,lr.payload={element:null};var cr=or.value;return lr.callback=function(){Oi||(Oi=!0,Pi=cr),Li(ar,or)},lr}function Qi(ar,or,lr){lr=mh(-1,lr),lr.tag=3;var cr=ar.type.getDerivedStateFromError;if(typeof cr=="function"){var ur=or.value;lr.payload=function(){return cr(ur)},lr.callback=function(){Li(ar,or)}}var dr=ar.stateNode;return dr!==null&&typeof dr.componentDidCatch=="function"&&(lr.callback=function(){Li(ar,or),typeof cr!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var hr=or.stack;this.componentDidCatch(or.value,{componentStack:hr!==null?hr:""})}),lr}function Si(ar,or,lr){var cr=ar.pingCache;if(cr===null){cr=ar.pingCache=new Mi;var ur=new Set;cr.set(or,ur)}else ur=cr.get(or),ur===void 0&&(ur=new Set,cr.set(or,ur));ur.has(lr)||(ur.add(lr),ar=Ti.bind(null,ar,or,lr),or.then(ar,ar))}function Ui(ar){do{var or;if((or=ar.tag===13)&&(or=ar.memoizedState,or=or!==null?or.dehydrated!==null:!0),or)return ar;ar=ar.return}while(ar!==null);return null}function Vi(ar,or,lr,cr,ur){return ar.mode&1?(ar.flags|=65536,ar.lanes=ur,ar):(ar===or?ar.flags|=65536:(ar.flags|=128,lr.flags|=131072,lr.flags&=-52805,lr.tag===1&&(lr.alternate===null?lr.tag=17:(or=mh(-1,1),or.tag=2,nh(lr,or,1))),lr.lanes|=1),ar)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(ar,or,lr,cr){or.child=ar===null?Vg(or,null,lr,cr):Ug(or,ar.child,lr,cr)}function Yi(ar,or,lr,cr,ur){lr=lr.render;var dr=or.ref;return ch(or,ur),cr=Nh(ar,or,lr,cr,dr,ur),lr=Sh(),ar!==null&&!dh?(or.updateQueue=ar.updateQueue,or.flags&=-2053,ar.lanes&=~ur,Zi(ar,or,ur)):(I$1&&lr&&vg(or),or.flags|=1,Xi(ar,or,cr,ur),or.child)}function $i(ar,or,lr,cr,ur){if(ar===null){var dr=lr.type;return typeof dr=="function"&&!aj(dr)&&dr.defaultProps===void 0&&lr.compare===null&&lr.defaultProps===void 0?(or.tag=15,or.type=dr,bj(ar,or,dr,cr,ur)):(ar=Rg(lr.type,null,cr,or,or.mode,ur),ar.ref=or.ref,ar.return=or,or.child=ar)}if(dr=ar.child,!(ar.lanes&ur)){var hr=dr.memoizedProps;if(lr=lr.compare,lr=lr!==null?lr:Ie$1,lr(hr,cr)&&ar.ref===or.ref)return Zi(ar,or,ur)}return or.flags|=1,ar=Pg(dr,cr),ar.ref=or.ref,ar.return=or,or.child=ar}function bj(ar,or,lr,cr,ur){if(ar!==null){var dr=ar.memoizedProps;if(Ie$1(dr,cr)&&ar.ref===or.ref)if(dh=!1,or.pendingProps=cr=dr,(ar.lanes&ur)!==0)ar.flags&131072&&(dh=!0);else return or.lanes=ar.lanes,Zi(ar,or,ur)}return cj(ar,or,lr,cr,ur)}function dj(ar,or,lr){var cr=or.pendingProps,ur=cr.children,dr=ar!==null?ar.memoizedState:null;if(cr.mode==="hidden")if(!(or.mode&1))or.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(ej,fj),fj|=lr;else{if(!(lr&1073741824))return ar=dr!==null?dr.baseLanes|lr:lr,or.lanes=or.childLanes=1073741824,or.memoizedState={baseLanes:ar,cachePool:null,transitions:null},or.updateQueue=null,G$1(ej,fj),fj|=ar,null;or.memoizedState={baseLanes:0,cachePool:null,transitions:null},cr=dr!==null?dr.baseLanes:lr,G$1(ej,fj),fj|=cr}else dr!==null?(cr=dr.baseLanes|lr,or.memoizedState=null):cr=lr,G$1(ej,fj),fj|=cr;return Xi(ar,or,ur,lr),or.child}function gj(ar,or){var lr=or.ref;(ar===null&&lr!==null||ar!==null&&ar.ref!==lr)&&(or.flags|=512,or.flags|=2097152)}function cj(ar,or,lr,cr,ur){var dr=Zf(lr)?Xf:H$1.current;return dr=Yf(or,dr),ch(or,ur),lr=Nh(ar,or,lr,cr,dr,ur),cr=Sh(),ar!==null&&!dh?(or.updateQueue=ar.updateQueue,or.flags&=-2053,ar.lanes&=~ur,Zi(ar,or,ur)):(I$1&&cr&&vg(or),or.flags|=1,Xi(ar,or,lr,ur),or.child)}function hj(ar,or,lr,cr,ur){if(Zf(lr)){var dr=!0;cg(or)}else dr=!1;if(ch(or,ur),or.stateNode===null)ij(ar,or),Gi(or,lr,cr),Ii(or,lr,cr,ur),cr=!0;else if(ar===null){var hr=or.stateNode,pr=or.memoizedProps;hr.props=pr;var mr=hr.context,fr=lr.contextType;typeof fr=="object"&&fr!==null?fr=eh(fr):(fr=Zf(lr)?Xf:H$1.current,fr=Yf(or,fr));var xr=lr.getDerivedStateFromProps,Er=typeof xr=="function"||typeof hr.getSnapshotBeforeUpdate=="function";Er||typeof hr.UNSAFE_componentWillReceiveProps!="function"&&typeof hr.componentWillReceiveProps!="function"||(pr!==cr||mr!==fr)&&Hi(or,hr,cr,fr),jh=!1;var vr=or.memoizedState;hr.state=vr,qh(or,cr,hr,ur),mr=or.memoizedState,pr!==cr||vr!==mr||Wf.current||jh?(typeof xr=="function"&&(Di(or,lr,xr,cr),mr=or.memoizedState),(pr=jh||Fi(or,lr,pr,cr,vr,mr,fr))?(Er||typeof hr.UNSAFE_componentWillMount!="function"&&typeof hr.componentWillMount!="function"||(typeof hr.componentWillMount=="function"&&hr.componentWillMount(),typeof hr.UNSAFE_componentWillMount=="function"&&hr.UNSAFE_componentWillMount()),typeof hr.componentDidMount=="function"&&(or.flags|=4194308)):(typeof hr.componentDidMount=="function"&&(or.flags|=4194308),or.memoizedProps=cr,or.memoizedState=mr),hr.props=cr,hr.state=mr,hr.context=fr,cr=pr):(typeof hr.componentDidMount=="function"&&(or.flags|=4194308),cr=!1)}else{hr=or.stateNode,lh(ar,or),pr=or.memoizedProps,fr=or.type===or.elementType?pr:Ci(or.type,pr),hr.props=fr,Er=or.pendingProps,vr=hr.context,mr=lr.contextType,typeof mr=="object"&&mr!==null?mr=eh(mr):(mr=Zf(lr)?Xf:H$1.current,mr=Yf(or,mr));var gr=lr.getDerivedStateFromProps;(xr=typeof gr=="function"||typeof hr.getSnapshotBeforeUpdate=="function")||typeof hr.UNSAFE_componentWillReceiveProps!="function"&&typeof hr.componentWillReceiveProps!="function"||(pr!==Er||vr!==mr)&&Hi(or,hr,cr,mr),jh=!1,vr=or.memoizedState,hr.state=vr,qh(or,cr,hr,ur);var yr=or.memoizedState;pr!==Er||vr!==yr||Wf.current||jh?(typeof gr=="function"&&(Di(or,lr,gr,cr),yr=or.memoizedState),(fr=jh||Fi(or,lr,fr,cr,vr,yr,mr)||!1)?(xr||typeof hr.UNSAFE_componentWillUpdate!="function"&&typeof hr.componentWillUpdate!="function"||(typeof hr.componentWillUpdate=="function"&&hr.componentWillUpdate(cr,yr,mr),typeof hr.UNSAFE_componentWillUpdate=="function"&&hr.UNSAFE_componentWillUpdate(cr,yr,mr)),typeof hr.componentDidUpdate=="function"&&(or.flags|=4),typeof hr.getSnapshotBeforeUpdate=="function"&&(or.flags|=1024)):(typeof hr.componentDidUpdate!="function"||pr===ar.memoizedProps&&vr===ar.memoizedState||(or.flags|=4),typeof hr.getSnapshotBeforeUpdate!="function"||pr===ar.memoizedProps&&vr===ar.memoizedState||(or.flags|=1024),or.memoizedProps=cr,or.memoizedState=yr),hr.props=cr,hr.state=yr,hr.context=mr,cr=fr):(typeof hr.componentDidUpdate!="function"||pr===ar.memoizedProps&&vr===ar.memoizedState||(or.flags|=4),typeof hr.getSnapshotBeforeUpdate!="function"||pr===ar.memoizedProps&&vr===ar.memoizedState||(or.flags|=1024),cr=!1)}return jj(ar,or,lr,cr,dr,ur)}function jj(ar,or,lr,cr,ur,dr){gj(ar,or);var hr=(or.flags&128)!==0;if(!cr&&!hr)return ur&&dg(or,lr,!1),Zi(ar,or,dr);cr=or.stateNode,Wi.current=or;var pr=hr&&typeof lr.getDerivedStateFromError!="function"?null:cr.render();return or.flags|=1,ar!==null&&hr?(or.child=Ug(or,ar.child,null,dr),or.child=Ug(or,null,pr,dr)):Xi(ar,or,pr,dr),or.memoizedState=cr.state,ur&&dg(or,lr,!0),or.child}function kj(ar){var or=ar.stateNode;or.pendingContext?ag(ar,or.pendingContext,or.pendingContext!==or.context):or.context&&ag(ar,or.context,!1),yh(ar,or.containerInfo)}function lj(ar,or,lr,cr,ur){return Ig(),Jg(ur),or.flags|=256,Xi(ar,or,lr,cr),or.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(ar){return{baseLanes:ar,cachePool:null,transitions:null}}function oj(ar,or,lr){var cr=or.pendingProps,ur=L$1.current,dr=!1,hr=(or.flags&128)!==0,pr;if((pr=hr)||(pr=ar!==null&&ar.memoizedState===null?!1:(ur&2)!==0),pr?(dr=!0,or.flags&=-129):(ar===null||ar.memoizedState!==null)&&(ur|=1),G$1(L$1,ur&1),ar===null)return Eg(or),ar=or.memoizedState,ar!==null&&(ar=ar.dehydrated,ar!==null)?(or.mode&1?ar.data==="$!"?or.lanes=8:or.lanes=1073741824:or.lanes=1,null):(hr=cr.children,ar=cr.fallback,dr?(cr=or.mode,dr=or.child,hr={mode:"hidden",children:hr},!(cr&1)&&dr!==null?(dr.childLanes=0,dr.pendingProps=hr):dr=pj(hr,cr,0,null),ar=Tg(ar,cr,lr,null),dr.return=or,ar.return=or,dr.sibling=ar,or.child=dr,or.child.memoizedState=nj(lr),or.memoizedState=mj,ar):qj(or,hr));if(ur=ar.memoizedState,ur!==null&&(pr=ur.dehydrated,pr!==null))return rj(ar,or,hr,cr,pr,ur,lr);if(dr){dr=cr.fallback,hr=or.mode,ur=ar.child,pr=ur.sibling;var mr={mode:"hidden",children:cr.children};return!(hr&1)&&or.child!==ur?(cr=or.child,cr.childLanes=0,cr.pendingProps=mr,or.deletions=null):(cr=Pg(ur,mr),cr.subtreeFlags=ur.subtreeFlags&14680064),pr!==null?dr=Pg(pr,dr):(dr=Tg(dr,hr,lr,null),dr.flags|=2),dr.return=or,cr.return=or,cr.sibling=dr,or.child=cr,cr=dr,dr=or.child,hr=ar.child.memoizedState,hr=hr===null?nj(lr):{baseLanes:hr.baseLanes|lr,cachePool:null,transitions:hr.transitions},dr.memoizedState=hr,dr.childLanes=ar.childLanes&~lr,or.memoizedState=mj,cr}return dr=ar.child,ar=dr.sibling,cr=Pg(dr,{mode:"visible",children:cr.children}),!(or.mode&1)&&(cr.lanes=lr),cr.return=or,cr.sibling=null,ar!==null&&(lr=or.deletions,lr===null?(or.deletions=[ar],or.flags|=16):lr.push(ar)),or.child=cr,or.memoizedState=null,cr}function qj(ar,or){return or=pj({mode:"visible",children:or},ar.mode,0,null),or.return=ar,ar.child=or}function sj(ar,or,lr,cr){return cr!==null&&Jg(cr),Ug(or,ar.child,null,lr),ar=qj(or,or.pendingProps.children),ar.flags|=2,or.memoizedState=null,ar}function rj(ar,or,lr,cr,ur,dr,hr){if(lr)return or.flags&256?(or.flags&=-257,cr=Ki(Error(p$1(422))),sj(ar,or,hr,cr)):or.memoizedState!==null?(or.child=ar.child,or.flags|=128,null):(dr=cr.fallback,ur=or.mode,cr=pj({mode:"visible",children:cr.children},ur,0,null),dr=Tg(dr,ur,hr,null),dr.flags|=2,cr.return=or,dr.return=or,cr.sibling=dr,or.child=cr,or.mode&1&&Ug(or,ar.child,null,hr),or.child.memoizedState=nj(hr),or.memoizedState=mj,dr);if(!(or.mode&1))return sj(ar,or,hr,null);if(ur.data==="$!"){if(cr=ur.nextSibling&&ur.nextSibling.dataset,cr)var pr=cr.dgst;return cr=pr,dr=Error(p$1(419)),cr=Ki(dr,cr,void 0),sj(ar,or,hr,cr)}if(pr=(hr&ar.childLanes)!==0,dh||pr){if(cr=Q$1,cr!==null){switch(hr&-hr){case 4:ur=2;break;case 16:ur=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ur=32;break;case 536870912:ur=268435456;break;default:ur=0}ur=ur&(cr.suspendedLanes|hr)?0:ur,ur!==0&&ur!==dr.retryLane&&(dr.retryLane=ur,ih(ar,ur),gi(cr,ar,ur,-1))}return tj(),cr=Ki(Error(p$1(421))),sj(ar,or,hr,cr)}return ur.data==="$?"?(or.flags|=128,or.child=ar.child,or=uj.bind(null,ar),ur._reactRetry=or,null):(ar=dr.treeContext,yg=Lf(ur.nextSibling),xg=or,I$1=!0,zg=null,ar!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=ar.id,sg=ar.overflow,qg=or),or=qj(or,cr.children),or.flags|=4096,or)}function vj(ar,or,lr){ar.lanes|=or;var cr=ar.alternate;cr!==null&&(cr.lanes|=or),bh(ar.return,or,lr)}function wj(ar,or,lr,cr,ur){var dr=ar.memoizedState;dr===null?ar.memoizedState={isBackwards:or,rendering:null,renderingStartTime:0,last:cr,tail:lr,tailMode:ur}:(dr.isBackwards=or,dr.rendering=null,dr.renderingStartTime=0,dr.last=cr,dr.tail=lr,dr.tailMode=ur)}function xj(ar,or,lr){var cr=or.pendingProps,ur=cr.revealOrder,dr=cr.tail;if(Xi(ar,or,cr.children,lr),cr=L$1.current,cr&2)cr=cr&1|2,or.flags|=128;else{if(ar!==null&&ar.flags&128)e:for(ar=or.child;ar!==null;){if(ar.tag===13)ar.memoizedState!==null&&vj(ar,lr,or);else if(ar.tag===19)vj(ar,lr,or);else if(ar.child!==null){ar.child.return=ar,ar=ar.child;continue}if(ar===or)break e;for(;ar.sibling===null;){if(ar.return===null||ar.return===or)break e;ar=ar.return}ar.sibling.return=ar.return,ar=ar.sibling}cr&=1}if(G$1(L$1,cr),!(or.mode&1))or.memoizedState=null;else switch(ur){case"forwards":for(lr=or.child,ur=null;lr!==null;)ar=lr.alternate,ar!==null&&Ch(ar)===null&&(ur=lr),lr=lr.sibling;lr=ur,lr===null?(ur=or.child,or.child=null):(ur=lr.sibling,lr.sibling=null),wj(or,!1,ur,lr,dr);break;case"backwards":for(lr=null,ur=or.child,or.child=null;ur!==null;){if(ar=ur.alternate,ar!==null&&Ch(ar)===null){or.child=ur;break}ar=ur.sibling,ur.sibling=lr,lr=ur,ur=ar}wj(or,!0,lr,null,dr);break;case"together":wj(or,!1,null,null,void 0);break;default:or.memoizedState=null}return or.child}function ij(ar,or){!(or.mode&1)&&ar!==null&&(ar.alternate=null,or.alternate=null,or.flags|=2)}function Zi(ar,or,lr){if(ar!==null&&(or.dependencies=ar.dependencies),rh|=or.lanes,!(lr&or.childLanes))return null;if(ar!==null&&or.child!==ar.child)throw Error(p$1(153));if(or.child!==null){for(ar=or.child,lr=Pg(ar,ar.pendingProps),or.child=lr,lr.return=or;ar.sibling!==null;)ar=ar.sibling,lr=lr.sibling=Pg(ar,ar.pendingProps),lr.return=or;lr.sibling=null}return or.child}function yj(ar,or,lr){switch(or.tag){case 3:kj(or),Ig();break;case 5:Ah(or);break;case 1:Zf(or.type)&&cg(or);break;case 4:yh(or,or.stateNode.containerInfo);break;case 10:var cr=or.type._context,ur=or.memoizedProps.value;G$1(Wg,cr._currentValue),cr._currentValue=ur;break;case 13:if(cr=or.memoizedState,cr!==null)return cr.dehydrated!==null?(G$1(L$1,L$1.current&1),or.flags|=128,null):lr&or.child.childLanes?oj(ar,or,lr):(G$1(L$1,L$1.current&1),ar=Zi(ar,or,lr),ar!==null?ar.sibling:null);G$1(L$1,L$1.current&1);break;case 19:if(cr=(lr&or.childLanes)!==0,ar.flags&128){if(cr)return xj(ar,or,lr);or.flags|=128}if(ur=or.memoizedState,ur!==null&&(ur.rendering=null,ur.tail=null,ur.lastEffect=null),G$1(L$1,L$1.current),cr)break;return null;case 22:case 23:return or.lanes=0,dj(ar,or,lr)}return Zi(ar,or,lr)}var zj,Aj,Bj,Cj;zj=function(ar,or){for(var lr=or.child;lr!==null;){if(lr.tag===5||lr.tag===6)ar.appendChild(lr.stateNode);else if(lr.tag!==4&&lr.child!==null){lr.child.return=lr,lr=lr.child;continue}if(lr===or)break;for(;lr.sibling===null;){if(lr.return===null||lr.return===or)return;lr=lr.return}lr.sibling.return=lr.return,lr=lr.sibling}};Aj=function(){};Bj=function(ar,or,lr,cr){var ur=ar.memoizedProps;if(ur!==cr){ar=or.stateNode,xh(uh.current);var dr=null;switch(lr){case"input":ur=Ya(ar,ur),cr=Ya(ar,cr),dr=[];break;case"select":ur=A$1({},ur,{value:void 0}),cr=A$1({},cr,{value:void 0}),dr=[];break;case"textarea":ur=gb(ar,ur),cr=gb(ar,cr),dr=[];break;default:typeof ur.onClick!="function"&&typeof cr.onClick=="function"&&(ar.onclick=Bf)}ub(lr,cr);var hr;lr=null;for(fr in ur)if(!cr.hasOwnProperty(fr)&&ur.hasOwnProperty(fr)&&ur[fr]!=null)if(fr==="style"){var pr=ur[fr];for(hr in pr)pr.hasOwnProperty(hr)&&(lr||(lr={}),lr[hr]="")}else fr!=="dangerouslySetInnerHTML"&&fr!=="children"&&fr!=="suppressContentEditableWarning"&&fr!=="suppressHydrationWarning"&&fr!=="autoFocus"&&(ea.hasOwnProperty(fr)?dr||(dr=[]):(dr=dr||[]).push(fr,null));for(fr in cr){var mr=cr[fr];if(pr=ur!=null?ur[fr]:void 0,cr.hasOwnProperty(fr)&&mr!==pr&&(mr!=null||pr!=null))if(fr==="style")if(pr){for(hr in pr)!pr.hasOwnProperty(hr)||mr&&mr.hasOwnProperty(hr)||(lr||(lr={}),lr[hr]="");for(hr in mr)mr.hasOwnProperty(hr)&&pr[hr]!==mr[hr]&&(lr||(lr={}),lr[hr]=mr[hr])}else lr||(dr||(dr=[]),dr.push(fr,lr)),lr=mr;else fr==="dangerouslySetInnerHTML"?(mr=mr?mr.__html:void 0,pr=pr?pr.__html:void 0,mr!=null&&pr!==mr&&(dr=dr||[]).push(fr,mr)):fr==="children"?typeof mr!="string"&&typeof mr!="number"||(dr=dr||[]).push(fr,""+mr):fr!=="suppressContentEditableWarning"&&fr!=="suppressHydrationWarning"&&(ea.hasOwnProperty(fr)?(mr!=null&&fr==="onScroll"&&D$1("scroll",ar),dr||pr===mr||(dr=[])):(dr=dr||[]).push(fr,mr))}lr&&(dr=dr||[]).push("style",lr);var fr=dr;(or.updateQueue=fr)&&(or.flags|=4)}};Cj=function(ar,or,lr,cr){lr!==cr&&(or.flags|=4)};function Dj(ar,or){if(!I$1)switch(ar.tailMode){case"hidden":or=ar.tail;for(var lr=null;or!==null;)or.alternate!==null&&(lr=or),or=or.sibling;lr===null?ar.tail=null:lr.sibling=null;break;case"collapsed":lr=ar.tail;for(var cr=null;lr!==null;)lr.alternate!==null&&(cr=lr),lr=lr.sibling;cr===null?or||ar.tail===null?ar.tail=null:ar.tail.sibling=null:cr.sibling=null}}function S$1(ar){var or=ar.alternate!==null&&ar.alternate.child===ar.child,lr=0,cr=0;if(or)for(var ur=ar.child;ur!==null;)lr|=ur.lanes|ur.childLanes,cr|=ur.subtreeFlags&14680064,cr|=ur.flags&14680064,ur.return=ar,ur=ur.sibling;else for(ur=ar.child;ur!==null;)lr|=ur.lanes|ur.childLanes,cr|=ur.subtreeFlags,cr|=ur.flags,ur.return=ar,ur=ur.sibling;return ar.subtreeFlags|=cr,ar.childLanes=lr,or}function Ej(ar,or,lr){var cr=or.pendingProps;switch(wg(or),or.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(or),null;case 1:return Zf(or.type)&&$f(),S$1(or),null;case 3:return cr=or.stateNode,zh(),E$1(Wf),E$1(H$1),Eh(),cr.pendingContext&&(cr.context=cr.pendingContext,cr.pendingContext=null),(ar===null||ar.child===null)&&(Gg(or)?or.flags|=4:ar===null||ar.memoizedState.isDehydrated&&!(or.flags&256)||(or.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(ar,or),S$1(or),null;case 5:Bh(or);var ur=xh(wh.current);if(lr=or.type,ar!==null&&or.stateNode!=null)Bj(ar,or,lr,cr,ur),ar.ref!==or.ref&&(or.flags|=512,or.flags|=2097152);else{if(!cr){if(or.stateNode===null)throw Error(p$1(166));return S$1(or),null}if(ar=xh(uh.current),Gg(or)){cr=or.stateNode,lr=or.type;var dr=or.memoizedProps;switch(cr[Of]=or,cr[Pf]=dr,ar=(or.mode&1)!==0,lr){case"dialog":D$1("cancel",cr),D$1("close",cr);break;case"iframe":case"object":case"embed":D$1("load",cr);break;case"video":case"audio":for(ur=0;ur<lf.length;ur++)D$1(lf[ur],cr);break;case"source":D$1("error",cr);break;case"img":case"image":case"link":D$1("error",cr),D$1("load",cr);break;case"details":D$1("toggle",cr);break;case"input":Za(cr,dr),D$1("invalid",cr);break;case"select":cr._wrapperState={wasMultiple:!!dr.multiple},D$1("invalid",cr);break;case"textarea":hb(cr,dr),D$1("invalid",cr)}ub(lr,dr),ur=null;for(var hr in dr)if(dr.hasOwnProperty(hr)){var pr=dr[hr];hr==="children"?typeof pr=="string"?cr.textContent!==pr&&(dr.suppressHydrationWarning!==!0&&Af(cr.textContent,pr,ar),ur=["children",pr]):typeof pr=="number"&&cr.textContent!==""+pr&&(dr.suppressHydrationWarning!==!0&&Af(cr.textContent,pr,ar),ur=["children",""+pr]):ea.hasOwnProperty(hr)&&pr!=null&&hr==="onScroll"&&D$1("scroll",cr)}switch(lr){case"input":Va(cr),db$1(cr,dr,!0);break;case"textarea":Va(cr),jb(cr);break;case"select":case"option":break;default:typeof dr.onClick=="function"&&(cr.onclick=Bf)}cr=ur,or.updateQueue=cr,cr!==null&&(or.flags|=4)}else{hr=ur.nodeType===9?ur:ur.ownerDocument,ar==="http://www.w3.org/1999/xhtml"&&(ar=kb(lr)),ar==="http://www.w3.org/1999/xhtml"?lr==="script"?(ar=hr.createElement("div"),ar.innerHTML="<script><\/script>",ar=ar.removeChild(ar.firstChild)):typeof cr.is=="string"?ar=hr.createElement(lr,{is:cr.is}):(ar=hr.createElement(lr),lr==="select"&&(hr=ar,cr.multiple?hr.multiple=!0:cr.size&&(hr.size=cr.size))):ar=hr.createElementNS(ar,lr),ar[Of]=or,ar[Pf]=cr,zj(ar,or,!1,!1),or.stateNode=ar;e:{switch(hr=vb(lr,cr),lr){case"dialog":D$1("cancel",ar),D$1("close",ar),ur=cr;break;case"iframe":case"object":case"embed":D$1("load",ar),ur=cr;break;case"video":case"audio":for(ur=0;ur<lf.length;ur++)D$1(lf[ur],ar);ur=cr;break;case"source":D$1("error",ar),ur=cr;break;case"img":case"image":case"link":D$1("error",ar),D$1("load",ar),ur=cr;break;case"details":D$1("toggle",ar),ur=cr;break;case"input":Za(ar,cr),ur=Ya(ar,cr),D$1("invalid",ar);break;case"option":ur=cr;break;case"select":ar._wrapperState={wasMultiple:!!cr.multiple},ur=A$1({},cr,{value:void 0}),D$1("invalid",ar);break;case"textarea":hb(ar,cr),ur=gb(ar,cr),D$1("invalid",ar);break;default:ur=cr}ub(lr,ur),pr=ur;for(dr in pr)if(pr.hasOwnProperty(dr)){var mr=pr[dr];dr==="style"?sb(ar,mr):dr==="dangerouslySetInnerHTML"?(mr=mr?mr.__html:void 0,mr!=null&&nb(ar,mr)):dr==="children"?typeof mr=="string"?(lr!=="textarea"||mr!=="")&&ob(ar,mr):typeof mr=="number"&&ob(ar,""+mr):dr!=="suppressContentEditableWarning"&&dr!=="suppressHydrationWarning"&&dr!=="autoFocus"&&(ea.hasOwnProperty(dr)?mr!=null&&dr==="onScroll"&&D$1("scroll",ar):mr!=null&&ta(ar,dr,mr,hr))}switch(lr){case"input":Va(ar),db$1(ar,cr,!1);break;case"textarea":Va(ar),jb(ar);break;case"option":cr.value!=null&&ar.setAttribute("value",""+Sa(cr.value));break;case"select":ar.multiple=!!cr.multiple,dr=cr.value,dr!=null?fb(ar,!!cr.multiple,dr,!1):cr.defaultValue!=null&&fb(ar,!!cr.multiple,cr.defaultValue,!0);break;default:typeof ur.onClick=="function"&&(ar.onclick=Bf)}switch(lr){case"button":case"input":case"select":case"textarea":cr=!!cr.autoFocus;break e;case"img":cr=!0;break e;default:cr=!1}}cr&&(or.flags|=4)}or.ref!==null&&(or.flags|=512,or.flags|=2097152)}return S$1(or),null;case 6:if(ar&&or.stateNode!=null)Cj(ar,or,ar.memoizedProps,cr);else{if(typeof cr!="string"&&or.stateNode===null)throw Error(p$1(166));if(lr=xh(wh.current),xh(uh.current),Gg(or)){if(cr=or.stateNode,lr=or.memoizedProps,cr[Of]=or,(dr=cr.nodeValue!==lr)&&(ar=xg,ar!==null))switch(ar.tag){case 3:Af(cr.nodeValue,lr,(ar.mode&1)!==0);break;case 5:ar.memoizedProps.suppressHydrationWarning!==!0&&Af(cr.nodeValue,lr,(ar.mode&1)!==0)}dr&&(or.flags|=4)}else cr=(lr.nodeType===9?lr:lr.ownerDocument).createTextNode(cr),cr[Of]=or,or.stateNode=cr}return S$1(or),null;case 13:if(E$1(L$1),cr=or.memoizedState,ar===null||ar.memoizedState!==null&&ar.memoizedState.dehydrated!==null){if(I$1&&yg!==null&&or.mode&1&&!(or.flags&128))Hg(),Ig(),or.flags|=98560,dr=!1;else if(dr=Gg(or),cr!==null&&cr.dehydrated!==null){if(ar===null){if(!dr)throw Error(p$1(318));if(dr=or.memoizedState,dr=dr!==null?dr.dehydrated:null,!dr)throw Error(p$1(317));dr[Of]=or}else Ig(),!(or.flags&128)&&(or.memoizedState=null),or.flags|=4;S$1(or),dr=!1}else zg!==null&&(Fj(zg),zg=null),dr=!0;if(!dr)return or.flags&65536?or:null}return or.flags&128?(or.lanes=lr,or):(cr=cr!==null,cr!==(ar!==null&&ar.memoizedState!==null)&&cr&&(or.child.flags|=8192,or.mode&1&&(ar===null||L$1.current&1?T$1===0&&(T$1=3):tj())),or.updateQueue!==null&&(or.flags|=4),S$1(or),null);case 4:return zh(),Aj(ar,or),ar===null&&sf(or.stateNode.containerInfo),S$1(or),null;case 10:return ah(or.type._context),S$1(or),null;case 17:return Zf(or.type)&&$f(),S$1(or),null;case 19:if(E$1(L$1),dr=or.memoizedState,dr===null)return S$1(or),null;if(cr=(or.flags&128)!==0,hr=dr.rendering,hr===null)if(cr)Dj(dr,!1);else{if(T$1!==0||ar!==null&&ar.flags&128)for(ar=or.child;ar!==null;){if(hr=Ch(ar),hr!==null){for(or.flags|=128,Dj(dr,!1),cr=hr.updateQueue,cr!==null&&(or.updateQueue=cr,or.flags|=4),or.subtreeFlags=0,cr=lr,lr=or.child;lr!==null;)dr=lr,ar=cr,dr.flags&=14680066,hr=dr.alternate,hr===null?(dr.childLanes=0,dr.lanes=ar,dr.child=null,dr.subtreeFlags=0,dr.memoizedProps=null,dr.memoizedState=null,dr.updateQueue=null,dr.dependencies=null,dr.stateNode=null):(dr.childLanes=hr.childLanes,dr.lanes=hr.lanes,dr.child=hr.child,dr.subtreeFlags=0,dr.deletions=null,dr.memoizedProps=hr.memoizedProps,dr.memoizedState=hr.memoizedState,dr.updateQueue=hr.updateQueue,dr.type=hr.type,ar=hr.dependencies,dr.dependencies=ar===null?null:{lanes:ar.lanes,firstContext:ar.firstContext}),lr=lr.sibling;return G$1(L$1,L$1.current&1|2),or.child}ar=ar.sibling}dr.tail!==null&&B$1()>Gj&&(or.flags|=128,cr=!0,Dj(dr,!1),or.lanes=4194304)}else{if(!cr)if(ar=Ch(hr),ar!==null){if(or.flags|=128,cr=!0,lr=ar.updateQueue,lr!==null&&(or.updateQueue=lr,or.flags|=4),Dj(dr,!0),dr.tail===null&&dr.tailMode==="hidden"&&!hr.alternate&&!I$1)return S$1(or),null}else 2*B$1()-dr.renderingStartTime>Gj&&lr!==1073741824&&(or.flags|=128,cr=!0,Dj(dr,!1),or.lanes=4194304);dr.isBackwards?(hr.sibling=or.child,or.child=hr):(lr=dr.last,lr!==null?lr.sibling=hr:or.child=hr,dr.last=hr)}return dr.tail!==null?(or=dr.tail,dr.rendering=or,dr.tail=or.sibling,dr.renderingStartTime=B$1(),or.sibling=null,lr=L$1.current,G$1(L$1,cr?lr&1|2:lr&1),or):(S$1(or),null);case 22:case 23:return Hj(),cr=or.memoizedState!==null,ar!==null&&ar.memoizedState!==null!==cr&&(or.flags|=8192),cr&&or.mode&1?fj&1073741824&&(S$1(or),or.subtreeFlags&6&&(or.flags|=8192)):S$1(or),null;case 24:return null;case 25:return null}throw Error(p$1(156,or.tag))}function Ij(ar,or){switch(wg(or),or.tag){case 1:return Zf(or.type)&&$f(),ar=or.flags,ar&65536?(or.flags=ar&-65537|128,or):null;case 3:return zh(),E$1(Wf),E$1(H$1),Eh(),ar=or.flags,ar&65536&&!(ar&128)?(or.flags=ar&-65537|128,or):null;case 5:return Bh(or),null;case 13:if(E$1(L$1),ar=or.memoizedState,ar!==null&&ar.dehydrated!==null){if(or.alternate===null)throw Error(p$1(340));Ig()}return ar=or.flags,ar&65536?(or.flags=ar&-65537|128,or):null;case 19:return E$1(L$1),null;case 4:return zh(),null;case 10:return ah(or.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U$1=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Lj(ar,or){var lr=ar.ref;if(lr!==null)if(typeof lr=="function")try{lr(null)}catch(cr){W$1(ar,or,cr)}else lr.current=null}function Mj(ar,or,lr){try{lr()}catch(cr){W$1(ar,or,cr)}}var Nj=!1;function Oj(ar,or){if(Cf=dd,ar=Me$1(),Ne$1(ar)){if("selectionStart"in ar)var lr={start:ar.selectionStart,end:ar.selectionEnd};else e:{lr=(lr=ar.ownerDocument)&&lr.defaultView||window;var cr=lr.getSelection&&lr.getSelection();if(cr&&cr.rangeCount!==0){lr=cr.anchorNode;var ur=cr.anchorOffset,dr=cr.focusNode;cr=cr.focusOffset;try{lr.nodeType,dr.nodeType}catch{lr=null;break e}var hr=0,pr=-1,mr=-1,fr=0,xr=0,Er=ar,vr=null;t:for(;;){for(var gr;Er!==lr||ur!==0&&Er.nodeType!==3||(pr=hr+ur),Er!==dr||cr!==0&&Er.nodeType!==3||(mr=hr+cr),Er.nodeType===3&&(hr+=Er.nodeValue.length),(gr=Er.firstChild)!==null;)vr=Er,Er=gr;for(;;){if(Er===ar)break t;if(vr===lr&&++fr===ur&&(pr=hr),vr===dr&&++xr===cr&&(mr=hr),(gr=Er.nextSibling)!==null)break;Er=vr,vr=Er.parentNode}Er=gr}lr=pr===-1||mr===-1?null:{start:pr,end:mr}}else lr=null}lr=lr||{start:0,end:0}}else lr=null;for(Df={focusedElem:ar,selectionRange:lr},dd=!1,V$1=or;V$1!==null;)if(or=V$1,ar=or.child,(or.subtreeFlags&1028)!==0&&ar!==null)ar.return=or,V$1=ar;else for(;V$1!==null;){or=V$1;try{var yr=or.alternate;if(or.flags&1024)switch(or.tag){case 0:case 11:case 15:break;case 1:if(yr!==null){var br=yr.memoizedProps,_r=yr.memoizedState,jr=or.stateNode,wr=jr.getSnapshotBeforeUpdate(or.elementType===or.type?br:Ci(or.type,br),_r);jr.__reactInternalSnapshotBeforeUpdate=wr}break;case 3:var Sr=or.stateNode.containerInfo;Sr.nodeType===1?Sr.textContent="":Sr.nodeType===9&&Sr.documentElement&&Sr.removeChild(Sr.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(Tr){W$1(or,or.return,Tr)}if(ar=or.sibling,ar!==null){ar.return=or.return,V$1=ar;break}V$1=or.return}return yr=Nj,Nj=!1,yr}function Pj(ar,or,lr){var cr=or.updateQueue;if(cr=cr!==null?cr.lastEffect:null,cr!==null){var ur=cr=cr.next;do{if((ur.tag&ar)===ar){var dr=ur.destroy;ur.destroy=void 0,dr!==void 0&&Mj(or,lr,dr)}ur=ur.next}while(ur!==cr)}}function Qj(ar,or){if(or=or.updateQueue,or=or!==null?or.lastEffect:null,or!==null){var lr=or=or.next;do{if((lr.tag&ar)===ar){var cr=lr.create;lr.destroy=cr()}lr=lr.next}while(lr!==or)}}function Rj(ar){var or=ar.ref;if(or!==null){var lr=ar.stateNode;switch(ar.tag){case 5:ar=lr;break;default:ar=lr}typeof or=="function"?or(ar):or.current=ar}}function Sj(ar){var or=ar.alternate;or!==null&&(ar.alternate=null,Sj(or)),ar.child=null,ar.deletions=null,ar.sibling=null,ar.tag===5&&(or=ar.stateNode,or!==null&&(delete or[Of],delete or[Pf],delete or[of],delete or[Qf],delete or[Rf])),ar.stateNode=null,ar.return=null,ar.dependencies=null,ar.memoizedProps=null,ar.memoizedState=null,ar.pendingProps=null,ar.stateNode=null,ar.updateQueue=null}function Tj(ar){return ar.tag===5||ar.tag===3||ar.tag===4}function Uj(ar){e:for(;;){for(;ar.sibling===null;){if(ar.return===null||Tj(ar.return))return null;ar=ar.return}for(ar.sibling.return=ar.return,ar=ar.sibling;ar.tag!==5&&ar.tag!==6&&ar.tag!==18;){if(ar.flags&2||ar.child===null||ar.tag===4)continue e;ar.child.return=ar,ar=ar.child}if(!(ar.flags&2))return ar.stateNode}}function Vj(ar,or,lr){var cr=ar.tag;if(cr===5||cr===6)ar=ar.stateNode,or?lr.nodeType===8?lr.parentNode.insertBefore(ar,or):lr.insertBefore(ar,or):(lr.nodeType===8?(or=lr.parentNode,or.insertBefore(ar,lr)):(or=lr,or.appendChild(ar)),lr=lr._reactRootContainer,lr!=null||or.onclick!==null||(or.onclick=Bf));else if(cr!==4&&(ar=ar.child,ar!==null))for(Vj(ar,or,lr),ar=ar.sibling;ar!==null;)Vj(ar,or,lr),ar=ar.sibling}function Wj(ar,or,lr){var cr=ar.tag;if(cr===5||cr===6)ar=ar.stateNode,or?lr.insertBefore(ar,or):lr.appendChild(ar);else if(cr!==4&&(ar=ar.child,ar!==null))for(Wj(ar,or,lr),ar=ar.sibling;ar!==null;)Wj(ar,or,lr),ar=ar.sibling}var X$1=null,Xj=!1;function Yj(ar,or,lr){for(lr=lr.child;lr!==null;)Zj(ar,or,lr),lr=lr.sibling}function Zj(ar,or,lr){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,lr)}catch{}switch(lr.tag){case 5:U$1||Lj(lr,or);case 6:var cr=X$1,ur=Xj;X$1=null,Yj(ar,or,lr),X$1=cr,Xj=ur,X$1!==null&&(Xj?(ar=X$1,lr=lr.stateNode,ar.nodeType===8?ar.parentNode.removeChild(lr):ar.removeChild(lr)):X$1.removeChild(lr.stateNode));break;case 18:X$1!==null&&(Xj?(ar=X$1,lr=lr.stateNode,ar.nodeType===8?Kf(ar.parentNode,lr):ar.nodeType===1&&Kf(ar,lr),bd(ar)):Kf(X$1,lr.stateNode));break;case 4:cr=X$1,ur=Xj,X$1=lr.stateNode.containerInfo,Xj=!0,Yj(ar,or,lr),X$1=cr,Xj=ur;break;case 0:case 11:case 14:case 15:if(!U$1&&(cr=lr.updateQueue,cr!==null&&(cr=cr.lastEffect,cr!==null))){ur=cr=cr.next;do{var dr=ur,hr=dr.destroy;dr=dr.tag,hr!==void 0&&(dr&2||dr&4)&&Mj(lr,or,hr),ur=ur.next}while(ur!==cr)}Yj(ar,or,lr);break;case 1:if(!U$1&&(Lj(lr,or),cr=lr.stateNode,typeof cr.componentWillUnmount=="function"))try{cr.props=lr.memoizedProps,cr.state=lr.memoizedState,cr.componentWillUnmount()}catch(pr){W$1(lr,or,pr)}Yj(ar,or,lr);break;case 21:Yj(ar,or,lr);break;case 22:lr.mode&1?(U$1=(cr=U$1)||lr.memoizedState!==null,Yj(ar,or,lr),U$1=cr):Yj(ar,or,lr);break;default:Yj(ar,or,lr)}}function ak(ar){var or=ar.updateQueue;if(or!==null){ar.updateQueue=null;var lr=ar.stateNode;lr===null&&(lr=ar.stateNode=new Kj),or.forEach(function(cr){var ur=bk.bind(null,ar,cr);lr.has(cr)||(lr.add(cr),cr.then(ur,ur))})}}function ck(ar,or){var lr=or.deletions;if(lr!==null)for(var cr=0;cr<lr.length;cr++){var ur=lr[cr];try{var dr=ar,hr=or,pr=hr;e:for(;pr!==null;){switch(pr.tag){case 5:X$1=pr.stateNode,Xj=!1;break e;case 3:X$1=pr.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=pr.stateNode.containerInfo,Xj=!0;break e}pr=pr.return}if(X$1===null)throw Error(p$1(160));Zj(dr,hr,ur),X$1=null,Xj=!1;var mr=ur.alternate;mr!==null&&(mr.return=null),ur.return=null}catch(fr){W$1(ur,or,fr)}}if(or.subtreeFlags&12854)for(or=or.child;or!==null;)dk(or,ar),or=or.sibling}function dk(ar,or){var lr=ar.alternate,cr=ar.flags;switch(ar.tag){case 0:case 11:case 14:case 15:if(ck(or,ar),ek(ar),cr&4){try{Pj(3,ar,ar.return),Qj(3,ar)}catch(br){W$1(ar,ar.return,br)}try{Pj(5,ar,ar.return)}catch(br){W$1(ar,ar.return,br)}}break;case 1:ck(or,ar),ek(ar),cr&512&&lr!==null&&Lj(lr,lr.return);break;case 5:if(ck(or,ar),ek(ar),cr&512&&lr!==null&&Lj(lr,lr.return),ar.flags&32){var ur=ar.stateNode;try{ob(ur,"")}catch(br){W$1(ar,ar.return,br)}}if(cr&4&&(ur=ar.stateNode,ur!=null)){var dr=ar.memoizedProps,hr=lr!==null?lr.memoizedProps:dr,pr=ar.type,mr=ar.updateQueue;if(ar.updateQueue=null,mr!==null)try{pr==="input"&&dr.type==="radio"&&dr.name!=null&&ab(ur,dr),vb(pr,hr);var fr=vb(pr,dr);for(hr=0;hr<mr.length;hr+=2){var xr=mr[hr],Er=mr[hr+1];xr==="style"?sb(ur,Er):xr==="dangerouslySetInnerHTML"?nb(ur,Er):xr==="children"?ob(ur,Er):ta(ur,xr,Er,fr)}switch(pr){case"input":bb(ur,dr);break;case"textarea":ib(ur,dr);break;case"select":var vr=ur._wrapperState.wasMultiple;ur._wrapperState.wasMultiple=!!dr.multiple;var gr=dr.value;gr!=null?fb(ur,!!dr.multiple,gr,!1):vr!==!!dr.multiple&&(dr.defaultValue!=null?fb(ur,!!dr.multiple,dr.defaultValue,!0):fb(ur,!!dr.multiple,dr.multiple?[]:"",!1))}ur[Pf]=dr}catch(br){W$1(ar,ar.return,br)}}break;case 6:if(ck(or,ar),ek(ar),cr&4){if(ar.stateNode===null)throw Error(p$1(162));ur=ar.stateNode,dr=ar.memoizedProps;try{ur.nodeValue=dr}catch(br){W$1(ar,ar.return,br)}}break;case 3:if(ck(or,ar),ek(ar),cr&4&&lr!==null&&lr.memoizedState.isDehydrated)try{bd(or.containerInfo)}catch(br){W$1(ar,ar.return,br)}break;case 4:ck(or,ar),ek(ar);break;case 13:ck(or,ar),ek(ar),ur=ar.child,ur.flags&8192&&(dr=ur.memoizedState!==null,ur.stateNode.isHidden=dr,!dr||ur.alternate!==null&&ur.alternate.memoizedState!==null||(fk=B$1())),cr&4&&ak(ar);break;case 22:if(xr=lr!==null&&lr.memoizedState!==null,ar.mode&1?(U$1=(fr=U$1)||xr,ck(or,ar),U$1=fr):ck(or,ar),ek(ar),cr&8192){if(fr=ar.memoizedState!==null,(ar.stateNode.isHidden=fr)&&!xr&&ar.mode&1)for(V$1=ar,xr=ar.child;xr!==null;){for(Er=V$1=xr;V$1!==null;){switch(vr=V$1,gr=vr.child,vr.tag){case 0:case 11:case 14:case 15:Pj(4,vr,vr.return);break;case 1:Lj(vr,vr.return);var yr=vr.stateNode;if(typeof yr.componentWillUnmount=="function"){cr=vr,lr=vr.return;try{or=cr,yr.props=or.memoizedProps,yr.state=or.memoizedState,yr.componentWillUnmount()}catch(br){W$1(cr,lr,br)}}break;case 5:Lj(vr,vr.return);break;case 22:if(vr.memoizedState!==null){gk(Er);continue}}gr!==null?(gr.return=vr,V$1=gr):gk(Er)}xr=xr.sibling}e:for(xr=null,Er=ar;;){if(Er.tag===5){if(xr===null){xr=Er;try{ur=Er.stateNode,fr?(dr=ur.style,typeof dr.setProperty=="function"?dr.setProperty("display","none","important"):dr.display="none"):(pr=Er.stateNode,mr=Er.memoizedProps.style,hr=mr!=null&&mr.hasOwnProperty("display")?mr.display:null,pr.style.display=rb("display",hr))}catch(br){W$1(ar,ar.return,br)}}}else if(Er.tag===6){if(xr===null)try{Er.stateNode.nodeValue=fr?"":Er.memoizedProps}catch(br){W$1(ar,ar.return,br)}}else if((Er.tag!==22&&Er.tag!==23||Er.memoizedState===null||Er===ar)&&Er.child!==null){Er.child.return=Er,Er=Er.child;continue}if(Er===ar)break e;for(;Er.sibling===null;){if(Er.return===null||Er.return===ar)break e;xr===Er&&(xr=null),Er=Er.return}xr===Er&&(xr=null),Er.sibling.return=Er.return,Er=Er.sibling}}break;case 19:ck(or,ar),ek(ar),cr&4&&ak(ar);break;case 21:break;default:ck(or,ar),ek(ar)}}function ek(ar){var or=ar.flags;if(or&2){try{e:{for(var lr=ar.return;lr!==null;){if(Tj(lr)){var cr=lr;break e}lr=lr.return}throw Error(p$1(160))}switch(cr.tag){case 5:var ur=cr.stateNode;cr.flags&32&&(ob(ur,""),cr.flags&=-33);var dr=Uj(ar);Wj(ar,dr,ur);break;case 3:case 4:var hr=cr.stateNode.containerInfo,pr=Uj(ar);Vj(ar,pr,hr);break;default:throw Error(p$1(161))}}catch(mr){W$1(ar,ar.return,mr)}ar.flags&=-3}or&4096&&(ar.flags&=-4097)}function hk(ar,or,lr){V$1=ar,ik(ar)}function ik(ar,or,lr){for(var cr=(ar.mode&1)!==0;V$1!==null;){var ur=V$1,dr=ur.child;if(ur.tag===22&&cr){var hr=ur.memoizedState!==null||Jj;if(!hr){var pr=ur.alternate,mr=pr!==null&&pr.memoizedState!==null||U$1;pr=Jj;var fr=U$1;if(Jj=hr,(U$1=mr)&&!fr)for(V$1=ur;V$1!==null;)hr=V$1,mr=hr.child,hr.tag===22&&hr.memoizedState!==null?jk(ur):mr!==null?(mr.return=hr,V$1=mr):jk(ur);for(;dr!==null;)V$1=dr,ik(dr),dr=dr.sibling;V$1=ur,Jj=pr,U$1=fr}kk(ar)}else ur.subtreeFlags&8772&&dr!==null?(dr.return=ur,V$1=dr):kk(ar)}}function kk(ar){for(;V$1!==null;){var or=V$1;if(or.flags&8772){var lr=or.alternate;try{if(or.flags&8772)switch(or.tag){case 0:case 11:case 15:U$1||Qj(5,or);break;case 1:var cr=or.stateNode;if(or.flags&4&&!U$1)if(lr===null)cr.componentDidMount();else{var ur=or.elementType===or.type?lr.memoizedProps:Ci(or.type,lr.memoizedProps);cr.componentDidUpdate(ur,lr.memoizedState,cr.__reactInternalSnapshotBeforeUpdate)}var dr=or.updateQueue;dr!==null&&sh(or,dr,cr);break;case 3:var hr=or.updateQueue;if(hr!==null){if(lr=null,or.child!==null)switch(or.child.tag){case 5:lr=or.child.stateNode;break;case 1:lr=or.child.stateNode}sh(or,hr,lr)}break;case 5:var pr=or.stateNode;if(lr===null&&or.flags&4){lr=pr;var mr=or.memoizedProps;switch(or.type){case"button":case"input":case"select":case"textarea":mr.autoFocus&&lr.focus();break;case"img":mr.src&&(lr.src=mr.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(or.memoizedState===null){var fr=or.alternate;if(fr!==null){var xr=fr.memoizedState;if(xr!==null){var Er=xr.dehydrated;Er!==null&&bd(Er)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U$1||or.flags&512&&Rj(or)}catch(vr){W$1(or,or.return,vr)}}if(or===ar){V$1=null;break}if(lr=or.sibling,lr!==null){lr.return=or.return,V$1=lr;break}V$1=or.return}}function gk(ar){for(;V$1!==null;){var or=V$1;if(or===ar){V$1=null;break}var lr=or.sibling;if(lr!==null){lr.return=or.return,V$1=lr;break}V$1=or.return}}function jk(ar){for(;V$1!==null;){var or=V$1;try{switch(or.tag){case 0:case 11:case 15:var lr=or.return;try{Qj(4,or)}catch(mr){W$1(or,lr,mr)}break;case 1:var cr=or.stateNode;if(typeof cr.componentDidMount=="function"){var ur=or.return;try{cr.componentDidMount()}catch(mr){W$1(or,ur,mr)}}var dr=or.return;try{Rj(or)}catch(mr){W$1(or,dr,mr)}break;case 5:var hr=or.return;try{Rj(or)}catch(mr){W$1(or,hr,mr)}}}catch(mr){W$1(or,or.return,mr)}if(or===ar){V$1=null;break}var pr=or.sibling;if(pr!==null){pr.return=or.return,V$1=pr;break}V$1=or.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok$1=ua.ReactCurrentBatchConfig,K$1=0,Q$1=null,Y$1=null,Z$1=0,fj=0,ej=Uf(0),T$1=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R$1(){return K$1&6?B$1():Ak!==-1?Ak:Ak=B$1()}function yi(ar){return ar.mode&1?K$1&2&&Z$1!==0?Z$1&-Z$1:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(ar=C$1,ar!==0||(ar=window.event,ar=ar===void 0?16:jd(ar.type)),ar):1}function gi(ar,or,lr,cr){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(ar,lr,cr),(!(K$1&2)||ar!==Q$1)&&(ar===Q$1&&(!(K$1&2)&&(qk|=lr),T$1===4&&Ck(ar,Z$1)),Dk(ar,cr),lr===1&&K$1===0&&!(or.mode&1)&&(Gj=B$1()+500,fg&&jg()))}function Dk(ar,or){var lr=ar.callbackNode;wc(ar,or);var cr=uc(ar,ar===Q$1?Z$1:0);if(cr===0)lr!==null&&bc(lr),ar.callbackNode=null,ar.callbackPriority=0;else if(or=cr&-cr,ar.callbackPriority!==or){if(lr!=null&&bc(lr),or===1)ar.tag===0?ig(Ek.bind(null,ar)):hg(Ek.bind(null,ar)),Jf(function(){!(K$1&6)&&jg()}),lr=null;else{switch(Dc(cr)){case 1:lr=fc;break;case 4:lr=gc;break;case 16:lr=hc;break;case 536870912:lr=jc;break;default:lr=hc}lr=Fk(lr,Gk.bind(null,ar))}ar.callbackPriority=or,ar.callbackNode=lr}}function Gk(ar,or){if(Ak=-1,Bk=0,K$1&6)throw Error(p$1(327));var lr=ar.callbackNode;if(Hk()&&ar.callbackNode!==lr)return null;var cr=uc(ar,ar===Q$1?Z$1:0);if(cr===0)return null;if(cr&30||cr&ar.expiredLanes||or)or=Ik(ar,cr);else{or=cr;var ur=K$1;K$1|=2;var dr=Jk();(Q$1!==ar||Z$1!==or)&&(uk=null,Gj=B$1()+500,Kk(ar,or));do try{Lk();break}catch(pr){Mk(ar,pr)}while(!0);$g(),mk.current=dr,K$1=ur,Y$1!==null?or=0:(Q$1=null,Z$1=0,or=T$1)}if(or!==0){if(or===2&&(ur=xc(ar),ur!==0&&(cr=ur,or=Nk(ar,ur))),or===1)throw lr=pk,Kk(ar,0),Ck(ar,cr),Dk(ar,B$1()),lr;if(or===6)Ck(ar,cr);else{if(ur=ar.current.alternate,!(cr&30)&&!Ok(ur)&&(or=Ik(ar,cr),or===2&&(dr=xc(ar),dr!==0&&(cr=dr,or=Nk(ar,dr))),or===1))throw lr=pk,Kk(ar,0),Ck(ar,cr),Dk(ar,B$1()),lr;switch(ar.finishedWork=ur,ar.finishedLanes=cr,or){case 0:case 1:throw Error(p$1(345));case 2:Pk(ar,tk,uk);break;case 3:if(Ck(ar,cr),(cr&130023424)===cr&&(or=fk+500-B$1(),10<or)){if(uc(ar,0)!==0)break;if(ur=ar.suspendedLanes,(ur&cr)!==cr){R$1(),ar.pingedLanes|=ar.suspendedLanes&ur;break}ar.timeoutHandle=Ff(Pk.bind(null,ar,tk,uk),or);break}Pk(ar,tk,uk);break;case 4:if(Ck(ar,cr),(cr&4194240)===cr)break;for(or=ar.eventTimes,ur=-1;0<cr;){var hr=31-oc(cr);dr=1<<hr,hr=or[hr],hr>ur&&(ur=hr),cr&=~dr}if(cr=ur,cr=B$1()-cr,cr=(120>cr?120:480>cr?480:1080>cr?1080:1920>cr?1920:3e3>cr?3e3:4320>cr?4320:1960*lk(cr/1960))-cr,10<cr){ar.timeoutHandle=Ff(Pk.bind(null,ar,tk,uk),cr);break}Pk(ar,tk,uk);break;case 5:Pk(ar,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(ar,B$1()),ar.callbackNode===lr?Gk.bind(null,ar):null}function Nk(ar,or){var lr=sk;return ar.current.memoizedState.isDehydrated&&(Kk(ar,or).flags|=256),ar=Ik(ar,or),ar!==2&&(or=tk,tk=lr,or!==null&&Fj(or)),ar}function Fj(ar){tk===null?tk=ar:tk.push.apply(tk,ar)}function Ok(ar){for(var or=ar;;){if(or.flags&16384){var lr=or.updateQueue;if(lr!==null&&(lr=lr.stores,lr!==null))for(var cr=0;cr<lr.length;cr++){var ur=lr[cr],dr=ur.getSnapshot;ur=ur.value;try{if(!He$1(dr(),ur))return!1}catch{return!1}}}if(lr=or.child,or.subtreeFlags&16384&&lr!==null)lr.return=or,or=lr;else{if(or===ar)break;for(;or.sibling===null;){if(or.return===null||or.return===ar)return!0;or=or.return}or.sibling.return=or.return,or=or.sibling}}return!0}function Ck(ar,or){for(or&=~rk,or&=~qk,ar.suspendedLanes|=or,ar.pingedLanes&=~or,ar=ar.expirationTimes;0<or;){var lr=31-oc(or),cr=1<<lr;ar[lr]=-1,or&=~cr}}function Ek(ar){if(K$1&6)throw Error(p$1(327));Hk();var or=uc(ar,0);if(!(or&1))return Dk(ar,B$1()),null;var lr=Ik(ar,or);if(ar.tag!==0&&lr===2){var cr=xc(ar);cr!==0&&(or=cr,lr=Nk(ar,cr))}if(lr===1)throw lr=pk,Kk(ar,0),Ck(ar,or),Dk(ar,B$1()),lr;if(lr===6)throw Error(p$1(345));return ar.finishedWork=ar.current.alternate,ar.finishedLanes=or,Pk(ar,tk,uk),Dk(ar,B$1()),null}function Qk(ar,or){var lr=K$1;K$1|=1;try{return ar(or)}finally{K$1=lr,K$1===0&&(Gj=B$1()+500,fg&&jg())}}function Rk(ar){wk!==null&&wk.tag===0&&!(K$1&6)&&Hk();var or=K$1;K$1|=1;var lr=ok$1.transition,cr=C$1;try{if(ok$1.transition=null,C$1=1,ar)return ar()}finally{C$1=cr,ok$1.transition=lr,K$1=or,!(K$1&6)&&jg()}}function Hj(){fj=ej.current,E$1(ej)}function Kk(ar,or){ar.finishedWork=null,ar.finishedLanes=0;var lr=ar.timeoutHandle;if(lr!==-1&&(ar.timeoutHandle=-1,Gf(lr)),Y$1!==null)for(lr=Y$1.return;lr!==null;){var cr=lr;switch(wg(cr),cr.tag){case 1:cr=cr.type.childContextTypes,cr!=null&&$f();break;case 3:zh(),E$1(Wf),E$1(H$1),Eh();break;case 5:Bh(cr);break;case 4:zh();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah(cr.type._context);break;case 22:case 23:Hj()}lr=lr.return}if(Q$1=ar,Y$1=ar=Pg(ar.current,null),Z$1=fj=or,T$1=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(or=0;or<fh.length;or++)if(lr=fh[or],cr=lr.interleaved,cr!==null){lr.interleaved=null;var ur=cr.next,dr=lr.pending;if(dr!==null){var hr=dr.next;dr.next=ur,cr.next=hr}lr.pending=cr}fh=null}return ar}function Mk(ar,or){do{var lr=Y$1;try{if($g(),Fh.current=Rh,Ih){for(var cr=M$1.memoizedState;cr!==null;){var ur=cr.queue;ur!==null&&(ur.pending=null),cr=cr.next}Ih=!1}if(Hh=0,O$1=N$1=M$1=null,Jh=!1,Kh=0,nk.current=null,lr===null||lr.return===null){T$1=1,pk=or,Y$1=null;break}e:{var dr=ar,hr=lr.return,pr=lr,mr=or;if(or=Z$1,pr.flags|=32768,mr!==null&&typeof mr=="object"&&typeof mr.then=="function"){var fr=mr,xr=pr,Er=xr.tag;if(!(xr.mode&1)&&(Er===0||Er===11||Er===15)){var vr=xr.alternate;vr?(xr.updateQueue=vr.updateQueue,xr.memoizedState=vr.memoizedState,xr.lanes=vr.lanes):(xr.updateQueue=null,xr.memoizedState=null)}var gr=Ui(hr);if(gr!==null){gr.flags&=-257,Vi(gr,hr,pr,dr,or),gr.mode&1&&Si(dr,fr,or),or=gr,mr=fr;var yr=or.updateQueue;if(yr===null){var br=new Set;br.add(mr),or.updateQueue=br}else yr.add(mr);break e}else{if(!(or&1)){Si(dr,fr,or),tj();break e}mr=Error(p$1(426))}}else if(I$1&&pr.mode&1){var _r=Ui(hr);if(_r!==null){!(_r.flags&65536)&&(_r.flags|=256),Vi(_r,hr,pr,dr,or),Jg(Ji(mr,pr));break e}}dr=mr=Ji(mr,pr),T$1!==4&&(T$1=2),sk===null?sk=[dr]:sk.push(dr),dr=hr;do{switch(dr.tag){case 3:dr.flags|=65536,or&=-or,dr.lanes|=or;var jr=Ni(dr,mr,or);ph(dr,jr);break e;case 1:pr=mr;var wr=dr.type,Sr=dr.stateNode;if(!(dr.flags&128)&&(typeof wr.getDerivedStateFromError=="function"||Sr!==null&&typeof Sr.componentDidCatch=="function"&&(Ri===null||!Ri.has(Sr)))){dr.flags|=65536,or&=-or,dr.lanes|=or;var Tr=Qi(dr,pr,or);ph(dr,Tr);break e}}dr=dr.return}while(dr!==null)}Sk(lr)}catch(Rr){or=Rr,Y$1===lr&&lr!==null&&(Y$1=lr=lr.return);continue}break}while(!0)}function Jk(){var ar=mk.current;return mk.current=Rh,ar===null?Rh:ar}function tj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),Q$1===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q$1,Z$1)}function Ik(ar,or){var lr=K$1;K$1|=2;var cr=Jk();(Q$1!==ar||Z$1!==or)&&(uk=null,Kk(ar,or));do try{Tk();break}catch(ur){Mk(ar,ur)}while(!0);if($g(),K$1=lr,mk.current=cr,Y$1!==null)throw Error(p$1(261));return Q$1=null,Z$1=0,T$1}function Tk(){for(;Y$1!==null;)Uk(Y$1)}function Lk(){for(;Y$1!==null&&!cc();)Uk(Y$1)}function Uk(ar){var or=Vk(ar.alternate,ar,fj);ar.memoizedProps=ar.pendingProps,or===null?Sk(ar):Y$1=or,nk.current=null}function Sk(ar){var or=ar;do{var lr=or.alternate;if(ar=or.return,or.flags&32768){if(lr=Ij(lr,or),lr!==null){lr.flags&=32767,Y$1=lr;return}if(ar!==null)ar.flags|=32768,ar.subtreeFlags=0,ar.deletions=null;else{T$1=6,Y$1=null;return}}else if(lr=Ej(lr,or,fj),lr!==null){Y$1=lr;return}if(or=or.sibling,or!==null){Y$1=or;return}Y$1=or=ar}while(or!==null);T$1===0&&(T$1=5)}function Pk(ar,or,lr){var cr=C$1,ur=ok$1.transition;try{ok$1.transition=null,C$1=1,Wk(ar,or,lr,cr)}finally{ok$1.transition=ur,C$1=cr}return null}function Wk(ar,or,lr,cr){do Hk();while(wk!==null);if(K$1&6)throw Error(p$1(327));lr=ar.finishedWork;var ur=ar.finishedLanes;if(lr===null)return null;if(ar.finishedWork=null,ar.finishedLanes=0,lr===ar.current)throw Error(p$1(177));ar.callbackNode=null,ar.callbackPriority=0;var dr=lr.lanes|lr.childLanes;if(Bc(ar,dr),ar===Q$1&&(Y$1=Q$1=null,Z$1=0),!(lr.subtreeFlags&2064)&&!(lr.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),dr=(lr.flags&15990)!==0,lr.subtreeFlags&15990||dr){dr=ok$1.transition,ok$1.transition=null;var hr=C$1;C$1=1;var pr=K$1;K$1|=4,nk.current=null,Oj(ar,lr),dk(lr,ar),Oe$1(Df),dd=!!Cf,Df=Cf=null,ar.current=lr,hk(lr),dc(),K$1=pr,C$1=hr,ok$1.transition=dr}else ar.current=lr;if(vk&&(vk=!1,wk=ar,xk=ur),dr=ar.pendingLanes,dr===0&&(Ri=null),mc(lr.stateNode),Dk(ar,B$1()),or!==null)for(cr=ar.onRecoverableError,lr=0;lr<or.length;lr++)ur=or[lr],cr(ur.value,{componentStack:ur.stack,digest:ur.digest});if(Oi)throw Oi=!1,ar=Pi,Pi=null,ar;return xk&1&&ar.tag!==0&&Hk(),dr=ar.pendingLanes,dr&1?ar===zk?yk++:(yk=0,zk=ar):yk=0,jg(),null}function Hk(){if(wk!==null){var ar=Dc(xk),or=ok$1.transition,lr=C$1;try{if(ok$1.transition=null,C$1=16>ar?16:ar,wk===null)var cr=!1;else{if(ar=wk,wk=null,xk=0,K$1&6)throw Error(p$1(331));var ur=K$1;for(K$1|=4,V$1=ar.current;V$1!==null;){var dr=V$1,hr=dr.child;if(V$1.flags&16){var pr=dr.deletions;if(pr!==null){for(var mr=0;mr<pr.length;mr++){var fr=pr[mr];for(V$1=fr;V$1!==null;){var xr=V$1;switch(xr.tag){case 0:case 11:case 15:Pj(8,xr,dr)}var Er=xr.child;if(Er!==null)Er.return=xr,V$1=Er;else for(;V$1!==null;){xr=V$1;var vr=xr.sibling,gr=xr.return;if(Sj(xr),xr===fr){V$1=null;break}if(vr!==null){vr.return=gr,V$1=vr;break}V$1=gr}}}var yr=dr.alternate;if(yr!==null){var br=yr.child;if(br!==null){yr.child=null;do{var _r=br.sibling;br.sibling=null,br=_r}while(br!==null)}}V$1=dr}}if(dr.subtreeFlags&2064&&hr!==null)hr.return=dr,V$1=hr;else e:for(;V$1!==null;){if(dr=V$1,dr.flags&2048)switch(dr.tag){case 0:case 11:case 15:Pj(9,dr,dr.return)}var jr=dr.sibling;if(jr!==null){jr.return=dr.return,V$1=jr;break e}V$1=dr.return}}var wr=ar.current;for(V$1=wr;V$1!==null;){hr=V$1;var Sr=hr.child;if(hr.subtreeFlags&2064&&Sr!==null)Sr.return=hr,V$1=Sr;else e:for(hr=wr;V$1!==null;){if(pr=V$1,pr.flags&2048)try{switch(pr.tag){case 0:case 11:case 15:Qj(9,pr)}}catch(Rr){W$1(pr,pr.return,Rr)}if(pr===hr){V$1=null;break e}var Tr=pr.sibling;if(Tr!==null){Tr.return=pr.return,V$1=Tr;break e}V$1=pr.return}}if(K$1=ur,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,ar)}catch{}cr=!0}return cr}finally{C$1=lr,ok$1.transition=or}}return!1}function Xk(ar,or,lr){or=Ji(lr,or),or=Ni(ar,or,1),ar=nh(ar,or,1),or=R$1(),ar!==null&&(Ac(ar,1,or),Dk(ar,or))}function W$1(ar,or,lr){if(ar.tag===3)Xk(ar,ar,lr);else for(;or!==null;){if(or.tag===3){Xk(or,ar,lr);break}else if(or.tag===1){var cr=or.stateNode;if(typeof or.type.getDerivedStateFromError=="function"||typeof cr.componentDidCatch=="function"&&(Ri===null||!Ri.has(cr))){ar=Ji(lr,ar),ar=Qi(or,ar,1),or=nh(or,ar,1),ar=R$1(),or!==null&&(Ac(or,1,ar),Dk(or,ar));break}}or=or.return}}function Ti(ar,or,lr){var cr=ar.pingCache;cr!==null&&cr.delete(or),or=R$1(),ar.pingedLanes|=ar.suspendedLanes&lr,Q$1===ar&&(Z$1&lr)===lr&&(T$1===4||T$1===3&&(Z$1&130023424)===Z$1&&500>B$1()-fk?Kk(ar,0):rk|=lr),Dk(ar,or)}function Yk(ar,or){or===0&&(ar.mode&1?(or=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):or=1);var lr=R$1();ar=ih(ar,or),ar!==null&&(Ac(ar,or,lr),Dk(ar,lr))}function uj(ar){var or=ar.memoizedState,lr=0;or!==null&&(lr=or.retryLane),Yk(ar,lr)}function bk(ar,or){var lr=0;switch(ar.tag){case 13:var cr=ar.stateNode,ur=ar.memoizedState;ur!==null&&(lr=ur.retryLane);break;case 19:cr=ar.stateNode;break;default:throw Error(p$1(314))}cr!==null&&cr.delete(or),Yk(ar,lr)}var Vk;Vk=function(ar,or,lr){if(ar!==null)if(ar.memoizedProps!==or.pendingProps||Wf.current)dh=!0;else{if(!(ar.lanes&lr)&&!(or.flags&128))return dh=!1,yj(ar,or,lr);dh=!!(ar.flags&131072)}else dh=!1,I$1&&or.flags&1048576&&ug(or,ng,or.index);switch(or.lanes=0,or.tag){case 2:var cr=or.type;ij(ar,or),ar=or.pendingProps;var ur=Yf(or,H$1.current);ch(or,lr),ur=Nh(null,or,cr,ar,ur,lr);var dr=Sh();return or.flags|=1,typeof ur=="object"&&ur!==null&&typeof ur.render=="function"&&ur.$$typeof===void 0?(or.tag=1,or.memoizedState=null,or.updateQueue=null,Zf(cr)?(dr=!0,cg(or)):dr=!1,or.memoizedState=ur.state!==null&&ur.state!==void 0?ur.state:null,kh(or),ur.updater=Ei,or.stateNode=ur,ur._reactInternals=or,Ii(or,cr,ar,lr),or=jj(null,or,cr,!0,dr,lr)):(or.tag=0,I$1&&dr&&vg(or),Xi(null,or,ur,lr),or=or.child),or;case 16:cr=or.elementType;e:{switch(ij(ar,or),ar=or.pendingProps,ur=cr._init,cr=ur(cr._payload),or.type=cr,ur=or.tag=Zk(cr),ar=Ci(cr,ar),ur){case 0:or=cj(null,or,cr,ar,lr);break e;case 1:or=hj(null,or,cr,ar,lr);break e;case 11:or=Yi(null,or,cr,ar,lr);break e;case 14:or=$i(null,or,cr,Ci(cr.type,ar),lr);break e}throw Error(p$1(306,cr,""))}return or;case 0:return cr=or.type,ur=or.pendingProps,ur=or.elementType===cr?ur:Ci(cr,ur),cj(ar,or,cr,ur,lr);case 1:return cr=or.type,ur=or.pendingProps,ur=or.elementType===cr?ur:Ci(cr,ur),hj(ar,or,cr,ur,lr);case 3:e:{if(kj(or),ar===null)throw Error(p$1(387));cr=or.pendingProps,dr=or.memoizedState,ur=dr.element,lh(ar,or),qh(or,cr,null,lr);var hr=or.memoizedState;if(cr=hr.element,dr.isDehydrated)if(dr={element:cr,isDehydrated:!1,cache:hr.cache,pendingSuspenseBoundaries:hr.pendingSuspenseBoundaries,transitions:hr.transitions},or.updateQueue.baseState=dr,or.memoizedState=dr,or.flags&256){ur=Ji(Error(p$1(423)),or),or=lj(ar,or,cr,lr,ur);break e}else if(cr!==ur){ur=Ji(Error(p$1(424)),or),or=lj(ar,or,cr,lr,ur);break e}else for(yg=Lf(or.stateNode.containerInfo.firstChild),xg=or,I$1=!0,zg=null,lr=Vg(or,null,cr,lr),or.child=lr;lr;)lr.flags=lr.flags&-3|4096,lr=lr.sibling;else{if(Ig(),cr===ur){or=Zi(ar,or,lr);break e}Xi(ar,or,cr,lr)}or=or.child}return or;case 5:return Ah(or),ar===null&&Eg(or),cr=or.type,ur=or.pendingProps,dr=ar!==null?ar.memoizedProps:null,hr=ur.children,Ef(cr,ur)?hr=null:dr!==null&&Ef(cr,dr)&&(or.flags|=32),gj(ar,or),Xi(ar,or,hr,lr),or.child;case 6:return ar===null&&Eg(or),null;case 13:return oj(ar,or,lr);case 4:return yh(or,or.stateNode.containerInfo),cr=or.pendingProps,ar===null?or.child=Ug(or,null,cr,lr):Xi(ar,or,cr,lr),or.child;case 11:return cr=or.type,ur=or.pendingProps,ur=or.elementType===cr?ur:Ci(cr,ur),Yi(ar,or,cr,ur,lr);case 7:return Xi(ar,or,or.pendingProps,lr),or.child;case 8:return Xi(ar,or,or.pendingProps.children,lr),or.child;case 12:return Xi(ar,or,or.pendingProps.children,lr),or.child;case 10:e:{if(cr=or.type._context,ur=or.pendingProps,dr=or.memoizedProps,hr=ur.value,G$1(Wg,cr._currentValue),cr._currentValue=hr,dr!==null)if(He$1(dr.value,hr)){if(dr.children===ur.children&&!Wf.current){or=Zi(ar,or,lr);break e}}else for(dr=or.child,dr!==null&&(dr.return=or);dr!==null;){var pr=dr.dependencies;if(pr!==null){hr=dr.child;for(var mr=pr.firstContext;mr!==null;){if(mr.context===cr){if(dr.tag===1){mr=mh(-1,lr&-lr),mr.tag=2;var fr=dr.updateQueue;if(fr!==null){fr=fr.shared;var xr=fr.pending;xr===null?mr.next=mr:(mr.next=xr.next,xr.next=mr),fr.pending=mr}}dr.lanes|=lr,mr=dr.alternate,mr!==null&&(mr.lanes|=lr),bh(dr.return,lr,or),pr.lanes|=lr;break}mr=mr.next}}else if(dr.tag===10)hr=dr.type===or.type?null:dr.child;else if(dr.tag===18){if(hr=dr.return,hr===null)throw Error(p$1(341));hr.lanes|=lr,pr=hr.alternate,pr!==null&&(pr.lanes|=lr),bh(hr,lr,or),hr=dr.sibling}else hr=dr.child;if(hr!==null)hr.return=dr;else for(hr=dr;hr!==null;){if(hr===or){hr=null;break}if(dr=hr.sibling,dr!==null){dr.return=hr.return,hr=dr;break}hr=hr.return}dr=hr}Xi(ar,or,ur.children,lr),or=or.child}return or;case 9:return ur=or.type,cr=or.pendingProps.children,ch(or,lr),ur=eh(ur),cr=cr(ur),or.flags|=1,Xi(ar,or,cr,lr),or.child;case 14:return cr=or.type,ur=Ci(cr,or.pendingProps),ur=Ci(cr.type,ur),$i(ar,or,cr,ur,lr);case 15:return bj(ar,or,or.type,or.pendingProps,lr);case 17:return cr=or.type,ur=or.pendingProps,ur=or.elementType===cr?ur:Ci(cr,ur),ij(ar,or),or.tag=1,Zf(cr)?(ar=!0,cg(or)):ar=!1,ch(or,lr),Gi(or,cr,ur),Ii(or,cr,ur,lr),jj(null,or,cr,!0,ar,lr);case 19:return xj(ar,or,lr);case 22:return dj(ar,or,lr)}throw Error(p$1(156,or.tag))};function Fk(ar,or){return ac(ar,or)}function $k(ar,or,lr,cr){this.tag=ar,this.key=lr,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=or,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=cr,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(ar,or,lr,cr){return new $k(ar,or,lr,cr)}function aj(ar){return ar=ar.prototype,!(!ar||!ar.isReactComponent)}function Zk(ar){if(typeof ar=="function")return aj(ar)?1:0;if(ar!=null){if(ar=ar.$$typeof,ar===Da)return 11;if(ar===Ga)return 14}return 2}function Pg(ar,or){var lr=ar.alternate;return lr===null?(lr=Bg(ar.tag,or,ar.key,ar.mode),lr.elementType=ar.elementType,lr.type=ar.type,lr.stateNode=ar.stateNode,lr.alternate=ar,ar.alternate=lr):(lr.pendingProps=or,lr.type=ar.type,lr.flags=0,lr.subtreeFlags=0,lr.deletions=null),lr.flags=ar.flags&14680064,lr.childLanes=ar.childLanes,lr.lanes=ar.lanes,lr.child=ar.child,lr.memoizedProps=ar.memoizedProps,lr.memoizedState=ar.memoizedState,lr.updateQueue=ar.updateQueue,or=ar.dependencies,lr.dependencies=or===null?null:{lanes:or.lanes,firstContext:or.firstContext},lr.sibling=ar.sibling,lr.index=ar.index,lr.ref=ar.ref,lr}function Rg(ar,or,lr,cr,ur,dr){var hr=2;if(cr=ar,typeof ar=="function")aj(ar)&&(hr=1);else if(typeof ar=="string")hr=5;else e:switch(ar){case ya:return Tg(lr.children,ur,dr,or);case za:hr=8,ur|=8;break;case Aa:return ar=Bg(12,lr,or,ur|2),ar.elementType=Aa,ar.lanes=dr,ar;case Ea:return ar=Bg(13,lr,or,ur),ar.elementType=Ea,ar.lanes=dr,ar;case Fa:return ar=Bg(19,lr,or,ur),ar.elementType=Fa,ar.lanes=dr,ar;case Ia:return pj(lr,ur,dr,or);default:if(typeof ar=="object"&&ar!==null)switch(ar.$$typeof){case Ba:hr=10;break e;case Ca:hr=9;break e;case Da:hr=11;break e;case Ga:hr=14;break e;case Ha:hr=16,cr=null;break e}throw Error(p$1(130,ar==null?ar:typeof ar,""))}return or=Bg(hr,lr,or,ur),or.elementType=ar,or.type=cr,or.lanes=dr,or}function Tg(ar,or,lr,cr){return ar=Bg(7,ar,cr,or),ar.lanes=lr,ar}function pj(ar,or,lr,cr){return ar=Bg(22,ar,cr,or),ar.elementType=Ia,ar.lanes=lr,ar.stateNode={isHidden:!1},ar}function Qg(ar,or,lr){return ar=Bg(6,ar,null,or),ar.lanes=lr,ar}function Sg(ar,or,lr){return or=Bg(4,ar.children!==null?ar.children:[],ar.key,or),or.lanes=lr,or.stateNode={containerInfo:ar.containerInfo,pendingChildren:null,implementation:ar.implementation},or}function al(ar,or,lr,cr,ur){this.tag=or,this.containerInfo=ar,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=cr,this.onRecoverableError=ur,this.mutableSourceEagerHydrationData=null}function bl(ar,or,lr,cr,ur,dr,hr,pr,mr){return ar=new al(ar,or,lr,pr,mr),or===1?(or=1,dr===!0&&(or|=8)):or=0,dr=Bg(3,null,null,or),ar.current=dr,dr.stateNode=ar,dr.memoizedState={element:cr,isDehydrated:lr,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(dr),ar}function cl(ar,or,lr){var cr=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:cr==null?null:""+cr,children:ar,containerInfo:or,implementation:lr}}function dl(ar){if(!ar)return Vf;ar=ar._reactInternals;e:{if(Vb(ar)!==ar||ar.tag!==1)throw Error(p$1(170));var or=ar;do{switch(or.tag){case 3:or=or.stateNode.context;break e;case 1:if(Zf(or.type)){or=or.stateNode.__reactInternalMemoizedMergedChildContext;break e}}or=or.return}while(or!==null);throw Error(p$1(171))}if(ar.tag===1){var lr=ar.type;if(Zf(lr))return bg(ar,lr,or)}return or}function el(ar,or,lr,cr,ur,dr,hr,pr,mr){return ar=bl(lr,cr,!0,ar,ur,dr,hr,pr,mr),ar.context=dl(null),lr=ar.current,cr=R$1(),ur=yi(lr),dr=mh(cr,ur),dr.callback=or??null,nh(lr,dr,ur),ar.current.lanes=ur,Ac(ar,ur,cr),Dk(ar,cr),ar}function fl(ar,or,lr,cr){var ur=or.current,dr=R$1(),hr=yi(ur);return lr=dl(lr),or.context===null?or.context=lr:or.pendingContext=lr,or=mh(dr,hr),or.payload={element:ar},cr=cr===void 0?null:cr,cr!==null&&(or.callback=cr),ar=nh(ur,or,hr),ar!==null&&(gi(ar,ur,hr,dr),oh(ar,ur,hr)),hr}function gl(ar){if(ar=ar.current,!ar.child)return null;switch(ar.child.tag){case 5:return ar.child.stateNode;default:return ar.child.stateNode}}function hl(ar,or){if(ar=ar.memoizedState,ar!==null&&ar.dehydrated!==null){var lr=ar.retryLane;ar.retryLane=lr!==0&&lr<or?lr:or}}function il(ar,or){hl(ar,or),(ar=ar.alternate)&&hl(ar,or)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(ar){console.error(ar)};function ll(ar){this._internalRoot=ar}ml.prototype.render=ll.prototype.render=function(ar){var or=this._internalRoot;if(or===null)throw Error(p$1(409));fl(ar,or,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var ar=this._internalRoot;if(ar!==null){this._internalRoot=null;var or=ar.containerInfo;Rk(function(){fl(null,ar,null,null)}),or[uf]=null}};function ml(ar){this._internalRoot=ar}ml.prototype.unstable_scheduleHydration=function(ar){if(ar){var or=Hc();ar={blockedOn:null,target:ar,priority:or};for(var lr=0;lr<Qc.length&&or!==0&&or<Qc[lr].priority;lr++);Qc.splice(lr,0,ar),lr===0&&Vc(ar)}};function nl(ar){return!(!ar||ar.nodeType!==1&&ar.nodeType!==9&&ar.nodeType!==11)}function ol(ar){return!(!ar||ar.nodeType!==1&&ar.nodeType!==9&&ar.nodeType!==11&&(ar.nodeType!==8||ar.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(ar,or,lr,cr,ur){if(ur){if(typeof cr=="function"){var dr=cr;cr=function(){var fr=gl(hr);dr.call(fr)}}var hr=el(or,cr,ar,0,null,!1,!1,"",pl);return ar._reactRootContainer=hr,ar[uf]=hr.current,sf(ar.nodeType===8?ar.parentNode:ar),Rk(),hr}for(;ur=ar.lastChild;)ar.removeChild(ur);if(typeof cr=="function"){var pr=cr;cr=function(){var fr=gl(mr);pr.call(fr)}}var mr=bl(ar,0,!1,null,null,!1,!1,"",pl);return ar._reactRootContainer=mr,ar[uf]=mr.current,sf(ar.nodeType===8?ar.parentNode:ar),Rk(function(){fl(or,mr,lr,cr)}),mr}function rl(ar,or,lr,cr,ur){var dr=lr._reactRootContainer;if(dr){var hr=dr;if(typeof ur=="function"){var pr=ur;ur=function(){var mr=gl(hr);pr.call(mr)}}fl(or,hr,ar,ur)}else hr=ql(lr,or,ar,ur,cr);return gl(hr)}Ec=function(ar){switch(ar.tag){case 3:var or=ar.stateNode;if(or.current.memoizedState.isDehydrated){var lr=tc(or.pendingLanes);lr!==0&&(Cc(or,lr|1),Dk(or,B$1()),!(K$1&6)&&(Gj=B$1()+500,jg()))}break;case 13:Rk(function(){var cr=ih(ar,1);if(cr!==null){var ur=R$1();gi(cr,ar,1,ur)}}),il(ar,1)}};Fc=function(ar){if(ar.tag===13){var or=ih(ar,134217728);if(or!==null){var lr=R$1();gi(or,ar,134217728,lr)}il(ar,134217728)}};Gc=function(ar){if(ar.tag===13){var or=yi(ar),lr=ih(ar,or);if(lr!==null){var cr=R$1();gi(lr,ar,or,cr)}il(ar,or)}};Hc=function(){return C$1};Ic=function(ar,or){var lr=C$1;try{return C$1=ar,or()}finally{C$1=lr}};yb=function(ar,or,lr){switch(or){case"input":if(bb(ar,lr),or=lr.name,lr.type==="radio"&&or!=null){for(lr=ar;lr.parentNode;)lr=lr.parentNode;for(lr=lr.querySelectorAll("input[name="+JSON.stringify(""+or)+'][type="radio"]'),or=0;or<lr.length;or++){var cr=lr[or];if(cr!==ar&&cr.form===ar.form){var ur=Db(cr);if(!ur)throw Error(p$1(90));Wa(cr),bb(cr,ur)}}}break;case"textarea":ib(ar,lr);break;case"select":or=lr.value,or!=null&&fb(ar,!!lr.multiple,or,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(ar){return ar=Zb(ar),ar===null?null:ar.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(ar,or){var lr=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(or))throw Error(p$1(200));return cl(ar,or,null,lr)};reactDom_production_min.createRoot=function(ar,or){if(!nl(ar))throw Error(p$1(299));var lr=!1,cr="",ur=kl;return or!=null&&(or.unstable_strictMode===!0&&(lr=!0),or.identifierPrefix!==void 0&&(cr=or.identifierPrefix),or.onRecoverableError!==void 0&&(ur=or.onRecoverableError)),or=bl(ar,1,!1,null,null,lr,!1,cr,ur),ar[uf]=or.current,sf(ar.nodeType===8?ar.parentNode:ar),new ll(or)};reactDom_production_min.findDOMNode=function(ar){if(ar==null)return null;if(ar.nodeType===1)return ar;var or=ar._reactInternals;if(or===void 0)throw typeof ar.render=="function"?Error(p$1(188)):(ar=Object.keys(ar).join(","),Error(p$1(268,ar)));return ar=Zb(or),ar=ar===null?null:ar.stateNode,ar};reactDom_production_min.flushSync=function(ar){return Rk(ar)};reactDom_production_min.hydrate=function(ar,or,lr){if(!ol(or))throw Error(p$1(200));return rl(null,ar,or,!0,lr)};reactDom_production_min.hydrateRoot=function(ar,or,lr){if(!nl(ar))throw Error(p$1(405));var cr=lr!=null&&lr.hydratedSources||null,ur=!1,dr="",hr=kl;if(lr!=null&&(lr.unstable_strictMode===!0&&(ur=!0),lr.identifierPrefix!==void 0&&(dr=lr.identifierPrefix),lr.onRecoverableError!==void 0&&(hr=lr.onRecoverableError)),or=el(or,null,ar,1,lr??null,ur,!1,dr,hr),ar[uf]=or.current,sf(ar),cr)for(ar=0;ar<cr.length;ar++)lr=cr[ar],ur=lr._getVersion,ur=ur(lr._source),or.mutableSourceEagerHydrationData==null?or.mutableSourceEagerHydrationData=[lr,ur]:or.mutableSourceEagerHydrationData.push(lr,ur);return new ml(or)};reactDom_production_min.render=function(ar,or,lr){if(!ol(or))throw Error(p$1(200));return rl(null,ar,or,!1,lr)};reactDom_production_min.unmountComponentAtNode=function(ar){if(!ol(ar))throw Error(p$1(40));return ar._reactRootContainer?(Rk(function(){rl(null,null,ar,!1,function(){ar._reactRootContainer=null,ar[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(ar,or,lr,cr){if(!ol(lr))throw Error(p$1(200));if(ar==null||ar._reactInternals===void 0)throw Error(p$1(38));return rl(ar,or,lr,!1,cr)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(ar){console.error(ar)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m$1=reactDomExports;client.createRoot=m$1.createRoot,client.hydrateRoot=m$1.hydrateRoot;const __vite_import_meta_env__$2={},createStoreImpl=ar=>{let or;const lr=new Set,cr=(xr,Er)=>{const vr=typeof xr=="function"?xr(or):xr;if(!Object.is(vr,or)){const gr=or;or=Er??(typeof vr!="object"||vr===null)?vr:Object.assign({},or,vr),lr.forEach(yr=>yr(or,gr))}},ur=()=>or,mr={setState:cr,getState:ur,getInitialState:()=>fr,subscribe:xr=>(lr.add(xr),()=>lr.delete(xr)),destroy:()=>{(__vite_import_meta_env__$2?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),lr.clear()}},fr=or=ar(cr,ur,mr);return mr},createStore=ar=>ar?createStoreImpl(ar):createStoreImpl;var withSelector={exports:{}},withSelector_production={},shim$2={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React$1=reactExports;function is$1(ar,or){return ar===or&&(ar!==0||1/ar===1/or)||ar!==ar&&or!==or}var objectIs$1=typeof Object.is=="function"?Object.is:is$1,useState=React$1.useState,useEffect$1=React$1.useEffect,useLayoutEffect=React$1.useLayoutEffect,useDebugValue$2=React$1.useDebugValue;function useSyncExternalStore$2(ar,or){var lr=or(),cr=useState({inst:{value:lr,getSnapshot:or}}),ur=cr[0].inst,dr=cr[1];return useLayoutEffect(function(){ur.value=lr,ur.getSnapshot=or,checkIfSnapshotChanged(ur)&&dr({inst:ur})},[ar,lr,or]),useEffect$1(function(){return checkIfSnapshotChanged(ur)&&dr({inst:ur}),ar(function(){checkIfSnapshotChanged(ur)&&dr({inst:ur})})},[ar]),useDebugValue$2(lr),lr}function checkIfSnapshotChanged(ar){var or=ar.getSnapshot;ar=ar.value;try{var lr=or();return!objectIs$1(ar,lr)}catch{return!0}}function useSyncExternalStore$1(ar,or){return or()}var shim$1=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?useSyncExternalStore$1:useSyncExternalStore$2;useSyncExternalStoreShim_production.useSyncExternalStore=React$1.useSyncExternalStore!==void 0?React$1.useSyncExternalStore:shim$1;shim$2.exports=useSyncExternalStoreShim_production;var shimExports=shim$2.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var React=reactExports,shim=shimExports;function is(ar,or){return ar===or&&(ar!==0||1/ar===1/or)||ar!==ar&&or!==or}var objectIs=typeof Object.is=="function"?Object.is:is,useSyncExternalStore=shim.useSyncExternalStore,useRef=React.useRef,useEffect=React.useEffect,useMemo=React.useMemo,useDebugValue$1=React.useDebugValue;withSelector_production.useSyncExternalStoreWithSelector=function(ar,or,lr,cr,ur){var dr=useRef(null);if(dr.current===null){var hr={hasValue:!1,value:null};dr.current=hr}else hr=dr.current;dr=useMemo(function(){function mr(gr){if(!fr){if(fr=!0,xr=gr,gr=cr(gr),ur!==void 0&&hr.hasValue){var yr=hr.value;if(ur(yr,gr))return Er=yr}return Er=gr}if(yr=Er,objectIs(xr,gr))return yr;var br=cr(gr);return ur!==void 0&&ur(yr,br)?(xr=gr,yr):(xr=gr,Er=br)}var fr=!1,xr,Er,vr=lr===void 0?null:lr;return[function(){return mr(or())},vr===null?void 0:function(){return mr(vr())}]},[or,lr,cr,ur]);var pr=useSyncExternalStore(ar,dr[0],dr[1]);return useEffect(function(){hr.hasValue=!0,hr.value=pr},[pr]),useDebugValue$1(pr),pr};withSelector.exports=withSelector_production;var withSelectorExports=withSelector.exports;const useSyncExternalStoreExports=getDefaultExportFromCjs(withSelectorExports),__vite_import_meta_env__$1={},{useDebugValue}=React$2,{useSyncExternalStoreWithSelector}=useSyncExternalStoreExports;let didWarnAboutEqualityFn=!1;const identity=ar=>ar;function useStore(ar,or=identity,lr){(__vite_import_meta_env__$1?"production":void 0)!=="production"&&lr&&!didWarnAboutEqualityFn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),didWarnAboutEqualityFn=!0);const cr=useSyncExternalStoreWithSelector(ar.subscribe,ar.getState,ar.getServerState||ar.getInitialState,or,lr);return useDebugValue(cr),cr}const createImpl=ar=>{(__vite_import_meta_env__$1?"production":void 0)!=="production"&&typeof ar!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const or=typeof ar=="function"?createStore(ar):ar,lr=(cr,ur)=>useStore(or,cr,ur);return Object.assign(lr,or),lr},create=ar=>ar?createImpl(ar):createImpl,__vite_import_meta_env__={};function createJSONStorage(ar,or){let lr;try{lr=ar()}catch{return}return{getItem:ur=>{var dr;const hr=mr=>mr===null?null:JSON.parse(mr,void 0),pr=(dr=lr.getItem(ur))!=null?dr:null;return pr instanceof Promise?pr.then(hr):hr(pr)},setItem:(ur,dr)=>lr.setItem(ur,JSON.stringify(dr,void 0)),removeItem:ur=>lr.removeItem(ur)}}const toThenable=ar=>or=>{try{const lr=ar(or);return lr instanceof Promise?lr:{then(cr){return toThenable(cr)(lr)},catch(cr){return this}}}catch(lr){return{then(cr){return this},catch(cr){return toThenable(cr)(lr)}}}},oldImpl=(ar,or)=>(lr,cr,ur)=>{let dr={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:_r=>_r,version:0,merge:(_r,jr)=>({...jr,..._r}),...or},hr=!1;const pr=new Set,mr=new Set;let fr;try{fr=dr.getStorage()}catch{}if(!fr)return ar((..._r)=>{console.warn(`[zustand persist middleware] Unable to update item '${dr.name}', the given storage is currently unavailable.`),lr(..._r)},cr,ur);const xr=toThenable(dr.serialize),Er=()=>{const _r=dr.partialize({...cr()});let jr;const wr=xr({state:_r,version:dr.version}).then(Sr=>fr.setItem(dr.name,Sr)).catch(Sr=>{jr=Sr});if(jr)throw jr;return wr},vr=ur.setState;ur.setState=(_r,jr)=>{vr(_r,jr),Er()};const gr=ar((..._r)=>{lr(..._r),Er()},cr,ur);let yr;const br=()=>{var _r;if(!fr)return;hr=!1,pr.forEach(wr=>wr(cr()));const jr=((_r=dr.onRehydrateStorage)==null?void 0:_r.call(dr,cr()))||void 0;return toThenable(fr.getItem.bind(fr))(dr.name).then(wr=>{if(wr)return dr.deserialize(wr)}).then(wr=>{if(wr)if(typeof wr.version=="number"&&wr.version!==dr.version){if(dr.migrate)return dr.migrate(wr.state,wr.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return wr.state}).then(wr=>{var Sr;return yr=dr.merge(wr,(Sr=cr())!=null?Sr:gr),lr(yr,!0),Er()}).then(()=>{jr==null||jr(yr,void 0),hr=!0,mr.forEach(wr=>wr(yr))}).catch(wr=>{jr==null||jr(void 0,wr)})};return ur.persist={setOptions:_r=>{dr={...dr,..._r},_r.getStorage&&(fr=_r.getStorage())},clearStorage:()=>{fr==null||fr.removeItem(dr.name)},getOptions:()=>dr,rehydrate:()=>br(),hasHydrated:()=>hr,onHydrate:_r=>(pr.add(_r),()=>{pr.delete(_r)}),onFinishHydration:_r=>(mr.add(_r),()=>{mr.delete(_r)})},br(),yr||gr},newImpl=(ar,or)=>(lr,cr,ur)=>{let dr={storage:createJSONStorage(()=>localStorage),partialize:br=>br,version:0,merge:(br,_r)=>({..._r,...br}),...or},hr=!1;const pr=new Set,mr=new Set;let fr=dr.storage;if(!fr)return ar((...br)=>{console.warn(`[zustand persist middleware] Unable to update item '${dr.name}', the given storage is currently unavailable.`),lr(...br)},cr,ur);const xr=()=>{const br=dr.partialize({...cr()});return fr.setItem(dr.name,{state:br,version:dr.version})},Er=ur.setState;ur.setState=(br,_r)=>{Er(br,_r),xr()};const vr=ar((...br)=>{lr(...br),xr()},cr,ur);ur.getInitialState=()=>vr;let gr;const yr=()=>{var br,_r;if(!fr)return;hr=!1,pr.forEach(wr=>{var Sr;return wr((Sr=cr())!=null?Sr:vr)});const jr=((_r=dr.onRehydrateStorage)==null?void 0:_r.call(dr,(br=cr())!=null?br:vr))||void 0;return toThenable(fr.getItem.bind(fr))(dr.name).then(wr=>{if(wr)if(typeof wr.version=="number"&&wr.version!==dr.version){if(dr.migrate)return[!0,dr.migrate(wr.state,wr.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,wr.state];return[!1,void 0]}).then(wr=>{var Sr;const[Tr,Rr]=wr;if(gr=dr.merge(Rr,(Sr=cr())!=null?Sr:vr),lr(gr,!0),Tr)return xr()}).then(()=>{jr==null||jr(gr,void 0),gr=cr(),hr=!0,mr.forEach(wr=>wr(gr))}).catch(wr=>{jr==null||jr(void 0,wr)})};return ur.persist={setOptions:br=>{dr={...dr,...br},br.storage&&(fr=br.storage)},clearStorage:()=>{fr==null||fr.removeItem(dr.name)},getOptions:()=>dr,rehydrate:()=>yr(),hasHydrated:()=>hr,onHydrate:br=>(pr.add(br),()=>{pr.delete(br)}),onFinishHydration:br=>(mr.add(br),()=>{mr.delete(br)})},dr.skipHydration||yr(),gr||vr},persistImpl=(ar,or)=>"getStorage"in or||"serialize"in or||"deserialize"in or?((__vite_import_meta_env__?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),oldImpl(ar,or)):newImpl(ar,or),persist=persistImpl,e=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,t=Object.keys,n=Array.isArray;function r$1(ar,or){return typeof or!="object"||t(or).forEach(function(lr){ar[lr]=or[lr]}),ar}typeof Promise>"u"||e.Promise||(e.Promise=Promise);const s=Object.getPrototypeOf,i={}.hasOwnProperty;function o(ar,or){return i.call(ar,or)}function a(ar,or){typeof or=="function"&&(or=or(s(ar))),(typeof Reflect>"u"?t:Reflect.ownKeys)(or).forEach(lr=>{l(ar,lr,or[lr])})}const u=Object.defineProperty;function l(ar,or,lr,cr){u(ar,or,r$1(lr&&o(lr,"get")&&typeof lr.get=="function"?{get:lr.get,set:lr.set,configurable:!0}:{value:lr,configurable:!0,writable:!0},cr))}function c(ar){return{from:function(or){return ar.prototype=Object.create(or.prototype),l(ar.prototype,"constructor",ar),{extend:a.bind(null,ar.prototype)}}}}const h=Object.getOwnPropertyDescriptor;function d(ar,or){let lr;return h(ar,or)||(lr=s(ar))&&d(lr,or)}const f=[].slice;function p(ar,or,lr){return f.call(ar,or,lr)}function y(ar,or){return or(ar)}function m(ar){if(!ar)throw new Error("Assertion Failed")}function v(ar){e.setImmediate?setImmediate(ar):setTimeout(ar,0)}function g(ar,or){return ar.reduce((lr,cr,ur)=>{var dr=or(cr,ur);return dr&&(lr[dr[0]]=dr[1]),lr},{})}function b(ar,or){if(typeof or=="string"&&o(ar,or))return ar[or];if(!or)return ar;if(typeof or!="string"){for(var lr=[],cr=0,ur=or.length;cr<ur;++cr){var dr=b(ar,or[cr]);lr.push(dr)}return lr}var hr=or.indexOf(".");if(hr!==-1){var pr=ar[or.substr(0,hr)];return pr==null?void 0:b(pr,or.substr(hr+1))}}function _(ar,or,lr){if(ar&&or!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(ar)))if(typeof or!="string"&&"length"in or){m(typeof lr!="string"&&"length"in lr);for(var cr=0,ur=or.length;cr<ur;++cr)_(ar,or[cr],lr[cr])}else{var dr=or.indexOf(".");if(dr!==-1){var hr=or.substr(0,dr),pr=or.substr(dr+1);if(pr==="")lr===void 0?n(ar)&&!isNaN(parseInt(hr))?ar.splice(hr,1):delete ar[hr]:ar[hr]=lr;else{var mr=ar[hr];mr&&o(ar,hr)||(mr=ar[hr]={}),_(mr,pr,lr)}}else lr===void 0?n(ar)&&!isNaN(parseInt(or))?ar.splice(or,1):delete ar[or]:ar[or]=lr}}function w(ar){var or={};for(var lr in ar)o(ar,lr)&&(or[lr]=ar[lr]);return or}const x=[].concat;function k(ar){return x.apply([],ar)}const E="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(k([8,16,32,64].map(ar=>["Int","Uint","Float"].map(or=>or+ar+"Array")))).filter(ar=>e[ar]),P=E.map(ar=>e[ar]);g(E,ar=>[ar,!0]);let K=null;function O(ar){K=typeof WeakMap<"u"&&new WeakMap;const or=S(ar);return K=null,or}function S(ar){if(!ar||typeof ar!="object")return ar;let or=K&&K.get(ar);if(or)return or;if(n(ar)){or=[],K&&K.set(ar,or);for(var lr=0,cr=ar.length;lr<cr;++lr)or.push(S(ar[lr]))}else if(P.indexOf(ar.constructor)>=0)or=ar;else{const dr=s(ar);for(var ur in or=dr===Object.prototype?{}:Object.create(dr),K&&K.set(ar,or),ar)o(ar,ur)&&(or[ur]=S(ar[ur]))}return or}const{toString:A}={};function C(ar){return A.call(ar).slice(8,-1)}const j=typeof Symbol<"u"?Symbol.iterator:"@@iterator",D=typeof j=="symbol"?function(ar){var or;return ar!=null&&(or=ar[j])&&or.apply(ar)}:function(){return null},I={};function B(ar){var or,lr,cr,ur;if(arguments.length===1){if(n(ar))return ar.slice();if(this===I&&typeof ar=="string")return[ar];if(ur=D(ar)){for(lr=[];!(cr=ur.next()).done;)lr.push(cr.value);return lr}if(ar==null)return[ar];if(typeof(or=ar.length)=="number"){for(lr=new Array(or);or--;)lr[or]=ar[or];return lr}return[ar]}for(or=arguments.length,lr=new Array(or);or--;)lr[or]=arguments[or];return lr}const T=typeof Symbol<"u"?ar=>ar[Symbol.toStringTag]==="AsyncFunction":()=>!1;var R=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function F(ar,or){R=ar,M=or}var M=()=>!0;const N=!new Error("").stack;function q(){if(N)try{throw q.arguments,new Error}catch(ar){return ar}return new Error}function $$1(ar,or){var lr=ar.stack;return lr?(or=or||0,lr.indexOf(ar.name)===0&&(or+=(ar.name+ar.message).split(`
`).length),lr.split(`
`).slice(or).filter(M).map(cr=>`
`+cr).join("")):""}var U=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],L=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(U),V={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function W(ar,or){this._e=q(),this.name=ar,this.message=or}function Y(ar,or){return ar+". Errors: "+Object.keys(or).map(lr=>or[lr].toString()).filter((lr,cr,ur)=>ur.indexOf(lr)===cr).join(`
`)}function z(ar,or,lr,cr){this._e=q(),this.failures=or,this.failedKeys=cr,this.successCount=lr,this.message=Y(ar,or)}function G(ar,or){this._e=q(),this.name="BulkError",this.failures=Object.keys(or).map(lr=>or[lr]),this.failuresByPos=or,this.message=Y(ar,or)}c(W).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+$$1(this._e,2))}},toString:function(){return this.name+": "+this.message}}),c(z).from(W),c(G).from(W);var H=L.reduce((ar,or)=>(ar[or]=or+"Error",ar),{});const Q=W;var X=L.reduce((ar,or)=>{var lr=or+"Error";function cr(ur,dr){this._e=q(),this.name=lr,ur?typeof ur=="string"?(this.message=`${ur}${dr?`
 `+dr:""}`,this.inner=dr||null):typeof ur=="object"&&(this.message=`${ur.name} ${ur.message}`,this.inner=ur):(this.message=V[or]||lr,this.inner=null)}return c(cr).from(Q),ar[or]=cr,ar},{});X.Syntax=SyntaxError,X.Type=TypeError,X.Range=RangeError;var J=U.reduce((ar,or)=>(ar[or+"Error"]=X[or],ar),{}),Z=L.reduce((ar,or)=>(["Syntax","Type","Range"].indexOf(or)===-1&&(ar[or+"Error"]=X[or]),ar),{});function ee(){}function te(ar){return ar}function ne(ar,or){return ar==null||ar===te?or:function(lr){return or(ar(lr))}}function re(ar,or){return function(){ar.apply(this,arguments),or.apply(this,arguments)}}function se(ar,or){return ar===ee?or:function(){var lr=ar.apply(this,arguments);lr!==void 0&&(arguments[0]=lr);var cr=this.onsuccess,ur=this.onerror;this.onsuccess=null,this.onerror=null;var dr=or.apply(this,arguments);return cr&&(this.onsuccess=this.onsuccess?re(cr,this.onsuccess):cr),ur&&(this.onerror=this.onerror?re(ur,this.onerror):ur),dr!==void 0?dr:lr}}function ie(ar,or){return ar===ee?or:function(){ar.apply(this,arguments);var lr=this.onsuccess,cr=this.onerror;this.onsuccess=this.onerror=null,or.apply(this,arguments),lr&&(this.onsuccess=this.onsuccess?re(lr,this.onsuccess):lr),cr&&(this.onerror=this.onerror?re(cr,this.onerror):cr)}}function oe(ar,or){return ar===ee?or:function(lr){var cr=ar.apply(this,arguments);r$1(lr,cr);var ur=this.onsuccess,dr=this.onerror;this.onsuccess=null,this.onerror=null;var hr=or.apply(this,arguments);return ur&&(this.onsuccess=this.onsuccess?re(ur,this.onsuccess):ur),dr&&(this.onerror=this.onerror?re(dr,this.onerror):dr),cr===void 0?hr===void 0?void 0:hr:r$1(cr,hr)}}function ae(ar,or){return ar===ee?or:function(){return or.apply(this,arguments)!==!1&&ar.apply(this,arguments)}}function ue(ar,or){return ar===ee?or:function(){var lr=ar.apply(this,arguments);if(lr&&typeof lr.then=="function"){for(var cr=this,ur=arguments.length,dr=new Array(ur);ur--;)dr[ur]=arguments[ur];return lr.then(function(){return or.apply(cr,dr)})}return or.apply(this,arguments)}}Z.ModifyError=z,Z.DexieError=W,Z.BulkError=G;var le={};const ce=100,[he,de,fe]=typeof Promise>"u"?[]:(()=>{let ar=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[ar,s(ar),ar];const or=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[or,s(or),ar]})(),pe=de&&de.then,ye=he&&he.constructor,me=!!fe;var ve=!1,ge=fe?()=>{fe.then($e)}:e.setImmediate?setImmediate.bind(null,$e):e.MutationObserver?()=>{var ar=document.createElement("div");new MutationObserver(()=>{$e(),ar=null}).observe(ar,{attributes:!0}),ar.setAttribute("i","1")}:()=>{setTimeout($e,0)},be=function(ar,or){Se.push([ar,or]),we&&(ge(),we=!1)},_e=!0,we=!0,xe=[],ke=[],Ee=null,Pe=te,Ke={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:dt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(ar=>{try{dt(ar[0],ar[1])}catch{}})}},Oe=Ke,Se=[],Ae=0,Ce=[];function je(ar){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ee,this._lib=!1;var or=this._PSD=Oe;if(R&&(this._stackHolder=q(),this._prev=null,this._numPrev=0),typeof ar!="function"){if(ar!==le)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Te(this,this._value))}this._state=null,this._value=null,++or.ref,Be(this,ar)}const De={get:function(){var ar=Oe,or=Xe;function lr(cr,ur){var dr=!ar.global&&(ar!==Oe||or!==Xe);const hr=dr&&!tt();var pr=new je((mr,fr)=>{Fe(this,new Ie(lt(cr,ar,dr,hr),lt(ur,ar,dr,hr),mr,fr,ar))});return R&&qe(pr,this),pr}return lr.prototype=le,lr},set:function(ar){l(this,"then",ar&&ar.prototype===le?De:{get:function(){return ar},set:De.set})}};function Ie(ar,or,lr,cr,ur){this.onFulfilled=typeof ar=="function"?ar:null,this.onRejected=typeof or=="function"?or:null,this.resolve=lr,this.reject=cr,this.psd=ur}function Be(ar,or){try{or(lr=>{if(ar._state===null){if(lr===ar)throw new TypeError("A promise cannot be resolved with itself.");var cr=ar._lib&&Ue();lr&&typeof lr.then=="function"?Be(ar,(ur,dr)=>{lr instanceof je?lr._then(ur,dr):lr.then(ur,dr)}):(ar._state=!0,ar._value=lr,Re(ar)),cr&&Le()}},Te.bind(null,ar))}catch(lr){Te(ar,lr)}}function Te(ar,or){if(ke.push(or),ar._state===null){var lr=ar._lib&&Ue();or=Pe(or),ar._state=!1,ar._value=or,R&&or!==null&&typeof or=="object"&&!or._promise&&function(cr,ur,dr){try{cr.apply(null,dr)}catch{}}(()=>{var cr=d(or,"stack");or._promise=ar,l(or,"stack",{get:()=>ve?cr&&(cr.get?cr.get.apply(or):cr.value):ar.stack})}),function(cr){xe.some(ur=>ur._value===cr._value)||xe.push(cr)}(ar),Re(ar),lr&&Le()}}function Re(ar){var or=ar._listeners;ar._listeners=[];for(var lr=0,cr=or.length;lr<cr;++lr)Fe(ar,or[lr]);var ur=ar._PSD;--ur.ref||ur.finalize(),Ae===0&&(++Ae,be(()=>{--Ae==0&&Ve()},[]))}function Fe(ar,or){if(ar._state!==null){var lr=ar._state?or.onFulfilled:or.onRejected;if(lr===null)return(ar._state?or.resolve:or.reject)(ar._value);++or.psd.ref,++Ae,be(Me,[lr,ar,or])}else ar._listeners.push(or)}function Me(ar,or,lr){try{Ee=or;var cr,ur=or._value;or._state?cr=ar(ur):(ke.length&&(ke=[]),cr=ar(ur),ke.indexOf(ur)===-1&&function(dr){for(var hr=xe.length;hr;)if(xe[--hr]._value===dr._value)return void xe.splice(hr,1)}(or)),lr.resolve(cr)}catch(dr){lr.reject(dr)}finally{Ee=null,--Ae==0&&Ve(),--lr.psd.ref||lr.psd.finalize()}}function Ne(ar,or,lr){if(or.length===lr)return or;var cr="";if(ar._state===!1){var ur,dr,hr=ar._value;hr!=null?(ur=hr.name||"Error",dr=hr.message||hr,cr=$$1(hr,0)):(ur=hr,dr=""),or.push(ur+(dr?": "+dr:"")+cr)}return R&&((cr=$$1(ar._stackHolder,2))&&or.indexOf(cr)===-1&&or.push(cr),ar._prev&&Ne(ar._prev,or,lr)),or}function qe(ar,or){var lr=or?or._numPrev+1:0;lr<100&&(ar._prev=or,ar._numPrev=lr)}function $e(){Ue()&&Le()}function Ue(){var ar=_e;return _e=!1,we=!1,ar}function Le(){var ar,or,lr;do for(;Se.length>0;)for(ar=Se,Se=[],lr=ar.length,or=0;or<lr;++or){var cr=ar[or];cr[0].apply(null,cr[1])}while(Se.length>0);_e=!0,we=!0}function Ve(){var ar=xe;xe=[],ar.forEach(cr=>{cr._PSD.onunhandled.call(null,cr._value,cr)});for(var or=Ce.slice(0),lr=or.length;lr;)or[--lr]()}function We(ar){return new je(le,!1,ar)}function Ye(ar,or){var lr=Oe;return function(){var cr=Ue(),ur=Oe;try{return it(lr,!0),ar.apply(this,arguments)}catch(dr){or&&or(dr)}finally{it(ur,!1),cr&&Le()}}}a(je.prototype,{then:De,_then:function(ar,or){Fe(this,new Ie(null,null,ar,or,Oe))},catch:function(ar){if(arguments.length===1)return this.then(null,ar);var or=arguments[0],lr=arguments[1];return typeof or=="function"?this.then(null,cr=>cr instanceof or?lr(cr):We(cr)):this.then(null,cr=>cr&&cr.name===or?lr(cr):We(cr))},finally:function(ar){return this.then(or=>(ar(),or),or=>(ar(),We(or)))},stack:{get:function(){if(this._stack)return this._stack;try{ve=!0;var ar=Ne(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=ar),ar}finally{ve=!1}}},timeout:function(ar,or){return ar<1/0?new je((lr,cr)=>{var ur=setTimeout(()=>cr(new X.Timeout(or)),ar);this.then(lr,cr).finally(clearTimeout.bind(null,ur))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&l(je.prototype,Symbol.toStringTag,"Dexie.Promise"),Ke.env=ot(),a(je,{all:function(){var ar=B.apply(null,arguments).map(nt);return new je(function(or,lr){ar.length===0&&or([]);var cr=ar.length;ar.forEach((ur,dr)=>je.resolve(ur).then(hr=>{ar[dr]=hr,--cr||or(ar)},lr))})},resolve:ar=>{if(ar instanceof je)return ar;if(ar&&typeof ar.then=="function")return new je((lr,cr)=>{ar.then(lr,cr)});var or=new je(le,!0,ar);return qe(or,Ee),or},reject:We,race:function(){var ar=B.apply(null,arguments).map(nt);return new je((or,lr)=>{ar.map(cr=>je.resolve(cr).then(or,lr))})},PSD:{get:()=>Oe,set:ar=>Oe=ar},totalEchoes:{get:()=>Xe},newPSD:Ze,usePSD:at,scheduler:{get:()=>be,set:ar=>{be=ar}},rejectionMapper:{get:()=>Pe,set:ar=>{Pe=ar}},follow:(ar,or)=>new je((lr,cr)=>Ze((ur,dr)=>{var hr=Oe;hr.unhandleds=[],hr.onunhandled=dr,hr.finalize=re(function(){(function(pr){function mr(){pr(),Ce.splice(Ce.indexOf(mr),1)}Ce.push(mr),++Ae,be(()=>{--Ae==0&&Ve()},[])})(()=>{this.unhandleds.length===0?ur():dr(this.unhandleds[0])})},hr.finalize),ar()},or,lr,cr))}),ye&&(ye.allSettled&&l(je,"allSettled",function(){const ar=B.apply(null,arguments).map(nt);return new je(or=>{ar.length===0&&or([]);let lr=ar.length;const cr=new Array(lr);ar.forEach((ur,dr)=>je.resolve(ur).then(hr=>cr[dr]={status:"fulfilled",value:hr},hr=>cr[dr]={status:"rejected",reason:hr}).then(()=>--lr||or(cr)))})}),ye.any&&typeof AggregateError<"u"&&l(je,"any",function(){const ar=B.apply(null,arguments).map(nt);return new je((or,lr)=>{ar.length===0&&lr(new AggregateError([]));let cr=ar.length;const ur=new Array(cr);ar.forEach((dr,hr)=>je.resolve(dr).then(pr=>or(pr),pr=>{ur[hr]=pr,--cr||lr(new AggregateError(ur))}))})}));const ze={awaits:0,echoes:0,id:0};var Ge=0,He=[],Qe=0,Xe=0,Je=0;function Ze(ar,or,lr,cr){var ur=Oe,dr=Object.create(ur);dr.parent=ur,dr.ref=0,dr.global=!1,dr.id=++Je;var hr=Ke.env;dr.env=me?{Promise:je,PromiseProp:{value:je,configurable:!0,writable:!0},all:je.all,race:je.race,allSettled:je.allSettled,any:je.any,resolve:je.resolve,reject:je.reject,nthen:ct(hr.nthen,dr),gthen:ct(hr.gthen,dr)}:{},or&&r$1(dr,or),++ur.ref,dr.finalize=function(){--this.parent.ref||this.parent.finalize()};var pr=at(dr,ar,lr,cr);return dr.ref===0&&dr.finalize(),pr}function et(){return ze.id||(ze.id=++Ge),++ze.awaits,ze.echoes+=ce,ze.id}function tt(){return!!ze.awaits&&(--ze.awaits==0&&(ze.id=0),ze.echoes=ze.awaits*ce,!0)}function nt(ar){return ze.echoes&&ar&&ar.constructor===ye?(et(),ar.then(or=>(tt(),or),or=>(tt(),ft(or)))):ar}function rt(ar){++Xe,ze.echoes&&--ze.echoes!=0||(ze.echoes=ze.id=0),He.push(Oe),it(ar,!0)}function st(){var ar=He[He.length-1];He.pop(),it(ar,!1)}function it(ar,or){var lr=Oe;if((or?!ze.echoes||Qe++&&ar===Oe:!Qe||--Qe&&ar===Oe)||ut(or?rt.bind(null,ar):st),ar!==Oe&&(Oe=ar,lr===Ke&&(Ke.env=ot()),me)){var cr=Ke.env.Promise,ur=ar.env;de.then=ur.nthen,cr.prototype.then=ur.gthen,(lr.global||ar.global)&&(Object.defineProperty(e,"Promise",ur.PromiseProp),cr.all=ur.all,cr.race=ur.race,cr.resolve=ur.resolve,cr.reject=ur.reject,ur.allSettled&&(cr.allSettled=ur.allSettled),ur.any&&(cr.any=ur.any))}}function ot(){var ar=e.Promise;return me?{Promise:ar,PromiseProp:Object.getOwnPropertyDescriptor(e,"Promise"),all:ar.all,race:ar.race,allSettled:ar.allSettled,any:ar.any,resolve:ar.resolve,reject:ar.reject,nthen:de.then,gthen:ar.prototype.then}:{}}function at(ar,or,lr,cr,ur){var dr=Oe;try{return it(ar,!0),or(lr,cr,ur)}finally{it(dr,!1)}}function ut(ar){pe.call(he,ar)}function lt(ar,or,lr,cr){return typeof ar!="function"?ar:function(){var ur=Oe;lr&&et(),it(or,!0);try{return ar.apply(this,arguments)}finally{it(ur,!1),cr&&ut(tt)}}}function ct(ar,or){return function(lr,cr){return ar.call(this,lt(lr,or),lt(cr,or))}}(""+pe).indexOf("[native code]")===-1&&(et=tt=ee);const ht="unhandledrejection";function dt(ar,or){var lr;try{lr=or.onuncatched(ar)}catch{}if(lr!==!1)try{var cr,ur={promise:or,reason:ar};if(e.document&&document.createEvent?((cr=document.createEvent("Event")).initEvent(ht,!0,!0),r$1(cr,ur)):e.CustomEvent&&r$1(cr=new CustomEvent(ht,{detail:ur}),ur),cr&&e.dispatchEvent&&(dispatchEvent(cr),!e.PromiseRejectionEvent&&e.onunhandledrejection))try{e.onunhandledrejection(cr)}catch{}R&&cr&&!cr.defaultPrevented&&console.warn(`Unhandled rejection: ${ar.stack||ar}`)}catch{}}var ft=je.reject;function pt(ar,or,lr,cr){if(ar.idbdb&&(ar._state.openComplete||Oe.letThrough||ar._vip)){var ur=ar._createTransaction(or,lr,ar._dbSchema);try{ur.create(),ar._state.PR1398_maxLoop=3}catch(dr){return dr.name===H.InvalidState&&ar.isOpen()&&--ar._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),ar._close(),ar.open().then(()=>pt(ar,or,lr,cr))):ft(dr)}return ur._promise(or,(dr,hr)=>Ze(()=>(Oe.trans=ur,cr(dr,hr,ur)))).then(dr=>ur._completion.then(()=>dr))}if(ar._state.openComplete)return ft(new X.DatabaseClosed(ar._state.dbOpenError));if(!ar._state.isBeingOpened){if(!ar._options.autoOpen)return ft(new X.DatabaseClosed);ar.open().catch(ee)}return ar._state.dbReadyPromise.then(()=>pt(ar,or,lr,cr))}const yt="3.2.7",mt="",vt=-1/0,gt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",bt="String expected.",_t=[],wt=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),xt=wt,kt=wt,Et=ar=>!/(dexie\.js|dexie\.min\.js)/.test(ar),Pt="__dbnames",Kt="readonly",Ot="readwrite";function St(ar,or){return ar?or?function(){return ar.apply(this,arguments)&&or.apply(this,arguments)}:ar:or}const At={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ct(ar){return typeof ar!="string"||/\./.test(ar)?or=>or:or=>(or[ar]===void 0&&ar in or&&delete(or=O(or))[ar],or)}class jt{_trans(or,lr,cr){const ur=this._tx||Oe.trans,dr=this.name;function hr(mr,fr,xr){if(!xr.schema[dr])throw new X.NotFound("Table "+dr+" not part of transaction");return lr(xr.idbtrans,xr)}const pr=Ue();try{return ur&&ur.db===this.db?ur===Oe.trans?ur._promise(or,hr,cr):Ze(()=>ur._promise(or,hr,cr),{trans:ur,transless:Oe.transless||Oe}):pt(this.db,or,[this.name],hr)}finally{pr&&Le()}}get(or,lr){return or&&or.constructor===Object?this.where(or).first(lr):this._trans("readonly",cr=>this.core.get({trans:cr,key:or}).then(ur=>this.hook.reading.fire(ur))).then(lr)}where(or){if(typeof or=="string")return new this.db.WhereClause(this,or);if(n(or))return new this.db.WhereClause(this,`[${or.join("+")}]`);const lr=t(or);if(lr.length===1)return this.where(lr[0]).equals(or[lr[0]]);const cr=this.schema.indexes.concat(this.schema.primKey).filter(fr=>{if(fr.compound&&lr.every(xr=>fr.keyPath.indexOf(xr)>=0)){for(let xr=0;xr<lr.length;++xr)if(lr.indexOf(fr.keyPath[xr])===-1)return!1;return!0}return!1}).sort((fr,xr)=>fr.keyPath.length-xr.keyPath.length)[0];if(cr&&this.db._maxKey!==mt){const fr=cr.keyPath.slice(0,lr.length);return this.where(fr).equals(fr.map(xr=>or[xr]))}!cr&&R&&console.warn(`The query ${JSON.stringify(or)} on ${this.name} would benefit of a compound index [${lr.join("+")}]`);const{idxByName:ur}=this.schema,dr=this.db._deps.indexedDB;function hr(fr,xr){try{return dr.cmp(fr,xr)===0}catch{return!1}}const[pr,mr]=lr.reduce(([fr,xr],Er)=>{const vr=ur[Er],gr=or[Er];return[fr||vr,fr||!vr?St(xr,vr&&vr.multi?yr=>{const br=b(yr,Er);return n(br)&&br.some(_r=>hr(gr,_r))}:yr=>hr(gr,b(yr,Er))):xr]},[null,null]);return pr?this.where(pr.name).equals(or[pr.keyPath]).filter(mr):cr?this.filter(mr):this.where(lr).equals("")}filter(or){return this.toCollection().and(or)}count(or){return this.toCollection().count(or)}offset(or){return this.toCollection().offset(or)}limit(or){return this.toCollection().limit(or)}each(or){return this.toCollection().each(or)}toArray(or){return this.toCollection().toArray(or)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(or){return new this.db.Collection(new this.db.WhereClause(this,n(or)?`[${or.join("+")}]`:or))}reverse(){return this.toCollection().reverse()}mapToClass(or){this.schema.mappedClass=or;const lr=cr=>{if(!cr)return cr;const ur=Object.create(or.prototype);for(var dr in cr)if(o(cr,dr))try{ur[dr]=cr[dr]}catch{}return ur};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=lr,this.hook("reading",lr),or}defineClass(){return this.mapToClass(function(or){r$1(this,or)})}add(or,lr){const{auto:cr,keyPath:ur}=this.schema.primKey;let dr=or;return ur&&cr&&(dr=Ct(ur)(or)),this._trans("readwrite",hr=>this.core.mutate({trans:hr,type:"add",keys:lr!=null?[lr]:null,values:[dr]})).then(hr=>hr.numFailures?je.reject(hr.failures[0]):hr.lastResult).then(hr=>{if(ur)try{_(or,ur,hr)}catch{}return hr})}update(or,lr){if(typeof or!="object"||n(or))return this.where(":id").equals(or).modify(lr);{const cr=b(or,this.schema.primKey.keyPath);if(cr===void 0)return ft(new X.InvalidArgument("Given object does not contain its primary key"));try{typeof lr!="function"?t(lr).forEach(ur=>{_(or,ur,lr[ur])}):lr(or,{value:or,primKey:cr})}catch{}return this.where(":id").equals(cr).modify(lr)}}put(or,lr){const{auto:cr,keyPath:ur}=this.schema.primKey;let dr=or;return ur&&cr&&(dr=Ct(ur)(or)),this._trans("readwrite",hr=>this.core.mutate({trans:hr,type:"put",values:[dr],keys:lr!=null?[lr]:null})).then(hr=>hr.numFailures?je.reject(hr.failures[0]):hr.lastResult).then(hr=>{if(ur)try{_(or,ur,hr)}catch{}return hr})}delete(or){return this._trans("readwrite",lr=>this.core.mutate({trans:lr,type:"delete",keys:[or]})).then(lr=>lr.numFailures?je.reject(lr.failures[0]):void 0)}clear(){return this._trans("readwrite",or=>this.core.mutate({trans:or,type:"deleteRange",range:At})).then(or=>or.numFailures?je.reject(or.failures[0]):void 0)}bulkGet(or){return this._trans("readonly",lr=>this.core.getMany({keys:or,trans:lr}).then(cr=>cr.map(ur=>this.hook.reading.fire(ur))))}bulkAdd(or,lr,cr){const ur=Array.isArray(lr)?lr:void 0,dr=(cr=cr||(ur?void 0:lr))?cr.allKeys:void 0;return this._trans("readwrite",hr=>{const{auto:pr,keyPath:mr}=this.schema.primKey;if(mr&&ur)throw new X.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(ur&&ur.length!==or.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");const fr=or.length;let xr=mr&&pr?or.map(Ct(mr)):or;return this.core.mutate({trans:hr,type:"add",keys:ur,values:xr,wantResults:dr}).then(({numFailures:Er,results:vr,lastResult:gr,failures:yr})=>{if(Er===0)return dr?vr:gr;throw new G(`${this.name}.bulkAdd(): ${Er} of ${fr} operations failed`,yr)})})}bulkPut(or,lr,cr){const ur=Array.isArray(lr)?lr:void 0,dr=(cr=cr||(ur?void 0:lr))?cr.allKeys:void 0;return this._trans("readwrite",hr=>{const{auto:pr,keyPath:mr}=this.schema.primKey;if(mr&&ur)throw new X.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(ur&&ur.length!==or.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");const fr=or.length;let xr=mr&&pr?or.map(Ct(mr)):or;return this.core.mutate({trans:hr,type:"put",keys:ur,values:xr,wantResults:dr}).then(({numFailures:Er,results:vr,lastResult:gr,failures:yr})=>{if(Er===0)return dr?vr:gr;throw new G(`${this.name}.bulkPut(): ${Er} of ${fr} operations failed`,yr)})})}bulkDelete(or){const lr=or.length;return this._trans("readwrite",cr=>this.core.mutate({trans:cr,type:"delete",keys:or})).then(({numFailures:cr,lastResult:ur,failures:dr})=>{if(cr===0)return ur;throw new G(`${this.name}.bulkDelete(): ${cr} of ${lr} operations failed`,dr)})}}function Dt(ar){var or={},lr=function(hr,pr){if(pr){for(var mr=arguments.length,fr=new Array(mr-1);--mr;)fr[mr-1]=arguments[mr];return or[hr].subscribe.apply(null,fr),ar}if(typeof hr=="string")return or[hr]};lr.addEventType=dr;for(var cr=1,ur=arguments.length;cr<ur;++cr)dr(arguments[cr]);return lr;function dr(hr,pr,mr){if(typeof hr!="object"){var fr;pr||(pr=ae),mr||(mr=ee);var xr={subscribers:[],fire:mr,subscribe:function(Er){xr.subscribers.indexOf(Er)===-1&&(xr.subscribers.push(Er),xr.fire=pr(xr.fire,Er))},unsubscribe:function(Er){xr.subscribers=xr.subscribers.filter(function(vr){return vr!==Er}),xr.fire=xr.subscribers.reduce(pr,mr)}};return or[hr]=lr[hr]=xr,xr}t(fr=hr).forEach(function(Er){var vr=fr[Er];if(n(vr))dr(Er,fr[Er][0],fr[Er][1]);else{if(vr!=="asap")throw new X.InvalidArgument("Invalid event config");var gr=dr(Er,te,function(){for(var yr=arguments.length,br=new Array(yr);yr--;)br[yr]=arguments[yr];gr.subscribers.forEach(function(_r){v(function(){_r.apply(null,br)})})})}})}}function It(ar,or){return c(or).from({prototype:ar}),or}function Bt(ar,or){return!(ar.filter||ar.algorithm||ar.or)&&(or?ar.justLimit:!ar.replayFilter)}function Tt(ar,or){ar.filter=St(ar.filter,or)}function Rt(ar,or,lr){var cr=ar.replayFilter;ar.replayFilter=cr?()=>St(cr(),or()):or,ar.justLimit=lr&&!cr}function Ft(ar,or){if(ar.isPrimKey)return or.primaryKey;const lr=or.getIndexByKeyPath(ar.index);if(!lr)throw new X.Schema("KeyPath "+ar.index+" on object store "+or.name+" is not indexed");return lr}function Mt(ar,or,lr){const cr=Ft(ar,or.schema);return or.openCursor({trans:lr,values:!ar.keysOnly,reverse:ar.dir==="prev",unique:!!ar.unique,query:{index:cr,range:ar.range}})}function Nt(ar,or,lr,cr){const ur=ar.replayFilter?St(ar.filter,ar.replayFilter()):ar.filter;if(ar.or){const dr={},hr=(pr,mr,fr)=>{if(!ur||ur(mr,fr,vr=>mr.stop(vr),vr=>mr.fail(vr))){var xr=mr.primaryKey,Er=""+xr;Er==="[object ArrayBuffer]"&&(Er=""+new Uint8Array(xr)),o(dr,Er)||(dr[Er]=!0,or(pr,mr,fr))}};return Promise.all([ar.or._iterate(hr,lr),qt(Mt(ar,cr,lr),ar.algorithm,hr,!ar.keysOnly&&ar.valueMapper)])}return qt(Mt(ar,cr,lr),St(ar.algorithm,ur),or,!ar.keysOnly&&ar.valueMapper)}function qt(ar,or,lr,cr){var ur=Ye(cr?(dr,hr,pr)=>lr(cr(dr),hr,pr):lr);return ar.then(dr=>{if(dr)return dr.start(()=>{var hr=()=>dr.continue();or&&!or(dr,pr=>hr=pr,pr=>{dr.stop(pr),hr=ee},pr=>{dr.fail(pr),hr=ee})||ur(dr.value,dr,pr=>hr=pr),hr()})})}function $t(ar,or){try{const lr=Ut(ar),cr=Ut(or);if(lr!==cr)return lr==="Array"?1:cr==="Array"?-1:lr==="binary"?1:cr==="binary"?-1:lr==="string"?1:cr==="string"?-1:lr==="Date"?1:cr!=="Date"?NaN:-1;switch(lr){case"number":case"Date":case"string":return ar>or?1:ar<or?-1:0;case"binary":return function(ur,dr){const hr=ur.length,pr=dr.length,mr=hr<pr?hr:pr;for(let fr=0;fr<mr;++fr)if(ur[fr]!==dr[fr])return ur[fr]<dr[fr]?-1:1;return hr===pr?0:hr<pr?-1:1}(Lt(ar),Lt(or));case"Array":return function(ur,dr){const hr=ur.length,pr=dr.length,mr=hr<pr?hr:pr;for(let fr=0;fr<mr;++fr){const xr=$t(ur[fr],dr[fr]);if(xr!==0)return xr}return hr===pr?0:hr<pr?-1:1}(ar,or)}}catch{}return NaN}function Ut(ar){const or=typeof ar;if(or!=="object")return or;if(ArrayBuffer.isView(ar))return"binary";const lr=C(ar);return lr==="ArrayBuffer"?"binary":lr}function Lt(ar){return ar instanceof Uint8Array?ar:ArrayBuffer.isView(ar)?new Uint8Array(ar.buffer,ar.byteOffset,ar.byteLength):new Uint8Array(ar)}class Vt{_read(or,lr){var cr=this._ctx;return cr.error?cr.table._trans(null,ft.bind(null,cr.error)):cr.table._trans("readonly",or).then(lr)}_write(or){var lr=this._ctx;return lr.error?lr.table._trans(null,ft.bind(null,lr.error)):lr.table._trans("readwrite",or,"locked")}_addAlgorithm(or){var lr=this._ctx;lr.algorithm=St(lr.algorithm,or)}_iterate(or,lr){return Nt(this._ctx,or,lr,this._ctx.table.core)}clone(or){var lr=Object.create(this.constructor.prototype),cr=Object.create(this._ctx);return or&&r$1(cr,or),lr._ctx=cr,lr}raw(){return this._ctx.valueMapper=null,this}each(or){var lr=this._ctx;return this._read(cr=>Nt(lr,or,cr,lr.table.core))}count(or){return this._read(lr=>{const cr=this._ctx,ur=cr.table.core;if(Bt(cr,!0))return ur.count({trans:lr,query:{index:Ft(cr,ur.schema),range:cr.range}}).then(hr=>Math.min(hr,cr.limit));var dr=0;return Nt(cr,()=>(++dr,!1),lr,ur).then(()=>dr)}).then(or)}sortBy(or,lr){const cr=or.split(".").reverse(),ur=cr[0],dr=cr.length-1;function hr(fr,xr){return xr?hr(fr[cr[xr]],xr-1):fr[ur]}var pr=this._ctx.dir==="next"?1:-1;function mr(fr,xr){var Er=hr(fr,dr),vr=hr(xr,dr);return Er<vr?-pr:Er>vr?pr:0}return this.toArray(function(fr){return fr.sort(mr)}).then(lr)}toArray(or){return this._read(lr=>{var cr=this._ctx;if(cr.dir==="next"&&Bt(cr,!0)&&cr.limit>0){const{valueMapper:ur}=cr,dr=Ft(cr,cr.table.core.schema);return cr.table.core.query({trans:lr,limit:cr.limit,values:!0,query:{index:dr,range:cr.range}}).then(({result:hr})=>ur?hr.map(ur):hr)}{const ur=[];return Nt(cr,dr=>ur.push(dr),lr,cr.table.core).then(()=>ur)}},or)}offset(or){var lr=this._ctx;return or<=0||(lr.offset+=or,Bt(lr)?Rt(lr,()=>{var cr=or;return(ur,dr)=>cr===0||(cr===1?(--cr,!1):(dr(()=>{ur.advance(cr),cr=0}),!1))}):Rt(lr,()=>{var cr=or;return()=>--cr<0})),this}limit(or){return this._ctx.limit=Math.min(this._ctx.limit,or),Rt(this._ctx,()=>{var lr=or;return function(cr,ur,dr){return--lr<=0&&ur(dr),lr>=0}},!0),this}until(or,lr){return Tt(this._ctx,function(cr,ur,dr){return!or(cr.value)||(ur(dr),lr)}),this}first(or){return this.limit(1).toArray(function(lr){return lr[0]}).then(or)}last(or){return this.reverse().first(or)}filter(or){var lr,cr;return Tt(this._ctx,function(ur){return or(ur.value)}),lr=this._ctx,cr=or,lr.isMatch=St(lr.isMatch,cr),this}and(or){return this.filter(or)}or(or){return new this.db.WhereClause(this._ctx.table,or,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(or){var lr=this._ctx;return lr.keysOnly=!lr.isMatch,this.each(function(cr,ur){or(ur.key,ur)})}eachUniqueKey(or){return this._ctx.unique="unique",this.eachKey(or)}eachPrimaryKey(or){var lr=this._ctx;return lr.keysOnly=!lr.isMatch,this.each(function(cr,ur){or(ur.primaryKey,ur)})}keys(or){var lr=this._ctx;lr.keysOnly=!lr.isMatch;var cr=[];return this.each(function(ur,dr){cr.push(dr.key)}).then(function(){return cr}).then(or)}primaryKeys(or){var lr=this._ctx;if(lr.dir==="next"&&Bt(lr,!0)&&lr.limit>0)return this._read(ur=>{var dr=Ft(lr,lr.table.core.schema);return lr.table.core.query({trans:ur,values:!1,limit:lr.limit,query:{index:dr,range:lr.range}})}).then(({result:ur})=>ur).then(or);lr.keysOnly=!lr.isMatch;var cr=[];return this.each(function(ur,dr){cr.push(dr.primaryKey)}).then(function(){return cr}).then(or)}uniqueKeys(or){return this._ctx.unique="unique",this.keys(or)}firstKey(or){return this.limit(1).keys(function(lr){return lr[0]}).then(or)}lastKey(or){return this.reverse().firstKey(or)}distinct(){var or=this._ctx,lr=or.index&&or.table.schema.idxByName[or.index];if(!lr||!lr.multi)return this;var cr={};return Tt(this._ctx,function(ur){var dr=ur.primaryKey.toString(),hr=o(cr,dr);return cr[dr]=!0,!hr}),this}modify(or){var lr=this._ctx;return this._write(cr=>{var ur;if(typeof or=="function")ur=or;else{var dr=t(or),hr=dr.length;ur=function(br){for(var _r=!1,jr=0;jr<hr;++jr){var wr=dr[jr],Sr=or[wr];b(br,wr)!==Sr&&(_(br,wr,Sr),_r=!0)}return _r}}const pr=lr.table.core,{outbound:mr,extractKey:fr}=pr.schema.primaryKey,xr=this.db._options.modifyChunkSize||200,Er=[];let vr=0;const gr=[],yr=(br,_r)=>{const{failures:jr,numFailures:wr}=_r;vr+=br-wr;for(let Sr of t(jr))Er.push(jr[Sr])};return this.clone().primaryKeys().then(br=>{const _r=jr=>{const wr=Math.min(xr,br.length-jr);return pr.getMany({trans:cr,keys:br.slice(jr,jr+wr),cache:"immutable"}).then(Sr=>{const Tr=[],Rr=[],Nr=mr?[]:null,Cr=[];for(let Ar=0;Ar<wr;++Ar){const Or=Sr[Ar],Lr={value:O(Or),primKey:br[jr+Ar]};ur.call(Lr,Lr.value,Lr)!==!1&&(Lr.value==null?Cr.push(br[jr+Ar]):mr||$t(fr(Or),fr(Lr.value))===0?(Rr.push(Lr.value),mr&&Nr.push(br[jr+Ar])):(Cr.push(br[jr+Ar]),Tr.push(Lr.value)))}const kr=Bt(lr)&&lr.limit===1/0&&(typeof or!="function"||or===Wt)&&{index:lr.index,range:lr.range};return Promise.resolve(Tr.length>0&&pr.mutate({trans:cr,type:"add",values:Tr}).then(Ar=>{for(let Or in Ar.failures)Cr.splice(parseInt(Or),1);yr(Tr.length,Ar)})).then(()=>(Rr.length>0||kr&&typeof or=="object")&&pr.mutate({trans:cr,type:"put",keys:Nr,values:Rr,criteria:kr,changeSpec:typeof or!="function"&&or}).then(Ar=>yr(Rr.length,Ar))).then(()=>(Cr.length>0||kr&&or===Wt)&&pr.mutate({trans:cr,type:"delete",keys:Cr,criteria:kr}).then(Ar=>yr(Cr.length,Ar))).then(()=>br.length>jr+wr&&_r(jr+xr))})};return _r(0).then(()=>{if(Er.length>0)throw new z("Error modifying one or more objects",Er,vr,gr);return br.length})})})}delete(){var or=this._ctx,lr=or.range;return Bt(or)&&(or.isPrimKey&&!kt||lr.type===3)?this._write(cr=>{const{primaryKey:ur}=or.table.core.schema,dr=lr;return or.table.core.count({trans:cr,query:{index:ur,range:dr}}).then(hr=>or.table.core.mutate({trans:cr,type:"deleteRange",range:dr}).then(({failures:pr,lastResult:mr,results:fr,numFailures:xr})=>{if(xr)throw new z("Could not delete some values",Object.keys(pr).map(Er=>pr[Er]),hr-xr);return hr-xr}))}):this.modify(Wt)}}const Wt=(ar,or)=>or.value=null;function Yt(ar,or){return ar<or?-1:ar===or?0:1}function zt(ar,or){return ar>or?-1:ar===or?0:1}function Gt(ar,or,lr){var cr=ar instanceof en?new ar.Collection(ar):ar;return cr._ctx.error=lr?new lr(or):new TypeError(or),cr}function Ht(ar){return new ar.Collection(ar,()=>Zt("")).limit(0)}function Qt(ar,or,lr,cr,ur,dr){for(var hr=Math.min(ar.length,cr.length),pr=-1,mr=0;mr<hr;++mr){var fr=or[mr];if(fr!==cr[mr])return ur(ar[mr],lr[mr])<0?ar.substr(0,mr)+lr[mr]+lr.substr(mr+1):ur(ar[mr],cr[mr])<0?ar.substr(0,mr)+cr[mr]+lr.substr(mr+1):pr>=0?ar.substr(0,pr)+or[pr]+lr.substr(pr+1):null;ur(ar[mr],fr)<0&&(pr=mr)}return hr<cr.length&&dr==="next"?ar+lr.substr(ar.length):hr<ar.length&&dr==="prev"?ar.substr(0,lr.length):pr<0?null:ar.substr(0,pr)+cr[pr]+lr.substr(pr+1)}function Xt(ar,or,lr,cr){var ur,dr,hr,pr,mr,fr,xr,Er=lr.length;if(!lr.every(br=>typeof br=="string"))return Gt(ar,bt);function vr(br){ur=function(jr){return jr==="next"?wr=>wr.toUpperCase():wr=>wr.toLowerCase()}(br),dr=function(jr){return jr==="next"?wr=>wr.toLowerCase():wr=>wr.toUpperCase()}(br),hr=br==="next"?Yt:zt;var _r=lr.map(function(jr){return{lower:dr(jr),upper:ur(jr)}}).sort(function(jr,wr){return hr(jr.lower,wr.lower)});pr=_r.map(function(jr){return jr.upper}),mr=_r.map(function(jr){return jr.lower}),fr=br,xr=br==="next"?"":cr}vr("next");var gr=new ar.Collection(ar,()=>Jt(pr[0],mr[Er-1]+cr));gr._ondirectionchange=function(br){vr(br)};var yr=0;return gr._addAlgorithm(function(br,_r,jr){var wr=br.key;if(typeof wr!="string")return!1;var Sr=dr(wr);if(or(Sr,mr,yr))return!0;for(var Tr=null,Rr=yr;Rr<Er;++Rr){var Nr=Qt(wr,Sr,pr[Rr],mr[Rr],hr,fr);Nr===null&&Tr===null?yr=Rr+1:(Tr===null||hr(Tr,Nr)>0)&&(Tr=Nr)}return _r(Tr!==null?function(){br.continue(Tr+xr)}:jr),!1}),gr}function Jt(ar,or,lr,cr){return{type:2,lower:ar,upper:or,lowerOpen:lr,upperOpen:cr}}function Zt(ar){return{type:1,lower:ar,upper:ar}}class en{get Collection(){return this._ctx.table.db.Collection}between(or,lr,cr,ur){cr=cr!==!1,ur=ur===!0;try{return this._cmp(or,lr)>0||this._cmp(or,lr)===0&&(cr||ur)&&(!cr||!ur)?Ht(this):new this.Collection(this,()=>Jt(or,lr,!cr,!ur))}catch{return Gt(this,gt)}}equals(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Zt(or))}above(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Jt(or,void 0,!0))}aboveOrEqual(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Jt(or,void 0,!1))}below(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Jt(void 0,or,!1,!0))}belowOrEqual(or){return or==null?Gt(this,gt):new this.Collection(this,()=>Jt(void 0,or))}startsWith(or){return typeof or!="string"?Gt(this,bt):this.between(or,or+mt,!0,!0)}startsWithIgnoreCase(or){return or===""?this.startsWith(or):Xt(this,(lr,cr)=>lr.indexOf(cr[0])===0,[or],mt)}equalsIgnoreCase(or){return Xt(this,(lr,cr)=>lr===cr[0],[or],"")}anyOfIgnoreCase(){var or=B.apply(I,arguments);return or.length===0?Ht(this):Xt(this,(lr,cr)=>cr.indexOf(lr)!==-1,or,"")}startsWithAnyOfIgnoreCase(){var or=B.apply(I,arguments);return or.length===0?Ht(this):Xt(this,(lr,cr)=>cr.some(ur=>lr.indexOf(ur)===0),or,mt)}anyOf(){const or=B.apply(I,arguments);let lr=this._cmp;try{or.sort(lr)}catch{return Gt(this,gt)}if(or.length===0)return Ht(this);const cr=new this.Collection(this,()=>Jt(or[0],or[or.length-1]));cr._ondirectionchange=dr=>{lr=dr==="next"?this._ascending:this._descending,or.sort(lr)};let ur=0;return cr._addAlgorithm((dr,hr,pr)=>{const mr=dr.key;for(;lr(mr,or[ur])>0;)if(++ur,ur===or.length)return hr(pr),!1;return lr(mr,or[ur])===0||(hr(()=>{dr.continue(or[ur])}),!1)}),cr}notEqual(or){return this.inAnyRange([[vt,or],[or,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const or=B.apply(I,arguments);if(or.length===0)return new this.Collection(this);try{or.sort(this._ascending)}catch{return Gt(this,gt)}const lr=or.reduce((cr,ur)=>cr?cr.concat([[cr[cr.length-1][1],ur]]):[[vt,ur]],null);return lr.push([or[or.length-1],this.db._maxKey]),this.inAnyRange(lr,{includeLowers:!1,includeUppers:!1})}inAnyRange(or,lr){const cr=this._cmp,ur=this._ascending,dr=this._descending,hr=this._min,pr=this._max;if(or.length===0)return Ht(this);if(!or.every(wr=>wr[0]!==void 0&&wr[1]!==void 0&&ur(wr[0],wr[1])<=0))return Gt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",X.InvalidArgument);const mr=!lr||lr.includeLowers!==!1,fr=lr&&lr.includeUppers===!0;let xr,Er=ur;function vr(wr,Sr){return Er(wr[0],Sr[0])}try{xr=or.reduce(function(wr,Sr){let Tr=0,Rr=wr.length;for(;Tr<Rr;++Tr){const Nr=wr[Tr];if(cr(Sr[0],Nr[1])<0&&cr(Sr[1],Nr[0])>0){Nr[0]=hr(Nr[0],Sr[0]),Nr[1]=pr(Nr[1],Sr[1]);break}}return Tr===Rr&&wr.push(Sr),wr},[]),xr.sort(vr)}catch{return Gt(this,gt)}let gr=0;const yr=fr?wr=>ur(wr,xr[gr][1])>0:wr=>ur(wr,xr[gr][1])>=0,br=mr?wr=>dr(wr,xr[gr][0])>0:wr=>dr(wr,xr[gr][0])>=0;let _r=yr;const jr=new this.Collection(this,()=>Jt(xr[0][0],xr[xr.length-1][1],!mr,!fr));return jr._ondirectionchange=wr=>{wr==="next"?(_r=yr,Er=ur):(_r=br,Er=dr),xr.sort(vr)},jr._addAlgorithm((wr,Sr,Tr)=>{for(var Rr=wr.key;_r(Rr);)if(++gr,gr===xr.length)return Sr(Tr),!1;return!!function(Nr){return!yr(Nr)&&!br(Nr)}(Rr)||(this._cmp(Rr,xr[gr][1])===0||this._cmp(Rr,xr[gr][0])===0||Sr(()=>{Er===ur?wr.continue(xr[gr][0]):wr.continue(xr[gr][1])}),!1)}),jr}startsWithAnyOf(){const or=B.apply(I,arguments);return or.every(lr=>typeof lr=="string")?or.length===0?Ht(this):this.inAnyRange(or.map(lr=>[lr,lr+mt])):Gt(this,"startsWithAnyOf() only works with strings")}}function tn(ar){return Ye(function(or){return nn(or),ar(or.target.error),!1})}function nn(ar){ar.stopPropagation&&ar.stopPropagation(),ar.preventDefault&&ar.preventDefault()}const rn="storagemutated",sn="x-storagemutated-1",on=Dt(null,rn);class an{_lock(){return m(!Oe.global),++this._reculock,this._reculock!==1||Oe.global||(Oe.lockOwnerFor=this),this}_unlock(){if(m(!Oe.global),--this._reculock==0)for(Oe.global||(Oe.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var or=this._blockedFuncs.shift();try{at(or[1],or[0])}catch{}}return this}_locked(){return this._reculock&&Oe.lockOwnerFor!==this}create(or){if(!this.mode)return this;const lr=this.db.idbdb,cr=this.db._state.dbOpenError;if(m(!this.idbtrans),!or&&!lr)switch(cr&&cr.name){case"DatabaseClosedError":throw new X.DatabaseClosed(cr);case"MissingAPIError":throw new X.MissingAPI(cr.message,cr);default:throw new X.OpenFailed(cr)}if(!this.active)throw new X.TransactionInactive;return m(this._completion._state===null),(or=this.idbtrans=or||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):lr.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ye(ur=>{nn(ur),this._reject(or.error)}),or.onabort=Ye(ur=>{nn(ur),this.active&&this._reject(new X.Abort(or.error)),this.active=!1,this.on("abort").fire(ur)}),or.oncomplete=Ye(()=>{this.active=!1,this._resolve(),"mutatedParts"in or&&on.storagemutated.fire(or.mutatedParts)}),this}_promise(or,lr,cr){if(or==="readwrite"&&this.mode!=="readwrite")return ft(new X.ReadOnly("Transaction is readonly"));if(!this.active)return ft(new X.TransactionInactive);if(this._locked())return new je((dr,hr)=>{this._blockedFuncs.push([()=>{this._promise(or,lr,cr).then(dr,hr)},Oe])});if(cr)return Ze(()=>{var dr=new je((hr,pr)=>{this._lock();const mr=lr(hr,pr,this);mr&&mr.then&&mr.then(hr,pr)});return dr.finally(()=>this._unlock()),dr._lib=!0,dr});var ur=new je((dr,hr)=>{var pr=lr(dr,hr,this);pr&&pr.then&&pr.then(dr,hr)});return ur._lib=!0,ur}_root(){return this.parent?this.parent._root():this}waitFor(or){var lr=this._root();const cr=je.resolve(or);if(lr._waitingFor)lr._waitingFor=lr._waitingFor.then(()=>cr);else{lr._waitingFor=cr,lr._waitingQueue=[];var ur=lr.idbtrans.objectStore(lr.storeNames[0]);(function hr(){for(++lr._spinCount;lr._waitingQueue.length;)lr._waitingQueue.shift()();lr._waitingFor&&(ur.get(-1/0).onsuccess=hr)})()}var dr=lr._waitingFor;return new je((hr,pr)=>{cr.then(mr=>lr._waitingQueue.push(Ye(hr.bind(null,mr))),mr=>lr._waitingQueue.push(Ye(pr.bind(null,mr)))).finally(()=>{lr._waitingFor===dr&&(lr._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new X.Abort))}table(or){const lr=this._memoizedTables||(this._memoizedTables={});if(o(lr,or))return lr[or];const cr=this.schema[or];if(!cr)throw new X.NotFound("Table "+or+" not part of transaction");const ur=new this.db.Table(or,cr,this);return ur.core=this.db.core.table(or),lr[or]=ur,ur}}function un(ar,or,lr,cr,ur,dr,hr){return{name:ar,keyPath:or,unique:lr,multi:cr,auto:ur,compound:dr,src:(lr&&!hr?"&":"")+(cr?"*":"")+(ur?"++":"")+ln(or)}}function ln(ar){return typeof ar=="string"?ar:ar?"["+[].join.call(ar,"+")+"]":""}function cn(ar,or,lr){return{name:ar,primKey:or,indexes:lr,mappedClass:null,idxByName:g(lr,cr=>[cr.name,cr])}}let hn=ar=>{try{return ar.only([[]]),hn=()=>[[]],[[]]}catch{return hn=()=>mt,mt}};function dn(ar){return ar==null?()=>{}:typeof ar=="string"?function(or){return or.split(".").length===1?cr=>cr[or]:cr=>b(cr,or)}(ar):or=>b(or,ar)}function fn(ar){return[].slice.call(ar)}let pn=0;function yn(ar){return ar==null?":id":typeof ar=="string"?ar:`[${ar.join("+")}]`}function mn(ar,or,lr){function cr(mr){if(mr.type===3)return null;if(mr.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:fr,upper:xr,lowerOpen:Er,upperOpen:vr}=mr;return fr===void 0?xr===void 0?null:or.upperBound(xr,!!vr):xr===void 0?or.lowerBound(fr,!!Er):or.bound(fr,xr,!!Er,!!vr)}const{schema:ur,hasGetAll:dr}=function(mr,fr){const xr=fn(mr.objectStoreNames);return{schema:{name:mr.name,tables:xr.map(Er=>fr.objectStore(Er)).map(Er=>{const{keyPath:vr,autoIncrement:gr}=Er,yr=n(vr),br=vr==null,_r={},jr={name:Er.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:br,compound:yr,keyPath:vr,autoIncrement:gr,unique:!0,extractKey:dn(vr)},indexes:fn(Er.indexNames).map(wr=>Er.index(wr)).map(wr=>{const{name:Sr,unique:Tr,multiEntry:Rr,keyPath:Nr}=wr,Cr={name:Sr,compound:n(Nr),keyPath:Nr,unique:Tr,multiEntry:Rr,extractKey:dn(Nr)};return _r[yn(Nr)]=Cr,Cr}),getIndexByKeyPath:wr=>_r[yn(wr)]};return _r[":id"]=jr.primaryKey,vr!=null&&(_r[yn(vr)]=jr.primaryKey),jr})},hasGetAll:xr.length>0&&"getAll"in fr.objectStore(xr[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(ar,lr),hr=ur.tables.map(mr=>function(fr){const xr=fr.name;return{name:xr,schema:fr,mutate:function({trans:Er,type:vr,keys:gr,values:yr,range:br}){return new Promise((_r,jr)=>{_r=Ye(_r);const wr=Er.objectStore(xr),Sr=wr.keyPath==null,Tr=vr==="put"||vr==="add";if(!Tr&&vr!=="delete"&&vr!=="deleteRange")throw new Error("Invalid operation type: "+vr);const{length:Rr}=gr||yr||{length:1};if(gr&&yr&&gr.length!==yr.length)throw new Error("Given keys array must have same length as given values array.");if(Rr===0)return _r({numFailures:0,failures:{},results:[],lastResult:void 0});let Nr;const Cr=[],kr=[];let Ar=0;const Or=Fr=>{++Ar,nn(Fr)};if(vr==="deleteRange"){if(br.type===4)return _r({numFailures:Ar,failures:kr,results:[],lastResult:void 0});br.type===3?Cr.push(Nr=wr.clear()):Cr.push(Nr=wr.delete(cr(br)))}else{const[Fr,Hr]=Tr?Sr?[yr,gr]:[yr,null]:[gr,null];if(Tr)for(let Kr=0;Kr<Rr;++Kr)Cr.push(Nr=Hr&&Hr[Kr]!==void 0?wr[vr](Fr[Kr],Hr[Kr]):wr[vr](Fr[Kr])),Nr.onerror=Or;else for(let Kr=0;Kr<Rr;++Kr)Cr.push(Nr=wr[vr](Fr[Kr])),Nr.onerror=Or}const Lr=Fr=>{const Hr=Fr.target.result;Cr.forEach((Kr,Gr)=>Kr.error!=null&&(kr[Gr]=Kr.error)),_r({numFailures:Ar,failures:kr,results:vr==="delete"?gr:Cr.map(Kr=>Kr.result),lastResult:Hr})};Nr.onerror=Fr=>{Or(Fr),Lr(Fr)},Nr.onsuccess=Lr})},getMany:({trans:Er,keys:vr})=>new Promise((gr,yr)=>{gr=Ye(gr);const br=Er.objectStore(xr),_r=vr.length,jr=new Array(_r);let wr,Sr=0,Tr=0;const Rr=Cr=>{const kr=Cr.target;jr[kr._pos]=kr.result,++Tr===Sr&&gr(jr)},Nr=tn(yr);for(let Cr=0;Cr<_r;++Cr)vr[Cr]!=null&&(wr=br.get(vr[Cr]),wr._pos=Cr,wr.onsuccess=Rr,wr.onerror=Nr,++Sr);Sr===0&&gr(jr)}),get:({trans:Er,key:vr})=>new Promise((gr,yr)=>{gr=Ye(gr);const br=Er.objectStore(xr).get(vr);br.onsuccess=_r=>gr(_r.target.result),br.onerror=tn(yr)}),query:function(Er){return vr=>new Promise((gr,yr)=>{gr=Ye(gr);const{trans:br,values:_r,limit:jr,query:wr}=vr,Sr=jr===1/0?void 0:jr,{index:Tr,range:Rr}=wr,Nr=br.objectStore(xr),Cr=Tr.isPrimaryKey?Nr:Nr.index(Tr.name),kr=cr(Rr);if(jr===0)return gr({result:[]});if(Er){const Ar=_r?Cr.getAll(kr,Sr):Cr.getAllKeys(kr,Sr);Ar.onsuccess=Or=>gr({result:Or.target.result}),Ar.onerror=tn(yr)}else{let Ar=0;const Or=_r||!("openKeyCursor"in Cr)?Cr.openCursor(kr):Cr.openKeyCursor(kr),Lr=[];Or.onsuccess=Fr=>{const Hr=Or.result;return Hr?(Lr.push(_r?Hr.value:Hr.primaryKey),++Ar===jr?gr({result:Lr}):void Hr.continue()):gr({result:Lr})},Or.onerror=tn(yr)}})}(dr),openCursor:function({trans:Er,values:vr,query:gr,reverse:yr,unique:br}){return new Promise((_r,jr)=>{_r=Ye(_r);const{index:wr,range:Sr}=gr,Tr=Er.objectStore(xr),Rr=wr.isPrimaryKey?Tr:Tr.index(wr.name),Nr=yr?br?"prevunique":"prev":br?"nextunique":"next",Cr=vr||!("openKeyCursor"in Rr)?Rr.openCursor(cr(Sr),Nr):Rr.openKeyCursor(cr(Sr),Nr);Cr.onerror=tn(jr),Cr.onsuccess=Ye(kr=>{const Ar=Cr.result;if(!Ar)return void _r(null);Ar.___id=++pn,Ar.done=!1;const Or=Ar.continue.bind(Ar);let Lr=Ar.continuePrimaryKey;Lr&&(Lr=Lr.bind(Ar));const Fr=Ar.advance.bind(Ar),Hr=()=>{throw new Error("Cursor not stopped")};Ar.trans=Er,Ar.stop=Ar.continue=Ar.continuePrimaryKey=Ar.advance=()=>{throw new Error("Cursor not started")},Ar.fail=Ye(jr),Ar.next=function(){let Kr=1;return this.start(()=>Kr--?this.continue():this.stop()).then(()=>this)},Ar.start=Kr=>{const Gr=new Promise((Jr,os)=>{Jr=Ye(Jr),Cr.onerror=tn(os),Ar.fail=os,Ar.stop=Ur=>{Ar.stop=Ar.continue=Ar.continuePrimaryKey=Ar.advance=Hr,Jr(Ur)}}),Zr=()=>{if(Cr.result)try{Kr()}catch(Jr){Ar.fail(Jr)}else Ar.done=!0,Ar.start=()=>{throw new Error("Cursor behind last entry")},Ar.stop()};return Cr.onsuccess=Ye(Jr=>{Cr.onsuccess=Zr,Zr()}),Ar.continue=Or,Ar.continuePrimaryKey=Lr,Ar.advance=Fr,Zr(),Gr},_r(Ar)},jr)})},count({query:Er,trans:vr}){const{index:gr,range:yr}=Er;return new Promise((br,_r)=>{const jr=vr.objectStore(xr),wr=gr.isPrimaryKey?jr:jr.index(gr.name),Sr=cr(yr),Tr=Sr?wr.count(Sr):wr.count();Tr.onsuccess=Ye(Rr=>br(Rr.target.result)),Tr.onerror=tn(_r)})}}}(mr)),pr={};return hr.forEach(mr=>pr[mr.name]=mr),{stack:"dbcore",transaction:ar.transaction.bind(ar),table(mr){if(!pr[mr])throw new Error(`Table '${mr}' not found`);return pr[mr]},MIN_KEY:-1/0,MAX_KEY:hn(or),schema:ur}}function vn({_novip:ar},or){const lr=or.db,cr=function(ur,dr,{IDBKeyRange:hr,indexedDB:pr},mr){return{dbcore:function(xr,Er){return Er.reduce((vr,{create:gr})=>({...vr,...gr(vr)}),xr)}(mn(dr,hr,mr),ur.dbcore)}}(ar._middlewares,lr,ar._deps,or);ar.core=cr.dbcore,ar.tables.forEach(ur=>{const dr=ur.name;ar.core.schema.tables.some(hr=>hr.name===dr)&&(ur.core=ar.core.table(dr),ar[dr]instanceof ar.Table&&(ar[dr].core=ur.core))})}function gn({_novip:ar},or,lr,cr){lr.forEach(ur=>{const dr=cr[ur];or.forEach(hr=>{const pr=d(hr,ur);(!pr||"value"in pr&&pr.value===void 0)&&(hr===ar.Transaction.prototype||hr instanceof ar.Transaction?l(hr,ur,{get(){return this.table(ur)},set(mr){u(this,ur,{value:mr,writable:!0,configurable:!0,enumerable:!0})}}):hr[ur]=new ar.Table(ur,dr))})})}function bn({_novip:ar},or){or.forEach(lr=>{for(let cr in lr)lr[cr]instanceof ar.Table&&delete lr[cr]})}function _n(ar,or){return ar._cfg.version-or._cfg.version}function wn(ar,or,lr,cr){const ur=ar._dbSchema,dr=ar._createTransaction("readwrite",ar._storeNames,ur);dr.create(lr),dr._completion.catch(cr);const hr=dr._reject.bind(dr),pr=Oe.transless||Oe;Ze(()=>{Oe.trans=dr,Oe.transless=pr,or===0?(t(ur).forEach(mr=>{kn(lr,mr,ur[mr].primKey,ur[mr].indexes)}),vn(ar,lr),je.follow(()=>ar.on.populate.fire(dr)).catch(hr)):function({_novip:mr},fr,xr,Er){const vr=[],gr=mr._versions;let yr=mr._dbSchema=Pn(mr,mr.idbdb,Er),br=!1;const _r=gr.filter(wr=>wr._cfg.version>=fr);function jr(){return vr.length?je.resolve(vr.shift()(xr.idbtrans)).then(jr):je.resolve()}return _r.forEach(wr=>{vr.push(()=>{const Sr=yr,Tr=wr._cfg.dbschema;Kn(mr,Sr,Er),Kn(mr,Tr,Er),yr=mr._dbSchema=Tr;const Rr=xn(Sr,Tr);Rr.add.forEach(Cr=>{kn(Er,Cr[0],Cr[1].primKey,Cr[1].indexes)}),Rr.change.forEach(Cr=>{if(Cr.recreate)throw new X.Upgrade("Not yet support for changing primary key");{const kr=Er.objectStore(Cr.name);Cr.add.forEach(Ar=>En(kr,Ar)),Cr.change.forEach(Ar=>{kr.deleteIndex(Ar.name),En(kr,Ar)}),Cr.del.forEach(Ar=>kr.deleteIndex(Ar))}});const Nr=wr._cfg.contentUpgrade;if(Nr&&wr._cfg.version>fr){vn(mr,Er),xr._memoizedTables={},br=!0;let Cr=w(Tr);Rr.del.forEach(Lr=>{Cr[Lr]=Sr[Lr]}),bn(mr,[mr.Transaction.prototype]),gn(mr,[mr.Transaction.prototype],t(Cr),Cr),xr.schema=Cr;const kr=T(Nr);let Ar;kr&&et();const Or=je.follow(()=>{if(Ar=Nr(xr),Ar&&kr){var Lr=tt.bind(null,null);Ar.then(Lr,Lr)}});return Ar&&typeof Ar.then=="function"?je.resolve(Ar):Or.then(()=>Ar)}}),vr.push(Sr=>{(!br||!xt)&&function(Tr,Rr){[].slice.call(Rr.db.objectStoreNames).forEach(Nr=>Tr[Nr]==null&&Rr.db.deleteObjectStore(Nr))}(wr._cfg.dbschema,Sr),bn(mr,[mr.Transaction.prototype]),gn(mr,[mr.Transaction.prototype],mr._storeNames,mr._dbSchema),xr.schema=mr._dbSchema})}),jr().then(()=>{var wr,Sr;Sr=Er,t(wr=yr).forEach(Tr=>{Sr.db.objectStoreNames.contains(Tr)||kn(Sr,Tr,wr[Tr].primKey,wr[Tr].indexes)})})}(ar,or,dr,lr).catch(hr)})}function xn(ar,or){const lr={del:[],add:[],change:[]};let cr;for(cr in ar)or[cr]||lr.del.push(cr);for(cr in or){const ur=ar[cr],dr=or[cr];if(ur){const hr={name:cr,def:dr,recreate:!1,del:[],add:[],change:[]};if(""+(ur.primKey.keyPath||"")!=""+(dr.primKey.keyPath||"")||ur.primKey.auto!==dr.primKey.auto&&!wt)hr.recreate=!0,lr.change.push(hr);else{const pr=ur.idxByName,mr=dr.idxByName;let fr;for(fr in pr)mr[fr]||hr.del.push(fr);for(fr in mr){const xr=pr[fr],Er=mr[fr];xr?xr.src!==Er.src&&hr.change.push(Er):hr.add.push(Er)}(hr.del.length>0||hr.add.length>0||hr.change.length>0)&&lr.change.push(hr)}}else lr.add.push([cr,dr])}return lr}function kn(ar,or,lr,cr){const ur=ar.db.createObjectStore(or,lr.keyPath?{keyPath:lr.keyPath,autoIncrement:lr.auto}:{autoIncrement:lr.auto});return cr.forEach(dr=>En(ur,dr)),ur}function En(ar,or){ar.createIndex(or.name,or.keyPath,{unique:or.unique,multiEntry:or.multi})}function Pn(ar,or,lr){const cr={};return p(or.objectStoreNames,0).forEach(ur=>{const dr=lr.objectStore(ur);let hr=dr.keyPath;const pr=un(ln(hr),hr||"",!1,!1,!!dr.autoIncrement,hr&&typeof hr!="string",!0),mr=[];for(let xr=0;xr<dr.indexNames.length;++xr){const Er=dr.index(dr.indexNames[xr]);hr=Er.keyPath;var fr=un(Er.name,hr,!!Er.unique,!!Er.multiEntry,!1,hr&&typeof hr!="string",!1);mr.push(fr)}cr[ur]=cn(ur,pr,mr)}),cr}function Kn({_novip:ar},or,lr){const cr=lr.db.objectStoreNames;for(let ur=0;ur<cr.length;++ur){const dr=cr[ur],hr=lr.objectStore(dr);ar._hasGetAll="getAll"in hr;for(let pr=0;pr<hr.indexNames.length;++pr){const mr=hr.indexNames[pr],fr=hr.index(mr).keyPath,xr=typeof fr=="string"?fr:"["+p(fr).join("+")+"]";if(or[dr]){const Er=or[dr].idxByName[xr];Er&&(Er.name=mr,delete or[dr].idxByName[xr],or[dr].idxByName[mr]=Er)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&e.WorkerGlobalScope&&e instanceof e.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(ar._hasGetAll=!1)}class On{_parseStoresSpec(or,lr){t(or).forEach(cr=>{if(or[cr]!==null){var ur=or[cr].split(",").map((hr,pr)=>{const mr=(hr=hr.trim()).replace(/([&*]|\+\+)/g,""),fr=/^\[/.test(mr)?mr.match(/^\[(.*)\]$/)[1].split("+"):mr;return un(mr,fr||null,/\&/.test(hr),/\*/.test(hr),/\+\+/.test(hr),n(fr),pr===0)}),dr=ur.shift();if(dr.multi)throw new X.Schema("Primary key cannot be multi-valued");ur.forEach(hr=>{if(hr.auto)throw new X.Schema("Only primary key can be marked as autoIncrement (++)");if(!hr.keyPath)throw new X.Schema("Index must have a name and cannot be an empty string")}),lr[cr]=cn(cr,dr,ur)}})}stores(or){const lr=this.db;this._cfg.storesSource=this._cfg.storesSource?r$1(this._cfg.storesSource,or):or;const cr=lr._versions,ur={};let dr={};return cr.forEach(hr=>{r$1(ur,hr._cfg.storesSource),dr=hr._cfg.dbschema={},hr._parseStoresSpec(ur,dr)}),lr._dbSchema=dr,bn(lr,[lr._allTables,lr,lr.Transaction.prototype]),gn(lr,[lr._allTables,lr,lr.Transaction.prototype,this._cfg.tables],t(dr),dr),lr._storeNames=t(dr),this}upgrade(or){return this._cfg.contentUpgrade=ue(this._cfg.contentUpgrade||ee,or),this}}function Sn(ar,or){let lr=ar._dbNamesDB;return lr||(lr=ar._dbNamesDB=new Xn(Pt,{addons:[],indexedDB:ar,IDBKeyRange:or}),lr.version(1).stores({dbnames:"name"})),lr.table("dbnames")}function An(ar){return ar&&typeof ar.databases=="function"}function Cn(ar){return Ze(function(){return Oe.letThrough=!0,ar()})}function jn(){var ar;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(or){var lr=function(){return indexedDB.databases().finally(or)};ar=setInterval(lr,100),lr()}).finally(function(){return clearInterval(ar)}):Promise.resolve()}function Dn(ar){const or=ar._state,{indexedDB:lr}=ar._deps;if(or.isBeingOpened||ar.idbdb)return or.dbReadyPromise.then(()=>or.dbOpenError?ft(or.dbOpenError):ar);R&&(or.openCanceller._stackHolder=q()),or.isBeingOpened=!0,or.dbOpenError=null,or.openComplete=!1;const cr=or.openCanceller;function ur(){if(or.openCanceller!==cr)throw new X.DatabaseClosed("db.open() was cancelled")}let dr=or.dbReadyResolve,hr=null,pr=!1;const mr=()=>new je((fr,xr)=>{if(ur(),!lr)throw new X.MissingAPI;const Er=ar.name,vr=or.autoSchema?lr.open(Er):lr.open(Er,Math.round(10*ar.verno));if(!vr)throw new X.MissingAPI;vr.onerror=tn(xr),vr.onblocked=Ye(ar._fireOnBlocked),vr.onupgradeneeded=Ye(gr=>{if(hr=vr.transaction,or.autoSchema&&!ar._options.allowEmptyDB){vr.onerror=nn,hr.abort(),vr.result.close();const br=lr.deleteDatabase(Er);br.onsuccess=br.onerror=Ye(()=>{xr(new X.NoSuchDatabase(`Database ${Er} doesnt exist`))})}else{hr.onerror=tn(xr);var yr=gr.oldVersion>Math.pow(2,62)?0:gr.oldVersion;pr=yr<1,ar._novip.idbdb=vr.result,wn(ar,yr/10,hr,xr)}},xr),vr.onsuccess=Ye(()=>{hr=null;const gr=ar._novip.idbdb=vr.result,yr=p(gr.objectStoreNames);if(yr.length>0)try{const _r=gr.transaction((br=yr).length===1?br[0]:br,"readonly");or.autoSchema?function({_novip:jr},wr,Sr){jr.verno=wr.version/10;const Tr=jr._dbSchema=Pn(0,wr,Sr);jr._storeNames=p(wr.objectStoreNames,0),gn(jr,[jr._allTables],t(Tr),Tr)}(ar,gr,_r):(Kn(ar,ar._dbSchema,_r),function(jr,wr){const Sr=xn(Pn(0,jr.idbdb,wr),jr._dbSchema);return!(Sr.add.length||Sr.change.some(Tr=>Tr.add.length||Tr.change.length))}(ar,_r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),vn(ar,_r)}catch{}var br;_t.push(ar),gr.onversionchange=Ye(_r=>{or.vcFired=!0,ar.on("versionchange").fire(_r)}),gr.onclose=Ye(_r=>{ar.on("close").fire(_r)}),pr&&function({indexedDB:_r,IDBKeyRange:jr},wr){!An(_r)&&wr!==Pt&&Sn(_r,jr).put({name:wr}).catch(ee)}(ar._deps,Er),fr()},xr)}).catch(fr=>fr&&fr.name==="UnknownError"&&or.PR1398_maxLoop>0?(or.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),mr()):je.reject(fr));return je.race([cr,(typeof navigator>"u"?je.resolve():jn()).then(mr)]).then(()=>(ur(),or.onReadyBeingFired=[],je.resolve(Cn(()=>ar.on.ready.fire(ar.vip))).then(function fr(){if(or.onReadyBeingFired.length>0){let xr=or.onReadyBeingFired.reduce(ue,ee);return or.onReadyBeingFired=[],je.resolve(Cn(()=>xr(ar.vip))).then(fr)}}))).finally(()=>{or.onReadyBeingFired=null,or.isBeingOpened=!1}).then(()=>ar).catch(fr=>{or.dbOpenError=fr;try{hr&&hr.abort()}catch{}return cr===or.openCanceller&&ar._close(),ft(fr)}).finally(()=>{or.openComplete=!0,dr()})}function In(ar){var or=dr=>ar.next(dr),lr=ur(or),cr=ur(dr=>ar.throw(dr));function ur(dr){return hr=>{var pr=dr(hr),mr=pr.value;return pr.done?mr:mr&&typeof mr.then=="function"?mr.then(lr,cr):n(mr)?Promise.all(mr).then(lr,cr):lr(mr)}}return ur(or)()}function Bn(ar,or,lr){var cr=arguments.length;if(cr<2)throw new X.InvalidArgument("Too few arguments");for(var ur=new Array(cr-1);--cr;)ur[cr-1]=arguments[cr];return lr=ur.pop(),[ar,k(ur),lr]}function Tn(ar,or,lr,cr,ur){return je.resolve().then(()=>{const dr=Oe.transless||Oe,hr=ar._createTransaction(or,lr,ar._dbSchema,cr),pr={trans:hr,transless:dr};if(cr)hr.idbtrans=cr.idbtrans;else try{hr.create(),ar._state.PR1398_maxLoop=3}catch(Er){return Er.name===H.InvalidState&&ar.isOpen()&&--ar._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),ar._close(),ar.open().then(()=>Tn(ar,or,lr,null,ur))):ft(Er)}const mr=T(ur);let fr;mr&&et();const xr=je.follow(()=>{if(fr=ur.call(hr,hr),fr)if(mr){var Er=tt.bind(null,null);fr.then(Er,Er)}else typeof fr.next=="function"&&typeof fr.throw=="function"&&(fr=In(fr))},pr);return(fr&&typeof fr.then=="function"?je.resolve(fr).then(Er=>hr.active?Er:ft(new X.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):xr.then(()=>fr)).then(Er=>(cr&&hr._resolve(),hr._completion.then(()=>Er))).catch(Er=>(hr._reject(Er),ft(Er)))})}function Rn(ar,or,lr){const cr=n(ar)?ar.slice():[ar];for(let ur=0;ur<lr;++ur)cr.push(or);return cr}const Fn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(ar){return{...ar,table(or){const lr=ar.table(or),{schema:cr}=lr,ur={},dr=[];function hr(xr,Er,vr){const gr=yn(xr),yr=ur[gr]=ur[gr]||[],br=xr==null?0:typeof xr=="string"?1:xr.length,_r=Er>0,jr={...vr,isVirtual:_r,keyTail:Er,keyLength:br,extractKey:dn(xr),unique:!_r&&vr.unique};return yr.push(jr),jr.isPrimaryKey||dr.push(jr),br>1&&hr(br===2?xr[0]:xr.slice(0,br-1),Er+1,vr),yr.sort((wr,Sr)=>wr.keyTail-Sr.keyTail),jr}const pr=hr(cr.primaryKey.keyPath,0,cr.primaryKey);ur[":id"]=[pr];for(const xr of cr.indexes)hr(xr.keyPath,0,xr);function mr(xr){const Er=xr.query.index;return Er.isVirtual?{...xr,query:{index:Er,range:(vr=xr.query.range,gr=Er.keyTail,{type:vr.type===1?2:vr.type,lower:Rn(vr.lower,vr.lowerOpen?ar.MAX_KEY:ar.MIN_KEY,gr),lowerOpen:!0,upper:Rn(vr.upper,vr.upperOpen?ar.MIN_KEY:ar.MAX_KEY,gr),upperOpen:!0})}}:xr;var vr,gr}return{...lr,schema:{...cr,primaryKey:pr,indexes:dr,getIndexByKeyPath:function(xr){const Er=ur[yn(xr)];return Er&&Er[0]}},count:xr=>lr.count(mr(xr)),query:xr=>lr.query(mr(xr)),openCursor(xr){const{keyTail:Er,isVirtual:vr,keyLength:gr}=xr.query.index;return vr?lr.openCursor(mr(xr)).then(yr=>yr&&function(br){return Object.create(br,{continue:{value:function(jr){jr!=null?br.continue(Rn(jr,xr.reverse?ar.MAX_KEY:ar.MIN_KEY,Er)):xr.unique?br.continue(br.key.slice(0,gr).concat(xr.reverse?ar.MIN_KEY:ar.MAX_KEY,Er)):br.continue()}},continuePrimaryKey:{value(jr,wr){br.continuePrimaryKey(Rn(jr,ar.MAX_KEY,Er),wr)}},primaryKey:{get:()=>br.primaryKey},key:{get(){const jr=br.key;return gr===1?jr[0]:jr.slice(0,gr)}},value:{get:()=>br.value}})}(yr)):lr.openCursor(xr)}}}}}};function Mn(ar,or,lr,cr){return lr=lr||{},cr=cr||"",t(ar).forEach(ur=>{if(o(or,ur)){var dr=ar[ur],hr=or[ur];if(typeof dr=="object"&&typeof hr=="object"&&dr&&hr){const pr=C(dr);pr!==C(hr)?lr[cr+ur]=or[ur]:pr==="Object"?Mn(dr,hr,lr,cr+ur+"."):dr!==hr&&(lr[cr+ur]=or[ur])}else dr!==hr&&(lr[cr+ur]=or[ur])}else lr[cr+ur]=void 0}),t(or).forEach(ur=>{o(ar,ur)||(lr[cr+ur]=or[ur])}),lr}const Nn={stack:"dbcore",name:"HooksMiddleware",level:2,create:ar=>({...ar,table(or){const lr=ar.table(or),{primaryKey:cr}=lr.schema;return{...lr,mutate(dr){const hr=Oe.trans,{deleting:pr,creating:mr,updating:fr}=hr.table(or).hook;switch(dr.type){case"add":if(mr.fire===ee)break;return hr._promise("readwrite",()=>xr(dr),!0);case"put":if(mr.fire===ee&&fr.fire===ee)break;return hr._promise("readwrite",()=>xr(dr),!0);case"delete":if(pr.fire===ee)break;return hr._promise("readwrite",()=>xr(dr),!0);case"deleteRange":if(pr.fire===ee)break;return hr._promise("readwrite",()=>function(vr){return Er(vr.trans,vr.range,1e4)}(dr),!0)}return lr.mutate(dr);function xr(vr){const gr=Oe.trans,yr=vr.keys||function(br,_r){return _r.type==="delete"?_r.keys:_r.keys||_r.values.map(br.extractKey)}(cr,vr);if(!yr)throw new Error("Keys missing");return(vr=vr.type==="add"||vr.type==="put"?{...vr,keys:yr}:{...vr}).type!=="delete"&&(vr.values=[...vr.values]),vr.keys&&(vr.keys=[...vr.keys]),function(br,_r,jr){return _r.type==="add"?Promise.resolve([]):br.getMany({trans:_r.trans,keys:jr,cache:"immutable"})}(lr,vr,yr).then(br=>{const _r=yr.map((jr,wr)=>{const Sr=br[wr],Tr={onerror:null,onsuccess:null};if(vr.type==="delete")pr.fire.call(Tr,jr,Sr,gr);else if(vr.type==="add"||Sr===void 0){const Rr=mr.fire.call(Tr,jr,vr.values[wr],gr);jr==null&&Rr!=null&&(jr=Rr,vr.keys[wr]=jr,cr.outbound||_(vr.values[wr],cr.keyPath,jr))}else{const Rr=Mn(Sr,vr.values[wr]),Nr=fr.fire.call(Tr,Rr,jr,Sr,gr);if(Nr){const Cr=vr.values[wr];Object.keys(Nr).forEach(kr=>{o(Cr,kr)?Cr[kr]=Nr[kr]:_(Cr,kr,Nr[kr])})}}return Tr});return lr.mutate(vr).then(({failures:jr,results:wr,numFailures:Sr,lastResult:Tr})=>{for(let Rr=0;Rr<yr.length;++Rr){const Nr=wr?wr[Rr]:yr[Rr],Cr=_r[Rr];Nr==null?Cr.onerror&&Cr.onerror(jr[Rr]):Cr.onsuccess&&Cr.onsuccess(vr.type==="put"&&br[Rr]?vr.values[Rr]:Nr)}return{failures:jr,results:wr,numFailures:Sr,lastResult:Tr}}).catch(jr=>(_r.forEach(wr=>wr.onerror&&wr.onerror(jr)),Promise.reject(jr)))})}function Er(vr,gr,yr){return lr.query({trans:vr,values:!1,query:{index:cr,range:gr},limit:yr}).then(({result:br})=>xr({type:"delete",keys:br,trans:vr}).then(_r=>_r.numFailures>0?Promise.reject(_r.failures[0]):br.length<yr?{failures:[],numFailures:0,lastResult:void 0}:Er(vr,{...gr,lower:br[br.length-1],lowerOpen:!0},yr)))}}}}})};function qn(ar,or,lr){try{if(!or||or.keys.length<ar.length)return null;const cr=[];for(let ur=0,dr=0;ur<or.keys.length&&dr<ar.length;++ur)$t(or.keys[ur],ar[dr])===0&&(cr.push(lr?O(or.values[ur]):or.values[ur]),++dr);return cr.length===ar.length?cr:null}catch{return null}}const $n={stack:"dbcore",level:-1,create:ar=>({table:or=>{const lr=ar.table(or);return{...lr,getMany:cr=>{if(!cr.cache)return lr.getMany(cr);const ur=qn(cr.keys,cr.trans._cache,cr.cache==="clone");return ur?je.resolve(ur):lr.getMany(cr).then(dr=>(cr.trans._cache={keys:cr.keys,values:cr.cache==="clone"?O(dr):dr},dr))},mutate:cr=>(cr.type!=="add"&&(cr.trans._cache=null),lr.mutate(cr))}}})};function Un(ar){return!("from"in ar)}const Ln=function(ar,or){if(!this){const lr=new Ln;return ar&&"d"in ar&&r$1(lr,ar),lr}r$1(this,arguments.length?{d:1,from:ar,to:arguments.length>1?or:ar}:{d:0})};function Vn(ar,or,lr){const cr=$t(or,lr);if(isNaN(cr))return;if(cr>0)throw RangeError();if(Un(ar))return r$1(ar,{from:or,to:lr,d:1});const ur=ar.l,dr=ar.r;if($t(lr,ar.from)<0)return ur?Vn(ur,or,lr):ar.l={from:or,to:lr,d:1,l:null,r:null},Gn(ar);if($t(or,ar.to)>0)return dr?Vn(dr,or,lr):ar.r={from:or,to:lr,d:1,l:null,r:null},Gn(ar);$t(or,ar.from)<0&&(ar.from=or,ar.l=null,ar.d=dr?dr.d+1:1),$t(lr,ar.to)>0&&(ar.to=lr,ar.r=null,ar.d=ar.l?ar.l.d+1:1);const hr=!ar.r;ur&&!ar.l&&Wn(ar,ur),dr&&hr&&Wn(ar,dr)}function Wn(ar,or){Un(or)||function lr(cr,{from:ur,to:dr,l:hr,r:pr}){Vn(cr,ur,dr),hr&&lr(cr,hr),pr&&lr(cr,pr)}(ar,or)}function Yn(ar,or){const lr=zn(or);let cr=lr.next();if(cr.done)return!1;let ur=cr.value;const dr=zn(ar);let hr=dr.next(ur.from),pr=hr.value;for(;!cr.done&&!hr.done;){if($t(pr.from,ur.to)<=0&&$t(pr.to,ur.from)>=0)return!0;$t(ur.from,pr.from)<0?ur=(cr=lr.next(pr.from)).value:pr=(hr=dr.next(ur.from)).value}return!1}function zn(ar){let or=Un(ar)?null:{s:0,n:ar};return{next(lr){const cr=arguments.length>0;for(;or;)switch(or.s){case 0:if(or.s=1,cr)for(;or.n.l&&$t(lr,or.n.from)<0;)or={up:or,n:or.n.l,s:1};else for(;or.n.l;)or={up:or,n:or.n.l,s:1};case 1:if(or.s=2,!cr||$t(lr,or.n.to)<=0)return{value:or.n,done:!1};case 2:if(or.n.r){or.s=3,or={up:or,n:or.n.r,s:0};continue}case 3:or=or.up}return{done:!0}}}}function Gn(ar){var or,lr;const cr=(((or=ar.r)===null||or===void 0?void 0:or.d)||0)-(((lr=ar.l)===null||lr===void 0?void 0:lr.d)||0),ur=cr>1?"r":cr<-1?"l":"";if(ur){const dr=ur==="r"?"l":"r",hr={...ar},pr=ar[ur];ar.from=pr.from,ar.to=pr.to,ar[ur]=pr[ur],hr[ur]=pr[dr],ar[dr]=hr,hr.d=Hn(hr)}ar.d=Hn(ar)}function Hn({r:ar,l:or}){return(ar?or?Math.max(ar.d,or.d):ar.d:or?or.d:0)+1}a(Ln.prototype,{add(ar){return Wn(this,ar),this},addKey(ar){return Vn(this,ar,ar),this},addKeys(ar){return ar.forEach(or=>Vn(this,or,or)),this},[j](){return zn(this)}});const Qn={stack:"dbcore",level:0,create:ar=>{const or=ar.schema.name,lr=new Ln(ar.MIN_KEY,ar.MAX_KEY);return{...ar,table:cr=>{const ur=ar.table(cr),{schema:dr}=ur,{primaryKey:hr}=dr,{extractKey:pr,outbound:mr}=hr,fr={...ur,mutate:vr=>{const gr=vr.trans,yr=gr.mutatedParts||(gr.mutatedParts={}),br=Nr=>{const Cr=`idb://${or}/${cr}/${Nr}`;return yr[Cr]||(yr[Cr]=new Ln)},_r=br(""),jr=br(":dels"),{type:wr}=vr;let[Sr,Tr]=vr.type==="deleteRange"?[vr.range]:vr.type==="delete"?[vr.keys]:vr.values.length<50?[[],vr.values]:[];const Rr=vr.trans._cache;return ur.mutate(vr).then(Nr=>{if(n(Sr)){wr!=="delete"&&(Sr=Nr.results),_r.addKeys(Sr);const Cr=qn(Sr,Rr);Cr||wr==="add"||jr.addKeys(Sr),(Cr||Tr)&&function(kr,Ar,Or,Lr){function Fr(Hr){const Kr=kr(Hr.name||"");function Gr(Jr){return Jr!=null?Hr.extractKey(Jr):null}const Zr=Jr=>Hr.multiEntry&&n(Jr)?Jr.forEach(os=>Kr.addKey(os)):Kr.addKey(Jr);(Or||Lr).forEach((Jr,os)=>{const Ur=Or&&Gr(Or[os]),Vr=Lr&&Gr(Lr[os]);$t(Ur,Vr)!==0&&(Ur!=null&&Zr(Ur),Vr!=null&&Zr(Vr))})}Ar.indexes.forEach(Fr)}(br,dr,Cr,Tr)}else if(Sr){const Cr={from:Sr.lower,to:Sr.upper};jr.add(Cr),_r.add(Cr)}else _r.add(lr),jr.add(lr),dr.indexes.forEach(Cr=>br(Cr.name).add(lr));return Nr})}},xr=({query:{index:vr,range:gr}})=>{var yr,br;return[vr,new Ln((yr=gr.lower)!==null&&yr!==void 0?yr:ar.MIN_KEY,(br=gr.upper)!==null&&br!==void 0?br:ar.MAX_KEY)]},Er={get:vr=>[hr,new Ln(vr.key)],getMany:vr=>[hr,new Ln().addKeys(vr.keys)],count:xr,query:xr,openCursor:xr};return t(Er).forEach(vr=>{fr[vr]=function(gr){const{subscr:yr}=Oe;if(yr){const br=Tr=>{const Rr=`idb://${or}/${cr}/${Tr}`;return yr[Rr]||(yr[Rr]=new Ln)},_r=br(""),jr=br(":dels"),[wr,Sr]=Er[vr](gr);if(br(wr.name||"").add(Sr),!wr.isPrimaryKey){if(vr!=="count"){const Tr=vr==="query"&&mr&&gr.values&&ur.query({...gr,values:!1});return ur[vr].apply(this,arguments).then(Rr=>{if(vr==="query"){if(mr&&gr.values)return Tr.then(({result:Cr})=>(_r.addKeys(Cr),Rr));const Nr=gr.values?Rr.result.map(pr):Rr.result;gr.values?_r.addKeys(Nr):jr.addKeys(Nr)}else if(vr==="openCursor"){const Nr=Rr,Cr=gr.values;return Nr&&Object.create(Nr,{key:{get:()=>(jr.addKey(Nr.primaryKey),Nr.key)},primaryKey:{get(){const kr=Nr.primaryKey;return jr.addKey(kr),kr}},value:{get:()=>(Cr&&_r.addKey(Nr.primaryKey),Nr.value)}})}return Rr})}jr.add(lr)}}return ur[vr].apply(this,arguments)}}),fr}}}};class Xn{constructor(or,lr){this._middlewares={},this.verno=0;const cr=Xn.dependencies;this._options=lr={addons:Xn.addons,autoOpen:!0,indexedDB:cr.indexedDB,IDBKeyRange:cr.IDBKeyRange,...lr},this._deps={indexedDB:lr.indexedDB,IDBKeyRange:lr.IDBKeyRange};const{addons:ur}=lr;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const dr={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ee,dbReadyPromise:null,cancelOpen:ee,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var hr;dr.dbReadyPromise=new je(pr=>{dr.dbReadyResolve=pr}),dr.openCanceller=new je((pr,mr)=>{dr.cancelOpen=mr}),this._state=dr,this.name=or,this.on=Dt(this,"populate","blocked","versionchange","close",{ready:[ue,ee]}),this.on.ready.subscribe=y(this.on.ready.subscribe,pr=>(mr,fr)=>{Xn.vip(()=>{const xr=this._state;if(xr.openComplete)xr.dbOpenError||je.resolve().then(mr),fr&&pr(mr);else if(xr.onReadyBeingFired)xr.onReadyBeingFired.push(mr),fr&&pr(mr);else{pr(mr);const Er=this;fr||pr(function vr(){Er.on.ready.unsubscribe(mr),Er.on.ready.unsubscribe(vr)})}})}),this.Collection=(hr=this,It(Vt.prototype,function(pr,mr){this.db=hr;let fr=At,xr=null;if(mr)try{fr=mr()}catch(yr){xr=yr}const Er=pr._ctx,vr=Er.table,gr=vr.hook.reading.fire;this._ctx={table:vr,index:Er.index,isPrimKey:!Er.index||vr.schema.primKey.keyPath&&Er.index===vr.schema.primKey.name,range:fr,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:xr,or:Er.or,valueMapper:gr!==te?gr:null}})),this.Table=function(pr){return It(jt.prototype,function(mr,fr,xr){this.db=pr,this._tx=xr,this.name=mr,this.schema=fr,this.hook=pr._allTables[mr]?pr._allTables[mr].hook:Dt(null,{creating:[se,ee],reading:[ne,te],updating:[oe,ee],deleting:[ie,ee]})})}(this),this.Transaction=function(pr){return It(an.prototype,function(mr,fr,xr,Er,vr){this.db=pr,this.mode=mr,this.storeNames=fr,this.schema=xr,this.chromeTransactionDurability=Er,this.idbtrans=null,this.on=Dt(this,"complete","error","abort"),this.parent=vr||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new je((gr,yr)=>{this._resolve=gr,this._reject=yr}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},gr=>{var yr=this.active;return this.active=!1,this.on.error.fire(gr),this.parent?this.parent._reject(gr):yr&&this.idbtrans&&this.idbtrans.abort(),ft(gr)})})}(this),this.Version=function(pr){return It(On.prototype,function(mr){this.db=pr,this._cfg={version:mr,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(pr){return It(en.prototype,function(mr,fr,xr){this.db=pr,this._ctx={table:mr,index:fr===":id"?null:fr,or:xr};const Er=pr._deps.indexedDB;if(!Er)throw new X.MissingAPI;this._cmp=this._ascending=Er.cmp.bind(Er),this._descending=(vr,gr)=>Er.cmp(gr,vr),this._max=(vr,gr)=>Er.cmp(vr,gr)>0?vr:gr,this._min=(vr,gr)=>Er.cmp(vr,gr)<0?vr:gr,this._IDBKeyRange=pr._deps.IDBKeyRange})}(this),this.on("versionchange",pr=>{pr.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",pr=>{!pr.newVersion||pr.newVersion<pr.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${pr.oldVersion/10}`)}),this._maxKey=hn(lr.IDBKeyRange),this._createTransaction=(pr,mr,fr,xr)=>new this.Transaction(pr,mr,fr,this._options.chromeTransactionDurability,xr),this._fireOnBlocked=pr=>{this.on("blocked").fire(pr),_t.filter(mr=>mr.name===this.name&&mr!==this&&!mr._state.vcFired).map(mr=>mr.on("versionchange").fire(pr))},this.use(Fn),this.use(Nn),this.use(Qn),this.use($n),this.vip=Object.create(this,{_vip:{value:!0}}),ur.forEach(pr=>pr(this))}version(or){if(isNaN(or)||or<.1)throw new X.Type("Given version is not a positive number");if(or=Math.round(10*or)/10,this.idbdb||this._state.isBeingOpened)throw new X.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,or);const lr=this._versions;var cr=lr.filter(ur=>ur._cfg.version===or)[0];return cr||(cr=new this.Version(or),lr.push(cr),lr.sort(_n),cr.stores({}),this._state.autoSchema=!1,cr)}_whenReady(or){return this.idbdb&&(this._state.openComplete||Oe.letThrough||this._vip)?or():new je((lr,cr)=>{if(this._state.openComplete)return cr(new X.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void cr(new X.DatabaseClosed);this.open().catch(ee)}this._state.dbReadyPromise.then(lr,cr)}).then(or)}use({stack:or,create:lr,level:cr,name:ur}){ur&&this.unuse({stack:or,name:ur});const dr=this._middlewares[or]||(this._middlewares[or]=[]);return dr.push({stack:or,create:lr,level:cr??10,name:ur}),dr.sort((hr,pr)=>hr.level-pr.level),this}unuse({stack:or,name:lr,create:cr}){return or&&this._middlewares[or]&&(this._middlewares[or]=this._middlewares[or].filter(ur=>cr?ur.create!==cr:!!lr&&ur.name!==lr)),this}open(){return Dn(this)}_close(){const or=this._state,lr=_t.indexOf(this);if(lr>=0&&_t.splice(lr,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}or.dbReadyPromise=new je(cr=>{or.dbReadyResolve=cr}),or.openCanceller=new je((cr,ur)=>{or.cancelOpen=ur})}close(){this._close();const or=this._state;this._options.autoOpen=!1,or.dbOpenError=new X.DatabaseClosed,or.isBeingOpened&&or.cancelOpen(or.dbOpenError)}delete(){const or=arguments.length>0,lr=this._state;return new je((cr,ur)=>{const dr=()=>{this.close();var hr=this._deps.indexedDB.deleteDatabase(this.name);hr.onsuccess=Ye(()=>{(function({indexedDB:pr,IDBKeyRange:mr},fr){!An(pr)&&fr!==Pt&&Sn(pr,mr).delete(fr).catch(ee)})(this._deps,this.name),cr()}),hr.onerror=tn(ur),hr.onblocked=this._fireOnBlocked};if(or)throw new X.InvalidArgument("Arguments not allowed in db.delete()");lr.isBeingOpened?lr.dbReadyPromise.then(dr):dr()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const or=this._state.dbOpenError;return or&&or.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return t(this._allTables).map(or=>this._allTables[or])}transaction(){const or=Bn.apply(this,arguments);return this._transaction.apply(this,or)}_transaction(or,lr,cr){let ur=Oe.trans;ur&&ur.db===this&&or.indexOf("!")===-1||(ur=null);const dr=or.indexOf("?")!==-1;let hr,pr;or=or.replace("!","").replace("?","");try{if(pr=lr.map(fr=>{var xr=fr instanceof this.Table?fr.name:fr;if(typeof xr!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return xr}),or=="r"||or===Kt)hr=Kt;else{if(or!="rw"&&or!=Ot)throw new X.InvalidArgument("Invalid transaction mode: "+or);hr=Ot}if(ur){if(ur.mode===Kt&&hr===Ot){if(!dr)throw new X.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");ur=null}ur&&pr.forEach(fr=>{if(ur&&ur.storeNames.indexOf(fr)===-1){if(!dr)throw new X.SubTransaction("Table "+fr+" not included in parent transaction.");ur=null}}),dr&&ur&&!ur.active&&(ur=null)}}catch(fr){return ur?ur._promise(null,(xr,Er)=>{Er(fr)}):ft(fr)}const mr=Tn.bind(null,this,hr,pr,ur,cr);return ur?ur._promise(hr,mr,"lock"):Oe.trans?at(Oe.transless,()=>this._whenReady(mr)):this._whenReady(mr)}table(or){if(!o(this._allTables,or))throw new X.InvalidTable(`Table ${or} does not exist`);return this._allTables[or]}}const Jn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Zn{constructor(or){this._subscribe=or}subscribe(or,lr,cr){return this._subscribe(or&&typeof or!="function"?or:{next:or,error:lr,complete:cr})}[Jn](){return this}}function er(ar,or){return t(or).forEach(lr=>{Wn(ar[lr]||(ar[lr]=new Ln),or[lr])}),ar}function tr(ar){let or,lr=!1;const cr=new Zn(ur=>{const dr=T(ar);let hr=!1,pr={},mr={};const fr={get closed(){return hr},unsubscribe:()=>{hr=!0,on.storagemutated.unsubscribe(gr)}};ur.start&&ur.start(fr);let xr=!1,Er=!1;function vr(){return t(mr).some(br=>pr[br]&&Yn(pr[br],mr[br]))}const gr=br=>{er(pr,br),vr()&&yr()},yr=()=>{if(xr||hr)return;pr={};const br={},_r=function(jr){dr&&et();const wr=()=>Ze(ar,{subscr:jr,trans:null}),Sr=Oe.trans?at(Oe.transless,wr):wr();return dr&&Sr.then(tt,tt),Sr}(br);Er||(on(rn,gr),Er=!0),xr=!0,Promise.resolve(_r).then(jr=>{lr=!0,or=jr,xr=!1,hr||(vr()?yr():(pr={},mr=br,ur.next&&ur.next(jr)))},jr=>{xr=!1,lr=!1,ur.error&&ur.error(jr),fr.unsubscribe()})};return yr(),fr});return cr.hasValue=()=>lr,cr.getValue=()=>or,cr}let nr;try{nr={indexedDB:e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:e.IDBKeyRange||e.webkitIDBKeyRange}}catch{nr={indexedDB:null,IDBKeyRange:null}}const rr=Xn;function sr(ar){let or=ir;try{ir=!0,on.storagemutated.fire(ar)}finally{ir=or}}a(rr,{...Z,delete:ar=>new rr(ar,{addons:[]}).delete(),exists:ar=>new rr(ar,{addons:[]}).open().then(or=>(or.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(ar){try{return function({indexedDB:or,IDBKeyRange:lr}){return An(or)?Promise.resolve(or.databases()).then(cr=>cr.map(ur=>ur.name).filter(ur=>ur!==Pt)):Sn(or,lr).toCollection().primaryKeys()}(rr.dependencies).then(ar)}catch{return ft(new X.MissingAPI)}},defineClass:()=>function(ar){r$1(this,ar)},ignoreTransaction:ar=>Oe.trans?at(Oe.transless,ar):ar(),vip:Cn,async:function(ar){return function(){try{var or=In(ar.apply(this,arguments));return or&&typeof or.then=="function"?or:je.resolve(or)}catch(lr){return ft(lr)}}},spawn:function(ar,or,lr){try{var cr=In(ar.apply(lr,or||[]));return cr&&typeof cr.then=="function"?cr:je.resolve(cr)}catch(ur){return ft(ur)}},currentTransaction:{get:()=>Oe.trans||null},waitFor:function(ar,or){const lr=je.resolve(typeof ar=="function"?rr.ignoreTransaction(ar):ar).timeout(or||6e4);return Oe.trans?Oe.trans.waitFor(lr):lr},Promise:je,debug:{get:()=>R,set:ar=>{F(ar,ar==="dexie"?()=>!0:Et)}},derive:c,extend:r$1,props:a,override:y,Events:Dt,on,liveQuery:tr,extendObservabilitySet:er,getByKeyPath:b,setByKeyPath:_,delByKeyPath:function(ar,or){typeof or=="string"?_(ar,or,void 0):"length"in or&&[].map.call(or,function(lr){_(ar,lr,void 0)})},shallowClone:w,deepClone:O,getObjectDiff:Mn,cmp:$t,asap:v,minKey:vt,addons:[],connections:_t,errnames:H,dependencies:nr,semVer:yt,version:yt.split(".").map(ar=>parseInt(ar)).reduce((ar,or,lr)=>ar+or/Math.pow(10,2*lr))}),rr.maxKey=hn(rr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(on(rn,ar=>{if(!ir){let or;wt?(or=document.createEvent("CustomEvent"),or.initCustomEvent(sn,!0,!0,ar)):or=new CustomEvent(sn,{detail:ar}),ir=!0,dispatchEvent(or),ir=!1}}),addEventListener(sn,({detail:ar})=>{ir||sr(ar)}));let ir=!1;if(typeof BroadcastChannel<"u"){const ar=new BroadcastChannel(sn);typeof ar.unref=="function"&&ar.unref(),on(rn,or=>{ir||ar.postMessage(or)}),ar.onmessage=or=>{or.data&&sr(or.data)}}else if(typeof self<"u"&&typeof navigator<"u"){on(rn,or=>{try{ir||(typeof localStorage<"u"&&localStorage.setItem(sn,JSON.stringify({trig:Math.random(),changedParts:or})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(lr=>lr.postMessage({type:sn,changedParts:or})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",or=>{if(or.key===sn){const lr=JSON.parse(or.newValue);lr&&sr(lr.changedParts)}});const ar=self.document&&navigator.serviceWorker;ar&&ar.addEventListener("message",function({data:or}){or&&or.type===sn&&sr(or.changedParts)})}je.rejectionMapper=function(ar,or){if(!ar||ar instanceof W||ar instanceof TypeError||ar instanceof SyntaxError||!ar.name||!J[ar.name])return ar;var lr=new J[ar.name](or||ar.message,ar);return"stack"in ar&&l(lr,"stack",{get:function(){return this.inner.stack}}),lr},F(R,Et);class HairMakeupDB extends Xn{constructor(){super("HairMakeupProDB");io(this,"projects");io(this,"scenes");io(this,"characters");io(this,"looks");io(this,"sceneCaptures");io(this,"photoBlobs");io(this,"storeBackups");this.version(1).stores({projects:"id, name, createdAt, updatedAt",scenes:"id, sceneNumber, slugline, isComplete",characters:"id, name",looks:"id, characterId, name",sceneCaptures:"id, sceneId, characterId, lookId, capturedAt",photos:"id, capturedAt, angle"}),this.version(2).stores({projects:"id, updatedAt",scenes:"id, sceneNumber, slugline, isComplete",characters:"id, name",looks:"id, characterId, name",sceneCaptures:"id, projectId, sceneId, characterId, updatedAt",photoBlobs:"id, capturedAt, angle",storeBackups:"id, updatedAt",photos:null}).upgrade(async()=>{console.log("Migrating database to version 2 with blob storage")})}}const db=new HairMakeupDB;async function savePhotoBlob(ar,or,lr,cr){return await db.photoBlobs.put({id:ar,blob:or,thumbnail:lr,capturedAt:new Date,angle:cr}),ar}async function getPhotoBlob(ar){return await db.photoBlobs.get(ar)}async function saveStoreBackup(ar,or){await db.storeBackups.put({id:ar,state:or,updatedAt:new Date})}async function getStoreBackup(ar){const or=await db.storeBackups.get(ar);return or==null?void 0:or.state}const debounceTimers={},pendingWrites={},DEBOUNCE_DELAY=500,INDEXEDDB_STORES=new Set(["hair-makeup-pro-storage","hair-makeup-callsheets","hair-makeup-schedule","hair-makeup-timesheet-storage","hair-makeup-budget"]);function debouncedWrite(ar,or,lr){pendingWrites[ar]=or,debounceTimers[ar]&&clearTimeout(debounceTimers[ar]),debounceTimers[ar]=setTimeout(async()=>{const cr=pendingWrites[ar];delete pendingWrites[ar],delete debounceTimers[ar];try{await lr(ar,cr)}catch(ur){console.error(`Failed to write store ${ar}:`,ur)}},DEBOUNCE_DELAY)}async function flushPendingWrites(){const ar=[];for(const[or,lr]of Object.entries(pendingWrites))if(debounceTimers[or]&&(clearTimeout(debounceTimers[or]),delete debounceTimers[or]),INDEXEDDB_STORES.has(or))ar.push(saveStoreBackup(or,lr).catch(cr=>console.error(`Failed to flush store ${or}:`,cr)));else try{localStorage.setItem(or,JSON.stringify(lr))}catch(cr){console.error(`Failed to flush store ${or} to localStorage:`,cr)}Object.keys(pendingWrites).forEach(or=>delete pendingWrites[or]),await Promise.all(ar)}function createHybridStorage(ar){const or=INDEXEDDB_STORES.has(ar);return{getItem:async lr=>{if(or)try{await db.open();const cr=await getStoreBackup(lr);if(cr)return cr;const ur=localStorage.getItem(lr);return ur?JSON.parse(ur):null}catch(cr){console.error(`Failed to read store ${lr} from IndexedDB:`,cr);const ur=localStorage.getItem(lr);return ur?JSON.parse(ur):null}else{const cr=localStorage.getItem(lr);return cr?JSON.parse(cr):null}},setItem:(lr,cr)=>{or?debouncedWrite(lr,cr,async(ur,dr)=>{try{localStorage.setItem(ur,JSON.stringify(dr))}catch{}await saveStoreBackup(ur,dr)}):debouncedWrite(lr,cr,async(ur,dr)=>{localStorage.setItem(ur,JSON.stringify(dr))})},removeItem:async lr=>{if(debounceTimers[lr]&&(clearTimeout(debounceTimers[lr]),delete debounceTimers[lr]),delete pendingWrites[lr],or)try{await db.storeBackups.delete(lr)}catch(cr){console.error(`Failed to remove store ${lr} from IndexedDB:`,cr)}localStorage.removeItem(lr)}}}async function migrateToIndexedDB(){const ar=[],or=[];await db.open();for(const lr of INDEXEDDB_STORES)try{const cr=localStorage.getItem(lr);if(cr&&!await getStoreBackup(lr)){const dr=JSON.parse(cr);await saveStoreBackup(lr,dr),ar.push(lr),localStorage.removeItem(lr)}}catch(cr){console.error(`Failed to migrate store ${lr}:`,cr),or.push(lr)}return{migrated:ar,errors:or}}typeof window<"u"&&(window.addEventListener("beforeunload",()=>{for(const[ar,or]of Object.entries(pendingWrites))try{localStorage.setItem(ar,JSON.stringify(or))}catch{}}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&flushPendingWrites().catch(()=>{})}));function commonjsRequire(ar){throw new Error('Could not dynamically require "'+ar+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports$1){(function(or,lr){module.exports=or.pdfjsLib=lr()})(globalThis,()=>(()=>{var __webpack_modules__=[,(ar,or)=>{var no;Object.defineProperty(or,"__esModule",{value:!0}),or.VerbosityLevel=or.Util=or.UnknownErrorException=or.UnexpectedResponseException=or.TextRenderingMode=or.RenderingIntentFlag=or.PromiseCapability=or.PermissionFlag=or.PasswordResponses=or.PasswordException=or.PageActionEventType=or.OPS=or.MissingPDFException=or.MAX_IMAGE_SIZE_TO_CACHE=or.LINE_FACTOR=or.LINE_DESCENT_FACTOR=or.InvalidPDFException=or.ImageKind=or.IDENTITY_MATRIX=or.FormatError=or.FeatureTest=or.FONT_IDENTITY_MATRIX=or.DocumentActionEventType=or.CMapCompressionType=or.BaseException=or.BASELINE_FACTOR=or.AnnotationType=or.AnnotationReplyType=or.AnnotationPrefix=or.AnnotationMode=or.AnnotationFlag=or.AnnotationFieldFlag=or.AnnotationEditorType=or.AnnotationEditorPrefix=or.AnnotationEditorParamsType=or.AnnotationBorderStyleType=or.AnnotationActionEventType=or.AbortException=void 0,or.assert=Ur,or.bytesToString=ns,or.createValidAbsoluteUrl=es,or.getModificationDate=Bs,or.getUuid=xa,or.getVerbosityLevel=Gr,or.info=Zr,or.isArrayBuffer=vs,or.isArrayEqual=Hs,or.isNodeJS=void 0,or.normalizeUnicode=Vs,or.objectFromMap=Ds,or.objectSize=Es,or.setVerbosityLevel=Kr,or.shadow=Ir,or.string32=bs,or.stringToBytes=fs,or.stringToPDFString=ys,or.stringToUTF8String=_s,or.unreachable=os,or.utf8StringToString=Ss,or.warn=Jr;const lr=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");or.isNodeJS=lr;const cr=[1,0,0,1,0,0];or.IDENTITY_MATRIX=cr;const ur=[.001,0,0,.001,0,0];or.FONT_IDENTITY_MATRIX=ur;const dr=1e7;or.MAX_IMAGE_SIZE_TO_CACHE=dr;const hr=1.35;or.LINE_FACTOR=hr;const pr=.35;or.LINE_DESCENT_FACTOR=pr;const mr=pr/hr;or.BASELINE_FACTOR=mr;const fr={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};or.RenderingIntentFlag=fr;const xr={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};or.AnnotationMode=xr;const Er="pdfjs_internal_editor_";or.AnnotationEditorPrefix=Er;const vr={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};or.AnnotationEditorType=vr;const gr={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};or.AnnotationEditorParamsType=gr;const yr={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};or.PermissionFlag=yr;const br={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};or.TextRenderingMode=br;const _r={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};or.ImageKind=_r;const jr={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};or.AnnotationType=jr;const wr={GROUP:"Group",REPLY:"R"};or.AnnotationReplyType=wr;const Sr={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};or.AnnotationFlag=Sr;const Tr={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};or.AnnotationFieldFlag=Tr;const Rr={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};or.AnnotationBorderStyleType=Rr;const Nr={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};or.AnnotationActionEventType=Nr;const Cr={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};or.DocumentActionEventType=Cr;const kr={O:"PageOpen",C:"PageClose"};or.PageActionEventType=kr;const Ar={ERRORS:0,WARNINGS:1,INFOS:5};or.VerbosityLevel=Ar;const Or={NONE:0,BINARY:1};or.CMapCompressionType=Or;const Lr={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};or.OPS=Lr;const Fr={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};or.PasswordResponses=Fr;let Hr=Ar.WARNINGS;function Kr(Us){Number.isInteger(Us)&&(Hr=Us)}function Gr(){return Hr}function Zr(Us){Hr>=Ar.INFOS&&console.log(`Info: ${Us}`)}function Jr(Us){Hr>=Ar.WARNINGS&&console.log(`Warning: ${Us}`)}function os(Us){throw new Error(Us)}function Ur(Us,Cs){Us||os(Cs)}function Vr(Us){switch(Us==null?void 0:Us.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function es(Us,Cs=null,Ts=null){if(!Us)return null;try{if(Ts&&typeof Us=="string"){if(Ts.addDefaultProtocol&&Us.startsWith("www.")){const to=Us.match(/\./g);(to==null?void 0:to.length)>=2&&(Us=`http://${Us}`)}if(Ts.tryConvertEncoding)try{Us=_s(Us)}catch{}}const qs=Cs?new URL(Us,Cs):new URL(Us);if(Vr(qs))return qs}catch{}return null}function Ir(Us,Cs,Ts,qs=!1){return Object.defineProperty(Us,Cs,{value:Ts,enumerable:!qs,configurable:!0,writable:!1}),Ts}const Dr=function(){function Cs(Ts,qs){this.constructor===Cs&&os("Cannot initialize BaseException."),this.message=Ts,this.name=qs}return Cs.prototype=new Error,Cs.constructor=Cs,Cs}();or.BaseException=Dr;class Pr extends Dr{constructor(Cs,Ts){super(Cs,"PasswordException"),this.code=Ts}}or.PasswordException=Pr;class Mr extends Dr{constructor(Cs,Ts){super(Cs,"UnknownErrorException"),this.details=Ts}}or.UnknownErrorException=Mr;class Br extends Dr{constructor(Cs){super(Cs,"InvalidPDFException")}}or.InvalidPDFException=Br;class Xr extends Dr{constructor(Cs){super(Cs,"MissingPDFException")}}or.MissingPDFException=Xr;class Wr extends Dr{constructor(Cs,Ts){super(Cs,"UnexpectedResponseException"),this.status=Ts}}or.UnexpectedResponseException=Wr;class ss extends Dr{constructor(Cs){super(Cs,"FormatError")}}or.FormatError=ss;class ds extends Dr{constructor(Cs){super(Cs,"AbortException")}}or.AbortException=ds;function ns(Us){(typeof Us!="object"||(Us==null?void 0:Us.length)===void 0)&&os("Invalid argument for bytesToString");const Cs=Us.length,Ts=8192;if(Cs<Ts)return String.fromCharCode.apply(null,Us);const qs=[];for(let to=0;to<Cs;to+=Ts){const eo=Math.min(to+Ts,Cs),xs=Us.subarray(to,eo);qs.push(String.fromCharCode.apply(null,xs))}return qs.join("")}function fs(Us){typeof Us!="string"&&os("Invalid argument for stringToBytes");const Cs=Us.length,Ts=new Uint8Array(Cs);for(let qs=0;qs<Cs;++qs)Ts[qs]=Us.charCodeAt(qs)&255;return Ts}function bs(Us){return String.fromCharCode(Us>>24&255,Us>>16&255,Us>>8&255,Us&255)}function Es(Us){return Object.keys(Us).length}function Ds(Us){const Cs=Object.create(null);for(const[Ts,qs]of Us)Cs[Ts]=qs;return Cs}function gs(){const Us=new Uint8Array(4);return Us[0]=1,new Uint32Array(Us.buffer,0,1)[0]===1}function as(){try{return new Function(""),!0}catch{return!1}}class qr{static get isLittleEndian(){return Ir(this,"isLittleEndian",gs())}static get isEvalSupported(){return Ir(this,"isEvalSupported",as())}static get isOffscreenCanvasSupported(){return Ir(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?Ir(this,"platform",{isWin:!1,isMac:!1}):Ir(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var Cs,Ts;return Ir(this,"isCSSRoundSupported",(Ts=(Cs=globalThis.CSS)==null?void 0:Cs.supports)==null?void 0:Ts.call(Cs,"width: round(1.5px, 1px)"))}}or.FeatureTest=qr;const ts=[...Array(256).keys()].map(Us=>Us.toString(16).padStart(2,"0"));class Yr{static makeHexColor(Cs,Ts,qs){return`#${ts[Cs]}${ts[Ts]}${ts[qs]}`}static scaleMinMax(Cs,Ts){let qs;Cs[0]?(Cs[0]<0&&(qs=Ts[0],Ts[0]=Ts[1],Ts[1]=qs),Ts[0]*=Cs[0],Ts[1]*=Cs[0],Cs[3]<0&&(qs=Ts[2],Ts[2]=Ts[3],Ts[3]=qs),Ts[2]*=Cs[3],Ts[3]*=Cs[3]):(qs=Ts[0],Ts[0]=Ts[2],Ts[2]=qs,qs=Ts[1],Ts[1]=Ts[3],Ts[3]=qs,Cs[1]<0&&(qs=Ts[2],Ts[2]=Ts[3],Ts[3]=qs),Ts[2]*=Cs[1],Ts[3]*=Cs[1],Cs[2]<0&&(qs=Ts[0],Ts[0]=Ts[1],Ts[1]=qs),Ts[0]*=Cs[2],Ts[1]*=Cs[2]),Ts[0]+=Cs[4],Ts[1]+=Cs[4],Ts[2]+=Cs[5],Ts[3]+=Cs[5]}static transform(Cs,Ts){return[Cs[0]*Ts[0]+Cs[2]*Ts[1],Cs[1]*Ts[0]+Cs[3]*Ts[1],Cs[0]*Ts[2]+Cs[2]*Ts[3],Cs[1]*Ts[2]+Cs[3]*Ts[3],Cs[0]*Ts[4]+Cs[2]*Ts[5]+Cs[4],Cs[1]*Ts[4]+Cs[3]*Ts[5]+Cs[5]]}static applyTransform(Cs,Ts){const qs=Cs[0]*Ts[0]+Cs[1]*Ts[2]+Ts[4],to=Cs[0]*Ts[1]+Cs[1]*Ts[3]+Ts[5];return[qs,to]}static applyInverseTransform(Cs,Ts){const qs=Ts[0]*Ts[3]-Ts[1]*Ts[2],to=(Cs[0]*Ts[3]-Cs[1]*Ts[2]+Ts[2]*Ts[5]-Ts[4]*Ts[3])/qs,eo=(-Cs[0]*Ts[1]+Cs[1]*Ts[0]+Ts[4]*Ts[1]-Ts[5]*Ts[0])/qs;return[to,eo]}static getAxialAlignedBoundingBox(Cs,Ts){const qs=this.applyTransform(Cs,Ts),to=this.applyTransform(Cs.slice(2,4),Ts),eo=this.applyTransform([Cs[0],Cs[3]],Ts),xs=this.applyTransform([Cs[2],Cs[1]],Ts);return[Math.min(qs[0],to[0],eo[0],xs[0]),Math.min(qs[1],to[1],eo[1],xs[1]),Math.max(qs[0],to[0],eo[0],xs[0]),Math.max(qs[1],to[1],eo[1],xs[1])]}static inverseTransform(Cs){const Ts=Cs[0]*Cs[3]-Cs[1]*Cs[2];return[Cs[3]/Ts,-Cs[1]/Ts,-Cs[2]/Ts,Cs[0]/Ts,(Cs[2]*Cs[5]-Cs[4]*Cs[3])/Ts,(Cs[4]*Cs[1]-Cs[5]*Cs[0])/Ts]}static singularValueDecompose2dScale(Cs){const Ts=[Cs[0],Cs[2],Cs[1],Cs[3]],qs=Cs[0]*Ts[0]+Cs[1]*Ts[2],to=Cs[0]*Ts[1]+Cs[1]*Ts[3],eo=Cs[2]*Ts[0]+Cs[3]*Ts[2],xs=Cs[2]*Ts[1]+Cs[3]*Ts[3],Os=(qs+xs)/2,zs=Math.sqrt((qs+xs)**2-4*(qs*xs-eo*to))/2,Zs=Os+zs||1,ga=Os-zs||1;return[Math.sqrt(Zs),Math.sqrt(ga)]}static normalizeRect(Cs){const Ts=Cs.slice(0);return Cs[0]>Cs[2]&&(Ts[0]=Cs[2],Ts[2]=Cs[0]),Cs[1]>Cs[3]&&(Ts[1]=Cs[3],Ts[3]=Cs[1]),Ts}static intersect(Cs,Ts){const qs=Math.max(Math.min(Cs[0],Cs[2]),Math.min(Ts[0],Ts[2])),to=Math.min(Math.max(Cs[0],Cs[2]),Math.max(Ts[0],Ts[2]));if(qs>to)return null;const eo=Math.max(Math.min(Cs[1],Cs[3]),Math.min(Ts[1],Ts[3])),xs=Math.min(Math.max(Cs[1],Cs[3]),Math.max(Ts[1],Ts[3]));return eo>xs?null:[qs,eo,to,xs]}static bezierBoundingBox(Cs,Ts,qs,to,eo,xs,Os,zs){const Zs=[],ga=[[],[]];let Ys,ms,cs,js,Ls,Is,$s,Ws;for(let us=0;us<2;++us){if(us===0?(ms=6*Cs-12*qs+6*eo,Ys=-3*Cs+9*qs-9*eo+3*Os,cs=3*qs-3*Cs):(ms=6*Ts-12*to+6*xs,Ys=-3*Ts+9*to-9*xs+3*zs,cs=3*to-3*Ts),Math.abs(Ys)<1e-12){if(Math.abs(ms)<1e-12)continue;js=-cs/ms,0<js&&js<1&&Zs.push(js);continue}$s=ms*ms-4*cs*Ys,Ws=Math.sqrt($s),!($s<0)&&(Ls=(-ms+Ws)/(2*Ys),0<Ls&&Ls<1&&Zs.push(Ls),Is=(-ms-Ws)/(2*Ys),0<Is&&Is<1&&Zs.push(Is))}let _i=Zs.length,Qs;const zr=_i;for(;_i--;)js=Zs[_i],Qs=1-js,ga[0][_i]=Qs*Qs*Qs*Cs+3*Qs*Qs*js*qs+3*Qs*js*js*eo+js*js*js*Os,ga[1][_i]=Qs*Qs*Qs*Ts+3*Qs*Qs*js*to+3*Qs*js*js*xs+js*js*js*zs;return ga[0][zr]=Cs,ga[1][zr]=Ts,ga[0][zr+1]=Os,ga[1][zr+1]=zs,ga[0].length=ga[1].length=zr+2,[Math.min(...ga[0]),Math.min(...ga[1]),Math.max(...ga[0]),Math.max(...ga[1])]}}or.Util=Yr;const hs=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function ys(Us){if(Us[0]>=""){let Ts;if(Us[0]===""&&Us[1]===""?Ts="utf-16be":Us[0]===""&&Us[1]===""?Ts="utf-16le":Us[0]===""&&Us[1]===""&&Us[2]===""&&(Ts="utf-8"),Ts)try{const qs=new TextDecoder(Ts,{fatal:!0}),to=fs(Us);return qs.decode(to)}catch(qs){Jr(`stringToPDFString: "${qs}".`)}}const Cs=[];for(let Ts=0,qs=Us.length;Ts<qs;Ts++){const to=hs[Us.charCodeAt(Ts)];Cs.push(to?String.fromCharCode(to):Us.charAt(Ts))}return Cs.join("")}function _s(Us){return decodeURIComponent(escape(Us))}function Ss(Us){return unescape(encodeURIComponent(Us))}function vs(Us){return typeof Us=="object"&&(Us==null?void 0:Us.byteLength)!==void 0}function Hs(Us,Cs){if(Us.length!==Cs.length)return!1;for(let Ts=0,qs=Us.length;Ts<qs;Ts++)if(Us[Ts]!==Cs[Ts])return!1;return!0}function Bs(Us=new Date){return[Us.getUTCFullYear().toString(),(Us.getUTCMonth()+1).toString().padStart(2,"0"),Us.getUTCDate().toString().padStart(2,"0"),Us.getUTCHours().toString().padStart(2,"0"),Us.getUTCMinutes().toString().padStart(2,"0"),Us.getUTCSeconds().toString().padStart(2,"0")].join("")}class na{constructor(){Ns(this,no,!1);this.promise=new Promise((Cs,Ts)=>{this.resolve=qs=>{ks(this,no,!0),Cs(qs)},this.reject=qs=>{ks(this,no,!0),Ts(qs)}})}get settled(){return $r(this,no)}}no=new WeakMap,or.PromiseCapability=na;let Js=null,$a=null;function Vs(Us){return Js||(Js=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,$a=new Map([["","t"]])),Us.replaceAll(Js,(Cs,Ts,qs)=>Ts?Ts.normalize("NFKC"):$a.get(qs))}function xa(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const Us=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(Us);else for(let Cs=0;Cs<32;Cs++)Us[Cs]=Math.floor(Math.random()*255);return ns(Us)}const ro="pdfjs_internal_id_";or.AnnotationPrefix=ro},(__unused_webpack_module,exports$1,__w_pdfjs_require__)=>{var ar,lr,cr,ur,fo,Ao,pr,mr,fr,xr,Er,vr,gr,yr,br,Po,jr,wr,Xo,Tr,Rr;Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.RenderTask=exports$1.PDFWorkerUtil=exports$1.PDFWorker=exports$1.PDFPageProxy=exports$1.PDFDocumentProxy=exports$1.PDFDocumentLoadingTask=exports$1.PDFDataRangeTransport=exports$1.LoopbackPort=exports$1.DefaultStandardFontDataFactory=exports$1.DefaultFilterFactory=exports$1.DefaultCanvasFactory=exports$1.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports$1,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports$1.build=void 0,exports$1.getDocument=getDocument,exports$1.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports$1.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports$1.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(Cr){if(typeof Cr=="string"||Cr instanceof URL?Cr={url:Cr}:(0,_util.isArrayBuffer)(Cr)&&(Cr={data:Cr}),typeof Cr!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!Cr.url&&!Cr.data&&!Cr.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const kr=new PDFDocumentLoadingTask,{docId:Ar}=kr,Or=Cr.url?getUrlProp(Cr.url):null,Lr=Cr.data?getDataProp(Cr.data):null,Fr=Cr.httpHeaders||null,Hr=Cr.withCredentials===!0,Kr=Cr.password??null,Gr=Cr.range instanceof PDFDataRangeTransport?Cr.range:null,Zr=Number.isInteger(Cr.rangeChunkSize)&&Cr.rangeChunkSize>0?Cr.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Jr=Cr.worker instanceof PDFWorker?Cr.worker:null;const os=Cr.verbosity,Ur=typeof Cr.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(Cr.docBaseUrl)?Cr.docBaseUrl:null,Vr=typeof Cr.cMapUrl=="string"?Cr.cMapUrl:null,es=Cr.cMapPacked!==!1,Ir=Cr.CMapReaderFactory||DefaultCMapReaderFactory,Dr=typeof Cr.standardFontDataUrl=="string"?Cr.standardFontDataUrl:null,Pr=Cr.StandardFontDataFactory||DefaultStandardFontDataFactory,Mr=Cr.stopAtErrors!==!0,Br=Number.isInteger(Cr.maxImageSize)&&Cr.maxImageSize>-1?Cr.maxImageSize:-1,Xr=Cr.isEvalSupported!==!1,Wr=typeof Cr.isOffscreenCanvasSupported=="boolean"?Cr.isOffscreenCanvasSupported:!_util.isNodeJS,ss=Number.isInteger(Cr.canvasMaxAreaInBytes)?Cr.canvasMaxAreaInBytes:-1,ds=typeof Cr.disableFontFace=="boolean"?Cr.disableFontFace:_util.isNodeJS,ns=Cr.fontExtraProperties===!0,fs=Cr.enableXfa===!0,bs=Cr.ownerDocument||globalThis.document,Es=Cr.disableRange===!0,Ds=Cr.disableStream===!0,gs=Cr.disableAutoFetch===!0,as=Cr.pdfBug===!0,qr=Gr?Gr.length:Cr.length??NaN,ts=typeof Cr.useSystemFonts=="boolean"?Cr.useSystemFonts:!_util.isNodeJS&&!ds,Yr=typeof Cr.useWorkerFetch=="boolean"?Cr.useWorkerFetch:Ir===_display_utils.DOMCMapReaderFactory&&Pr===_display_utils.DOMStandardFontDataFactory&&Vr&&Dr&&(0,_display_utils.isValidFetchUrl)(Vr,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(Dr,document.baseURI),hs=Cr.canvasFactory||new DefaultCanvasFactory({ownerDocument:bs}),ys=Cr.filterFactory||new DefaultFilterFactory({docId:Ar,ownerDocument:bs}),_s=null;(0,_util.setVerbosityLevel)(os);const Ss={canvasFactory:hs,filterFactory:ys};if(Yr||(Ss.cMapReaderFactory=new Ir({baseUrl:Vr,isCompressed:es}),Ss.standardFontDataFactory=new Pr({baseUrl:Dr})),!Jr){const Bs={verbosity:os,port:_worker_options.GlobalWorkerOptions.workerPort};Jr=Bs.port?PDFWorker.fromPort(Bs):new PDFWorker(Bs),kr._worker=Jr}const vs={docId:Ar,apiVersion:"3.11.174",data:Lr,password:Kr,disableAutoFetch:gs,rangeChunkSize:Zr,length:qr,docBaseUrl:Ur,enableXfa:fs,evaluatorOptions:{maxImageSize:Br,disableFontFace:ds,ignoreErrors:Mr,isEvalSupported:Xr,isOffscreenCanvasSupported:Wr,canvasMaxAreaInBytes:ss,fontExtraProperties:ns,useSystemFonts:ts,cMapUrl:Yr?Vr:null,standardFontDataUrl:Yr?Dr:null}},Hs={ignoreErrors:Mr,isEvalSupported:Xr,disableFontFace:ds,fontExtraProperties:ns,enableXfa:fs,ownerDocument:bs,disableAutoFetch:gs,pdfBug:as,styleElement:_s};return Jr.promise.then(function(){if(kr.destroyed)throw new Error("Loading aborted");const Bs=_fetchDocument(Jr,vs),na=new Promise(function(Js){let $a;Gr?$a=new _transport_stream.PDFDataTransportStream({length:qr,initialData:Gr.initialData,progressiveDone:Gr.progressiveDone,contentDispositionFilename:Gr.contentDispositionFilename,disableRange:Es,disableStream:Ds},Gr):Lr||($a=(xa=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(xa):(0,_display_utils.isValidFetchUrl)(xa.url)?new _displayFetch_stream.PDFFetchStream(xa):new _displayNetwork.PDFNetworkStream(xa))({url:Or,length:qr,httpHeaders:Fr,withCredentials:Hr,rangeChunkSize:Zr,disableRange:Es,disableStream:Ds})),Js($a)});return Promise.all([Bs,na]).then(function([Js,$a]){if(kr.destroyed)throw new Error("Loading aborted");const Vs=new _message_handler.MessageHandler(Ar,Js,Jr.port),xa=new WorkerTransport(Vs,kr,$a,Hs,Ss);kr._transport=xa,Vs.send("Ready",null)})}).catch(kr._capability.reject),kr}async function _fetchDocument(Cr,kr){if(Cr.destroyed)throw new Error("Worker was destroyed");const Ar=await Cr.messageHandler.sendWithPromise("GetDocRequest",kr,kr.data?[kr.data.buffer]:null);if(Cr.destroyed)throw new Error("Worker was destroyed");return Ar}function getUrlProp(Cr){if(Cr instanceof URL)return Cr.href;try{return new URL(Cr,window.location).href}catch{if(_util.isNodeJS&&typeof Cr=="string")return Cr}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(Cr){if(_util.isNodeJS&&typeof Buffer<"u"&&Cr instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(Cr instanceof Uint8Array&&Cr.byteLength===Cr.buffer.byteLength)return Cr;if(typeof Cr=="string")return(0,_util.stringToBytes)(Cr);if(typeof Cr=="object"&&!isNaN(Cr==null?void 0:Cr.length)||(0,_util.isArrayBuffer)(Cr))return new Uint8Array(Cr);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const or=class or{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${wo(or,ar)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var kr,Ar,Or;this.destroyed=!0;try{(kr=this._worker)!=null&&kr.port&&(this._worker._pendingDestroy=!0),await((Ar=this._transport)==null?void 0:Ar.destroy())}catch(Lr){throw(Or=this._worker)!=null&&Or.port&&delete this._worker._pendingDestroy,Lr}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};ar=new WeakMap,Ns(or,ar,0);let PDFDocumentLoadingTask=or;exports$1.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(kr,Ar,Or=!1,Lr=null){this.length=kr,this.initialData=Ar,this.progressiveDone=Or,this.contentDispositionFilename=Lr,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(kr){this._rangeListeners.push(kr)}addProgressListener(kr){this._progressListeners.push(kr)}addProgressiveReadListener(kr){this._progressiveReadListeners.push(kr)}addProgressiveDoneListener(kr){this._progressiveDoneListeners.push(kr)}onDataRange(kr,Ar){for(const Or of this._rangeListeners)Or(kr,Ar)}onDataProgress(kr,Ar){this._readyCapability.promise.then(()=>{for(const Or of this._progressListeners)Or(kr,Ar)})}onDataProgressiveRead(kr){this._readyCapability.promise.then(()=>{for(const Ar of this._progressiveReadListeners)Ar(kr)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const kr of this._progressiveDoneListeners)kr()})}transportReady(){this._readyCapability.resolve()}requestDataRange(kr,Ar){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports$1.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(kr,Ar){this._pdfInfo=kr,this._transport=Ar,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(Or=>{if(!Or)return Or;const Lr=[];for(const Fr in Or)Lr.push(...Or[Fr]);return Lr}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(kr){return this._transport.getPage(kr)}getPageIndex(kr){return this._transport.getPageIndex(kr)}getDestinations(){return this._transport.getDestinations()}getDestination(kr){return this._transport.getDestination(kr)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(kr=!1){return this._transport.startCleanup(kr||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports$1.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(kr,Ar,Or,Lr=!1){Ns(this,ur);Ns(this,lr,null);Ns(this,cr,!1);this._pageIndex=kr,this._pageInfo=Ar,this._transport=Or,this._stats=Lr?new _display_utils.StatTimer:null,this._pdfBug=Lr,this.commonObjs=Or.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:kr,rotation:Ar=this.rotate,offsetX:Or=0,offsetY:Lr=0,dontFlip:Fr=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:kr,rotation:Ar,offsetX:Or,offsetY:Lr,dontFlip:Fr})}getAnnotations({intent:kr="display"}={}){const Ar=this._transport.getRenderingIntent(kr);return this._transport.getAnnotations(this._pageIndex,Ar.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var kr;return((kr=this._transport._htmlForXfa)==null?void 0:kr.children[this._pageIndex])||null}render({canvasContext:kr,viewport:Ar,intent:Or="display",annotationMode:Lr=_util.AnnotationMode.ENABLE,transform:Fr=null,background:Hr=null,optionalContentConfigPromise:Kr=null,annotationCanvasMap:Gr=null,pageColors:Zr=null,printAnnotationStorage:Jr=null}){var Pr,Mr;(Pr=this._stats)==null||Pr.time("Overall");const os=this._transport.getRenderingIntent(Or,Lr,Jr);ks(this,cr,!1),ws(this,ur,Ao).call(this),Kr||(Kr=this._transport.getOptionalContentConfig());let Ur=this._intentStates.get(os.cacheKey);Ur||(Ur=Object.create(null),this._intentStates.set(os.cacheKey,Ur)),Ur.streamReaderCancelTimeout&&(clearTimeout(Ur.streamReaderCancelTimeout),Ur.streamReaderCancelTimeout=null);const Vr=!!(os.renderingIntent&_util.RenderingIntentFlag.PRINT);Ur.displayReadyCapability||(Ur.displayReadyCapability=new _util.PromiseCapability,Ur.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Mr=this._stats)==null||Mr.time("Page Request"),this._pumpOperatorList(os));const es=Br=>{var Xr,Wr;Ur.renderTasks.delete(Ir),(this._maybeCleanupAfterRender||Vr)&&ks(this,cr,!0),ws(this,ur,fo).call(this,!Vr),Br?(Ir.capability.reject(Br),this._abortOperatorList({intentState:Ur,reason:Br instanceof Error?Br:new Error(Br)})):Ir.capability.resolve(),(Xr=this._stats)==null||Xr.timeEnd("Rendering"),(Wr=this._stats)==null||Wr.timeEnd("Overall")},Ir=new InternalRenderTask({callback:es,params:{canvasContext:kr,viewport:Ar,transform:Fr,background:Hr},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:Gr,operatorList:Ur.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Vr,pdfBug:this._pdfBug,pageColors:Zr});(Ur.renderTasks||(Ur.renderTasks=new Set)).add(Ir);const Dr=Ir.task;return Promise.all([Ur.displayReadyCapability.promise,Kr]).then(([Br,Xr])=>{var Wr;if(this.destroyed){es();return}(Wr=this._stats)==null||Wr.time("Rendering"),Ir.initializeGraphics({transparency:Br,optionalContentConfig:Xr}),Ir.operatorListChanged()}).catch(es),Dr}getOperatorList({intent:kr="display",annotationMode:Ar=_util.AnnotationMode.ENABLE,printAnnotationStorage:Or=null}={}){var Gr;function Lr(){Hr.operatorList.lastChunk&&(Hr.opListReadCapability.resolve(Hr.operatorList),Hr.renderTasks.delete(Kr))}const Fr=this._transport.getRenderingIntent(kr,Ar,Or,!0);let Hr=this._intentStates.get(Fr.cacheKey);Hr||(Hr=Object.create(null),this._intentStates.set(Fr.cacheKey,Hr));let Kr;return Hr.opListReadCapability||(Kr=Object.create(null),Kr.operatorListChanged=Lr,Hr.opListReadCapability=new _util.PromiseCapability,(Hr.renderTasks||(Hr.renderTasks=new Set)).add(Kr),Hr.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Gr=this._stats)==null||Gr.time("Page Request"),this._pumpOperatorList(Fr)),Hr.opListReadCapability.promise}streamTextContent({includeMarkedContent:kr=!1,disableNormalization:Ar=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:kr===!0,disableNormalization:Ar===!0},{highWaterMark:100,size(Lr){return Lr.items.length}})}getTextContent(kr={}){if(this._transport._htmlForXfa)return this.getXfa().then(Or=>_xfa_text.XfaText.textContent(Or));const Ar=this.streamTextContent(kr);return new Promise(function(Or,Lr){function Fr(){Hr.read().then(function({value:Gr,done:Zr}){if(Zr){Or(Kr);return}Object.assign(Kr.styles,Gr.styles),Kr.items.push(...Gr.items),Fr()},Lr)}const Hr=Ar.getReader(),Kr={items:[],styles:Object.create(null)};Fr()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const kr=[];for(const Ar of this._intentStates.values())if(this._abortOperatorList({intentState:Ar,reason:new Error("Page was destroyed."),force:!0}),!Ar.opListReadCapability)for(const Or of Ar.renderTasks)kr.push(Or.completed),Or.cancel();return this.objs.clear(),ks(this,cr,!1),ws(this,ur,Ao).call(this),Promise.all(kr)}cleanup(kr=!1){ks(this,cr,!0);const Ar=ws(this,ur,fo).call(this,!1);return kr&&Ar&&this._stats&&(this._stats=new _display_utils.StatTimer),Ar}_startRenderPage(kr,Ar){var Lr,Fr;const Or=this._intentStates.get(Ar);Or&&((Lr=this._stats)==null||Lr.timeEnd("Page Request"),(Fr=Or.displayReadyCapability)==null||Fr.resolve(kr))}_renderPageChunk(kr,Ar){for(let Or=0,Lr=kr.length;Or<Lr;Or++)Ar.operatorList.fnArray.push(kr.fnArray[Or]),Ar.operatorList.argsArray.push(kr.argsArray[Or]);Ar.operatorList.lastChunk=kr.lastChunk,Ar.operatorList.separateAnnots=kr.separateAnnots;for(const Or of Ar.renderTasks)Or.operatorListChanged();kr.lastChunk&&ws(this,ur,fo).call(this,!0)}_pumpOperatorList({renderingIntent:kr,cacheKey:Ar,annotationStorageSerializable:Or}){const{map:Lr,transfers:Fr}=Or,Kr=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:kr,cacheKey:Ar,annotationStorage:Lr},Fr).getReader(),Gr=this._intentStates.get(Ar);Gr.streamReader=Kr;const Zr=()=>{Kr.read().then(({value:Jr,done:os})=>{if(os){Gr.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Jr,Gr),Zr())},Jr=>{if(Gr.streamReader=null,!this._transport.destroyed){if(Gr.operatorList){Gr.operatorList.lastChunk=!0;for(const os of Gr.renderTasks)os.operatorListChanged();ws(this,ur,fo).call(this,!0)}if(Gr.displayReadyCapability)Gr.displayReadyCapability.reject(Jr);else if(Gr.opListReadCapability)Gr.opListReadCapability.reject(Jr);else throw Jr}})};Zr()}_abortOperatorList({intentState:kr,reason:Ar,force:Or=!1}){if(kr.streamReader){if(kr.streamReaderCancelTimeout&&(clearTimeout(kr.streamReaderCancelTimeout),kr.streamReaderCancelTimeout=null),!Or){if(kr.renderTasks.size>0)return;if(Ar instanceof _display_utils.RenderingCancelledException){let Lr=RENDERING_CANCELLED_TIMEOUT;Ar.extraDelay>0&&Ar.extraDelay<1e3&&(Lr+=Ar.extraDelay),kr.streamReaderCancelTimeout=setTimeout(()=>{kr.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:kr,reason:Ar,force:!0})},Lr);return}}if(kr.streamReader.cancel(new _util.AbortException(Ar.message)).catch(()=>{}),kr.streamReader=null,!this._transport.destroyed){for(const[Lr,Fr]of this._intentStates)if(Fr===kr){this._intentStates.delete(Lr);break}this.cleanup()}}}get stats(){return this._stats}}lr=new WeakMap,cr=new WeakMap,ur=new WeakSet,fo=function(kr=!1){if(ws(this,ur,Ao).call(this),!$r(this,cr)||this.destroyed)return!1;if(kr)return ks(this,lr,setTimeout(()=>{ks(this,lr,null),ws(this,ur,fo).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:Ar,operatorList:Or}of this._intentStates.values())if(Ar.size>0||!Or.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),ks(this,cr,!1),!0},Ao=function(){$r(this,lr)&&(clearTimeout($r(this,lr)),ks(this,lr,null))},exports$1.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Ns(this,pr,new Set);Ns(this,mr,Promise.resolve())}postMessage(kr,Ar){const Or={data:structuredClone(kr,Ar?{transfer:Ar}:null)};$r(this,mr).then(()=>{for(const Lr of $r(this,pr))Lr.call(this,Or)})}addEventListener(kr,Ar){$r(this,pr).add(Ar)}removeEventListener(kr,Ar){$r(this,pr).delete(Ar)}terminate(){$r(this,pr).clear()}}pr=new WeakMap,mr=new WeakMap,exports$1.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports$1.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const Cr=(fr=document==null?void 0:document.currentScript)==null?void 0:fr.src;Cr&&(PDFWorkerUtil.fallbackWorkerSrc=Cr.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(Cr,kr){let Ar;try{if(Ar=new URL(Cr),!Ar.origin||Ar.origin==="null")return!1}catch{return!1}const Or=new URL(kr,Ar);return Ar.origin===Or.origin},PDFWorkerUtil.createCDNWrapper=function(Cr){const kr=`importScripts("${Cr}");`;return URL.createObjectURL(new Blob([kr]))}}const _PDFWorker=class _PDFWorker{constructor({name:Cr=null,port:kr=null,verbosity:Ar=(0,_util.getVerbosityLevel)()}={}){var Or;if(this.name=Cr,this.destroyed=!1,this.verbosity=Ar,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,kr){if((Or=$r(_PDFWorker,xr))!=null&&Or.has(kr))throw new Error("Cannot use more than one PDFWorker per port.");($r(_PDFWorker,xr)||ks(_PDFWorker,xr,new WeakMap)).set(kr,this),this._initializeFromPort(kr);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(Cr){this._port=Cr,this._messageHandler=new _message_handler.MessageHandler("main","worker",Cr),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:Cr}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,Cr)||(Cr=PDFWorkerUtil.createCDNWrapper(new URL(Cr,window.location).href));const kr=new Worker(Cr),Ar=new _message_handler.MessageHandler("main","worker",kr),Or=()=>{kr.removeEventListener("error",Lr),Ar.destroy(),kr.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},Lr=()=>{this._webWorker||Or()};kr.addEventListener("error",Lr),Ar.on("test",Hr=>{if(kr.removeEventListener("error",Lr),this.destroyed){Or();return}Hr?(this._messageHandler=Ar,this._port=kr,this._webWorker=kr,this._readyCapability.resolve(),Ar.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),Ar.destroy(),kr.terminate())}),Ar.on("ready",Hr=>{if(kr.removeEventListener("error",Lr),this.destroyed){Or();return}try{Fr()}catch{this._setupFakeWorker()}});const Fr=()=>{const Hr=new Uint8Array;Ar.send("test",Hr,[Hr.buffer])};Fr();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(Cr=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const kr=new LoopbackPort;this._port=kr;const Ar=`fake${PDFWorkerUtil.fakeWorkerId++}`,Or=new _message_handler.MessageHandler(Ar+"_worker",Ar,kr);Cr.setup(Or,kr);const Lr=new _message_handler.MessageHandler(Ar,Ar+"_worker",kr);this._messageHandler=Lr,this._readyCapability.resolve(),Lr.send("configure",{verbosity:this.verbosity})}).catch(Cr=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${Cr.message}".`))})}destroy(){var Cr;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(Cr=$r(_PDFWorker,xr))==null||Cr.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(Cr){var Ar;if(!(Cr!=null&&Cr.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const kr=(Ar=$r(this,xr))==null?void 0:Ar.get(Cr.port);if(kr){if(kr._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return kr}return new _PDFWorker(Cr)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var Cr;try{return((Cr=globalThis.pdfjsWorker)==null?void 0:Cr.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};xr=new WeakMap,Ns(_PDFWorker,xr);let PDFWorker=_PDFWorker;exports$1.PDFWorker=PDFWorker;class WorkerTransport{constructor(kr,Ar,Or,Lr,Fr){Ns(this,br);Ns(this,Er,new Map);Ns(this,vr,new Map);Ns(this,gr,new Map);Ns(this,yr,null);this.messageHandler=kr,this.loadingTask=Ar,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:Lr.ownerDocument,styleElement:Lr.styleElement}),this._params=Lr,this.canvasFactory=Fr.canvasFactory,this.filterFactory=Fr.filterFactory,this.cMapReaderFactory=Fr.cMapReaderFactory,this.standardFontDataFactory=Fr.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=Or,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(kr,Ar=_util.AnnotationMode.ENABLE,Or=null,Lr=!1){let Fr=_util.RenderingIntentFlag.DISPLAY,Hr=_annotation_storage.SerializableEmpty;switch(kr){case"any":Fr=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":Fr=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${kr}`)}switch(Ar){case _util.AnnotationMode.DISABLE:Fr+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:Fr+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:Fr+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,Hr=(Fr&_util.RenderingIntentFlag.PRINT&&Or instanceof _annotation_storage.PrintAnnotationStorage?Or:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${Ar}`)}return Lr&&(Fr+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:Fr,cacheKey:`${Fr}_${Hr.hash}`,annotationStorageSerializable:Hr}}destroy(){var Or;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(Or=$r(this,yr))==null||Or.reject(new Error("Worker was destroyed during onPassword callback"));const kr=[];for(const Lr of $r(this,vr).values())kr.push(Lr._destroy());$r(this,vr).clear(),$r(this,gr).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const Ar=this.messageHandler.sendWithPromise("Terminate",null);return kr.push(Ar),Promise.all(kr).then(()=>{var Lr;this.commonObjs.clear(),this.fontLoader.clear(),$r(this,Er).clear(),this.filterFactory.destroy(),(Lr=this._networkStream)==null||Lr.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:kr,loadingTask:Ar}=this;kr.on("GetReader",(Or,Lr)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=Fr=>{this._lastProgress={loaded:Fr.loaded,total:Fr.total}},Lr.onPull=()=>{this._fullReader.read().then(function({value:Fr,done:Hr}){if(Hr){Lr.close();return}(0,_util.assert)(Fr instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),Lr.enqueue(new Uint8Array(Fr),1,[Fr])}).catch(Fr=>{Lr.error(Fr)})},Lr.onCancel=Fr=>{this._fullReader.cancel(Fr),Lr.ready.catch(Hr=>{if(!this.destroyed)throw Hr})}}),kr.on("ReaderHeadersReady",Or=>{const Lr=new _util.PromiseCapability,Fr=this._fullReader;return Fr.headersReady.then(()=>{var Hr;(!Fr.isStreamingSupported||!Fr.isRangeSupported)&&(this._lastProgress&&((Hr=Ar.onProgress)==null||Hr.call(Ar,this._lastProgress)),Fr.onProgress=Kr=>{var Gr;(Gr=Ar.onProgress)==null||Gr.call(Ar,{loaded:Kr.loaded,total:Kr.total})}),Lr.resolve({isStreamingSupported:Fr.isStreamingSupported,isRangeSupported:Fr.isRangeSupported,contentLength:Fr.contentLength})},Lr.reject),Lr.promise}),kr.on("GetRangeReader",(Or,Lr)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const Fr=this._networkStream.getRangeReader(Or.begin,Or.end);if(!Fr){Lr.close();return}Lr.onPull=()=>{Fr.read().then(function({value:Hr,done:Kr}){if(Kr){Lr.close();return}(0,_util.assert)(Hr instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),Lr.enqueue(new Uint8Array(Hr),1,[Hr])}).catch(Hr=>{Lr.error(Hr)})},Lr.onCancel=Hr=>{Fr.cancel(Hr),Lr.ready.catch(Kr=>{if(!this.destroyed)throw Kr})}}),kr.on("GetDoc",({pdfInfo:Or})=>{this._numPages=Or.numPages,this._htmlForXfa=Or.htmlForXfa,delete Or.htmlForXfa,Ar._capability.resolve(new PDFDocumentProxy(Or,this))}),kr.on("DocException",function(Or){let Lr;switch(Or.name){case"PasswordException":Lr=new _util.PasswordException(Or.message,Or.code);break;case"InvalidPDFException":Lr=new _util.InvalidPDFException(Or.message);break;case"MissingPDFException":Lr=new _util.MissingPDFException(Or.message);break;case"UnexpectedResponseException":Lr=new _util.UnexpectedResponseException(Or.message,Or.status);break;case"UnknownErrorException":Lr=new _util.UnknownErrorException(Or.message,Or.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}Ar._capability.reject(Lr)}),kr.on("PasswordRequest",Or=>{if(ks(this,yr,new _util.PromiseCapability),Ar.onPassword){const Lr=Fr=>{Fr instanceof Error?$r(this,yr).reject(Fr):$r(this,yr).resolve({password:Fr})};try{Ar.onPassword(Lr,Or.code)}catch(Fr){$r(this,yr).reject(Fr)}}else $r(this,yr).reject(new _util.PasswordException(Or.message,Or.code));return $r(this,yr).promise}),kr.on("DataLoaded",Or=>{var Lr;(Lr=Ar.onProgress)==null||Lr.call(Ar,{loaded:Or.length,total:Or.length}),this.downloadInfoCapability.resolve(Or)}),kr.on("StartRenderPage",Or=>{if(this.destroyed)return;$r(this,vr).get(Or.pageIndex)._startRenderPage(Or.transparency,Or.cacheKey)}),kr.on("commonobj",([Or,Lr,Fr])=>{var Hr;if(!this.destroyed&&!this.commonObjs.has(Or))switch(Lr){case"Font":const Kr=this._params;if("error"in Fr){const Jr=Fr.error;(0,_util.warn)(`Error during font loading: ${Jr}`),this.commonObjs.resolve(Or,Jr);break}const Gr=Kr.pdfBug&&((Hr=globalThis.FontInspector)!=null&&Hr.enabled)?(Jr,os)=>globalThis.FontInspector.fontAdded(Jr,os):null,Zr=new _font_loader.FontFaceObject(Fr,{isEvalSupported:Kr.isEvalSupported,disableFontFace:Kr.disableFontFace,ignoreErrors:Kr.ignoreErrors,inspectFont:Gr});this.fontLoader.bind(Zr).catch(Jr=>kr.sendWithPromise("FontFallback",{id:Or})).finally(()=>{!Kr.fontExtraProperties&&Zr.data&&(Zr.data=null),this.commonObjs.resolve(Or,Zr)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(Or,Fr);break;default:throw new Error(`Got unknown common object type ${Lr}`)}}),kr.on("obj",([Or,Lr,Fr,Hr])=>{var Gr;if(this.destroyed)return;const Kr=$r(this,vr).get(Lr);if(!Kr.objs.has(Or))switch(Fr){case"Image":if(Kr.objs.resolve(Or,Hr),Hr){let Zr;if(Hr.bitmap){const{width:Jr,height:os}=Hr;Zr=Jr*os*4}else Zr=((Gr=Hr.data)==null?void 0:Gr.length)||0;Zr>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Kr._maybeCleanupAfterRender=!0)}break;case"Pattern":Kr.objs.resolve(Or,Hr);break;default:throw new Error(`Got unknown object type ${Fr}`)}}),kr.on("DocProgress",Or=>{var Lr;this.destroyed||(Lr=Ar.onProgress)==null||Lr.call(Ar,{loaded:Or.loaded,total:Or.total})}),kr.on("FetchBuiltInCMap",Or=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(Or):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),kr.on("FetchStandardFontData",Or=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(Or):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var Or;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:kr,transfers:Ar}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:kr,filename:((Or=this._fullReader)==null?void 0:Or.filename)??null},Ar).finally(()=>{this.annotationStorage.resetModified()})}getPage(kr){if(!Number.isInteger(kr)||kr<=0||kr>this._numPages)return Promise.reject(new Error("Invalid page request."));const Ar=kr-1,Or=$r(this,gr).get(Ar);if(Or)return Or;const Lr=this.messageHandler.sendWithPromise("GetPage",{pageIndex:Ar}).then(Fr=>{if(this.destroyed)throw new Error("Transport destroyed");const Hr=new PDFPageProxy(Ar,Fr,this,this._params.pdfBug);return $r(this,vr).set(Ar,Hr),Hr});return $r(this,gr).set(Ar,Lr),Lr}getPageIndex(kr){return typeof kr!="object"||kr===null||!Number.isInteger(kr.num)||kr.num<0||!Number.isInteger(kr.gen)||kr.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:kr.num,gen:kr.gen})}getAnnotations(kr,Ar){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:kr,intent:Ar})}getFieldObjects(){return ws(this,br,Po).call(this,"GetFieldObjects")}hasJSActions(){return ws(this,br,Po).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(kr){return typeof kr!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:kr})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return ws(this,br,Po).call(this,"GetDocJSActions")}getPageJSActions(kr){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:kr})}getStructTree(kr){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:kr})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(kr=>new _optional_content_config.OptionalContentConfig(kr))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const kr="GetMetadata",Ar=$r(this,Er).get(kr);if(Ar)return Ar;const Or=this.messageHandler.sendWithPromise(kr,null).then(Lr=>{var Fr,Hr;return{info:Lr[0],metadata:Lr[1]?new _metadata.Metadata(Lr[1]):null,contentDispositionFilename:((Fr=this._fullReader)==null?void 0:Fr.filename)??null,contentLength:((Hr=this._fullReader)==null?void 0:Hr.contentLength)??null}});return $r(this,Er).set(kr,Or),Or}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(kr=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const Ar of $r(this,vr).values())if(!Ar.cleanup())throw new Error(`startCleanup: Page ${Ar.pageNumber} is currently rendering.`);this.commonObjs.clear(),kr||this.fontLoader.clear(),$r(this,Er).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:kr,enableXfa:Ar}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:kr,enableXfa:Ar})}}Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,br=new WeakSet,Po=function(kr,Ar=null){const Or=$r(this,Er).get(kr);if(Or)return Or;const Lr=this.messageHandler.sendWithPromise(kr,Ar);return $r(this,Er).set(kr,Lr),Lr};class PDFObjects{constructor(){Ns(this,wr);Ns(this,jr,Object.create(null))}get(kr,Ar=null){if(Ar){const Lr=ws(this,wr,Xo).call(this,kr);return Lr.capability.promise.then(()=>Ar(Lr.data)),null}const Or=$r(this,jr)[kr];if(!(Or!=null&&Or.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${kr}.`);return Or.data}has(kr){const Ar=$r(this,jr)[kr];return(Ar==null?void 0:Ar.capability.settled)||!1}resolve(kr,Ar=null){const Or=ws(this,wr,Xo).call(this,kr);Or.data=Ar,Or.capability.resolve()}clear(){var kr;for(const Ar in $r(this,jr)){const{data:Or}=$r(this,jr)[Ar];(kr=Or==null?void 0:Or.bitmap)==null||kr.close()}ks(this,jr,Object.create(null))}}jr=new WeakMap,wr=new WeakSet,Xo=function(kr){var Ar;return(Ar=$r(this,jr))[kr]||(Ar[kr]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(kr){Ns(this,Tr,null);ks(this,Tr,kr),this.onContinue=null}get promise(){return $r(this,Tr).capability.promise}cancel(kr=0){$r(this,Tr).cancel(null,kr)}get separateAnnots(){const{separateAnnots:kr}=$r(this,Tr).operatorList;if(!kr)return!1;const{annotationCanvasMap:Ar}=$r(this,Tr);return kr.form||kr.canvas&&(Ar==null?void 0:Ar.size)>0}}Tr=new WeakMap,exports$1.RenderTask=RenderTask;const Nr=class Nr{constructor({callback:kr,params:Ar,objs:Or,commonObjs:Lr,annotationCanvasMap:Fr,operatorList:Hr,pageIndex:Kr,canvasFactory:Gr,filterFactory:Zr,useRequestAnimationFrame:Jr=!1,pdfBug:os=!1,pageColors:Ur=null}){this.callback=kr,this.params=Ar,this.objs=Or,this.commonObjs=Lr,this.annotationCanvasMap=Fr,this.operatorListIdx=null,this.operatorList=Hr,this._pageIndex=Kr,this.canvasFactory=Gr,this.filterFactory=Zr,this._pdfBug=os,this.pageColors=Ur,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Jr===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=Ar.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:kr=!1,optionalContentConfig:Ar}){var Kr,Gr;if(this.cancelled)return;if(this._canvas){if($r(Nr,Rr).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");$r(Nr,Rr).add(this._canvas)}this._pdfBug&&((Kr=globalThis.StepperManager)!=null&&Kr.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:Or,viewport:Lr,transform:Fr,background:Hr}=this.params;this.gfx=new _canvas.CanvasGraphics(Or,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:Ar},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:Fr,viewport:Lr,transparency:kr,background:Hr}),this.operatorListIdx=0,this.graphicsReady=!0,(Gr=this.graphicsReadyCallback)==null||Gr.call(this)}cancel(kr=null,Ar=0){var Or;this.running=!1,this.cancelled=!0,(Or=this.gfx)==null||Or.endDrawing(),$r(Nr,Rr).delete(this._canvas),this.callback(kr||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,Ar))}operatorListChanged(){var kr;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(kr=this.stepper)==null||kr.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),$r(Nr,Rr).delete(this._canvas),this.callback())))}};Rr=new WeakMap,Ns(Nr,Rr,new WeakSet);let InternalRenderTask=Nr;const version="3.11.174";exports$1.version=version;const build="ce8716743";exports$1.build=build},(ar,or,lr)=>{var fr,xr,Er,Yl,gr;Object.defineProperty(or,"__esModule",{value:!0}),or.SerializableEmpty=or.PrintAnnotationStorage=or.AnnotationStorage=void 0;var cr=lr(1),ur=lr(4),dr=lr(8);const hr=Object.freeze({map:null,hash:"",transfers:void 0});or.SerializableEmpty=hr;class pr{constructor(){Ns(this,Er);Ns(this,fr,!1);Ns(this,xr,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(br,_r){const jr=$r(this,xr).get(br);return jr===void 0?_r:Object.assign(_r,jr)}getRawValue(br){return $r(this,xr).get(br)}remove(br){if($r(this,xr).delete(br),$r(this,xr).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const _r of $r(this,xr).values())if(_r instanceof ur.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(br,_r){const jr=$r(this,xr).get(br);let wr=!1;if(jr!==void 0)for(const[Sr,Tr]of Object.entries(_r))jr[Sr]!==Tr&&(wr=!0,jr[Sr]=Tr);else wr=!0,$r(this,xr).set(br,_r);wr&&ws(this,Er,Yl).call(this),_r instanceof ur.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(_r.constructor._type)}has(br){return $r(this,xr).has(br)}getAll(){return $r(this,xr).size>0?(0,cr.objectFromMap)($r(this,xr)):null}setAll(br){for(const[_r,jr]of Object.entries(br))this.setValue(_r,jr)}get size(){return $r(this,xr).size}resetModified(){$r(this,fr)&&(ks(this,fr,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new mr(this)}get serializable(){if($r(this,xr).size===0)return hr;const br=new Map,_r=new dr.MurmurHash3_64,jr=[],wr=Object.create(null);let Sr=!1;for(const[Tr,Rr]of $r(this,xr)){const Nr=Rr instanceof ur.AnnotationEditor?Rr.serialize(!1,wr):Rr;Nr&&(br.set(Tr,Nr),_r.update(`${Tr}:${JSON.stringify(Nr)}`),Sr||(Sr=!!Nr.bitmap))}if(Sr)for(const Tr of br.values())Tr.bitmap&&jr.push(Tr.bitmap);return br.size>0?{map:br,hash:_r.hexdigest(),transfers:jr}:hr}}fr=new WeakMap,xr=new WeakMap,Er=new WeakSet,Yl=function(){$r(this,fr)||(ks(this,fr,!0),typeof this.onSetModified=="function"&&this.onSetModified())},or.AnnotationStorage=pr;class mr extends pr{constructor(_r){super();Ns(this,gr);const{map:jr,hash:wr,transfers:Sr}=_r.serializable,Tr=structuredClone(jr,Sr?{transfer:Sr}:null);ks(this,gr,{map:Tr,hash:wr,transfers:Sr})}get print(){(0,cr.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return $r(this,gr)}}gr=new WeakMap,or.PrintAnnotationStorage=mr},(ar,or,lr)=>{var mr,fr,xr,Er,vr,gr,yr,br,_r,jr,wr,Sr,Tr,Rr,Nr,Ko,Yo,Ar,qo,Jo,Jl,Ql,Zl,Qo,_c;Object.defineProperty(or,"__esModule",{value:!0}),or.AnnotationEditor=void 0;var cr=lr(5),ur=lr(1),dr=lr(6);const Jr=class Jr{constructor(Ur){Ns(this,Nr);Ns(this,mr,"");Ns(this,fr,!1);Ns(this,xr,null);Ns(this,Er,null);Ns(this,vr,null);Ns(this,gr,!1);Ns(this,yr,null);Ns(this,br,this.focusin.bind(this));Ns(this,_r,this.focusout.bind(this));Ns(this,jr,!1);Ns(this,wr,!1);Ns(this,Sr,!1);io(this,"_initialOptions",Object.create(null));io(this,"_uiManager",null);io(this,"_focusEventsAllowed",!0);io(this,"_l10nPromise",null);Ns(this,Tr,!1);Ns(this,Rr,Jr._zIndex++);this.constructor===Jr&&(0,ur.unreachable)("Cannot initialize AnnotationEditor."),this.parent=Ur.parent,this.id=Ur.id,this.width=this.height=null,this.pageIndex=Ur.parent.pageIndex,this.name=Ur.name,this.div=null,this._uiManager=Ur.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=Ur.isCentered,this._structTreeParentId=null;const{rotation:Vr,rawDims:{pageWidth:es,pageHeight:Ir,pageX:Dr,pageY:Pr}}=this.parent.viewport;this.rotation=Vr,this.pageRotation=(360+Vr-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[es,Ir],this.pageTranslation=[Dr,Pr];const[Mr,Br]=this.parentDimensions;this.x=Ur.x/Mr,this.y=Ur.y/Br,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,ur.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(Ur){const Vr=new pr({id:Ur.parent.getNextId(),parent:Ur.parent,uiManager:Ur._uiManager});Vr.annotationElementId=Ur.annotationElementId,Vr.deleted=!0,Vr._uiManager.addToAnnotationStorage(Vr)}static initialize(Ur,Vr=null){if(Jr._l10nPromise||(Jr._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(Ir=>[Ir,Ur.get(Ir)]))),Vr!=null&&Vr.strings)for(const Ir of Vr.strings)Jr._l10nPromise.set(Ir,Ur.get(Ir));if(Jr._borderLineWidth!==-1)return;const es=getComputedStyle(document.documentElement);Jr._borderLineWidth=parseFloat(es.getPropertyValue("--outline-width"))||0}static updateDefaultParams(Ur,Vr){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(Ur){return!1}static paste(Ur,Vr){(0,ur.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return $r(this,Tr)}set _isDraggable(Ur){var Vr;ks(this,Tr,Ur),(Vr=this.div)==null||Vr.classList.toggle("draggable",Ur)}center(){const[Ur,Vr]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*Vr/(Ur*2),this.y+=this.width*Ur/(Vr*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*Vr/(Ur*2),this.y-=this.width*Ur/(Vr*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(Ur){this._uiManager.addCommands(Ur)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=$r(this,Rr)}setParent(Ur){Ur!==null&&(this.pageIndex=Ur.pageIndex,this.pageDimensions=Ur.pageDimensions),this.parent=Ur}focusin(Ur){this._focusEventsAllowed&&($r(this,jr)?ks(this,jr,!1):this.parent.setSelected(this))}focusout(Ur){var es;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const Vr=Ur.relatedTarget;Vr!=null&&Vr.closest(`#${this.id}`)||(Ur.preventDefault(),(es=this.parent)!=null&&es.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(Ur,Vr,es,Ir){const[Dr,Pr]=this.parentDimensions;[es,Ir]=this.screenToPageTranslation(es,Ir),this.x=(Ur+es)/Dr,this.y=(Vr+Ir)/Pr,this.fixAndSetPosition()}translate(Ur,Vr){ws(this,Nr,Ko).call(this,this.parentDimensions,Ur,Vr)}translateInPage(Ur,Vr){ws(this,Nr,Ko).call(this,this.pageDimensions,Ur,Vr),this.div.scrollIntoView({block:"nearest"})}drag(Ur,Vr){const[es,Ir]=this.parentDimensions;if(this.x+=Ur/es,this.y+=Vr/Ir,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:Xr,y:Wr}=this.div.getBoundingClientRect();this.parent.findNewParent(this,Xr,Wr)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:Dr,y:Pr}=this;const[Mr,Br]=ws(this,Nr,Yo).call(this);Dr+=Mr,Pr+=Br,this.div.style.left=`${(100*Dr).toFixed(2)}%`,this.div.style.top=`${(100*Pr).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[Ur,Vr]=this.pageDimensions;let{x:es,y:Ir,width:Dr,height:Pr}=this;switch(Dr*=Ur,Pr*=Vr,es*=Ur,Ir*=Vr,this.rotation){case 0:es=Math.max(0,Math.min(Ur-Dr,es)),Ir=Math.max(0,Math.min(Vr-Pr,Ir));break;case 90:es=Math.max(0,Math.min(Ur-Pr,es)),Ir=Math.min(Vr,Math.max(Dr,Ir));break;case 180:es=Math.min(Ur,Math.max(Dr,es)),Ir=Math.min(Vr,Math.max(Pr,Ir));break;case 270:es=Math.min(Ur,Math.max(Pr,es)),Ir=Math.max(0,Math.min(Vr-Dr,Ir));break}this.x=es/=Ur,this.y=Ir/=Vr;const[Mr,Br]=ws(this,Nr,Yo).call(this);es+=Mr,Ir+=Br;const{style:Xr}=this.div;Xr.left=`${(100*es).toFixed(2)}%`,Xr.top=`${(100*Ir).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(Ur,Vr){var es;return ws(es=Jr,Ar,qo).call(es,Ur,Vr,this.parentRotation)}pageTranslationToScreen(Ur,Vr){var es;return ws(es=Jr,Ar,qo).call(es,Ur,Vr,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:Ur,pageDimensions:[Vr,es]}=this,Ir=Vr*Ur,Dr=es*Ur;return ur.FeatureTest.isCSSRoundSupported?[Math.round(Ir),Math.round(Dr)]:[Ir,Dr]}setDims(Ur,Vr){var Dr;const[es,Ir]=this.parentDimensions;this.div.style.width=`${(100*Ur/es).toFixed(2)}%`,$r(this,gr)||(this.div.style.height=`${(100*Vr/Ir).toFixed(2)}%`),(Dr=$r(this,xr))==null||Dr.classList.toggle("small",Ur<Jr.SMALL_EDITOR_SIZE||Vr<Jr.SMALL_EDITOR_SIZE)}fixDims(){const{style:Ur}=this.div,{height:Vr,width:es}=Ur,Ir=es.endsWith("%"),Dr=!$r(this,gr)&&Vr.endsWith("%");if(Ir&&Dr)return;const[Pr,Mr]=this.parentDimensions;Ir||(Ur.width=`${(100*parseFloat(es)/Pr).toFixed(2)}%`),!$r(this,gr)&&!Dr&&(Ur.height=`${(100*parseFloat(Vr)/Mr).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if($r(this,xr))return;const Ur=ks(this,xr,document.createElement("button"));Ur.className="altText";const Vr=await Jr._l10nPromise.get("editor_alt_text_button_label");Ur.textContent=Vr,Ur.setAttribute("aria-label",Vr),Ur.tabIndex="0",Ur.addEventListener("contextmenu",dr.noContextMenu),Ur.addEventListener("pointerdown",es=>es.stopPropagation()),Ur.addEventListener("click",es=>{es.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),Ur.addEventListener("keydown",es=>{es.target===Ur&&es.key==="Enter"&&(es.preventDefault(),this._uiManager.editAltText(this))}),ws(this,Nr,Qo).call(this),this.div.append(Ur),Jr.SMALL_EDITOR_SIZE||(Jr.SMALL_EDITOR_SIZE=Math.min(128,Math.round(Ur.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:$r(this,mr),decorative:$r(this,fr)}}set altTextData({altText:Ur,decorative:Vr}){$r(this,mr)===Ur&&$r(this,fr)===Vr||(ks(this,mr,Ur),ks(this,fr,Vr),ws(this,Nr,Qo).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",$r(this,br)),this.div.addEventListener("focusout",$r(this,_r));const[Ur,Vr]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*Vr/Ur).toFixed(2)}%`,this.div.style.maxHeight=`${(100*Ur/Vr).toFixed(2)}%`);const[es,Ir]=this.getInitialTranslation();return this.translate(es,Ir),(0,cr.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(Ur){const{isMac:Vr}=ur.FeatureTest.platform;if(Ur.button!==0||Ur.ctrlKey&&Vr){Ur.preventDefault();return}ks(this,jr,!0),ws(this,Nr,_c).call(this,Ur)}moveInDOM(){var Ur;(Ur=this.parent)==null||Ur.moveEditorInDOM(this)}_setParentAndPosition(Ur,Vr,es){Ur.changeParent(this),this.x=Vr,this.y=es,this.fixAndSetPosition()}getRect(Ur,Vr){const es=this.parentScale,[Ir,Dr]=this.pageDimensions,[Pr,Mr]=this.pageTranslation,Br=Ur/es,Xr=Vr/es,Wr=this.x*Ir,ss=this.y*Dr,ds=this.width*Ir,ns=this.height*Dr;switch(this.rotation){case 0:return[Wr+Br+Pr,Dr-ss-Xr-ns+Mr,Wr+Br+ds+Pr,Dr-ss-Xr+Mr];case 90:return[Wr+Xr+Pr,Dr-ss+Br+Mr,Wr+Xr+ns+Pr,Dr-ss+Br+ds+Mr];case 180:return[Wr-Br-ds+Pr,Dr-ss+Xr+Mr,Wr-Br+Pr,Dr-ss+Xr+ns+Mr];case 270:return[Wr-Xr-ns+Pr,Dr-ss-Br-ds+Mr,Wr-Xr+Pr,Dr-ss-Br+Mr];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(Ur,Vr){const[es,Ir,Dr,Pr]=Ur,Mr=Dr-es,Br=Pr-Ir;switch(this.rotation){case 0:return[es,Vr-Pr,Mr,Br];case 90:return[es,Vr-Ir,Br,Mr];case 180:return[Dr,Vr-Ir,Mr,Br];case 270:return[Dr,Vr-Pr,Br,Mr];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){ks(this,Sr,!0)}disableEditMode(){ks(this,Sr,!1)}isInEditMode(){return $r(this,Sr)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var Ur,Vr;(Ur=this.div)==null||Ur.addEventListener("focusin",$r(this,br)),(Vr=this.div)==null||Vr.addEventListener("focusout",$r(this,_r))}serialize(Ur=!1,Vr=null){(0,ur.unreachable)("An editor must be serializable")}static deserialize(Ur,Vr,es){const Ir=new this.prototype.constructor({parent:Vr,id:Vr.getNextId(),uiManager:es});Ir.rotation=Ur.rotation;const[Dr,Pr]=Ir.pageDimensions,[Mr,Br,Xr,Wr]=Ir.getRectInCurrentCoords(Ur.rect,Pr);return Ir.x=Mr/Dr,Ir.y=Br/Pr,Ir.width=Xr/Dr,Ir.height=Wr/Pr,Ir}remove(){var Ur;this.div.removeEventListener("focusin",$r(this,br)),this.div.removeEventListener("focusout",$r(this,_r)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(Ur=$r(this,xr))==null||Ur.remove(),ks(this,xr,null),ks(this,Er,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(ws(this,Nr,Jl).call(this),$r(this,yr).classList.remove("hidden"))}select(){var Ur;this.makeResizable(),(Ur=this.div)==null||Ur.classList.add("selectedEditor")}unselect(){var Ur,Vr,es;(Ur=$r(this,yr))==null||Ur.classList.add("hidden"),(Vr=this.div)==null||Vr.classList.remove("selectedEditor"),(es=this.div)!=null&&es.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(Ur,Vr){}disableEditing(){$r(this,xr)&&($r(this,xr).hidden=!0)}enableEditing(){$r(this,xr)&&($r(this,xr).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return $r(this,wr)}set isEditing(Ur){ks(this,wr,Ur),this.parent&&(Ur?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(Ur,Vr){ks(this,gr,!0);const es=Ur/Vr,{style:Ir}=this.div;Ir.aspectRatio=es,Ir.height="auto"}static get MIN_SIZE(){return 16}};mr=new WeakMap,fr=new WeakMap,xr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,br=new WeakMap,_r=new WeakMap,jr=new WeakMap,wr=new WeakMap,Sr=new WeakMap,Tr=new WeakMap,Rr=new WeakMap,Nr=new WeakSet,Ko=function([Ur,Vr],es,Ir){[es,Ir]=this.screenToPageTranslation(es,Ir),this.x+=es/Ur,this.y+=Ir/Vr,this.fixAndSetPosition()},Yo=function(){const[Ur,Vr]=this.parentDimensions,{_borderLineWidth:es}=Jr,Ir=es/Ur,Dr=es/Vr;switch(this.rotation){case 90:return[-Ir,Dr];case 180:return[Ir,Dr];case 270:return[Ir,-Dr];default:return[-Ir,-Dr]}},Ar=new WeakSet,qo=function(Ur,Vr,es){switch(es){case 90:return[Vr,-Ur];case 180:return[-Ur,-Vr];case 270:return[-Vr,Ur];default:return[Ur,Vr]}},Jo=function(Ur){switch(Ur){case 90:{const[Vr,es]=this.pageDimensions;return[0,-Vr/es,es/Vr,0]}case 180:return[-1,0,0,-1];case 270:{const[Vr,es]=this.pageDimensions;return[0,Vr/es,-es/Vr,0]}default:return[1,0,0,1]}},Jl=function(){if($r(this,yr))return;ks(this,yr,document.createElement("div")),$r(this,yr).classList.add("resizers");const Ur=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||Ur.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const Vr of Ur){const es=document.createElement("div");$r(this,yr).append(es),es.classList.add("resizer",Vr),es.addEventListener("pointerdown",ws(this,Nr,Ql).bind(this,Vr)),es.addEventListener("contextmenu",dr.noContextMenu)}this.div.prepend($r(this,yr))},Ql=function(Ur,Vr){Vr.preventDefault();const{isMac:es}=ur.FeatureTest.platform;if(Vr.button!==0||Vr.ctrlKey&&es)return;const Ir=ws(this,Nr,Zl).bind(this,Ur),Dr=this._isDraggable;this._isDraggable=!1;const Pr={passive:!0,capture:!0};window.addEventListener("pointermove",Ir,Pr);const Mr=this.x,Br=this.y,Xr=this.width,Wr=this.height,ss=this.parent.div.style.cursor,ds=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(Vr.target).cursor;const ns=()=>{this._isDraggable=Dr,window.removeEventListener("pointerup",ns),window.removeEventListener("blur",ns),window.removeEventListener("pointermove",Ir,Pr),this.parent.div.style.cursor=ss,this.div.style.cursor=ds;const fs=this.x,bs=this.y,Es=this.width,Ds=this.height;fs===Mr&&bs===Br&&Es===Xr&&Ds===Wr||this.addCommands({cmd:()=>{this.width=Es,this.height=Ds,this.x=fs,this.y=bs;const[gs,as]=this.parentDimensions;this.setDims(gs*Es,as*Ds),this.fixAndSetPosition()},undo:()=>{this.width=Xr,this.height=Wr,this.x=Mr,this.y=Br;const[gs,as]=this.parentDimensions;this.setDims(gs*Xr,as*Wr),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",ns),window.addEventListener("blur",ns)},Zl=function(Ur,Vr){const[es,Ir]=this.parentDimensions,Dr=this.x,Pr=this.y,Mr=this.width,Br=this.height,Xr=Jr.MIN_SIZE/es,Wr=Jr.MIN_SIZE/Ir,ss=Vs=>Math.round(Vs*1e4)/1e4,ds=ws(this,Nr,Jo).call(this,this.rotation),ns=(Vs,xa)=>[ds[0]*Vs+ds[2]*xa,ds[1]*Vs+ds[3]*xa],fs=ws(this,Nr,Jo).call(this,360-this.rotation),bs=(Vs,xa)=>[fs[0]*Vs+fs[2]*xa,fs[1]*Vs+fs[3]*xa];let Es,Ds,gs=!1,as=!1;switch(Ur){case"topLeft":gs=!0,Es=(Vs,xa)=>[0,0],Ds=(Vs,xa)=>[Vs,xa];break;case"topMiddle":Es=(Vs,xa)=>[Vs/2,0],Ds=(Vs,xa)=>[Vs/2,xa];break;case"topRight":gs=!0,Es=(Vs,xa)=>[Vs,0],Ds=(Vs,xa)=>[0,xa];break;case"middleRight":as=!0,Es=(Vs,xa)=>[Vs,xa/2],Ds=(Vs,xa)=>[0,xa/2];break;case"bottomRight":gs=!0,Es=(Vs,xa)=>[Vs,xa],Ds=(Vs,xa)=>[0,0];break;case"bottomMiddle":Es=(Vs,xa)=>[Vs/2,xa],Ds=(Vs,xa)=>[Vs/2,0];break;case"bottomLeft":gs=!0,Es=(Vs,xa)=>[0,xa],Ds=(Vs,xa)=>[Vs,0];break;case"middleLeft":as=!0,Es=(Vs,xa)=>[0,xa/2],Ds=(Vs,xa)=>[Vs,xa/2];break}const qr=Es(Mr,Br),ts=Ds(Mr,Br);let Yr=ns(...ts);const hs=ss(Dr+Yr[0]),ys=ss(Pr+Yr[1]);let _s=1,Ss=1,[vs,Hs]=this.screenToPageTranslation(Vr.movementX,Vr.movementY);if([vs,Hs]=bs(vs/es,Hs/Ir),gs){const Vs=Math.hypot(Mr,Br);_s=Ss=Math.max(Math.min(Math.hypot(ts[0]-qr[0]-vs,ts[1]-qr[1]-Hs)/Vs,1/Mr,1/Br),Xr/Mr,Wr/Br)}else as?_s=Math.max(Xr,Math.min(1,Math.abs(ts[0]-qr[0]-vs)))/Mr:Ss=Math.max(Wr,Math.min(1,Math.abs(ts[1]-qr[1]-Hs)))/Br;const Bs=ss(Mr*_s),na=ss(Br*Ss);Yr=ns(...Ds(Bs,na));const Js=hs-Yr[0],$a=ys-Yr[1];this.width=Bs,this.height=na,this.x=Js,this.y=$a,this.setDims(es*Bs,Ir*na),this.fixAndSetPosition()},Qo=async function(){var es;const Ur=$r(this,xr);if(!Ur)return;if(!$r(this,mr)&&!$r(this,fr)){Ur.classList.remove("done"),(es=$r(this,Er))==null||es.remove();return}Jr._l10nPromise.get("editor_alt_text_edit_button_label").then(Ir=>{Ur.setAttribute("aria-label",Ir)});let Vr=$r(this,Er);if(!Vr){ks(this,Er,Vr=document.createElement("span")),Vr.className="tooltip",Vr.setAttribute("role","tooltip");const Ir=Vr.id=`alt-text-tooltip-${this.id}`;Ur.setAttribute("aria-describedby",Ir);const Dr=100;Ur.addEventListener("mouseenter",()=>{ks(this,vr,setTimeout(()=>{ks(this,vr,null),$r(this,Er).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},Dr))}),Ur.addEventListener("mouseleave",()=>{var Pr;clearTimeout($r(this,vr)),ks(this,vr,null),(Pr=$r(this,Er))==null||Pr.classList.remove("show")})}Ur.classList.add("done"),Vr.innerText=$r(this,fr)?await Jr._l10nPromise.get("editor_alt_text_decorative_tooltip"):$r(this,mr),Vr.parentNode||Ur.append(Vr)},_c=function(Ur){if(!this._isDraggable)return;const Vr=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let es,Ir;Vr&&(es={passive:!0,capture:!0},Ir=Pr=>{const[Mr,Br]=this.screenToPageTranslation(Pr.movementX,Pr.movementY);this._uiManager.dragSelectedEditors(Mr,Br)},window.addEventListener("pointermove",Ir,es));const Dr=()=>{if(window.removeEventListener("pointerup",Dr),window.removeEventListener("blur",Dr),Vr&&window.removeEventListener("pointermove",Ir,es),ks(this,jr,!1),!this._uiManager.endDragSession()){const{isMac:Pr}=ur.FeatureTest.platform;Ur.ctrlKey&&!Pr||Ur.shiftKey||Ur.metaKey&&Pr?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",Dr),window.addEventListener("blur",Dr)},Ns(Jr,Ar),io(Jr,"_borderLineWidth",-1),io(Jr,"_colorManager",new cr.ColorManager),io(Jr,"_zIndex",1),io(Jr,"SMALL_EDITOR_SIZE",0);let hr=Jr;or.AnnotationEditor=hr;class pr extends hr{constructor(Ur){super(Ur),this.annotationElementId=Ur.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(ar,or,lr)=>{var gr,yr,br,_r,jr,Zo,Tr,Rr,Nr,Cr,kr,eu,Lr,Fr,Hr,Kr,Gr,Zr,Jr,os,Ur,Vr,es,Ir,Dr,Pr,Mr,Br,Xr,Wr,ss,ds,ns,fs,bs,Es,Ds,gs,as,qr,ts,Yr,hs,ys,_s,Ss,vs,tu,xl,El,Do,yl,wl,co,_o,ru,su,_l,So,Sl;Object.defineProperty(or,"__esModule",{value:!0}),or.KeyboardManager=or.CommandManager=or.ColorManager=or.AnnotationEditorUIManager=void 0,or.bindEvents=dr,or.opacityToHex=hr;var cr=lr(1),ur=lr(6);function dr(eo,xs,Os){for(const zs of Os)xs.addEventListener(zs,eo[zs].bind(eo))}function hr(eo){return Math.round(Math.min(255,Math.max(1,255*eo))).toString(16).padStart(2,"0")}class pr{constructor(){Ns(this,gr,0)}getId(){return`${cr.AnnotationEditorPrefix}${wo(this,gr)._++}`}}gr=new WeakMap;const Sr=class Sr{constructor(){Ns(this,jr);Ns(this,yr,(0,cr.getUuid)());Ns(this,br,0);Ns(this,_r,null)}static get _isSVGFittingCanvas(){const xs='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',zs=new OffscreenCanvas(1,3).getContext("2d"),Zs=new Image;Zs.src=xs;const ga=Zs.decode().then(()=>(zs.drawImage(Zs,0,0,1,1,0,0,1,3),new Uint32Array(zs.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,cr.shadow)(this,"_isSVGFittingCanvas",ga)}async getFromFile(xs){const{lastModified:Os,name:zs,size:Zs,type:ga}=xs;return ws(this,jr,Zo).call(this,`${Os}_${zs}_${Zs}_${ga}`,xs)}async getFromUrl(xs){return ws(this,jr,Zo).call(this,xs,xs)}async getFromId(xs){$r(this,_r)||ks(this,_r,new Map);const Os=$r(this,_r).get(xs);return Os?Os.bitmap?(Os.refCounter+=1,Os):Os.file?this.getFromFile(Os.file):this.getFromUrl(Os.url):null}getSvgUrl(xs){const Os=$r(this,_r).get(xs);return Os!=null&&Os.isSvg?Os.svgUrl:null}deleteId(xs){$r(this,_r)||ks(this,_r,new Map);const Os=$r(this,_r).get(xs);Os&&(Os.refCounter-=1,Os.refCounter===0&&(Os.bitmap=null))}isValidId(xs){return xs.startsWith(`image_${$r(this,yr)}_`)}};yr=new WeakMap,br=new WeakMap,_r=new WeakMap,jr=new WeakSet,Zo=async function(xs,Os){$r(this,_r)||ks(this,_r,new Map);let zs=$r(this,_r).get(xs);if(zs===null)return null;if(zs!=null&&zs.bitmap)return zs.refCounter+=1,zs;try{zs||(zs={bitmap:null,id:`image_${$r(this,yr)}_${wo(this,br)._++}`,refCounter:0,isSvg:!1});let Zs;if(typeof Os=="string"){zs.url=Os;const ga=await fetch(Os);if(!ga.ok)throw new Error(ga.statusText);Zs=await ga.blob()}else Zs=zs.file=Os;if(Zs.type==="image/svg+xml"){const ga=Sr._isSVGFittingCanvas,Ys=new FileReader,ms=new Image,cs=new Promise((js,Ls)=>{ms.onload=()=>{zs.bitmap=ms,zs.isSvg=!0,js()},Ys.onload=async()=>{const Is=zs.svgUrl=Ys.result;ms.src=await ga?`${Is}#svgView(preserveAspectRatio(none))`:Is},ms.onerror=Ys.onerror=Ls});Ys.readAsDataURL(Zs),await cs}else zs.bitmap=await createImageBitmap(Zs);zs.refCounter=1}catch(Zs){console.error(Zs),zs=null}return $r(this,_r).set(xs,zs),zs&&$r(this,_r).set(zs.id,zs),zs};let mr=Sr;class fr{constructor(xs=128){Ns(this,Tr,[]);Ns(this,Rr,!1);Ns(this,Nr);Ns(this,Cr,-1);ks(this,Nr,xs)}add({cmd:xs,undo:Os,mustExec:zs,type:Zs=NaN,overwriteIfSameType:ga=!1,keepUndo:Ys=!1}){if(zs&&xs(),$r(this,Rr))return;const ms={cmd:xs,undo:Os,type:Zs};if($r(this,Cr)===-1){$r(this,Tr).length>0&&($r(this,Tr).length=0),ks(this,Cr,0),$r(this,Tr).push(ms);return}if(ga&&$r(this,Tr)[$r(this,Cr)].type===Zs){Ys&&(ms.undo=$r(this,Tr)[$r(this,Cr)].undo),$r(this,Tr)[$r(this,Cr)]=ms;return}const cs=$r(this,Cr)+1;cs===$r(this,Nr)?$r(this,Tr).splice(0,1):(ks(this,Cr,cs),cs<$r(this,Tr).length&&$r(this,Tr).splice(cs)),$r(this,Tr).push(ms)}undo(){$r(this,Cr)!==-1&&(ks(this,Rr,!0),$r(this,Tr)[$r(this,Cr)].undo(),ks(this,Rr,!1),ks(this,Cr,$r(this,Cr)-1))}redo(){$r(this,Cr)<$r(this,Tr).length-1&&(ks(this,Cr,$r(this,Cr)+1),ks(this,Rr,!0),$r(this,Tr)[$r(this,Cr)].cmd(),ks(this,Rr,!1))}hasSomethingToUndo(){return $r(this,Cr)!==-1}hasSomethingToRedo(){return $r(this,Cr)<$r(this,Tr).length-1}destroy(){ks(this,Tr,null)}}Tr=new WeakMap,Rr=new WeakMap,Nr=new WeakMap,Cr=new WeakMap,or.CommandManager=fr;class xr{constructor(xs){Ns(this,kr);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:Os}=cr.FeatureTest.platform;for(const[zs,Zs,ga={}]of xs)for(const Ys of zs){const ms=Ys.startsWith("mac+");Os&&ms?(this.callbacks.set(Ys.slice(4),{callback:Zs,options:ga}),this.allKeys.add(Ys.split("+").at(-1))):!Os&&!ms&&(this.callbacks.set(Ys,{callback:Zs,options:ga}),this.allKeys.add(Ys.split("+").at(-1)))}}exec(xs,Os){if(!this.allKeys.has(Os.key))return;const zs=this.callbacks.get(ws(this,kr,eu).call(this,Os));if(!zs)return;const{callback:Zs,options:{bubbles:ga=!1,args:Ys=[],checker:ms=null}}=zs;ms&&!ms(xs,Os)||(Zs.bind(xs,...Ys)(),ga||(Os.stopPropagation(),Os.preventDefault()))}}kr=new WeakSet,eu=function(xs){xs.altKey&&this.buffer.push("alt"),xs.ctrlKey&&this.buffer.push("ctrl"),xs.metaKey&&this.buffer.push("meta"),xs.shiftKey&&this.buffer.push("shift"),this.buffer.push(xs.key);const Os=this.buffer.join("+");return this.buffer.length=0,Os},or.KeyboardManager=xr;const Or=class Or{get _colors(){const xs=new Map([["CanvasText",null],["Canvas",null]]);return(0,ur.getColorValues)(xs),(0,cr.shadow)(this,"_colors",xs)}convert(xs){const Os=(0,ur.getRGB)(xs);if(!window.matchMedia("(forced-colors: active)").matches)return Os;for(const[zs,Zs]of this._colors)if(Zs.every((ga,Ys)=>ga===Os[Ys]))return Or._colorsMapping.get(zs);return Os}getHexCode(xs){const Os=this._colors.get(xs);return Os?cr.Util.makeHexColor(...Os):xs}};io(Or,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Er=Or;or.ColorManager=Er;const to=class to{constructor(xs,Os,zs,Zs,ga,Ys){Ns(this,vs);Ns(this,Lr,null);Ns(this,Fr,new Map);Ns(this,Hr,new Map);Ns(this,Kr,null);Ns(this,Gr,null);Ns(this,Zr,new fr);Ns(this,Jr,0);Ns(this,os,new Set);Ns(this,Ur,null);Ns(this,Vr,null);Ns(this,es,new Set);Ns(this,Ir,null);Ns(this,Dr,new pr);Ns(this,Pr,!1);Ns(this,Mr,!1);Ns(this,Br,null);Ns(this,Xr,cr.AnnotationEditorType.NONE);Ns(this,Wr,new Set);Ns(this,ss,null);Ns(this,ds,this.blur.bind(this));Ns(this,ns,this.focus.bind(this));Ns(this,fs,this.copy.bind(this));Ns(this,bs,this.cut.bind(this));Ns(this,Es,this.paste.bind(this));Ns(this,Ds,this.keydown.bind(this));Ns(this,gs,this.onEditingAction.bind(this));Ns(this,as,this.onPageChanging.bind(this));Ns(this,qr,this.onScaleChanging.bind(this));Ns(this,ts,this.onRotationChanging.bind(this));Ns(this,Yr,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Ns(this,hs,[0,0]);Ns(this,ys,null);Ns(this,_s,null);Ns(this,Ss,null);ks(this,_s,xs),ks(this,Ss,Os),ks(this,Kr,zs),this._eventBus=Zs,this._eventBus._on("editingaction",$r(this,gs)),this._eventBus._on("pagechanging",$r(this,as)),this._eventBus._on("scalechanging",$r(this,qr)),this._eventBus._on("rotationchanging",$r(this,ts)),ks(this,Gr,ga.annotationStorage),ks(this,Ir,ga.filterFactory),ks(this,ss,Ys),this.viewParameters={realScale:ur.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const xs=to.prototype,Os=ga=>{const{activeElement:Ys}=document;return Ys&&$r(ga,_s).contains(Ys)&&ga.hasSomethingToControl()},zs=this.TRANSLATE_SMALL,Zs=this.TRANSLATE_BIG;return(0,cr.shadow)(this,"_keyboardManager",new xr([[["ctrl+a","mac+meta+a"],xs.selectAll],[["ctrl+z","mac+meta+z"],xs.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],xs.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],xs.delete],[["Escape","mac+Escape"],xs.unselectAll],[["ArrowLeft","mac+ArrowLeft"],xs.translateSelectedEditors,{args:[-zs,0],checker:Os}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],xs.translateSelectedEditors,{args:[-Zs,0],checker:Os}],[["ArrowRight","mac+ArrowRight"],xs.translateSelectedEditors,{args:[zs,0],checker:Os}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],xs.translateSelectedEditors,{args:[Zs,0],checker:Os}],[["ArrowUp","mac+ArrowUp"],xs.translateSelectedEditors,{args:[0,-zs],checker:Os}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],xs.translateSelectedEditors,{args:[0,-Zs],checker:Os}],[["ArrowDown","mac+ArrowDown"],xs.translateSelectedEditors,{args:[0,zs],checker:Os}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],xs.translateSelectedEditors,{args:[0,Zs],checker:Os}]]))}destroy(){ws(this,vs,Do).call(this),ws(this,vs,xl).call(this),this._eventBus._off("editingaction",$r(this,gs)),this._eventBus._off("pagechanging",$r(this,as)),this._eventBus._off("scalechanging",$r(this,qr)),this._eventBus._off("rotationchanging",$r(this,ts));for(const xs of $r(this,Hr).values())xs.destroy();$r(this,Hr).clear(),$r(this,Fr).clear(),$r(this,es).clear(),ks(this,Lr,null),$r(this,Wr).clear(),$r(this,Zr).destroy(),$r(this,Kr).destroy()}get hcmFilter(){return(0,cr.shadow)(this,"hcmFilter",$r(this,ss)?$r(this,Ir).addHCMFilter($r(this,ss).foreground,$r(this,ss).background):"none")}get direction(){return(0,cr.shadow)(this,"direction",getComputedStyle($r(this,_s)).direction)}editAltText(xs){var Os;(Os=$r(this,Kr))==null||Os.editAltText(this,xs)}onPageChanging({pageNumber:xs}){ks(this,Jr,xs-1)}focusMainContainer(){$r(this,_s).focus()}findParent(xs,Os){for(const zs of $r(this,Hr).values()){const{x:Zs,y:ga,width:Ys,height:ms}=zs.div.getBoundingClientRect();if(xs>=Zs&&xs<=Zs+Ys&&Os>=ga&&Os<=ga+ms)return zs}return null}disableUserSelect(xs=!1){$r(this,Ss).classList.toggle("noUserSelect",xs)}addShouldRescale(xs){$r(this,es).add(xs)}removeShouldRescale(xs){$r(this,es).delete(xs)}onScaleChanging({scale:xs}){this.commitOrRemove(),this.viewParameters.realScale=xs*ur.PixelsPerInch.PDF_TO_CSS_UNITS;for(const Os of $r(this,es))Os.onScaleChanging()}onRotationChanging({pagesRotation:xs}){this.commitOrRemove(),this.viewParameters.rotation=xs}addToAnnotationStorage(xs){!xs.isEmpty()&&$r(this,Gr)&&!$r(this,Gr).has(xs.id)&&$r(this,Gr).setValue(xs.id,xs)}blur(){if(!this.hasSelection)return;const{activeElement:xs}=document;for(const Os of $r(this,Wr))if(Os.div.contains(xs)){ks(this,Br,[Os,xs]),Os._focusEventsAllowed=!1;break}}focus(){if(!$r(this,Br))return;const[xs,Os]=$r(this,Br);ks(this,Br,null),Os.addEventListener("focusin",()=>{xs._focusEventsAllowed=!0},{once:!0}),Os.focus()}addEditListeners(){ws(this,vs,El).call(this),ws(this,vs,yl).call(this)}removeEditListeners(){ws(this,vs,Do).call(this),ws(this,vs,wl).call(this)}copy(xs){var zs;if(xs.preventDefault(),(zs=$r(this,Lr))==null||zs.commitOrRemove(),!this.hasSelection)return;const Os=[];for(const Zs of $r(this,Wr)){const ga=Zs.serialize(!0);ga&&Os.push(ga)}Os.length!==0&&xs.clipboardData.setData("application/pdfjs",JSON.stringify(Os))}cut(xs){this.copy(xs),this.delete()}paste(xs){xs.preventDefault();const{clipboardData:Os}=xs;for(const ga of Os.items)for(const Ys of $r(this,Vr))if(Ys.isHandlingMimeForPasting(ga.type)){Ys.paste(ga,this.currentLayer);return}let zs=Os.getData("application/pdfjs");if(!zs)return;try{zs=JSON.parse(zs)}catch(ga){(0,cr.warn)(`paste: "${ga.message}".`);return}if(!Array.isArray(zs))return;this.unselectAll();const Zs=this.currentLayer;try{const ga=[];for(const cs of zs){const js=Zs.deserialize(cs);if(!js)return;ga.push(js)}const Ys=()=>{for(const cs of ga)ws(this,vs,_l).call(this,cs);ws(this,vs,Sl).call(this,ga)},ms=()=>{for(const cs of ga)cs.remove()};this.addCommands({cmd:Ys,undo:ms,mustExec:!0})}catch(ga){(0,cr.warn)(`paste: "${ga.message}".`)}}keydown(xs){var Os;(Os=this.getActive())!=null&&Os.shouldGetKeyboardEvents()||to._keyboardManager.exec(this,xs)}onEditingAction(xs){["undo","redo","delete","selectAll"].includes(xs.name)&&this[xs.name]()}setEditingState(xs){xs?(ws(this,vs,tu).call(this),ws(this,vs,El).call(this),ws(this,vs,yl).call(this),ws(this,vs,co).call(this,{isEditing:$r(this,Xr)!==cr.AnnotationEditorType.NONE,isEmpty:ws(this,vs,So).call(this),hasSomethingToUndo:$r(this,Zr).hasSomethingToUndo(),hasSomethingToRedo:$r(this,Zr).hasSomethingToRedo(),hasSelectedEditor:!1})):(ws(this,vs,xl).call(this),ws(this,vs,Do).call(this),ws(this,vs,wl).call(this),ws(this,vs,co).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(xs){if(!$r(this,Vr)){ks(this,Vr,xs);for(const Os of $r(this,Vr))ws(this,vs,_o).call(this,Os.defaultPropertiesToUpdate)}}getId(){return $r(this,Dr).getId()}get currentLayer(){return $r(this,Hr).get($r(this,Jr))}getLayer(xs){return $r(this,Hr).get(xs)}get currentPageIndex(){return $r(this,Jr)}addLayer(xs){$r(this,Hr).set(xs.pageIndex,xs),$r(this,Pr)?xs.enable():xs.disable()}removeLayer(xs){$r(this,Hr).delete(xs.pageIndex)}updateMode(xs,Os=null){if($r(this,Xr)!==xs){if(ks(this,Xr,xs),xs===cr.AnnotationEditorType.NONE){this.setEditingState(!1),ws(this,vs,su).call(this);return}this.setEditingState(!0),ws(this,vs,ru).call(this),this.unselectAll();for(const zs of $r(this,Hr).values())zs.updateMode(xs);if(Os){for(const zs of $r(this,Fr).values())if(zs.annotationElementId===Os){this.setSelected(zs),zs.enterInEditMode();break}}}}updateToolbar(xs){xs!==$r(this,Xr)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:xs})}updateParams(xs,Os){if($r(this,Vr)){if(xs===cr.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(xs);return}for(const zs of $r(this,Wr))zs.updateParams(xs,Os);for(const zs of $r(this,Vr))zs.updateDefaultParams(xs,Os)}}enableWaiting(xs=!1){if($r(this,Mr)!==xs){ks(this,Mr,xs);for(const Os of $r(this,Hr).values())xs?Os.disableClick():Os.enableClick(),Os.div.classList.toggle("waiting",xs)}}getEditors(xs){const Os=[];for(const zs of $r(this,Fr).values())zs.pageIndex===xs&&Os.push(zs);return Os}getEditor(xs){return $r(this,Fr).get(xs)}addEditor(xs){$r(this,Fr).set(xs.id,xs)}removeEditor(xs){var Os;$r(this,Fr).delete(xs.id),this.unselect(xs),(!xs.annotationElementId||!$r(this,os).has(xs.annotationElementId))&&((Os=$r(this,Gr))==null||Os.remove(xs.id))}addDeletedAnnotationElement(xs){$r(this,os).add(xs.annotationElementId),xs.deleted=!0}isDeletedAnnotationElement(xs){return $r(this,os).has(xs)}removeDeletedAnnotationElement(xs){$r(this,os).delete(xs.annotationElementId),xs.deleted=!1}setActiveEditor(xs){$r(this,Lr)!==xs&&(ks(this,Lr,xs),xs&&ws(this,vs,_o).call(this,xs.propertiesToUpdate))}toggleSelected(xs){if($r(this,Wr).has(xs)){$r(this,Wr).delete(xs),xs.unselect(),ws(this,vs,co).call(this,{hasSelectedEditor:this.hasSelection});return}$r(this,Wr).add(xs),xs.select(),ws(this,vs,_o).call(this,xs.propertiesToUpdate),ws(this,vs,co).call(this,{hasSelectedEditor:!0})}setSelected(xs){for(const Os of $r(this,Wr))Os!==xs&&Os.unselect();$r(this,Wr).clear(),$r(this,Wr).add(xs),xs.select(),ws(this,vs,_o).call(this,xs.propertiesToUpdate),ws(this,vs,co).call(this,{hasSelectedEditor:!0})}isSelected(xs){return $r(this,Wr).has(xs)}unselect(xs){xs.unselect(),$r(this,Wr).delete(xs),ws(this,vs,co).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return $r(this,Wr).size!==0}undo(){$r(this,Zr).undo(),ws(this,vs,co).call(this,{hasSomethingToUndo:$r(this,Zr).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:ws(this,vs,So).call(this)})}redo(){$r(this,Zr).redo(),ws(this,vs,co).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:$r(this,Zr).hasSomethingToRedo(),isEmpty:ws(this,vs,So).call(this)})}addCommands(xs){$r(this,Zr).add(xs),ws(this,vs,co).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:ws(this,vs,So).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const xs=[...$r(this,Wr)],Os=()=>{for(const Zs of xs)Zs.remove()},zs=()=>{for(const Zs of xs)ws(this,vs,_l).call(this,Zs)};this.addCommands({cmd:Os,undo:zs,mustExec:!0})}commitOrRemove(){var xs;(xs=$r(this,Lr))==null||xs.commitOrRemove()}hasSomethingToControl(){return $r(this,Lr)||this.hasSelection}selectAll(){for(const xs of $r(this,Wr))xs.commit();ws(this,vs,Sl).call(this,$r(this,Fr).values())}unselectAll(){if($r(this,Lr)){$r(this,Lr).commitOrRemove();return}if(this.hasSelection){for(const xs of $r(this,Wr))xs.unselect();$r(this,Wr).clear(),ws(this,vs,co).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(xs,Os,zs=!1){if(zs||this.commitOrRemove(),!this.hasSelection)return;$r(this,hs)[0]+=xs,$r(this,hs)[1]+=Os;const[Zs,ga]=$r(this,hs),Ys=[...$r(this,Wr)],ms=1e3;$r(this,ys)&&clearTimeout($r(this,ys)),ks(this,ys,setTimeout(()=>{ks(this,ys,null),$r(this,hs)[0]=$r(this,hs)[1]=0,this.addCommands({cmd:()=>{for(const cs of Ys)$r(this,Fr).has(cs.id)&&cs.translateInPage(Zs,ga)},undo:()=>{for(const cs of Ys)$r(this,Fr).has(cs.id)&&cs.translateInPage(-Zs,-ga)},mustExec:!1})},ms));for(const cs of Ys)cs.translateInPage(xs,Os)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),ks(this,Ur,new Map);for(const xs of $r(this,Wr))$r(this,Ur).set(xs,{savedX:xs.x,savedY:xs.y,savedPageIndex:xs.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!$r(this,Ur))return!1;this.disableUserSelect(!1);const xs=$r(this,Ur);ks(this,Ur,null);let Os=!1;for(const[{x:Zs,y:ga,pageIndex:Ys},ms]of xs)ms.newX=Zs,ms.newY=ga,ms.newPageIndex=Ys,Os||(Os=Zs!==ms.savedX||ga!==ms.savedY||Ys!==ms.savedPageIndex);if(!Os)return!1;const zs=(Zs,ga,Ys,ms)=>{if($r(this,Fr).has(Zs.id)){const cs=$r(this,Hr).get(ms);cs?Zs._setParentAndPosition(cs,ga,Ys):(Zs.pageIndex=ms,Zs.x=ga,Zs.y=Ys)}};return this.addCommands({cmd:()=>{for(const[Zs,{newX:ga,newY:Ys,newPageIndex:ms}]of xs)zs(Zs,ga,Ys,ms)},undo:()=>{for(const[Zs,{savedX:ga,savedY:Ys,savedPageIndex:ms}]of xs)zs(Zs,ga,Ys,ms)},mustExec:!0}),!0}dragSelectedEditors(xs,Os){if($r(this,Ur))for(const zs of $r(this,Ur).keys())zs.drag(xs,Os)}rebuild(xs){if(xs.parent===null){const Os=this.getLayer(xs.pageIndex);Os?(Os.changeParent(xs),Os.addOrRebuild(xs)):(this.addEditor(xs),this.addToAnnotationStorage(xs),xs.rebuild())}else xs.parent.addOrRebuild(xs)}isActive(xs){return $r(this,Lr)===xs}getActive(){return $r(this,Lr)}getMode(){return $r(this,Xr)}get imageManager(){return(0,cr.shadow)(this,"imageManager",new mr)}};Lr=new WeakMap,Fr=new WeakMap,Hr=new WeakMap,Kr=new WeakMap,Gr=new WeakMap,Zr=new WeakMap,Jr=new WeakMap,os=new WeakMap,Ur=new WeakMap,Vr=new WeakMap,es=new WeakMap,Ir=new WeakMap,Dr=new WeakMap,Pr=new WeakMap,Mr=new WeakMap,Br=new WeakMap,Xr=new WeakMap,Wr=new WeakMap,ss=new WeakMap,ds=new WeakMap,ns=new WeakMap,fs=new WeakMap,bs=new WeakMap,Es=new WeakMap,Ds=new WeakMap,gs=new WeakMap,as=new WeakMap,qr=new WeakMap,ts=new WeakMap,Yr=new WeakMap,hs=new WeakMap,ys=new WeakMap,_s=new WeakMap,Ss=new WeakMap,vs=new WeakSet,tu=function(){window.addEventListener("focus",$r(this,ns)),window.addEventListener("blur",$r(this,ds))},xl=function(){window.removeEventListener("focus",$r(this,ns)),window.removeEventListener("blur",$r(this,ds))},El=function(){window.addEventListener("keydown",$r(this,Ds),{capture:!0})},Do=function(){window.removeEventListener("keydown",$r(this,Ds),{capture:!0})},yl=function(){document.addEventListener("copy",$r(this,fs)),document.addEventListener("cut",$r(this,bs)),document.addEventListener("paste",$r(this,Es))},wl=function(){document.removeEventListener("copy",$r(this,fs)),document.removeEventListener("cut",$r(this,bs)),document.removeEventListener("paste",$r(this,Es))},co=function(xs){Object.entries(xs).some(([zs,Zs])=>$r(this,Yr)[zs]!==Zs)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign($r(this,Yr),xs)})},_o=function(xs){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:xs})},ru=function(){if(!$r(this,Pr)){ks(this,Pr,!0);for(const xs of $r(this,Hr).values())xs.enable()}},su=function(){if(this.unselectAll(),$r(this,Pr)){ks(this,Pr,!1);for(const xs of $r(this,Hr).values())xs.disable()}},_l=function(xs){const Os=$r(this,Hr).get(xs.pageIndex);Os?Os.addOrRebuild(xs):this.addEditor(xs)},So=function(){if($r(this,Fr).size===0)return!0;if($r(this,Fr).size===1)for(const xs of $r(this,Fr).values())return xs.isEmpty();return!1},Sl=function(xs){$r(this,Wr).clear();for(const Os of xs)Os.isEmpty()||($r(this,Wr).add(Os),Os.select());ws(this,vs,co).call(this,{hasSelectedEditor:!0})},io(to,"TRANSLATE_SMALL",1),io(to,"TRANSLATE_BIG",10);let vr=to;or.AnnotationEditorUIManager=vr},(ar,or,lr)=>{var Jr,os,Ur,Vr,es,Ir,Dr,Pr,Mr,Br,Xr,Wr,xo,go,Rl,Lo,Io,Ro,Co;Object.defineProperty(or,"__esModule",{value:!0}),or.StatTimer=or.RenderingCancelledException=or.PixelsPerInch=or.PageViewport=or.PDFDateString=or.DOMStandardFontDataFactory=or.DOMSVGFactory=or.DOMFilterFactory=or.DOMCanvasFactory=or.DOMCMapReaderFactory=void 0,or.deprecated=Cr,or.getColorValues=Fr,or.getCurrentTransform=Hr,or.getCurrentTransformInverse=Kr,or.getFilenameFromUrl=jr,or.getPdfFilenameFromUrl=wr,or.getRGB=Lr,or.getXfaPageViewport=Or,or.isDataScheme=br,or.isPdfFile=_r,or.isValidFetchUrl=Tr,or.loadScript=Nr,or.noContextMenu=Rr,or.setLayerDimensions=Gr;var cr=lr(7),ur=lr(1);const dr="http://www.w3.org/2000/svg",Zr=class Zr{};io(Zr,"CSS",96),io(Zr,"PDF",72),io(Zr,"PDF_TO_CSS_UNITS",Zr.CSS/Zr.PDF);let hr=Zr;or.PixelsPerInch=hr;class pr extends cr.BaseFilterFactory{constructor({docId:qr,ownerDocument:ts=globalThis.document}={}){super();Ns(this,Wr);Ns(this,Jr);Ns(this,os);Ns(this,Ur);Ns(this,Vr);Ns(this,es);Ns(this,Ir);Ns(this,Dr);Ns(this,Pr);Ns(this,Mr);Ns(this,Br);Ns(this,Xr,0);ks(this,Ur,qr),ks(this,Vr,ts)}addFilter(qr){if(!qr)return"none";let ts=$r(this,Wr,xo).get(qr);if(ts)return ts;let Yr,hs,ys,_s;if(qr.length===1){const Bs=qr[0],na=new Array(256);for(let Js=0;Js<256;Js++)na[Js]=Bs[Js]/255;_s=Yr=hs=ys=na.join(",")}else{const[Bs,na,Js]=qr,$a=new Array(256),Vs=new Array(256),xa=new Array(256);for(let ro=0;ro<256;ro++)$a[ro]=Bs[ro]/255,Vs[ro]=na[ro]/255,xa[ro]=Js[ro]/255;Yr=$a.join(","),hs=Vs.join(","),ys=xa.join(","),_s=`${Yr}${hs}${ys}`}if(ts=$r(this,Wr,xo).get(_s),ts)return $r(this,Wr,xo).set(qr,ts),ts;const Ss=`g_${$r(this,Ur)}_transfer_map_${wo(this,Xr)._++}`,vs=`url(#${Ss})`;$r(this,Wr,xo).set(qr,vs),$r(this,Wr,xo).set(_s,vs);const Hs=ws(this,Wr,Lo).call(this,Ss);return ws(this,Wr,Ro).call(this,Yr,hs,ys,Hs),vs}addHCMFilter(qr,ts){var na;const Yr=`${qr}-${ts}`;if($r(this,Ir)===Yr)return $r(this,Dr);if(ks(this,Ir,Yr),ks(this,Dr,"none"),(na=$r(this,es))==null||na.remove(),!qr||!ts)return $r(this,Dr);const hs=ws(this,Wr,Co).call(this,qr);qr=ur.Util.makeHexColor(...hs);const ys=ws(this,Wr,Co).call(this,ts);if(ts=ur.Util.makeHexColor(...ys),$r(this,Wr,go).style.color="",qr==="#000000"&&ts==="#ffffff"||qr===ts)return $r(this,Dr);const _s=new Array(256);for(let Js=0;Js<=255;Js++){const $a=Js/255;_s[Js]=$a<=.03928?$a/12.92:(($a+.055)/1.055)**2.4}const Ss=_s.join(","),vs=`g_${$r(this,Ur)}_hcm_filter`,Hs=ks(this,Pr,ws(this,Wr,Lo).call(this,vs));ws(this,Wr,Ro).call(this,Ss,Ss,Ss,Hs),ws(this,Wr,Rl).call(this,Hs);const Bs=(Js,$a)=>{const Vs=hs[Js]/255,xa=ys[Js]/255,ro=new Array($a+1);for(let no=0;no<=$a;no++)ro[no]=Vs+no/$a*(xa-Vs);return ro.join(",")};return ws(this,Wr,Ro).call(this,Bs(0,5),Bs(1,5),Bs(2,5),Hs),ks(this,Dr,`url(#${vs})`),$r(this,Dr)}addHighlightHCMFilter(qr,ts,Yr,hs){var xa;const ys=`${qr}-${ts}-${Yr}-${hs}`;if($r(this,Mr)===ys)return $r(this,Br);if(ks(this,Mr,ys),ks(this,Br,"none"),(xa=$r(this,Pr))==null||xa.remove(),!qr||!ts)return $r(this,Br);const[_s,Ss]=[qr,ts].map(ws(this,Wr,Co).bind(this));let vs=Math.round(.2126*_s[0]+.7152*_s[1]+.0722*_s[2]),Hs=Math.round(.2126*Ss[0]+.7152*Ss[1]+.0722*Ss[2]),[Bs,na]=[Yr,hs].map(ws(this,Wr,Co).bind(this));Hs<vs&&([vs,Hs,Bs,na]=[Hs,vs,na,Bs]),$r(this,Wr,go).style.color="";const Js=(ro,no,Us)=>{const Cs=new Array(256),Ts=(Hs-vs)/Us,qs=ro/255,to=(no-ro)/(255*Us);let eo=0;for(let xs=0;xs<=Us;xs++){const Os=Math.round(vs+xs*Ts),zs=qs+xs*to;for(let Zs=eo;Zs<=Os;Zs++)Cs[Zs]=zs;eo=Os+1}for(let xs=eo;xs<256;xs++)Cs[xs]=Cs[eo-1];return Cs.join(",")},$a=`g_${$r(this,Ur)}_hcm_highlight_filter`,Vs=ks(this,Pr,ws(this,Wr,Lo).call(this,$a));return ws(this,Wr,Rl).call(this,Vs),ws(this,Wr,Ro).call(this,Js(Bs[0],na[0],5),Js(Bs[1],na[1],5),Js(Bs[2],na[2],5),Vs),ks(this,Br,`url(#${$a})`),$r(this,Br)}destroy(qr=!1){qr&&($r(this,Dr)||$r(this,Br))||($r(this,os)&&($r(this,os).parentNode.parentNode.remove(),ks(this,os,null)),$r(this,Jr)&&($r(this,Jr).clear(),ks(this,Jr,null)),ks(this,Xr,0))}}Jr=new WeakMap,os=new WeakMap,Ur=new WeakMap,Vr=new WeakMap,es=new WeakMap,Ir=new WeakMap,Dr=new WeakMap,Pr=new WeakMap,Mr=new WeakMap,Br=new WeakMap,Xr=new WeakMap,Wr=new WeakSet,xo=function(){return $r(this,Jr)||ks(this,Jr,new Map)},go=function(){if(!$r(this,os)){const qr=$r(this,Vr).createElement("div"),{style:ts}=qr;ts.visibility="hidden",ts.contain="strict",ts.width=ts.height=0,ts.position="absolute",ts.top=ts.left=0,ts.zIndex=-1;const Yr=$r(this,Vr).createElementNS(dr,"svg");Yr.setAttribute("width",0),Yr.setAttribute("height",0),ks(this,os,$r(this,Vr).createElementNS(dr,"defs")),qr.append(Yr),Yr.append($r(this,os)),$r(this,Vr).body.append(qr)}return $r(this,os)},Rl=function(qr){const ts=$r(this,Vr).createElementNS(dr,"feColorMatrix");ts.setAttribute("type","matrix"),ts.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),qr.append(ts)},Lo=function(qr){const ts=$r(this,Vr).createElementNS(dr,"filter");return ts.setAttribute("color-interpolation-filters","sRGB"),ts.setAttribute("id",qr),$r(this,Wr,go).append(ts),ts},Io=function(qr,ts,Yr){const hs=$r(this,Vr).createElementNS(dr,ts);hs.setAttribute("type","discrete"),hs.setAttribute("tableValues",Yr),qr.append(hs)},Ro=function(qr,ts,Yr,hs){const ys=$r(this,Vr).createElementNS(dr,"feComponentTransfer");hs.append(ys),ws(this,Wr,Io).call(this,ys,"feFuncR",qr),ws(this,Wr,Io).call(this,ys,"feFuncG",ts),ws(this,Wr,Io).call(this,ys,"feFuncB",Yr)},Co=function(qr){return $r(this,Wr,go).style.color=qr,Lr(getComputedStyle($r(this,Wr,go)).getPropertyValue("color"))},or.DOMFilterFactory=pr;class mr extends cr.BaseCanvasFactory{constructor({ownerDocument:as=globalThis.document}={}){super(),this._document=as}_createCanvas(as,qr){const ts=this._document.createElement("canvas");return ts.width=as,ts.height=qr,ts}}or.DOMCanvasFactory=mr;async function fr(gs,as=!1){if(Tr(gs,document.baseURI)){const qr=await fetch(gs);if(!qr.ok)throw new Error(qr.statusText);return as?new Uint8Array(await qr.arrayBuffer()):(0,ur.stringToBytes)(await qr.text())}return new Promise((qr,ts)=>{const Yr=new XMLHttpRequest;Yr.open("GET",gs,!0),as&&(Yr.responseType="arraybuffer"),Yr.onreadystatechange=()=>{if(Yr.readyState===XMLHttpRequest.DONE){if(Yr.status===200||Yr.status===0){let hs;if(as&&Yr.response?hs=new Uint8Array(Yr.response):!as&&Yr.responseText&&(hs=(0,ur.stringToBytes)(Yr.responseText)),hs){qr(hs);return}}ts(new Error(Yr.statusText))}},Yr.send(null)})}class xr extends cr.BaseCMapReaderFactory{_fetchData(as,qr){return fr(as,this.isCompressed).then(ts=>({cMapData:ts,compressionType:qr}))}}or.DOMCMapReaderFactory=xr;class Er extends cr.BaseStandardFontDataFactory{_fetchData(as){return fr(as,!0)}}or.DOMStandardFontDataFactory=Er;class vr extends cr.BaseSVGFactory{_createSVG(as){return document.createElementNS(dr,as)}}or.DOMSVGFactory=vr;class gr{constructor({viewBox:as,scale:qr,rotation:ts,offsetX:Yr=0,offsetY:hs=0,dontFlip:ys=!1}){this.viewBox=as,this.scale=qr,this.rotation=ts,this.offsetX=Yr,this.offsetY=hs;const _s=(as[2]+as[0])/2,Ss=(as[3]+as[1])/2;let vs,Hs,Bs,na;switch(ts%=360,ts<0&&(ts+=360),ts){case 180:vs=-1,Hs=0,Bs=0,na=1;break;case 90:vs=0,Hs=1,Bs=1,na=0;break;case 270:vs=0,Hs=-1,Bs=-1,na=0;break;case 0:vs=1,Hs=0,Bs=0,na=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}ys&&(Bs=-Bs,na=-na);let Js,$a,Vs,xa;vs===0?(Js=Math.abs(Ss-as[1])*qr+Yr,$a=Math.abs(_s-as[0])*qr+hs,Vs=(as[3]-as[1])*qr,xa=(as[2]-as[0])*qr):(Js=Math.abs(_s-as[0])*qr+Yr,$a=Math.abs(Ss-as[1])*qr+hs,Vs=(as[2]-as[0])*qr,xa=(as[3]-as[1])*qr),this.transform=[vs*qr,Hs*qr,Bs*qr,na*qr,Js-vs*qr*_s-Bs*qr*Ss,$a-Hs*qr*_s-na*qr*Ss],this.width=Vs,this.height=xa}get rawDims(){const{viewBox:as}=this;return(0,ur.shadow)(this,"rawDims",{pageWidth:as[2]-as[0],pageHeight:as[3]-as[1],pageX:as[0],pageY:as[1]})}clone({scale:as=this.scale,rotation:qr=this.rotation,offsetX:ts=this.offsetX,offsetY:Yr=this.offsetY,dontFlip:hs=!1}={}){return new gr({viewBox:this.viewBox.slice(),scale:as,rotation:qr,offsetX:ts,offsetY:Yr,dontFlip:hs})}convertToViewportPoint(as,qr){return ur.Util.applyTransform([as,qr],this.transform)}convertToViewportRectangle(as){const qr=ur.Util.applyTransform([as[0],as[1]],this.transform),ts=ur.Util.applyTransform([as[2],as[3]],this.transform);return[qr[0],qr[1],ts[0],ts[1]]}convertToPdfPoint(as,qr){return ur.Util.applyInverseTransform([as,qr],this.transform)}}or.PageViewport=gr;class yr extends ur.BaseException{constructor(as,qr=0){super(as,"RenderingCancelledException"),this.extraDelay=qr}}or.RenderingCancelledException=yr;function br(gs){const as=gs.length;let qr=0;for(;qr<as&&gs[qr].trim()==="";)qr++;return gs.substring(qr,qr+5).toLowerCase()==="data:"}function _r(gs){return typeof gs=="string"&&/\.pdf$/i.test(gs)}function jr(gs,as=!1){return as||([gs]=gs.split(/[#?]/,1)),gs.substring(gs.lastIndexOf("/")+1)}function wr(gs,as="document.pdf"){if(typeof gs!="string")return as;if(br(gs))return(0,ur.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),as;const qr=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,ts=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Yr=qr.exec(gs);let hs=ts.exec(Yr[1])||ts.exec(Yr[2])||ts.exec(Yr[3]);if(hs&&(hs=hs[0],hs.includes("%")))try{hs=ts.exec(decodeURIComponent(hs))[0]}catch{}return hs||as}class Sr{constructor(){io(this,"started",Object.create(null));io(this,"times",[])}time(as){as in this.started&&(0,ur.warn)(`Timer is already running for ${as}`),this.started[as]=Date.now()}timeEnd(as){as in this.started||(0,ur.warn)(`Timer has not been started for ${as}`),this.times.push({name:as,start:this.started[as],end:Date.now()}),delete this.started[as]}toString(){const as=[];let qr=0;for(const{name:ts}of this.times)qr=Math.max(ts.length,qr);for(const{name:ts,start:Yr,end:hs}of this.times)as.push(`${ts.padEnd(qr)} ${hs-Yr}ms
`);return as.join("")}}or.StatTimer=Sr;function Tr(gs,as){try{const{protocol:qr}=as?new URL(gs,as):new URL(gs);return qr==="http:"||qr==="https:"}catch{return!1}}function Rr(gs){gs.preventDefault()}function Nr(gs,as=!1){return new Promise((qr,ts)=>{const Yr=document.createElement("script");Yr.src=gs,Yr.onload=function(hs){as&&Yr.remove(),qr(hs)},Yr.onerror=function(){ts(new Error(`Cannot load script at: ${Yr.src}`))},(document.head||document.documentElement).append(Yr)})}function Cr(gs){console.log("Deprecated API usage: "+gs)}let kr;class Ar{static toDateObject(as){if(!as||typeof as!="string")return null;kr||(kr=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const qr=kr.exec(as);if(!qr)return null;const ts=parseInt(qr[1],10);let Yr=parseInt(qr[2],10);Yr=Yr>=1&&Yr<=12?Yr-1:0;let hs=parseInt(qr[3],10);hs=hs>=1&&hs<=31?hs:1;let ys=parseInt(qr[4],10);ys=ys>=0&&ys<=23?ys:0;let _s=parseInt(qr[5],10);_s=_s>=0&&_s<=59?_s:0;let Ss=parseInt(qr[6],10);Ss=Ss>=0&&Ss<=59?Ss:0;const vs=qr[7]||"Z";let Hs=parseInt(qr[8],10);Hs=Hs>=0&&Hs<=23?Hs:0;let Bs=parseInt(qr[9],10)||0;return Bs=Bs>=0&&Bs<=59?Bs:0,vs==="-"?(ys+=Hs,_s+=Bs):vs==="+"&&(ys-=Hs,_s-=Bs),new Date(Date.UTC(ts,Yr,hs,ys,_s,Ss))}}or.PDFDateString=Ar;function Or(gs,{scale:as=1,rotation:qr=0}){const{width:ts,height:Yr}=gs.attributes.style,hs=[0,0,parseInt(ts),parseInt(Yr)];return new gr({viewBox:hs,scale:as,rotation:qr})}function Lr(gs){if(gs.startsWith("#")){const as=parseInt(gs.slice(1),16);return[(as&16711680)>>16,(as&65280)>>8,as&255]}return gs.startsWith("rgb(")?gs.slice(4,-1).split(",").map(as=>parseInt(as)):gs.startsWith("rgba(")?gs.slice(5,-1).split(",").map(as=>parseInt(as)).slice(0,3):((0,ur.warn)(`Not a valid color format: "${gs}"`),[0,0,0])}function Fr(gs){const as=document.createElement("span");as.style.visibility="hidden",document.body.append(as);for(const qr of gs.keys()){as.style.color=qr;const ts=window.getComputedStyle(as).color;gs.set(qr,Lr(ts))}as.remove()}function Hr(gs){const{a:as,b:qr,c:ts,d:Yr,e:hs,f:ys}=gs.getTransform();return[as,qr,ts,Yr,hs,ys]}function Kr(gs){const{a:as,b:qr,c:ts,d:Yr,e:hs,f:ys}=gs.getTransform().invertSelf();return[as,qr,ts,Yr,hs,ys]}function Gr(gs,as,qr=!1,ts=!0){if(as instanceof gr){const{pageWidth:Yr,pageHeight:hs}=as.rawDims,{style:ys}=gs,_s=ur.FeatureTest.isCSSRoundSupported,Ss=`var(--scale-factor) * ${Yr}px`,vs=`var(--scale-factor) * ${hs}px`,Hs=_s?`round(${Ss}, 1px)`:`calc(${Ss})`,Bs=_s?`round(${vs}, 1px)`:`calc(${vs})`;!qr||as.rotation%180===0?(ys.width=Hs,ys.height=Bs):(ys.width=Bs,ys.height=Hs)}ts&&gs.setAttribute("data-main-rotation",as.rotation)}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.BaseStandardFontDataFactory=or.BaseSVGFactory=or.BaseFilterFactory=or.BaseCanvasFactory=or.BaseCMapReaderFactory=void 0;var cr=lr(1);class ur{constructor(){this.constructor===ur&&(0,cr.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(xr){return"none"}addHCMFilter(xr,Er){return"none"}addHighlightHCMFilter(xr,Er,vr,gr){return"none"}destroy(xr=!1){}}or.BaseFilterFactory=ur;class dr{constructor(){this.constructor===dr&&(0,cr.unreachable)("Cannot initialize BaseCanvasFactory.")}create(xr,Er){if(xr<=0||Er<=0)throw new Error("Invalid canvas size");const vr=this._createCanvas(xr,Er);return{canvas:vr,context:vr.getContext("2d")}}reset(xr,Er,vr){if(!xr.canvas)throw new Error("Canvas is not specified");if(Er<=0||vr<=0)throw new Error("Invalid canvas size");xr.canvas.width=Er,xr.canvas.height=vr}destroy(xr){if(!xr.canvas)throw new Error("Canvas is not specified");xr.canvas.width=0,xr.canvas.height=0,xr.canvas=null,xr.context=null}_createCanvas(xr,Er){(0,cr.unreachable)("Abstract method `_createCanvas` called.")}}or.BaseCanvasFactory=dr;class hr{constructor({baseUrl:xr=null,isCompressed:Er=!0}){this.constructor===hr&&(0,cr.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=xr,this.isCompressed=Er}async fetch({name:xr}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!xr)throw new Error("CMap name must be specified.");const Er=this.baseUrl+xr+(this.isCompressed?".bcmap":""),vr=this.isCompressed?cr.CMapCompressionType.BINARY:cr.CMapCompressionType.NONE;return this._fetchData(Er,vr).catch(gr=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${Er}`)})}_fetchData(xr,Er){(0,cr.unreachable)("Abstract method `_fetchData` called.")}}or.BaseCMapReaderFactory=hr;class pr{constructor({baseUrl:xr=null}){this.constructor===pr&&(0,cr.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=xr}async fetch({filename:xr}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!xr)throw new Error("Font filename must be specified.");const Er=`${this.baseUrl}${xr}`;return this._fetchData(Er).catch(vr=>{throw new Error(`Unable to load font data at: ${Er}`)})}_fetchData(xr){(0,cr.unreachable)("Abstract method `_fetchData` called.")}}or.BaseStandardFontDataFactory=pr;class mr{constructor(){this.constructor===mr&&(0,cr.unreachable)("Cannot initialize BaseSVGFactory.")}create(xr,Er,vr=!1){if(xr<=0||Er<=0)throw new Error("Invalid SVG dimensions");const gr=this._createSVG("svg:svg");return gr.setAttribute("version","1.1"),vr||(gr.setAttribute("width",`${xr}px`),gr.setAttribute("height",`${Er}px`)),gr.setAttribute("preserveAspectRatio","none"),gr.setAttribute("viewBox",`0 0 ${xr} ${Er}`),gr}createElement(xr){if(typeof xr!="string")throw new Error("Invalid SVG element type");return this._createSVG(xr)}_createSVG(xr){(0,cr.unreachable)("Abstract method `_createSVG` called.")}}or.BaseSVGFactory=mr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.MurmurHash3_64=void 0;var cr=lr(1);const ur=3285377520,dr=4294901760,hr=65535;class pr{constructor(fr){this.h1=fr?fr&4294967295:ur,this.h2=fr?fr&4294967295:ur}update(fr){let xr,Er;if(typeof fr=="string"){xr=new Uint8Array(fr.length*2),Er=0;for(let Cr=0,kr=fr.length;Cr<kr;Cr++){const Ar=fr.charCodeAt(Cr);Ar<=255?xr[Er++]=Ar:(xr[Er++]=Ar>>>8,xr[Er++]=Ar&255)}}else if((0,cr.isArrayBuffer)(fr))xr=fr.slice(),Er=xr.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const vr=Er>>2,gr=Er-vr*4,yr=new Uint32Array(xr.buffer,0,vr);let br=0,_r=0,jr=this.h1,wr=this.h2;const Sr=3432918353,Tr=461845907,Rr=Sr&hr,Nr=Tr&hr;for(let Cr=0;Cr<vr;Cr++)Cr&1?(br=yr[Cr],br=br*Sr&dr|br*Rr&hr,br=br<<15|br>>>17,br=br*Tr&dr|br*Nr&hr,jr^=br,jr=jr<<13|jr>>>19,jr=jr*5+3864292196):(_r=yr[Cr],_r=_r*Sr&dr|_r*Rr&hr,_r=_r<<15|_r>>>17,_r=_r*Tr&dr|_r*Nr&hr,wr^=_r,wr=wr<<13|wr>>>19,wr=wr*5+3864292196);switch(br=0,gr){case 3:br^=xr[vr*4+2]<<16;case 2:br^=xr[vr*4+1]<<8;case 1:br^=xr[vr*4],br=br*Sr&dr|br*Rr&hr,br=br<<15|br>>>17,br=br*Tr&dr|br*Nr&hr,vr&1?jr^=br:wr^=br}this.h1=jr,this.h2=wr}hexdigest(){let fr=this.h1,xr=this.h2;return fr^=xr>>>1,fr=fr*3981806797&dr|fr*36045&hr,xr=xr*4283543511&dr|((xr<<16|fr>>>16)*2950163797&dr)>>>16,fr^=xr>>>1,fr=fr*444984403&dr|fr*60499&hr,xr=xr*3301882366&dr|((xr<<16|fr>>>16)*3120437893&dr)>>>16,fr^=xr>>>1,(fr>>>0).toString(16).padStart(8,"0")+(xr>>>0).toString(16).padStart(8,"0")}}or.MurmurHash3_64=pr},(ar,or,lr)=>{var hr;Object.defineProperty(or,"__esModule",{value:!0}),or.FontLoader=or.FontFaceObject=void 0;var cr=lr(1);class ur{constructor({ownerDocument:mr=globalThis.document,styleElement:fr=null}){Ns(this,hr,new Set);this._document=mr,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(mr){this.nativeFontFaces.add(mr),this._document.fonts.add(mr)}removeNativeFontFace(mr){this.nativeFontFaces.delete(mr),this._document.fonts.delete(mr)}insertRule(mr){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const fr=this.styleElement.sheet;fr.insertRule(mr,fr.cssRules.length)}clear(){for(const mr of this.nativeFontFaces)this._document.fonts.delete(mr);this.nativeFontFaces.clear(),$r(this,hr).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(mr){if(!(!mr||$r(this,hr).has(mr.loadedName))){if((0,cr.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:fr,src:xr,style:Er}=mr,vr=new FontFace(fr,xr,Er);this.addNativeFontFace(vr);try{await vr.load(),$r(this,hr).add(fr)}catch{(0,cr.warn)(`Cannot load system font: ${mr.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(vr)}return}(0,cr.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(mr){if(mr.attached||mr.missingFile&&!mr.systemFontInfo)return;if(mr.attached=!0,mr.systemFontInfo){await this.loadSystemFont(mr.systemFontInfo);return}if(this.isFontLoadingAPISupported){const xr=mr.createNativeFontFace();if(xr){this.addNativeFontFace(xr);try{await xr.loaded}catch(Er){throw(0,cr.warn)(`Failed to load font '${xr.family}': '${Er}'.`),mr.disableFontFace=!0,Er}}return}const fr=mr.createFontFaceRule();if(fr){if(this.insertRule(fr),this.isSyncFontLoadingSupported)return;await new Promise(xr=>{const Er=this._queueLoadingCallback(xr);this._prepareFontLoadEvent(mr,Er)})}}get isFontLoadingAPISupported(){var fr;const mr=!!((fr=this._document)!=null&&fr.fonts);return(0,cr.shadow)(this,"isFontLoadingAPISupported",mr)}get isSyncFontLoadingSupported(){let mr=!1;return(cr.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(mr=!0),(0,cr.shadow)(this,"isSyncFontLoadingSupported",mr)}_queueLoadingCallback(mr){function fr(){for((0,cr.assert)(!Er.done,"completeRequest() cannot be called twice."),Er.done=!0;xr.length>0&&xr[0].done;){const vr=xr.shift();setTimeout(vr.callback,0)}}const{loadingRequests:xr}=this,Er={done:!1,complete:fr,callback:mr};return xr.push(Er),Er}get _loadTestFont(){const mr=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,cr.shadow)(this,"_loadTestFont",mr)}_prepareFontLoadEvent(mr,fr){function xr(Lr,Fr){return Lr.charCodeAt(Fr)<<24|Lr.charCodeAt(Fr+1)<<16|Lr.charCodeAt(Fr+2)<<8|Lr.charCodeAt(Fr+3)&255}function Er(Lr,Fr,Hr,Kr){const Gr=Lr.substring(0,Fr),Zr=Lr.substring(Fr+Hr);return Gr+Kr+Zr}let vr,gr;const yr=this._document.createElement("canvas");yr.width=1,yr.height=1;const br=yr.getContext("2d");let _r=0;function jr(Lr,Fr){if(++_r>30){(0,cr.warn)("Load test font never loaded."),Fr();return}if(br.font="30px "+Lr,br.fillText(".",0,20),br.getImageData(0,0,1,1).data[3]>0){Fr();return}setTimeout(jr.bind(null,Lr,Fr))}const wr=`lt${Date.now()}${this.loadTestFontId++}`;let Sr=this._loadTestFont;Sr=Er(Sr,976,wr.length,wr);const Rr=16,Nr=1482184792;let Cr=xr(Sr,Rr);for(vr=0,gr=wr.length-3;vr<gr;vr+=4)Cr=Cr-Nr+xr(wr,vr)|0;vr<wr.length&&(Cr=Cr-Nr+xr(wr+"XXX",vr)|0),Sr=Er(Sr,Rr,4,(0,cr.string32)(Cr));const kr=`url(data:font/opentype;base64,${btoa(Sr)});`,Ar=`@font-face {font-family:"${wr}";src:${kr}}`;this.insertRule(Ar);const Or=this._document.createElement("div");Or.style.visibility="hidden",Or.style.width=Or.style.height="10px",Or.style.position="absolute",Or.style.top=Or.style.left="0px";for(const Lr of[mr.loadedName,wr]){const Fr=this._document.createElement("span");Fr.textContent="Hi",Fr.style.fontFamily=Lr,Or.append(Fr)}this._document.body.append(Or),jr(wr,()=>{Or.remove(),fr.complete()})}}hr=new WeakMap,or.FontLoader=ur;class dr{constructor(mr,{isEvalSupported:fr=!0,disableFontFace:xr=!1,ignoreErrors:Er=!1,inspectFont:vr=null}){this.compiledGlyphs=Object.create(null);for(const gr in mr)this[gr]=mr[gr];this.isEvalSupported=fr!==!1,this.disableFontFace=xr===!0,this.ignoreErrors=Er===!0,this._inspectFont=vr}createNativeFontFace(){var fr;if(!this.data||this.disableFontFace)return null;let mr;if(!this.cssFontInfo)mr=new FontFace(this.loadedName,this.data,{});else{const xr={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(xr.style=`oblique ${this.cssFontInfo.italicAngle}deg`),mr=new FontFace(this.cssFontInfo.fontFamily,this.data,xr)}return(fr=this._inspectFont)==null||fr.call(this,this),mr}createFontFaceRule(){var Er;if(!this.data||this.disableFontFace)return null;const mr=(0,cr.bytesToString)(this.data),fr=`url(data:${this.mimetype};base64,${btoa(mr)});`;let xr;if(!this.cssFontInfo)xr=`@font-face {font-family:"${this.loadedName}";src:${fr}}`;else{let vr=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(vr+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),xr=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${vr}src:${fr}}`}return(Er=this._inspectFont)==null||Er.call(this,this,fr),xr}getPathGenerator(mr,fr){if(this.compiledGlyphs[fr]!==void 0)return this.compiledGlyphs[fr];let xr;try{xr=mr.get(this.loadedName+"_path_"+fr)}catch(Er){if(!this.ignoreErrors)throw Er;return(0,cr.warn)(`getPathGenerator - ignoring character: "${Er}".`),this.compiledGlyphs[fr]=function(vr,gr){}}if(this.isEvalSupported&&cr.FeatureTest.isEvalSupported){const Er=[];for(const vr of xr){const gr=vr.args!==void 0?vr.args.join(","):"";Er.push("c.",vr.cmd,"(",gr,`);
`)}return this.compiledGlyphs[fr]=new Function("c","size",Er.join(""))}return this.compiledGlyphs[fr]=function(Er,vr){for(const gr of xr)gr.cmd==="scale"&&(gr.args=[vr,-vr]),Er[gr.cmd].apply(Er,gr.args)}}}or.FontFaceObject=dr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.NodeStandardFontDataFactory=or.NodeFilterFactory=or.NodeCanvasFactory=or.NodeCMapReaderFactory=void 0;var cr=lr(7);lr(1);const ur=function(fr){return new Promise((xr,Er)=>{require$$5.readFile(fr,(gr,yr)=>{if(gr||!yr){Er(new Error(gr));return}xr(new Uint8Array(yr))})})};class dr extends cr.BaseFilterFactory{}or.NodeFilterFactory=dr;class hr extends cr.BaseCanvasFactory{_createCanvas(xr,Er){return require$$5.createCanvas(xr,Er)}}or.NodeCanvasFactory=hr;class pr extends cr.BaseCMapReaderFactory{_fetchData(xr,Er){return ur(xr).then(vr=>({cMapData:vr,compressionType:Er}))}}or.NodeCMapReaderFactory=pr;class mr extends cr.BaseStandardFontDataFactory{_fetchData(xr){return ur(xr)}}or.NodeStandardFontDataFactory=mr},(ar,or,lr)=>{var os,Cl,Nl;Object.defineProperty(or,"__esModule",{value:!0}),or.CanvasGraphics=void 0;var cr=lr(1),ur=lr(6),dr=lr(12),hr=lr(13);const pr=16,mr=100,fr=4096,xr=15,Er=10,vr=1e3,gr=16;function yr(Ir,Dr){if(Ir._removeMirroring)throw new Error("Context is already forwarding operations.");Ir.__originalSave=Ir.save,Ir.__originalRestore=Ir.restore,Ir.__originalRotate=Ir.rotate,Ir.__originalScale=Ir.scale,Ir.__originalTranslate=Ir.translate,Ir.__originalTransform=Ir.transform,Ir.__originalSetTransform=Ir.setTransform,Ir.__originalResetTransform=Ir.resetTransform,Ir.__originalClip=Ir.clip,Ir.__originalMoveTo=Ir.moveTo,Ir.__originalLineTo=Ir.lineTo,Ir.__originalBezierCurveTo=Ir.bezierCurveTo,Ir.__originalRect=Ir.rect,Ir.__originalClosePath=Ir.closePath,Ir.__originalBeginPath=Ir.beginPath,Ir._removeMirroring=()=>{Ir.save=Ir.__originalSave,Ir.restore=Ir.__originalRestore,Ir.rotate=Ir.__originalRotate,Ir.scale=Ir.__originalScale,Ir.translate=Ir.__originalTranslate,Ir.transform=Ir.__originalTransform,Ir.setTransform=Ir.__originalSetTransform,Ir.resetTransform=Ir.__originalResetTransform,Ir.clip=Ir.__originalClip,Ir.moveTo=Ir.__originalMoveTo,Ir.lineTo=Ir.__originalLineTo,Ir.bezierCurveTo=Ir.__originalBezierCurveTo,Ir.rect=Ir.__originalRect,Ir.closePath=Ir.__originalClosePath,Ir.beginPath=Ir.__originalBeginPath,delete Ir._removeMirroring},Ir.save=function(){Dr.save(),this.__originalSave()},Ir.restore=function(){Dr.restore(),this.__originalRestore()},Ir.translate=function(Mr,Br){Dr.translate(Mr,Br),this.__originalTranslate(Mr,Br)},Ir.scale=function(Mr,Br){Dr.scale(Mr,Br),this.__originalScale(Mr,Br)},Ir.transform=function(Mr,Br,Xr,Wr,ss,ds){Dr.transform(Mr,Br,Xr,Wr,ss,ds),this.__originalTransform(Mr,Br,Xr,Wr,ss,ds)},Ir.setTransform=function(Mr,Br,Xr,Wr,ss,ds){Dr.setTransform(Mr,Br,Xr,Wr,ss,ds),this.__originalSetTransform(Mr,Br,Xr,Wr,ss,ds)},Ir.resetTransform=function(){Dr.resetTransform(),this.__originalResetTransform()},Ir.rotate=function(Mr){Dr.rotate(Mr),this.__originalRotate(Mr)},Ir.clip=function(Mr){Dr.clip(Mr),this.__originalClip(Mr)},Ir.moveTo=function(Pr,Mr){Dr.moveTo(Pr,Mr),this.__originalMoveTo(Pr,Mr)},Ir.lineTo=function(Pr,Mr){Dr.lineTo(Pr,Mr),this.__originalLineTo(Pr,Mr)},Ir.bezierCurveTo=function(Pr,Mr,Br,Xr,Wr,ss){Dr.bezierCurveTo(Pr,Mr,Br,Xr,Wr,ss),this.__originalBezierCurveTo(Pr,Mr,Br,Xr,Wr,ss)},Ir.rect=function(Pr,Mr,Br,Xr){Dr.rect(Pr,Mr,Br,Xr),this.__originalRect(Pr,Mr,Br,Xr)},Ir.closePath=function(){Dr.closePath(),this.__originalClosePath()},Ir.beginPath=function(){Dr.beginPath(),this.__originalBeginPath()}}class br{constructor(Dr){this.canvasFactory=Dr,this.cache=Object.create(null)}getCanvas(Dr,Pr,Mr){let Br;return this.cache[Dr]!==void 0?(Br=this.cache[Dr],this.canvasFactory.reset(Br,Pr,Mr)):(Br=this.canvasFactory.create(Pr,Mr),this.cache[Dr]=Br),Br}delete(Dr){delete this.cache[Dr]}clear(){for(const Dr in this.cache){const Pr=this.cache[Dr];this.canvasFactory.destroy(Pr),delete this.cache[Dr]}}}function _r(Ir,Dr,Pr,Mr,Br,Xr,Wr,ss,ds,ns){const[fs,bs,Es,Ds,gs,as]=(0,ur.getCurrentTransform)(Ir);if(bs===0&&Es===0){const Yr=Wr*fs+gs,hs=Math.round(Yr),ys=ss*Ds+as,_s=Math.round(ys),Ss=(Wr+ds)*fs+gs,vs=Math.abs(Math.round(Ss)-hs)||1,Hs=(ss+ns)*Ds+as,Bs=Math.abs(Math.round(Hs)-_s)||1;return Ir.setTransform(Math.sign(fs),0,0,Math.sign(Ds),hs,_s),Ir.drawImage(Dr,Pr,Mr,Br,Xr,0,0,vs,Bs),Ir.setTransform(fs,bs,Es,Ds,gs,as),[vs,Bs]}if(fs===0&&Ds===0){const Yr=ss*Es+gs,hs=Math.round(Yr),ys=Wr*bs+as,_s=Math.round(ys),Ss=(ss+ns)*Es+gs,vs=Math.abs(Math.round(Ss)-hs)||1,Hs=(Wr+ds)*bs+as,Bs=Math.abs(Math.round(Hs)-_s)||1;return Ir.setTransform(0,Math.sign(bs),Math.sign(Es),0,hs,_s),Ir.drawImage(Dr,Pr,Mr,Br,Xr,0,0,Bs,vs),Ir.setTransform(fs,bs,Es,Ds,gs,as),[Bs,vs]}Ir.drawImage(Dr,Pr,Mr,Br,Xr,Wr,ss,ds,ns);const qr=Math.hypot(fs,bs),ts=Math.hypot(Es,Ds);return[qr*ds,ts*ns]}function jr(Ir){const{width:Dr,height:Pr}=Ir;if(Dr>vr||Pr>vr)return null;const Mr=1e3,Br=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),Xr=Dr+1;let Wr=new Uint8Array(Xr*(Pr+1)),ss,ds,ns;const fs=Dr+7&-8;let bs=new Uint8Array(fs*Pr),Es=0;for(const ts of Ir.data){let Yr=128;for(;Yr>0;)bs[Es++]=ts&Yr?0:255,Yr>>=1}let Ds=0;for(Es=0,bs[Es]!==0&&(Wr[0]=1,++Ds),ds=1;ds<Dr;ds++)bs[Es]!==bs[Es+1]&&(Wr[ds]=bs[Es]?2:1,++Ds),Es++;for(bs[Es]!==0&&(Wr[ds]=2,++Ds),ss=1;ss<Pr;ss++){Es=ss*fs,ns=ss*Xr,bs[Es-fs]!==bs[Es]&&(Wr[ns]=bs[Es]?1:8,++Ds);let ts=(bs[Es]?4:0)+(bs[Es-fs]?8:0);for(ds=1;ds<Dr;ds++)ts=(ts>>2)+(bs[Es+1]?4:0)+(bs[Es-fs+1]?8:0),Br[ts]&&(Wr[ns+ds]=Br[ts],++Ds),Es++;if(bs[Es-fs]!==bs[Es]&&(Wr[ns+ds]=bs[Es]?2:4,++Ds),Ds>Mr)return null}for(Es=fs*(Pr-1),ns=ss*Xr,bs[Es]!==0&&(Wr[ns]=8,++Ds),ds=1;ds<Dr;ds++)bs[Es]!==bs[Es+1]&&(Wr[ns+ds]=bs[Es]?4:8,++Ds),Es++;if(bs[Es]!==0&&(Wr[ns+ds]=4,++Ds),Ds>Mr)return null;const gs=new Int32Array([0,Xr,-1,0,-Xr,0,0,0,1]),as=new Path2D;for(ss=0;Ds&&ss<=Pr;ss++){let ts=ss*Xr;const Yr=ts+Dr;for(;ts<Yr&&!Wr[ts];)ts++;if(ts===Yr)continue;as.moveTo(ts%Xr,ss);const hs=ts;let ys=Wr[ts];do{const _s=gs[ys];do ts+=_s;while(!Wr[ts]);const Ss=Wr[ts];Ss!==5&&Ss!==10?(ys=Ss,Wr[ts]=0):(ys=Ss&51*ys>>4,Wr[ts]&=ys>>2|ys<<2),as.lineTo(ts%Xr,ts/Xr|0),Wr[ts]||--Ds}while(hs!==ts);--ss}return bs=null,Wr=null,function(ts){ts.save(),ts.scale(1/Dr,-1/Pr),ts.translate(0,-Pr),ts.fill(as),ts.beginPath(),ts.restore()}}class wr{constructor(Dr,Pr){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=cr.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=cr.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=cr.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,Dr,Pr])}clone(){const Dr=Object.create(this);return Dr.clipBox=this.clipBox.slice(),Dr}setCurrentPoint(Dr,Pr){this.x=Dr,this.y=Pr}updatePathMinMax(Dr,Pr,Mr){[Pr,Mr]=cr.Util.applyTransform([Pr,Mr],Dr),this.minX=Math.min(this.minX,Pr),this.minY=Math.min(this.minY,Mr),this.maxX=Math.max(this.maxX,Pr),this.maxY=Math.max(this.maxY,Mr)}updateRectMinMax(Dr,Pr){const Mr=cr.Util.applyTransform(Pr,Dr),Br=cr.Util.applyTransform(Pr.slice(2),Dr);this.minX=Math.min(this.minX,Mr[0],Br[0]),this.minY=Math.min(this.minY,Mr[1],Br[1]),this.maxX=Math.max(this.maxX,Mr[0],Br[0]),this.maxY=Math.max(this.maxY,Mr[1],Br[1])}updateScalingPathMinMax(Dr,Pr){cr.Util.scaleMinMax(Dr,Pr),this.minX=Math.min(this.minX,Pr[0]),this.maxX=Math.max(this.maxX,Pr[1]),this.minY=Math.min(this.minY,Pr[2]),this.maxY=Math.max(this.maxY,Pr[3])}updateCurvePathMinMax(Dr,Pr,Mr,Br,Xr,Wr,ss,ds,ns,fs){const bs=cr.Util.bezierBoundingBox(Pr,Mr,Br,Xr,Wr,ss,ds,ns);if(fs){fs[0]=Math.min(fs[0],bs[0],bs[2]),fs[1]=Math.max(fs[1],bs[0],bs[2]),fs[2]=Math.min(fs[2],bs[1],bs[3]),fs[3]=Math.max(fs[3],bs[1],bs[3]);return}this.updateRectMinMax(Dr,bs)}getPathBoundingBox(Dr=dr.PathType.FILL,Pr=null){const Mr=[this.minX,this.minY,this.maxX,this.maxY];if(Dr===dr.PathType.STROKE){Pr||(0,cr.unreachable)("Stroke bounding box must include transform.");const Br=cr.Util.singularValueDecompose2dScale(Pr),Xr=Br[0]*this.lineWidth/2,Wr=Br[1]*this.lineWidth/2;Mr[0]-=Xr,Mr[1]-=Wr,Mr[2]+=Xr,Mr[3]+=Wr}return Mr}updateClipFromPath(){const Dr=cr.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(Dr||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(Dr){this.clipBox=Dr,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(Dr=dr.PathType.FILL,Pr=null){return cr.Util.intersect(this.clipBox,this.getPathBoundingBox(Dr,Pr))}}function Sr(Ir,Dr){if(typeof ImageData<"u"&&Dr instanceof ImageData){Ir.putImageData(Dr,0,0);return}const Pr=Dr.height,Mr=Dr.width,Br=Pr%gr,Xr=(Pr-Br)/gr,Wr=Br===0?Xr:Xr+1,ss=Ir.createImageData(Mr,gr);let ds=0,ns;const fs=Dr.data,bs=ss.data;let Es,Ds,gs,as;if(Dr.kind===cr.ImageKind.GRAYSCALE_1BPP){const qr=fs.byteLength,ts=new Uint32Array(bs.buffer,0,bs.byteLength>>2),Yr=ts.length,hs=Mr+7>>3,ys=4294967295,_s=cr.FeatureTest.isLittleEndian?4278190080:255;for(Es=0;Es<Wr;Es++){for(gs=Es<Xr?gr:Br,ns=0,Ds=0;Ds<gs;Ds++){const Ss=qr-ds;let vs=0;const Hs=Ss>hs?Mr:Ss*8-7,Bs=Hs&-8;let na=0,Js=0;for(;vs<Bs;vs+=8)Js=fs[ds++],ts[ns++]=Js&128?ys:_s,ts[ns++]=Js&64?ys:_s,ts[ns++]=Js&32?ys:_s,ts[ns++]=Js&16?ys:_s,ts[ns++]=Js&8?ys:_s,ts[ns++]=Js&4?ys:_s,ts[ns++]=Js&2?ys:_s,ts[ns++]=Js&1?ys:_s;for(;vs<Hs;vs++)na===0&&(Js=fs[ds++],na=128),ts[ns++]=Js&na?ys:_s,na>>=1}for(;ns<Yr;)ts[ns++]=0;Ir.putImageData(ss,0,Es*gr)}}else if(Dr.kind===cr.ImageKind.RGBA_32BPP){for(Ds=0,as=Mr*gr*4,Es=0;Es<Xr;Es++)bs.set(fs.subarray(ds,ds+as)),ds+=as,Ir.putImageData(ss,0,Ds),Ds+=gr;Es<Wr&&(as=Mr*Br*4,bs.set(fs.subarray(ds,ds+as)),Ir.putImageData(ss,0,Ds))}else if(Dr.kind===cr.ImageKind.RGB_24BPP)for(gs=gr,as=Mr*gs,Es=0;Es<Wr;Es++){for(Es>=Xr&&(gs=Br,as=Mr*gs),ns=0,Ds=as;Ds--;)bs[ns++]=fs[ds++],bs[ns++]=fs[ds++],bs[ns++]=fs[ds++],bs[ns++]=255;Ir.putImageData(ss,0,Es*gr)}else throw new Error(`bad image kind: ${Dr.kind}`)}function Tr(Ir,Dr){if(Dr.bitmap){Ir.drawImage(Dr.bitmap,0,0);return}const Pr=Dr.height,Mr=Dr.width,Br=Pr%gr,Xr=(Pr-Br)/gr,Wr=Br===0?Xr:Xr+1,ss=Ir.createImageData(Mr,gr);let ds=0;const ns=Dr.data,fs=ss.data;for(let bs=0;bs<Wr;bs++){const Es=bs<Xr?gr:Br;({srcPos:ds}=(0,hr.convertBlackAndWhiteToRGBA)({src:ns,srcPos:ds,dest:fs,width:Mr,height:Es,nonBlackColor:0})),Ir.putImageData(ss,0,bs*gr)}}function Rr(Ir,Dr){const Pr=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const Mr of Pr)Ir[Mr]!==void 0&&(Dr[Mr]=Ir[Mr]);Ir.setLineDash!==void 0&&(Dr.setLineDash(Ir.getLineDash()),Dr.lineDashOffset=Ir.lineDashOffset)}function Nr(Ir){if(Ir.strokeStyle=Ir.fillStyle="#000000",Ir.fillRule="nonzero",Ir.globalAlpha=1,Ir.lineWidth=1,Ir.lineCap="butt",Ir.lineJoin="miter",Ir.miterLimit=10,Ir.globalCompositeOperation="source-over",Ir.font="10px sans-serif",Ir.setLineDash!==void 0&&(Ir.setLineDash([]),Ir.lineDashOffset=0),!cr.isNodeJS){const{filter:Dr}=Ir;Dr!=="none"&&Dr!==""&&(Ir.filter="none")}}function Cr(Ir,Dr,Pr,Mr){const Br=Ir.length;for(let Xr=3;Xr<Br;Xr+=4){const Wr=Ir[Xr];if(Wr===0)Ir[Xr-3]=Dr,Ir[Xr-2]=Pr,Ir[Xr-1]=Mr;else if(Wr<255){const ss=255-Wr;Ir[Xr-3]=Ir[Xr-3]*Wr+Dr*ss>>8,Ir[Xr-2]=Ir[Xr-2]*Wr+Pr*ss>>8,Ir[Xr-1]=Ir[Xr-1]*Wr+Mr*ss>>8}}}function kr(Ir,Dr,Pr){const Mr=Ir.length,Br=1/255;for(let Xr=3;Xr<Mr;Xr+=4){const Wr=Pr?Pr[Ir[Xr]]:Ir[Xr];Dr[Xr]=Dr[Xr]*Wr*Br|0}}function Ar(Ir,Dr,Pr){const Mr=Ir.length;for(let Br=3;Br<Mr;Br+=4){const Xr=Ir[Br-3]*77+Ir[Br-2]*152+Ir[Br-1]*28;Dr[Br]=Pr?Dr[Br]*Pr[Xr>>8]>>8:Dr[Br]*Xr>>16}}function Or(Ir,Dr,Pr,Mr,Br,Xr,Wr,ss,ds,ns,fs){const bs=!!Xr,Es=bs?Xr[0]:0,Ds=bs?Xr[1]:0,gs=bs?Xr[2]:0,as=Br==="Luminosity"?Ar:kr,ts=Math.min(Mr,Math.ceil(1048576/Pr));for(let Yr=0;Yr<Mr;Yr+=ts){const hs=Math.min(ts,Mr-Yr),ys=Ir.getImageData(ss-ns,Yr+(ds-fs),Pr,hs),_s=Dr.getImageData(ss,Yr+ds,Pr,hs);bs&&Cr(ys.data,Es,Ds,gs),as(ys.data,_s.data,Wr),Dr.putImageData(_s,ss,Yr+ds)}}function Lr(Ir,Dr,Pr,Mr){const Br=Mr[0],Xr=Mr[1],Wr=Mr[2]-Br,ss=Mr[3]-Xr;Wr===0||ss===0||(Or(Dr.context,Pr,Wr,ss,Dr.subtype,Dr.backdrop,Dr.transferMap,Br,Xr,Dr.offsetX,Dr.offsetY),Ir.save(),Ir.globalAlpha=1,Ir.globalCompositeOperation="source-over",Ir.setTransform(1,0,0,1,0,0),Ir.drawImage(Pr.canvas,0,0),Ir.restore())}function Fr(Ir,Dr){const Pr=cr.Util.singularValueDecompose2dScale(Ir);Pr[0]=Math.fround(Pr[0]),Pr[1]=Math.fround(Pr[1]);const Mr=Math.fround((globalThis.devicePixelRatio||1)*ur.PixelsPerInch.PDF_TO_CSS_UNITS);return Dr!==void 0?Dr:Pr[0]<=Mr||Pr[1]<=Mr}const Hr=["butt","round","square"],Kr=["miter","round","bevel"],Gr={},Zr={},es=class es{constructor(Dr,Pr,Mr,Br,Xr,{optionalContentConfig:Wr,markedContentStack:ss=null},ds,ns){Ns(this,os);this.ctx=Dr,this.current=new wr(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=Pr,this.objs=Mr,this.canvasFactory=Br,this.filterFactory=Xr,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=ss||[],this.optionalContentConfig=Wr,this.cachedCanvases=new br(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=ds,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=ns,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(Dr,Pr=null){return typeof Dr=="string"?Dr.startsWith("g_")?this.commonObjs.get(Dr):this.objs.get(Dr):Pr}beginDrawing({transform:Dr,viewport:Pr,transparency:Mr=!1,background:Br=null}){const Xr=this.ctx.canvas.width,Wr=this.ctx.canvas.height,ss=this.ctx.fillStyle;if(this.ctx.fillStyle=Br||"#ffffff",this.ctx.fillRect(0,0,Xr,Wr),this.ctx.fillStyle=ss,Mr){const ds=this.cachedCanvases.getCanvas("transparent",Xr,Wr);this.compositeCtx=this.ctx,this.transparentCanvas=ds.canvas,this.ctx=ds.context,this.ctx.save(),this.ctx.transform(...(0,ur.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),Nr(this.ctx),Dr&&(this.ctx.transform(...Dr),this.outputScaleX=Dr[0],this.outputScaleY=Dr[0]),this.ctx.transform(...Pr.transform),this.viewportScale=Pr.scale,this.baseTransform=(0,ur.getCurrentTransform)(this.ctx)}executeOperatorList(Dr,Pr,Mr,Br){const Xr=Dr.argsArray,Wr=Dr.fnArray;let ss=Pr||0;const ds=Xr.length;if(ds===ss)return ss;const ns=ds-ss>Er&&typeof Mr=="function",fs=ns?Date.now()+xr:0;let bs=0;const Es=this.commonObjs,Ds=this.objs;let gs;for(;;){if(Br!==void 0&&ss===Br.nextBreakPoint)return Br.breakIt(ss,Mr),ss;if(gs=Wr[ss],gs!==cr.OPS.dependency)this[gs].apply(this,Xr[ss]);else for(const as of Xr[ss]){const qr=as.startsWith("g_")?Es:Ds;if(!qr.has(as))return qr.get(as,Mr),ss}if(ss++,ss===ds)return ss;if(ns&&++bs>Er){if(Date.now()>fs)return Mr(),ss;bs=0}}}endDrawing(){ws(this,os,Cl).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const Dr of this._cachedBitmapsMap.values()){for(const Pr of Dr.values())typeof HTMLCanvasElement<"u"&&Pr instanceof HTMLCanvasElement&&(Pr.width=Pr.height=0);Dr.clear()}this._cachedBitmapsMap.clear(),ws(this,os,Nl).call(this)}_scaleImage(Dr,Pr){const Mr=Dr.width,Br=Dr.height;let Xr=Math.max(Math.hypot(Pr[0],Pr[1]),1),Wr=Math.max(Math.hypot(Pr[2],Pr[3]),1),ss=Mr,ds=Br,ns="prescale1",fs,bs;for(;Xr>2&&ss>1||Wr>2&&ds>1;){let Es=ss,Ds=ds;Xr>2&&ss>1&&(Es=ss>=16384?Math.floor(ss/2)-1||1:Math.ceil(ss/2),Xr/=ss/Es),Wr>2&&ds>1&&(Ds=ds>=16384?Math.floor(ds/2)-1||1:Math.ceil(ds)/2,Wr/=ds/Ds),fs=this.cachedCanvases.getCanvas(ns,Es,Ds),bs=fs.context,bs.clearRect(0,0,Es,Ds),bs.drawImage(Dr,0,0,ss,ds,0,0,Es,Ds),Dr=fs.canvas,ss=Es,ds=Ds,ns=ns==="prescale1"?"prescale2":"prescale1"}return{img:Dr,paintWidth:ss,paintHeight:ds}}_createMaskCanvas(Dr){const Pr=this.ctx,{width:Mr,height:Br}=Dr,Xr=this.current.fillColor,Wr=this.current.patternFill,ss=(0,ur.getCurrentTransform)(Pr);let ds,ns,fs,bs;if((Dr.bitmap||Dr.data)&&Dr.count>1){const vs=Dr.bitmap||Dr.data.buffer;ns=JSON.stringify(Wr?ss:[ss.slice(0,4),Xr]),ds=this._cachedBitmapsMap.get(vs),ds||(ds=new Map,this._cachedBitmapsMap.set(vs,ds));const Hs=ds.get(ns);if(Hs&&!Wr){const Bs=Math.round(Math.min(ss[0],ss[2])+ss[4]),na=Math.round(Math.min(ss[1],ss[3])+ss[5]);return{canvas:Hs,offsetX:Bs,offsetY:na}}fs=Hs}fs||(bs=this.cachedCanvases.getCanvas("maskCanvas",Mr,Br),Tr(bs.context,Dr));let Es=cr.Util.transform(ss,[1/Mr,0,0,-1/Br,0,0]);Es=cr.Util.transform(Es,[1,0,0,1,0,-Br]);const Ds=cr.Util.applyTransform([0,0],Es),gs=cr.Util.applyTransform([Mr,Br],Es),as=cr.Util.normalizeRect([Ds[0],Ds[1],gs[0],gs[1]]),qr=Math.round(as[2]-as[0])||1,ts=Math.round(as[3]-as[1])||1,Yr=this.cachedCanvases.getCanvas("fillCanvas",qr,ts),hs=Yr.context,ys=Math.min(Ds[0],gs[0]),_s=Math.min(Ds[1],gs[1]);hs.translate(-ys,-_s),hs.transform(...Es),fs||(fs=this._scaleImage(bs.canvas,(0,ur.getCurrentTransformInverse)(hs)),fs=fs.img,ds&&Wr&&ds.set(ns,fs)),hs.imageSmoothingEnabled=Fr((0,ur.getCurrentTransform)(hs),Dr.interpolate),_r(hs,fs,0,0,fs.width,fs.height,0,0,Mr,Br),hs.globalCompositeOperation="source-in";const Ss=cr.Util.transform((0,ur.getCurrentTransformInverse)(hs),[1,0,0,1,-ys,-_s]);return hs.fillStyle=Wr?Xr.getPattern(Pr,this,Ss,dr.PathType.FILL):Xr,hs.fillRect(0,0,Mr,Br),ds&&!Wr&&(this.cachedCanvases.delete("fillCanvas"),ds.set(ns,Yr.canvas)),{canvas:Yr.canvas,offsetX:Math.round(ys),offsetY:Math.round(_s)}}setLineWidth(Dr){Dr!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=Dr,this.ctx.lineWidth=Dr}setLineCap(Dr){this.ctx.lineCap=Hr[Dr]}setLineJoin(Dr){this.ctx.lineJoin=Kr[Dr]}setMiterLimit(Dr){this.ctx.miterLimit=Dr}setDash(Dr,Pr){const Mr=this.ctx;Mr.setLineDash!==void 0&&(Mr.setLineDash(Dr),Mr.lineDashOffset=Pr)}setRenderingIntent(Dr){}setFlatness(Dr){}setGState(Dr){for(const[Pr,Mr]of Dr)switch(Pr){case"LW":this.setLineWidth(Mr);break;case"LC":this.setLineCap(Mr);break;case"LJ":this.setLineJoin(Mr);break;case"ML":this.setMiterLimit(Mr);break;case"D":this.setDash(Mr[0],Mr[1]);break;case"RI":this.setRenderingIntent(Mr);break;case"FL":this.setFlatness(Mr);break;case"Font":this.setFont(Mr[0],Mr[1]);break;case"CA":this.current.strokeAlpha=Mr;break;case"ca":this.current.fillAlpha=Mr,this.ctx.globalAlpha=Mr;break;case"BM":this.ctx.globalCompositeOperation=Mr;break;case"SMask":this.current.activeSMask=Mr?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(Mr);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const Dr=this.inSMaskMode;this.current.activeSMask&&!Dr?this.beginSMaskMode():!this.current.activeSMask&&Dr&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const Dr=this.ctx.canvas.width,Pr=this.ctx.canvas.height,Mr="smaskGroupAt"+this.groupLevel,Br=this.cachedCanvases.getCanvas(Mr,Dr,Pr);this.suspendedCtx=this.ctx,this.ctx=Br.context;const Xr=this.ctx;Xr.setTransform(...(0,ur.getCurrentTransform)(this.suspendedCtx)),Rr(this.suspendedCtx,Xr),yr(Xr,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Rr(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(Dr){if(!this.current.activeSMask)return;Dr?(Dr[0]=Math.floor(Dr[0]),Dr[1]=Math.floor(Dr[1]),Dr[2]=Math.ceil(Dr[2]),Dr[3]=Math.ceil(Dr[3])):Dr=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const Pr=this.current.activeSMask,Mr=this.suspendedCtx;Lr(Mr,Pr,this.ctx,Dr),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(Rr(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const Dr=this.current;this.stateStack.push(Dr),this.current=Dr.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Rr(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(Dr,Pr,Mr,Br,Xr,Wr){this.ctx.transform(Dr,Pr,Mr,Br,Xr,Wr),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(Dr,Pr,Mr){const Br=this.ctx,Xr=this.current;let Wr=Xr.x,ss=Xr.y,ds,ns;const fs=(0,ur.getCurrentTransform)(Br),bs=fs[0]===0&&fs[3]===0||fs[1]===0&&fs[2]===0,Es=bs?Mr.slice(0):null;for(let Ds=0,gs=0,as=Dr.length;Ds<as;Ds++)switch(Dr[Ds]|0){case cr.OPS.rectangle:Wr=Pr[gs++],ss=Pr[gs++];const qr=Pr[gs++],ts=Pr[gs++],Yr=Wr+qr,hs=ss+ts;Br.moveTo(Wr,ss),qr===0||ts===0?Br.lineTo(Yr,hs):(Br.lineTo(Yr,ss),Br.lineTo(Yr,hs),Br.lineTo(Wr,hs)),bs||Xr.updateRectMinMax(fs,[Wr,ss,Yr,hs]),Br.closePath();break;case cr.OPS.moveTo:Wr=Pr[gs++],ss=Pr[gs++],Br.moveTo(Wr,ss),bs||Xr.updatePathMinMax(fs,Wr,ss);break;case cr.OPS.lineTo:Wr=Pr[gs++],ss=Pr[gs++],Br.lineTo(Wr,ss),bs||Xr.updatePathMinMax(fs,Wr,ss);break;case cr.OPS.curveTo:ds=Wr,ns=ss,Wr=Pr[gs+4],ss=Pr[gs+5],Br.bezierCurveTo(Pr[gs],Pr[gs+1],Pr[gs+2],Pr[gs+3],Wr,ss),Xr.updateCurvePathMinMax(fs,ds,ns,Pr[gs],Pr[gs+1],Pr[gs+2],Pr[gs+3],Wr,ss,Es),gs+=6;break;case cr.OPS.curveTo2:ds=Wr,ns=ss,Br.bezierCurveTo(Wr,ss,Pr[gs],Pr[gs+1],Pr[gs+2],Pr[gs+3]),Xr.updateCurvePathMinMax(fs,ds,ns,Wr,ss,Pr[gs],Pr[gs+1],Pr[gs+2],Pr[gs+3],Es),Wr=Pr[gs+2],ss=Pr[gs+3],gs+=4;break;case cr.OPS.curveTo3:ds=Wr,ns=ss,Wr=Pr[gs+2],ss=Pr[gs+3],Br.bezierCurveTo(Pr[gs],Pr[gs+1],Wr,ss,Wr,ss),Xr.updateCurvePathMinMax(fs,ds,ns,Pr[gs],Pr[gs+1],Wr,ss,Wr,ss,Es),gs+=4;break;case cr.OPS.closePath:Br.closePath();break}bs&&Xr.updateScalingPathMinMax(fs,Es),Xr.setCurrentPoint(Wr,ss)}closePath(){this.ctx.closePath()}stroke(Dr=!0){const Pr=this.ctx,Mr=this.current.strokeColor;Pr.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof Mr=="object"&&(Mr!=null&&Mr.getPattern)?(Pr.save(),Pr.strokeStyle=Mr.getPattern(Pr,this,(0,ur.getCurrentTransformInverse)(Pr),dr.PathType.STROKE),this.rescaleAndStroke(!1),Pr.restore()):this.rescaleAndStroke(!0)),Dr&&this.consumePath(this.current.getClippedPathBoundingBox()),Pr.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(Dr=!0){const Pr=this.ctx,Mr=this.current.fillColor,Br=this.current.patternFill;let Xr=!1;Br&&(Pr.save(),Pr.fillStyle=Mr.getPattern(Pr,this,(0,ur.getCurrentTransformInverse)(Pr),dr.PathType.FILL),Xr=!0);const Wr=this.current.getClippedPathBoundingBox();this.contentVisible&&Wr!==null&&(this.pendingEOFill?(Pr.fill("evenodd"),this.pendingEOFill=!1):Pr.fill()),Xr&&Pr.restore(),Dr&&this.consumePath(Wr)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Gr}eoClip(){this.pendingClip=Zr}beginText(){this.current.textMatrix=cr.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const Dr=this.pendingTextPaths,Pr=this.ctx;if(Dr===void 0){Pr.beginPath();return}Pr.save(),Pr.beginPath();for(const Mr of Dr)Pr.setTransform(...Mr.transform),Pr.translate(Mr.x,Mr.y),Mr.addToPath(Pr,Mr.fontSize);Pr.restore(),Pr.clip(),Pr.beginPath(),delete this.pendingTextPaths}setCharSpacing(Dr){this.current.charSpacing=Dr}setWordSpacing(Dr){this.current.wordSpacing=Dr}setHScale(Dr){this.current.textHScale=Dr/100}setLeading(Dr){this.current.leading=-Dr}setFont(Dr,Pr){var fs;const Mr=this.commonObjs.get(Dr),Br=this.current;if(!Mr)throw new Error(`Can't find font for ${Dr}`);if(Br.fontMatrix=Mr.fontMatrix||cr.FONT_IDENTITY_MATRIX,(Br.fontMatrix[0]===0||Br.fontMatrix[3]===0)&&(0,cr.warn)("Invalid font matrix for font "+Dr),Pr<0?(Pr=-Pr,Br.fontDirection=-1):Br.fontDirection=1,this.current.font=Mr,this.current.fontSize=Pr,Mr.isType3Font)return;const Xr=Mr.loadedName||"sans-serif",Wr=((fs=Mr.systemFontInfo)==null?void 0:fs.css)||`"${Xr}", ${Mr.fallbackName}`;let ss="normal";Mr.black?ss="900":Mr.bold&&(ss="bold");const ds=Mr.italic?"italic":"normal";let ns=Pr;Pr<pr?ns=pr:Pr>mr&&(ns=mr),this.current.fontSizeScale=Pr/ns,this.ctx.font=`${ds} ${ss} ${ns}px ${Wr}`}setTextRenderingMode(Dr){this.current.textRenderingMode=Dr}setTextRise(Dr){this.current.textRise=Dr}moveText(Dr,Pr){this.current.x=this.current.lineX+=Dr,this.current.y=this.current.lineY+=Pr}setLeadingMoveText(Dr,Pr){this.setLeading(-Pr),this.moveText(Dr,Pr)}setTextMatrix(Dr,Pr,Mr,Br,Xr,Wr){this.current.textMatrix=[Dr,Pr,Mr,Br,Xr,Wr],this.current.textMatrixScale=Math.hypot(Dr,Pr),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(Dr,Pr,Mr,Br){const Xr=this.ctx,Wr=this.current,ss=Wr.font,ds=Wr.textRenderingMode,ns=Wr.fontSize/Wr.fontSizeScale,fs=ds&cr.TextRenderingMode.FILL_STROKE_MASK,bs=!!(ds&cr.TextRenderingMode.ADD_TO_PATH_FLAG),Es=Wr.patternFill&&!ss.missingFile;let Ds;(ss.disableFontFace||bs||Es)&&(Ds=ss.getPathGenerator(this.commonObjs,Dr)),ss.disableFontFace||Es?(Xr.save(),Xr.translate(Pr,Mr),Xr.beginPath(),Ds(Xr,ns),Br&&Xr.setTransform(...Br),(fs===cr.TextRenderingMode.FILL||fs===cr.TextRenderingMode.FILL_STROKE)&&Xr.fill(),(fs===cr.TextRenderingMode.STROKE||fs===cr.TextRenderingMode.FILL_STROKE)&&Xr.stroke(),Xr.restore()):((fs===cr.TextRenderingMode.FILL||fs===cr.TextRenderingMode.FILL_STROKE)&&Xr.fillText(Dr,Pr,Mr),(fs===cr.TextRenderingMode.STROKE||fs===cr.TextRenderingMode.FILL_STROKE)&&Xr.strokeText(Dr,Pr,Mr)),bs&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,ur.getCurrentTransform)(Xr),x:Pr,y:Mr,fontSize:ns,addToPath:Ds})}get isFontSubpixelAAEnabled(){const{context:Dr}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);Dr.scale(1.5,1),Dr.fillText("I",0,10);const Pr=Dr.getImageData(0,0,10,10).data;let Mr=!1;for(let Br=3;Br<Pr.length;Br+=4)if(Pr[Br]>0&&Pr[Br]<255){Mr=!0;break}return(0,cr.shadow)(this,"isFontSubpixelAAEnabled",Mr)}showText(Dr){const Pr=this.current,Mr=Pr.font;if(Mr.isType3Font)return this.showType3Text(Dr);const Br=Pr.fontSize;if(Br===0)return;const Xr=this.ctx,Wr=Pr.fontSizeScale,ss=Pr.charSpacing,ds=Pr.wordSpacing,ns=Pr.fontDirection,fs=Pr.textHScale*ns,bs=Dr.length,Es=Mr.vertical,Ds=Es?1:-1,gs=Mr.defaultVMetrics,as=Br*Pr.fontMatrix[0],qr=Pr.textRenderingMode===cr.TextRenderingMode.FILL&&!Mr.disableFontFace&&!Pr.patternFill;Xr.save(),Xr.transform(...Pr.textMatrix),Xr.translate(Pr.x,Pr.y+Pr.textRise),ns>0?Xr.scale(fs,-1):Xr.scale(fs,1);let ts;if(Pr.patternFill){Xr.save();const Ss=Pr.fillColor.getPattern(Xr,this,(0,ur.getCurrentTransformInverse)(Xr),dr.PathType.FILL);ts=(0,ur.getCurrentTransform)(Xr),Xr.restore(),Xr.fillStyle=Ss}let Yr=Pr.lineWidth;const hs=Pr.textMatrixScale;if(hs===0||Yr===0){const Ss=Pr.textRenderingMode&cr.TextRenderingMode.FILL_STROKE_MASK;(Ss===cr.TextRenderingMode.STROKE||Ss===cr.TextRenderingMode.FILL_STROKE)&&(Yr=this.getSinglePixelWidth())}else Yr/=hs;if(Wr!==1&&(Xr.scale(Wr,Wr),Yr/=Wr),Xr.lineWidth=Yr,Mr.isInvalidPDFjsFont){const Ss=[];let vs=0;for(const Hs of Dr)Ss.push(Hs.unicode),vs+=Hs.width;Xr.fillText(Ss.join(""),0,0),Pr.x+=vs*as*fs,Xr.restore(),this.compose();return}let ys=0,_s;for(_s=0;_s<bs;++_s){const Ss=Dr[_s];if(typeof Ss=="number"){ys+=Ds*Ss*Br/1e3;continue}let vs=!1;const Hs=(Ss.isSpace?ds:0)+ss,Bs=Ss.fontChar,na=Ss.accent;let Js,$a,Vs=Ss.width;if(Es){const ro=Ss.vmetric||gs,no=-(Ss.vmetric?ro[1]:Vs*.5)*as,Us=ro[2]*as;Vs=ro?-ro[0]:Vs,Js=no/Wr,$a=(ys+Us)/Wr}else Js=ys/Wr,$a=0;if(Mr.remeasure&&Vs>0){const ro=Xr.measureText(Bs).width*1e3/Br*Wr;if(Vs<ro&&this.isFontSubpixelAAEnabled){const no=Vs/ro;vs=!0,Xr.save(),Xr.scale(no,1),Js/=no}else Vs!==ro&&(Js+=(Vs-ro)/2e3*Br/Wr)}if(this.contentVisible&&(Ss.isInFont||Mr.missingFile)){if(qr&&!na)Xr.fillText(Bs,Js,$a);else if(this.paintChar(Bs,Js,$a,ts),na){const ro=Js+Br*na.offset.x/Wr,no=$a-Br*na.offset.y/Wr;this.paintChar(na.fontChar,ro,no,ts)}}const xa=Es?Vs*as-Hs*ns:Vs*as+Hs*ns;ys+=xa,vs&&Xr.restore()}Es?Pr.y-=ys:Pr.x+=ys*fs,Xr.restore(),this.compose()}showType3Text(Dr){const Pr=this.ctx,Mr=this.current,Br=Mr.font,Xr=Mr.fontSize,Wr=Mr.fontDirection,ss=Br.vertical?1:-1,ds=Mr.charSpacing,ns=Mr.wordSpacing,fs=Mr.textHScale*Wr,bs=Mr.fontMatrix||cr.FONT_IDENTITY_MATRIX,Es=Dr.length,Ds=Mr.textRenderingMode===cr.TextRenderingMode.INVISIBLE;let gs,as,qr,ts;if(!(Ds||Xr===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,Pr.save(),Pr.transform(...Mr.textMatrix),Pr.translate(Mr.x,Mr.y),Pr.scale(fs,Wr),gs=0;gs<Es;++gs){if(as=Dr[gs],typeof as=="number"){ts=ss*as*Xr/1e3,this.ctx.translate(ts,0),Mr.x+=ts*fs;continue}const Yr=(as.isSpace?ns:0)+ds,hs=Br.charProcOperatorList[as.operatorListId];if(!hs){(0,cr.warn)(`Type3 character "${as.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=as,this.save(),Pr.scale(Xr,Xr),Pr.transform(...bs),this.executeOperatorList(hs),this.restore()),qr=cr.Util.applyTransform([as.width,0],bs)[0]*Xr+Yr,Pr.translate(qr,0),Mr.x+=qr*fs}Pr.restore(),this.processingType3=null}}setCharWidth(Dr,Pr){}setCharWidthAndBounds(Dr,Pr,Mr,Br,Xr,Wr){this.ctx.rect(Mr,Br,Xr-Mr,Wr-Br),this.ctx.clip(),this.endPath()}getColorN_Pattern(Dr){let Pr;if(Dr[0]==="TilingPattern"){const Mr=Dr[1],Br=this.baseTransform||(0,ur.getCurrentTransform)(this.ctx),Xr={createCanvasGraphics:Wr=>new es(Wr,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};Pr=new dr.TilingPattern(Dr,Mr,this.ctx,Xr,Br)}else Pr=this._getPattern(Dr[1],Dr[2]);return Pr}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(Dr,Pr,Mr){const Br=cr.Util.makeHexColor(Dr,Pr,Mr);this.ctx.strokeStyle=Br,this.current.strokeColor=Br}setFillRGBColor(Dr,Pr,Mr){const Br=cr.Util.makeHexColor(Dr,Pr,Mr);this.ctx.fillStyle=Br,this.current.fillColor=Br,this.current.patternFill=!1}_getPattern(Dr,Pr=null){let Mr;return this.cachedPatterns.has(Dr)?Mr=this.cachedPatterns.get(Dr):(Mr=(0,dr.getShadingPattern)(this.getObject(Dr)),this.cachedPatterns.set(Dr,Mr)),Pr&&(Mr.matrix=Pr),Mr}shadingFill(Dr){if(!this.contentVisible)return;const Pr=this.ctx;this.save();const Mr=this._getPattern(Dr);Pr.fillStyle=Mr.getPattern(Pr,this,(0,ur.getCurrentTransformInverse)(Pr),dr.PathType.SHADING);const Br=(0,ur.getCurrentTransformInverse)(Pr);if(Br){const{width:Xr,height:Wr}=Pr.canvas,[ss,ds,ns,fs]=cr.Util.getAxialAlignedBoundingBox([0,0,Xr,Wr],Br);this.ctx.fillRect(ss,ds,ns-ss,fs-ds)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,cr.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,cr.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(Dr,Pr){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(Dr)&&Dr.length===6&&this.transform(...Dr),this.baseTransform=(0,ur.getCurrentTransform)(this.ctx),Pr)){const Mr=Pr[2]-Pr[0],Br=Pr[3]-Pr[1];this.ctx.rect(Pr[0],Pr[1],Mr,Br),this.current.updateRectMinMax((0,ur.getCurrentTransform)(this.ctx),Pr),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(Dr){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const Pr=this.ctx;Dr.isolated||(0,cr.info)("TODO: Support non-isolated groups."),Dr.knockout&&(0,cr.warn)("Knockout groups not supported.");const Mr=(0,ur.getCurrentTransform)(Pr);if(Dr.matrix&&Pr.transform(...Dr.matrix),!Dr.bbox)throw new Error("Bounding box is required.");let Br=cr.Util.getAxialAlignedBoundingBox(Dr.bbox,(0,ur.getCurrentTransform)(Pr));const Xr=[0,0,Pr.canvas.width,Pr.canvas.height];Br=cr.Util.intersect(Br,Xr)||[0,0,0,0];const Wr=Math.floor(Br[0]),ss=Math.floor(Br[1]);let ds=Math.max(Math.ceil(Br[2])-Wr,1),ns=Math.max(Math.ceil(Br[3])-ss,1),fs=1,bs=1;ds>fr&&(fs=ds/fr,ds=fr),ns>fr&&(bs=ns/fr,ns=fr),this.current.startNewPathAndClipBox([0,0,ds,ns]);let Es="groupAt"+this.groupLevel;Dr.smask&&(Es+="_smask_"+this.smaskCounter++%2);const Ds=this.cachedCanvases.getCanvas(Es,ds,ns),gs=Ds.context;gs.scale(1/fs,1/bs),gs.translate(-Wr,-ss),gs.transform(...Mr),Dr.smask?this.smaskStack.push({canvas:Ds.canvas,context:gs,offsetX:Wr,offsetY:ss,scaleX:fs,scaleY:bs,subtype:Dr.smask.subtype,backdrop:Dr.smask.backdrop,transferMap:Dr.smask.transferMap||null,startTransformInverse:null}):(Pr.setTransform(1,0,0,1,0,0),Pr.translate(Wr,ss),Pr.scale(fs,bs),Pr.save()),Rr(Pr,gs),this.ctx=gs,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(Pr),this.groupLevel++}endGroup(Dr){if(!this.contentVisible)return;this.groupLevel--;const Pr=this.ctx,Mr=this.groupStack.pop();if(this.ctx=Mr,this.ctx.imageSmoothingEnabled=!1,Dr.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const Br=(0,ur.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...Br);const Xr=cr.Util.getAxialAlignedBoundingBox([0,0,Pr.canvas.width,Pr.canvas.height],Br);this.ctx.drawImage(Pr.canvas,0,0),this.ctx.restore(),this.compose(Xr)}}beginAnnotation(Dr,Pr,Mr,Br,Xr){if(ws(this,os,Cl).call(this),Nr(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(Pr)&&Pr.length===4){const Wr=Pr[2]-Pr[0],ss=Pr[3]-Pr[1];if(Xr&&this.annotationCanvasMap){Mr=Mr.slice(),Mr[4]-=Pr[0],Mr[5]-=Pr[1],Pr=Pr.slice(),Pr[0]=Pr[1]=0,Pr[2]=Wr,Pr[3]=ss;const[ds,ns]=cr.Util.singularValueDecompose2dScale((0,ur.getCurrentTransform)(this.ctx)),{viewportScale:fs}=this,bs=Math.ceil(Wr*this.outputScaleX*fs),Es=Math.ceil(ss*this.outputScaleY*fs);this.annotationCanvas=this.canvasFactory.create(bs,Es);const{canvas:Ds,context:gs}=this.annotationCanvas;this.annotationCanvasMap.set(Dr,Ds),this.annotationCanvas.savedCtx=this.ctx,this.ctx=gs,this.ctx.save(),this.ctx.setTransform(ds,0,0,-ns,0,ss*ns),Nr(this.ctx)}else Nr(this.ctx),this.ctx.rect(Pr[0],Pr[1],Wr,ss),this.ctx.clip(),this.endPath()}this.current=new wr(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...Mr),this.transform(...Br)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),ws(this,os,Nl).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(Dr){if(!this.contentVisible)return;const Pr=Dr.count;Dr=this.getObject(Dr.data,Dr),Dr.count=Pr;const Mr=this.ctx,Br=this.processingType3;if(Br&&(Br.compiled===void 0&&(Br.compiled=jr(Dr)),Br.compiled)){Br.compiled(Mr);return}const Xr=this._createMaskCanvas(Dr),Wr=Xr.canvas;Mr.save(),Mr.setTransform(1,0,0,1,0,0),Mr.drawImage(Wr,Xr.offsetX,Xr.offsetY),Mr.restore(),this.compose()}paintImageMaskXObjectRepeat(Dr,Pr,Mr=0,Br=0,Xr,Wr){if(!this.contentVisible)return;Dr=this.getObject(Dr.data,Dr);const ss=this.ctx;ss.save();const ds=(0,ur.getCurrentTransform)(ss);ss.transform(Pr,Mr,Br,Xr,0,0);const ns=this._createMaskCanvas(Dr);ss.setTransform(1,0,0,1,ns.offsetX-ds[4],ns.offsetY-ds[5]);for(let fs=0,bs=Wr.length;fs<bs;fs+=2){const Es=cr.Util.transform(ds,[Pr,Mr,Br,Xr,Wr[fs],Wr[fs+1]]),[Ds,gs]=cr.Util.applyTransform([0,0],Es);ss.drawImage(ns.canvas,Ds,gs)}ss.restore(),this.compose()}paintImageMaskXObjectGroup(Dr){if(!this.contentVisible)return;const Pr=this.ctx,Mr=this.current.fillColor,Br=this.current.patternFill;for(const Xr of Dr){const{data:Wr,width:ss,height:ds,transform:ns}=Xr,fs=this.cachedCanvases.getCanvas("maskCanvas",ss,ds),bs=fs.context;bs.save();const Es=this.getObject(Wr,Xr);Tr(bs,Es),bs.globalCompositeOperation="source-in",bs.fillStyle=Br?Mr.getPattern(bs,this,(0,ur.getCurrentTransformInverse)(Pr),dr.PathType.FILL):Mr,bs.fillRect(0,0,ss,ds),bs.restore(),Pr.save(),Pr.transform(...ns),Pr.scale(1,-1),_r(Pr,fs.canvas,0,0,ss,ds,0,-1,1,1),Pr.restore()}this.compose()}paintImageXObject(Dr){if(!this.contentVisible)return;const Pr=this.getObject(Dr);if(!Pr){(0,cr.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(Pr)}paintImageXObjectRepeat(Dr,Pr,Mr,Br){if(!this.contentVisible)return;const Xr=this.getObject(Dr);if(!Xr){(0,cr.warn)("Dependent image isn't ready yet");return}const Wr=Xr.width,ss=Xr.height,ds=[];for(let ns=0,fs=Br.length;ns<fs;ns+=2)ds.push({transform:[Pr,0,0,Mr,Br[ns],Br[ns+1]],x:0,y:0,w:Wr,h:ss});this.paintInlineImageXObjectGroup(Xr,ds)}applyTransferMapsToCanvas(Dr){return this.current.transferMaps!=="none"&&(Dr.filter=this.current.transferMaps,Dr.drawImage(Dr.canvas,0,0),Dr.filter="none"),Dr.canvas}applyTransferMapsToBitmap(Dr){if(this.current.transferMaps==="none")return Dr.bitmap;const{bitmap:Pr,width:Mr,height:Br}=Dr,Xr=this.cachedCanvases.getCanvas("inlineImage",Mr,Br),Wr=Xr.context;return Wr.filter=this.current.transferMaps,Wr.drawImage(Pr,0,0),Wr.filter="none",Xr.canvas}paintInlineImageXObject(Dr){if(!this.contentVisible)return;const Pr=Dr.width,Mr=Dr.height,Br=this.ctx;if(this.save(),!cr.isNodeJS){const{filter:ss}=Br;ss!=="none"&&ss!==""&&(Br.filter="none")}Br.scale(1/Pr,-1/Mr);let Xr;if(Dr.bitmap)Xr=this.applyTransferMapsToBitmap(Dr);else if(typeof HTMLElement=="function"&&Dr instanceof HTMLElement||!Dr.data)Xr=Dr;else{const ds=this.cachedCanvases.getCanvas("inlineImage",Pr,Mr).context;Sr(ds,Dr),Xr=this.applyTransferMapsToCanvas(ds)}const Wr=this._scaleImage(Xr,(0,ur.getCurrentTransformInverse)(Br));Br.imageSmoothingEnabled=Fr((0,ur.getCurrentTransform)(Br),Dr.interpolate),_r(Br,Wr.img,0,0,Wr.paintWidth,Wr.paintHeight,0,-Mr,Pr,Mr),this.compose(),this.restore()}paintInlineImageXObjectGroup(Dr,Pr){if(!this.contentVisible)return;const Mr=this.ctx;let Br;if(Dr.bitmap)Br=Dr.bitmap;else{const Xr=Dr.width,Wr=Dr.height,ds=this.cachedCanvases.getCanvas("inlineImage",Xr,Wr).context;Sr(ds,Dr),Br=this.applyTransferMapsToCanvas(ds)}for(const Xr of Pr)Mr.save(),Mr.transform(...Xr.transform),Mr.scale(1,-1),_r(Mr,Br,Xr.x,Xr.y,Xr.w,Xr.h,0,-1,1,1),Mr.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(Dr){}markPointProps(Dr,Pr){}beginMarkedContent(Dr){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(Dr,Pr){Dr==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(Pr)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(Dr){const Pr=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(Dr);const Mr=this.ctx;this.pendingClip&&(Pr||(this.pendingClip===Zr?Mr.clip("evenodd"):Mr.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),Mr.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const Dr=(0,ur.getCurrentTransform)(this.ctx);if(Dr[1]===0&&Dr[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(Dr[0]),Math.abs(Dr[3]));else{const Pr=Math.abs(Dr[0]*Dr[3]-Dr[2]*Dr[1]),Mr=Math.hypot(Dr[0],Dr[2]),Br=Math.hypot(Dr[1],Dr[3]);this._cachedGetSinglePixelWidth=Math.max(Mr,Br)/Pr}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:Dr}=this.current,{a:Pr,b:Mr,c:Br,d:Xr}=this.ctx.getTransform();let Wr,ss;if(Mr===0&&Br===0){const ds=Math.abs(Pr),ns=Math.abs(Xr);if(ds===ns)if(Dr===0)Wr=ss=1/ds;else{const fs=ds*Dr;Wr=ss=fs<1?1/fs:1}else if(Dr===0)Wr=1/ds,ss=1/ns;else{const fs=ds*Dr,bs=ns*Dr;Wr=fs<1?1/fs:1,ss=bs<1?1/bs:1}}else{const ds=Math.abs(Pr*Xr-Mr*Br),ns=Math.hypot(Pr,Mr),fs=Math.hypot(Br,Xr);if(Dr===0)Wr=fs/ds,ss=ns/ds;else{const bs=Dr*ds;Wr=fs>bs?fs/bs:1,ss=ns>bs?ns/bs:1}}this._cachedScaleForStroking[0]=Wr,this._cachedScaleForStroking[1]=ss}return this._cachedScaleForStroking}rescaleAndStroke(Dr){const{ctx:Pr}=this,{lineWidth:Mr}=this.current,[Br,Xr]=this.getScaleForStroking();if(Pr.lineWidth=Mr||1,Br===1&&Xr===1){Pr.stroke();return}const Wr=Pr.getLineDash();if(Dr&&Pr.save(),Pr.scale(Br,Xr),Wr.length>0){const ss=Math.max(Br,Xr);Pr.setLineDash(Wr.map(ds=>ds/ss)),Pr.lineDashOffset/=ss}Pr.stroke(),Dr&&Pr.restore()}isContentVisible(){for(let Dr=this.markedContentStack.length-1;Dr>=0;Dr--)if(!this.markedContentStack[Dr].visible)return!1;return!0}};os=new WeakSet,Cl=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Nl=function(){if(this.pageColors){const Dr=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(Dr!=="none"){const Pr=this.ctx.filter;this.ctx.filter=Dr,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=Pr}}};let Jr=es;or.CanvasGraphics=Jr;for(const Ir in cr.OPS)Jr.prototype[Ir]!==void 0&&(Jr.prototype[cr.OPS[Ir]]=Jr.prototype[Ir])},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.TilingPattern=or.PathType=void 0,or.getShadingPattern=gr;var cr=lr(1),ur=lr(6);const dr={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};or.PathType=dr;function hr(jr,wr){if(!wr)return;const Sr=wr[2]-wr[0],Tr=wr[3]-wr[1],Rr=new Path2D;Rr.rect(wr[0],wr[1],Sr,Tr),jr.clip(Rr)}class pr{constructor(){this.constructor===pr&&(0,cr.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,cr.unreachable)("Abstract method `getPattern` called.")}}class mr extends pr{constructor(wr){super(),this._type=wr[1],this._bbox=wr[2],this._colorStops=wr[3],this._p0=wr[4],this._p1=wr[5],this._r0=wr[6],this._r1=wr[7],this.matrix=null}_createGradient(wr){let Sr;this._type==="axial"?Sr=wr.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(Sr=wr.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const Tr of this._colorStops)Sr.addColorStop(Tr[0],Tr[1]);return Sr}getPattern(wr,Sr,Tr,Rr){let Nr;if(Rr===dr.STROKE||Rr===dr.FILL){const Cr=Sr.current.getClippedPathBoundingBox(Rr,(0,ur.getCurrentTransform)(wr))||[0,0,0,0],kr=Math.ceil(Cr[2]-Cr[0])||1,Ar=Math.ceil(Cr[3]-Cr[1])||1,Or=Sr.cachedCanvases.getCanvas("pattern",kr,Ar,!0),Lr=Or.context;Lr.clearRect(0,0,Lr.canvas.width,Lr.canvas.height),Lr.beginPath(),Lr.rect(0,0,Lr.canvas.width,Lr.canvas.height),Lr.translate(-Cr[0],-Cr[1]),Tr=cr.Util.transform(Tr,[1,0,0,1,Cr[0],Cr[1]]),Lr.transform(...Sr.baseTransform),this.matrix&&Lr.transform(...this.matrix),hr(Lr,this._bbox),Lr.fillStyle=this._createGradient(Lr),Lr.fill(),Nr=wr.createPattern(Or.canvas,"no-repeat");const Fr=new DOMMatrix(Tr);Nr.setTransform(Fr)}else hr(wr,this._bbox),Nr=this._createGradient(wr);return Nr}}function fr(jr,wr,Sr,Tr,Rr,Nr,Cr,kr){const Ar=wr.coords,Or=wr.colors,Lr=jr.data,Fr=jr.width*4;let Hr;Ar[Sr+1]>Ar[Tr+1]&&(Hr=Sr,Sr=Tr,Tr=Hr,Hr=Nr,Nr=Cr,Cr=Hr),Ar[Tr+1]>Ar[Rr+1]&&(Hr=Tr,Tr=Rr,Rr=Hr,Hr=Cr,Cr=kr,kr=Hr),Ar[Sr+1]>Ar[Tr+1]&&(Hr=Sr,Sr=Tr,Tr=Hr,Hr=Nr,Nr=Cr,Cr=Hr);const Kr=(Ar[Sr]+wr.offsetX)*wr.scaleX,Gr=(Ar[Sr+1]+wr.offsetY)*wr.scaleY,Zr=(Ar[Tr]+wr.offsetX)*wr.scaleX,Jr=(Ar[Tr+1]+wr.offsetY)*wr.scaleY,os=(Ar[Rr]+wr.offsetX)*wr.scaleX,Ur=(Ar[Rr+1]+wr.offsetY)*wr.scaleY;if(Gr>=Ur)return;const Vr=Or[Nr],es=Or[Nr+1],Ir=Or[Nr+2],Dr=Or[Cr],Pr=Or[Cr+1],Mr=Or[Cr+2],Br=Or[kr],Xr=Or[kr+1],Wr=Or[kr+2],ss=Math.round(Gr),ds=Math.round(Ur);let ns,fs,bs,Es,Ds,gs,as,qr;for(let ts=ss;ts<=ds;ts++){if(ts<Jr){const Ss=ts<Gr?0:(Gr-ts)/(Gr-Jr);ns=Kr-(Kr-Zr)*Ss,fs=Vr-(Vr-Dr)*Ss,bs=es-(es-Pr)*Ss,Es=Ir-(Ir-Mr)*Ss}else{let Ss;ts>Ur?Ss=1:Jr===Ur?Ss=0:Ss=(Jr-ts)/(Jr-Ur),ns=Zr-(Zr-os)*Ss,fs=Dr-(Dr-Br)*Ss,bs=Pr-(Pr-Xr)*Ss,Es=Mr-(Mr-Wr)*Ss}let Yr;ts<Gr?Yr=0:ts>Ur?Yr=1:Yr=(Gr-ts)/(Gr-Ur),Ds=Kr-(Kr-os)*Yr,gs=Vr-(Vr-Br)*Yr,as=es-(es-Xr)*Yr,qr=Ir-(Ir-Wr)*Yr;const hs=Math.round(Math.min(ns,Ds)),ys=Math.round(Math.max(ns,Ds));let _s=Fr*ts+hs*4;for(let Ss=hs;Ss<=ys;Ss++)Yr=(ns-Ss)/(ns-Ds),Yr<0?Yr=0:Yr>1&&(Yr=1),Lr[_s++]=fs-(fs-gs)*Yr|0,Lr[_s++]=bs-(bs-as)*Yr|0,Lr[_s++]=Es-(Es-qr)*Yr|0,Lr[_s++]=255}}function xr(jr,wr,Sr){const Tr=wr.coords,Rr=wr.colors;let Nr,Cr;switch(wr.type){case"lattice":const kr=wr.verticesPerRow,Ar=Math.floor(Tr.length/kr)-1,Or=kr-1;for(Nr=0;Nr<Ar;Nr++){let Lr=Nr*kr;for(let Fr=0;Fr<Or;Fr++,Lr++)fr(jr,Sr,Tr[Lr],Tr[Lr+1],Tr[Lr+kr],Rr[Lr],Rr[Lr+1],Rr[Lr+kr]),fr(jr,Sr,Tr[Lr+kr+1],Tr[Lr+1],Tr[Lr+kr],Rr[Lr+kr+1],Rr[Lr+1],Rr[Lr+kr])}break;case"triangles":for(Nr=0,Cr=Tr.length;Nr<Cr;Nr+=3)fr(jr,Sr,Tr[Nr],Tr[Nr+1],Tr[Nr+2],Rr[Nr],Rr[Nr+1],Rr[Nr+2]);break;default:throw new Error("illegal figure")}}class Er extends pr{constructor(wr){super(),this._coords=wr[2],this._colors=wr[3],this._figures=wr[4],this._bounds=wr[5],this._bbox=wr[7],this._background=wr[8],this.matrix=null}_createMeshCanvas(wr,Sr,Tr){const kr=Math.floor(this._bounds[0]),Ar=Math.floor(this._bounds[1]),Or=Math.ceil(this._bounds[2])-kr,Lr=Math.ceil(this._bounds[3])-Ar,Fr=Math.min(Math.ceil(Math.abs(Or*wr[0]*1.1)),3e3),Hr=Math.min(Math.ceil(Math.abs(Lr*wr[1]*1.1)),3e3),Kr=Or/Fr,Gr=Lr/Hr,Zr={coords:this._coords,colors:this._colors,offsetX:-kr,offsetY:-Ar,scaleX:1/Kr,scaleY:1/Gr},Jr=Fr+2*2,os=Hr+2*2,Ur=Tr.getCanvas("mesh",Jr,os,!1),Vr=Ur.context,es=Vr.createImageData(Fr,Hr);if(Sr){const Dr=es.data;for(let Pr=0,Mr=Dr.length;Pr<Mr;Pr+=4)Dr[Pr]=Sr[0],Dr[Pr+1]=Sr[1],Dr[Pr+2]=Sr[2],Dr[Pr+3]=255}for(const Dr of this._figures)xr(es,Dr,Zr);return Vr.putImageData(es,2,2),{canvas:Ur.canvas,offsetX:kr-2*Kr,offsetY:Ar-2*Gr,scaleX:Kr,scaleY:Gr}}getPattern(wr,Sr,Tr,Rr){hr(wr,this._bbox);let Nr;if(Rr===dr.SHADING)Nr=cr.Util.singularValueDecompose2dScale((0,ur.getCurrentTransform)(wr));else if(Nr=cr.Util.singularValueDecompose2dScale(Sr.baseTransform),this.matrix){const kr=cr.Util.singularValueDecompose2dScale(this.matrix);Nr=[Nr[0]*kr[0],Nr[1]*kr[1]]}const Cr=this._createMeshCanvas(Nr,Rr===dr.SHADING?null:this._background,Sr.cachedCanvases);return Rr!==dr.SHADING&&(wr.setTransform(...Sr.baseTransform),this.matrix&&wr.transform(...this.matrix)),wr.translate(Cr.offsetX,Cr.offsetY),wr.scale(Cr.scaleX,Cr.scaleY),wr.createPattern(Cr.canvas,"no-repeat")}}class vr extends pr{getPattern(){return"hotpink"}}function gr(jr){switch(jr[0]){case"RadialAxial":return new mr(jr);case"Mesh":return new Er(jr);case"Dummy":return new vr}throw new Error(`Unknown IR type: ${jr[0]}`)}const yr={COLORED:1,UNCOLORED:2},_r=class _r{constructor(wr,Sr,Tr,Rr,Nr){this.operatorList=wr[2],this.matrix=wr[3]||[1,0,0,1,0,0],this.bbox=wr[4],this.xstep=wr[5],this.ystep=wr[6],this.paintType=wr[7],this.tilingType=wr[8],this.color=Sr,this.ctx=Tr,this.canvasGraphicsFactory=Rr,this.baseTransform=Nr}createPatternCanvas(wr){const Sr=this.operatorList,Tr=this.bbox,Rr=this.xstep,Nr=this.ystep,Cr=this.paintType,kr=this.tilingType,Ar=this.color,Or=this.canvasGraphicsFactory;(0,cr.info)("TilingType: "+kr);const Lr=Tr[0],Fr=Tr[1],Hr=Tr[2],Kr=Tr[3],Gr=cr.Util.singularValueDecompose2dScale(this.matrix),Zr=cr.Util.singularValueDecompose2dScale(this.baseTransform),Jr=[Gr[0]*Zr[0],Gr[1]*Zr[1]],os=this.getSizeAndScale(Rr,this.ctx.canvas.width,Jr[0]),Ur=this.getSizeAndScale(Nr,this.ctx.canvas.height,Jr[1]),Vr=wr.cachedCanvases.getCanvas("pattern",os.size,Ur.size,!0),es=Vr.context,Ir=Or.createCanvasGraphics(es);Ir.groupLevel=wr.groupLevel,this.setFillAndStrokeStyleToContext(Ir,Cr,Ar);let Dr=Lr,Pr=Fr,Mr=Hr,Br=Kr;return Lr<0&&(Dr=0,Mr+=Math.abs(Lr)),Fr<0&&(Pr=0,Br+=Math.abs(Fr)),es.translate(-(os.scale*Dr),-(Ur.scale*Pr)),Ir.transform(os.scale,0,0,Ur.scale,0,0),es.save(),this.clipBbox(Ir,Dr,Pr,Mr,Br),Ir.baseTransform=(0,ur.getCurrentTransform)(Ir.ctx),Ir.executeOperatorList(Sr),Ir.endDrawing(),{canvas:Vr.canvas,scaleX:os.scale,scaleY:Ur.scale,offsetX:Dr,offsetY:Pr}}getSizeAndScale(wr,Sr,Tr){wr=Math.abs(wr);const Rr=Math.max(_r.MAX_PATTERN_SIZE,Sr);let Nr=Math.ceil(wr*Tr);return Nr>=Rr?Nr=Rr:Tr=Nr/wr,{scale:Tr,size:Nr}}clipBbox(wr,Sr,Tr,Rr,Nr){const Cr=Rr-Sr,kr=Nr-Tr;wr.ctx.rect(Sr,Tr,Cr,kr),wr.current.updateRectMinMax((0,ur.getCurrentTransform)(wr.ctx),[Sr,Tr,Rr,Nr]),wr.clip(),wr.endPath()}setFillAndStrokeStyleToContext(wr,Sr,Tr){const Rr=wr.ctx,Nr=wr.current;switch(Sr){case yr.COLORED:const Cr=this.ctx;Rr.fillStyle=Cr.fillStyle,Rr.strokeStyle=Cr.strokeStyle,Nr.fillColor=Cr.fillStyle,Nr.strokeColor=Cr.strokeStyle;break;case yr.UNCOLORED:const kr=cr.Util.makeHexColor(Tr[0],Tr[1],Tr[2]);Rr.fillStyle=kr,Rr.strokeStyle=kr,Nr.fillColor=kr,Nr.strokeColor=kr;break;default:throw new cr.FormatError(`Unsupported paint type: ${Sr}`)}}getPattern(wr,Sr,Tr,Rr){let Nr=Tr;Rr!==dr.SHADING&&(Nr=cr.Util.transform(Nr,Sr.baseTransform),this.matrix&&(Nr=cr.Util.transform(Nr,this.matrix)));const Cr=this.createPatternCanvas(Sr);let kr=new DOMMatrix(Nr);kr=kr.translate(Cr.offsetX,Cr.offsetY),kr=kr.scale(1/Cr.scaleX,1/Cr.scaleY);const Ar=wr.createPattern(Cr.canvas,"repeat");return Ar.setTransform(kr),Ar}};io(_r,"MAX_PATTERN_SIZE",3e3);let br=_r;or.TilingPattern=br},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.convertBlackAndWhiteToRGBA=dr,or.convertToRGBA=ur,or.grayToRGBA=pr;var cr=lr(1);function ur(mr){switch(mr.kind){case cr.ImageKind.GRAYSCALE_1BPP:return dr(mr);case cr.ImageKind.RGB_24BPP:return hr(mr)}return null}function dr({src:mr,srcPos:fr=0,dest:xr,width:Er,height:vr,nonBlackColor:gr=4294967295,inverseDecode:yr=!1}){const br=cr.FeatureTest.isLittleEndian?4278190080:255,[_r,jr]=yr?[gr,br]:[br,gr],wr=Er>>3,Sr=Er&7,Tr=mr.length;xr=new Uint32Array(xr.buffer);let Rr=0;for(let Nr=0;Nr<vr;Nr++){for(const kr=fr+wr;fr<kr;fr++){const Ar=fr<Tr?mr[fr]:255;xr[Rr++]=Ar&128?jr:_r,xr[Rr++]=Ar&64?jr:_r,xr[Rr++]=Ar&32?jr:_r,xr[Rr++]=Ar&16?jr:_r,xr[Rr++]=Ar&8?jr:_r,xr[Rr++]=Ar&4?jr:_r,xr[Rr++]=Ar&2?jr:_r,xr[Rr++]=Ar&1?jr:_r}if(Sr===0)continue;const Cr=fr<Tr?mr[fr++]:255;for(let kr=0;kr<Sr;kr++)xr[Rr++]=Cr&1<<7-kr?jr:_r}return{srcPos:fr,destPos:Rr}}function hr({src:mr,srcPos:fr=0,dest:xr,destPos:Er=0,width:vr,height:gr}){let yr=0;const br=mr.length>>2,_r=new Uint32Array(mr.buffer,fr,br);if(cr.FeatureTest.isLittleEndian){for(;yr<br-2;yr+=3,Er+=4){const jr=_r[yr],wr=_r[yr+1],Sr=_r[yr+2];xr[Er]=jr|4278190080,xr[Er+1]=jr>>>24|wr<<8|4278190080,xr[Er+2]=wr>>>16|Sr<<16|4278190080,xr[Er+3]=Sr>>>8|4278190080}for(let jr=yr*4,wr=mr.length;jr<wr;jr+=3)xr[Er++]=mr[jr]|mr[jr+1]<<8|mr[jr+2]<<16|4278190080}else{for(;yr<br-2;yr+=3,Er+=4){const jr=_r[yr],wr=_r[yr+1],Sr=_r[yr+2];xr[Er]=jr|255,xr[Er+1]=jr<<24|wr>>>8|255,xr[Er+2]=wr<<16|Sr>>>16|255,xr[Er+3]=Sr<<8|255}for(let jr=yr*4,wr=mr.length;jr<wr;jr+=3)xr[Er++]=mr[jr]<<24|mr[jr+1]<<16|mr[jr+2]<<8|255}return{srcPos:fr,destPos:Er}}function pr(mr,fr){if(cr.FeatureTest.isLittleEndian)for(let xr=0,Er=mr.length;xr<Er;xr++)fr[xr]=mr[xr]*65793|4278190080;else for(let xr=0,Er=mr.length;xr<Er;xr++)fr[xr]=mr[xr]*16843008|255}},(ar,or)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.GlobalWorkerOptions=void 0;const lr=Object.create(null);or.GlobalWorkerOptions=lr,lr.workerPort=null,lr.workerSrc=""},(ar,or,lr)=>{var mr,nu,iu,Mo;Object.defineProperty(or,"__esModule",{value:!0}),or.MessageHandler=void 0;var cr=lr(1);const ur={DATA:1,ERROR:2},dr={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function hr(vr){switch(vr instanceof Error||typeof vr=="object"&&vr!==null||(0,cr.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),vr.name){case"AbortException":return new cr.AbortException(vr.message);case"MissingPDFException":return new cr.MissingPDFException(vr.message);case"PasswordException":return new cr.PasswordException(vr.message,vr.code);case"UnexpectedResponseException":return new cr.UnexpectedResponseException(vr.message,vr.status);case"UnknownErrorException":return new cr.UnknownErrorException(vr.message,vr.details);default:return new cr.UnknownErrorException(vr.message,vr.toString())}}class pr{constructor(gr,yr,br){Ns(this,mr);this.sourceName=gr,this.targetName=yr,this.comObj=br,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=_r=>{const jr=_r.data;if(jr.targetName!==this.sourceName)return;if(jr.stream){ws(this,mr,iu).call(this,jr);return}if(jr.callback){const Sr=jr.callbackId,Tr=this.callbackCapabilities[Sr];if(!Tr)throw new Error(`Cannot resolve callback ${Sr}`);if(delete this.callbackCapabilities[Sr],jr.callback===ur.DATA)Tr.resolve(jr.data);else if(jr.callback===ur.ERROR)Tr.reject(hr(jr.reason));else throw new Error("Unexpected callback case");return}const wr=this.actionHandler[jr.action];if(!wr)throw new Error(`Unknown action from worker: ${jr.action}`);if(jr.callbackId){const Sr=this.sourceName,Tr=jr.sourceName;new Promise(function(Rr){Rr(wr(jr.data))}).then(function(Rr){br.postMessage({sourceName:Sr,targetName:Tr,callback:ur.DATA,callbackId:jr.callbackId,data:Rr})},function(Rr){br.postMessage({sourceName:Sr,targetName:Tr,callback:ur.ERROR,callbackId:jr.callbackId,reason:hr(Rr)})});return}if(jr.streamId){ws(this,mr,nu).call(this,jr);return}wr(jr.data)},br.addEventListener("message",this._onComObjOnMessage)}on(gr,yr){const br=this.actionHandler;if(br[gr])throw new Error(`There is already an actionName called "${gr}"`);br[gr]=yr}send(gr,yr,br){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:gr,data:yr},br)}sendWithPromise(gr,yr,br){const _r=this.callbackId++,jr=new cr.PromiseCapability;this.callbackCapabilities[_r]=jr;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:gr,callbackId:_r,data:yr},br)}catch(wr){jr.reject(wr)}return jr.promise}sendWithStream(gr,yr,br,_r){const jr=this.streamId++,wr=this.sourceName,Sr=this.targetName,Tr=this.comObj;return new ReadableStream({start:Rr=>{const Nr=new cr.PromiseCapability;return this.streamControllers[jr]={controller:Rr,startCall:Nr,pullCall:null,cancelCall:null,isClosed:!1},Tr.postMessage({sourceName:wr,targetName:Sr,action:gr,streamId:jr,data:yr,desiredSize:Rr.desiredSize},_r),Nr.promise},pull:Rr=>{const Nr=new cr.PromiseCapability;return this.streamControllers[jr].pullCall=Nr,Tr.postMessage({sourceName:wr,targetName:Sr,stream:dr.PULL,streamId:jr,desiredSize:Rr.desiredSize}),Nr.promise},cancel:Rr=>{(0,cr.assert)(Rr instanceof Error,"cancel must have a valid reason");const Nr=new cr.PromiseCapability;return this.streamControllers[jr].cancelCall=Nr,this.streamControllers[jr].isClosed=!0,Tr.postMessage({sourceName:wr,targetName:Sr,stream:dr.CANCEL,streamId:jr,reason:hr(Rr)}),Nr.promise}},br)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}mr=new WeakSet,nu=function(gr){const yr=gr.streamId,br=this.sourceName,_r=gr.sourceName,jr=this.comObj,wr=this,Sr=this.actionHandler[gr.action],Tr={enqueue(Rr,Nr=1,Cr){if(this.isCancelled)return;const kr=this.desiredSize;this.desiredSize-=Nr,kr>0&&this.desiredSize<=0&&(this.sinkCapability=new cr.PromiseCapability,this.ready=this.sinkCapability.promise),jr.postMessage({sourceName:br,targetName:_r,stream:dr.ENQUEUE,streamId:yr,chunk:Rr},Cr)},close(){this.isCancelled||(this.isCancelled=!0,jr.postMessage({sourceName:br,targetName:_r,stream:dr.CLOSE,streamId:yr}),delete wr.streamSinks[yr])},error(Rr){(0,cr.assert)(Rr instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,jr.postMessage({sourceName:br,targetName:_r,stream:dr.ERROR,streamId:yr,reason:hr(Rr)}))},sinkCapability:new cr.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:gr.desiredSize,ready:null};Tr.sinkCapability.resolve(),Tr.ready=Tr.sinkCapability.promise,this.streamSinks[yr]=Tr,new Promise(function(Rr){Rr(Sr(gr.data,Tr))}).then(function(){jr.postMessage({sourceName:br,targetName:_r,stream:dr.START_COMPLETE,streamId:yr,success:!0})},function(Rr){jr.postMessage({sourceName:br,targetName:_r,stream:dr.START_COMPLETE,streamId:yr,reason:hr(Rr)})})},iu=function(gr){const yr=gr.streamId,br=this.sourceName,_r=gr.sourceName,jr=this.comObj,wr=this.streamControllers[yr],Sr=this.streamSinks[yr];switch(gr.stream){case dr.START_COMPLETE:gr.success?wr.startCall.resolve():wr.startCall.reject(hr(gr.reason));break;case dr.PULL_COMPLETE:gr.success?wr.pullCall.resolve():wr.pullCall.reject(hr(gr.reason));break;case dr.PULL:if(!Sr){jr.postMessage({sourceName:br,targetName:_r,stream:dr.PULL_COMPLETE,streamId:yr,success:!0});break}Sr.desiredSize<=0&&gr.desiredSize>0&&Sr.sinkCapability.resolve(),Sr.desiredSize=gr.desiredSize,new Promise(function(Tr){var Rr;Tr((Rr=Sr.onPull)==null?void 0:Rr.call(Sr))}).then(function(){jr.postMessage({sourceName:br,targetName:_r,stream:dr.PULL_COMPLETE,streamId:yr,success:!0})},function(Tr){jr.postMessage({sourceName:br,targetName:_r,stream:dr.PULL_COMPLETE,streamId:yr,reason:hr(Tr)})});break;case dr.ENQUEUE:if((0,cr.assert)(wr,"enqueue should have stream controller"),wr.isClosed)break;wr.controller.enqueue(gr.chunk);break;case dr.CLOSE:if((0,cr.assert)(wr,"close should have stream controller"),wr.isClosed)break;wr.isClosed=!0,wr.controller.close(),ws(this,mr,Mo).call(this,wr,yr);break;case dr.ERROR:(0,cr.assert)(wr,"error should have stream controller"),wr.controller.error(hr(gr.reason)),ws(this,mr,Mo).call(this,wr,yr);break;case dr.CANCEL_COMPLETE:gr.success?wr.cancelCall.resolve():wr.cancelCall.reject(hr(gr.reason)),ws(this,mr,Mo).call(this,wr,yr);break;case dr.CANCEL:if(!Sr)break;new Promise(function(Tr){var Rr;Tr((Rr=Sr.onCancel)==null?void 0:Rr.call(Sr,hr(gr.reason)))}).then(function(){jr.postMessage({sourceName:br,targetName:_r,stream:dr.CANCEL_COMPLETE,streamId:yr,success:!0})},function(Tr){jr.postMessage({sourceName:br,targetName:_r,stream:dr.CANCEL_COMPLETE,streamId:yr,reason:hr(Tr)})}),Sr.sinkCapability.reject(hr(gr.reason)),Sr.isCancelled=!0,delete this.streamSinks[yr];break;default:throw new Error("Unexpected stream case")}},Mo=async function(gr,yr){var br,_r,jr;await Promise.allSettled([(br=gr.startCall)==null?void 0:br.promise,(_r=gr.pullCall)==null?void 0:_r.promise,(jr=gr.cancelCall)==null?void 0:jr.promise]),delete this.streamControllers[yr]},or.MessageHandler=pr},(ar,or,lr)=>{var dr,hr;Object.defineProperty(or,"__esModule",{value:!0}),or.Metadata=void 0;var cr=lr(1);class ur{constructor({parsedData:mr,rawData:fr}){Ns(this,dr);Ns(this,hr);ks(this,dr,mr),ks(this,hr,fr)}getRaw(){return $r(this,hr)}get(mr){return $r(this,dr).get(mr)??null}getAll(){return(0,cr.objectFromMap)($r(this,dr))}has(mr){return $r(this,dr).has(mr)}}dr=new WeakMap,hr=new WeakMap,or.Metadata=ur},(ar,or,lr)=>{var mr,fr,xr,Er,vr,gr,Tl;Object.defineProperty(or,"__esModule",{value:!0}),or.OptionalContentConfig=void 0;var cr=lr(1),ur=lr(8);const dr=Symbol("INTERNAL");class hr{constructor(_r,jr){Ns(this,mr,!0);this.name=_r,this.intent=jr}get visible(){return $r(this,mr)}_setVisible(_r,jr){_r!==dr&&(0,cr.unreachable)("Internal method `_setVisible` called."),ks(this,mr,jr)}}mr=new WeakMap;class pr{constructor(_r){Ns(this,gr);Ns(this,fr,null);Ns(this,xr,new Map);Ns(this,Er,null);Ns(this,vr,null);if(this.name=null,this.creator=null,_r!==null){this.name=_r.name,this.creator=_r.creator,ks(this,vr,_r.order);for(const jr of _r.groups)$r(this,xr).set(jr.id,new hr(jr.name,jr.intent));if(_r.baseState==="OFF")for(const jr of $r(this,xr).values())jr._setVisible(dr,!1);for(const jr of _r.on)$r(this,xr).get(jr)._setVisible(dr,!0);for(const jr of _r.off)$r(this,xr).get(jr)._setVisible(dr,!1);ks(this,Er,this.getHash())}}isVisible(_r){if($r(this,xr).size===0)return!0;if(!_r)return(0,cr.warn)("Optional content group not defined."),!0;if(_r.type==="OCG")return $r(this,xr).has(_r.id)?$r(this,xr).get(_r.id).visible:((0,cr.warn)(`Optional content group not found: ${_r.id}`),!0);if(_r.type==="OCMD"){if(_r.expression)return ws(this,gr,Tl).call(this,_r.expression);if(!_r.policy||_r.policy==="AnyOn"){for(const jr of _r.ids){if(!$r(this,xr).has(jr))return(0,cr.warn)(`Optional content group not found: ${jr}`),!0;if($r(this,xr).get(jr).visible)return!0}return!1}else if(_r.policy==="AllOn"){for(const jr of _r.ids){if(!$r(this,xr).has(jr))return(0,cr.warn)(`Optional content group not found: ${jr}`),!0;if(!$r(this,xr).get(jr).visible)return!1}return!0}else if(_r.policy==="AnyOff"){for(const jr of _r.ids){if(!$r(this,xr).has(jr))return(0,cr.warn)(`Optional content group not found: ${jr}`),!0;if(!$r(this,xr).get(jr).visible)return!0}return!1}else if(_r.policy==="AllOff"){for(const jr of _r.ids){if(!$r(this,xr).has(jr))return(0,cr.warn)(`Optional content group not found: ${jr}`),!0;if($r(this,xr).get(jr).visible)return!1}return!0}return(0,cr.warn)(`Unknown optional content policy ${_r.policy}.`),!0}return(0,cr.warn)(`Unknown group type ${_r.type}.`),!0}setVisibility(_r,jr=!0){if(!$r(this,xr).has(_r)){(0,cr.warn)(`Optional content group not found: ${_r}`);return}$r(this,xr).get(_r)._setVisible(dr,!!jr),ks(this,fr,null)}get hasInitialVisibility(){return $r(this,Er)===null||this.getHash()===$r(this,Er)}getOrder(){return $r(this,xr).size?$r(this,vr)?$r(this,vr).slice():[...$r(this,xr).keys()]:null}getGroups(){return $r(this,xr).size>0?(0,cr.objectFromMap)($r(this,xr)):null}getGroup(_r){return $r(this,xr).get(_r)||null}getHash(){if($r(this,fr)!==null)return $r(this,fr);const _r=new ur.MurmurHash3_64;for(const[jr,wr]of $r(this,xr))_r.update(`${jr}:${wr.visible}`);return ks(this,fr,_r.hexdigest())}}fr=new WeakMap,xr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakSet,Tl=function(_r){const jr=_r.length;if(jr<2)return!0;const wr=_r[0];for(let Sr=1;Sr<jr;Sr++){const Tr=_r[Sr];let Rr;if(Array.isArray(Tr))Rr=ws(this,gr,Tl).call(this,Tr);else if($r(this,xr).has(Tr))Rr=$r(this,xr).get(Tr).visible;else return(0,cr.warn)(`Optional content group not found: ${Tr}`),!0;switch(wr){case"And":if(!Rr)return!1;break;case"Or":if(Rr)return!0;break;case"Not":return!Rr;default:return!0}}return wr==="And"},or.OptionalContentConfig=pr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.PDFDataTransportStream=void 0;var cr=lr(1),ur=lr(6);class dr{constructor({length:fr,initialData:xr,progressiveDone:Er=!1,contentDispositionFilename:vr=null,disableRange:gr=!1,disableStream:yr=!1},br){if((0,cr.assert)(br,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=Er,this._contentDispositionFilename=vr,(xr==null?void 0:xr.length)>0){const _r=xr instanceof Uint8Array&&xr.byteLength===xr.buffer.byteLength?xr.buffer:new Uint8Array(xr).buffer;this._queuedChunks.push(_r)}this._pdfDataRangeTransport=br,this._isStreamingSupported=!yr,this._isRangeSupported=!gr,this._contentLength=fr,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((_r,jr)=>{this._onReceiveData({begin:_r,chunk:jr})}),this._pdfDataRangeTransport.addProgressListener((_r,jr)=>{this._onProgress({loaded:_r,total:jr})}),this._pdfDataRangeTransport.addProgressiveReadListener(_r=>{this._onReceiveData({chunk:_r})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:fr,chunk:xr}){const Er=xr instanceof Uint8Array&&xr.byteLength===xr.buffer.byteLength?xr.buffer:new Uint8Array(xr).buffer;if(fr===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(Er):this._queuedChunks.push(Er);else{const vr=this._rangeReaders.some(function(gr){return gr._begin!==fr?!1:(gr._enqueue(Er),!0)});(0,cr.assert)(vr,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var fr;return((fr=this._fullRequestReader)==null?void 0:fr._loaded)??0}_onProgress(fr){var xr,Er,vr,gr;fr.total===void 0?(Er=(xr=this._rangeReaders[0])==null?void 0:xr.onProgress)==null||Er.call(xr,{loaded:fr.loaded}):(gr=(vr=this._fullRequestReader)==null?void 0:vr.onProgress)==null||gr.call(vr,{loaded:fr.loaded,total:fr.total})}_onProgressiveDone(){var fr;(fr=this._fullRequestReader)==null||fr.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(fr){const xr=this._rangeReaders.indexOf(fr);xr>=0&&this._rangeReaders.splice(xr,1)}getFullReader(){(0,cr.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const fr=this._queuedChunks;return this._queuedChunks=null,new hr(this,fr,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(fr,xr){if(xr<=this._progressiveDataLength)return null;const Er=new pr(this,fr,xr);return this._pdfDataRangeTransport.requestDataRange(fr,xr),this._rangeReaders.push(Er),Er}cancelAllRequests(fr){var xr;(xr=this._fullRequestReader)==null||xr.cancel(fr);for(const Er of this._rangeReaders.slice(0))Er.cancel(fr);this._pdfDataRangeTransport.abort()}}or.PDFDataTransportStream=dr;class hr{constructor(fr,xr,Er=!1,vr=null){this._stream=fr,this._done=Er||!1,this._filename=(0,ur.isPdfFile)(vr)?vr:null,this._queuedChunks=xr||[],this._loaded=0;for(const gr of this._queuedChunks)this._loaded+=gr.byteLength;this._requests=[],this._headersReady=Promise.resolve(),fr._fullRequestReader=this,this.onProgress=null}_enqueue(fr){this._done||(this._requests.length>0?this._requests.shift().resolve({value:fr,done:!1}):this._queuedChunks.push(fr),this._loaded+=fr.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const fr=new cr.PromiseCapability;return this._requests.push(fr),fr.promise}cancel(fr){this._done=!0;for(const xr of this._requests)xr.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class pr{constructor(fr,xr,Er){this._stream=fr,this._begin=xr,this._end=Er,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(fr){if(!this._done){if(this._requests.length===0)this._queuedChunk=fr;else{this._requests.shift().resolve({value:fr,done:!1});for(const Er of this._requests)Er.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const xr=this._queuedChunk;return this._queuedChunk=null,{value:xr,done:!1}}if(this._done)return{value:void 0,done:!0};const fr=new cr.PromiseCapability;return this._requests.push(fr),fr.promise}cancel(fr){this._done=!0;for(const xr of this._requests)xr.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.PDFFetchStream=void 0;var cr=lr(1),ur=lr(20);function dr(Er,vr,gr){return{method:"GET",headers:Er,signal:gr.signal,mode:"cors",credentials:vr?"include":"same-origin",redirect:"follow"}}function hr(Er){const vr=new Headers;for(const gr in Er){const yr=Er[gr];yr!==void 0&&vr.append(gr,yr)}return vr}function pr(Er){return Er instanceof Uint8Array?Er.buffer:Er instanceof ArrayBuffer?Er:((0,cr.warn)(`getArrayBuffer - unexpected data format: ${Er}`),new Uint8Array(Er).buffer)}class mr{constructor(vr){this.source=vr,this.isHttp=/^https?:/i.test(vr.url),this.httpHeaders=this.isHttp&&vr.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var vr;return((vr=this._fullRequestReader)==null?void 0:vr._loaded)??0}getFullReader(){return(0,cr.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new fr(this),this._fullRequestReader}getRangeReader(vr,gr){if(gr<=this._progressiveDataLength)return null;const yr=new xr(this,vr,gr);return this._rangeRequestReaders.push(yr),yr}cancelAllRequests(vr){var gr;(gr=this._fullRequestReader)==null||gr.cancel(vr);for(const yr of this._rangeRequestReaders.slice(0))yr.cancel(vr)}}or.PDFFetchStream=mr;class fr{constructor(vr){this._stream=vr,this._reader=null,this._loaded=0,this._filename=null;const gr=vr.source;this._withCredentials=gr.withCredentials||!1,this._contentLength=gr.length,this._headersCapability=new cr.PromiseCapability,this._disableRange=gr.disableRange||!1,this._rangeChunkSize=gr.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!gr.disableStream,this._isRangeSupported=!gr.disableRange,this._headers=hr(this._stream.httpHeaders);const yr=gr.url;fetch(yr,dr(this._headers,this._withCredentials,this._abortController)).then(br=>{if(!(0,ur.validateResponseStatus)(br.status))throw(0,ur.createResponseStatusError)(br.status,yr);this._reader=br.body.getReader(),this._headersCapability.resolve();const _r=Sr=>br.headers.get(Sr),{allowRangeRequests:jr,suggestedLength:wr}=(0,ur.validateRangeRequestCapabilities)({getResponseHeader:_r,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=jr,this._contentLength=wr||this._contentLength,this._filename=(0,ur.extractFilenameFromHeader)(_r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new cr.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var yr;await this._headersCapability.promise;const{value:vr,done:gr}=await this._reader.read();return gr?{value:vr,done:gr}:(this._loaded+=vr.byteLength,(yr=this.onProgress)==null||yr.call(this,{loaded:this._loaded,total:this._contentLength}),{value:pr(vr),done:!1})}cancel(vr){var gr;(gr=this._reader)==null||gr.cancel(vr),this._abortController.abort()}}class xr{constructor(vr,gr,yr){this._stream=vr,this._reader=null,this._loaded=0;const br=vr.source;this._withCredentials=br.withCredentials||!1,this._readCapability=new cr.PromiseCapability,this._isStreamingSupported=!br.disableStream,this._abortController=new AbortController,this._headers=hr(this._stream.httpHeaders),this._headers.append("Range",`bytes=${gr}-${yr-1}`);const _r=br.url;fetch(_r,dr(this._headers,this._withCredentials,this._abortController)).then(jr=>{if(!(0,ur.validateResponseStatus)(jr.status))throw(0,ur.createResponseStatusError)(jr.status,_r);this._readCapability.resolve(),this._reader=jr.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var yr;await this._readCapability.promise;const{value:vr,done:gr}=await this._reader.read();return gr?{value:vr,done:gr}:(this._loaded+=vr.byteLength,(yr=this.onProgress)==null||yr.call(this,{loaded:this._loaded}),{value:pr(vr),done:!1})}cancel(vr){var gr;(gr=this._reader)==null||gr.cancel(vr),this._abortController.abort()}}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.createResponseStatusError=mr,or.extractFilenameFromHeader=pr,or.validateRangeRequestCapabilities=hr,or.validateResponseStatus=fr;var cr=lr(1),ur=lr(21),dr=lr(6);function hr({getResponseHeader:xr,isHttp:Er,rangeChunkSize:vr,disableRange:gr}){const yr={allowRangeRequests:!1,suggestedLength:void 0},br=parseInt(xr("Content-Length"),10);return!Number.isInteger(br)||(yr.suggestedLength=br,br<=2*vr)||gr||!Er||xr("Accept-Ranges")!=="bytes"||(xr("Content-Encoding")||"identity")!=="identity"||(yr.allowRangeRequests=!0),yr}function pr(xr){const Er=xr("Content-Disposition");if(Er){let vr=(0,ur.getFilenameFromContentDispositionHeader)(Er);if(vr.includes("%"))try{vr=decodeURIComponent(vr)}catch{}if((0,dr.isPdfFile)(vr))return vr}return null}function mr(xr,Er){return xr===404||xr===0&&Er.startsWith("file:")?new cr.MissingPDFException('Missing PDF "'+Er+'".'):new cr.UnexpectedResponseException(`Unexpected server response (${xr}) while retrieving PDF "${Er}".`,xr)}function fr(xr){return xr===200||xr===206}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.getFilenameFromContentDispositionHeader=ur;var cr=lr(1);function ur(dr){let hr=!0,pr=mr("filename\\*","i").exec(dr);if(pr){pr=pr[1];let br=vr(pr);return br=unescape(br),br=gr(br),br=yr(br),xr(br)}if(pr=Er(dr),pr){const br=yr(pr);return xr(br)}if(pr=mr("filename","i").exec(dr),pr){pr=pr[1];let br=vr(pr);return br=yr(br),xr(br)}function mr(br,_r){return new RegExp("(?:^|;)\\s*"+br+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',_r)}function fr(br,_r){if(br){if(!/^[\x00-\xFF]+$/.test(_r))return _r;try{const jr=new TextDecoder(br,{fatal:!0}),wr=(0,cr.stringToBytes)(_r);_r=jr.decode(wr),hr=!1}catch{}}return _r}function xr(br){return hr&&/[\x80-\xff]/.test(br)&&(br=fr("utf-8",br),hr&&(br=fr("iso-8859-1",br))),br}function Er(br){const _r=[];let jr;const wr=mr("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(jr=wr.exec(br))!==null;){let[,Tr,Rr,Nr]=jr;if(Tr=parseInt(Tr,10),Tr in _r){if(Tr===0)break;continue}_r[Tr]=[Rr,Nr]}const Sr=[];for(let Tr=0;Tr<_r.length&&Tr in _r;++Tr){let[Rr,Nr]=_r[Tr];Nr=vr(Nr),Rr&&(Nr=unescape(Nr),Tr===0&&(Nr=gr(Nr))),Sr.push(Nr)}return Sr.join("")}function vr(br){if(br.startsWith('"')){const _r=br.slice(1).split('\\"');for(let jr=0;jr<_r.length;++jr){const wr=_r[jr].indexOf('"');wr!==-1&&(_r[jr]=_r[jr].slice(0,wr),_r.length=jr+1),_r[jr]=_r[jr].replaceAll(/\\(.)/g,"$1")}br=_r.join('"')}return br}function gr(br){const _r=br.indexOf("'");if(_r===-1)return br;const jr=br.slice(0,_r),Sr=br.slice(_r+1).replace(/^[^']*'/,"");return fr(jr,Sr)}function yr(br){return!br.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(br)?br:br.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(_r,jr,wr,Sr){if(wr==="q"||wr==="Q")return Sr=Sr.replaceAll("_"," "),Sr=Sr.replaceAll(/=([0-9a-fA-F]{2})/g,function(Tr,Rr){return String.fromCharCode(parseInt(Rr,16))}),fr(jr,Sr);try{Sr=atob(Sr)}catch{}return fr(jr,Sr)})}return""}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.PDFNetworkStream=void 0;var cr=lr(1),ur=lr(20);const dr=200,hr=206;function pr(vr){const gr=vr.response;return typeof gr!="string"?gr:(0,cr.stringToBytes)(gr).buffer}class mr{constructor(gr,yr={}){this.url=gr,this.isHttp=/^https?:/i.test(gr),this.httpHeaders=this.isHttp&&yr.httpHeaders||Object.create(null),this.withCredentials=yr.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(gr,yr,br){const _r={begin:gr,end:yr};for(const jr in br)_r[jr]=br[jr];return this.request(_r)}requestFull(gr){return this.request(gr)}request(gr){const yr=new XMLHttpRequest,br=this.currXhrId++,_r=this.pendingRequests[br]={xhr:yr};yr.open("GET",this.url),yr.withCredentials=this.withCredentials;for(const jr in this.httpHeaders){const wr=this.httpHeaders[jr];wr!==void 0&&yr.setRequestHeader(jr,wr)}return this.isHttp&&"begin"in gr&&"end"in gr?(yr.setRequestHeader("Range",`bytes=${gr.begin}-${gr.end-1}`),_r.expectedStatus=hr):_r.expectedStatus=dr,yr.responseType="arraybuffer",gr.onError&&(yr.onerror=function(jr){gr.onError(yr.status)}),yr.onreadystatechange=this.onStateChange.bind(this,br),yr.onprogress=this.onProgress.bind(this,br),_r.onHeadersReceived=gr.onHeadersReceived,_r.onDone=gr.onDone,_r.onError=gr.onError,_r.onProgress=gr.onProgress,yr.send(null),br}onProgress(gr,yr){var _r;const br=this.pendingRequests[gr];br&&((_r=br.onProgress)==null||_r.call(br,yr))}onStateChange(gr,yr){var Tr,Rr,Nr;const br=this.pendingRequests[gr];if(!br)return;const _r=br.xhr;if(_r.readyState>=2&&br.onHeadersReceived&&(br.onHeadersReceived(),delete br.onHeadersReceived),_r.readyState!==4||!(gr in this.pendingRequests))return;if(delete this.pendingRequests[gr],_r.status===0&&this.isHttp){(Tr=br.onError)==null||Tr.call(br,_r.status);return}const jr=_r.status||dr;if(!(jr===dr&&br.expectedStatus===hr)&&jr!==br.expectedStatus){(Rr=br.onError)==null||Rr.call(br,_r.status);return}const Sr=pr(_r);if(jr===hr){const Cr=_r.getResponseHeader("Content-Range"),kr=/bytes (\d+)-(\d+)\/(\d+)/.exec(Cr);br.onDone({begin:parseInt(kr[1],10),chunk:Sr})}else Sr?br.onDone({begin:0,chunk:Sr}):(Nr=br.onError)==null||Nr.call(br,_r.status)}getRequestXhr(gr){return this.pendingRequests[gr].xhr}isPendingRequest(gr){return gr in this.pendingRequests}abortRequest(gr){const yr=this.pendingRequests[gr].xhr;delete this.pendingRequests[gr],yr.abort()}}class fr{constructor(gr){this._source=gr,this._manager=new mr(gr.url,{httpHeaders:gr.httpHeaders,withCredentials:gr.withCredentials}),this._rangeChunkSize=gr.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(gr){const yr=this._rangeRequestReaders.indexOf(gr);yr>=0&&this._rangeRequestReaders.splice(yr,1)}getFullReader(){return(0,cr.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new xr(this._manager,this._source),this._fullRequestReader}getRangeReader(gr,yr){const br=new Er(this._manager,gr,yr);return br.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(br),br}cancelAllRequests(gr){var yr;(yr=this._fullRequestReader)==null||yr.cancel(gr);for(const br of this._rangeRequestReaders.slice(0))br.cancel(gr)}}or.PDFNetworkStream=fr;class xr{constructor(gr,yr){this._manager=gr;const br={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=yr.url,this._fullRequestId=gr.requestFull(br),this._headersReceivedCapability=new cr.PromiseCapability,this._disableRange=yr.disableRange||!1,this._contentLength=yr.length,this._rangeChunkSize=yr.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const gr=this._fullRequestId,yr=this._manager.getRequestXhr(gr),br=wr=>yr.getResponseHeader(wr),{allowRangeRequests:_r,suggestedLength:jr}=(0,ur.validateRangeRequestCapabilities)({getResponseHeader:br,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});_r&&(this._isRangeSupported=!0),this._contentLength=jr||this._contentLength,this._filename=(0,ur.extractFilenameFromHeader)(br),this._isRangeSupported&&this._manager.abortRequest(gr),this._headersReceivedCapability.resolve()}_onDone(gr){if(gr&&(this._requests.length>0?this._requests.shift().resolve({value:gr.chunk,done:!1}):this._cachedChunks.push(gr.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const yr of this._requests)yr.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(gr){this._storedError=(0,ur.createResponseStatusError)(gr,this._url),this._headersReceivedCapability.reject(this._storedError);for(const yr of this._requests)yr.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(gr){var yr;(yr=this.onProgress)==null||yr.call(this,{loaded:gr.loaded,total:gr.lengthComputable?gr.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const gr=new cr.PromiseCapability;return this._requests.push(gr),gr.promise}cancel(gr){this._done=!0,this._headersReceivedCapability.reject(gr);for(const yr of this._requests)yr.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Er{constructor(gr,yr,br){this._manager=gr;const _r={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=gr.url,this._requestId=gr.requestRange(yr,br,_r),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var gr;(gr=this.onClosed)==null||gr.call(this,this)}_onDone(gr){const yr=gr.chunk;this._requests.length>0?this._requests.shift().resolve({value:yr,done:!1}):this._queuedChunk=yr,this._done=!0;for(const br of this._requests)br.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(gr){this._storedError=(0,ur.createResponseStatusError)(gr,this._url);for(const yr of this._requests)yr.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(gr){var yr;this.isStreamingSupported||(yr=this.onProgress)==null||yr.call(this,{loaded:gr.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const yr=this._queuedChunk;return this._queuedChunk=null,{value:yr,done:!1}}if(this._done)return{value:void 0,done:!0};const gr=new cr.PromiseCapability;return this._requests.push(gr),gr.promise}cancel(gr){this._done=!0;for(const yr of this._requests)yr.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.PDFNodeStream=void 0;var cr=lr(1),ur=lr(20);const dr=/^file:\/\/\/[a-zA-Z]:\//;function hr(br){const _r=require$$5,jr=_r.parse(br);return jr.protocol==="file:"||jr.host?jr:/^[a-z]:[/\\]/i.test(br)?_r.parse(`file:///${br}`):(jr.host||(jr.protocol="file:"),jr)}class pr{constructor(_r){this.source=_r,this.url=hr(_r.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&_r.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var _r;return((_r=this._fullRequestReader)==null?void 0:_r._loaded)??0}getFullReader(){return(0,cr.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new gr(this):new Er(this),this._fullRequestReader}getRangeReader(_r,jr){if(jr<=this._progressiveDataLength)return null;const wr=this.isFsUrl?new yr(this,_r,jr):new vr(this,_r,jr);return this._rangeRequestReaders.push(wr),wr}cancelAllRequests(_r){var jr;(jr=this._fullRequestReader)==null||jr.cancel(_r);for(const wr of this._rangeRequestReaders.slice(0))wr.cancel(_r)}}or.PDFNodeStream=pr;class mr{constructor(_r){this._url=_r.url,this._done=!1,this._storedError=null,this.onProgress=null;const jr=_r.source;this._contentLength=jr.length,this._loaded=0,this._filename=null,this._disableRange=jr.disableRange||!1,this._rangeChunkSize=jr.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!jr.disableStream,this._isRangeSupported=!jr.disableRange,this._readableStream=null,this._readCapability=new cr.PromiseCapability,this._headersCapability=new cr.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var wr;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const _r=this._readableStream.read();return _r===null?(this._readCapability=new cr.PromiseCapability,this.read()):(this._loaded+=_r.length,(wr=this.onProgress)==null||wr.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(_r).buffer,done:!1})}cancel(_r){if(!this._readableStream){this._error(_r);return}this._readableStream.destroy(_r)}_error(_r){this._storedError=_r,this._readCapability.resolve()}_setReadableStream(_r){this._readableStream=_r,_r.on("readable",()=>{this._readCapability.resolve()}),_r.on("end",()=>{_r.destroy(),this._done=!0,this._readCapability.resolve()}),_r.on("error",jr=>{this._error(jr)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new cr.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class fr{constructor(_r){this._url=_r.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new cr.PromiseCapability;const jr=_r.source;this._isStreamingSupported=!jr.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var wr;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const _r=this._readableStream.read();return _r===null?(this._readCapability=new cr.PromiseCapability,this.read()):(this._loaded+=_r.length,(wr=this.onProgress)==null||wr.call(this,{loaded:this._loaded}),{value:new Uint8Array(_r).buffer,done:!1})}cancel(_r){if(!this._readableStream){this._error(_r);return}this._readableStream.destroy(_r)}_error(_r){this._storedError=_r,this._readCapability.resolve()}_setReadableStream(_r){this._readableStream=_r,_r.on("readable",()=>{this._readCapability.resolve()}),_r.on("end",()=>{_r.destroy(),this._done=!0,this._readCapability.resolve()}),_r.on("error",jr=>{this._error(jr)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function xr(br,_r){return{protocol:br.protocol,auth:br.auth,host:br.hostname,port:br.port,path:br.path,method:"GET",headers:_r}}class Er extends mr{constructor(_r){super(_r);const jr=wr=>{if(wr.statusCode===404){const Nr=new cr.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Nr,this._headersCapability.reject(Nr);return}this._headersCapability.resolve(),this._setReadableStream(wr);const Sr=Nr=>this._readableStream.headers[Nr.toLowerCase()],{allowRangeRequests:Tr,suggestedLength:Rr}=(0,ur.validateRangeRequestCapabilities)({getResponseHeader:Sr,isHttp:_r.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=Tr,this._contentLength=Rr||this._contentLength,this._filename=(0,ur.extractFilenameFromHeader)(Sr)};if(this._request=null,this._url.protocol==="http:"){const wr=require$$5;this._request=wr.request(xr(this._url,_r.httpHeaders),jr)}else{const wr=require$$5;this._request=wr.request(xr(this._url,_r.httpHeaders),jr)}this._request.on("error",wr=>{this._storedError=wr,this._headersCapability.reject(wr)}),this._request.end()}}class vr extends fr{constructor(_r,jr,wr){super(_r),this._httpHeaders={};for(const Tr in _r.httpHeaders){const Rr=_r.httpHeaders[Tr];Rr!==void 0&&(this._httpHeaders[Tr]=Rr)}this._httpHeaders.Range=`bytes=${jr}-${wr-1}`;const Sr=Tr=>{if(Tr.statusCode===404){const Rr=new cr.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Rr;return}this._setReadableStream(Tr)};if(this._request=null,this._url.protocol==="http:"){const Tr=require$$5;this._request=Tr.request(xr(this._url,this._httpHeaders),Sr)}else{const Tr=require$$5;this._request=Tr.request(xr(this._url,this._httpHeaders),Sr)}this._request.on("error",Tr=>{this._storedError=Tr}),this._request.end()}}class gr extends mr{constructor(_r){super(_r);let jr=decodeURIComponent(this._url.path);dr.test(this._url.href)&&(jr=jr.replace(/^\//,""));const wr=require$$5;wr.lstat(jr,(Sr,Tr)=>{if(Sr){Sr.code==="ENOENT"&&(Sr=new cr.MissingPDFException(`Missing PDF "${jr}".`)),this._storedError=Sr,this._headersCapability.reject(Sr);return}this._contentLength=Tr.size,this._setReadableStream(wr.createReadStream(jr)),this._headersCapability.resolve()})}}class yr extends fr{constructor(_r,jr,wr){super(_r);let Sr=decodeURIComponent(this._url.path);dr.test(this._url.href)&&(Sr=Sr.replace(/^\//,""));const Tr=require$$5;this._setReadableStream(Tr.createReadStream(Sr,{start:jr,end:wr-1}))}}},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.SVGGraphics=void 0;var cr=lr(6),ur=lr(1);const dr={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},hr="http://www.w3.org/XML/1998/namespace",pr="http://www.w3.org/1999/xlink",mr=["butt","round","square"],fr=["miter","round","bevel"],xr=function(Tr,Rr="",Nr=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!Nr)return URL.createObjectURL(new Blob([Tr],{type:Rr}));const Cr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let kr=`data:${Rr};base64,`;for(let Ar=0,Or=Tr.length;Ar<Or;Ar+=3){const Lr=Tr[Ar]&255,Fr=Tr[Ar+1]&255,Hr=Tr[Ar+2]&255,Kr=Lr>>2,Gr=(Lr&3)<<4|Fr>>4,Zr=Ar+1<Or?(Fr&15)<<2|Hr>>6:64,Jr=Ar+2<Or?Hr&63:64;kr+=Cr[Kr]+Cr[Gr]+Cr[Zr]+Cr[Jr]}return kr},Er=function(){const Tr=new Uint8Array([137,80,78,71,13,10,26,10]),Rr=12,Nr=new Int32Array(256);for(let Hr=0;Hr<256;Hr++){let Kr=Hr;for(let Gr=0;Gr<8;Gr++)Kr=Kr&1?3988292384^Kr>>1&2147483647:Kr>>1&2147483647;Nr[Hr]=Kr}function Cr(Hr,Kr,Gr){let Zr=-1;for(let Jr=Kr;Jr<Gr;Jr++){const os=(Zr^Hr[Jr])&255,Ur=Nr[os];Zr=Zr>>>8^Ur}return Zr^-1}function kr(Hr,Kr,Gr,Zr){let Jr=Zr;const os=Kr.length;Gr[Jr]=os>>24&255,Gr[Jr+1]=os>>16&255,Gr[Jr+2]=os>>8&255,Gr[Jr+3]=os&255,Jr+=4,Gr[Jr]=Hr.charCodeAt(0)&255,Gr[Jr+1]=Hr.charCodeAt(1)&255,Gr[Jr+2]=Hr.charCodeAt(2)&255,Gr[Jr+3]=Hr.charCodeAt(3)&255,Jr+=4,Gr.set(Kr,Jr),Jr+=Kr.length;const Ur=Cr(Gr,Zr+4,Jr);Gr[Jr]=Ur>>24&255,Gr[Jr+1]=Ur>>16&255,Gr[Jr+2]=Ur>>8&255,Gr[Jr+3]=Ur&255}function Ar(Hr,Kr,Gr){let Zr=1,Jr=0;for(let os=Kr;os<Gr;++os)Zr=(Zr+(Hr[os]&255))%65521,Jr=(Jr+Zr)%65521;return Jr<<16|Zr}function Or(Hr){if(!ur.isNodeJS)return Lr(Hr);try{const Kr=parseInt(process.versions.node)>=8?Hr:Buffer.from(Hr),Gr=require$$5.deflateSync(Kr,{level:9});return Gr instanceof Uint8Array?Gr:new Uint8Array(Gr)}catch(Kr){(0,ur.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Kr)}return Lr(Hr)}function Lr(Hr){let Kr=Hr.length;const Gr=65535,Zr=Math.ceil(Kr/Gr),Jr=new Uint8Array(2+Kr+Zr*5+4);let os=0;Jr[os++]=120,Jr[os++]=156;let Ur=0;for(;Kr>Gr;)Jr[os++]=0,Jr[os++]=255,Jr[os++]=255,Jr[os++]=0,Jr[os++]=0,Jr.set(Hr.subarray(Ur,Ur+Gr),os),os+=Gr,Ur+=Gr,Kr-=Gr;Jr[os++]=1,Jr[os++]=Kr&255,Jr[os++]=Kr>>8&255,Jr[os++]=~Kr&65535&255,Jr[os++]=(~Kr&65535)>>8&255,Jr.set(Hr.subarray(Ur),os),os+=Hr.length-Ur;const Vr=Ar(Hr,0,Hr.length);return Jr[os++]=Vr>>24&255,Jr[os++]=Vr>>16&255,Jr[os++]=Vr>>8&255,Jr[os++]=Vr&255,Jr}function Fr(Hr,Kr,Gr,Zr){const Jr=Hr.width,os=Hr.height;let Ur,Vr,es;const Ir=Hr.data;switch(Kr){case ur.ImageKind.GRAYSCALE_1BPP:Vr=0,Ur=1,es=Jr+7>>3;break;case ur.ImageKind.RGB_24BPP:Vr=2,Ur=8,es=Jr*3;break;case ur.ImageKind.RGBA_32BPP:Vr=6,Ur=8,es=Jr*4;break;default:throw new Error("invalid format")}const Dr=new Uint8Array((1+es)*os);let Pr=0,Mr=0;for(let ns=0;ns<os;++ns)Dr[Pr++]=0,Dr.set(Ir.subarray(Mr,Mr+es),Pr),Mr+=es,Pr+=es;if(Kr===ur.ImageKind.GRAYSCALE_1BPP&&Zr){Pr=0;for(let ns=0;ns<os;ns++){Pr++;for(let fs=0;fs<es;fs++)Dr[Pr++]^=255}}const Br=new Uint8Array([Jr>>24&255,Jr>>16&255,Jr>>8&255,Jr&255,os>>24&255,os>>16&255,os>>8&255,os&255,Ur,Vr,0,0,0]),Xr=Or(Dr),Wr=Tr.length+Rr*3+Br.length+Xr.length,ss=new Uint8Array(Wr);let ds=0;return ss.set(Tr,ds),ds+=Tr.length,kr("IHDR",Br,ss,ds),ds+=Rr+Br.length,kr("IDATA",Xr,ss,ds),ds+=Rr+Xr.length,kr("IEND",new Uint8Array(0),ss,ds),xr(ss,"image/png",Gr)}return function(Kr,Gr,Zr){const Jr=Kr.kind===void 0?ur.ImageKind.GRAYSCALE_1BPP:Kr.kind;return Fr(Kr,Jr,Gr,Zr)}}();class vr{constructor(){this.fontSizeScale=1,this.fontWeight=dr.fontWeight,this.fontSize=0,this.textMatrix=ur.IDENTITY_MATRIX,this.fontMatrix=ur.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=ur.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=dr.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(Rr,Nr){this.x=Rr,this.y=Nr}}function gr(Tr){let Rr=[];const Nr=[];for(const Cr of Tr){if(Cr.fn==="save"){Rr.push({fnId:92,fn:"group",items:[]}),Nr.push(Rr),Rr=Rr.at(-1).items;continue}Cr.fn==="restore"?Rr=Nr.pop():Rr.push(Cr)}return Rr}function yr(Tr){if(Number.isInteger(Tr))return Tr.toString();const Rr=Tr.toFixed(10);let Nr=Rr.length-1;if(Rr[Nr]!=="0")return Rr;do Nr--;while(Rr[Nr]==="0");return Rr.substring(0,Rr[Nr]==="."?Nr:Nr+1)}function br(Tr){if(Tr[4]===0&&Tr[5]===0){if(Tr[1]===0&&Tr[2]===0)return Tr[0]===1&&Tr[3]===1?"":`scale(${yr(Tr[0])} ${yr(Tr[3])})`;if(Tr[0]===Tr[3]&&Tr[1]===-Tr[2]){const Rr=Math.acos(Tr[0])*180/Math.PI;return`rotate(${yr(Rr)})`}}else if(Tr[0]===1&&Tr[1]===0&&Tr[2]===0&&Tr[3]===1)return`translate(${yr(Tr[4])} ${yr(Tr[5])})`;return`matrix(${yr(Tr[0])} ${yr(Tr[1])} ${yr(Tr[2])} ${yr(Tr[3])} ${yr(Tr[4])} ${yr(Tr[5])})`}let _r=0,jr=0,wr=0;class Sr{constructor(Rr,Nr,Cr=!1){(0,cr.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new cr.DOMSVGFactory,this.current=new vr,this.transformMatrix=ur.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=Rr,this.objs=Nr,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!Cr,this._operatorIdMapping=[];for(const kr in ur.OPS)this._operatorIdMapping[ur.OPS[kr]]=kr}getObject(Rr,Nr=null){return typeof Rr=="string"?Rr.startsWith("g_")?this.commonObjs.get(Rr):this.objs.get(Rr):Nr}save(){this.transformStack.push(this.transformMatrix);const Rr=this.current;this.extraStack.push(Rr),this.current=Rr.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(Rr){this.save(),this.executeOpTree(Rr),this.restore()}loadDependencies(Rr){const Nr=Rr.fnArray,Cr=Rr.argsArray;for(let kr=0,Ar=Nr.length;kr<Ar;kr++)if(Nr[kr]===ur.OPS.dependency)for(const Or of Cr[kr]){const Lr=Or.startsWith("g_")?this.commonObjs:this.objs,Fr=new Promise(Hr=>{Lr.get(Or,Hr)});this.current.dependencies.push(Fr)}return Promise.all(this.current.dependencies)}transform(Rr,Nr,Cr,kr,Ar,Or){const Lr=[Rr,Nr,Cr,kr,Ar,Or];this.transformMatrix=ur.Util.transform(this.transformMatrix,Lr),this.tgrp=null}getSVG(Rr,Nr){this.viewport=Nr;const Cr=this._initialize(Nr);return this.loadDependencies(Rr).then(()=>(this.transformMatrix=ur.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(Rr)),Cr))}convertOpList(Rr){const Nr=this._operatorIdMapping,Cr=Rr.argsArray,kr=Rr.fnArray,Ar=[];for(let Or=0,Lr=kr.length;Or<Lr;Or++){const Fr=kr[Or];Ar.push({fnId:Fr,fn:Nr[Fr],args:Cr[Or]})}return gr(Ar)}executeOpTree(Rr){for(const Nr of Rr){const Cr=Nr.fn,kr=Nr.fnId,Ar=Nr.args;switch(kr|0){case ur.OPS.beginText:this.beginText();break;case ur.OPS.dependency:break;case ur.OPS.setLeading:this.setLeading(Ar);break;case ur.OPS.setLeadingMoveText:this.setLeadingMoveText(Ar[0],Ar[1]);break;case ur.OPS.setFont:this.setFont(Ar);break;case ur.OPS.showText:this.showText(Ar[0]);break;case ur.OPS.showSpacedText:this.showText(Ar[0]);break;case ur.OPS.endText:this.endText();break;case ur.OPS.moveText:this.moveText(Ar[0],Ar[1]);break;case ur.OPS.setCharSpacing:this.setCharSpacing(Ar[0]);break;case ur.OPS.setWordSpacing:this.setWordSpacing(Ar[0]);break;case ur.OPS.setHScale:this.setHScale(Ar[0]);break;case ur.OPS.setTextMatrix:this.setTextMatrix(Ar[0],Ar[1],Ar[2],Ar[3],Ar[4],Ar[5]);break;case ur.OPS.setTextRise:this.setTextRise(Ar[0]);break;case ur.OPS.setTextRenderingMode:this.setTextRenderingMode(Ar[0]);break;case ur.OPS.setLineWidth:this.setLineWidth(Ar[0]);break;case ur.OPS.setLineJoin:this.setLineJoin(Ar[0]);break;case ur.OPS.setLineCap:this.setLineCap(Ar[0]);break;case ur.OPS.setMiterLimit:this.setMiterLimit(Ar[0]);break;case ur.OPS.setFillRGBColor:this.setFillRGBColor(Ar[0],Ar[1],Ar[2]);break;case ur.OPS.setStrokeRGBColor:this.setStrokeRGBColor(Ar[0],Ar[1],Ar[2]);break;case ur.OPS.setStrokeColorN:this.setStrokeColorN(Ar);break;case ur.OPS.setFillColorN:this.setFillColorN(Ar);break;case ur.OPS.shadingFill:this.shadingFill(Ar[0]);break;case ur.OPS.setDash:this.setDash(Ar[0],Ar[1]);break;case ur.OPS.setRenderingIntent:this.setRenderingIntent(Ar[0]);break;case ur.OPS.setFlatness:this.setFlatness(Ar[0]);break;case ur.OPS.setGState:this.setGState(Ar[0]);break;case ur.OPS.fill:this.fill();break;case ur.OPS.eoFill:this.eoFill();break;case ur.OPS.stroke:this.stroke();break;case ur.OPS.fillStroke:this.fillStroke();break;case ur.OPS.eoFillStroke:this.eoFillStroke();break;case ur.OPS.clip:this.clip("nonzero");break;case ur.OPS.eoClip:this.clip("evenodd");break;case ur.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case ur.OPS.paintImageXObject:this.paintImageXObject(Ar[0]);break;case ur.OPS.paintInlineImageXObject:this.paintInlineImageXObject(Ar[0]);break;case ur.OPS.paintImageMaskXObject:this.paintImageMaskXObject(Ar[0]);break;case ur.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(Ar[0],Ar[1]);break;case ur.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case ur.OPS.closePath:this.closePath();break;case ur.OPS.closeStroke:this.closeStroke();break;case ur.OPS.closeFillStroke:this.closeFillStroke();break;case ur.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case ur.OPS.nextLine:this.nextLine();break;case ur.OPS.transform:this.transform(Ar[0],Ar[1],Ar[2],Ar[3],Ar[4],Ar[5]);break;case ur.OPS.constructPath:this.constructPath(Ar[0],Ar[1]);break;case ur.OPS.endPath:this.endPath();break;case 92:this.group(Nr.items);break;default:(0,ur.warn)(`Unimplemented operator ${Cr}`);break}}}setWordSpacing(Rr){this.current.wordSpacing=Rr}setCharSpacing(Rr){this.current.charSpacing=Rr}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(Rr,Nr,Cr,kr,Ar,Or){const Lr=this.current;Lr.textMatrix=Lr.lineMatrix=[Rr,Nr,Cr,kr,Ar,Or],Lr.textMatrixScale=Math.hypot(Rr,Nr),Lr.x=Lr.lineX=0,Lr.y=Lr.lineY=0,Lr.xcoords=[],Lr.ycoords=[],Lr.tspan=this.svgFactory.createElement("svg:tspan"),Lr.tspan.setAttributeNS(null,"font-family",Lr.fontFamily),Lr.tspan.setAttributeNS(null,"font-size",`${yr(Lr.fontSize)}px`),Lr.tspan.setAttributeNS(null,"y",yr(-Lr.y)),Lr.txtElement=this.svgFactory.createElement("svg:text"),Lr.txtElement.append(Lr.tspan)}beginText(){const Rr=this.current;Rr.x=Rr.lineX=0,Rr.y=Rr.lineY=0,Rr.textMatrix=ur.IDENTITY_MATRIX,Rr.lineMatrix=ur.IDENTITY_MATRIX,Rr.textMatrixScale=1,Rr.tspan=this.svgFactory.createElement("svg:tspan"),Rr.txtElement=this.svgFactory.createElement("svg:text"),Rr.txtgrp=this.svgFactory.createElement("svg:g"),Rr.xcoords=[],Rr.ycoords=[]}moveText(Rr,Nr){const Cr=this.current;Cr.x=Cr.lineX+=Rr,Cr.y=Cr.lineY+=Nr,Cr.xcoords=[],Cr.ycoords=[],Cr.tspan=this.svgFactory.createElement("svg:tspan"),Cr.tspan.setAttributeNS(null,"font-family",Cr.fontFamily),Cr.tspan.setAttributeNS(null,"font-size",`${yr(Cr.fontSize)}px`),Cr.tspan.setAttributeNS(null,"y",yr(-Cr.y))}showText(Rr){const Nr=this.current,Cr=Nr.font,kr=Nr.fontSize;if(kr===0)return;const Ar=Nr.fontSizeScale,Or=Nr.charSpacing,Lr=Nr.wordSpacing,Fr=Nr.fontDirection,Hr=Nr.textHScale*Fr,Kr=Cr.vertical,Gr=Kr?1:-1,Zr=Cr.defaultVMetrics,Jr=kr*Nr.fontMatrix[0];let os=0;for(const es of Rr){if(es===null){os+=Fr*Lr;continue}else if(typeof es=="number"){os+=Gr*es*kr/1e3;continue}const Ir=(es.isSpace?Lr:0)+Or,Dr=es.fontChar;let Pr,Mr,Br=es.width;if(Kr){let Wr;const ss=es.vmetric||Zr;Wr=es.vmetric?ss[1]:Br*.5,Wr=-Wr*Jr;const ds=ss[2]*Jr;Br=ss?-ss[0]:Br,Pr=Wr/Ar,Mr=(os+ds)/Ar}else Pr=os/Ar,Mr=0;(es.isInFont||Cr.missingFile)&&(Nr.xcoords.push(Nr.x+Pr),Kr&&Nr.ycoords.push(-Nr.y+Mr),Nr.tspan.textContent+=Dr);const Xr=Kr?Br*Jr-Ir*Fr:Br*Jr+Ir*Fr;os+=Xr}Nr.tspan.setAttributeNS(null,"x",Nr.xcoords.map(yr).join(" ")),Kr?Nr.tspan.setAttributeNS(null,"y",Nr.ycoords.map(yr).join(" ")):Nr.tspan.setAttributeNS(null,"y",yr(-Nr.y)),Kr?Nr.y-=os:Nr.x+=os*Hr,Nr.tspan.setAttributeNS(null,"font-family",Nr.fontFamily),Nr.tspan.setAttributeNS(null,"font-size",`${yr(Nr.fontSize)}px`),Nr.fontStyle!==dr.fontStyle&&Nr.tspan.setAttributeNS(null,"font-style",Nr.fontStyle),Nr.fontWeight!==dr.fontWeight&&Nr.tspan.setAttributeNS(null,"font-weight",Nr.fontWeight);const Ur=Nr.textRenderingMode&ur.TextRenderingMode.FILL_STROKE_MASK;if(Ur===ur.TextRenderingMode.FILL||Ur===ur.TextRenderingMode.FILL_STROKE?(Nr.fillColor!==dr.fillColor&&Nr.tspan.setAttributeNS(null,"fill",Nr.fillColor),Nr.fillAlpha<1&&Nr.tspan.setAttributeNS(null,"fill-opacity",Nr.fillAlpha)):Nr.textRenderingMode===ur.TextRenderingMode.ADD_TO_PATH?Nr.tspan.setAttributeNS(null,"fill","transparent"):Nr.tspan.setAttributeNS(null,"fill","none"),Ur===ur.TextRenderingMode.STROKE||Ur===ur.TextRenderingMode.FILL_STROKE){const es=1/(Nr.textMatrixScale||1);this._setStrokeAttributes(Nr.tspan,es)}let Vr=Nr.textMatrix;Nr.textRise!==0&&(Vr=Vr.slice(),Vr[5]+=Nr.textRise),Nr.txtElement.setAttributeNS(null,"transform",`${br(Vr)} scale(${yr(Hr)}, -1)`),Nr.txtElement.setAttributeNS(hr,"xml:space","preserve"),Nr.txtElement.append(Nr.tspan),Nr.txtgrp.append(Nr.txtElement),this._ensureTransformGroup().append(Nr.txtElement)}setLeadingMoveText(Rr,Nr){this.setLeading(-Nr),this.moveText(Rr,Nr)}addFontStyle(Rr){if(!Rr.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const Nr=xr(Rr.data,Rr.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${Rr.loadedName}"; src: url(${Nr}); }
`}setFont(Rr){const Nr=this.current,Cr=this.commonObjs.get(Rr[0]);let kr=Rr[1];Nr.font=Cr,this.embedFonts&&!Cr.missingFile&&!this.embeddedFonts[Cr.loadedName]&&(this.addFontStyle(Cr),this.embeddedFonts[Cr.loadedName]=Cr),Nr.fontMatrix=Cr.fontMatrix||ur.FONT_IDENTITY_MATRIX;let Ar="normal";Cr.black?Ar="900":Cr.bold&&(Ar="bold");const Or=Cr.italic?"italic":"normal";kr<0?(kr=-kr,Nr.fontDirection=-1):Nr.fontDirection=1,Nr.fontSize=kr,Nr.fontFamily=Cr.loadedName,Nr.fontWeight=Ar,Nr.fontStyle=Or,Nr.tspan=this.svgFactory.createElement("svg:tspan"),Nr.tspan.setAttributeNS(null,"y",yr(-Nr.y)),Nr.xcoords=[],Nr.ycoords=[]}endText(){var Nr;const Rr=this.current;Rr.textRenderingMode&ur.TextRenderingMode.ADD_TO_PATH_FLAG&&((Nr=Rr.txtElement)!=null&&Nr.hasChildNodes())&&(Rr.element=Rr.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(Rr){Rr>0&&(this.current.lineWidth=Rr)}setLineCap(Rr){this.current.lineCap=mr[Rr]}setLineJoin(Rr){this.current.lineJoin=fr[Rr]}setMiterLimit(Rr){this.current.miterLimit=Rr}setStrokeAlpha(Rr){this.current.strokeAlpha=Rr}setStrokeRGBColor(Rr,Nr,Cr){this.current.strokeColor=ur.Util.makeHexColor(Rr,Nr,Cr)}setFillAlpha(Rr){this.current.fillAlpha=Rr}setFillRGBColor(Rr,Nr,Cr){this.current.fillColor=ur.Util.makeHexColor(Rr,Nr,Cr),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(Rr){this.current.strokeColor=this._makeColorN_Pattern(Rr)}setFillColorN(Rr){this.current.fillColor=this._makeColorN_Pattern(Rr)}shadingFill(Rr){const{width:Nr,height:Cr}=this.viewport,kr=ur.Util.inverseTransform(this.transformMatrix),[Ar,Or,Lr,Fr]=ur.Util.getAxialAlignedBoundingBox([0,0,Nr,Cr],kr),Hr=this.svgFactory.createElement("svg:rect");Hr.setAttributeNS(null,"x",Ar),Hr.setAttributeNS(null,"y",Or),Hr.setAttributeNS(null,"width",Lr-Ar),Hr.setAttributeNS(null,"height",Fr-Or),Hr.setAttributeNS(null,"fill",this._makeShadingPattern(Rr)),this.current.fillAlpha<1&&Hr.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Hr)}_makeColorN_Pattern(Rr){return Rr[0]==="TilingPattern"?this._makeTilingPattern(Rr):this._makeShadingPattern(Rr)}_makeTilingPattern(Rr){const Nr=Rr[1],Cr=Rr[2],kr=Rr[3]||ur.IDENTITY_MATRIX,[Ar,Or,Lr,Fr]=Rr[4],Hr=Rr[5],Kr=Rr[6],Gr=Rr[7],Zr=`shading${wr++}`,[Jr,os,Ur,Vr]=ur.Util.normalizeRect([...ur.Util.applyTransform([Ar,Or],kr),...ur.Util.applyTransform([Lr,Fr],kr)]),[es,Ir]=ur.Util.singularValueDecompose2dScale(kr),Dr=Hr*es,Pr=Kr*Ir,Mr=this.svgFactory.createElement("svg:pattern");Mr.setAttributeNS(null,"id",Zr),Mr.setAttributeNS(null,"patternUnits","userSpaceOnUse"),Mr.setAttributeNS(null,"width",Dr),Mr.setAttributeNS(null,"height",Pr),Mr.setAttributeNS(null,"x",`${Jr}`),Mr.setAttributeNS(null,"y",`${os}`);const Br=this.svg,Xr=this.transformMatrix,Wr=this.current.fillColor,ss=this.current.strokeColor,ds=this.svgFactory.create(Ur-Jr,Vr-os);if(this.svg=ds,this.transformMatrix=kr,Gr===2){const ns=ur.Util.makeHexColor(...Nr);this.current.fillColor=ns,this.current.strokeColor=ns}return this.executeOpTree(this.convertOpList(Cr)),this.svg=Br,this.transformMatrix=Xr,this.current.fillColor=Wr,this.current.strokeColor=ss,Mr.append(ds.childNodes[0]),this.defs.append(Mr),`url(#${Zr})`}_makeShadingPattern(Rr){switch(typeof Rr=="string"&&(Rr=this.objs.get(Rr)),Rr[0]){case"RadialAxial":const Nr=`shading${wr++}`,Cr=Rr[3];let kr;switch(Rr[1]){case"axial":const Ar=Rr[4],Or=Rr[5];kr=this.svgFactory.createElement("svg:linearGradient"),kr.setAttributeNS(null,"id",Nr),kr.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),kr.setAttributeNS(null,"x1",Ar[0]),kr.setAttributeNS(null,"y1",Ar[1]),kr.setAttributeNS(null,"x2",Or[0]),kr.setAttributeNS(null,"y2",Or[1]);break;case"radial":const Lr=Rr[4],Fr=Rr[5],Hr=Rr[6],Kr=Rr[7];kr=this.svgFactory.createElement("svg:radialGradient"),kr.setAttributeNS(null,"id",Nr),kr.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),kr.setAttributeNS(null,"cx",Fr[0]),kr.setAttributeNS(null,"cy",Fr[1]),kr.setAttributeNS(null,"r",Kr),kr.setAttributeNS(null,"fx",Lr[0]),kr.setAttributeNS(null,"fy",Lr[1]),kr.setAttributeNS(null,"fr",Hr);break;default:throw new Error(`Unknown RadialAxial type: ${Rr[1]}`)}for(const Ar of Cr){const Or=this.svgFactory.createElement("svg:stop");Or.setAttributeNS(null,"offset",Ar[0]),Or.setAttributeNS(null,"stop-color",Ar[1]),kr.append(Or)}return this.defs.append(kr),`url(#${Nr})`;case"Mesh":return(0,ur.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${Rr[0]}`)}}setDash(Rr,Nr){this.current.dashArray=Rr,this.current.dashPhase=Nr}constructPath(Rr,Nr){const Cr=this.current;let kr=Cr.x,Ar=Cr.y,Or=[],Lr=0;for(const Fr of Rr)switch(Fr|0){case ur.OPS.rectangle:kr=Nr[Lr++],Ar=Nr[Lr++];const Hr=Nr[Lr++],Kr=Nr[Lr++],Gr=kr+Hr,Zr=Ar+Kr;Or.push("M",yr(kr),yr(Ar),"L",yr(Gr),yr(Ar),"L",yr(Gr),yr(Zr),"L",yr(kr),yr(Zr),"Z");break;case ur.OPS.moveTo:kr=Nr[Lr++],Ar=Nr[Lr++],Or.push("M",yr(kr),yr(Ar));break;case ur.OPS.lineTo:kr=Nr[Lr++],Ar=Nr[Lr++],Or.push("L",yr(kr),yr(Ar));break;case ur.OPS.curveTo:kr=Nr[Lr+4],Ar=Nr[Lr+5],Or.push("C",yr(Nr[Lr]),yr(Nr[Lr+1]),yr(Nr[Lr+2]),yr(Nr[Lr+3]),yr(kr),yr(Ar)),Lr+=6;break;case ur.OPS.curveTo2:Or.push("C",yr(kr),yr(Ar),yr(Nr[Lr]),yr(Nr[Lr+1]),yr(Nr[Lr+2]),yr(Nr[Lr+3])),kr=Nr[Lr+2],Ar=Nr[Lr+3],Lr+=4;break;case ur.OPS.curveTo3:kr=Nr[Lr+2],Ar=Nr[Lr+3],Or.push("C",yr(Nr[Lr]),yr(Nr[Lr+1]),yr(kr),yr(Ar),yr(kr),yr(Ar)),Lr+=4;break;case ur.OPS.closePath:Or.push("Z");break}Or=Or.join(" "),Cr.path&&Rr.length>0&&Rr[0]!==ur.OPS.rectangle&&Rr[0]!==ur.OPS.moveTo?Or=Cr.path.getAttributeNS(null,"d")+Or:(Cr.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(Cr.path)),Cr.path.setAttributeNS(null,"d",Or),Cr.path.setAttributeNS(null,"fill","none"),Cr.element=Cr.path,Cr.setCurrentPoint(kr,Ar)}endPath(){const Rr=this.current;if(Rr.path=null,!this.pendingClip)return;if(!Rr.element){this.pendingClip=null;return}const Nr=`clippath${_r++}`,Cr=this.svgFactory.createElement("svg:clipPath");Cr.setAttributeNS(null,"id",Nr),Cr.setAttributeNS(null,"transform",br(this.transformMatrix));const kr=Rr.element.cloneNode(!0);if(this.pendingClip==="evenodd"?kr.setAttributeNS(null,"clip-rule","evenodd"):kr.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,Cr.append(kr),this.defs.append(Cr),Rr.activeClipUrl){Rr.clipGroup=null;for(const Ar of this.extraStack)Ar.clipGroup=null;Cr.setAttributeNS(null,"clip-path",Rr.activeClipUrl)}Rr.activeClipUrl=`url(#${Nr})`,this.tgrp=null}clip(Rr){this.pendingClip=Rr}closePath(){const Rr=this.current;if(Rr.path){const Nr=`${Rr.path.getAttributeNS(null,"d")}Z`;Rr.path.setAttributeNS(null,"d",Nr)}}setLeading(Rr){this.current.leading=-Rr}setTextRise(Rr){this.current.textRise=Rr}setTextRenderingMode(Rr){this.current.textRenderingMode=Rr}setHScale(Rr){this.current.textHScale=Rr/100}setRenderingIntent(Rr){}setFlatness(Rr){}setGState(Rr){for(const[Nr,Cr]of Rr)switch(Nr){case"LW":this.setLineWidth(Cr);break;case"LC":this.setLineCap(Cr);break;case"LJ":this.setLineJoin(Cr);break;case"ML":this.setMiterLimit(Cr);break;case"D":this.setDash(Cr[0],Cr[1]);break;case"RI":this.setRenderingIntent(Cr);break;case"FL":this.setFlatness(Cr);break;case"Font":this.setFont(Cr);break;case"CA":this.setStrokeAlpha(Cr);break;case"ca":this.setFillAlpha(Cr);break;default:(0,ur.warn)(`Unimplemented graphic state operator ${Nr}`);break}}fill(){const Rr=this.current;Rr.element&&(Rr.element.setAttributeNS(null,"fill",Rr.fillColor),Rr.element.setAttributeNS(null,"fill-opacity",Rr.fillAlpha),this.endPath())}stroke(){const Rr=this.current;Rr.element&&(this._setStrokeAttributes(Rr.element),Rr.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(Rr,Nr=1){const Cr=this.current;let kr=Cr.dashArray;Nr!==1&&kr.length>0&&(kr=kr.map(function(Ar){return Nr*Ar})),Rr.setAttributeNS(null,"stroke",Cr.strokeColor),Rr.setAttributeNS(null,"stroke-opacity",Cr.strokeAlpha),Rr.setAttributeNS(null,"stroke-miterlimit",yr(Cr.miterLimit)),Rr.setAttributeNS(null,"stroke-linecap",Cr.lineCap),Rr.setAttributeNS(null,"stroke-linejoin",Cr.lineJoin),Rr.setAttributeNS(null,"stroke-width",yr(Nr*Cr.lineWidth)+"px"),Rr.setAttributeNS(null,"stroke-dasharray",kr.map(yr).join(" ")),Rr.setAttributeNS(null,"stroke-dashoffset",yr(Nr*Cr.dashPhase)+"px")}eoFill(){var Rr;(Rr=this.current.element)==null||Rr.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var Rr;(Rr=this.current.element)==null||Rr.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const Rr=this.svgFactory.createElement("svg:rect");Rr.setAttributeNS(null,"x","0"),Rr.setAttributeNS(null,"y","0"),Rr.setAttributeNS(null,"width","1px"),Rr.setAttributeNS(null,"height","1px"),Rr.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(Rr)}paintImageXObject(Rr){const Nr=this.getObject(Rr);if(!Nr){(0,ur.warn)(`Dependent image with object ID ${Rr} is not ready yet`);return}this.paintInlineImageXObject(Nr)}paintInlineImageXObject(Rr,Nr){const Cr=Rr.width,kr=Rr.height,Ar=Er(Rr,this.forceDataSchema,!!Nr),Or=this.svgFactory.createElement("svg:rect");Or.setAttributeNS(null,"x","0"),Or.setAttributeNS(null,"y","0"),Or.setAttributeNS(null,"width",yr(Cr)),Or.setAttributeNS(null,"height",yr(kr)),this.current.element=Or,this.clip("nonzero");const Lr=this.svgFactory.createElement("svg:image");Lr.setAttributeNS(pr,"xlink:href",Ar),Lr.setAttributeNS(null,"x","0"),Lr.setAttributeNS(null,"y",yr(-kr)),Lr.setAttributeNS(null,"width",yr(Cr)+"px"),Lr.setAttributeNS(null,"height",yr(kr)+"px"),Lr.setAttributeNS(null,"transform",`scale(${yr(1/Cr)} ${yr(-1/kr)})`),Nr?Nr.append(Lr):this._ensureTransformGroup().append(Lr)}paintImageMaskXObject(Rr){const Nr=this.getObject(Rr.data,Rr);if(Nr.bitmap){(0,ur.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const Cr=this.current,kr=Nr.width,Ar=Nr.height,Or=Cr.fillColor;Cr.maskId=`mask${jr++}`;const Lr=this.svgFactory.createElement("svg:mask");Lr.setAttributeNS(null,"id",Cr.maskId);const Fr=this.svgFactory.createElement("svg:rect");Fr.setAttributeNS(null,"x","0"),Fr.setAttributeNS(null,"y","0"),Fr.setAttributeNS(null,"width",yr(kr)),Fr.setAttributeNS(null,"height",yr(Ar)),Fr.setAttributeNS(null,"fill",Or),Fr.setAttributeNS(null,"mask",`url(#${Cr.maskId})`),this.defs.append(Lr),this._ensureTransformGroup().append(Fr),this.paintInlineImageXObject(Nr,Lr)}paintFormXObjectBegin(Rr,Nr){if(Array.isArray(Rr)&&Rr.length===6&&this.transform(Rr[0],Rr[1],Rr[2],Rr[3],Rr[4],Rr[5]),Nr){const Cr=Nr[2]-Nr[0],kr=Nr[3]-Nr[1],Ar=this.svgFactory.createElement("svg:rect");Ar.setAttributeNS(null,"x",Nr[0]),Ar.setAttributeNS(null,"y",Nr[1]),Ar.setAttributeNS(null,"width",yr(Cr)),Ar.setAttributeNS(null,"height",yr(kr)),this.current.element=Ar,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(Rr){const Nr=this.svgFactory.create(Rr.width,Rr.height),Cr=this.svgFactory.createElement("svg:defs");Nr.append(Cr),this.defs=Cr;const kr=this.svgFactory.createElement("svg:g");return kr.setAttributeNS(null,"transform",br(Rr.transform)),Nr.append(kr),this.svg=kr,Nr}_ensureClipGroup(){if(!this.current.clipGroup){const Rr=this.svgFactory.createElement("svg:g");Rr.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(Rr),this.current.clipGroup=Rr}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",br(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}or.SVGGraphics=Sr},(ar,or)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.XfaText=void 0;class lr{static textContent(ur){const dr=[],hr={items:dr,styles:Object.create(null)};function pr(mr){var Er;if(!mr)return;let fr=null;const xr=mr.name;if(xr==="#text")fr=mr.value;else if(lr.shouldBuildText(xr))(Er=mr==null?void 0:mr.attributes)!=null&&Er.textContent?fr=mr.attributes.textContent:mr.value&&(fr=mr.value);else return;if(fr!==null&&dr.push({str:fr}),!!mr.children)for(const vr of mr.children)pr(vr)}return pr(ur),hr}static shouldBuildText(ur){return!(ur==="textarea"||ur==="input"||ur==="option"||ur==="select")}}or.XfaText=lr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.TextLayerRenderTask=void 0,or.renderTextLayer=br,or.updateTextLayer=_r;var cr=lr(1),ur=lr(6);const dr=1e5,hr=30,pr=.8,mr=new Map;function fr(jr,wr){let Sr;if(wr&&cr.FeatureTest.isOffscreenCanvasSupported)Sr=new OffscreenCanvas(jr,jr).getContext("2d",{alpha:!1});else{const Tr=document.createElement("canvas");Tr.width=Tr.height=jr,Sr=Tr.getContext("2d",{alpha:!1})}return Sr}function xr(jr,wr){const Sr=mr.get(jr);if(Sr)return Sr;const Tr=fr(hr,wr);Tr.font=`${hr}px ${jr}`;const Rr=Tr.measureText("");let Nr=Rr.fontBoundingBoxAscent,Cr=Math.abs(Rr.fontBoundingBoxDescent);if(Nr){const Ar=Nr/(Nr+Cr);return mr.set(jr,Ar),Tr.canvas.width=Tr.canvas.height=0,Ar}Tr.strokeStyle="red",Tr.clearRect(0,0,hr,hr),Tr.strokeText("g",0,0);let kr=Tr.getImageData(0,0,hr,hr).data;Cr=0;for(let Ar=kr.length-1-3;Ar>=0;Ar-=4)if(kr[Ar]>0){Cr=Math.ceil(Ar/4/hr);break}Tr.clearRect(0,0,hr,hr),Tr.strokeText("A",0,hr),kr=Tr.getImageData(0,0,hr,hr).data,Nr=0;for(let Ar=0,Or=kr.length;Ar<Or;Ar+=4)if(kr[Ar]>0){Nr=hr-Math.floor(Ar/4/hr);break}if(Tr.canvas.width=Tr.canvas.height=0,Nr){const Ar=Nr/(Nr+Cr);return mr.set(jr,Ar),Ar}return mr.set(jr,pr),pr}function Er(jr,wr,Sr){const Tr=document.createElement("span"),Rr={angle:0,canvasWidth:0,hasText:wr.str!=="",hasEOL:wr.hasEOL,fontSize:0};jr._textDivs.push(Tr);const Nr=cr.Util.transform(jr._transform,wr.transform);let Cr=Math.atan2(Nr[1],Nr[0]);const kr=Sr[wr.fontName];kr.vertical&&(Cr+=Math.PI/2);const Ar=Math.hypot(Nr[2],Nr[3]),Or=Ar*xr(kr.fontFamily,jr._isOffscreenCanvasSupported);let Lr,Fr;Cr===0?(Lr=Nr[4],Fr=Nr[5]-Or):(Lr=Nr[4]+Or*Math.sin(Cr),Fr=Nr[5]-Or*Math.cos(Cr));const Hr="calc(var(--scale-factor)*",Kr=Tr.style;jr._container===jr._rootContainer?(Kr.left=`${(100*Lr/jr._pageWidth).toFixed(2)}%`,Kr.top=`${(100*Fr/jr._pageHeight).toFixed(2)}%`):(Kr.left=`${Hr}${Lr.toFixed(2)}px)`,Kr.top=`${Hr}${Fr.toFixed(2)}px)`),Kr.fontSize=`${Hr}${Ar.toFixed(2)}px)`,Kr.fontFamily=kr.fontFamily,Rr.fontSize=Ar,Tr.setAttribute("role","presentation"),Tr.textContent=wr.str,Tr.dir=wr.dir,jr._fontInspectorEnabled&&(Tr.dataset.fontName=wr.fontName),Cr!==0&&(Rr.angle=Cr*(180/Math.PI));let Gr=!1;if(wr.str.length>1)Gr=!0;else if(wr.str!==" "&&wr.transform[0]!==wr.transform[3]){const Zr=Math.abs(wr.transform[0]),Jr=Math.abs(wr.transform[3]);Zr!==Jr&&Math.max(Zr,Jr)/Math.min(Zr,Jr)>1.5&&(Gr=!0)}Gr&&(Rr.canvasWidth=kr.vertical?wr.height:wr.width),jr._textDivProperties.set(Tr,Rr),jr._isReadableStream&&jr._layoutText(Tr)}function vr(jr){const{div:wr,scale:Sr,properties:Tr,ctx:Rr,prevFontSize:Nr,prevFontFamily:Cr}=jr,{style:kr}=wr;let Ar="";if(Tr.canvasWidth!==0&&Tr.hasText){const{fontFamily:Or}=kr,{canvasWidth:Lr,fontSize:Fr}=Tr;(Nr!==Fr||Cr!==Or)&&(Rr.font=`${Fr*Sr}px ${Or}`,jr.prevFontSize=Fr,jr.prevFontFamily=Or);const{width:Hr}=Rr.measureText(wr.textContent);Hr>0&&(Ar=`scaleX(${Lr*Sr/Hr})`)}Tr.angle!==0&&(Ar=`rotate(${Tr.angle}deg) ${Ar}`),Ar.length>0&&(kr.transform=Ar)}function gr(jr){if(jr._canceled)return;const wr=jr._textDivs,Sr=jr._capability;if(wr.length>dr){Sr.resolve();return}if(!jr._isReadableStream)for(const Rr of wr)jr._layoutText(Rr);Sr.resolve()}class yr{constructor({textContentSource:wr,container:Sr,viewport:Tr,textDivs:Rr,textDivProperties:Nr,textContentItemsStr:Cr,isOffscreenCanvasSupported:kr}){var Hr;this._textContentSource=wr,this._isReadableStream=wr instanceof ReadableStream,this._container=this._rootContainer=Sr,this._textDivs=Rr||[],this._textContentItemsStr=Cr||[],this._isOffscreenCanvasSupported=kr,this._fontInspectorEnabled=!!((Hr=globalThis.FontInspector)!=null&&Hr.enabled),this._reader=null,this._textDivProperties=Nr||new WeakMap,this._canceled=!1,this._capability=new cr.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:Tr.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:fr(0,kr)};const{pageWidth:Ar,pageHeight:Or,pageX:Lr,pageY:Fr}=Tr.rawDims;this._transform=[1,0,0,-1,-Lr,Fr+Or],this._pageWidth=Ar,this._pageHeight=Or,(0,ur.setLayerDimensions)(Sr,Tr),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new cr.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new cr.AbortException("TextLayer task cancelled."))}_processItems(wr,Sr){for(const Tr of wr){if(Tr.str===void 0){if(Tr.type==="beginMarkedContentProps"||Tr.type==="beginMarkedContent"){const Rr=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),Tr.id!==null&&this._container.setAttribute("id",`${Tr.id}`),Rr.append(this._container)}else Tr.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(Tr.str),Er(this,Tr,Sr)}}_layoutText(wr){const Sr=this._layoutTextParams.properties=this._textDivProperties.get(wr);if(this._layoutTextParams.div=wr,vr(this._layoutTextParams),Sr.hasText&&this._container.append(wr),Sr.hasEOL){const Tr=document.createElement("br");Tr.setAttribute("role","presentation"),this._container.append(Tr)}}_render(){const wr=new cr.PromiseCapability;let Sr=Object.create(null);if(this._isReadableStream){const Tr=()=>{this._reader.read().then(({value:Rr,done:Nr})=>{if(Nr){wr.resolve();return}Object.assign(Sr,Rr.styles),this._processItems(Rr.items,Sr),Tr()},wr.reject)};this._reader=this._textContentSource.getReader(),Tr()}else if(this._textContentSource){const{items:Tr,styles:Rr}=this._textContentSource;this._processItems(Tr,Rr),wr.resolve()}else throw new Error('No "textContentSource" parameter specified.');wr.promise.then(()=>{Sr=null,gr(this)},this._capability.reject)}}or.TextLayerRenderTask=yr;function br(jr){!jr.textContentSource&&(jr.textContent||jr.textContentStream)&&((0,ur.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),jr.textContentSource=jr.textContent||jr.textContentStream);const{container:wr,viewport:Sr}=jr,Tr=getComputedStyle(wr),Rr=Tr.getPropertyValue("visibility"),Nr=parseFloat(Tr.getPropertyValue("--scale-factor"));Rr==="visible"&&(!Nr||Math.abs(Nr-Sr.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const Cr=new yr(jr);return Cr._render(),Cr}function _r({container:jr,viewport:wr,textDivs:Sr,textDivProperties:Tr,isOffscreenCanvasSupported:Rr,mustRotate:Nr=!0,mustRescale:Cr=!0}){if(Nr&&(0,ur.setLayerDimensions)(jr,{rotation:wr.rotation}),Cr){const kr=fr(0,Rr),Or={prevFontSize:null,prevFontFamily:null,div:null,scale:wr.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:kr};for(const Lr of Sr)Or.properties=Tr.get(Lr),Or.div=Lr,vr(Or)}}},(ar,or,lr)=>{var xr,Er,vr,gr,yr,br,_r,jr,wr,Sr,Tr,Al,Fo,Pl,Dl;Object.defineProperty(or,"__esModule",{value:!0}),or.AnnotationEditorLayer=void 0;var cr=lr(1),ur=lr(4),dr=lr(28),hr=lr(33),pr=lr(6),mr=lr(34);const Ar=class Ar{constructor({uiManager:Lr,pageIndex:Fr,div:Hr,accessibilityManager:Kr,annotationLayer:Gr,viewport:Zr,l10n:Jr}){Ns(this,Tr);Ns(this,xr);Ns(this,Er,!1);Ns(this,vr,null);Ns(this,gr,this.pointerup.bind(this));Ns(this,yr,this.pointerdown.bind(this));Ns(this,br,new Map);Ns(this,_r,!1);Ns(this,jr,!1);Ns(this,wr,!1);Ns(this,Sr);const os=[dr.FreeTextEditor,hr.InkEditor,mr.StampEditor];if(!Ar._initialized){Ar._initialized=!0;for(const Ur of os)Ur.initialize(Jr)}Lr.registerEditorTypes(os),ks(this,Sr,Lr),this.pageIndex=Fr,this.div=Hr,ks(this,xr,Kr),ks(this,vr,Gr),this.viewport=Zr,$r(this,Sr).addLayer(this)}get isEmpty(){return $r(this,br).size===0}updateToolbar(Lr){$r(this,Sr).updateToolbar(Lr)}updateMode(Lr=$r(this,Sr).getMode()){ws(this,Tr,Dl).call(this),Lr===cr.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),Lr!==cr.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",Lr===cr.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",Lr===cr.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",Lr===cr.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(Lr){if(!Lr&&$r(this,Sr).getMode()!==cr.AnnotationEditorType.INK)return;if(!Lr){for(const Hr of $r(this,br).values())if(Hr.isEmpty()){Hr.setInBackground();return}}ws(this,Tr,Fo).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(Lr){$r(this,Sr).setEditingState(Lr)}addCommands(Lr){$r(this,Sr).addCommands(Lr)}enable(){this.div.style.pointerEvents="auto";const Lr=new Set;for(const Hr of $r(this,br).values())Hr.enableEditing(),Hr.annotationElementId&&Lr.add(Hr.annotationElementId);if(!$r(this,vr))return;const Fr=$r(this,vr).getEditableAnnotations();for(const Hr of Fr){if(Hr.hide(),$r(this,Sr).isDeletedAnnotationElement(Hr.data.id)||Lr.has(Hr.data.id))continue;const Kr=this.deserialize(Hr);Kr&&(this.addOrRebuild(Kr),Kr.enableEditing())}}disable(){var Fr;ks(this,wr,!0),this.div.style.pointerEvents="none";const Lr=new Set;for(const Hr of $r(this,br).values()){if(Hr.disableEditing(),!Hr.annotationElementId||Hr.serialize()!==null){Lr.add(Hr.annotationElementId);continue}(Fr=this.getEditableAnnotation(Hr.annotationElementId))==null||Fr.show(),Hr.remove()}if($r(this,vr)){const Hr=$r(this,vr).getEditableAnnotations();for(const Kr of Hr){const{id:Gr}=Kr.data;Lr.has(Gr)||$r(this,Sr).isDeletedAnnotationElement(Gr)||Kr.show()}}ws(this,Tr,Dl).call(this),this.isEmpty&&(this.div.hidden=!0),ks(this,wr,!1)}getEditableAnnotation(Lr){var Fr;return((Fr=$r(this,vr))==null?void 0:Fr.getEditableAnnotation(Lr))||null}setActiveEditor(Lr){$r(this,Sr).getActive()!==Lr&&$r(this,Sr).setActiveEditor(Lr)}enableClick(){this.div.addEventListener("pointerdown",$r(this,yr)),this.div.addEventListener("pointerup",$r(this,gr))}disableClick(){this.div.removeEventListener("pointerdown",$r(this,yr)),this.div.removeEventListener("pointerup",$r(this,gr))}attach(Lr){$r(this,br).set(Lr.id,Lr);const{annotationElementId:Fr}=Lr;Fr&&$r(this,Sr).isDeletedAnnotationElement(Fr)&&$r(this,Sr).removeDeletedAnnotationElement(Lr)}detach(Lr){var Fr;$r(this,br).delete(Lr.id),(Fr=$r(this,xr))==null||Fr.removePointerInTextLayer(Lr.contentDiv),!$r(this,wr)&&Lr.annotationElementId&&$r(this,Sr).addDeletedAnnotationElement(Lr)}remove(Lr){this.detach(Lr),$r(this,Sr).removeEditor(Lr),Lr.div.contains(document.activeElement)&&setTimeout(()=>{$r(this,Sr).focusMainContainer()},0),Lr.div.remove(),Lr.isAttachedToDOM=!1,$r(this,jr)||this.addInkEditorIfNeeded(!1)}changeParent(Lr){var Fr;Lr.parent!==this&&(Lr.annotationElementId&&($r(this,Sr).addDeletedAnnotationElement(Lr.annotationElementId),ur.AnnotationEditor.deleteAnnotationElement(Lr),Lr.annotationElementId=null),this.attach(Lr),(Fr=Lr.parent)==null||Fr.detach(Lr),Lr.setParent(this),Lr.div&&Lr.isAttachedToDOM&&(Lr.div.remove(),this.div.append(Lr.div)))}add(Lr){if(this.changeParent(Lr),$r(this,Sr).addEditor(Lr),this.attach(Lr),!Lr.isAttachedToDOM){const Fr=Lr.render();this.div.append(Fr),Lr.isAttachedToDOM=!0}Lr.fixAndSetPosition(),Lr.onceAdded(),$r(this,Sr).addToAnnotationStorage(Lr)}moveEditorInDOM(Lr){var Hr;if(!Lr.isAttachedToDOM)return;const{activeElement:Fr}=document;Lr.div.contains(Fr)&&(Lr._focusEventsAllowed=!1,setTimeout(()=>{Lr.div.contains(document.activeElement)?Lr._focusEventsAllowed=!0:(Lr.div.addEventListener("focusin",()=>{Lr._focusEventsAllowed=!0},{once:!0}),Fr.focus())},0)),Lr._structTreeParentId=(Hr=$r(this,xr))==null?void 0:Hr.moveElementInDOM(this.div,Lr.div,Lr.contentDiv,!0)}addOrRebuild(Lr){Lr.needsToBeRebuilt()?Lr.rebuild():this.add(Lr)}addUndoableEditor(Lr){const Fr=()=>Lr._uiManager.rebuild(Lr),Hr=()=>{Lr.remove()};this.addCommands({cmd:Fr,undo:Hr,mustExec:!1})}getNextId(){return $r(this,Sr).getId()}pasteEditor(Lr,Fr){$r(this,Sr).updateToolbar(Lr),$r(this,Sr).updateMode(Lr);const{offsetX:Hr,offsetY:Kr}=ws(this,Tr,Pl).call(this),Gr=this.getNextId(),Zr=ws(this,Tr,Al).call(this,{parent:this,id:Gr,x:Hr,y:Kr,uiManager:$r(this,Sr),isCentered:!0,...Fr});Zr&&this.add(Zr)}deserialize(Lr){switch(Lr.annotationType??Lr.annotationEditorType){case cr.AnnotationEditorType.FREETEXT:return dr.FreeTextEditor.deserialize(Lr,this,$r(this,Sr));case cr.AnnotationEditorType.INK:return hr.InkEditor.deserialize(Lr,this,$r(this,Sr));case cr.AnnotationEditorType.STAMP:return mr.StampEditor.deserialize(Lr,this,$r(this,Sr))}return null}addNewEditor(){ws(this,Tr,Fo).call(this,ws(this,Tr,Pl).call(this),!0)}setSelected(Lr){$r(this,Sr).setSelected(Lr)}toggleSelected(Lr){$r(this,Sr).toggleSelected(Lr)}isSelected(Lr){return $r(this,Sr).isSelected(Lr)}unselect(Lr){$r(this,Sr).unselect(Lr)}pointerup(Lr){const{isMac:Fr}=cr.FeatureTest.platform;if(!(Lr.button!==0||Lr.ctrlKey&&Fr)&&Lr.target===this.div&&$r(this,_r)){if(ks(this,_r,!1),!$r(this,Er)){ks(this,Er,!0);return}if($r(this,Sr).getMode()===cr.AnnotationEditorType.STAMP){$r(this,Sr).unselectAll();return}ws(this,Tr,Fo).call(this,Lr,!1)}}pointerdown(Lr){if($r(this,_r)){ks(this,_r,!1);return}const{isMac:Fr}=cr.FeatureTest.platform;if(Lr.button!==0||Lr.ctrlKey&&Fr||Lr.target!==this.div)return;ks(this,_r,!0);const Hr=$r(this,Sr).getActive();ks(this,Er,!Hr||Hr.isEmpty())}findNewParent(Lr,Fr,Hr){const Kr=$r(this,Sr).findParent(Fr,Hr);return Kr===null||Kr===this?!1:(Kr.changeParent(Lr),!0)}destroy(){var Lr,Fr;((Lr=$r(this,Sr).getActive())==null?void 0:Lr.parent)===this&&($r(this,Sr).commitOrRemove(),$r(this,Sr).setActiveEditor(null));for(const Hr of $r(this,br).values())(Fr=$r(this,xr))==null||Fr.removePointerInTextLayer(Hr.contentDiv),Hr.setParent(null),Hr.isAttachedToDOM=!1,Hr.div.remove();this.div=null,$r(this,br).clear(),$r(this,Sr).removeLayer(this)}render({viewport:Lr}){this.viewport=Lr,(0,pr.setLayerDimensions)(this.div,Lr);for(const Fr of $r(this,Sr).getEditors(this.pageIndex))this.add(Fr);this.updateMode()}update({viewport:Lr}){$r(this,Sr).commitOrRemove(),this.viewport=Lr,(0,pr.setLayerDimensions)(this.div,{rotation:Lr.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:Lr,pageHeight:Fr}=this.viewport.rawDims;return[Lr,Fr]}};xr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,br=new WeakMap,_r=new WeakMap,jr=new WeakMap,wr=new WeakMap,Sr=new WeakMap,Tr=new WeakSet,Al=function(Lr){switch($r(this,Sr).getMode()){case cr.AnnotationEditorType.FREETEXT:return new dr.FreeTextEditor(Lr);case cr.AnnotationEditorType.INK:return new hr.InkEditor(Lr);case cr.AnnotationEditorType.STAMP:return new mr.StampEditor(Lr)}return null},Fo=function(Lr,Fr){const Hr=this.getNextId(),Kr=ws(this,Tr,Al).call(this,{parent:this,id:Hr,x:Lr.offsetX,y:Lr.offsetY,uiManager:$r(this,Sr),isCentered:Fr});return Kr&&this.add(Kr),Kr},Pl=function(){const{x:Lr,y:Fr,width:Hr,height:Kr}=this.div.getBoundingClientRect(),Gr=Math.max(0,Lr),Zr=Math.max(0,Fr),Jr=Math.min(window.innerWidth,Lr+Hr),os=Math.min(window.innerHeight,Fr+Kr),Ur=(Gr+Jr)/2-Lr,Vr=(Zr+os)/2-Fr,[es,Ir]=this.viewport.rotation%180===0?[Ur,Vr]:[Vr,Ur];return{offsetX:es,offsetY:Ir}},Dl=function(){ks(this,jr,!0);for(const Lr of $r(this,br).values())Lr.isEmpty()&&Lr.remove();ks(this,jr,!1)},io(Ar,"_initialized",!1);let fr=Ar;or.AnnotationEditorLayer=fr},(ar,or,lr)=>{var mr,fr,xr,Er,vr,gr,yr,br,_r,jr,au,ou,lu,No,Ll,cu,Il;Object.defineProperty(or,"__esModule",{value:!0}),or.FreeTextEditor=void 0;var cr=lr(1),ur=lr(5),dr=lr(4),hr=lr(29);const Ar=class Ar extends dr.AnnotationEditor{constructor(Fr){super({...Fr,name:"freeTextEditor"});Ns(this,jr);Ns(this,mr,this.editorDivBlur.bind(this));Ns(this,fr,this.editorDivFocus.bind(this));Ns(this,xr,this.editorDivInput.bind(this));Ns(this,Er,this.editorDivKeydown.bind(this));Ns(this,vr);Ns(this,gr,"");Ns(this,yr,`${this.id}-editor`);Ns(this,br);Ns(this,_r,null);ks(this,vr,Fr.color||Ar._defaultColor||dr.AnnotationEditor._defaultLineColor),ks(this,br,Fr.fontSize||Ar._defaultFontSize)}static get _keyboardManager(){const Fr=Ar.prototype,Hr=Zr=>Zr.isEmpty(),Kr=ur.AnnotationEditorUIManager.TRANSLATE_SMALL,Gr=ur.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,cr.shadow)(this,"_keyboardManager",new ur.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],Fr.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],Fr.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],Fr._translateEmpty,{args:[-Kr,0],checker:Hr}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Fr._translateEmpty,{args:[-Gr,0],checker:Hr}],[["ArrowRight","mac+ArrowRight"],Fr._translateEmpty,{args:[Kr,0],checker:Hr}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Fr._translateEmpty,{args:[Gr,0],checker:Hr}],[["ArrowUp","mac+ArrowUp"],Fr._translateEmpty,{args:[0,-Kr],checker:Hr}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Fr._translateEmpty,{args:[0,-Gr],checker:Hr}],[["ArrowDown","mac+ArrowDown"],Fr._translateEmpty,{args:[0,Kr],checker:Hr}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Fr._translateEmpty,{args:[0,Gr],checker:Hr}]]))}static initialize(Fr){dr.AnnotationEditor.initialize(Fr,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const Hr=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(Hr.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Fr,Hr){switch(Fr){case cr.AnnotationEditorParamsType.FREETEXT_SIZE:Ar._defaultFontSize=Hr;break;case cr.AnnotationEditorParamsType.FREETEXT_COLOR:Ar._defaultColor=Hr;break}}updateParams(Fr,Hr){switch(Fr){case cr.AnnotationEditorParamsType.FREETEXT_SIZE:ws(this,jr,au).call(this,Hr);break;case cr.AnnotationEditorParamsType.FREETEXT_COLOR:ws(this,jr,ou).call(this,Hr);break}}static get defaultPropertiesToUpdate(){return[[cr.AnnotationEditorParamsType.FREETEXT_SIZE,Ar._defaultFontSize],[cr.AnnotationEditorParamsType.FREETEXT_COLOR,Ar._defaultColor||dr.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[cr.AnnotationEditorParamsType.FREETEXT_SIZE,$r(this,br)],[cr.AnnotationEditorParamsType.FREETEXT_COLOR,$r(this,vr)]]}_translateEmpty(Fr,Hr){this._uiManager.translateSelectedEditors(Fr,Hr,!0)}getInitialTranslation(){const Fr=this.parentScale;return[-Ar._internalPadding*Fr,-(Ar._internalPadding+$r(this,br))*Fr]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(cr.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",$r(this,Er)),this.editorDiv.addEventListener("focus",$r(this,fr)),this.editorDiv.addEventListener("blur",$r(this,mr)),this.editorDiv.addEventListener("input",$r(this,xr)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",$r(this,yr)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",$r(this,Er)),this.editorDiv.removeEventListener("focus",$r(this,fr)),this.editorDiv.removeEventListener("blur",$r(this,mr)),this.editorDiv.removeEventListener("input",$r(this,xr)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Fr){this._focusEventsAllowed&&(super.focusin(Fr),Fr.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var Fr;if(this.width){ws(this,jr,Il).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(Fr=this._initialOptions)!=null&&Fr.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Fr=$r(this,gr),Hr=ks(this,gr,ws(this,jr,lu).call(this).trimEnd());if(Fr===Hr)return;const Kr=Gr=>{if(ks(this,gr,Gr),!Gr){this.remove();return}ws(this,jr,Ll).call(this),this._uiManager.rebuild(this),ws(this,jr,No).call(this)};this.addCommands({cmd:()=>{Kr(Hr)},undo:()=>{Kr(Fr)},mustExec:!1}),ws(this,jr,No).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(Fr){this.enterInEditMode()}keydown(Fr){Fr.target===this.div&&Fr.key==="Enter"&&(this.enterInEditMode(),Fr.preventDefault())}editorDivKeydown(Fr){Ar._keyboardManager.exec(this,Fr)}editorDivFocus(Fr){this.isEditing=!0}editorDivBlur(Fr){this.isEditing=!1}editorDivInput(Fr){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Fr,Hr;this.width&&(Fr=this.x,Hr=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",$r(this,yr)),this.enableEditing(),dr.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(Gr=>{var Zr;return(Zr=this.editorDiv)==null?void 0:Zr.setAttribute("aria-label",Gr)}),dr.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(Gr=>{var Zr;return(Zr=this.editorDiv)==null?void 0:Zr.setAttribute("default-content",Gr)}),this.editorDiv.contentEditable=!0;const{style:Kr}=this.editorDiv;if(Kr.fontSize=`calc(${$r(this,br)}px * var(--scale-factor))`,Kr.color=$r(this,vr),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,ur.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Gr,Zr]=this.parentDimensions;if(this.annotationElementId){const{position:Jr}=$r(this,_r);let[os,Ur]=this.getInitialTranslation();[os,Ur]=this.pageTranslationToScreen(os,Ur);const[Vr,es]=this.pageDimensions,[Ir,Dr]=this.pageTranslation;let Pr,Mr;switch(this.rotation){case 0:Pr=Fr+(Jr[0]-Ir)/Vr,Mr=Hr+this.height-(Jr[1]-Dr)/es;break;case 90:Pr=Fr+(Jr[0]-Ir)/Vr,Mr=Hr-(Jr[1]-Dr)/es,[os,Ur]=[Ur,-os];break;case 180:Pr=Fr-this.width+(Jr[0]-Ir)/Vr,Mr=Hr-(Jr[1]-Dr)/es,[os,Ur]=[-os,-Ur];break;case 270:Pr=Fr+(Jr[0]-Ir-this.height*es)/Vr,Mr=Hr+(Jr[1]-Dr-this.width*Vr)/es,[os,Ur]=[-Ur,os];break}this.setAt(Pr*Gr,Mr*Zr,os,Ur)}else this.setAt(Fr*Gr,Hr*Zr,this.width*Gr,this.height*Zr);ws(this,jr,Ll).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Fr,Hr,Kr){let Gr=null;if(Fr instanceof hr.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Jr,fontColor:os},rect:Ur,rotation:Vr,id:es},textContent:Ir,textPosition:Dr,parent:{page:{pageNumber:Pr}}}=Fr;if(!Ir||Ir.length===0)return null;Gr=Fr={annotationType:cr.AnnotationEditorType.FREETEXT,color:Array.from(os),fontSize:Jr,value:Ir.join(`
`),position:Dr,pageIndex:Pr-1,rect:Ur,rotation:Vr,id:es,deleted:!1}}const Zr=super.deserialize(Fr,Hr,Kr);return ks(Zr,br,Fr.fontSize),ks(Zr,vr,cr.Util.makeHexColor(...Fr.color)),ks(Zr,gr,Fr.value),Zr.annotationElementId=Fr.id||null,ks(Zr,_r,Gr),Zr}serialize(Fr=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const Hr=Ar._internalPadding*this.parentScale,Kr=this.getRect(Hr,Hr),Gr=dr.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:$r(this,vr)),Zr={annotationType:cr.AnnotationEditorType.FREETEXT,color:Gr,fontSize:$r(this,br),value:$r(this,gr),pageIndex:this.pageIndex,rect:Kr,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return Fr?Zr:this.annotationElementId&&!ws(this,jr,cu).call(this,Zr)?null:(Zr.id=this.annotationElementId,Zr)}};mr=new WeakMap,fr=new WeakMap,xr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,br=new WeakMap,_r=new WeakMap,jr=new WeakSet,au=function(Fr){const Hr=Gr=>{this.editorDiv.style.fontSize=`calc(${Gr}px * var(--scale-factor))`,this.translate(0,-(Gr-$r(this,br))*this.parentScale),ks(this,br,Gr),ws(this,jr,No).call(this)},Kr=$r(this,br);this.addCommands({cmd:()=>{Hr(Fr)},undo:()=>{Hr(Kr)},mustExec:!0,type:cr.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},ou=function(Fr){const Hr=$r(this,vr);this.addCommands({cmd:()=>{ks(this,vr,this.editorDiv.style.color=Fr)},undo:()=>{ks(this,vr,this.editorDiv.style.color=Hr)},mustExec:!0,type:cr.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},lu=function(){const Fr=this.editorDiv.getElementsByTagName("div");if(Fr.length===0)return this.editorDiv.innerText;const Hr=[];for(const Kr of Fr)Hr.push(Kr.innerText.replace(/\r\n?|\n/,""));return Hr.join(`
`)},No=function(){const[Fr,Hr]=this.parentDimensions;let Kr;if(this.isAttachedToDOM)Kr=this.div.getBoundingClientRect();else{const{currentLayer:Gr,div:Zr}=this,Jr=Zr.style.display;Zr.style.display="hidden",Gr.div.append(this.div),Kr=Zr.getBoundingClientRect(),Zr.remove(),Zr.style.display=Jr}this.rotation%180===this.parentRotation%180?(this.width=Kr.width/Fr,this.height=Kr.height/Hr):(this.width=Kr.height/Fr,this.height=Kr.width/Hr),this.fixAndSetPosition()},Ll=function(){if(this.editorDiv.replaceChildren(),!!$r(this,gr))for(const Fr of $r(this,gr).split(`
`)){const Hr=document.createElement("div");Hr.append(Fr?document.createTextNode(Fr):document.createElement("br")),this.editorDiv.append(Hr)}},cu=function(Fr){const{value:Hr,fontSize:Kr,color:Gr,rect:Zr,pageIndex:Jr}=$r(this,_r);return Fr.value!==Hr||Fr.fontSize!==Kr||Fr.rect.some((os,Ur)=>Math.abs(os-Zr[Ur])>=1)||Fr.color.some((os,Ur)=>os!==Gr[Ur])||Fr.pageIndex!==Jr},Il=function(Fr=!1){if(!this.annotationElementId)return;if(ws(this,jr,No).call(this),!Fr&&(this.width===0||this.height===0)){setTimeout(()=>ws(this,jr,Il).call(this,!0),0);return}const Hr=Ar._internalPadding*this.parentScale;$r(this,_r).rect=this.getRect(Hr,Hr)},io(Ar,"_freeTextDefaultContent",""),io(Ar,"_internalPadding",0),io(Ar,"_defaultColor",null),io(Ar,"_defaultFontSize",10),io(Ar,"_type","freetext");let pr=Ar;or.FreeTextEditor=pr},(ar,or,lr)=>{var Mr,Xr,mo,uu,ds,ns,fs,bs,Es,Ds,gs,as,qr,ts,Yr,hs,ys,_s,Ss,vs,Hs,Bs,du,Oo,Ml,Fl,xa,ro,no,Us,Cs,Ts,qs,Ol,eo,xs,Os,zs,hu,$l;Object.defineProperty(or,"__esModule",{value:!0}),or.StampAnnotationElement=or.InkAnnotationElement=or.FreeTextAnnotationElement=or.AnnotationLayer=void 0;var cr=lr(1),ur=lr(6),dr=lr(3),hr=lr(30),pr=lr(31),mr=lr(32);const fr=1e3,xr=9,Er=new WeakSet;function vr(Ys){return{width:Ys[2]-Ys[0],height:Ys[3]-Ys[1]}}class gr{static create(ms){switch(ms.data.annotationType){case cr.AnnotationType.LINK:return new br(ms);case cr.AnnotationType.TEXT:return new _r(ms);case cr.AnnotationType.WIDGET:switch(ms.data.fieldType){case"Tx":return new wr(ms);case"Btn":return ms.data.radioButton?new Rr(ms):ms.data.checkBox?new Tr(ms):new Nr(ms);case"Ch":return new Cr(ms);case"Sig":return new Sr(ms)}return new jr(ms);case cr.AnnotationType.POPUP:return new kr(ms);case cr.AnnotationType.FREETEXT:return new Or(ms);case cr.AnnotationType.LINE:return new Lr(ms);case cr.AnnotationType.SQUARE:return new Fr(ms);case cr.AnnotationType.CIRCLE:return new Hr(ms);case cr.AnnotationType.POLYLINE:return new Kr(ms);case cr.AnnotationType.CARET:return new Zr(ms);case cr.AnnotationType.INK:return new Jr(ms);case cr.AnnotationType.POLYGON:return new Gr(ms);case cr.AnnotationType.HIGHLIGHT:return new os(ms);case cr.AnnotationType.UNDERLINE:return new Ur(ms);case cr.AnnotationType.SQUIGGLY:return new Vr(ms);case cr.AnnotationType.STRIKEOUT:return new es(ms);case cr.AnnotationType.STAMP:return new Ir(ms);case cr.AnnotationType.FILEATTACHMENT:return new Dr(ms);default:return new yr(ms)}}}const Br=class Br{constructor(ms,{isRenderable:cs=!1,ignoreBorder:js=!1,createQuadrilaterals:Ls=!1}={}){Ns(this,Mr,!1);this.isRenderable=cs,this.data=ms.data,this.layer=ms.layer,this.linkService=ms.linkService,this.downloadManager=ms.downloadManager,this.imageResourcesPath=ms.imageResourcesPath,this.renderForms=ms.renderForms,this.svgFactory=ms.svgFactory,this.annotationStorage=ms.annotationStorage,this.enableScripting=ms.enableScripting,this.hasJSActions=ms.hasJSActions,this._fieldObjects=ms.fieldObjects,this.parent=ms.parent,cs&&(this.container=this._createContainer(js)),Ls&&this._createQuadrilaterals()}static _hasPopupData({titleObj:ms,contentsObj:cs,richText:js}){return!!(ms!=null&&ms.str||cs!=null&&cs.str||js!=null&&js.str)}get hasPopupData(){return Br._hasPopupData(this.data)}_createContainer(ms){const{data:cs,parent:{page:js,viewport:Ls}}=this,Is=document.createElement("section");Is.setAttribute("data-annotation-id",cs.id),this instanceof jr||(Is.tabIndex=fr),Is.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Is.setAttribute("aria-haspopup","dialog"),cs.noRotate&&Is.classList.add("norotate");const{pageWidth:$s,pageHeight:Ws,pageX:_i,pageY:Qs}=Ls.rawDims;if(!cs.rect||this instanceof kr){const{rotation:ls}=cs;return!cs.hasOwnCanvas&&ls!==0&&this.setRotation(ls,Is),Is}const{width:zr,height:us}=vr(cs.rect),Qr=cr.Util.normalizeRect([cs.rect[0],js.view[3]-cs.rect[1]+js.view[1],cs.rect[2],js.view[3]-cs.rect[3]+js.view[1]]);if(!ms&&cs.borderStyle.width>0){Is.style.borderWidth=`${cs.borderStyle.width}px`;const ls=cs.borderStyle.horizontalCornerRadius,ps=cs.borderStyle.verticalCornerRadius;if(ls>0||ps>0){const Fs=`calc(${ls}px * var(--scale-factor)) / calc(${ps}px * var(--scale-factor))`;Is.style.borderRadius=Fs}else if(this instanceof Rr){const Fs=`calc(${zr}px * var(--scale-factor)) / calc(${us}px * var(--scale-factor))`;Is.style.borderRadius=Fs}switch(cs.borderStyle.style){case cr.AnnotationBorderStyleType.SOLID:Is.style.borderStyle="solid";break;case cr.AnnotationBorderStyleType.DASHED:Is.style.borderStyle="dashed";break;case cr.AnnotationBorderStyleType.BEVELED:(0,cr.warn)("Unimplemented border style: beveled");break;case cr.AnnotationBorderStyleType.INSET:(0,cr.warn)("Unimplemented border style: inset");break;case cr.AnnotationBorderStyleType.UNDERLINE:Is.style.borderBottomStyle="solid";break}const Rs=cs.borderColor||null;Rs?(ks(this,Mr,!0),Is.style.borderColor=cr.Util.makeHexColor(Rs[0]|0,Rs[1]|0,Rs[2]|0)):Is.style.borderWidth=0}Is.style.left=`${100*(Qr[0]-_i)/$s}%`,Is.style.top=`${100*(Qr[1]-Qs)/Ws}%`;const{rotation:rs}=cs;return cs.hasOwnCanvas||rs===0?(Is.style.width=`${100*zr/$s}%`,Is.style.height=`${100*us/Ws}%`):this.setRotation(rs,Is),Is}setRotation(ms,cs=this.container){if(!this.data.rect)return;const{pageWidth:js,pageHeight:Ls}=this.parent.viewport.rawDims,{width:Is,height:$s}=vr(this.data.rect);let Ws,_i;ms%180===0?(Ws=100*Is/js,_i=100*$s/Ls):(Ws=100*$s/js,_i=100*Is/Ls),cs.style.width=`${Ws}%`,cs.style.height=`${_i}%`,cs.setAttribute("data-main-rotation",(360-ms)%360)}get _commonActions(){const ms=(cs,js,Ls)=>{const Is=Ls.detail[cs],$s=Is[0],Ws=Is.slice(1);Ls.target.style[js]=hr.ColorConverters[`${$s}_HTML`](Ws),this.annotationStorage.setValue(this.data.id,{[js]:hr.ColorConverters[`${$s}_rgb`](Ws)})};return(0,cr.shadow)(this,"_commonActions",{display:cs=>{const{display:js}=cs.detail,Ls=js%2===1;this.container.style.visibility=Ls?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:Ls,noPrint:js===1||js===2})},print:cs=>{this.annotationStorage.setValue(this.data.id,{noPrint:!cs.detail.print})},hidden:cs=>{const{hidden:js}=cs.detail;this.container.style.visibility=js?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:js,noView:js})},focus:cs=>{setTimeout(()=>cs.target.focus({preventScroll:!1}),0)},userName:cs=>{cs.target.title=cs.detail.userName},readonly:cs=>{cs.target.disabled=cs.detail.readonly},required:cs=>{this._setRequired(cs.target,cs.detail.required)},bgColor:cs=>{ms("bgColor","backgroundColor",cs)},fillColor:cs=>{ms("fillColor","backgroundColor",cs)},fgColor:cs=>{ms("fgColor","color",cs)},textColor:cs=>{ms("textColor","color",cs)},borderColor:cs=>{ms("borderColor","borderColor",cs)},strokeColor:cs=>{ms("strokeColor","borderColor",cs)},rotation:cs=>{const js=cs.detail.rotation;this.setRotation(js),this.annotationStorage.setValue(this.data.id,{rotation:js})}})}_dispatchEventFromSandbox(ms,cs){const js=this._commonActions;for(const Ls of Object.keys(cs.detail)){const Is=ms[Ls]||js[Ls];Is==null||Is(cs)}}_setDefaultPropertiesFromJS(ms){if(!this.enableScripting)return;const cs=this.annotationStorage.getRawValue(this.data.id);if(!cs)return;const js=this._commonActions;for(const[Ls,Is]of Object.entries(cs)){const $s=js[Ls];if($s){const Ws={detail:{[Ls]:Is},target:ms};$s(Ws),delete cs[Ls]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:ms}=this.data;if(!ms)return;const[cs,js,Ls,Is]=this.data.rect;if(ms.length===1){const[,{x:ps,y:Rs},{x:Fs,y:Ps}]=ms[0];if(Ls===ps&&Is===Rs&&cs===Fs&&js===Ps)return}const{style:$s}=this.container;let Ws;if($r(this,Mr)){const{borderColor:ps,borderWidth:Rs}=$s;$s.borderWidth=0,Ws=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${ps}" stroke-width="${Rs}">`],this.container.classList.add("hasBorder")}const _i=Ls-cs,Qs=Is-js,{svgFactory:zr}=this,us=zr.createElement("svg");us.classList.add("quadrilateralsContainer"),us.setAttribute("width",0),us.setAttribute("height",0);const Qr=zr.createElement("defs");us.append(Qr);const rs=zr.createElement("clipPath"),ls=`clippath_${this.data.id}`;rs.setAttribute("id",ls),rs.setAttribute("clipPathUnits","objectBoundingBox"),Qr.append(rs);for(const[,{x:ps,y:Rs},{x:Fs,y:Ps}]of ms){const As=zr.createElement("rect"),Ms=(Fs-cs)/_i,Gs=(Is-Rs)/Qs,Xs=(ps-Fs)/_i,_a=(Rs-Ps)/Qs;As.setAttribute("x",Ms),As.setAttribute("y",Gs),As.setAttribute("width",Xs),As.setAttribute("height",_a),rs.append(As),Ws==null||Ws.push(`<rect vector-effect="non-scaling-stroke" x="${Ms}" y="${Gs}" width="${Xs}" height="${_a}"/>`)}$r(this,Mr)&&(Ws.push("</g></svg>')"),$s.backgroundImage=Ws.join("")),this.container.append(us),this.container.style.clipPath=`url(#${ls})`}_createPopup(){const{container:ms,data:cs}=this;ms.setAttribute("aria-haspopup","dialog");const js=new kr({data:{color:cs.color,titleObj:cs.titleObj,modificationDate:cs.modificationDate,contentsObj:cs.contentsObj,richText:cs.richText,parentRect:cs.rect,borderStyle:0,id:`popup_${cs.id}`,rotation:cs.rotation},parent:this.parent,elements:[this]});this.parent.div.append(js.render())}render(){(0,cr.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(ms,cs=null){const js=[];if(this._fieldObjects){const Ls=this._fieldObjects[ms];if(Ls)for(const{page:Is,id:$s,exportValues:Ws}of Ls){if(Is===-1||$s===cs)continue;const _i=typeof Ws=="string"?Ws:null,Qs=document.querySelector(`[data-element-id="${$s}"]`);if(Qs&&!Er.has(Qs)){(0,cr.warn)(`_getElementsByName - element not allowed: ${$s}`);continue}js.push({id:$s,exportValue:_i,domElement:Qs})}return js}for(const Ls of document.getElementsByName(ms)){const{exportValue:Is}=Ls,$s=Ls.getAttribute("data-element-id");$s!==cs&&Er.has(Ls)&&js.push({id:$s,exportValue:Is,domElement:Ls})}return js}show(){var ms;this.container&&(this.container.hidden=!1),(ms=this.popup)==null||ms.maybeShow()}hide(){var ms;this.container&&(this.container.hidden=!0),(ms=this.popup)==null||ms.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const ms=this.getElementsToTriggerPopup();if(Array.isArray(ms))for(const cs of ms)cs.classList.add("highlightArea");else ms.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:ms,data:{id:cs}}=this;this.container.addEventListener("dblclick",()=>{var js;(js=this.linkService.eventBus)==null||js.dispatch("switchannotationeditormode",{source:this,mode:ms,editId:cs})})}};Mr=new WeakMap;let yr=Br;class br extends yr{constructor(cs,js=null){super(cs,{isRenderable:!0,ignoreBorder:!!(js!=null&&js.ignoreBorder),createQuadrilaterals:!0});Ns(this,Xr);this.isTooltipOnly=cs.data.isTooltipOnly}render(){const{data:cs,linkService:js}=this,Ls=document.createElement("a");Ls.setAttribute("data-element-id",cs.id);let Is=!1;return cs.url?(js.addLinkAttributes(Ls,cs.url,cs.newWindow),Is=!0):cs.action?(this._bindNamedAction(Ls,cs.action),Is=!0):cs.attachment?(this._bindAttachment(Ls,cs.attachment),Is=!0):cs.setOCGState?(ws(this,Xr,uu).call(this,Ls,cs.setOCGState),Is=!0):cs.dest?(this._bindLink(Ls,cs.dest),Is=!0):(cs.actions&&(cs.actions.Action||cs.actions["Mouse Up"]||cs.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(Ls,cs),Is=!0),cs.resetForm?(this._bindResetFormAction(Ls,cs.resetForm),Is=!0):this.isTooltipOnly&&!Is&&(this._bindLink(Ls,""),Is=!0)),this.container.classList.add("linkAnnotation"),Is&&this.container.append(Ls),this.container}_bindLink(cs,js){cs.href=this.linkService.getDestinationHash(js),cs.onclick=()=>(js&&this.linkService.goToDestination(js),!1),(js||js==="")&&ws(this,Xr,mo).call(this)}_bindNamedAction(cs,js){cs.href=this.linkService.getAnchorUrl(""),cs.onclick=()=>(this.linkService.executeNamedAction(js),!1),ws(this,Xr,mo).call(this)}_bindAttachment(cs,js){cs.href=this.linkService.getAnchorUrl(""),cs.onclick=()=>{var Ls;return(Ls=this.downloadManager)==null||Ls.openOrDownloadData(this.container,js.content,js.filename),!1},ws(this,Xr,mo).call(this)}_bindJSAction(cs,js){cs.href=this.linkService.getAnchorUrl("");const Ls=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Is of Object.keys(js.actions)){const $s=Ls.get(Is);$s&&(cs[$s]=()=>{var Ws;return(Ws=this.linkService.eventBus)==null||Ws.dispatch("dispatcheventinsandbox",{source:this,detail:{id:js.id,name:Is}}),!1})}cs.onclick||(cs.onclick=()=>!1),ws(this,Xr,mo).call(this)}_bindResetFormAction(cs,js){const Ls=cs.onclick;if(Ls||(cs.href=this.linkService.getAnchorUrl("")),ws(this,Xr,mo).call(this),!this._fieldObjects){(0,cr.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),Ls||(cs.onclick=()=>!1);return}cs.onclick=()=>{var us;Ls==null||Ls();const{fields:Is,refs:$s,include:Ws}=js,_i=[];if(Is.length!==0||$s.length!==0){const Qr=new Set($s);for(const rs of Is){const ls=this._fieldObjects[rs]||[];for(const{id:ps}of ls)Qr.add(ps)}for(const rs of Object.values(this._fieldObjects))for(const ls of rs)Qr.has(ls.id)===Ws&&_i.push(ls)}else for(const Qr of Object.values(this._fieldObjects))_i.push(...Qr);const Qs=this.annotationStorage,zr=[];for(const Qr of _i){const{id:rs}=Qr;switch(zr.push(rs),Qr.type){case"text":{const ps=Qr.defaultValue||"";Qs.setValue(rs,{value:ps});break}case"checkbox":case"radiobutton":{const ps=Qr.defaultValue===Qr.exportValues;Qs.setValue(rs,{value:ps});break}case"combobox":case"listbox":{const ps=Qr.defaultValue||"";Qs.setValue(rs,{value:ps});break}default:continue}const ls=document.querySelector(`[data-element-id="${rs}"]`);if(ls){if(!Er.has(ls)){(0,cr.warn)(`_bindResetFormAction - element not allowed: ${rs}`);continue}}else continue;ls.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((us=this.linkService.eventBus)==null||us.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:zr,name:"ResetForm"}})),!1}}}Xr=new WeakSet,mo=function(){this.container.setAttribute("data-internal-link","")},uu=function(cs,js){cs.href=this.linkService.getAnchorUrl(""),cs.onclick=()=>(this.linkService.executeSetOCGState(js),!1),ws(this,Xr,mo).call(this)};class _r extends yr{constructor(ms){super(ms,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const ms=document.createElement("img");return ms.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",ms.alt="[{{type}} Annotation]",ms.dataset.l10nId="text_annotation_type",ms.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(ms),this.container}}class jr extends yr{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(ms){var cs;this.data.hasOwnCanvas&&(((cs=ms.previousSibling)==null?void 0:cs.nodeName)==="CANVAS"&&(ms.previousSibling.hidden=!0),ms.hidden=!1)}_getKeyModifier(ms){const{isWin:cs,isMac:js}=cr.FeatureTest.platform;return cs&&ms.ctrlKey||js&&ms.metaKey}_setEventListener(ms,cs,js,Ls,Is){js.includes("mouse")?ms.addEventListener(js,$s=>{var Ws;(Ws=this.linkService.eventBus)==null||Ws.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ls,value:Is($s),shift:$s.shiftKey,modifier:this._getKeyModifier($s)}})}):ms.addEventListener(js,$s=>{var Ws;if(js==="blur"){if(!cs.focused||!$s.relatedTarget)return;cs.focused=!1}else if(js==="focus"){if(cs.focused)return;cs.focused=!0}Is&&((Ws=this.linkService.eventBus)==null||Ws.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ls,value:Is($s)}}))})}_setEventListeners(ms,cs,js,Ls){var Is,$s,Ws;for(const[_i,Qs]of js)(Qs==="Action"||(Is=this.data.actions)!=null&&Is[Qs])&&((Qs==="Focus"||Qs==="Blur")&&(cs||(cs={focused:!1})),this._setEventListener(ms,cs,_i,Qs,Ls),Qs==="Focus"&&!(($s=this.data.actions)!=null&&$s.Blur)?this._setEventListener(ms,cs,"blur","Blur",null):Qs==="Blur"&&!((Ws=this.data.actions)!=null&&Ws.Focus)&&this._setEventListener(ms,cs,"focus","Focus",null))}_setBackgroundColor(ms){const cs=this.data.backgroundColor||null;ms.style.backgroundColor=cs===null?"transparent":cr.Util.makeHexColor(cs[0],cs[1],cs[2])}_setTextStyle(ms){const cs=["left","center","right"],{fontColor:js}=this.data.defaultAppearanceData,Ls=this.data.defaultAppearanceData.fontSize||xr,Is=ms.style;let $s;const Ws=2,_i=Qs=>Math.round(10*Qs)/10;if(this.data.multiLine){const Qs=Math.abs(this.data.rect[3]-this.data.rect[1]-Ws),zr=Math.round(Qs/(cr.LINE_FACTOR*Ls))||1,us=Qs/zr;$s=Math.min(Ls,_i(us/cr.LINE_FACTOR))}else{const Qs=Math.abs(this.data.rect[3]-this.data.rect[1]-Ws);$s=Math.min(Ls,_i(Qs/cr.LINE_FACTOR))}Is.fontSize=`calc(${$s}px * var(--scale-factor))`,Is.color=cr.Util.makeHexColor(js[0],js[1],js[2]),this.data.textAlignment!==null&&(Is.textAlign=cs[this.data.textAlignment])}_setRequired(ms,cs){cs?ms.setAttribute("required",!0):ms.removeAttribute("required"),ms.setAttribute("aria-required",cs)}}class wr extends jr{constructor(ms){const cs=ms.renderForms||!ms.data.hasAppearance&&!!ms.data.fieldValue;super(ms,{isRenderable:cs})}setPropertyOnSiblings(ms,cs,js,Ls){const Is=this.annotationStorage;for(const $s of this._getElementsByName(ms.name,ms.id))$s.domElement&&($s.domElement[cs]=js),Is.setValue($s.id,{[Ls]:js})}render(){var Ls,Is;const ms=this.annotationStorage,cs=this.data.id;this.container.classList.add("textWidgetAnnotation");let js=null;if(this.renderForms){const $s=ms.getValue(cs,{value:this.data.fieldValue});let Ws=$s.value||"";const _i=ms.getValue(cs,{charLimit:this.data.maxLen}).charLimit;_i&&Ws.length>_i&&(Ws=Ws.slice(0,_i));let Qs=$s.formattedValue||((Ls=this.data.textContent)==null?void 0:Ls.join(`
`))||null;Qs&&this.data.comb&&(Qs=Qs.replaceAll(/\s+/g,""));const zr={userValue:Ws,formattedValue:Qs,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(js=document.createElement("textarea"),js.textContent=Qs??Ws,this.data.doNotScroll&&(js.style.overflowY="hidden")):(js=document.createElement("input"),js.type="text",js.setAttribute("value",Qs??Ws),this.data.doNotScroll&&(js.style.overflowX="hidden")),this.data.hasOwnCanvas&&(js.hidden=!0),Er.add(js),js.setAttribute("data-element-id",cs),js.disabled=this.data.readOnly,js.name=this.data.fieldName,js.tabIndex=fr,this._setRequired(js,this.data.required),_i&&(js.maxLength=_i),js.addEventListener("input",Qr=>{ms.setValue(cs,{value:Qr.target.value}),this.setPropertyOnSiblings(js,"value",Qr.target.value,"value"),zr.formattedValue=null}),js.addEventListener("resetform",Qr=>{const rs=this.data.defaultFieldValue??"";js.value=zr.userValue=rs,zr.formattedValue=null});let us=Qr=>{const{formattedValue:rs}=zr;rs!=null&&(Qr.target.value=rs),Qr.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){js.addEventListener("focus",rs=>{if(zr.focused)return;const{target:ls}=rs;zr.userValue&&(ls.value=zr.userValue),zr.lastCommittedValue=ls.value,zr.commitKey=1,zr.focused=!0}),js.addEventListener("updatefromsandbox",rs=>{this.showElementAndHideCanvas(rs.target);const ls={value(ps){zr.userValue=ps.detail.value??"",ms.setValue(cs,{value:zr.userValue.toString()}),ps.target.value=zr.userValue},formattedValue(ps){const{formattedValue:Rs}=ps.detail;zr.formattedValue=Rs,Rs!=null&&ps.target!==document.activeElement&&(ps.target.value=Rs),ms.setValue(cs,{formattedValue:Rs})},selRange(ps){ps.target.setSelectionRange(...ps.detail.selRange)},charLimit:ps=>{var As;const{charLimit:Rs}=ps.detail,{target:Fs}=ps;if(Rs===0){Fs.removeAttribute("maxLength");return}Fs.setAttribute("maxLength",Rs);let Ps=zr.userValue;!Ps||Ps.length<=Rs||(Ps=Ps.slice(0,Rs),Fs.value=zr.userValue=Ps,ms.setValue(cs,{value:Ps}),(As=this.linkService.eventBus)==null||As.dispatch("dispatcheventinsandbox",{source:this,detail:{id:cs,name:"Keystroke",value:Ps,willCommit:!0,commitKey:1,selStart:Fs.selectionStart,selEnd:Fs.selectionEnd}}))}};this._dispatchEventFromSandbox(ls,rs)}),js.addEventListener("keydown",rs=>{var Rs;zr.commitKey=1;let ls=-1;if(rs.key==="Escape"?ls=0:rs.key==="Enter"&&!this.data.multiLine?ls=2:rs.key==="Tab"&&(zr.commitKey=3),ls===-1)return;const{value:ps}=rs.target;zr.lastCommittedValue!==ps&&(zr.lastCommittedValue=ps,zr.userValue=ps,(Rs=this.linkService.eventBus)==null||Rs.dispatch("dispatcheventinsandbox",{source:this,detail:{id:cs,name:"Keystroke",value:ps,willCommit:!0,commitKey:ls,selStart:rs.target.selectionStart,selEnd:rs.target.selectionEnd}}))});const Qr=us;us=null,js.addEventListener("blur",rs=>{var ps;if(!zr.focused||!rs.relatedTarget)return;zr.focused=!1;const{value:ls}=rs.target;zr.userValue=ls,zr.lastCommittedValue!==ls&&((ps=this.linkService.eventBus)==null||ps.dispatch("dispatcheventinsandbox",{source:this,detail:{id:cs,name:"Keystroke",value:ls,willCommit:!0,commitKey:zr.commitKey,selStart:rs.target.selectionStart,selEnd:rs.target.selectionEnd}})),Qr(rs)}),(Is=this.data.actions)!=null&&Is.Keystroke&&js.addEventListener("beforeinput",rs=>{var Gs;zr.lastCommittedValue=null;const{data:ls,target:ps}=rs,{value:Rs,selectionStart:Fs,selectionEnd:Ps}=ps;let As=Fs,Ms=Ps;switch(rs.inputType){case"deleteWordBackward":{const Xs=Rs.substring(0,Fs).match(/\w*[^\w]*$/);Xs&&(As-=Xs[0].length);break}case"deleteWordForward":{const Xs=Rs.substring(Fs).match(/^[^\w]*\w*/);Xs&&(Ms+=Xs[0].length);break}case"deleteContentBackward":Fs===Ps&&(As-=1);break;case"deleteContentForward":Fs===Ps&&(Ms+=1);break}rs.preventDefault(),(Gs=this.linkService.eventBus)==null||Gs.dispatch("dispatcheventinsandbox",{source:this,detail:{id:cs,name:"Keystroke",value:Rs,change:ls||"",willCommit:!1,selStart:As,selEnd:Ms}})}),this._setEventListeners(js,zr,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],rs=>rs.target.value)}if(us&&js.addEventListener("blur",us),this.data.comb){const rs=(this.data.rect[2]-this.data.rect[0])/_i;js.classList.add("comb"),js.style.letterSpacing=`calc(${rs}px * var(--scale-factor) - 1ch)`}}else js=document.createElement("div"),js.textContent=this.data.fieldValue,js.style.verticalAlign="middle",js.style.display="table-cell";return this._setTextStyle(js),this._setBackgroundColor(js),this._setDefaultPropertiesFromJS(js),this.container.append(js),this.container}}class Sr extends jr{constructor(ms){super(ms,{isRenderable:!!ms.data.hasOwnCanvas})}}class Tr extends jr{constructor(ms){super(ms,{isRenderable:ms.renderForms})}render(){const ms=this.annotationStorage,cs=this.data,js=cs.id;let Ls=ms.getValue(js,{value:cs.exportValue===cs.fieldValue}).value;typeof Ls=="string"&&(Ls=Ls!=="Off",ms.setValue(js,{value:Ls})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Is=document.createElement("input");return Er.add(Is),Is.setAttribute("data-element-id",js),Is.disabled=cs.readOnly,this._setRequired(Is,this.data.required),Is.type="checkbox",Is.name=cs.fieldName,Ls&&Is.setAttribute("checked",!0),Is.setAttribute("exportValue",cs.exportValue),Is.tabIndex=fr,Is.addEventListener("change",$s=>{const{name:Ws,checked:_i}=$s.target;for(const Qs of this._getElementsByName(Ws,js)){const zr=_i&&Qs.exportValue===cs.exportValue;Qs.domElement&&(Qs.domElement.checked=zr),ms.setValue(Qs.id,{value:zr})}ms.setValue(js,{value:_i})}),Is.addEventListener("resetform",$s=>{const Ws=cs.defaultFieldValue||"Off";$s.target.checked=Ws===cs.exportValue}),this.enableScripting&&this.hasJSActions&&(Is.addEventListener("updatefromsandbox",$s=>{const Ws={value(_i){_i.target.checked=_i.detail.value!=="Off",ms.setValue(js,{value:_i.target.checked})}};this._dispatchEventFromSandbox(Ws,$s)}),this._setEventListeners(Is,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],$s=>$s.target.checked)),this._setBackgroundColor(Is),this._setDefaultPropertiesFromJS(Is),this.container.append(Is),this.container}}class Rr extends jr{constructor(ms){super(ms,{isRenderable:ms.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const ms=this.annotationStorage,cs=this.data,js=cs.id;let Ls=ms.getValue(js,{value:cs.fieldValue===cs.buttonValue}).value;typeof Ls=="string"&&(Ls=Ls!==cs.buttonValue,ms.setValue(js,{value:Ls}));const Is=document.createElement("input");if(Er.add(Is),Is.setAttribute("data-element-id",js),Is.disabled=cs.readOnly,this._setRequired(Is,this.data.required),Is.type="radio",Is.name=cs.fieldName,Ls&&Is.setAttribute("checked",!0),Is.tabIndex=fr,Is.addEventListener("change",$s=>{const{name:Ws,checked:_i}=$s.target;for(const Qs of this._getElementsByName(Ws,js))ms.setValue(Qs.id,{value:!1});ms.setValue(js,{value:_i})}),Is.addEventListener("resetform",$s=>{const Ws=cs.defaultFieldValue;$s.target.checked=Ws!=null&&Ws===cs.buttonValue}),this.enableScripting&&this.hasJSActions){const $s=cs.buttonValue;Is.addEventListener("updatefromsandbox",Ws=>{const _i={value:Qs=>{const zr=$s===Qs.detail.value;for(const us of this._getElementsByName(Qs.target.name)){const Qr=zr&&us.id===js;us.domElement&&(us.domElement.checked=Qr),ms.setValue(us.id,{value:Qr})}}};this._dispatchEventFromSandbox(_i,Ws)}),this._setEventListeners(Is,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Ws=>Ws.target.checked)}return this._setBackgroundColor(Is),this._setDefaultPropertiesFromJS(Is),this.container.append(Is),this.container}}class Nr extends br{constructor(ms){super(ms,{ignoreBorder:ms.data.hasAppearance})}render(){const ms=super.render();ms.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(ms.title=this.data.alternativeText);const cs=ms.lastChild;return this.enableScripting&&this.hasJSActions&&cs&&(this._setDefaultPropertiesFromJS(cs),cs.addEventListener("updatefromsandbox",js=>{this._dispatchEventFromSandbox({},js)})),ms}}class Cr extends jr{constructor(ms){super(ms,{isRenderable:ms.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const ms=this.annotationStorage,cs=this.data.id,js=ms.getValue(cs,{value:this.data.fieldValue}),Ls=document.createElement("select");Er.add(Ls),Ls.setAttribute("data-element-id",cs),Ls.disabled=this.data.readOnly,this._setRequired(Ls,this.data.required),Ls.name=this.data.fieldName,Ls.tabIndex=fr;let Is=this.data.combo&&this.data.options.length>0;this.data.combo||(Ls.size=this.data.options.length,this.data.multiSelect&&(Ls.multiple=!0)),Ls.addEventListener("resetform",zr=>{const us=this.data.defaultFieldValue;for(const Qr of Ls.options)Qr.selected=Qr.value===us});for(const zr of this.data.options){const us=document.createElement("option");us.textContent=zr.displayValue,us.value=zr.exportValue,js.value.includes(zr.exportValue)&&(us.setAttribute("selected",!0),Is=!1),Ls.append(us)}let $s=null;if(Is){const zr=document.createElement("option");zr.value=" ",zr.setAttribute("hidden",!0),zr.setAttribute("selected",!0),Ls.prepend(zr),$s=()=>{zr.remove(),Ls.removeEventListener("input",$s),$s=null},Ls.addEventListener("input",$s)}const Ws=zr=>{const us=zr?"value":"textContent",{options:Qr,multiple:rs}=Ls;return rs?Array.prototype.filter.call(Qr,ls=>ls.selected).map(ls=>ls[us]):Qr.selectedIndex===-1?null:Qr[Qr.selectedIndex][us]};let _i=Ws(!1);const Qs=zr=>{const us=zr.target.options;return Array.prototype.map.call(us,Qr=>({displayValue:Qr.textContent,exportValue:Qr.value}))};return this.enableScripting&&this.hasJSActions?(Ls.addEventListener("updatefromsandbox",zr=>{const us={value(Qr){$s==null||$s();const rs=Qr.detail.value,ls=new Set(Array.isArray(rs)?rs:[rs]);for(const ps of Ls.options)ps.selected=ls.has(ps.value);ms.setValue(cs,{value:Ws(!0)}),_i=Ws(!1)},multipleSelection(Qr){Ls.multiple=!0},remove(Qr){const rs=Ls.options,ls=Qr.detail.remove;rs[ls].selected=!1,Ls.remove(ls),rs.length>0&&Array.prototype.findIndex.call(rs,Rs=>Rs.selected)===-1&&(rs[0].selected=!0),ms.setValue(cs,{value:Ws(!0),items:Qs(Qr)}),_i=Ws(!1)},clear(Qr){for(;Ls.length!==0;)Ls.remove(0);ms.setValue(cs,{value:null,items:[]}),_i=Ws(!1)},insert(Qr){const{index:rs,displayValue:ls,exportValue:ps}=Qr.detail.insert,Rs=Ls.children[rs],Fs=document.createElement("option");Fs.textContent=ls,Fs.value=ps,Rs?Rs.before(Fs):Ls.append(Fs),ms.setValue(cs,{value:Ws(!0),items:Qs(Qr)}),_i=Ws(!1)},items(Qr){const{items:rs}=Qr.detail;for(;Ls.length!==0;)Ls.remove(0);for(const ls of rs){const{displayValue:ps,exportValue:Rs}=ls,Fs=document.createElement("option");Fs.textContent=ps,Fs.value=Rs,Ls.append(Fs)}Ls.options.length>0&&(Ls.options[0].selected=!0),ms.setValue(cs,{value:Ws(!0),items:Qs(Qr)}),_i=Ws(!1)},indices(Qr){const rs=new Set(Qr.detail.indices);for(const ls of Qr.target.options)ls.selected=rs.has(ls.index);ms.setValue(cs,{value:Ws(!0)}),_i=Ws(!1)},editable(Qr){Qr.target.disabled=!Qr.detail.editable}};this._dispatchEventFromSandbox(us,zr)}),Ls.addEventListener("input",zr=>{var Qr;const us=Ws(!0);ms.setValue(cs,{value:us}),zr.preventDefault(),(Qr=this.linkService.eventBus)==null||Qr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:cs,name:"Keystroke",value:_i,changeEx:us,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(Ls,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],zr=>zr.target.value)):Ls.addEventListener("input",function(zr){ms.setValue(cs,{value:Ws(!0)})}),this.data.combo&&this._setTextStyle(Ls),this._setBackgroundColor(Ls),this._setDefaultPropertiesFromJS(Ls),this.container.append(Ls),this.container}}class kr extends yr{constructor(ms){const{data:cs,elements:js}=ms;super(ms,{isRenderable:yr._hasPopupData(cs)}),this.elements=js}render(){this.container.classList.add("popupAnnotation");const ms=new Ar({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),cs=[];for(const js of this.elements)js.popup=ms,cs.push(js.data.id),js.addHighlightArea();return this.container.setAttribute("aria-controls",cs.map(js=>`${cr.AnnotationPrefix}${js}`).join(",")),this.container}}class Ar{constructor({container:ms,color:cs,elements:js,titleObj:Ls,modificationDate:Is,contentsObj:$s,richText:Ws,parent:_i,rect:Qs,parentRect:zr,open:us}){Ns(this,Bs);Ns(this,ds,null);Ns(this,ns,ws(this,Bs,du).bind(this));Ns(this,fs,ws(this,Bs,Fl).bind(this));Ns(this,bs,ws(this,Bs,Ml).bind(this));Ns(this,Es,ws(this,Bs,Oo).bind(this));Ns(this,Ds,null);Ns(this,gs,null);Ns(this,as,null);Ns(this,qr,null);Ns(this,ts,null);Ns(this,Yr,null);Ns(this,hs,!1);Ns(this,ys,null);Ns(this,_s,null);Ns(this,Ss,null);Ns(this,vs,null);Ns(this,Hs,!1);var rs;ks(this,gs,ms),ks(this,vs,Ls),ks(this,as,$s),ks(this,Ss,Ws),ks(this,ts,_i),ks(this,Ds,cs),ks(this,_s,Qs),ks(this,Yr,zr),ks(this,qr,js);const Qr=ur.PDFDateString.toDateObject(Is);Qr&&ks(this,ds,_i.l10n.get("annotation_date_string",{date:Qr.toLocaleDateString(),time:Qr.toLocaleTimeString()})),this.trigger=js.flatMap(ls=>ls.getElementsToTriggerPopup());for(const ls of this.trigger)ls.addEventListener("click",$r(this,Es)),ls.addEventListener("mouseenter",$r(this,bs)),ls.addEventListener("mouseleave",$r(this,fs)),ls.classList.add("popupTriggerArea");for(const ls of js)(rs=ls.container)==null||rs.addEventListener("keydown",$r(this,ns));$r(this,gs).hidden=!0,us&&ws(this,Bs,Oo).call(this)}render(){if($r(this,ys))return;const{page:{view:ms},viewport:{rawDims:{pageWidth:cs,pageHeight:js,pageX:Ls,pageY:Is}}}=$r(this,ts),$s=ks(this,ys,document.createElement("div"));if($s.className="popup",$r(this,Ds)){const As=$s.style.outlineColor=cr.Util.makeHexColor(...$r(this,Ds));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?$s.style.backgroundColor=`color-mix(in srgb, ${As} 30%, white)`:$s.style.backgroundColor=cr.Util.makeHexColor(...$r(this,Ds).map(Gs=>Math.floor(.7*(255-Gs)+Gs)))}const Ws=document.createElement("span");Ws.className="header";const _i=document.createElement("h1");if(Ws.append(_i),{dir:_i.dir,str:_i.textContent}=$r(this,vs),$s.append(Ws),$r(this,ds)){const As=document.createElement("span");As.classList.add("popupDate"),$r(this,ds).then(Ms=>{As.textContent=Ms}),Ws.append(As)}const Qs=$r(this,as),zr=$r(this,Ss);if(zr!=null&&zr.str&&(!(Qs!=null&&Qs.str)||Qs.str===zr.str))mr.XfaLayer.render({xfaHtml:zr.html,intent:"richText",div:$s}),$s.lastChild.classList.add("richText","popupContent");else{const As=this._formatContents(Qs);$s.append(As)}let us=!!$r(this,Yr),Qr=us?$r(this,Yr):$r(this,_s);for(const As of $r(this,qr))if(!Qr||cr.Util.intersect(As.data.rect,Qr)!==null){Qr=As.data.rect,us=!0;break}const rs=cr.Util.normalizeRect([Qr[0],ms[3]-Qr[1]+ms[1],Qr[2],ms[3]-Qr[3]+ms[1]]),ps=us?Qr[2]-Qr[0]+5:0,Rs=rs[0]+ps,Fs=rs[1],{style:Ps}=$r(this,gs);Ps.left=`${100*(Rs-Ls)/cs}%`,Ps.top=`${100*(Fs-Is)/js}%`,$r(this,gs).append($s)}_formatContents({str:ms,dir:cs}){const js=document.createElement("p");js.classList.add("popupContent"),js.dir=cs;const Ls=ms.split(/(?:\r\n?|\n)/);for(let Is=0,$s=Ls.length;Is<$s;++Is){const Ws=Ls[Is];js.append(document.createTextNode(Ws)),Is<$s-1&&js.append(document.createElement("br"))}return js}forceHide(){ks(this,Hs,this.isVisible),$r(this,Hs)&&($r(this,gs).hidden=!0)}maybeShow(){$r(this,Hs)&&(ks(this,Hs,!1),$r(this,gs).hidden=!1)}get isVisible(){return $r(this,gs).hidden===!1}}ds=new WeakMap,ns=new WeakMap,fs=new WeakMap,bs=new WeakMap,Es=new WeakMap,Ds=new WeakMap,gs=new WeakMap,as=new WeakMap,qr=new WeakMap,ts=new WeakMap,Yr=new WeakMap,hs=new WeakMap,ys=new WeakMap,_s=new WeakMap,Ss=new WeakMap,vs=new WeakMap,Hs=new WeakMap,Bs=new WeakSet,du=function(ms){ms.altKey||ms.shiftKey||ms.ctrlKey||ms.metaKey||(ms.key==="Enter"||ms.key==="Escape"&&$r(this,hs))&&ws(this,Bs,Oo).call(this)},Oo=function(){ks(this,hs,!$r(this,hs)),$r(this,hs)?(ws(this,Bs,Ml).call(this),$r(this,gs).addEventListener("click",$r(this,Es)),$r(this,gs).addEventListener("keydown",$r(this,ns))):(ws(this,Bs,Fl).call(this),$r(this,gs).removeEventListener("click",$r(this,Es)),$r(this,gs).removeEventListener("keydown",$r(this,ns)))},Ml=function(){$r(this,ys)||this.render(),this.isVisible?$r(this,hs)&&$r(this,gs).classList.add("focused"):($r(this,gs).hidden=!1,$r(this,gs).style.zIndex=parseInt($r(this,gs).style.zIndex)+1e3)},Fl=function(){$r(this,gs).classList.remove("focused"),!($r(this,hs)||!this.isVisible)&&($r(this,gs).hidden=!0,$r(this,gs).style.zIndex=parseInt($r(this,gs).style.zIndex)-1e3)};class Or extends yr{constructor(ms){super(ms,{isRenderable:!0,ignoreBorder:!0}),this.textContent=ms.data.textContent,this.textPosition=ms.data.textPosition,this.annotationEditorType=cr.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const ms=document.createElement("div");ms.classList.add("annotationTextContent"),ms.setAttribute("role","comment");for(const cs of this.textContent){const js=document.createElement("span");js.textContent=cs,ms.append(js)}this.container.append(ms)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}or.FreeTextAnnotationElement=Or;class Lr extends yr{constructor(cs){super(cs,{isRenderable:!0,ignoreBorder:!0});Ns(this,xa,null)}render(){this.container.classList.add("lineAnnotation");const cs=this.data,{width:js,height:Ls}=vr(cs.rect),Is=this.svgFactory.create(js,Ls,!0),$s=ks(this,xa,this.svgFactory.createElement("svg:line"));return $s.setAttribute("x1",cs.rect[2]-cs.lineCoordinates[0]),$s.setAttribute("y1",cs.rect[3]-cs.lineCoordinates[1]),$s.setAttribute("x2",cs.rect[2]-cs.lineCoordinates[2]),$s.setAttribute("y2",cs.rect[3]-cs.lineCoordinates[3]),$s.setAttribute("stroke-width",cs.borderStyle.width||1),$s.setAttribute("stroke","transparent"),$s.setAttribute("fill","transparent"),Is.append($s),this.container.append(Is),!cs.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return $r(this,xa)}addHighlightArea(){this.container.classList.add("highlightArea")}}xa=new WeakMap;class Fr extends yr{constructor(cs){super(cs,{isRenderable:!0,ignoreBorder:!0});Ns(this,ro,null)}render(){this.container.classList.add("squareAnnotation");const cs=this.data,{width:js,height:Ls}=vr(cs.rect),Is=this.svgFactory.create(js,Ls,!0),$s=cs.borderStyle.width,Ws=ks(this,ro,this.svgFactory.createElement("svg:rect"));return Ws.setAttribute("x",$s/2),Ws.setAttribute("y",$s/2),Ws.setAttribute("width",js-$s),Ws.setAttribute("height",Ls-$s),Ws.setAttribute("stroke-width",$s||1),Ws.setAttribute("stroke","transparent"),Ws.setAttribute("fill","transparent"),Is.append(Ws),this.container.append(Is),!cs.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return $r(this,ro)}addHighlightArea(){this.container.classList.add("highlightArea")}}ro=new WeakMap;class Hr extends yr{constructor(cs){super(cs,{isRenderable:!0,ignoreBorder:!0});Ns(this,no,null)}render(){this.container.classList.add("circleAnnotation");const cs=this.data,{width:js,height:Ls}=vr(cs.rect),Is=this.svgFactory.create(js,Ls,!0),$s=cs.borderStyle.width,Ws=ks(this,no,this.svgFactory.createElement("svg:ellipse"));return Ws.setAttribute("cx",js/2),Ws.setAttribute("cy",Ls/2),Ws.setAttribute("rx",js/2-$s/2),Ws.setAttribute("ry",Ls/2-$s/2),Ws.setAttribute("stroke-width",$s||1),Ws.setAttribute("stroke","transparent"),Ws.setAttribute("fill","transparent"),Is.append(Ws),this.container.append(Is),!cs.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return $r(this,no)}addHighlightArea(){this.container.classList.add("highlightArea")}}no=new WeakMap;class Kr extends yr{constructor(cs){super(cs,{isRenderable:!0,ignoreBorder:!0});Ns(this,Us,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const cs=this.data,{width:js,height:Ls}=vr(cs.rect),Is=this.svgFactory.create(js,Ls,!0);let $s=[];for(const _i of cs.vertices){const Qs=_i.x-cs.rect[0],zr=cs.rect[3]-_i.y;$s.push(Qs+","+zr)}$s=$s.join(" ");const Ws=ks(this,Us,this.svgFactory.createElement(this.svgElementName));return Ws.setAttribute("points",$s),Ws.setAttribute("stroke-width",cs.borderStyle.width||1),Ws.setAttribute("stroke","transparent"),Ws.setAttribute("fill","transparent"),Is.append(Ws),this.container.append(Is),!cs.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return $r(this,Us)}addHighlightArea(){this.container.classList.add("highlightArea")}}Us=new WeakMap;class Gr extends Kr{constructor(ms){super(ms),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Zr extends yr{constructor(ms){super(ms,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Jr extends yr{constructor(cs){super(cs,{isRenderable:!0,ignoreBorder:!0});Ns(this,Cs,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=cr.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const cs=this.data,{width:js,height:Ls}=vr(cs.rect),Is=this.svgFactory.create(js,Ls,!0);for(const $s of cs.inkLists){let Ws=[];for(const Qs of $s){const zr=Qs.x-cs.rect[0],us=cs.rect[3]-Qs.y;Ws.push(`${zr},${us}`)}Ws=Ws.join(" ");const _i=this.svgFactory.createElement(this.svgElementName);$r(this,Cs).push(_i),_i.setAttribute("points",Ws),_i.setAttribute("stroke-width",cs.borderStyle.width||1),_i.setAttribute("stroke","transparent"),_i.setAttribute("fill","transparent"),!cs.popupRef&&this.hasPopupData&&this._createPopup(),Is.append(_i)}return this.container.append(Is),this.container}getElementsToTriggerPopup(){return $r(this,Cs)}addHighlightArea(){this.container.classList.add("highlightArea")}}Cs=new WeakMap,or.InkAnnotationElement=Jr;class os extends yr{constructor(ms){super(ms,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class Ur extends yr{constructor(ms){super(ms,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Vr extends yr{constructor(ms){super(ms,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class es extends yr{constructor(ms){super(ms,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Ir extends yr{constructor(ms){super(ms,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}or.StampAnnotationElement=Ir;class Dr extends yr{constructor(cs){var Is;super(cs,{isRenderable:!0});Ns(this,qs);Ns(this,Ts,null);const{filename:js,content:Ls}=this.data.file;this.filename=(0,ur.getFilenameFromUrl)(js,!0),this.content=Ls,(Is=this.linkService.eventBus)==null||Is.dispatch("fileattachmentannotation",{source:this,filename:js,content:Ls})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:cs,data:js}=this;let Ls;js.hasAppearance||js.fillAlpha===0?Ls=document.createElement("div"):(Ls=document.createElement("img"),Ls.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(js.name)?"paperclip":"pushpin"}.svg`,js.fillAlpha&&js.fillAlpha<1&&(Ls.style=`filter: opacity(${Math.round(js.fillAlpha*100)}%);`)),Ls.addEventListener("dblclick",ws(this,qs,Ol).bind(this)),ks(this,Ts,Ls);const{isMac:Is}=cr.FeatureTest.platform;return cs.addEventListener("keydown",$s=>{$s.key==="Enter"&&(Is?$s.metaKey:$s.ctrlKey)&&ws(this,qs,Ol).call(this)}),!js.popupRef&&this.hasPopupData?this._createPopup():Ls.classList.add("popupTriggerArea"),cs.append(Ls),cs}getElementsToTriggerPopup(){return $r(this,Ts)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ts=new WeakMap,qs=new WeakSet,Ol=function(){var cs;(cs=this.downloadManager)==null||cs.openOrDownloadData(this.container,this.content,this.filename)};class Pr{constructor({div:ms,accessibilityManager:cs,annotationCanvasMap:js,l10n:Ls,page:Is,viewport:$s}){Ns(this,zs);Ns(this,eo,null);Ns(this,xs,null);Ns(this,Os,new Map);this.div=ms,ks(this,eo,cs),ks(this,xs,js),this.l10n=Ls,this.page=Is,this.viewport=$s,this.zIndex=0,this.l10n||(this.l10n=pr.NullL10n)}async render(ms){const{annotations:cs}=ms,js=this.div;(0,ur.setLayerDimensions)(js,this.viewport);const Ls=new Map,Is={data:null,layer:js,linkService:ms.linkService,downloadManager:ms.downloadManager,imageResourcesPath:ms.imageResourcesPath||"",renderForms:ms.renderForms!==!1,svgFactory:new ur.DOMSVGFactory,annotationStorage:ms.annotationStorage||new dr.AnnotationStorage,enableScripting:ms.enableScripting===!0,hasJSActions:ms.hasJSActions,fieldObjects:ms.fieldObjects,parent:this,elements:null};for(const $s of cs){if($s.noHTML)continue;const Ws=$s.annotationType===cr.AnnotationType.POPUP;if(Ws){const zr=Ls.get($s.id);if(!zr)continue;Is.elements=zr}else{const{width:zr,height:us}=vr($s.rect);if(zr<=0||us<=0)continue}Is.data=$s;const _i=gr.create(Is);if(!_i.isRenderable)continue;if(!Ws&&$s.popupRef){const zr=Ls.get($s.popupRef);zr?zr.push(_i):Ls.set($s.popupRef,[_i])}_i.annotationEditorType>0&&$r(this,Os).set(_i.data.id,_i);const Qs=_i.render();$s.hidden&&(Qs.style.visibility="hidden"),ws(this,zs,hu).call(this,Qs,$s.id)}ws(this,zs,$l).call(this),await this.l10n.translate(js)}update({viewport:ms}){const cs=this.div;this.viewport=ms,(0,ur.setLayerDimensions)(cs,{rotation:ms.rotation}),ws(this,zs,$l).call(this),cs.hidden=!1}getEditableAnnotations(){return Array.from($r(this,Os).values())}getEditableAnnotation(ms){return $r(this,Os).get(ms)}}eo=new WeakMap,xs=new WeakMap,Os=new WeakMap,zs=new WeakSet,hu=function(ms,cs){var Ls;const js=ms.firstChild||ms;js.id=`${cr.AnnotationPrefix}${cs}`,this.div.append(ms),(Ls=$r(this,eo))==null||Ls.moveElementInDOM(this.div,ms,js,!1)},$l=function(){if(!$r(this,xs))return;const ms=this.div;for(const[cs,js]of $r(this,xs)){const Ls=ms.querySelector(`[data-annotation-id="${cs}"]`);if(!Ls)continue;const{firstChild:Is}=Ls;Is?Is.nodeName==="CANVAS"?Is.replaceWith(js):Is.before(js):Ls.append(js)}$r(this,xs).clear()},or.AnnotationLayer=Pr},(ar,or)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.ColorConverters=void 0;function lr(dr){return Math.floor(Math.max(0,Math.min(1,dr))*255).toString(16).padStart(2,"0")}function cr(dr){return Math.max(0,Math.min(255,255*dr))}class ur{static CMYK_G([hr,pr,mr,fr]){return["G",1-Math.min(1,.3*hr+.59*mr+.11*pr+fr)]}static G_CMYK([hr]){return["CMYK",0,0,0,1-hr]}static G_RGB([hr]){return["RGB",hr,hr,hr]}static G_rgb([hr]){return hr=cr(hr),[hr,hr,hr]}static G_HTML([hr]){const pr=lr(hr);return`#${pr}${pr}${pr}`}static RGB_G([hr,pr,mr]){return["G",.3*hr+.59*pr+.11*mr]}static RGB_rgb(hr){return hr.map(cr)}static RGB_HTML(hr){return`#${hr.map(lr).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([hr,pr,mr,fr]){return["RGB",1-Math.min(1,hr+fr),1-Math.min(1,mr+fr),1-Math.min(1,pr+fr)]}static CMYK_rgb([hr,pr,mr,fr]){return[cr(1-Math.min(1,hr+fr)),cr(1-Math.min(1,mr+fr)),cr(1-Math.min(1,pr+fr))]}static CMYK_HTML(hr){const pr=this.CMYK_RGB(hr).slice(1);return this.RGB_HTML(pr)}static RGB_CMYK([hr,pr,mr]){const fr=1-hr,xr=1-pr,Er=1-mr,vr=Math.min(fr,xr,Er);return["CMYK",fr,xr,Er,vr]}}or.ColorConverters=ur},(ar,or)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.NullL10n=void 0,or.getL10nFallback=cr;const lr={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}}  {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}}  {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};lr.print_progress_percent="{{progress}}%";function cr(hr,pr){switch(hr){case"find_match_count":hr=`find_match_count[${pr.total===1?"one":"other"}]`;break;case"find_match_count_limit":hr=`find_match_count_limit[${pr.limit===1?"one":"other"}]`;break}return lr[hr]||""}function ur(hr,pr){return pr?hr.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(mr,fr)=>fr in pr?pr[fr]:"{{"+fr+"}}"):hr}const dr={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(hr,pr=null,mr=cr(hr,pr)){return ur(mr,pr)},async translate(hr){}};or.NullL10n=dr},(ar,or,lr)=>{Object.defineProperty(or,"__esModule",{value:!0}),or.XfaLayer=void 0;var cr=lr(25);class ur{static setupStorage(hr,pr,mr,fr,xr){const Er=fr.getValue(pr,{value:null});switch(mr.name){case"textarea":if(Er.value!==null&&(hr.textContent=Er.value),xr==="print")break;hr.addEventListener("input",vr=>{fr.setValue(pr,{value:vr.target.value})});break;case"input":if(mr.attributes.type==="radio"||mr.attributes.type==="checkbox"){if(Er.value===mr.attributes.xfaOn?hr.setAttribute("checked",!0):Er.value===mr.attributes.xfaOff&&hr.removeAttribute("checked"),xr==="print")break;hr.addEventListener("change",vr=>{fr.setValue(pr,{value:vr.target.checked?vr.target.getAttribute("xfaOn"):vr.target.getAttribute("xfaOff")})})}else{if(Er.value!==null&&hr.setAttribute("value",Er.value),xr==="print")break;hr.addEventListener("input",vr=>{fr.setValue(pr,{value:vr.target.value})})}break;case"select":if(Er.value!==null){hr.setAttribute("value",Er.value);for(const vr of mr.children)vr.attributes.value===Er.value?vr.attributes.selected=!0:vr.attributes.hasOwnProperty("selected")&&delete vr.attributes.selected}hr.addEventListener("input",vr=>{const gr=vr.target.options,yr=gr.selectedIndex===-1?"":gr[gr.selectedIndex].value;fr.setValue(pr,{value:yr})});break}}static setAttributes({html:hr,element:pr,storage:mr=null,intent:fr,linkService:xr}){const{attributes:Er}=pr,vr=hr instanceof HTMLAnchorElement;Er.type==="radio"&&(Er.name=`${Er.name}-${fr}`);for(const[gr,yr]of Object.entries(Er))if(yr!=null)switch(gr){case"class":yr.length&&hr.setAttribute(gr,yr.join(" "));break;case"dataId":break;case"id":hr.setAttribute("data-element-id",yr);break;case"style":Object.assign(hr.style,yr);break;case"textContent":hr.textContent=yr;break;default:(!vr||gr!=="href"&&gr!=="newWindow")&&hr.setAttribute(gr,yr)}vr&&xr.addLinkAttributes(hr,Er.href,Er.newWindow),mr&&Er.dataId&&this.setupStorage(hr,Er.dataId,pr,mr)}static render(hr){var br;const pr=hr.annotationStorage,mr=hr.linkService,fr=hr.xfaHtml,xr=hr.intent||"display",Er=document.createElement(fr.name);fr.attributes&&this.setAttributes({html:Er,element:fr,intent:xr,linkService:mr});const vr=[[fr,-1,Er]],gr=hr.div;if(gr.append(Er),hr.viewport){const _r=`matrix(${hr.viewport.transform.join(",")})`;gr.style.transform=_r}xr!=="richText"&&gr.setAttribute("class","xfaLayer xfaFont");const yr=[];for(;vr.length>0;){const[_r,jr,wr]=vr.at(-1);if(jr+1===_r.children.length){vr.pop();continue}const Sr=_r.children[++vr.at(-1)[1]];if(Sr===null)continue;const{name:Tr}=Sr;if(Tr==="#text"){const Nr=document.createTextNode(Sr.value);yr.push(Nr),wr.append(Nr);continue}const Rr=(br=Sr==null?void 0:Sr.attributes)!=null&&br.xmlns?document.createElementNS(Sr.attributes.xmlns,Tr):document.createElement(Tr);if(wr.append(Rr),Sr.attributes&&this.setAttributes({html:Rr,element:Sr,storage:pr,intent:xr,linkService:mr}),Sr.children&&Sr.children.length>0)vr.push([Sr,-1,Rr]);else if(Sr.value){const Nr=document.createTextNode(Sr.value);cr.XfaText.shouldBuildText(Tr)&&yr.push(Nr),Rr.append(Nr)}}for(const _r of gr.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))_r.setAttribute("readOnly",!0);return{textDivs:yr}}static update(hr){const pr=`matrix(${hr.viewport.transform.join(",")})`;hr.div.style.transform=pr,hr.div.hidden=!1}}or.XfaLayer=ur},(ar,or,lr)=>{var fr,xr,Er,vr,gr,yr,br,_r,jr,wr,Sr,Tr,Rr,Nr,Cr,pu,mu,fu,xu,Bl,gu,Ul,vu,Eu,yu,bu,ju,ho,Hl,$o,Bo,vo,Wl,Uo,Xr,wu,zl,_u,Su,Vl,Ho,Eo;Object.defineProperty(or,"__esModule",{value:!0}),or.InkEditor=void 0;var cr=lr(1),ur=lr(4),dr=lr(29),hr=lr(6),pr=lr(5);const Ds=class Ds extends ur.AnnotationEditor{constructor(qr){super({...qr,name:"inkEditor"});Ns(this,Cr);Ns(this,fr,0);Ns(this,xr,0);Ns(this,Er,this.canvasPointermove.bind(this));Ns(this,vr,this.canvasPointerleave.bind(this));Ns(this,gr,this.canvasPointerup.bind(this));Ns(this,yr,this.canvasPointerdown.bind(this));Ns(this,br,new Path2D);Ns(this,_r,!1);Ns(this,jr,!1);Ns(this,wr,!1);Ns(this,Sr,null);Ns(this,Tr,0);Ns(this,Rr,0);Ns(this,Nr,null);this.color=qr.color||null,this.thickness=qr.thickness||null,this.opacity=qr.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(qr){ur.AnnotationEditor.initialize(qr,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(qr,ts){switch(qr){case cr.AnnotationEditorParamsType.INK_THICKNESS:Ds._defaultThickness=ts;break;case cr.AnnotationEditorParamsType.INK_COLOR:Ds._defaultColor=ts;break;case cr.AnnotationEditorParamsType.INK_OPACITY:Ds._defaultOpacity=ts/100;break}}updateParams(qr,ts){switch(qr){case cr.AnnotationEditorParamsType.INK_THICKNESS:ws(this,Cr,pu).call(this,ts);break;case cr.AnnotationEditorParamsType.INK_COLOR:ws(this,Cr,mu).call(this,ts);break;case cr.AnnotationEditorParamsType.INK_OPACITY:ws(this,Cr,fu).call(this,ts);break}}static get defaultPropertiesToUpdate(){return[[cr.AnnotationEditorParamsType.INK_THICKNESS,Ds._defaultThickness],[cr.AnnotationEditorParamsType.INK_COLOR,Ds._defaultColor||ur.AnnotationEditor._defaultLineColor],[cr.AnnotationEditorParamsType.INK_OPACITY,Math.round(Ds._defaultOpacity*100)]]}get propertiesToUpdate(){return[[cr.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Ds._defaultThickness],[cr.AnnotationEditorParamsType.INK_COLOR,this.color||Ds._defaultColor||ur.AnnotationEditor._defaultLineColor],[cr.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Ds._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(ws(this,Cr,$o).call(this),ws(this,Cr,Bo).call(this)),this.isAttachedToDOM||(this.parent.add(this),ws(this,Cr,vo).call(this)),ws(this,Cr,Eo).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,$r(this,Sr).disconnect(),ks(this,Sr,null),super.remove())}setParent(qr){!this.parent&&qr?this._uiManager.removeShouldRescale(this):this.parent&&qr===null&&this._uiManager.addShouldRescale(this),super.setParent(qr)}onScaleChanging(){const[qr,ts]=this.parentDimensions,Yr=this.width*qr,hs=this.height*ts;this.setDimensions(Yr,hs)}enableEditMode(){$r(this,_r)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",$r(this,yr)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",$r(this,yr)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){$r(this,_r)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),ks(this,_r,!0),this.div.classList.add("disabled"),ws(this,Cr,Eo).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(qr){this._focusEventsAllowed&&(super.focusin(qr),this.enableEditMode())}canvasPointerdown(qr){qr.button!==0||!this.isInEditMode()||$r(this,_r)||(this.setInForeground(),qr.preventDefault(),qr.type!=="mouse"&&this.div.focus(),ws(this,Cr,gu).call(this,qr.offsetX,qr.offsetY))}canvasPointermove(qr){qr.preventDefault(),ws(this,Cr,Ul).call(this,qr.offsetX,qr.offsetY)}canvasPointerup(qr){qr.preventDefault(),ws(this,Cr,Hl).call(this,qr)}canvasPointerleave(qr){ws(this,Cr,Hl).call(this,qr)}get isResizable(){return!this.isEmpty()&&$r(this,_r)}render(){if(this.div)return this.div;let qr,ts;this.width&&(qr=this.x,ts=this.y),super.render(),ur.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(Ss=>{var vs;return(vs=this.div)==null?void 0:vs.setAttribute("aria-label",Ss)});const[Yr,hs,ys,_s]=ws(this,Cr,xu).call(this);if(this.setAt(Yr,hs,0,0),this.setDims(ys,_s),ws(this,Cr,$o).call(this),this.width){const[Ss,vs]=this.parentDimensions;this.setAspectRatio(this.width*Ss,this.height*vs),this.setAt(qr*Ss,ts*vs,this.width*Ss,this.height*vs),ks(this,wr,!0),ws(this,Cr,vo).call(this),this.setDims(this.width*Ss,this.height*vs),ws(this,Cr,ho).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return ws(this,Cr,Bo).call(this),this.div}setDimensions(qr,ts){const Yr=Math.round(qr),hs=Math.round(ts);if($r(this,Tr)===Yr&&$r(this,Rr)===hs)return;ks(this,Tr,Yr),ks(this,Rr,hs),this.canvas.style.visibility="hidden";const[ys,_s]=this.parentDimensions;this.width=qr/ys,this.height=ts/_s,this.fixAndSetPosition(),$r(this,_r)&&ws(this,Cr,Wl).call(this,qr,ts),ws(this,Cr,vo).call(this),ws(this,Cr,ho).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(qr,ts,Yr){var xa,ro,no;if(qr instanceof dr.InkAnnotationElement)return null;const hs=super.deserialize(qr,ts,Yr);hs.thickness=qr.thickness,hs.color=cr.Util.makeHexColor(...qr.color),hs.opacity=qr.opacity;const[ys,_s]=hs.pageDimensions,Ss=hs.width*ys,vs=hs.height*_s,Hs=hs.parentScale,Bs=qr.thickness/2;ks(hs,_r,!0),ks(hs,Tr,Math.round(Ss)),ks(hs,Rr,Math.round(vs));const{paths:na,rect:Js,rotation:$a}=qr;for(let{bezier:Us}of na){Us=ws(xa=Ds,Xr,_u).call(xa,Us,Js,$a);const Cs=[];hs.paths.push(Cs);let Ts=Hs*(Us[0]-Bs),qs=Hs*(Us[1]-Bs);for(let eo=2,xs=Us.length;eo<xs;eo+=6){const Os=Hs*(Us[eo]-Bs),zs=Hs*(Us[eo+1]-Bs),Zs=Hs*(Us[eo+2]-Bs),ga=Hs*(Us[eo+3]-Bs),Ys=Hs*(Us[eo+4]-Bs),ms=Hs*(Us[eo+5]-Bs);Cs.push([[Ts,qs],[Os,zs],[Zs,ga],[Ys,ms]]),Ts=Ys,qs=ms}const to=ws(this,Xr,wu).call(this,Cs);hs.bezierPath2D.push(to)}const Vs=ws(ro=hs,Cr,Vl).call(ro);return ks(hs,xr,Math.max(ur.AnnotationEditor.MIN_SIZE,Vs[2]-Vs[0])),ks(hs,fr,Math.max(ur.AnnotationEditor.MIN_SIZE,Vs[3]-Vs[1])),ws(no=hs,Cr,Wl).call(no,Ss,vs),hs}serialize(){if(this.isEmpty())return null;const qr=this.getRect(0,0),ts=ur.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:cr.AnnotationEditorType.INK,color:ts,thickness:this.thickness,opacity:this.opacity,paths:ws(this,Cr,Su).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,qr),pageIndex:this.pageIndex,rect:qr,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};fr=new WeakMap,xr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,br=new WeakMap,_r=new WeakMap,jr=new WeakMap,wr=new WeakMap,Sr=new WeakMap,Tr=new WeakMap,Rr=new WeakMap,Nr=new WeakMap,Cr=new WeakSet,pu=function(qr){const ts=this.thickness;this.addCommands({cmd:()=>{this.thickness=qr,ws(this,Cr,Eo).call(this)},undo:()=>{this.thickness=ts,ws(this,Cr,Eo).call(this)},mustExec:!0,type:cr.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},mu=function(qr){const ts=this.color;this.addCommands({cmd:()=>{this.color=qr,ws(this,Cr,ho).call(this)},undo:()=>{this.color=ts,ws(this,Cr,ho).call(this)},mustExec:!0,type:cr.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},fu=function(qr){qr/=100;const ts=this.opacity;this.addCommands({cmd:()=>{this.opacity=qr,ws(this,Cr,ho).call(this)},undo:()=>{this.opacity=ts,ws(this,Cr,ho).call(this)},mustExec:!0,type:cr.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},xu=function(){const{parentRotation:qr,parentDimensions:[ts,Yr]}=this;switch(qr){case 90:return[0,Yr,Yr,ts];case 180:return[ts,Yr,ts,Yr];case 270:return[ts,0,Yr,ts];default:return[0,0,ts,Yr]}},Bl=function(){const{ctx:qr,color:ts,opacity:Yr,thickness:hs,parentScale:ys,scaleFactor:_s}=this;qr.lineWidth=hs*ys/_s,qr.lineCap="round",qr.lineJoin="round",qr.miterLimit=10,qr.strokeStyle=`${ts}${(0,pr.opacityToHex)(Yr)}`},gu=function(qr,ts){this.canvas.addEventListener("contextmenu",hr.noContextMenu),this.canvas.addEventListener("pointerleave",$r(this,vr)),this.canvas.addEventListener("pointermove",$r(this,Er)),this.canvas.addEventListener("pointerup",$r(this,gr)),this.canvas.removeEventListener("pointerdown",$r(this,yr)),this.isEditing=!0,$r(this,wr)||(ks(this,wr,!0),ws(this,Cr,vo).call(this),this.thickness||(this.thickness=Ds._defaultThickness),this.color||(this.color=Ds._defaultColor||ur.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=Ds._defaultOpacity)),this.currentPath.push([qr,ts]),ks(this,jr,!1),ws(this,Cr,Bl).call(this),ks(this,Nr,()=>{ws(this,Cr,yu).call(this),$r(this,Nr)&&window.requestAnimationFrame($r(this,Nr))}),window.requestAnimationFrame($r(this,Nr))},Ul=function(qr,ts){const[Yr,hs]=this.currentPath.at(-1);if(this.currentPath.length>1&&qr===Yr&&ts===hs)return;const ys=this.currentPath;let _s=$r(this,br);if(ys.push([qr,ts]),ks(this,jr,!0),ys.length<=2){_s.moveTo(...ys[0]),_s.lineTo(qr,ts);return}ys.length===3&&(ks(this,br,_s=new Path2D),_s.moveTo(...ys[0])),ws(this,Cr,bu).call(this,_s,...ys.at(-3),...ys.at(-2),qr,ts)},vu=function(){if(this.currentPath.length===0)return;const qr=this.currentPath.at(-1);$r(this,br).lineTo(...qr)},Eu=function(qr,ts){ks(this,Nr,null),qr=Math.min(Math.max(qr,0),this.canvas.width),ts=Math.min(Math.max(ts,0),this.canvas.height),ws(this,Cr,Ul).call(this,qr,ts),ws(this,Cr,vu).call(this);let Yr;if(this.currentPath.length!==1)Yr=ws(this,Cr,ju).call(this);else{const vs=[qr,ts];Yr=[[vs,vs.slice(),vs.slice(),vs]]}const hs=$r(this,br),ys=this.currentPath;this.currentPath=[],ks(this,br,new Path2D);const _s=()=>{this.allRawPaths.push(ys),this.paths.push(Yr),this.bezierPath2D.push(hs),this.rebuild()},Ss=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(ws(this,Cr,$o).call(this),ws(this,Cr,Bo).call(this)),ws(this,Cr,Eo).call(this))};this.addCommands({cmd:_s,undo:Ss,mustExec:!0})},yu=function(){if(!$r(this,jr))return;ks(this,jr,!1);const qr=Math.ceil(this.thickness*this.parentScale),ts=this.currentPath.slice(-3),Yr=ts.map(_s=>_s[0]),hs=ts.map(_s=>_s[1]);Math.min(...Yr)-qr,Math.max(...Yr)+qr,Math.min(...hs)-qr,Math.max(...hs)+qr;const{ctx:ys}=this;ys.save(),ys.clearRect(0,0,this.canvas.width,this.canvas.height);for(const _s of this.bezierPath2D)ys.stroke(_s);ys.stroke($r(this,br)),ys.restore()},bu=function(qr,ts,Yr,hs,ys,_s,Ss){const vs=(ts+hs)/2,Hs=(Yr+ys)/2,Bs=(hs+_s)/2,na=(ys+Ss)/2;qr.bezierCurveTo(vs+2*(hs-vs)/3,Hs+2*(ys-Hs)/3,Bs+2*(hs-Bs)/3,na+2*(ys-na)/3,Bs,na)},ju=function(){const qr=this.currentPath;if(qr.length<=2)return[[qr[0],qr[0],qr.at(-1),qr.at(-1)]];const ts=[];let Yr,[hs,ys]=qr[0];for(Yr=1;Yr<qr.length-2;Yr++){const[Js,$a]=qr[Yr],[Vs,xa]=qr[Yr+1],ro=(Js+Vs)/2,no=($a+xa)/2,Us=[hs+2*(Js-hs)/3,ys+2*($a-ys)/3],Cs=[ro+2*(Js-ro)/3,no+2*($a-no)/3];ts.push([[hs,ys],Us,Cs,[ro,no]]),[hs,ys]=[ro,no]}const[_s,Ss]=qr[Yr],[vs,Hs]=qr[Yr+1],Bs=[hs+2*(_s-hs)/3,ys+2*(Ss-ys)/3],na=[vs+2*(_s-vs)/3,Hs+2*(Ss-Hs)/3];return ts.push([[hs,ys],Bs,na,[vs,Hs]]),ts},ho=function(){if(this.isEmpty()){ws(this,Cr,Uo).call(this);return}ws(this,Cr,Bl).call(this);const{canvas:qr,ctx:ts}=this;ts.setTransform(1,0,0,1,0,0),ts.clearRect(0,0,qr.width,qr.height),ws(this,Cr,Uo).call(this);for(const Yr of this.bezierPath2D)ts.stroke(Yr)},Hl=function(qr){this.canvas.removeEventListener("pointerleave",$r(this,vr)),this.canvas.removeEventListener("pointermove",$r(this,Er)),this.canvas.removeEventListener("pointerup",$r(this,gr)),this.canvas.addEventListener("pointerdown",$r(this,yr)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",hr.noContextMenu)},10),ws(this,Cr,Eu).call(this,qr.offsetX,qr.offsetY),this.addToAnnotationStorage(),this.setInBackground()},$o=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",ur.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(qr=>{var ts;return(ts=this.canvas)==null?void 0:ts.setAttribute("aria-label",qr)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Bo=function(){ks(this,Sr,new ResizeObserver(qr=>{const ts=qr[0].contentRect;ts.width&&ts.height&&this.setDimensions(ts.width,ts.height)})),$r(this,Sr).observe(this.div)},vo=function(){if(!$r(this,wr))return;const[qr,ts]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*qr),this.canvas.height=Math.ceil(this.height*ts),ws(this,Cr,Uo).call(this)},Wl=function(qr,ts){const Yr=ws(this,Cr,Ho).call(this),hs=(qr-Yr)/$r(this,xr),ys=(ts-Yr)/$r(this,fr);this.scaleFactor=Math.min(hs,ys)},Uo=function(){const qr=ws(this,Cr,Ho).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+qr,this.translationY*this.scaleFactor+qr)},Xr=new WeakSet,wu=function(qr){const ts=new Path2D;for(let Yr=0,hs=qr.length;Yr<hs;Yr++){const[ys,_s,Ss,vs]=qr[Yr];Yr===0&&ts.moveTo(...ys),ts.bezierCurveTo(_s[0],_s[1],Ss[0],Ss[1],vs[0],vs[1])}return ts},zl=function(qr,ts,Yr){const[hs,ys,_s,Ss]=ts;switch(Yr){case 0:for(let vs=0,Hs=qr.length;vs<Hs;vs+=2)qr[vs]+=hs,qr[vs+1]=Ss-qr[vs+1];break;case 90:for(let vs=0,Hs=qr.length;vs<Hs;vs+=2){const Bs=qr[vs];qr[vs]=qr[vs+1]+hs,qr[vs+1]=Bs+ys}break;case 180:for(let vs=0,Hs=qr.length;vs<Hs;vs+=2)qr[vs]=_s-qr[vs],qr[vs+1]+=ys;break;case 270:for(let vs=0,Hs=qr.length;vs<Hs;vs+=2){const Bs=qr[vs];qr[vs]=_s-qr[vs+1],qr[vs+1]=Ss-Bs}break;default:throw new Error("Invalid rotation")}return qr},_u=function(qr,ts,Yr){const[hs,ys,_s,Ss]=ts;switch(Yr){case 0:for(let vs=0,Hs=qr.length;vs<Hs;vs+=2)qr[vs]-=hs,qr[vs+1]=Ss-qr[vs+1];break;case 90:for(let vs=0,Hs=qr.length;vs<Hs;vs+=2){const Bs=qr[vs];qr[vs]=qr[vs+1]-ys,qr[vs+1]=Bs-hs}break;case 180:for(let vs=0,Hs=qr.length;vs<Hs;vs+=2)qr[vs]=_s-qr[vs],qr[vs+1]-=ys;break;case 270:for(let vs=0,Hs=qr.length;vs<Hs;vs+=2){const Bs=qr[vs];qr[vs]=Ss-qr[vs+1],qr[vs+1]=_s-Bs}break;default:throw new Error("Invalid rotation")}return qr},Su=function(qr,ts,Yr,hs){var Hs,Bs;const ys=[],_s=this.thickness/2,Ss=qr*ts+_s,vs=qr*Yr+_s;for(const na of this.paths){const Js=[],$a=[];for(let Vs=0,xa=na.length;Vs<xa;Vs++){const[ro,no,Us,Cs]=na[Vs],Ts=qr*ro[0]+Ss,qs=qr*ro[1]+vs,to=qr*no[0]+Ss,eo=qr*no[1]+vs,xs=qr*Us[0]+Ss,Os=qr*Us[1]+vs,zs=qr*Cs[0]+Ss,Zs=qr*Cs[1]+vs;Vs===0&&(Js.push(Ts,qs),$a.push(Ts,qs)),Js.push(to,eo,xs,Os,zs,Zs),$a.push(to,eo),Vs===xa-1&&$a.push(zs,Zs)}ys.push({bezier:ws(Hs=Ds,Xr,zl).call(Hs,Js,hs,this.rotation),points:ws(Bs=Ds,Xr,zl).call(Bs,$a,hs,this.rotation)})}return ys},Vl=function(){let qr=1/0,ts=-1/0,Yr=1/0,hs=-1/0;for(const ys of this.paths)for(const[_s,Ss,vs,Hs]of ys){const Bs=cr.Util.bezierBoundingBox(..._s,...Ss,...vs,...Hs);qr=Math.min(qr,Bs[0]),Yr=Math.min(Yr,Bs[1]),ts=Math.max(ts,Bs[2]),hs=Math.max(hs,Bs[3])}return[qr,Yr,ts,hs]},Ho=function(){return $r(this,_r)?Math.ceil(this.thickness*this.parentScale):0},Eo=function(qr=!1){if(this.isEmpty())return;if(!$r(this,_r)){ws(this,Cr,ho).call(this);return}const ts=ws(this,Cr,Vl).call(this),Yr=ws(this,Cr,Ho).call(this);ks(this,xr,Math.max(ur.AnnotationEditor.MIN_SIZE,ts[2]-ts[0])),ks(this,fr,Math.max(ur.AnnotationEditor.MIN_SIZE,ts[3]-ts[1]));const hs=Math.ceil(Yr+$r(this,xr)*this.scaleFactor),ys=Math.ceil(Yr+$r(this,fr)*this.scaleFactor),[_s,Ss]=this.parentDimensions;this.width=hs/_s,this.height=ys/Ss,this.setAspectRatio(hs,ys);const vs=this.translationX,Hs=this.translationY;this.translationX=-ts[0],this.translationY=-ts[1],ws(this,Cr,vo).call(this),ws(this,Cr,ho).call(this),ks(this,Tr,hs),ks(this,Rr,ys),this.setDims(hs,ys);const Bs=qr?Yr/this.scaleFactor/2:0;this.translate(vs-this.translationX-Bs,Hs-this.translationY-Bs)},Ns(Ds,Xr),io(Ds,"_defaultColor",null),io(Ds,"_defaultOpacity",1),io(Ds,"_defaultThickness",1),io(Ds,"_type","ink");let mr=Ds;or.InkEditor=mr},(ar,or,lr)=>{var mr,fr,xr,Er,vr,gr,yr,br,_r,jr,wr,ko,To,Wo,Gl,Ru,Cu,Xl,zo,Nu;Object.defineProperty(or,"__esModule",{value:!0}),or.StampEditor=void 0;var cr=lr(1),ur=lr(4),dr=lr(6),hr=lr(29);const Fr=class Fr extends ur.AnnotationEditor{constructor(Gr){super({...Gr,name:"stampEditor"});Ns(this,wr);Ns(this,mr,null);Ns(this,fr,null);Ns(this,xr,null);Ns(this,Er,null);Ns(this,vr,null);Ns(this,gr,null);Ns(this,yr,null);Ns(this,br,null);Ns(this,_r,!1);Ns(this,jr,!1);ks(this,Er,Gr.bitmapUrl),ks(this,vr,Gr.bitmapFile)}static initialize(Gr){ur.AnnotationEditor.initialize(Gr)}static get supportedTypes(){const Gr=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,cr.shadow)(this,"supportedTypes",Gr.map(Zr=>`image/${Zr}`))}static get supportedTypesStr(){return(0,cr.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(Gr){return this.supportedTypes.includes(Gr)}static paste(Gr,Zr){Zr.pasteEditor(cr.AnnotationEditorType.STAMP,{bitmapFile:Gr.getAsFile()})}remove(){var Gr,Zr;$r(this,fr)&&(ks(this,mr,null),this._uiManager.imageManager.deleteId($r(this,fr)),(Gr=$r(this,gr))==null||Gr.remove(),ks(this,gr,null),(Zr=$r(this,yr))==null||Zr.disconnect(),ks(this,yr,null)),super.remove()}rebuild(){if(!this.parent){$r(this,fr)&&ws(this,wr,Wo).call(this);return}super.rebuild(),this.div!==null&&($r(this,fr)&&ws(this,wr,Wo).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!($r(this,xr)||$r(this,mr)||$r(this,Er)||$r(this,vr))}get isResizable(){return!0}render(){if(this.div)return this.div;let Gr,Zr;if(this.width&&(Gr=this.x,Zr=this.y),super.render(),this.div.hidden=!0,$r(this,mr)?ws(this,wr,Gl).call(this):ws(this,wr,Wo).call(this),this.width){const[Jr,os]=this.parentDimensions;this.setAt(Gr*Jr,Zr*os,this.width*Jr,this.height*os)}return this.div}static deserialize(Gr,Zr,Jr){if(Gr instanceof hr.StampAnnotationElement)return null;const os=super.deserialize(Gr,Zr,Jr),{rect:Ur,bitmapUrl:Vr,bitmapId:es,isSvg:Ir,accessibilityData:Dr}=Gr;es&&Jr.imageManager.isValidId(es)?ks(os,fr,es):ks(os,Er,Vr),ks(os,_r,Ir);const[Pr,Mr]=os.pageDimensions;return os.width=(Ur[2]-Ur[0])/Pr,os.height=(Ur[3]-Ur[1])/Mr,Dr&&(os.altTextData=Dr),os}serialize(Gr=!1,Zr=null){if(this.isEmpty())return null;const Jr={annotationType:cr.AnnotationEditorType.STAMP,bitmapId:$r(this,fr),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:$r(this,_r),structTreeParentId:this._structTreeParentId};if(Gr)return Jr.bitmapUrl=ws(this,wr,zo).call(this,!0),Jr.accessibilityData=this.altTextData,Jr;const{decorative:os,altText:Ur}=this.altTextData;if(!os&&Ur&&(Jr.accessibilityData={type:"Figure",alt:Ur}),Zr===null)return Jr;Zr.stamps||(Zr.stamps=new Map);const Vr=$r(this,_r)?(Jr.rect[2]-Jr.rect[0])*(Jr.rect[3]-Jr.rect[1]):null;if(!Zr.stamps.has($r(this,fr)))Zr.stamps.set($r(this,fr),{area:Vr,serialized:Jr}),Jr.bitmap=ws(this,wr,zo).call(this,!1);else if($r(this,_r)){const es=Zr.stamps.get($r(this,fr));Vr>es.area&&(es.area=Vr,es.serialized.bitmap.close(),es.serialized.bitmap=ws(this,wr,zo).call(this,!1))}return Jr}};mr=new WeakMap,fr=new WeakMap,xr=new WeakMap,Er=new WeakMap,vr=new WeakMap,gr=new WeakMap,yr=new WeakMap,br=new WeakMap,_r=new WeakMap,jr=new WeakMap,wr=new WeakSet,ko=function(Gr,Zr=!1){if(!Gr){this.remove();return}ks(this,mr,Gr.bitmap),Zr||(ks(this,fr,Gr.id),ks(this,_r,Gr.isSvg)),ws(this,wr,Gl).call(this)},To=function(){ks(this,xr,null),this._uiManager.enableWaiting(!1),$r(this,gr)&&this.div.focus()},Wo=function(){if($r(this,fr)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId($r(this,fr)).then(Zr=>ws(this,wr,ko).call(this,Zr,!0)).finally(()=>ws(this,wr,To).call(this));return}if($r(this,Er)){const Zr=$r(this,Er);ks(this,Er,null),this._uiManager.enableWaiting(!0),ks(this,xr,this._uiManager.imageManager.getFromUrl(Zr).then(Jr=>ws(this,wr,ko).call(this,Jr)).finally(()=>ws(this,wr,To).call(this)));return}if($r(this,vr)){const Zr=$r(this,vr);ks(this,vr,null),this._uiManager.enableWaiting(!0),ks(this,xr,this._uiManager.imageManager.getFromFile(Zr).then(Jr=>ws(this,wr,ko).call(this,Jr)).finally(()=>ws(this,wr,To).call(this)));return}const Gr=document.createElement("input");Gr.type="file",Gr.accept=Fr.supportedTypesStr,ks(this,xr,new Promise(Zr=>{Gr.addEventListener("change",async()=>{if(!Gr.files||Gr.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const Jr=await this._uiManager.imageManager.getFromFile(Gr.files[0]);ws(this,wr,ko).call(this,Jr)}Zr()}),Gr.addEventListener("cancel",()=>{this.remove(),Zr()})}).finally(()=>ws(this,wr,To).call(this))),Gr.click()},Gl=function(){const{div:Gr}=this;let{width:Zr,height:Jr}=$r(this,mr);const[os,Ur]=this.pageDimensions,Vr=.75;if(this.width)Zr=this.width*os,Jr=this.height*Ur;else if(Zr>Vr*os||Jr>Vr*Ur){const Pr=Math.min(Vr*os/Zr,Vr*Ur/Jr);Zr*=Pr,Jr*=Pr}const[es,Ir]=this.parentDimensions;this.setDims(Zr*es/os,Jr*Ir/Ur),this._uiManager.enableWaiting(!1);const Dr=ks(this,gr,document.createElement("canvas"));Gr.append(Dr),Gr.hidden=!1,ws(this,wr,Xl).call(this,Zr,Jr),ws(this,wr,Nu).call(this),$r(this,jr)||(this.parent.addUndoableEditor(this),ks(this,jr,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},Ru=function(Gr,Zr){var Vr;const[Jr,os]=this.parentDimensions;this.width=Gr/Jr,this.height=Zr/os,this.setDims(Gr,Zr),(Vr=this._initialOptions)!=null&&Vr.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,$r(this,br)!==null&&clearTimeout($r(this,br)),ks(this,br,setTimeout(()=>{ks(this,br,null),ws(this,wr,Xl).call(this,Gr,Zr)},200))},Cu=function(Gr,Zr){const{width:Jr,height:os}=$r(this,mr);let Ur=Jr,Vr=os,es=$r(this,mr);for(;Ur>2*Gr||Vr>2*Zr;){const Ir=Ur,Dr=Vr;Ur>2*Gr&&(Ur=Ur>=16384?Math.floor(Ur/2)-1:Math.ceil(Ur/2)),Vr>2*Zr&&(Vr=Vr>=16384?Math.floor(Vr/2)-1:Math.ceil(Vr/2));const Pr=new OffscreenCanvas(Ur,Vr);Pr.getContext("2d").drawImage(es,0,0,Ir,Dr,0,0,Ur,Vr),es=Pr.transferToImageBitmap()}return es},Xl=function(Gr,Zr){Gr=Math.ceil(Gr),Zr=Math.ceil(Zr);const Jr=$r(this,gr);if(!Jr||Jr.width===Gr&&Jr.height===Zr)return;Jr.width=Gr,Jr.height=Zr;const os=$r(this,_r)?$r(this,mr):ws(this,wr,Cu).call(this,Gr,Zr),Ur=Jr.getContext("2d");Ur.filter=this._uiManager.hcmFilter,Ur.drawImage(os,0,0,os.width,os.height,0,0,Gr,Zr)},zo=function(Gr){if(Gr){if($r(this,_r)){const os=this._uiManager.imageManager.getSvgUrl($r(this,fr));if(os)return os}const Zr=document.createElement("canvas");return{width:Zr.width,height:Zr.height}=$r(this,mr),Zr.getContext("2d").drawImage($r(this,mr),0,0),Zr.toDataURL()}if($r(this,_r)){const[Zr,Jr]=this.pageDimensions,os=Math.round(this.width*Zr*dr.PixelsPerInch.PDF_TO_CSS_UNITS),Ur=Math.round(this.height*Jr*dr.PixelsPerInch.PDF_TO_CSS_UNITS),Vr=new OffscreenCanvas(os,Ur);return Vr.getContext("2d").drawImage($r(this,mr),0,0,$r(this,mr).width,$r(this,mr).height,0,0,os,Ur),Vr.transferToImageBitmap()}return structuredClone($r(this,mr))},Nu=function(){ks(this,yr,new ResizeObserver(Gr=>{const Zr=Gr[0].contentRect;Zr.width&&Zr.height&&ws(this,wr,Ru).call(this,Zr.width,Zr.height)})),$r(this,yr).observe(this.div)},io(Fr,"_type","stamp");let pr=Fr;or.StampEditor=pr}],__webpack_module_cache__={};function __w_pdfjs_require__(ar){var or=__webpack_module_cache__[ar];if(or!==void 0)return or.exports;var lr=__webpack_module_cache__[ar]={exports:{}};return __webpack_modules__[ar](lr,lr.exports,__w_pdfjs_require__),lr.exports}var __webpack_exports__={};return(()=>{var ar=__webpack_exports__;Object.defineProperty(ar,"__esModule",{value:!0}),Object.defineProperty(ar,"AbortException",{enumerable:!0,get:function(){return or.AbortException}}),Object.defineProperty(ar,"AnnotationEditorLayer",{enumerable:!0,get:function(){return dr.AnnotationEditorLayer}}),Object.defineProperty(ar,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return or.AnnotationEditorParamsType}}),Object.defineProperty(ar,"AnnotationEditorType",{enumerable:!0,get:function(){return or.AnnotationEditorType}}),Object.defineProperty(ar,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return hr.AnnotationEditorUIManager}}),Object.defineProperty(ar,"AnnotationLayer",{enumerable:!0,get:function(){return pr.AnnotationLayer}}),Object.defineProperty(ar,"AnnotationMode",{enumerable:!0,get:function(){return or.AnnotationMode}}),Object.defineProperty(ar,"CMapCompressionType",{enumerable:!0,get:function(){return or.CMapCompressionType}}),Object.defineProperty(ar,"DOMSVGFactory",{enumerable:!0,get:function(){return cr.DOMSVGFactory}}),Object.defineProperty(ar,"FeatureTest",{enumerable:!0,get:function(){return or.FeatureTest}}),Object.defineProperty(ar,"GlobalWorkerOptions",{enumerable:!0,get:function(){return mr.GlobalWorkerOptions}}),Object.defineProperty(ar,"ImageKind",{enumerable:!0,get:function(){return or.ImageKind}}),Object.defineProperty(ar,"InvalidPDFException",{enumerable:!0,get:function(){return or.InvalidPDFException}}),Object.defineProperty(ar,"MissingPDFException",{enumerable:!0,get:function(){return or.MissingPDFException}}),Object.defineProperty(ar,"OPS",{enumerable:!0,get:function(){return or.OPS}}),Object.defineProperty(ar,"PDFDataRangeTransport",{enumerable:!0,get:function(){return lr.PDFDataRangeTransport}}),Object.defineProperty(ar,"PDFDateString",{enumerable:!0,get:function(){return cr.PDFDateString}}),Object.defineProperty(ar,"PDFWorker",{enumerable:!0,get:function(){return lr.PDFWorker}}),Object.defineProperty(ar,"PasswordResponses",{enumerable:!0,get:function(){return or.PasswordResponses}}),Object.defineProperty(ar,"PermissionFlag",{enumerable:!0,get:function(){return or.PermissionFlag}}),Object.defineProperty(ar,"PixelsPerInch",{enumerable:!0,get:function(){return cr.PixelsPerInch}}),Object.defineProperty(ar,"PromiseCapability",{enumerable:!0,get:function(){return or.PromiseCapability}}),Object.defineProperty(ar,"RenderingCancelledException",{enumerable:!0,get:function(){return cr.RenderingCancelledException}}),Object.defineProperty(ar,"SVGGraphics",{enumerable:!0,get:function(){return lr.SVGGraphics}}),Object.defineProperty(ar,"UnexpectedResponseException",{enumerable:!0,get:function(){return or.UnexpectedResponseException}}),Object.defineProperty(ar,"Util",{enumerable:!0,get:function(){return or.Util}}),Object.defineProperty(ar,"VerbosityLevel",{enumerable:!0,get:function(){return or.VerbosityLevel}}),Object.defineProperty(ar,"XfaLayer",{enumerable:!0,get:function(){return fr.XfaLayer}}),Object.defineProperty(ar,"build",{enumerable:!0,get:function(){return lr.build}}),Object.defineProperty(ar,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return or.createValidAbsoluteUrl}}),Object.defineProperty(ar,"getDocument",{enumerable:!0,get:function(){return lr.getDocument}}),Object.defineProperty(ar,"getFilenameFromUrl",{enumerable:!0,get:function(){return cr.getFilenameFromUrl}}),Object.defineProperty(ar,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return cr.getPdfFilenameFromUrl}}),Object.defineProperty(ar,"getXfaPageViewport",{enumerable:!0,get:function(){return cr.getXfaPageViewport}}),Object.defineProperty(ar,"isDataScheme",{enumerable:!0,get:function(){return cr.isDataScheme}}),Object.defineProperty(ar,"isPdfFile",{enumerable:!0,get:function(){return cr.isPdfFile}}),Object.defineProperty(ar,"loadScript",{enumerable:!0,get:function(){return cr.loadScript}}),Object.defineProperty(ar,"noContextMenu",{enumerable:!0,get:function(){return cr.noContextMenu}}),Object.defineProperty(ar,"normalizeUnicode",{enumerable:!0,get:function(){return or.normalizeUnicode}}),Object.defineProperty(ar,"renderTextLayer",{enumerable:!0,get:function(){return ur.renderTextLayer}}),Object.defineProperty(ar,"setLayerDimensions",{enumerable:!0,get:function(){return cr.setLayerDimensions}}),Object.defineProperty(ar,"shadow",{enumerable:!0,get:function(){return or.shadow}}),Object.defineProperty(ar,"updateTextLayer",{enumerable:!0,get:function(){return ur.updateTextLayer}}),Object.defineProperty(ar,"version",{enumerable:!0,get:function(){return lr.version}});var or=__w_pdfjs_require__(1),lr=__w_pdfjs_require__(2),cr=__w_pdfjs_require__(6),ur=__w_pdfjs_require__(26),dr=__w_pdfjs_require__(27),hr=__w_pdfjs_require__(5),pr=__w_pdfjs_require__(29),mr=__w_pdfjs_require__(14),fr=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let ar=0;ar<256;++ar)byteToHex.push((ar+256).toString(16).slice(1));function unsafeStringify(ar,or=0){return byteToHex[ar[or+0]]+byteToHex[ar[or+1]]+byteToHex[ar[or+2]]+byteToHex[ar[or+3]]+"-"+byteToHex[ar[or+4]]+byteToHex[ar[or+5]]+"-"+byteToHex[ar[or+6]]+byteToHex[ar[or+7]]+"-"+byteToHex[ar[or+8]]+byteToHex[ar[or+9]]+"-"+byteToHex[ar[or+10]]+byteToHex[ar[or+11]]+byteToHex[ar[or+12]]+byteToHex[ar[or+13]]+byteToHex[ar[or+14]]+byteToHex[ar[or+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(ar,or,lr){if(native.randomUUID&&!ar)return native.randomUUID();ar=ar||{};const cr=ar.random||(ar.rng||rng)();return cr[6]=cr[6]&15|64,cr[8]=cr[8]&63|128,unsafeStringify(cr)}pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;async function parseScheduleStage1(ar){console.time("scheduleParser:stage1");const or=await new Promise(mr=>{const fr=new FileReader;fr.onload=()=>mr(fr.result),fr.readAsDataURL(ar)}),lr=await extractTextFromPDF$2(ar);console.log("Stage 1: Extracted text length:",lr.length);const cr=extractCastListFast(lr);console.log("Stage 1: Found",cr.length,"cast members");const{totalDays:ur,dayTextBlocks:dr}=extractDayCountAndBlocks(lr);console.log("Stage 1: Found",ur,"shooting days");const hr=extractMetadata(lr);console.log("Stage 1: Production name:",hr.productionName);const pr={id:v4(),productionName:hr.productionName,scriptVersion:hr.scriptVersion,scheduleVersion:hr.scheduleVersion,status:"pending",processingProgress:{current:0,total:ur},castList:cr,days:[],totalDays:ur,uploadedAt:new Date,pdfUri:or,rawText:lr};return console.timeEnd("scheduleParser:stage1"),{schedule:pr,rawText:lr,dayTextBlocks:dr}}function extractDayCountAndBlocks(ar){const or=[],lr=/End of Shooting Day\s+(\d+)/gi,cr=[];let ur;for(;(ur=lr.exec(ar))!==null;){const hr=parseInt(ur[1],10);cr.find(pr=>pr.dayNum===hr)||cr.push({dayNum:hr,endPos:ur.index+ur[0].length})}cr.sort((hr,pr)=>hr.endPos-pr.endPos);let dr=0;for(let hr=0;hr<cr.length;hr++){const pr=cr[hr],mr=hr>0?cr[hr-1].endPos:0,fr=ar.slice(mr,pr.endPos+200);or.push(fr),dr=Math.max(dr,pr.dayNum)}if(cr.length===0){const hr=/(?:^|\n)(?:Shooting\s+)?Day\s+(\d+)/gi;for(;(ur=hr.exec(ar))!==null;){const pr=parseInt(ur[1],10);dr=Math.max(dr,pr)}}return{totalDays:dr,dayTextBlocks:or}}async function extractTextFromPDF$2(ar){const or=await ar.arrayBuffer(),lr=await pdfExports.getDocument({data:or}).promise;let cr="";for(let ur=1;ur<=lr.numPages;ur++){const hr=await(await lr.getPage(ur)).getTextContent(),pr=new Map;for(const fr of hr.items){if(!fr.str||fr.str.trim()==="")continue;const xr=Math.round(fr.transform[5]/3)*3,Er=fr.transform[4];pr.has(xr)||pr.set(xr,[]),pr.get(xr).push({x:Er,text:fr.str,width:fr.width||0})}const mr=Array.from(pr.keys()).sort((fr,xr)=>xr-fr);for(const fr of mr){const xr=pr.get(fr);xr.sort((yr,br)=>yr.x-br.x);let Er="",vr=0,gr=0;for(const yr of xr){const br=yr.x-(vr+gr);vr>0&&br>15?Er+="	":vr>0&&br>3&&(Er+=" "),Er+=yr.text,vr=yr.x,gr=yr.width}cr+=Er.trimEnd()+`
`}cr+=`
=== PAGE ${ur} ===

`}return cr}function extractCastListFast(ar){const or=[],lr=ar.slice(0,15e3),cr=[/(?:CAST\s*LIST|CAST\s*MEMBERS?|CAST|CHARACTERS?)[:\s]*\n([\s\S]*?)(?=\n\s*\n\s*\n|SHOOTING\s*DAY|END\s*OF|DAY\s+\d|=== PAGE)/i,/(?:CAST\s*LIST|CAST\s*MEMBERS?|CAST|CHARACTERS?)[:\s]*\n([\s\S]*?)(?=\n[A-Z]{3,}\s*\n|\nSCENE|\nDAY\b)/i];for(const mr of cr){const fr=lr.match(mr);if(fr){const xr=fr[1],Er=/(\d{1,3})\s*[.\-)\]:]?\s*([A-Z][A-Za-z'\-.\s]{1,30})/g;let vr;for(;(vr=Er.exec(xr))!==null;)addCastMember(or,vr[1],vr[2]);if(or.length>=2)break}}const ur=/(?:^|\n|\t)\s*(\d{1,3})\s*[.\-)\]:]\s*([A-Z][A-Za-z'\-.\s]{1,30}?)(?=\s*\n|\s*\t|\s{3,})/gm;let dr;for(;(dr=ur.exec(lr))!==null;)addCastMember(or,dr[1],dr[2]);const hr=/(?:^|\n)\s*(\d{1,3})[\t\s]{2,}([A-Z][A-Za-z'\-.\s]{1,30}?)(?=\s*[\t\n]|\s{3,}|$)/gm;for(;(dr=hr.exec(lr))!==null;)addCastMember(or,dr[1],dr[2]);const pr=/\((\d{1,3})\)\s*([A-Z][A-Za-z'\-.\s]{1,30}?)(?=\s*\n|\s*\t|\s{3,})/gm;for(;(dr=pr.exec(lr))!==null;)addCastMember(or,dr[1],dr[2]);if(or.length<3){const mr=/(?:^|\n|\t)\s*(\d{1,2})\s*[.\-)\]:]\s*([A-Z][A-Za-z'\-.\s]{2,25})/gm,fr=[];for(;(dr=mr.exec(ar.slice(0,2e4)))!==null;){const xr=dr[2].trim(),Er=new RegExp(`\\b${escapeRegExpSchedule(xr.split(" ")[0])}\\b`,"gi"),vr=(ar.match(Er)||[]).length;vr>=2&&fr.push({num:dr[1],name:xr,count:vr})}fr.sort((xr,Er)=>Er.count-xr.count);for(const xr of fr)addCastMember(or,xr.num,xr.name)}return or.sort((mr,fr)=>mr.number-fr.number),console.log("extractCastListFast: Found",or.length,"cast members:",or.map(mr=>`${mr.number}.${mr.name}`).join(", ")),or}function escapeRegExpSchedule(ar){return ar.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function addCastMember(ar,or,lr){const cr=parseInt(or,10);let ur=lr.trim().replace(/\s+/g," ").replace(/[.,;:]+$/,"").trim();cr<=0||cr>200||ur.length<2||ur.length>30||/^(INT|EXT|DAY|NIGHT|MORNING|HOURS|PAGE|SCENE|EST|TIME|CALL|UNIT|SET|LOC|END|TOTAL|SHOOT)/i.test(ur)||/^\d+$/.test(ur)||/^\d{1,2}[:/]\d{2}/.test(ur)||ar.find(dr=>dr.number===cr)||(ur=ur.toUpperCase(),ar.push({number:cr,name:ur}))}function extractMetadata(ar){const or=ar.slice(0,2e3),lr=or.match(/^[A-Z][A-Z\s\-']+(?=\s*\n)/m),cr=or.match(/(?:Script|Draft)[:\s]*([A-Za-z]+\s*\d*)/i),ur=or.match(/(?:Schedule|Version)[:\s]*([A-Za-z0-9\s\-\/]+)/i);return{productionName:lr?lr[0].trim():void 0,scriptVersion:cr?cr[1].trim():void 0,scheduleVersion:ur?ur[1].trim():void 0}}function aiDebugLog(...ar){console.log("[AIService]",...ar)}async function callAI(ar,or={}){var pr;const{system:lr,maxTokens:cr=4e3,maxRetries:ur=3}=or;aiDebugLog("callAI started, maxTokens:",cr,"prompt length:",ar.length);const dr=[{role:"user",content:ar}];let hr=null;for(let mr=0;mr<ur;mr++)try{aiDebugLog(`Attempt ${mr+1}/${ur}...`);const xr=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:dr,system:lr,maxTokens:cr,model:"claude-sonnet-4-20250514"})});if(aiDebugLog("Response status:",xr.status),!xr.ok){const vr=await xr.json().catch(()=>({})),gr=((pr=vr.error)==null?void 0:pr.message)||vr.error||"";if(aiDebugLog("API error:",xr.status,gr),xr.status===429){const yr=Math.pow(2,mr+1)*1e3;aiDebugLog(`Rate limited, waiting ${yr}ms before retry...`),await new Promise(br=>setTimeout(br,yr));continue}if(xr.status===529){const yr=Math.pow(2,mr+1)*1e3;aiDebugLog(`Server overloaded, waiting ${yr}ms before retry...`),await new Promise(br=>setTimeout(br,yr));continue}if(xr.status===400&&(gr.includes("credit balance")||gr.includes("purchase credits")))throw new Error("Insufficient API credits. Please add credits at console.anthropic.com");if(xr.status===401||xr.status===403)throw new Error("Invalid API key. Please check your configuration.");if(xr.status>=500){const yr=Math.pow(2,mr+1)*1e3;aiDebugLog(`Server error ${xr.status}, waiting ${yr}ms before retry...`),await new Promise(br=>setTimeout(br,yr));continue}throw new Error(vr.error||`API error: ${xr.status}`)}const Er=await xr.json();if(Er.content&&Er.content.length>0){const vr=Er.content[0].text;return aiDebugLog("AI call successful, response length:",vr.length),Er.usage&&aiDebugLog("Token usage:",Er.usage),vr}throw new Error("Empty response from AI")}catch(fr){hr=fr,aiDebugLog(`AI call attempt ${mr+1} failed:`,fr),console.error(`AI call attempt ${mr+1} failed:`,fr);const xr=hr.message||"";if(xr.includes("Insufficient API credits")||xr.includes("Invalid API key"))throw hr;if(mr<ur-1){const Er=Math.pow(2,mr+1)*1e3;aiDebugLog(`Waiting ${Er}ms before retry...`),await new Promise(vr=>setTimeout(vr,Er))}}throw aiDebugLog("All retries failed, throwing error"),hr||new Error("AI call failed after retries")}async function processDayWithAI(ar,or,lr){const cr=`You are an expert at parsing film/TV production schedules. Extract structured scene data from a single shooting day's schedule text.

The text comes from a PDF extraction and may have table structure lost. Look for patterns:
- Scene numbers (e.g., "Scene 21", "Scene 14", "Scene 61A")
- INT/EXT markers
- Location/set descriptions (e.g., "MARGOT'S BEDROOM - PLUMHILL MANOR")
- Day/Night indicators
- Page counts (e.g., "2 pgs", "1 4/8 pgs", "5/8 pgs")
- Cast numbers (small numbers like 1, 2, 3 that refer to cast members)
- Estimated times (e.g., "3:00", "1:30", ":30")
- Story day markers (e.g., "D5", "N8", "D4")
- Scene descriptions/log lines
- Set moves, lighting changes, load in/out markers
- "End of Shooting Day" summary lines with date and total pages

${lr}

Return ONLY valid JSON with no additional text or markdown.`,ur=`Parse this shooting day text and extract ALL scenes with their details.

SHOOTING DAY TEXT:
---
${ar}
---

Return a JSON object with this structure:
{
  "dayNumber": ${or},
  "date": "YYYY-MM-DD or null if not found",
  "dayOfWeek": "Monday/Tuesday/etc or null",
  "location": "Main location for the day",
  "notes": ["array of notes like 'Set Move :30', 'Lighting Change for Night', 'Load In :30'"],
  "totalPages": "total pages string if found in End of Shooting Day line",
  "scenes": [
    {
      "sceneNumber": "21",
      "pages": "2",
      "intExt": "INT",
      "dayNight": "Day",
      "setLocation": "MARGOT'S BEDROOM - PLUMHILL MANOR",
      "description": "Margot wakes to a call from Calvaux.",
      "castNumbers": [1],
      "estimatedTime": "3:00",
      "storyDay": "D5",
      "remarks": "Calvaux (Phone)"
    }
  ]
}

IMPORTANT:
- Extract EVERY scene entry, including those after "Lighting Change" or "Set Move" markers
- Scene numbers may include letters like "61A", "14pt"
- Pages can be "2", "1 4/8", "2/8", "5/8", "3/8" etc.
- Cast numbers are the small integers (1, 2, 3, 7, etc.) that reference the cast list
- Day/Night is usually "Day", "Night", "Morning" - also look for D/N column
- The description/log line describes what happens in the scene
- estimatedTime is the Est. Time value (e.g., "3:00", "1:30", ":30", "1:00")
- storyDay is the Day marker like "D5", "N8", "D4" from the Day column
- remarks captures any additional notes from the Remarks column
- Include the shootOrder (1-based index within the day)
- Look for the "End of Shooting Day X" line for date and total pages info`,hr=(await callAI(ur,{system:cr,maxTokens:6e3})).match(/\{[\s\S]*\}/);if(!hr)throw new Error(`Failed to parse AI response for day ${or}`);const pr=JSON.parse(hr[0]),mr=(pr.scenes||[]).map((fr,xr)=>{var Er;return{sceneNumber:String(fr.sceneNumber||""),pages:fr.pages||void 0,intExt:((Er=fr.intExt)==null?void 0:Er.toUpperCase())==="EXT"?"EXT":"INT",dayNight:fr.dayNight||fr.storyDay||"Day",setLocation:fr.setLocation||"",description:fr.description||fr.remarks||void 0,castNumbers:Array.isArray(fr.castNumbers)?fr.castNumbers.map(Number).filter(vr=>!isNaN(vr)):[],estimatedTime:fr.estimatedTime||void 0,shootOrder:xr+1}});return{dayNumber:pr.dayNumber||or,date:pr.date||void 0,dayOfWeek:pr.dayOfWeek||void 0,location:pr.location||"",notes:Array.isArray(pr.notes)?pr.notes:void 0,scenes:mr,totalPages:pr.totalPages||void 0}}function extractDayTextBlocks(ar){const or=new Map,lr=/End of Shooting Day\s+(\d+)/gi,cr=[];let ur;for(;(ur=lr.exec(ar))!==null;){const dr=parseInt(ur[1],10),hr=Math.min(ur.index+ur[0].length+200,ar.length);cr.push({dayNum:dr,endPos:hr})}cr.sort((dr,hr)=>dr.endPos-hr.endPos);for(let dr=0;dr<cr.length;dr++){const hr=cr[dr],pr=dr>0?cr[dr-1].endPos:0,mr=ar.slice(pr,hr.endPos);or.set(hr.dayNum,mr)}return or}async function processScheduleStage2(ar,or){const lr=ar.rawText;if(!lr)throw new Error("No raw text available for processing. Please re-upload the schedule.");const cr=ar.castList.length>0?`CAST LIST (number  name):
${ar.castList.map(mr=>`${mr.number}. ${mr.name}`).join(`
`)}

Use these cast numbers when identifying which cast members are in each scene.`:"",ur=extractDayTextBlocks(lr),dr=ar.totalDays||ur.size;if(ur.size===0)return or==null||or({current:1,total:1,message:"Processing schedule..."}),{days:[await processDayWithAI(lr.slice(0,3e4),1,cr)]};const hr=[],pr=Array.from(ur.keys()).sort((mr,fr)=>mr-fr);for(let mr=0;mr<pr.length;mr++){const fr=pr[mr],xr=ur.get(fr);or==null||or({current:mr+1,total:dr,message:`Processing Day ${fr} of ${dr}...`});try{const Er=await processDayWithAI(xr,fr,cr);hr.push(Er)}catch(Er){console.error(`Failed to process day ${fr}:`,Er),hr.push({dayNumber:fr,location:"",scenes:[],notes:[`Processing failed: ${Er instanceof Error?Er.message:"Unknown error"}`]})}}return{days:hr}}function buildSceneMap(ar){const or=new Map;for(const lr of ar.days)for(const cr of lr.scenes){const ur=cr.sceneNumber.replace(/\s+/g,"").toUpperCase();or.set(ur,{day:lr,entry:cr})}return or}function normalizeSceneNumber(ar){return ar.replace(/\s+/g,"").toUpperCase()}function detectCastChanges(ar,or){const lr=new Set(ar.castNumbers),cr=new Set(or.castNumbers),ur=[...cr].filter(hr=>!lr.has(hr)),dr=[...lr].filter(hr=>!cr.has(hr));return ur.length===0&&dr.length===0?null:{added:ur,removed:dr}}function detectTimingChanges(ar,or,lr){return lr?(ar.estimatedTime||"")!==(or.estimatedTime||"")||ar.shootOrder!==or.shootOrder||(ar.pages||"")!==(or.pages||""):!1}function compareScheduleAmendment(ar,or){const lr=buildSceneMap(ar),cr=buildSceneMap(or),ur=[],dr=[],hr=new Set(ar.days.map(Sr=>Sr.dayNumber)),pr=new Set(or.days.map(Sr=>Sr.dayNumber)),mr=new Set;for(const[Sr,{day:Tr,entry:Rr}]of cr){mr.add(Sr);const Nr=lr.get(Sr);if(!Nr)ur.push({sceneNumber:Rr.sceneNumber,changeType:"scene_added",description:`Scene ${Rr.sceneNumber} added to Day ${Tr.dayNumber}`,newDay:Tr.dayNumber,newEntry:Rr});else{const{day:Cr,entry:kr}=Nr,Ar=Cr.dayNumber===Tr.dayNumber;Ar||ur.push({sceneNumber:Rr.sceneNumber,changeType:"scene_moved",description:`Scene ${Rr.sceneNumber} moved from Day ${Cr.dayNumber} to Day ${Tr.dayNumber}`,oldDay:Cr.dayNumber,newDay:Tr.dayNumber,oldEntry:kr,newEntry:Rr});const Or=detectCastChanges(kr,Rr);if(Or){const Lr=[];Or.added.length>0&&Lr.push(`${Or.added.length} cast added`),Or.removed.length>0&&Lr.push(`${Or.removed.length} cast removed`),ur.push({sceneNumber:Rr.sceneNumber,changeType:"cast_changed",description:`Scene ${Rr.sceneNumber}: ${Lr.join(", ")}`,oldDay:Cr.dayNumber,newDay:Tr.dayNumber,oldEntry:kr,newEntry:Rr,castAdded:Or.added,castRemoved:Or.removed})}if(Ar&&detectTimingChanges(kr,Rr,Ar)){const Lr=[];(kr.estimatedTime||"")!==(Rr.estimatedTime||"")&&Lr.push(`time: ${kr.estimatedTime||"none"}  ${Rr.estimatedTime||"none"}`),kr.shootOrder!==Rr.shootOrder&&Lr.push(`order: ${kr.shootOrder}  ${Rr.shootOrder}`),(kr.pages||"")!==(Rr.pages||"")&&Lr.push(`pages: ${kr.pages||"none"}  ${Rr.pages||"none"}`),ur.push({sceneNumber:Rr.sceneNumber,changeType:"timing_changed",description:`Scene ${Rr.sceneNumber}: ${Lr.join(", ")}`,oldDay:Cr.dayNumber,newDay:Tr.dayNumber,oldEntry:kr,newEntry:Rr})}}}for(const[Sr,{day:Tr,entry:Rr}]of lr)mr.has(Sr)||ur.push({sceneNumber:Rr.sceneNumber,changeType:"scene_removed",description:`Scene ${Rr.sceneNumber} removed from Day ${Tr.dayNumber}`,oldDay:Tr.dayNumber,oldEntry:Rr});for(const Sr of or.days)if(!hr.has(Sr.dayNumber)){const Tr=ur.filter(Rr=>Rr.newDay===Sr.dayNumber);dr.push({dayNumber:Sr.dayNumber,changeType:"day_added",description:`Day ${Sr.dayNumber} added (${Sr.scenes.length} scene${Sr.scenes.length!==1?"s":""})`,newDay:Sr,sceneChanges:Tr})}for(const Sr of ar.days)if(!pr.has(Sr.dayNumber)){const Tr=ur.filter(Rr=>Rr.oldDay===Sr.dayNumber);dr.push({dayNumber:Sr.dayNumber,changeType:"day_removed",description:`Day ${Sr.dayNumber} removed (${Sr.scenes.length} scene${Sr.scenes.length!==1?"s":""})`,oldDay:Sr,sceneChanges:Tr})}for(const Sr of or.days)if(hr.has(Sr.dayNumber)){const Tr=ur.filter(Rr=>Rr.newDay===Sr.dayNumber||Rr.oldDay===Sr.dayNumber);if(Tr.length>0){const Rr=ar.days.find(Nr=>Nr.dayNumber===Sr.dayNumber);dr.push({dayNumber:Sr.dayNumber,changeType:"day_modified",description:`Day ${Sr.dayNumber}: ${Tr.length} change${Tr.length!==1?"s":""}`,oldDay:Rr,newDay:Sr,sceneChanges:Tr})}}dr.sort((Sr,Tr)=>Sr.dayNumber-Tr.dayNumber);const fr=ur.filter(Sr=>Sr.changeType==="scene_added"),xr=ur.filter(Sr=>Sr.changeType==="scene_removed"),Er=ur.filter(Sr=>Sr.changeType==="scene_moved"),vr=ur.filter(Sr=>Sr.changeType==="cast_changed"),gr=ur.filter(Sr=>Sr.changeType==="timing_changed"),yr=dr.filter(Sr=>Sr.changeType==="day_added"),br=dr.filter(Sr=>Sr.changeType==="day_removed"),_r=[];fr.length>0&&_r.push(`${fr.length} scene${fr.length>1?"s":""} added`),xr.length>0&&_r.push(`${xr.length} scene${xr.length>1?"s":""} removed`),Er.length>0&&_r.push(`${Er.length} scene${Er.length>1?"s":""} moved`),vr.length>0&&_r.push(`${vr.length} cast change${vr.length>1?"s":""}`),gr.length>0&&_r.push(`${gr.length} timing change${gr.length>1?"s":""}`),yr.length>0&&_r.push(`${yr.length} day${yr.length>1?"s":""} added`),br.length>0&&_r.push(`${br.length} day${br.length>1?"s":""} removed`);const jr=_r.length>0?_r.join(", "):"No changes detected",wr=ur.length>0||dr.length>0;return{dayChanges:dr,allSceneChanges:ur,addedScenes:fr,removedScenes:xr,movedScenes:Er,castChanges:vr,timingChanges:gr,addedDays:yr,removedDays:br,summary:jr,hasChanges:wr}}function applyScheduleAmendment(ar,or,lr,cr={includeAddedScenes:!0,includeRemovedScenes:!0,includeMovedScenes:!0,includeCastChanges:!0,includeTimingChanges:!0}){const ur=new Map;for(const xr of ar.days)ur.set(xr.dayNumber,{...xr,scenes:[...xr.scenes]});const dr=new Set;if(!cr.includeAddedScenes)for(const xr of lr.addedScenes)dr.add(normalizeSceneNumber(xr.sceneNumber));if(!cr.includeRemovedScenes)for(const xr of lr.removedScenes)dr.add(normalizeSceneNumber(xr.sceneNumber));if(!cr.includeMovedScenes)for(const xr of lr.movedScenes)dr.add(normalizeSceneNumber(xr.sceneNumber));const hr=new Set;if(!cr.includeCastChanges)for(const xr of lr.castChanges)hr.add(normalizeSceneNumber(xr.sceneNumber));const pr=new Set;if(!cr.includeTimingChanges)for(const xr of lr.timingChanges)pr.add(normalizeSceneNumber(xr.sceneNumber));const mr=buildSceneMap(ar),fr=[];for(const xr of or.days){const Er=[];for(const vr of xr.scenes){const gr=normalizeSceneNumber(vr.sceneNumber);if(dr.has(gr)&&lr.addedScenes.some(_r=>normalizeSceneNumber(_r.sceneNumber)===gr))continue;const yr=mr.get(gr);let br={...vr};hr.has(gr)&&yr&&(br.castNumbers=[...yr.entry.castNumbers]),pr.has(gr)&&yr&&(br.estimatedTime=yr.entry.estimatedTime,br.shootOrder=yr.entry.shootOrder,br.pages=yr.entry.pages),Er.push(br)}if(!cr.includeRemovedScenes){const vr=ar.days.find(gr=>gr.dayNumber===xr.dayNumber);if(vr)for(const gr of vr.scenes){const yr=normalizeSceneNumber(gr.sceneNumber);or.days.some(br=>br.scenes.some(_r=>normalizeSceneNumber(_r.sceneNumber)===yr))||Er.push({...gr})}}fr.push({...xr,scenes:Er})}if(!cr.includeRemovedScenes)for(const xr of ar.days)or.days.some(Er=>Er.dayNumber===xr.dayNumber)||fr.push({...xr,scenes:[...xr.scenes]});return fr.sort((xr,Er)=>xr.dayNumber-Er.dayNumber),{...or,days:fr,status:or.status,castList:mergecastLists(ar.castList,or.castList)}}function mergecastLists(ar,or){const lr=[...or],cr=new Set(or.map(ur=>ur.number));for(const ur of ar)cr.has(ur.number)||lr.push(ur);return lr.sort((ur,dr)=>ur.number-dr.number)}const useScheduleStore=create()(persist((ar,or)=>({schedule:null,savedSchedules:{},isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null,pendingSchedule:null,setSchedule:lr=>{ar({schedule:lr,isUploading:!1,uploadError:null})},uploadScheduleStage1:async lr=>{ar({isUploading:!0,uploadError:null});try{console.log("[ScheduleStore] Starting Stage 1 parsing...");const cr=await parseScheduleStage1(lr);console.log("[ScheduleStore] Stage 1 complete:",{castCount:cr.schedule.castList.length,totalDays:cr.schedule.totalDays,productionName:cr.schedule.productionName});const ur={...cr.schedule,status:"pending"};return ar({schedule:ur,isUploading:!1}),ur}catch(cr){const ur=cr instanceof Error?cr.message:"Failed to parse schedule";throw console.error("[ScheduleStore] Stage 1 failed:",cr),ar({isUploading:!1,uploadError:ur}),cr}},uploadRevisionStage1:async lr=>{ar({isUploading:!0,uploadError:null});try{console.log("[ScheduleStore] Starting revision Stage 1 parsing...");const ur={...(await parseScheduleStage1(lr)).schedule,status:"pending"};return ar({pendingSchedule:ur,isUploading:!1}),ur}catch(cr){const ur=cr instanceof Error?cr.message:"Failed to parse revised schedule";throw console.error("[ScheduleStore] Revision Stage 1 failed:",cr),ar({isUploading:!1,uploadError:ur}),cr}},startRevisionStage2Processing:async()=>{const lr=or();if(!(!lr.pendingSchedule||lr.isProcessingStage2)){ar({isProcessingStage2:!0,stage2Error:null,stage2Progress:{current:0,total:lr.pendingSchedule.totalDays||1}});try{const cr=await processScheduleStage2(lr.pendingSchedule,ur=>{ar({stage2Progress:ur})});ar(ur=>({pendingSchedule:ur.pendingSchedule?{...ur.pendingSchedule,days:cr.days,status:"complete",processingProgress:{current:cr.days.length,total:cr.days.length}}:null,isProcessingStage2:!1,stage2Progress:{current:cr.days.length,total:cr.days.length}})),console.log("[ScheduleStore] Revision Stage 2 complete:",{daysProcessed:cr.days.length,totalScenes:cr.days.reduce((ur,dr)=>ur+dr.scenes.length,0)})}catch(cr){const ur=cr instanceof Error?cr.message:"Failed to process revised schedule";console.error("[ScheduleStore] Revision Stage 2 failed:",cr),ar({isProcessingStage2:!1,stage2Error:ur})}}},compareAmendment:()=>{const lr=or();return!lr.schedule||!lr.pendingSchedule||lr.schedule.days.length===0||lr.pendingSchedule.days.length===0?null:compareScheduleAmendment(lr.schedule,lr.pendingSchedule)},applyAmendment:(lr,cr)=>{const ur=or();if(!ur.schedule||!ur.pendingSchedule)return;const dr=applyScheduleAmendment(ur.schedule,ur.pendingSchedule,lr,cr);ar({schedule:dr,pendingSchedule:null}),console.log("[ScheduleStore] Amendment applied:",{days:dr.days.length,totalScenes:dr.days.reduce((hr,pr)=>hr+pr.scenes.length,0)})},clearPendingSchedule:()=>{ar({pendingSchedule:null})},startStage2Processing:async()=>{const lr=or();if(!(!lr.schedule||lr.isProcessingStage2)){ar({isProcessingStage2:!0,stage2Error:null,stage2Progress:{current:0,total:lr.schedule.totalDays||1}}),ar(cr=>({schedule:cr.schedule?{...cr.schedule,status:"processing"}:null}));try{const cr=await processScheduleStage2(lr.schedule,ur=>{ar({stage2Progress:ur})});ar(ur=>({schedule:ur.schedule?{...ur.schedule,days:cr.days,status:"complete",processingProgress:{current:cr.days.length,total:cr.days.length}}:null,isProcessingStage2:!1,stage2Progress:{current:cr.days.length,total:cr.days.length}})),console.log("[ScheduleStore] Stage 2 complete:",{daysProcessed:cr.days.length,totalScenes:cr.days.reduce((ur,dr)=>ur+dr.scenes.length,0)})}catch(cr){const ur=cr instanceof Error?cr.message:"Failed to process schedule";console.error("[ScheduleStore] Stage 2 failed:",cr),ar({isProcessingStage2:!1,stage2Error:ur,schedule:or().schedule?{...or().schedule,status:"partial",processingError:ur}:null})}}},updateDayData:(lr,cr)=>{ar(ur=>{if(!ur.schedule)return ur;const dr=ur.schedule.days.findIndex(pr=>pr.dayNumber===lr),hr=[...ur.schedule.days];return dr>=0?hr[dr]=cr:(hr.push(cr),hr.sort((pr,mr)=>pr.dayNumber-mr.dayNumber)),{schedule:{...ur.schedule,days:hr}}})},clearSchedule:()=>{ar({schedule:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null})},getCastMemberByNumber:lr=>{const cr=or().schedule;return cr&&cr.castList.find(ur=>ur.number===lr)||null},getCastMemberByName:lr=>{const cr=or().schedule;if(!cr)return null;const ur=lr.toUpperCase().trim();return cr.castList.find(dr=>dr.name.toUpperCase().includes(ur)||dr.character&&dr.character.toUpperCase().includes(ur))||null},getCastNamesForNumbers:lr=>{const cr=or().schedule;return cr?lr.map(ur=>{const dr=cr.castList.find(hr=>hr.number===ur);return dr?dr.character||dr.name:`Cast #${ur}`}):[]},getScenesForShootingDay:lr=>{const cr=or().schedule;return cr&&cr.days.find(ur=>ur.dayNumber===lr)||null},getShootingDayForScene:lr=>{const cr=or().schedule;if(!cr)return null;const ur=lr.replace(/\s+/g,"").toUpperCase();for(const dr of cr.days)for(const hr of dr.scenes)if(hr.sceneNumber.replace(/\s+/g,"").toUpperCase()===ur)return dr.dayNumber;return null},saveScheduleForProject:lr=>{or().schedule&&ar(ur=>({savedSchedules:{...ur.savedSchedules,[lr]:{schedule:ur.schedule}},schedule:null,isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null}))},restoreScheduleForProject:lr=>{const cr=or(),ur=cr.savedSchedules[lr];if(!ur)return!1;const dr={...cr.savedSchedules};return delete dr[lr],ar({schedule:ur.schedule,savedSchedules:dr,isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null}),!0},hasSavedSchedule:lr=>!!or().savedSchedules[lr],clearScheduleForProject:()=>{ar({schedule:null,isUploading:!1,uploadError:null,isProcessingStage2:!1,stage2Progress:{current:0,total:0},stage2Error:null})}}),{name:"hair-makeup-schedule",storage:createHybridStorage("hair-makeup-schedule"),partialize:ar=>({schedule:ar.schedule,savedSchedules:ar.savedSchedules})}));pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;function debugLog(...ar){console.log("[CallSheetParser]",...ar)}async function extractTextFromPDF$1(ar){const or=await ar.arrayBuffer(),lr=await pdfExports.getDocument({data:or}).promise;let cr="";for(let ur=1;ur<=lr.numPages;ur++){const pr=(await(await lr.getPage(ur)).getTextContent()).items.map(mr=>mr.str).join(" ");cr+=pr+`
`}return cr}async function parseCallSheetText(ar,or){var ur,dr,hr;const lr=`You are an expert at parsing film/TV production call sheets. Your job is to extract structured data from call sheet text that has been extracted from a PDF.

IMPORTANT: Call sheets vary significantly between productions and ADs. The text extraction may lose table structure, so look for patterns and context clues.

Common patterns to look for:
- Production day: "DAY X" or "DAY X OF Y" or "SHOOT DAY X" or "CALL SHEET X OF Y"
- Dates: Various formats like "MONDAY 24TH NOVEMBER 2025" or "24/11/25"
- Unit call time: "UNIT CALL" or "UNIT CALL TIME" followed by time
- Pre-calls: HMU, COSTUME, ADs, LIGHTING, CAMERA times (often earlier than unit call)
  - May include location like "07:45 @ UB" (at Unit Base)
- Meal times: BREAKFAST, LUNCH with times and possibly locations (HOTBOX, IN HAND, etc.)
- Wrap estimates: "EST. WRAP", "CAMERA WRAP", "WRAP"
- Weather: Temperature (High/Low), conditions, sunrise/sunset times
- Locations: UNIT BASE, LOCATION, LOC 1, LOC 2, CREW PARKING with addresses and What3Words (///word.word.word)
- Scene schedules: Usually in table format with scene numbers, INT/EXT, location, D/N, pages, cast numbers, timings
- Cast information: Actor names, characters, call times, H&MU times, costume times, travel, on-set times

Time formats vary: "0730", "07:30", "7:30 AM", "7.30", "08:00 AM"

Return ONLY valid JSON with no additional text or markdown.`,cr=`Parse this call sheet text and extract ALL available information including locations, weather, and timing details.

CALL SHEET TEXT:
---
${ar.slice(0,15e3)}
---

Return a JSON object with this structure (include only fields that have data in the call sheet):
{
  "date": "YYYY-MM-DD format",
  "productionDay": number,
  "totalProductionDays": number or null,
  "dayType": "e.g., 10 HRS CONTINUOUS WORKING DAY, STANDARD WORKING DAY, SEMI-CONTINUOUS",
  "unitCallTime": "HH:MM 24-hour format",
  "rehearsalsTime": "HH:MM or null (REHEARSALS ON SET FOR)",
  "firstShotTime": "HH:MM or null (TO SHOOT FOR)",
  "preCalls": {
    "ads": "HH:MM or null",
    "hmu": "HH:MM or null",
    "costume": "HH:MM or null",
    "production": "HH:MM or null",
    "lighting": "HH:MM or null",
    "camera": "HH:MM or null",
    "location": "where pre-calls happen e.g., 'Unit Base', 'UB', 'On Set'"
  },
  "breakfastTime": "HH:MM or HH:MM - HH:MM",
  "breakfastLocation": "location description or null",
  "lunchTime": "HH:MM or HH:MM - HH:MM",
  "lunchLocation": "HOTBOX, IN HAND, location name, etc.",
  "cameraWrapEstimate": "HH:MM",
  "wrapEstimate": "HH:MM",
  "weather": {
    "conditions": "Overcast, Sunny, Showers, Mostly Cloudy, Scattered Showers, etc.",
    "tempHigh": number in Celsius,
    "tempLow": number in Celsius,
    "sunrise": "HH:MM",
    "sunset": "HH:MM"
  },
  "unitBase": {
    "name": "Location name",
    "address": "Full street address",
    "what3words": "///word.word.word format if present"
  },
  "shootLocations": [
    {
      "id": "LOC 1 or LOC1 or main",
      "name": "Location name",
      "address": "Full street address",
      "what3words": "///word.word.word format if present"
    }
  ],
  "crewParking": {
    "name": "Parking location name",
    "address": "Address if different from unit base",
    "notes": "Any parking instructions"
  },
  "unitNotes": ["array of important notes from UNIT NOTES section"],
  "scenes": [
    {
      "sceneNumber": "1" or "1A" (string, exactly as shown),
      "locationId": "LOC 1, LOC 2, etc. if shown",
      "setDescription": "The INT/EXT location line ONLY, e.g. 'EXT. FARMHOUSE' or 'INT. FARMHOUSE - KITCHEN'. Do NOT include the scene description here.",
      "action": "REQUIRED: The scene description/log line that describes WHAT HAPPENS in the scene. Examples: 'PETER and GWEN meet the AOKI's', 'PETER tells GWEN to go', 'PETER & GWEN watch the helicopter take off'. This is usually below the location or after a separator. Extract this for EVERY scene.",
      "dayNight": "D" or "N" or "D/N" or "D1" or "D2" or "D11" etc (from D/N column)",
      "pages": "1/8" or "2" or "1 5/8" or "1 2/8" etc (from PAGES column)",
      "cast": ["1", "2", "4"] (cast ID numbers from CAST column, as strings),
      "estimatedTime": "08:20 - 09:00 or 09:20 - 10:30 (from TIMINGS column)",
      "notes": "CRITICAL: Extract ALL notes from the NOTES column, especially HMU (hair/makeup), VFX, SFX, STUNTS notes. Format as 'HMU: description, VFX: description, SFX: description'. These are essential for continuity tracking."
    }
  ],
  "castCalls": [
    {
      "id": "1" (cast number from ID column),
      "name": "ACTOR NAME",
      "character": "CHARACTER NAME or ROLE",
      "status": "SW" or "SWF" or "W" or "WF" etc,
      "pickup": "HH:MM or null",
      "driver": "RW, LW, MINIBUS, etc. or null",
      "callTime": "HH:MM (CALL column)",
      "breakfastTime": "HH:MM (B/FAST column) or null",
      "costumeCall": "HH:MM (COSTUME column) or null",
      "hmuCall": "HH:MM (H&MU column) or null",
      "travelTime": "HH:MM (TRAVEL column) or null",
      "onSetTime": "HH:MM (ON SET column) or null",
      "notes": "any notes for this cast member"
    }
  ],
  "supportingArtists": [
    {
      "id": "SA1 or number",
      "name": "NAME",
      "designation": "Role description",
      "callTime": "HH:MM"
    }
  ]
}

IMPORTANT:
- All times should be in 24-hour HH:MM format (convert "0730" to "07:30", "8:00 AM" to "08:00")
- Scene numbers should be extracted exactly as shown (may be numeric or alphanumeric like "4A", "18B")
- Extract What3Words addresses - they look like "///word.word.word" or "W3W - ///word.word.word"
- Look for LOCATION: and UNIT BASE: lines for address information
- Camera wrap and estimated wrap are often separate times
- Pre-calls may be listed as "PRE-CALLS" or "PRE CALLS" with department times
- Extract weather including conditions like "Overcast with Scattered Showers"
- If a field has no data, omit it or use null
- CRITICAL: Only extract scenes for the CURRENT shooting day. Do NOT include scenes from "ADVANCE SCHEDULE", "ADVANCE", "NEXT DAYS", or any section showing future production days. These appear at the end of call sheets and show upcoming days - ignore them completely.

SCENE DATA EXTRACTION (VERY IMPORTANT):
- The "SET & DESCRIPTION" column typically has TWO parts per scene:
  1. setDescription = The INT/EXT location line ONLY (e.g., "EXT. FARMHOUSE", "INT. FARMHOUSE - KITCHEN")
  2. action = The scene description/log line that describes WHAT HAPPENS (e.g., "PETER and GWEN meet the AOKI's", "PETER tells GWEN to go")
- CRITICAL: The "action" field MUST contain the description of what happens in the scene, NOT the location
- If the description appears on a separate line below the location, that is the "action"
- If the description appears after a dash or colon after the location, extract it as the "action"
- Examples of action: "PETER and GWEN watch the helicopter take off", "PETER tells GWEN to go", "PETER & GWEN make the poison, the house rocks"
- ALWAYS extract cast numbers from the CAST column (e.g., "1, 2, 9, 10, 14")
- ALWAYS extract notes from NOTES column, especially HMU (hair/makeup), VFX, SFX notes
- ALWAYS extract page counts and timings when available`;try{debugLog("Starting AI call sheet parsing..."),debugLog("Text length:",ar.length,"characters");const pr=await callAI(cr,{system:lr,maxTokens:8e3});debugLog("AI response received, length:",pr.length);const mr=pr.match(/\{[\s\S]*\}/);if(!mr)throw console.error("No JSON found in AI response:",pr),debugLog("ERROR: No JSON found in AI response"),new Error("Failed to parse call sheet - invalid AI response");const fr=JSON.parse(mr[0]);if(debugLog("JSON parsed successfully"),debugLog("Scenes extracted:",((ur=fr.scenes)==null?void 0:ur.length)||0),debugLog("Cast calls extracted:",((dr=fr.castCalls)==null?void 0:dr.length)||0),((hr=fr.scenes)==null?void 0:hr.length)>0){const Sr=fr.scenes[0];debugLog("Sample scene:",{sceneNumber:Sr.sceneNumber,setDescription:Sr.setDescription,action:Sr.action,cast:Sr.cast,estimatedTime:Sr.estimatedTime,pages:Sr.pages})}const Er=(fr.scenes||[]).filter(Sr=>{const Tr=(Sr.notes||"").toLowerCase();return!(Tr.includes("advance schedule")||Tr.includes("advance day")||Sr.productionDay&&fr.productionDay&&Sr.productionDay!==fr.productionDay)}).map((Sr,Tr)=>({sceneNumber:String(Sr.sceneNumber||Tr+1),location:Sr.locationId||Sr.location||void 0,setDescription:Sr.setDescription||"Unknown Scene",action:Sr.action||void 0,dayNight:Sr.dayNight||"D",pages:Sr.pages||void 0,cast:Array.isArray(Sr.cast)?Sr.cast.map(String):[],notes:Sr.notes||void 0,estimatedTime:Sr.estimatedTime||void 0,startTime:Sr.startTime||void 0,endTime:Sr.endTime||void 0,shootOrder:Tr+1,status:"upcoming"})),vr=(fr.castCalls||[]).map(Sr=>({id:String(Sr.id||""),name:Sr.name||"",character:Sr.character||"",status:Sr.status||"W",pickup:Sr.pickup||void 0,driver:Sr.driver||void 0,callTime:Sr.callTime||"",makeupCall:Sr.makeupCall||Sr.breakfastTime||void 0,costumeCall:Sr.costumeCall||void 0,hmuCall:Sr.hmuCall||void 0,travelTime:Sr.travelTime||void 0,onSetTime:Sr.onSetTime||void 0,notes:Sr.notes||void 0})),gr=(fr.supportingArtists||[]).map(Sr=>({id:String(Sr.id||""),name:Sr.name||"",designation:Sr.designation||"",status:Sr.status||"-",callTime:Sr.callTime||"",makeupCall:Sr.makeupCall||void 0,costumeCall:Sr.costumeCall||void 0,hmuCall:Sr.hmuCall||void 0,travelTime:Sr.travelTime||void 0,onSetTime:Sr.onSetTime||void 0,notes:Sr.notes||void 0})),yr=fr.weather?{conditions:fr.weather.conditions||void 0,tempHigh:fr.weather.tempHigh||void 0,tempLow:fr.weather.tempLow||void 0,sunrise:fr.weather.sunrise||void 0,sunset:fr.weather.sunset||void 0}:void 0,br=fr.preCalls?{ads:fr.preCalls.ads||void 0,hmu:fr.preCalls.hmu||void 0,costume:fr.preCalls.costume||void 0,production:fr.preCalls.production||void 0,lighting:fr.preCalls.lighting||void 0,camera:fr.preCalls.camera||void 0,location:fr.preCalls.location||void 0}:void 0,_r=fr.unitBase?{name:fr.unitBase.name||"",address:fr.unitBase.address||void 0,what3words:fr.unitBase.what3words||void 0,notes:fr.unitBase.notes||void 0}:void 0;let jr;if(fr.shootLocation)jr={name:fr.shootLocation.name||"",address:fr.shootLocation.address||void 0,what3words:fr.shootLocation.what3words||void 0,notes:fr.shootLocation.notes||void 0};else if(fr.shootLocations&&fr.shootLocations.length>0){const Sr=fr.shootLocations[0],Tr=fr.shootLocations.slice(1),Rr=Tr.length>0?Tr.map(Nr=>`${Nr.id||""}: ${Nr.name||""} ${Nr.address||""}`).join("; "):void 0;jr={name:Sr.name||Sr.id||"",address:Sr.address||void 0,what3words:Sr.what3words||void 0,notes:Rr||Sr.notes||void 0}}const wr=fr.crewParking?{name:fr.crewParking.name||"Crew Parking",address:fr.crewParking.address||void 0,what3words:fr.crewParking.what3words||void 0,notes:fr.crewParking.notes||void 0}:void 0;return{id:v4(),date:fr.date||new Date().toISOString().split("T")[0],productionDay:fr.productionDay||1,totalProductionDays:fr.totalProductionDays||void 0,dayType:fr.dayType||void 0,unitCallTime:fr.unitCallTime||"06:00",rehearsalsTime:fr.rehearsalsTime||void 0,firstShotTime:fr.firstShotTime||void 0,preCalls:br,breakfastTime:fr.breakfastTime||void 0,lunchTime:fr.lunchTime||void 0,lunchLocation:fr.lunchLocation||fr.breakfastLocation||void 0,cameraWrapEstimate:fr.cameraWrapEstimate||void 0,wrapEstimate:fr.wrapEstimate||void 0,weather:yr,unitBase:_r,shootLocation:jr,crewParking:wr,unitNotes:Array.isArray(fr.unitNotes)?fr.unitNotes:void 0,scenes:Er,castCalls:vr,supportingArtists:gr,uploadedAt:new Date,pdfUri:or,rawText:ar}}catch(pr){return console.error("AI call sheet parsing failed:",pr),debugLog("ERROR: AI parsing failed, falling back to regex parser"),debugLog("Error details:",pr),fallbackParseCallSheetText(ar,or)}}function fallbackParseCallSheetText(ar,or){debugLog("Using FALLBACK regex parser (AI parsing failed)"),debugLog("NOTE: Fallback parser has limited extraction - cast, timing, action fields may be missing");const lr=Pr=>{if(!Pr)return;const Mr=Pr[1].padStart(2,"0"),Br=Pr[2]||"00";return`${Mr}:${Br}`},cr=ar.match(/DAY\s*(\d+)\s*(?:OF\s*(\d+))?/i);let ur=1,dr;cr&&(ur=parseInt(cr[1],10),dr=cr[2]?parseInt(cr[2],10):void 0);const hr=ar.match(/CALL\s*SHEET\s*(\d+)\s*OF\s*(\d+)/i);hr&&!cr&&(ur=parseInt(hr[1],10),dr=parseInt(hr[2],10));let pr=new Date().toISOString().split("T")[0];const mr=ar.match(/(\d{1,2})(?:ST|ND|RD|TH)?\s*(JANUARY|FEBRUARY|MARCH|APRIL|MAY|JUNE|JULY|AUGUST|SEPTEMBER|OCTOBER|NOVEMBER|DECEMBER)\s*(\d{4})/i);if(mr){const Pr={JANUARY:"01",FEBRUARY:"02",MARCH:"03",APRIL:"04",MAY:"05",JUNE:"06",JULY:"07",AUGUST:"08",SEPTEMBER:"09",OCTOBER:"10",NOVEMBER:"11",DECEMBER:"12"},Mr=mr[1].padStart(2,"0"),Br=Pr[mr[2].toUpperCase()]||"01";pr=`${mr[3]}-${Br}-${Mr}`}const fr=ar.match(/UNIT\s*CALL[:\s]*TIME?[:\s]*(\d{1,2})[:\.]?(\d{2})/i),xr=lr(fr)||"06:00",Er=ar.match(/(?:EST\.?\s*)?WRAP[:\s]*(\d{1,2})[:\.]?(\d{2})/i),vr=lr(Er),gr=ar.match(/CAMERA\s*WRAP[:\s]*(\d{1,2})[:\.]?(\d{2})/i),yr=lr(gr),br=ar.match(/BREAKFAST[:\s]*(\d{1,2})[:\.]?(\d{2})/i),_r=lr(br),jr=ar.match(/(?:EST\.?\s*)?LUNCH[:\s]*(\d{1,2})[:\.]?(\d{2})/i),wr=lr(jr);let Sr;const Tr=ar.match(/(?:HIGH|TEMP)[:\s]*(\d+)\s*[]?/i),Rr=ar.match(/LOW[:\s]*(\d+)\s*[]?/i),Nr=ar.match(/(?:SUN\s*)?RISE[S]?[:\s]*(\d{1,2})[:\.]?(\d{2})/i),Cr=ar.match(/(?:SUN\s*)?SET[S]?[:\s]*(\d{1,2})[:\.]?(\d{2})/i),kr=ar.match(/WEATHER[:\s]*([A-Za-z\s,]+?)(?:\s*(?:TEMP|HIGH|LOW|\d))/i);(Tr||Rr||Nr||Cr)&&(Sr={conditions:kr?kr[1].trim():void 0,tempHigh:Tr?parseInt(Tr[1],10):void 0,tempLow:Rr?parseInt(Rr[1],10):void 0,sunrise:lr(Nr),sunset:lr(Cr)});let Ar;const Or=ar.match(/HMU[:\s]*(\d{1,2})[:\.]?(\d{2})/i),Lr=ar.match(/COSTUME[:\s]*(\d{1,2})[:\.]?(\d{2})/i),Fr=ar.match(/ADs?[:\s]*(\d{1,2})[:\.]?(\d{2})/i);(Or||Lr||Fr)&&(Ar={hmu:lr(Or),costume:lr(Lr),ads:lr(Fr)});let Hr;const Kr=ar.match(/(?:LOCATION|UNIT\s*BASE)[:\s]*([^,\n]+(?:,[^,\n]+)*)/i),Gr=ar.match(/(?:W3W|what3words)[:\s-]*\/\/\/([a-z]+\.[a-z]+\.[a-z]+)/i);Kr&&(Hr={name:Kr[1].trim().split(",")[0],address:Kr[1].trim(),what3words:Gr?`///${Gr[1]}`:void 0});const Zr=ar.search(/ADVANCE\s*SCHEDULE/i),Jr=Zr>0?ar.slice(0,Zr):ar,os=[],Ur=/(?:SC|SCENE)?\s*(\d+[A-Z]?)\s+((?:INT|EXT)[.\s/][^D\d]*?)\s*(D\d*|N\d*|D\/N)/gi;let Vr,es=1;for(;(Vr=Ur.exec(Jr))!==null;)os.push({sceneNumber:Vr[1],setDescription:Vr[2].trim(),dayNight:Vr[3],shootOrder:es++,status:"upcoming"});const Ir=[],Dr=ar.match(/CAST\s*INFORMATION[^]*?(?=MINIBUS|TRANSPORT|DEPARTURE|ADVANCE|$)/i);if(Dr){const Pr=Dr[0];debugLog("Found CAST INFORMATION section, length:",Pr.length);const Mr=/\b(\d{1,2})\s+([A-Z][A-Z\s.'-]+?)\s+([A-Z][A-Z\s'-]+?)\s+(SW?F?|W|WF|H|T|R|SWF?)\s+/gi;let Br;for(;(Br=Mr.exec(Pr))!==null;){const Xr=Br[1],Wr=Br[2].trim(),ss=Br[3].trim(),ds=Br[4];if(Wr==="NAME"||Wr==="ID"||ss==="ROLE"||ss==="CHARACTER")continue;const ns=Pr.slice(Br.index+Br[0].length,Br.index+200),fs=/(\d{1,2}:\d{2})/g,bs=ns.match(fs)||[];Ir.push({id:Xr,name:Wr,character:ss,status:ds,callTime:bs[0]||"",makeupCall:bs[1]||void 0,costumeCall:bs[2]||void 0,hmuCall:bs[3]||void 0,onSetTime:bs[4]||void 0})}debugLog("Extracted cast calls:",Ir.length),Ir.length>0&&debugLog("Sample cast call:",Ir[0])}return os.forEach((Pr,Mr)=>{const Br=Jr.indexOf(Pr.sceneNumber);if(Br>=0){const Wr=Jr.slice(Br,Br+500).match(/(?:CAST|cast)?[:\s]*(\d+(?:\s*,\s*\d+)+)/);if(Wr){const ss=Wr[1].split(/\s*,\s*/).map(ds=>ds.trim());os[Mr]={...Pr,cast:ss},debugLog(`Scene ${Pr.sceneNumber} cast:`,ss)}}}),{id:v4(),date:pr,productionDay:ur,totalProductionDays:dr,unitCallTime:xr,breakfastTime:_r,lunchTime:wr,cameraWrapEstimate:yr,wrapEstimate:vr,weather:Sr,preCalls:Ar,unitBase:Hr,scenes:os,castCalls:Ir,supportingArtists:[],uploadedAt:new Date,pdfUri:or,rawText:ar}}async function parseCallSheetPDF(ar){const or=await new Promise(cr=>{const ur=new FileReader;ur.onload=()=>cr(ur.result),ur.readAsDataURL(ar)}),lr=await extractTextFromPDF$1(ar);return parseCallSheetText(lr,or)}const BETA_MODE=!0,TIER_FEATURES={trainee:{maxProjects:3,maxArchivedProjects:1,maxPhotosPerProject:50,canCreateProjects:!1,offlineMode:!1,exportReports:!1,personalTemplates:!1,teamManagement:!1,characterProgressionTracking:!1,shootingScheduleView:!1,teamPhotoStorage:!1,desktopWebAccess:!1,preProductionBreakdown:!1,characterDesignDocs:!1,exportProductionBooks:!1,budgetSchedulingTools:!1},artist:{maxProjects:10,maxArchivedProjects:-1,maxPhotosPerProject:500,canCreateProjects:!1,offlineMode:!0,exportReports:!0,personalTemplates:!0,teamManagement:!1,characterProgressionTracking:!1,shootingScheduleView:!1,teamPhotoStorage:!1,desktopWebAccess:!1,preProductionBreakdown:!1,characterDesignDocs:!1,exportProductionBooks:!1,budgetSchedulingTools:!1},supervisor:{maxProjects:25,maxArchivedProjects:15,maxPhotosPerProject:1e3,canCreateProjects:!0,offlineMode:!0,exportReports:!0,personalTemplates:!0,teamManagement:!0,characterProgressionTracking:!0,shootingScheduleView:!0,teamPhotoStorage:!1,desktopWebAccess:!1,preProductionBreakdown:!1,characterDesignDocs:!1,exportProductionBooks:!1,budgetSchedulingTools:!1},designer:{maxProjects:-1,maxArchivedProjects:-1,maxPhotosPerProject:-1,canCreateProjects:!0,offlineMode:!0,exportReports:!0,personalTemplates:!0,teamManagement:!0,characterProgressionTracking:!0,shootingScheduleView:!0,teamPhotoStorage:!0,desktopWebAccess:!0,preProductionBreakdown:!0,characterDesignDocs:!0,exportProductionBooks:!0,budgetSchedulingTools:!0}},TIER_PRICING={trainee:{monthly:0,yearly:0,currency:"GBP",currencySymbol:""},artist:{monthly:4.99,yearly:47.9,currency:"GBP",currencySymbol:""},supervisor:{monthly:9.99,yearly:95.9,currency:"GBP",currencySymbol:""},designer:{monthly:29.99,yearly:287.9,perProject:49,currency:"GBP",currencySymbol:""}},SUBSCRIPTION_TIERS=[{id:"trainee",name:"TRAINEE",displayName:"Trainee",description:"Perfect for students and emerging artists",pricing:TIER_PRICING.trainee,features:TIER_FEATURES.trainee,featureList:["Multiple projects simultaneously","50 photos per project","View breakdowns & scenes","Add continuity notes","1 archived project"]},{id:"artist",name:"ARTIST",displayName:"Artist",description:"For working floor artists",pricing:TIER_PRICING.artist,features:TIER_FEATURES.artist,featureList:["Everything in Trainee","500 photos per project","Offline mode with full sync","Export continuity reports (PDF)","Personal templates between projects","Unlimited project archive"],isPopular:!0},{id:"supervisor",name:"SUPERVISOR",displayName:"Supervisor",description:"For supervisors and key artists",pricing:TIER_PRICING.supervisor,features:TIER_FEATURES.supervisor,featureList:["Everything in Artist","1000 photos per project","Create & manage projects","Generate team invite codes","Team management","Character progression tracking","Shooting schedule view"]},{id:"designer",name:"DESIGNER",displayName:"Designer",description:"The complete package for HODs and designers",pricing:TIER_PRICING.designer,features:TIER_FEATURES.designer,featureList:["Everything in Supervisor","Unlimited photo storage","Team photo storage included","Full desktop web access","Pre-production script breakdown","Character design documentation","Export full production books","Budget & scheduling tools"],isPremium:!0}],formatMonthlyEquivalent=(ar,or="")=>{const lr=ar/12;return`${or}${lr.toFixed(2)}`},isTierHigher=(ar,or)=>{const lr=["trainee","artist","supervisor","designer"];return lr.indexOf(ar)>lr.indexOf(or)},getDowngradeWarnings=(ar,or)=>{const lr=TIER_FEATURES[ar],cr=TIER_FEATURES[or],ur=[];if(lr.offlineMode&&!cr.offlineMode&&ur.push("Offline mode with full sync"),lr.exportReports&&!cr.exportReports&&ur.push("Export continuity reports"),lr.personalTemplates&&!cr.personalTemplates&&ur.push("Personal templates"),lr.teamManagement&&!cr.teamManagement&&ur.push("Team management"),lr.canCreateProjects&&!cr.canCreateProjects&&ur.push("Create & manage projects"),lr.characterProgressionTracking&&!cr.characterProgressionTracking&&ur.push("Character progression tracking"),lr.shootingScheduleView&&!cr.shootingScheduleView&&ur.push("Shooting schedule view"),lr.teamPhotoStorage&&!cr.teamPhotoStorage&&ur.push("Team photo storage"),lr.desktopWebAccess&&!cr.desktopWebAccess&&ur.push("Desktop web access"),lr.preProductionBreakdown&&!cr.preProductionBreakdown&&ur.push("Pre-production script breakdown"),lr.characterDesignDocs&&!cr.characterDesignDocs&&ur.push("Character design documentation"),lr.exportProductionBooks&&!cr.exportProductionBooks&&ur.push("Export production books"),lr.budgetSchedulingTools&&!cr.budgetSchedulingTools&&ur.push("Budget & scheduling tools"),lr.maxPhotosPerProject>cr.maxPhotosPerProject){const dr=lr.maxPhotosPerProject===-1?"Unlimited":lr.maxPhotosPerProject,hr=cr.maxPhotosPerProject===-1?"Unlimited":cr.maxPhotosPerProject;ur.push(`Photo limit reduced from ${dr} to ${hr} per project`)}return ur},createDefaultSubscription=()=>({tier:"designer",status:"active",billingPeriod:null}),createEmptyCastProfile=ar=>({id:`cast-${ar}`,characterId:ar,actorName:"",phone:"",email:"",agentName:"",agentPhone:"",agentEmail:"",allergies:"",specialRequirements:"",skinType:"",notes:""}),HAIR_TYPES=["Natural","Wig","Hair Pieces","Extensions"],WIG_TYPES=["Lace Front","Full Lace","Hard Front","U-Part","Closure"],WIG_ATTACHMENTS=["Glue","Tape","Pins","Combs","Clips","Elastic"],HAIRLINE_STYLES=["Natural","Laid","Concealed","Bleached Knots"],SFX_TYPES=["Prosthetics","Wounds","Scars","Tattoos","Aging","Bald Cap","Contact Lenses","Teeth","Body Paint"],BLOOD_TYPES=["Fresh","Dried","Arterial","Mouth Blood","Bruising"],ALL_NAV_ITEMS=[{id:"today",label:"Today",iconName:"calendar"},{id:"breakdown",label:"Breakdown",iconName:"grid"},{id:"lookbook",label:"Lookbook",iconName:"book"},{id:"hours",label:"Hours",iconName:"clock"},{id:"budget",label:"Budget",iconName:"wallet"},{id:"script",label:"Script",iconName:"document"},{id:"schedule",label:"Schedule",iconName:"schedule"},{id:"callsheets",label:"Call Sheets",iconName:"clipboard"},{id:"settings",label:"Settings",iconName:"cog"}],DEFAULT_BOTTOM_NAV=["today","breakdown","hours"],SCENE_FILMING_STATUS_CONFIG={"not-filmed":{label:"Incomplete",shortLabel:"Incomplete",bgClass:"bg-red-100",textClass:"text-red-600",borderClass:"border-red-400",color:"#dc2626",glassOverlay:"rgba(239, 68, 68, 0.15)"},partial:{label:"Part Complete",shortLabel:"Part Complete",bgClass:"bg-amber-100",textClass:"text-amber-600",borderClass:"border-amber-400",color:"#d97706",glassOverlay:"rgba(245, 158, 11, 0.15)"},complete:{label:"Complete",shortLabel:"Complete",bgClass:"bg-green-100",textClass:"text-green-600",borderClass:"border-green-400",color:"#16a34a",glassOverlay:"rgba(34, 197, 94, 0.15)"}},createEmptyMakeupDetails=()=>({foundation:"",coverage:"",concealer:"",concealerPlacement:"",contour:"",contourPlacement:"",highlight:"",highlightPlacement:"",blush:"",blushPlacement:"",browProduct:"",browShape:"",eyePrimer:"",lidColour:"",creaseColour:"",outerV:"",liner:"",lashes:"",lipLiner:"",lipColour:"",setting:""}),createEmptyHairDetails=()=>({style:"",products:"",parting:"",piecesOut:"",pins:"",accessories:"",hairType:"Natural",wigNameId:"",wigType:"",wigCapMethod:"",wigAttachment:[],hairline:"",laceTint:"",edgesBabyHairs:""}),createEmptySFXDetails=()=>({sfxRequired:!1,sfxTypes:[],prostheticPieces:"",prostheticAdhesive:"",bloodTypes:[],bloodProducts:"",bloodPlacement:"",tattooCoverage:"",temporaryTattoos:"",contactLenses:"",teeth:"",agingCharacterNotes:"",sfxApplicationTime:null,sfxReferencePhotos:[]}),createEmptyContinuityFlags=()=>({sweat:!1,dishevelled:!1,blood:!1,dirt:!1,wetHair:!1,tears:!1}),STAGE_SUGGESTIONS=["Fresh","Day 1 Healing","Day 2 Healing","Day 3 Healing","Scabbed","Scarring","Healed","Faded"],CONTINUITY_EVENT_TYPES=["Wound","Bruise","Prosthetic","Scar","Tattoo","Other"],countFilledFields=ar=>Object.entries(ar).filter(([or,lr])=>or==="hairType"||or==="sfxRequired"?!1:Array.isArray(lr)?lr.length>0:typeof lr=="number"?lr>0:lr===null||typeof lr=="boolean"?!1:typeof lr=="string"?lr.trim()!=="":!1).length,countHairFields=ar=>{const or=["style","products","parting","piecesOut","pins","accessories"],lr=["wigNameId","wigType","wigCapMethod","wigAttachment","hairline","laceTint","edgesBabyHairs"];let cr=0;return or.forEach(ur=>{const dr=ar[ur];typeof dr=="string"&&dr.trim()!==""&&cr++}),ar.hairType!=="Natural"&&lr.forEach(ur=>{const dr=ar[ur];(Array.isArray(dr)&&dr.length>0||typeof dr=="string"&&dr.trim()!=="")&&cr++}),cr},countSFXFields=ar=>{if(!ar.sfxRequired)return 0;let or=0;return ar.sfxTypes.length>0&&or++,ar.prostheticPieces.trim()!==""&&or++,ar.prostheticAdhesive.trim()!==""&&or++,ar.bloodTypes.length>0&&or++,ar.bloodProducts.trim()!==""&&or++,ar.bloodPlacement.trim()!==""&&or++,ar.tattooCoverage.trim()!==""&&or++,ar.temporaryTattoos.trim()!==""&&or++,ar.contactLenses.trim()!==""&&or++,ar.teeth.trim()!==""&&or++,ar.agingCharacterNotes.trim()!==""&&or++,ar.sfxApplicationTime!==null&&ar.sfxApplicationTime>0&&or++,ar.sfxReferencePhotos.length>0&&or++,or},DAY_TYPE_LABELS={SWD:"Standard Working Day",CWD:"Continuous Working Day",SCWD:"Semi-Continuous Working Day"};function parseDayTypeFromString(ar){if(!ar)return"SWD";const or=ar.toUpperCase();return or.includes("SEMI-CONTINUOUS")||or.includes("SEMI CONTINUOUS")||or.includes("SCWD")||or.includes("SHORT CONTINUOUS")?"SCWD":or.includes("CONTINUOUS")||or.includes("CWD")?"CWD":"SWD"}const getLunchDurationForDayType=ar=>{switch(ar){case"SWD":return 60;case"SCWD":return 30;case"CWD":return 0;default:return 60}},createDefaultRateCard=()=>({dailyRate:0,baseDayHours:11,baseContract:"11+1",dayType:"SWD",otMultiplier:1.5,lateNightMultiplier:2,preCallMultiplier:1.5,sixthDayMultiplier:1.5,seventhDayMultiplier:2,kitRental:0,lunchDuration:60}),createEmptyTimesheetEntry=ar=>({id:`entry-${ar}`,date:ar,dayType:"SWD",preCall:"",unitCall:"",lunchStart:"",lunchEnd:"",outOfChair:"",wrapOut:"",lunchTaken:60,isSixthDay:!1,isSeventhDay:!1,notes:"",status:"draft"}),CURRENCIES=[{code:"GBP",symbol:"",name:"British Pound",locale:"en-GB"},{code:"USD",symbol:"$",name:"US Dollar",locale:"en-US"},{code:"EUR",symbol:"",name:"Euro",locale:"de-DE"},{code:"CAD",symbol:"C$",name:"Canadian Dollar",locale:"en-CA"},{code:"AUD",symbol:"A$",name:"Australian Dollar",locale:"en-AU"}],DEFAULT_CURRENCY="GBP",getCurrencyByCode=ar=>CURRENCIES.find(or=>or.code===ar)||CURRENCIES[0],formatCurrency=(ar,or=DEFAULT_CURRENCY)=>`${getCurrencyByCode(or).symbol}${ar.toFixed(2)}`,createEmptyBillingDetails=()=>({fullName:"",businessName:"",address:"",phone:"",email:"",bankDetails:{accountName:"",sortCode:"",accountNumber:""},paymentTerms:"Payment within 30 days",vatSettings:{isVATRegistered:!1,vatNumber:"",vatRate:20}}),calculateInvoiceWithVAT=(ar,or)=>{const lr=or.isVATRegistered,cr=or.vatRate,ur=lr?ar*(cr/100):0,dr=ar+ur;return{subtotal:ar,vatAmount:ur,total:dr,isVATApplicable:lr,vatRate:cr}},createEmptyProductionInvoicingDetails=()=>({productionCompany:"",productionAddress:"",productionPhone:"",productionEmail:"",accountsPayableContact:"",accountsPayableEmail:"",accountsPayablePhone:"",poNumber:"",costCode:"",jobReference:"",invoiceAddressDifferent:!1,invoiceAddress:"",invoiceNotes:""}),EXPORT_DOCUMENTS=[{id:"continuity_bible",name:"Continuity Bible",description:"Complete reference document - all characters, all looks, all scenes with photos",format:"pdf",selected:!0},{id:"scene_breakdown",name:"Scene Breakdown",description:"Spreadsheet of all scenes with H&MU details per character",format:"csv",selected:!0},{id:"character_lookbooks",name:"Character Lookbooks",description:"Individual PDFs per character with all their looks",format:"pdf_zip",selected:!0},{id:"photo_archive",name:"Photo Archive",description:"All captured photos organized by character/scene",format:"zip",selected:!0},{id:"timesheets",name:"Timesheets",description:"All logged hours for the production",format:"pdf",selected:!0},{id:"invoice_summary",name:"Invoice Summary",description:"Total hours, rates, kit rental for invoicing",format:"pdf",selected:!1}],PROJECT_RETENTION_DAYS=90,REMINDER_INTERVAL_DAYS=7,INACTIVITY_TRIGGER_DAYS=30,createDefaultLifecycle=()=>({state:"active",lastActivityAt:new Date}),calculateDaysUntilDeletion=ar=>{const or=new Date,lr=new Date(ar);lr.setDate(lr.getDate()+PROJECT_RETENTION_DAYS);const cr=lr.getTime()-or.getTime();return Math.max(0,Math.ceil(cr/(1e3*60*60*24)))},PRODUCTION_TYPES=[{value:"film",label:"Film"},{value:"tv_series",label:"TV Series"},{value:"short_film",label:"Short Film"},{value:"commercial",label:"Commercial"},{value:"music_video",label:"Music Video"},{value:"other",label:"Other"}],PROJECT_CODE_CHARS="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",PROJECT_CODE_LETTER_COUNT=24,generateProjectCode=()=>{let ar="";for(let or=0;or<3;or++)ar+=PROJECT_CODE_CHARS.charAt(Math.floor(Math.random()*PROJECT_CODE_LETTER_COUNT));ar+="-";for(let or=0;or<4;or++)ar+=PROJECT_CODE_CHARS.charAt(Math.floor(Math.random()*PROJECT_CODE_CHARS.length));return ar},isValidProjectCode=ar=>/^[ABCDEFGHJKLMNPQRSTUVWXYZ23456789]{3}-[ABCDEFGHJKLMNPQRSTUVWXYZ23456789]{4}$/.test(ar.toUpperCase()),formatProjectCode=ar=>{const or=ar.toUpperCase().replace(/[^ABCDEFGHJKLMNPQRSTUVWXYZ23456789]/g,"");return or.length<=3?or:or.slice(0,3)+"-"+or.slice(3,7)},TIER_LIMITS={trainee:{maxProjects:3,maxArchivedProjects:1,canCreateProjects:!1},artist:{maxProjects:10,maxArchivedProjects:-1,canCreateProjects:!1},supervisor:{maxProjects:25,maxArchivedProjects:15,canCreateProjects:!0},designer:{maxProjects:-1,maxArchivedProjects:-1,canCreateProjects:!0}},shouldTriggerWrap=(ar,or)=>{if(or.state!=="active")return{trigger:!1};if(ar.scenes.length>0&&ar.scenes.every(hr=>hr.isComplete))return{trigger:!0,reason:"all_scenes_complete"};const cr=new Date,ur=new Date(or.lastActivityAt);return Math.floor((cr.getTime()-ur.getTime())/(1e3*60*60*24))>=INACTIVITY_TRIGGER_DAYS?{trigger:!0,reason:"inactivity"}:{trigger:!1}},TEAM_MEMBER_ROLES=[{value:"designer",label:"Designer (HoD)",level:8},{value:"supervisor",label:"Supervisor",level:7},{value:"key",label:"Key Artist",level:6},{value:"hair",label:"Hair Artist",level:5},{value:"makeup",label:"Makeup Artist",level:4},{value:"sfx",label:"Special Effects Artist",level:3},{value:"daily",label:"Daily",level:2},{value:"trainee",label:"Trainee",level:1}],getTeamMemberRoleLabel=ar=>{var or;return((or=TEAM_MEMBER_ROLES.find(lr=>lr.value===ar))==null?void 0:or.label)||ar},PERMISSION_LEVELS=[{value:"all",label:"All team members"},{value:"key_plus",label:"Key artists and above"},{value:"supervisor_plus",label:"Supervisors only"}],groupTeamMembersByRole=ar=>{const or=new Map;return TEAM_MEMBER_ROLES.forEach(lr=>{or.set(lr.value,[])}),ar.forEach(lr=>{const cr=or.get(lr.role);cr&&cr.push(lr)}),or.forEach(lr=>{lr.sort((cr,ur)=>cr.name.localeCompare(ur.name))}),TEAM_MEMBER_ROLES.filter(lr=>{var cr;return(((cr=or.get(lr.value))==null?void 0:cr.length)||0)>0}).map(lr=>({role:lr.value,label:lr.label+"s",members:or.get(lr.value)||[]}))},canManageProject=(ar,or)=>{if(!or)return!1;if(or.isOwner)return!0;const lr=["designer","supervisor"];return["supervisor","designer"].includes(ar)&&lr.includes(or.role)},createDefaultProjectPermissions=()=>({addPhotos:"all",editNotes:"all",markComplete:"key_plus"}),formatStorageSize=ar=>{if(ar===0)return"0 B";const or=1024,lr=["B","KB","MB","GB","TB"],cr=Math.floor(Math.log(ar)/Math.log(or));return parseFloat((ar/Math.pow(or,cr)).toFixed(1))+" "+lr[cr]};function timeToMinutes(ar){if(!ar)return 0;const[or,lr]=ar.split(":").map(Number);return isNaN(or)||isNaN(lr)?0:or*60+lr}function minutesToTime(ar){const or=(ar%1440+1440)%1440,lr=Math.floor(or/60),cr=or%60;return`${lr.toString().padStart(2,"0")}:${cr.toString().padStart(2,"0")}`}function timeDiffHours(ar,or){if(!ar||!or)return 0;let lr=timeToMinutes(ar),cr=timeToMinutes(or);return cr<lr&&(cr+=24*60),(cr-lr)/60}function addHoursToTime(ar,or){const lr=timeToMinutes(ar)+or*60;return minutesToTime(lr)}const BASE_CONTRACTS={"10+1":{baseWorkHours:10,label:"10+1 (10 hours + 1hr lunch)"},"11+1":{baseWorkHours:11,label:"11+1 (11 hours + 1hr lunch)"}},DAY_TYPES$1={SWD:{name:"Standard Working Day",lunchMins:60,hourReduction:0},SCWD:{name:"Semi-Continuous Working Day",lunchMins:30,hourReduction:.5},CWD:{name:"Continuous Working Day",lunchMins:0,hourReduction:1}};function getContractedWorkHours(ar,or){const lr=BASE_CONTRACTS[ar].baseWorkHours,cr=DAY_TYPES$1[or].hourReduction;return lr-cr}function getLunchDuration(ar){return DAY_TYPES$1[ar].lunchMins}function getHourlyRate(ar,or,lr){const cr=getContractedWorkHours(or,lr);return cr<=0?0:ar/cr}function calculatePreCall(ar,or,lr,cr=1.5){if(!ar||!or)return{hours:0,pay:0};const ur=timeDiffHours(ar,or);return ur<=0?{hours:0,pay:0}:{hours:ur,pay:ur*(lr*cr)}}function calculateOvertime(ar,or,lr,cr=1.5){const ur=Math.max(0,ar-or),dr=lr*cr;return{hours:ur,pay:ur*dr}}function calculateBrokenLunch(ar,or,lr,cr,ur=1.5){if(lr==="CWD"||!or||!ar)return{hours:0,pay:0};const dr=addHoursToTime(ar,6),hr=timeToMinutes(or),pr=timeToMinutes(dr);if(hr<=pr)return{hours:0,pay:0};const mr=timeDiffHours(dr,or),fr=cr*ur;return{hours:mr,pay:mr*fr}}function calculateBrokenTurnaround(ar,or,lr,cr,ur=1.5,dr=11){if(!ar||!lr)return{hours:0,pay:0};let pr=timeDiffHours(ar,or||lr);if(pr<0&&(pr+=24),pr>=dr)return{hours:0,pay:0};const mr=dr-pr,fr=cr*ur;return{hours:mr,pay:mr*fr}}function calculateLateNight(ar,or,lr,cr,ur,dr=2,hr="23:00"){if(!or||!ar)return{hours:0,pay:0};const pr=timeToMinutes(or),mr=timeToMinutes(hr);let fr=pr;if(pr<timeToMinutes(ar)&&(fr=pr+24*60),fr<=mr&&pr>=timeToMinutes(ar))return{hours:0,pay:0};let xr;fr>mr,xr=fr-mr;let Er=xr/60;if(lr){const gr=timeToMinutes(lr);(gr>mr||gr<timeToMinutes(ar))&&(Er-=cr/60)}Er=Math.max(0,Er);const vr=ur*(dr-1);return{hours:Er,pay:Er*vr}}function applyDayMultiplier(ar,or,lr,cr=1.5,ur=2){return lr?{multiplier:ur,total:ar*ur}:or?{multiplier:cr,total:ar*cr}:{multiplier:1,total:ar}}function calculateBECTUTimesheet(ar){if(!ar.unitCallTime||!ar.wrapOutTime)return createEmptyCalculation$1();const or=getContractedWorkHours(ar.baseContract,ar.dayType),lr=getHourlyRate(ar.dayRate,ar.baseContract,ar.dayType),cr=lr*ar.otMultiplier,ur=ar.preCallTime||ar.unitCallTime,dr=timeDiffHours(ur,ar.wrapOutTime),hr=ar.lunchDuration/60,pr=Math.max(0,dr-hr),mr=calculatePreCall(ar.preCallTime,ar.unitCallTime,lr,ar.preCallMultiplier),fr=timeDiffHours(ar.unitCallTime,ar.wrapOutTime)-hr,xr=calculateOvertime(Math.max(0,fr),or,lr,ar.otMultiplier),Er=calculateBrokenLunch(ar.unitCallTime,ar.lunchTime,ar.dayType,lr,ar.otMultiplier),vr=calculateBrokenTurnaround(ar.previousWrapOut,ar.preCallTime,ar.unitCallTime,lr,ar.otMultiplier),gr=calculateLateNight(ar.unitCallTime,ar.wrapOutTime,ar.lunchTime,ar.lunchDuration,lr,ar.lateNightMultiplier),yr=ar.dayRate,br=yr+mr.pay+xr.pay+Er.pay+vr.pay+gr.pay,_r=applyDayMultiplier(br,ar.is6thDay,ar.is7thDay,ar.sixthDayMultiplier,ar.seventhDayMultiplier);return{contractedHours:round2(or),hourlyRate:round2(lr),otRate:round2(cr),actualWorkHours:round2(pr),preCallHours:round2(mr.hours),overtimeHours:round2(xr.hours),brokenLunchHours:round2(Er.hours),brokenTurnaroundHours:round2(vr.hours),lateNightHours:round2(gr.hours),basePay:round2(yr),preCallPay:round2(mr.pay),overtimePay:round2(xr.pay),brokenLunchPay:round2(Er.pay),brokenTurnaroundPay:round2(vr.pay),lateNightPay:round2(gr.pay),subtotal:round2(br),dayMultiplier:_r.multiplier,totalPay:round2(_r.total),hasBrokenLunch:Er.hours>0,hasBrokenTurnaround:vr.hours>0,hasLateNight:gr.hours>0,hasOvertime:xr.hours>0}}function createEmptyCalculation$1(){return{contractedHours:0,hourlyRate:0,otRate:0,actualWorkHours:0,preCallHours:0,overtimeHours:0,brokenLunchHours:0,brokenTurnaroundHours:0,lateNightHours:0,basePay:0,preCallPay:0,overtimePay:0,brokenLunchPay:0,brokenTurnaroundPay:0,lateNightPay:0,subtotal:0,dayMultiplier:1,totalPay:0,hasBrokenLunch:!1,hasBrokenTurnaround:!1,hasLateNight:!1,hasOvertime:!1}}function round2(ar){return Math.round(ar*100)/100}function baseDayHoursToContract(ar){return ar===10?"10+1":"11+1"}function createEmptyCalculation(){return{contractedHours:0,hourlyRate:0,otRate:0,preCallHours:0,preCallEarnings:0,workingHours:0,actualWorkHours:0,baseHours:0,otHours:0,brokenLunchHours:0,brokenTurnaroundHours:0,lateNightHours:0,totalHours:0,dailyEarnings:0,basePay:0,otEarnings:0,overtimePay:0,brokenLunchPay:0,brokenTurnaroundPay:0,lateNightEarnings:0,lateNightPay:0,sixthDayBonus:0,seventhDayBonus:0,dayMultiplier:1,subtotal:0,kitRental:0,totalEarnings:0,totalPay:0,brokenLunch:!1,hasBrokenLunch:!1,brokenTurnaround:!1,hasBrokenTurnaround:!1,hasLateNight:!1,hasOvertime:!1}}function toBECTUEntry(ar,or,lr){const cr=or.baseContract||baseDayHoursToContract(or.baseDayHours);return{date:ar.date,dayRate:or.dailyRate,baseContract:cr,dayType:ar.dayType,preCallTime:ar.preCall||null,unitCallTime:ar.unitCall,lunchTime:ar.lunchStart||ar.callSheetLunch||null,lunchDuration:ar.lunchTaken||getLunchDuration(ar.dayType),wrapOutTime:ar.wrapOut,is6thDay:ar.isSixthDay,is7thDay:ar.isSeventhDay,previousWrapOut:ar.previousWrapOut||lr||null,preCallMultiplier:or.preCallMultiplier,otMultiplier:or.otMultiplier,lateNightMultiplier:or.lateNightMultiplier,sixthDayMultiplier:or.sixthDayMultiplier,seventhDayMultiplier:or.seventhDayMultiplier}}function formatDateString(ar){return ar.toISOString().split("T")[0]}function addDays(ar,or){const lr=new Date(ar);return lr.setDate(lr.getDate()+or),formatDateString(lr)}function getWeekStart(ar){const or=new Date(ar),lr=or.getDay(),cr=or.getDate()-lr+(lr===0?-6:1);return or.setDate(cr),formatDateString(or)}const useTimesheetStore=create()(persist((ar,or)=>({rateCard:createDefaultRateCard(),entries:{},selectedDate:formatDateString(new Date),viewMode:"week",editingEntry:!1,updateRateCard:lr=>{ar(cr=>({rateCard:{...cr.rateCard,...lr}}))},getEntry:lr=>or().entries[lr]||createEmptyTimesheetEntry(lr),saveEntry:lr=>{ar(cr=>({entries:{...cr.entries,[lr.date]:lr}}))},deleteEntry:lr=>{ar(cr=>{const ur={...cr.entries};return delete ur[lr],{entries:ur}})},clearAll:()=>{ar({rateCard:createDefaultRateCard(),entries:{},selectedDate:formatDateString(new Date),viewMode:"week",editingEntry:!1})},setSelectedDate:lr=>ar({selectedDate:lr}),setViewMode:lr=>ar({viewMode:lr}),setEditingEntry:lr=>ar({editingEntry:lr}),navigateDay:lr=>{const cr=or(),ur=addDays(cr.selectedDate,lr==="next"?1:-1);ar({selectedDate:ur})},autoFillFromCallSheet:(lr,cr)=>{var fr;const ur=or().entries[lr]||createEmptyTimesheetEntry(lr),dr=parseDayTypeFromString(cr.dayType),hr=getLunchDurationForDayType(dr),pr=((fr=cr.preCalls)==null?void 0:fr.hmu)||"";return{...ur,preCall:pr||ur.preCall,unitCall:cr.unitCallTime||ur.unitCall,dayType:dr,wrapOut:ur.wrapOut||"",outOfChair:ur.outOfChair||"",lunchTaken:hr,productionDay:cr.productionDay,autoFilledFrom:cr.id,callSheetUnitCall:cr.unitCallTime,callSheetLunch:cr.lunchTime,callSheetWrap:cr.wrapEstimate}},calculateEntry:(lr,cr)=>{const{rateCard:ur}=or();if(!lr.unitCall||!lr.wrapOut)return createEmptyCalculation();const dr=toBECTUEntry(lr,ur,cr),hr=calculateBECTUTimesheet(dr);let pr=0,mr=0;lr.isSeventhDay?mr=hr.subtotal*(ur.seventhDayMultiplier-1):lr.isSixthDay&&(pr=hr.subtotal*(ur.sixthDayMultiplier-1));const fr=ur.kitRental,xr=hr.totalPay+fr;return{contractedHours:hr.contractedHours,hourlyRate:hr.hourlyRate,otRate:hr.otRate,preCallHours:hr.preCallHours,workingHours:hr.actualWorkHours,actualWorkHours:hr.actualWorkHours,baseHours:hr.contractedHours,otHours:hr.overtimeHours,brokenLunchHours:hr.brokenLunchHours,brokenTurnaroundHours:hr.brokenTurnaroundHours,lateNightHours:hr.lateNightHours,totalHours:hr.actualWorkHours+hr.preCallHours,preCallEarnings:hr.preCallPay,dailyEarnings:hr.basePay,basePay:hr.basePay,otEarnings:hr.overtimePay,overtimePay:hr.overtimePay,brokenLunchPay:hr.brokenLunchPay,brokenTurnaroundPay:hr.brokenTurnaroundPay,lateNightEarnings:hr.lateNightPay,lateNightPay:hr.lateNightPay,sixthDayBonus:Math.round(pr*100)/100,seventhDayBonus:Math.round(mr*100)/100,dayMultiplier:hr.dayMultiplier,subtotal:hr.subtotal,kitRental:fr,totalEarnings:Math.round(xr*100)/100,totalPay:Math.round(xr*100)/100,brokenLunch:hr.hasBrokenLunch,hasBrokenLunch:hr.hasBrokenLunch,brokenTurnaround:hr.hasBrokenTurnaround,hasBrokenTurnaround:hr.hasBrokenTurnaround,hasLateNight:hr.hasLateNight,hasOvertime:hr.hasOvertime}},getPreviousWrapOut:lr=>{const cr=addDays(lr,-1),ur=or().entries[cr];return(ur==null?void 0:ur.wrapOut)||void 0},getWeekSummary:lr=>{const cr=or(),ur=[];for(let Cr=0;Cr<7;Cr++){const kr=addDays(lr,Cr);cr.entries[kr]&&ur.push(cr.entries[kr])}let dr=0,hr=0,pr=0,mr=0,fr=0,xr=0,Er=0,vr=0,gr=0,yr=0,br=0,_r=0,jr=0,wr=0,Sr=0,Tr=0,Rr=0;const Nr=[...ur].sort((Cr,kr)=>Cr.date.localeCompare(kr.date));return Nr.forEach((Cr,kr)=>{const Ar=kr>0?Nr[kr-1].wrapOut:cr.getPreviousWrapOut(Cr.date),Or=cr.calculateEntry(Cr,Ar);dr+=Or.totalHours,hr+=Or.preCallHours,pr+=Or.baseHours,mr+=Or.otHours,fr+=Or.lateNightHours,xr+=Or.brokenLunchHours,Er+=Or.brokenTurnaroundHours,Cr.isSixthDay&&!Cr.isSeventhDay&&(vr+=Or.totalHours),Cr.isSeventhDay&&(gr+=Or.totalHours),yr+=Or.totalEarnings,_r+=Or.basePay,jr+=Or.overtimePay,wr+=Or.preCallEarnings,Sr+=Or.brokenLunchPay,Tr+=Or.brokenTurnaroundPay,Rr+=Or.lateNightPay,Cr.unitCall&&Cr.wrapOut&&(br+=cr.rateCard.kitRental)}),{startDate:lr,endDate:addDays(lr,6),totalHours:Math.round(dr*10)/10,preCallHours:Math.round(hr*10)/10,baseHours:Math.round(pr*10)/10,otHours:Math.round(mr*10)/10,sixthDayHours:Math.round(vr*10)/10,seventhDayHours:Math.round(gr*10)/10,lateNightHours:Math.round(fr*10)/10,brokenLunchHours:Math.round(xr*10)/10,brokenTurnaroundHours:Math.round(Er*10)/10,kitRentalTotal:br,totalEarnings:Math.round(yr*100)/100,entries:ur,basePay:Math.round(_r*100)/100,overtimePay:Math.round(jr*100)/100,preCallPay:Math.round(wr*100)/100,brokenLunchPay:Math.round(Sr*100)/100,brokenTurnaroundPay:Math.round(Tr*100)/100,lateNightPay:Math.round(Rr*100)/100}},getMonthEntries:(lr,cr)=>{const ur=or(),dr=[],hr=new Date(lr,cr,1),pr=new Date(lr,cr+1,0),mr=new Date(hr);for(;mr<=pr;){const fr=formatDateString(mr);ur.entries[fr]&&dr.push(ur.entries[fr]),mr.setDate(mr.getDate()+1)}return dr}}),{name:"hair-makeup-timesheet-storage",storage:createHybridStorage("hair-makeup-timesheet-storage"),merge:(ar,or)=>({...or,...ar,entries:{...or.entries,...(ar==null?void 0:ar.entries)||{}}})})),STORE_VERSION=3;function validateCallSheet(ar){return!ar.id||!ar.date||!Array.isArray(ar.scenes)?!1:ar.scenes.length>50?(console.warn(`Call sheet ${ar.id} has ${ar.scenes.length} scenes - possible data corruption`),!1):!0}const useCallSheetStore=create()(persist((ar,or)=>({callSheets:[],activeCallSheetId:null,savedCallSheets:{},isUploading:!1,uploadError:null,uploadCallSheet:async lr=>{var cr;ar({isUploading:!0,uploadError:null});try{const ur=await parseCallSheetPDF(lr),dr=(cr=useProjectStore.getState().currentProject)==null?void 0:cr.id,hr={...ur,projectId:dr,scenes:[...ur.scenes]},pr=or().callSheets.find(xr=>xr.date===hr.date||xr.productionDay===hr.productionDay),mr=xr=>{if(xr.date){const Er=useTimesheetStore.getState(),vr=Er.autoFillFromCallSheet(xr.date,xr);Er.saveEntry(vr)}},fr=xr=>{const Er=useProjectStore.getState(),vr=Er.currentProject;vr!=null&&vr.scenes&&xr.scenes.forEach(gr=>{if(!gr.action)return;const yr=vr.scenes.find(br=>br.sceneNumber===gr.sceneNumber);yr&&!yr.synopsis&&Er.updateSceneSynopsis(yr.id,gr.action)})};if(pr){const xr={...hr,id:pr.id};return ar(Er=>({callSheets:Er.callSheets.map(vr=>vr.id===pr.id?xr:vr),isUploading:!1,activeCallSheetId:pr.id})),mr(xr),fr(xr),xr}return ar(xr=>({callSheets:[...xr.callSheets,hr].sort((Er,vr)=>Er.productionDay-vr.productionDay),isUploading:!1,activeCallSheetId:hr.id})),mr(hr),fr(hr),hr}catch(ur){const dr=ur instanceof Error?ur.message:"Failed to parse call sheet";throw ar({isUploading:!1,uploadError:dr}),ur}},setActiveCallSheet:lr=>{ar({activeCallSheetId:lr})},getActiveCallSheet:()=>{const lr=or();return lr.activeCallSheetId?lr.callSheets.find(cr=>cr.id===lr.activeCallSheetId)||null:[...lr.callSheets].sort((ur,dr)=>new Date(dr.date).getTime()-new Date(ur.date).getTime())[0]||null},getCallSheetByDate:lr=>or().callSheets.find(cr=>cr.date===lr)||null,getCallSheetByDay:lr=>or().callSheets.find(cr=>cr.productionDay===lr)||null,deleteCallSheet:lr=>{ar(cr=>({callSheets:cr.callSheets.filter(ur=>ur.id!==lr),activeCallSheetId:cr.activeCallSheetId===lr?null:cr.activeCallSheetId}))},updateSceneStatus:(lr,cr,ur)=>{ar(dr=>({callSheets:dr.callSheets.map(hr=>hr.id!==lr?hr:{...hr,scenes:hr.scenes.map(pr=>pr.sceneNumber===cr?{...pr,status:ur,completedAt:ur==="wrapped"?new Date().toISOString():pr.completedAt}:pr)})}))},updateSceneFilmingStatus:(lr,cr,ur,dr)=>{ar(hr=>({callSheets:hr.callSheets.map(pr=>pr.id!==lr?pr:{...pr,scenes:pr.scenes.map(mr=>mr.sceneNumber===cr?{...mr,filmingStatus:ur,filmingNotes:dr,status:"wrapped",completedAt:new Date().toISOString()}:mr)})}))},clearAll:()=>{ar({callSheets:[],activeCallSheetId:null})},saveCallSheetsForProject:lr=>{or().callSheets.length>0?ar(ur=>({savedCallSheets:{...ur.savedCallSheets,[lr]:{callSheets:ur.callSheets,activeCallSheetId:ur.activeCallSheetId}},callSheets:[],activeCallSheetId:null,isUploading:!1,uploadError:null})):ar({callSheets:[],activeCallSheetId:null,isUploading:!1,uploadError:null})},restoreCallSheetsForProject:lr=>{const cr=or(),ur=cr.savedCallSheets[lr];if(!ur)return!1;const dr={...cr.savedCallSheets};return delete dr[lr],ar({callSheets:ur.callSheets,activeCallSheetId:ur.activeCallSheetId,savedCallSheets:dr,isUploading:!1,uploadError:null}),!0},hasSavedCallSheets:lr=>!!or().savedCallSheets[lr],clearCallSheetsForProject:()=>{ar({callSheets:[],activeCallSheetId:null,isUploading:!1,uploadError:null})}}),{name:"hair-makeup-callsheets",version:STORE_VERSION,storage:createHybridStorage("hair-makeup-callsheets"),partialize:ar=>({callSheets:ar.callSheets,activeCallSheetId:ar.activeCallSheetId,savedCallSheets:ar.savedCallSheets}),migrate:(ar,or)=>{const lr=ar;if(or<STORE_VERSION){console.log(`Migrating call sheet store from version ${or} to ${STORE_VERSION}`);const cr=(lr.callSheets||[]).filter(validateCallSheet);return cr.length!==(lr.callSheets||[]).length&&console.warn("Removed corrupted call sheet data during migration"),{callSheets:cr,activeCallSheetId:lr.activeCallSheetId||null,savedCallSheets:lr.savedCallSheets||{},isUploading:!1,uploadError:null}}return lr},merge:(ar,or)=>{const lr=ar,cr=(lr.callSheets||[]).filter(validateCallSheet);return{...or,callSheets:cr,activeCallSheetId:lr.activeCallSheetId||null,savedCallSheets:lr.savedCallSheets||{}}}})),createSceneSlice=(ar,or)=>({addScene:lr=>{const cr={id:v4(),sceneNumber:lr.sceneNumber,slugline:lr.slugline||`Scene ${lr.sceneNumber}`,intExt:lr.intExt||"INT",timeOfDay:lr.timeOfDay||"DAY",synopsis:lr.synopsis,scriptContent:lr.scriptContent,characters:lr.characters||[],isComplete:!1,characterConfirmationStatus:"confirmed",shootingDay:lr.shootingDay};return ar(ur=>{if(!ur.currentProject)return ur;const dr=[...ur.currentProject.scenes,cr].sort((hr,pr)=>{const mr=parseInt(hr.sceneNumber.replace(/\D/g,""))||0,fr=parseInt(pr.sceneNumber.replace(/\D/g,""))||0;return mr!==fr?mr-fr:hr.sceneNumber.localeCompare(pr.sceneNumber)});return{currentProject:{...ur.currentProject,scenes:dr}}}),cr},addCharacterToScene:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,scenes:ur.currentProject.scenes.map(dr=>dr.id===lr&&!dr.characters.includes(cr)?{...dr,characters:[...dr.characters,cr]}:dr)}}:ur)},markSceneComplete:lr=>{ar(cr=>cr.currentProject?{currentProject:{...cr.currentProject,scenes:cr.currentProject.scenes.map(ur=>ur.id===lr?{...ur,isComplete:!0,completedAt:new Date}:ur)}}:cr)},markSceneIncomplete:lr=>{ar(cr=>cr.currentProject?{currentProject:{...cr.currentProject,scenes:cr.currentProject.scenes.map(ur=>ur.id===lr?{...ur,isComplete:!1,completedAt:void 0}:ur)}}:cr)},copyToNextScene:(lr,cr)=>{const ur=or();if(!ur.currentProject)return null;const dr=ur.currentProject.scenes.find(xr=>xr.id===lr);if(!dr)return null;const hr=ur.currentProject.scenes.find(xr=>xr.sceneNumber>dr.sceneNumber&&xr.characters.includes(cr));if(!hr)return null;const pr=ur.sceneCaptures[`${lr}-${cr}`];if(!pr)return hr.id;const mr=`${hr.id}-${cr}`,fr={id:v4(),sceneId:hr.id,characterId:cr,lookId:pr.lookId,capturedAt:new Date,photos:{},additionalPhotos:[],continuityFlags:{...pr.continuityFlags},continuityEvents:pr.continuityEvents.map(xr=>({...xr,id:v4()})),sfxDetails:{...pr.sfxDetails,sfxReferencePhotos:[]},notes:pr.notes,applicationTime:pr.applicationTime};return ar(xr=>({sceneCaptures:{...xr.sceneCaptures,[mr]:fr},currentSceneId:hr.id})),hr.id},updateSceneFilmingStatus:(lr,cr,ur)=>{ar(dr=>dr.currentProject?{currentProject:{...dr.currentProject,scenes:dr.currentProject.scenes.map(hr=>hr.sceneNumber===lr?{...hr,filmingStatus:cr,filmingNotes:ur}:hr)}}:dr)},updateSceneSynopsis:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,scenes:ur.currentProject.scenes.map(dr=>dr.id===lr?{...dr,synopsis:cr}:dr)}}:ur)},updateAllSceneSynopses:lr=>{ar(cr=>{if(!cr.currentProject)return cr;const ur=new Map;return lr.forEach(dr=>{dr.synopsis&&ur.set(dr.id,dr.synopsis)}),{currentProject:{...cr.currentProject,scenes:cr.currentProject.scenes.map(dr=>{const hr=ur.get(dr.id);return hr?{...dr,synopsis:hr}:dr})}}})},getScene:lr=>{var cr;return(cr=or().currentProject)==null?void 0:cr.scenes.find(ur=>ur.id===lr)},getFilteredScenes:()=>{const lr=or();if(!lr.currentProject)return[];let cr=[...lr.currentProject.scenes];if(lr.sceneFilter==="complete"?cr=cr.filter(ur=>ur.isComplete):lr.sceneFilter==="incomplete"&&(cr=cr.filter(ur=>!ur.isComplete)),lr.searchQuery){const ur=lr.searchQuery.toLowerCase();cr=cr.filter(dr=>dr.sceneNumber.toString().includes(ur)||dr.slugline.toLowerCase().includes(ur))}return cr.sort((ur,dr)=>ur.sceneNumber.localeCompare(dr.sceneNumber,void 0,{numeric:!0}))},getScenesForLook:lr=>{const cr=or();if(!cr.currentProject)return[];const ur=cr.currentProject.looks.find(dr=>dr.id===lr);return ur?cr.currentProject.scenes.filter(dr=>ur.scenes.includes(dr.sceneNumber)).sort((dr,hr)=>dr.sceneNumber.localeCompare(hr.sceneNumber,void 0,{numeric:!0})):[]}}),createCaptureSlice=(ar,or)=>({getOrCreateSceneCapture:(lr,cr)=>{var xr,Er,vr;const ur=or(),dr=`${lr}-${cr}`,hr=ur.sceneCaptures[dr];if(hr)return hr;const pr=(Er=(xr=ur.currentProject)==null?void 0:xr.scenes.find(gr=>gr.id===lr))==null?void 0:Er.sceneNumber,mr=(vr=ur.currentProject)==null?void 0:vr.looks.find(gr=>gr.characterId===cr&&pr!==void 0&&gr.scenes.includes(pr)),fr={id:v4(),sceneId:lr,characterId:cr,lookId:(mr==null?void 0:mr.id)??"",capturedAt:new Date,photos:{},additionalPhotos:[],continuityFlags:createEmptyContinuityFlags(),continuityEvents:[],sfxDetails:createEmptySFXDetails(),notes:""};return ar(gr=>({sceneCaptures:{...gr.sceneCaptures,[dr]:fr}})),fr},updateSceneCapture:(lr,cr)=>{ar(ur=>({sceneCaptures:{...ur.sceneCaptures,[lr]:{...ur.sceneCaptures[lr],...cr}}}))},addPhotoToCapture:(lr,cr,ur)=>{ar(dr=>{const hr=dr.sceneCaptures[lr];return hr?ur==="additional"?{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,additionalPhotos:[...hr.additionalPhotos,cr]}}}:{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,photos:{...hr.photos,[ur]:cr}}}}:dr})},removePhotoFromCapture:(lr,cr,ur)=>{ar(dr=>{const hr=dr.sceneCaptures[lr];if(!hr)return dr;if(cr==="additional"&&ur)return{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,additionalPhotos:hr.additionalPhotos.filter(fr=>fr.id!==ur)}}};const pr=cr,mr={...hr.photos};return delete mr[pr],{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,photos:mr}}}})},toggleContinuityFlag:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,continuityFlags:{...dr.continuityFlags,[cr]:!dr.continuityFlags[cr]}}}}:ur})},addContinuityEvent:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,continuityEvents:[...dr.continuityEvents,cr]}}}:ur})},updateContinuityEvent:(lr,cr,ur)=>{ar(dr=>{const hr=dr.sceneCaptures[lr];return hr?{sceneCaptures:{...dr.sceneCaptures,[lr]:{...hr,continuityEvents:hr.continuityEvents.map(pr=>pr.id===cr?{...pr,...ur}:pr)}}}:dr})},removeContinuityEvent:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,continuityEvents:dr.continuityEvents.filter(hr=>hr.id!==cr)}}}:ur})},updateSFXDetails:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,sfxDetails:cr}}}:ur})},addSFXPhoto:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,sfxDetails:{...dr.sfxDetails,sfxReferencePhotos:[...dr.sfxDetails.sfxReferencePhotos,cr]}}}}:ur})},removeSFXPhoto:(lr,cr)=>{ar(ur=>{const dr=ur.sceneCaptures[lr];return dr?{sceneCaptures:{...ur.sceneCaptures,[lr]:{...dr,sfxDetails:{...dr.sfxDetails,sfxReferencePhotos:dr.sfxDetails.sfxReferencePhotos.filter(hr=>hr.id!==cr)}}}}:ur})},getSceneCapture:(lr,cr)=>or().sceneCaptures[`${lr}-${cr}`]}),CHARACTER_COLORS=["#C9A961","#8B5CF6","#EC4899","#10B981","#F59E0B","#EF4444","#3B82F6","#6366F1","#14B8A6","#F97316"];function normalizeNameForMatch(ar){return ar.toUpperCase().replace(/^\d+\.\s*/,"").replace(/[^A-Z\s]/g,"").replace(/\s+/g," ").trim()}function findMatchingCharacter(ar,or){const lr=normalizeNameForMatch(ar);if(!lr)return null;const cr=or.find(dr=>normalizeNameForMatch(dr.name)===lr);return cr||or.find(dr=>{const hr=normalizeNameForMatch(dr.name);return hr.includes(lr)||lr.includes(hr)||hr.split(" ")[0]===lr.split(" ")[0]})||null}function createCharacterFromName(ar,or){const lr=v4(),cr=ar.replace(/^\d+\.\s*/,"").trim(),ur=cr.split(" ").map(hr=>hr[0]).join("").slice(0,2).toUpperCase(),dr=CHARACTER_COLORS[or%CHARACTER_COLORS.length];return{id:lr,name:cr,initials:ur||"??",avatarColour:dr}}function getTimeOrder(ar){const or=ar.toUpperCase().trim();return or.includes("MORN")||or==="DAWN"||or==="SUNRISE"?0:or.includes("DAY")||or==="D"||or.includes("AFTERNOON")?1:or.includes("EVEN")||or==="DUSK"||or==="SUNSET"?2:or.includes("NIGHT")||or==="N"?3:-1}function isExplicitNewDay(ar){const or=ar.toUpperCase().trim();return!!(/\bNEXT\s+(DAY|MORNING|EVENING|NIGHT|AFTERNOON)\b/.test(or)||/\bFOLLOWING\s+(DAY|MORNING|EVENING|NIGHT|AFTERNOON)\b/.test(or)||/\bNEW\s+DAY\b/.test(or)||/\b\d+\s+(DAYS?|WEEKS?|MONTHS?|YEARS?)\s+LATER\b/.test(or)||/\b(ONE|TWO|THREE|FOUR|FIVE|SIX|SEVEN|SEVERAL|FEW|SOME)\s+(DAYS?|WEEKS?|MONTHS?|YEARS?)\s+LATER\b/.test(or))}function isNewStoryDay(ar,or,lr){return isExplicitNewDay(lr)?!0:ar<0||or<0?!1:ar>=2&&or<=1||ar===1&&or===0}function buildStoryDayMap(ar,or){const lr=new Map,cr=new Map;for(const xr of ar.days)for(const Er of xr.scenes){const vr=Er.sceneNumber.replace(/\s+/g,"").toUpperCase();cr.set(vr,Er.dayNight)}for(const xr of or){const Er=xr.sceneNumber.replace(/\s+/g,"").toUpperCase();cr.has(Er)||cr.set(Er,xr.timeOfDay)}const ur=new Map;for(const xr of or){const Er=xr.sceneNumber.replace(/\s+/g,"").toUpperCase();if(xr.slugline){const vr=xr.slugline.match(/[-]\s*([^-]+)$/);vr&&ur.set(Er,vr[1].trim())}}const dr=/^[DN](\d+)/i;let hr=!1;for(const[xr,Er]of cr){const vr=Er.match(dr);vr&&(hr=!0,lr.set(xr,parseInt(vr[1],10)))}if(hr&&lr.size>0)return console.log("[CastSync] Story days from explicit D1/D2/N1 markers:",lr.size,"scenes mapped"),lr;const pr=Array.from(cr.keys()).sort((xr,Er)=>xr.localeCompare(Er,void 0,{numeric:!0}));let mr=1,fr=-1;for(const xr of pr){const Er=cr.get(xr)||"",vr=ur.get(xr)||"",gr=vr.length>Er.length?vr:Er,yr=getTimeOrder(Er);isNewStoryDay(fr,yr,gr)&&mr++,lr.set(xr,mr),yr>=0&&(fr=yr)}return console.log("[CastSync] Story days inferred from time-of-day transitions:",mr,"days detected"),lr}function createLooksForCharacter(ar,or,lr){const cr=new Map;for(const hr of or){const pr=hr.replace(/\s+/g,"").toUpperCase(),mr=lr.get(pr)||1;cr.has(mr)||cr.set(mr,[]),cr.get(mr).push(hr)}const ur=Array.from(cr.keys()).sort((hr,pr)=>hr-pr),dr=[];for(const hr of ur){const pr=cr.get(hr).sort((mr,fr)=>mr.localeCompare(fr,void 0,{numeric:!0}));dr.push({id:v4(),characterId:ar.id,name:`Day ${hr}`,scenes:pr,estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()})}return dr.length===0&&dr.push({id:v4(),characterId:ar.id,name:"Day 1",scenes:[],estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()}),dr}function getCharacterNameFromCastNumber(ar,or){const lr=or.castList.find(cr=>cr.number===ar);return lr?lr.character||lr.name:null}function buildSceneCastMap(ar){const or=new Map;for(const lr of ar.days)for(const cr of lr.scenes){const ur=cr.sceneNumber.replace(/\s+/g,"").toUpperCase();cr.castNumbers&&cr.castNumbers.length>0&&or.set(ur,cr.castNumbers)}return or}function syncCastDataToScenes(ar,or,lr,cr,ur={}){const{createMissingCharacters:dr=!0,overwriteExisting:hr=!1,autoConfirm:pr=!0}=ur,mr={success:!0,scenesUpdated:0,charactersCreated:0,errors:[],sceneResults:[]},fr=buildSceneCastMap(ar),xr=buildStoryDayMap(ar,or);console.log("[CastSync] Scene cast map built:",Object.fromEntries(fr));const Er=[],vr=new Map,gr=or.map(jr=>({...jr})),yr=[...lr];for(const jr of gr){const wr=jr.sceneNumber.replace(/\s+/g,"").toUpperCase(),Sr=fr.get(wr);if(!Sr||Sr.length===0||!hr&&jr.characters.length>0&&jr.characterConfirmationStatus==="confirmed")continue;const Tr=[];for(const Cr of Sr){const kr=getCharacterNameFromCastNumber(Cr,ar);kr?Tr.push(kr):mr.errors.push(`Scene ${jr.sceneNumber}: Cast #${Cr} not found in cast list`)}const Rr=[],Nr=[];for(const Cr of Tr){let kr=findMatchingCharacter(Cr,[...yr,...Er]);!kr&&dr&&(kr=createCharacterFromName(Cr,yr.length+Er.length),Er.push(kr),Nr.push(kr.id),vr.set(kr.id,[]),mr.charactersCreated++),kr&&(Rr.push(kr.id),vr.has(kr.id)&&vr.get(kr.id).push(jr.sceneNumber))}Rr.length>0&&(pr?(jr.characters=Rr,jr.characterConfirmationStatus="confirmed",jr.suggestedCharacters=void 0):(jr.suggestedCharacters=Tr,jr.characterConfirmationStatus="ready"),mr.scenesUpdated++),mr.sceneResults.push({sceneNumber:jr.sceneNumber,castNumbers:Sr,characterNames:Tr,matchedCharacterIds:Rr.filter(Cr=>!Nr.includes(Cr)),newCharacterIds:Nr})}yr.push(...Er);const br=[];for(const jr of Er){const wr=vr.get(jr.id)||[],Sr=createLooksForCharacter(jr,wr,xr);br.push(...Sr)}const _r=cr.map(jr=>{const wr=[];for(const Sr of gr)Sr.characters.includes(jr.characterId)&&!jr.scenes.includes(Sr.sceneNumber)&&wr.push(Sr.sceneNumber);return wr.length>0?{...jr,scenes:[...jr.scenes,...wr].sort((Sr,Tr)=>Sr.localeCompare(Tr,void 0,{numeric:!0}))}:jr});return _r.push(...br),console.log("[CastSync] Sync complete:",{scenesUpdated:mr.scenesUpdated,charactersCreated:mr.charactersCreated,errors:mr.errors}),{result:mr,updatedScenes:gr,updatedCharacters:yr,updatedLooks:_r}}function canSyncCastData(ar){return ar?ar.castList.length===0?{canSync:!1,reason:"Schedule has no cast list"}:ar.status!=="complete"?{canSync:!1,reason:"Schedule processing not complete. Run AI analysis first."}:!ar.days||ar.days.length===0?{canSync:!1,reason:"Schedule has no shooting days. Run AI analysis first."}:ar.days.some(lr=>lr.scenes.some(cr=>cr.castNumbers&&cr.castNumbers.length>0))?{canSync:!0}:{canSync:!1,reason:"No cast data found in schedule scenes"}:{canSync:!1,reason:"No schedule uploaded"}}const createCharacterSlice=(ar,or)=>({startCharacterDetection:()=>{ar(lr=>lr.currentProject?{currentProject:{...lr.currentProject,characterDetectionStatus:"running",scenes:lr.currentProject.scenes.map(cr=>({...cr,characterConfirmationStatus:cr.characterConfirmationStatus==="confirmed"?"confirmed":"detecting"}))}}:lr)},setCharacterDetectionStatus:lr=>{ar(cr=>cr.currentProject?{currentProject:{...cr.currentProject,characterDetectionStatus:lr}}:cr)},updateSceneSuggestedCharacters:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,scenes:ur.currentProject.scenes.map(dr=>dr.id===lr?{...dr,suggestedCharacters:cr,characterConfirmationStatus:dr.characterConfirmationStatus==="confirmed"?"confirmed":"ready"}:dr)}}:ur)},updateSceneConfirmationStatus:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,scenes:ur.currentProject.scenes.map(dr=>dr.id===lr?{...dr,characterConfirmationStatus:cr}:dr)}}:ur)},confirmSceneCharacters:(lr,cr)=>{ar(ur=>{if(!ur.currentProject)return ur;const dr=ur.currentProject.scenes.find(yr=>yr.id===lr),hr=(dr==null?void 0:dr.characters)||[],pr=ur.currentProject.scenes.map(yr=>yr.id===lr?{...yr,characters:cr,characterConfirmationStatus:"confirmed",suggestedCharacters:void 0}:yr),mr=pr.filter(yr=>yr.characterConfirmationStatus==="confirmed").length,fr=pr.find(yr=>yr.id===lr),xr=hr.filter(yr=>!cr.includes(yr)),Er=new Set;for(const yr of ur.currentProject.looks)fr&&yr.scenes.includes(fr.sceneNumber)&&Er.add(yr.characterId);const vr=new Set,gr=ur.currentProject.looks.map(yr=>fr?xr.includes(yr.characterId)&&yr.scenes.includes(fr.sceneNumber)?{...yr,scenes:yr.scenes.filter(br=>br!==fr.sceneNumber)}:cr.includes(yr.characterId)&&!Er.has(yr.characterId)&&!vr.has(yr.characterId)?(vr.add(yr.characterId),{...yr,scenes:[...yr.scenes,fr.sceneNumber].sort((br,_r)=>br.localeCompare(_r,void 0,{numeric:!0}))}):yr:yr);return{currentProject:{...ur.currentProject,scenes:pr,looks:gr,scenesConfirmed:mr}}})},addCharacterFromScene:(lr,cr)=>{const ur=or();if(!ur.currentProject)throw new Error("No project loaded");const dr=v4(),hr=cr.split(" ").map(Er=>Er[0]).join("").slice(0,2),pr=["#C9A961","#8B5CF6","#EC4899","#10B981","#F59E0B","#EF4444","#3B82F6","#6366F1"],mr=pr[ur.currentProject.characters.length%pr.length],fr={id:dr,name:cr,initials:hr,avatarColour:mr},xr=ur.currentProject.scenes.find(Er=>Er.id===lr);return ar(Er=>{if(!Er.currentProject)return Er;const vr={id:v4(),characterId:fr.id,name:"Day 1",scenes:xr?[xr.sceneNumber]:[],estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()};return{currentProject:{...Er.currentProject,characters:[...Er.currentProject.characters,fr],looks:[...Er.currentProject.looks,vr]}}}),fr},getUnconfirmedScenesCount:()=>{const lr=or();return lr.currentProject?lr.currentProject.scenes.filter(cr=>cr.characterConfirmationStatus!=="confirmed").length:0},getConfirmedScenesCount:()=>{const lr=or();return lr.currentProject?lr.currentProject.scenes.filter(cr=>cr.characterConfirmationStatus==="confirmed").length:0},getCastProfile:lr=>{var ur;const cr=or();if(cr.currentProject)return(ur=cr.currentProject.castProfiles)==null?void 0:ur.find(dr=>dr.characterId===lr)},updateCastProfile:(lr,cr)=>{ar(ur=>{if(!ur.currentProject)return ur;const dr=ur.currentProject.castProfiles||[],hr=dr.findIndex(mr=>mr.characterId===lr);let pr;if(hr>=0)pr=dr.map((mr,fr)=>fr===hr?{...mr,...cr}:mr);else{const mr={...createEmptyCastProfile(lr),...cr};pr=[...dr,mr]}return{currentProject:{...ur.currentProject,castProfiles:pr}}})},syncCastDataFromSchedule:(lr,cr={})=>{const ur=or();if(!ur.currentProject)return null;const{canSync:dr,reason:hr}=canSyncCastData(lr);if(!dr)return console.error("[ProjectStore] Cannot sync cast data:",hr),null;const{result:pr,updatedScenes:mr,updatedCharacters:fr,updatedLooks:xr}=syncCastDataToScenes(lr,ur.currentProject.scenes,ur.currentProject.characters,ur.currentProject.looks,cr);return(pr.scenesUpdated>0||pr.charactersCreated>0)&&(ar(Er=>{if(!Er.currentProject)return{};const gr=(Er.currentProject.castProfiles||[]).map(yr=>{const br=yr.characterId.match(/^cast-(\d+)$/);if(!br)return yr;const _r=parseInt(br[1],10),jr=lr.castList.find(Tr=>Tr.number===_r);if(!jr)return yr;const wr=(jr.character||jr.name).replace(/^\d+\.\s*/,"").trim().toUpperCase(),Sr=fr.find(Tr=>Tr.name.trim().toUpperCase()===wr);return Sr?(console.log(`[ProjectStore] Migrating cast profile from placeholder ${yr.characterId} to ${Sr.id} (${Sr.name})`),{...yr,characterId:Sr.id,id:`cast-${Sr.id}`}):yr});return{currentProject:{...Er.currentProject,scenes:mr,characters:fr,looks:xr,castProfiles:gr}}}),console.log("[ProjectStore] Cast sync complete:",{scenesUpdated:pr.scenesUpdated,charactersCreated:pr.charactersCreated})),pr},canSyncCastData:lr=>canSyncCastData(lr),getCharacter:lr=>{var cr;return(cr=or().currentProject)==null?void 0:cr.characters.find(ur=>ur.id===lr)}}),createLookSlice=(ar,or)=>({updateLook:(lr,cr)=>{ar(ur=>ur.currentProject?{currentProject:{...ur.currentProject,looks:ur.currentProject.looks.map(dr=>dr.id===lr?{...dr,...cr}:dr)}}:ur)},updateLookWithPropagation:(lr,cr)=>{const ur=or();if(!ur.currentProject)return;const dr=ur.currentProject.looks.find(mr=>mr.id===lr);if(!dr)return;ar(mr=>mr.currentProject?{currentProject:{...mr.currentProject,looks:mr.currentProject.looks.map(fr=>fr.id===lr?{...fr,...cr}:fr)}}:mr);const hr={...ur.sceneCaptures};let pr=!1;for(const mr of dr.scenes){const fr=ur.currentProject.scenes.find(gr=>gr.sceneNumber===mr);if(!fr)continue;const xr=`${fr.id}-${dr.characterId}`,Er=hr[xr];if(!Er)continue;const vr={};if(cr.continuityFlags){const gr=Er.continuityFlags;!gr.sweat&&!gr.dishevelled&&!gr.blood&&!gr.dirt&&!gr.wetHair&&!gr.tears&&(vr.continuityFlags={...cr.continuityFlags})}cr.notes!==void 0&&!Er.notes&&(vr.notes=cr.notes),cr.sfxDetails&&!Er.sfxDetails.sfxRequired&&Er.sfxDetails.sfxTypes.length===0&&(vr.sfxDetails={...cr.sfxDetails}),Object.keys(vr).length>0&&(hr[xr]={...Er,...vr},pr=!0)}pr&&ar({sceneCaptures:hr})},getLookForCharacterInScene:(lr,cr)=>{var ur;return(ur=or().currentProject)==null?void 0:ur.looks.find(dr=>dr.characterId===lr&&dr.scenes.includes(cr))}});function calculateTextSimilarity(ar,or){if(!ar&&!or)return 100;if(!ar||!or)return 0;const lr=fr=>fr.toLowerCase().replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim(),cr=lr(ar),ur=lr(or);if(cr===ur)return 100;const dr=new Set(cr.split(" ").filter(fr=>fr.length>2)),hr=new Set(ur.split(" ").filter(fr=>fr.length>2));if(dr.size===0&&hr.size===0)return 100;if(dr.size===0||hr.size===0)return 0;const pr=new Set([...dr].filter(fr=>hr.has(fr))),mr=new Set([...dr,...hr]);return Math.round(pr.size/mr.size*100)}function describeChanges(ar,or,lr){return!ar&&or?"New scene added":ar&&!or?"Scene removed from script":lr>=95?"Minor formatting changes":lr>=80?"Minor dialogue or action changes":lr>=50?"Significant content changes":"Major rewrite of scene"}function compareScriptAmendment(ar,or){const lr=[],cr=new Set,ur=new Set,dr=new Map(ar.map(vr=>[vr.sceneNumber,vr]));for(const vr of or){const gr=dr.get(vr.sceneNumber);if(ur.add(vr.sceneNumber),!gr)lr.push({sceneNumber:vr.sceneNumber,status:"new",newScene:vr,changeDescription:"New scene added to script"});else{cr.add(vr.sceneNumber);const yr=calculateTextSimilarity(gr.scriptContent||"",vr.scriptContent||"");yr>=95?lr.push({sceneNumber:vr.sceneNumber,status:"unchanged",existingScene:gr,newScene:vr,changeDescription:"No significant changes",contentSimilarity:yr}):lr.push({sceneNumber:vr.sceneNumber,status:"modified",existingScene:gr,newScene:vr,changeDescription:describeChanges(gr.scriptContent,vr.scriptContent,yr),contentSimilarity:yr})}}for(const vr of ar)cr.has(vr.sceneNumber)||lr.push({sceneNumber:vr.sceneNumber,status:"deleted",existingScene:vr,changeDescription:"Scene removed from script"});lr.sort((vr,gr)=>{const yr=parseFloat(vr.sceneNumber.replace(/[A-Z]/g,".5"))||0,br=parseFloat(gr.sceneNumber.replace(/[A-Z]/g,".5"))||0;return yr-br});const hr=lr.filter(vr=>vr.status==="new"),pr=lr.filter(vr=>vr.status==="modified"),mr=lr.filter(vr=>vr.status==="deleted"),fr=lr.filter(vr=>vr.status==="unchanged"),xr=[];hr.length>0&&xr.push(`${hr.length} new scene${hr.length>1?"s":""}`),pr.length>0&&xr.push(`${pr.length} modified scene${pr.length>1?"s":""}`),mr.length>0&&xr.push(`${mr.length} deleted scene${mr.length>1?"s":""}`);const Er=xr.length>0?xr.join(", "):"No changes detected";return{changes:lr,newScenes:hr,modifiedScenes:pr,deletedScenes:mr,unchangedScenes:fr,summary:Er}}function applyAmendmentToScenes(ar,or,lr={includeNew:!0,includeModified:!0,includeDeleted:!1}){const cr=new Date().toISOString(),ur=new Map(ar.map(dr=>[dr.sceneNumber,{...dr}]));for(const dr of or.changes)if(dr.status==="new"&&lr.includeNew&&dr.newScene){const hr={id:v4(),sceneNumber:dr.newScene.sceneNumber,slugline:dr.newScene.slugline,intExt:dr.newScene.intExt,timeOfDay:dr.newScene.timeOfDay,scriptContent:dr.newScene.scriptContent,characters:[],isComplete:!1,amendmentStatus:"new",amendmentDate:cr,amendmentNotes:"New scene added in script revision"};ur.set(dr.sceneNumber,hr)}else if(dr.status==="modified"&&lr.includeModified&&dr.newScene){const hr=ur.get(dr.sceneNumber);hr&&ur.set(dr.sceneNumber,{...hr,slugline:dr.newScene.slugline,intExt:dr.newScene.intExt,timeOfDay:dr.newScene.timeOfDay,scriptContent:dr.newScene.scriptContent,previousScriptContent:hr.scriptContent,amendmentStatus:"modified",amendmentDate:cr,amendmentNotes:dr.changeDescription})}else if(dr.status==="deleted"&&lr.includeDeleted){const hr=ur.get(dr.sceneNumber);hr&&ur.set(dr.sceneNumber,{...hr,amendmentStatus:"deleted",amendmentDate:cr,amendmentNotes:"Scene removed in script revision"})}else if(dr.status==="unchanged"){const hr=ur.get(dr.sceneNumber);hr&&hr.amendmentStatus&&ur.set(dr.sceneNumber,{...hr,amendmentStatus:"unchanged"})}return Array.from(ur.values()).sort((dr,hr)=>{const pr=parseFloat(dr.sceneNumber.replace(/[A-Z]/g,".5"))||0,mr=parseFloat(hr.sceneNumber.replace(/[A-Z]/g,".5"))||0;return pr-mr})}function clearAmendmentFlags(ar){return ar.map(or=>({...or,amendmentStatus:void 0,previousScriptContent:void 0,amendmentNotes:void 0}))}function getAmendmentCount(ar){const or=ar.filter(ur=>ur.amendmentStatus==="new").length,lr=ar.filter(ur=>ur.amendmentStatus==="modified").length,cr=ar.filter(ur=>ur.amendmentStatus==="deleted").length;return{total:or+lr+cr,new:or,modified:lr,deleted:cr}}const createAmendmentSlice=(ar,or)=>({compareScriptAmendment:lr=>{const{currentProject:cr}=or();return cr!=null&&cr.scenes?compareScriptAmendment(cr.scenes,lr):null},applyScriptAmendment:(lr,cr={includeNew:!0,includeModified:!0,includeDeleted:!1})=>{const{currentProject:ur}=or();if(!ur)return;const dr=applyAmendmentToScenes(ur.scenes,lr,cr);ar({currentProject:{...ur,scenes:dr,updatedAt:new Date}})},clearSceneAmendmentFlags:()=>{const{currentProject:lr}=or();if(!lr)return;const cr=clearAmendmentFlags(lr.scenes);ar({currentProject:{...lr,scenes:cr}})},clearSingleSceneAmendment:lr=>{const{currentProject:cr}=or();if(!cr)return;const ur=cr.scenes.map(dr=>dr.id===lr?{...dr,amendmentStatus:void 0,amendmentNotes:void 0,previousScriptContent:void 0}:dr);ar({currentProject:{...cr,scenes:ur}})},getAmendmentCounts:()=>{const{currentProject:lr}=or();return lr!=null&&lr.scenes?getAmendmentCount(lr.scenes):{total:0,new:0,modified:0,deleted:0}}}),createLifecycleSlice=(ar,or)=>({updateActivity:()=>{ar(lr=>({lifecycle:{...lr.lifecycle,lastActivityAt:new Date}}))},checkWrapTrigger:()=>{const lr=or();if(!lr.currentProject)return;if(lr.lifecycle.nextReminderAt&&new Date>=new Date(lr.lifecycle.nextReminderAt)){ar({showWrapPopup:!0,wrapTriggerReason:lr.lifecycle.wrapReason||"manual"});return}const cr=shouldTriggerWrap(lr.currentProject,lr.lifecycle);cr.trigger&&cr.reason&&ar({showWrapPopup:!0,wrapTriggerReason:cr.reason})},wrapProject:lr=>{const cr=new Date,ur=new Date(cr);ur.setDate(ur.getDate()+PROJECT_RETENTION_DAYS),ar(dr=>({lifecycle:{...dr.lifecycle,state:"wrapped",wrappedAt:cr,wrapReason:lr,deletionDate:ur},showWrapPopup:!1,wrapTriggerReason:null}))},dismissWrapPopup:lr=>{if(lr){const cr=new Date;cr.setDate(cr.getDate()+REMINDER_INTERVAL_DAYS),ar(ur=>({showWrapPopup:!1,lifecycle:{...ur.lifecycle,reminderDismissedAt:new Date,nextReminderAt:cr}}))}else ar({showWrapPopup:!1})},restoreProject:()=>{ar(lr=>({lifecycle:{...lr.lifecycle,state:"active",wrappedAt:void 0,deletionDate:void 0,archiveDate:void 0,reminderDismissedAt:void 0,nextReminderAt:void 0,lastActivityAt:new Date}}))},archiveProject:()=>{const lr=or();if(!lr.currentProject)return;const cr=new Date,ur={project:lr.currentProject,lifecycle:{...lr.lifecycle,state:"archived",archiveDate:cr},sceneCaptures:lr.sceneCaptures};ar(dr=>({archivedProjects:[...dr.archivedProjects,ur],currentProject:null,sceneCaptures:{},lifecycle:createDefaultLifecycle()}))},permanentlyDeleteProject:()=>{ar({currentProject:null,sceneCaptures:{},lifecycle:createDefaultLifecycle()})},getArchivedProjects:()=>or().archivedProjects.map(cr=>{const ur=Object.values(cr.sceneCaptures).reduce((dr,hr)=>{let pr=0;return hr.photos.front&&pr++,hr.photos.left&&pr++,hr.photos.right&&pr++,hr.photos.back&&pr++,pr+=hr.additionalPhotos.length,dr+pr},0);return{id:cr.project.id,name:cr.project.name,state:cr.lifecycle.state,wrappedAt:cr.lifecycle.wrappedAt,daysUntilDeletion:cr.lifecycle.wrappedAt?calculateDaysUntilDeletion(new Date(cr.lifecycle.wrappedAt)):0,scenesCount:cr.project.scenes.length,charactersCount:cr.project.characters.length,photosCount:ur}}),loadArchivedProject:lr=>{const cr=or(),ur=cr.archivedProjects.findIndex(pr=>pr.project.id===lr);if(ur===-1)return;const dr=cr.archivedProjects[ur],hr=[...cr.archivedProjects];hr.splice(ur,1),ar({currentProject:dr.project,sceneCaptures:dr.sceneCaptures,lifecycle:dr.lifecycle,archivedProjects:hr})},getDaysUntilDeletion:()=>{const lr=or();return lr.lifecycle.state==="active"||!lr.lifecycle.wrappedAt?-1:calculateDaysUntilDeletion(new Date(lr.lifecycle.wrappedAt))},getLifecycleBanner:()=>{const lr=or();if(lr.lifecycle.state==="active")return null;const cr=lr.lifecycle.wrappedAt?calculateDaysUntilDeletion(new Date(lr.lifecycle.wrappedAt)):0;return lr.lifecycle.state==="wrapped"?{show:!0,message:`Project wrapped. ${cr} days until archive.`,daysRemaining:cr}:lr.lifecycle.state==="archived"?{show:!0,message:"Archived. Export to restore.",daysRemaining:cr}:null}}),useProjectStore=create()(persist((ar,or)=>({currentProject:null,currentSceneId:null,currentCharacterId:null,currentLookId:null,activeTab:"today",sceneFilter:"all",searchQuery:"",needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null,savedProjects:{},archivedProjects:[],setProject:lr=>ar({currentProject:lr,needsSetup:!1,lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}),setProjectNeedsSetup:lr=>ar({currentProject:lr,needsSetup:!0,lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}),clearNeedsSetup:()=>ar({needsSetup:!1}),setScriptPdf:lr=>ar(cr=>({currentProject:cr.currentProject?{...cr.currentProject,scriptPdfData:lr}:null})),clearProject:()=>ar({currentProject:null,currentSceneId:null,currentCharacterId:null,needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}),saveAndClearProject:()=>{const lr=or();if(lr.currentProject){const cr=lr.currentProject.id,ur=lr.currentProject,dr=lr.sceneCaptures,hr=lr.lifecycle,pr=lr.needsSetup;useScheduleStore.getState().saveScheduleForProject(cr),useCallSheetStore.getState().saveCallSheetsForProject(cr),ar(mr=>({savedProjects:{...mr.savedProjects,[cr]:{project:ur,sceneCaptures:dr,lifecycle:hr,needsSetup:pr}},currentProject:null,currentSceneId:null,currentCharacterId:null,needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null}))}else useScheduleStore.getState().clearScheduleForProject(),useCallSheetStore.getState().clearCallSheetsForProject(),ar({currentProject:null,currentSceneId:null,currentCharacterId:null,needsSetup:!1,sceneCaptures:{},lifecycle:createDefaultLifecycle(),showWrapPopup:!1,wrapTriggerReason:null})},restoreSavedProject:lr=>{const cr=or(),ur=cr.savedProjects[lr];if(!ur)return!1;const dr={...cr.savedProjects};return delete dr[lr],useScheduleStore.getState().restoreScheduleForProject(lr),useCallSheetStore.getState().restoreCallSheetsForProject(lr),ar({currentProject:ur.project,sceneCaptures:ur.sceneCaptures,lifecycle:ur.lifecycle,needsSetup:ur.needsSetup,savedProjects:dr,currentSceneId:null,currentCharacterId:null,showWrapPopup:!1,wrapTriggerReason:null}),!0},hasSavedProject:lr=>!!or().savedProjects[lr],removeSavedProject:lr=>{const cr={...or().savedProjects};delete cr[lr],ar({savedProjects:cr})},setActiveTab:lr=>ar({activeTab:lr}),setCurrentScene:lr=>ar({currentSceneId:lr}),setCurrentCharacter:lr=>ar({currentCharacterId:lr}),setCurrentLook:lr=>ar({currentLookId:lr}),setSceneFilter:lr=>ar({sceneFilter:lr}),setSearchQuery:lr=>ar({searchQuery:lr}),...createSceneSlice(ar,or),...createCaptureSlice(ar,or),...createCharacterSlice(ar,or),...createLookSlice(ar,or),...createAmendmentSlice(ar,or),...createLifecycleSlice(ar,or)}),{name:"hair-makeup-pro-storage",storage:createHybridStorage("hair-makeup-pro-storage"),partialize:ar=>({currentProject:ar.currentProject,sceneCaptures:ar.sceneCaptures,lifecycle:ar.lifecycle,savedProjects:ar.savedProjects,archivedProjects:ar.archivedProjects,needsSetup:ar.needsSetup})}));function __rest(ar,or){var lr={};for(var cr in ar)Object.prototype.hasOwnProperty.call(ar,cr)&&or.indexOf(cr)<0&&(lr[cr]=ar[cr]);if(ar!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ur=0,cr=Object.getOwnPropertySymbols(ar);ur<cr.length;ur++)or.indexOf(cr[ur])<0&&Object.prototype.propertyIsEnumerable.call(ar,cr[ur])&&(lr[cr[ur]]=ar[cr[ur]]);return lr}function __awaiter(ar,or,lr,cr){function ur(dr){return dr instanceof lr?dr:new lr(function(hr){hr(dr)})}return new(lr||(lr=Promise))(function(dr,hr){function pr(xr){try{fr(cr.next(xr))}catch(Er){hr(Er)}}function mr(xr){try{fr(cr.throw(xr))}catch(Er){hr(Er)}}function fr(xr){xr.done?dr(xr.value):ur(xr.value).then(pr,mr)}fr((cr=cr.apply(ar,or||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;const resolveFetch$3=ar=>ar?(...or)=>ar(...or):(...or)=>fetch(...or);class FunctionsError extends Error{constructor(or,lr="FunctionsError",cr){super(or),this.name=lr,this.context=cr}}class FunctionsFetchError extends FunctionsError{constructor(or){super("Failed to send a request to the Edge Function","FunctionsFetchError",or)}}class FunctionsRelayError extends FunctionsError{constructor(or){super("Relay Error invoking the Edge Function","FunctionsRelayError",or)}}class FunctionsHttpError extends FunctionsError{constructor(or){super("Edge Function returned a non-2xx status code","FunctionsHttpError",or)}}var FunctionRegion;(function(ar){ar.Any="any",ar.ApNortheast1="ap-northeast-1",ar.ApNortheast2="ap-northeast-2",ar.ApSouth1="ap-south-1",ar.ApSoutheast1="ap-southeast-1",ar.ApSoutheast2="ap-southeast-2",ar.CaCentral1="ca-central-1",ar.EuCentral1="eu-central-1",ar.EuWest1="eu-west-1",ar.EuWest2="eu-west-2",ar.EuWest3="eu-west-3",ar.SaEast1="sa-east-1",ar.UsEast1="us-east-1",ar.UsWest1="us-west-1",ar.UsWest2="us-west-2"})(FunctionRegion||(FunctionRegion={}));class FunctionsClient{constructor(or,{headers:lr={},customFetch:cr,region:ur=FunctionRegion.Any}={}){this.url=or,this.headers=lr,this.region=ur,this.fetch=resolveFetch$3(cr)}setAuth(or){this.headers.Authorization=`Bearer ${or}`}invoke(or){return __awaiter(this,arguments,void 0,function*(lr,cr={}){var ur;let dr,hr;try{const{headers:pr,method:mr,body:fr,signal:xr,timeout:Er}=cr;let vr={},{region:gr}=cr;gr||(gr=this.region);const yr=new URL(`${this.url}/${lr}`);gr&&gr!=="any"&&(vr["x-region"]=gr,yr.searchParams.set("forceFunctionRegion",gr));let br;fr&&(pr&&!Object.prototype.hasOwnProperty.call(pr,"Content-Type")||!pr)?typeof Blob<"u"&&fr instanceof Blob||fr instanceof ArrayBuffer?(vr["Content-Type"]="application/octet-stream",br=fr):typeof fr=="string"?(vr["Content-Type"]="text/plain",br=fr):typeof FormData<"u"&&fr instanceof FormData?br=fr:(vr["Content-Type"]="application/json",br=JSON.stringify(fr)):fr&&typeof fr!="string"&&!(typeof Blob<"u"&&fr instanceof Blob)&&!(fr instanceof ArrayBuffer)&&!(typeof FormData<"u"&&fr instanceof FormData)?br=JSON.stringify(fr):br=fr;let _r=xr;Er&&(hr=new AbortController,dr=setTimeout(()=>hr.abort(),Er),xr?(_r=hr.signal,xr.addEventListener("abort",()=>hr.abort())):_r=hr.signal);const jr=yield this.fetch(yr.toString(),{method:mr||"POST",headers:Object.assign(Object.assign(Object.assign({},vr),this.headers),pr),body:br,signal:_r}).catch(Rr=>{throw new FunctionsFetchError(Rr)}),wr=jr.headers.get("x-relay-error");if(wr&&wr==="true")throw new FunctionsRelayError(jr);if(!jr.ok)throw new FunctionsHttpError(jr);let Sr=((ur=jr.headers.get("Content-Type"))!==null&&ur!==void 0?ur:"text/plain").split(";")[0].trim(),Tr;return Sr==="application/json"?Tr=yield jr.json():Sr==="application/octet-stream"||Sr==="application/pdf"?Tr=yield jr.blob():Sr==="text/event-stream"?Tr=jr:Sr==="multipart/form-data"?Tr=yield jr.formData():Tr=yield jr.text(),{data:Tr,error:null,response:jr}}catch(pr){return{data:null,error:pr,response:pr instanceof FunctionsHttpError||pr instanceof FunctionsRelayError?pr.context:void 0}}finally{dr&&clearTimeout(dr)}})}}var PostgrestError=class extends Error{constructor(ar){super(ar.message),this.name="PostgrestError",this.details=ar.details,this.hint=ar.hint,this.code=ar.code}},PostgrestBuilder=class{constructor(ar){var or,lr;this.shouldThrowOnError=!1,this.method=ar.method,this.url=ar.url,this.headers=new Headers(ar.headers),this.schema=ar.schema,this.body=ar.body,this.shouldThrowOnError=(or=ar.shouldThrowOnError)!==null&&or!==void 0?or:!1,this.signal=ar.signal,this.isMaybeSingle=(lr=ar.isMaybeSingle)!==null&&lr!==void 0?lr:!1,ar.fetch?this.fetch=ar.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(ar,or){return this.headers=new Headers(this.headers),this.headers.set(ar,or),this}then(ar,or){var lr=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const cr=this.fetch;let ur=cr(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async dr=>{let hr=null,pr=null,mr=null,fr=dr.status,xr=dr.statusText;if(dr.ok){var Er,vr;if(lr.method!=="HEAD"){var gr;const jr=await dr.text();jr===""||(lr.headers.get("Accept")==="text/csv"||lr.headers.get("Accept")&&(!((gr=lr.headers.get("Accept"))===null||gr===void 0)&&gr.includes("application/vnd.pgrst.plan+text"))?pr=jr:pr=JSON.parse(jr))}const br=(Er=lr.headers.get("Prefer"))===null||Er===void 0?void 0:Er.match(/count=(exact|planned|estimated)/),_r=(vr=dr.headers.get("content-range"))===null||vr===void 0?void 0:vr.split("/");br&&_r&&_r.length>1&&(mr=parseInt(_r[1])),lr.isMaybeSingle&&lr.method==="GET"&&Array.isArray(pr)&&(pr.length>1?(hr={code:"PGRST116",details:`Results contain ${pr.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},pr=null,mr=null,fr=406,xr="Not Acceptable"):pr.length===1?pr=pr[0]:pr=null)}else{var yr;const br=await dr.text();try{hr=JSON.parse(br),Array.isArray(hr)&&dr.status===404&&(pr=[],hr=null,fr=200,xr="OK")}catch{dr.status===404&&br===""?(fr=204,xr="No Content"):hr={message:br}}if(hr&&lr.isMaybeSingle&&(!(hr==null||(yr=hr.details)===null||yr===void 0)&&yr.includes("0 rows"))&&(hr=null,fr=200,xr="OK"),hr&&lr.shouldThrowOnError)throw new PostgrestError(hr)}return{error:hr,data:pr,count:mr,status:fr,statusText:xr}});return this.shouldThrowOnError||(ur=ur.catch(dr=>{var hr;let pr="";const mr=dr==null?void 0:dr.cause;if(mr){var fr,xr,Er,vr;const yr=(fr=mr==null?void 0:mr.message)!==null&&fr!==void 0?fr:"",br=(xr=mr==null?void 0:mr.code)!==null&&xr!==void 0?xr:"";pr=`${(Er=dr==null?void 0:dr.name)!==null&&Er!==void 0?Er:"FetchError"}: ${dr==null?void 0:dr.message}`,pr+=`

Caused by: ${(vr=mr==null?void 0:mr.name)!==null&&vr!==void 0?vr:"Error"}: ${yr}`,br&&(pr+=` (${br})`),mr!=null&&mr.stack&&(pr+=`
${mr.stack}`)}else{var gr;pr=(gr=dr==null?void 0:dr.stack)!==null&&gr!==void 0?gr:""}return{error:{message:`${(hr=dr==null?void 0:dr.name)!==null&&hr!==void 0?hr:"FetchError"}: ${dr==null?void 0:dr.message}`,details:pr,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),ur.then(ar,or)}returns(){return this}overrideTypes(){return this}},PostgrestTransformBuilder=class extends PostgrestBuilder{select(ar){let or=!1;const lr=(ar??"*").split("").map(cr=>/\s/.test(cr)&&!or?"":(cr==='"'&&(or=!or),cr)).join("");return this.url.searchParams.set("select",lr),this.headers.append("Prefer","return=representation"),this}order(ar,{ascending:or=!0,nullsFirst:lr,foreignTable:cr,referencedTable:ur=cr}={}){const dr=ur?`${ur}.order`:"order",hr=this.url.searchParams.get(dr);return this.url.searchParams.set(dr,`${hr?`${hr},`:""}${ar}.${or?"asc":"desc"}${lr===void 0?"":lr?".nullsfirst":".nullslast"}`),this}limit(ar,{foreignTable:or,referencedTable:lr=or}={}){const cr=typeof lr>"u"?"limit":`${lr}.limit`;return this.url.searchParams.set(cr,`${ar}`),this}range(ar,or,{foreignTable:lr,referencedTable:cr=lr}={}){const ur=typeof cr>"u"?"offset":`${cr}.offset`,dr=typeof cr>"u"?"limit":`${cr}.limit`;return this.url.searchParams.set(ur,`${ar}`),this.url.searchParams.set(dr,`${or-ar+1}`),this}abortSignal(ar){return this.signal=ar,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:ar=!1,verbose:or=!1,settings:lr=!1,buffers:cr=!1,wal:ur=!1,format:dr="text"}={}){var hr;const pr=[ar?"analyze":null,or?"verbose":null,lr?"settings":null,cr?"buffers":null,ur?"wal":null].filter(Boolean).join("|"),mr=(hr=this.headers.get("Accept"))!==null&&hr!==void 0?hr:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${dr}; for="${mr}"; options=${pr};`),dr==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(ar){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${ar}`),this}};const PostgrestReservedCharsRegexp=new RegExp("[,()]");var PostgrestFilterBuilder=class extends PostgrestTransformBuilder{eq(ar,or){return this.url.searchParams.append(ar,`eq.${or}`),this}neq(ar,or){return this.url.searchParams.append(ar,`neq.${or}`),this}gt(ar,or){return this.url.searchParams.append(ar,`gt.${or}`),this}gte(ar,or){return this.url.searchParams.append(ar,`gte.${or}`),this}lt(ar,or){return this.url.searchParams.append(ar,`lt.${or}`),this}lte(ar,or){return this.url.searchParams.append(ar,`lte.${or}`),this}like(ar,or){return this.url.searchParams.append(ar,`like.${or}`),this}likeAllOf(ar,or){return this.url.searchParams.append(ar,`like(all).{${or.join(",")}}`),this}likeAnyOf(ar,or){return this.url.searchParams.append(ar,`like(any).{${or.join(",")}}`),this}ilike(ar,or){return this.url.searchParams.append(ar,`ilike.${or}`),this}ilikeAllOf(ar,or){return this.url.searchParams.append(ar,`ilike(all).{${or.join(",")}}`),this}ilikeAnyOf(ar,or){return this.url.searchParams.append(ar,`ilike(any).{${or.join(",")}}`),this}regexMatch(ar,or){return this.url.searchParams.append(ar,`match.${or}`),this}regexIMatch(ar,or){return this.url.searchParams.append(ar,`imatch.${or}`),this}is(ar,or){return this.url.searchParams.append(ar,`is.${or}`),this}isDistinct(ar,or){return this.url.searchParams.append(ar,`isdistinct.${or}`),this}in(ar,or){const lr=Array.from(new Set(or)).map(cr=>typeof cr=="string"&&PostgrestReservedCharsRegexp.test(cr)?`"${cr}"`:`${cr}`).join(",");return this.url.searchParams.append(ar,`in.(${lr})`),this}notIn(ar,or){const lr=Array.from(new Set(or)).map(cr=>typeof cr=="string"&&PostgrestReservedCharsRegexp.test(cr)?`"${cr}"`:`${cr}`).join(",");return this.url.searchParams.append(ar,`not.in.(${lr})`),this}contains(ar,or){return typeof or=="string"?this.url.searchParams.append(ar,`cs.${or}`):Array.isArray(or)?this.url.searchParams.append(ar,`cs.{${or.join(",")}}`):this.url.searchParams.append(ar,`cs.${JSON.stringify(or)}`),this}containedBy(ar,or){return typeof or=="string"?this.url.searchParams.append(ar,`cd.${or}`):Array.isArray(or)?this.url.searchParams.append(ar,`cd.{${or.join(",")}}`):this.url.searchParams.append(ar,`cd.${JSON.stringify(or)}`),this}rangeGt(ar,or){return this.url.searchParams.append(ar,`sr.${or}`),this}rangeGte(ar,or){return this.url.searchParams.append(ar,`nxl.${or}`),this}rangeLt(ar,or){return this.url.searchParams.append(ar,`sl.${or}`),this}rangeLte(ar,or){return this.url.searchParams.append(ar,`nxr.${or}`),this}rangeAdjacent(ar,or){return this.url.searchParams.append(ar,`adj.${or}`),this}overlaps(ar,or){return typeof or=="string"?this.url.searchParams.append(ar,`ov.${or}`):this.url.searchParams.append(ar,`ov.{${or.join(",")}}`),this}textSearch(ar,or,{config:lr,type:cr}={}){let ur="";cr==="plain"?ur="pl":cr==="phrase"?ur="ph":cr==="websearch"&&(ur="w");const dr=lr===void 0?"":`(${lr})`;return this.url.searchParams.append(ar,`${ur}fts${dr}.${or}`),this}match(ar){return Object.entries(ar).forEach(([or,lr])=>{this.url.searchParams.append(or,`eq.${lr}`)}),this}not(ar,or,lr){return this.url.searchParams.append(ar,`not.${or}.${lr}`),this}or(ar,{foreignTable:or,referencedTable:lr=or}={}){const cr=lr?`${lr}.or`:"or";return this.url.searchParams.append(cr,`(${ar})`),this}filter(ar,or,lr){return this.url.searchParams.append(ar,`${or}.${lr}`),this}},PostgrestQueryBuilder=class{constructor(ar,{headers:or={},schema:lr,fetch:cr}){this.url=ar,this.headers=new Headers(or),this.schema=lr,this.fetch=cr}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(ar,or){const{head:lr=!1,count:cr}=or??{},ur=lr?"HEAD":"GET";let dr=!1;const hr=(ar??"*").split("").map(fr=>/\s/.test(fr)&&!dr?"":(fr==='"'&&(dr=!dr),fr)).join(""),{url:pr,headers:mr}=this.cloneRequestState();return pr.searchParams.set("select",hr),cr&&mr.append("Prefer",`count=${cr}`),new PostgrestFilterBuilder({method:ur,url:pr,headers:mr,schema:this.schema,fetch:this.fetch})}insert(ar,{count:or,defaultToNull:lr=!0}={}){var cr;const ur="POST",{url:dr,headers:hr}=this.cloneRequestState();if(or&&hr.append("Prefer",`count=${or}`),lr||hr.append("Prefer","missing=default"),Array.isArray(ar)){const pr=ar.reduce((mr,fr)=>mr.concat(Object.keys(fr)),[]);if(pr.length>0){const mr=[...new Set(pr)].map(fr=>`"${fr}"`);dr.searchParams.set("columns",mr.join(","))}}return new PostgrestFilterBuilder({method:ur,url:dr,headers:hr,schema:this.schema,body:ar,fetch:(cr=this.fetch)!==null&&cr!==void 0?cr:fetch})}upsert(ar,{onConflict:or,ignoreDuplicates:lr=!1,count:cr,defaultToNull:ur=!0}={}){var dr;const hr="POST",{url:pr,headers:mr}=this.cloneRequestState();if(mr.append("Prefer",`resolution=${lr?"ignore":"merge"}-duplicates`),or!==void 0&&pr.searchParams.set("on_conflict",or),cr&&mr.append("Prefer",`count=${cr}`),ur||mr.append("Prefer","missing=default"),Array.isArray(ar)){const fr=ar.reduce((xr,Er)=>xr.concat(Object.keys(Er)),[]);if(fr.length>0){const xr=[...new Set(fr)].map(Er=>`"${Er}"`);pr.searchParams.set("columns",xr.join(","))}}return new PostgrestFilterBuilder({method:hr,url:pr,headers:mr,schema:this.schema,body:ar,fetch:(dr=this.fetch)!==null&&dr!==void 0?dr:fetch})}update(ar,{count:or}={}){var lr;const cr="PATCH",{url:ur,headers:dr}=this.cloneRequestState();return or&&dr.append("Prefer",`count=${or}`),new PostgrestFilterBuilder({method:cr,url:ur,headers:dr,schema:this.schema,body:ar,fetch:(lr=this.fetch)!==null&&lr!==void 0?lr:fetch})}delete({count:ar}={}){var or;const lr="DELETE",{url:cr,headers:ur}=this.cloneRequestState();return ar&&ur.append("Prefer",`count=${ar}`),new PostgrestFilterBuilder({method:lr,url:cr,headers:ur,schema:this.schema,fetch:(or=this.fetch)!==null&&or!==void 0?or:fetch})}},PostgrestClient=class ku{constructor(or,{headers:lr={},schema:cr,fetch:ur}={}){this.url=or,this.headers=new Headers(lr),this.schemaName=cr,this.fetch=ur}from(or){if(!or||typeof or!="string"||or.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new PostgrestQueryBuilder(new URL(`${this.url}/${or}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(or){return new ku(this.url,{headers:this.headers,schema:or,fetch:this.fetch})}rpc(or,lr={},{head:cr=!1,get:ur=!1,count:dr}={}){var hr;let pr;const mr=new URL(`${this.url}/rpc/${or}`);let fr;const xr=gr=>gr!==null&&typeof gr=="object"&&(!Array.isArray(gr)||gr.some(xr)),Er=cr&&Object.values(lr).some(xr);Er?(pr="POST",fr=lr):cr||ur?(pr=cr?"HEAD":"GET",Object.entries(lr).filter(([gr,yr])=>yr!==void 0).map(([gr,yr])=>[gr,Array.isArray(yr)?`{${yr.join(",")}}`:`${yr}`]).forEach(([gr,yr])=>{mr.searchParams.append(gr,yr)})):(pr="POST",fr=lr);const vr=new Headers(this.headers);return Er?vr.set("Prefer",dr?`count=${dr},return=minimal`:"return=minimal"):dr&&vr.set("Prefer",`count=${dr}`),new PostgrestFilterBuilder({method:pr,url:mr,headers:vr,schema:this.schemaName,body:fr,fetch:(hr=this.fetch)!==null&&hr!==void 0?hr:fetch})}};class WebSocketFactory{constructor(){}static detectEnvironment(){var or;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((or=navigator.userAgent)===null||or===void 0)&&or.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const lr=globalThis.process;if(lr){const cr=lr.versions;if(cr&&cr.node){const ur=cr.node,dr=parseInt(ur.replace(/^v/,"").split(".")[0]);return dr>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${dr} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${dr} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const or=this.detectEnvironment();if(or.constructor)return or.constructor;let lr=or.error||"WebSocket not supported in this environment.";throw or.workaround&&(lr+=`

Suggested solution: ${or.workaround}`),new Error(lr)}static createWebSocket(or,lr){const cr=this.getWebSocketConstructor();return new cr(or,lr)}static isWebSocketSupported(){try{const or=this.detectEnvironment();return or.type==="native"||or.type==="ws"}catch{return!1}}}const version$3="2.93.1",DEFAULT_VERSION=`realtime-js/${version$3}`,VSN_1_0_0="1.0.0",VSN_2_0_0="2.0.0",DEFAULT_VSN=VSN_2_0_0,DEFAULT_TIMEOUT=1e4,WS_CLOSE_NORMAL=1e3,MAX_PUSH_BUFFER_SIZE=100;var SOCKET_STATES;(function(ar){ar[ar.connecting=0]="connecting",ar[ar.open=1]="open",ar[ar.closing=2]="closing",ar[ar.closed=3]="closed"})(SOCKET_STATES||(SOCKET_STATES={}));var CHANNEL_STATES;(function(ar){ar.closed="closed",ar.errored="errored",ar.joined="joined",ar.joining="joining",ar.leaving="leaving"})(CHANNEL_STATES||(CHANNEL_STATES={}));var CHANNEL_EVENTS;(function(ar){ar.close="phx_close",ar.error="phx_error",ar.join="phx_join",ar.reply="phx_reply",ar.leave="phx_leave",ar.access_token="access_token"})(CHANNEL_EVENTS||(CHANNEL_EVENTS={}));var TRANSPORTS;(function(ar){ar.websocket="websocket"})(TRANSPORTS||(TRANSPORTS={}));var CONNECTION_STATE;(function(ar){ar.Connecting="connecting",ar.Open="open",ar.Closing="closing",ar.Closed="closed"})(CONNECTION_STATE||(CONNECTION_STATE={}));class Serializer{constructor(or){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=or??[]}encode(or,lr){if(or.event===this.BROADCAST_EVENT&&!(or.payload instanceof ArrayBuffer)&&typeof or.payload.event=="string")return lr(this._binaryEncodeUserBroadcastPush(or));let cr=[or.join_ref,or.ref,or.topic,or.event,or.payload];return lr(JSON.stringify(cr))}_binaryEncodeUserBroadcastPush(or){var lr;return this._isArrayBuffer((lr=or.payload)===null||lr===void 0?void 0:lr.payload)?this._encodeBinaryUserBroadcastPush(or):this._encodeJsonUserBroadcastPush(or)}_encodeBinaryUserBroadcastPush(or){var lr,cr;const ur=(cr=(lr=or.payload)===null||lr===void 0?void 0:lr.payload)!==null&&cr!==void 0?cr:new ArrayBuffer(0);return this._encodeUserBroadcastPush(or,this.BINARY_ENCODING,ur)}_encodeJsonUserBroadcastPush(or){var lr,cr;const ur=(cr=(lr=or.payload)===null||lr===void 0?void 0:lr.payload)!==null&&cr!==void 0?cr:{},hr=new TextEncoder().encode(JSON.stringify(ur)).buffer;return this._encodeUserBroadcastPush(or,this.JSON_ENCODING,hr)}_encodeUserBroadcastPush(or,lr,cr){var ur,dr;const hr=or.topic,pr=(ur=or.ref)!==null&&ur!==void 0?ur:"",mr=(dr=or.join_ref)!==null&&dr!==void 0?dr:"",fr=or.payload.event,xr=this.allowedMetadataKeys?this._pick(or.payload,this.allowedMetadataKeys):{},Er=Object.keys(xr).length===0?"":JSON.stringify(xr);if(mr.length>255)throw new Error(`joinRef length ${mr.length} exceeds maximum of 255`);if(pr.length>255)throw new Error(`ref length ${pr.length} exceeds maximum of 255`);if(hr.length>255)throw new Error(`topic length ${hr.length} exceeds maximum of 255`);if(fr.length>255)throw new Error(`userEvent length ${fr.length} exceeds maximum of 255`);if(Er.length>255)throw new Error(`metadata length ${Er.length} exceeds maximum of 255`);const vr=this.USER_BROADCAST_PUSH_META_LENGTH+mr.length+pr.length+hr.length+fr.length+Er.length,gr=new ArrayBuffer(this.HEADER_LENGTH+vr);let yr=new DataView(gr),br=0;yr.setUint8(br++,this.KINDS.userBroadcastPush),yr.setUint8(br++,mr.length),yr.setUint8(br++,pr.length),yr.setUint8(br++,hr.length),yr.setUint8(br++,fr.length),yr.setUint8(br++,Er.length),yr.setUint8(br++,lr),Array.from(mr,jr=>yr.setUint8(br++,jr.charCodeAt(0))),Array.from(pr,jr=>yr.setUint8(br++,jr.charCodeAt(0))),Array.from(hr,jr=>yr.setUint8(br++,jr.charCodeAt(0))),Array.from(fr,jr=>yr.setUint8(br++,jr.charCodeAt(0))),Array.from(Er,jr=>yr.setUint8(br++,jr.charCodeAt(0)));var _r=new Uint8Array(gr.byteLength+cr.byteLength);return _r.set(new Uint8Array(gr),0),_r.set(new Uint8Array(cr),gr.byteLength),_r.buffer}decode(or,lr){if(this._isArrayBuffer(or)){let cr=this._binaryDecode(or);return lr(cr)}if(typeof or=="string"){const cr=JSON.parse(or),[ur,dr,hr,pr,mr]=cr;return lr({join_ref:ur,ref:dr,topic:hr,event:pr,payload:mr})}return lr({})}_binaryDecode(or){const lr=new DataView(or),cr=lr.getUint8(0),ur=new TextDecoder;switch(cr){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(or,lr,ur)}}_decodeUserBroadcast(or,lr,cr){const ur=lr.getUint8(1),dr=lr.getUint8(2),hr=lr.getUint8(3),pr=lr.getUint8(4);let mr=this.HEADER_LENGTH+4;const fr=cr.decode(or.slice(mr,mr+ur));mr=mr+ur;const xr=cr.decode(or.slice(mr,mr+dr));mr=mr+dr;const Er=cr.decode(or.slice(mr,mr+hr));mr=mr+hr;const vr=or.slice(mr,or.byteLength),gr=pr===this.JSON_ENCODING?JSON.parse(cr.decode(vr)):vr,yr={type:this.BROADCAST_EVENT,event:xr,payload:gr};return hr>0&&(yr.meta=JSON.parse(Er)),{join_ref:null,ref:null,topic:fr,event:this.BROADCAST_EVENT,payload:yr}}_isArrayBuffer(or){var lr;return or instanceof ArrayBuffer||((lr=or==null?void 0:or.constructor)===null||lr===void 0?void 0:lr.name)==="ArrayBuffer"}_pick(or,lr){return!or||typeof or!="object"?{}:Object.fromEntries(Object.entries(or).filter(([cr])=>lr.includes(cr)))}}class Timer{constructor(or,lr){this.callback=or,this.timerCalc=lr,this.timer=void 0,this.tries=0,this.callback=or,this.timerCalc=lr}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var PostgresTypes;(function(ar){ar.abstime="abstime",ar.bool="bool",ar.date="date",ar.daterange="daterange",ar.float4="float4",ar.float8="float8",ar.int2="int2",ar.int4="int4",ar.int4range="int4range",ar.int8="int8",ar.int8range="int8range",ar.json="json",ar.jsonb="jsonb",ar.money="money",ar.numeric="numeric",ar.oid="oid",ar.reltime="reltime",ar.text="text",ar.time="time",ar.timestamp="timestamp",ar.timestamptz="timestamptz",ar.timetz="timetz",ar.tsrange="tsrange",ar.tstzrange="tstzrange"})(PostgresTypes||(PostgresTypes={}));const convertChangeData=(ar,or,lr={})=>{var cr;const ur=(cr=lr.skipTypes)!==null&&cr!==void 0?cr:[];return or?Object.keys(or).reduce((dr,hr)=>(dr[hr]=convertColumn(hr,ar,or,ur),dr),{}):{}},convertColumn=(ar,or,lr,cr)=>{const ur=or.find(pr=>pr.name===ar),dr=ur==null?void 0:ur.type,hr=lr[ar];return dr&&!cr.includes(dr)?convertCell(dr,hr):noop$1(hr)},convertCell=(ar,or)=>{if(ar.charAt(0)==="_"){const lr=ar.slice(1,ar.length);return toArray(or,lr)}switch(ar){case PostgresTypes.bool:return toBoolean(or);case PostgresTypes.float4:case PostgresTypes.float8:case PostgresTypes.int2:case PostgresTypes.int4:case PostgresTypes.int8:case PostgresTypes.numeric:case PostgresTypes.oid:return toNumber(or);case PostgresTypes.json:case PostgresTypes.jsonb:return toJson(or);case PostgresTypes.timestamp:return toTimestampString(or);case PostgresTypes.abstime:case PostgresTypes.date:case PostgresTypes.daterange:case PostgresTypes.int4range:case PostgresTypes.int8range:case PostgresTypes.money:case PostgresTypes.reltime:case PostgresTypes.text:case PostgresTypes.time:case PostgresTypes.timestamptz:case PostgresTypes.timetz:case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return noop$1(or);default:return noop$1(or)}},noop$1=ar=>ar,toBoolean=ar=>{switch(ar){case"t":return!0;case"f":return!1;default:return ar}},toNumber=ar=>{if(typeof ar=="string"){const or=parseFloat(ar);if(!Number.isNaN(or))return or}return ar},toJson=ar=>{if(typeof ar=="string")try{return JSON.parse(ar)}catch{return ar}return ar},toArray=(ar,or)=>{if(typeof ar!="string")return ar;const lr=ar.length-1,cr=ar[lr];if(ar[0]==="{"&&cr==="}"){let dr;const hr=ar.slice(1,lr);try{dr=JSON.parse("["+hr+"]")}catch{dr=hr?hr.split(","):[]}return dr.map(pr=>convertCell(or,pr))}return ar},toTimestampString=ar=>typeof ar=="string"?ar.replace(" ","T"):ar,httpEndpointURL=ar=>{const or=new URL(ar);return or.protocol=or.protocol.replace(/^ws/i,"http"),or.pathname=or.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),or.pathname===""||or.pathname==="/"?or.pathname="/api/broadcast":or.pathname=or.pathname+"/api/broadcast",or.href};class Push{constructor(or,lr,cr={},ur=DEFAULT_TIMEOUT){this.channel=or,this.event=lr,this.payload=cr,this.timeout=ur,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(or){this.timeout=or,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(or){this.payload=Object.assign(Object.assign({},this.payload),or)}receive(or,lr){var cr;return this._hasReceived(or)&&lr((cr=this.receivedResp)===null||cr===void 0?void 0:cr.response),this.recHooks.push({status:or,callback:lr}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const or=lr=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=lr,this._matchReceive(lr)};this.channel._on(this.refEvent,{},or),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(or,lr){this.refEvent&&this.channel._trigger(this.refEvent,{status:or,response:lr})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:or,response:lr}){this.recHooks.filter(cr=>cr.status===or).forEach(cr=>cr.callback(lr))}_hasReceived(or){return this.receivedResp&&this.receivedResp.status===or}}var REALTIME_PRESENCE_LISTEN_EVENTS;(function(ar){ar.SYNC="sync",ar.JOIN="join",ar.LEAVE="leave"})(REALTIME_PRESENCE_LISTEN_EVENTS||(REALTIME_PRESENCE_LISTEN_EVENTS={}));class RealtimePresence{constructor(or,lr){this.channel=or,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const cr=(lr==null?void 0:lr.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(cr.state,{},ur=>{const{onJoin:dr,onLeave:hr,onSync:pr}=this.caller;this.joinRef=this.channel._joinRef(),this.state=RealtimePresence.syncState(this.state,ur,dr,hr),this.pendingDiffs.forEach(mr=>{this.state=RealtimePresence.syncDiff(this.state,mr,dr,hr)}),this.pendingDiffs=[],pr()}),this.channel._on(cr.diff,{},ur=>{const{onJoin:dr,onLeave:hr,onSync:pr}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(ur):(this.state=RealtimePresence.syncDiff(this.state,ur,dr,hr),pr())}),this.onJoin((ur,dr,hr)=>{this.channel._trigger("presence",{event:"join",key:ur,currentPresences:dr,newPresences:hr})}),this.onLeave((ur,dr,hr)=>{this.channel._trigger("presence",{event:"leave",key:ur,currentPresences:dr,leftPresences:hr})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(or,lr,cr,ur){const dr=this.cloneDeep(or),hr=this.transformState(lr),pr={},mr={};return this.map(dr,(fr,xr)=>{hr[fr]||(mr[fr]=xr)}),this.map(hr,(fr,xr)=>{const Er=dr[fr];if(Er){const vr=xr.map(_r=>_r.presence_ref),gr=Er.map(_r=>_r.presence_ref),yr=xr.filter(_r=>gr.indexOf(_r.presence_ref)<0),br=Er.filter(_r=>vr.indexOf(_r.presence_ref)<0);yr.length>0&&(pr[fr]=yr),br.length>0&&(mr[fr]=br)}else pr[fr]=xr}),this.syncDiff(dr,{joins:pr,leaves:mr},cr,ur)}static syncDiff(or,lr,cr,ur){const{joins:dr,leaves:hr}={joins:this.transformState(lr.joins),leaves:this.transformState(lr.leaves)};return cr||(cr=()=>{}),ur||(ur=()=>{}),this.map(dr,(pr,mr)=>{var fr;const xr=(fr=or[pr])!==null&&fr!==void 0?fr:[];if(or[pr]=this.cloneDeep(mr),xr.length>0){const Er=or[pr].map(gr=>gr.presence_ref),vr=xr.filter(gr=>Er.indexOf(gr.presence_ref)<0);or[pr].unshift(...vr)}cr(pr,xr,mr)}),this.map(hr,(pr,mr)=>{let fr=or[pr];if(!fr)return;const xr=mr.map(Er=>Er.presence_ref);fr=fr.filter(Er=>xr.indexOf(Er.presence_ref)<0),or[pr]=fr,ur(pr,fr,mr),fr.length===0&&delete or[pr]}),or}static map(or,lr){return Object.getOwnPropertyNames(or).map(cr=>lr(cr,or[cr]))}static transformState(or){return or=this.cloneDeep(or),Object.getOwnPropertyNames(or).reduce((lr,cr)=>{const ur=or[cr];return"metas"in ur?lr[cr]=ur.metas.map(dr=>(dr.presence_ref=dr.phx_ref,delete dr.phx_ref,delete dr.phx_ref_prev,dr)):lr[cr]=ur,lr},{})}static cloneDeep(or){return JSON.parse(JSON.stringify(or))}onJoin(or){this.caller.onJoin=or}onLeave(or){this.caller.onLeave=or}onSync(or){this.caller.onSync=or}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var REALTIME_POSTGRES_CHANGES_LISTEN_EVENT;(function(ar){ar.ALL="*",ar.INSERT="INSERT",ar.UPDATE="UPDATE",ar.DELETE="DELETE"})(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT||(REALTIME_POSTGRES_CHANGES_LISTEN_EVENT={}));var REALTIME_LISTEN_TYPES;(function(ar){ar.BROADCAST="broadcast",ar.PRESENCE="presence",ar.POSTGRES_CHANGES="postgres_changes",ar.SYSTEM="system"})(REALTIME_LISTEN_TYPES||(REALTIME_LISTEN_TYPES={}));var REALTIME_SUBSCRIBE_STATES;(function(ar){ar.SUBSCRIBED="SUBSCRIBED",ar.TIMED_OUT="TIMED_OUT",ar.CLOSED="CLOSED",ar.CHANNEL_ERROR="CHANNEL_ERROR"})(REALTIME_SUBSCRIBE_STATES||(REALTIME_SUBSCRIBE_STATES={}));class RealtimeChannel{constructor(or,lr={config:{}},cr){var ur,dr;if(this.topic=or,this.params=lr,this.socket=cr,this.bindings={},this.state=CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=or.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},lr.config),this.timeout=this.socket.timeout,this.joinPush=new Push(this,CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new Timer(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(hr=>hr.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=CHANNEL_STATES.closed,this.socket._remove(this)}),this._onError(hr=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,hr),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",hr=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,hr),this.state=CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this._on(CHANNEL_EVENTS.reply,{},(hr,pr)=>{this._trigger(this._replyEventName(pr),hr)}),this.presence=new RealtimePresence(this),this.broadcastEndpointURL=httpEndpointURL(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((dr=(ur=this.params.config)===null||ur===void 0?void 0:ur.broadcast)===null||dr===void 0)&&dr.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(or,lr=this.timeout){var cr,ur,dr;if(this.socket.isConnected()||this.socket.connect(),this.state==CHANNEL_STATES.closed){const{config:{broadcast:hr,presence:pr,private:mr}}=this.params,fr=(ur=(cr=this.bindings.postgres_changes)===null||cr===void 0?void 0:cr.map(gr=>gr.filter))!==null&&ur!==void 0?ur:[],xr=!!this.bindings[REALTIME_LISTEN_TYPES.PRESENCE]&&this.bindings[REALTIME_LISTEN_TYPES.PRESENCE].length>0||((dr=this.params.config.presence)===null||dr===void 0?void 0:dr.enabled)===!0,Er={},vr={broadcast:hr,presence:Object.assign(Object.assign({},pr),{enabled:xr}),postgres_changes:fr,private:mr};this.socket.accessTokenValue&&(Er.access_token=this.socket.accessTokenValue),this._onError(gr=>or==null?void 0:or(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,gr)),this._onClose(()=>or==null?void 0:or(REALTIME_SUBSCRIBE_STATES.CLOSED)),this.updateJoinPayload(Object.assign({config:vr},Er)),this.joinedOnce=!0,this._rejoin(lr),this.joinPush.receive("ok",async({postgres_changes:gr})=>{var yr;if(this.socket._isManualToken()||this.socket.setAuth(),gr===void 0){or==null||or(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}else{const br=this.bindings.postgres_changes,_r=(yr=br==null?void 0:br.length)!==null&&yr!==void 0?yr:0,jr=[];for(let wr=0;wr<_r;wr++){const Sr=br[wr],{filter:{event:Tr,schema:Rr,table:Nr,filter:Cr}}=Sr,kr=gr&&gr[wr];if(kr&&kr.event===Tr&&RealtimeChannel.isFilterValueEqual(kr.schema,Rr)&&RealtimeChannel.isFilterValueEqual(kr.table,Nr)&&RealtimeChannel.isFilterValueEqual(kr.filter,Cr))jr.push(Object.assign(Object.assign({},Sr),{id:kr.id}));else{this.unsubscribe(),this.state=CHANNEL_STATES.errored,or==null||or(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=jr,or&&or(REALTIME_SUBSCRIBE_STATES.SUBSCRIBED);return}}).receive("error",gr=>{this.state=CHANNEL_STATES.errored,or==null||or(REALTIME_SUBSCRIBE_STATES.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(gr).join(", ")||"error")))}).receive("timeout",()=>{or==null||or(REALTIME_SUBSCRIBE_STATES.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(or,lr={}){return await this.send({type:"presence",event:"track",payload:or},lr.timeout||this.timeout)}async untrack(or={}){return await this.send({type:"presence",event:"untrack"},or)}on(or,lr,cr){return this.state===CHANNEL_STATES.joined&&or===REALTIME_LISTEN_TYPES.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(or,lr,cr)}async httpSend(or,lr,cr={}){var ur;if(lr==null)return Promise.reject("Payload is required for httpSend()");const dr={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(dr.Authorization=`Bearer ${this.socket.accessTokenValue}`);const hr={method:"POST",headers:dr,body:JSON.stringify({messages:[{topic:this.subTopic,event:or,payload:lr,private:this.private}]})},pr=await this._fetchWithTimeout(this.broadcastEndpointURL,hr,(ur=cr.timeout)!==null&&ur!==void 0?ur:this.timeout);if(pr.status===202)return{success:!0};let mr=pr.statusText;try{const fr=await pr.json();mr=fr.error||fr.message||mr}catch{}return Promise.reject(new Error(mr))}async send(or,lr={}){var cr,ur;if(!this._canPush()&&or.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:dr,payload:hr}=or,pr={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(pr.Authorization=`Bearer ${this.socket.accessTokenValue}`);const mr={method:"POST",headers:pr,body:JSON.stringify({messages:[{topic:this.subTopic,event:dr,payload:hr,private:this.private}]})};try{const fr=await this._fetchWithTimeout(this.broadcastEndpointURL,mr,(cr=lr.timeout)!==null&&cr!==void 0?cr:this.timeout);return await((ur=fr.body)===null||ur===void 0?void 0:ur.cancel()),fr.ok?"ok":"error"}catch(fr){return fr.name==="AbortError"?"timed out":"error"}}else return new Promise(dr=>{var hr,pr,mr;const fr=this._push(or.type,or,lr.timeout||this.timeout);or.type==="broadcast"&&!(!((mr=(pr=(hr=this.params)===null||hr===void 0?void 0:hr.config)===null||pr===void 0?void 0:pr.broadcast)===null||mr===void 0)&&mr.ack)&&dr("ok"),fr.receive("ok",()=>dr("ok")),fr.receive("error",()=>dr("error")),fr.receive("timeout",()=>dr("timed out"))})}updateJoinPayload(or){this.joinPush.updatePayload(or)}unsubscribe(or=this.timeout){this.state=CHANNEL_STATES.leaving;const lr=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(CHANNEL_EVENTS.close,"leave",this._joinRef())};this.joinPush.destroy();let cr=null;return new Promise(ur=>{cr=new Push(this,CHANNEL_EVENTS.leave,{},or),cr.receive("ok",()=>{lr(),ur("ok")}).receive("timeout",()=>{lr(),ur("timed out")}).receive("error",()=>{ur("error")}),cr.send(),this._canPush()||cr.trigger("ok",{})}).finally(()=>{cr==null||cr.destroy()})}teardown(){this.pushBuffer.forEach(or=>or.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=CHANNEL_STATES.closed,this.bindings={}}async _fetchWithTimeout(or,lr,cr){const ur=new AbortController,dr=setTimeout(()=>ur.abort(),cr),hr=await this.socket.fetch(or,Object.assign(Object.assign({},lr),{signal:ur.signal}));return clearTimeout(dr),hr}_push(or,lr,cr=this.timeout){if(!this.joinedOnce)throw`tried to push '${or}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let ur=new Push(this,or,lr,cr);return this._canPush()?ur.send():this._addToPushBuffer(ur),ur}_addToPushBuffer(or){if(or.startTimeout(),this.pushBuffer.push(or),this.pushBuffer.length>MAX_PUSH_BUFFER_SIZE){const lr=this.pushBuffer.shift();lr&&(lr.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${lr.event}`,lr.payload))}}_onMessage(or,lr,cr){return lr}_isMember(or){return this.topic===or}_joinRef(){return this.joinPush.ref}_trigger(or,lr,cr){var ur,dr;const hr=or.toLocaleLowerCase(),{close:pr,error:mr,leave:fr,join:xr}=CHANNEL_EVENTS;if(cr&&[pr,mr,fr,xr].indexOf(hr)>=0&&cr!==this._joinRef())return;let vr=this._onMessage(hr,lr,cr);if(lr&&!vr)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(hr)?(ur=this.bindings.postgres_changes)===null||ur===void 0||ur.filter(gr=>{var yr,br,_r;return((yr=gr.filter)===null||yr===void 0?void 0:yr.event)==="*"||((_r=(br=gr.filter)===null||br===void 0?void 0:br.event)===null||_r===void 0?void 0:_r.toLocaleLowerCase())===hr}).map(gr=>gr.callback(vr,cr)):(dr=this.bindings[hr])===null||dr===void 0||dr.filter(gr=>{var yr,br,_r,jr,wr,Sr;if(["broadcast","presence","postgres_changes"].includes(hr))if("id"in gr){const Tr=gr.id,Rr=(yr=gr.filter)===null||yr===void 0?void 0:yr.event;return Tr&&((br=lr.ids)===null||br===void 0?void 0:br.includes(Tr))&&(Rr==="*"||(Rr==null?void 0:Rr.toLocaleLowerCase())===((_r=lr.data)===null||_r===void 0?void 0:_r.type.toLocaleLowerCase()))}else{const Tr=(wr=(jr=gr==null?void 0:gr.filter)===null||jr===void 0?void 0:jr.event)===null||wr===void 0?void 0:wr.toLocaleLowerCase();return Tr==="*"||Tr===((Sr=lr==null?void 0:lr.event)===null||Sr===void 0?void 0:Sr.toLocaleLowerCase())}else return gr.type.toLocaleLowerCase()===hr}).map(gr=>{if(typeof vr=="object"&&"ids"in vr){const yr=vr.data,{schema:br,table:_r,commit_timestamp:jr,type:wr,errors:Sr}=yr;vr=Object.assign(Object.assign({},{schema:br,table:_r,commit_timestamp:jr,eventType:wr,new:{},old:{},errors:Sr}),this._getPayloadRecords(yr))}gr.callback(vr,cr)})}_isClosed(){return this.state===CHANNEL_STATES.closed}_isJoined(){return this.state===CHANNEL_STATES.joined}_isJoining(){return this.state===CHANNEL_STATES.joining}_isLeaving(){return this.state===CHANNEL_STATES.leaving}_replyEventName(or){return`chan_reply_${or}`}_on(or,lr,cr){const ur=or.toLocaleLowerCase(),dr={type:ur,filter:lr,callback:cr};return this.bindings[ur]?this.bindings[ur].push(dr):this.bindings[ur]=[dr],this}_off(or,lr){const cr=or.toLocaleLowerCase();return this.bindings[cr]&&(this.bindings[cr]=this.bindings[cr].filter(ur=>{var dr;return!(((dr=ur.type)===null||dr===void 0?void 0:dr.toLocaleLowerCase())===cr&&RealtimeChannel.isEqual(ur.filter,lr))})),this}static isEqual(or,lr){if(Object.keys(or).length!==Object.keys(lr).length)return!1;for(const cr in or)if(or[cr]!==lr[cr])return!1;return!0}static isFilterValueEqual(or,lr){return(or??void 0)===(lr??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(or){this._on(CHANNEL_EVENTS.close,{},or)}_onError(or){this._on(CHANNEL_EVENTS.error,{},lr=>or(lr))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(or=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=CHANNEL_STATES.joining,this.joinPush.resend(or))}_getPayloadRecords(or){const lr={new:{},old:{}};return(or.type==="INSERT"||or.type==="UPDATE")&&(lr.new=convertChangeData(or.columns,or.record)),(or.type==="UPDATE"||or.type==="DELETE")&&(lr.old=convertChangeData(or.columns,or.old_record)),lr}}const noop=()=>{},CONNECTION_TIMEOUTS={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},RECONNECT_INTERVALS=[1e3,2e3,5e3,1e4],DEFAULT_RECONNECT_FALLBACK=1e4,WORKER_SCRIPT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class RealtimeClient{constructor(or,lr){var cr;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=DEFAULT_TIMEOUT,this.transport=null,this.heartbeatIntervalMs=CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=noop,this.ref=0,this.reconnectTimer=null,this.vsn=DEFAULT_VSN,this.logger=noop,this.conn=null,this.sendBuffer=[],this.serializer=new Serializer,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=ur=>ur?(...dr)=>ur(...dr):(...dr)=>fetch(...dr),!(!((cr=lr==null?void 0:lr.params)===null||cr===void 0)&&cr.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=lr.params.apikey,this.endPoint=`${or}/${TRANSPORTS.websocket}`,this.httpEndpoint=httpEndpointURL(or),this._initializeOptions(lr),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(lr==null?void 0:lr.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=WebSocketFactory.createWebSocket(this.endpointURL())}catch(or){this._setConnectionState("disconnected");const lr=or.message;throw lr.includes("Node.js")?new Error(`${lr}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${lr}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(or,lr){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const cr=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(cr),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(or?this.conn.close(or,lr??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(or){const lr=await or.unsubscribe();return this.channels.length===0&&this.disconnect(),lr}async removeAllChannels(){const or=await Promise.all(this.channels.map(lr=>lr.unsubscribe()));return this.channels=[],this.disconnect(),or}log(or,lr,cr){this.logger(or,lr,cr)}connectionState(){switch(this.conn&&this.conn.readyState){case SOCKET_STATES.connecting:return CONNECTION_STATE.Connecting;case SOCKET_STATES.open:return CONNECTION_STATE.Open;case SOCKET_STATES.closing:return CONNECTION_STATE.Closing;default:return CONNECTION_STATE.Closed}}isConnected(){return this.connectionState()===CONNECTION_STATE.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(or,lr={config:{}}){const cr=`realtime:${or}`,ur=this.getChannels().find(dr=>dr.topic===cr);if(ur)return ur;{const dr=new RealtimeChannel(`realtime:${or}`,lr,this);return this.channels.push(dr),dr}}push(or){const{topic:lr,event:cr,payload:ur,ref:dr}=or,hr=()=>{this.encode(or,pr=>{var mr;(mr=this.conn)===null||mr===void 0||mr.send(pr)})};this.log("push",`${lr} ${cr} (${dr})`,ur),this.isConnected()?hr():this.sendBuffer.push(hr)}async setAuth(or=null){this._authPromise=this._performAuth(or);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var or;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(lr){this.log("error","error in heartbeat callback",lr)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(lr){this.log("error","error in heartbeat callback",lr)}this._wasManualDisconnect=!1,(or=this.conn)===null||or===void 0||or.close(WS_CLOSE_NORMAL,"heartbeat timeout"),setTimeout(()=>{var lr;this.isConnected()||(lr=this.reconnectTimer)===null||lr===void 0||lr.scheduleTimeout()},CONNECTION_TIMEOUTS.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(lr){this.log("error","error in heartbeat callback",lr)}this._setAuthSafely("heartbeat")}onHeartbeat(or){this.heartbeatCallback=or}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(or=>or()),this.sendBuffer=[])}_makeRef(){let or=this.ref+1;return or===this.ref?this.ref=0:this.ref=or,this.ref.toString()}_leaveOpenTopic(or){let lr=this.channels.find(cr=>cr.topic===or&&(cr._isJoined()||cr._isJoining()));lr&&(this.log("transport",`leaving duplicate topic "${or}"`),lr.unsubscribe())}_remove(or){this.channels=this.channels.filter(lr=>lr.topic!==or.topic)}_onConnMessage(or){this.decode(or.data,lr=>{if(lr.topic==="phoenix"&&lr.event==="phx_reply"&&lr.ref&&lr.ref===this.pendingHeartbeatRef){const fr=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(lr.payload.status==="ok"?"ok":"error",fr)}catch(xr){this.log("error","error in heartbeat callback",xr)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:cr,event:ur,payload:dr,ref:hr}=lr,pr=hr?`(${hr})`:"",mr=dr.status||"";this.log("receive",`${mr} ${cr} ${ur} ${pr}`.trim(),dr),this.channels.filter(fr=>fr._isMember(cr)).forEach(fr=>fr._trigger(ur,dr,hr)),this._triggerStateCallbacks("message",lr)})}_clearTimer(or){var lr;or==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):or==="reconnect"&&((lr=this.reconnectTimer)===null||lr===void 0||lr.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=or=>this._onConnError(or),this.conn.onmessage=or=>this._onConnMessage(or),this.conn.onclose=or=>this._onConnClose(or),this.conn.readyState===SOCKET_STATES.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===SOCKET_STATES.open||this.conn.readyState===SOCKET_STATES.connecting)try{this.conn.close()}catch(or){this.log("error","Error closing connection",or)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(or=>or.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(lr=>{this.log("error","error waiting for auth on connect",lr),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const or=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(or),this.workerRef.onerror=lr=>{this.log("worker","worker error",lr.message),this._terminateWorker()},this.workerRef.onmessage=lr=>{lr.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(or){var lr;this._setConnectionState("disconnected"),this.log("transport","close",or),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(lr=this.reconnectTimer)===null||lr===void 0||lr.scheduleTimeout(),this._triggerStateCallbacks("close",or)}_onConnError(or){this._setConnectionState("disconnected"),this.log("transport",`${or}`),this._triggerChanError(),this._triggerStateCallbacks("error",or);try{this.heartbeatCallback("error")}catch(lr){this.log("error","error in heartbeat callback",lr)}}_triggerChanError(){this.channels.forEach(or=>or._trigger(CHANNEL_EVENTS.error))}_appendParams(or,lr){if(Object.keys(lr).length===0)return or;const cr=or.match(/\?/)?"&":"?",ur=new URLSearchParams(lr);return`${or}${cr}${ur}`}_workerObjectUrl(or){let lr;if(or)lr=or;else{const cr=new Blob([WORKER_SCRIPT],{type:"application/javascript"});lr=URL.createObjectURL(cr)}return lr}_setConnectionState(or,lr=!1){this._connectionState=or,or==="connecting"?this._wasManualDisconnect=!1:or==="disconnecting"&&(this._wasManualDisconnect=lr)}async _performAuth(or=null){let lr,cr=!1;if(or)lr=or,cr=!0;else if(this.accessToken)try{lr=await this.accessToken()}catch(ur){this.log("error","Error fetching access token from callback",ur),lr=this.accessTokenValue}else lr=this.accessTokenValue;cr?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=lr&&(this.accessTokenValue=lr,this.channels.forEach(ur=>{const dr={access_token:lr,version:DEFAULT_VERSION};lr&&ur.updateJoinPayload(dr),ur.joinedOnce&&ur._isJoined()&&ur._push(CHANNEL_EVENTS.access_token,{access_token:lr})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(or="general"){this._isManualToken()||this.setAuth().catch(lr=>{this.log("error",`Error setting auth in ${or}`,lr)})}_triggerStateCallbacks(or,lr){try{this.stateChangeCallbacks[or].forEach(cr=>{try{cr(lr)}catch(ur){this.log("error",`error in ${or} callback`,ur)}})}catch(cr){this.log("error",`error triggering ${or} callbacks`,cr)}}_setupReconnectionTimer(){this.reconnectTimer=new Timer(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},CONNECTION_TIMEOUTS.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(or){var lr,cr,ur,dr,hr,pr,mr,fr,xr,Er,vr,gr;switch(this.transport=(lr=or==null?void 0:or.transport)!==null&&lr!==void 0?lr:null,this.timeout=(cr=or==null?void 0:or.timeout)!==null&&cr!==void 0?cr:DEFAULT_TIMEOUT,this.heartbeatIntervalMs=(ur=or==null?void 0:or.heartbeatIntervalMs)!==null&&ur!==void 0?ur:CONNECTION_TIMEOUTS.HEARTBEAT_INTERVAL,this.worker=(dr=or==null?void 0:or.worker)!==null&&dr!==void 0?dr:!1,this.accessToken=(hr=or==null?void 0:or.accessToken)!==null&&hr!==void 0?hr:null,this.heartbeatCallback=(pr=or==null?void 0:or.heartbeatCallback)!==null&&pr!==void 0?pr:noop,this.vsn=(mr=or==null?void 0:or.vsn)!==null&&mr!==void 0?mr:DEFAULT_VSN,or!=null&&or.params&&(this.params=or.params),or!=null&&or.logger&&(this.logger=or.logger),(or!=null&&or.logLevel||or!=null&&or.log_level)&&(this.logLevel=or.logLevel||or.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(fr=or==null?void 0:or.reconnectAfterMs)!==null&&fr!==void 0?fr:yr=>RECONNECT_INTERVALS[yr-1]||DEFAULT_RECONNECT_FALLBACK,this.vsn){case VSN_1_0_0:this.encode=(xr=or==null?void 0:or.encode)!==null&&xr!==void 0?xr:(yr,br)=>br(JSON.stringify(yr)),this.decode=(Er=or==null?void 0:or.decode)!==null&&Er!==void 0?Er:(yr,br)=>br(JSON.parse(yr));break;case VSN_2_0_0:this.encode=(vr=or==null?void 0:or.encode)!==null&&vr!==void 0?vr:this.serializer.encode.bind(this.serializer),this.decode=(gr=or==null?void 0:or.decode)!==null&&gr!==void 0?gr:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=or==null?void 0:or.workerUrl}}}var IcebergError=class extends Error{constructor(ar,or){var lr;super(ar),this.name="IcebergError",this.status=or.status,this.icebergType=or.icebergType,this.icebergCode=or.icebergCode,this.details=or.details,this.isCommitStateUnknown=or.icebergType==="CommitStateUnknownException"||[500,502,504].includes(or.status)&&((lr=or.icebergType)==null?void 0:lr.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function buildUrl(ar,or,lr){const cr=new URL(or,ar);if(lr)for(const[ur,dr]of Object.entries(lr))dr!==void 0&&cr.searchParams.set(ur,dr);return cr.toString()}async function buildAuthHeaders(ar){return!ar||ar.type==="none"?{}:ar.type==="bearer"?{Authorization:`Bearer ${ar.token}`}:ar.type==="header"?{[ar.name]:ar.value}:ar.type==="custom"?await ar.getHeaders():{}}function createFetchClient(ar){const or=ar.fetchImpl??globalThis.fetch;return{async request({method:lr,path:cr,query:ur,body:dr,headers:hr}){const pr=buildUrl(ar.baseUrl,cr,ur),mr=await buildAuthHeaders(ar.auth),fr=await or(pr,{method:lr,headers:{...dr?{"Content-Type":"application/json"}:{},...mr,...hr},body:dr?JSON.stringify(dr):void 0}),xr=await fr.text(),Er=(fr.headers.get("content-type")||"").includes("application/json"),vr=Er&&xr?JSON.parse(xr):xr;if(!fr.ok){const gr=Er?vr:void 0,yr=gr==null?void 0:gr.error;throw new IcebergError((yr==null?void 0:yr.message)??`Request failed with status ${fr.status}`,{status:fr.status,icebergType:yr==null?void 0:yr.type,icebergCode:yr==null?void 0:yr.code,details:gr})}return{status:fr.status,headers:fr.headers,data:vr}}}}function namespaceToPath(ar){return ar.join("")}var NamespaceOperations=class{constructor(ar,or=""){this.client=ar,this.prefix=or}async listNamespaces(ar){const or=ar?{parent:namespaceToPath(ar.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:or})).data.namespaces.map(cr=>({namespace:cr}))}async createNamespace(ar,or){const lr={namespace:ar.namespace,properties:or==null?void 0:or.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:lr})).data}async dropNamespace(ar){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${namespaceToPath(ar.namespace)}`})}async loadNamespaceMetadata(ar){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${namespaceToPath(ar.namespace)}`})).data.properties}}async namespaceExists(ar){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${namespaceToPath(ar.namespace)}`}),!0}catch(or){if(or instanceof IcebergError&&or.status===404)return!1;throw or}}async createNamespaceIfNotExists(ar,or){try{return await this.createNamespace(ar,or)}catch(lr){if(lr instanceof IcebergError&&lr.status===409)return;throw lr}}};function namespaceToPath2(ar){return ar.join("")}var TableOperations=class{constructor(ar,or="",lr){this.client=ar,this.prefix=or,this.accessDelegation=lr}async listTables(ar){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables`})).data.identifiers}async createTable(ar,or){const lr={};return this.accessDelegation&&(lr["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables`,body:or,headers:lr})).data.metadata}async updateTable(ar,or){const lr=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables/${ar.name}`,body:or});return{"metadata-location":lr.data["metadata-location"],metadata:lr.data.metadata}}async dropTable(ar,or){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables/${ar.name}`,query:{purgeRequested:String((or==null?void 0:or.purge)??!1)}})}async loadTable(ar){const or={};return this.accessDelegation&&(or["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables/${ar.name}`,headers:or})).data.metadata}async tableExists(ar){const or={};this.accessDelegation&&(or["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${namespaceToPath2(ar.namespace)}/tables/${ar.name}`,headers:or}),!0}catch(lr){if(lr instanceof IcebergError&&lr.status===404)return!1;throw lr}}async createTableIfNotExists(ar,or){try{return await this.createTable(ar,or)}catch(lr){if(lr instanceof IcebergError&&lr.status===409)return await this.loadTable({namespace:ar.namespace,name:or.name});throw lr}}},IcebergRestCatalog=class{constructor(ar){var cr;let or="v1";ar.catalogName&&(or+=`/${ar.catalogName}`);const lr=ar.baseUrl.endsWith("/")?ar.baseUrl:`${ar.baseUrl}/`;this.client=createFetchClient({baseUrl:lr,auth:ar.auth,fetchImpl:ar.fetch}),this.accessDelegation=(cr=ar.accessDelegation)==null?void 0:cr.join(","),this.namespaceOps=new NamespaceOperations(this.client,or),this.tableOps=new TableOperations(this.client,or,this.accessDelegation)}async listNamespaces(ar){return this.namespaceOps.listNamespaces(ar)}async createNamespace(ar,or){return this.namespaceOps.createNamespace(ar,or)}async dropNamespace(ar){await this.namespaceOps.dropNamespace(ar)}async loadNamespaceMetadata(ar){return this.namespaceOps.loadNamespaceMetadata(ar)}async listTables(ar){return this.tableOps.listTables(ar)}async createTable(ar,or){return this.tableOps.createTable(ar,or)}async updateTable(ar,or){return this.tableOps.updateTable(ar,or)}async dropTable(ar,or){await this.tableOps.dropTable(ar,or)}async loadTable(ar){return this.tableOps.loadTable(ar)}async namespaceExists(ar){return this.namespaceOps.namespaceExists(ar)}async tableExists(ar){return this.tableOps.tableExists(ar)}async createNamespaceIfNotExists(ar,or){return this.namespaceOps.createNamespaceIfNotExists(ar,or)}async createTableIfNotExists(ar,or){return this.tableOps.createTableIfNotExists(ar,or)}},StorageError=class extends Error{constructor(ar,or="storage",lr,cr){super(ar),this.__isStorageError=!0,this.namespace=or,this.name=or==="vectors"?"StorageVectorsError":"StorageError",this.status=lr,this.statusCode=cr}};function isStorageError(ar){return typeof ar=="object"&&ar!==null&&"__isStorageError"in ar}var StorageApiError=class extends StorageError{constructor(ar,or,lr,cr="storage"){super(ar,cr,or,lr),this.name=cr==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=or,this.statusCode=lr}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},StorageUnknownError=class extends StorageError{constructor(ar,or,lr="storage"){super(ar,lr),this.name=lr==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=or}};const resolveFetch$2=ar=>ar?(...or)=>ar(...or):(...or)=>fetch(...or),isPlainObject=ar=>{if(typeof ar!="object"||ar===null)return!1;const or=Object.getPrototypeOf(ar);return(or===null||or===Object.prototype||Object.getPrototypeOf(or)===null)&&!(Symbol.toStringTag in ar)&&!(Symbol.iterator in ar)},recursiveToCamel=ar=>{if(Array.isArray(ar))return ar.map(lr=>recursiveToCamel(lr));if(typeof ar=="function"||ar!==Object(ar))return ar;const or={};return Object.entries(ar).forEach(([lr,cr])=>{const ur=lr.replace(/([-_][a-z])/gi,dr=>dr.toUpperCase().replace(/[-_]/g,""));or[ur]=recursiveToCamel(cr)}),or},isValidBucketName=ar=>!ar||typeof ar!="string"||ar.length===0||ar.length>100||ar.trim()!==ar||ar.includes("/")||ar.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(ar);function _typeof$1(ar){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(or){return typeof or}:function(or){return or&&typeof Symbol=="function"&&or.constructor===Symbol&&or!==Symbol.prototype?"symbol":typeof or},_typeof$1(ar)}function toPrimitive$1(ar,or){if(_typeof$1(ar)!="object"||!ar)return ar;var lr=ar[Symbol.toPrimitive];if(lr!==void 0){var cr=lr.call(ar,or);if(_typeof$1(cr)!="object")return cr;throw new TypeError("@@toPrimitive must return a primitive value.")}return(or==="string"?String:Number)(ar)}function toPropertyKey$1(ar){var or=toPrimitive$1(ar,"string");return _typeof$1(or)=="symbol"?or:or+""}function _defineProperty$1(ar,or,lr){return(or=toPropertyKey$1(or))in ar?Object.defineProperty(ar,or,{value:lr,enumerable:!0,configurable:!0,writable:!0}):ar[or]=lr,ar}function ownKeys$1(ar,or){var lr=Object.keys(ar);if(Object.getOwnPropertySymbols){var cr=Object.getOwnPropertySymbols(ar);or&&(cr=cr.filter(function(ur){return Object.getOwnPropertyDescriptor(ar,ur).enumerable})),lr.push.apply(lr,cr)}return lr}function _objectSpread2$1(ar){for(var or=1;or<arguments.length;or++){var lr=arguments[or]!=null?arguments[or]:{};or%2?ownKeys$1(Object(lr),!0).forEach(function(cr){_defineProperty$1(ar,cr,lr[cr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ar,Object.getOwnPropertyDescriptors(lr)):ownKeys$1(Object(lr)).forEach(function(cr){Object.defineProperty(ar,cr,Object.getOwnPropertyDescriptor(lr,cr))})}return ar}const _getErrorMessage$1=ar=>{var or;return ar.msg||ar.message||ar.error_description||(typeof ar.error=="string"?ar.error:(or=ar.error)===null||or===void 0?void 0:or.message)||JSON.stringify(ar)},handleError$1=async(ar,or,lr,cr)=>{if(ar&&typeof ar=="object"&&"status"in ar&&"ok"in ar&&typeof ar.status=="number"&&!(lr!=null&&lr.noResolveJson)){const ur=ar,dr=ur.status||500;if(typeof ur.json=="function")ur.json().then(hr=>{const pr=(hr==null?void 0:hr.statusCode)||(hr==null?void 0:hr.code)||dr+"";or(new StorageApiError(_getErrorMessage$1(hr),dr,pr,cr))}).catch(()=>{if(cr==="vectors"){const hr=dr+"";or(new StorageApiError(ur.statusText||`HTTP ${dr} error`,dr,hr,cr))}else{const hr=dr+"";or(new StorageApiError(ur.statusText||`HTTP ${dr} error`,dr,hr,cr))}});else{const hr=dr+"";or(new StorageApiError(ur.statusText||`HTTP ${dr} error`,dr,hr,cr))}}else or(new StorageUnknownError(_getErrorMessage$1(ar),ar,cr))},_getRequestParams$1=(ar,or,lr,cr)=>{const ur={method:ar,headers:(or==null?void 0:or.headers)||{}};return ar==="GET"||ar==="HEAD"||!cr?_objectSpread2$1(_objectSpread2$1({},ur),lr):(isPlainObject(cr)?(ur.headers=_objectSpread2$1({"Content-Type":"application/json"},or==null?void 0:or.headers),ur.body=JSON.stringify(cr)):ur.body=cr,or!=null&&or.duplex&&(ur.duplex=or.duplex),_objectSpread2$1(_objectSpread2$1({},ur),lr))};async function _handleRequest$1(ar,or,lr,cr,ur,dr,hr){return new Promise((pr,mr)=>{ar(lr,_getRequestParams$1(or,cr,ur,dr)).then(fr=>{if(!fr.ok)throw fr;if(cr!=null&&cr.noResolveJson)return fr;if(hr==="vectors"){const xr=fr.headers.get("content-type");if(!xr||!xr.includes("application/json"))return{}}return fr.json()}).then(fr=>pr(fr)).catch(fr=>handleError$1(fr,mr,cr,hr))})}function createFetchApi(ar="storage"){return{get:async(or,lr,cr,ur)=>_handleRequest$1(or,"GET",lr,cr,ur,void 0,ar),post:async(or,lr,cr,ur,dr)=>_handleRequest$1(or,"POST",lr,ur,dr,cr,ar),put:async(or,lr,cr,ur,dr)=>_handleRequest$1(or,"PUT",lr,ur,dr,cr,ar),head:async(or,lr,cr,ur)=>_handleRequest$1(or,"HEAD",lr,_objectSpread2$1(_objectSpread2$1({},cr),{},{noResolveJson:!0}),ur,void 0,ar),remove:async(or,lr,cr,ur,dr)=>_handleRequest$1(or,"DELETE",lr,ur,dr,cr,ar)}}const defaultApi=createFetchApi("storage"),{get,post,put,head,remove}=defaultApi;var BaseApiClient=class{constructor(ar,or={},lr,cr="storage"){this.shouldThrowOnError=!1,this.url=ar,this.headers=or,this.fetch=resolveFetch$2(lr),this.namespace=cr}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(ar){var or=this;try{return{data:await ar(),error:null}}catch(lr){if(or.shouldThrowOnError)throw lr;if(isStorageError(lr))return{data:null,error:lr};throw lr}}},StreamDownloadBuilder=class{constructor(ar,or){this.downloadFn=ar,this.shouldThrowOnError=or}then(ar,or){return this.execute().then(ar,or)}async execute(){var ar=this;try{return{data:(await ar.downloadFn()).body,error:null}}catch(or){if(ar.shouldThrowOnError)throw or;if(isStorageError(or))return{data:null,error:or};throw or}}};let _Symbol$toStringTag;_Symbol$toStringTag=Symbol.toStringTag;var BlobDownloadBuilder=class{constructor(ar,or){this.downloadFn=ar,this.shouldThrowOnError=or,this[_Symbol$toStringTag]="BlobDownloadBuilder",this.promise=null}asStream(){return new StreamDownloadBuilder(this.downloadFn,this.shouldThrowOnError)}then(ar,or){return this.getPromise().then(ar,or)}catch(ar){return this.getPromise().catch(ar)}finally(ar){return this.getPromise().finally(ar)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var ar=this;try{return{data:await(await ar.downloadFn()).blob(),error:null}}catch(or){if(ar.shouldThrowOnError)throw or;if(isStorageError(or))return{data:null,error:or};throw or}}};const DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var StorageFileApi=class extends BaseApiClient{constructor(ar,or={},lr,cr){super(ar,or,cr,"storage"),this.bucketId=lr}async uploadOrUpdate(ar,or,lr,cr){var ur=this;return ur.handleOperation(async()=>{let dr;const hr=_objectSpread2$1(_objectSpread2$1({},DEFAULT_FILE_OPTIONS),cr);let pr=_objectSpread2$1(_objectSpread2$1({},ur.headers),ar==="POST"&&{"x-upsert":String(hr.upsert)});const mr=hr.metadata;typeof Blob<"u"&&lr instanceof Blob?(dr=new FormData,dr.append("cacheControl",hr.cacheControl),mr&&dr.append("metadata",ur.encodeMetadata(mr)),dr.append("",lr)):typeof FormData<"u"&&lr instanceof FormData?(dr=lr,dr.has("cacheControl")||dr.append("cacheControl",hr.cacheControl),mr&&!dr.has("metadata")&&dr.append("metadata",ur.encodeMetadata(mr))):(dr=lr,pr["cache-control"]=`max-age=${hr.cacheControl}`,pr["content-type"]=hr.contentType,mr&&(pr["x-metadata"]=ur.toBase64(ur.encodeMetadata(mr))),(typeof ReadableStream<"u"&&dr instanceof ReadableStream||dr&&typeof dr=="object"&&"pipe"in dr&&typeof dr.pipe=="function")&&!hr.duplex&&(hr.duplex="half")),cr!=null&&cr.headers&&(pr=_objectSpread2$1(_objectSpread2$1({},pr),cr.headers));const fr=ur._removeEmptyFolders(or),xr=ur._getFinalPath(fr),Er=await(ar=="PUT"?put:post)(ur.fetch,`${ur.url}/object/${xr}`,dr,_objectSpread2$1({headers:pr},hr!=null&&hr.duplex?{duplex:hr.duplex}:{}));return{path:fr,id:Er.Id,fullPath:Er.Key}})}async upload(ar,or,lr){return this.uploadOrUpdate("POST",ar,or,lr)}async uploadToSignedUrl(ar,or,lr,cr){var ur=this;const dr=ur._removeEmptyFolders(ar),hr=ur._getFinalPath(dr),pr=new URL(ur.url+`/object/upload/sign/${hr}`);return pr.searchParams.set("token",or),ur.handleOperation(async()=>{let mr;const fr=_objectSpread2$1({upsert:DEFAULT_FILE_OPTIONS.upsert},cr),xr=_objectSpread2$1(_objectSpread2$1({},ur.headers),{"x-upsert":String(fr.upsert)});return typeof Blob<"u"&&lr instanceof Blob?(mr=new FormData,mr.append("cacheControl",fr.cacheControl),mr.append("",lr)):typeof FormData<"u"&&lr instanceof FormData?(mr=lr,mr.append("cacheControl",fr.cacheControl)):(mr=lr,xr["cache-control"]=`max-age=${fr.cacheControl}`,xr["content-type"]=fr.contentType),{path:dr,fullPath:(await put(ur.fetch,pr.toString(),mr,{headers:xr})).Key}})}async createSignedUploadUrl(ar,or){var lr=this;return lr.handleOperation(async()=>{let cr=lr._getFinalPath(ar);const ur=_objectSpread2$1({},lr.headers);or!=null&&or.upsert&&(ur["x-upsert"]="true");const dr=await post(lr.fetch,`${lr.url}/object/upload/sign/${cr}`,{},{headers:ur}),hr=new URL(lr.url+dr.url),pr=hr.searchParams.get("token");if(!pr)throw new StorageError("No token returned by API");return{signedUrl:hr.toString(),path:ar,token:pr}})}async update(ar,or,lr){return this.uploadOrUpdate("PUT",ar,or,lr)}async move(ar,or,lr){var cr=this;return cr.handleOperation(async()=>await post(cr.fetch,`${cr.url}/object/move`,{bucketId:cr.bucketId,sourceKey:ar,destinationKey:or,destinationBucket:lr==null?void 0:lr.destinationBucket},{headers:cr.headers}))}async copy(ar,or,lr){var cr=this;return cr.handleOperation(async()=>({path:(await post(cr.fetch,`${cr.url}/object/copy`,{bucketId:cr.bucketId,sourceKey:ar,destinationKey:or,destinationBucket:lr==null?void 0:lr.destinationBucket},{headers:cr.headers})).Key}))}async createSignedUrl(ar,or,lr){var cr=this;return cr.handleOperation(async()=>{let ur=cr._getFinalPath(ar),dr=await post(cr.fetch,`${cr.url}/object/sign/${ur}`,_objectSpread2$1({expiresIn:or},lr!=null&&lr.transform?{transform:lr.transform}:{}),{headers:cr.headers});const hr=lr!=null&&lr.download?`&download=${lr.download===!0?"":lr.download}`:"";return{signedUrl:encodeURI(`${cr.url}${dr.signedURL}${hr}`)}})}async createSignedUrls(ar,or,lr){var cr=this;return cr.handleOperation(async()=>{const ur=await post(cr.fetch,`${cr.url}/object/sign/${cr.bucketId}`,{expiresIn:or,paths:ar},{headers:cr.headers}),dr=lr!=null&&lr.download?`&download=${lr.download===!0?"":lr.download}`:"";return ur.map(hr=>_objectSpread2$1(_objectSpread2$1({},hr),{},{signedUrl:hr.signedURL?encodeURI(`${cr.url}${hr.signedURL}${dr}`):null}))})}download(ar,or){const lr=typeof(or==null?void 0:or.transform)<"u"?"render/image/authenticated":"object",cr=this.transformOptsToQueryString((or==null?void 0:or.transform)||{}),ur=cr?`?${cr}`:"",dr=this._getFinalPath(ar),hr=()=>get(this.fetch,`${this.url}/${lr}/${dr}${ur}`,{headers:this.headers,noResolveJson:!0});return new BlobDownloadBuilder(hr,this.shouldThrowOnError)}async info(ar){var or=this;const lr=or._getFinalPath(ar);return or.handleOperation(async()=>recursiveToCamel(await get(or.fetch,`${or.url}/object/info/${lr}`,{headers:or.headers})))}async exists(ar){var or=this;const lr=or._getFinalPath(ar);try{return await head(or.fetch,`${or.url}/object/${lr}`,{headers:or.headers}),{data:!0,error:null}}catch(cr){if(or.shouldThrowOnError)throw cr;if(isStorageError(cr)&&cr instanceof StorageUnknownError){const ur=cr.originalError;if([400,404].includes(ur==null?void 0:ur.status))return{data:!1,error:cr}}throw cr}}getPublicUrl(ar,or){const lr=this._getFinalPath(ar),cr=[],ur=or!=null&&or.download?`download=${or.download===!0?"":or.download}`:"";ur!==""&&cr.push(ur);const dr=typeof(or==null?void 0:or.transform)<"u"?"render/image":"object",hr=this.transformOptsToQueryString((or==null?void 0:or.transform)||{});hr!==""&&cr.push(hr);let pr=cr.join("&");return pr!==""&&(pr=`?${pr}`),{data:{publicUrl:encodeURI(`${this.url}/${dr}/public/${lr}${pr}`)}}}async remove(ar){var or=this;return or.handleOperation(async()=>await remove(or.fetch,`${or.url}/object/${or.bucketId}`,{prefixes:ar},{headers:or.headers}))}async list(ar,or,lr){var cr=this;return cr.handleOperation(async()=>{const ur=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},DEFAULT_SEARCH_OPTIONS),or),{},{prefix:ar||""});return await post(cr.fetch,`${cr.url}/object/list/${cr.bucketId}`,ur,{headers:cr.headers},lr)})}async listV2(ar,or){var lr=this;return lr.handleOperation(async()=>{const cr=_objectSpread2$1({},ar);return await post(lr.fetch,`${lr.url}/object/list-v2/${lr.bucketId}`,cr,{headers:lr.headers},or)})}encodeMetadata(ar){return JSON.stringify(ar)}toBase64(ar){return typeof Buffer<"u"?Buffer.from(ar).toString("base64"):btoa(ar)}_getFinalPath(ar){return`${this.bucketId}/${ar.replace(/^\/+/,"")}`}_removeEmptyFolders(ar){return ar.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(ar){const or=[];return ar.width&&or.push(`width=${ar.width}`),ar.height&&or.push(`height=${ar.height}`),ar.resize&&or.push(`resize=${ar.resize}`),ar.format&&or.push(`format=${ar.format}`),ar.quality&&or.push(`quality=${ar.quality}`),or.join("&")}};const version$2="2.93.1",DEFAULT_HEADERS$2={"X-Client-Info":`storage-js/${version$2}`};var StorageBucketApi=class extends BaseApiClient{constructor(ar,or={},lr,cr){const ur=new URL(ar);cr!=null&&cr.useNewHostname&&/supabase\.(co|in|red)$/.test(ur.hostname)&&!ur.hostname.includes("storage.supabase.")&&(ur.hostname=ur.hostname.replace("supabase.","storage.supabase."));const dr=ur.href.replace(/\/$/,""),hr=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),or);super(dr,hr,lr,"storage")}async listBuckets(ar){var or=this;return or.handleOperation(async()=>{const lr=or.listBucketOptionsToQueryString(ar);return await get(or.fetch,`${or.url}/bucket${lr}`,{headers:or.headers})})}async getBucket(ar){var or=this;return or.handleOperation(async()=>await get(or.fetch,`${or.url}/bucket/${ar}`,{headers:or.headers}))}async createBucket(ar,or={public:!1}){var lr=this;return lr.handleOperation(async()=>await post(lr.fetch,`${lr.url}/bucket`,{id:ar,name:ar,type:or.type,public:or.public,file_size_limit:or.fileSizeLimit,allowed_mime_types:or.allowedMimeTypes},{headers:lr.headers}))}async updateBucket(ar,or){var lr=this;return lr.handleOperation(async()=>await put(lr.fetch,`${lr.url}/bucket/${ar}`,{id:ar,name:ar,public:or.public,file_size_limit:or.fileSizeLimit,allowed_mime_types:or.allowedMimeTypes},{headers:lr.headers}))}async emptyBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/bucket/${ar}/empty`,{},{headers:or.headers}))}async deleteBucket(ar){var or=this;return or.handleOperation(async()=>await remove(or.fetch,`${or.url}/bucket/${ar}`,{},{headers:or.headers}))}listBucketOptionsToQueryString(ar){const or={};return ar&&("limit"in ar&&(or.limit=String(ar.limit)),"offset"in ar&&(or.offset=String(ar.offset)),ar.search&&(or.search=ar.search),ar.sortColumn&&(or.sortColumn=ar.sortColumn),ar.sortOrder&&(or.sortOrder=ar.sortOrder)),Object.keys(or).length>0?"?"+new URLSearchParams(or).toString():""}},StorageAnalyticsClient=class extends BaseApiClient{constructor(ar,or={},lr){const cr=ar.replace(/\/$/,""),ur=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),or);super(cr,ur,lr,"storage")}async createBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/bucket`,{name:ar},{headers:or.headers}))}async listBuckets(ar){var or=this;return or.handleOperation(async()=>{const lr=new URLSearchParams;(ar==null?void 0:ar.limit)!==void 0&&lr.set("limit",ar.limit.toString()),(ar==null?void 0:ar.offset)!==void 0&&lr.set("offset",ar.offset.toString()),ar!=null&&ar.sortColumn&&lr.set("sortColumn",ar.sortColumn),ar!=null&&ar.sortOrder&&lr.set("sortOrder",ar.sortOrder),ar!=null&&ar.search&&lr.set("search",ar.search);const cr=lr.toString(),ur=cr?`${or.url}/bucket?${cr}`:`${or.url}/bucket`;return await get(or.fetch,ur,{headers:or.headers})})}async deleteBucket(ar){var or=this;return or.handleOperation(async()=>await remove(or.fetch,`${or.url}/bucket/${ar}`,{},{headers:or.headers}))}from(ar){var or=this;if(!isValidBucketName(ar))throw new StorageError("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const lr=new IcebergRestCatalog({baseUrl:this.url,catalogName:ar,auth:{type:"custom",getHeaders:async()=>or.headers},fetch:this.fetch}),cr=this.shouldThrowOnError;return new Proxy(lr,{get(ur,dr){const hr=ur[dr];return typeof hr!="function"?hr:async(...pr)=>{try{return{data:await hr.apply(ur,pr),error:null}}catch(mr){if(cr)throw mr;return{data:null,error:mr}}}}})}},VectorIndexApi=class extends BaseApiClient{constructor(ar,or={},lr){const cr=ar.replace(/\/$/,""),ur=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),{},{"Content-Type":"application/json"},or);super(cr,ur,lr,"vectors")}async createIndex(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/CreateIndex`,ar,{headers:or.headers})||{})}async getIndex(ar,or){var lr=this;return lr.handleOperation(async()=>await post(lr.fetch,`${lr.url}/GetIndex`,{vectorBucketName:ar,indexName:or},{headers:lr.headers}))}async listIndexes(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/ListIndexes`,ar,{headers:or.headers}))}async deleteIndex(ar,or){var lr=this;return lr.handleOperation(async()=>await post(lr.fetch,`${lr.url}/DeleteIndex`,{vectorBucketName:ar,indexName:or},{headers:lr.headers})||{})}},VectorDataApi=class extends BaseApiClient{constructor(ar,or={},lr){const cr=ar.replace(/\/$/,""),ur=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),{},{"Content-Type":"application/json"},or);super(cr,ur,lr,"vectors")}async putVectors(ar){var or=this;if(ar.vectors.length<1||ar.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return or.handleOperation(async()=>await post(or.fetch,`${or.url}/PutVectors`,ar,{headers:or.headers})||{})}async getVectors(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/GetVectors`,ar,{headers:or.headers}))}async listVectors(ar){var or=this;if(ar.segmentCount!==void 0){if(ar.segmentCount<1||ar.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(ar.segmentIndex!==void 0&&(ar.segmentIndex<0||ar.segmentIndex>=ar.segmentCount))throw new Error(`segmentIndex must be between 0 and ${ar.segmentCount-1}`)}return or.handleOperation(async()=>await post(or.fetch,`${or.url}/ListVectors`,ar,{headers:or.headers}))}async queryVectors(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/QueryVectors`,ar,{headers:or.headers}))}async deleteVectors(ar){var or=this;if(ar.keys.length<1||ar.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return or.handleOperation(async()=>await post(or.fetch,`${or.url}/DeleteVectors`,ar,{headers:or.headers})||{})}},VectorBucketApi=class extends BaseApiClient{constructor(ar,or={},lr){const cr=ar.replace(/\/$/,""),ur=_objectSpread2$1(_objectSpread2$1({},DEFAULT_HEADERS$2),{},{"Content-Type":"application/json"},or);super(cr,ur,lr,"vectors")}async createBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/CreateVectorBucket`,{vectorBucketName:ar},{headers:or.headers})||{})}async getBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/GetVectorBucket`,{vectorBucketName:ar},{headers:or.headers}))}async listBuckets(ar={}){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/ListVectorBuckets`,ar,{headers:or.headers}))}async deleteBucket(ar){var or=this;return or.handleOperation(async()=>await post(or.fetch,`${or.url}/DeleteVectorBucket`,{vectorBucketName:ar},{headers:or.headers})||{})}},StorageVectorsClient=class extends VectorBucketApi{constructor(ar,or={}){super(ar,or.headers||{},or.fetch)}from(ar){return new VectorBucketScope(this.url,this.headers,ar,this.fetch)}async createBucket(ar){var or=()=>super.createBucket,lr=this;return or().call(lr,ar)}async getBucket(ar){var or=()=>super.getBucket,lr=this;return or().call(lr,ar)}async listBuckets(ar={}){var or=()=>super.listBuckets,lr=this;return or().call(lr,ar)}async deleteBucket(ar){var or=()=>super.deleteBucket,lr=this;return or().call(lr,ar)}},VectorBucketScope=class extends VectorIndexApi{constructor(ar,or,lr,cr){super(ar,or,cr),this.vectorBucketName=lr}async createIndex(ar){var or=()=>super.createIndex,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName}))}async listIndexes(ar={}){var or=()=>super.listIndexes,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName}))}async getIndex(ar){var or=()=>super.getIndex,lr=this;return or().call(lr,lr.vectorBucketName,ar)}async deleteIndex(ar){var or=()=>super.deleteIndex,lr=this;return or().call(lr,lr.vectorBucketName,ar)}index(ar){return new VectorIndexScope(this.url,this.headers,this.vectorBucketName,ar,this.fetch)}},VectorIndexScope=class extends VectorDataApi{constructor(ar,or,lr,cr,ur){super(ar,or,ur),this.vectorBucketName=lr,this.indexName=cr}async putVectors(ar){var or=()=>super.putVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}async getVectors(ar){var or=()=>super.getVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}async listVectors(ar={}){var or=()=>super.listVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}async queryVectors(ar){var or=()=>super.queryVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}async deleteVectors(ar){var or=()=>super.deleteVectors,lr=this;return or().call(lr,_objectSpread2$1(_objectSpread2$1({},ar),{},{vectorBucketName:lr.vectorBucketName,indexName:lr.indexName}))}},StorageClient=class extends StorageBucketApi{constructor(ar,or={},lr,cr){super(ar,or,lr,cr)}from(ar){return new StorageFileApi(this.url,this.headers,ar,this.fetch)}get vectors(){return new StorageVectorsClient(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new StorageAnalyticsClient(this.url+"/iceberg",this.headers,this.fetch)}};const version$1="2.93.1",AUTO_REFRESH_TICK_DURATION_MS=30*1e3,AUTO_REFRESH_TICK_THRESHOLD=3,EXPIRY_MARGIN_MS=AUTO_REFRESH_TICK_THRESHOLD*AUTO_REFRESH_TICK_DURATION_MS,GOTRUE_URL="http://localhost:9999",STORAGE_KEY="supabase.auth.token",DEFAULT_HEADERS$1={"X-Client-Info":`gotrue-js/${version$1}`},API_VERSION_HEADER_NAME="X-Supabase-Api-Version",API_VERSIONS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},BASE64URL_REGEX=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,JWKS_TTL=10*60*1e3;class AuthError extends Error{constructor(or,lr,cr){super(or),this.__isAuthError=!0,this.name="AuthError",this.status=lr,this.code=cr}}function isAuthError(ar){return typeof ar=="object"&&ar!==null&&"__isAuthError"in ar}class AuthApiError extends AuthError{constructor(or,lr,cr){super(or,lr,cr),this.name="AuthApiError",this.status=lr,this.code=cr}}function isAuthApiError(ar){return isAuthError(ar)&&ar.name==="AuthApiError"}class AuthUnknownError extends AuthError{constructor(or,lr){super(or),this.name="AuthUnknownError",this.originalError=lr}}class CustomAuthError extends AuthError{constructor(or,lr,cr,ur){super(or,cr,ur),this.name=lr,this.status=cr}}class AuthSessionMissingError extends CustomAuthError{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function isAuthSessionMissingError(ar){return isAuthError(ar)&&ar.name==="AuthSessionMissingError"}class AuthInvalidTokenResponseError extends CustomAuthError{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class AuthInvalidCredentialsError extends CustomAuthError{constructor(or){super(or,"AuthInvalidCredentialsError",400,void 0)}}class AuthImplicitGrantRedirectError extends CustomAuthError{constructor(or,lr=null){super(or,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=lr}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function isAuthImplicitGrantRedirectError(ar){return isAuthError(ar)&&ar.name==="AuthImplicitGrantRedirectError"}class AuthPKCEGrantCodeExchangeError extends CustomAuthError{constructor(or,lr=null){super(or,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=lr}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AuthPKCECodeVerifierMissingError extends CustomAuthError{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class AuthRetryableFetchError extends CustomAuthError{constructor(or,lr){super(or,"AuthRetryableFetchError",lr,void 0)}}function isAuthRetryableFetchError(ar){return isAuthError(ar)&&ar.name==="AuthRetryableFetchError"}class AuthWeakPasswordError extends CustomAuthError{constructor(or,lr,cr){super(or,"AuthWeakPasswordError",lr,"weak_password"),this.reasons=cr}}class AuthInvalidJwtError extends CustomAuthError{constructor(or){super(or,"AuthInvalidJwtError",400,"invalid_jwt")}}const TO_BASE64URL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),IGNORE_BASE64URL=` 	
\r=`.split(""),FROM_BASE64URL=(()=>{const ar=new Array(128);for(let or=0;or<ar.length;or+=1)ar[or]=-1;for(let or=0;or<IGNORE_BASE64URL.length;or+=1)ar[IGNORE_BASE64URL[or].charCodeAt(0)]=-2;for(let or=0;or<TO_BASE64URL.length;or+=1)ar[TO_BASE64URL[or].charCodeAt(0)]=or;return ar})();function byteToBase64URL(ar,or,lr){if(ar!==null)for(or.queue=or.queue<<8|ar,or.queuedBits+=8;or.queuedBits>=6;){const cr=or.queue>>or.queuedBits-6&63;lr(TO_BASE64URL[cr]),or.queuedBits-=6}else if(or.queuedBits>0)for(or.queue=or.queue<<6-or.queuedBits,or.queuedBits=6;or.queuedBits>=6;){const cr=or.queue>>or.queuedBits-6&63;lr(TO_BASE64URL[cr]),or.queuedBits-=6}}function byteFromBase64URL(ar,or,lr){const cr=FROM_BASE64URL[ar];if(cr>-1)for(or.queue=or.queue<<6|cr,or.queuedBits+=6;or.queuedBits>=8;)lr(or.queue>>or.queuedBits-8&255),or.queuedBits-=8;else{if(cr===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(ar)}"`)}}function stringFromBase64URL(ar){const or=[],lr=hr=>{or.push(String.fromCodePoint(hr))},cr={utf8seq:0,codepoint:0},ur={queue:0,queuedBits:0},dr=hr=>{stringFromUTF8(hr,cr,lr)};for(let hr=0;hr<ar.length;hr+=1)byteFromBase64URL(ar.charCodeAt(hr),ur,dr);return or.join("")}function codepointToUTF8(ar,or){if(ar<=127){or(ar);return}else if(ar<=2047){or(192|ar>>6),or(128|ar&63);return}else if(ar<=65535){or(224|ar>>12),or(128|ar>>6&63),or(128|ar&63);return}else if(ar<=1114111){or(240|ar>>18),or(128|ar>>12&63),or(128|ar>>6&63),or(128|ar&63);return}throw new Error(`Unrecognized Unicode codepoint: ${ar.toString(16)}`)}function stringToUTF8(ar,or){for(let lr=0;lr<ar.length;lr+=1){let cr=ar.charCodeAt(lr);if(cr>55295&&cr<=56319){const ur=(cr-55296)*1024&65535;cr=(ar.charCodeAt(lr+1)-56320&65535|ur)+65536,lr+=1}codepointToUTF8(cr,or)}}function stringFromUTF8(ar,or,lr){if(or.utf8seq===0){if(ar<=127){lr(ar);return}for(let cr=1;cr<6;cr+=1)if(!(ar>>7-cr&1)){or.utf8seq=cr;break}if(or.utf8seq===2)or.codepoint=ar&31;else if(or.utf8seq===3)or.codepoint=ar&15;else if(or.utf8seq===4)or.codepoint=ar&7;else throw new Error("Invalid UTF-8 sequence");or.utf8seq-=1}else if(or.utf8seq>0){if(ar<=127)throw new Error("Invalid UTF-8 sequence");or.codepoint=or.codepoint<<6|ar&63,or.utf8seq-=1,or.utf8seq===0&&lr(or.codepoint)}}function base64UrlToUint8Array(ar){const or=[],lr={queue:0,queuedBits:0},cr=ur=>{or.push(ur)};for(let ur=0;ur<ar.length;ur+=1)byteFromBase64URL(ar.charCodeAt(ur),lr,cr);return new Uint8Array(or)}function stringToUint8Array(ar){const or=[];return stringToUTF8(ar,lr=>or.push(lr)),new Uint8Array(or)}function bytesToBase64URL(ar){const or=[],lr={queue:0,queuedBits:0},cr=ur=>{or.push(ur)};return ar.forEach(ur=>byteToBase64URL(ur,lr,cr)),byteToBase64URL(null,lr,cr),or.join("")}function expiresAt(ar){return Math.round(Date.now()/1e3)+ar}function generateCallbackId(){return Symbol("auth-callback")}const isBrowser=()=>typeof window<"u"&&typeof document<"u",localStorageWriteTests={tested:!1,writable:!1},supportsLocalStorage=()=>{if(!isBrowser())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(localStorageWriteTests.tested)return localStorageWriteTests.writable;const ar=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(ar,ar),globalThis.localStorage.removeItem(ar),localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!0}catch{localStorageWriteTests.tested=!0,localStorageWriteTests.writable=!1}return localStorageWriteTests.writable};function parseParametersFromURL(ar){const or={},lr=new URL(ar);if(lr.hash&&lr.hash[0]==="#")try{new URLSearchParams(lr.hash.substring(1)).forEach((ur,dr)=>{or[dr]=ur})}catch{}return lr.searchParams.forEach((cr,ur)=>{or[ur]=cr}),or}const resolveFetch$1=ar=>ar?(...or)=>ar(...or):(...or)=>fetch(...or),looksLikeFetchResponse=ar=>typeof ar=="object"&&ar!==null&&"status"in ar&&"ok"in ar&&"json"in ar&&typeof ar.json=="function",setItemAsync=async(ar,or,lr)=>{await ar.setItem(or,JSON.stringify(lr))},getItemAsync=async(ar,or)=>{const lr=await ar.getItem(or);if(!lr)return null;try{return JSON.parse(lr)}catch{return lr}},removeItemAsync=async(ar,or)=>{await ar.removeItem(or)};class Deferred{constructor(){this.promise=new Deferred.promiseConstructor((or,lr)=>{this.resolve=or,this.reject=lr})}}Deferred.promiseConstructor=Promise;function decodeJWT(ar){const or=ar.split(".");if(or.length!==3)throw new AuthInvalidJwtError("Invalid JWT structure");for(let cr=0;cr<or.length;cr++)if(!BASE64URL_REGEX.test(or[cr]))throw new AuthInvalidJwtError("JWT not in base64url format");return{header:JSON.parse(stringFromBase64URL(or[0])),payload:JSON.parse(stringFromBase64URL(or[1])),signature:base64UrlToUint8Array(or[2]),raw:{header:or[0],payload:or[1]}}}async function sleep(ar){return await new Promise(or=>{setTimeout(()=>or(null),ar)})}function retryable(ar,or){return new Promise((cr,ur)=>{(async()=>{for(let dr=0;dr<1/0;dr++)try{const hr=await ar(dr);if(!or(dr,null,hr)){cr(hr);return}}catch(hr){if(!or(dr,hr)){ur(hr);return}}})()})}function dec2hex(ar){return("0"+ar.toString(16)).substr(-2)}function generatePKCEVerifier(){const or=new Uint32Array(56);if(typeof crypto>"u"){const lr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",cr=lr.length;let ur="";for(let dr=0;dr<56;dr++)ur+=lr.charAt(Math.floor(Math.random()*cr));return ur}return crypto.getRandomValues(or),Array.from(or,dec2hex).join("")}async function sha256(ar){const lr=new TextEncoder().encode(ar),cr=await crypto.subtle.digest("SHA-256",lr),ur=new Uint8Array(cr);return Array.from(ur).map(dr=>String.fromCharCode(dr)).join("")}async function generatePKCEChallenge(ar){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),ar;const lr=await sha256(ar);return btoa(lr).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function getCodeChallengeAndMethod(ar,or,lr=!1){const cr=generatePKCEVerifier();let ur=cr;lr&&(ur+="/PASSWORD_RECOVERY"),await setItemAsync(ar,`${or}-code-verifier`,ur);const dr=await generatePKCEChallenge(cr);return[dr,cr===dr?"plain":"s256"]}const API_VERSION_REGEX=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function parseResponseAPIVersion(ar){const or=ar.headers.get(API_VERSION_HEADER_NAME);if(!or||!or.match(API_VERSION_REGEX))return null;try{return new Date(`${or}T00:00:00.0Z`)}catch{return null}}function validateExp(ar){if(!ar)throw new Error("Missing exp claim");const or=Math.floor(Date.now()/1e3);if(ar<=or)throw new Error("JWT has expired")}function getAlgorithm(ar){switch(ar){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const UUID_REGEX=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function validateUUID(ar){if(!UUID_REGEX.test(ar))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function userNotAvailableProxy(){const ar={};return new Proxy(ar,{get:(or,lr)=>{if(lr==="__isUserNotAvailableProxy")return!0;if(typeof lr=="symbol"){const cr=lr.toString();if(cr==="Symbol(Symbol.toPrimitive)"||cr==="Symbol(Symbol.toStringTag)"||cr==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${lr}" property of the session object is not supported. Please use getUser() instead.`)},set:(or,lr)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${lr}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(or,lr)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${lr}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function insecureUserWarningProxy(ar,or){return new Proxy(ar,{get:(lr,cr,ur)=>{if(cr==="__isInsecureUserWarningProxy")return!0;if(typeof cr=="symbol"){const dr=cr.toString();if(dr==="Symbol(Symbol.toPrimitive)"||dr==="Symbol(Symbol.toStringTag)"||dr==="Symbol(util.inspect.custom)"||dr==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(lr,cr,ur)}return!or.value&&typeof cr=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),or.value=!0),Reflect.get(lr,cr,ur)}})}function deepClone(ar){return JSON.parse(JSON.stringify(ar))}const _getErrorMessage=ar=>ar.msg||ar.message||ar.error_description||ar.error||JSON.stringify(ar),NETWORK_ERROR_CODES=[502,503,504];async function handleError(ar){var or;if(!looksLikeFetchResponse(ar))throw new AuthRetryableFetchError(_getErrorMessage(ar),0);if(NETWORK_ERROR_CODES.includes(ar.status))throw new AuthRetryableFetchError(_getErrorMessage(ar),ar.status);let lr;try{lr=await ar.json()}catch(dr){throw new AuthUnknownError(_getErrorMessage(dr),dr)}let cr;const ur=parseResponseAPIVersion(ar);if(ur&&ur.getTime()>=API_VERSIONS["2024-01-01"].timestamp&&typeof lr=="object"&&lr&&typeof lr.code=="string"?cr=lr.code:typeof lr=="object"&&lr&&typeof lr.error_code=="string"&&(cr=lr.error_code),cr){if(cr==="weak_password")throw new AuthWeakPasswordError(_getErrorMessage(lr),ar.status,((or=lr.weak_password)===null||or===void 0?void 0:or.reasons)||[]);if(cr==="session_not_found")throw new AuthSessionMissingError}else if(typeof lr=="object"&&lr&&typeof lr.weak_password=="object"&&lr.weak_password&&Array.isArray(lr.weak_password.reasons)&&lr.weak_password.reasons.length&&lr.weak_password.reasons.reduce((dr,hr)=>dr&&typeof hr=="string",!0))throw new AuthWeakPasswordError(_getErrorMessage(lr),ar.status,lr.weak_password.reasons);throw new AuthApiError(_getErrorMessage(lr),ar.status||500,cr)}const _getRequestParams=(ar,or,lr,cr)=>{const ur={method:ar,headers:(or==null?void 0:or.headers)||{}};return ar==="GET"?ur:(ur.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},or==null?void 0:or.headers),ur.body=JSON.stringify(cr),Object.assign(Object.assign({},ur),lr))};async function _request(ar,or,lr,cr){var ur;const dr=Object.assign({},cr==null?void 0:cr.headers);dr[API_VERSION_HEADER_NAME]||(dr[API_VERSION_HEADER_NAME]=API_VERSIONS["2024-01-01"].name),cr!=null&&cr.jwt&&(dr.Authorization=`Bearer ${cr.jwt}`);const hr=(ur=cr==null?void 0:cr.query)!==null&&ur!==void 0?ur:{};cr!=null&&cr.redirectTo&&(hr.redirect_to=cr.redirectTo);const pr=Object.keys(hr).length?"?"+new URLSearchParams(hr).toString():"",mr=await _handleRequest(ar,or,lr+pr,{headers:dr,noResolveJson:cr==null?void 0:cr.noResolveJson},{},cr==null?void 0:cr.body);return cr!=null&&cr.xform?cr==null?void 0:cr.xform(mr):{data:Object.assign({},mr),error:null}}async function _handleRequest(ar,or,lr,cr,ur,dr){const hr=_getRequestParams(or,cr,ur,dr);let pr;try{pr=await ar(lr,Object.assign({},hr))}catch(mr){throw console.error(mr),new AuthRetryableFetchError(_getErrorMessage(mr),0)}if(pr.ok||await handleError(pr),cr!=null&&cr.noResolveJson)return pr;try{return await pr.json()}catch(mr){await handleError(mr)}}function _sessionResponse(ar){var or;let lr=null;hasSession(ar)&&(lr=Object.assign({},ar),ar.expires_at||(lr.expires_at=expiresAt(ar.expires_in)));const cr=(or=ar.user)!==null&&or!==void 0?or:ar;return{data:{session:lr,user:cr},error:null}}function _sessionResponsePassword(ar){const or=_sessionResponse(ar);return!or.error&&ar.weak_password&&typeof ar.weak_password=="object"&&Array.isArray(ar.weak_password.reasons)&&ar.weak_password.reasons.length&&ar.weak_password.message&&typeof ar.weak_password.message=="string"&&ar.weak_password.reasons.reduce((lr,cr)=>lr&&typeof cr=="string",!0)&&(or.data.weak_password=ar.weak_password),or}function _userResponse(ar){var or;return{data:{user:(or=ar.user)!==null&&or!==void 0?or:ar},error:null}}function _ssoResponse(ar){return{data:ar,error:null}}function _generateLinkResponse(ar){const{action_link:or,email_otp:lr,hashed_token:cr,redirect_to:ur,verification_type:dr}=ar,hr=__rest(ar,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),pr={action_link:or,email_otp:lr,hashed_token:cr,redirect_to:ur,verification_type:dr},mr=Object.assign({},hr);return{data:{properties:pr,user:mr},error:null}}function _noResolveJsonResponse(ar){return ar}function hasSession(ar){return ar.access_token&&ar.refresh_token&&ar.expires_in}const SIGN_OUT_SCOPES=["global","local","others"];class GoTrueAdminApi{constructor({url:or="",headers:lr={},fetch:cr}){this.url=or,this.headers=lr,this.fetch=resolveFetch$1(cr),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(or,lr=SIGN_OUT_SCOPES[0]){if(SIGN_OUT_SCOPES.indexOf(lr)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${SIGN_OUT_SCOPES.join(", ")}`);try{return await _request(this.fetch,"POST",`${this.url}/logout?scope=${lr}`,{headers:this.headers,jwt:or,noResolveJson:!0}),{data:null,error:null}}catch(cr){if(isAuthError(cr))return{data:null,error:cr};throw cr}}async inviteUserByEmail(or,lr={}){try{return await _request(this.fetch,"POST",`${this.url}/invite`,{body:{email:or,data:lr.data},headers:this.headers,redirectTo:lr.redirectTo,xform:_userResponse})}catch(cr){if(isAuthError(cr))return{data:{user:null},error:cr};throw cr}}async generateLink(or){try{const{options:lr}=or,cr=__rest(or,["options"]),ur=Object.assign(Object.assign({},cr),lr);return"newEmail"in cr&&(ur.new_email=cr==null?void 0:cr.newEmail,delete ur.newEmail),await _request(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:ur,headers:this.headers,xform:_generateLinkResponse,redirectTo:lr==null?void 0:lr.redirectTo})}catch(lr){if(isAuthError(lr))return{data:{properties:null,user:null},error:lr};throw lr}}async createUser(or){try{return await _request(this.fetch,"POST",`${this.url}/admin/users`,{body:or,headers:this.headers,xform:_userResponse})}catch(lr){if(isAuthError(lr))return{data:{user:null},error:lr};throw lr}}async listUsers(or){var lr,cr,ur,dr,hr,pr,mr;try{const fr={nextPage:null,lastPage:0,total:0},xr=await _request(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(cr=(lr=or==null?void 0:or.page)===null||lr===void 0?void 0:lr.toString())!==null&&cr!==void 0?cr:"",per_page:(dr=(ur=or==null?void 0:or.perPage)===null||ur===void 0?void 0:ur.toString())!==null&&dr!==void 0?dr:""},xform:_noResolveJsonResponse});if(xr.error)throw xr.error;const Er=await xr.json(),vr=(hr=xr.headers.get("x-total-count"))!==null&&hr!==void 0?hr:0,gr=(mr=(pr=xr.headers.get("link"))===null||pr===void 0?void 0:pr.split(","))!==null&&mr!==void 0?mr:[];return gr.length>0&&(gr.forEach(yr=>{const br=parseInt(yr.split(";")[0].split("=")[1].substring(0,1)),_r=JSON.parse(yr.split(";")[1].split("=")[1]);fr[`${_r}Page`]=br}),fr.total=parseInt(vr)),{data:Object.assign(Object.assign({},Er),fr),error:null}}catch(fr){if(isAuthError(fr))return{data:{users:[]},error:fr};throw fr}}async getUserById(or){validateUUID(or);try{return await _request(this.fetch,"GET",`${this.url}/admin/users/${or}`,{headers:this.headers,xform:_userResponse})}catch(lr){if(isAuthError(lr))return{data:{user:null},error:lr};throw lr}}async updateUserById(or,lr){validateUUID(or);try{return await _request(this.fetch,"PUT",`${this.url}/admin/users/${or}`,{body:lr,headers:this.headers,xform:_userResponse})}catch(cr){if(isAuthError(cr))return{data:{user:null},error:cr};throw cr}}async deleteUser(or,lr=!1){validateUUID(or);try{return await _request(this.fetch,"DELETE",`${this.url}/admin/users/${or}`,{headers:this.headers,body:{should_soft_delete:lr},xform:_userResponse})}catch(cr){if(isAuthError(cr))return{data:{user:null},error:cr};throw cr}}async _listFactors(or){validateUUID(or.userId);try{const{data:lr,error:cr}=await _request(this.fetch,"GET",`${this.url}/admin/users/${or.userId}/factors`,{headers:this.headers,xform:ur=>({data:{factors:ur},error:null})});return{data:lr,error:cr}}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _deleteFactor(or){validateUUID(or.userId),validateUUID(or.id);try{return{data:await _request(this.fetch,"DELETE",`${this.url}/admin/users/${or.userId}/factors/${or.id}`,{headers:this.headers}),error:null}}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _listOAuthClients(or){var lr,cr,ur,dr,hr,pr,mr;try{const fr={nextPage:null,lastPage:0,total:0},xr=await _request(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(cr=(lr=or==null?void 0:or.page)===null||lr===void 0?void 0:lr.toString())!==null&&cr!==void 0?cr:"",per_page:(dr=(ur=or==null?void 0:or.perPage)===null||ur===void 0?void 0:ur.toString())!==null&&dr!==void 0?dr:""},xform:_noResolveJsonResponse});if(xr.error)throw xr.error;const Er=await xr.json(),vr=(hr=xr.headers.get("x-total-count"))!==null&&hr!==void 0?hr:0,gr=(mr=(pr=xr.headers.get("link"))===null||pr===void 0?void 0:pr.split(","))!==null&&mr!==void 0?mr:[];return gr.length>0&&(gr.forEach(yr=>{const br=parseInt(yr.split(";")[0].split("=")[1].substring(0,1)),_r=JSON.parse(yr.split(";")[1].split("=")[1]);fr[`${_r}Page`]=br}),fr.total=parseInt(vr)),{data:Object.assign(Object.assign({},Er),fr),error:null}}catch(fr){if(isAuthError(fr))return{data:{clients:[]},error:fr};throw fr}}async _createOAuthClient(or){try{return await _request(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:or,headers:this.headers,xform:lr=>({data:lr,error:null})})}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _getOAuthClient(or){try{return await _request(this.fetch,"GET",`${this.url}/admin/oauth/clients/${or}`,{headers:this.headers,xform:lr=>({data:lr,error:null})})}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _updateOAuthClient(or,lr){try{return await _request(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${or}`,{body:lr,headers:this.headers,xform:cr=>({data:cr,error:null})})}catch(cr){if(isAuthError(cr))return{data:null,error:cr};throw cr}}async _deleteOAuthClient(or){try{return await _request(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${or}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}async _regenerateOAuthClientSecret(or){try{return await _request(this.fetch,"POST",`${this.url}/admin/oauth/clients/${or}/regenerate_secret`,{headers:this.headers,xform:lr=>({data:lr,error:null})})}catch(lr){if(isAuthError(lr))return{data:null,error:lr};throw lr}}}function memoryLocalStorageAdapter(ar={}){return{getItem:or=>ar[or]||null,setItem:(or,lr)=>{ar[or]=lr},removeItem:or=>{delete ar[or]}}}const internals={debug:!!(globalThis&&supportsLocalStorage()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class LockAcquireTimeoutError extends Error{constructor(or){super(or),this.isAcquireTimeout=!0}}class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError{}async function navigatorLock(ar,or,lr){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",ar,or);const cr=new globalThis.AbortController;return or>0&&setTimeout(()=>{cr.abort(),internals.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",ar)},or),await Promise.resolve().then(()=>globalThis.navigator.locks.request(ar,or===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:cr.signal},async ur=>{if(ur){internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",ar,ur.name);try{return await lr()}finally{internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",ar,ur.name)}}else{if(or===0)throw internals.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",ar),new NavigatorLockAcquireTimeoutError(`Acquiring an exclusive Navigator LockManager lock "${ar}" immediately failed`);if(internals.debug)try{const dr=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(dr,null,"  "))}catch(dr){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",dr)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await lr()}}))}function polyfillGlobalThis(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function getAddress(ar){if(!/^0x[a-fA-F0-9]{40}$/.test(ar))throw new Error(`@supabase/auth-js: Address "${ar}" is invalid.`);return ar.toLowerCase()}function fromHex(ar){return parseInt(ar,16)}function toHex(ar){const or=new TextEncoder().encode(ar);return"0x"+Array.from(or,cr=>cr.toString(16).padStart(2,"0")).join("")}function createSiweMessage(ar){var or;const{chainId:lr,domain:cr,expirationTime:ur,issuedAt:dr=new Date,nonce:hr,notBefore:pr,requestId:mr,resources:fr,scheme:xr,uri:Er,version:vr}=ar;{if(!Number.isInteger(lr))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${lr}`);if(!cr)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(hr&&hr.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${hr}`);if(!Er)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(vr!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${vr}`);if(!((or=ar.statement)===null||or===void 0)&&or.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${ar.statement}`)}const gr=getAddress(ar.address),yr=xr?`${xr}://${cr}`:cr,br=ar.statement?`${ar.statement}
`:"",_r=`${yr} wants you to sign in with your Ethereum account:
${gr}

${br}`;let jr=`URI: ${Er}
Version: ${vr}
Chain ID: ${lr}${hr?`
Nonce: ${hr}`:""}
Issued At: ${dr.toISOString()}`;if(ur&&(jr+=`
Expiration Time: ${ur.toISOString()}`),pr&&(jr+=`
Not Before: ${pr.toISOString()}`),mr&&(jr+=`
Request ID: ${mr}`),fr){let wr=`
Resources:`;for(const Sr of fr){if(!Sr||typeof Sr!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${Sr}`);wr+=`
- ${Sr}`}jr+=wr}return`${_r}
${jr}`}class WebAuthnError extends Error{constructor({message:or,code:lr,cause:cr,name:ur}){var dr;super(or,{cause:cr}),this.__isWebAuthnError=!0,this.name=(dr=ur??(cr instanceof Error?cr.name:void 0))!==null&&dr!==void 0?dr:"Unknown Error",this.code=lr}}class WebAuthnUnknownError extends WebAuthnError{constructor(or,lr){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:lr,message:or}),this.name="WebAuthnUnknownError",this.originalError=lr}}function identifyRegistrationError({error:ar,options:or}){var lr,cr,ur;const{publicKey:dr}=or;if(!dr)throw Error("options was missing required publicKey property");if(ar.name==="AbortError"){if(or.signal instanceof AbortSignal)return new WebAuthnError({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:ar})}else if(ar.name==="ConstraintError"){if(((lr=dr.authenticatorSelection)===null||lr===void 0?void 0:lr.requireResidentKey)===!0)return new WebAuthnError({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:ar});if(or.mediation==="conditional"&&((cr=dr.authenticatorSelection)===null||cr===void 0?void 0:cr.userVerification)==="required")return new WebAuthnError({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:ar});if(((ur=dr.authenticatorSelection)===null||ur===void 0?void 0:ur.userVerification)==="required")return new WebAuthnError({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:ar})}else{if(ar.name==="InvalidStateError")return new WebAuthnError({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:ar});if(ar.name==="NotAllowedError")return new WebAuthnError({message:ar.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:ar});if(ar.name==="NotSupportedError")return dr.pubKeyCredParams.filter(pr=>pr.type==="public-key").length===0?new WebAuthnError({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:ar}):new WebAuthnError({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:ar});if(ar.name==="SecurityError"){const hr=window.location.hostname;if(isValidDomain(hr)){if(dr.rp.id!==hr)return new WebAuthnError({message:`The RP ID "${dr.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:ar})}else return new WebAuthnError({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:ar})}else if(ar.name==="TypeError"){if(dr.user.id.byteLength<1||dr.user.id.byteLength>64)return new WebAuthnError({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:ar})}else if(ar.name==="UnknownError")return new WebAuthnError({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:ar})}return new WebAuthnError({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:ar})}function identifyAuthenticationError({error:ar,options:or}){const{publicKey:lr}=or;if(!lr)throw Error("options was missing required publicKey property");if(ar.name==="AbortError"){if(or.signal instanceof AbortSignal)return new WebAuthnError({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:ar})}else{if(ar.name==="NotAllowedError")return new WebAuthnError({message:ar.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:ar});if(ar.name==="SecurityError"){const cr=window.location.hostname;if(isValidDomain(cr)){if(lr.rpId!==cr)return new WebAuthnError({message:`The RP ID "${lr.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:ar})}else return new WebAuthnError({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:ar})}else if(ar.name==="UnknownError")return new WebAuthnError({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:ar})}return new WebAuthnError({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:ar})}class WebAuthnAbortService{createNewAbortSignal(){if(this.controller){const lr=new Error("Cancelling existing WebAuthn API call for new one");lr.name="AbortError",this.controller.abort(lr)}const or=new AbortController;return this.controller=or,or.signal}cancelCeremony(){if(this.controller){const or=new Error("Manually cancelling existing WebAuthn API call");or.name="AbortError",this.controller.abort(or),this.controller=void 0}}}const webAuthnAbortService=new WebAuthnAbortService;function deserializeCredentialCreationOptions(ar){if(!ar)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(ar);const{challenge:or,user:lr,excludeCredentials:cr}=ar,ur=__rest(ar,["challenge","user","excludeCredentials"]),dr=base64UrlToUint8Array(or).buffer,hr=Object.assign(Object.assign({},lr),{id:base64UrlToUint8Array(lr.id).buffer}),pr=Object.assign(Object.assign({},ur),{challenge:dr,user:hr});if(cr&&cr.length>0){pr.excludeCredentials=new Array(cr.length);for(let mr=0;mr<cr.length;mr++){const fr=cr[mr];pr.excludeCredentials[mr]=Object.assign(Object.assign({},fr),{id:base64UrlToUint8Array(fr.id).buffer,type:fr.type||"public-key",transports:fr.transports})}}return pr}function deserializeCredentialRequestOptions(ar){if(!ar)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(ar);const{challenge:or,allowCredentials:lr}=ar,cr=__rest(ar,["challenge","allowCredentials"]),ur=base64UrlToUint8Array(or).buffer,dr=Object.assign(Object.assign({},cr),{challenge:ur});if(lr&&lr.length>0){dr.allowCredentials=new Array(lr.length);for(let hr=0;hr<lr.length;hr++){const pr=lr[hr];dr.allowCredentials[hr]=Object.assign(Object.assign({},pr),{id:base64UrlToUint8Array(pr.id).buffer,type:pr.type||"public-key",transports:pr.transports})}}return dr}function serializeCredentialCreationResponse(ar){var or;if("toJSON"in ar&&typeof ar.toJSON=="function")return ar.toJSON();const lr=ar;return{id:ar.id,rawId:ar.id,response:{attestationObject:bytesToBase64URL(new Uint8Array(ar.response.attestationObject)),clientDataJSON:bytesToBase64URL(new Uint8Array(ar.response.clientDataJSON))},type:"public-key",clientExtensionResults:ar.getClientExtensionResults(),authenticatorAttachment:(or=lr.authenticatorAttachment)!==null&&or!==void 0?or:void 0}}function serializeCredentialRequestResponse(ar){var or;if("toJSON"in ar&&typeof ar.toJSON=="function")return ar.toJSON();const lr=ar,cr=ar.getClientExtensionResults(),ur=ar.response;return{id:ar.id,rawId:ar.id,response:{authenticatorData:bytesToBase64URL(new Uint8Array(ur.authenticatorData)),clientDataJSON:bytesToBase64URL(new Uint8Array(ur.clientDataJSON)),signature:bytesToBase64URL(new Uint8Array(ur.signature)),userHandle:ur.userHandle?bytesToBase64URL(new Uint8Array(ur.userHandle)):void 0},type:"public-key",clientExtensionResults:cr,authenticatorAttachment:(or=lr.authenticatorAttachment)!==null&&or!==void 0?or:void 0}}function isValidDomain(ar){return ar==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(ar)}function browserSupportsWebAuthn(){var ar,or;return!!(isBrowser()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((ar=navigator==null?void 0:navigator.credentials)===null||ar===void 0?void 0:ar.create)=="function"&&typeof((or=navigator==null?void 0:navigator.credentials)===null||or===void 0?void 0:or.get)=="function")}async function createCredential(ar){try{const or=await navigator.credentials.create(ar);return or?or instanceof PublicKeyCredential?{data:or,error:null}:{data:null,error:new WebAuthnUnknownError("Browser returned unexpected credential type",or)}:{data:null,error:new WebAuthnUnknownError("Empty credential response",or)}}catch(or){return{data:null,error:identifyRegistrationError({error:or,options:ar})}}}async function getCredential(ar){try{const or=await navigator.credentials.get(ar);return or?or instanceof PublicKeyCredential?{data:or,error:null}:{data:null,error:new WebAuthnUnknownError("Browser returned unexpected credential type",or)}:{data:null,error:new WebAuthnUnknownError("Empty credential response",or)}}catch(or){return{data:null,error:identifyAuthenticationError({error:or,options:ar})}}}const DEFAULT_CREATION_OPTIONS={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},DEFAULT_REQUEST_OPTIONS={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function deepMerge(...ar){const or=ur=>ur!==null&&typeof ur=="object"&&!Array.isArray(ur),lr=ur=>ur instanceof ArrayBuffer||ArrayBuffer.isView(ur),cr={};for(const ur of ar)if(ur)for(const dr in ur){const hr=ur[dr];if(hr!==void 0)if(Array.isArray(hr))cr[dr]=hr;else if(lr(hr))cr[dr]=hr;else if(or(hr)){const pr=cr[dr];or(pr)?cr[dr]=deepMerge(pr,hr):cr[dr]=deepMerge(hr)}else cr[dr]=hr}return cr}function mergeCredentialCreationOptions(ar,or){return deepMerge(DEFAULT_CREATION_OPTIONS,ar,or||{})}function mergeCredentialRequestOptions(ar,or){return deepMerge(DEFAULT_REQUEST_OPTIONS,ar,or||{})}class WebAuthnApi{constructor(or){this.client=or,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(or){return this.client.mfa.enroll(Object.assign(Object.assign({},or),{factorType:"webauthn"}))}async _challenge({factorId:or,webauthn:lr,friendlyName:cr,signal:ur},dr){try{const{data:hr,error:pr}=await this.client.mfa.challenge({factorId:or,webauthn:lr});if(!hr)return{data:null,error:pr};const mr=ur??webAuthnAbortService.createNewAbortSignal();if(hr.webauthn.type==="create"){const{user:fr}=hr.webauthn.credential_options.publicKey;fr.name||(fr.name=`${fr.id}:${cr}`),fr.displayName||(fr.displayName=fr.name)}switch(hr.webauthn.type){case"create":{const fr=mergeCredentialCreationOptions(hr.webauthn.credential_options.publicKey,dr==null?void 0:dr.create),{data:xr,error:Er}=await createCredential({publicKey:fr,signal:mr});return xr?{data:{factorId:or,challengeId:hr.id,webauthn:{type:hr.webauthn.type,credential_response:xr}},error:null}:{data:null,error:Er}}case"request":{const fr=mergeCredentialRequestOptions(hr.webauthn.credential_options.publicKey,dr==null?void 0:dr.request),{data:xr,error:Er}=await getCredential(Object.assign(Object.assign({},hr.webauthn.credential_options),{publicKey:fr,signal:mr}));return xr?{data:{factorId:or,challengeId:hr.id,webauthn:{type:hr.webauthn.type,credential_response:xr}},error:null}:{data:null,error:Er}}}}catch(hr){return isAuthError(hr)?{data:null,error:hr}:{data:null,error:new AuthUnknownError("Unexpected error in challenge",hr)}}}async _verify({challengeId:or,factorId:lr,webauthn:cr}){return this.client.mfa.verify({factorId:lr,challengeId:or,webauthn:cr})}async _authenticate({factorId:or,webauthn:{rpId:lr=typeof window<"u"?window.location.hostname:void 0,rpOrigins:cr=typeof window<"u"?[window.location.origin]:void 0,signal:ur}={}},dr){if(!lr)return{data:null,error:new AuthError("rpId is required for WebAuthn authentication")};try{if(!browserSupportsWebAuthn())return{data:null,error:new AuthUnknownError("Browser does not support WebAuthn",null)};const{data:hr,error:pr}=await this.challenge({factorId:or,webauthn:{rpId:lr,rpOrigins:cr},signal:ur},{request:dr});if(!hr)return{data:null,error:pr};const{webauthn:mr}=hr;return this._verify({factorId:or,challengeId:hr.challengeId,webauthn:{type:mr.type,rpId:lr,rpOrigins:cr,credential_response:mr.credential_response}})}catch(hr){return isAuthError(hr)?{data:null,error:hr}:{data:null,error:new AuthUnknownError("Unexpected error in authenticate",hr)}}}async _register({friendlyName:or,webauthn:{rpId:lr=typeof window<"u"?window.location.hostname:void 0,rpOrigins:cr=typeof window<"u"?[window.location.origin]:void 0,signal:ur}={}},dr){if(!lr)return{data:null,error:new AuthError("rpId is required for WebAuthn registration")};try{if(!browserSupportsWebAuthn())return{data:null,error:new AuthUnknownError("Browser does not support WebAuthn",null)};const{data:hr,error:pr}=await this._enroll({friendlyName:or});if(!hr)return await this.client.mfa.listFactors().then(xr=>{var Er;return(Er=xr.data)===null||Er===void 0?void 0:Er.all.find(vr=>vr.factor_type==="webauthn"&&vr.friendly_name===or&&vr.status!=="unverified")}).then(xr=>xr?this.client.mfa.unenroll({factorId:xr==null?void 0:xr.id}):void 0),{data:null,error:pr};const{data:mr,error:fr}=await this._challenge({factorId:hr.id,friendlyName:hr.friendly_name,webauthn:{rpId:lr,rpOrigins:cr},signal:ur},{create:dr});return mr?this._verify({factorId:hr.id,challengeId:mr.challengeId,webauthn:{rpId:lr,rpOrigins:cr,type:mr.webauthn.type,credential_response:mr.webauthn.credential_response}}):{data:null,error:fr}}catch(hr){return isAuthError(hr)?{data:null,error:hr}:{data:null,error:new AuthUnknownError("Unexpected error in register",hr)}}}}polyfillGlobalThis();const DEFAULT_OPTIONS={url:GOTRUE_URL,storageKey:STORAGE_KEY,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:DEFAULT_HEADERS$1,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function lockNoOp(ar,or,lr){return await lr()}const GLOBAL_JWKS={};class GoTrueClient{get jwks(){var or,lr;return(lr=(or=GLOBAL_JWKS[this.storageKey])===null||or===void 0?void 0:or.jwks)!==null&&lr!==void 0?lr:{keys:[]}}set jwks(or){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{jwks:or})}get jwks_cached_at(){var or,lr;return(lr=(or=GLOBAL_JWKS[this.storageKey])===null||or===void 0?void 0:or.cachedAt)!==null&&lr!==void 0?lr:Number.MIN_SAFE_INTEGER}set jwks_cached_at(or){GLOBAL_JWKS[this.storageKey]=Object.assign(Object.assign({},GLOBAL_JWKS[this.storageKey]),{cachedAt:or})}constructor(or){var lr,cr,ur;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const dr=Object.assign(Object.assign({},DEFAULT_OPTIONS),or);if(this.storageKey=dr.storageKey,this.instanceID=(lr=GoTrueClient.nextInstanceID[this.storageKey])!==null&&lr!==void 0?lr:0,GoTrueClient.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!dr.debug,typeof dr.debug=="function"&&(this.logger=dr.debug),this.instanceID>0&&isBrowser()){const hr=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(hr),this.logDebugMessages&&console.trace(hr)}if(this.persistSession=dr.persistSession,this.autoRefreshToken=dr.autoRefreshToken,this.admin=new GoTrueAdminApi({url:dr.url,headers:dr.headers,fetch:dr.fetch}),this.url=dr.url,this.headers=dr.headers,this.fetch=resolveFetch$1(dr.fetch),this.lock=dr.lock||lockNoOp,this.detectSessionInUrl=dr.detectSessionInUrl,this.flowType=dr.flowType,this.hasCustomAuthorizationHeader=dr.hasCustomAuthorizationHeader,this.throwOnError=dr.throwOnError,this.lockAcquireTimeout=dr.lockAcquireTimeout,dr.lock?this.lock=dr.lock:this.persistSession&&isBrowser()&&(!((cr=globalThis==null?void 0:globalThis.navigator)===null||cr===void 0)&&cr.locks)?this.lock=navigatorLock:this.lock=lockNoOp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new WebAuthnApi(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(dr.storage?this.storage=dr.storage:supportsLocalStorage()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),dr.userStorage&&(this.userStorage=dr.userStorage)):(this.memoryStorage={},this.storage=memoryLocalStorageAdapter(this.memoryStorage)),isBrowser()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(hr){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",hr)}(ur=this.broadcastChannel)===null||ur===void 0||ur.addEventListener("message",async hr=>{this._debug("received broadcast notification from other tab or client",hr);try{await this._notifyAllSubscribers(hr.data.event,hr.data.session,!1)}catch(pr){this._debug("#broadcastChannel","error",pr)}})}this.initialize().catch(hr=>{this._debug("#initialize()","error",hr)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(or){if(this.throwOnError&&or&&or.error)throw or.error;return or}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${version$1}) ${new Date().toISOString()}`}_debug(...or){return this.logDebugMessages&&this.logger(this._logPrefix(),...or),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var or;try{let lr={},cr="none";if(isBrowser()&&(lr=parseParametersFromURL(window.location.href),this._isImplicitGrantCallback(lr)?cr="implicit":await this._isPKCECallback(lr)&&(cr="pkce")),isBrowser()&&this.detectSessionInUrl&&cr!=="none"){const{data:ur,error:dr}=await this._getSessionFromURL(lr,cr);if(dr){if(this._debug("#_initialize()","error detecting session from URL",dr),isAuthImplicitGrantRedirectError(dr)){const mr=(or=dr.details)===null||or===void 0?void 0:or.code;if(mr==="identity_already_exists"||mr==="identity_not_found"||mr==="single_identity_not_deletable")return{error:dr}}return{error:dr}}const{session:hr,redirectType:pr}=ur;return this._debug("#_initialize()","detected session in URL",hr,"redirect type",pr),await this._saveSession(hr),setTimeout(async()=>{pr==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",hr):await this._notifyAllSubscribers("SIGNED_IN",hr)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(lr){return isAuthError(lr)?this._returnResult({error:lr}):this._returnResult({error:new AuthUnknownError("Unexpected error during initialization",lr)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(or){var lr,cr,ur;try{const dr=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(cr=(lr=or==null?void 0:or.options)===null||lr===void 0?void 0:lr.data)!==null&&cr!==void 0?cr:{},gotrue_meta_security:{captcha_token:(ur=or==null?void 0:or.options)===null||ur===void 0?void 0:ur.captchaToken}},xform:_sessionResponse}),{data:hr,error:pr}=dr;if(pr||!hr)return this._returnResult({data:{user:null,session:null},error:pr});const mr=hr.session,fr=hr.user;return hr.session&&(await this._saveSession(hr.session),await this._notifyAllSubscribers("SIGNED_IN",mr)),this._returnResult({data:{user:fr,session:mr},error:null})}catch(dr){if(isAuthError(dr))return this._returnResult({data:{user:null,session:null},error:dr});throw dr}}async signUp(or){var lr,cr,ur;try{let dr;if("email"in or){const{email:xr,password:Er,options:vr}=or;let gr=null,yr=null;this.flowType==="pkce"&&([gr,yr]=await getCodeChallengeAndMethod(this.storage,this.storageKey)),dr=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:vr==null?void 0:vr.emailRedirectTo,body:{email:xr,password:Er,data:(lr=vr==null?void 0:vr.data)!==null&&lr!==void 0?lr:{},gotrue_meta_security:{captcha_token:vr==null?void 0:vr.captchaToken},code_challenge:gr,code_challenge_method:yr},xform:_sessionResponse})}else if("phone"in or){const{phone:xr,password:Er,options:vr}=or;dr=await _request(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:xr,password:Er,data:(cr=vr==null?void 0:vr.data)!==null&&cr!==void 0?cr:{},channel:(ur=vr==null?void 0:vr.channel)!==null&&ur!==void 0?ur:"sms",gotrue_meta_security:{captcha_token:vr==null?void 0:vr.captchaToken}},xform:_sessionResponse})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:hr,error:pr}=dr;if(pr||!hr)return await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:pr});const mr=hr.session,fr=hr.user;return hr.session&&(await this._saveSession(hr.session),await this._notifyAllSubscribers("SIGNED_IN",mr)),this._returnResult({data:{user:fr,session:mr},error:null})}catch(dr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(dr))return this._returnResult({data:{user:null,session:null},error:dr});throw dr}}async signInWithPassword(or){try{let lr;if("email"in or){const{email:dr,password:hr,options:pr}=or;lr=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:dr,password:hr,gotrue_meta_security:{captcha_token:pr==null?void 0:pr.captchaToken}},xform:_sessionResponsePassword})}else if("phone"in or){const{phone:dr,password:hr,options:pr}=or;lr=await _request(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:dr,password:hr,gotrue_meta_security:{captcha_token:pr==null?void 0:pr.captchaToken}},xform:_sessionResponsePassword})}else throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a password");const{data:cr,error:ur}=lr;if(ur)return this._returnResult({data:{user:null,session:null},error:ur});if(!cr||!cr.session||!cr.user){const dr=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:dr})}return cr.session&&(await this._saveSession(cr.session),await this._notifyAllSubscribers("SIGNED_IN",cr.session)),this._returnResult({data:Object.assign({user:cr.user,session:cr.session},cr.weak_password?{weakPassword:cr.weak_password}:null),error:ur})}catch(lr){if(isAuthError(lr))return this._returnResult({data:{user:null,session:null},error:lr});throw lr}}async signInWithOAuth(or){var lr,cr,ur,dr;return await this._handleProviderSignIn(or.provider,{redirectTo:(lr=or.options)===null||lr===void 0?void 0:lr.redirectTo,scopes:(cr=or.options)===null||cr===void 0?void 0:cr.scopes,queryParams:(ur=or.options)===null||ur===void 0?void 0:ur.queryParams,skipBrowserRedirect:(dr=or.options)===null||dr===void 0?void 0:dr.skipBrowserRedirect})}async exchangeCodeForSession(or){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(or))}async signInWithWeb3(or){const{chain:lr}=or;switch(lr){case"ethereum":return await this.signInWithEthereum(or);case"solana":return await this.signInWithSolana(or);default:throw new Error(`@supabase/auth-js: Unsupported chain "${lr}"`)}}async signInWithEthereum(or){var lr,cr,ur,dr,hr,pr,mr,fr,xr,Er,vr;let gr,yr;if("message"in or)gr=or.message,yr=or.signature;else{const{chain:br,wallet:_r,statement:jr,options:wr}=or;let Sr;if(isBrowser())if(typeof _r=="object")Sr=_r;else{const Ar=window;if("ethereum"in Ar&&typeof Ar.ethereum=="object"&&"request"in Ar.ethereum&&typeof Ar.ethereum.request=="function")Sr=Ar.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof _r!="object"||!(wr!=null&&wr.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Sr=_r}const Tr=new URL((lr=wr==null?void 0:wr.url)!==null&&lr!==void 0?lr:window.location.href),Rr=await Sr.request({method:"eth_requestAccounts"}).then(Ar=>Ar).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Rr||Rr.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Nr=getAddress(Rr[0]);let Cr=(cr=wr==null?void 0:wr.signInWithEthereum)===null||cr===void 0?void 0:cr.chainId;if(!Cr){const Ar=await Sr.request({method:"eth_chainId"});Cr=fromHex(Ar)}const kr={domain:Tr.host,address:Nr,statement:jr,uri:Tr.href,version:"1",chainId:Cr,nonce:(ur=wr==null?void 0:wr.signInWithEthereum)===null||ur===void 0?void 0:ur.nonce,issuedAt:(hr=(dr=wr==null?void 0:wr.signInWithEthereum)===null||dr===void 0?void 0:dr.issuedAt)!==null&&hr!==void 0?hr:new Date,expirationTime:(pr=wr==null?void 0:wr.signInWithEthereum)===null||pr===void 0?void 0:pr.expirationTime,notBefore:(mr=wr==null?void 0:wr.signInWithEthereum)===null||mr===void 0?void 0:mr.notBefore,requestId:(fr=wr==null?void 0:wr.signInWithEthereum)===null||fr===void 0?void 0:fr.requestId,resources:(xr=wr==null?void 0:wr.signInWithEthereum)===null||xr===void 0?void 0:xr.resources};gr=createSiweMessage(kr),yr=await Sr.request({method:"personal_sign",params:[toHex(gr),Nr]})}try{const{data:br,error:_r}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:gr,signature:yr},!((Er=or.options)===null||Er===void 0)&&Er.captchaToken?{gotrue_meta_security:{captcha_token:(vr=or.options)===null||vr===void 0?void 0:vr.captchaToken}}:null),xform:_sessionResponse});if(_r)throw _r;if(!br||!br.session||!br.user){const jr=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:jr})}return br.session&&(await this._saveSession(br.session),await this._notifyAllSubscribers("SIGNED_IN",br.session)),this._returnResult({data:Object.assign({},br),error:_r})}catch(br){if(isAuthError(br))return this._returnResult({data:{user:null,session:null},error:br});throw br}}async signInWithSolana(or){var lr,cr,ur,dr,hr,pr,mr,fr,xr,Er,vr,gr;let yr,br;if("message"in or)yr=or.message,br=or.signature;else{const{chain:_r,wallet:jr,statement:wr,options:Sr}=or;let Tr;if(isBrowser())if(typeof jr=="object")Tr=jr;else{const Nr=window;if("solana"in Nr&&typeof Nr.solana=="object"&&("signIn"in Nr.solana&&typeof Nr.solana.signIn=="function"||"signMessage"in Nr.solana&&typeof Nr.solana.signMessage=="function"))Tr=Nr.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof jr!="object"||!(Sr!=null&&Sr.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Tr=jr}const Rr=new URL((lr=Sr==null?void 0:Sr.url)!==null&&lr!==void 0?lr:window.location.href);if("signIn"in Tr&&Tr.signIn){const Nr=await Tr.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Sr==null?void 0:Sr.signInWithSolana),{version:"1",domain:Rr.host,uri:Rr.href}),wr?{statement:wr}:null));let Cr;if(Array.isArray(Nr)&&Nr[0]&&typeof Nr[0]=="object")Cr=Nr[0];else if(Nr&&typeof Nr=="object"&&"signedMessage"in Nr&&"signature"in Nr)Cr=Nr;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Cr&&"signature"in Cr&&(typeof Cr.signedMessage=="string"||Cr.signedMessage instanceof Uint8Array)&&Cr.signature instanceof Uint8Array)yr=typeof Cr.signedMessage=="string"?Cr.signedMessage:new TextDecoder().decode(Cr.signedMessage),br=Cr.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Tr)||typeof Tr.signMessage!="function"||!("publicKey"in Tr)||typeof Tr!="object"||!Tr.publicKey||!("toBase58"in Tr.publicKey)||typeof Tr.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");yr=[`${Rr.host} wants you to sign in with your Solana account:`,Tr.publicKey.toBase58(),...wr?["",wr,""]:[""],"Version: 1",`URI: ${Rr.href}`,`Issued At: ${(ur=(cr=Sr==null?void 0:Sr.signInWithSolana)===null||cr===void 0?void 0:cr.issuedAt)!==null&&ur!==void 0?ur:new Date().toISOString()}`,...!((dr=Sr==null?void 0:Sr.signInWithSolana)===null||dr===void 0)&&dr.notBefore?[`Not Before: ${Sr.signInWithSolana.notBefore}`]:[],...!((hr=Sr==null?void 0:Sr.signInWithSolana)===null||hr===void 0)&&hr.expirationTime?[`Expiration Time: ${Sr.signInWithSolana.expirationTime}`]:[],...!((pr=Sr==null?void 0:Sr.signInWithSolana)===null||pr===void 0)&&pr.chainId?[`Chain ID: ${Sr.signInWithSolana.chainId}`]:[],...!((mr=Sr==null?void 0:Sr.signInWithSolana)===null||mr===void 0)&&mr.nonce?[`Nonce: ${Sr.signInWithSolana.nonce}`]:[],...!((fr=Sr==null?void 0:Sr.signInWithSolana)===null||fr===void 0)&&fr.requestId?[`Request ID: ${Sr.signInWithSolana.requestId}`]:[],...!((Er=(xr=Sr==null?void 0:Sr.signInWithSolana)===null||xr===void 0?void 0:xr.resources)===null||Er===void 0)&&Er.length?["Resources",...Sr.signInWithSolana.resources.map(Cr=>`- ${Cr}`)]:[]].join(`
`);const Nr=await Tr.signMessage(new TextEncoder().encode(yr),"utf8");if(!Nr||!(Nr instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");br=Nr}}try{const{data:_r,error:jr}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:yr,signature:bytesToBase64URL(br)},!((vr=or.options)===null||vr===void 0)&&vr.captchaToken?{gotrue_meta_security:{captcha_token:(gr=or.options)===null||gr===void 0?void 0:gr.captchaToken}}:null),xform:_sessionResponse});if(jr)throw jr;if(!_r||!_r.session||!_r.user){const wr=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:wr})}return _r.session&&(await this._saveSession(_r.session),await this._notifyAllSubscribers("SIGNED_IN",_r.session)),this._returnResult({data:Object.assign({},_r),error:jr})}catch(_r){if(isAuthError(_r))return this._returnResult({data:{user:null,session:null},error:_r});throw _r}}async _exchangeCodeForSession(or){const lr=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`),[cr,ur]=(lr??"").split("/");try{if(!cr&&this.flowType==="pkce")throw new AuthPKCECodeVerifierMissingError;const{data:dr,error:hr}=await _request(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:or,code_verifier:cr},xform:_sessionResponse});if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),hr)throw hr;if(!dr||!dr.session||!dr.user){const pr=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null,redirectType:null},error:pr})}return dr.session&&(await this._saveSession(dr.session),await this._notifyAllSubscribers("SIGNED_IN",dr.session)),this._returnResult({data:Object.assign(Object.assign({},dr),{redirectType:ur??null}),error:hr})}catch(dr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(dr))return this._returnResult({data:{user:null,session:null,redirectType:null},error:dr});throw dr}}async signInWithIdToken(or){try{const{options:lr,provider:cr,token:ur,access_token:dr,nonce:hr}=or,pr=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:cr,id_token:ur,access_token:dr,nonce:hr,gotrue_meta_security:{captcha_token:lr==null?void 0:lr.captchaToken}},xform:_sessionResponse}),{data:mr,error:fr}=pr;if(fr)return this._returnResult({data:{user:null,session:null},error:fr});if(!mr||!mr.session||!mr.user){const xr=new AuthInvalidTokenResponseError;return this._returnResult({data:{user:null,session:null},error:xr})}return mr.session&&(await this._saveSession(mr.session),await this._notifyAllSubscribers("SIGNED_IN",mr.session)),this._returnResult({data:mr,error:fr})}catch(lr){if(isAuthError(lr))return this._returnResult({data:{user:null,session:null},error:lr});throw lr}}async signInWithOtp(or){var lr,cr,ur,dr,hr;try{if("email"in or){const{email:pr,options:mr}=or;let fr=null,xr=null;this.flowType==="pkce"&&([fr,xr]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{error:Er}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:pr,data:(lr=mr==null?void 0:mr.data)!==null&&lr!==void 0?lr:{},create_user:(cr=mr==null?void 0:mr.shouldCreateUser)!==null&&cr!==void 0?cr:!0,gotrue_meta_security:{captcha_token:mr==null?void 0:mr.captchaToken},code_challenge:fr,code_challenge_method:xr},redirectTo:mr==null?void 0:mr.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:Er})}if("phone"in or){const{phone:pr,options:mr}=or,{data:fr,error:xr}=await _request(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:pr,data:(ur=mr==null?void 0:mr.data)!==null&&ur!==void 0?ur:{},create_user:(dr=mr==null?void 0:mr.shouldCreateUser)!==null&&dr!==void 0?dr:!0,gotrue_meta_security:{captcha_token:mr==null?void 0:mr.captchaToken},channel:(hr=mr==null?void 0:mr.channel)!==null&&hr!==void 0?hr:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:fr==null?void 0:fr.message_id},error:xr})}throw new AuthInvalidCredentialsError("You must provide either an email or phone number.")}catch(pr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(pr))return this._returnResult({data:{user:null,session:null},error:pr});throw pr}}async verifyOtp(or){var lr,cr;try{let ur,dr;"options"in or&&(ur=(lr=or.options)===null||lr===void 0?void 0:lr.redirectTo,dr=(cr=or.options)===null||cr===void 0?void 0:cr.captchaToken);const{data:hr,error:pr}=await _request(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},or),{gotrue_meta_security:{captcha_token:dr}}),redirectTo:ur,xform:_sessionResponse});if(pr)throw pr;if(!hr)throw new Error("An error occurred on token verification.");const mr=hr.session,fr=hr.user;return mr!=null&&mr.access_token&&(await this._saveSession(mr),await this._notifyAllSubscribers(or.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",mr)),this._returnResult({data:{user:fr,session:mr},error:null})}catch(ur){if(isAuthError(ur))return this._returnResult({data:{user:null,session:null},error:ur});throw ur}}async signInWithSSO(or){var lr,cr,ur,dr,hr;try{let pr=null,mr=null;this.flowType==="pkce"&&([pr,mr]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const fr=await _request(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in or?{provider_id:or.providerId}:null),"domain"in or?{domain:or.domain}:null),{redirect_to:(cr=(lr=or.options)===null||lr===void 0?void 0:lr.redirectTo)!==null&&cr!==void 0?cr:void 0}),!((ur=or==null?void 0:or.options)===null||ur===void 0)&&ur.captchaToken?{gotrue_meta_security:{captcha_token:or.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:pr,code_challenge_method:mr}),headers:this.headers,xform:_ssoResponse});return!((dr=fr.data)===null||dr===void 0)&&dr.url&&isBrowser()&&!(!((hr=or.options)===null||hr===void 0)&&hr.skipBrowserRedirect)&&window.location.assign(fr.data.url),this._returnResult(fr)}catch(pr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(pr))return this._returnResult({data:null,error:pr});throw pr}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async or=>{const{data:{session:lr},error:cr}=or;if(cr)throw cr;if(!lr)throw new AuthSessionMissingError;const{error:ur}=await _request(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:lr.access_token});return this._returnResult({data:{user:null,session:null},error:ur})})}catch(or){if(isAuthError(or))return this._returnResult({data:{user:null,session:null},error:or});throw or}}async resend(or){try{const lr=`${this.url}/resend`;if("email"in or){const{email:cr,type:ur,options:dr}=or,{error:hr}=await _request(this.fetch,"POST",lr,{headers:this.headers,body:{email:cr,type:ur,gotrue_meta_security:{captcha_token:dr==null?void 0:dr.captchaToken}},redirectTo:dr==null?void 0:dr.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:hr})}else if("phone"in or){const{phone:cr,type:ur,options:dr}=or,{data:hr,error:pr}=await _request(this.fetch,"POST",lr,{headers:this.headers,body:{phone:cr,type:ur,gotrue_meta_security:{captcha_token:dr==null?void 0:dr.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:hr==null?void 0:hr.message_id},error:pr})}throw new AuthInvalidCredentialsError("You must provide either an email or phone number and a type")}catch(lr){if(isAuthError(lr))return this._returnResult({data:{user:null,session:null},error:lr});throw lr}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async lr=>lr))}async _acquireLock(or,lr){this._debug("#_acquireLock","begin",or);try{if(this.lockAcquired){const cr=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),ur=(async()=>(await cr,await lr()))();return this.pendingInLock.push((async()=>{try{await ur}catch{}})()),ur}return await this.lock(`lock:${this.storageKey}`,or,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const cr=lr();for(this.pendingInLock.push((async()=>{try{await cr}catch{}})()),await cr;this.pendingInLock.length;){const ur=[...this.pendingInLock];await Promise.all(ur),this.pendingInLock.splice(0,ur.length)}return await cr}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(or){this._debug("#_useSession","begin");try{const lr=await this.__loadSession();return await or(lr)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let or=null;const lr=await getItemAsync(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",lr),lr!==null&&(this._isValidSession(lr)?or=lr:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!or)return{data:{session:null},error:null};const cr=or.expires_at?or.expires_at*1e3-Date.now()<EXPIRY_MARGIN_MS:!1;if(this._debug("#__loadSession()",`session has${cr?"":" not"} expired`,"expires_at",or.expires_at),!cr){if(this.userStorage){const hr=await getItemAsync(this.userStorage,this.storageKey+"-user");hr!=null&&hr.user?or.user=hr.user:or.user=userNotAvailableProxy()}if(this.storage.isServer&&or.user&&!or.user.__isUserNotAvailableProxy){const hr={value:this.suppressGetSessionWarning};or.user=insecureUserWarningProxy(or.user,hr),hr.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:or},error:null}}const{data:ur,error:dr}=await this._callRefreshToken(or.refresh_token);return dr?this._returnResult({data:{session:null},error:dr}):this._returnResult({data:{session:ur},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(or){if(or)return await this._getUser(or);await this.initializePromise;const lr=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return lr.data.user&&(this.suppressGetSessionWarning=!0),lr}async _getUser(or){try{return or?await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:or,xform:_userResponse}):await this._useSession(async lr=>{var cr,ur,dr;const{data:hr,error:pr}=lr;if(pr)throw pr;return!(!((cr=hr.session)===null||cr===void 0)&&cr.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new AuthSessionMissingError}:await _request(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(dr=(ur=hr.session)===null||ur===void 0?void 0:ur.access_token)!==null&&dr!==void 0?dr:void 0,xform:_userResponse})})}catch(lr){if(isAuthError(lr))return isAuthSessionMissingError(lr)&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:lr});throw lr}}async updateUser(or,lr={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(or,lr))}async _updateUser(or,lr={}){try{return await this._useSession(async cr=>{const{data:ur,error:dr}=cr;if(dr)throw dr;if(!ur.session)throw new AuthSessionMissingError;const hr=ur.session;let pr=null,mr=null;this.flowType==="pkce"&&or.email!=null&&([pr,mr]=await getCodeChallengeAndMethod(this.storage,this.storageKey));const{data:fr,error:xr}=await _request(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:lr==null?void 0:lr.emailRedirectTo,body:Object.assign(Object.assign({},or),{code_challenge:pr,code_challenge_method:mr}),jwt:hr.access_token,xform:_userResponse});if(xr)throw xr;return hr.user=fr.user,await this._saveSession(hr),await this._notifyAllSubscribers("USER_UPDATED",hr),this._returnResult({data:{user:hr.user},error:null})})}catch(cr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(cr))return this._returnResult({data:{user:null},error:cr});throw cr}}async setSession(or){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(or))}async _setSession(or){try{if(!or.access_token||!or.refresh_token)throw new AuthSessionMissingError;const lr=Date.now()/1e3;let cr=lr,ur=!0,dr=null;const{payload:hr}=decodeJWT(or.access_token);if(hr.exp&&(cr=hr.exp,ur=cr<=lr),ur){const{data:pr,error:mr}=await this._callRefreshToken(or.refresh_token);if(mr)return this._returnResult({data:{user:null,session:null},error:mr});if(!pr)return{data:{user:null,session:null},error:null};dr=pr}else{const{data:pr,error:mr}=await this._getUser(or.access_token);if(mr)return this._returnResult({data:{user:null,session:null},error:mr});dr={access_token:or.access_token,refresh_token:or.refresh_token,user:pr.user,token_type:"bearer",expires_in:cr-lr,expires_at:cr},await this._saveSession(dr),await this._notifyAllSubscribers("SIGNED_IN",dr)}return this._returnResult({data:{user:dr.user,session:dr},error:null})}catch(lr){if(isAuthError(lr))return this._returnResult({data:{session:null,user:null},error:lr});throw lr}}async refreshSession(or){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(or))}async _refreshSession(or){try{return await this._useSession(async lr=>{var cr;if(!or){const{data:hr,error:pr}=lr;if(pr)throw pr;or=(cr=hr.session)!==null&&cr!==void 0?cr:void 0}if(!(or!=null&&or.refresh_token))throw new AuthSessionMissingError;const{data:ur,error:dr}=await this._callRefreshToken(or.refresh_token);return dr?this._returnResult({data:{user:null,session:null},error:dr}):ur?this._returnResult({data:{user:ur.user,session:ur},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:{user:null,session:null},error:lr});throw lr}}async _getSessionFromURL(or,lr){try{if(!isBrowser())throw new AuthImplicitGrantRedirectError("No browser detected.");if(or.error||or.error_description||or.error_code)throw new AuthImplicitGrantRedirectError(or.error_description||"Error in URL with unspecified error_description",{error:or.error||"unspecified_error",code:or.error_code||"unspecified_code"});switch(lr){case"implicit":if(this.flowType==="pkce")throw new AuthPKCEGrantCodeExchangeError("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new AuthImplicitGrantRedirectError("Not a valid implicit grant flow url.");break;default:}if(lr==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!or.code)throw new AuthPKCEGrantCodeExchangeError("No code detected.");const{data:wr,error:Sr}=await this._exchangeCodeForSession(or.code);if(Sr)throw Sr;const Tr=new URL(window.location.href);return Tr.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Tr.toString()),{data:{session:wr.session,redirectType:null},error:null}}const{provider_token:cr,provider_refresh_token:ur,access_token:dr,refresh_token:hr,expires_in:pr,expires_at:mr,token_type:fr}=or;if(!dr||!pr||!hr||!fr)throw new AuthImplicitGrantRedirectError("No session defined in URL");const xr=Math.round(Date.now()/1e3),Er=parseInt(pr);let vr=xr+Er;mr&&(vr=parseInt(mr));const gr=vr-xr;gr*1e3<=AUTO_REFRESH_TICK_DURATION_MS&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${gr}s, should have been closer to ${Er}s`);const yr=vr-Er;xr-yr>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",yr,vr,xr):xr-yr<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",yr,vr,xr);const{data:br,error:_r}=await this._getUser(dr);if(_r)throw _r;const jr={provider_token:cr,provider_refresh_token:ur,access_token:dr,expires_in:Er,expires_at:vr,refresh_token:hr,token_type:fr,user:br.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:jr,redirectType:or.type},error:null})}catch(cr){if(isAuthError(cr))return this._returnResult({data:{session:null,redirectType:null},error:cr});throw cr}}_isImplicitGrantCallback(or){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),or):!!(or.access_token||or.error_description)}async _isPKCECallback(or){const lr=await getItemAsync(this.storage,`${this.storageKey}-code-verifier`);return!!(or.code&&lr)}async signOut(or={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(or))}async _signOut({scope:or}={scope:"global"}){return await this._useSession(async lr=>{var cr;const{data:ur,error:dr}=lr;if(dr&&!isAuthSessionMissingError(dr))return this._returnResult({error:dr});const hr=(cr=ur.session)===null||cr===void 0?void 0:cr.access_token;if(hr){const{error:pr}=await this.admin.signOut(hr,or);if(pr&&!(isAuthApiError(pr)&&(pr.status===404||pr.status===401||pr.status===403)||isAuthSessionMissingError(pr)))return this._returnResult({error:pr})}return or!=="others"&&(await this._removeSession(),await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(or){const lr=generateCallbackId(),cr={id:lr,callback:or,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",lr),this.stateChangeEmitters.delete(lr)}};return this._debug("#onAuthStateChange()","registered callback with id",lr),this.stateChangeEmitters.set(lr,cr),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(lr)})))(),{data:{subscription:cr}}}async _emitInitialSession(or){return await this._useSession(async lr=>{var cr,ur;try{const{data:{session:dr},error:hr}=lr;if(hr)throw hr;await((cr=this.stateChangeEmitters.get(or))===null||cr===void 0?void 0:cr.callback("INITIAL_SESSION",dr)),this._debug("INITIAL_SESSION","callback id",or,"session",dr)}catch(dr){await((ur=this.stateChangeEmitters.get(or))===null||ur===void 0?void 0:ur.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",or,"error",dr),console.error(dr)}})}async resetPasswordForEmail(or,lr={}){let cr=null,ur=null;this.flowType==="pkce"&&([cr,ur]=await getCodeChallengeAndMethod(this.storage,this.storageKey,!0));try{return await _request(this.fetch,"POST",`${this.url}/recover`,{body:{email:or,code_challenge:cr,code_challenge_method:ur,gotrue_meta_security:{captcha_token:lr.captchaToken}},headers:this.headers,redirectTo:lr.redirectTo})}catch(dr){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(dr))return this._returnResult({data:null,error:dr});throw dr}}async getUserIdentities(){var or;try{const{data:lr,error:cr}=await this.getUser();if(cr)throw cr;return this._returnResult({data:{identities:(or=lr.user.identities)!==null&&or!==void 0?or:[]},error:null})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async linkIdentity(or){return"token"in or?this.linkIdentityIdToken(or):this.linkIdentityOAuth(or)}async linkIdentityOAuth(or){var lr;try{const{data:cr,error:ur}=await this._useSession(async dr=>{var hr,pr,mr,fr,xr;const{data:Er,error:vr}=dr;if(vr)throw vr;const gr=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,or.provider,{redirectTo:(hr=or.options)===null||hr===void 0?void 0:hr.redirectTo,scopes:(pr=or.options)===null||pr===void 0?void 0:pr.scopes,queryParams:(mr=or.options)===null||mr===void 0?void 0:mr.queryParams,skipBrowserRedirect:!0});return await _request(this.fetch,"GET",gr,{headers:this.headers,jwt:(xr=(fr=Er.session)===null||fr===void 0?void 0:fr.access_token)!==null&&xr!==void 0?xr:void 0})});if(ur)throw ur;return isBrowser()&&!(!((lr=or.options)===null||lr===void 0)&&lr.skipBrowserRedirect)&&window.location.assign(cr==null?void 0:cr.url),this._returnResult({data:{provider:or.provider,url:cr==null?void 0:cr.url},error:null})}catch(cr){if(isAuthError(cr))return this._returnResult({data:{provider:or.provider,url:null},error:cr});throw cr}}async linkIdentityIdToken(or){return await this._useSession(async lr=>{var cr;try{const{error:ur,data:{session:dr}}=lr;if(ur)throw ur;const{options:hr,provider:pr,token:mr,access_token:fr,nonce:xr}=or,Er=await _request(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(cr=dr==null?void 0:dr.access_token)!==null&&cr!==void 0?cr:void 0,body:{provider:pr,id_token:mr,access_token:fr,nonce:xr,link_identity:!0,gotrue_meta_security:{captcha_token:hr==null?void 0:hr.captchaToken}},xform:_sessionResponse}),{data:vr,error:gr}=Er;return gr?this._returnResult({data:{user:null,session:null},error:gr}):!vr||!vr.session||!vr.user?this._returnResult({data:{user:null,session:null},error:new AuthInvalidTokenResponseError}):(vr.session&&(await this._saveSession(vr.session),await this._notifyAllSubscribers("USER_UPDATED",vr.session)),this._returnResult({data:vr,error:gr}))}catch(ur){if(await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`),isAuthError(ur))return this._returnResult({data:{user:null,session:null},error:ur});throw ur}})}async unlinkIdentity(or){try{return await this._useSession(async lr=>{var cr,ur;const{data:dr,error:hr}=lr;if(hr)throw hr;return await _request(this.fetch,"DELETE",`${this.url}/user/identities/${or.identity_id}`,{headers:this.headers,jwt:(ur=(cr=dr.session)===null||cr===void 0?void 0:cr.access_token)!==null&&ur!==void 0?ur:void 0})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async _refreshAccessToken(or){const lr=`#_refreshAccessToken(${or.substring(0,5)}...)`;this._debug(lr,"begin");try{const cr=Date.now();return await retryable(async ur=>(ur>0&&await sleep(200*Math.pow(2,ur-1)),this._debug(lr,"refreshing attempt",ur),await _request(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:or},headers:this.headers,xform:_sessionResponse})),(ur,dr)=>{const hr=200*Math.pow(2,ur);return dr&&isAuthRetryableFetchError(dr)&&Date.now()+hr-cr<AUTO_REFRESH_TICK_DURATION_MS})}catch(cr){if(this._debug(lr,"error",cr),isAuthError(cr))return this._returnResult({data:{session:null,user:null},error:cr});throw cr}finally{this._debug(lr,"end")}}_isValidSession(or){return typeof or=="object"&&or!==null&&"access_token"in or&&"refresh_token"in or&&"expires_at"in or}async _handleProviderSignIn(or,lr){const cr=await this._getUrlForProvider(`${this.url}/authorize`,or,{redirectTo:lr.redirectTo,scopes:lr.scopes,queryParams:lr.queryParams});return this._debug("#_handleProviderSignIn()","provider",or,"options",lr,"url",cr),isBrowser()&&!lr.skipBrowserRedirect&&window.location.assign(cr),{data:{provider:or,url:cr},error:null}}async _recoverAndRefresh(){var or,lr;const cr="#_recoverAndRefresh()";this._debug(cr,"begin");try{const ur=await getItemAsync(this.storage,this.storageKey);if(ur&&this.userStorage){let hr=await getItemAsync(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!hr&&(hr={user:ur.user},await setItemAsync(this.userStorage,this.storageKey+"-user",hr)),ur.user=(or=hr==null?void 0:hr.user)!==null&&or!==void 0?or:userNotAvailableProxy()}else if(ur&&!ur.user&&!ur.user){const hr=await getItemAsync(this.storage,this.storageKey+"-user");hr&&(hr!=null&&hr.user)?(ur.user=hr.user,await removeItemAsync(this.storage,this.storageKey+"-user"),await setItemAsync(this.storage,this.storageKey,ur)):ur.user=userNotAvailableProxy()}if(this._debug(cr,"session from storage",ur),!this._isValidSession(ur)){this._debug(cr,"session is not valid"),ur!==null&&await this._removeSession();return}const dr=((lr=ur.expires_at)!==null&&lr!==void 0?lr:1/0)*1e3-Date.now()<EXPIRY_MARGIN_MS;if(this._debug(cr,`session has${dr?"":" not"} expired with margin of ${EXPIRY_MARGIN_MS}s`),dr){if(this.autoRefreshToken&&ur.refresh_token){const{error:hr}=await this._callRefreshToken(ur.refresh_token);hr&&(console.error(hr),isAuthRetryableFetchError(hr)||(this._debug(cr,"refresh failed with a non-retryable error, removing the session",hr),await this._removeSession()))}}else if(ur.user&&ur.user.__isUserNotAvailableProxy===!0)try{const{data:hr,error:pr}=await this._getUser(ur.access_token);!pr&&(hr!=null&&hr.user)?(ur.user=hr.user,await this._saveSession(ur),await this._notifyAllSubscribers("SIGNED_IN",ur)):this._debug(cr,"could not get user data, skipping SIGNED_IN notification")}catch(hr){console.error("Error getting user data:",hr),this._debug(cr,"error getting user data, skipping SIGNED_IN notification",hr)}else await this._notifyAllSubscribers("SIGNED_IN",ur)}catch(ur){this._debug(cr,"error",ur),console.error(ur);return}finally{this._debug(cr,"end")}}async _callRefreshToken(or){var lr,cr;if(!or)throw new AuthSessionMissingError;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const ur=`#_callRefreshToken(${or.substring(0,5)}...)`;this._debug(ur,"begin");try{this.refreshingDeferred=new Deferred;const{data:dr,error:hr}=await this._refreshAccessToken(or);if(hr)throw hr;if(!dr.session)throw new AuthSessionMissingError;await this._saveSession(dr.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",dr.session);const pr={data:dr.session,error:null};return this.refreshingDeferred.resolve(pr),pr}catch(dr){if(this._debug(ur,"error",dr),isAuthError(dr)){const hr={data:null,error:dr};return isAuthRetryableFetchError(dr)||await this._removeSession(),(lr=this.refreshingDeferred)===null||lr===void 0||lr.resolve(hr),hr}throw(cr=this.refreshingDeferred)===null||cr===void 0||cr.reject(dr),dr}finally{this.refreshingDeferred=null,this._debug(ur,"end")}}async _notifyAllSubscribers(or,lr,cr=!0){const ur=`#_notifyAllSubscribers(${or})`;this._debug(ur,"begin",lr,`broadcast = ${cr}`);try{this.broadcastChannel&&cr&&this.broadcastChannel.postMessage({event:or,session:lr});const dr=[],hr=Array.from(this.stateChangeEmitters.values()).map(async pr=>{try{await pr.callback(or,lr)}catch(mr){dr.push(mr)}});if(await Promise.all(hr),dr.length>0){for(let pr=0;pr<dr.length;pr+=1)console.error(dr[pr]);throw dr[0]}}finally{this._debug(ur,"end")}}async _saveSession(or){this._debug("#_saveSession()",or),this.suppressGetSessionWarning=!0,await removeItemAsync(this.storage,`${this.storageKey}-code-verifier`);const lr=Object.assign({},or),cr=lr.user&&lr.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!cr&&lr.user&&await setItemAsync(this.userStorage,this.storageKey+"-user",{user:lr.user});const ur=Object.assign({},lr);delete ur.user;const dr=deepClone(ur);await setItemAsync(this.storage,this.storageKey,dr)}else{const ur=deepClone(lr);await setItemAsync(this.storage,this.storageKey,ur)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await removeItemAsync(this.storage,this.storageKey),await removeItemAsync(this.storage,this.storageKey+"-code-verifier"),await removeItemAsync(this.storage,this.storageKey+"-user"),this.userStorage&&await removeItemAsync(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const or=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{or&&isBrowser()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",or)}catch(lr){console.error("removing visibilitychange callback failed",lr)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const or=setInterval(()=>this._autoRefreshTokenTick(),AUTO_REFRESH_TICK_DURATION_MS);this.autoRefreshTicker=or,or&&typeof or=="object"&&typeof or.unref=="function"?or.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(or);const lr=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=lr,lr&&typeof lr=="object"&&typeof lr.unref=="function"?lr.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(lr)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const or=this.autoRefreshTicker;this.autoRefreshTicker=null,or&&clearInterval(or);const lr=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,lr&&clearTimeout(lr)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const or=Date.now();try{return await this._useSession(async lr=>{const{data:{session:cr}}=lr;if(!cr||!cr.refresh_token||!cr.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const ur=Math.floor((cr.expires_at*1e3-or)/AUTO_REFRESH_TICK_DURATION_MS);this._debug("#_autoRefreshTokenTick()",`access token expires in ${ur} ticks, a tick lasts ${AUTO_REFRESH_TICK_DURATION_MS}ms, refresh threshold is ${AUTO_REFRESH_TICK_THRESHOLD} ticks`),ur<=AUTO_REFRESH_TICK_THRESHOLD&&await this._callRefreshToken(cr.refresh_token)})}catch(lr){console.error("Auto refresh tick failed with error. This is likely a transient error.",lr)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(or){if(or.isAcquireTimeout||or instanceof LockAcquireTimeoutError)this._debug("auto refresh token tick lock not available");else throw or}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!isBrowser()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(or){this._debug("#visibilityChangedCallback","error",or)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(or){console.error("_handleVisibilityChange",or)}}async _onVisibilityChanged(or){const lr=`#_onVisibilityChanged(${or})`;this._debug(lr,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),or||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(lr,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(or,lr,cr){const ur=[`provider=${encodeURIComponent(lr)}`];if(cr!=null&&cr.redirectTo&&ur.push(`redirect_to=${encodeURIComponent(cr.redirectTo)}`),cr!=null&&cr.scopes&&ur.push(`scopes=${encodeURIComponent(cr.scopes)}`),this.flowType==="pkce"){const[dr,hr]=await getCodeChallengeAndMethod(this.storage,this.storageKey),pr=new URLSearchParams({code_challenge:`${encodeURIComponent(dr)}`,code_challenge_method:`${encodeURIComponent(hr)}`});ur.push(pr.toString())}if(cr!=null&&cr.queryParams){const dr=new URLSearchParams(cr.queryParams);ur.push(dr.toString())}return cr!=null&&cr.skipBrowserRedirect&&ur.push(`skip_http_redirect=${cr.skipBrowserRedirect}`),`${or}?${ur.join("&")}`}async _unenroll(or){try{return await this._useSession(async lr=>{var cr;const{data:ur,error:dr}=lr;return dr?this._returnResult({data:null,error:dr}):await _request(this.fetch,"DELETE",`${this.url}/factors/${or.factorId}`,{headers:this.headers,jwt:(cr=ur==null?void 0:ur.session)===null||cr===void 0?void 0:cr.access_token})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async _enroll(or){try{return await this._useSession(async lr=>{var cr,ur;const{data:dr,error:hr}=lr;if(hr)return this._returnResult({data:null,error:hr});const pr=Object.assign({friendly_name:or.friendlyName,factor_type:or.factorType},or.factorType==="phone"?{phone:or.phone}:or.factorType==="totp"?{issuer:or.issuer}:{}),{data:mr,error:fr}=await _request(this.fetch,"POST",`${this.url}/factors`,{body:pr,headers:this.headers,jwt:(cr=dr==null?void 0:dr.session)===null||cr===void 0?void 0:cr.access_token});return fr?this._returnResult({data:null,error:fr}):(or.factorType==="totp"&&mr.type==="totp"&&(!((ur=mr==null?void 0:mr.totp)===null||ur===void 0)&&ur.qr_code)&&(mr.totp.qr_code=`data:image/svg+xml;utf-8,${mr.totp.qr_code}`),this._returnResult({data:mr,error:null}))})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async _verify(or){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async lr=>{var cr;const{data:ur,error:dr}=lr;if(dr)return this._returnResult({data:null,error:dr});const hr=Object.assign({challenge_id:or.challengeId},"webauthn"in or?{webauthn:Object.assign(Object.assign({},or.webauthn),{credential_response:or.webauthn.type==="create"?serializeCredentialCreationResponse(or.webauthn.credential_response):serializeCredentialRequestResponse(or.webauthn.credential_response)})}:{code:or.code}),{data:pr,error:mr}=await _request(this.fetch,"POST",`${this.url}/factors/${or.factorId}/verify`,{body:hr,headers:this.headers,jwt:(cr=ur==null?void 0:ur.session)===null||cr===void 0?void 0:cr.access_token});return mr?this._returnResult({data:null,error:mr}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+pr.expires_in},pr)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",pr),this._returnResult({data:pr,error:mr}))})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}})}async _challenge(or){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async lr=>{var cr;const{data:ur,error:dr}=lr;if(dr)return this._returnResult({data:null,error:dr});const hr=await _request(this.fetch,"POST",`${this.url}/factors/${or.factorId}/challenge`,{body:or,headers:this.headers,jwt:(cr=ur==null?void 0:ur.session)===null||cr===void 0?void 0:cr.access_token});if(hr.error)return hr;const{data:pr}=hr;if(pr.type!=="webauthn")return{data:pr,error:null};switch(pr.webauthn.type){case"create":return{data:Object.assign(Object.assign({},pr),{webauthn:Object.assign(Object.assign({},pr.webauthn),{credential_options:Object.assign(Object.assign({},pr.webauthn.credential_options),{publicKey:deserializeCredentialCreationOptions(pr.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},pr),{webauthn:Object.assign(Object.assign({},pr.webauthn),{credential_options:Object.assign(Object.assign({},pr.webauthn.credential_options),{publicKey:deserializeCredentialRequestOptions(pr.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}})}async _challengeAndVerify(or){const{data:lr,error:cr}=await this._challenge({factorId:or.factorId});return cr?this._returnResult({data:null,error:cr}):await this._verify({factorId:or.factorId,challengeId:lr.id,code:or.code})}async _listFactors(){var or;const{data:{user:lr},error:cr}=await this.getUser();if(cr)return{data:null,error:cr};const ur={all:[],phone:[],totp:[],webauthn:[]};for(const dr of(or=lr==null?void 0:lr.factors)!==null&&or!==void 0?or:[])ur.all.push(dr),dr.status==="verified"&&ur[dr.factor_type].push(dr);return{data:ur,error:null}}async _getAuthenticatorAssuranceLevel(or){var lr,cr,ur,dr;if(or)try{const{payload:gr}=decodeJWT(or);let yr=null;gr.aal&&(yr=gr.aal);let br=yr;const{data:{user:_r},error:jr}=await this.getUser(or);if(jr)return this._returnResult({data:null,error:jr});((cr=(lr=_r==null?void 0:_r.factors)===null||lr===void 0?void 0:lr.filter(Tr=>Tr.status==="verified"))!==null&&cr!==void 0?cr:[]).length>0&&(br="aal2");const Sr=gr.amr||[];return{data:{currentLevel:yr,nextLevel:br,currentAuthenticationMethods:Sr},error:null}}catch(gr){if(isAuthError(gr))return this._returnResult({data:null,error:gr});throw gr}const{data:{session:hr},error:pr}=await this.getSession();if(pr)return this._returnResult({data:null,error:pr});if(!hr)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:mr}=decodeJWT(hr.access_token);let fr=null;mr.aal&&(fr=mr.aal);let xr=fr;((dr=(ur=hr.user.factors)===null||ur===void 0?void 0:ur.filter(gr=>gr.status==="verified"))!==null&&dr!==void 0?dr:[]).length>0&&(xr="aal2");const vr=mr.amr||[];return{data:{currentLevel:fr,nextLevel:xr,currentAuthenticationMethods:vr},error:null}}async _getAuthorizationDetails(or){try{return await this._useSession(async lr=>{const{data:{session:cr},error:ur}=lr;return ur?this._returnResult({data:null,error:ur}):cr?await _request(this.fetch,"GET",`${this.url}/oauth/authorizations/${or}`,{headers:this.headers,jwt:cr.access_token,xform:dr=>({data:dr,error:null})}):this._returnResult({data:null,error:new AuthSessionMissingError})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async _approveAuthorization(or,lr){try{return await this._useSession(async cr=>{const{data:{session:ur},error:dr}=cr;if(dr)return this._returnResult({data:null,error:dr});if(!ur)return this._returnResult({data:null,error:new AuthSessionMissingError});const hr=await _request(this.fetch,"POST",`${this.url}/oauth/authorizations/${or}/consent`,{headers:this.headers,jwt:ur.access_token,body:{action:"approve"},xform:pr=>({data:pr,error:null})});return hr.data&&hr.data.redirect_url&&isBrowser()&&!(lr!=null&&lr.skipBrowserRedirect)&&window.location.assign(hr.data.redirect_url),hr})}catch(cr){if(isAuthError(cr))return this._returnResult({data:null,error:cr});throw cr}}async _denyAuthorization(or,lr){try{return await this._useSession(async cr=>{const{data:{session:ur},error:dr}=cr;if(dr)return this._returnResult({data:null,error:dr});if(!ur)return this._returnResult({data:null,error:new AuthSessionMissingError});const hr=await _request(this.fetch,"POST",`${this.url}/oauth/authorizations/${or}/consent`,{headers:this.headers,jwt:ur.access_token,body:{action:"deny"},xform:pr=>({data:pr,error:null})});return hr.data&&hr.data.redirect_url&&isBrowser()&&!(lr!=null&&lr.skipBrowserRedirect)&&window.location.assign(hr.data.redirect_url),hr})}catch(cr){if(isAuthError(cr))return this._returnResult({data:null,error:cr});throw cr}}async _listOAuthGrants(){try{return await this._useSession(async or=>{const{data:{session:lr},error:cr}=or;return cr?this._returnResult({data:null,error:cr}):lr?await _request(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:lr.access_token,xform:ur=>({data:ur,error:null})}):this._returnResult({data:null,error:new AuthSessionMissingError})})}catch(or){if(isAuthError(or))return this._returnResult({data:null,error:or});throw or}}async _revokeOAuthGrant(or){try{return await this._useSession(async lr=>{const{data:{session:cr},error:ur}=lr;return ur?this._returnResult({data:null,error:ur}):cr?(await _request(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:cr.access_token,query:{client_id:or.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new AuthSessionMissingError})})}catch(lr){if(isAuthError(lr))return this._returnResult({data:null,error:lr});throw lr}}async fetchJwk(or,lr={keys:[]}){let cr=lr.keys.find(pr=>pr.kid===or);if(cr)return cr;const ur=Date.now();if(cr=this.jwks.keys.find(pr=>pr.kid===or),cr&&this.jwks_cached_at+JWKS_TTL>ur)return cr;const{data:dr,error:hr}=await _request(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(hr)throw hr;return!dr.keys||dr.keys.length===0||(this.jwks=dr,this.jwks_cached_at=ur,cr=dr.keys.find(pr=>pr.kid===or),!cr)?null:cr}async getClaims(or,lr={}){try{let cr=or;if(!cr){const{data:gr,error:yr}=await this.getSession();if(yr||!gr.session)return this._returnResult({data:null,error:yr});cr=gr.session.access_token}const{header:ur,payload:dr,signature:hr,raw:{header:pr,payload:mr}}=decodeJWT(cr);lr!=null&&lr.allowExpired||validateExp(dr.exp);const fr=!ur.alg||ur.alg.startsWith("HS")||!ur.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(ur.kid,lr!=null&&lr.keys?{keys:lr.keys}:lr==null?void 0:lr.jwks);if(!fr){const{error:gr}=await this.getUser(cr);if(gr)throw gr;return{data:{claims:dr,header:ur,signature:hr},error:null}}const xr=getAlgorithm(ur.alg),Er=await crypto.subtle.importKey("jwk",fr,xr,!0,["verify"]);if(!await crypto.subtle.verify(xr,Er,hr,stringToUint8Array(`${pr}.${mr}`)))throw new AuthInvalidJwtError("Invalid JWT signature");return{data:{claims:dr,header:ur,signature:hr},error:null}}catch(cr){if(isAuthError(cr))return this._returnResult({data:null,error:cr});throw cr}}}GoTrueClient.nextInstanceID={};const AuthClient=GoTrueClient,version="2.93.1";let JS_ENV="";typeof Deno<"u"?JS_ENV="deno":typeof document<"u"?JS_ENV="web":typeof navigator<"u"&&navigator.product==="ReactNative"?JS_ENV="react-native":JS_ENV="node";function getClientPlatform(){const ar=globalThis.process;if(ar&&ar.platform){const or=ar.platform;if(or==="darwin")return"macOS";if(or==="win32")return"Windows";if(or==="linux")return"Linux";if(or==="android")return"Android"}if(typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platform){const or=navigator.userAgentData.platform;if(or==="macOS")return"macOS";if(or==="Windows")return"Windows";if(or==="Linux")return"Linux";if(or==="Android")return"Android";if(or==="iOS")return"iOS"}return null}function getClientPlatformVersion(){const ar=globalThis.process;if(ar){const or=ar.versions;if(or&&or.node&&typeof window>"u")try{const lr=globalThis.require;if(lr)return lr("os").release()}catch{return null}}if(typeof Deno<"u"&&Deno.osRelease)try{return Deno.osRelease()}catch{return null}return typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platformVersion?navigator.userAgentData.platformVersion:null}function getClientRuntime(){if(typeof Deno<"u")return"deno";if(typeof Bun<"u")return"bun";const ar=globalThis.process;if(ar){const or=ar.versions;if(or&&or.node)return"node"}return null}function getClientRuntimeVersion(){if(typeof Deno<"u"&&Deno.version)return Deno.version.deno;if(typeof Bun<"u"&&Bun.version)return Bun.version;const ar=globalThis.process;if(ar){const or=ar.versions;if(or&&or.node)return or.node}return null}function buildHeaders(){const ar={"X-Client-Info":`supabase-js-${JS_ENV}/${version}`},or=getClientPlatform();or&&(ar["X-Supabase-Client-Platform"]=or);const lr=getClientPlatformVersion();lr&&(ar["X-Supabase-Client-Platform-Version"]=lr);const cr=getClientRuntime();cr&&(ar["X-Supabase-Client-Runtime"]=cr);const ur=getClientRuntimeVersion();return ur&&(ar["X-Supabase-Client-Runtime-Version"]=ur),ar}const DEFAULT_HEADERS=buildHeaders(),DEFAULT_GLOBAL_OPTIONS={headers:DEFAULT_HEADERS},DEFAULT_DB_OPTIONS={schema:"public"},DEFAULT_AUTH_OPTIONS={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},DEFAULT_REALTIME_OPTIONS={};function _typeof(ar){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(or){return typeof or}:function(or){return or&&typeof Symbol=="function"&&or.constructor===Symbol&&or!==Symbol.prototype?"symbol":typeof or},_typeof(ar)}function toPrimitive(ar,or){if(_typeof(ar)!="object"||!ar)return ar;var lr=ar[Symbol.toPrimitive];if(lr!==void 0){var cr=lr.call(ar,or);if(_typeof(cr)!="object")return cr;throw new TypeError("@@toPrimitive must return a primitive value.")}return(or==="string"?String:Number)(ar)}function toPropertyKey(ar){var or=toPrimitive(ar,"string");return _typeof(or)=="symbol"?or:or+""}function _defineProperty(ar,or,lr){return(or=toPropertyKey(or))in ar?Object.defineProperty(ar,or,{value:lr,enumerable:!0,configurable:!0,writable:!0}):ar[or]=lr,ar}function ownKeys(ar,or){var lr=Object.keys(ar);if(Object.getOwnPropertySymbols){var cr=Object.getOwnPropertySymbols(ar);or&&(cr=cr.filter(function(ur){return Object.getOwnPropertyDescriptor(ar,ur).enumerable})),lr.push.apply(lr,cr)}return lr}function _objectSpread2(ar){for(var or=1;or<arguments.length;or++){var lr=arguments[or]!=null?arguments[or]:{};or%2?ownKeys(Object(lr),!0).forEach(function(cr){_defineProperty(ar,cr,lr[cr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ar,Object.getOwnPropertyDescriptors(lr)):ownKeys(Object(lr)).forEach(function(cr){Object.defineProperty(ar,cr,Object.getOwnPropertyDescriptor(lr,cr))})}return ar}const resolveFetch=ar=>ar?(...or)=>ar(...or):(...or)=>fetch(...or),resolveHeadersConstructor=()=>Headers,fetchWithAuth=(ar,or,lr)=>{const cr=resolveFetch(lr),ur=resolveHeadersConstructor();return async(dr,hr)=>{var pr;const mr=(pr=await or())!==null&&pr!==void 0?pr:ar;let fr=new ur(hr==null?void 0:hr.headers);return fr.has("apikey")||fr.set("apikey",ar),fr.has("Authorization")||fr.set("Authorization",`Bearer ${mr}`),cr(dr,_objectSpread2(_objectSpread2({},hr),{},{headers:fr}))}};function ensureTrailingSlash(ar){return ar.endsWith("/")?ar:ar+"/"}function applySettingDefaults(ar,or){var lr,cr;const{db:ur,auth:dr,realtime:hr,global:pr}=ar,{db:mr,auth:fr,realtime:xr,global:Er}=or,vr={db:_objectSpread2(_objectSpread2({},mr),ur),auth:_objectSpread2(_objectSpread2({},fr),dr),realtime:_objectSpread2(_objectSpread2({},xr),hr),storage:{},global:_objectSpread2(_objectSpread2(_objectSpread2({},Er),pr),{},{headers:_objectSpread2(_objectSpread2({},(lr=Er==null?void 0:Er.headers)!==null&&lr!==void 0?lr:{}),(cr=pr==null?void 0:pr.headers)!==null&&cr!==void 0?cr:{})}),accessToken:async()=>""};return ar.accessToken?vr.accessToken=ar.accessToken:delete vr.accessToken,vr}function validateSupabaseUrl(ar){const or=ar==null?void 0:ar.trim();if(!or)throw new Error("supabaseUrl is required.");if(!or.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(ensureTrailingSlash(or))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var SupabaseAuthClient=class extends AuthClient{constructor(ar){super(ar)}},SupabaseClient=class{constructor(ar,or,lr){var cr,ur;this.supabaseUrl=ar,this.supabaseKey=or;const dr=validateSupabaseUrl(ar);if(!or)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",dr),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",dr),this.storageUrl=new URL("storage/v1",dr),this.functionsUrl=new URL("functions/v1",dr);const hr=`sb-${dr.hostname.split(".")[0]}-auth-token`,pr={db:DEFAULT_DB_OPTIONS,realtime:DEFAULT_REALTIME_OPTIONS,auth:_objectSpread2(_objectSpread2({},DEFAULT_AUTH_OPTIONS),{},{storageKey:hr}),global:DEFAULT_GLOBAL_OPTIONS},mr=applySettingDefaults(lr??{},pr);if(this.storageKey=(cr=mr.auth.storageKey)!==null&&cr!==void 0?cr:"",this.headers=(ur=mr.global.headers)!==null&&ur!==void 0?ur:{},mr.accessToken)this.accessToken=mr.accessToken,this.auth=new Proxy({},{get:(xr,Er)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(Er)} is not possible`)}});else{var fr;this.auth=this._initSupabaseAuthClient((fr=mr.auth)!==null&&fr!==void 0?fr:{},this.headers,mr.global.fetch)}this.fetch=fetchWithAuth(or,this._getAccessToken.bind(this),mr.global.fetch),this.realtime=this._initRealtimeClient(_objectSpread2({headers:this.headers,accessToken:this._getAccessToken.bind(this)},mr.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(xr=>this.realtime.setAuth(xr)).catch(xr=>console.warn("Failed to set initial Realtime auth token:",xr)),this.rest=new PostgrestClient(new URL("rest/v1",dr).href,{headers:this.headers,schema:mr.db.schema,fetch:this.fetch}),this.storage=new StorageClient(this.storageUrl.href,this.headers,this.fetch,lr==null?void 0:lr.storage),mr.accessToken||this._listenForAuthEvents()}get functions(){return new FunctionsClient(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(ar){return this.rest.from(ar)}schema(ar){return this.rest.schema(ar)}rpc(ar,or={},lr={head:!1,get:!1,count:void 0}){return this.rest.rpc(ar,or,lr)}channel(ar,or={config:{}}){return this.realtime.channel(ar,or)}getChannels(){return this.realtime.getChannels()}removeChannel(ar){return this.realtime.removeChannel(ar)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var ar=this,or,lr;if(ar.accessToken)return await ar.accessToken();const{data:cr}=await ar.auth.getSession();return(or=(lr=cr.session)===null||lr===void 0?void 0:lr.access_token)!==null&&or!==void 0?or:ar.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:ar,persistSession:or,detectSessionInUrl:lr,storage:cr,userStorage:ur,storageKey:dr,flowType:hr,lock:pr,debug:mr,throwOnError:fr},xr,Er){const vr={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient({url:this.authUrl.href,headers:_objectSpread2(_objectSpread2({},vr),xr),storageKey:dr,autoRefreshToken:ar,persistSession:or,detectSessionInUrl:lr,storage:cr,userStorage:ur,flowType:hr,lock:pr,debug:mr,throwOnError:fr,fetch:Er,hasCustomAuthorizationHeader:Object.keys(this.headers).some(gr=>gr.toLowerCase()==="authorization")})}_initRealtimeClient(ar){return new RealtimeClient(this.realtimeUrl.href,_objectSpread2(_objectSpread2({},ar),{},{params:_objectSpread2(_objectSpread2({},{apikey:this.supabaseKey}),ar==null?void 0:ar.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((ar,or)=>{this._handleTokenChanged(ar,"CLIENT",or==null?void 0:or.access_token)})}_handleTokenChanged(ar,or,lr){(ar==="TOKEN_REFRESHED"||ar==="SIGNED_IN")&&this.changedAccessToken!==lr?(this.changedAccessToken=lr,this.realtime.setAuth(lr)):ar==="SIGNED_OUT"&&(this.realtime.setAuth(),or=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const createClient=(ar,or,lr)=>new SupabaseClient(ar,or,lr);function shouldShowDeprecationWarning(){if(typeof window<"u")return!1;const ar=globalThis.process;if(!ar)return!1;const or=ar.version;if(or==null)return!1;const lr=or.match(/^v(\d+)\./);return lr?parseInt(lr[1],10)<=18:!1}shouldShowDeprecationWarning()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const supabaseUrl=void 0,supabaseAnonKey=void 0,isSupabaseConfigured=!!supabaseUrl,supabase=isSupabaseConfigured?createClient(supabaseUrl,supabaseAnonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:localStorage,storageKey:"checks-happy-auth"}}):createClient("https://placeholder.supabase.co","placeholder-key",{auth:{autoRefreshToken:!1,persistSession:!1}});async function signUp({email:ar,password:or,name:lr}){try{const{data:cr,error:ur}=await supabase.auth.signUp({email:ar,password:or,options:{data:{name:lr}}});if(ur)throw ur;if(!cr.user)throw new Error("No user returned from sign up");const{error:dr}=await supabase.from("users").insert({id:cr.user.id,email:ar,name:lr,tier:"trainee"});return dr&&console.error("Error creating user profile:",dr),{user:cr.user,error:null}}catch(cr){return{user:null,error:cr}}}async function signIn({email:ar,password:or}){try{const{data:lr,error:cr}=await supabase.auth.signInWithPassword({email:ar,password:or});if(cr)throw cr;return{user:lr.user,error:null}}catch(lr){return{user:null,error:lr}}}async function signOut(){try{const{error:ar}=await supabase.auth.signOut();if(ar)throw ar;return{error:null}}catch(ar){return{error:ar}}}async function getUserProfile(ar){try{const{data:or,error:lr}=await supabase.from("users").select("*").eq("id",ar).single();if(lr)throw lr;return{profile:or,error:null}}catch(or){return{profile:null,error:or}}}async function updateUserProfile(ar,or){try{const{error:lr}=await supabase.from("users").update(or).eq("id",ar);if(lr)throw lr;return{error:null}}catch(lr){return{error:lr}}}async function updateUserTier(ar,or){return updateUserProfile(ar,{tier:or})}async function resetPassword(ar){try{const{error:or}=await supabase.auth.resetPasswordForEmail(ar,{redirectTo:`${window.location.origin}/reset-password`});if(or)throw or;return{error:null}}catch(or){return{error:or}}}async function getSession(){const{data:{session:ar},error:or}=await supabase.auth.getSession();if(or)throw or;return ar}function generateInviteCode(){const ar="ABCDEFGHJKLMNPQRSTUVWXYZ",or="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let lr="";for(let cr=0;cr<3;cr++)lr+=ar[Math.floor(Math.random()*ar.length)];lr+="-";for(let cr=0;cr<4;cr++)lr+=or[Math.floor(Math.random()*or.length)];return lr}async function createProject(ar,or,lr,cr="designer"){try{const ur=generateInviteCode(),{data:dr,error:hr}=await supabase.from("projects").insert({name:ar,production_type:or,invite_code:ur,created_by:lr}).select().single();if(hr)throw hr;const{error:pr}=await supabase.from("project_members").insert({project_id:dr.id,user_id:lr,role:cr,is_owner:!0});if(pr)throw await supabase.from("projects").delete().eq("id",dr.id),pr;return{project:dr,inviteCode:ur,error:null}}catch(ur){return{project:null,inviteCode:null,error:ur}}}async function getProjectByInviteCode(ar){try{const{data:or,error:lr}=await supabase.rpc("lookup_project_by_invite_code",{invite_code_input:ar.toUpperCase()});if(lr)throw lr;if(or!=null&&or.error)throw new Error(or.error);return{project:{id:or.id,name:or.name,production_type:or.production_type,invite_code:or.invite_code},error:null}}catch(or){return{project:null,error:or}}}async function joinProject(ar,or,lr="floor"){try{const{data:cr,error:ur}=await supabase.rpc("join_project_by_invite_code",{invite_code_input:ar.toUpperCase(),role_input:lr});if(ur)throw ur;if(cr!=null&&cr.error)throw new Error(cr.error);return{project:{id:cr.project_id,name:cr.project_name,production_type:cr.production_type,invite_code:cr.invite_code,created_at:cr.created_at},error:null}}catch(cr){return{project:null,error:cr}}}async function getUserProjects(ar){try{const{data:or,error:lr}=await supabase.from("project_members").select(`
        role,
        is_owner,
        joined_at,
        projects (*, users:created_by (name))
      `).eq("user_id",ar).order("joined_at",{ascending:!1});if(lr)throw lr;const cr=(or||[]).map(ur=>{var dr,hr;return{...ur.projects,role:ur.role,is_owner:ur.is_owner,owner_name:((hr=(dr=ur.projects)==null?void 0:dr.users)==null?void 0:hr.name)||void 0}});for(const ur of cr)delete ur.users;return{projects:cr,error:null}}catch(or){return{projects:[],error:or}}}async function getProjectData(ar){try{const[or,lr,cr,ur,dr,hr]=await Promise.all([supabase.from("scenes").select("*").eq("project_id",ar).order("scene_number"),supabase.from("characters").select("*").eq("project_id",ar).order("name"),supabase.from("looks").select("*").eq("project_id",ar),supabase.from("schedule_data").select("*").eq("project_id",ar).order("created_at",{ascending:!1}).limit(1),supabase.from("call_sheet_data").select("*").eq("project_id",ar).order("production_day"),supabase.from("script_uploads").select("*").eq("project_id",ar).eq("is_active",!0).limit(1)]);if(or.error)throw or.error;if(lr.error)throw lr.error;if(cr.error)throw cr.error;const pr=or.data||[],mr=cr.data||[],fr=pr.map(gr=>gr.id),xr=mr.map(gr=>gr.id),[Er,vr]=await Promise.all([fr.length>0?supabase.from("scene_characters").select("scene_id, character_id").in("scene_id",fr):Promise.resolve({data:[],error:null}),xr.length>0?supabase.from("look_scenes").select("look_id, scene_number").in("look_id",xr):Promise.resolve({data:[],error:null})]);return{scenes:pr,characters:lr.data||[],looks:mr,sceneCharacters:Er.data||[],lookScenes:vr.data||[],scheduleData:ur.data||[],callSheetData:dr.data||[],scriptData:hr.data||[],error:null}}catch(or){return{scenes:[],characters:[],looks:[],sceneCharacters:[],lookScenes:[],scheduleData:[],callSheetData:[],scriptData:[],error:or}}}async function regenerateInviteCode(ar){try{const or=generateInviteCode(),{error:lr}=await supabase.from("projects").update({invite_code:or}).eq("id",ar);if(lr)throw lr;return{inviteCode:or,error:null}}catch(or){return{inviteCode:null,error:or}}}async function removeMember(ar,or){try{const{error:lr}=await supabase.from("project_members").delete().eq("project_id",ar).eq("user_id",or);if(lr)throw lr;return{error:null}}catch(lr){return{error:lr}}}async function updateMemberRole(ar,or,lr){try{const{error:cr}=await supabase.from("project_members").update({role:lr}).eq("project_id",ar).eq("user_id",or);if(cr)throw cr;return{error:null}}catch(cr){return{error:cr}}}async function getProjectMembers(ar){try{const{data:or,error:lr}=await supabase.from("project_members").select(`
        *,
        users (name, email)
      `).eq("project_id",ar).order("joined_at");if(lr)throw lr;return{members:(or||[]).map(ur=>{var dr,hr;return{...ur,user:{name:((dr=ur.users)==null?void 0:dr.name)||ur.user_id.slice(0,8),email:((hr=ur.users)==null?void 0:hr.email)||""}}}),error:null}}catch(or){return{members:[],error:or}}}const DELETION_GRACE_PERIOD_HOURS=48;async function deleteProject(ar,or){var lr,cr;try{const{data:ur,error:dr}=await supabase.from("project_members").select("is_owner").eq("project_id",ar).eq("user_id",or).single();if(dr)throw new Error("Failed to verify project ownership");if(!(ur!=null&&ur.is_owner))throw new Error("Only project owners can delete projects");const{error:hr}=await supabase.from("projects").update({pending_deletion_at:new Date().toISOString()}).eq("id",ar);if(hr){if(((lr=hr.message)==null?void 0:lr.includes("schema cache"))||((cr=hr.message)==null?void 0:cr.includes("pending_deletion_at"))||hr.code==="PGRST204")return console.warn("[deleteProject] pending_deletion_at column not available, falling back to hard delete"),finalizeProjectDeletion(ar,or);throw hr}return{error:null}}catch(ur){return{error:ur}}}async function finalizeProjectDeletion(ar,or){try{const{data:lr,error:cr}=await supabase.from("project_members").select("is_owner").eq("project_id",ar).eq("user_id",or).single();if(cr)throw new Error("Failed to verify project ownership");if(!(lr!=null&&lr.is_owner))throw new Error("Only project owners can delete projects");const{data:ur}=await supabase.from("scenes").select("id").eq("project_id",ar),dr=(ur==null?void 0:ur.map(fr=>fr.id))||[],{data:hr}=await supabase.from("looks").select("id").eq("project_id",ar),pr=(hr==null?void 0:hr.map(fr=>fr.id))||[];dr.length>0&&await supabase.from("scene_characters").delete().in("scene_id",dr),pr.length>0&&await supabase.from("look_scenes").delete().in("look_id",pr),await supabase.from("looks").delete().eq("project_id",ar),await supabase.from("characters").delete().eq("project_id",ar),await supabase.from("scenes").delete().eq("project_id",ar),await supabase.from("project_members").delete().eq("project_id",ar);const{error:mr}=await supabase.from("projects").delete().eq("id",ar);if(mr)throw mr;return{error:null}}catch(lr){return{error:lr}}}function isDeletionGracePeriodExpired(ar){const or=new Date(ar),lr=new Date(or.getTime()+DELETION_GRACE_PERIOD_HOURS*60*60*1e3);return new Date>=lr}function hoursUntilDeletion(ar){const or=new Date(ar),cr=new Date(or.getTime()+DELETION_GRACE_PERIOD_HOURS*60*60*1e3).getTime()-new Date().getTime();return Math.max(0,Math.ceil(cr/(1e3*60*60)))}async function leaveProject(ar,or){try{const{data:lr,error:cr}=await supabase.from("project_members").select("is_owner").eq("project_id",ar).eq("user_id",or).single();if(cr)throw new Error("Failed to verify membership");if(lr!=null&&lr.is_owner)throw new Error("Owners cannot leave their own project. Transfer ownership or delete the project instead.");const{error:ur}=await supabase.from("project_members").delete().eq("project_id",ar).eq("user_id",or);if(ur)throw ur;return{error:null}}catch(lr){return{error:lr}}}const BUCKET_NAME="continuity-photos",DOCUMENTS_BUCKET="project-documents";async function uploadPhoto(ar,or,lr,cr){try{const ur=lr instanceof File?lr.name.split(".").pop():"jpg",dr=v4(),hr=`${ar}/${or}/${dr}.${ur}`,{data:pr,error:mr}=await supabase.storage.from(BUCKET_NAME).upload(hr,lr,{contentType:lr.type||"image/jpeg",cacheControl:"3600",upsert:!1});if(mr)throw mr;const{data:fr}=supabase.storage.from(BUCKET_NAME).getPublicUrl(hr);return{result:{path:pr.path,url:fr.publicUrl},error:null}}catch(ur){return{result:null,error:ur}}}async function uploadBase64Photo(ar,or,lr,cr="image/jpeg"){try{const dr=await(await fetch(lr)).blob();return uploadPhoto(ar,or,dr)}catch(ur){return{result:null,error:ur}}}async function downloadPhoto(ar){try{const{data:or,error:lr}=await supabase.storage.from(BUCKET_NAME).download(ar);if(lr)throw lr;return{blob:or,error:null}}catch(or){return{blob:null,error:or}}}async function uploadDocument(ar,or,lr,cr){try{const ur=(cr==null?void 0:cr.split(".").pop())||"pdf",dr=v4(),hr=`${ar}/${or}/${dr}.${ur}`,{error:pr}=await supabase.storage.from(DOCUMENTS_BUCKET).upload(hr,lr,{contentType:lr instanceof File?lr.type:"application/pdf",cacheControl:"3600",upsert:!1});if(pr)throw pr;return{path:hr,error:null}}catch(ur){return{path:null,error:ur}}}async function uploadBase64Document(ar,or,lr){try{const ur=await(await fetch(lr)).blob();return uploadDocument(ar,or,ur,"document.pdf")}catch(cr){return{path:null,error:cr}}}async function downloadDocumentAsDataUri(ar){try{const{data:or,error:lr}=await supabase.storage.from(DOCUMENTS_BUCKET).download(ar);if(lr)throw lr;if(!or)throw new Error("No data returned");return{dataUri:await new Promise(ur=>{const dr=new FileReader;dr.onload=()=>ur(dr.result),dr.readAsDataURL(or)}),error:null}}catch(or){return{dataUri:null,error:or}}}const VALID_TIERS=["trainee","artist","supervisor","designer"];function toAppUser(ar){const or=VALID_TIERS.includes(ar.tier)?ar.tier:"trainee";return{id:ar.id,email:ar.email,name:ar.name,tier:or,createdAt:new Date(ar.created_at)}}function toProjectMembership(ar){return{projectId:ar.id,projectName:ar.name,productionType:ar.production_type,role:ar.is_owner?"owner":ar.role,joinedAt:new Date(ar.created_at),lastAccessedAt:new Date,teamMemberCount:0,sceneCount:0,projectCode:ar.invite_code,status:ar.status==="wrapped"?"wrapped":"active",ownerName:ar.owner_name,pendingDeletionAt:ar.pending_deletion_at?new Date(ar.pending_deletion_at):null}}const useAuthStore=create()(persist((ar,or)=>({isAuthenticated:!1,user:null,isLoading:!1,error:null,currentScreen:"welcome",screenHistory:[],hasCompletedOnboarding:!1,hasSelectedPlan:!1,subscription:createDefaultSubscription(),projectMemberships:[],guestProjectCode:null,pinnedProjectId:null,settingsProjectId:null,initializeAuth:async()=>{try{const lr=await getSession();if(lr!=null&&lr.user){const{profile:cr,error:ur}=await getUserProfile(lr.user.id);if(cr&&!ur){const dr=toAppUser(cr),{projects:hr}=await getUserProjects(lr.user.id),pr=hr.map(toProjectMembership);ar({isAuthenticated:!0,user:dr,projectMemberships:pr,hasCompletedOnboarding:!0,hasSelectedPlan:!0,currentScreen:"hub"})}}}catch(lr){console.error("Error initializing auth:",lr)}},refreshUserProjects:async()=>{const{user:lr}=or();if(lr)try{const{projects:cr}=await getUserProjects(lr.id);for(const hr of cr)hr.is_owner&&hr.pending_deletion_at&&isDeletionGracePeriodExpired(hr.pending_deletion_at)&&await finalizeProjectDeletion(hr.id,lr.id).catch(console.error);const dr=cr.filter(hr=>!hr.is_owner||!hr.pending_deletion_at||!isDeletionGracePeriodExpired(hr.pending_deletion_at)).map(toProjectMembership);ar({projectMemberships:dr})}catch(cr){console.error("Error refreshing projects:",cr)}},setScreen:(lr,cr=!0)=>{const{currentScreen:ur,screenHistory:dr}=or();lr!==ur&&ar(cr?{currentScreen:lr,screenHistory:[...dr,ur],error:null}:{currentScreen:lr,error:null})},goBack:()=>{const{screenHistory:lr,isAuthenticated:cr}=or();if(lr.length>0){const ur=[...lr],dr=ur.pop();ar({currentScreen:dr,screenHistory:ur,error:null})}else ar({currentScreen:cr?"hub":"welcome",error:null})},signIn:async(lr,cr)=>{var ur,dr;ar({isLoading:!0,error:null});try{const{user:hr,error:pr}=await signIn({email:lr,password:cr});if(pr){const xr=pr.message.includes("Invalid login")?"Invalid email or password":pr.message;return ar({isLoading:!1,error:xr}),!1}if(!hr)return ar({isLoading:!1,error:"Sign in failed. Please try again."}),!1;const{profile:mr,error:fr}=await getUserProfile(hr.id);if(fr||!mr){await supabase.from("users").insert({id:hr.id,email:hr.email,name:((ur=hr.user_metadata)==null?void 0:ur.name)||lr.split("@")[0],tier:"trainee"});const xr={id:hr.id,email:hr.email,name:((dr=hr.user_metadata)==null?void 0:dr.name)||lr.split("@")[0],tier:"trainee",createdAt:new Date};ar({isAuthenticated:!0,user:xr,isLoading:!1,error:null,currentScreen:"hub",hasCompletedOnboarding:!0,hasSelectedPlan:!0})}else{const xr=toAppUser(mr),{projects:Er}=await getUserProjects(hr.id),vr=Er.map(toProjectMembership);ar({isAuthenticated:!0,user:xr,projectMemberships:vr,isLoading:!1,error:null,currentScreen:"hub",hasCompletedOnboarding:!0,hasSelectedPlan:!0})}return!0}catch(hr){return console.error("Sign in error:",hr),ar({isLoading:!1,error:"An error occurred. Please try again."}),!1}},signUp:async(lr,cr,ur)=>{ar({isLoading:!0,error:null});try{const{user:dr,error:hr}=await signUp({email:cr,password:ur,name:lr});if(hr){const mr=hr.message.includes("already registered")?"An account with this email already exists":hr.message;return ar({isLoading:!1,error:mr}),!1}if(!dr)return ar({isLoading:!1,error:"Sign up failed. Please try again."}),!1;const pr={id:dr.id,email:dr.email,name:lr,tier:BETA_MODE?"designer":"trainee",createdAt:new Date};return ar({isAuthenticated:!0,user:pr,isLoading:!1,error:null,currentScreen:BETA_MODE?"hub":"select-plan",hasCompletedOnboarding:BETA_MODE,hasSelectedPlan:BETA_MODE,subscription:createDefaultSubscription(),projectMemberships:[]}),!0}catch(dr){return console.error("Sign up error:",dr),ar({isLoading:!1,error:"An error occurred. Please try again."}),!1}},signOut:async()=>{try{await signOut()}catch(lr){console.error("Sign out error:",lr)}ar({isAuthenticated:!1,user:null,currentScreen:"welcome",screenHistory:[],hasCompletedOnboarding:!1,hasSelectedPlan:!1,subscription:createDefaultSubscription(),projectMemberships:[],guestProjectCode:null})},joinProject:async(lr,cr)=>{const{user:ur,projectMemberships:dr,isAuthenticated:hr}=or();ar({isLoading:!0,error:null});try{if(!hr||!ur)return ar({isLoading:!1,error:"Please create an account first to join a project."}),{success:!1,error:"Account required"};const pr=cr||"floor",{project:mr,error:fr}=await joinProject(lr,ur.id,pr);if(fr)return ar({isLoading:!1,error:fr.message}),{success:!1,error:fr.message};if(!mr)return ar({isLoading:!1,error:"Failed to join project"}),{success:!1,error:"Failed to join project"};let xr;try{const{members:Rr}=await getProjectMembers(mr.id),Nr=Rr.find(Cr=>Cr.is_owner);Nr&&(xr=Nr.user.name)}catch{}const Er={projectId:mr.id,projectName:mr.name,productionType:mr.production_type,role:pr,joinedAt:new Date,lastAccessedAt:new Date,teamMemberCount:1,sceneCount:0,projectCode:mr.invite_code,status:"active",ownerName:xr,pendingDeletionAt:null},{scenes:vr,characters:gr,looks:yr,sceneCharacters:br,lookScenes:_r,scheduleData:jr,callSheetData:wr,scriptData:Sr}=await getProjectData(mr.id),Tr=useProjectStore.getState();if(vr.length>0||gr.length>0){const Rr=new Map;for(const Lr of br){const Fr=Rr.get(Lr.scene_id)||[];Fr.push(Lr.character_id),Rr.set(Lr.scene_id,Fr)}const Nr=new Map;for(const Lr of _r){const Fr=Nr.get(Lr.look_id)||[];Fr.push(Lr.scene_number),Nr.set(Lr.look_id,Fr)}const Cr=vr.map(Lr=>({id:Lr.id,sceneNumber:Lr.scene_number,slugline:Lr.location||`Scene ${Lr.scene_number}`,intExt:Lr.int_ext==="EXT"?"EXT":"INT",timeOfDay:Lr.time_of_day||"DAY",synopsis:Lr.synopsis||void 0,characters:Rr.get(Lr.id)||[],isComplete:Lr.is_complete,completedAt:Lr.completed_at?new Date(Lr.completed_at):void 0,filmingStatus:Lr.filming_status,filmingNotes:Lr.filming_notes||void 0,shootingDay:Lr.shooting_day||void 0,characterConfirmationStatus:"confirmed"})),kr=gr.map(Lr=>({id:Lr.id,name:Lr.name,initials:Lr.initials,avatarColour:Lr.avatar_colour})),Ar=yr.map(Lr=>({id:Lr.id,characterId:Lr.character_id,name:Lr.name,scenes:Nr.get(Lr.id)||[],estimatedTime:Lr.estimated_time,makeup:Lr.makeup_details||createEmptyMakeupDetails(),hair:Lr.hair_details||createEmptyHairDetails()})),Or={id:mr.id,name:mr.name,createdAt:new Date(mr.created_at),updatedAt:new Date,scenes:Cr,characters:kr,looks:Ar};Tr.setProject(Or)}else{const Rr={id:mr.id,name:mr.name,createdAt:new Date(mr.created_at),updatedAt:new Date,scenes:[],characters:[],looks:[]};Tr.setProject(Rr)}if(jr.length>0){const Rr=jr[0];if(Rr.days||Rr.cast_list){const Nr={id:Rr.id,status:Rr.status==="complete"?"complete":"pending",castList:Rr.cast_list||[],days:Rr.days||[],totalDays:(Rr.days||[]).length,uploadedAt:new Date(Rr.created_at),rawText:Rr.raw_pdf_text||void 0};useScheduleStore.getState().setSchedule(Nr)}}if(wr.length>0){const Rr=useCallSheetStore.getState();Rr.clearAll();const Nr=wr.map(kr=>{const Ar=kr.parsed_data||{};return{...Ar,id:kr.id,date:kr.shoot_date,productionDay:kr.production_day,rawText:kr.raw_text||Ar.rawText,pdfUri:void 0,uploadedAt:new Date(kr.created_at),scenes:Ar.scenes||[]}});for(const kr of Nr)useCallSheetStore.setState(Ar=>({callSheets:[...Ar.callSheets,kr].sort((Or,Lr)=>Or.productionDay-Lr.productionDay)}));const Cr=Nr[Nr.length-1];Cr&&Rr.setActiveCallSheet(Cr.id);for(const kr of wr)kr.storage_path&&downloadDocumentAsDataUri(kr.storage_path).then(({dataUri:Ar})=>{Ar&&useCallSheetStore.setState(Or=>({callSheets:Or.callSheets.map(Lr=>Lr.id===kr.id?{...Lr,pdfUri:Ar}:Lr)}))})}return Sr.length>0&&Sr[0].storage_path&&downloadDocumentAsDataUri(Sr[0].storage_path).then(({dataUri:Rr})=>{Rr&&useProjectStore.getState().setScriptPdf(Rr)}),Tr.setActiveTab("today"),ar({isLoading:!1,projectMemberships:[...dr,Er]}),{success:!0,projectName:mr.name}}catch(pr){return console.error("Join project error:",pr),ar({isLoading:!1,error:"Failed to join project. Please try again."}),{success:!1,error:"Failed to join project"}}},createProject:async(lr,cr,ur)=>{const{user:dr,projectMemberships:hr}=or(),pr=dr?TIER_LIMITS[dr.tier]:null;if(!dr||!(pr!=null&&pr.canCreateProjects))return ar({error:"Your account tier does not allow creating projects"}),{success:!1,error:"Insufficient permissions"};ar({isLoading:!0,error:null});try{const{project:mr,inviteCode:fr,error:xr}=await createProject(lr,cr,dr.id,ur||"designer");if(xr||!mr||!fr)return ar({isLoading:!1,error:(xr==null?void 0:xr.message)||"Failed to create project"}),{success:!1,error:(xr==null?void 0:xr.message)||"Failed to create project"};const Er={projectId:mr.id,projectName:mr.name,productionType:cr,role:"owner",joinedAt:new Date,lastAccessedAt:new Date,teamMemberCount:1,sceneCount:0,projectCode:fr,status:"active"};return ar({isLoading:!1,projectMemberships:[...hr,Er]}),{success:!0,code:fr}}catch(mr){return console.error("Create project error:",mr),ar({isLoading:!1,error:"Failed to create project. Please try again."}),{success:!1,error:"Failed to create project"}}},clearError:()=>{ar({error:null})},setHasCompletedOnboarding:lr=>{ar({hasCompletedOnboarding:lr})},canCreateProjects:()=>{const{user:lr}=or();if(!lr)return!1;const cr=TIER_LIMITS[lr.tier];return cr?cr.canCreateProjects:!1},updateLastAccessed:lr=>{const{projectMemberships:cr}=or(),ur=cr.map(dr=>dr.projectId===lr?{...dr,lastAccessedAt:new Date}:dr);ar({projectMemberships:ur})},selectTier:async(lr,cr)=>{const{user:ur}=or();if(!ur)return!1;ar({isLoading:!0,error:null});try{const{error:dr}=await updateUserTier(ur.id,lr);if(dr)return ar({isLoading:!1,error:dr.message}),!1;const hr={...ur,tier:lr},pr={tier:lr,status:lr==="trainee"?null:"active",billingPeriod:lr==="trainee"?null:cr,subscriptionStartedAt:lr!=="trainee"?new Date:void 0,currentPeriodEndsAt:lr!=="trainee"?new Date(Date.now()+(cr==="yearly"?365:30)*24*60*60*1e3):void 0};return ar({user:hr,subscription:pr,hasSelectedPlan:!0,hasCompletedOnboarding:!0,currentScreen:"hub",isLoading:!1,error:null}),!0}catch(dr){return console.error("Select tier error:",dr),ar({isLoading:!1,error:"Failed to update subscription. Please try again."}),!1}},updateSubscription:lr=>{const{subscription:cr,user:ur}=or(),dr={...cr,...lr};if(lr.tier&&ur){const hr={...ur,tier:lr.tier};updateUserTier(ur.id,lr.tier).catch(console.error),ar({subscription:dr,user:hr})}else ar({subscription:dr})},deleteProject:async lr=>{const{user:cr,projectMemberships:ur}=or();if(!cr)return{success:!1,error:"Not authenticated"};ar({isLoading:!0,error:null});try{if(!lr.startsWith("project-")){const{error:pr}=await deleteProject(lr,cr.id);if(pr)return ar({isLoading:!1,error:pr.message}),{success:!1,error:pr.message}}const hr=ur.filter(pr=>pr.projectId!==lr);return ar({isLoading:!1,projectMemberships:hr,error:null}),{success:!0}}catch(dr){return console.error("Delete project error:",dr),ar({isLoading:!1,error:"Failed to delete project. Please try again."}),{success:!1,error:"Failed to delete project"}}},leaveProject:async lr=>{const{user:cr,projectMemberships:ur}=or();if(!cr)return{success:!1,error:"Not authenticated"};ar({isLoading:!0,error:null});try{if(!lr.startsWith("project-")){const{error:pr}=await leaveProject(lr,cr.id);if(pr)return ar({isLoading:!1,error:pr.message}),{success:!1,error:pr.message}}const hr=ur.filter(pr=>pr.projectId!==lr);return ar({isLoading:!1,projectMemberships:hr,error:null}),{success:!0}}catch(dr){return console.error("Leave project error:",dr),ar({isLoading:!1,error:"Failed to leave project. Please try again."}),{success:!1,error:"Failed to leave project"}}},setPinnedProject:lr=>{ar({pinnedProjectId:lr})},setSettingsProjectId:lr=>{ar({settingsProjectId:lr})}}),{name:"checks-happy-auth-storage",storage:createJSONStorage(()=>localStorage),partialize:ar=>({isAuthenticated:ar.isAuthenticated,user:ar.user,currentScreen:ar.currentScreen,hasCompletedOnboarding:ar.hasCompletedOnboarding,hasSelectedPlan:ar.hasSelectedPlan,subscription:ar.subscription,projectMemberships:ar.projectMemberships,pinnedProjectId:ar.pinnedProjectId,guestProjectCode:ar.guestProjectCode})}));isSupabaseConfigured&&supabase.auth.onAuthStateChange(async(ar,or)=>{ar==="SIGNED_IN"&&(or!=null&&or.user)?useAuthStore.getState().initializeAuth():ar==="TOKEN_REFRESHED"&&(or!=null&&or.user)?useAuthStore.getState().isAuthenticated||useAuthStore.getState().initializeAuth():ar==="USER_UPDATED"&&(or!=null&&or.user)?useAuthStore.getState().initializeAuth():ar==="SIGNED_OUT"&&useAuthStore.setState({isAuthenticated:!1,user:null,projectMemberships:[],currentScreen:"welcome",screenHistory:[],hasCompletedOnboarding:!1,hasSelectedPlan:!1,subscription:createDefaultSubscription(),guestProjectCode:null})});const useSyncStore=create()(ar=>({status:"idle",lastSyncedAt:null,pendingChanges:0,error:null,activeProjectId:null,realtimeConnected:!1,onlineMembers:0,setStatus:or=>ar({status:or,error:or==="error"?void 0:null}),setSynced:()=>ar({status:"synced",lastSyncedAt:new Date,error:null}),setSyncing:()=>ar({status:"syncing",error:null}),setError:or=>ar({status:"error",error:or}),setOffline:()=>ar({status:"offline"}),setActiveProject:or=>ar({activeProjectId:or}),setRealtimeConnected:or=>ar({realtimeConnected:or}),setOnlineMembers:or=>ar({onlineMembers:or}),incrementPending:()=>ar(or=>({pendingChanges:or.pendingChanges+1})),decrementPending:()=>ar(or=>({pendingChanges:Math.max(0,or.pendingChanges-1)})),clearPending:()=>ar({pendingChanges:0}),reset:()=>ar({status:"idle",lastSyncedAt:null,pendingChanges:0,error:null,activeProjectId:null,realtimeConnected:!1,onlineMembers:0})})),CLIENT_ID=v4(),PUSH_DEBOUNCE_MS=800;let activeChannel=null,activeProjectId=null,pushTimers={},pushingTables=new Set;function sceneToDb(ar,or){return{id:ar.id,project_id:or,scene_number:ar.sceneNumber,int_ext:ar.intExt||null,location:ar.slugline||null,time_of_day:ar.timeOfDay||null,synopsis:ar.synopsis||null,page_count:null,story_day:(ar.shootingDay,null),shooting_day:ar.shootingDay||null,filming_status:ar.filmingStatus||null,filming_notes:ar.filmingNotes||null,is_complete:ar.isComplete,completed_at:ar.completedAt?new Date(ar.completedAt).toISOString():null}}function characterToDb(ar,or){return{id:ar.id,project_id:or,name:ar.name,actor_name:null,initials:ar.initials,avatar_colour:ar.avatarColour||"#6366f1",base_look_description:null}}function lookToDb(ar,or){return{id:ar.id,project_id:or,character_id:ar.characterId,name:ar.name,description:ar.notes||null,estimated_time:ar.estimatedTime,makeup_details:ar.makeup,hair_details:ar.hair}}function sceneCaptureToDb(ar,or,lr){return{id:ar.id,scene_id:ar.sceneId,character_id:ar.characterId,look_id:ar.lookId||null,shooting_day:null,status:"in_progress",hair_notes:null,makeup_notes:null,prosthetics_notes:null,wounds_blood_notes:null,general_notes:ar.notes||null,application_time:ar.applicationTime||null,continuity_flags:ar.continuityFlags,continuity_events_data:ar.continuityEvents,sfx_details:ar.sfxDetails,checked_by:lr,checked_at:null}}function dbToScene(ar,or,lr){return{id:ar.id,sceneNumber:ar.scene_number,slugline:ar.location||"",intExt:ar.int_ext||"INT",timeOfDay:ar.time_of_day||"DAY",synopsis:ar.synopsis||void 0,characters:or,isComplete:ar.is_complete,completedAt:ar.completed_at?new Date(ar.completed_at):void 0,filmingStatus:ar.filming_status||void 0,filmingNotes:ar.filming_notes||void 0,shootingDay:ar.shooting_day||void 0,scriptContent:lr==null?void 0:lr.scriptContent,hasScheduleDiscrepancy:lr==null?void 0:lr.hasScheduleDiscrepancy,characterConfirmationStatus:lr==null?void 0:lr.characterConfirmationStatus,suggestedCharacters:lr==null?void 0:lr.suggestedCharacters,amendmentStatus:lr==null?void 0:lr.amendmentStatus,previousScriptContent:lr==null?void 0:lr.previousScriptContent,amendmentDate:lr==null?void 0:lr.amendmentDate,amendmentNotes:lr==null?void 0:lr.amendmentNotes}}function dbToCharacter(ar,or){return{id:ar.id,name:ar.name,initials:ar.initials,avatarColour:ar.avatar_colour,actorNumber:or==null?void 0:or.actorNumber}}function dbToLook(ar,or,lr){return{id:ar.id,characterId:ar.character_id,name:ar.name,scenes:or,estimatedTime:ar.estimated_time,makeup:ar.makeup_details||{foundation:"",coverage:"",concealer:"",concealerPlacement:"",contour:"",contourPlacement:"",highlight:"",highlightPlacement:"",blush:"",blushPlacement:"",browProduct:"",browShape:"",eyePrimer:"",lidColour:"",creaseColour:"",outerV:"",liner:"",lashes:"",lipLiner:"",lipColour:"",setting:""},hair:ar.hair_details||{style:"",products:"",parting:"",piecesOut:"",pins:"",accessories:"",hairType:"Natural",wigNameId:"",wigType:"",wigCapMethod:"",wigAttachment:[],hairline:"",laceTint:"",edgesBabyHairs:""},notes:ar.description||void 0,masterReference:lr==null?void 0:lr.masterReference,continuityFlags:lr==null?void 0:lr.continuityFlags,continuityEvents:lr==null?void 0:lr.continuityEvents,sfxDetails:lr==null?void 0:lr.sfxDetails}}function dbToSceneCapture(ar,or,lr){return{id:ar.id,sceneId:ar.scene_id,characterId:ar.character_id,lookId:ar.look_id||"",capturedAt:new Date(ar.created_at),photos:or,additionalPhotos:lr,continuityFlags:ar.continuity_flags||{sweat:!1,dishevelled:!1,blood:!1,dirt:!1,wetHair:!1,tears:!1},continuityEvents:ar.continuity_events_data||[],sfxDetails:ar.sfx_details||{sfxRequired:!1,sfxTypes:[],prostheticPieces:"",prostheticAdhesive:"",bloodTypes:[],bloodProducts:"",bloodPlacement:"",tattooCoverage:"",temporaryTattoos:"",contactLenses:"",teeth:"",agingCharacterNotes:"",sfxApplicationTime:null,sfxReferencePhotos:[]},notes:ar.general_notes||"",applicationTime:ar.application_time||void 0}}async function pullProjectData(ar,or=0){if(!isSupabaseConfigured)return!1;console.log("[PULL] pullProjectData called for project:",ar,or>0?`(retry ${or})`:"");const lr=useSyncStore.getState();lr.setSyncing();try{const[cr,ur,dr,hr,pr,mr]=await Promise.all([supabase.from("scenes").select("*").eq("project_id",ar).order("scene_number"),supabase.from("characters").select("*").eq("project_id",ar).order("name"),supabase.from("looks").select("*").eq("project_id",ar),supabase.from("schedule_data").select("*").eq("project_id",ar).order("created_at",{ascending:!1}).limit(1),supabase.from("call_sheet_data").select("*").eq("project_id",ar).order("production_day"),supabase.from("script_uploads").select("*").eq("project_id",ar).eq("is_active",!0).limit(1)]);if(cr.error)throw cr.error;if(ur.error)throw ur.error;if(dr.error)throw dr.error;const fr=cr.data||[],xr=ur.data||[],Er=dr.data||[],vr=hr.data||[],gr=pr.data||[],yr=mr.data||[],br=fr.map(Mr=>Mr.id),_r=Er.map(Mr=>Mr.id),[jr,wr,Sr]=await Promise.all([br.length>0?supabase.from("scene_characters").select("scene_id, character_id").in("scene_id",br):Promise.resolve({data:[],error:null}),_r.length>0?supabase.from("look_scenes").select("look_id, scene_number").in("look_id",_r):Promise.resolve({data:[],error:null}),br.length>0?supabase.from("continuity_events").select("*").in("scene_id",br):Promise.resolve({data:[],error:null})]),Tr=jr.data||[],Rr=wr.data||[],Nr=Sr.data||[],Cr=Nr.map(Mr=>Mr.id),Ar=(Cr.length>0?await supabase.from("photos").select("*").in("continuity_event_id",Cr):{data:[],error:null}).data||[];console.log("[PULL] Server data:",{scenes:fr.length,characters:xr.length,looks:Er.length,captures:Nr.length,photos:Ar.length,schedule:vr.length,callSheets:gr.length,script:yr.length});const Or=fr.length>0||xr.length>0||Er.length>0,Lr=vr.length>0||gr.length>0||yr.length>0;if(!Or&&!Lr){console.log("[PULL] Server has no data for this project, skipping merge");const Mr=useProjectStore.getState().currentProject;if(Mr&&Mr.scenes.length===0&&or<3){const Br=(or+1)*3e3;console.log(`[PULL] Local project also empty, retrying in ${Br}ms (attempt ${or+1}/3)`),setTimeout(()=>{pullProjectData(ar,or+1)},Br)}return lr.setSynced(),!0}if(!Or&&Lr)return console.log("[PULL] Server has documents but no scene data, merging documents only"),vr.length>0&&mergeScheduleData(vr[0],ar),gr.length>0&&mergeCallSheetData(gr,ar),yr.length>0&&mergeScriptData(yr[0],ar),lr.setSynced(),!0;const Fr=new Map;for(const Mr of Tr){const Br=Fr.get(Mr.scene_id)||[];Br.push(Mr.character_id),Fr.set(Mr.scene_id,Br)}const Hr=new Map;for(const Mr of Rr){const Br=Hr.get(Mr.look_id)||[];Br.push(Mr.scene_number),Hr.set(Mr.look_id,Br)}const Kr=new Map;for(const Mr of Ar){const Br=Kr.get(Mr.continuity_event_id)||[];Br.push(Mr),Kr.set(Mr.continuity_event_id,Br)}const Gr=useProjectStore.getState(),Zr=Gr.currentProject;if(!Zr)return lr.setSynced(),!0;const Jr=new Map(Zr.scenes.map(Mr=>[Mr.id,Mr])),os=new Map(Zr.characters.map(Mr=>[Mr.id,Mr])),Ur=new Map(Zr.looks.map(Mr=>[Mr.id,Mr])),Vr=fr.map(Mr=>dbToScene(Mr,Fr.get(Mr.id)||[],Jr.get(Mr.id))),es=xr.map(Mr=>dbToCharacter(Mr,os.get(Mr.id))),Ir=Er.map(Mr=>dbToLook(Mr,Hr.get(Mr.id)||[],Ur.get(Mr.id))),Dr={};for(const Mr of Nr){const Br=Kr.get(Mr.id)||[],Xr={},Wr=[];for(const ns of Br){const fs=await downloadAndCachePhoto(ns);fs&&(ns.angle!=="additional"&&ns.angle!=="detail"?Xr[ns.angle]=fs:Wr.push(fs))}const ss=dbToSceneCapture(Mr,Xr,Wr),ds=`${Mr.scene_id}-${Mr.character_id}`;Dr[ds]=ss}const Pr={...Zr,scenes:Vr,characters:es,looks:Ir};if(console.log("[PULL] Merging server data into store:",{scenes:Vr.length,characters:es.length,looks:Ir.length,captures:Object.keys(Dr).length}),Gr.setProject(Pr),Object.keys(Dr).length>0)for(const[Mr,Br]of Object.entries(Dr))Gr.updateSceneCapture(Mr,Br);if(vr.length>0){const Mr=vr[0];mergeScheduleData(Mr,ar)}return gr.length>0&&mergeCallSheetData(gr,ar),yr.length>0&&mergeScriptData(yr[0],ar),console.log("[PULL] Pull complete, data merged successfully"),lr.setSynced(),!0}catch(cr){return console.error("[SyncService] Pull failed:",cr),lr.setError(cr instanceof Error?cr.message:"Pull failed"),!1}}async function downloadAndCachePhoto(ar){try{const or=await getPhotoBlob(ar.id);if(or)return{id:ar.id,uri:"",thumbnail:or.thumbnail,capturedAt:or.capturedAt,angle:ar.angle};const{blob:lr,error:cr}=await downloadPhoto(ar.storage_path);if(cr||!lr)return null;const ur=await createThumbnail(lr);return await savePhotoBlob(ar.id,lr,ur,ar.angle),{id:ar.id,uri:URL.createObjectURL(lr),thumbnail:ur,capturedAt:new Date(ar.taken_at),angle:ar.angle}}catch(or){return console.error("[SyncService] Photo download failed:",or),null}}async function createThumbnail(ar){return new Promise(or=>{const lr=new Image,cr=URL.createObjectURL(ar);lr.onload=()=>{const ur=document.createElement("canvas"),dr=80;ur.width=dr,ur.height=dr;const hr=ur.getContext("2d"),pr=Math.max(dr/lr.width,dr/lr.height),mr=(dr-lr.width*pr)/2,fr=(dr-lr.height*pr)/2;hr.drawImage(lr,mr,fr,lr.width*pr,lr.height*pr),URL.revokeObjectURL(cr),or(ur.toDataURL("image/jpeg",.6))},lr.onerror=()=>{URL.revokeObjectURL(cr),or("")},lr.src=cr})}function mergeScheduleData(ar,or){const lr=useScheduleStore.getState(),cr=lr.schedule;if(!ar.days&&!ar.cast_list||cr&&cr.id===ar.id&&cr.days.length>0)return;const ur={id:ar.id,status:ar.status==="complete"?"complete":"pending",castList:ar.cast_list||[],days:ar.days||[],totalDays:(ar.days||[]).length,uploadedAt:new Date(ar.created_at),rawText:ar.raw_pdf_text||void 0};lr.setSchedule(ur)}function mergeCallSheetData(ar,or){const lr=useCallSheetStore.getState(),cr=lr.callSheets;if(cr.length>0){const hr=new Set(cr.map(mr=>mr.id));if(ar.every(mr=>hr.has(mr.id))&&ar.length===cr.length)return}const ur=ar.map(hr=>{const pr=hr.parsed_data||{};return{...pr,id:hr.id,date:hr.shoot_date,productionDay:hr.production_day,rawText:hr.raw_text||pr.rawText,pdfUri:void 0,uploadedAt:new Date(hr.created_at),scenes:pr.scenes||[]}});if(ur.length===0)return;lr.clearAll();for(const hr of ur)useCallSheetStore.setState(pr=>({callSheets:[...pr.callSheets,hr].sort((mr,fr)=>mr.productionDay-fr.productionDay)}));const dr=ur[ur.length-1];dr&&lr.setActiveCallSheet(dr.id);for(const hr of ar)hr.storage_path&&downloadDocumentAsDataUri(hr.storage_path).then(({dataUri:pr})=>{pr&&useCallSheetStore.setState(mr=>({callSheets:mr.callSheets.map(fr=>fr.id===hr.id?{...fr,pdfUri:pr}:fr)}))});console.log("[PULL] Merged",ur.length,"call sheets from server")}function mergeScriptData(ar,or){const lr=useProjectStore.getState();lr.currentProject&&ar.storage_path&&downloadDocumentAsDataUri(ar.storage_path).then(({dataUri:ur})=>{ur&&(lr.setScriptPdf(ur),console.log("[PULL] Restored script PDF from server"))})}function debouncedPush(ar,or){pushTimers[ar]?clearTimeout(pushTimers[ar]):useSyncStore.getState().incrementPending(),pushTimers[ar]=setTimeout(async()=>{delete pushTimers[ar],pushingTables.add(ar);try{useSyncStore.getState().setSyncing(),await or(),console.log(`[PUSH] ${ar} pushed successfully`)}catch(lr){console.error(`[PUSH] ${ar} FAILED:`,lr),useSyncStore.getState().setError(`Failed to sync ${ar}`)}finally{pushingTables.delete(ar),useSyncStore.getState().decrementPending(),useSyncStore.getState().pendingChanges===0&&useSyncStore.getState().setSynced()}},PUSH_DEBOUNCE_MS)}async function pushScenes(ar,or){isSupabaseConfigured&&(console.log(`[PUSH] pushScenes called: projectId=${ar}, count=${or.length}`),debouncedPush("scenes",async()=>{const lr=or.map(hr=>sceneToDb(hr,ar)),{error:cr}=await supabase.from("scenes").upsert(lr,{onConflict:"id"});if(cr)throw cr;const ur=or.map(hr=>hr.id),dr=[];for(const hr of or)for(const pr of hr.characters)dr.push({scene_id:hr.id,character_id:pr});if(ur.length>0){const{error:hr}=await supabase.rpc("sync_scene_characters",{p_scene_ids:ur,p_entries:dr});if(hr)throw hr}}))}async function pushCharacters(ar,or){isSupabaseConfigured&&(console.log(`[PUSH] pushCharacters called: projectId=${ar}, count=${or.length}`),debouncedPush("characters",async()=>{const lr=or.map(ur=>characterToDb(ur,ar)),{error:cr}=await supabase.from("characters").upsert(lr,{onConflict:"id"});if(cr)throw cr}))}async function pushLooks(ar,or){isSupabaseConfigured&&(console.log(`[PUSH] pushLooks called: projectId=${ar}, count=${or.length}`),debouncedPush("looks",async()=>{const lr=or.map(hr=>lookToDb(hr,ar)),{error:cr}=await supabase.from("looks").upsert(lr,{onConflict:"id"});if(cr)throw cr;const ur=or.map(hr=>hr.id),dr=[];for(const hr of or)for(const pr of hr.scenes)dr.push({look_id:hr.id,scene_number:pr});if(ur.length>0){const{error:hr}=await supabase.rpc("sync_look_scenes",{p_look_ids:ur,p_entries:dr});if(hr)throw hr}}))}async function pushSceneCapture(ar,or,lr){isSupabaseConfigured&&(console.log(`[PUSH] pushSceneCapture called: captureId=${or.id}, sceneId=${or.sceneId}`),debouncedPush(`capture_${or.id}`,async()=>{const cr=sceneCaptureToDb(or,ar,lr),{error:ur}=await supabase.from("continuity_events").upsert(cr,{onConflict:"id"});if(ur)throw ur;await syncCapturePhotos(ar,or)}))}async function syncCapturePhotos(ar,or){const lr=[];for(const[cr,ur]of Object.entries(or.photos))ur&&lr.push({photo:ur,angle:cr});for(const cr of or.additionalPhotos)lr.push({photo:cr,angle:"additional"});for(const{photo:cr,angle:ur}of lr){const{data:dr}=await supabase.from("photos").select("id").eq("id",cr.id).single();if(dr)continue;let hr=null;const pr=await getPhotoBlob(cr.id);if(pr){const{result:mr,error:fr}=await uploadPhoto(ar,or.characterId,pr.blob);!fr&&mr&&(hr=mr.path)}else if(cr.uri&&cr.uri.startsWith("data:")){const{result:mr,error:fr}=await uploadBase64Photo(ar,or.characterId,cr.uri);!fr&&mr&&(hr=mr.path)}hr&&await supabase.from("photos").insert({id:cr.id,continuity_event_id:or.id,storage_path:hr,photo_type:"on_set",angle:ur,taken_at:cr.capturedAt?new Date(cr.capturedAt).toISOString():new Date().toISOString()})}}async function pushScheduleData(ar,or){var lr;isSupabaseConfigured&&(console.log(`[PUSH] pushScheduleData called: projectId=${ar}, status=${or.status}, days=${(lr=or.days)==null?void 0:lr.length}`),or.pdfUri&&or.pdfUri.startsWith("data:")&&pushSchedulePdf(ar,or),debouncedPush("schedule",async()=>{const{error:cr}=await supabase.from("schedule_data").upsert({id:or.id,project_id:ar,raw_pdf_text:or.rawText||null,cast_list:or.castList,days:or.days,status:or.status==="complete"?"complete":"pending"},{onConflict:"id"});if(cr)throw cr}))}const schedulePdfUploading=new Set;async function pushSchedulePdf(ar,or){const lr=`${ar}:${or.id}`;if(!schedulePdfUploading.has(lr)){schedulePdfUploading.add(lr);try{const{path:cr,error:ur}=await uploadBase64Document(ar,"schedules",or.pdfUri);if(ur){console.error("[PUSH] Schedule PDF upload failed:",ur);return}console.log("[PUSH] Schedule PDF uploaded to:",cr),await supabase.from("schedule_data").update({raw_pdf_text:or.rawText||null}).eq("id",or.id)}catch(cr){console.error("[PUSH] Schedule PDF upload error:",cr)}}}async function pushCallSheetData(ar,or,lr){isSupabaseConfigured&&(console.log(`[PUSH] pushCallSheetData: date=${or.date}, day=${or.productionDay}`),or.pdfUri&&or.pdfUri.startsWith("data:")&&pushCallSheetPdf(ar,or),debouncedPush(`callsheet_${or.date}`,async()=>{const{pdfUri:cr,...ur}=or,{error:dr}=await supabase.from("call_sheet_data").upsert({id:or.id,project_id:ar,shoot_date:or.date,production_day:or.productionDay,raw_text:or.rawText||null,parsed_data:ur,uploaded_by:lr},{onConflict:"id"});if(dr)throw dr}))}const callSheetPdfUploading=new Set;async function pushCallSheetPdf(ar,or){const lr=`${ar}:${or.id}`;if(!callSheetPdfUploading.has(lr)){callSheetPdfUploading.add(lr);try{const{path:cr,error:ur}=await uploadBase64Document(ar,"call-sheets",or.pdfUri);if(ur){console.error("[PUSH] Call sheet PDF upload failed:",ur);return}console.log("[PUSH] Call sheet PDF uploaded to:",cr),await supabase.from("call_sheet_data").update({storage_path:cr}).eq("id",or.id)}catch(cr){console.error("[PUSH] Call sheet PDF upload error:",cr)}}}async function pushScriptPdf(ar,or,lr){isSupabaseConfigured&&(!or||!or.startsWith("data:")||(console.log(`[PUSH] pushScriptPdf: uploading script for project ${ar}`),debouncedPush("script",async()=>{var mr;const{path:cr,error:ur}=await uploadBase64Document(ar,"scripts",or);if(ur||!cr){console.error("[PUSH] Script PDF upload failed:",ur);return}console.log("[PUSH] Script PDF uploaded to:",cr);const dr=((mr=or.split(",")[1])==null?void 0:mr.length)||0,hr=Math.round(dr*.75),{error:pr}=await supabase.from("script_uploads").insert({project_id:ar,storage_path:cr,file_name:"script.pdf",file_size:hr,is_active:!0,status:"uploaded",uploaded_by:lr});if(pr)throw pr})))}function subscribeToProject(ar,or){if(!isSupabaseConfigured)return;activeChannel&&unsubscribeFromProject(),activeProjectId=ar;const lr=supabase.channel(`project:${ar}`,{config:{broadcast:{self:!1},presence:{key:or||CLIENT_ID}}});lr.on("postgres_changes",{event:"*",schema:"public",table:"scenes",filter:`project_id=eq.${ar}`},cr=>{pushingTables.has("scenes")||handleSceneChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"characters",filter:`project_id=eq.${ar}`},cr=>{pushingTables.has("characters")||handleCharacterChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"looks",filter:`project_id=eq.${ar}`},cr=>{pushingTables.has("looks")||handleLookChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"continuity_events"},cr=>{const ur=cr.new||cr.old;if(!(ur!=null&&ur.scene_id))return;const dr=useProjectStore.getState().currentProject;dr!=null&&dr.scenes.some(hr=>hr.id===ur.scene_id)&&(pushingTables.has(`capture_${ur.id}`)||handleContinuityEventChange(cr))}),lr.on("postgres_changes",{event:"*",schema:"public",table:"schedule_data",filter:`project_id=eq.${ar}`},cr=>{pushingTables.has("schedule")||handleScheduleChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"call_sheet_data",filter:`project_id=eq.${ar}`},cr=>{var ur;pushingTables.has(`callsheet_${(ur=cr.new)==null?void 0:ur.shoot_date}`)||handleCallSheetChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"script_uploads",filter:`project_id=eq.${ar}`},cr=>{pushingTables.has("script")||handleScriptChange(cr)}),lr.on("postgres_changes",{event:"*",schema:"public",table:"photos"},cr=>{const ur=cr.new||cr.old;!(ur!=null&&ur.continuity_event_id)||!useProjectStore.getState().sceneCaptures[ur.continuity_event_id]||handlePhotoChange(cr)}),lr.on("presence",{event:"sync"},()=>{const cr=lr.presenceState(),ur=Object.keys(cr).length;useSyncStore.getState().setOnlineMembers(ur)}),lr.subscribe(async cr=>{cr==="SUBSCRIBED"?(useSyncStore.getState().setRealtimeConnected(!0),or&&await lr.track({user_id:or,client_id:CLIENT_ID,online_at:new Date().toISOString()})):(cr==="CLOSED"||cr==="CHANNEL_ERROR")&&useSyncStore.getState().setRealtimeConnected(!1)}),activeChannel=lr,useSyncStore.getState().setActiveProject(ar)}function unsubscribeFromProject(){activeChannel&&(supabase.removeChannel(activeChannel),activeChannel=null),activeProjectId=null;for(const ar of Object.values(pushTimers))clearTimeout(ar);pushTimers={},pushingTables.clear(),useSyncStore.getState().setRealtimeConnected(!1),useSyncStore.getState().setActiveProject(null)}function handleSceneChange(ar){const or=useProjectStore.getState(),lr=or.currentProject;if(lr){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const cr=ar.new,ur=lr.scenes.find(dr=>dr.id===cr.id);fetchSceneCharacters(cr.id).then(dr=>{const hr=dbToScene(cr,dr,ur),pr=ur?lr.scenes.map(mr=>mr.id===hr.id?hr:mr):[...lr.scenes,hr];or.setProject({...lr,scenes:pr})})}else if(ar.eventType==="DELETE"){const cr=ar.old;or.setProject({...lr,scenes:lr.scenes.filter(ur=>ur.id!==cr.id)})}}}function handleCharacterChange(ar){const or=useProjectStore.getState(),lr=or.currentProject;if(lr){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const cr=ar.new,ur=lr.characters.find(pr=>pr.id===cr.id),dr=dbToCharacter(cr,ur),hr=ur?lr.characters.map(pr=>pr.id===dr.id?dr:pr):[...lr.characters,dr];or.setProject({...lr,characters:hr})}else if(ar.eventType==="DELETE"){const cr=ar.old;or.setProject({...lr,characters:lr.characters.filter(ur=>ur.id!==cr.id)})}}}function handleLookChange(ar){const or=useProjectStore.getState(),lr=or.currentProject;if(lr){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const cr=ar.new,ur=lr.looks.find(dr=>dr.id===cr.id);fetchLookScenes(cr.id).then(dr=>{const hr=dbToLook(cr,dr,ur),pr=ur?lr.looks.map(mr=>mr.id===hr.id?hr:mr):[...lr.looks,hr];or.setProject({...lr,looks:pr})})}else if(ar.eventType==="DELETE"){const cr=ar.old;or.setProject({...lr,looks:lr.looks.filter(ur=>ur.id!==cr.id)})}}}function handleContinuityEventChange(ar,or){const lr=useProjectStore.getState();if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const cr=ar.new;fetchCapturePhotos(cr.id).then(async ur=>{const dr={},hr=[];for(const fr of ur){const xr=await downloadAndCachePhoto(fr);xr&&(fr.angle!=="additional"&&fr.angle!=="detail"?dr[fr.angle]=xr:hr.push(xr))}const pr=dbToSceneCapture(cr,dr,hr),mr=`${pr.sceneId}-${pr.characterId}`;lr.updateSceneCapture(mr,pr)})}}function handleScheduleChange(ar,or){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const lr=ar.new;mergeScheduleData(lr)}}function handleCallSheetChange(ar,or){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const lr=ar.new,cr=lr.parsed_data||{},ur={...cr,id:lr.id,date:lr.shoot_date,productionDay:lr.production_day,rawText:lr.raw_text||cr.rawText,uploadedAt:new Date(lr.created_at),scenes:cr.scenes||[]};useCallSheetStore.getState().callSheets.find(pr=>pr.id===lr.id)?useCallSheetStore.setState(pr=>({callSheets:pr.callSheets.map(mr=>mr.id===lr.id?{...ur,pdfUri:mr.pdfUri}:mr)})):useCallSheetStore.setState(pr=>({callSheets:[...pr.callSheets,ur].sort((mr,fr)=>mr.productionDay-fr.productionDay)})),lr.storage_path&&downloadDocumentAsDataUri(lr.storage_path).then(({dataUri:pr})=>{pr&&useCallSheetStore.setState(mr=>({callSheets:mr.callSheets.map(fr=>fr.id===lr.id?{...fr,pdfUri:pr}:fr)}))}),console.log("[RT] Call sheet updated:",lr.shoot_date)}else if(ar.eventType==="DELETE"){const lr=ar.old;lr!=null&&lr.id&&(useCallSheetStore.getState().deleteCallSheet(lr.id),console.log("[RT] Call sheet deleted:",lr.id))}}function handleScriptChange(ar,or){if(ar.eventType==="INSERT"||ar.eventType==="UPDATE"){const lr=ar.new;if(!lr.is_active||!lr.storage_path)return;downloadDocumentAsDataUri(lr.storage_path).then(({dataUri:cr})=>{cr&&(useProjectStore.getState().setScriptPdf(cr),console.log("[RT] Script PDF updated from server"))})}}function handlePhotoChange(ar,or){if(ar.eventType==="INSERT"){const lr=ar.new;downloadAndCachePhoto(lr).then(cr=>{if(!cr)return;const ur=useProjectStore.getState(),dr=ur.sceneCaptures;for(const[hr,pr]of Object.entries(dr))if(hr===lr.continuity_event_id){lr.angle!=="additional"&&lr.angle!=="detail"?ur.addPhotoToCapture(hr,cr,lr.angle):ur.addPhotoToCapture(hr,cr,"additional");break}})}}async function fetchSceneCharacters(ar){const{data:or}=await supabase.from("scene_characters").select("character_id").eq("scene_id",ar);return(or||[]).map(lr=>lr.character_id)}async function fetchLookScenes(ar){const{data:or}=await supabase.from("look_scenes").select("scene_number").eq("look_id",ar);return(or||[]).map(lr=>lr.scene_number)}async function fetchCapturePhotos(ar){const{data:or}=await supabase.from("photos").select("*").eq("continuity_event_id",ar);return or||[]}async function startSync(ar,or){if(console.log("[SYNC] startSync called:",{projectId:ar,userId:or}),!isSupabaseConfigured){console.warn("[SYNC] Supabase not configured, going offline"),useSyncStore.getState().setOffline();return}if(!navigator.onLine){useSyncStore.getState().setOffline(),window.addEventListener("online",()=>{startSync(ar,or)},{once:!0});return}const lr=await pullProjectData(ar);console.log("[SYNC] Pull complete, success:",lr),subscribeToProject(ar,or),console.log("[SYNC] Realtime subscriptions active, activeProjectId:",activeProjectId),await pushInitialData(ar,or),window.addEventListener("offline",()=>{useSyncStore.getState().setOffline()}),window.addEventListener("online",()=>{useSyncStore.getState().setStatus("syncing"),pullProjectData(ar).then(()=>{subscribeToProject(ar,or),pushInitialData(ar,or)})})}async function pushInitialData(ar,or){const lr=useProjectStore.getState().currentProject;if(!lr){console.log("[SYNC] pushInitialData: no current project, skipping");return}console.log("[SYNC] pushInitialData: pushing local data for project",ar,{scenes:lr.scenes.length,characters:lr.characters.length,looks:lr.looks.length}),lr.scenes.length>0&&pushScenes(ar,lr.scenes),lr.characters.length>0&&pushCharacters(ar,lr.characters),lr.looks.length>0&&pushLooks(ar,lr.looks);const cr=useProjectStore.getState().sceneCaptures,ur=Object.keys(cr).length;if(ur>0){console.log("[SYNC] pushInitialData: pushing",ur,"scene captures");for(const pr of Object.values(cr))pushSceneCapture(ar,pr,or||null)}const dr=useScheduleStore.getState().schedule;dr&&(console.log("[SYNC] pushInitialData: pushing schedule, status:",dr.status),pushScheduleData(ar,dr));const hr=useCallSheetStore.getState().callSheets;if(hr.length>0){console.log("[SYNC] pushInitialData: pushing",hr.length,"call sheets");for(const pr of hr)pushCallSheetData(ar,pr,or||null)}lr.scriptPdfData&&(console.log("[SYNC] pushInitialData: pushing script PDF"),pushScriptPdf(ar,lr.scriptPdfData,or||null))}function stopSync(){unsubscribeFromProject(),useSyncStore.getState().reset()}function getActiveProjectId(){return activeProjectId}let initialized=!1;function initSyncSubscriptions(){initialized||(initialized=!0,console.log("[SYNC-SUB] Initializing sync subscriptions"),useProjectStore.subscribe((ar,or)=>{var dr,hr;const lr=getActiveProjectId();if(!lr||!ar.currentProject)return;const cr=or.currentProject,ur=ar.currentProject;if(!(!cr||!ur)){if(cr.scenes!==ur.scenes&&(console.log("[SYNC-SUB] Scenes changed:",cr.scenes.length,"",ur.scenes.length),pushScenes(lr,ur.scenes)),cr.characters!==ur.characters&&(console.log("[SYNC-SUB] Characters changed:",cr.characters.length,"",ur.characters.length),pushCharacters(lr,ur.characters)),cr.looks!==ur.looks&&(console.log("[SYNC-SUB] Looks changed:",cr.looks.length,"",ur.looks.length),pushLooks(lr,ur.looks)),or.sceneCaptures!==ar.sceneCaptures){const pr=((dr=useAuthStore.getState().user)==null?void 0:dr.id)||null;for(const[mr,fr]of Object.entries(ar.sceneCaptures))or.sceneCaptures[mr]!==fr&&(console.log("[SYNC-SUB] Scene capture changed:",mr),pushSceneCapture(lr,fr,pr))}if(cr.scriptPdfData!==ur.scriptPdfData&&ur.scriptPdfData){const pr=((hr=useAuthStore.getState().user)==null?void 0:hr.id)||null;console.log("[SYNC-SUB] Script PDF changed, pushing to Supabase"),pushScriptPdf(lr,ur.scriptPdfData,pr)}}}),useScheduleStore.subscribe((ar,or)=>{const lr=getActiveProjectId();lr&&ar.schedule!==or.schedule&&ar.schedule&&(console.log("[SYNC-SUB] Schedule changed, pushing to Supabase, status:",ar.schedule.status),pushScheduleData(lr,ar.schedule))}),useCallSheetStore.subscribe((ar,or)=>{var cr;const lr=getActiveProjectId();if(lr&&ar.callSheets!==or.callSheets&&ar.callSheets.length>0){const ur=((cr=useAuthStore.getState().user)==null?void 0:cr.id)||null;for(const dr of ar.callSheets){const hr=or.callSheets.find(pr=>pr.id===dr.id);(!hr||hr!==dr)&&(console.log("[SYNC-SUB] Call sheet changed:",dr.date),pushCallSheetData(lr,dr,ur))}}}))}function r(ar){var or,lr,cr="";if(typeof ar=="string"||typeof ar=="number")cr+=ar;else if(typeof ar=="object")if(Array.isArray(ar)){var ur=ar.length;for(or=0;or<ur;or++)ar[or]&&(lr=r(ar[or]))&&(cr&&(cr+=" "),cr+=lr)}else for(lr in ar)ar[lr]&&(cr&&(cr+=" "),cr+=lr);return cr}function clsx(){for(var ar,or,lr=0,cr="",ur=arguments.length;lr<ur;lr++)(ar=arguments[lr])&&(or=r(ar))&&(cr&&(cr+=" "),cr+=or);return cr}const MAX_BOTTOM_NAV_ITEMS=5,useNavigationStore=create()(persist((ar,or)=>({bottomNavItems:DEFAULT_BOTTOM_NAV,isEditMenuOpen:!1,setBottomNavItems:lr=>{const cr=lr.slice(0,MAX_BOTTOM_NAV_ITEMS);ar({bottomNavItems:cr})},openEditMenu:()=>ar({isEditMenuOpen:!0}),closeEditMenu:()=>ar({isEditMenuOpen:!1}),moveToBottomNav:(lr,cr)=>{const ur=[...or().bottomNavItems],dr=ur.indexOf(lr);dr!==-1?(ur.splice(dr,1),ur.splice(cr,0,lr)):ur.length<MAX_BOTTOM_NAV_ITEMS?ur.splice(cr,0,lr):ur[cr]=lr,ar({bottomNavItems:ur.slice(0,MAX_BOTTOM_NAV_ITEMS)})},moveToMoreMenu:lr=>{const cr=or().bottomNavItems.filter(ur=>ur!==lr);cr.length!==0&&ar({bottomNavItems:cr})},reorderBottomNav:(lr,cr)=>{const ur=[...or().bottomNavItems],[dr]=ur.splice(lr,1);ur.splice(cr,0,dr),ar({bottomNavItems:ur})},getMoreMenuItems:()=>{const lr=or().bottomNavItems;return ALL_NAV_ITEMS.filter(cr=>!lr.includes(cr.id)).map(cr=>cr.id)},resetToDefaults:()=>{ar({bottomNavItems:DEFAULT_BOTTOM_NAV})}}),{name:"hair-makeup-navigation",storage:createJSONStorage(()=>localStorage),partialize:ar=>({bottomNavItems:ar.bottomNavItems})}));function BottomNav({activeTab:ar,onTabChange:or}){const{bottomNavItems:lr}=useNavigationStore(),cr=[...lr.map(ur=>{const dr=ALL_NAV_ITEMS.find(hr=>hr.id===ur);return dr?{id:dr.id,label:dr.label,icon:jsxRuntimeExports.jsx(NavIcon,{name:dr.iconName})}:null}).filter(Boolean),{id:"more",label:"More",icon:jsxRuntimeExports.jsx(NavIcon,{name:"ellipsis"})}];return jsxRuntimeExports.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-40 bg-card shadow-nav border-t border-border",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-around bottom-nav-safe",children:cr.map(ur=>{const dr=ar===ur.id;return jsxRuntimeExports.jsxs("button",{onClick:()=>or(ur.id),className:clsx("flex flex-col items-center justify-center py-2 px-3 min-w-[56px] tap-target touch-manipulation transition-colors",{"text-gold":dr,"text-text-light hover:text-text-muted":!dr}),"aria-current":dr?"page":void 0,children:[jsxRuntimeExports.jsx("span",{className:"w-6 h-6 mb-1",children:ur.icon}),jsxRuntimeExports.jsx("span",{className:clsx("text-[10px] font-medium",{"font-semibold":dr}),children:ur.label})]},ur.id)})})})})}function NavIcon({name:ar,className:or="w-full h-full"}){switch(ar){case"calendar":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})});case"grid":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 10h18M3 14h18M10 3v18M14 3v18M3 6a3 3 0 013-3h12a3 3 0 013 3v12a3 3 0 01-3 3H6a3 3 0 01-3-3V6z"})});case"book":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})});case"clock":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})});case"wallet":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v3"})});case"document":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})});case"schedule":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V15zm0 2.25h.008v.008h-.008v-.008zm2.25-4.5h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z"})});case"clipboard":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"})});case"cog":return jsxRuntimeExports.jsxs("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});case"ellipsis":return jsxRuntimeExports.jsx("svg",{className:or,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"})});default:return null}}function Header({title:ar,showBack:or=!1,onBack:lr,showSearch:cr=!1,onSearch:ur,rightContent:dr,className:hr}){return jsxRuntimeExports.jsx("header",{className:clsx("sticky top-0 z-30 bg-card border-b border-border safe-top",hr),children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between h-14 px-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[or&&jsxRuntimeExports.jsx("button",{onClick:lr,className:"flex items-center gap-1 text-gold tap-target touch-manipulation -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary truncate",children:ar})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[dr,cr&&jsxRuntimeExports.jsx("button",{onClick:ur,className:"p-2 text-text-muted hover:text-text-primary tap-target touch-manipulation","aria-label":"Search",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]})})})}function ProjectHeader({onSwitchProject:ar,onNavigateToProfile:or}){const{currentProject:lr}=useProjectStore(),{user:cr}=useAuthStore();if(!lr)return null;const ur=()=>{if(!(cr!=null&&cr.name))return"U";const dr=cr.name.split(" ");return dr.length>=2?`${dr[0][0]}${dr[1][0]}`.toUpperCase():cr.name.substring(0,2).toUpperCase()};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-12 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("button",{onClick:ar,className:"flex items-center gap-2 min-w-0 active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsx("div",{className:"w-7 h-7 rounded-lg gold-gradient flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary truncate max-w-[200px]",children:lr.name}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-muted flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"})})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-3",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center text-gold text-xs font-bold active:scale-95 transition-transform",children:ur()})})]})})})})}const Button=reactExports.forwardRef(({className:ar,variant:or="primary",size:lr="md",fullWidth:cr=!1,children:ur,disabled:dr,...hr},pr)=>jsxRuntimeExports.jsx("button",{ref:pr,className:clsx("inline-flex items-center justify-center font-semibold transition-all duration-200 touch-manipulation tap-target","focus:outline-none focus:ring-2 focus:ring-gold/50 focus:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",{"btn-gold text-white active:scale-[0.98]":or==="primary","bg-input-bg text-text-primary border border-border hover:bg-gray-100 dark:hover:bg-gray-800 active:scale-[0.98]":or==="secondary","btn-outline-gold active:scale-[0.98]":or==="outline","text-gold hover:bg-gold/10 active:scale-[0.98]":or==="ghost","bg-red-500 text-white hover:bg-red-600 active:scale-[0.98]":or==="danger","px-3 py-1.5 text-sm rounded-lg":lr==="sm","px-4 py-2.5 text-base rounded-lg":lr==="md","px-6 py-3.5 text-lg rounded-lg":lr==="lg","w-full":cr},ar),disabled:dr,...hr,children:ur}));Button.displayName="Button";const Input=reactExports.forwardRef(({className:ar,label:or,error:lr,helperText:cr,id:ur,...dr},hr)=>{const pr=ur||(or==null?void 0:or.toLowerCase().replace(/\s+/g,"-"));return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[or&&jsxRuntimeExports.jsx("label",{htmlFor:pr,className:"field-label block mb-1.5",children:or}),jsxRuntimeExports.jsx("input",{ref:hr,id:pr,className:clsx("input-field w-full",{"border-error focus:border-error focus:ring-error/30":lr},ar),...dr}),lr&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-error",children:lr}),cr&&!lr&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-text-muted",children:cr})]})});Input.displayName="Input";const Textarea=reactExports.forwardRef(({className:ar,label:or,error:lr,helperText:cr,id:ur,rows:dr=3,...hr},pr)=>{const mr=ur||(or==null?void 0:or.toLowerCase().replace(/\s+/g,"-"));return jsxRuntimeExports.jsxs("div",{className:"w-full",children:[or&&jsxRuntimeExports.jsx("label",{htmlFor:mr,className:"field-label block mb-1.5",children:or}),jsxRuntimeExports.jsx("textarea",{ref:pr,id:mr,rows:dr,className:clsx("input-field w-full resize-none",{"border-error focus:border-error focus:ring-error/30":lr},ar),...hr}),lr&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-error",children:lr}),cr&&!lr&&jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-text-muted",children:cr})]})});Textarea.displayName="Textarea";const Card=reactExports.forwardRef(({className:ar,variant:or="default",padding:lr="md",children:cr,...ur},dr)=>jsxRuntimeExports.jsx("div",{ref:dr,className:clsx("rounded-card",{"bg-card shadow-card":or==="default","bg-card":or==="flat","bg-card border border-border":or==="bordered","p-0":lr==="none","p-3":lr==="sm","p-card-padding":lr==="md","p-6":lr==="lg"},ar),...ur,children:cr}));Card.displayName="Card";const CardHeader=reactExports.forwardRef(({className:ar,children:or,...lr},cr)=>jsxRuntimeExports.jsx("div",{ref:cr,className:clsx("flex items-center justify-between mb-3",ar),...lr,children:or}));CardHeader.displayName="CardHeader";const CardTitle=reactExports.forwardRef(({className:ar,children:or,...lr},cr)=>jsxRuntimeExports.jsx("h3",{ref:cr,className:clsx("section-header",ar),...lr,children:or}));CardTitle.displayName="CardTitle";const CardContent=reactExports.forwardRef(({className:ar,children:or,...lr},cr)=>jsxRuntimeExports.jsx("div",{ref:cr,className:clsx(ar),...lr,children:or}));CardContent.displayName="CardContent";const Badge=reactExports.forwardRef(({className:ar,variant:or="default",size:lr="sm",children:cr,...ur},dr)=>jsxRuntimeExports.jsx("span",{ref:dr,className:clsx("inline-flex items-center justify-center font-semibold uppercase tracking-wide",{"bg-gray-100 text-text-muted":or==="default","bg-gold text-white":or==="gold","bg-blue-100 text-blue-700":or==="int","bg-gold-100 text-gold-700":or==="ext","bg-green-100 text-green-700":or==="success","bg-orange-100 text-orange-700":or==="warning","bg-red-100 text-red-700":or==="error","bg-transparent border border-current":or==="outline","px-1.5 py-0.5 text-[9px] rounded":lr==="sm","px-2.5 py-1 text-[10px] rounded-md":lr==="md"},ar),...ur,children:cr}));Badge.displayName="Badge";const CountBadge=reactExports.forwardRef(({className:ar,count:or,label:lr="fields",...cr},ur)=>jsxRuntimeExports.jsxs("span",{ref:ur,className:clsx("inline-flex items-center justify-center px-2.5 py-0.5 text-[10px] font-semibold rounded-xl","bg-gold-100/60 text-gold",ar),...cr,children:[or," ",lr]}));CountBadge.displayName="CountBadge";const TogglePill=reactExports.forwardRef(({className:ar,isActive:or,label:lr,onClick:cr,...ur},dr)=>jsxRuntimeExports.jsx("button",{ref:dr,type:"button",role:"switch","aria-checked":or,onClick:cr,className:clsx("px-3 py-1.5 text-xs font-medium rounded-pill border transition-all duration-200 touch-manipulation","focus:outline-none focus:ring-2 focus:ring-gold/50",{"bg-gold-50 text-gold border-gold":or,"bg-gray-100 text-text-muted border-gray-200 hover:bg-gray-200":!or},ar),...ur,children:lr}));TogglePill.displayName="TogglePill";const Switch=reactExports.forwardRef(({className:ar,isOn:or,label:lr,onToggle:cr,...ur},dr)=>jsxRuntimeExports.jsxs("button",{ref:dr,type:"button",role:"switch","aria-checked":or,onClick:cr,className:clsx("relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2",{"bg-gold":or,"bg-gray-200":!or},ar),...ur,children:[lr&&jsxRuntimeExports.jsx("span",{className:"sr-only",children:lr}),jsxRuntimeExports.jsx("span",{"aria-hidden":"true",className:clsx("pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",{"translate-x-5":or,"translate-x-0":!or})})]}));Switch.displayName="Switch";function Accordion({title:ar,count:or,badge:lr,defaultOpen:cr=!1,children:ur,className:dr}){const[hr,pr]=reactExports.useState(cr);return jsxRuntimeExports.jsxs("div",{className:clsx("bg-card rounded-card shadow-card overflow-hidden",dr),children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>pr(!hr),className:"w-full flex items-center justify-between px-[18px] py-4 text-left touch-manipulation","aria-expanded":hr,children:[jsxRuntimeExports.jsx("span",{className:"section-header",children:ar}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2.5",children:[lr&&jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:lr}),or!==void 0&&or>0&&jsxRuntimeExports.jsx(CountBadge,{count:or}),jsxRuntimeExports.jsx(ChevronIcon,{isOpen:hr})]})]}),jsxRuntimeExports.jsx("div",{className:clsx("overflow-hidden transition-all duration-300 ease-in-out",{"max-h-0 opacity-0":!hr,"max-h-[2000px] opacity-100":hr}),children:jsxRuntimeExports.jsx("div",{className:"px-[18px] pb-[18px]",children:ur})})]})}function ChevronIcon({isOpen:ar}){return jsxRuntimeExports.jsx("svg",{className:clsx("w-5 h-5 text-text-muted transition-transform duration-200",{"rotate-180":ar}),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}function Modal({isOpen:ar,onClose:or,title:lr,children:cr,className:ur,showCloseButton:dr=!0}){const hr=reactExports.useRef(null);reactExports.useEffect(()=>{const mr=fr=>{fr.key==="Escape"&&ar&&or()};return document.addEventListener("keydown",mr),()=>document.removeEventListener("keydown",mr)},[ar,or]),reactExports.useEffect(()=>(ar?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[ar]);const pr=mr=>{mr.target===hr.current&&or()};return ar?jsxRuntimeExports.jsx("div",{ref:hr,onClick:pr,className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm animate-fadeIn",children:jsxRuntimeExports.jsxs("div",{className:clsx("w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp","max-h-[90vh] overflow-hidden flex flex-col",ur),children:[(lr||dr)&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[lr&&jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:lr}),dr&&jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -m-2 text-text-muted hover:text-text-primary transition-colors tap-target","aria-label":"Close modal",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:cr})]})}):null}function BottomSheet({isOpen:ar,onClose:or,title:lr,children:cr,className:ur,showCloseButton:dr=!0,height:hr="auto"}){return jsxRuntimeExports.jsx(Modal,{isOpen:ar,onClose:or,title:lr,showCloseButton:dr,className:clsx({"max-h-[50vh]":hr==="half","h-[90vh]":hr==="full"},ur),children:cr})}function FormField({label:ar,value:or,onChange:lr,readOnly:cr=!1,placeholder:ur,multiline:dr=!1,rows:hr=2}){if(cr)return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:ar}),jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:or||jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})})]});const pr="w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] placeholder:text-[#999] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors";return dr?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:ar}),jsxRuntimeExports.jsx("textarea",{value:or,onChange:mr=>lr(mr.target.value),placeholder:ur,rows:hr,className:`${pr} resize-none`})]}):jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:ar}),jsxRuntimeExports.jsx("input",{type:"text",value:or,onChange:mr=>lr(mr.target.value),placeholder:ur,className:pr})]})}function getCaptureStatus(ar){return!ar||!(ar.photos.front||ar.photos.left||ar.photos.right||ar.photos.back||ar.additionalPhotos.length>0)?"not-started":ar.photos.front?"complete":"in-progress"}function parseSceneRange(ar){const or=[],lr=ar.split(",").map(cr=>cr.trim());for(const cr of lr)if(cr.includes("-")){const[ur,dr]=cr.split("-").map(hr=>parseInt(hr.trim(),10));if(!isNaN(ur)&&!isNaN(dr))for(let hr=ur;hr<=dr;hr++)or.push(hr)}else{const ur=parseInt(cr,10);isNaN(ur)||or.push(ur)}return[...new Set(or)].sort((cr,ur)=>cr-ur)}function formatSceneRange(ar){if(ar.length===0)return"";if(ar.length===1)return ar[0];const or=[...ar].sort((pr,mr)=>pr.localeCompare(mr,void 0,{numeric:!0})),lr=[];let cr=or[0],ur=or[0],dr=parseInt(cr,10),hr=dr;for(let pr=1;pr<or.length;pr++){const mr=or[pr],fr=parseInt(mr,10);!isNaN(hr)&&!isNaN(fr)&&mr===String(fr)&&ur===String(hr)&&fr===hr+1?(ur=mr,hr=fr):(lr.push(cr===ur?cr:`${cr}-${ur}`),cr=mr,ur=mr,dr=fr,hr=fr)}return lr.push(cr===ur?cr:`${cr}-${ur}`),lr.join(", ")}function formatEstimatedTime(ar){if(ar<60)return`~${ar} min`;const or=Math.floor(ar/60),lr=ar%60;return lr===0?`~${or}h`:`~${or}h ${lr}m`}function formatShortDate(ar){const or=typeof ar=="string"?new Date(ar):ar,lr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],cr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${lr[or.getDay()]} ${or.getDate()} ${cr[or.getMonth()]}`}const MAX_IMAGE_DIMENSION=1920,IMAGE_QUALITY=.8,THUMBNAIL_SIZE=200,THUMBNAIL_QUALITY=.6,SUPPORTED_IMAGE_TYPES=new Set(["image/jpeg","image/png","image/gif","image/webp"]);function isSupportedImageType(ar){return SUPPORTED_IMAGE_TYPES.has(ar.toLowerCase())}async function ensureSupportedImageFormat(ar){const or=ar.match(/^data:([^;]+);base64,/);if(!or)return ar;const lr=or[1].toLowerCase();if(isSupportedImageType(lr))return ar;const cr=base64ToBlob(ar),ur=await compressImage(cr,MAX_IMAGE_DIMENSION,IMAGE_QUALITY);return blobToBase64(ur)}async function compressImage(ar,or=MAX_IMAGE_DIMENSION,lr=IMAGE_QUALITY){return new Promise((cr,ur)=>{const dr=new Image,hr=URL.createObjectURL(ar);dr.onload=()=>{URL.revokeObjectURL(hr);let{width:pr,height:mr}=dr;(pr>or||mr>or)&&(pr>mr?(mr=Math.round(mr*or/pr),pr=or):(pr=Math.round(pr*or/mr),mr=or));const fr=document.createElement("canvas");fr.width=pr,fr.height=mr;const xr=fr.getContext("2d");if(!xr){ur(new Error("Failed to get canvas context"));return}xr.drawImage(dr,0,0,pr,mr),fr.toBlob(Er=>{Er?cr(Er):ur(new Error("Failed to compress image"))},"image/jpeg",lr)},dr.onerror=()=>{URL.revokeObjectURL(hr),ur(new Error("Failed to load image"))},dr.src=hr})}async function generateThumbnail(ar){const or=await compressImage(ar,THUMBNAIL_SIZE,THUMBNAIL_QUALITY);return blobToBase64(or)}function blobToBase64(ar){return new Promise((or,lr)=>{const cr=new FileReader;cr.onloadend=()=>{const ur=cr.result;or(ur)},cr.onerror=lr,cr.readAsDataURL(ar)})}function base64ToBlob(ar){const[or,lr]=ar.split(","),cr=or.match(/:(.*?);/),ur=cr?cr[1]:"image/jpeg",dr=atob(lr),hr=new ArrayBuffer(dr.length),pr=new Uint8Array(hr);for(let mr=0;mr<dr.length;mr++)pr[mr]=dr.charCodeAt(mr);return new Blob([pr],{type:ur})}async function createPhotoFromBlob(ar,or){const lr=await compressImage(ar),cr=await blobToBase64(lr),ur=await generateThumbnail(ar);return{id:v4(),uri:cr,thumbnail:ur,capturedAt:new Date,angle:or}}function CharacterAvatar({character:ar,size:or="md",className:lr}){const cr=ar.avatarColour??"#C9A962";return jsxRuntimeExports.jsx("div",{className:clsx("rounded-full flex items-center justify-center font-bold text-white flex-shrink-0",{"w-5 h-5 text-[8px]":or==="xs","w-8 h-8 text-xs":or==="sm","w-10 h-10 text-sm":or==="md","w-14 h-14 text-lg":or==="lg","w-20 h-20 text-2xl":or==="xl"},lr),style:{background:`linear-gradient(135deg, ${cr} 0%, ${adjustColor$1(cr,-20)} 100%)`},children:ar.initials})}function adjustColor$1(ar,or){const lr=parseInt(ar.replace("#",""),16),cr=Math.max(0,Math.min(255,(lr>>16)+or)),ur=Math.max(0,Math.min(255,(lr>>8&255)+or)),dr=Math.max(0,Math.min(255,(lr&255)+or));return`#${((1<<24)+(cr<<16)+(ur<<8)+dr).toString(16).slice(1)}`}const angleLabels$1={front:"Front",left:"Left",right:"Right",back:"Back",additional:""};function PhotoSlot({photo:ar,angle:or,onCapture:lr,onView:cr,size:ur="md",showLabel:dr=!0,isPrimary:hr=!1}){const pr=!!ar,mr=angleLabels$1[or],fr=()=>{pr&&cr?cr():lr()};return jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsx("button",{type:"button",onClick:fr,className:clsx("relative rounded-[10px] overflow-hidden touch-manipulation transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2",{"w-full aspect-square":ur==="sm","w-full aspect-[4/3]":ur==="md","w-full aspect-[16/9]":ur==="lg","w-full aspect-[3/4]":ur==="portrait","border-2 border-dashed":!pr,"border-gold":!pr&&hr,"border-gray-300":!pr&&!hr,"border-2 border-solid border-gold":pr}),children:pr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("img",{src:ar.thumbnail||ar.uri,alt:`${mr} view`,className:"w-full h-full object-cover"}),dr&&mr&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent px-2 py-1.5",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-medium text-white uppercase tracking-wide",children:mr})})]}):jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-50",children:[jsxRuntimeExports.jsx(CameraIcon$1,{className:clsx("text-gray-400",{"w-5 h-5":ur==="sm"||ur==="portrait","w-6 h-6":ur==="md","w-8 h-8":ur==="lg"})}),dr&&mr&&jsxRuntimeExports.jsx("span",{className:clsx("font-bold uppercase tracking-widest text-gray-400 mt-2",{"text-[9px]":ur==="sm"||ur==="portrait","text-[10px]":ur==="md","text-xs":ur==="lg"}),children:mr})]})})})}function SceneThumbnailSlot({sceneNumber:ar,hasCaptured:or,isActive:lr,onClick:cr,thumbnailUrl:ur}){return jsxRuntimeExports.jsxs("button",{type:"button",onClick:cr,className:clsx("flex flex-col items-center gap-1.5 touch-manipulation","focus:outline-none"),children:[jsxRuntimeExports.jsx("div",{className:clsx("w-[70px] h-[70px] rounded-lg flex items-center justify-center transition-all overflow-hidden",{"border-2 border-solid border-gold":or,"border-2 border-dashed border-gray-300 bg-gray-50":!or,"ring-2 ring-gold ring-offset-2":lr}),children:or&&ur?jsxRuntimeExports.jsx("img",{src:ur,alt:`Scene ${ar}`,className:"w-full h-full object-cover"}):or?jsxRuntimeExports.jsx(CheckIcon$1,{className:"w-6 h-6 text-gold"}):jsxRuntimeExports.jsx(CameraIcon$1,{className:"w-5 h-5 text-gray-400"})}),jsxRuntimeExports.jsx("span",{className:clsx("text-xs font-medium",{"text-gold":lr,"text-text-secondary":!lr}),children:ar})]})}function CameraIcon$1({className:ar}){return jsxRuntimeExports.jsxs("svg",{className:ar,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}function CheckIcon$1({className:ar}){return jsxRuntimeExports.jsx("svg",{className:ar,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}function PhotoGrid({photos:ar,onCapture:or,onView:lr,className:cr}){const ur=[{angle:"front",photo:ar.front},{angle:"left",photo:ar.left},{angle:"right",photo:ar.right},{angle:"back",photo:ar.back}];return jsxRuntimeExports.jsx("div",{className:clsx("grid grid-cols-4 gap-2.5",cr),children:ur.map(({angle:dr,photo:hr})=>jsxRuntimeExports.jsx(PhotoSlot,{photo:hr,angle:dr,onCapture:()=>or(dr),onView:hr&&lr?()=>lr(hr,dr):void 0,size:"portrait",showLabel:!0,isPrimary:dr==="front"},dr))})}function AdditionalPhotosGrid({photos:ar,onCapture:or,onView:lr,maxVisible:cr=8,className:ur}){const dr=ar.slice(0,cr),hr=ar.length-cr,pr=Math.max(0,4-(dr.length%4||4)),mr=dr.length<cr;return jsxRuntimeExports.jsxs("div",{className:clsx("grid grid-cols-4 gap-2",ur),children:[dr.map((fr,xr)=>jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>lr==null?void 0:lr(fr,xr),className:"w-full aspect-square rounded-lg overflow-hidden border-2 border-gold touch-manipulation focus:outline-none focus:ring-2 focus:ring-gold",children:jsxRuntimeExports.jsx("img",{src:fr.thumbnail||fr.uri,alt:`Additional photo ${xr+1}`,className:"w-full h-full object-cover"})}),xr===cr-1&&hr>0&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/60 rounded-lg flex items-center justify-center",children:jsxRuntimeExports.jsxs("span",{className:"text-white font-semibold text-lg",children:["+",hr]})})]},fr.id)),mr&&Array.from({length:Math.min(pr+1,cr-dr.length)}).map((fr,xr)=>jsxRuntimeExports.jsx("button",{type:"button",onClick:or,className:clsx("w-full aspect-square rounded-lg flex items-center justify-center touch-manipulation","focus:outline-none focus:ring-2 focus:ring-gold",{"border-2 border-dashed border-gold bg-gold-50/50":xr===0,"border-2 border-dashed border-gray-300 bg-gray-50":xr>0}),children:jsxRuntimeExports.jsx("svg",{className:clsx("w-5 h-5",{"text-gold":xr===0,"text-gray-400":xr>0}),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})},`empty-${xr}`))]})}function useCamera(ar={}){const{facingMode:or="environment",onCapture:lr,onError:cr}=ar,ur=reactExports.useRef(null),dr=reactExports.useRef(null),hr=reactExports.useRef(null),[pr,mr]=reactExports.useState(!1),[fr,xr]=reactExports.useState(!1),[Er,vr]=reactExports.useState(null),[gr,yr]=reactExports.useState(or);reactExports.useEffect(()=>(hr.current=document.createElement("canvas"),()=>{hr.current=null}),[]);const br=reactExports.useCallback(()=>{dr.current&&(dr.current.getTracks().forEach(Sr=>Sr.stop()),dr.current=null),ur.current&&(ur.current.srcObject=null),mr(!1)},[]);reactExports.useEffect(()=>()=>{dr.current&&(dr.current.getTracks().forEach(Sr=>Sr.stop()),dr.current=null),ur.current&&(ur.current.srcObject=null)},[]);const _r=reactExports.useCallback(async()=>{try{if(vr(null),mr(!1),br(),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported on this device");const Sr={video:{facingMode:{ideal:gr},width:{ideal:1920},height:{ideal:1080}},audio:!1},Tr=await navigator.mediaDevices.getUserMedia(Sr);dr.current=Tr,ur.current&&(ur.current.srcObject=Tr,await ur.current.play(),mr(!0))}catch(Sr){const Tr=Sr instanceof Error?Sr.message:"Failed to access camera";vr(Tr),cr==null||cr(Sr instanceof Error?Sr:new Error(Tr))}},[gr,br,cr]),jr=reactExports.useCallback(async()=>{const Sr=gr==="user"?"environment":"user";if(yr(Sr),dr.current){br(),await new Promise(Tr=>setTimeout(Tr,100));try{const Tr={video:{facingMode:{ideal:Sr},width:{ideal:1920},height:{ideal:1080}},audio:!1},Rr=await navigator.mediaDevices.getUserMedia(Tr);dr.current=Rr,ur.current&&(ur.current.srcObject=Rr,await ur.current.play(),mr(!0))}catch(Tr){const Rr=Tr instanceof Error?Tr.message:"Failed to switch camera";vr(Rr),cr==null||cr(Tr instanceof Error?Tr:new Error(Rr))}}},[gr,br,cr]),wr=reactExports.useCallback(async()=>{if(!ur.current||!hr.current||!pr)return null;try{xr(!0);const Sr=ur.current,Tr=hr.current;Tr.width=Sr.videoWidth,Tr.height=Sr.videoHeight;const Rr=Tr.getContext("2d");if(!Rr)throw new Error("Failed to get canvas context");gr==="user"&&(Rr.translate(Tr.width,0),Rr.scale(-1,1)),Rr.drawImage(Sr,0,0);const Nr=await new Promise((Cr,kr)=>{Tr.toBlob(Ar=>{Ar?Cr(Ar):kr(new Error("Failed to capture photo"))},"image/jpeg",.9)});return lr==null||lr(Nr),Nr}catch(Sr){const Tr=Sr instanceof Error?Sr.message:"Failed to capture photo";return vr(Tr),cr==null||cr(Sr instanceof Error?Sr:new Error(Tr)),null}finally{xr(!1)}},[pr,gr,lr,cr]);return{videoRef:ur,isReady:pr,isCapturing:fr,error:Er,facingMode:gr,startCamera:_r,stopCamera:br,capturePhoto:wr,switchCamera:jr}}const angleLabels={front:"Front View",left:"Left View",right:"Right View",back:"Back View",additional:"Additional"};function PhotoCapture({isOpen:ar,onClose:or,onCapture:lr,angle:cr="additional",characterName:ur,sceneNumber:dr,lookName:hr}){const[pr,mr]=reactExports.useState(null),[fr,xr]=reactExports.useState(null),[Er,vr]=reactExports.useState("choose"),gr=reactExports.useRef(null),{videoRef:yr,isReady:br,isCapturing:_r,error:jr,facingMode:wr,startCamera:Sr,stopCamera:Tr,capturePhoto:Rr,switchCamera:Nr}=useCamera({facingMode:"environment",onError:Hr=>console.error("Camera error:",Hr)});reactExports.useEffect(()=>{ar?(vr("choose"),mr(null),xr(null)):(Tr(),mr(null),xr(null))},[ar,Tr]),reactExports.useEffect(()=>{Er==="camera"?Sr():Tr()},[Er,Sr,Tr]),reactExports.useEffect(()=>()=>{fr&&URL.revokeObjectURL(fr)},[fr]);const Cr=async()=>{const Hr=await Rr();if(Hr){const Kr=URL.createObjectURL(Hr);mr(Hr),xr(Kr),vr("preview")}},kr=()=>{fr&&URL.revokeObjectURL(fr),mr(null),xr(null),vr("choose")},Ar=()=>{pr&&(lr(pr),or())},Or=Hr=>{var Gr;const Kr=(Gr=Hr.target.files)==null?void 0:Gr[0];if(Kr){const Zr=Kr,Jr=URL.createObjectURL(Zr);mr(Zr),xr(Jr),vr("preview")}gr.current&&(gr.current.value="")},Lr=()=>{var Hr;(Hr=gr.current)==null||Hr.click()},Fr=()=>{vr("camera")};return ar?Er==="choose"?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-background flex flex-col",children:[jsxRuntimeExports.jsx("input",{ref:gr,type:"file",accept:"image/*",capture:void 0,onChange:Or,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3 safe-top",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"text-white tap-target touch-manipulation","aria-label":"Close",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[ur&&jsxRuntimeExports.jsx("div",{className:"text-white font-semibold text-sm",children:ur}),jsxRuntimeExports.jsxs("div",{className:"text-white/80 text-xs",children:[dr&&`Scene ${dr}`,hr&&`  ${hr}`]})]}),jsxRuntimeExports.jsx("div",{className:"w-6"})]})}),jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border px-4 py-3 text-center",children:jsxRuntimeExports.jsx("span",{className:"text-text-primary text-sm font-medium",children:angleLabels[cr]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 rounded-full bg-gold/10 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsxs("svg",{className:"w-12 h-12 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Add Photo"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary text-center text-sm mb-8",children:"Take a new photo or choose one from your library"}),jsxRuntimeExports.jsxs(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:Fr,className:"max-w-xs",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"13",r:"4"})]}),"Take Photo"]}),jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"lg",fullWidth:!0,onClick:Lr,className:"max-w-xs",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]}),"Choose from Library"]})]})]}):Er==="preview"&&fr?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3 safe-top",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:kr,className:"text-white tap-target touch-manipulation","aria-label":"Back",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[ur&&jsxRuntimeExports.jsx("div",{className:"text-white font-semibold text-sm",children:ur}),jsxRuntimeExports.jsx("div",{className:"text-white/80 text-xs",children:angleLabels[cr]})]}),jsxRuntimeExports.jsx("div",{className:"w-6"})]})}),jsxRuntimeExports.jsx("div",{className:"flex-1 relative overflow-hidden bg-black",children:jsxRuntimeExports.jsx("img",{src:fr,alt:"Captured preview",className:"w-full h-full object-contain"})}),jsxRuntimeExports.jsx("div",{className:"bg-black px-4 py-6 safe-bottom",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-6",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"lg",onClick:kr,className:"flex-1 max-w-[140px]",children:"Change"}),jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",onClick:Ar,className:"flex-1 max-w-[140px]",children:"Use Photo"})]})})]}):jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-black flex flex-col",children:[jsxRuntimeExports.jsx("input",{ref:gr,type:"file",accept:"image/*",onChange:Or,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3 safe-top",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("button",{onClick:()=>vr("choose"),className:"text-white tap-target touch-manipulation","aria-label":"Back",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[ur&&jsxRuntimeExports.jsx("div",{className:"text-white font-semibold text-sm",children:ur}),jsxRuntimeExports.jsxs("div",{className:"text-white/80 text-xs",children:[dr&&`Scene ${dr}`,hr&&`  ${hr}`]})]}),jsxRuntimeExports.jsx("div",{className:"w-6"})]})}),jsxRuntimeExports.jsx("div",{className:"bg-black/50 px-4 py-2 text-center",children:jsxRuntimeExports.jsx("span",{className:"text-white/90 text-sm font-medium",children:angleLabels[cr]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[jsxRuntimeExports.jsx("video",{ref:yr,autoPlay:!0,playsInline:!0,muted:!0,className:clsx("w-full h-full object-cover",{"scale-x-[-1]":wr==="user"})}),!br&&!jr&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:jsxRuntimeExports.jsxs("div",{className:"text-white text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),jsxRuntimeExports.jsx("div",{className:"text-sm",children:"Starting camera..."})]})}),jr&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:jsxRuntimeExports.jsxs("div",{className:"text-white text-center px-8",children:[jsxRuntimeExports.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),jsxRuntimeExports.jsx("div",{className:"text-sm mb-4",children:jr.includes("permission")||jr.includes("Permission")?"Camera access denied. Please allow camera access in your browser settings.":jr}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"primary",size:"sm",onClick:Sr,children:"Try Again"}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:Lr,children:"Choose from Library Instead"})]})]})})]}),jsxRuntimeExports.jsx("div",{className:"bg-black px-4 py-6 safe-bottom",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-8",children:[jsxRuntimeExports.jsx("button",{onClick:Lr,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center tap-target touch-manipulation","aria-label":"Choose from library",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),jsxRuntimeExports.jsx("button",{onClick:Cr,disabled:!br||_r,className:clsx("w-20 h-20 rounded-full border-4 border-white flex items-center justify-center tap-target touch-manipulation","transition-transform active:scale-95",{"opacity-50":!br||_r}),"aria-label":"Take photo",children:jsxRuntimeExports.jsx("div",{className:clsx("w-16 h-16 rounded-full bg-white",{"animate-pulse":_r})})}),jsxRuntimeExports.jsx("button",{onClick:Nr,disabled:!br,className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center tap-target touch-manipulation disabled:opacity-50","aria-label":"Switch camera",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})})]}):null}function MasterReference({photo:ar,onCapture:or,onView:lr,onRemove:cr,className:ur}){const dr=!!ar,hr=()=>{dr&&lr?lr():or()};return jsxRuntimeExports.jsxs("div",{className:clsx("relative",ur),children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:hr,className:clsx("w-full aspect-[16/9] rounded-lg overflow-hidden touch-manipulation transition-all","focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2",{"border-2 border-dashed border-gray-300 bg-gray-50":!dr,"border-2 border-solid border-gold":dr}),children:dr?jsxRuntimeExports.jsx("img",{src:ar.uri,alt:"Master reference",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx(CameraIcon,{className:"w-8 h-8 text-gray-400 mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-500",children:"Tap to set master reference"})]})}),dr&&cr&&jsxRuntimeExports.jsx("button",{type:"button",onClick:pr=>{pr.stopPropagation(),cr()},className:"absolute top-2 right-2 w-8 h-8 bg-black/50 text-white rounded-full flex items-center justify-center tap-target touch-manipulation hover:bg-black/70","aria-label":"Remove master reference",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),dr&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent px-3 py-2",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-white uppercase tracking-wide",children:"Master Reference"})})]})}function CameraIcon({className:ar}){return jsxRuntimeExports.jsxs("svg",{className:ar,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}function PhotoViewer({isOpen:ar,photos:or,initialIndex:lr=0,onClose:cr,onDelete:ur}){const[dr,hr]=reactExports.useState(lr),[pr,mr]=reactExports.useState(!0),[fr,xr]=reactExports.useState(!1),Er=reactExports.useRef(null),vr=reactExports.useRef(null),gr=reactExports.useRef(null);reactExports.useEffect(()=>{ar&&(hr(Math.min(lr,or.length-1)),mr(!0))},[ar,lr,or.length]),reactExports.useEffect(()=>{if(!ar)return;const Nr=Cr=>{Cr.key==="ArrowLeft"?yr():Cr.key==="ArrowRight"?br():Cr.key==="Escape"&&cr()};return window.addEventListener("keydown",Nr),()=>window.removeEventListener("keydown",Nr)},[ar,dr,or.length]);const yr=reactExports.useCallback(()=>{dr>0&&hr(dr-1)},[dr]),br=reactExports.useCallback(()=>{dr<or.length-1&&hr(dr+1)},[dr,or.length]),_r=Nr=>{Er.current=Nr.touches[0].clientX},jr=Nr=>{vr.current=Nr.touches[0].clientX},wr=()=>{if(Er.current===null||vr.current===null)return;const Nr=Er.current-vr.current;Math.abs(Nr)>50&&(Nr>0?br():yr()),Er.current=null,vr.current=null},Sr=async()=>{if(!ur||fr)return;const Nr=or[dr];xr(!0);try{ur(Nr.id),dr>=or.length-1&&dr>0&&hr(dr-1),or.length<=1&&cr()}finally{xr(!1)}},Tr=()=>{mr(!pr)};if(!ar||or.length===0)return null;const Rr=or[dr];return Rr?jsxRuntimeExports.jsxs("div",{ref:gr,className:"fixed inset-0 z-50 bg-black",onTouchStart:_r,onTouchMove:jr,onTouchEnd:wr,children:[jsxRuntimeExports.jsx("div",{className:clsx("absolute top-0 left-0 right-0 z-10 transition-opacity duration-200","bg-gradient-to-b from-black/60 to-transparent","safe-top",{"opacity-100":pr,"opacity-0 pointer-events-none":!pr}),children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 pt-[calc(env(safe-area-inset-top)+12px)]",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:cr,className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation","aria-label":"Close",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsxs("span",{className:"text-white text-sm font-medium px-3 py-1 rounded-full bg-black/30 backdrop-blur-sm",children:[dr+1," / ",or.length]}),ur&&jsxRuntimeExports.jsx("button",{type:"button",onClick:Sr,disabled:fr,className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation disabled:opacity-50","aria-label":"Delete photo",children:fr?jsxRuntimeExports.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",onClick:Tr,children:jsxRuntimeExports.jsx("img",{src:Rr.uri,alt:`Photo ${dr+1}`,className:"max-w-full max-h-full object-contain",draggable:!1})}),or.length>1&&pr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[dr>0&&jsxRuntimeExports.jsx("button",{type:"button",onClick:Nr=>{Nr.stopPropagation(),yr()},className:"absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation hidden sm:flex","aria-label":"Previous photo",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),dr<or.length-1&&jsxRuntimeExports.jsx("button",{type:"button",onClick:Nr=>{Nr.stopPropagation(),br()},className:"absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center rounded-full bg-black/30 backdrop-blur-sm touch-manipulation hidden sm:flex","aria-label":"Next photo",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),or.length>1&&pr&&jsxRuntimeExports.jsx("div",{className:clsx("absolute bottom-0 left-0 right-0 z-10","bg-gradient-to-t from-black/60 to-transparent","safe-bottom"),children:jsxRuntimeExports.jsx("div",{className:"flex justify-center gap-1.5 pb-[calc(env(safe-area-inset-bottom)+16px)] pt-6",children:or.map((Nr,Cr)=>jsxRuntimeExports.jsx("button",{type:"button",onClick:kr=>{kr.stopPropagation(),hr(Cr)},className:clsx("w-2 h-2 rounded-full transition-all touch-manipulation",{"bg-white w-6":Cr===dr,"bg-white/50":Cr!==dr}),"aria-label":`Go to photo ${Cr+1}`},Cr))})}),or.length>1&&pr&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-24 left-0 right-0 flex justify-center pointer-events-none sm:hidden",children:jsxRuntimeExports.jsx("span",{className:"text-white/60 text-xs",children:"Swipe to navigate"})})]}):null}const flagLabels=[{key:"sweat",label:"Sweat"},{key:"dishevelled",label:"Dishevelled"},{key:"blood",label:"Blood"},{key:"dirt",label:"Dirt"},{key:"wetHair",label:"Wet Hair"},{key:"tears",label:"Tears"}];function QuickFlags({flags:ar,onToggle:or}){return jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:flagLabels.map(({key:lr,label:cr})=>jsxRuntimeExports.jsx(TogglePill,{isActive:ar[lr],label:cr,onClick:()=>or(lr)},lr))})}function EventCard({event:ar,onRemove:or}){const[lr,cr]=reactExports.useState(!1),ur=ar.progression&&ar.progression.length>0,dr=ar.scenes&&ar.scenes.length>0?ar.scenes:null;return jsxRuntimeExports.jsxs("div",{className:"bg-card border border-border rounded-[10px] p-3.5 relative",children:[or&&jsxRuntimeExports.jsx("button",{onClick:or,className:"absolute top-3 right-3 p-1 text-text-light hover:text-text-muted transition-colors touch-manipulation","aria-label":"Remove event",children:jsxRuntimeExports.jsx("svg",{className:"w-[18px] h-[18px]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsx("span",{className:"inline-block text-[9px] font-bold tracking-widest uppercase text-gold bg-gold-100/50 px-2 py-0.5 rounded mb-2",children:ar.type}),jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary text-[15px] mb-1 pr-6",children:ar.name}),ar.description&&jsxRuntimeExports.jsx("p",{className:"text-[13px] text-text-secondary leading-snug mb-2.5",children:ar.description}),dr&&jsxRuntimeExports.jsxs("div",{className:"mb-2.5",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide block mb-1.5",children:"SCENES"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:dr.map(hr=>{const pr=ur&&ar.progression.some(mr=>mr.scene===hr);return jsxRuntimeExports.jsx("span",{className:`inline-block min-w-[32px] text-center px-2 py-0.5 text-[11px] font-medium rounded ${pr?"bg-gold text-white":"bg-gray-100 text-text-secondary"}`,children:hr},hr)})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Stage:"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary font-medium ml-1.5",children:ar.stage||""})]}),!dr&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Scenes:"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary font-medium ml-1.5",children:ar.sceneRange||""})]})]}),ar.products&&jsxRuntimeExports.jsxs("div",{className:"text-xs mt-2",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Products:"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary ml-1.5",children:ar.products})]}),ar.referencePhotos.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-3",children:[jsxRuntimeExports.jsx("div",{className:"field-label mb-2",children:"REFERENCE PHOTOS"}),jsxRuntimeExports.jsx("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar",children:ar.referencePhotos.map(hr=>jsxRuntimeExports.jsx("img",{src:hr.thumbnail||hr.uri,alt:"Reference",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"},hr.id))})]}),ur&&jsxRuntimeExports.jsxs("div",{className:"mt-3 border-t border-border pt-3",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>cr(!lr),className:"flex items-center gap-1.5 text-[11px] font-semibold text-gold mb-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),"Progression (",ar.progression.length," stage",ar.progression.length!==1?"s":"",")",jsxRuntimeExports.jsx("svg",{className:`w-3.5 h-3.5 transition-transform ${lr?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),lr&&jsxRuntimeExports.jsxs("div",{className:"relative pl-4",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-[7px] top-1 bottom-1 w-[2px] bg-gold-200 rounded"}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:ar.progression.map((hr,pr)=>jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute -left-4 top-0.5 w-4 h-4 rounded-full bg-gold flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px] text-white font-bold",children:pr+1})}),jsxRuntimeExports.jsxs("div",{className:"ml-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[jsxRuntimeExports.jsx("span",{className:"text-[11px] font-semibold text-text-primary",children:hr.stage||`Stage ${pr+1}`}),hr.scene&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-muted bg-gray-100 px-1.5 py-0.5 rounded",children:["Sc ",hr.scene]})]}),hr.notes&&jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-secondary leading-snug",children:hr.notes}),hr.referencePhotos&&hr.referencePhotos.length>0&&jsxRuntimeExports.jsx("div",{className:"flex gap-1.5 mt-1.5",children:hr.referencePhotos.map(mr=>jsxRuntimeExports.jsx("img",{src:mr.thumbnail||mr.uri,alt:"Stage reference",className:"w-10 h-10 rounded object-cover"},mr.id))})]})]},hr.id))})]})]})]})}function ContinuityEvents({events:ar,onAddEvent:or,onRemoveEvent:lr}){return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3.5",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"CONTINUITY EVENTS"}),jsxRuntimeExports.jsxs("button",{onClick:or,className:"flex items-center gap-1 px-3 py-1.5 rounded-md bg-gold-100/50 text-gold text-[11px] font-semibold hover:bg-gold-100 transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Event"]})]}),ar.length===0?jsxRuntimeExports.jsx(EmptyState$3,{onAdd:or}):jsxRuntimeExports.jsx("div",{className:"space-y-2.5",children:ar.map(cr=>jsxRuntimeExports.jsx(EventCard,{event:cr,onRemove:()=>lr(cr.id)},cr.id))})]})}function EmptyState$3({onAdd:ar}){return jsxRuntimeExports.jsxs("button",{onClick:ar,className:"w-full flex flex-col items-center justify-center py-6 text-center touch-manipulation",children:[jsxRuntimeExports.jsxs("svg",{className:"w-8 h-8 text-gray-300 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),jsxRuntimeExports.jsx("polyline",{points:"14 2 14 8 20 8",strokeLinecap:"round",strokeLinejoin:"round"}),jsxRuntimeExports.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"12",strokeLinecap:"round"}),jsxRuntimeExports.jsx("line",{x1:"9",y1:"15",x2:"15",y2:"15",strokeLinecap:"round"})]}),jsxRuntimeExports.jsx("span",{className:"text-[13px] text-text-light",children:"No continuity events"}),jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-placeholder mt-1",children:"Add wounds, bruises, prosthetics etc."})]})}function AddEventModal({isOpen:ar,onClose:or,onAdd:lr,availableScenes:cr=[]}){const[ur,dr]=reactExports.useState("Wound"),[hr,pr]=reactExports.useState(""),[mr,fr]=reactExports.useState(""),[xr,Er]=reactExports.useState(""),[vr,gr]=reactExports.useState([]),[yr,br]=reactExports.useState(""),[_r,jr]=reactExports.useState(!1),[wr,Sr]=reactExports.useState([]),[Tr,Rr]=reactExports.useState(!1),[Nr,Cr]=reactExports.useState(!1),kr=reactExports.useRef(null),[Ar,Or]=reactExports.useState([]),[Lr,Fr]=reactExports.useState(!1),Hr=()=>{dr("Wound"),pr(""),fr(""),Er(""),gr([]),br(""),Sr([]),Cr(!1),Or([]),Fr(!1)},Kr=()=>{hr.trim()&&(lr({type:ur,name:hr.trim(),description:mr.trim(),stage:xr.trim(),sceneRange:vr.length>0?vr.join(", "):"",scenes:vr,products:yr.trim(),referencePhotos:wr,progression:Ar}),Hr())},Gr=()=>{Hr(),or()},Zr=Br=>{gr(Xr=>Xr.includes(Br)?Xr.filter(Wr=>Wr!==Br):[...Xr,Br])},Jr=()=>{vr.length===cr.length?gr([]):gr([...cr])},os=()=>{const Br=vr.find(Xr=>!Ar.some(Wr=>Wr.scene===Xr))||"";Or(Xr=>[...Xr,{id:`stage-${Date.now()}`,scene:Br,stage:"",notes:"",referencePhotos:[]}])},Ur=(Br,Xr)=>{Or(Wr=>Wr.map(ss=>ss.id===Br?{...ss,...Xr}:ss))},Vr=Br=>{Or(Xr=>Xr.filter(Wr=>Wr.id!==Br))},es=async Br=>{var Wr;const Xr=(Wr=Br.target.files)==null?void 0:Wr[0];if(Xr){Rr(!0);try{const ss=await createPhotoFromBlob(Xr,"additional");Sr(ds=>[...ds,ss])}catch(ss){console.error("Failed to process photo:",ss)}finally{Rr(!1)}}kr.current&&(kr.current.value="")},Ir=Br=>{Sr(Xr=>Xr.filter(Wr=>Wr.id!==Br))},Dr=async Br=>{Rr(!0);try{const Xr=await createPhotoFromBlob(Br,"additional");Sr(Wr=>[...Wr,Xr])}catch(Xr){console.error("Failed to process captured photo:",Xr)}finally{Rr(!1),Cr(!1)}},Pr=()=>{Cr(!0)},Mr=ur==="Wound"||ur==="Bruise"||ur==="Other";return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(PhotoCapture,{isOpen:Nr,onClose:()=>Cr(!1),onCapture:Dr,angle:"additional"}),jsxRuntimeExports.jsxs(BottomSheet,{isOpen:ar&&!Nr,onClose:Gr,title:"Add Continuity Event",height:"auto",children:[jsxRuntimeExports.jsx("input",{ref:kr,type:"file",accept:"image/*",onChange:es,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"TYPE"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:CONTINUITY_EVENT_TYPES.map(Br=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>dr(Br),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full border transition-colors touch-manipulation",{"bg-gold text-white border-gold":ur===Br,"bg-gray-100 text-text-secondary border-gray-200 hover:bg-gray-200":ur!==Br}),children:Br},Br))})]}),jsxRuntimeExports.jsx(Input,{label:"NAME",value:hr,onChange:Br=>pr(Br.target.value),placeholder:"e.g., Forehead Cut"}),jsxRuntimeExports.jsx(Textarea,{label:"DESCRIPTION",value:mr,onChange:Br=>fr(Br.target.value),placeholder:"Describe the makeup effect...",rows:2}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"SCENES"}),cr.length>0&&jsxRuntimeExports.jsx("button",{type:"button",onClick:Jr,className:"text-[11px] text-gold font-medium",children:vr.length===cr.length?"Deselect All":"Select All"})]}),cr.length>0?jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1.5",children:cr.map(Br=>{const Xr=vr.includes(Br);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Zr(Br),className:clsx("min-w-[44px] px-2.5 py-1.5 text-xs font-medium rounded-lg border transition-colors touch-manipulation",{"bg-gold text-white border-gold":Xr,"bg-gray-50 text-text-secondary border-gray-200":!Xr}),children:Br},Br)})}):jsxRuntimeExports.jsx(Input,{value:vr.join(", "),onChange:Br=>gr(Br.target.value.split(",").map(Xr=>Xr.trim()).filter(Boolean)),placeholder:"e.g., 12, 13, 14, 15"}),vr.length>0&&jsxRuntimeExports.jsxs("p",{className:"text-[11px] text-text-muted mt-1.5",children:[vr.length," scene",vr.length!==1?"s":""," selected"]})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{label:"CURRENT STAGE",value:xr,onChange:Br=>Er(Br.target.value),onFocus:()=>jr(!0),onBlur:()=>setTimeout(()=>jr(!1),200),placeholder:"e.g., Fresh, Day 2 Healing"}),_r&&jsxRuntimeExports.jsx("div",{className:"absolute z-10 top-full left-0 right-0 mt-1 bg-card rounded-lg shadow-lg border border-border overflow-hidden max-h-40 overflow-y-auto",children:STAGE_SUGGESTIONS.map(Br=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{Er(Br),jr(!1)},className:"w-full px-3 py-2 text-left text-sm text-text-secondary hover:bg-gray-50 touch-manipulation",children:Br},Br))})]}),Mr&&vr.length>1&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"PROGRESSION TIMELINE"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Fr(!Lr),className:"text-[11px] text-gold font-medium",children:Lr?"Hide":"Plan changes over scenes"})]}),Lr&&jsxRuntimeExports.jsxs("div",{className:"space-y-2.5",children:[Ar.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-2",children:Ar.map((Br,Xr)=>jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-gold text-white text-[10px] font-bold flex items-center justify-center flex-shrink-0",children:Xr+1}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] font-semibold text-text-muted uppercase tracking-wide",children:["Stage ",Xr+1]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Vr(Br.id),className:"ml-auto p-0.5 text-text-light hover:text-red-500 transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide block mb-1",children:"From Scene"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:vr.map(Wr=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Ur(Br.id,{scene:Wr}),className:clsx("min-w-[36px] px-2 py-1 text-[11px] font-medium rounded border transition-colors touch-manipulation",{"bg-gold text-white border-gold":Br.scene===Wr,"bg-white text-text-secondary border-gray-200":Br.scene!==Wr}),children:Wr},Wr))})]}),jsxRuntimeExports.jsx("div",{className:"mb-2 relative",children:jsxRuntimeExports.jsx(ProgressionStagePicker,{value:Br.stage,onChange:Wr=>Ur(Br.id,{stage:Wr})})}),jsxRuntimeExports.jsx(Textarea,{value:Br.notes,onChange:Wr=>Ur(Br.id,{notes:Wr.target.value}),placeholder:"Application notes for this stage...",rows:1})]},Br.id))}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:os,className:"w-full py-2.5 flex items-center justify-center gap-1.5 text-[12px] font-medium text-gold bg-gold-100/30 border border-dashed border-gold-300 rounded-lg hover:bg-gold-100/50 transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Stage"]}),Ar.length===0&&jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light text-center",children:"Plan how this event changes across scenes  e.g. fresh wound in Sc 5, scabbing by Sc 12, healed by Sc 20"})]})]}),jsxRuntimeExports.jsx(Textarea,{label:"PRODUCTS",value:yr,onChange:Br=>br(Br.target.value),placeholder:"List products used...",rows:2}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"REFERENCE PHOTOS"}),wr.length>0&&jsxRuntimeExports.jsx("div",{className:"grid grid-cols-4 gap-2 mb-3",children:wr.map(Br=>jsxRuntimeExports.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100",children:[jsxRuntimeExports.jsx("img",{src:Br.thumbnail||Br.uri,alt:"Reference",className:"w-full h-full object-cover"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Ir(Br.id),className:"absolute top-1 right-1 w-5 h-5 bg-black/60 rounded-full flex items-center justify-center","aria-label":"Remove photo",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},Br.id))}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",fullWidth:!0,onClick:Pr,disabled:Tr,children:Tr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"w-4 h-4 mr-1.5 border-2 border-gold border-t-transparent rounded-full animate-spin"}),"Processing..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),wr.length>0?"Add Another Photo":"Add Reference Photo"]})})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"lg",fullWidth:!0,onClick:Gr,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:Kr,disabled:!hr.trim(),children:"Add Event"})]})]})]})]})}function ProgressionStagePicker({value:ar,onChange:or}){const[lr,cr]=reactExports.useState(!1);return jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{label:"STAGE",value:ar,onChange:ur=>or(ur.target.value),onFocus:()=>cr(!0),onBlur:()=>setTimeout(()=>cr(!1),200),placeholder:"e.g., Fresh, Scabbed"}),lr&&jsxRuntimeExports.jsx("div",{className:"absolute z-10 top-full left-0 right-0 mt-1 bg-card rounded-lg shadow-lg border border-border overflow-hidden max-h-32 overflow-y-auto",children:STAGE_SUGGESTIONS.map(ur=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{or(ur),cr(!1)},className:"w-full px-3 py-1.5 text-left text-[12px] text-text-secondary hover:bg-gray-50 touch-manipulation",children:ur},ur))})]})}function MakeupForm({makeup:ar,onChange:or,readOnly:lr=!1}){const cr=ar||createEmptyMakeupDetails(),ur=(dr,hr)=>{or&&!lr&&or({...cr,[dr]:hr})};return!ar&&lr?jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No makeup details available for this look."})}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"BASE"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Foundation",value:cr.foundation,onChange:dr=>ur("foundation",dr),readOnly:lr,placeholder:"e.g., MAC Studio Fix NC25"}),jsxRuntimeExports.jsx(FormField,{label:"Coverage",value:cr.coverage,onChange:dr=>ur("coverage",dr),readOnly:lr,placeholder:"e.g., Medium"})]}),jsxRuntimeExports.jsx(FormField,{label:"Concealer",value:cr.concealer,onChange:dr=>ur("concealer",dr),readOnly:lr,placeholder:"e.g., NARS Radiant Creamy"}),jsxRuntimeExports.jsx(FormField,{label:"Concealer Placement",value:cr.concealerPlacement,onChange:dr=>ur("concealerPlacement",dr),readOnly:lr,placeholder:"e.g., Under eyes, bridge of nose"}),jsxRuntimeExports.jsx(FormField,{label:"Contour",value:cr.contour,onChange:dr=>ur("contour",dr),readOnly:lr,placeholder:"e.g., Charlotte Tilbury Sculpt"}),jsxRuntimeExports.jsx(FormField,{label:"Contour Placement",value:cr.contourPlacement,onChange:dr=>ur("contourPlacement",dr),readOnly:lr,placeholder:"e.g., Hollows of cheeks, jawline"}),jsxRuntimeExports.jsx(FormField,{label:"Highlight",value:cr.highlight,onChange:dr=>ur("highlight",dr),readOnly:lr,placeholder:"e.g., Becca Champagne Pop"}),jsxRuntimeExports.jsx(FormField,{label:"Highlight Placement",value:cr.highlightPlacement,onChange:dr=>ur("highlightPlacement",dr),readOnly:lr,placeholder:"e.g., Cheekbones, brow bone"}),jsxRuntimeExports.jsx(FormField,{label:"Blush",value:cr.blush,onChange:dr=>ur("blush",dr),readOnly:lr,placeholder:"e.g., NARS Orgasm"}),jsxRuntimeExports.jsx(FormField,{label:"Blush Placement",value:cr.blushPlacement,onChange:dr=>ur("blushPlacement",dr),readOnly:lr,placeholder:"e.g., Apples of cheeks"})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"EYES"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Brow Product",value:cr.browProduct,onChange:dr=>ur("browProduct",dr),readOnly:lr,placeholder:"e.g., ABH Dipbrow Taupe"}),jsxRuntimeExports.jsx(FormField,{label:"Brow Shape",value:cr.browShape,onChange:dr=>ur("browShape",dr),readOnly:lr,placeholder:"e.g., Natural arch"})]}),jsxRuntimeExports.jsx(FormField,{label:"Eye Primer",value:cr.eyePrimer,onChange:dr=>ur("eyePrimer",dr),readOnly:lr,placeholder:"e.g., Urban Decay Primer Potion"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Lid Colour",value:cr.lidColour,onChange:dr=>ur("lidColour",dr),readOnly:lr,placeholder:"e.g., Champagne"}),jsxRuntimeExports.jsx(FormField,{label:"Crease",value:cr.creaseColour,onChange:dr=>ur("creaseColour",dr),readOnly:lr,placeholder:"e.g., Warm brown"}),jsxRuntimeExports.jsx(FormField,{label:"Outer V",value:cr.outerV,onChange:dr=>ur("outerV",dr),readOnly:lr,placeholder:"e.g., Deep brown"})]}),jsxRuntimeExports.jsx(FormField,{label:"Liner Style",value:cr.liner,onChange:dr=>ur("liner",dr),readOnly:lr,placeholder:"e.g., Thin black line, tight line"}),jsxRuntimeExports.jsx(FormField,{label:"Lashes",value:cr.lashes,onChange:dr=>ur("lashes",dr),readOnly:lr,placeholder:"e.g., Ardell Wispies, 2 coats mascara"})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"LIPS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Lip Liner",value:cr.lipLiner,onChange:dr=>ur("lipLiner",dr),readOnly:lr,placeholder:"e.g., MAC Spice"}),jsxRuntimeExports.jsx(FormField,{label:"Lip Colour",value:cr.lipColour,onChange:dr=>ur("lipColour",dr),readOnly:lr,placeholder:"e.g., Charlotte Tilbury Pillow Talk"})]}),jsxRuntimeExports.jsx(FormField,{label:"Setting",value:cr.setting,onChange:dr=>ur("setting",dr),readOnly:lr,placeholder:"e.g., MAC Fix+, light powder"})]})]})]})}function HairForm({hair:ar,onChange:or,readOnly:lr=!1}){const cr=ar||createEmptyHairDetails(),ur=cr.hairType!=="Natural",dr=(pr,mr)=>{or&&!lr&&or({...cr,[pr]:mr})},hr=pr=>{if(lr)return;const mr=cr.wigAttachment||[],fr=mr.includes(pr)?mr.filter(xr=>xr!==pr):[...mr,pr];dr("wigAttachment",fr)};return!ar&&lr?jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No hair details available for this look."})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Hair Type"}),lr?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:cr.hairType}):jsxRuntimeExports.jsx("select",{value:cr.hairType,onChange:pr=>dr("hairType",pr.target.value),className:"w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",children:HAIR_TYPES.map(pr=>jsxRuntimeExports.jsx("option",{value:pr,children:pr},pr))})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Style Description",value:cr.style,onChange:pr=>dr("style",pr),readOnly:lr,placeholder:"e.g., Loose waves, half-up half-down",multiline:!0}),jsxRuntimeExports.jsx(FormField,{label:"Products Used",value:cr.products,onChange:pr=>dr("products",pr),readOnly:lr,placeholder:"e.g., Oribe Dry Texturizing Spray, heat protectant",multiline:!0}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Parting",value:cr.parting,onChange:pr=>dr("parting",pr),readOnly:lr,placeholder:"e.g., Centre part"}),jsxRuntimeExports.jsx(FormField,{label:"Pieces Out",value:cr.piecesOut,onChange:pr=>dr("piecesOut",pr),readOnly:lr,placeholder:"e.g., Face-framing layers"})]}),jsxRuntimeExports.jsx(FormField,{label:"Pins / Grips / Ties",value:cr.pins,onChange:pr=>dr("pins",pr),readOnly:lr,placeholder:"e.g., 6 bobby pins at crown, clear elastic"}),jsxRuntimeExports.jsx(FormField,{label:"Accessories",value:cr.accessories,onChange:pr=>dr("accessories",pr),readOnly:lr,placeholder:"e.g., Gold barrette, silk ribbon"})]}),ur&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-4 mt-4",children:jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"WIG / HAIRPIECE DETAILS"})}),jsxRuntimeExports.jsx(FormField,{label:"Wig Name / ID",value:cr.wigNameId,onChange:pr=>dr("wigNameId",pr),readOnly:lr,placeholder:"e.g., WIG-042 Auburn Bob"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Wig Type"}),lr?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:cr.wigType||jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsxs("select",{value:cr.wigType,onChange:pr=>dr("wigType",pr.target.value),className:"w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select type..."}),WIG_TYPES.map(pr=>jsxRuntimeExports.jsx("option",{value:pr,children:pr},pr))]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Hairline"}),lr?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:cr.hairline||jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsxs("select",{value:cr.hairline,onChange:pr=>dr("hairline",pr.target.value),className:"w-full bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-3 text-sm text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select style..."}),HAIRLINE_STYLES.map(pr=>jsxRuntimeExports.jsx("option",{value:pr,children:pr},pr))]})]})]}),jsxRuntimeExports.jsx(FormField,{label:"Wig Cap Method",value:cr.wigCapMethod,onChange:pr=>dr("wigCapMethod",pr),readOnly:lr,placeholder:"e.g., Cornrows, bald cap, braided flat"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Attachment Method"}),lr?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:cr.wigAttachment.length>0?cr.wigAttachment.join(", "):jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:WIG_ATTACHMENTS.map(pr=>{const mr=cr.wigAttachment.includes(pr);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>hr(pr),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${mr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:pr},pr)})})]}),jsxRuntimeExports.jsx(FormField,{label:"Lace Tint",value:cr.laceTint,onChange:pr=>dr("laceTint",pr),readOnly:lr,placeholder:"e.g., Ebin Lace Tint Medium Brown"}),jsxRuntimeExports.jsx(FormField,{label:"Edges / Baby Hairs",value:cr.edgesBabyHairs,onChange:pr=>dr("edgesBabyHairs",pr),readOnly:lr,placeholder:"e.g., Laid with Got2b, swoop on left side"})]})]})}function SFXForm({sfx:ar,onChange:or,onCapturePhoto:lr,onRemovePhoto:cr,readOnly:ur=!1}){const dr=ar||createEmptySFXDetails(),hr=(fr,xr)=>{or&&!ur&&or({...dr,[fr]:xr})},pr=fr=>{if(ur)return;const xr=dr.sfxTypes||[],Er=xr.includes(fr)?xr.filter(vr=>vr!==fr):[...xr,fr];hr("sfxTypes",Er)},mr=fr=>{if(ur)return;const xr=dr.bloodTypes||[],Er=xr.includes(fr)?xr.filter(vr=>vr!==fr):[...xr,fr];hr("bloodTypes",Er)};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"SFX Required"}),jsxRuntimeExports.jsx(Switch,{isOn:dr.sfxRequired,onToggle:()=>!ur&&hr("sfxRequired",!dr.sfxRequired),disabled:ur})]}),dr.sfxRequired&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"SFX Type"}),ur?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:dr.sfxTypes.length>0?dr.sfxTypes.join(", "):jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:SFX_TYPES.map(fr=>{const xr=dr.sfxTypes.includes(fr);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>pr(fr),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${xr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:fr},fr)})})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"PROSTHETICS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Prosthetic Pieces",value:dr.prostheticPieces,onChange:fr=>hr("prostheticPieces",fr),readOnly:ur,placeholder:"e.g., Brow piece #3, nose tip, chin extension",multiline:!0}),jsxRuntimeExports.jsx(FormField,{label:"Prosthetic Adhesive",value:dr.prostheticAdhesive,onChange:fr=>hr("prostheticAdhesive",fr),readOnly:ur,placeholder:"e.g., Pros-Aide, Telesis 5"})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"BLOOD"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Blood Type"}),ur?jsxRuntimeExports.jsx("div",{className:"text-sm text-text-primary",children:dr.bloodTypes.length>0?dr.bloodTypes.join(", "):jsxRuntimeExports.jsx("span",{className:"text-text-placeholder",children:""})}):jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:BLOOD_TYPES.map(fr=>{const xr=dr.bloodTypes.includes(fr);return jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>mr(fr),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${xr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:fr},fr)})})]}),jsxRuntimeExports.jsx(FormField,{label:"Blood Products",value:dr.bloodProducts,onChange:fr=>hr("bloodProducts",fr),readOnly:ur,placeholder:"e.g., Kryolan Dark Blood, Fleet Street Drying Blood"}),jsxRuntimeExports.jsx(FormField,{label:"Blood Placement",value:dr.bloodPlacement,onChange:fr=>hr("bloodPlacement",fr),readOnly:ur,placeholder:"e.g., Left temple wound, splatter on collar",multiline:!0})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"TATTOOS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Tattoo Coverage",value:dr.tattooCoverage,onChange:fr=>hr("tattooCoverage",fr),readOnly:ur,placeholder:"e.g., Dermablend on right arm sleeve"}),jsxRuntimeExports.jsx(FormField,{label:"Temporary Tattoos",value:dr.temporaryTattoos,onChange:fr=>hr("temporaryTattoos",fr),readOnly:ur,placeholder:"e.g., Neck tattoo transfer, left forearm design"})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"EYES & TEETH"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(FormField,{label:"Contact Lenses",value:dr.contactLenses,onChange:fr=>hr("contactLenses",fr),readOnly:ur,placeholder:"e.g., 9mm Mesmer Ghostly White, plano"}),jsxRuntimeExports.jsx(FormField,{label:"Teeth",value:dr.teeth,onChange:fr=>hr("teeth",fr),readOnly:ur,placeholder:"e.g., Custom vampire fangs, coffee staining"})]})]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold mb-3",children:"AGING & CHARACTER"}),jsxRuntimeExports.jsx(FormField,{label:"Aging / Character Notes",value:dr.agingCharacterNotes,onChange:fr=>hr("agingCharacterNotes",fr),readOnly:ur,placeholder:"e.g., Stipple aging on hands and neck, sunken cheeks with highlight/shadow",multiline:!0,rows:3})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border pt-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("label",{className:"field-label whitespace-nowrap",children:"SFX APPLICATION TIME"}),ur?jsxRuntimeExports.jsxs("span",{className:"text-sm text-text-primary font-semibold",children:[dr.sfxApplicationTime??""," min"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("input",{type:"number",value:dr.sfxApplicationTime??"",onChange:fr=>hr("sfxApplicationTime",fr.target.value?parseInt(fr.target.value,10):null),className:"w-16 bg-[#f8f7f5] border border-[#e8e6e1] rounded-lg px-3 py-2 text-sm text-center font-semibold text-[#1a1a1a] focus:outline-none focus:border-gold focus:ring-1 focus:ring-gold/30 transition-colors",placeholder:"--",min:"0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border pt-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h4",{className:"field-label text-gold",children:"SFX REFERENCE PHOTOS"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-light",children:[dr.sfxReferencePhotos.length," photos"]})]}),jsxRuntimeExports.jsx(SFXPhotoGrid,{photos:dr.sfxReferencePhotos,onCapture:lr,onRemove:cr,readOnly:ur})]})]}),!dr.sfxRequired&&jsxRuntimeExports.jsx("div",{className:"text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Toggle SFX Required to add special effects details."})})]})}function SFXPhotoGrid({photos:ar,onCapture:or,onRemove:lr,readOnly:cr}){return jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[ar.map(ur=>jsxRuntimeExports.jsxs("div",{className:"relative aspect-square",children:[jsxRuntimeExports.jsx("img",{src:ur.thumbnail||ur.uri,alt:"SFX reference",className:"w-full h-full object-cover rounded-lg"}),!cr&&lr&&jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>lr(ur.id),className:"absolute -top-1.5 -right-1.5 w-5 h-5 rounded-full bg-error text-white flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},ur.id)),!cr&&or&&jsxRuntimeExports.jsxs("button",{type:"button",onClick:or,className:"aspect-square rounded-lg border-2 border-dashed border-border flex flex-col items-center justify-center gap-1 text-text-light hover:border-gold hover:text-gold transition-colors",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"})]}),jsxRuntimeExports.jsx("span",{className:"text-[10px] font-medium",children:"Add"})]}),ar.length===0&&cr&&jsxRuntimeExports.jsx("div",{className:"col-span-4 text-center py-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No SFX reference photos."})})]})}function NotesForm({notes:ar,onChange:or}){const[lr,cr]=reactExports.useState(ar),ur=reactExports.useRef(null),dr=reactExports.useRef(null),hr=reactExports.useRef(or);reactExports.useEffect(()=>{hr.current=or},[or]),reactExports.useEffect(()=>{cr(ar)},[ar]);const pr=()=>{dr.current&&(clearTimeout(dr.current),dr.current=null),ur.current!==null&&(hr.current(ur.current),ur.current=null)};reactExports.useEffect(()=>()=>{pr()},[]);const mr=xr=>{cr(xr),ur.current=xr,dr.current&&clearTimeout(dr.current),dr.current=setTimeout(()=>{ur.current!==null&&(hr.current(ur.current),ur.current=null)},300)},fr=()=>{pr()};return jsxRuntimeExports.jsx(Textarea,{value:lr,onChange:xr=>mr(xr.target.value),onBlur:fr,placeholder:"Add continuity notes, anomalies, director requests...",rows:4,className:"resize-none"})}function CharacterProfile({sceneId:ar,characterId:or}){const{currentProject:lr,getCharacter:cr,getScene:ur,getLookForCharacterInScene:dr,getOrCreateSceneCapture:hr,getSceneCapture:pr,updateSceneCapture:mr,addPhotoToCapture:fr,removePhotoFromCapture:xr,toggleContinuityFlag:Er,addContinuityEvent:vr,removeContinuityEvent:gr,updateSFXDetails:yr,addSFXPhoto:br,removeSFXPhoto:_r,markSceneComplete:jr,copyToNextScene:wr,setCurrentScene:Sr,sceneCaptures:Tr,updateLook:Rr}=useProjectStore(),Nr=cr(or),Cr=ur(ar),kr=Cr?dr(or,Cr.sceneNumber):void 0,Ar=pr(ar,or)||hr(ar,or),[Or,Lr]=reactExports.useState(!1),[Fr,Hr]=reactExports.useState("front"),[Kr,Gr]=reactExports.useState(!1),[Zr,Jr]=reactExports.useState(!1),[os,Ur]=reactExports.useState(!1),[Vr,es]=reactExports.useState(!1),[Ir,Dr]=reactExports.useState([]),[Pr,Mr]=reactExports.useState(0),[Br,Xr]=reactExports.useState("scene");if(!Nr||!Cr||!lr)return null;const Wr=Ar.id,ss=(ts,Yr=!1,hs=!1)=>{Hr(ts),Gr(Yr),Jr(hs),Lr(!0)},ds=async ts=>{const Yr=await createPhotoFromBlob(ts,Kr||Zr?void 0:Fr);Zr?br(Wr,Yr):Kr&&kr?fr(Wr,Yr,"additional"):fr(Wr,Yr,Fr==="additional"?"additional":Fr)},ns=ts=>{yr(Wr,ts)},fs=()=>{jr(ar)},bs=()=>{const ts=wr(ar,or);ts&&Sr(ts)},Es=ts=>{const Yr={...ts,id:`event-${Date.now()}`};vr(Wr,Yr),Ur(!1)},Ds=(ts,Yr)=>{const hs=[],ys=["front","left","right","back"];let _s=0;ys.forEach(Ss=>{const vs=Ar.photos[Ss];vs&&(Ss===Yr&&(_s=hs.length),hs.push(vs))}),Dr(hs),Mr(_s),Xr("scene"),es(!0)},gs=(ts,Yr)=>{Dr(Ar.additionalPhotos),Mr(Yr),Xr("additional"),es(!0)},as=ts=>{if(Br==="scene"){const Yr=["front","left","right","back"];for(const hs of Yr){const ys=Ar.photos[hs];if((ys==null?void 0:ys.id)===ts){xr(Wr,hs);break}}Dr(hs=>hs.filter(ys=>ys.id!==ts))}else Br==="additional"?(xr(Wr,"additional",ts),Dr(Yr=>Yr.filter(hs=>hs.id!==ts))):Br==="sfx"&&(_r(Wr,ts),Dr(Yr=>Yr.filter(hs=>hs.id!==ts)))},qr=kr?lr.scenes.filter(ts=>kr.scenes.includes(ts.sceneNumber)):[];return jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-4 space-y-2.5 pb-32",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3.5",children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:Nr,size:"xl"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h2",{className:"text-character-name text-gold font-bold truncate",children:Nr.name}),jsxRuntimeExports.jsxs("p",{className:"text-[13px] text-text-muted mt-0.5",children:["Scene ",Cr.sceneNumber," | ",formatSluglineShort(Cr.slugline)]})]})]}),kr&&jsxRuntimeExports.jsxs("div",{className:"bg-input-bg rounded-[10px] px-4 py-3 flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-gold",children:kr.name}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted ml-2.5",children:["Scenes ",formatSceneRange(kr.scenes)]})]}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted font-medium",children:["~",formatEstimatedTime(kr.estimatedTime)]})]}),(()=>{const ts=[{key:"sweat",label:"Sweat"},{key:"dishevelled",label:"Dishevelled"},{key:"blood",label:"Blood"},{key:"dirt",label:"Dirt"},{key:"wetHair",label:"Wet Hair"},{key:"tears",label:"Tears"}].filter(({key:Yr})=>Ar.continuityFlags[Yr]);return ts.length===0?null:jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:ts.map(({key:Yr,label:hs})=>jsxRuntimeExports.jsx("span",{className:"px-3 py-1.5 text-xs font-semibold rounded-full bg-gold text-white",children:hs},Yr))})})(),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"SCENE PHOTOS"}),jsxRuntimeExports.jsx(PhotoGrid,{photos:Ar.photos,onCapture:ts=>ss(ts),onView:Ds})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"MASTER REFERENCE"}),jsxRuntimeExports.jsx(MasterReference,{photo:kr==null?void 0:kr.masterReference,onCapture:()=>ss("front",!0)})]}),qr.length>1&&jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"SCENES IN THIS LOOK"}),jsxRuntimeExports.jsx("div",{className:"flex gap-3 overflow-x-auto hide-scrollbar p-1 -m-1",children:qr.map(ts=>{const Yr=Tr[`${ts.id}-${or}`],hs=Yr?getCaptureStatus(Yr)!=="not-started":!1;let ys;if(Yr){const{photos:_s,additionalPhotos:Ss}=Yr,vs=_s.front||_s.left||_s.right||_s.back||Ss[0];ys=(vs==null?void 0:vs.thumbnail)||(vs==null?void 0:vs.uri)}return jsxRuntimeExports.jsx(SceneThumbnailSlot,{sceneNumber:ts.sceneNumber,hasCaptured:hs,isActive:ts.id===ar,onClick:()=>Sr(ts.id),thumbnailUrl:ys},ts.id)})})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"ADDITIONAL PHOTOS"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-light",children:[Ar.additionalPhotos.length," photos"]})]}),jsxRuntimeExports.jsx(AdditionalPhotosGrid,{photos:Ar.additionalPhotos,onCapture:()=>ss("additional"),onView:gs})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"QUICK FLAGS"}),jsxRuntimeExports.jsx(QuickFlags,{flags:Ar.continuityFlags,onToggle:ts=>Er(Wr,ts)})]}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx(ContinuityEvents,{events:Ar.continuityEvents,onAddEvent:()=>Ur(!0),onRemoveEvent:ts=>gr(Wr,ts)})}),jsxRuntimeExports.jsx(Accordion,{title:"MAKEUP",count:kr?countFilledFields(kr.makeup):0,children:jsxRuntimeExports.jsx(MakeupForm,{makeup:kr==null?void 0:kr.makeup,onChange:kr?ts=>Rr(kr.id,{makeup:ts}):void 0})}),jsxRuntimeExports.jsx(Accordion,{title:"HAIR",count:kr?countHairFields(kr.hair):0,children:jsxRuntimeExports.jsx(HairForm,{hair:kr==null?void 0:kr.hair,onChange:kr?ts=>Rr(kr.id,{hair:ts}):void 0})}),jsxRuntimeExports.jsx(Accordion,{title:"SPECIAL EFFECTS",count:countSFXFields(Ar.sfxDetails),badge:Ar.sfxDetails.sfxRequired?void 0:"None",children:jsxRuntimeExports.jsx(SFXForm,{sfx:Ar.sfxDetails,onChange:ns,onCapturePhoto:()=>ss("additional",!1,!0),onRemovePhoto:ts=>_r(Wr,ts)})}),jsxRuntimeExports.jsx(Accordion,{title:"SCENE NOTES",children:jsxRuntimeExports.jsx(NotesForm,{notes:Ar.notes,onChange:ts=>mr(Wr,{notes:ts})})}),jsxRuntimeExports.jsxs("div",{className:"card flex items-center gap-3.5",children:[jsxRuntimeExports.jsx("label",{className:"field-label whitespace-nowrap",children:"APPLICATION TIME"}),jsxRuntimeExports.jsx("input",{type:"number",value:Ar.applicationTime??(kr==null?void 0:kr.estimatedTime)??"",onChange:ts=>mr(Wr,{applicationTime:ts.target.value?parseInt(ts.target.value,10):void 0}),className:"input-field w-16 text-center font-semibold",placeholder:"--",min:"0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2.5 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:fs,disabled:Cr.isComplete,children:Cr.isComplete?"Scene Completed":"Mark Scene Complete"}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"lg",fullWidth:!0,onClick:bs,children:"Copy to Next Scene"})]})]}),jsxRuntimeExports.jsx(PhotoCapture,{isOpen:Or,onClose:()=>Lr(!1),onCapture:ds,angle:Fr,characterName:Nr.name,sceneNumber:Cr.sceneNumber,lookName:kr==null?void 0:kr.name}),jsxRuntimeExports.jsx(AddEventModal,{isOpen:os,onClose:()=>Ur(!1),onAdd:Es}),jsxRuntimeExports.jsx(PhotoViewer,{isOpen:Vr,photos:Ir,initialIndex:Pr,onClose:()=>es(!1),onDelete:as})]})}function formatSluglineShort(ar){return ar.replace(/^(INT\.|EXT\.)\s*/i,"").replace(/\s*-\s*(DAY|NIGHT|MORNING|EVENING|CONTINUOUS)\s*$/i,"").split(" - ")[0]}function SceneView({sceneId:ar,onBack:or}){const{currentProject:lr,currentCharacterId:cr,setCurrentCharacter:ur,getScene:dr,getCharacter:hr,addCharacterToScene:pr}=useProjectStore(),mr=dr(ar),[fr,xr]=reactExports.useState(!1),[Er,vr]=reactExports.useState(!1);reactExports.useEffect(()=>{mr&&mr.characters.length>0&&!cr&&ur(mr.characters[0])},[mr,cr,ur]);const gr=reactExports.useMemo(()=>!mr||!cr?!0:mr.characters.includes(cr),[mr,cr]),yr=cr?hr(cr):null,br=reactExports.useCallback(()=>{mr&&cr&&pr(mr.id,cr)},[mr,cr,pr]),_r=reactExports.useCallback(()=>{!gr&&cr?vr(!0):or()},[gr,cr,or]);if(!mr||!lr)return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-text-muted",children:"Scene not found"}),jsxRuntimeExports.jsx(Button,{variant:"ghost",onClick:or,className:"mt-2",children:"Go Back"})]})});const jr=reactExports.useMemo(()=>mr.characters.map(wr=>hr(wr)).filter(Boolean),[mr.characters,hr]);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx(Header,{title:`Scene ${mr.sceneNumber}`,showBack:!0,onBack:_r}),!gr&&yr&&jsxRuntimeExports.jsx("div",{className:"bg-amber-50 border-b border-amber-200 px-4 py-3",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium text-amber-800",children:[yr.name," is not in the breakdown"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-600 mt-0.5",children:"Add them to track continuity for this scene"})]}),jsxRuntimeExports.jsx("button",{onClick:br,className:"flex-shrink-0 px-3 py-1.5 rounded-lg bg-amber-600 text-white text-xs font-semibold active:scale-95 transition-transform",children:"Add to Breakdown"})]})})}),jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border px-4 py-3",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold text-text-primary mb-2",children:mr.slugline}),mr.synopsis?jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mb-3",children:mr.synopsis}):jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted italic mb-3",children:"No synopsis available. Sync from desktop or tap to add."}),mr.scriptContent&&jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:()=>xr(!0),children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"View Full Scene"]})]})}),jr.length>0&&jsxRuntimeExports.jsx("div",{className:"bg-card border-b border-border overflow-x-auto hide-scrollbar",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"flex gap-2 px-4 py-3",children:jr.map(wr=>jsxRuntimeExports.jsx("button",{onClick:()=>ur(wr.id),className:clsx("flex-shrink-0 px-4 py-2 rounded-pill text-sm font-medium transition-colors touch-manipulation",{"gold-gradient text-white":cr===wr.id,"bg-gray-100 text-text-secondary hover:bg-gray-200":cr!==wr.id}),children:wr.name},wr.id))})})}),cr&&jsxRuntimeExports.jsx(CharacterProfile,{sceneId:ar,characterId:cr}),Er&&yr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:()=>vr(!1),children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-t-2xl overflow-hidden animate-slideUp",onClick:wr=>wr.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"p-5",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM3 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 019.374 21c-2.331 0-4.512-.645-6.374-1.766z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Add ",yr.name," to Breakdown?"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"This character hasn't been added to the scene breakdown yet"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-5 pb-5 flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{vr(!1),or()},className:"flex-1 py-2.5 rounded-button border border-border text-text-muted text-sm font-medium",children:"Leave Without Adding"}),jsxRuntimeExports.jsx("button",{onClick:()=>{br(),vr(!1),or()},className:"flex-1 py-2.5 rounded-button gold-gradient text-white text-sm font-medium",children:"Add to Breakdown"})]})]})}),fr&&mr.scriptContent&&jsxRuntimeExports.jsx(FullScriptModal,{content:mr.scriptContent,sceneNumber:mr.sceneNumber,onClose:()=>xr(!1)})]})}function FullScriptModal({content:ar,sceneNumber:or,onClose:lr}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col bg-card animate-slideUp",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-text-primary",children:["Scene ",or]}),jsxRuntimeExports.jsx("button",{onClick:lr,className:"p-2 -m-2 text-text-muted hover:text-text-primary tap-target touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-text-primary leading-relaxed",children:ar})})]})})}function SceneScriptModal({scene:ar,onClose:or}){return reactExports.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),reactExports.useEffect(()=>{const lr=cr=>{cr.key==="Escape"&&or()};return document.addEventListener("keydown",lr),()=>document.removeEventListener("keydown",lr)},[or]),jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",onClick:or,children:jsxRuntimeExports.jsxs("div",{className:"h-full flex flex-col bg-card animate-slideUp",onClick:lr=>lr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border safe-top",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[jsxRuntimeExports.jsxs("h2",{className:"font-semibold text-text-primary",children:["Scene ",ar.sceneNumber]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted truncate",children:ar.slugline})]}),jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -m-2 text-text-muted hover:text-text-primary tap-target touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-border/50 bg-gray-50",children:[jsxRuntimeExports.jsx("span",{className:clsx("px-2 py-0.5 text-xs font-bold rounded",ar.intExt==="INT"?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"),children:ar.intExt}),jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-gray-200 text-text-secondary",children:ar.timeOfDay}),ar.filmingStatus&&jsxRuntimeExports.jsx("span",{className:clsx("px-2 py-0.5 text-xs font-medium rounded",ar.filmingStatus==="complete"?"bg-green-100 text-green-700":ar.filmingStatus==="partial"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"),children:ar.filmingStatus==="complete"?"Complete":ar.filmingStatus==="partial"?"Partial":"Incomplete"})]}),ar.synopsis&&jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border/50 bg-gold-100/30",children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-1",children:"SYNOPSIS"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary italic",children:ar.synopsis})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto",children:ar.scriptContent?jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"FULL SCENE"}),jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-text-primary leading-relaxed",children:ar.scriptContent})]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Script Content"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted text-center",children:["Script content is not available for this scene.",!ar.synopsis&&" Upload a script to view full scene content."]})]})}),jsxRuntimeExports.jsx("div",{className:"border-t border-border p-4 safe-bottom bg-card",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-full py-3 rounded-button gold-gradient text-white font-medium active:scale-[0.98] transition-transform",children:"Close"})})]})})}function formatDuration(ar){if(ar<60)return`${ar}m`;const or=Math.floor(ar/60),lr=ar%60;return lr===0?`${or}hr`:`${or}hr ${lr}m`}function splitCombinedSceneNumber(ar){const or=new Set;or.add(ar),ar.split(/[\/]/).map(pr=>pr.trim()).filter(Boolean).forEach(pr=>or.add(pr)),ar.split(/[,]/).map(pr=>pr.trim()).filter(Boolean).forEach(pr=>or.add(pr));const ur=ar.match(/^(\d+[A-Za-z]?)(?:pt|part|PT|PART|-|\s)/i);ur&&or.add(ur[1]);const dr=ar.match(/^(\d+)/);dr&&dr[1]!==ar&&or.add(dr[1]);const hr=[...or];for(const pr of hr){const mr=pr.match(/^(\d+)[A-Za-z]$/);mr&&or.add(mr[1])}return[...or]}function formatSyncTime(ar){const or=Math.floor((Date.now()-ar.getTime())/1e3);if(or<10)return"just now";if(or<60)return`${or}s ago`;const lr=Math.floor(or/60);if(lr<60)return`${lr}m ago`;const cr=Math.floor(lr/60);return cr<24?`${cr}h ago`:"over a day ago"}function Today({onSceneSelect:ar,onNavigateToTab:or}){var ts;const{currentProject:lr,updateSceneFilmingStatus:cr,addScene:ur,addCharacterToScene:dr,addCharacterFromScene:hr,setCurrentCharacter:pr}=useProjectStore(),mr=useSyncStore(Yr=>Yr.status),fr=useSyncStore(Yr=>Yr.lastSyncedAt),xr=useCallSheetStore(Yr=>Yr.callSheets),Er=useCallSheetStore(Yr=>Yr.activeCallSheetId),vr=useCallSheetStore(Yr=>Yr.getCallSheetByDate),gr=useCallSheetStore(Yr=>Yr.uploadCallSheet),yr=useCallSheetStore(Yr=>Yr.isUploading),br=useCallSheetStore(Yr=>Yr.uploadError),_r=useCallSheetStore(Yr=>Yr.updateSceneStatus),[jr,wr]=reactExports.useState(new Date),[Sr,Tr]=reactExports.useState(!1),[Rr,Nr]=reactExports.useState(!1),[Cr,kr]=reactExports.useState(new Map),Ar=reactExports.useMemo(()=>{const Yr=jr.toISOString().split("T")[0];return vr(Yr)},[jr,vr,xr]),Or=reactExports.useMemo(()=>Er?xr.find(Yr=>Yr.id===Er)||null:[...xr].sort((hs,ys)=>new Date(ys.date).getTime()-new Date(hs.date).getTime())[0]||null,[xr,Er]),Lr=Ar||Or,Fr=reactExports.useMemo(()=>Lr?Cr.size===0?Lr:{...Lr,scenes:Lr.scenes.map(Yr=>{const hs=Cr.get(Yr.sceneNumber);return hs?{...Yr,...hs}:Yr})}:null,[Lr,Cr]);reactExports.useEffect(()=>{kr(new Map)},[Lr==null?void 0:Lr.id]),reactExports.useEffect(()=>{Or!=null&&Or.date&&wr(new Date(Or.date))},[Or==null?void 0:Or.id,Or==null?void 0:Or.date]);const[Hr,Kr]=reactExports.useState(null),[Gr,Zr]=reactExports.useState(null),Jr=reactExports.useRef(null),os=async Yr=>{var ys;const hs=(ys=Yr.target.files)==null?void 0:ys[0];if(hs&&hs.type==="application/pdf")try{await gr(hs)}catch(_s){console.error("Failed to upload call sheet:",_s)}Jr.current&&(Jr.current.value="")},Ur=Yr=>{const hs=new Date(jr);hs.setDate(hs.getDate()+Yr),wr(hs),kr(new Map)},Vr=reactExports.useMemo(()=>{if(!Fr)return[];if(Sr)return[...Fr.scenes].sort((hs,ys)=>hs.shootOrder-ys.shootOrder);const Yr={"in-progress":0,upcoming:1,wrapped:2};return[...Fr.scenes].sort((hs,ys)=>{const _s=Yr[hs.status]-Yr[ys.status];return _s!==0?_s:hs.shootOrder-ys.shootOrder})},[Fr,Sr]),es=(Yr,hs)=>{if(!Fr)return;const ys=[...Fr.scenes].sort((na,Js)=>na.shootOrder-Js.shootOrder),_s=ys.findIndex(na=>na.sceneNumber===Yr);if(_s===-1||hs==="up"&&_s===0||hs==="down"&&_s===ys.length-1)return;const Ss=hs==="up"?_s-1:_s+1,vs=ys[_s].shootOrder,Hs=ys[Ss].shootOrder,Bs=ys[Ss].sceneNumber;kr(na=>{const Js=new Map(na),$a=Js.get(Yr)||{},Vs=Js.get(Bs)||{};return Js.set(Yr,{...$a,shootOrder:Hs}),Js.set(Bs,{...Vs,shootOrder:vs}),Js})},Ir=reactExports.useMemo(()=>lr?new Map(lr.scenes.map(Yr=>[Yr.sceneNumber,Yr])):new Map,[lr==null?void 0:lr.scenes]),Dr=reactExports.useMemo(()=>lr?new Map(lr.characters.map(Yr=>[Yr.id,Yr])):new Map,[lr==null?void 0:lr.characters]),Pr=reactExports.useMemo(()=>{if(!lr)return new Map;const Yr=new Map;for(const hs of lr.scenes){const ys=hs.characters.map(_s=>Dr.get(_s)).filter(_s=>_s!==void 0);Yr.set(hs.sceneNumber,ys)}return Yr},[lr==null?void 0:lr.scenes,Dr]),Mr=reactExports.useMemo(()=>{if(!lr)return new Map;const Yr=new Map;for(const hs of lr.looks)for(const ys of hs.scenes)Yr.set(`${hs.characterId}-${ys}`,hs);return Yr},[lr==null?void 0:lr.looks]),Br=reactExports.useMemo(()=>{if(!lr)return new Map;const Yr=new Map;for(const hs of lr.looks){const ys=Dr.get(hs.characterId);if(ys!=null&&ys.actorNumber)for(const _s of hs.scenes)Yr.set(`${ys.actorNumber}-${_s}`,hs)}return Yr},[lr==null?void 0:lr.looks,Dr]),Xr=reactExports.useMemo(()=>Fr!=null&&Fr.castCalls?new Map(Fr.castCalls.map(Yr=>[Yr.id,Yr])):new Map,[Fr==null?void 0:Fr.castCalls]),Wr=reactExports.useMemo(()=>{if(!Fr)return new Map;const Yr=new Map;for(const hs of Fr.scenes){if(!hs.cast||hs.cast.length===0)continue;const ys=[];for(const _s of hs.cast){const Ss=Xr.get(_s);if(Ss){const vs=Ss.character||Ss.name||`Cast #${_s}`,Hs=vs.split(" ").map(Bs=>Bs.charAt(0).toUpperCase()).join("").slice(0,2);ys.push({id:`cast-${_s}`,name:vs,initials:Hs,actorNumber:parseInt(_s,10)||void 0})}else ys.push({id:`cast-${_s}`,name:`Cast #${_s}`,initials:_s.slice(0,2),actorNumber:parseInt(_s,10)||void 0})}Yr.set(hs.sceneNumber,ys)}return Yr},[Fr==null?void 0:Fr.scenes,Xr]),ss=Yr=>{const hs=Ir.get(Yr);if(hs)return hs;const ys=splitCombinedSceneNumber(Yr);for(const _s of ys){const Ss=Ir.get(_s);if(Ss)return Ss}},ds=Yr=>{if(!lr||!Yr)return;const hs=Yr.toUpperCase().trim(),ys=lr.characters.find(Hs=>Hs.name.toUpperCase().trim()===hs);if(ys)return ys;const _s=lr.characters.find(Hs=>Hs.name.toUpperCase().trim().split(" ")[0]===hs);if(_s)return _s;const Ss=lr.characters.find(Hs=>Hs.name.toUpperCase().trim().startsWith(hs+" "));if(Ss)return Ss;const vs=lr.characters.find(Hs=>{const Bs=Hs.name.toUpperCase().trim().split(" ")[0];return hs.includes(Bs)&&Bs.length>2});if(vs)return vs},ns=Yr=>{const hs=Pr.get(Yr)||[];if(hs.length>0)return hs;const ys=splitCombinedSceneNumber(Yr);for(const Ss of ys){const vs=Pr.get(Ss)||[];if(vs.length>0)return vs}const _s=Wr.get(Yr)||[];return _s.length>0?_s.map(Ss=>{const vs=ds(Ss.name);return vs?{...vs,actorNumber:Ss.actorNumber}:Ss}):[]},fs=(Yr,hs,ys)=>{const _s=splitCombinedSceneNumber(hs);for(const Ss of _s){const vs=Mr.get(`${Yr}-${Ss}`);if(vs)return vs}if(ys)for(const Ss of _s){const vs=Br.get(`${ys}-${Ss}`);if(vs)return vs}if(lr&&!Yr.startsWith("cast-"))return lr.looks.find(Ss=>Ss.characterId===Yr)},bs=reactExports.useMemo(()=>Fr!=null&&Fr.castCalls?Fr.castCalls.filter(Yr=>Yr.hmuCall||Yr.makeupCall).sort((Yr,hs)=>{const ys=Yr.hmuCall||Yr.makeupCall||"",_s=hs.hmuCall||hs.makeupCall||"";return ys.localeCompare(_s)}):[],[Fr==null?void 0:Fr.castCalls]),Es=reactExports.useMemo(()=>{if(!(Fr!=null&&Fr.scenes)||!Fr.firstShotTime)return null;const Yr=Vs=>{const xa=Vs.match(/(\d{1,2}):(\d{2})/);return xa?parseInt(xa[1],10)*60+parseInt(xa[2],10):null},hs=[...Fr.scenes].sort((Vs,xa)=>Vs.shootOrder-xa.shootOrder),ys=hs.filter(Vs=>Vs.status==="wrapped"&&Vs.completedAt);if(ys.length===0)return{status:"not-started",completedCount:0,totalCount:Fr.scenes.length};const _s=ys[ys.length-1];let Ss=null;if(_s.estimatedTime){const Vs=_s.estimatedTime.match(/-\s*(\d{1,2}:\d{2})/);Vs&&(Ss=Yr(Vs[1]))}const vs=new Date(_s.completedAt),Hs=vs.getHours()*60+vs.getMinutes();if(Ss!==null&&Hs<Ss-2)return{status:"ahead",diffMinutes:Ss-Hs,completedCount:ys.length,totalCount:Fr.scenes.length};const Bs=hs.find(Vs=>Vs.status!=="wrapped");if(!Bs)return{status:"completed",completedCount:ys.length,totalCount:Fr.scenes.length};let na=null;if(Bs.estimatedTime){const Vs=Bs.estimatedTime.match(/^(\d{1,2}:\d{2})/);Vs&&(na=Yr(Vs[1]))}if(na===null)return{status:"unknown",completedCount:ys.length,totalCount:Fr.scenes.length};const Js=new Date,$a=Js.getHours()*60+Js.getMinutes();return $a>na+2?{status:"behind",diffMinutes:$a-na,completedCount:ys.length,totalCount:Fr.scenes.length}:{status:"on-track",completedCount:ys.length,totalCount:Fr.scenes.length}},[Fr==null?void 0:Fr.scenes,Fr==null?void 0:Fr.firstShotTime]),Ds=(Yr,hs)=>{Lr&&(kr(ys=>{const _s=new Map(ys),Ss=_s.get(Yr)||{};return _s.set(Yr,{...Ss,status:hs}),_s}),_r(Lr.id,Yr,hs))},gs=(Yr,hs,ys)=>{Lr&&(kr(_s=>{const Ss=new Map(_s),vs=Ss.get(Yr)||{};return Ss.set(Yr,{...vs,status:"wrapped"}),Ss}),_r(Lr.id,Yr,"wrapped"),cr(Yr,hs,ys))},as=Yr=>{const hs=ss(Yr);hs&&ar(hs.id)},qr=(Yr,hs,ys)=>{const _s=Yr.id.startsWith("cast-"),Ss=ss(hs);if(Ss){if(_s){const Hs=hr(Ss.id,Yr.name);if(Yr.actorNumber){const Bs=useProjectStore.getState();if(Bs.currentProject){const na=Bs.currentProject.characters.map(Js=>Js.id===Hs.id?{...Js,actorNumber:Yr.actorNumber}:Js);useProjectStore.setState({currentProject:{...Bs.currentProject,characters:na}})}}dr(Ss.id,Hs.id),pr(Hs.id)}else pr(Yr.id);ar(Ss.id);return}const vs=[];if(lr){const Hs=splitCombinedSceneNumber(hs);for(const Bs of lr.scenes){const na=splitCombinedSceneNumber(Bs.sceneNumber);Hs.some($a=>na.some(Vs=>Vs===$a||Vs.startsWith($a)||$a.startsWith(Vs)))&&!vs.includes(Bs)&&vs.push(Bs)}}if(_s){let Hs=Yr;if(lr){const Bs=ds(Yr.name);Bs&&(Hs=Bs)}Zr({sceneNumber:hs,character:Hs,callSheetScene:ys,suggestedMergeScenes:vs});return}Zr({sceneNumber:hs,character:Yr,callSheetScene:ys,suggestedMergeScenes:vs})};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("input",{ref:Jr,type:"file",accept:".pdf",onChange:os,className:"hidden"}),jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ur(-1),className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:formatShortDate(jr)}),jsxRuntimeExports.jsx("button",{onClick:()=>Ur(1),className:"p-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{var Yr;return(Yr=Jr.current)==null?void 0:Yr.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:yr,title:"Upload call sheet",children:yr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),Fr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>Tr(!Sr),className:clsx("p-2 rounded-lg transition-colors touch-manipulation",Sr?"bg-gold text-white":"text-text-muted hover:text-gold"),title:Sr?"Done reordering":"Reorder scenes",children:Sr?jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})}),jsxRuntimeExports.jsxs("button",{onClick:()=>or==null?void 0:or("callsheets"),className:"flex items-center gap-1.5 px-2.5 py-1 text-xs font-semibold rounded-full bg-gold-100 text-gold active:bg-gold-200 transition-colors",title:"View call sheet PDF",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Day ",Fr.productionDay]})]})]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 space-y-4",children:[fr&&jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between px-1",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${mr==="synced"?"bg-success":mr==="syncing"?"bg-warning animate-pulse":mr==="error"?"bg-destructive":"bg-gray-400"}`}),jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted",children:mr==="syncing"?"Syncing...":mr==="error"?"Sync error":mr==="synced"?`Synced ${formatSyncTime(fr)}`:"Offline"})]})}),br&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:br})}),Fr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between mb-3",children:jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"CALL TIMES"})}),(()=>{const Yr=parseDayTypeFromString(Fr.dayType);return jsxRuntimeExports.jsxs("div",{className:"mb-3 pb-3 border-b border-border/50 flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:clsx("px-2 py-0.5 text-xs font-bold rounded",Yr==="CWD"&&"bg-amber-100 text-amber-700",Yr==="SCWD"&&"bg-orange-100 text-orange-700",Yr==="SWD"&&"bg-blue-100 text-blue-700"),children:Yr}),Es&&(Es.status==="ahead"||Es.status==="behind")&&jsxRuntimeExports.jsxs("div",{className:clsx("flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-medium",Es.status==="ahead"&&"bg-blue-50 text-blue-600",Es.status==="behind"&&"bg-red-50 text-red-600"),children:[Es.status==="ahead"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 10l7-7m0 0l7 7m-7-7v18"})}),jsxRuntimeExports.jsxs("span",{children:[formatDuration(Es.diffMinutes)," ahead"]})]}),Es.status==="behind"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}),jsxRuntimeExports.jsxs("span",{children:[formatDuration(Es.diffMinutes)," behind"]})]})]})]})})(),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Unit Call"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Fr.unitCallTime})]}),((ts=Fr.preCalls)==null?void 0:ts.hmu)&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"HMU Pre-call"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-gold",children:Fr.preCalls.hmu})]}),Fr.firstShotTime&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"First Shot"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Fr.firstShotTime})]}),Fr.lunchTime&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Lunch"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Fr.lunchTime})]}),Fr.cameraWrapEstimate&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Camera Wrap"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Fr.cameraWrapEstimate})]}),Fr.wrapEstimate&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Est. Wrap"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Fr.wrapEstimate})]})]})]}),bs.length>0&&jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Nr(!Rr),className:"w-full flex items-center justify-between touch-manipulation",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"HMU CALLS"}),jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-semibold rounded-full bg-gold-100 text-gold",children:bs.length})]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 text-text-muted transition-transform",Rr&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),Rr&&jsxRuntimeExports.jsx("div",{className:"space-y-2 mt-3 pt-3 border-t border-border/30",children:bs.map(Yr=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-border/30 last:border-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary truncate block",children:Yr.character}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate block",children:Yr.name})]}),jsxRuntimeExports.jsxs("div",{className:"text-right ml-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-gold",children:Yr.hmuCall||Yr.makeupCall}),Yr.onSetTime&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:["On set: ",Yr.onSetTime]})]})]},Yr.id))})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between",children:jsxRuntimeExports.jsxs("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:["TODAY'S SCENES (",Vr.length,")"]})}),Sr&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Drag to reorder shooting schedule"}),jsxRuntimeExports.jsx("button",{onClick:()=>Tr(!1),className:"text-sm font-medium text-gold",children:"Done"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2.5",children:Vr.map((Yr,hs)=>{const ys=ss(Yr.sceneNumber),_s=ns(Yr.sceneNumber);return jsxRuntimeExports.jsx(TodaySceneCard,{shootingScene:Yr,scene:ys,characters:_s,getLookForCharacter:fs,onTap:()=>as(Yr.sceneNumber),onCharacterTap:Ss=>qr(Ss,Yr.sceneNumber,Yr),onSynopsisClick:Ss=>Kr(Ss),onStatusChange:Ss=>Ds(Yr.sceneNumber,Ss),onFilmingStatusChange:(Ss,vs)=>gs(Yr.sceneNumber,Ss,vs),isReorderMode:Sr,isFirst:hs===0,isLast:hs===Vr.length-1,onMoveUp:()=>es(Yr.sceneNumber,"up"),onMoveDown:()=>es(Yr.sceneNumber,"down")},Yr.sceneNumber)})})]}):jsxRuntimeExports.jsx(EmptyState$2,{hasAnyCallSheets:xr.length>0,onUploadClick:()=>{var Yr;return(Yr=Jr.current)==null?void 0:Yr.click()},isUploading:yr,isSyncing:mr==="syncing"||mr==="idle",hasProjectData:!!lr&&lr.scenes.length>0})]}),Hr&&jsxRuntimeExports.jsx(SceneScriptModal,{scene:Hr,onClose:()=>Kr(null)}),Gr&&jsxRuntimeExports.jsx(UnmatchedSceneModal,{info:Gr,onClose:()=>Zr(null),onAddScene:Yr=>{const hs=ur(Yr);dr(hs.id,Gr.character.id),Zr(null),ar(hs.id)},onMergeWithScene:Yr=>{Yr.characters.includes(Gr.character.id)||dr(Yr.id,Gr.character.id),Zr(null),ar(Yr.id)}})]})}const TodaySceneCard=reactExports.memo(function ar({shootingScene:or,scene:lr,characters:cr,getLookForCharacter:ur,onTap:dr,onCharacterTap:hr,onSynopsisClick:pr,onStatusChange:mr,onFilmingStatusChange:fr,isReorderMode:xr=!1,isFirst:Er=!1,isLast:vr=!1,onMoveUp:gr,onMoveDown:yr}){const[br,_r]=reactExports.useState(!1),[jr,wr]=reactExports.useState(!1),[Sr,Tr]=reactExports.useState(!1),[Rr,Nr]=reactExports.useState((lr==null?void 0:lr.filmingNotes)||""),Cr=reactExports.useRef(null);reactExports.useEffect(()=>{const Ur=Vr=>{Cr.current&&!Cr.current.contains(Vr.target)&&Tr(!1)};return document.addEventListener("mousedown",Ur),()=>document.removeEventListener("mousedown",Ur)},[]);const kr=reactExports.useMemo(()=>{if(lr)return null;const Ur=or.setDescription||"",Vr=Ur.match(/^(INT|EXT)\./i),es=Ur.match(/- (DAY|NIGHT|MORNING|EVENING|DUSK|DAWN|CONTINUOUS)$/i),Ir=Ur.match(/^(?:INT|EXT)\.\s*(.+?)(?:\s*-\s*(?:DAY|NIGHT|MORNING|EVENING|DUSK|DAWN|CONTINUOUS))?$/i);return{intExt:Vr?Vr[1].toUpperCase():null,timeOfDay:es?es[1].toUpperCase():null,location:Ir?Ir[1].trim():Ur}},[lr,or.setDescription]),Ar=lr==null?void 0:lr.filmingStatus,Or=lr==null?void 0:lr.filmingNotes,Fr=(()=>{if(!Ar)return null;switch(Ar){case"complete":return"scene-glass-complete";case"partial":return"scene-glass-partial";case"not-filmed":return"scene-glass-incomplete";default:return null}})(),Hr={upcoming:"Upcoming","in-progress":"In Progress",wrapped:"Wrapped"},Gr=(()=>{if(Ar){const Vr=SCENE_FILMING_STATUS_CONFIG[Ar];return{bg:Vr.bgClass,text:Vr.textClass,label:Vr.shortLabel,color:Vr.color}}return{...{upcoming:{bg:"bg-gray-100",text:"text-text-muted",color:"#6b7280"},"in-progress":{bg:"bg-gold-100/50",text:"text-gold",color:"#C9A962"},wrapped:{bg:"bg-green-50",text:"text-green-600",color:"#22c55e"}}[or.status],label:Hr[or.status]}})(),Zr=()=>{_r(!0)},Jr=Ur=>{Ur==="not-filmed"||Ur==="partial"?(wr(!0),Tr(!1)):(fr(Ur),Tr(!1))},os=Ur=>{fr(Ur,Rr),wr(!1),_r(!1)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:clsx("relative",Sr&&"z-40"),children:[xr&&jsxRuntimeExports.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 z-20 flex flex-col gap-1",children:[jsxRuntimeExports.jsx("button",{onClick:Ur=>{Ur.stopPropagation(),gr==null||gr()},disabled:Er,className:clsx("p-2 rounded-lg transition-all touch-manipulation",Er?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-gold hover:bg-gold/10 active:scale-95"),children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),jsxRuntimeExports.jsx("button",{onClick:Ur=>{Ur.stopPropagation(),yr==null||yr()},disabled:vr,className:clsx("p-2 rounded-lg transition-all touch-manipulation",vr?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-gold hover:bg-gold/10 active:scale-95"),children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]}),jsxRuntimeExports.jsxs("div",{onClick:xr?void 0:dr,onContextMenu:Ur=>{xr||(Ur.preventDefault(),Zr())},className:clsx("w-full text-left card transition-all relative",!Sr&&"overflow-hidden",xr?"pr-16":"active:scale-[0.98] cursor-pointer"),children:[Fr&&jsxRuntimeExports.jsx("div",{className:clsx("scene-glass-overlay",Fr)}),jsxRuntimeExports.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 rounded-l-card",style:{background:or.status==="in-progress"?"linear-gradient(180deg, #d4a853 0%, #c9a962 100%)":or.status==="wrapped"?Ar==="complete"?"linear-gradient(180deg, #10b981 0%, #059669 100%)":Ar==="partial"?"linear-gradient(180deg, #d4a853 0%, #c9a962 100%)":Ar==="not-filmed"?"linear-gradient(180deg, #f87171 0%, #ef4444 100%)":"linear-gradient(180deg, #d1d5db 0%, #9ca3af 100%)":"transparent"}}),jsxRuntimeExports.jsxs("div",{className:"relative z-10 pl-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xl font-bold text-text-primary",children:or.sceneNumber}),jsxRuntimeExports.jsxs("div",{ref:Cr,className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:Ur=>{Ur.stopPropagation(),Tr(!Sr)},className:"status-dropdown-btn touch-manipulation",style:{borderColor:Ar?Gr.color:void 0},children:[jsxRuntimeExports.jsx("span",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:Gr.color}}),jsxRuntimeExports.jsx("span",{className:Gr.text,children:Gr.label}),jsxRuntimeExports.jsx("svg",{className:clsx("w-3 h-3 text-text-muted transition-transform",Sr&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),Sr&&jsxRuntimeExports.jsx("div",{className:"absolute right-0 top-full mt-1 w-44 bg-card border border-border rounded-lg shadow-lg z-50 overflow-hidden animate-fadeIn",children:["complete","partial","not-filmed"].map(Ur=>{const Vr=SCENE_FILMING_STATUS_CONFIG[Ur],es=Ar===Ur;return jsxRuntimeExports.jsxs("button",{onClick:Ir=>{Ir.stopPropagation(),Jr(Ur)},className:clsx("w-full px-3 py-2.5 text-left text-sm flex items-center gap-2.5 transition-colors",es?Vr.bgClass:"hover:bg-gray-50"),children:[jsxRuntimeExports.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Vr.color}}),jsxRuntimeExports.jsx("span",{className:clsx("font-medium",es&&Vr.textClass),children:Vr.label}),es&&jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 ml-auto",Vr.textClass),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},Ur)})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5 mb-2 flex-wrap",children:[((lr==null?void 0:lr.intExt)||(kr==null?void 0:kr.intExt))&&jsxRuntimeExports.jsx("span",{className:`px-1.5 py-0.5 text-[10px] font-bold rounded ${((lr==null?void 0:lr.intExt)||(kr==null?void 0:kr.intExt))==="INT"?"bg-slate-100 text-slate-600":"bg-stone-100 text-stone-600"}`,children:(lr==null?void 0:lr.intExt)||(kr==null?void 0:kr.intExt)}),or.dayNight&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-100 text-amber-700",children:or.dayNight}),or.pages&&jsxRuntimeExports.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-gray-100 text-text-muted",children:[or.pages," pgs"]}),or.estimatedTime&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-blue-50 text-blue-600",children:or.estimatedTime})]}),or.setDescription&&jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:or.setDescription}),(or.action||(lr==null?void 0:lr.synopsis))&&jsxRuntimeExports.jsxs("button",{onClick:Ur=>{Ur.stopPropagation(),lr&&pr(lr)},className:"w-full text-left group",disabled:!(lr!=null&&lr.scriptContent),children:[jsxRuntimeExports.jsx("p",{className:clsx("text-xs text-text-muted italic line-clamp-2",(lr==null?void 0:lr.scriptContent)&&"group-hover:text-gold transition-colors"),children:or.action||(lr==null?void 0:lr.synopsis)}),(lr==null?void 0:lr.scriptContent)&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-gold flex items-center gap-1 mt-0.5",children:[jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Tap to view full scene"]})]}),or.notes&&jsxRuntimeExports.jsx("div",{className:"mt-2 px-2.5 py-2 rounded-lg bg-gold-50 border border-gold-100",children:jsxRuntimeExports.jsx("div",{className:"text-xs text-gold-700 font-medium leading-relaxed",children:or.notes})}),Ar&&Ar!=="complete"&&Or&&jsxRuntimeExports.jsxs("div",{className:clsx("mt-2 px-2.5 py-2 rounded-lg text-xs",Ar==="partial"?"bg-amber-50 text-amber-700 border border-amber-100":"bg-red-50 text-red-700 border border-red-100"),children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Note:"})," ",Or]}),cr.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2.5 pt-2 border-t border-border/50",children:cr.map(Ur=>{const Vr=ur(Ur.id,or.sceneNumber,Ur.actorNumber),es=Ur.avatarColour??"#C9A962";return jsxRuntimeExports.jsxs("button",{onClick:Ir=>{Ir.stopPropagation(),hr(Ur)},className:"flex items-center gap-1 rounded-full pl-0.5 pr-2 py-0.5 transition-colors bg-gray-50 hover:bg-gold/10 active:bg-gold/20 cursor-pointer",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold text-white flex-shrink-0",style:{backgroundColor:es},children:Ur.actorNumber||Ur.initials}),jsxRuntimeExports.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:Ur.name.split(" ")[0]}),Vr&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-gold",children:[" ",Vr.name]})]},Ur.id)})})]})]})]}),br&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-4",onClick:()=>_r(!1),children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl overflow-hidden",onClick:Ur=>Ur.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"p-4 border-b border-border",children:jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Scene ",or.sceneNumber]})}),jsxRuntimeExports.jsxs("div",{className:"py-2",children:[or.status!=="in-progress"&&jsxRuntimeExports.jsxs("button",{onClick:()=>{mr("in-progress"),_r(!1)},className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"})}),"Mark In Progress"]}),jsxRuntimeExports.jsxs("div",{className:"border-t border-border mt-2 pt-2",children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-2",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"FILMING STATUS"})}),jsxRuntimeExports.jsxs("button",{onClick:()=>os("complete"),className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-green-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Complete"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Scene fully filmed"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>wr(!0),className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-amber-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Part Complete"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Some shots still needed"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>wr(!0),className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-red-500 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Incomplete"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Scene not filmed"})]})]})]}),or.status!=="upcoming"&&jsxRuntimeExports.jsxs("button",{onClick:()=>{mr("upcoming"),_r(!1)},className:"w-full px-4 py-3 text-left text-sm text-text-muted hover:bg-gray-50 flex items-center gap-3 border-t border-border mt-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})}),"Revert to Upcoming"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>_r(!1),className:"w-full p-4 text-center text-sm font-medium text-gold border-t border-border",children:"Cancel"})]})}),jr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",onClick:()=>wr(!1),children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl overflow-hidden",onClick:Ur=>Ur.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Scene ",or.sceneNumber," - Add Notes"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Why wasn't this scene fully filmed?"})]}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsx("textarea",{value:Rr,onChange:Ur=>Nr(Ur.target.value),placeholder:"e.g., Ran out of time, weather issues, actor unavailable...",rows:3,className:"w-full p-3 border border-border rounded-lg text-sm bg-input-bg text-text-primary resize-none"})}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-border flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>os("partial"),className:"flex-1 py-2.5 rounded-button bg-amber-500 text-white text-sm font-medium",children:"Part Complete"}),jsxRuntimeExports.jsx("button",{onClick:()=>os("not-filmed"),className:"flex-1 py-2.5 rounded-button bg-red-500 text-white text-sm font-medium",children:"Incomplete"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>wr(!1),className:"w-full p-3 text-center text-sm text-text-muted border-t border-border",children:"Cancel"})]})})]})}),EmptyState$2=reactExports.memo(function ar({hasAnyCallSheets:or,onUploadClick:lr,isUploading:cr,isSyncing:ur,hasProjectData:dr}){const hr=ur&&!dr&&!or;return jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:hr?jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182M2.985 19.644l3.181-3.183"}):or?jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"}):jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),hr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"Syncing Project Data"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Waiting for project data from your team. This should only take a moment."}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-gold",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-warning animate-pulse"}),jsxRuntimeExports.jsx("span",{children:"Syncing..."})]})]}):or?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"No Call Sheet for This Date"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload a call sheet for this production day to see today's scenes"}),jsxRuntimeExports.jsx("button",{onClick:lr,disabled:cr,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:cr?"Uploading...":"Upload Call Sheet PDF"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"Upload a Call Sheet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload your first call sheet to see today's scenes and start tracking continuity"}),jsxRuntimeExports.jsx("button",{onClick:lr,disabled:cr,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:cr?"Uploading...":"Upload Call Sheet PDF"})]})]})}),UnmatchedSceneModal=reactExports.memo(function ar({info:or,onClose:lr,onAddScene:cr,onMergeWithScene:ur}){const{sceneNumber:dr,character:hr,callSheetScene:pr,suggestedMergeScenes:mr}=or,fr=()=>{var gr,yr;let xr="INT",Er=pr.setDescription||`Scene ${dr}`;const vr=(gr=pr.setDescription)==null?void 0:gr.match(/^(INT|EXT)\./i);vr&&(xr=vr[1].toUpperCase()),cr({sceneNumber:dr,slugline:Er,intExt:xr,timeOfDay:((yr=pr.dayNight)==null?void 0:yr.toUpperCase())||"DAY",synopsis:pr.action,characters:[hr.id]})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-4",onClick:lr,children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl overflow-hidden animate-slideUp",onClick:xr=>xr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary",children:["Scene ",dr," Not in Breakdown"]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["This scene from the call sheet doesn't exist in your script breakdown. Choose how to handle continuity for ",jsxRuntimeExports.jsx("span",{className:"font-medium text-gold",children:hr.name}),"."]})]}),jsxRuntimeExports.jsxs("div",{className:"py-2",children:[jsxRuntimeExports.jsxs("button",{onClick:fr,className:"w-full px-4 py-3.5 text-left hover:bg-gray-50 flex items-center gap-3 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-gold-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-text-primary block",children:["Add Scene ",dr," to Breakdown"]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Create a new scene and track continuity there"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}),mr.length>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-2 border-t border-border/50 mt-1",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"OR MERGE WITH EXISTING SCENE"})}),mr.map(xr=>jsxRuntimeExports.jsxs("button",{onClick:()=>ur(xr),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-blue-600",children:xr.sceneNumber})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-text-primary block truncate",children:["Merge with Scene ",xr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate block",children:xr.slugline})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},xr.id))]})]}),jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-full p-4 text-center text-sm font-medium text-text-muted border-t border-border hover:bg-gray-50 transition-colors",children:"Cancel"})]})})});/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var XLSX={};XLSX.version="0.18.5";var current_ansi=1252,VALID_ANSI=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],set_ansi=function(ar){VALID_ANSI.indexOf(ar)!=-1&&(current_ansi=ar)};function reset_ansi(){set_ansi(1252)}var set_cp=function(ar){set_ansi(ar)};function reset_cp(){set_cp(1200),reset_ansi()}var _getchar=function ar(or){return String.fromCharCode(or)},_getansi=function ar(or){return String.fromCharCode(or)},$cptable,Base64_map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Base64_encode(ar){for(var or="",lr=0,cr=0,ur=0,dr=0,hr=0,pr=0,mr=0,fr=0;fr<ar.length;)lr=ar.charCodeAt(fr++),dr=lr>>2,cr=ar.charCodeAt(fr++),hr=(lr&3)<<4|cr>>4,ur=ar.charCodeAt(fr++),pr=(cr&15)<<2|ur>>6,mr=ur&63,isNaN(cr)?pr=mr=64:isNaN(ur)&&(mr=64),or+=Base64_map.charAt(dr)+Base64_map.charAt(hr)+Base64_map.charAt(pr)+Base64_map.charAt(mr);return or}function Base64_decode(ar){var or="",lr=0,cr=0,ur=0,dr=0,hr=0,pr=0,mr=0;ar=ar.replace(/[^\w\+\/\=]/g,"");for(var fr=0;fr<ar.length;)dr=Base64_map.indexOf(ar.charAt(fr++)),hr=Base64_map.indexOf(ar.charAt(fr++)),lr=dr<<2|hr>>4,or+=String.fromCharCode(lr),pr=Base64_map.indexOf(ar.charAt(fr++)),cr=(hr&15)<<4|pr>>2,pr!==64&&(or+=String.fromCharCode(cr)),mr=Base64_map.indexOf(ar.charAt(fr++)),ur=(pr&3)<<6|mr,mr!==64&&(or+=String.fromCharCode(ur));return or}var has_buf=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Buffer_from=function(){if(typeof Buffer<"u"){var ar=!Buffer.from;if(!ar)try{Buffer.from("foo","utf8")}catch{ar=!0}return ar?function(or,lr){return lr?new Buffer(or,lr):new Buffer(or)}:Buffer.from.bind(Buffer)}return function(){}}();function new_raw_buf(ar){return has_buf?Buffer.alloc?Buffer.alloc(ar):new Buffer(ar):typeof Uint8Array<"u"?new Uint8Array(ar):new Array(ar)}function new_unsafe_buf(ar){return has_buf?Buffer.allocUnsafe?Buffer.allocUnsafe(ar):new Buffer(ar):typeof Uint8Array<"u"?new Uint8Array(ar):new Array(ar)}var s2a=function ar(or){return has_buf?Buffer_from(or,"binary"):or.split("").map(function(lr){return lr.charCodeAt(0)&255})};function s2ab(ar){if(typeof ArrayBuffer>"u")return s2a(ar);for(var or=new ArrayBuffer(ar.length),lr=new Uint8Array(or),cr=0;cr!=ar.length;++cr)lr[cr]=ar.charCodeAt(cr)&255;return or}function a2s(ar){if(Array.isArray(ar))return ar.map(function(cr){return String.fromCharCode(cr)}).join("");for(var or=[],lr=0;lr<ar.length;++lr)or[lr]=String.fromCharCode(ar[lr]);return or.join("")}function a2u(ar){if(typeof Uint8Array>"u")throw new Error("Unsupported");return new Uint8Array(ar)}var bconcat=has_buf?function(ar){return Buffer.concat(ar.map(function(or){return Buffer.isBuffer(or)?or:Buffer_from(or)}))}:function(ar){if(typeof Uint8Array<"u"){var or=0,lr=0;for(or=0;or<ar.length;++or)lr+=ar[or].length;var cr=new Uint8Array(lr),ur=0;for(or=0,lr=0;or<ar.length;lr+=ur,++or)if(ur=ar[or].length,ar[or]instanceof Uint8Array)cr.set(ar[or],lr);else{if(typeof ar[or]=="string")throw"wtf";cr.set(new Uint8Array(ar[or]),lr)}return cr}return[].concat.apply([],ar.map(function(dr){return Array.isArray(dr)?dr:[].slice.call(dr)}))};function utf8decode(ar){for(var or=[],lr=0,cr=ar.length+250,ur=new_raw_buf(ar.length+255),dr=0;dr<ar.length;++dr){var hr=ar.charCodeAt(dr);if(hr<128)ur[lr++]=hr;else if(hr<2048)ur[lr++]=192|hr>>6&31,ur[lr++]=128|hr&63;else if(hr>=55296&&hr<57344){hr=(hr&1023)+64;var pr=ar.charCodeAt(++dr)&1023;ur[lr++]=240|hr>>8&7,ur[lr++]=128|hr>>2&63,ur[lr++]=128|pr>>6&15|(hr&3)<<4,ur[lr++]=128|pr&63}else ur[lr++]=224|hr>>12&15,ur[lr++]=128|hr>>6&63,ur[lr++]=128|hr&63;lr>cr&&(or.push(ur.slice(0,lr)),lr=0,ur=new_raw_buf(65535),cr=65530)}return or.push(ur.slice(0,lr)),bconcat(or)}var chr0=/\u0000/g,chr1=/[\u0001-\u0006]/g;function _strrev(ar){for(var or="",lr=ar.length-1;lr>=0;)or+=ar.charAt(lr--);return or}function pad0(ar,or){var lr=""+ar;return lr.length>=or?lr:fill("0",or-lr.length)+lr}function pad_(ar,or){var lr=""+ar;return lr.length>=or?lr:fill(" ",or-lr.length)+lr}function rpad_(ar,or){var lr=""+ar;return lr.length>=or?lr:lr+fill(" ",or-lr.length)}function pad0r1(ar,or){var lr=""+Math.round(ar);return lr.length>=or?lr:fill("0",or-lr.length)+lr}function pad0r2(ar,or){var lr=""+ar;return lr.length>=or?lr:fill("0",or-lr.length)+lr}var p2_32=Math.pow(2,32);function pad0r(ar,or){if(ar>p2_32||ar<-p2_32)return pad0r1(ar,or);var lr=Math.round(ar);return pad0r2(lr,or)}function SSF_isgeneral(ar,or){return or=or||0,ar.length>=7+or&&(ar.charCodeAt(or)|32)===103&&(ar.charCodeAt(or+1)|32)===101&&(ar.charCodeAt(or+2)|32)===110&&(ar.charCodeAt(or+3)|32)===101&&(ar.charCodeAt(or+4)|32)===114&&(ar.charCodeAt(or+5)|32)===97&&(ar.charCodeAt(or+6)|32)===108}var days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function SSF_init_table(ar){return ar||(ar={}),ar[0]="General",ar[1]="0",ar[2]="0.00",ar[3]="#,##0",ar[4]="#,##0.00",ar[9]="0%",ar[10]="0.00%",ar[11]="0.00E+00",ar[12]="# ?/?",ar[13]="# ??/??",ar[14]="m/d/yy",ar[15]="d-mmm-yy",ar[16]="d-mmm",ar[17]="mmm-yy",ar[18]="h:mm AM/PM",ar[19]="h:mm:ss AM/PM",ar[20]="h:mm",ar[21]="h:mm:ss",ar[22]="m/d/yy h:mm",ar[37]="#,##0 ;(#,##0)",ar[38]="#,##0 ;[Red](#,##0)",ar[39]="#,##0.00;(#,##0.00)",ar[40]="#,##0.00;[Red](#,##0.00)",ar[45]="mm:ss",ar[46]="[h]:mm:ss",ar[47]="mmss.0",ar[48]="##0.0E+0",ar[49]="@",ar[56]='"/ "hh""mm""ss" "',ar}var table_fmt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "'},SSF_default_map={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},SSF_default_str={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function SSF_frac(ar,or,lr){for(var cr=ar<0?-1:1,ur=ar*cr,dr=0,hr=1,pr=0,mr=1,fr=0,xr=0,Er=Math.floor(ur);fr<or&&(Er=Math.floor(ur),pr=Er*hr+dr,xr=Er*fr+mr,!(ur-Er<5e-8));)ur=1/(ur-Er),dr=hr,hr=pr,mr=fr,fr=xr;if(xr>or&&(fr>or?(xr=mr,pr=dr):(xr=fr,pr=hr)),!lr)return[0,cr*pr,xr];var vr=Math.floor(cr*pr/xr);return[vr,cr*pr-vr*xr,xr]}function SSF_parse_date_code(ar,or,lr){if(ar>2958465||ar<0)return null;var cr=ar|0,ur=Math.floor(86400*(ar-cr)),dr=0,hr=[],pr={D:cr,T:ur,u:86400*(ar-cr)-ur,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(pr.u)<1e-6&&(pr.u=0),or&&or.date1904&&(cr+=1462),pr.u>.9999&&(pr.u=0,++ur==86400&&(pr.T=ur=0,++cr,++pr.D)),cr===60)hr=lr?[1317,10,29]:[1900,2,29],dr=3;else if(cr===0)hr=lr?[1317,8,29]:[1900,1,0],dr=6;else{cr>60&&--cr;var mr=new Date(1900,0,1);mr.setDate(mr.getDate()+cr-1),hr=[mr.getFullYear(),mr.getMonth()+1,mr.getDate()],dr=mr.getDay(),cr<60&&(dr=(dr+6)%7),lr&&(dr=SSF_fix_hijri(mr,hr))}return pr.y=hr[0],pr.m=hr[1],pr.d=hr[2],pr.S=ur%60,ur=Math.floor(ur/60),pr.M=ur%60,ur=Math.floor(ur/60),pr.H=ur,pr.q=dr,pr}var SSFbasedate=new Date(1899,11,31,0,0,0),SSFdnthresh=SSFbasedate.getTime(),SSFbase1904=new Date(1900,2,1,0,0,0);function datenum_local(ar,or){var lr=ar.getTime();return or?lr-=1461*24*60*60*1e3:ar>=SSFbase1904&&(lr+=24*60*60*1e3),(lr-(SSFdnthresh+(ar.getTimezoneOffset()-SSFbasedate.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function SSF_strip_decimal(ar){return ar.indexOf(".")==-1?ar:ar.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function SSF_normalize_exp(ar){return ar.indexOf("E")==-1?ar:ar.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function SSF_small_exp(ar){var or=ar<0?12:11,lr=SSF_strip_decimal(ar.toFixed(12));return lr.length<=or||(lr=ar.toPrecision(10),lr.length<=or)?lr:ar.toExponential(5)}function SSF_large_exp(ar){var or=SSF_strip_decimal(ar.toFixed(11));return or.length>(ar<0?12:11)||or==="0"||or==="-0"?ar.toPrecision(6):or}function SSF_general_num(ar){var or=Math.floor(Math.log(Math.abs(ar))*Math.LOG10E),lr;return or>=-4&&or<=-1?lr=ar.toPrecision(10+or):Math.abs(or)<=9?lr=SSF_small_exp(ar):or===10?lr=ar.toFixed(10).substr(0,12):lr=SSF_large_exp(ar),SSF_strip_decimal(SSF_normalize_exp(lr.toUpperCase()))}function SSF_general(ar,or){switch(typeof ar){case"string":return ar;case"boolean":return ar?"TRUE":"FALSE";case"number":return(ar|0)===ar?ar.toString(10):SSF_general_num(ar);case"undefined":return"";case"object":if(ar==null)return"";if(ar instanceof Date)return SSF_format(14,datenum_local(ar,or&&or.date1904),or)}throw new Error("unsupported value in General format: "+ar)}function SSF_fix_hijri(ar,or){or[0]-=581;var lr=ar.getDay();return ar<60&&(lr=(lr+6)%7),lr}function SSF_write_date(ar,or,lr,cr){var ur="",dr=0,hr=0,pr=lr.y,mr,fr=0;switch(ar){case 98:pr=lr.y+543;case 121:switch(or.length){case 1:case 2:mr=pr%100,fr=2;break;default:mr=pr%1e4,fr=4;break}break;case 109:switch(or.length){case 1:case 2:mr=lr.m,fr=or.length;break;case 3:return months[lr.m-1][1];case 5:return months[lr.m-1][0];default:return months[lr.m-1][2]}break;case 100:switch(or.length){case 1:case 2:mr=lr.d,fr=or.length;break;case 3:return days[lr.q][0];default:return days[lr.q][1]}break;case 104:switch(or.length){case 1:case 2:mr=1+(lr.H+11)%12,fr=or.length;break;default:throw"bad hour format: "+or}break;case 72:switch(or.length){case 1:case 2:mr=lr.H,fr=or.length;break;default:throw"bad hour format: "+or}break;case 77:switch(or.length){case 1:case 2:mr=lr.M,fr=or.length;break;default:throw"bad minute format: "+or}break;case 115:if(or!="s"&&or!="ss"&&or!=".0"&&or!=".00"&&or!=".000")throw"bad second format: "+or;return lr.u===0&&(or=="s"||or=="ss")?pad0(lr.S,or.length):(cr>=2?hr=cr===3?1e3:100:hr=cr===1?10:1,dr=Math.round(hr*(lr.S+lr.u)),dr>=60*hr&&(dr=0),or==="s"?dr===0?"0":""+dr/hr:(ur=pad0(dr,2+cr),or==="ss"?ur.substr(0,2):"."+ur.substr(2,or.length-1)));case 90:switch(or){case"[h]":case"[hh]":mr=lr.D*24+lr.H;break;case"[m]":case"[mm]":mr=(lr.D*24+lr.H)*60+lr.M;break;case"[s]":case"[ss]":mr=((lr.D*24+lr.H)*60+lr.M)*60+Math.round(lr.S+lr.u);break;default:throw"bad abstime format: "+or}fr=or.length===3?1:2;break;case 101:mr=pr,fr=1;break}var xr=fr>0?pad0(mr,fr):"";return xr}function commaify(ar){var or=3;if(ar.length<=or)return ar;for(var lr=ar.length%or,cr=ar.substr(0,lr);lr!=ar.length;lr+=or)cr+=(cr.length>0?",":"")+ar.substr(lr,or);return cr}var pct1=/%/g;function write_num_pct(ar,or,lr){var cr=or.replace(pct1,""),ur=or.length-cr.length;return write_num(ar,cr,lr*Math.pow(10,2*ur))+fill("%",ur)}function write_num_cm(ar,or,lr){for(var cr=or.length-1;or.charCodeAt(cr-1)===44;)--cr;return write_num(ar,or.substr(0,cr),lr/Math.pow(10,3*(or.length-cr)))}function write_num_exp(ar,or){var lr,cr=ar.indexOf("E")-ar.indexOf(".")-1;if(ar.match(/^#+0.0E\+0$/)){if(or==0)return"0.0E+0";if(or<0)return"-"+write_num_exp(ar,-or);var ur=ar.indexOf(".");ur===-1&&(ur=ar.indexOf("E"));var dr=Math.floor(Math.log(or)*Math.LOG10E)%ur;if(dr<0&&(dr+=ur),lr=(or/Math.pow(10,dr)).toPrecision(cr+1+(ur+dr)%ur),lr.indexOf("e")===-1){var hr=Math.floor(Math.log(or)*Math.LOG10E);for(lr.indexOf(".")===-1?lr=lr.charAt(0)+"."+lr.substr(1)+"E+"+(hr-lr.length+dr):lr+="E+"+(hr-dr);lr.substr(0,2)==="0.";)lr=lr.charAt(0)+lr.substr(2,ur)+"."+lr.substr(2+ur),lr=lr.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");lr=lr.replace(/\+-/,"-")}lr=lr.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(pr,mr,fr,xr){return mr+fr+xr.substr(0,(ur+dr)%ur)+"."+xr.substr(dr)+"E"})}else lr=or.toExponential(cr);return ar.match(/E\+00$/)&&lr.match(/e[+-]\d$/)&&(lr=lr.substr(0,lr.length-1)+"0"+lr.charAt(lr.length-1)),ar.match(/E\-/)&&lr.match(/e\+/)&&(lr=lr.replace(/e\+/,"e")),lr.replace("e","E")}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(ar,or,lr){var cr=parseInt(ar[4],10),ur=Math.round(or*cr),dr=Math.floor(ur/cr),hr=ur-dr*cr,pr=cr;return lr+(dr===0?"":""+dr)+" "+(hr===0?fill(" ",ar[1].length+1+ar[4].length):pad_(hr,ar[1].length)+ar[2]+"/"+ar[3]+pad0(pr,ar[4].length))}function write_num_f2(ar,or,lr){return lr+(or===0?"":""+or)+fill(" ",ar[1].length+2+ar[4].length)}var dec1=/^#*0*\.([0#]+)/,closeparen=/\).*[0#]/,phone=/\(###\) ###\\?-####/;function hashq(ar){for(var or="",lr,cr=0;cr!=ar.length;++cr)switch(lr=ar.charCodeAt(cr)){case 35:break;case 63:or+=" ";break;case 48:or+="0";break;default:or+=String.fromCharCode(lr)}return or}function rnd(ar,or){var lr=Math.pow(10,or);return""+Math.round(ar*lr)/lr}function dec(ar,or){var lr=ar-Math.floor(ar),cr=Math.pow(10,or);return or<(""+Math.round(lr*cr)).length?0:Math.round(lr*cr)}function carry(ar,or){return or<(""+Math.round((ar-Math.floor(ar))*Math.pow(10,or))).length?1:0}function flr(ar){return ar<2147483647&&ar>-2147483648?""+(ar>=0?ar|0:ar-1|0):""+Math.floor(ar)}function write_num_flt(ar,or,lr){if(ar.charCodeAt(0)===40&&!or.match(closeparen)){var cr=or.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return lr>=0?write_num_flt("n",cr,lr):"("+write_num_flt("n",cr,-lr)+")"}if(or.charCodeAt(or.length-1)===44)return write_num_cm(ar,or,lr);if(or.indexOf("%")!==-1)return write_num_pct(ar,or,lr);if(or.indexOf("E")!==-1)return write_num_exp(or,lr);if(or.charCodeAt(0)===36)return"$"+write_num_flt(ar,or.substr(or.charAt(1)==" "?2:1),lr);var ur,dr,hr,pr,mr=Math.abs(lr),fr=lr<0?"-":"";if(or.match(/^00+$/))return fr+pad0r(mr,or.length);if(or.match(/^[#?]+$/))return ur=pad0r(lr,0),ur==="0"&&(ur=""),ur.length>or.length?ur:hashq(or.substr(0,or.length-ur.length))+ur;if(dr=or.match(frac1))return write_num_f1(dr,mr,fr);if(or.match(/^#+0+$/))return fr+pad0r(mr,or.length-or.indexOf("0"));if(dr=or.match(dec1))return ur=rnd(lr,dr[1].length).replace(/^([^\.]+)$/,"$1."+hashq(dr[1])).replace(/\.$/,"."+hashq(dr[1])).replace(/\.(\d*)$/,function(yr,br){return"."+br+fill("0",hashq(dr[1]).length-br.length)}),or.indexOf("0.")!==-1?ur:ur.replace(/^0\./,".");if(or=or.replace(/^#+([0.])/,"$1"),dr=or.match(/^(0*)\.(#*)$/))return fr+rnd(mr,dr[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,dr[1].length?"0.":".");if(dr=or.match(/^#{1,3},##0(\.?)$/))return fr+commaify(pad0r(mr,0));if(dr=or.match(/^#,##0\.([#0]*0)$/))return lr<0?"-"+write_num_flt(ar,or,-lr):commaify(""+(Math.floor(lr)+carry(lr,dr[1].length)))+"."+pad0(dec(lr,dr[1].length),dr[1].length);if(dr=or.match(/^#,#*,#0/))return write_num_flt(ar,or.replace(/^#,#*,/,""),lr);if(dr=or.match(/^([0#]+)(\\?-([0#]+))+$/))return ur=_strrev(write_num_flt(ar,or.replace(/[\\-]/g,""),lr)),hr=0,_strrev(_strrev(or.replace(/\\/g,"")).replace(/[0#]/g,function(yr){return hr<ur.length?ur.charAt(hr++):yr==="0"?"0":""}));if(or.match(phone))return ur=write_num_flt(ar,"##########",lr),"("+ur.substr(0,3)+") "+ur.substr(3,3)+"-"+ur.substr(6);var xr="";if(dr=or.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return hr=Math.min(dr[4].length,7),pr=SSF_frac(mr,Math.pow(10,hr)-1,!1),ur=""+fr,xr=write_num("n",dr[1],pr[1]),xr.charAt(xr.length-1)==" "&&(xr=xr.substr(0,xr.length-1)+"0"),ur+=xr+dr[2]+"/"+dr[3],xr=rpad_(pr[2],hr),xr.length<dr[4].length&&(xr=hashq(dr[4].substr(dr[4].length-xr.length))+xr),ur+=xr,ur;if(dr=or.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return hr=Math.min(Math.max(dr[1].length,dr[4].length),7),pr=SSF_frac(mr,Math.pow(10,hr)-1,!0),fr+(pr[0]||(pr[1]?"":"0"))+" "+(pr[1]?pad_(pr[1],hr)+dr[2]+"/"+dr[3]+rpad_(pr[2],hr):fill(" ",2*hr+1+dr[2].length+dr[3].length));if(dr=or.match(/^[#0?]+$/))return ur=pad0r(lr,0),or.length<=ur.length?ur:hashq(or.substr(0,or.length-ur.length))+ur;if(dr=or.match(/^([#0?]+)\.([#0]+)$/)){ur=""+lr.toFixed(Math.min(dr[2].length,10)).replace(/([^0])0+$/,"$1"),hr=ur.indexOf(".");var Er=or.indexOf(".")-hr,vr=or.length-ur.length-Er;return hashq(or.substr(0,Er)+ur+or.substr(or.length-vr))}if(dr=or.match(/^00,000\.([#0]*0)$/))return hr=dec(lr,dr[1].length),lr<0?"-"+write_num_flt(ar,or,-lr):commaify(flr(lr)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(yr){return"00,"+(yr.length<3?pad0(0,3-yr.length):"")+yr})+"."+pad0(hr,dr[1].length);switch(or){case"###,##0.00":return write_num_flt(ar,"#,##0.00",lr);case"###,###":case"##,###":case"#,###":var gr=commaify(pad0r(mr,0));return gr!=="0"?fr+gr:"";case"###,###.00":return write_num_flt(ar,"###,##0.00",lr).replace(/^0\./,".");case"#,###.00":return write_num_flt(ar,"#,##0.00",lr).replace(/^0\./,".")}throw new Error("unsupported format |"+or+"|")}function write_num_cm2(ar,or,lr){for(var cr=or.length-1;or.charCodeAt(cr-1)===44;)--cr;return write_num(ar,or.substr(0,cr),lr/Math.pow(10,3*(or.length-cr)))}function write_num_pct2(ar,or,lr){var cr=or.replace(pct1,""),ur=or.length-cr.length;return write_num(ar,cr,lr*Math.pow(10,2*ur))+fill("%",ur)}function write_num_exp2(ar,or){var lr,cr=ar.indexOf("E")-ar.indexOf(".")-1;if(ar.match(/^#+0.0E\+0$/)){if(or==0)return"0.0E+0";if(or<0)return"-"+write_num_exp2(ar,-or);var ur=ar.indexOf(".");ur===-1&&(ur=ar.indexOf("E"));var dr=Math.floor(Math.log(or)*Math.LOG10E)%ur;if(dr<0&&(dr+=ur),lr=(or/Math.pow(10,dr)).toPrecision(cr+1+(ur+dr)%ur),!lr.match(/[Ee]/)){var hr=Math.floor(Math.log(or)*Math.LOG10E);lr.indexOf(".")===-1?lr=lr.charAt(0)+"."+lr.substr(1)+"E+"+(hr-lr.length+dr):lr+="E+"+(hr-dr),lr=lr.replace(/\+-/,"-")}lr=lr.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(pr,mr,fr,xr){return mr+fr+xr.substr(0,(ur+dr)%ur)+"."+xr.substr(dr)+"E"})}else lr=or.toExponential(cr);return ar.match(/E\+00$/)&&lr.match(/e[+-]\d$/)&&(lr=lr.substr(0,lr.length-1)+"0"+lr.charAt(lr.length-1)),ar.match(/E\-/)&&lr.match(/e\+/)&&(lr=lr.replace(/e\+/,"e")),lr.replace("e","E")}function write_num_int(ar,or,lr){if(ar.charCodeAt(0)===40&&!or.match(closeparen)){var cr=or.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return lr>=0?write_num_int("n",cr,lr):"("+write_num_int("n",cr,-lr)+")"}if(or.charCodeAt(or.length-1)===44)return write_num_cm2(ar,or,lr);if(or.indexOf("%")!==-1)return write_num_pct2(ar,or,lr);if(or.indexOf("E")!==-1)return write_num_exp2(or,lr);if(or.charCodeAt(0)===36)return"$"+write_num_int(ar,or.substr(or.charAt(1)==" "?2:1),lr);var ur,dr,hr,pr,mr=Math.abs(lr),fr=lr<0?"-":"";if(or.match(/^00+$/))return fr+pad0(mr,or.length);if(or.match(/^[#?]+$/))return ur=""+lr,lr===0&&(ur=""),ur.length>or.length?ur:hashq(or.substr(0,or.length-ur.length))+ur;if(dr=or.match(frac1))return write_num_f2(dr,mr,fr);if(or.match(/^#+0+$/))return fr+pad0(mr,or.length-or.indexOf("0"));if(dr=or.match(dec1))return ur=(""+lr).replace(/^([^\.]+)$/,"$1."+hashq(dr[1])).replace(/\.$/,"."+hashq(dr[1])),ur=ur.replace(/\.(\d*)$/,function(yr,br){return"."+br+fill("0",hashq(dr[1]).length-br.length)}),or.indexOf("0.")!==-1?ur:ur.replace(/^0\./,".");if(or=or.replace(/^#+([0.])/,"$1"),dr=or.match(/^(0*)\.(#*)$/))return fr+(""+mr).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,dr[1].length?"0.":".");if(dr=or.match(/^#{1,3},##0(\.?)$/))return fr+commaify(""+mr);if(dr=or.match(/^#,##0\.([#0]*0)$/))return lr<0?"-"+write_num_int(ar,or,-lr):commaify(""+lr)+"."+fill("0",dr[1].length);if(dr=or.match(/^#,#*,#0/))return write_num_int(ar,or.replace(/^#,#*,/,""),lr);if(dr=or.match(/^([0#]+)(\\?-([0#]+))+$/))return ur=_strrev(write_num_int(ar,or.replace(/[\\-]/g,""),lr)),hr=0,_strrev(_strrev(or.replace(/\\/g,"")).replace(/[0#]/g,function(yr){return hr<ur.length?ur.charAt(hr++):yr==="0"?"0":""}));if(or.match(phone))return ur=write_num_int(ar,"##########",lr),"("+ur.substr(0,3)+") "+ur.substr(3,3)+"-"+ur.substr(6);var xr="";if(dr=or.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return hr=Math.min(dr[4].length,7),pr=SSF_frac(mr,Math.pow(10,hr)-1,!1),ur=""+fr,xr=write_num("n",dr[1],pr[1]),xr.charAt(xr.length-1)==" "&&(xr=xr.substr(0,xr.length-1)+"0"),ur+=xr+dr[2]+"/"+dr[3],xr=rpad_(pr[2],hr),xr.length<dr[4].length&&(xr=hashq(dr[4].substr(dr[4].length-xr.length))+xr),ur+=xr,ur;if(dr=or.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return hr=Math.min(Math.max(dr[1].length,dr[4].length),7),pr=SSF_frac(mr,Math.pow(10,hr)-1,!0),fr+(pr[0]||(pr[1]?"":"0"))+" "+(pr[1]?pad_(pr[1],hr)+dr[2]+"/"+dr[3]+rpad_(pr[2],hr):fill(" ",2*hr+1+dr[2].length+dr[3].length));if(dr=or.match(/^[#0?]+$/))return ur=""+lr,or.length<=ur.length?ur:hashq(or.substr(0,or.length-ur.length))+ur;if(dr=or.match(/^([#0]+)\.([#0]+)$/)){ur=""+lr.toFixed(Math.min(dr[2].length,10)).replace(/([^0])0+$/,"$1"),hr=ur.indexOf(".");var Er=or.indexOf(".")-hr,vr=or.length-ur.length-Er;return hashq(or.substr(0,Er)+ur+or.substr(or.length-vr))}if(dr=or.match(/^00,000\.([#0]*0)$/))return lr<0?"-"+write_num_int(ar,or,-lr):commaify(""+lr).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(yr){return"00,"+(yr.length<3?pad0(0,3-yr.length):"")+yr})+"."+pad0(0,dr[1].length);switch(or){case"###,###":case"##,###":case"#,###":var gr=commaify(""+mr);return gr!=="0"?fr+gr:"";default:if(or.match(/\.[0#?]*$/))return write_num_int(ar,or.slice(0,or.lastIndexOf(".")),lr)+hashq(or.slice(or.lastIndexOf(".")))}throw new Error("unsupported format |"+or+"|")}function write_num(ar,or,lr){return(lr|0)===lr?write_num_int(ar,or,lr):write_num_flt(ar,or,lr)}function SSF_split_fmt(ar){for(var or=[],lr=!1,cr=0,ur=0;cr<ar.length;++cr)switch(ar.charCodeAt(cr)){case 34:lr=!lr;break;case 95:case 42:case 92:++cr;break;case 59:or[or.length]=ar.substr(ur,cr-ur),ur=cr+1}if(or[or.length]=ar.substr(ur),lr===!0)throw new Error("Format |"+ar+"| unterminated string ");return or}var SSF_abstime=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function fmt_is_date(ar){for(var or=0,lr="",cr="";or<ar.length;)switch(lr=ar.charAt(or)){case"G":SSF_isgeneral(ar,or)&&(or+=6),or++;break;case'"':for(;ar.charCodeAt(++or)!==34&&or<ar.length;);++or;break;case"\\":or+=2;break;case"_":or+=2;break;case"@":++or;break;case"B":case"b":if(ar.charAt(or+1)==="1"||ar.charAt(or+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"":if(ar.substr(or,3).toUpperCase()==="A/P"||ar.substr(or,5).toUpperCase()==="AM/PM"||ar.substr(or,5).toUpperCase()==="/")return!0;++or;break;case"[":for(cr=lr;ar.charAt(or++)!=="]"&&or<ar.length;)cr+=ar.charAt(or);if(cr.match(SSF_abstime))return!0;break;case".":case"0":case"#":for(;or<ar.length&&("0#?.,E+-%".indexOf(lr=ar.charAt(++or))>-1||lr=="\\"&&ar.charAt(or+1)=="-"&&"0#".indexOf(ar.charAt(or+2))>-1););break;case"?":for(;ar.charAt(++or)===lr;);break;case"*":++or,(ar.charAt(or)==" "||ar.charAt(or)=="*")&&++or;break;case"(":case")":++or;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;or<ar.length&&"0123456789".indexOf(ar.charAt(++or))>-1;);break;case" ":++or;break;default:++or;break}return!1}function eval_fmt(ar,or,lr,cr){for(var ur=[],dr="",hr=0,pr="",mr="t",fr,xr,Er,vr="H";hr<ar.length;)switch(pr=ar.charAt(hr)){case"G":if(!SSF_isgeneral(ar,hr))throw new Error("unrecognized character "+pr+" in "+ar);ur[ur.length]={t:"G",v:"General"},hr+=7;break;case'"':for(dr="";(Er=ar.charCodeAt(++hr))!==34&&hr<ar.length;)dr+=String.fromCharCode(Er);ur[ur.length]={t:"t",v:dr},++hr;break;case"\\":var gr=ar.charAt(++hr),yr=gr==="("||gr===")"?gr:"t";ur[ur.length]={t:yr,v:gr},++hr;break;case"_":ur[ur.length]={t:"t",v:" "},hr+=2;break;case"@":ur[ur.length]={t:"T",v:or},++hr;break;case"B":case"b":if(ar.charAt(hr+1)==="1"||ar.charAt(hr+1)==="2"){if(fr==null&&(fr=SSF_parse_date_code(or,lr,ar.charAt(hr+1)==="2"),fr==null))return"";ur[ur.length]={t:"X",v:ar.substr(hr,2)},mr=pr,hr+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":pr=pr.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(or<0||fr==null&&(fr=SSF_parse_date_code(or,lr),fr==null))return"";for(dr=pr;++hr<ar.length&&ar.charAt(hr).toLowerCase()===pr;)dr+=pr;pr==="m"&&mr.toLowerCase()==="h"&&(pr="M"),pr==="h"&&(pr=vr),ur[ur.length]={t:pr,v:dr},mr=pr;break;case"A":case"a":case"":var br={t:pr,v:pr};if(fr==null&&(fr=SSF_parse_date_code(or,lr)),ar.substr(hr,3).toUpperCase()==="A/P"?(fr!=null&&(br.v=fr.H>=12?"P":"A"),br.t="T",vr="h",hr+=3):ar.substr(hr,5).toUpperCase()==="AM/PM"?(fr!=null&&(br.v=fr.H>=12?"PM":"AM"),br.t="T",hr+=5,vr="h"):ar.substr(hr,5).toUpperCase()==="/"?(fr!=null&&(br.v=fr.H>=12?"":""),br.t="T",hr+=5,vr="h"):(br.t="t",++hr),fr==null&&br.t==="T")return"";ur[ur.length]=br,mr=pr;break;case"[":for(dr=pr;ar.charAt(hr++)!=="]"&&hr<ar.length;)dr+=ar.charAt(hr);if(dr.slice(-1)!=="]")throw'unterminated "[" block: |'+dr+"|";if(dr.match(SSF_abstime)){if(fr==null&&(fr=SSF_parse_date_code(or,lr),fr==null))return"";ur[ur.length]={t:"Z",v:dr.toLowerCase()},mr=dr.charAt(1)}else dr.indexOf("$")>-1&&(dr=(dr.match(/\$([^-\[\]]*)/)||[])[1]||"$",fmt_is_date(ar)||(ur[ur.length]={t:"t",v:dr}));break;case".":if(fr!=null){for(dr=pr;++hr<ar.length&&(pr=ar.charAt(hr))==="0";)dr+=pr;ur[ur.length]={t:"s",v:dr};break}case"0":case"#":for(dr=pr;++hr<ar.length&&"0#?.,E+-%".indexOf(pr=ar.charAt(hr))>-1;)dr+=pr;ur[ur.length]={t:"n",v:dr};break;case"?":for(dr=pr;ar.charAt(++hr)===pr;)dr+=pr;ur[ur.length]={t:pr,v:dr},mr=pr;break;case"*":++hr,(ar.charAt(hr)==" "||ar.charAt(hr)=="*")&&++hr;break;case"(":case")":ur[ur.length]={t:cr===1?"t":pr,v:pr},++hr;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(dr=pr;hr<ar.length&&"0123456789".indexOf(ar.charAt(++hr))>-1;)dr+=ar.charAt(hr);ur[ur.length]={t:"D",v:dr};break;case" ":ur[ur.length]={t:pr,v:pr},++hr;break;case"$":ur[ur.length]={t:"t",v:"$"},++hr;break;default:if(",$-+/():!^&'~{}<>=acfijklopqrtuvwxzP".indexOf(pr)===-1)throw new Error("unrecognized character "+pr+" in "+ar);ur[ur.length]={t:"t",v:pr},++hr;break}var _r=0,jr=0,wr;for(hr=ur.length-1,mr="t";hr>=0;--hr)switch(ur[hr].t){case"h":case"H":ur[hr].t=vr,mr="h",_r<1&&(_r=1);break;case"s":(wr=ur[hr].v.match(/\.0+$/))&&(jr=Math.max(jr,wr[0].length-1)),_r<3&&(_r=3);case"d":case"y":case"M":case"e":mr=ur[hr].t;break;case"m":mr==="s"&&(ur[hr].t="M",_r<2&&(_r=2));break;case"X":break;case"Z":_r<1&&ur[hr].v.match(/[Hh]/)&&(_r=1),_r<2&&ur[hr].v.match(/[Mm]/)&&(_r=2),_r<3&&ur[hr].v.match(/[Ss]/)&&(_r=3)}switch(_r){case 0:break;case 1:fr.u>=.5&&(fr.u=0,++fr.S),fr.S>=60&&(fr.S=0,++fr.M),fr.M>=60&&(fr.M=0,++fr.H);break;case 2:fr.u>=.5&&(fr.u=0,++fr.S),fr.S>=60&&(fr.S=0,++fr.M);break}var Sr="",Tr;for(hr=0;hr<ur.length;++hr)switch(ur[hr].t){case"t":case"T":case" ":case"D":break;case"X":ur[hr].v="",ur[hr].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":ur[hr].v=SSF_write_date(ur[hr].t.charCodeAt(0),ur[hr].v,fr,jr),ur[hr].t="t";break;case"n":case"?":for(Tr=hr+1;ur[Tr]!=null&&((pr=ur[Tr].t)==="?"||pr==="D"||(pr===" "||pr==="t")&&ur[Tr+1]!=null&&(ur[Tr+1].t==="?"||ur[Tr+1].t==="t"&&ur[Tr+1].v==="/")||ur[hr].t==="("&&(pr===" "||pr==="n"||pr===")")||pr==="t"&&(ur[Tr].v==="/"||ur[Tr].v===" "&&ur[Tr+1]!=null&&ur[Tr+1].t=="?"));)ur[hr].v+=ur[Tr].v,ur[Tr]={v:"",t:";"},++Tr;Sr+=ur[hr].v,hr=Tr-1;break;case"G":ur[hr].t="t",ur[hr].v=SSF_general(or,lr);break}var Rr="",Nr,Cr;if(Sr.length>0){Sr.charCodeAt(0)==40?(Nr=or<0&&Sr.charCodeAt(0)===45?-or:or,Cr=write_num("n",Sr,Nr)):(Nr=or<0&&cr>1?-or:or,Cr=write_num("n",Sr,Nr),Nr<0&&ur[0]&&ur[0].t=="t"&&(Cr=Cr.substr(1),ur[0].v="-"+ur[0].v)),Tr=Cr.length-1;var kr=ur.length;for(hr=0;hr<ur.length;++hr)if(ur[hr]!=null&&ur[hr].t!="t"&&ur[hr].v.indexOf(".")>-1){kr=hr;break}var Ar=ur.length;if(kr===ur.length&&Cr.indexOf("E")===-1){for(hr=ur.length-1;hr>=0;--hr)ur[hr]==null||"n?".indexOf(ur[hr].t)===-1||(Tr>=ur[hr].v.length-1?(Tr-=ur[hr].v.length,ur[hr].v=Cr.substr(Tr+1,ur[hr].v.length)):Tr<0?ur[hr].v="":(ur[hr].v=Cr.substr(0,Tr+1),Tr=-1),ur[hr].t="t",Ar=hr);Tr>=0&&Ar<ur.length&&(ur[Ar].v=Cr.substr(0,Tr+1)+ur[Ar].v)}else if(kr!==ur.length&&Cr.indexOf("E")===-1){for(Tr=Cr.indexOf(".")-1,hr=kr;hr>=0;--hr)if(!(ur[hr]==null||"n?".indexOf(ur[hr].t)===-1)){for(xr=ur[hr].v.indexOf(".")>-1&&hr===kr?ur[hr].v.indexOf(".")-1:ur[hr].v.length-1,Rr=ur[hr].v.substr(xr+1);xr>=0;--xr)Tr>=0&&(ur[hr].v.charAt(xr)==="0"||ur[hr].v.charAt(xr)==="#")&&(Rr=Cr.charAt(Tr--)+Rr);ur[hr].v=Rr,ur[hr].t="t",Ar=hr}for(Tr>=0&&Ar<ur.length&&(ur[Ar].v=Cr.substr(0,Tr+1)+ur[Ar].v),Tr=Cr.indexOf(".")+1,hr=kr;hr<ur.length;++hr)if(!(ur[hr]==null||"n?(".indexOf(ur[hr].t)===-1&&hr!==kr)){for(xr=ur[hr].v.indexOf(".")>-1&&hr===kr?ur[hr].v.indexOf(".")+1:0,Rr=ur[hr].v.substr(0,xr);xr<ur[hr].v.length;++xr)Tr<Cr.length&&(Rr+=Cr.charAt(Tr++));ur[hr].v=Rr,ur[hr].t="t",Ar=hr}}}for(hr=0;hr<ur.length;++hr)ur[hr]!=null&&"n?".indexOf(ur[hr].t)>-1&&(Nr=cr>1&&or<0&&hr>0&&ur[hr-1].v==="-"?-or:or,ur[hr].v=write_num(ur[hr].t,ur[hr].v,Nr),ur[hr].t="t");var Or="";for(hr=0;hr!==ur.length;++hr)ur[hr]!=null&&(Or+=ur[hr].v);return Or}var cfregex2=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function chkcond(ar,or){if(or==null)return!1;var lr=parseFloat(or[2]);switch(or[1]){case"=":if(ar==lr)return!0;break;case">":if(ar>lr)return!0;break;case"<":if(ar<lr)return!0;break;case"<>":if(ar!=lr)return!0;break;case">=":if(ar>=lr)return!0;break;case"<=":if(ar<=lr)return!0;break}return!1}function choose_fmt(ar,or){var lr=SSF_split_fmt(ar),cr=lr.length,ur=lr[cr-1].indexOf("@");if(cr<4&&ur>-1&&--cr,lr.length>4)throw new Error("cannot find right format for |"+lr.join("|")+"|");if(typeof or!="number")return[4,lr.length===4||ur>-1?lr[lr.length-1]:"@"];switch(lr.length){case 1:lr=ur>-1?["General","General","General",lr[0]]:[lr[0],lr[0],lr[0],"@"];break;case 2:lr=ur>-1?[lr[0],lr[0],lr[0],lr[1]]:[lr[0],lr[1],lr[0],"@"];break;case 3:lr=ur>-1?[lr[0],lr[1],lr[0],lr[2]]:[lr[0],lr[1],lr[2],"@"];break}var dr=or>0?lr[0]:or<0?lr[1]:lr[2];if(lr[0].indexOf("[")===-1&&lr[1].indexOf("[")===-1)return[cr,dr];if(lr[0].match(/\[[=<>]/)!=null||lr[1].match(/\[[=<>]/)!=null){var hr=lr[0].match(cfregex2),pr=lr[1].match(cfregex2);return chkcond(or,hr)?[cr,lr[0]]:chkcond(or,pr)?[cr,lr[1]]:[cr,lr[hr!=null&&pr!=null?2:1]]}return[cr,dr]}function SSF_format(ar,or,lr){lr==null&&(lr={});var cr="";switch(typeof ar){case"string":ar=="m/d/yy"&&lr.dateNF?cr=lr.dateNF:cr=ar;break;case"number":ar==14&&lr.dateNF?cr=lr.dateNF:cr=(lr.table!=null?lr.table:table_fmt)[ar],cr==null&&(cr=lr.table&&lr.table[SSF_default_map[ar]]||table_fmt[SSF_default_map[ar]]),cr==null&&(cr=SSF_default_str[ar]||"General");break}if(SSF_isgeneral(cr,0))return SSF_general(or,lr);or instanceof Date&&(or=datenum_local(or,lr.date1904));var ur=choose_fmt(cr,or);if(SSF_isgeneral(ur[1]))return SSF_general(or,lr);if(or===!0)or="TRUE";else if(or===!1)or="FALSE";else if(or===""||or==null)return"";return eval_fmt(ur[1],or,lr,ur[0])}function SSF_load(ar,or){if(typeof or!="number"){or=+or||-1;for(var lr=0;lr<392;++lr){if(table_fmt[lr]==null){or<0&&(or=lr);continue}if(table_fmt[lr]==ar){or=lr;break}}or<0&&(or=391)}return table_fmt[or]=ar,or}function SSF_load_table(ar){for(var or=0;or!=392;++or)ar[or]!==void 0&&SSF_load(ar[or],or)}function make_ssf(){table_fmt=SSF_init_table()}var dateNFregex=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function dateNF_regex(ar){var or=typeof ar=="number"?table_fmt[ar]:ar;return or=or.replace(dateNFregex,"(\\d+)"),new RegExp("^"+or+"$")}function dateNF_fix(ar,or,lr){var cr=-1,ur=-1,dr=-1,hr=-1,pr=-1,mr=-1;(or.match(dateNFregex)||[]).forEach(function(Er,vr){var gr=parseInt(lr[vr+1],10);switch(Er.toLowerCase().charAt(0)){case"y":cr=gr;break;case"d":dr=gr;break;case"h":hr=gr;break;case"s":mr=gr;break;case"m":hr>=0?pr=gr:ur=gr;break}}),mr>=0&&pr==-1&&ur>=0&&(pr=ur,ur=-1);var fr=(""+(cr>=0?cr:new Date().getFullYear())).slice(-4)+"-"+("00"+(ur>=1?ur:1)).slice(-2)+"-"+("00"+(dr>=1?dr:1)).slice(-2);fr.length==7&&(fr="0"+fr),fr.length==8&&(fr="20"+fr);var xr=("00"+(hr>=0?hr:0)).slice(-2)+":"+("00"+(pr>=0?pr:0)).slice(-2)+":"+("00"+(mr>=0?mr:0)).slice(-2);return hr==-1&&pr==-1&&mr==-1?fr:cr==-1&&ur==-1&&dr==-1?xr:fr+"T"+xr}var CRC32=function(){var ar={};ar.version="1.2.0";function or(){for(var Cr=0,kr=new Array(256),Ar=0;Ar!=256;++Ar)Cr=Ar,Cr=Cr&1?-306674912^Cr>>>1:Cr>>>1,Cr=Cr&1?-306674912^Cr>>>1:Cr>>>1,Cr=Cr&1?-306674912^Cr>>>1:Cr>>>1,Cr=Cr&1?-306674912^Cr>>>1:Cr>>>1,Cr=Cr&1?-306674912^Cr>>>1:Cr>>>1,Cr=Cr&1?-306674912^Cr>>>1:Cr>>>1,Cr=Cr&1?-306674912^Cr>>>1:Cr>>>1,Cr=Cr&1?-306674912^Cr>>>1:Cr>>>1,kr[Ar]=Cr;return typeof Int32Array<"u"?new Int32Array(kr):kr}var lr=or();function cr(Cr){var kr=0,Ar=0,Or=0,Lr=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(Or=0;Or!=256;++Or)Lr[Or]=Cr[Or];for(Or=0;Or!=256;++Or)for(Ar=Cr[Or],kr=256+Or;kr<4096;kr+=256)Ar=Lr[kr]=Ar>>>8^Cr[Ar&255];var Fr=[];for(Or=1;Or!=16;++Or)Fr[Or-1]=typeof Int32Array<"u"?Lr.subarray(Or*256,Or*256+256):Lr.slice(Or*256,Or*256+256);return Fr}var ur=cr(lr),dr=ur[0],hr=ur[1],pr=ur[2],mr=ur[3],fr=ur[4],xr=ur[5],Er=ur[6],vr=ur[7],gr=ur[8],yr=ur[9],br=ur[10],_r=ur[11],jr=ur[12],wr=ur[13],Sr=ur[14];function Tr(Cr,kr){for(var Ar=kr^-1,Or=0,Lr=Cr.length;Or<Lr;)Ar=Ar>>>8^lr[(Ar^Cr.charCodeAt(Or++))&255];return~Ar}function Rr(Cr,kr){for(var Ar=kr^-1,Or=Cr.length-15,Lr=0;Lr<Or;)Ar=Sr[Cr[Lr++]^Ar&255]^wr[Cr[Lr++]^Ar>>8&255]^jr[Cr[Lr++]^Ar>>16&255]^_r[Cr[Lr++]^Ar>>>24]^br[Cr[Lr++]]^yr[Cr[Lr++]]^gr[Cr[Lr++]]^vr[Cr[Lr++]]^Er[Cr[Lr++]]^xr[Cr[Lr++]]^fr[Cr[Lr++]]^mr[Cr[Lr++]]^pr[Cr[Lr++]]^hr[Cr[Lr++]]^dr[Cr[Lr++]]^lr[Cr[Lr++]];for(Or+=15;Lr<Or;)Ar=Ar>>>8^lr[(Ar^Cr[Lr++])&255];return~Ar}function Nr(Cr,kr){for(var Ar=kr^-1,Or=0,Lr=Cr.length,Fr=0,Hr=0;Or<Lr;)Fr=Cr.charCodeAt(Or++),Fr<128?Ar=Ar>>>8^lr[(Ar^Fr)&255]:Fr<2048?(Ar=Ar>>>8^lr[(Ar^(192|Fr>>6&31))&255],Ar=Ar>>>8^lr[(Ar^(128|Fr&63))&255]):Fr>=55296&&Fr<57344?(Fr=(Fr&1023)+64,Hr=Cr.charCodeAt(Or++)&1023,Ar=Ar>>>8^lr[(Ar^(240|Fr>>8&7))&255],Ar=Ar>>>8^lr[(Ar^(128|Fr>>2&63))&255],Ar=Ar>>>8^lr[(Ar^(128|Hr>>6&15|(Fr&3)<<4))&255],Ar=Ar>>>8^lr[(Ar^(128|Hr&63))&255]):(Ar=Ar>>>8^lr[(Ar^(224|Fr>>12&15))&255],Ar=Ar>>>8^lr[(Ar^(128|Fr>>6&63))&255],Ar=Ar>>>8^lr[(Ar^(128|Fr&63))&255]);return~Ar}return ar.table=lr,ar.bstr=Tr,ar.buf=Rr,ar.str=Nr,ar}(),CFB=function ar(){var or={};or.version="1.2.1";function lr(zr,us){for(var Qr=zr.split("/"),rs=us.split("/"),ls=0,ps=0,Rs=Math.min(Qr.length,rs.length);ls<Rs;++ls){if(ps=Qr[ls].length-rs[ls].length)return ps;if(Qr[ls]!=rs[ls])return Qr[ls]<rs[ls]?-1:1}return Qr.length-rs.length}function cr(zr){if(zr.charAt(zr.length-1)=="/")return zr.slice(0,-1).indexOf("/")===-1?zr:cr(zr.slice(0,-1));var us=zr.lastIndexOf("/");return us===-1?zr:zr.slice(0,us+1)}function ur(zr){if(zr.charAt(zr.length-1)=="/")return ur(zr.slice(0,-1));var us=zr.lastIndexOf("/");return us===-1?zr:zr.slice(us+1)}function dr(zr,us){typeof us=="string"&&(us=new Date(us));var Qr=us.getHours();Qr=Qr<<6|us.getMinutes(),Qr=Qr<<5|us.getSeconds()>>>1,zr.write_shift(2,Qr);var rs=us.getFullYear()-1980;rs=rs<<4|us.getMonth()+1,rs=rs<<5|us.getDate(),zr.write_shift(2,rs)}function hr(zr){var us=zr.read_shift(2)&65535,Qr=zr.read_shift(2)&65535,rs=new Date,ls=Qr&31;Qr>>>=5;var ps=Qr&15;Qr>>>=4,rs.setMilliseconds(0),rs.setFullYear(Qr+1980),rs.setMonth(ps-1),rs.setDate(ls);var Rs=us&31;us>>>=5;var Fs=us&63;return us>>>=6,rs.setHours(us),rs.setMinutes(Fs),rs.setSeconds(Rs<<1),rs}function pr(zr){prep_blob(zr,0);for(var us={},Qr=0;zr.l<=zr.length-4;){var rs=zr.read_shift(2),ls=zr.read_shift(2),ps=zr.l+ls,Rs={};switch(rs){case 21589:Qr=zr.read_shift(1),Qr&1&&(Rs.mtime=zr.read_shift(4)),ls>5&&(Qr&2&&(Rs.atime=zr.read_shift(4)),Qr&4&&(Rs.ctime=zr.read_shift(4))),Rs.mtime&&(Rs.mt=new Date(Rs.mtime*1e3));break}zr.l=ps,us[rs]=Rs}return us}var mr;function fr(){return mr||(mr={})}function xr(zr,us){if(zr[0]==80&&zr[1]==75)return eo(zr,us);if((zr[0]|32)==109&&(zr[1]|32)==105)return js(zr,us);if(zr.length<512)throw new Error("CFB file size "+zr.length+" < 512");var Qr=3,rs=512,ls=0,ps=0,Rs=0,Fs=0,Ps=0,As=[],Ms=zr.slice(0,512);prep_blob(Ms,0);var Gs=Er(Ms);switch(Qr=Gs[0],Qr){case 3:rs=512;break;case 4:rs=4096;break;case 0:if(Gs[1]==0)return eo(zr,us);default:throw new Error("Major Version: Expected 3 or 4 saw "+Qr)}rs!==512&&(Ms=zr.slice(0,rs),prep_blob(Ms,28));var Xs=zr.slice(0,rs);vr(Ms,Qr);var _a=Ms.read_shift(4,"i");if(Qr===3&&_a!==0)throw new Error("# Directory Sectors: Expected 0 saw "+_a);Ms.l+=4,Rs=Ms.read_shift(4,"i"),Ms.l+=4,Ms.chk("00100000","Mini Stream Cutoff Size: "),Fs=Ms.read_shift(4,"i"),ls=Ms.read_shift(4,"i"),Ps=Ms.read_shift(4,"i"),ps=Ms.read_shift(4,"i");for(var Ks=-1,ba=0;ba<109&&(Ks=Ms.read_shift(4,"i"),!(Ks<0));++ba)As[ba]=Ks;var so=gr(zr,rs);_r(Ps,ps,so,rs,As);var ao=wr(so,Rs,As,rs);ao[Rs].name="!Directory",ls>0&&Fs!==Hr&&(ao[Fs].name="!MiniFAT"),ao[As[0]].name="!FAT",ao.fat_addrs=As,ao.ssz=rs;var oo={},lo=[],yo=[],bo=[];Sr(Rs,ao,so,lo,ls,oo,yo,Fs),yr(yo,bo,lo),lo.shift();var jo={FileIndex:yo,FullPaths:bo};return us&&us.raw&&(jo.raw={header:Xs,sectors:so}),jo}function Er(zr){if(zr[zr.l]==80&&zr[zr.l+1]==75)return[0,0];zr.chk(Kr,"Header Signature: "),zr.l+=16;var us=zr.read_shift(2,"u");return[zr.read_shift(2,"u"),us]}function vr(zr,us){var Qr=9;switch(zr.l+=2,Qr=zr.read_shift(2)){case 9:if(us!=3)throw new Error("Sector Shift: Expected 9 saw "+Qr);break;case 12:if(us!=4)throw new Error("Sector Shift: Expected 12 saw "+Qr);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+Qr)}zr.chk("0600","Mini Sector Shift: "),zr.chk("000000000000","Reserved: ")}function gr(zr,us){for(var Qr=Math.ceil(zr.length/us)-1,rs=[],ls=1;ls<Qr;++ls)rs[ls-1]=zr.slice(ls*us,(ls+1)*us);return rs[Qr-1]=zr.slice(Qr*us),rs}function yr(zr,us,Qr){for(var rs=0,ls=0,ps=0,Rs=0,Fs=0,Ps=Qr.length,As=[],Ms=[];rs<Ps;++rs)As[rs]=Ms[rs]=rs,us[rs]=Qr[rs];for(;Fs<Ms.length;++Fs)rs=Ms[Fs],ls=zr[rs].L,ps=zr[rs].R,Rs=zr[rs].C,As[rs]===rs&&(ls!==-1&&As[ls]!==ls&&(As[rs]=As[ls]),ps!==-1&&As[ps]!==ps&&(As[rs]=As[ps])),Rs!==-1&&(As[Rs]=rs),ls!==-1&&rs!=As[rs]&&(As[ls]=As[rs],Ms.lastIndexOf(ls)<Fs&&Ms.push(ls)),ps!==-1&&rs!=As[rs]&&(As[ps]=As[rs],Ms.lastIndexOf(ps)<Fs&&Ms.push(ps));for(rs=1;rs<Ps;++rs)As[rs]===rs&&(ps!==-1&&As[ps]!==ps?As[rs]=As[ps]:ls!==-1&&As[ls]!==ls&&(As[rs]=As[ls]));for(rs=1;rs<Ps;++rs)if(zr[rs].type!==0){if(Fs=rs,Fs!=As[Fs])do Fs=As[Fs],us[rs]=us[Fs]+"/"+us[rs];while(Fs!==0&&As[Fs]!==-1&&Fs!=As[Fs]);As[rs]=-1}for(us[0]+="/",rs=1;rs<Ps;++rs)zr[rs].type!==2&&(us[rs]+="/")}function br(zr,us,Qr){for(var rs=zr.start,ls=zr.size,ps=[],Rs=rs;Qr&&ls>0&&Rs>=0;)ps.push(us.slice(Rs*Fr,Rs*Fr+Fr)),ls-=Fr,Rs=__readInt32LE(Qr,Rs*4);return ps.length===0?new_buf(0):bconcat(ps).slice(0,zr.size)}function _r(zr,us,Qr,rs,ls){var ps=Hr;if(zr===Hr){if(us!==0)throw new Error("DIFAT chain shorter than expected")}else if(zr!==-1){var Rs=Qr[zr],Fs=(rs>>>2)-1;if(!Rs)return;for(var Ps=0;Ps<Fs&&(ps=__readInt32LE(Rs,Ps*4))!==Hr;++Ps)ls.push(ps);_r(__readInt32LE(Rs,rs-4),us-1,Qr,rs,ls)}}function jr(zr,us,Qr,rs,ls){var ps=[],Rs=[];ls||(ls=[]);var Fs=rs-1,Ps=0,As=0;for(Ps=us;Ps>=0;){ls[Ps]=!0,ps[ps.length]=Ps,Rs.push(zr[Ps]);var Ms=Qr[Math.floor(Ps*4/rs)];if(As=Ps*4&Fs,rs<4+As)throw new Error("FAT boundary crossed: "+Ps+" 4 "+rs);if(!zr[Ms])break;Ps=__readInt32LE(zr[Ms],As)}return{nodes:ps,data:__toBuffer([Rs])}}function wr(zr,us,Qr,rs){var ls=zr.length,ps=[],Rs=[],Fs=[],Ps=[],As=rs-1,Ms=0,Gs=0,Xs=0,_a=0;for(Ms=0;Ms<ls;++Ms)if(Fs=[],Xs=Ms+us,Xs>=ls&&(Xs-=ls),!Rs[Xs]){Ps=[];var Ks=[];for(Gs=Xs;Gs>=0;){Ks[Gs]=!0,Rs[Gs]=!0,Fs[Fs.length]=Gs,Ps.push(zr[Gs]);var ba=Qr[Math.floor(Gs*4/rs)];if(_a=Gs*4&As,rs<4+_a)throw new Error("FAT boundary crossed: "+Gs+" 4 "+rs);if(!zr[ba]||(Gs=__readInt32LE(zr[ba],_a),Ks[Gs]))break}ps[Xs]={nodes:Fs,data:__toBuffer([Ps])}}return ps}function Sr(zr,us,Qr,rs,ls,ps,Rs,Fs){for(var Ps=0,As=rs.length?2:0,Ms=us[zr].data,Gs=0,Xs=0,_a;Gs<Ms.length;Gs+=128){var Ks=Ms.slice(Gs,Gs+128);prep_blob(Ks,64),Xs=Ks.read_shift(2),_a=__utf16le(Ks,0,Xs-As),rs.push(_a);var ba={name:_a,type:Ks.read_shift(1),color:Ks.read_shift(1),L:Ks.read_shift(4,"i"),R:Ks.read_shift(4,"i"),C:Ks.read_shift(4,"i"),clsid:Ks.read_shift(16),state:Ks.read_shift(4,"i"),start:0,size:0},so=Ks.read_shift(2)+Ks.read_shift(2)+Ks.read_shift(2)+Ks.read_shift(2);so!==0&&(ba.ct=Tr(Ks,Ks.l-8));var ao=Ks.read_shift(2)+Ks.read_shift(2)+Ks.read_shift(2)+Ks.read_shift(2);ao!==0&&(ba.mt=Tr(Ks,Ks.l-8)),ba.start=Ks.read_shift(4,"i"),ba.size=Ks.read_shift(4,"i"),ba.size<0&&ba.start<0&&(ba.size=ba.type=0,ba.start=Hr,ba.name=""),ba.type===5?(Ps=ba.start,ls>0&&Ps!==Hr&&(us[Ps].name="!StreamData")):ba.size>=4096?(ba.storage="fat",us[ba.start]===void 0&&(us[ba.start]=jr(Qr,ba.start,us.fat_addrs,us.ssz)),us[ba.start].name=ba.name,ba.content=us[ba.start].data.slice(0,ba.size)):(ba.storage="minifat",ba.size<0?ba.size=0:Ps!==Hr&&ba.start!==Hr&&us[Ps]&&(ba.content=br(ba,us[Ps].data,(us[Fs]||{}).data))),ba.content&&prep_blob(ba.content,0),ps[_a]=ba,Rs.push(ba)}}function Tr(zr,us){return new Date((__readUInt32LE(zr,us+4)/1e7*Math.pow(2,32)+__readUInt32LE(zr,us)/1e7-11644473600)*1e3)}function Rr(zr,us){return fr(),xr(mr.readFileSync(zr),us)}function Nr(zr,us){var Qr=us&&us.type;switch(Qr||has_buf&&Buffer.isBuffer(zr)&&(Qr="buffer"),Qr||"base64"){case"file":return Rr(zr,us);case"base64":return xr(s2a(Base64_decode(zr)),us);case"binary":return xr(s2a(zr),us)}return xr(zr,us)}function Cr(zr,us){var Qr=us||{},rs=Qr.root||"Root Entry";if(zr.FullPaths||(zr.FullPaths=[]),zr.FileIndex||(zr.FileIndex=[]),zr.FullPaths.length!==zr.FileIndex.length)throw new Error("inconsistent CFB structure");zr.FullPaths.length===0&&(zr.FullPaths[0]=rs+"/",zr.FileIndex[0]={name:rs,type:5}),Qr.CLSID&&(zr.FileIndex[0].clsid=Qr.CLSID),kr(zr)}function kr(zr){var us="Sh33tJ5";if(!CFB.find(zr,"/"+us)){var Qr=new_buf(4);Qr[0]=55,Qr[1]=Qr[3]=50,Qr[2]=54,zr.FileIndex.push({name:us,type:2,content:Qr,size:4,L:69,R:69,C:69}),zr.FullPaths.push(zr.FullPaths[0]+us),Ar(zr)}}function Ar(zr,us){Cr(zr);for(var Qr=!1,rs=!1,ls=zr.FullPaths.length-1;ls>=0;--ls){var ps=zr.FileIndex[ls];switch(ps.type){case 0:rs?Qr=!0:(zr.FileIndex.pop(),zr.FullPaths.pop());break;case 1:case 2:case 5:rs=!0,isNaN(ps.R*ps.L*ps.C)&&(Qr=!0),ps.R>-1&&ps.L>-1&&ps.R==ps.L&&(Qr=!0);break;default:Qr=!0;break}}if(!(!Qr&&!us)){var Rs=new Date(1987,1,19),Fs=0,Ps=Object.create?Object.create(null):{},As=[];for(ls=0;ls<zr.FullPaths.length;++ls)Ps[zr.FullPaths[ls]]=!0,zr.FileIndex[ls].type!==0&&As.push([zr.FullPaths[ls],zr.FileIndex[ls]]);for(ls=0;ls<As.length;++ls){var Ms=cr(As[ls][0]);rs=Ps[Ms],rs||(As.push([Ms,{name:ur(Ms).replace("/",""),type:1,clsid:Zr,ct:Rs,mt:Rs,content:null}]),Ps[Ms]=!0)}for(As.sort(function(_a,Ks){return lr(_a[0],Ks[0])}),zr.FullPaths=[],zr.FileIndex=[],ls=0;ls<As.length;++ls)zr.FullPaths[ls]=As[ls][0],zr.FileIndex[ls]=As[ls][1];for(ls=0;ls<As.length;++ls){var Gs=zr.FileIndex[ls],Xs=zr.FullPaths[ls];if(Gs.name=ur(Xs).replace("/",""),Gs.L=Gs.R=Gs.C=-(Gs.color=1),Gs.size=Gs.content?Gs.content.length:0,Gs.start=0,Gs.clsid=Gs.clsid||Zr,ls===0)Gs.C=As.length>1?1:-1,Gs.size=0,Gs.type=5;else if(Xs.slice(-1)=="/"){for(Fs=ls+1;Fs<As.length&&cr(zr.FullPaths[Fs])!=Xs;++Fs);for(Gs.C=Fs>=As.length?-1:Fs,Fs=ls+1;Fs<As.length&&cr(zr.FullPaths[Fs])!=cr(Xs);++Fs);Gs.R=Fs>=As.length?-1:Fs,Gs.type=1}else cr(zr.FullPaths[ls+1]||"")==cr(Xs)&&(Gs.R=ls+1),Gs.type=2}}}function Or(zr,us){var Qr=us||{};if(Qr.fileType=="mad")return Ls(zr,Qr);switch(Ar(zr),Qr.fileType){case"zip":return Os(zr,Qr)}var rs=function(_a){for(var Ks=0,ba=0,so=0;so<_a.FileIndex.length;++so){var ao=_a.FileIndex[so];if(ao.content){var oo=ao.content.length;oo>0&&(oo<4096?Ks+=oo+63>>6:ba+=oo+511>>9)}}for(var lo=_a.FullPaths.length+3>>2,yo=Ks+7>>3,bo=Ks+127>>7,jo=yo+ba+lo+bo,po=jo+127>>7,Vo=po<=109?0:Math.ceil((po-109)/127);jo+po+Vo+127>>7>po;)Vo=++po<=109?0:Math.ceil((po-109)/127);var uo=[1,Vo,po,bo,lo,ba,Ks,0];return _a.FileIndex[0].size=Ks<<6,uo[7]=(_a.FileIndex[0].start=uo[0]+uo[1]+uo[2]+uo[3]+uo[4]+uo[5])+(uo[6]+7>>3),uo}(zr),ls=new_buf(rs[7]<<9),ps=0,Rs=0;{for(ps=0;ps<8;++ps)ls.write_shift(1,Gr[ps]);for(ps=0;ps<8;++ps)ls.write_shift(2,0);for(ls.write_shift(2,62),ls.write_shift(2,3),ls.write_shift(2,65534),ls.write_shift(2,9),ls.write_shift(2,6),ps=0;ps<3;++ps)ls.write_shift(2,0);for(ls.write_shift(4,0),ls.write_shift(4,rs[2]),ls.write_shift(4,rs[0]+rs[1]+rs[2]+rs[3]-1),ls.write_shift(4,0),ls.write_shift(4,4096),ls.write_shift(4,rs[3]?rs[0]+rs[1]+rs[2]-1:Hr),ls.write_shift(4,rs[3]),ls.write_shift(-4,rs[1]?rs[0]-1:Hr),ls.write_shift(4,rs[1]),ps=0;ps<109;++ps)ls.write_shift(-4,ps<rs[2]?rs[1]+ps:-1)}if(rs[1])for(Rs=0;Rs<rs[1];++Rs){for(;ps<236+Rs*127;++ps)ls.write_shift(-4,ps<rs[2]?rs[1]+ps:-1);ls.write_shift(-4,Rs===rs[1]-1?Hr:Rs+1)}var Fs=function(_a){for(Rs+=_a;ps<Rs-1;++ps)ls.write_shift(-4,ps+1);_a&&(++ps,ls.write_shift(-4,Hr))};for(Rs=ps=0,Rs+=rs[1];ps<Rs;++ps)ls.write_shift(-4,Jr.DIFSECT);for(Rs+=rs[2];ps<Rs;++ps)ls.write_shift(-4,Jr.FATSECT);Fs(rs[3]),Fs(rs[4]);for(var Ps=0,As=0,Ms=zr.FileIndex[0];Ps<zr.FileIndex.length;++Ps)Ms=zr.FileIndex[Ps],Ms.content&&(As=Ms.content.length,!(As<4096)&&(Ms.start=Rs,Fs(As+511>>9)));for(Fs(rs[6]+7>>3);ls.l&511;)ls.write_shift(-4,Jr.ENDOFCHAIN);for(Rs=ps=0,Ps=0;Ps<zr.FileIndex.length;++Ps)Ms=zr.FileIndex[Ps],Ms.content&&(As=Ms.content.length,!(!As||As>=4096)&&(Ms.start=Rs,Fs(As+63>>6)));for(;ls.l&511;)ls.write_shift(-4,Jr.ENDOFCHAIN);for(ps=0;ps<rs[4]<<2;++ps){var Gs=zr.FullPaths[ps];if(!Gs||Gs.length===0){for(Ps=0;Ps<17;++Ps)ls.write_shift(4,0);for(Ps=0;Ps<3;++Ps)ls.write_shift(4,-1);for(Ps=0;Ps<12;++Ps)ls.write_shift(4,0);continue}Ms=zr.FileIndex[ps],ps===0&&(Ms.start=Ms.size?Ms.start-1:Hr);var Xs=ps===0&&Qr.root||Ms.name;if(As=2*(Xs.length+1),ls.write_shift(64,Xs,"utf16le"),ls.write_shift(2,As),ls.write_shift(1,Ms.type),ls.write_shift(1,Ms.color),ls.write_shift(-4,Ms.L),ls.write_shift(-4,Ms.R),ls.write_shift(-4,Ms.C),Ms.clsid)ls.write_shift(16,Ms.clsid,"hex");else for(Ps=0;Ps<4;++Ps)ls.write_shift(4,0);ls.write_shift(4,Ms.state||0),ls.write_shift(4,0),ls.write_shift(4,0),ls.write_shift(4,0),ls.write_shift(4,0),ls.write_shift(4,Ms.start),ls.write_shift(4,Ms.size),ls.write_shift(4,0)}for(ps=1;ps<zr.FileIndex.length;++ps)if(Ms=zr.FileIndex[ps],Ms.size>=4096)if(ls.l=Ms.start+1<<9,has_buf&&Buffer.isBuffer(Ms.content))Ms.content.copy(ls,ls.l,0,Ms.size),ls.l+=Ms.size+511&-512;else{for(Ps=0;Ps<Ms.size;++Ps)ls.write_shift(1,Ms.content[Ps]);for(;Ps&511;++Ps)ls.write_shift(1,0)}for(ps=1;ps<zr.FileIndex.length;++ps)if(Ms=zr.FileIndex[ps],Ms.size>0&&Ms.size<4096)if(has_buf&&Buffer.isBuffer(Ms.content))Ms.content.copy(ls,ls.l,0,Ms.size),ls.l+=Ms.size+63&-64;else{for(Ps=0;Ps<Ms.size;++Ps)ls.write_shift(1,Ms.content[Ps]);for(;Ps&63;++Ps)ls.write_shift(1,0)}if(has_buf)ls.l=ls.length;else for(;ls.l<ls.length;)ls.write_shift(1,0);return ls}function Lr(zr,us){var Qr=zr.FullPaths.map(function(Ps){return Ps.toUpperCase()}),rs=Qr.map(function(Ps){var As=Ps.split("/");return As[As.length-(Ps.slice(-1)=="/"?2:1)]}),ls=!1;us.charCodeAt(0)===47?(ls=!0,us=Qr[0].slice(0,-1)+us):ls=us.indexOf("/")!==-1;var ps=us.toUpperCase(),Rs=ls===!0?Qr.indexOf(ps):rs.indexOf(ps);if(Rs!==-1)return zr.FileIndex[Rs];var Fs=!ps.match(chr1);for(ps=ps.replace(chr0,""),Fs&&(ps=ps.replace(chr1,"!")),Rs=0;Rs<Qr.length;++Rs)if((Fs?Qr[Rs].replace(chr1,"!"):Qr[Rs]).replace(chr0,"")==ps||(Fs?rs[Rs].replace(chr1,"!"):rs[Rs]).replace(chr0,"")==ps)return zr.FileIndex[Rs];return null}var Fr=64,Hr=-2,Kr="d0cf11e0a1b11ae1",Gr=[208,207,17,224,161,177,26,225],Zr="00000000000000000000000000000000",Jr={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:Hr,FREESECT:-1,HEADER_SIGNATURE:Kr,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:Zr,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function os(zr,us,Qr){fr();var rs=Or(zr,Qr);mr.writeFileSync(us,rs)}function Ur(zr){for(var us=new Array(zr.length),Qr=0;Qr<zr.length;++Qr)us[Qr]=String.fromCharCode(zr[Qr]);return us.join("")}function Vr(zr,us){var Qr=Or(zr,us);switch(us&&us.type||"buffer"){case"file":return fr(),mr.writeFileSync(us.filename,Qr),Qr;case"binary":return typeof Qr=="string"?Qr:Ur(Qr);case"base64":return Base64_encode(typeof Qr=="string"?Qr:Ur(Qr));case"buffer":if(has_buf)return Buffer.isBuffer(Qr)?Qr:Buffer_from(Qr);case"array":return typeof Qr=="string"?s2a(Qr):Qr}return Qr}var es;function Ir(zr){try{var us=zr.InflateRaw,Qr=new us;if(Qr._processChunk(new Uint8Array([3,0]),Qr._finishFlushFlag),Qr.bytesRead)es=zr;else throw new Error("zlib does not expose bytesRead")}catch(rs){console.error("cannot use native zlib: "+(rs.message||rs))}}function Dr(zr,us){if(!es)return qs(zr,us);var Qr=es.InflateRaw,rs=new Qr,ls=rs._processChunk(zr.slice(zr.l),rs._finishFlushFlag);return zr.l+=rs.bytesRead,ls}function Pr(zr){return es?es.deflateRawSync(zr):$a(zr)}var Mr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Br=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Xr=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function Wr(zr){var us=(zr<<1|zr<<11)&139536|(zr<<5|zr<<15)&558144;return(us>>16|us>>8|us)&255}for(var ss=typeof Uint8Array<"u",ds=ss?new Uint8Array(256):[],ns=0;ns<256;++ns)ds[ns]=Wr(ns);function fs(zr,us){var Qr=ds[zr&255];return us<=8?Qr>>>8-us:(Qr=Qr<<8|ds[zr>>8&255],us<=16?Qr>>>16-us:(Qr=Qr<<8|ds[zr>>16&255],Qr>>>24-us))}function bs(zr,us){var Qr=us&7,rs=us>>>3;return(zr[rs]|(Qr<=6?0:zr[rs+1]<<8))>>>Qr&3}function Es(zr,us){var Qr=us&7,rs=us>>>3;return(zr[rs]|(Qr<=5?0:zr[rs+1]<<8))>>>Qr&7}function Ds(zr,us){var Qr=us&7,rs=us>>>3;return(zr[rs]|(Qr<=4?0:zr[rs+1]<<8))>>>Qr&15}function gs(zr,us){var Qr=us&7,rs=us>>>3;return(zr[rs]|(Qr<=3?0:zr[rs+1]<<8))>>>Qr&31}function as(zr,us){var Qr=us&7,rs=us>>>3;return(zr[rs]|(Qr<=1?0:zr[rs+1]<<8))>>>Qr&127}function qr(zr,us,Qr){var rs=us&7,ls=us>>>3,ps=(1<<Qr)-1,Rs=zr[ls]>>>rs;return Qr<8-rs||(Rs|=zr[ls+1]<<8-rs,Qr<16-rs)||(Rs|=zr[ls+2]<<16-rs,Qr<24-rs)||(Rs|=zr[ls+3]<<24-rs),Rs&ps}function ts(zr,us,Qr){var rs=us&7,ls=us>>>3;return rs<=5?zr[ls]|=(Qr&7)<<rs:(zr[ls]|=Qr<<rs&255,zr[ls+1]=(Qr&7)>>8-rs),us+3}function Yr(zr,us,Qr){var rs=us&7,ls=us>>>3;return Qr=(Qr&1)<<rs,zr[ls]|=Qr,us+1}function hs(zr,us,Qr){var rs=us&7,ls=us>>>3;return Qr<<=rs,zr[ls]|=Qr&255,Qr>>>=8,zr[ls+1]=Qr,us+8}function ys(zr,us,Qr){var rs=us&7,ls=us>>>3;return Qr<<=rs,zr[ls]|=Qr&255,Qr>>>=8,zr[ls+1]=Qr&255,zr[ls+2]=Qr>>>8,us+16}function _s(zr,us){var Qr=zr.length,rs=2*Qr>us?2*Qr:us+5,ls=0;if(Qr>=us)return zr;if(has_buf){var ps=new_unsafe_buf(rs);if(zr.copy)zr.copy(ps);else for(;ls<zr.length;++ls)ps[ls]=zr[ls];return ps}else if(ss){var Rs=new Uint8Array(rs);if(Rs.set)Rs.set(zr);else for(;ls<Qr;++ls)Rs[ls]=zr[ls];return Rs}return zr.length=rs,zr}function Ss(zr){for(var us=new Array(zr),Qr=0;Qr<zr;++Qr)us[Qr]=0;return us}function vs(zr,us,Qr){var rs=1,ls=0,ps=0,Rs=0,Fs=0,Ps=zr.length,As=ss?new Uint16Array(32):Ss(32);for(ps=0;ps<32;++ps)As[ps]=0;for(ps=Ps;ps<Qr;++ps)zr[ps]=0;Ps=zr.length;var Ms=ss?new Uint16Array(Ps):Ss(Ps);for(ps=0;ps<Ps;++ps)As[ls=zr[ps]]++,rs<ls&&(rs=ls),Ms[ps]=0;for(As[0]=0,ps=1;ps<=rs;++ps)As[ps+16]=Fs=Fs+As[ps-1]<<1;for(ps=0;ps<Ps;++ps)Fs=zr[ps],Fs!=0&&(Ms[ps]=As[Fs+16]++);var Gs=0;for(ps=0;ps<Ps;++ps)if(Gs=zr[ps],Gs!=0)for(Fs=fs(Ms[ps],rs)>>rs-Gs,Rs=(1<<rs+4-Gs)-1;Rs>=0;--Rs)us[Fs|Rs<<Gs]=Gs&15|ps<<4;return rs}var Hs=ss?new Uint16Array(512):Ss(512),Bs=ss?new Uint16Array(32):Ss(32);if(!ss){for(var na=0;na<512;++na)Hs[na]=0;for(na=0;na<32;++na)Bs[na]=0}(function(){for(var zr=[],us=0;us<32;us++)zr.push(5);vs(zr,Bs,32);var Qr=[];for(us=0;us<=143;us++)Qr.push(8);for(;us<=255;us++)Qr.push(9);for(;us<=279;us++)Qr.push(7);for(;us<=287;us++)Qr.push(8);vs(Qr,Hs,288)})();var Js=function(){for(var us=ss?new Uint8Array(32768):[],Qr=0,rs=0;Qr<Xr.length-1;++Qr)for(;rs<Xr[Qr+1];++rs)us[rs]=Qr;for(;rs<32768;++rs)us[rs]=29;var ls=ss?new Uint8Array(259):[];for(Qr=0,rs=0;Qr<Br.length-1;++Qr)for(;rs<Br[Qr+1];++rs)ls[rs]=Qr;function ps(Fs,Ps){for(var As=0;As<Fs.length;){var Ms=Math.min(65535,Fs.length-As),Gs=As+Ms==Fs.length;for(Ps.write_shift(1,+Gs),Ps.write_shift(2,Ms),Ps.write_shift(2,~Ms&65535);Ms-- >0;)Ps[Ps.l++]=Fs[As++]}return Ps.l}function Rs(Fs,Ps){for(var As=0,Ms=0,Gs=ss?new Uint16Array(32768):[];Ms<Fs.length;){var Xs=Math.min(65535,Fs.length-Ms);if(Xs<10){for(As=ts(Ps,As,+(Ms+Xs==Fs.length)),As&7&&(As+=8-(As&7)),Ps.l=As/8|0,Ps.write_shift(2,Xs),Ps.write_shift(2,~Xs&65535);Xs-- >0;)Ps[Ps.l++]=Fs[Ms++];As=Ps.l*8;continue}As=ts(Ps,As,+(Ms+Xs==Fs.length)+2);for(var _a=0;Xs-- >0;){var Ks=Fs[Ms];_a=(_a<<5^Ks)&32767;var ba=-1,so=0;if((ba=Gs[_a])&&(ba|=Ms&-32768,ba>Ms&&(ba-=32768),ba<Ms))for(;Fs[ba+so]==Fs[Ms+so]&&so<250;)++so;if(so>2){Ks=ls[so],Ks<=22?As=hs(Ps,As,ds[Ks+1]>>1)-1:(hs(Ps,As,3),As+=5,hs(Ps,As,ds[Ks-23]>>5),As+=3);var ao=Ks<8?0:Ks-4>>2;ao>0&&(ys(Ps,As,so-Br[Ks]),As+=ao),Ks=us[Ms-ba],As=hs(Ps,As,ds[Ks]>>3),As-=3;var oo=Ks<4?0:Ks-2>>1;oo>0&&(ys(Ps,As,Ms-ba-Xr[Ks]),As+=oo);for(var lo=0;lo<so;++lo)Gs[_a]=Ms&32767,_a=(_a<<5^Fs[Ms])&32767,++Ms;Xs-=so-1}else Ks<=143?Ks=Ks+48:As=Yr(Ps,As,1),As=hs(Ps,As,ds[Ks]),Gs[_a]=Ms&32767,++Ms}As=hs(Ps,As,0)-1}return Ps.l=(As+7)/8|0,Ps.l}return function(Ps,As){return Ps.length<8?ps(Ps,As):Rs(Ps,As)}}();function $a(zr){var us=new_buf(50+Math.floor(zr.length*1.1)),Qr=Js(zr,us);return us.slice(0,Qr)}var Vs=ss?new Uint16Array(32768):Ss(32768),xa=ss?new Uint16Array(32768):Ss(32768),ro=ss?new Uint16Array(128):Ss(128),no=1,Us=1;function Cs(zr,us){var Qr=gs(zr,us)+257;us+=5;var rs=gs(zr,us)+1;us+=5;var ls=Ds(zr,us)+4;us+=4;for(var ps=0,Rs=ss?new Uint8Array(19):Ss(19),Fs=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ps=1,As=ss?new Uint8Array(8):Ss(8),Ms=ss?new Uint8Array(8):Ss(8),Gs=Rs.length,Xs=0;Xs<ls;++Xs)Rs[Mr[Xs]]=ps=Es(zr,us),Ps<ps&&(Ps=ps),As[ps]++,us+=3;var _a=0;for(As[0]=0,Xs=1;Xs<=Ps;++Xs)Ms[Xs]=_a=_a+As[Xs-1]<<1;for(Xs=0;Xs<Gs;++Xs)(_a=Rs[Xs])!=0&&(Fs[Xs]=Ms[_a]++);var Ks=0;for(Xs=0;Xs<Gs;++Xs)if(Ks=Rs[Xs],Ks!=0){_a=ds[Fs[Xs]]>>8-Ks;for(var ba=(1<<7-Ks)-1;ba>=0;--ba)ro[_a|ba<<Ks]=Ks&7|Xs<<3}var so=[];for(Ps=1;so.length<Qr+rs;)switch(_a=ro[as(zr,us)],us+=_a&7,_a>>>=3){case 16:for(ps=3+bs(zr,us),us+=2,_a=so[so.length-1];ps-- >0;)so.push(_a);break;case 17:for(ps=3+Es(zr,us),us+=3;ps-- >0;)so.push(0);break;case 18:for(ps=11+as(zr,us),us+=7;ps-- >0;)so.push(0);break;default:so.push(_a),Ps<_a&&(Ps=_a);break}var ao=so.slice(0,Qr),oo=so.slice(Qr);for(Xs=Qr;Xs<286;++Xs)ao[Xs]=0;for(Xs=rs;Xs<30;++Xs)oo[Xs]=0;return no=vs(ao,Vs,286),Us=vs(oo,xa,30),us}function Ts(zr,us){if(zr[0]==3&&!(zr[1]&3))return[new_raw_buf(us),2];for(var Qr=0,rs=0,ls=new_unsafe_buf(us||1<<18),ps=0,Rs=ls.length>>>0,Fs=0,Ps=0;!(rs&1);){if(rs=Es(zr,Qr),Qr+=3,rs>>>1)rs>>1==1?(Fs=9,Ps=5):(Qr=Cs(zr,Qr),Fs=no,Ps=Us);else{Qr&7&&(Qr+=8-(Qr&7));var As=zr[Qr>>>3]|zr[(Qr>>>3)+1]<<8;if(Qr+=32,As>0)for(!us&&Rs<ps+As&&(ls=_s(ls,ps+As),Rs=ls.length);As-- >0;)ls[ps++]=zr[Qr>>>3],Qr+=8;continue}for(;;){!us&&Rs<ps+32767&&(ls=_s(ls,ps+32767),Rs=ls.length);var Ms=qr(zr,Qr,Fs),Gs=rs>>>1==1?Hs[Ms]:Vs[Ms];if(Qr+=Gs&15,Gs>>>=4,!(Gs>>>8&255))ls[ps++]=Gs;else{if(Gs==256)break;Gs-=257;var Xs=Gs<8?0:Gs-4>>2;Xs>5&&(Xs=0);var _a=ps+Br[Gs];Xs>0&&(_a+=qr(zr,Qr,Xs),Qr+=Xs),Ms=qr(zr,Qr,Ps),Gs=rs>>>1==1?Bs[Ms]:xa[Ms],Qr+=Gs&15,Gs>>>=4;var Ks=Gs<4?0:Gs-2>>1,ba=Xr[Gs];for(Ks>0&&(ba+=qr(zr,Qr,Ks),Qr+=Ks),!us&&Rs<_a&&(ls=_s(ls,_a+100),Rs=ls.length);ps<_a;)ls[ps]=ls[ps-ba],++ps}}}return us?[ls,Qr+7>>>3]:[ls.slice(0,ps),Qr+7>>>3]}function qs(zr,us){var Qr=zr.slice(zr.l||0),rs=Ts(Qr,us);return zr.l+=rs[1],rs[0]}function to(zr,us){if(zr)typeof console<"u"&&console.error(us);else throw new Error(us)}function eo(zr,us){var Qr=zr;prep_blob(Qr,0);var rs=[],ls=[],ps={FileIndex:rs,FullPaths:ls};Cr(ps,{root:us.root});for(var Rs=Qr.length-4;(Qr[Rs]!=80||Qr[Rs+1]!=75||Qr[Rs+2]!=5||Qr[Rs+3]!=6)&&Rs>=0;)--Rs;Qr.l=Rs+4,Qr.l+=4;var Fs=Qr.read_shift(2);Qr.l+=6;var Ps=Qr.read_shift(4);for(Qr.l=Ps,Rs=0;Rs<Fs;++Rs){Qr.l+=20;var As=Qr.read_shift(4),Ms=Qr.read_shift(4),Gs=Qr.read_shift(2),Xs=Qr.read_shift(2),_a=Qr.read_shift(2);Qr.l+=8;var Ks=Qr.read_shift(4),ba=pr(Qr.slice(Qr.l+Gs,Qr.l+Gs+Xs));Qr.l+=Gs+Xs+_a;var so=Qr.l;Qr.l=Ks+4,xs(Qr,As,Ms,ps,ba),Qr.l=so}return ps}function xs(zr,us,Qr,rs,ls){zr.l+=2;var ps=zr.read_shift(2),Rs=zr.read_shift(2),Fs=hr(zr);if(ps&8257)throw new Error("Unsupported ZIP encryption");for(var Ps=zr.read_shift(4),As=zr.read_shift(4),Ms=zr.read_shift(4),Gs=zr.read_shift(2),Xs=zr.read_shift(2),_a="",Ks=0;Ks<Gs;++Ks)_a+=String.fromCharCode(zr[zr.l++]);if(Xs){var ba=pr(zr.slice(zr.l,zr.l+Xs));(ba[21589]||{}).mt&&(Fs=ba[21589].mt),((ls||{})[21589]||{}).mt&&(Fs=ls[21589].mt)}zr.l+=Xs;var so=zr.slice(zr.l,zr.l+As);switch(Rs){case 8:so=Dr(zr,Ms);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Rs)}var ao=!1;ps&8&&(Ps=zr.read_shift(4),Ps==134695760&&(Ps=zr.read_shift(4),ao=!0),As=zr.read_shift(4),Ms=zr.read_shift(4)),As!=us&&to(ao,"Bad compressed size: "+us+" != "+As),Ms!=Qr&&to(ao,"Bad uncompressed size: "+Qr+" != "+Ms),$s(rs,_a,so,{unsafe:!0,mt:Fs})}function Os(zr,us){var Qr=us||{},rs=[],ls=[],ps=new_buf(1),Rs=Qr.compression?8:0,Fs=0,Ps=0,As=0,Ms=0,Gs=0,Xs=zr.FullPaths[0],_a=Xs,Ks=zr.FileIndex[0],ba=[],so=0;for(Ps=1;Ps<zr.FullPaths.length;++Ps)if(_a=zr.FullPaths[Ps].slice(Xs.length),Ks=zr.FileIndex[Ps],!(!Ks.size||!Ks.content||_a=="Sh33tJ5")){var ao=Ms,oo=new_buf(_a.length);for(As=0;As<_a.length;++As)oo.write_shift(1,_a.charCodeAt(As)&127);oo=oo.slice(0,oo.l),ba[Gs]=CRC32.buf(Ks.content,0);var lo=Ks.content;Rs==8&&(lo=Pr(lo)),ps=new_buf(30),ps.write_shift(4,67324752),ps.write_shift(2,20),ps.write_shift(2,Fs),ps.write_shift(2,Rs),Ks.mt?dr(ps,Ks.mt):ps.write_shift(4,0),ps.write_shift(-4,ba[Gs]),ps.write_shift(4,lo.length),ps.write_shift(4,Ks.content.length),ps.write_shift(2,oo.length),ps.write_shift(2,0),Ms+=ps.length,rs.push(ps),Ms+=oo.length,rs.push(oo),Ms+=lo.length,rs.push(lo),ps=new_buf(46),ps.write_shift(4,33639248),ps.write_shift(2,0),ps.write_shift(2,20),ps.write_shift(2,Fs),ps.write_shift(2,Rs),ps.write_shift(4,0),ps.write_shift(-4,ba[Gs]),ps.write_shift(4,lo.length),ps.write_shift(4,Ks.content.length),ps.write_shift(2,oo.length),ps.write_shift(2,0),ps.write_shift(2,0),ps.write_shift(2,0),ps.write_shift(2,0),ps.write_shift(4,0),ps.write_shift(4,ao),so+=ps.l,ls.push(ps),so+=oo.length,ls.push(oo),++Gs}return ps=new_buf(22),ps.write_shift(4,101010256),ps.write_shift(2,0),ps.write_shift(2,0),ps.write_shift(2,Gs),ps.write_shift(2,Gs),ps.write_shift(4,so),ps.write_shift(4,Ms),ps.write_shift(2,0),bconcat([bconcat(rs),bconcat(ls),ps])}var zs={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Zs(zr,us){if(zr.ctype)return zr.ctype;var Qr=zr.name||"",rs=Qr.match(/\.([^\.]+)$/);return rs&&zs[rs[1]]||us&&(rs=(Qr=us).match(/[\.\\]([^\.\\])+$/),rs&&zs[rs[1]])?zs[rs[1]]:"application/octet-stream"}function ga(zr){for(var us=Base64_encode(zr),Qr=[],rs=0;rs<us.length;rs+=76)Qr.push(us.slice(rs,rs+76));return Qr.join(`\r
`)+`\r
`}function Ys(zr){var us=zr.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(As){var Ms=As.charCodeAt(0).toString(16).toUpperCase();return"="+(Ms.length==1?"0"+Ms:Ms)});us=us.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),us.charAt(0)==`
`&&(us="=0D"+us.slice(1)),us=us.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var Qr=[],rs=us.split(`\r
`),ls=0;ls<rs.length;++ls){var ps=rs[ls];if(ps.length==0){Qr.push("");continue}for(var Rs=0;Rs<ps.length;){var Fs=76,Ps=ps.slice(Rs,Rs+Fs);Ps.charAt(Fs-1)=="="?Fs--:Ps.charAt(Fs-2)=="="?Fs-=2:Ps.charAt(Fs-3)=="="&&(Fs-=3),Ps=ps.slice(Rs,Rs+Fs),Rs+=Fs,Rs<ps.length&&(Ps+="="),Qr.push(Ps)}}return Qr.join(`\r
`)}function ms(zr){for(var us=[],Qr=0;Qr<zr.length;++Qr){for(var rs=zr[Qr];Qr<=zr.length&&rs.charAt(rs.length-1)=="=";)rs=rs.slice(0,rs.length-1)+zr[++Qr];us.push(rs)}for(var ls=0;ls<us.length;++ls)us[ls]=us[ls].replace(/[=][0-9A-Fa-f]{2}/g,function(ps){return String.fromCharCode(parseInt(ps.slice(1),16))});return s2a(us.join(`\r
`))}function cs(zr,us,Qr){for(var rs="",ls="",ps="",Rs,Fs=0;Fs<10;++Fs){var Ps=us[Fs];if(!Ps||Ps.match(/^\s*$/))break;var As=Ps.match(/^(.*?):\s*([^\s].*)$/);if(As)switch(As[1].toLowerCase()){case"content-location":rs=As[2].trim();break;case"content-type":ps=As[2].trim();break;case"content-transfer-encoding":ls=As[2].trim();break}}switch(++Fs,ls.toLowerCase()){case"base64":Rs=s2a(Base64_decode(us.slice(Fs).join("")));break;case"quoted-printable":Rs=ms(us.slice(Fs));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+ls)}var Ms=$s(zr,rs.slice(Qr.length),Rs,{unsafe:!0});ps&&(Ms.ctype=ps)}function js(zr,us){if(Ur(zr.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var Qr=us&&us.root||"",rs=(has_buf&&Buffer.isBuffer(zr)?zr.toString("binary"):Ur(zr)).split(`\r
`),ls=0,ps="";for(ls=0;ls<rs.length;++ls)if(ps=rs[ls],!!/^Content-Location:/i.test(ps)&&(ps=ps.slice(ps.indexOf("file")),Qr||(Qr=ps.slice(0,ps.lastIndexOf("/")+1)),ps.slice(0,Qr.length)!=Qr))for(;Qr.length>0&&(Qr=Qr.slice(0,Qr.length-1),Qr=Qr.slice(0,Qr.lastIndexOf("/")+1),ps.slice(0,Qr.length)!=Qr););var Rs=(rs[1]||"").match(/boundary="(.*?)"/);if(!Rs)throw new Error("MAD cannot find boundary");var Fs="--"+(Rs[1]||""),Ps=[],As=[],Ms={FileIndex:Ps,FullPaths:As};Cr(Ms);var Gs,Xs=0;for(ls=0;ls<rs.length;++ls){var _a=rs[ls];_a!==Fs&&_a!==Fs+"--"||(Xs++&&cs(Ms,rs.slice(Gs,ls),Qr),Gs=ls)}return Ms}function Ls(zr,us){var Qr=us||{},rs=Qr.boundary||"SheetJS";rs="------="+rs;for(var ls=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+rs.slice(2)+'"',"","",""],ps=zr.FullPaths[0],Rs=ps,Fs=zr.FileIndex[0],Ps=1;Ps<zr.FullPaths.length;++Ps)if(Rs=zr.FullPaths[Ps].slice(ps.length),Fs=zr.FileIndex[Ps],!(!Fs.size||!Fs.content||Rs=="Sh33tJ5")){Rs=Rs.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(so){return"_x"+so.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(so){return"_u"+so.charCodeAt(0).toString(16)+"_"});for(var As=Fs.content,Ms=has_buf&&Buffer.isBuffer(As)?As.toString("binary"):Ur(As),Gs=0,Xs=Math.min(1024,Ms.length),_a=0,Ks=0;Ks<=Xs;++Ks)(_a=Ms.charCodeAt(Ks))>=32&&_a<128&&++Gs;var ba=Gs>=Xs*4/5;ls.push(rs),ls.push("Content-Location: "+(Qr.root||"file:///C:/SheetJS/")+Rs),ls.push("Content-Transfer-Encoding: "+(ba?"quoted-printable":"base64")),ls.push("Content-Type: "+Zs(Fs,Rs)),ls.push(""),ls.push(ba?Ys(Ms):ga(Ms))}return ls.push(rs+`--\r
`),ls.join(`\r
`)}function Is(zr){var us={};return Cr(us,zr),us}function $s(zr,us,Qr,rs){var ls=rs&&rs.unsafe;ls||Cr(zr);var ps=!ls&&CFB.find(zr,us);if(!ps){var Rs=zr.FullPaths[0];us.slice(0,Rs.length)==Rs?Rs=us:(Rs.slice(-1)!="/"&&(Rs+="/"),Rs=(Rs+us).replace("//","/")),ps={name:ur(us),type:2},zr.FileIndex.push(ps),zr.FullPaths.push(Rs),ls||CFB.utils.cfb_gc(zr)}return ps.content=Qr,ps.size=Qr?Qr.length:0,rs&&(rs.CLSID&&(ps.clsid=rs.CLSID),rs.mt&&(ps.mt=rs.mt),rs.ct&&(ps.ct=rs.ct)),ps}function Ws(zr,us){Cr(zr);var Qr=CFB.find(zr,us);if(Qr){for(var rs=0;rs<zr.FileIndex.length;++rs)if(zr.FileIndex[rs]==Qr)return zr.FileIndex.splice(rs,1),zr.FullPaths.splice(rs,1),!0}return!1}function _i(zr,us,Qr){Cr(zr);var rs=CFB.find(zr,us);if(rs){for(var ls=0;ls<zr.FileIndex.length;++ls)if(zr.FileIndex[ls]==rs)return zr.FileIndex[ls].name=ur(Qr),zr.FullPaths[ls]=Qr,!0}return!1}function Qs(zr){Ar(zr,!0)}return or.find=Lr,or.read=Nr,or.parse=xr,or.write=Vr,or.writeFile=os,or.utils={cfb_new:Is,cfb_add:$s,cfb_del:Ws,cfb_mov:_i,cfb_gc:Qs,ReadShift,CheckField,prep_blob,bconcat,use_zlib:Ir,_deflateRaw:$a,_inflateRaw:qs,consts:Jr},or}();function blobify(ar){return typeof ar=="string"?s2ab(ar):Array.isArray(ar)?a2u(ar):ar}function write_dl(ar,or,lr){if(typeof Deno<"u"){if(lr&&typeof or=="string")switch(lr){case"utf8":or=new TextEncoder(lr).encode(or);break;case"binary":or=s2ab(or);break;default:throw new Error("Unsupported encoding "+lr)}return Deno.writeFileSync(ar,or)}var cr=lr=="utf8"?utf8write(or):or;if(typeof IE_SaveFile<"u")return IE_SaveFile(cr,ar);if(typeof Blob<"u"){var ur=new Blob([blobify(cr)],{type:"application/octet-stream"});if(typeof navigator<"u"&&navigator.msSaveBlob)return navigator.msSaveBlob(ur,ar);if(typeof saveAs<"u")return saveAs(ur,ar);if(typeof URL<"u"&&typeof document<"u"&&document.createElement&&URL.createObjectURL){var dr=URL.createObjectURL(ur);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(dr)},6e4),chrome.downloads.download({url:dr,filename:ar,saveAs:!0});var hr=document.createElement("a");if(hr.download!=null)return hr.download=ar,hr.href=dr,document.body.appendChild(hr),hr.click(),document.body.removeChild(hr),URL.revokeObjectURL&&typeof setTimeout<"u"&&setTimeout(function(){URL.revokeObjectURL(dr)},6e4),dr}}if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var pr=File(ar);return pr.open("w"),pr.encoding="binary",Array.isArray(or)&&(or=a2s(or)),pr.write(or),pr.close(),or}catch(mr){if(!mr.message||!mr.message.match(/onstruct/))throw mr}throw new Error("cannot save file "+ar)}function keys(ar){for(var or=Object.keys(ar),lr=[],cr=0;cr<or.length;++cr)Object.prototype.hasOwnProperty.call(ar,or[cr])&&lr.push(or[cr]);return lr}function evert_key(ar,or){for(var lr=[],cr=keys(ar),ur=0;ur!==cr.length;++ur)lr[ar[cr[ur]][or]]==null&&(lr[ar[cr[ur]][or]]=cr[ur]);return lr}function evert(ar){for(var or=[],lr=keys(ar),cr=0;cr!==lr.length;++cr)or[ar[lr[cr]]]=lr[cr];return or}function evert_num(ar){for(var or=[],lr=keys(ar),cr=0;cr!==lr.length;++cr)or[ar[lr[cr]]]=parseInt(lr[cr],10);return or}function evert_arr(ar){for(var or=[],lr=keys(ar),cr=0;cr!==lr.length;++cr)or[ar[lr[cr]]]==null&&(or[ar[lr[cr]]]=[]),or[ar[lr[cr]]].push(lr[cr]);return or}var basedate=new Date(1899,11,30,0,0,0);function datenum(ar,or){var lr=ar.getTime(),cr=basedate.getTime()+(ar.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4;return(lr-cr)/(24*60*60*1e3)}var refdate=new Date,dnthresh=basedate.getTime()+(refdate.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4,refoffset=refdate.getTimezoneOffset();function numdate(ar){var or=new Date;return or.setTime(ar*24*60*60*1e3+dnthresh),or.getTimezoneOffset()!==refoffset&&or.setTime(or.getTime()+(or.getTimezoneOffset()-refoffset)*6e4),or}var good_pd_date_1=new Date("2017-02-19T19:06:09.000Z"),good_pd_date=isNaN(good_pd_date_1.getFullYear())?new Date("2/19/17"):good_pd_date_1,good_pd=good_pd_date.getFullYear()==2017;function parseDate(ar,or){var lr=new Date(ar);if(good_pd)return or>0?lr.setTime(lr.getTime()+lr.getTimezoneOffset()*60*1e3):or<0&&lr.setTime(lr.getTime()-lr.getTimezoneOffset()*60*1e3),lr;if(ar instanceof Date)return ar;if(good_pd_date.getFullYear()==1917&&!isNaN(lr.getFullYear())){var cr=lr.getFullYear();return ar.indexOf(""+cr)>-1||lr.setFullYear(lr.getFullYear()+100),lr}var ur=ar.match(/\d+/g)||["2017","2","19","0","0","0"],dr=new Date(+ur[0],+ur[1]-1,+ur[2],+ur[3]||0,+ur[4]||0,+ur[5]||0);return ar.indexOf("Z")>-1&&(dr=new Date(dr.getTime()-dr.getTimezoneOffset()*60*1e3)),dr}function cc2str(ar,or){if(has_buf&&Buffer.isBuffer(ar))return ar.toString("binary");if(typeof TextDecoder<"u")try{var lr={"":"","":"",:"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"","":"","":"","":"","":"","":"","":"","":"","":"","":"",:"","":"",:"",:"",:""};return Array.isArray(ar)&&(ar=new Uint8Array(ar)),new TextDecoder("latin1").decode(ar).replace(/[]/g,function(dr){return lr[dr]||dr})}catch{}for(var cr=[],ur=0;ur!=ar.length;++ur)cr.push(String.fromCharCode(ar[ur]));return cr.join("")}function dup(ar){if(typeof JSON<"u"&&!Array.isArray(ar))return JSON.parse(JSON.stringify(ar));if(typeof ar!="object"||ar==null)return ar;if(ar instanceof Date)return new Date(ar.getTime());var or={};for(var lr in ar)Object.prototype.hasOwnProperty.call(ar,lr)&&(or[lr]=dup(ar[lr]));return or}function fill(ar,or){for(var lr="";lr.length<or;)lr+=ar;return lr}function fuzzynum(ar){var or=Number(ar);if(!isNaN(or))return isFinite(or)?or:NaN;if(!/\d/.test(ar))return or;var lr=1,cr=ar.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return lr*=100,""});return!isNaN(or=Number(cr))||(cr=cr.replace(/[(](.*)[)]/,function(ur,dr){return lr=-lr,dr}),!isNaN(or=Number(cr)))?or/lr:or}var lower_months=["january","february","march","april","may","june","july","august","september","october","november","december"];function fuzzydate(ar){var or=new Date(ar),lr=new Date(NaN),cr=or.getYear(),ur=or.getMonth(),dr=or.getDate();if(isNaN(dr))return lr;var hr=ar.toLowerCase();if(hr.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(hr=hr.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),hr.length>3&&lower_months.indexOf(hr)==-1)return lr}else if(hr.match(/[a-z]/))return lr;return cr<0||cr>8099?lr:(ur>0||dr>1)&&cr!=101?or:ar.match(/[^-0-9:,\/\\]/)?lr:or}function zip_add_file(ar,or,lr){if(ar.FullPaths){if(typeof lr=="string"){var cr;return has_buf?cr=Buffer_from(lr):cr=utf8decode(lr),CFB.utils.cfb_add(ar,or,cr)}CFB.utils.cfb_add(ar,or,lr)}else ar.file(or,lr)}function zip_new(){return CFB.utils.cfb_new()}var XML_HEADER=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},rencoding=evert(encodings),decregex=/[&<>'"]/g,charegex=/[\u0000-\u0008\u000b-\u001f]/g;function escapexml(ar){var or=ar+"";return or.replace(decregex,function(lr){return rencoding[lr]}).replace(charegex,function(lr){return"_x"+("000"+lr.charCodeAt(0).toString(16)).slice(-4)+"_"})}function escapexmltag(ar){return escapexml(ar).replace(/ /g,"_x0020_")}var htmlcharegex=/[\u0000-\u001f]/g;function escapehtml(ar){var or=ar+"";return or.replace(decregex,function(lr){return rencoding[lr]}).replace(/\n/g,"<br/>").replace(htmlcharegex,function(lr){return"&#x"+("000"+lr.charCodeAt(0).toString(16)).slice(-4)+";"})}function escapexlml(ar){var or=ar+"";return or.replace(decregex,function(lr){return rencoding[lr]}).replace(htmlcharegex,function(lr){return"&#x"+lr.charCodeAt(0).toString(16).toUpperCase()+";"})}function xlml_unfixstr(ar){return ar.replace(/(\r\n|[\r\n])/g,"&#10;")}function parsexmlbool(ar){switch(ar){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function utf8reada(ar){for(var or="",lr=0,cr=0,ur=0,dr=0,hr=0,pr=0;lr<ar.length;){if(cr=ar.charCodeAt(lr++),cr<128){or+=String.fromCharCode(cr);continue}if(ur=ar.charCodeAt(lr++),cr>191&&cr<224){hr=(cr&31)<<6,hr|=ur&63,or+=String.fromCharCode(hr);continue}if(dr=ar.charCodeAt(lr++),cr<240){or+=String.fromCharCode((cr&15)<<12|(ur&63)<<6|dr&63);continue}hr=ar.charCodeAt(lr++),pr=((cr&7)<<18|(ur&63)<<12|(dr&63)<<6|hr&63)-65536,or+=String.fromCharCode(55296+(pr>>>10&1023)),or+=String.fromCharCode(56320+(pr&1023))}return or}function utf8readb(ar){var or=new_raw_buf(2*ar.length),lr,cr,ur=1,dr=0,hr=0,pr;for(cr=0;cr<ar.length;cr+=ur)ur=1,(pr=ar.charCodeAt(cr))<128?lr=pr:pr<224?(lr=(pr&31)*64+(ar.charCodeAt(cr+1)&63),ur=2):pr<240?(lr=(pr&15)*4096+(ar.charCodeAt(cr+1)&63)*64+(ar.charCodeAt(cr+2)&63),ur=3):(ur=4,lr=(pr&7)*262144+(ar.charCodeAt(cr+1)&63)*4096+(ar.charCodeAt(cr+2)&63)*64+(ar.charCodeAt(cr+3)&63),lr-=65536,hr=55296+(lr>>>10&1023),lr=56320+(lr&1023)),hr!==0&&(or[dr++]=hr&255,or[dr++]=hr>>>8,hr=0),or[dr++]=lr%256,or[dr++]=lr>>>8;return or.slice(0,dr).toString("ucs2")}function utf8readc(ar){return Buffer_from(ar,"binary").toString("utf8")}var utf8corpus="foo bar baz",utf8read=has_buf&&(utf8readc(utf8corpus)==utf8reada(utf8corpus)&&utf8readc||utf8readb(utf8corpus)==utf8reada(utf8corpus)&&utf8readb)||utf8reada,utf8write=has_buf?function(ar){return Buffer_from(ar,"utf8").toString("binary")}:function(ar){for(var or=[],lr=0,cr=0,ur=0;lr<ar.length;)switch(cr=ar.charCodeAt(lr++),!0){case cr<128:or.push(String.fromCharCode(cr));break;case cr<2048:or.push(String.fromCharCode(192+(cr>>6))),or.push(String.fromCharCode(128+(cr&63)));break;case(cr>=55296&&cr<57344):cr-=55296,ur=ar.charCodeAt(lr++)-56320+(cr<<10),or.push(String.fromCharCode(240+(ur>>18&7))),or.push(String.fromCharCode(144+(ur>>12&63))),or.push(String.fromCharCode(128+(ur>>6&63))),or.push(String.fromCharCode(128+(ur&63)));break;default:or.push(String.fromCharCode(224+(cr>>12))),or.push(String.fromCharCode(128+(cr>>6&63))),or.push(String.fromCharCode(128+(cr&63)))}return or.join("")},htmldecode=function(){var ar=[["nbsp"," "],["middot",""],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(or){return[new RegExp("&"+or[0]+";","ig"),or[1]]});return function(lr){for(var cr=lr.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),ur=0;ur<ar.length;++ur)cr=cr.replace(ar[ur][0],ar[ur][1]);return cr}}(),wtregex=/(^\s|\s$|\n)/;function writetag(ar,or){return"<"+ar+(or.match(wtregex)?' xml:space="preserve"':"")+">"+or+"</"+ar+">"}function wxt_helper(ar){return keys(ar).map(function(or){return" "+or+'="'+ar[or]+'"'}).join("")}function writextag(ar,or,lr){return"<"+ar+(lr!=null?wxt_helper(lr):"")+(or!=null?(or.match(wtregex)?' xml:space="preserve"':"")+">"+or+"</"+ar:"/")+">"}function write_w3cdtf(ar,or){try{return ar.toISOString().replace(/\.\d*/,"")}catch(lr){if(or)throw lr}return""}function write_vt(ar,or){switch(typeof ar){case"string":var lr=writextag("vt:lpwstr",escapexml(ar));return lr=lr.replace(/&quot;/g,"_x0022_"),lr;case"number":return writextag((ar|0)==ar?"vt:i4":"vt:r8",escapexml(String(ar)));case"boolean":return writextag("vt:bool",ar?"true":"false")}if(ar instanceof Date)return writextag("vt:filetime",write_w3cdtf(ar));throw new Error("Unable to serialize "+ar)}var XMLNS={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},XMLNS_main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],XLMLNS={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function read_double_le(ar,or){for(var lr=1-2*(ar[or+7]>>>7),cr=((ar[or+7]&127)<<4)+(ar[or+6]>>>4&15),ur=ar[or+6]&15,dr=5;dr>=0;--dr)ur=ur*256+ar[or+dr];return cr==2047?ur==0?lr*(1/0):NaN:(cr==0?cr=-1022:(cr-=1023,ur+=Math.pow(2,52)),lr*Math.pow(2,cr-52)*ur)}function write_double_le(ar,or,lr){var cr=(or<0||1/or==-1/0?1:0)<<7,ur=0,dr=0,hr=cr?-or:or;isFinite(hr)?hr==0?ur=dr=0:(ur=Math.floor(Math.log(hr)/Math.LN2),dr=hr*Math.pow(2,52-ur),ur<=-1023&&(!isFinite(dr)||dr<Math.pow(2,52))?ur=-1022:(dr-=Math.pow(2,52),ur+=1023)):(ur=2047,dr=isNaN(or)?26985:0);for(var pr=0;pr<=5;++pr,dr/=256)ar[lr+pr]=dr&255;ar[lr+6]=(ur&15)<<4|dr&15,ar[lr+7]=ur>>4|cr}var ___toBuffer=function(ar){for(var or=[],lr=10240,cr=0;cr<ar[0].length;++cr)if(ar[0][cr])for(var ur=0,dr=ar[0][cr].length;ur<dr;ur+=lr)or.push.apply(or,ar[0][cr].slice(ur,ur+lr));return or},__toBuffer=has_buf?function(ar){return ar[0].length>0&&Buffer.isBuffer(ar[0][0])?Buffer.concat(ar[0].map(function(or){return Buffer.isBuffer(or)?or:Buffer_from(or)})):___toBuffer(ar)}:___toBuffer,___utf16le=function(ar,or,lr){for(var cr=[],ur=or;ur<lr;ur+=2)cr.push(String.fromCharCode(__readUInt16LE(ar,ur)));return cr.join("").replace(chr0,"")},__utf16le=has_buf?function(ar,or,lr){return Buffer.isBuffer(ar)?ar.toString("utf16le",or,lr).replace(chr0,""):___utf16le(ar,or,lr)}:___utf16le,___hexlify=function(ar,or,lr){for(var cr=[],ur=or;ur<or+lr;++ur)cr.push(("0"+ar[ur].toString(16)).slice(-2));return cr.join("")},__hexlify=has_buf?function(ar,or,lr){return Buffer.isBuffer(ar)?ar.toString("hex",or,or+lr):___hexlify(ar,or,lr)}:___hexlify,___utf8=function(ar,or,lr){for(var cr=[],ur=or;ur<lr;ur++)cr.push(String.fromCharCode(__readUInt8(ar,ur)));return cr.join("")},__utf8=has_buf?function ar(or,lr,cr){return Buffer.isBuffer(or)?or.toString("utf8",lr,cr):___utf8(or,lr,cr)}:___utf8,___lpstr=function(ar,or){var lr=__readUInt32LE(ar,or);return lr>0?__utf8(ar,or+4,or+4+lr-1):""},__lpstr=___lpstr,___cpstr=function(ar,or){var lr=__readUInt32LE(ar,or);return lr>0?__utf8(ar,or+4,or+4+lr-1):""},__cpstr=___cpstr,___lpwstr=function(ar,or){var lr=2*__readUInt32LE(ar,or);return lr>0?__utf8(ar,or+4,or+4+lr-1):""},__lpwstr=___lpwstr,___lpp4=function ar(or,lr){var cr=__readUInt32LE(or,lr);return cr>0?__utf16le(or,lr+4,lr+4+cr):""},__lpp4=___lpp4,___8lpp4=function(ar,or){var lr=__readUInt32LE(ar,or);return lr>0?__utf8(ar,or+4,or+4+lr):""},__8lpp4=___8lpp4,___double=function(ar,or){return read_double_le(ar,or)},__double=___double,is_buf=function ar(or){return Array.isArray(or)||typeof Uint8Array<"u"&&or instanceof Uint8Array};has_buf&&(__lpstr=function(or,lr){if(!Buffer.isBuffer(or))return ___lpstr(or,lr);var cr=or.readUInt32LE(lr);return cr>0?or.toString("utf8",lr+4,lr+4+cr-1):""},__cpstr=function(or,lr){if(!Buffer.isBuffer(or))return ___cpstr(or,lr);var cr=or.readUInt32LE(lr);return cr>0?or.toString("utf8",lr+4,lr+4+cr-1):""},__lpwstr=function(or,lr){if(!Buffer.isBuffer(or))return ___lpwstr(or,lr);var cr=2*or.readUInt32LE(lr);return or.toString("utf16le",lr+4,lr+4+cr-1)},__lpp4=function(or,lr){if(!Buffer.isBuffer(or))return ___lpp4(or,lr);var cr=or.readUInt32LE(lr);return or.toString("utf16le",lr+4,lr+4+cr)},__8lpp4=function(or,lr){if(!Buffer.isBuffer(or))return ___8lpp4(or,lr);var cr=or.readUInt32LE(lr);return or.toString("utf8",lr+4,lr+4+cr)},__double=function(or,lr){return Buffer.isBuffer(or)?or.readDoubleLE(lr):___double(or,lr)},is_buf=function(or){return Buffer.isBuffer(or)||Array.isArray(or)||typeof Uint8Array<"u"&&or instanceof Uint8Array});var __readUInt8=function(ar,or){return ar[or]},__readUInt16LE=function(ar,or){return ar[or+1]*256+ar[or]},__readInt16LE=function(ar,or){var lr=ar[or+1]*256+ar[or];return lr<32768?lr:(65535-lr+1)*-1},__readUInt32LE=function(ar,or){return ar[or+3]*(1<<24)+(ar[or+2]<<16)+(ar[or+1]<<8)+ar[or]},__readInt32LE=function(ar,or){return ar[or+3]<<24|ar[or+2]<<16|ar[or+1]<<8|ar[or]},__readInt32BE=function(ar,or){return ar[or]<<24|ar[or+1]<<16|ar[or+2]<<8|ar[or+3]};function ReadShift(ar,or){var lr="",cr,ur,dr=[],hr,pr,mr,fr;switch(or){case"dbcs":if(fr=this.l,has_buf&&Buffer.isBuffer(this))lr=this.slice(this.l,this.l+2*ar).toString("utf16le");else for(mr=0;mr<ar;++mr)lr+=String.fromCharCode(__readUInt16LE(this,fr)),fr+=2;ar*=2;break;case"utf8":lr=__utf8(this,this.l,this.l+ar);break;case"utf16le":ar*=2,lr=__utf16le(this,this.l,this.l+ar);break;case"wstr":return ReadShift.call(this,ar,"dbcs");case"lpstr-ansi":lr=__lpstr(this,this.l),ar=4+__readUInt32LE(this,this.l);break;case"lpstr-cp":lr=__cpstr(this,this.l),ar=4+__readUInt32LE(this,this.l);break;case"lpwstr":lr=__lpwstr(this,this.l),ar=4+2*__readUInt32LE(this,this.l);break;case"lpp4":ar=4+__readUInt32LE(this,this.l),lr=__lpp4(this,this.l),ar&2&&(ar+=2);break;case"8lpp4":ar=4+__readUInt32LE(this,this.l),lr=__8lpp4(this,this.l),ar&3&&(ar+=4-(ar&3));break;case"cstr":for(ar=0,lr="";(hr=__readUInt8(this,this.l+ar++))!==0;)dr.push(_getchar(hr));lr=dr.join("");break;case"_wstr":for(ar=0,lr="";(hr=__readUInt16LE(this,this.l+ar))!==0;)dr.push(_getchar(hr)),ar+=2;ar+=2,lr=dr.join("");break;case"dbcs-cont":for(lr="",fr=this.l,mr=0;mr<ar;++mr){if(this.lens&&this.lens.indexOf(fr)!==-1)return hr=__readUInt8(this,fr),this.l=fr+1,pr=ReadShift.call(this,ar-mr,hr?"dbcs-cont":"sbcs-cont"),dr.join("")+pr;dr.push(_getchar(__readUInt16LE(this,fr))),fr+=2}lr=dr.join(""),ar*=2;break;case"cpstr":case"sbcs-cont":for(lr="",fr=this.l,mr=0;mr!=ar;++mr){if(this.lens&&this.lens.indexOf(fr)!==-1)return hr=__readUInt8(this,fr),this.l=fr+1,pr=ReadShift.call(this,ar-mr,hr?"dbcs-cont":"sbcs-cont"),dr.join("")+pr;dr.push(_getchar(__readUInt8(this,fr))),fr+=1}lr=dr.join("");break;default:switch(ar){case 1:return cr=__readUInt8(this,this.l),this.l++,cr;case 2:return cr=(or==="i"?__readInt16LE:__readUInt16LE)(this,this.l),this.l+=2,cr;case 4:case-4:return or==="i"||!(this[this.l+3]&128)?(cr=(ar>0?__readInt32LE:__readInt32BE)(this,this.l),this.l+=4,cr):(ur=__readUInt32LE(this,this.l),this.l+=4,ur);case 8:case-8:if(or==="f")return ar==8?ur=__double(this,this.l):ur=__double([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,ur;ar=8;case 16:lr=__hexlify(this,this.l,ar);break}}return this.l+=ar,lr}var __writeUInt32LE=function(ar,or,lr){ar[lr]=or&255,ar[lr+1]=or>>>8&255,ar[lr+2]=or>>>16&255,ar[lr+3]=or>>>24&255},__writeInt32LE=function(ar,or,lr){ar[lr]=or&255,ar[lr+1]=or>>8&255,ar[lr+2]=or>>16&255,ar[lr+3]=or>>24&255},__writeUInt16LE=function(ar,or,lr){ar[lr]=or&255,ar[lr+1]=or>>>8&255};function WriteShift(ar,or,lr){var cr=0,ur=0;if(lr==="dbcs"){for(ur=0;ur!=or.length;++ur)__writeUInt16LE(this,or.charCodeAt(ur),this.l+2*ur);cr=2*or.length}else if(lr==="sbcs"){for(or=or.replace(/[^\x00-\x7F]/g,"_"),ur=0;ur!=or.length;++ur)this[this.l+ur]=or.charCodeAt(ur)&255;cr=or.length}else if(lr==="hex"){for(;ur<ar;++ur)this[this.l++]=parseInt(or.slice(2*ur,2*ur+2),16)||0;return this}else if(lr==="utf16le"){var dr=Math.min(this.l+ar,this.length);for(ur=0;ur<Math.min(or.length,ar);++ur){var hr=or.charCodeAt(ur);this[this.l++]=hr&255,this[this.l++]=hr>>8}for(;this.l<dr;)this[this.l++]=0;return this}else switch(ar){case 1:cr=1,this[this.l]=or&255;break;case 2:cr=2,this[this.l]=or&255,or>>>=8,this[this.l+1]=or&255;break;case 3:cr=3,this[this.l]=or&255,or>>>=8,this[this.l+1]=or&255,or>>>=8,this[this.l+2]=or&255;break;case 4:cr=4,__writeUInt32LE(this,or,this.l);break;case 8:if(cr=8,lr==="f"){write_double_le(this,or,this.l);break}case 16:break;case-4:cr=4,__writeInt32LE(this,or,this.l);break}return this.l+=cr,this}function CheckField(ar,or){var lr=__hexlify(this,this.l,ar.length>>1);if(lr!==ar)throw new Error(or+"Expected "+ar+" saw "+lr);this.l+=ar.length>>1}function prep_blob(ar,or){ar.l=or,ar.read_shift=ReadShift,ar.chk=CheckField,ar.write_shift=WriteShift}function parsenoop(ar,or){ar.l+=or}function new_buf(ar){var or=new_raw_buf(ar);return prep_blob(or,0),or}function buf_array(){var ar=[],or=has_buf?256:2048,lr=function(fr){var xr=new_buf(fr);return prep_blob(xr,0),xr},cr=lr(or),ur=function(){cr&&(cr.length>cr.l&&(cr=cr.slice(0,cr.l),cr.l=cr.length),cr.length>0&&ar.push(cr),cr=null)},dr=function(fr){return cr&&fr<cr.length-cr.l?cr:(ur(),cr=lr(Math.max(fr+1,or)))},hr=function(){return ur(),bconcat(ar)},pr=function(fr){ur(),cr=fr,cr.l==null&&(cr.l=cr.length),dr(or)};return{next:dr,push:pr,end:hr,_bufs:ar}}function write_record(ar,or,lr,cr){var ur=+or,dr;if(!isNaN(ur)){cr||(cr=XLSBRecordEnum[ur].p||(lr||[]).length||0),dr=1+(ur>=128?1:0)+1,cr>=128&&++dr,cr>=16384&&++dr,cr>=2097152&&++dr;var hr=ar.next(dr);ur<=127?hr.write_shift(1,ur):(hr.write_shift(1,(ur&127)+128),hr.write_shift(1,ur>>7));for(var pr=0;pr!=4;++pr)if(cr>=128)hr.write_shift(1,(cr&127)+128),cr>>=7;else{hr.write_shift(1,cr);break}cr>0&&is_buf(lr)&&ar.push(lr)}}function shift_cell_xls(ar,or,lr){var cr=dup(ar);if(or.s?(cr.cRel&&(cr.c+=or.s.c),cr.rRel&&(cr.r+=or.s.r)):(cr.cRel&&(cr.c+=or.c),cr.rRel&&(cr.r+=or.r)),!lr||lr.biff<12){for(;cr.c>=256;)cr.c-=256;for(;cr.r>=65536;)cr.r-=65536}return cr}function shift_range_xls(ar,or,lr){var cr=dup(ar);return cr.s=shift_cell_xls(cr.s,or.s,lr),cr.e=shift_cell_xls(cr.e,or.s,lr),cr}function encode_cell_xls(ar,or){if(ar.cRel&&ar.c<0)for(ar=dup(ar);ar.c<0;)ar.c+=or>8?16384:256;if(ar.rRel&&ar.r<0)for(ar=dup(ar);ar.r<0;)ar.r+=or>8?1048576:or>5?65536:16384;var lr=encode_cell(ar);return!ar.cRel&&ar.cRel!=null&&(lr=fix_col(lr)),!ar.rRel&&ar.rRel!=null&&(lr=fix_row(lr)),lr}function encode_range_xls(ar,or){return ar.s.r==0&&!ar.s.rRel&&ar.e.r==(or.biff>=12?1048575:or.biff>=8?65536:16384)&&!ar.e.rRel?(ar.s.cRel?"":"$")+encode_col(ar.s.c)+":"+(ar.e.cRel?"":"$")+encode_col(ar.e.c):ar.s.c==0&&!ar.s.cRel&&ar.e.c==(or.biff>=12?16383:255)&&!ar.e.cRel?(ar.s.rRel?"":"$")+encode_row(ar.s.r)+":"+(ar.e.rRel?"":"$")+encode_row(ar.e.r):encode_cell_xls(ar.s,or.biff)+":"+encode_cell_xls(ar.e,or.biff)}function decode_row(ar){return parseInt(unfix_row(ar),10)-1}function encode_row(ar){return""+(ar+1)}function fix_row(ar){return ar.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function unfix_row(ar){return ar.replace(/\$(\d+)$/,"$1")}function decode_col(ar){for(var or=unfix_col(ar),lr=0,cr=0;cr!==or.length;++cr)lr=26*lr+or.charCodeAt(cr)-64;return lr-1}function encode_col(ar){if(ar<0)throw new Error("invalid column "+ar);var or="";for(++ar;ar;ar=Math.floor((ar-1)/26))or=String.fromCharCode((ar-1)%26+65)+or;return or}function fix_col(ar){return ar.replace(/^([A-Z])/,"$$$1")}function unfix_col(ar){return ar.replace(/^\$([A-Z])/,"$1")}function split_cell(ar){return ar.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(ar){for(var or=0,lr=0,cr=0;cr<ar.length;++cr){var ur=ar.charCodeAt(cr);ur>=48&&ur<=57?or=10*or+(ur-48):ur>=65&&ur<=90&&(lr=26*lr+(ur-64))}return{c:lr-1,r:or-1}}function encode_cell(ar){for(var or=ar.c+1,lr="";or;or=(or-1)/26|0)lr=String.fromCharCode((or-1)%26+65)+lr;return lr+(ar.r+1)}function decode_range(ar){var or=ar.indexOf(":");return or==-1?{s:decode_cell(ar),e:decode_cell(ar)}:{s:decode_cell(ar.slice(0,or)),e:decode_cell(ar.slice(or+1))}}function encode_range(ar,or){return typeof or>"u"||typeof or=="number"?encode_range(ar.s,ar.e):(typeof ar!="string"&&(ar=encode_cell(ar)),typeof or!="string"&&(or=encode_cell(or)),ar==or?ar:ar+":"+or)}function safe_decode_range(ar){var or={s:{c:0,r:0},e:{c:0,r:0}},lr=0,cr=0,ur=0,dr=ar.length;for(lr=0;cr<dr&&!((ur=ar.charCodeAt(cr)-64)<1||ur>26);++cr)lr=26*lr+ur;for(or.s.c=--lr,lr=0;cr<dr&&!((ur=ar.charCodeAt(cr)-48)<0||ur>9);++cr)lr=10*lr+ur;if(or.s.r=--lr,cr===dr||ur!=10)return or.e.c=or.s.c,or.e.r=or.s.r,or;for(++cr,lr=0;cr!=dr&&!((ur=ar.charCodeAt(cr)-64)<1||ur>26);++cr)lr=26*lr+ur;for(or.e.c=--lr,lr=0;cr!=dr&&!((ur=ar.charCodeAt(cr)-48)<0||ur>9);++cr)lr=10*lr+ur;return or.e.r=--lr,or}function safe_format_cell(ar,or){var lr=ar.t=="d"&&or instanceof Date;if(ar.z!=null)try{return ar.w=SSF_format(ar.z,lr?datenum(or):or)}catch{}try{return ar.w=SSF_format((ar.XF||{}).numFmtId||(lr?14:0),lr?datenum(or):or)}catch{return""+or}}function format_cell(ar,or,lr){return ar==null||ar.t==null||ar.t=="z"?"":ar.w!==void 0?ar.w:(ar.t=="d"&&!ar.z&&lr&&lr.dateNF&&(ar.z=lr.dateNF),ar.t=="e"?BErr[ar.v]||ar.v:or==null?safe_format_cell(ar,ar.v):safe_format_cell(ar,or))}function sheet_to_workbook(ar,or){var lr=or&&or.sheet?or.sheet:"Sheet1",cr={};return cr[lr]=ar,{SheetNames:[lr],Sheets:cr}}function sheet_add_aoa(ar,or,lr){var cr=lr||{},ur=ar?Array.isArray(ar):cr.dense,dr=ar||(ur?[]:{}),hr=0,pr=0;if(dr&&cr.origin!=null){if(typeof cr.origin=="number")hr=cr.origin;else{var mr=typeof cr.origin=="string"?decode_cell(cr.origin):cr.origin;hr=mr.r,pr=mr.c}dr["!ref"]||(dr["!ref"]="A1:A1")}var fr={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(dr["!ref"]){var xr=safe_decode_range(dr["!ref"]);fr.s.c=xr.s.c,fr.s.r=xr.s.r,fr.e.c=Math.max(fr.e.c,xr.e.c),fr.e.r=Math.max(fr.e.r,xr.e.r),hr==-1&&(fr.e.r=hr=xr.e.r+1)}for(var Er=0;Er!=or.length;++Er)if(or[Er]){if(!Array.isArray(or[Er]))throw new Error("aoa_to_sheet expects an array of arrays");for(var vr=0;vr!=or[Er].length;++vr)if(!(typeof or[Er][vr]>"u")){var gr={v:or[Er][vr]},yr=hr+Er,br=pr+vr;if(fr.s.r>yr&&(fr.s.r=yr),fr.s.c>br&&(fr.s.c=br),fr.e.r<yr&&(fr.e.r=yr),fr.e.c<br&&(fr.e.c=br),or[Er][vr]&&typeof or[Er][vr]=="object"&&!Array.isArray(or[Er][vr])&&!(or[Er][vr]instanceof Date))gr=or[Er][vr];else if(Array.isArray(gr.v)&&(gr.f=or[Er][vr][1],gr.v=gr.v[0]),gr.v===null)if(gr.f)gr.t="n";else if(cr.nullError)gr.t="e",gr.v=0;else if(cr.sheetStubs)gr.t="z";else continue;else typeof gr.v=="number"?gr.t="n":typeof gr.v=="boolean"?gr.t="b":gr.v instanceof Date?(gr.z=cr.dateNF||table_fmt[14],cr.cellDates?(gr.t="d",gr.w=SSF_format(gr.z,datenum(gr.v))):(gr.t="n",gr.v=datenum(gr.v),gr.w=SSF_format(gr.z,gr.v))):gr.t="s";if(ur)dr[yr]||(dr[yr]=[]),dr[yr][br]&&dr[yr][br].z&&(gr.z=dr[yr][br].z),dr[yr][br]=gr;else{var _r=encode_cell({c:br,r:yr});dr[_r]&&dr[_r].z&&(gr.z=dr[_r].z),dr[_r]=gr}}}return fr.s.c<1e7&&(dr["!ref"]=encode_range(fr)),dr}function aoa_to_sheet(ar,or){return sheet_add_aoa(null,ar,or)}function parse_Int32LE(ar){return ar.read_shift(4,"i")}function write_UInt32LE(ar,or){return or||(or=new_buf(4)),or.write_shift(4,ar),or}function parse_XLWideString(ar){var or=ar.read_shift(4);return or===0?"":ar.read_shift(or,"dbcs")}function write_XLWideString(ar,or){var lr=!1;return or==null&&(lr=!0,or=new_buf(4+2*ar.length)),or.write_shift(4,ar.length),ar.length>0&&or.write_shift(0,ar,"dbcs"),lr?or.slice(0,or.l):or}function parse_StrRun(ar){return{ich:ar.read_shift(2),ifnt:ar.read_shift(2)}}function write_StrRun(ar,or){return or||(or=new_buf(4)),or.write_shift(2,0),or.write_shift(2,0),or}function parse_RichStr(ar,or){var lr=ar.l,cr=ar.read_shift(1),ur=parse_XLWideString(ar),dr=[],hr={t:ur,h:ur};if(cr&1){for(var pr=ar.read_shift(4),mr=0;mr!=pr;++mr)dr.push(parse_StrRun(ar));hr.r=dr}else hr.r=[{ich:0,ifnt:0}];return ar.l=lr+or,hr}function write_RichStr(ar,or){var lr=!1;return or==null&&(lr=!0,or=new_buf(15+4*ar.t.length)),or.write_shift(1,0),write_XLWideString(ar.t,or),lr?or.slice(0,or.l):or}var parse_BrtCommentText=parse_RichStr;function write_BrtCommentText(ar,or){var lr=!1;return or==null&&(lr=!0,or=new_buf(23+4*ar.t.length)),or.write_shift(1,1),write_XLWideString(ar.t,or),or.write_shift(4,1),write_StrRun({},or),lr?or.slice(0,or.l):or}function parse_XLSBCell(ar){var or=ar.read_shift(4),lr=ar.read_shift(2);return lr+=ar.read_shift(1)<<16,ar.l++,{c:or,iStyleRef:lr}}function write_XLSBCell(ar,or){return or==null&&(or=new_buf(8)),or.write_shift(-4,ar.c),or.write_shift(3,ar.iStyleRef||ar.s),or.write_shift(1,0),or}function parse_XLSBShortCell(ar){var or=ar.read_shift(2);return or+=ar.read_shift(1)<<16,ar.l++,{c:-1,iStyleRef:or}}function write_XLSBShortCell(ar,or){return or==null&&(or=new_buf(4)),or.write_shift(3,ar.iStyleRef||ar.s),or.write_shift(1,0),or}var parse_XLSBCodeName=parse_XLWideString,write_XLSBCodeName=write_XLWideString;function parse_XLNullableWideString(ar){var or=ar.read_shift(4);return or===0||or===4294967295?"":ar.read_shift(or,"dbcs")}function write_XLNullableWideString(ar,or){var lr=!1;return or==null&&(lr=!0,or=new_buf(127)),or.write_shift(4,ar.length>0?ar.length:4294967295),ar.length>0&&or.write_shift(0,ar,"dbcs"),lr?or.slice(0,or.l):or}var parse_XLNameWideString=parse_XLWideString,parse_RelID=parse_XLNullableWideString,write_RelID=write_XLNullableWideString;function parse_RkNumber(ar){var or=ar.slice(ar.l,ar.l+4),lr=or[0]&1,cr=or[0]&2;ar.l+=4;var ur=cr===0?__double([0,0,0,0,or[0]&252,or[1],or[2],or[3]],0):__readInt32LE(or,0)>>2;return lr?ur/100:ur}function write_RkNumber(ar,or){or==null&&(or=new_buf(4));var lr=0,cr=0,ur=ar*100;if(ar==(ar|0)&&ar>=-536870912&&ar<1<<29?cr=1:ur==(ur|0)&&ur>=-536870912&&ur<1<<29&&(cr=1,lr=1),cr)or.write_shift(-4,((lr?ur:ar)<<2)+(lr+2));else throw new Error("unsupported RkNumber "+ar)}function parse_RfX(ar){var or={s:{},e:{}};return or.s.r=ar.read_shift(4),or.e.r=ar.read_shift(4),or.s.c=ar.read_shift(4),or.e.c=ar.read_shift(4),or}function write_RfX(ar,or){return or||(or=new_buf(16)),or.write_shift(4,ar.s.r),or.write_shift(4,ar.e.r),or.write_shift(4,ar.s.c),or.write_shift(4,ar.e.c),or}var parse_UncheckedRfX=parse_RfX,write_UncheckedRfX=write_RfX;function parse_Xnum(ar){if(ar.length-ar.l<8)throw"XLS Xnum Buffer underflow";return ar.read_shift(8,"f")}function write_Xnum(ar,or){return(or||new_buf(8)).write_shift(8,ar,"f")}function parse_BrtColor(ar){var or={},lr=ar.read_shift(1),cr=lr>>>1,ur=ar.read_shift(1),dr=ar.read_shift(2,"i"),hr=ar.read_shift(1),pr=ar.read_shift(1),mr=ar.read_shift(1);switch(ar.l++,cr){case 0:or.auto=1;break;case 1:or.index=ur;var fr=XLSIcv[ur];fr&&(or.rgb=rgb2Hex(fr));break;case 2:or.rgb=rgb2Hex([hr,pr,mr]);break;case 3:or.theme=ur;break}return dr!=0&&(or.tint=dr>0?dr/32767:dr/32768),or}function write_BrtColor(ar,or){if(or||(or=new_buf(8)),!ar||ar.auto)return or.write_shift(4,0),or.write_shift(4,0),or;ar.index!=null?(or.write_shift(1,2),or.write_shift(1,ar.index)):ar.theme!=null?(or.write_shift(1,6),or.write_shift(1,ar.theme)):(or.write_shift(1,5),or.write_shift(1,0));var lr=ar.tint||0;if(lr>0?lr*=32767:lr<0&&(lr*=32768),or.write_shift(2,lr),!ar.rgb||ar.theme!=null)or.write_shift(2,0),or.write_shift(1,0),or.write_shift(1,0);else{var cr=ar.rgb||"FFFFFF";typeof cr=="number"&&(cr=("000000"+cr.toString(16)).slice(-6)),or.write_shift(1,parseInt(cr.slice(0,2),16)),or.write_shift(1,parseInt(cr.slice(2,4),16)),or.write_shift(1,parseInt(cr.slice(4,6),16)),or.write_shift(1,255)}return or}function parse_FontFlags(ar){var or=ar.read_shift(1);ar.l++;var lr={fBold:or&1,fItalic:or&2,fUnderline:or&4,fStrikeout:or&8,fOutline:or&16,fShadow:or&32,fCondense:or&64,fExtend:or&128};return lr}function write_FontFlags(ar,or){or||(or=new_buf(2));var lr=(ar.italic?2:0)|(ar.strike?8:0)|(ar.outline?16:0)|(ar.shadow?32:0)|(ar.condense?64:0)|(ar.extend?128:0);return or.write_shift(1,lr),or.write_shift(1,0),or}var VT_I2=2,VT_I4=3,VT_BOOL=11,VT_UI4=19,VT_FILETIME=64,VT_BLOB=65,VT_CF=71,VT_VECTOR_VARIANT=4108,VT_VECTOR_LPSTR=4126,VT_STRING=80,DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:VT_STRING},3:{n:"PresentationFormat",t:VT_STRING},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"ScaleCrop",t:VT_BOOL},12:{n:"HeadingPairs",t:VT_VECTOR_VARIANT},13:{n:"TitlesOfParts",t:VT_VECTOR_LPSTR},14:{n:"Manager",t:VT_STRING},15:{n:"Company",t:VT_STRING},16:{n:"LinksUpToDate",t:VT_BOOL},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:VT_BOOL},22:{n:"HyperlinksChanged",t:VT_BOOL},23:{n:"AppVersion",t:VT_I4,p:"version"},24:{n:"DigSig",t:VT_BLOB},26:{n:"ContentType",t:VT_STRING},27:{n:"ContentStatus",t:VT_STRING},28:{n:"Language",t:VT_STRING},29:{n:"Version",t:VT_STRING},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:VT_STRING},3:{n:"Subject",t:VT_STRING},4:{n:"Author",t:VT_STRING},5:{n:"Keywords",t:VT_STRING},6:{n:"Comments",t:VT_STRING},7:{n:"Template",t:VT_STRING},8:{n:"LastAuthor",t:VT_STRING},9:{n:"RevNumber",t:VT_STRING},10:{n:"EditTime",t:VT_FILETIME},11:{n:"LastPrinted",t:VT_FILETIME},12:{n:"CreatedDate",t:VT_FILETIME},13:{n:"ModifiedDate",t:VT_FILETIME},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:VT_CF},18:{n:"Application",t:VT_STRING},19:{n:"DocSecurity",t:VT_I4},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}};function rgbify(ar){return ar.map(function(or){return[or>>16&255,or>>8&255,or&255]})}var _XLSIcv=rgbify([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),XLSIcv=dup(_XLSIcv),BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},CT_LIST={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function new_ct(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function write_ct(ar,or){var lr=evert_arr(ct2type),cr=[],ur;cr[cr.length]=XML_HEADER,cr[cr.length]=writextag("Types",null,{xmlns:XMLNS.CT,"xmlns:xsd":XMLNS.xsd,"xmlns:xsi":XMLNS.xsi}),cr=cr.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(mr){return writextag("Default",null,{Extension:mr[0],ContentType:mr[1]})}));var dr=function(mr){ar[mr]&&ar[mr].length>0&&(ur=ar[mr][0],cr[cr.length]=writextag("Override",null,{PartName:(ur[0]=="/"?"":"/")+ur,ContentType:CT_LIST[mr][or.bookType]||CT_LIST[mr].xlsx}))},hr=function(mr){(ar[mr]||[]).forEach(function(fr){cr[cr.length]=writextag("Override",null,{PartName:(fr[0]=="/"?"":"/")+fr,ContentType:CT_LIST[mr][or.bookType]||CT_LIST[mr].xlsx})})},pr=function(mr){(ar[mr]||[]).forEach(function(fr){cr[cr.length]=writextag("Override",null,{PartName:(fr[0]=="/"?"":"/")+fr,ContentType:lr[mr][0]})})};return dr("workbooks"),hr("sheets"),hr("charts"),pr("themes"),["strs","styles"].forEach(dr),["coreprops","extprops","custprops"].forEach(pr),pr("vba"),pr("comments"),pr("threadedcomments"),pr("drawings"),hr("metadata"),pr("people"),cr.length>2&&(cr[cr.length]="</Types>",cr[1]=cr[1].replace("/>",">")),cr.join("")}var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function get_rels_path(ar){var or=ar.lastIndexOf("/");return ar.slice(0,or+1)+"_rels/"+ar.slice(or+1)+".rels"}function write_rels(ar){var or=[XML_HEADER,writextag("Relationships",null,{xmlns:XMLNS.RELS})];return keys(ar["!id"]).forEach(function(lr){or[or.length]=writextag("Relationship",null,ar["!id"][lr])}),or.length>2&&(or[or.length]="</Relationships>",or[1]=or[1].replace("/>",">")),or.join("")}function add_rels(ar,or,lr,cr,ur,dr){if(ur||(ur={}),ar["!id"]||(ar["!id"]={}),ar["!idx"]||(ar["!idx"]=1),or<0)for(or=ar["!idx"];ar["!id"]["rId"+or];++or);if(ar["!idx"]=or+1,ur.Id="rId"+or,ur.Type=cr,ur.Target=lr,[RELS.HLINK,RELS.XPATH,RELS.XMISS].indexOf(ur.Type)>-1&&(ur.TargetMode="External"),ar["!id"][ur.Id])throw new Error("Cannot rewrite rId "+or);return ar["!id"][ur.Id]=ur,ar[("/"+ur.Target).replace("//","/")]=ur,or}function write_manifest(ar){var or=[XML_HEADER];or.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),or.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var lr=0;lr<ar.length;++lr)or.push('  <manifest:file-entry manifest:full-path="'+ar[lr][0]+'" manifest:media-type="'+ar[lr][1]+`"/>
`);return or.push("</manifest:manifest>"),or.join("")}function write_rdf_type(ar,or,lr){return['  <rdf:Description rdf:about="'+ar+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(lr||"odf")+"#"+or+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf_has(ar,or){return['  <rdf:Description rdf:about="'+ar+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+or+`"/>
`,`  </rdf:Description>
`].join("")}function write_rdf(ar){var or=[XML_HEADER];or.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var lr=0;lr!=ar.length;++lr)or.push(write_rdf_type(ar[lr][0],ar[lr][1])),or.push(write_rdf_has("",ar[lr][0]));return or.push(write_rdf_type("","Document","pkg")),or.push("</rdf:RDF>"),or.join("")}function write_meta_ods(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+XLSX.version+"</meta:generator></office:meta></office:document-meta>"}var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function cp_doit(ar,or,lr,cr,ur){ur[ar]!=null||or==null||or===""||(ur[ar]=or,or=escapexml(or),cr[cr.length]=lr?writextag(ar,or,lr):writetag(ar,or))}function write_core_props(ar,or){var lr=or||{},cr=[XML_HEADER,writextag("cp:coreProperties",null,{"xmlns:cp":XMLNS.CORE_PROPS,"xmlns:dc":XMLNS.dc,"xmlns:dcterms":XMLNS.dcterms,"xmlns:dcmitype":XMLNS.dcmitype,"xmlns:xsi":XMLNS.xsi})],ur={};if(!ar&&!lr.Props)return cr.join("");ar&&(ar.CreatedDate!=null&&cp_doit("dcterms:created",typeof ar.CreatedDate=="string"?ar.CreatedDate:write_w3cdtf(ar.CreatedDate,lr.WTF),{"xsi:type":"dcterms:W3CDTF"},cr,ur),ar.ModifiedDate!=null&&cp_doit("dcterms:modified",typeof ar.ModifiedDate=="string"?ar.ModifiedDate:write_w3cdtf(ar.ModifiedDate,lr.WTF),{"xsi:type":"dcterms:W3CDTF"},cr,ur));for(var dr=0;dr!=CORE_PROPS.length;++dr){var hr=CORE_PROPS[dr],pr=lr.Props&&lr.Props[hr[1]]!=null?lr.Props[hr[1]]:ar?ar[hr[1]]:null;pr===!0?pr="1":pr===!1?pr="0":typeof pr=="number"&&(pr=String(pr)),pr!=null&&cp_doit(hr[0],pr,null,cr,ur)}return cr.length>2&&(cr[cr.length]="</cp:coreProperties>",cr[1]=cr[1].replace("/>",">")),cr.join("")}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],PseudoPropsPairs=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function write_ext_props(ar){var or=[],lr=writextag;return ar||(ar={}),ar.Application="SheetJS",or[or.length]=XML_HEADER,or[or.length]=writextag("Properties",null,{xmlns:XMLNS.EXT_PROPS,"xmlns:vt":XMLNS.vt}),EXT_PROPS.forEach(function(cr){if(ar[cr[1]]!==void 0){var ur;switch(cr[2]){case"string":ur=escapexml(String(ar[cr[1]]));break;case"bool":ur=ar[cr[1]]?"true":"false";break}ur!==void 0&&(or[or.length]=lr(cr[0],ur))}}),or[or.length]=lr("HeadingPairs",lr("vt:vector",lr("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+lr("vt:variant",lr("vt:i4",String(ar.Worksheets))),{size:2,baseType:"variant"})),or[or.length]=lr("TitlesOfParts",lr("vt:vector",ar.SheetNames.map(function(cr){return"<vt:lpstr>"+escapexml(cr)+"</vt:lpstr>"}).join(""),{size:ar.Worksheets,baseType:"lpstr"})),or.length>2&&(or[or.length]="</Properties>",or[1]=or[1].replace("/>",">")),or.join("")}function write_cust_props(ar){var or=[XML_HEADER,writextag("Properties",null,{xmlns:XMLNS.CUST_PROPS,"xmlns:vt":XMLNS.vt})];if(!ar)return or.join("");var lr=1;return keys(ar).forEach(function(ur){++lr,or[or.length]=writextag("property",write_vt(ar[ur]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:lr,name:escapexml(ur)})}),or.length>2&&(or[or.length]="</Properties>",or[1]=or[1].replace("/>",">")),or.join("")}var XLMLDocPropsMap={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function xlml_write_docprops(ar,or){var lr=[];return keys(XLMLDocPropsMap).map(function(cr){for(var ur=0;ur<CORE_PROPS.length;++ur)if(CORE_PROPS[ur][1]==cr)return CORE_PROPS[ur];for(ur=0;ur<EXT_PROPS.length;++ur)if(EXT_PROPS[ur][1]==cr)return EXT_PROPS[ur];throw cr}).forEach(function(cr){if(ar[cr[1]]!=null){var ur=or&&or.Props&&or.Props[cr[1]]!=null?or.Props[cr[1]]:ar[cr[1]];switch(cr[2]){case"date":ur=new Date(ur).toISOString().replace(/\.\d*Z/,"Z");break}typeof ur=="number"?ur=String(ur):ur===!0||ur===!1?ur=ur?"1":"0":ur instanceof Date&&(ur=new Date(ur).toISOString().replace(/\.\d*Z/,"")),lr.push(writetag(XLMLDocPropsMap[cr[1]]||cr[1],ur))}}),writextag("DocumentProperties",lr.join(""),{xmlns:XLMLNS.o})}function xlml_write_custprops(ar,or){var lr=["Worksheets","SheetNames"],cr="CustomDocumentProperties",ur=[];return ar&&keys(ar).forEach(function(dr){if(Object.prototype.hasOwnProperty.call(ar,dr)){for(var hr=0;hr<CORE_PROPS.length;++hr)if(dr==CORE_PROPS[hr][1])return;for(hr=0;hr<EXT_PROPS.length;++hr)if(dr==EXT_PROPS[hr][1])return;for(hr=0;hr<lr.length;++hr)if(dr==lr[hr])return;var pr=ar[dr],mr="string";typeof pr=="number"?(mr="float",pr=String(pr)):pr===!0||pr===!1?(mr="boolean",pr=pr?"1":"0"):pr=String(pr),ur.push(writextag(escapexmltag(dr),pr,{"dt:dt":mr}))}}),or&&keys(or).forEach(function(dr){if(Object.prototype.hasOwnProperty.call(or,dr)&&!(ar&&Object.prototype.hasOwnProperty.call(ar,dr))){var hr=or[dr],pr="string";typeof hr=="number"?(pr="float",hr=String(hr)):hr===!0||hr===!1?(pr="boolean",hr=hr?"1":"0"):hr instanceof Date?(pr="dateTime.tz",hr=hr.toISOString()):hr=String(hr),ur.push(writextag(escapexmltag(dr),hr,{"dt:dt":pr}))}}),"<"+cr+' xmlns="'+XLMLNS.o+'">'+ur.join("")+"</"+cr+">"}function write_FILETIME(ar){var or=typeof ar=="string"?new Date(Date.parse(ar)):ar,lr=or.getTime()/1e3+11644473600,cr=lr%Math.pow(2,32),ur=(lr-cr)/Math.pow(2,32);cr*=1e7,ur*=1e7;var dr=cr/Math.pow(2,32)|0;dr>0&&(cr=cr%Math.pow(2,32),ur+=dr);var hr=new_buf(8);return hr.write_shift(4,cr),hr.write_shift(4,ur),hr}function write_TypedPropertyValue(ar,or){var lr=new_buf(4),cr=new_buf(4);switch(lr.write_shift(4,ar==80?31:ar),ar){case 3:cr.write_shift(-4,or);break;case 5:cr=new_buf(8),cr.write_shift(8,or,"f");break;case 11:cr.write_shift(4,or?1:0);break;case 64:cr=write_FILETIME(or);break;case 31:case 80:for(cr=new_buf(4+2*(or.length+1)+(or.length%2?0:2)),cr.write_shift(4,or.length+1),cr.write_shift(0,or,"dbcs");cr.l!=cr.length;)cr.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+ar+" "+or)}return bconcat([lr,cr])}var XLSPSSkip=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function guess_property_type(ar){switch(typeof ar){case"boolean":return 11;case"number":return(ar|0)==ar?3:5;case"string":return 31;case"object":if(ar instanceof Date)return 64;break}return-1}function write_PropertySet(ar,or,lr){var cr=new_buf(8),ur=[],dr=[],hr=8,pr=0,mr=new_buf(8),fr=new_buf(8);if(mr.write_shift(4,2),mr.write_shift(4,1200),fr.write_shift(4,1),dr.push(mr),ur.push(fr),hr+=8+mr.length,!or){fr=new_buf(8),fr.write_shift(4,0),ur.unshift(fr);var xr=[new_buf(4)];for(xr[0].write_shift(4,ar.length),pr=0;pr<ar.length;++pr){var Er=ar[pr][0];for(mr=new_buf(8+2*(Er.length+1)+(Er.length%2?0:2)),mr.write_shift(4,pr+2),mr.write_shift(4,Er.length+1),mr.write_shift(0,Er,"dbcs");mr.l!=mr.length;)mr.write_shift(1,0);xr.push(mr)}mr=bconcat(xr),dr.unshift(mr),hr+=8+mr.length}for(pr=0;pr<ar.length;++pr)if(!(or&&!or[ar[pr][0]])&&!(XLSPSSkip.indexOf(ar[pr][0])>-1||PseudoPropsPairs.indexOf(ar[pr][0])>-1)&&ar[pr][1]!=null){var vr=ar[pr][1],gr=0;if(or){gr=+or[ar[pr][0]];var yr=lr[gr];if(yr.p=="version"&&typeof vr=="string"){var br=vr.split(".");vr=(+br[0]<<16)+(+br[1]||0)}mr=write_TypedPropertyValue(yr.t,vr)}else{var _r=guess_property_type(vr);_r==-1&&(_r=31,vr=String(vr)),mr=write_TypedPropertyValue(_r,vr)}dr.push(mr),fr=new_buf(8),fr.write_shift(4,or?gr:2+pr),ur.push(fr),hr+=8+mr.length}var jr=8*(dr.length+1);for(pr=0;pr<dr.length;++pr)ur[pr].write_shift(4,jr),jr+=dr[pr].length;return cr.write_shift(4,hr),cr.write_shift(4,dr.length),bconcat([cr].concat(ur).concat(dr))}function write_PropertySetStream(ar,or,lr,cr,ur,dr){var hr=new_buf(ur?68:48),pr=[hr];hr.write_shift(2,65534),hr.write_shift(2,0),hr.write_shift(4,842412599),hr.write_shift(16,CFB.utils.consts.HEADER_CLSID,"hex"),hr.write_shift(4,ur?2:1),hr.write_shift(16,or,"hex"),hr.write_shift(4,ur?68:48);var mr=write_PropertySet(ar,lr,cr);if(pr.push(mr),ur){var fr=write_PropertySet(ur,null,null);hr.write_shift(16,dr,"hex"),hr.write_shift(4,68+mr.length),pr.push(fr)}return bconcat(pr)}function writezeroes(ar,or){or||(or=new_buf(ar));for(var lr=0;lr<ar;++lr)or.write_shift(1,0);return or}function parsebool(ar,or){return ar.read_shift(or)===1}function writebool(ar,or){return or||(or=new_buf(2)),or.write_shift(2,+!!ar),or}function parseuint16(ar){return ar.read_shift(2,"u")}function writeuint16(ar,or){return or||(or=new_buf(2)),or.write_shift(2,ar),or}function write_Bes(ar,or,lr){return lr||(lr=new_buf(2)),lr.write_shift(1,or=="e"?+ar:+!!ar),lr.write_shift(1,or=="e"?1:0),lr}function parse_ShortXLUnicodeString(ar,or,lr){var cr=ar.read_shift(lr&&lr.biff>=12?2:1),ur="sbcs-cont";if(lr&&lr.biff>=8,!lr||lr.biff==8){var dr=ar.read_shift(1);dr&&(ur="dbcs-cont")}else lr.biff==12&&(ur="wstr");lr.biff>=2&&lr.biff<=5&&(ur="cpstr");var hr=cr?ar.read_shift(cr,ur):"";return hr}function write_XLUnicodeRichExtendedString(ar){var or=ar.t||"",lr=new_buf(3);lr.write_shift(2,or.length),lr.write_shift(1,1);var cr=new_buf(2*or.length);cr.write_shift(2*or.length,or,"utf16le");var ur=[lr,cr];return bconcat(ur)}function parse_XLUnicodeStringNoCch(ar,or,lr){var cr;if(lr){if(lr.biff>=2&&lr.biff<=5)return ar.read_shift(or,"cpstr");if(lr.biff>=12)return ar.read_shift(or,"dbcs-cont")}var ur=ar.read_shift(1);return ur===0?cr=ar.read_shift(or,"sbcs-cont"):cr=ar.read_shift(or,"dbcs-cont"),cr}function parse_XLUnicodeString(ar,or,lr){var cr=ar.read_shift(lr&&lr.biff==2?1:2);return cr===0?(ar.l++,""):parse_XLUnicodeStringNoCch(ar,cr,lr)}function parse_XLUnicodeString2(ar,or,lr){if(lr.biff>5)return parse_XLUnicodeString(ar,or,lr);var cr=ar.read_shift(1);return cr===0?(ar.l++,""):ar.read_shift(cr,lr.biff<=4||!ar.lens?"cpstr":"sbcs-cont")}function write_XLUnicodeString(ar,or,lr){return lr||(lr=new_buf(3+2*ar.length)),lr.write_shift(2,ar.length),lr.write_shift(1,1),lr.write_shift(31,ar,"utf16le"),lr}function write_HyperlinkString(ar,or){or||(or=new_buf(6+ar.length*2)),or.write_shift(4,1+ar.length);for(var lr=0;lr<ar.length;++lr)or.write_shift(2,ar.charCodeAt(lr));return or.write_shift(2,0),or}function write_Hyperlink(ar){var or=new_buf(512),lr=0,cr=ar.Target;cr.slice(0,7)=="file://"&&(cr=cr.slice(7));var ur=cr.indexOf("#"),dr=ur>-1?31:23;switch(cr.charAt(0)){case"#":dr=28;break;case".":dr&=-3;break}or.write_shift(4,2),or.write_shift(4,dr);var hr=[8,6815827,6619237,4849780,83];for(lr=0;lr<hr.length;++lr)or.write_shift(4,hr[lr]);if(dr==28)cr=cr.slice(1),write_HyperlinkString(cr,or);else if(dr&2){for(hr="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),lr=0;lr<hr.length;++lr)or.write_shift(1,parseInt(hr[lr],16));var pr=ur>-1?cr.slice(0,ur):cr;for(or.write_shift(4,2*(pr.length+1)),lr=0;lr<pr.length;++lr)or.write_shift(2,pr.charCodeAt(lr));or.write_shift(2,0),dr&8&&write_HyperlinkString(ur>-1?cr.slice(ur+1):"",or)}else{for(hr="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),lr=0;lr<hr.length;++lr)or.write_shift(1,parseInt(hr[lr],16));for(var mr=0;cr.slice(mr*3,mr*3+3)=="../"||cr.slice(mr*3,mr*3+3)=="..\\";)++mr;for(or.write_shift(2,mr),or.write_shift(4,cr.length-3*mr+1),lr=0;lr<cr.length-3*mr;++lr)or.write_shift(1,cr.charCodeAt(lr+3*mr)&255);for(or.write_shift(1,0),or.write_shift(2,65535),or.write_shift(2,57005),lr=0;lr<6;++lr)or.write_shift(4,0)}return or.slice(0,or.l)}function write_XLSCell(ar,or,lr,cr){return cr||(cr=new_buf(6)),cr.write_shift(2,ar),cr.write_shift(2,or),cr.write_shift(2,lr||0),cr}function parse_XTI(ar,or,lr){var cr=lr.biff>8?4:2,ur=ar.read_shift(cr),dr=ar.read_shift(cr,"i"),hr=ar.read_shift(cr,"i");return[ur,dr,hr]}function parse_Ref8U(ar){var or=ar.read_shift(2),lr=ar.read_shift(2),cr=ar.read_shift(2),ur=ar.read_shift(2);return{s:{c:cr,r:or},e:{c:ur,r:lr}}}function write_Ref8U(ar,or){return or||(or=new_buf(8)),or.write_shift(2,ar.s.r),or.write_shift(2,ar.e.r),or.write_shift(2,ar.s.c),or.write_shift(2,ar.e.c),or}function write_BOF(ar,or,lr){var cr=1536,ur=16;switch(lr.bookType){case"biff8":break;case"biff5":cr=1280,ur=8;break;case"biff4":cr=4,ur=6;break;case"biff3":cr=3,ur=6;break;case"biff2":cr=2,ur=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var dr=new_buf(ur);return dr.write_shift(2,cr),dr.write_shift(2,or),ur>4&&dr.write_shift(2,29282),ur>6&&dr.write_shift(2,1997),ur>8&&(dr.write_shift(2,49161),dr.write_shift(2,1),dr.write_shift(2,1798),dr.write_shift(2,0)),dr}function write_WriteAccess(ar,or){var lr=!or||or.biff==8,cr=new_buf(lr?112:54);for(cr.write_shift(or.biff==8?2:1,7),lr&&cr.write_shift(1,0),cr.write_shift(4,859007059),cr.write_shift(4,5458548|(lr?0:536870912));cr.l<cr.length;)cr.write_shift(1,lr?0:32);return cr}function write_BoundSheet8(ar,or){var lr=!or||or.biff>=8?2:1,cr=new_buf(8+lr*ar.name.length);cr.write_shift(4,ar.pos),cr.write_shift(1,ar.hs||0),cr.write_shift(1,ar.dt),cr.write_shift(1,ar.name.length),or.biff>=8&&cr.write_shift(1,1),cr.write_shift(lr*ar.name.length,ar.name,or.biff<8?"sbcs":"utf16le");var ur=cr.slice(0,cr.l);return ur.l=cr.l,ur}function write_SST(ar,or){var lr=new_buf(8);lr.write_shift(4,ar.Count),lr.write_shift(4,ar.Unique);for(var cr=[],ur=0;ur<ar.length;++ur)cr[ur]=write_XLUnicodeRichExtendedString(ar[ur]);var dr=bconcat([lr].concat(cr));return dr.parts=[lr.length].concat(cr.map(function(hr){return hr.length})),dr}function write_Window1(){var ar=new_buf(18);return ar.write_shift(2,0),ar.write_shift(2,0),ar.write_shift(2,29280),ar.write_shift(2,17600),ar.write_shift(2,56),ar.write_shift(2,0),ar.write_shift(2,0),ar.write_shift(2,1),ar.write_shift(2,500),ar}function write_Window2(ar){var or=new_buf(18),lr=1718;return ar&&ar.RTL&&(lr|=64),or.write_shift(2,lr),or.write_shift(4,0),or.write_shift(4,64),or.write_shift(4,0),or.write_shift(4,0),or}function write_Font(ar,or){var lr=ar.name||"Arial",cr=or&&or.biff==5,ur=cr?15+lr.length:16+2*lr.length,dr=new_buf(ur);return dr.write_shift(2,ar.sz*20),dr.write_shift(4,0),dr.write_shift(2,400),dr.write_shift(4,0),dr.write_shift(2,0),dr.write_shift(1,lr.length),cr||dr.write_shift(1,1),dr.write_shift((cr?1:2)*lr.length,lr,cr?"sbcs":"utf16le"),dr}function write_LabelSst(ar,or,lr,cr){var ur=new_buf(10);return write_XLSCell(ar,or,cr,ur),ur.write_shift(4,lr),ur}function write_Label(ar,or,lr,cr,ur){var dr=!ur||ur.biff==8,hr=new_buf(8+ +dr+(1+dr)*lr.length);return write_XLSCell(ar,or,cr,hr),hr.write_shift(2,lr.length),dr&&hr.write_shift(1,1),hr.write_shift((1+dr)*lr.length,lr,dr?"utf16le":"sbcs"),hr}function write_Format(ar,or,lr,cr){var ur=lr&&lr.biff==5;cr||(cr=new_buf(ur?3+or.length:5+2*or.length)),cr.write_shift(2,ar),cr.write_shift(ur?1:2,or.length),ur||cr.write_shift(1,1),cr.write_shift((ur?1:2)*or.length,or,ur?"sbcs":"utf16le");var dr=cr.length>cr.l?cr.slice(0,cr.l):cr;return dr.l==null&&(dr.l=dr.length),dr}function write_Dimensions(ar,or){var lr=or.biff==8||!or.biff?4:2,cr=new_buf(2*lr+6);return cr.write_shift(lr,ar.s.r),cr.write_shift(lr,ar.e.r+1),cr.write_shift(2,ar.s.c),cr.write_shift(2,ar.e.c+1),cr.write_shift(2,0),cr}function write_XF(ar,or,lr,cr){var ur=lr&&lr.biff==5;cr||(cr=new_buf(ur?16:20)),cr.write_shift(2,0),ar.style?(cr.write_shift(2,ar.numFmtId||0),cr.write_shift(2,65524)):(cr.write_shift(2,ar.numFmtId||0),cr.write_shift(2,or<<4));var dr=0;return ar.numFmtId>0&&ur&&(dr|=1024),cr.write_shift(4,dr),cr.write_shift(4,0),ur||cr.write_shift(4,0),cr.write_shift(2,0),cr}function write_Guts(ar){var or=new_buf(8);return or.write_shift(4,0),or.write_shift(2,0),or.write_shift(2,0),or}function write_BoolErr(ar,or,lr,cr,ur,dr){var hr=new_buf(8);return write_XLSCell(ar,or,cr,hr),write_Bes(lr,dr,hr),hr}function write_Number(ar,or,lr,cr){var ur=new_buf(14);return write_XLSCell(ar,or,cr,ur),write_Xnum(lr,ur),ur}function parse_ExternSheet(ar,or,lr){if(lr.biff<8)return parse_BIFF5ExternSheet(ar,or,lr);for(var cr=[],ur=ar.l+or,dr=ar.read_shift(lr.biff>8?4:2);dr--!==0;)cr.push(parse_XTI(ar,lr.biff>8?12:6,lr));if(ar.l!=ur)throw new Error("Bad ExternSheet: "+ar.l+" != "+ur);return cr}function parse_BIFF5ExternSheet(ar,or,lr){ar[ar.l+1]==3&&ar[ar.l]++;var cr=parse_ShortXLUnicodeString(ar,or,lr);return cr.charCodeAt(0)==3?cr.slice(1):cr}function write_MergeCells(ar){var or=new_buf(2+ar.length*8);or.write_shift(2,ar.length);for(var lr=0;lr<ar.length;++lr)write_Ref8U(ar[lr],or);return or}function write_HLink(ar){var or=new_buf(24),lr=decode_cell(ar[0]);or.write_shift(2,lr.r),or.write_shift(2,lr.r),or.write_shift(2,lr.c),or.write_shift(2,lr.c);for(var cr="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),ur=0;ur<16;++ur)or.write_shift(1,parseInt(cr[ur],16));return bconcat([or,write_Hyperlink(ar[1])])}function write_HLinkTooltip(ar){var or=ar[1].Tooltip,lr=new_buf(10+2*(or.length+1));lr.write_shift(2,2048);var cr=decode_cell(ar[0]);lr.write_shift(2,cr.r),lr.write_shift(2,cr.r),lr.write_shift(2,cr.c),lr.write_shift(2,cr.c);for(var ur=0;ur<or.length;++ur)lr.write_shift(2,or.charCodeAt(ur));return lr.write_shift(2,0),lr}function write_Country(ar){return ar||(ar=new_buf(4)),ar.write_shift(2,1),ar.write_shift(2,1),ar}function parse_ColInfo(ar,or,lr){if(!lr.cellStyles)return parsenoop(ar,or);var cr=lr&&lr.biff>=12?4:2,ur=ar.read_shift(cr),dr=ar.read_shift(cr),hr=ar.read_shift(cr),pr=ar.read_shift(cr),mr=ar.read_shift(2);cr==2&&(ar.l+=2);var fr={s:ur,e:dr,w:hr,ixfe:pr,flags:mr};return(lr.biff>=5||!lr.biff)&&(fr.level=mr>>8&7),fr}function write_ColInfo(ar,or){var lr=new_buf(12);lr.write_shift(2,or),lr.write_shift(2,or),lr.write_shift(2,ar.width*256),lr.write_shift(2,0);var cr=0;return ar.hidden&&(cr|=1),lr.write_shift(1,cr),cr=ar.level||0,lr.write_shift(1,cr),lr.write_shift(2,0),lr}function write_RRTabId(ar){for(var or=new_buf(2*ar),lr=0;lr<ar;++lr)or.write_shift(2,lr+1);return or}function write_BIFF2NUM(ar,or,lr){var cr=new_buf(15);return write_BIFF2Cell(cr,ar,or),cr.write_shift(8,lr,"f"),cr}function write_BIFF2INT(ar,or,lr){var cr=new_buf(9);return write_BIFF2Cell(cr,ar,or),cr.write_shift(2,lr),cr}var DBF=function(){var ar={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},or=evert({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function lr(pr,mr){var fr=[],xr=new_raw_buf(1);switch(mr.type){case"base64":xr=s2a(Base64_decode(pr));break;case"binary":xr=s2a(pr);break;case"buffer":case"array":xr=pr;break}prep_blob(xr,0);var Er=xr.read_shift(1),vr=!!(Er&136),gr=!1,yr=!1;switch(Er){case 2:break;case 3:break;case 48:gr=!0,vr=!0;break;case 49:gr=!0,vr=!0;break;case 131:break;case 139:break;case 140:yr=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+Er.toString(16))}var br=0,_r=521;Er==2&&(br=xr.read_shift(2)),xr.l+=3,Er!=2&&(br=xr.read_shift(4)),br>1048576&&(br=1e6),Er!=2&&(_r=xr.read_shift(2));var jr=xr.read_shift(2),wr=mr.codepage||1252;Er!=2&&(xr.l+=16,xr.read_shift(1),xr[xr.l]!==0&&(wr=ar[xr[xr.l]]),xr.l+=1,xr.l+=2),yr&&(xr.l+=36);for(var Sr=[],Tr={},Rr=Math.min(xr.length,Er==2?521:_r-10-(gr?264:0)),Nr=yr?32:11;xr.l<Rr&&xr[xr.l]!=13;)switch(Tr={},Tr.name=$cptable.utils.decode(wr,xr.slice(xr.l,xr.l+Nr)).replace(/[\u0000\r\n].*$/g,""),xr.l+=Nr,Tr.type=String.fromCharCode(xr.read_shift(1)),Er!=2&&!yr&&(Tr.offset=xr.read_shift(4)),Tr.len=xr.read_shift(1),Er==2&&(Tr.offset=xr.read_shift(2)),Tr.dec=xr.read_shift(1),Tr.name.length&&Sr.push(Tr),Er!=2&&(xr.l+=yr?13:14),Tr.type){case"B":(!gr||Tr.len!=8)&&mr.WTF&&console.log("Skipping "+Tr.name+":"+Tr.type);break;case"G":case"P":mr.WTF&&console.log("Skipping "+Tr.name+":"+Tr.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+Tr.type)}if(xr[xr.l]!==13&&(xr.l=_r-1),xr.read_shift(1)!==13)throw new Error("DBF Terminator not found "+xr.l+" "+xr[xr.l]);xr.l=_r;var Cr=0,kr=0;for(fr[0]=[],kr=0;kr!=Sr.length;++kr)fr[0][kr]=Sr[kr].name;for(;br-- >0;){if(xr[xr.l]===42){xr.l+=jr;continue}for(++xr.l,fr[++Cr]=[],kr=0,kr=0;kr!=Sr.length;++kr){var Ar=xr.slice(xr.l,xr.l+Sr[kr].len);xr.l+=Sr[kr].len,prep_blob(Ar,0);var Or=$cptable.utils.decode(wr,Ar);switch(Sr[kr].type){case"C":Or.trim().length&&(fr[Cr][kr]=Or.replace(/\s+$/,""));break;case"D":Or.length===8?fr[Cr][kr]=new Date(+Or.slice(0,4),+Or.slice(4,6)-1,+Or.slice(6,8)):fr[Cr][kr]=Or;break;case"F":fr[Cr][kr]=parseFloat(Or.trim());break;case"+":case"I":fr[Cr][kr]=yr?Ar.read_shift(-4,"i")^2147483648:Ar.read_shift(4,"i");break;case"L":switch(Or.trim().toUpperCase()){case"Y":case"T":fr[Cr][kr]=!0;break;case"N":case"F":fr[Cr][kr]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+Or+"|")}break;case"M":if(!vr)throw new Error("DBF Unexpected MEMO for type "+Er.toString(16));fr[Cr][kr]="##MEMO##"+(yr?parseInt(Or.trim(),10):Ar.read_shift(4));break;case"N":Or=Or.replace(/\u0000/g,"").trim(),Or&&Or!="."&&(fr[Cr][kr]=+Or||0);break;case"@":fr[Cr][kr]=new Date(Ar.read_shift(-8,"f")-621356832e5);break;case"T":fr[Cr][kr]=new Date((Ar.read_shift(4)-2440588)*864e5+Ar.read_shift(4));break;case"Y":fr[Cr][kr]=Ar.read_shift(4,"i")/1e4+Ar.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":fr[Cr][kr]=-Ar.read_shift(-8,"f");break;case"B":if(gr&&Sr[kr].len==8){fr[Cr][kr]=Ar.read_shift(8,"f");break}case"G":case"P":Ar.l+=Sr[kr].len;break;case"0":if(Sr[kr].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+Sr[kr].type)}}}if(Er!=2&&xr.l<xr.length&&xr[xr.l++]!=26)throw new Error("DBF EOF Marker missing "+(xr.l-1)+" of "+xr.length+" "+xr[xr.l-1].toString(16));return mr&&mr.sheetRows&&(fr=fr.slice(0,mr.sheetRows)),mr.DBF=Sr,fr}function cr(pr,mr){var fr=mr||{};fr.dateNF||(fr.dateNF="yyyymmdd");var xr=aoa_to_sheet(lr(pr,fr),fr);return xr["!cols"]=fr.DBF.map(function(Er){return{wch:Er.len,DBF:Er}}),delete fr.DBF,xr}function ur(pr,mr){try{return sheet_to_workbook(cr(pr,mr),mr)}catch(fr){if(mr&&mr.WTF)throw fr}return{SheetNames:[],Sheets:{}}}var dr={B:8,C:250,L:1,D:8,"?":0,"":0};function hr(pr,mr){var fr=mr||{};if(+fr.codepage>=0&&set_cp(+fr.codepage),fr.type=="string")throw new Error("Cannot write DBF to JS string");var xr=buf_array(),Er=sheet_to_json(pr,{header:1,raw:!0,cellDates:!0}),vr=Er[0],gr=Er.slice(1),yr=pr["!cols"]||[],br=0,_r=0,jr=0,wr=1;for(br=0;br<vr.length;++br){if(((yr[br]||{}).DBF||{}).name){vr[br]=yr[br].DBF.name,++jr;continue}if(vr[br]!=null){if(++jr,typeof vr[br]=="number"&&(vr[br]=vr[br].toString(10)),typeof vr[br]!="string")throw new Error("DBF Invalid column name "+vr[br]+" |"+typeof vr[br]+"|");if(vr.indexOf(vr[br])!==br){for(_r=0;_r<1024;++_r)if(vr.indexOf(vr[br]+"_"+_r)==-1){vr[br]+="_"+_r;break}}}}var Sr=safe_decode_range(pr["!ref"]),Tr=[],Rr=[],Nr=[];for(br=0;br<=Sr.e.c-Sr.s.c;++br){var Cr="",kr="",Ar=0,Or=[];for(_r=0;_r<gr.length;++_r)gr[_r][br]!=null&&Or.push(gr[_r][br]);if(Or.length==0||vr[br]==null){Tr[br]="?";continue}for(_r=0;_r<Or.length;++_r){switch(typeof Or[_r]){case"number":kr="B";break;case"string":kr="C";break;case"boolean":kr="L";break;case"object":kr=Or[_r]instanceof Date?"D":"C";break;default:kr="C"}Ar=Math.max(Ar,String(Or[_r]).length),Cr=Cr&&Cr!=kr?"C":kr}Ar>250&&(Ar=250),kr=((yr[br]||{}).DBF||{}).type,kr=="C"&&yr[br].DBF.len>Ar&&(Ar=yr[br].DBF.len),Cr=="B"&&kr=="N"&&(Cr="N",Nr[br]=yr[br].DBF.dec,Ar=yr[br].DBF.len),Rr[br]=Cr=="C"||kr=="N"?Ar:dr[Cr]||0,wr+=Rr[br],Tr[br]=Cr}var Lr=xr.next(32);for(Lr.write_shift(4,318902576),Lr.write_shift(4,gr.length),Lr.write_shift(2,296+32*jr),Lr.write_shift(2,wr),br=0;br<4;++br)Lr.write_shift(4,0);for(Lr.write_shift(4,0|(+or[current_ansi]||3)<<8),br=0,_r=0;br<vr.length;++br)if(vr[br]!=null){var Fr=xr.next(32),Hr=(vr[br].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Fr.write_shift(1,Hr,"sbcs"),Fr.write_shift(1,Tr[br]=="?"?"C":Tr[br],"sbcs"),Fr.write_shift(4,_r),Fr.write_shift(1,Rr[br]||dr[Tr[br]]||0),Fr.write_shift(1,Nr[br]||0),Fr.write_shift(1,2),Fr.write_shift(4,0),Fr.write_shift(1,0),Fr.write_shift(4,0),Fr.write_shift(4,0),_r+=Rr[br]||dr[Tr[br]]||0}var Kr=xr.next(264);for(Kr.write_shift(4,13),br=0;br<65;++br)Kr.write_shift(4,0);for(br=0;br<gr.length;++br){var Gr=xr.next(wr);for(Gr.write_shift(1,0),_r=0;_r<vr.length;++_r)if(vr[_r]!=null)switch(Tr[_r]){case"L":Gr.write_shift(1,gr[br][_r]==null?63:gr[br][_r]?84:70);break;case"B":Gr.write_shift(8,gr[br][_r]||0,"f");break;case"N":var Zr="0";for(typeof gr[br][_r]=="number"&&(Zr=gr[br][_r].toFixed(Nr[_r]||0)),jr=0;jr<Rr[_r]-Zr.length;++jr)Gr.write_shift(1,32);Gr.write_shift(1,Zr,"sbcs");break;case"D":gr[br][_r]?(Gr.write_shift(4,("0000"+gr[br][_r].getFullYear()).slice(-4),"sbcs"),Gr.write_shift(2,("00"+(gr[br][_r].getMonth()+1)).slice(-2),"sbcs"),Gr.write_shift(2,("00"+gr[br][_r].getDate()).slice(-2),"sbcs")):Gr.write_shift(8,"00000000","sbcs");break;case"C":var Jr=String(gr[br][_r]!=null?gr[br][_r]:"").slice(0,Rr[_r]);for(Gr.write_shift(1,Jr,"sbcs"),jr=0;jr<Rr[_r]-Jr.length;++jr)Gr.write_shift(1,32);break}}return xr.next(1).write_shift(1,26),xr.end()}return{to_workbook:ur,to_sheet:cr,from_sheet:hr}}(),SYLK=function(){var ar={AA:"",BA:"",CA:"",DA:195,HA:"",JA:197,AE:"",BE:"",CE:"",HE:"",AI:"",BI:"",CI:"",HI:"",AO:"",BO:"",CO:"",DO:213,HO:"",AU:"",BU:"",CU:"",HU:"",Aa:"",Ba:"",Ca:"",Da:227,Ha:"",Ja:229,Ae:"",Be:"",Ce:"",He:"",Ai:"",Bi:"",Ci:"",Hi:"",Ao:"",Bo:"",Co:"",Do:245,Ho:"",Au:"",Bu:"",Cu:"",Hu:"",KC:"",Kc:"",q:"",z:"",a:"",j:"",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},or=new RegExp("\x1BN("+keys(ar).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),lr=function(vr,gr){var yr=ar[gr];return typeof yr=="number"?_getansi(yr):yr},cr=function(vr,gr,yr){var br=gr.charCodeAt(0)-32<<4|yr.charCodeAt(0)-48;return br==59?vr:_getansi(br)};ar["|"]=254;function ur(vr,gr){switch(gr.type){case"base64":return dr(Base64_decode(vr),gr);case"binary":return dr(vr,gr);case"buffer":return dr(has_buf&&Buffer.isBuffer(vr)?vr.toString("binary"):a2s(vr),gr);case"array":return dr(cc2str(vr),gr)}throw new Error("Unrecognized type "+gr.type)}function dr(vr,gr){var yr=vr.split(/[\n\r]+/),br=-1,_r=-1,jr=0,wr=0,Sr=[],Tr=[],Rr=null,Nr={},Cr=[],kr=[],Ar=[],Or=0,Lr;for(+gr.codepage>=0&&set_cp(+gr.codepage);jr!==yr.length;++jr){Or=0;var Fr=yr[jr].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,cr).replace(or,lr),Hr=Fr.replace(/;;/g,"\0").split(";").map(function(Mr){return Mr.replace(/\u0000/g,";")}),Kr=Hr[0],Gr;if(Fr.length>0)switch(Kr){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":Hr[1].charAt(0)=="P"&&Tr.push(Fr.slice(3).replace(/;;/g,";"));break;case"C":var Zr=!1,Jr=!1,os=!1,Ur=!1,Vr=-1,es=-1;for(wr=1;wr<Hr.length;++wr)switch(Hr[wr].charAt(0)){case"A":break;case"X":_r=parseInt(Hr[wr].slice(1))-1,Jr=!0;break;case"Y":for(br=parseInt(Hr[wr].slice(1))-1,Jr||(_r=0),Lr=Sr.length;Lr<=br;++Lr)Sr[Lr]=[];break;case"K":Gr=Hr[wr].slice(1),Gr.charAt(0)==='"'?Gr=Gr.slice(1,Gr.length-1):Gr==="TRUE"?Gr=!0:Gr==="FALSE"?Gr=!1:isNaN(fuzzynum(Gr))?isNaN(fuzzydate(Gr).getDate())||(Gr=parseDate(Gr)):(Gr=fuzzynum(Gr),Rr!==null&&fmt_is_date(Rr)&&(Gr=numdate(Gr))),Zr=!0;break;case"E":Ur=!0;var Ir=rc_to_a1(Hr[wr].slice(1),{r:br,c:_r});Sr[br][_r]=[Sr[br][_r],Ir];break;case"S":os=!0,Sr[br][_r]=[Sr[br][_r],"S5S"];break;case"G":break;case"R":Vr=parseInt(Hr[wr].slice(1))-1;break;case"C":es=parseInt(Hr[wr].slice(1))-1;break;default:if(gr&&gr.WTF)throw new Error("SYLK bad record "+Fr)}if(Zr&&(Sr[br][_r]&&Sr[br][_r].length==2?Sr[br][_r][0]=Gr:Sr[br][_r]=Gr,Rr=null),os){if(Ur)throw new Error("SYLK shared formula cannot have own formula");var Dr=Vr>-1&&Sr[Vr][es];if(!Dr||!Dr[1])throw new Error("SYLK shared formula cannot find base");Sr[br][_r][1]=shift_formula_str(Dr[1],{r:br-Vr,c:_r-es})}break;case"F":var Pr=0;for(wr=1;wr<Hr.length;++wr)switch(Hr[wr].charAt(0)){case"X":_r=parseInt(Hr[wr].slice(1))-1,++Pr;break;case"Y":for(br=parseInt(Hr[wr].slice(1))-1,Lr=Sr.length;Lr<=br;++Lr)Sr[Lr]=[];break;case"M":Or=parseInt(Hr[wr].slice(1))/20;break;case"F":break;case"G":break;case"P":Rr=Tr[parseInt(Hr[wr].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(Ar=Hr[wr].slice(1).split(" "),Lr=parseInt(Ar[0],10);Lr<=parseInt(Ar[1],10);++Lr)Or=parseInt(Ar[2],10),kr[Lr-1]=Or===0?{hidden:!0}:{wch:Or},process_col(kr[Lr-1]);break;case"C":_r=parseInt(Hr[wr].slice(1))-1,kr[_r]||(kr[_r]={});break;case"R":br=parseInt(Hr[wr].slice(1))-1,Cr[br]||(Cr[br]={}),Or>0?(Cr[br].hpt=Or,Cr[br].hpx=pt2px(Or)):Or===0&&(Cr[br].hidden=!0);break;default:if(gr&&gr.WTF)throw new Error("SYLK bad record "+Fr)}Pr<1&&(Rr=null);break;default:if(gr&&gr.WTF)throw new Error("SYLK bad record "+Fr)}}return Cr.length>0&&(Nr["!rows"]=Cr),kr.length>0&&(Nr["!cols"]=kr),gr&&gr.sheetRows&&(Sr=Sr.slice(0,gr.sheetRows)),[Sr,Nr]}function hr(vr,gr){var yr=ur(vr,gr),br=yr[0],_r=yr[1],jr=aoa_to_sheet(br,gr);return keys(_r).forEach(function(wr){jr[wr]=_r[wr]}),jr}function pr(vr,gr){return sheet_to_workbook(hr(vr,gr),gr)}function mr(vr,gr,yr,br){var _r="C;Y"+(yr+1)+";X"+(br+1)+";K";switch(vr.t){case"n":_r+=vr.v||0,vr.f&&!vr.F&&(_r+=";E"+a1_to_rc(vr.f,{r:yr,c:br}));break;case"b":_r+=vr.v?"TRUE":"FALSE";break;case"e":_r+=vr.w||vr.v;break;case"d":_r+='"'+(vr.w||vr.v)+'"';break;case"s":_r+='"'+vr.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return _r}function fr(vr,gr){gr.forEach(function(yr,br){var _r="F;W"+(br+1)+" "+(br+1)+" ";yr.hidden?_r+="0":(typeof yr.width=="number"&&!yr.wpx&&(yr.wpx=width2px(yr.width)),typeof yr.wpx=="number"&&!yr.wch&&(yr.wch=px2char(yr.wpx)),typeof yr.wch=="number"&&(_r+=Math.round(yr.wch))),_r.charAt(_r.length-1)!=" "&&vr.push(_r)})}function xr(vr,gr){gr.forEach(function(yr,br){var _r="F;";yr.hidden?_r+="M0;":yr.hpt?_r+="M"+20*yr.hpt+";":yr.hpx&&(_r+="M"+20*px2pt(yr.hpx)+";"),_r.length>2&&vr.push(_r+"R"+(br+1))})}function Er(vr,gr){var yr=["ID;PWXL;N;E"],br=[],_r=safe_decode_range(vr["!ref"]),jr,wr=Array.isArray(vr),Sr=`\r
`;yr.push("P;PGeneral"),yr.push("F;P0;DG0G8;M255"),vr["!cols"]&&fr(yr,vr["!cols"]),vr["!rows"]&&xr(yr,vr["!rows"]),yr.push("B;Y"+(_r.e.r-_r.s.r+1)+";X"+(_r.e.c-_r.s.c+1)+";D"+[_r.s.c,_r.s.r,_r.e.c,_r.e.r].join(" "));for(var Tr=_r.s.r;Tr<=_r.e.r;++Tr)for(var Rr=_r.s.c;Rr<=_r.e.c;++Rr){var Nr=encode_cell({r:Tr,c:Rr});jr=wr?(vr[Tr]||[])[Rr]:vr[Nr],!(!jr||jr.v==null&&(!jr.f||jr.F))&&br.push(mr(jr,vr,Tr,Rr))}return yr.join(Sr)+Sr+br.join(Sr)+Sr+"E"+Sr}return{to_workbook:pr,to_sheet:hr,from_sheet:Er}}(),DIF=function(){function ar(dr,hr){switch(hr.type){case"base64":return or(Base64_decode(dr),hr);case"binary":return or(dr,hr);case"buffer":return or(has_buf&&Buffer.isBuffer(dr)?dr.toString("binary"):a2s(dr),hr);case"array":return or(cc2str(dr),hr)}throw new Error("Unrecognized type "+hr.type)}function or(dr,hr){for(var pr=dr.split(`
`),mr=-1,fr=-1,xr=0,Er=[];xr!==pr.length;++xr){if(pr[xr].trim()==="BOT"){Er[++mr]=[],fr=0;continue}if(!(mr<0)){var vr=pr[xr].trim().split(","),gr=vr[0],yr=vr[1];++xr;for(var br=pr[xr]||"";(br.match(/["]/g)||[]).length&1&&xr<pr.length-1;)br+=`
`+pr[++xr];switch(br=br.trim(),+gr){case-1:if(br==="BOT"){Er[++mr]=[],fr=0;continue}else if(br!=="EOD")throw new Error("Unrecognized DIF special command "+br);break;case 0:br==="TRUE"?Er[mr][fr]=!0:br==="FALSE"?Er[mr][fr]=!1:isNaN(fuzzynum(yr))?isNaN(fuzzydate(yr).getDate())?Er[mr][fr]=yr:Er[mr][fr]=parseDate(yr):Er[mr][fr]=fuzzynum(yr),++fr;break;case 1:br=br.slice(1,br.length-1),br=br.replace(/""/g,'"'),br&&br.match(/^=".*"$/)&&(br=br.slice(2,-1)),Er[mr][fr++]=br!==""?br:null;break}if(br==="EOD")break}}return hr&&hr.sheetRows&&(Er=Er.slice(0,hr.sheetRows)),Er}function lr(dr,hr){return aoa_to_sheet(ar(dr,hr),hr)}function cr(dr,hr){return sheet_to_workbook(lr(dr,hr),hr)}var ur=function(){var dr=function(mr,fr,xr,Er,vr){mr.push(fr),mr.push(xr+","+Er),mr.push('"'+vr.replace(/"/g,'""')+'"')},hr=function(mr,fr,xr,Er){mr.push(fr+","+xr),mr.push(fr==1?'"'+Er.replace(/"/g,'""')+'"':Er)};return function(mr){var fr=[],xr=safe_decode_range(mr["!ref"]),Er,vr=Array.isArray(mr);dr(fr,"TABLE",0,1,"sheetjs"),dr(fr,"VECTORS",0,xr.e.r-xr.s.r+1,""),dr(fr,"TUPLES",0,xr.e.c-xr.s.c+1,""),dr(fr,"DATA",0,0,"");for(var gr=xr.s.r;gr<=xr.e.r;++gr){hr(fr,-1,0,"BOT");for(var yr=xr.s.c;yr<=xr.e.c;++yr){var br=encode_cell({r:gr,c:yr});if(Er=vr?(mr[gr]||[])[yr]:mr[br],!Er){hr(fr,1,0,"");continue}switch(Er.t){case"n":var _r=Er.w;!_r&&Er.v!=null&&(_r=Er.v),_r==null?Er.f&&!Er.F?hr(fr,1,0,"="+Er.f):hr(fr,1,0,""):hr(fr,0,_r,"V");break;case"b":hr(fr,0,Er.v?1:0,Er.v?"TRUE":"FALSE");break;case"s":hr(fr,1,0,isNaN(Er.v)?Er.v:'="'+Er.v+'"');break;case"d":Er.w||(Er.w=SSF_format(Er.z||table_fmt[14],datenum(parseDate(Er.v)))),hr(fr,0,Er.w,"V");break;default:hr(fr,1,0,"")}}}hr(fr,-1,0,"EOD");var jr=`\r
`,wr=fr.join(jr);return wr}}();return{to_workbook:cr,to_sheet:lr,from_sheet:ur}}(),ETH=function(){function ar(Er){return Er.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function or(Er){return Er.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function lr(Er,vr){for(var gr=Er.split(`
`),yr=-1,br=-1,_r=0,jr=[];_r!==gr.length;++_r){var wr=gr[_r].trim().split(":");if(wr[0]==="cell"){var Sr=decode_cell(wr[1]);if(jr.length<=Sr.r)for(yr=jr.length;yr<=Sr.r;++yr)jr[yr]||(jr[yr]=[]);switch(yr=Sr.r,br=Sr.c,wr[2]){case"t":jr[yr][br]=ar(wr[3]);break;case"v":jr[yr][br]=+wr[3];break;case"vtf":var Tr=wr[wr.length-1];case"vtc":switch(wr[3]){case"nl":jr[yr][br]=!!+wr[4];break;default:jr[yr][br]=+wr[4];break}wr[2]=="vtf"&&(jr[yr][br]=[jr[yr][br],Tr])}}}return vr&&vr.sheetRows&&(jr=jr.slice(0,vr.sheetRows)),jr}function cr(Er,vr){return aoa_to_sheet(lr(Er,vr),vr)}function ur(Er,vr){return sheet_to_workbook(cr(Er,vr),vr)}var dr=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),hr=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,pr=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),mr="--SocialCalcSpreadsheetControlSave--";function fr(Er){if(!Er||!Er["!ref"])return"";for(var vr=[],gr=[],yr,br="",_r=decode_range(Er["!ref"]),jr=Array.isArray(Er),wr=_r.s.r;wr<=_r.e.r;++wr)for(var Sr=_r.s.c;Sr<=_r.e.c;++Sr)if(br=encode_cell({r:wr,c:Sr}),yr=jr?(Er[wr]||[])[Sr]:Er[br],!(!yr||yr.v==null||yr.t==="z")){switch(gr=["cell",br,"t"],yr.t){case"s":case"str":gr.push(or(yr.v));break;case"n":yr.f?(gr[2]="vtf",gr[3]="n",gr[4]=yr.v,gr[5]=or(yr.f)):(gr[2]="v",gr[3]=yr.v);break;case"b":gr[2]="vt"+(yr.f?"f":"c"),gr[3]="nl",gr[4]=yr.v?"1":"0",gr[5]=or(yr.f||(yr.v?"TRUE":"FALSE"));break;case"d":var Tr=datenum(parseDate(yr.v));gr[2]="vtc",gr[3]="nd",gr[4]=""+Tr,gr[5]=yr.w||SSF_format(yr.z||table_fmt[14],Tr);break;case"e":continue}vr.push(gr.join(":"))}return vr.push("sheet:c:"+(_r.e.c-_r.s.c+1)+":r:"+(_r.e.r-_r.s.r+1)+":tvf:1"),vr.push("valueformat:1:text-wiki"),vr.join(`
`)}function xr(Er){return[dr,hr,pr,hr,fr(Er),mr].join(`
`)}return{to_workbook:ur,to_sheet:cr,from_sheet:xr}}(),PRN=function(){function ar(xr,Er,vr,gr,yr){yr.raw?Er[vr][gr]=xr:xr===""||(xr==="TRUE"?Er[vr][gr]=!0:xr==="FALSE"?Er[vr][gr]=!1:isNaN(fuzzynum(xr))?isNaN(fuzzydate(xr).getDate())?Er[vr][gr]=xr:Er[vr][gr]=parseDate(xr):Er[vr][gr]=fuzzynum(xr))}function or(xr,Er){var vr=Er||{},gr=[];if(!xr||xr.length===0)return gr;for(var yr=xr.split(/[\r\n]/),br=yr.length-1;br>=0&&yr[br].length===0;)--br;for(var _r=10,jr=0,wr=0;wr<=br;++wr)jr=yr[wr].indexOf(" "),jr==-1?jr=yr[wr].length:jr++,_r=Math.max(_r,jr);for(wr=0;wr<=br;++wr){gr[wr]=[];var Sr=0;for(ar(yr[wr].slice(0,_r).trim(),gr,wr,Sr,vr),Sr=1;Sr<=(yr[wr].length-_r)/10+1;++Sr)ar(yr[wr].slice(_r+(Sr-1)*10,_r+Sr*10).trim(),gr,wr,Sr,vr)}return vr.sheetRows&&(gr=gr.slice(0,vr.sheetRows)),gr}var lr={44:",",9:"	",59:";",124:"|"},cr={44:3,9:2,59:1,124:0};function ur(xr){for(var Er={},vr=!1,gr=0,yr=0;gr<xr.length;++gr)(yr=xr.charCodeAt(gr))==34?vr=!vr:!vr&&yr in lr&&(Er[yr]=(Er[yr]||0)+1);yr=[];for(gr in Er)Object.prototype.hasOwnProperty.call(Er,gr)&&yr.push([Er[gr],gr]);if(!yr.length){Er=cr;for(gr in Er)Object.prototype.hasOwnProperty.call(Er,gr)&&yr.push([Er[gr],gr])}return yr.sort(function(br,_r){return br[0]-_r[0]||cr[br[1]]-cr[_r[1]]}),lr[yr.pop()[1]]||44}function dr(xr,Er){var vr=Er||{},gr="",yr=vr.dense?[]:{},br={s:{c:0,r:0},e:{c:0,r:0}};xr.slice(0,4)=="sep="?xr.charCodeAt(5)==13&&xr.charCodeAt(6)==10?(gr=xr.charAt(4),xr=xr.slice(7)):xr.charCodeAt(5)==13||xr.charCodeAt(5)==10?(gr=xr.charAt(4),xr=xr.slice(6)):gr=ur(xr.slice(0,1024)):vr&&vr.FS?gr=vr.FS:gr=ur(xr.slice(0,1024));var _r=0,jr=0,wr=0,Sr=0,Tr=0,Rr=gr.charCodeAt(0),Nr=!1,Cr=0,kr=xr.charCodeAt(0);xr=xr.replace(/\r\n/mg,`
`);var Ar=vr.dateNF!=null?dateNF_regex(vr.dateNF):null;function Or(){var Lr=xr.slice(Sr,Tr),Fr={};if(Lr.charAt(0)=='"'&&Lr.charAt(Lr.length-1)=='"'&&(Lr=Lr.slice(1,-1).replace(/""/g,'"')),Lr.length===0)Fr.t="z";else if(vr.raw)Fr.t="s",Fr.v=Lr;else if(Lr.trim().length===0)Fr.t="s",Fr.v=Lr;else if(Lr.charCodeAt(0)==61)Lr.charCodeAt(1)==34&&Lr.charCodeAt(Lr.length-1)==34?(Fr.t="s",Fr.v=Lr.slice(2,-1).replace(/""/g,'"')):fuzzyfmla(Lr)?(Fr.t="n",Fr.f=Lr.slice(1)):(Fr.t="s",Fr.v=Lr);else if(Lr=="TRUE")Fr.t="b",Fr.v=!0;else if(Lr=="FALSE")Fr.t="b",Fr.v=!1;else if(!isNaN(wr=fuzzynum(Lr)))Fr.t="n",vr.cellText!==!1&&(Fr.w=Lr),Fr.v=wr;else if(!isNaN(fuzzydate(Lr).getDate())||Ar&&Lr.match(Ar)){Fr.z=vr.dateNF||table_fmt[14];var Hr=0;Ar&&Lr.match(Ar)&&(Lr=dateNF_fix(Lr,vr.dateNF,Lr.match(Ar)||[]),Hr=1),vr.cellDates?(Fr.t="d",Fr.v=parseDate(Lr,Hr)):(Fr.t="n",Fr.v=datenum(parseDate(Lr,Hr))),vr.cellText!==!1&&(Fr.w=SSF_format(Fr.z,Fr.v instanceof Date?datenum(Fr.v):Fr.v)),vr.cellNF||delete Fr.z}else Fr.t="s",Fr.v=Lr;if(Fr.t=="z"||(vr.dense?(yr[_r]||(yr[_r]=[]),yr[_r][jr]=Fr):yr[encode_cell({c:jr,r:_r})]=Fr),Sr=Tr+1,kr=xr.charCodeAt(Sr),br.e.c<jr&&(br.e.c=jr),br.e.r<_r&&(br.e.r=_r),Cr==Rr)++jr;else if(jr=0,++_r,vr.sheetRows&&vr.sheetRows<=_r)return!0}e:for(;Tr<xr.length;++Tr)switch(Cr=xr.charCodeAt(Tr)){case 34:kr===34&&(Nr=!Nr);break;case Rr:case 10:case 13:if(!Nr&&Or())break e;break}return Tr-Sr>0&&Or(),yr["!ref"]=encode_range(br),yr}function hr(xr,Er){return!(Er&&Er.PRN)||Er.FS||xr.slice(0,4)=="sep="||xr.indexOf("	")>=0||xr.indexOf(",")>=0||xr.indexOf(";")>=0?dr(xr,Er):aoa_to_sheet(or(xr,Er),Er)}function pr(xr,Er){var vr="",gr=Er.type=="string"?[0,0,0,0]:firstbyte(xr,Er);switch(Er.type){case"base64":vr=Base64_decode(xr);break;case"binary":vr=xr;break;case"buffer":Er.codepage==65001?vr=xr.toString("utf8"):Er.codepage&&typeof $cptable<"u"||(vr=has_buf&&Buffer.isBuffer(xr)?xr.toString("binary"):a2s(xr));break;case"array":vr=cc2str(xr);break;case"string":vr=xr;break;default:throw new Error("Unrecognized type "+Er.type)}return gr[0]==239&&gr[1]==187&&gr[2]==191?vr=utf8read(vr.slice(3)):Er.type!="string"&&Er.type!="buffer"&&Er.codepage==65001?vr=utf8read(vr):Er.type=="binary"&&typeof $cptable<"u",vr.slice(0,19)=="socialcalc:version:"?ETH.to_sheet(Er.type=="string"?vr:utf8read(vr),Er):hr(vr,Er)}function mr(xr,Er){return sheet_to_workbook(pr(xr,Er),Er)}function fr(xr){for(var Er=[],vr=safe_decode_range(xr["!ref"]),gr,yr=Array.isArray(xr),br=vr.s.r;br<=vr.e.r;++br){for(var _r=[],jr=vr.s.c;jr<=vr.e.c;++jr){var wr=encode_cell({r:br,c:jr});if(gr=yr?(xr[br]||[])[jr]:xr[wr],!gr||gr.v==null){_r.push("          ");continue}for(var Sr=(gr.w||(format_cell(gr),gr.w)||"").slice(0,10);Sr.length<10;)Sr+=" ";_r.push(Sr+(jr===0?" ":""))}Er.push(_r.join(""))}return Er.join(`
`)}return{to_workbook:mr,to_sheet:pr,from_sheet:fr}}(),WK_=function(){function ar(Ir,Dr,Pr){if(Ir){prep_blob(Ir,Ir.l||0);for(var Mr=Pr.Enum||Vr;Ir.l<Ir.length;){var Br=Ir.read_shift(2),Xr=Mr[Br]||Mr[65535],Wr=Ir.read_shift(2),ss=Ir.l+Wr,ds=Xr.f&&Xr.f(Ir,Wr,Pr);if(Ir.l=ss,Dr(ds,Xr,Br))return}}}function or(Ir,Dr){switch(Dr.type){case"base64":return lr(s2a(Base64_decode(Ir)),Dr);case"binary":return lr(s2a(Ir),Dr);case"buffer":case"array":return lr(Ir,Dr)}throw"Unsupported type "+Dr.type}function lr(Ir,Dr){if(!Ir)return Ir;var Pr=Dr||{},Mr=Pr.dense?[]:{},Br="Sheet1",Xr="",Wr=0,ss={},ds=[],ns=[],fs={s:{r:0,c:0},e:{r:0,c:0}},bs=Pr.sheetRows||0;if(Ir[2]==0&&(Ir[3]==8||Ir[3]==9)&&Ir.length>=16&&Ir[14]==5&&Ir[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(Ir[2]==2)Pr.Enum=Vr,ar(Ir,function(as,qr,ts){switch(ts){case 0:Pr.vers=as,as>=4096&&(Pr.qpro=!0);break;case 6:fs=as;break;case 204:as&&(Xr=as);break;case 222:Xr=as;break;case 15:case 51:Pr.qpro||(as[1].v=as[1].v.slice(1));case 13:case 14:case 16:ts==14&&(as[2]&112)==112&&(as[2]&15)>1&&(as[2]&15)<15&&(as[1].z=Pr.dateNF||table_fmt[14],Pr.cellDates&&(as[1].t="d",as[1].v=numdate(as[1].v))),Pr.qpro&&as[3]>Wr&&(Mr["!ref"]=encode_range(fs),ss[Br]=Mr,ds.push(Br),Mr=Pr.dense?[]:{},fs={s:{r:0,c:0},e:{r:0,c:0}},Wr=as[3],Br=Xr||"Sheet"+(Wr+1),Xr="");var Yr=Pr.dense?(Mr[as[0].r]||[])[as[0].c]:Mr[encode_cell(as[0])];if(Yr){Yr.t=as[1].t,Yr.v=as[1].v,as[1].z!=null&&(Yr.z=as[1].z),as[1].f!=null&&(Yr.f=as[1].f);break}Pr.dense?(Mr[as[0].r]||(Mr[as[0].r]=[]),Mr[as[0].r][as[0].c]=as[1]):Mr[encode_cell(as[0])]=as[1];break}},Pr);else if(Ir[2]==26||Ir[2]==14)Pr.Enum=es,Ir[2]==14&&(Pr.qpro=!0,Ir.l=0),ar(Ir,function(as,qr,ts){switch(ts){case 204:Br=as;break;case 22:as[1].v=as[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(as[3]>Wr&&(Mr["!ref"]=encode_range(fs),ss[Br]=Mr,ds.push(Br),Mr=Pr.dense?[]:{},fs={s:{r:0,c:0},e:{r:0,c:0}},Wr=as[3],Br="Sheet"+(Wr+1)),bs>0&&as[0].r>=bs)break;Pr.dense?(Mr[as[0].r]||(Mr[as[0].r]=[]),Mr[as[0].r][as[0].c]=as[1]):Mr[encode_cell(as[0])]=as[1],fs.e.c<as[0].c&&(fs.e.c=as[0].c),fs.e.r<as[0].r&&(fs.e.r=as[0].r);break;case 27:as[14e3]&&(ns[as[14e3][0]]=as[14e3][1]);break;case 1537:ns[as[0]]=as[1],as[0]==Wr&&(Br=as[1]);break}},Pr);else throw new Error("Unrecognized LOTUS BOF "+Ir[2]);if(Mr["!ref"]=encode_range(fs),ss[Xr||Br]=Mr,ds.push(Xr||Br),!ns.length)return{SheetNames:ds,Sheets:ss};for(var Es={},Ds=[],gs=0;gs<ns.length;++gs)ss[ds[gs]]?(Ds.push(ns[gs]||ds[gs]),Es[ns[gs]]=ss[ns[gs]]||ss[ds[gs]]):(Ds.push(ns[gs]),Es[ns[gs]]={"!ref":"A1"});return{SheetNames:Ds,Sheets:Es}}function cr(Ir,Dr){var Pr=Dr||{};if(+Pr.codepage>=0&&set_cp(+Pr.codepage),Pr.type=="string")throw new Error("Cannot write WK1 to JS string");var Mr=buf_array(),Br=safe_decode_range(Ir["!ref"]),Xr=Array.isArray(Ir),Wr=[];write_biff_rec(Mr,0,dr(1030)),write_biff_rec(Mr,6,mr(Br));for(var ss=Math.min(Br.e.r,8191),ds=Br.s.r;ds<=ss;++ds)for(var ns=encode_row(ds),fs=Br.s.c;fs<=Br.e.c;++fs){ds===Br.s.r&&(Wr[fs]=encode_col(fs));var bs=Wr[fs]+ns,Es=Xr?(Ir[ds]||[])[fs]:Ir[bs];if(!(!Es||Es.t=="z"))if(Es.t=="n")(Es.v|0)==Es.v&&Es.v>=-32768&&Es.v<=32767?write_biff_rec(Mr,13,gr(ds,fs,Es.v)):write_biff_rec(Mr,14,br(ds,fs,Es.v));else{var Ds=format_cell(Es);write_biff_rec(Mr,15,Er(ds,fs,Ds.slice(0,239)))}}return write_biff_rec(Mr,1),Mr.end()}function ur(Ir,Dr){var Pr=Dr||{};if(+Pr.codepage>=0&&set_cp(+Pr.codepage),Pr.type=="string")throw new Error("Cannot write WK3 to JS string");var Mr=buf_array();write_biff_rec(Mr,0,hr(Ir));for(var Br=0,Xr=0;Br<Ir.SheetNames.length;++Br)(Ir.Sheets[Ir.SheetNames[Br]]||{})["!ref"]&&write_biff_rec(Mr,27,Ur(Ir.SheetNames[Br],Xr++));var Wr=0;for(Br=0;Br<Ir.SheetNames.length;++Br){var ss=Ir.Sheets[Ir.SheetNames[Br]];if(!(!ss||!ss["!ref"])){for(var ds=safe_decode_range(ss["!ref"]),ns=Array.isArray(ss),fs=[],bs=Math.min(ds.e.r,8191),Es=ds.s.r;Es<=bs;++Es)for(var Ds=encode_row(Es),gs=ds.s.c;gs<=ds.e.c;++gs){Es===ds.s.r&&(fs[gs]=encode_col(gs));var as=fs[gs]+Ds,qr=ns?(ss[Es]||[])[gs]:ss[as];if(!(!qr||qr.t=="z"))if(qr.t=="n")write_biff_rec(Mr,23,Or(Es,gs,Wr,qr.v));else{var ts=format_cell(qr);write_biff_rec(Mr,22,Cr(Es,gs,Wr,ts.slice(0,239)))}}++Wr}}return write_biff_rec(Mr,1),Mr.end()}function dr(Ir){var Dr=new_buf(2);return Dr.write_shift(2,Ir),Dr}function hr(Ir){var Dr=new_buf(26);Dr.write_shift(2,4096),Dr.write_shift(2,4),Dr.write_shift(4,0);for(var Pr=0,Mr=0,Br=0,Xr=0;Xr<Ir.SheetNames.length;++Xr){var Wr=Ir.SheetNames[Xr],ss=Ir.Sheets[Wr];if(!(!ss||!ss["!ref"])){++Br;var ds=decode_range(ss["!ref"]);Pr<ds.e.r&&(Pr=ds.e.r),Mr<ds.e.c&&(Mr=ds.e.c)}}return Pr>8191&&(Pr=8191),Dr.write_shift(2,Pr),Dr.write_shift(1,Br),Dr.write_shift(1,Mr),Dr.write_shift(2,0),Dr.write_shift(2,0),Dr.write_shift(1,1),Dr.write_shift(1,2),Dr.write_shift(4,0),Dr.write_shift(4,0),Dr}function pr(Ir,Dr,Pr){var Mr={s:{c:0,r:0},e:{c:0,r:0}};return Dr==8&&Pr.qpro?(Mr.s.c=Ir.read_shift(1),Ir.l++,Mr.s.r=Ir.read_shift(2),Mr.e.c=Ir.read_shift(1),Ir.l++,Mr.e.r=Ir.read_shift(2),Mr):(Mr.s.c=Ir.read_shift(2),Mr.s.r=Ir.read_shift(2),Dr==12&&Pr.qpro&&(Ir.l+=2),Mr.e.c=Ir.read_shift(2),Mr.e.r=Ir.read_shift(2),Dr==12&&Pr.qpro&&(Ir.l+=2),Mr.s.c==65535&&(Mr.s.c=Mr.e.c=Mr.s.r=Mr.e.r=0),Mr)}function mr(Ir){var Dr=new_buf(8);return Dr.write_shift(2,Ir.s.c),Dr.write_shift(2,Ir.s.r),Dr.write_shift(2,Ir.e.c),Dr.write_shift(2,Ir.e.r),Dr}function fr(Ir,Dr,Pr){var Mr=[{c:0,r:0},{t:"n",v:0},0,0];return Pr.qpro&&Pr.vers!=20768?(Mr[0].c=Ir.read_shift(1),Mr[3]=Ir.read_shift(1),Mr[0].r=Ir.read_shift(2),Ir.l+=2):(Mr[2]=Ir.read_shift(1),Mr[0].c=Ir.read_shift(2),Mr[0].r=Ir.read_shift(2)),Mr}function xr(Ir,Dr,Pr){var Mr=Ir.l+Dr,Br=fr(Ir,Dr,Pr);if(Br[1].t="s",Pr.vers==20768){Ir.l++;var Xr=Ir.read_shift(1);return Br[1].v=Ir.read_shift(Xr,"utf8"),Br}return Pr.qpro&&Ir.l++,Br[1].v=Ir.read_shift(Mr-Ir.l,"cstr"),Br}function Er(Ir,Dr,Pr){var Mr=new_buf(7+Pr.length);Mr.write_shift(1,255),Mr.write_shift(2,Dr),Mr.write_shift(2,Ir),Mr.write_shift(1,39);for(var Br=0;Br<Mr.length;++Br){var Xr=Pr.charCodeAt(Br);Mr.write_shift(1,Xr>=128?95:Xr)}return Mr.write_shift(1,0),Mr}function vr(Ir,Dr,Pr){var Mr=fr(Ir,Dr,Pr);return Mr[1].v=Ir.read_shift(2,"i"),Mr}function gr(Ir,Dr,Pr){var Mr=new_buf(7);return Mr.write_shift(1,255),Mr.write_shift(2,Dr),Mr.write_shift(2,Ir),Mr.write_shift(2,Pr,"i"),Mr}function yr(Ir,Dr,Pr){var Mr=fr(Ir,Dr,Pr);return Mr[1].v=Ir.read_shift(8,"f"),Mr}function br(Ir,Dr,Pr){var Mr=new_buf(13);return Mr.write_shift(1,255),Mr.write_shift(2,Dr),Mr.write_shift(2,Ir),Mr.write_shift(8,Pr,"f"),Mr}function _r(Ir,Dr,Pr){var Mr=Ir.l+Dr,Br=fr(Ir,Dr,Pr);if(Br[1].v=Ir.read_shift(8,"f"),Pr.qpro)Ir.l=Mr;else{var Xr=Ir.read_shift(2);Tr(Ir.slice(Ir.l,Ir.l+Xr),Br),Ir.l+=Xr}return Br}function jr(Ir,Dr,Pr){var Mr=Dr&32768;return Dr&=-32769,Dr=(Mr?Ir:0)+(Dr>=8192?Dr-16384:Dr),(Mr?"":"$")+(Pr?encode_col(Dr):encode_row(Dr))}var wr={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},Sr=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function Tr(Ir,Dr){prep_blob(Ir,0);for(var Pr=[],Mr=0,Br="",Xr="",Wr="",ss="";Ir.l<Ir.length;){var ds=Ir[Ir.l++];switch(ds){case 0:Pr.push(Ir.read_shift(8,"f"));break;case 1:Xr=jr(Dr[0].c,Ir.read_shift(2),!0),Br=jr(Dr[0].r,Ir.read_shift(2),!1),Pr.push(Xr+Br);break;case 2:{var ns=jr(Dr[0].c,Ir.read_shift(2),!0),fs=jr(Dr[0].r,Ir.read_shift(2),!1);Xr=jr(Dr[0].c,Ir.read_shift(2),!0),Br=jr(Dr[0].r,Ir.read_shift(2),!1),Pr.push(ns+fs+":"+Xr+Br)}break;case 3:if(Ir.l<Ir.length){console.error("WK1 premature formula end");return}break;case 4:Pr.push("("+Pr.pop()+")");break;case 5:Pr.push(Ir.read_shift(2));break;case 6:{for(var bs="";ds=Ir[Ir.l++];)bs+=String.fromCharCode(ds);Pr.push('"'+bs.replace(/"/g,'""')+'"')}break;case 8:Pr.push("-"+Pr.pop());break;case 23:Pr.push("+"+Pr.pop());break;case 22:Pr.push("NOT("+Pr.pop()+")");break;case 20:case 21:ss=Pr.pop(),Wr=Pr.pop(),Pr.push(["AND","OR"][ds-20]+"("+Wr+","+ss+")");break;default:if(ds<32&&Sr[ds])ss=Pr.pop(),Wr=Pr.pop(),Pr.push(Wr+Sr[ds]+ss);else if(wr[ds]){if(Mr=wr[ds][1],Mr==69&&(Mr=Ir[Ir.l++]),Mr>Pr.length){console.error("WK1 bad formula parse 0x"+ds.toString(16)+":|"+Pr.join("|")+"|");return}var Es=Pr.slice(-Mr);Pr.length-=Mr,Pr.push(wr[ds][0]+"("+Es.join(",")+")")}else return ds<=7?console.error("WK1 invalid opcode "+ds.toString(16)):ds<=24?console.error("WK1 unsupported op "+ds.toString(16)):ds<=30?console.error("WK1 invalid opcode "+ds.toString(16)):ds<=115?console.error("WK1 unsupported function opcode "+ds.toString(16)):console.error("WK1 unrecognized opcode "+ds.toString(16))}}Pr.length==1?Dr[1].f=""+Pr[0]:console.error("WK1 bad formula parse |"+Pr.join("|")+"|")}function Rr(Ir){var Dr=[{c:0,r:0},{t:"n",v:0},0];return Dr[0].r=Ir.read_shift(2),Dr[3]=Ir[Ir.l++],Dr[0].c=Ir[Ir.l++],Dr}function Nr(Ir,Dr){var Pr=Rr(Ir);return Pr[1].t="s",Pr[1].v=Ir.read_shift(Dr-4,"cstr"),Pr}function Cr(Ir,Dr,Pr,Mr){var Br=new_buf(6+Mr.length);Br.write_shift(2,Ir),Br.write_shift(1,Pr),Br.write_shift(1,Dr),Br.write_shift(1,39);for(var Xr=0;Xr<Mr.length;++Xr){var Wr=Mr.charCodeAt(Xr);Br.write_shift(1,Wr>=128?95:Wr)}return Br.write_shift(1,0),Br}function kr(Ir,Dr){var Pr=Rr(Ir);Pr[1].v=Ir.read_shift(2);var Mr=Pr[1].v>>1;if(Pr[1].v&1)switch(Mr&7){case 0:Mr=(Mr>>3)*5e3;break;case 1:Mr=(Mr>>3)*500;break;case 2:Mr=(Mr>>3)/20;break;case 3:Mr=(Mr>>3)/200;break;case 4:Mr=(Mr>>3)/2e3;break;case 5:Mr=(Mr>>3)/2e4;break;case 6:Mr=(Mr>>3)/16;break;case 7:Mr=(Mr>>3)/64;break}return Pr[1].v=Mr,Pr}function Ar(Ir,Dr){var Pr=Rr(Ir),Mr=Ir.read_shift(4),Br=Ir.read_shift(4),Xr=Ir.read_shift(2);if(Xr==65535)return Mr===0&&Br===3221225472?(Pr[1].t="e",Pr[1].v=15):Mr===0&&Br===3489660928?(Pr[1].t="e",Pr[1].v=42):Pr[1].v=0,Pr;var Wr=Xr&32768;return Xr=(Xr&32767)-16446,Pr[1].v=(1-Wr*2)*(Br*Math.pow(2,Xr+32)+Mr*Math.pow(2,Xr)),Pr}function Or(Ir,Dr,Pr,Mr){var Br=new_buf(14);if(Br.write_shift(2,Ir),Br.write_shift(1,Pr),Br.write_shift(1,Dr),Mr==0)return Br.write_shift(4,0),Br.write_shift(4,0),Br.write_shift(2,65535),Br;var Xr=0,Wr=0,ss=0,ds=0;return Mr<0&&(Xr=1,Mr=-Mr),Wr=Math.log2(Mr)|0,Mr/=Math.pow(2,Wr-31),ds=Mr>>>0,ds&2147483648||(Mr/=2,++Wr,ds=Mr>>>0),Mr-=ds,ds|=2147483648,ds>>>=0,Mr*=Math.pow(2,32),ss=Mr>>>0,Br.write_shift(4,ss),Br.write_shift(4,ds),Wr+=16383+(Xr?32768:0),Br.write_shift(2,Wr),Br}function Lr(Ir,Dr){var Pr=Ar(Ir);return Ir.l+=Dr-14,Pr}function Fr(Ir,Dr){var Pr=Rr(Ir),Mr=Ir.read_shift(4);return Pr[1].v=Mr>>6,Pr}function Hr(Ir,Dr){var Pr=Rr(Ir),Mr=Ir.read_shift(8,"f");return Pr[1].v=Mr,Pr}function Kr(Ir,Dr){var Pr=Hr(Ir);return Ir.l+=Dr-10,Pr}function Gr(Ir,Dr){return Ir[Ir.l+Dr-1]==0?Ir.read_shift(Dr,"cstr"):""}function Zr(Ir,Dr){var Pr=Ir[Ir.l++];Pr>Dr-1&&(Pr=Dr-1);for(var Mr="";Mr.length<Pr;)Mr+=String.fromCharCode(Ir[Ir.l++]);return Mr}function Jr(Ir,Dr,Pr){if(!(!Pr.qpro||Dr<21)){var Mr=Ir.read_shift(1);Ir.l+=17,Ir.l+=1,Ir.l+=2;var Br=Ir.read_shift(Dr-21,"cstr");return[Mr,Br]}}function os(Ir,Dr){for(var Pr={},Mr=Ir.l+Dr;Ir.l<Mr;){var Br=Ir.read_shift(2);if(Br==14e3){for(Pr[Br]=[0,""],Pr[Br][0]=Ir.read_shift(2);Ir[Ir.l];)Pr[Br][1]+=String.fromCharCode(Ir[Ir.l]),Ir.l++;Ir.l++}}return Pr}function Ur(Ir,Dr){var Pr=new_buf(5+Ir.length);Pr.write_shift(2,14e3),Pr.write_shift(2,Dr);for(var Mr=0;Mr<Ir.length;++Mr){var Br=Ir.charCodeAt(Mr);Pr[Pr.l++]=Br>127?95:Br}return Pr[Pr.l++]=0,Pr}var Vr={0:{n:"BOF",f:parseuint16},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:pr},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:vr},14:{n:"NUMBER",f:yr},15:{n:"LABEL",f:xr},16:{n:"FORMULA",f:_r},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:xr},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:Gr},222:{n:"SHEETNAMELP",f:Zr},65535:{n:""}},es={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:Nr},23:{n:"NUMBER17",f:Ar},24:{n:"NUMBER18",f:kr},25:{n:"FORMULA19",f:Lr},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:os},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Fr},38:{n:"??"},39:{n:"NUMBER27",f:Hr},40:{n:"FORMULA28",f:Kr},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:Gr},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:Jr},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:cr,book_to_wk3:ur,to_workbook:or}}(),straywsregex=/^\s|\s$|[\t\n\r]/;function write_sst_xml(ar,or){if(!or.bookSST)return"";var lr=[XML_HEADER];lr[lr.length]=writextag("sst",null,{xmlns:XMLNS_main[0],count:ar.Count,uniqueCount:ar.Unique});for(var cr=0;cr!=ar.length;++cr)if(ar[cr]!=null){var ur=ar[cr],dr="<si>";ur.r?dr+=ur.r:(dr+="<t",ur.t||(ur.t=""),ur.t.match(straywsregex)&&(dr+=' xml:space="preserve"'),dr+=">"+escapexml(ur.t)+"</t>"),dr+="</si>",lr[lr.length]=dr}return lr.length>2&&(lr[lr.length]="</sst>",lr[1]=lr[1].replace("/>",">")),lr.join("")}function parse_BrtBeginSst(ar){return[ar.read_shift(4),ar.read_shift(4)]}function write_BrtBeginSst(ar,or){return or||(or=new_buf(8)),or.write_shift(4,ar.Count),or.write_shift(4,ar.Unique),or}var write_BrtSSTItem=write_RichStr;function write_sst_bin(ar){var or=buf_array();write_record(or,159,write_BrtBeginSst(ar));for(var lr=0;lr<ar.length;++lr)write_record(or,19,write_BrtSSTItem(ar[lr]));return write_record(or,160),or.end()}function _JS2ANSI(ar){for(var or=[],lr=ar.split(""),cr=0;cr<lr.length;++cr)or[cr]=lr[cr].charCodeAt(0);return or}function crypto_CreatePasswordVerifier_Method1(ar){var or=0,lr,cr=_JS2ANSI(ar),ur=cr.length+1,dr,hr,pr,mr,fr;for(lr=new_raw_buf(ur),lr[0]=cr.length,dr=1;dr!=ur;++dr)lr[dr]=cr[dr-1];for(dr=ur-1;dr>=0;--dr)hr=lr[dr],pr=or&16384?1:0,mr=or<<1&32767,fr=pr|mr,or=fr^hr;return or^52811}var RTF=function(){function ar(ur,dr){switch(dr.type){case"base64":return or(Base64_decode(ur),dr);case"binary":return or(ur,dr);case"buffer":return or(has_buf&&Buffer.isBuffer(ur)?ur.toString("binary"):a2s(ur),dr);case"array":return or(cc2str(ur),dr)}throw new Error("Unrecognized type "+dr.type)}function or(ur,dr){var hr=dr||{},pr=hr.dense?[]:{},mr=ur.match(/\\trowd.*?\\row\b/g);if(!mr.length)throw new Error("RTF missing table");var fr={s:{c:0,r:0},e:{c:0,r:mr.length-1}};return mr.forEach(function(xr,Er){Array.isArray(pr)&&(pr[Er]=[]);for(var vr=/\\\w+\b/g,gr=0,yr,br=-1;yr=vr.exec(xr);){switch(yr[0]){case"\\cell":var _r=xr.slice(gr,vr.lastIndex-yr[0].length);if(_r[0]==" "&&(_r=_r.slice(1)),++br,_r.length){var jr={v:_r,t:"s"};Array.isArray(pr)?pr[Er][br]=jr:pr[encode_cell({r:Er,c:br})]=jr}break}gr=vr.lastIndex}br>fr.e.c&&(fr.e.c=br)}),pr["!ref"]=encode_range(fr),pr}function lr(ur,dr){return sheet_to_workbook(ar(ur,dr),dr)}function cr(ur){for(var dr=["{\\rtf1\\ansi"],hr=safe_decode_range(ur["!ref"]),pr,mr=Array.isArray(ur),fr=hr.s.r;fr<=hr.e.r;++fr){dr.push("\\trowd\\trautofit1");for(var xr=hr.s.c;xr<=hr.e.c;++xr)dr.push("\\cellx"+(xr+1));for(dr.push("\\pard\\intbl"),xr=hr.s.c;xr<=hr.e.c;++xr){var Er=encode_cell({r:fr,c:xr});pr=mr?(ur[fr]||[])[xr]:ur[Er],!(!pr||pr.v==null&&(!pr.f||pr.F))&&(dr.push(" "+(pr.w||(format_cell(pr),pr.w))),dr.push("\\cell"))}dr.push("\\pard\\intbl\\row")}return dr.join("")+"}"}return{to_workbook:lr,to_sheet:ar,from_sheet:cr}}();function rgb2Hex(ar){for(var or=0,lr=1;or!=3;++or)lr=lr*256+(ar[or]>255?255:ar[or]<0?0:ar[or]);return lr.toString(16).toUpperCase().slice(1)}var DEF_MDW=6,MDW=DEF_MDW;function width2px(ar){return Math.floor((ar+Math.round(128/MDW)/256)*MDW)}function px2char(ar){return Math.floor((ar-5)/MDW*100+.5)/100}function char2width(ar){return Math.round((ar*MDW+5)/MDW*256)/256}function process_col(ar){ar.width?(ar.wpx=width2px(ar.width),ar.wch=px2char(ar.wpx),ar.MDW=MDW):ar.wpx?(ar.wch=px2char(ar.wpx),ar.width=char2width(ar.wch),ar.MDW=MDW):typeof ar.wch=="number"&&(ar.width=char2width(ar.wch),ar.wpx=width2px(ar.width),ar.MDW=MDW),ar.customWidth&&delete ar.customWidth}var DEF_PPI=96,PPI=DEF_PPI;function px2pt(ar){return ar*96/PPI}function pt2px(ar){return ar*PPI/96}function write_numFmts(ar){var or=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(lr){for(var cr=lr[0];cr<=lr[1];++cr)ar[cr]!=null&&(or[or.length]=writextag("numFmt",null,{numFmtId:cr,formatCode:escapexml(ar[cr])}))}),or.length===1?"":(or[or.length]="</numFmts>",or[0]=writextag("numFmts",null,{count:or.length-2}).replace("/>",">"),or.join(""))}function write_cellXfs(ar){var or=[];return or[or.length]=writextag("cellXfs",null),ar.forEach(function(lr){or[or.length]=writextag("xf",null,lr)}),or[or.length]="</cellXfs>",or.length===2?"":(or[0]=writextag("cellXfs",null,{count:or.length-2}).replace("/>",">"),or.join(""))}function write_sty_xml(ar,or){var lr=[XML_HEADER,writextag("styleSheet",null,{xmlns:XMLNS_main[0],"xmlns:vt":XMLNS.vt})],cr;return ar.SSF&&(cr=write_numFmts(ar.SSF))!=null&&(lr[lr.length]=cr),lr[lr.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',lr[lr.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',lr[lr.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',lr[lr.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(cr=write_cellXfs(or.cellXfs))&&(lr[lr.length]=cr),lr[lr.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',lr[lr.length]='<dxfs count="0"/>',lr[lr.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',lr.length>2&&(lr[lr.length]="</styleSheet>",lr[1]=lr[1].replace("/>",">")),lr.join("")}function parse_BrtFmt(ar,or){var lr=ar.read_shift(2),cr=parse_XLWideString(ar);return[lr,cr]}function write_BrtFmt(ar,or,lr){lr||(lr=new_buf(6+4*or.length)),lr.write_shift(2,ar),write_XLWideString(or,lr);var cr=lr.length>lr.l?lr.slice(0,lr.l):lr;return lr.l==null&&(lr.l=lr.length),cr}function parse_BrtFont(ar,or,lr){var cr={};cr.sz=ar.read_shift(2)/20;var ur=parse_FontFlags(ar);ur.fItalic&&(cr.italic=1),ur.fCondense&&(cr.condense=1),ur.fExtend&&(cr.extend=1),ur.fShadow&&(cr.shadow=1),ur.fOutline&&(cr.outline=1),ur.fStrikeout&&(cr.strike=1);var dr=ar.read_shift(2);switch(dr===700&&(cr.bold=1),ar.read_shift(2)){case 1:cr.vertAlign="superscript";break;case 2:cr.vertAlign="subscript";break}var hr=ar.read_shift(1);hr!=0&&(cr.underline=hr);var pr=ar.read_shift(1);pr>0&&(cr.family=pr);var mr=ar.read_shift(1);switch(mr>0&&(cr.charset=mr),ar.l++,cr.color=parse_BrtColor(ar),ar.read_shift(1)){case 1:cr.scheme="major";break;case 2:cr.scheme="minor";break}return cr.name=parse_XLWideString(ar),cr}function write_BrtFont(ar,or){or||(or=new_buf(25+4*32)),or.write_shift(2,ar.sz*20),write_FontFlags(ar,or),or.write_shift(2,ar.bold?700:400);var lr=0;ar.vertAlign=="superscript"?lr=1:ar.vertAlign=="subscript"&&(lr=2),or.write_shift(2,lr),or.write_shift(1,ar.underline||0),or.write_shift(1,ar.family||0),or.write_shift(1,ar.charset||0),or.write_shift(1,0),write_BrtColor(ar.color,or);var cr=0;return cr=2,or.write_shift(1,cr),write_XLWideString(ar.name,or),or.length>or.l?or.slice(0,or.l):or}var XLSBFillPTNames=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],rev_XLSBFillPTNames,parse_BrtFill=parsenoop;function write_BrtFill(ar,or){or||(or=new_buf(4*3+8*7+16*1)),rev_XLSBFillPTNames||(rev_XLSBFillPTNames=evert(XLSBFillPTNames));var lr=rev_XLSBFillPTNames[ar.patternType];lr==null&&(lr=40),or.write_shift(4,lr);var cr=0;if(lr!=40)for(write_BrtColor({auto:1},or),write_BrtColor({auto:1},or);cr<12;++cr)or.write_shift(4,0);else{for(;cr<4;++cr)or.write_shift(4,0);for(;cr<12;++cr)or.write_shift(4,0)}return or.length>or.l?or.slice(0,or.l):or}function parse_BrtXF(ar,or){var lr=ar.l+or,cr=ar.read_shift(2),ur=ar.read_shift(2);return ar.l=lr,{ixfe:cr,numFmtId:ur}}function write_BrtXF(ar,or,lr){lr||(lr=new_buf(16)),lr.write_shift(2,or||0),lr.write_shift(2,ar.numFmtId||0),lr.write_shift(2,0),lr.write_shift(2,0),lr.write_shift(2,0),lr.write_shift(1,0),lr.write_shift(1,0);var cr=0;return lr.write_shift(1,cr),lr.write_shift(1,0),lr.write_shift(1,0),lr.write_shift(1,0),lr}function write_Blxf(ar,or){return or||(or=new_buf(10)),or.write_shift(1,0),or.write_shift(1,0),or.write_shift(4,0),or.write_shift(4,0),or}var parse_BrtBorder=parsenoop;function write_BrtBorder(ar,or){return or||(or=new_buf(51)),or.write_shift(1,0),write_Blxf(null,or),write_Blxf(null,or),write_Blxf(null,or),write_Blxf(null,or),write_Blxf(null,or),or.length>or.l?or.slice(0,or.l):or}function write_BrtStyle(ar,or){return or||(or=new_buf(12+4*10)),or.write_shift(4,ar.xfId),or.write_shift(2,1),or.write_shift(1,0),or.write_shift(1,0),write_XLNullableWideString(ar.name||"",or),or.length>or.l?or.slice(0,or.l):or}function write_BrtBeginTableStyles(ar,or,lr){var cr=new_buf(2052);return cr.write_shift(4,ar),write_XLNullableWideString(or,cr),write_XLNullableWideString(lr,cr),cr.length>cr.l?cr.slice(0,cr.l):cr}function write_FMTS_bin(ar,or){if(or){var lr=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(cr){for(var ur=cr[0];ur<=cr[1];++ur)or[ur]!=null&&++lr}),lr!=0&&(write_record(ar,615,write_UInt32LE(lr)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(cr){for(var ur=cr[0];ur<=cr[1];++ur)or[ur]!=null&&write_record(ar,44,write_BrtFmt(ur,or[ur]))}),write_record(ar,616))}}function write_FONTS_bin(ar){var or=1;write_record(ar,611,write_UInt32LE(or)),write_record(ar,43,write_BrtFont({sz:12,color:{theme:1},name:"Calibri",family:2})),write_record(ar,612)}function write_FILLS_bin(ar){var or=2;write_record(ar,603,write_UInt32LE(or)),write_record(ar,45,write_BrtFill({patternType:"none"})),write_record(ar,45,write_BrtFill({patternType:"gray125"})),write_record(ar,604)}function write_BORDERS_bin(ar){var or=1;write_record(ar,613,write_UInt32LE(or)),write_record(ar,46,write_BrtBorder()),write_record(ar,614)}function write_CELLSTYLEXFS_bin(ar){var or=1;write_record(ar,626,write_UInt32LE(or)),write_record(ar,47,write_BrtXF({numFmtId:0},65535)),write_record(ar,627)}function write_CELLXFS_bin(ar,or){write_record(ar,617,write_UInt32LE(or.length)),or.forEach(function(lr){write_record(ar,47,write_BrtXF(lr,0))}),write_record(ar,618)}function write_STYLES_bin(ar){var or=1;write_record(ar,619,write_UInt32LE(or)),write_record(ar,48,write_BrtStyle({xfId:0,name:"Normal"})),write_record(ar,620)}function write_DXFS_bin(ar){var or=0;write_record(ar,505,write_UInt32LE(or)),write_record(ar,506)}function write_TABLESTYLES_bin(ar){var or=0;write_record(ar,508,write_BrtBeginTableStyles(or,"TableStyleMedium9","PivotStyleMedium4")),write_record(ar,509)}function write_sty_bin(ar,or){var lr=buf_array();return write_record(lr,278),write_FMTS_bin(lr,ar.SSF),write_FONTS_bin(lr),write_FILLS_bin(lr),write_BORDERS_bin(lr),write_CELLSTYLEXFS_bin(lr),write_CELLXFS_bin(lr,or.cellXfs),write_STYLES_bin(lr),write_DXFS_bin(lr),write_TABLESTYLES_bin(lr),write_record(lr,279),lr.end()}function write_theme(ar,or){if(or&&or.themeXLSX)return or.themeXLSX;if(ar&&typeof ar.raw=="string")return ar.raw;var lr=[XML_HEADER];return lr[lr.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',lr[lr.length]="<a:themeElements>",lr[lr.length]='<a:clrScheme name="Office">',lr[lr.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',lr[lr.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',lr[lr.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',lr[lr.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',lr[lr.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',lr[lr.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',lr[lr.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',lr[lr.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',lr[lr.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',lr[lr.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',lr[lr.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',lr[lr.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',lr[lr.length]="</a:clrScheme>",lr[lr.length]='<a:fontScheme name="Office">',lr[lr.length]="<a:majorFont>",lr[lr.length]='<a:latin typeface="Cambria"/>',lr[lr.length]='<a:ea typeface=""/>',lr[lr.length]='<a:cs typeface=""/>',lr[lr.length]='<a:font script="Jpan" typeface=" "/>',lr[lr.length]='<a:font script="Hang" typeface=" "/>',lr[lr.length]='<a:font script="Hans" typeface=""/>',lr[lr.length]='<a:font script="Hant" typeface=""/>',lr[lr.length]='<a:font script="Arab" typeface="Times New Roman"/>',lr[lr.length]='<a:font script="Hebr" typeface="Times New Roman"/>',lr[lr.length]='<a:font script="Thai" typeface="Tahoma"/>',lr[lr.length]='<a:font script="Ethi" typeface="Nyala"/>',lr[lr.length]='<a:font script="Beng" typeface="Vrinda"/>',lr[lr.length]='<a:font script="Gujr" typeface="Shruti"/>',lr[lr.length]='<a:font script="Khmr" typeface="MoolBoran"/>',lr[lr.length]='<a:font script="Knda" typeface="Tunga"/>',lr[lr.length]='<a:font script="Guru" typeface="Raavi"/>',lr[lr.length]='<a:font script="Cans" typeface="Euphemia"/>',lr[lr.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',lr[lr.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',lr[lr.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',lr[lr.length]='<a:font script="Thaa" typeface="MV Boli"/>',lr[lr.length]='<a:font script="Deva" typeface="Mangal"/>',lr[lr.length]='<a:font script="Telu" typeface="Gautami"/>',lr[lr.length]='<a:font script="Taml" typeface="Latha"/>',lr[lr.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',lr[lr.length]='<a:font script="Orya" typeface="Kalinga"/>',lr[lr.length]='<a:font script="Mlym" typeface="Kartika"/>',lr[lr.length]='<a:font script="Laoo" typeface="DokChampa"/>',lr[lr.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',lr[lr.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',lr[lr.length]='<a:font script="Viet" typeface="Times New Roman"/>',lr[lr.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',lr[lr.length]='<a:font script="Geor" typeface="Sylfaen"/>',lr[lr.length]="</a:majorFont>",lr[lr.length]="<a:minorFont>",lr[lr.length]='<a:latin typeface="Calibri"/>',lr[lr.length]='<a:ea typeface=""/>',lr[lr.length]='<a:cs typeface=""/>',lr[lr.length]='<a:font script="Jpan" typeface=" "/>',lr[lr.length]='<a:font script="Hang" typeface=" "/>',lr[lr.length]='<a:font script="Hans" typeface=""/>',lr[lr.length]='<a:font script="Hant" typeface=""/>',lr[lr.length]='<a:font script="Arab" typeface="Arial"/>',lr[lr.length]='<a:font script="Hebr" typeface="Arial"/>',lr[lr.length]='<a:font script="Thai" typeface="Tahoma"/>',lr[lr.length]='<a:font script="Ethi" typeface="Nyala"/>',lr[lr.length]='<a:font script="Beng" typeface="Vrinda"/>',lr[lr.length]='<a:font script="Gujr" typeface="Shruti"/>',lr[lr.length]='<a:font script="Khmr" typeface="DaunPenh"/>',lr[lr.length]='<a:font script="Knda" typeface="Tunga"/>',lr[lr.length]='<a:font script="Guru" typeface="Raavi"/>',lr[lr.length]='<a:font script="Cans" typeface="Euphemia"/>',lr[lr.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',lr[lr.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',lr[lr.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',lr[lr.length]='<a:font script="Thaa" typeface="MV Boli"/>',lr[lr.length]='<a:font script="Deva" typeface="Mangal"/>',lr[lr.length]='<a:font script="Telu" typeface="Gautami"/>',lr[lr.length]='<a:font script="Taml" typeface="Latha"/>',lr[lr.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',lr[lr.length]='<a:font script="Orya" typeface="Kalinga"/>',lr[lr.length]='<a:font script="Mlym" typeface="Kartika"/>',lr[lr.length]='<a:font script="Laoo" typeface="DokChampa"/>',lr[lr.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',lr[lr.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',lr[lr.length]='<a:font script="Viet" typeface="Arial"/>',lr[lr.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',lr[lr.length]='<a:font script="Geor" typeface="Sylfaen"/>',lr[lr.length]="</a:minorFont>",lr[lr.length]="</a:fontScheme>",lr[lr.length]='<a:fmtScheme name="Office">',lr[lr.length]="<a:fillStyleLst>",lr[lr.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',lr[lr.length]='<a:gradFill rotWithShape="1">',lr[lr.length]="<a:gsLst>",lr[lr.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',lr[lr.length]="</a:gsLst>",lr[lr.length]='<a:lin ang="16200000" scaled="1"/>',lr[lr.length]="</a:gradFill>",lr[lr.length]='<a:gradFill rotWithShape="1">',lr[lr.length]="<a:gsLst>",lr[lr.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',lr[lr.length]="</a:gsLst>",lr[lr.length]='<a:lin ang="16200000" scaled="0"/>',lr[lr.length]="</a:gradFill>",lr[lr.length]="</a:fillStyleLst>",lr[lr.length]="<a:lnStyleLst>",lr[lr.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',lr[lr.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',lr[lr.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',lr[lr.length]="</a:lnStyleLst>",lr[lr.length]="<a:effectStyleLst>",lr[lr.length]="<a:effectStyle>",lr[lr.length]="<a:effectLst>",lr[lr.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',lr[lr.length]="</a:effectLst>",lr[lr.length]="</a:effectStyle>",lr[lr.length]="<a:effectStyle>",lr[lr.length]="<a:effectLst>",lr[lr.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',lr[lr.length]="</a:effectLst>",lr[lr.length]="</a:effectStyle>",lr[lr.length]="<a:effectStyle>",lr[lr.length]="<a:effectLst>",lr[lr.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',lr[lr.length]="</a:effectLst>",lr[lr.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',lr[lr.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',lr[lr.length]="</a:effectStyle>",lr[lr.length]="</a:effectStyleLst>",lr[lr.length]="<a:bgFillStyleLst>",lr[lr.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',lr[lr.length]='<a:gradFill rotWithShape="1">',lr[lr.length]="<a:gsLst>",lr[lr.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',lr[lr.length]="</a:gsLst>",lr[lr.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',lr[lr.length]="</a:gradFill>",lr[lr.length]='<a:gradFill rotWithShape="1">',lr[lr.length]="<a:gsLst>",lr[lr.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',lr[lr.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',lr[lr.length]="</a:gsLst>",lr[lr.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',lr[lr.length]="</a:gradFill>",lr[lr.length]="</a:bgFillStyleLst>",lr[lr.length]="</a:fmtScheme>",lr[lr.length]="</a:themeElements>",lr[lr.length]="<a:objectDefaults>",lr[lr.length]="<a:spDef>",lr[lr.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',lr[lr.length]="</a:spDef>",lr[lr.length]="<a:lnDef>",lr[lr.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',lr[lr.length]="</a:lnDef>",lr[lr.length]="</a:objectDefaults>",lr[lr.length]="<a:extraClrSchemeLst/>",lr[lr.length]="</a:theme>",lr.join("")}function parse_BrtMdtinfo(ar,or){return{flags:ar.read_shift(4),version:ar.read_shift(4),name:parse_XLWideString(ar)}}function write_BrtMdtinfo(ar){var or=new_buf(12+2*ar.name.length);return or.write_shift(4,ar.flags),or.write_shift(4,ar.version),write_XLWideString(ar.name,or),or.slice(0,or.l)}function parse_BrtMdb(ar){for(var or=[],lr=ar.read_shift(4);lr-- >0;)or.push([ar.read_shift(4),ar.read_shift(4)]);return or}function write_BrtMdb(ar){var or=new_buf(4+8*ar.length);or.write_shift(4,ar.length);for(var lr=0;lr<ar.length;++lr)or.write_shift(4,ar[lr][0]),or.write_shift(4,ar[lr][1]);return or}function write_BrtBeginEsfmd(ar,or){var lr=new_buf(8+2*or.length);return lr.write_shift(4,ar),write_XLWideString(or,lr),lr.slice(0,lr.l)}function parse_BrtBeginEsmdb(ar){return ar.l+=4,ar.read_shift(4)!=0}function write_BrtBeginEsmdb(ar,or){var lr=new_buf(8);return lr.write_shift(4,ar),lr.write_shift(4,1),lr}function write_xlmeta_bin(){var ar=buf_array();return write_record(ar,332),write_record(ar,334,write_UInt32LE(1)),write_record(ar,335,write_BrtMdtinfo({name:"XLDAPR",version:12e4,flags:3496657072})),write_record(ar,336),write_record(ar,339,write_BrtBeginEsfmd(1,"XLDAPR")),write_record(ar,52),write_record(ar,35,write_UInt32LE(514)),write_record(ar,4096,write_UInt32LE(0)),write_record(ar,4097,writeuint16(1)),write_record(ar,36),write_record(ar,53),write_record(ar,340),write_record(ar,337,write_BrtBeginEsmdb(1)),write_record(ar,51,write_BrtMdb([[1,0]])),write_record(ar,338),write_record(ar,333),ar.end()}function write_xlmeta_xml(){var ar=[XML_HEADER];return ar.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),ar.join("")}function parse_BrtCalcChainItem$(ar){var or={};or.i=ar.read_shift(4);var lr={};lr.r=ar.read_shift(4),lr.c=ar.read_shift(4),or.r=encode_cell(lr);var cr=ar.read_shift(1);return cr&2&&(or.l="1"),cr&8&&(or.a="1"),or}var _shapeid=1024;function write_comments_vml(ar,or){for(var lr=[21600,21600],cr=["m0,0l0",lr[1],lr[0],lr[1],lr[0],"0xe"].join(","),ur=[writextag("xml",null,{"xmlns:v":XLMLNS.v,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:mv":XLMLNS.mv}).replace(/\/>/,">"),writextag("o:shapelayout",writextag("o:idmap",null,{"v:ext":"edit",data:ar}),{"v:ext":"edit"}),writextag("v:shapetype",[writextag("v:stroke",null,{joinstyle:"miter"}),writextag("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:lr.join(","),path:cr})];_shapeid<ar*1e3;)_shapeid+=1e3;return or.forEach(function(dr){var hr=decode_cell(dr[0]),pr={color2:"#BEFF82",type:"gradient"};pr.type=="gradient"&&(pr.angle="-180");var mr=pr.type=="gradient"?writextag("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,fr=writextag("v:fill",mr,pr),xr={on:"t",obscured:"t"};++_shapeid,ur=ur.concat(["<v:shape"+wxt_helper({id:"_x0000_s"+_shapeid,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(dr[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",fr,writextag("v:shadow",null,xr),writextag("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",writetag("x:Anchor",[hr.c+1,0,hr.r+1,0,hr.c+3,20,hr.r+5,20].join(",")),writetag("x:AutoFill","False"),writetag("x:Row",String(hr.r)),writetag("x:Column",String(hr.c)),dr[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),ur.push("</xml>"),ur.join("")}function write_comments_xml(ar){var or=[XML_HEADER,writextag("comments",null,{xmlns:XMLNS_main[0]})],lr=[];return or.push("<authors>"),ar.forEach(function(cr){cr[1].forEach(function(ur){var dr=escapexml(ur.a);lr.indexOf(dr)==-1&&(lr.push(dr),or.push("<author>"+dr+"</author>")),ur.T&&ur.ID&&lr.indexOf("tc="+ur.ID)==-1&&(lr.push("tc="+ur.ID),or.push("<author>tc="+ur.ID+"</author>"))})}),lr.length==0&&(lr.push("SheetJ5"),or.push("<author>SheetJ5</author>")),or.push("</authors>"),or.push("<commentList>"),ar.forEach(function(cr){var ur=0,dr=[];if(cr[1][0]&&cr[1][0].T&&cr[1][0].ID?ur=lr.indexOf("tc="+cr[1][0].ID):cr[1].forEach(function(mr){mr.a&&(ur=lr.indexOf(escapexml(mr.a))),dr.push(mr.t||"")}),or.push('<comment ref="'+cr[0]+'" authorId="'+ur+'"><text>'),dr.length<=1)or.push(writetag("t",escapexml(dr[0]||"")));else{for(var hr=`Comment:
    `+dr[0]+`
`,pr=1;pr<dr.length;++pr)hr+=`Reply:
    `+dr[pr]+`
`;or.push(writetag("t",escapexml(hr)))}or.push("</text></comment>")}),or.push("</commentList>"),or.length>2&&(or[or.length]="</comments>",or[1]=or[1].replace("/>",">")),or.join("")}function write_tcmnt_xml(ar,or,lr){var cr=[XML_HEADER,writextag("ThreadedComments",null,{xmlns:XMLNS.TCMNT}).replace(/[\/]>/,">")];return ar.forEach(function(ur){var dr="";(ur[1]||[]).forEach(function(hr,pr){if(!hr.T){delete hr.ID;return}hr.a&&or.indexOf(hr.a)==-1&&or.push(hr.a);var mr={ref:ur[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+lr.tcid++).slice(-12)+"}"};pr==0?dr=mr.id:mr.parentId=dr,hr.ID=mr.id,hr.a&&(mr.personId="{54EE7950-7262-4200-6969-"+("000000000000"+or.indexOf(hr.a)).slice(-12)+"}"),cr.push(writextag("threadedComment",writetag("text",hr.t||""),mr))})}),cr.push("</ThreadedComments>"),cr.join("")}function write_people_xml(ar){var or=[XML_HEADER,writextag("personList",null,{xmlns:XMLNS.TCMNT,"xmlns:x":XMLNS_main[0]}).replace(/[\/]>/,">")];return ar.forEach(function(lr,cr){or.push(writextag("person",null,{displayName:lr,id:"{54EE7950-7262-4200-6969-"+("000000000000"+cr).slice(-12)+"}",userId:lr,providerId:"None"}))}),or.push("</personList>"),or.join("")}function parse_BrtBeginComment(ar){var or={};or.iauthor=ar.read_shift(4);var lr=parse_UncheckedRfX(ar);return or.rfx=lr.s,or.ref=encode_cell(lr.s),ar.l+=16,or}function write_BrtBeginComment(ar,or){return or==null&&(or=new_buf(36)),or.write_shift(4,ar[1].iauthor),write_UncheckedRfX(ar[0],or),or.write_shift(4,0),or.write_shift(4,0),or.write_shift(4,0),or.write_shift(4,0),or}var parse_BrtCommentAuthor=parse_XLWideString;function write_BrtCommentAuthor(ar){return write_XLWideString(ar.slice(0,54))}function write_comments_bin(ar){var or=buf_array(),lr=[];return write_record(or,628),write_record(or,630),ar.forEach(function(cr){cr[1].forEach(function(ur){lr.indexOf(ur.a)>-1||(lr.push(ur.a.slice(0,54)),write_record(or,632,write_BrtCommentAuthor(ur.a)))})}),write_record(or,631),write_record(or,633),ar.forEach(function(cr){cr[1].forEach(function(ur){ur.iauthor=lr.indexOf(ur.a);var dr={s:decode_cell(cr[0]),e:decode_cell(cr[0])};write_record(or,635,write_BrtBeginComment([dr,ur])),ur.t&&ur.t.length>0&&write_record(or,637,write_BrtCommentText(ur)),write_record(or,636),delete ur.iauthor})}),write_record(or,634),write_record(or,629),or.end()}function fill_vba_xls(ar,or){or.FullPaths.forEach(function(lr,cr){if(cr!=0){var ur=lr.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");ur.slice(-1)!=="/"&&CFB.utils.cfb_add(ar,ur,or.FileIndex[cr].content)}})}var VBAFMTS=["xlsb","xlsm","xlam","biff8","xla"],rc_to_a1=function(){var ar=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,or={r:0,c:0};function lr(cr,ur,dr,hr){var pr=!1,mr=!1;dr.length==0?mr=!0:dr.charAt(0)=="["&&(mr=!0,dr=dr.slice(1,-1)),hr.length==0?pr=!0:hr.charAt(0)=="["&&(pr=!0,hr=hr.slice(1,-1));var fr=dr.length>0?parseInt(dr,10)|0:0,xr=hr.length>0?parseInt(hr,10)|0:0;return pr?xr+=or.c:--xr,mr?fr+=or.r:--fr,ur+(pr?"":"$")+encode_col(xr)+(mr?"":"$")+encode_row(fr)}return function(ur,dr){return or=dr,ur.replace(ar,lr)}}(),crefregex=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,a1_to_rc=function(){return function(or,lr){return or.replace(crefregex,function(cr,ur,dr,hr,pr,mr){var fr=decode_col(hr)-(dr?0:lr.c),xr=decode_row(mr)-(pr?0:lr.r),Er=xr==0?"":pr?xr+1:"["+xr+"]",vr=fr==0?"":dr?fr+1:"["+fr+"]";return ur+"R"+Er+"C"+vr})}}();function shift_formula_str(ar,or){return ar.replace(crefregex,function(lr,cr,ur,dr,hr,pr){return cr+(ur=="$"?ur+dr:encode_col(decode_col(dr)+or.c))+(hr=="$"?hr+pr:encode_row(decode_row(pr)+or.r))})}function fuzzyfmla(ar){return ar.length!=1}function parseread1(ar){ar.l+=1}function parse_ColRelU(ar,or){var lr=ar.read_shift(2);return[lr&16383,lr>>14&1,lr>>15&1]}function parse_RgceArea(ar,or,lr){var cr=2;if(lr){if(lr.biff>=2&&lr.biff<=5)return parse_RgceArea_BIFF2(ar);lr.biff==12&&(cr=4)}var ur=ar.read_shift(cr),dr=ar.read_shift(cr),hr=parse_ColRelU(ar),pr=parse_ColRelU(ar);return{s:{r:ur,c:hr[0],cRel:hr[1],rRel:hr[2]},e:{r:dr,c:pr[0],cRel:pr[1],rRel:pr[2]}}}function parse_RgceArea_BIFF2(ar){var or=parse_ColRelU(ar),lr=parse_ColRelU(ar),cr=ar.read_shift(1),ur=ar.read_shift(1);return{s:{r:or[0],c:cr,cRel:or[1],rRel:or[2]},e:{r:lr[0],c:ur,cRel:lr[1],rRel:lr[2]}}}function parse_RgceAreaRel(ar,or,lr){if(lr.biff<8)return parse_RgceArea_BIFF2(ar);var cr=ar.read_shift(lr.biff==12?4:2),ur=ar.read_shift(lr.biff==12?4:2),dr=parse_ColRelU(ar),hr=parse_ColRelU(ar);return{s:{r:cr,c:dr[0],cRel:dr[1],rRel:dr[2]},e:{r:ur,c:hr[0],cRel:hr[1],rRel:hr[2]}}}function parse_RgceLoc(ar,or,lr){if(lr&&lr.biff>=2&&lr.biff<=5)return parse_RgceLoc_BIFF2(ar);var cr=ar.read_shift(lr&&lr.biff==12?4:2),ur=parse_ColRelU(ar);return{r:cr,c:ur[0],cRel:ur[1],rRel:ur[2]}}function parse_RgceLoc_BIFF2(ar){var or=parse_ColRelU(ar),lr=ar.read_shift(1);return{r:or[0],c:lr,cRel:or[1],rRel:or[2]}}function parse_RgceElfLoc(ar){var or=ar.read_shift(2),lr=ar.read_shift(2);return{r:or,c:lr&255,fQuoted:!!(lr&16384),cRel:lr>>15,rRel:lr>>15}}function parse_RgceLocRel(ar,or,lr){var cr=lr&&lr.biff?lr.biff:8;if(cr>=2&&cr<=5)return parse_RgceLocRel_BIFF2(ar);var ur=ar.read_shift(cr>=12?4:2),dr=ar.read_shift(2),hr=(dr&16384)>>14,pr=(dr&32768)>>15;if(dr&=16383,pr==1)for(;ur>524287;)ur-=1048576;if(hr==1)for(;dr>8191;)dr=dr-16384;return{r:ur,c:dr,cRel:hr,rRel:pr}}function parse_RgceLocRel_BIFF2(ar){var or=ar.read_shift(2),lr=ar.read_shift(1),cr=(or&32768)>>15,ur=(or&16384)>>14;return or&=16383,cr==1&&or>=8192&&(or=or-16384),ur==1&&lr>=128&&(lr=lr-256),{r:or,c:lr,cRel:ur,rRel:cr}}function parse_PtgArea(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=parse_RgceArea(ar,lr.biff>=2&&lr.biff<=5?6:8,lr);return[cr,ur]}function parse_PtgArea3d(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=ar.read_shift(2,"i"),dr=8;if(lr)switch(lr.biff){case 5:ar.l+=12,dr=6;break;case 12:dr=12;break}var hr=parse_RgceArea(ar,dr,lr);return[cr,ur,hr]}function parse_PtgAreaErr(ar,or,lr){var cr=(ar[ar.l++]&96)>>5;return ar.l+=lr&&lr.biff>8?12:lr.biff<8?6:8,[cr]}function parse_PtgAreaErr3d(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=ar.read_shift(2),dr=8;if(lr)switch(lr.biff){case 5:ar.l+=12,dr=6;break;case 12:dr=12;break}return ar.l+=dr,[cr,ur]}function parse_PtgAreaN(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=parse_RgceAreaRel(ar,or-1,lr);return[cr,ur]}function parse_PtgArray(ar,or,lr){var cr=(ar[ar.l++]&96)>>5;return ar.l+=lr.biff==2?6:lr.biff==12?14:7,[cr]}function parse_PtgAttrBaxcel(ar){var or=ar[ar.l+1]&1,lr=1;return ar.l+=4,[or,lr]}function parse_PtgAttrChoose(ar,or,lr){ar.l+=2;for(var cr=ar.read_shift(lr&&lr.biff==2?1:2),ur=[],dr=0;dr<=cr;++dr)ur.push(ar.read_shift(lr&&lr.biff==2?1:2));return ur}function parse_PtgAttrGoto(ar,or,lr){var cr=ar[ar.l+1]&255?1:0;return ar.l+=2,[cr,ar.read_shift(lr&&lr.biff==2?1:2)]}function parse_PtgAttrIf(ar,or,lr){var cr=ar[ar.l+1]&255?1:0;return ar.l+=2,[cr,ar.read_shift(lr&&lr.biff==2?1:2)]}function parse_PtgAttrIfError(ar){var or=ar[ar.l+1]&255?1:0;return ar.l+=2,[or,ar.read_shift(2)]}function parse_PtgAttrSemi(ar,or,lr){var cr=ar[ar.l+1]&255?1:0;return ar.l+=lr&&lr.biff==2?3:4,[cr]}function parse_PtgAttrSpaceType(ar){var or=ar.read_shift(1),lr=ar.read_shift(1);return[or,lr]}function parse_PtgAttrSpace(ar){return ar.read_shift(2),parse_PtgAttrSpaceType(ar)}function parse_PtgAttrSpaceSemi(ar){return ar.read_shift(2),parse_PtgAttrSpaceType(ar)}function parse_PtgRef(ar,or,lr){var cr=(ar[ar.l]&96)>>5;ar.l+=1;var ur=parse_RgceLoc(ar,0,lr);return[cr,ur]}function parse_PtgRefN(ar,or,lr){var cr=(ar[ar.l]&96)>>5;ar.l+=1;var ur=parse_RgceLocRel(ar,0,lr);return[cr,ur]}function parse_PtgRef3d(ar,or,lr){var cr=(ar[ar.l]&96)>>5;ar.l+=1;var ur=ar.read_shift(2);lr&&lr.biff==5&&(ar.l+=12);var dr=parse_RgceLoc(ar,0,lr);return[cr,ur,dr]}function parse_PtgFunc(ar,or,lr){var cr=(ar[ar.l]&96)>>5;ar.l+=1;var ur=ar.read_shift(lr&&lr.biff<=3?1:2);return[FtabArgc[ur],Ftab[ur],cr]}function parse_PtgFuncVar(ar,or,lr){var cr=ar[ar.l++],ur=ar.read_shift(1),dr=lr&&lr.biff<=3?[cr==88?-1:0,ar.read_shift(1)]:parsetab(ar);return[ur,(dr[0]===0?Ftab:Cetab)[dr[1]]]}function parsetab(ar){return[ar[ar.l+1]>>7,ar.read_shift(2)&32767]}function parse_PtgAttrSum(ar,or,lr){ar.l+=lr&&lr.biff==2?3:4}function parse_PtgExp(ar,or,lr){if(ar.l++,lr&&lr.biff==12)return[ar.read_shift(4,"i"),0];var cr=ar.read_shift(2),ur=ar.read_shift(lr&&lr.biff==2?1:2);return[cr,ur]}function parse_PtgErr(ar){return ar.l++,BErr[ar.read_shift(1)]}function parse_PtgInt(ar){return ar.l++,ar.read_shift(2)}function parse_PtgBool(ar){return ar.l++,ar.read_shift(1)!==0}function parse_PtgNum(ar){return ar.l++,parse_Xnum(ar)}function parse_PtgStr(ar,or,lr){return ar.l++,parse_ShortXLUnicodeString(ar,or-1,lr)}function parse_SerAr(ar,or){var lr=[ar.read_shift(1)];if(or==12)switch(lr[0]){case 2:lr[0]=4;break;case 4:lr[0]=16;break;case 0:lr[0]=1;break;case 1:lr[0]=2;break}switch(lr[0]){case 4:lr[1]=parsebool(ar,1)?"TRUE":"FALSE",or!=12&&(ar.l+=7);break;case 37:case 16:lr[1]=BErr[ar[ar.l]],ar.l+=or==12?4:8;break;case 0:ar.l+=8;break;case 1:lr[1]=parse_Xnum(ar);break;case 2:lr[1]=parse_XLUnicodeString2(ar,0,{biff:or>0&&or<8?2:or});break;default:throw new Error("Bad SerAr: "+lr[0])}return lr}function parse_PtgExtraMem(ar,or,lr){for(var cr=ar.read_shift(lr.biff==12?4:2),ur=[],dr=0;dr!=cr;++dr)ur.push((lr.biff==12?parse_UncheckedRfX:parse_Ref8U)(ar));return ur}function parse_PtgExtraArray(ar,or,lr){var cr=0,ur=0;lr.biff==12?(cr=ar.read_shift(4),ur=ar.read_shift(4)):(ur=1+ar.read_shift(1),cr=1+ar.read_shift(2)),lr.biff>=2&&lr.biff<8&&(--cr,--ur==0&&(ur=256));for(var dr=0,hr=[];dr!=cr&&(hr[dr]=[]);++dr)for(var pr=0;pr!=ur;++pr)hr[dr][pr]=parse_SerAr(ar,lr.biff);return hr}function parse_PtgName(ar,or,lr){var cr=ar.read_shift(1)>>>5&3,ur=!lr||lr.biff>=8?4:2,dr=ar.read_shift(ur);switch(lr.biff){case 2:ar.l+=5;break;case 3:case 4:ar.l+=8;break;case 5:ar.l+=12;break}return[cr,0,dr]}function parse_PtgNameX(ar,or,lr){if(lr.biff==5)return parse_PtgNameX_BIFF5(ar);var cr=ar.read_shift(1)>>>5&3,ur=ar.read_shift(2),dr=ar.read_shift(4);return[cr,ur,dr]}function parse_PtgNameX_BIFF5(ar){var or=ar.read_shift(1)>>>5&3,lr=ar.read_shift(2,"i");ar.l+=8;var cr=ar.read_shift(2);return ar.l+=12,[or,lr,cr]}function parse_PtgMemArea(ar,or,lr){var cr=ar.read_shift(1)>>>5&3;ar.l+=lr&&lr.biff==2?3:4;var ur=ar.read_shift(lr&&lr.biff==2?1:2);return[cr,ur]}function parse_PtgMemFunc(ar,or,lr){var cr=ar.read_shift(1)>>>5&3,ur=ar.read_shift(lr&&lr.biff==2?1:2);return[cr,ur]}function parse_PtgRefErr(ar,or,lr){var cr=ar.read_shift(1)>>>5&3;return ar.l+=4,lr.biff<8&&ar.l--,lr.biff==12&&(ar.l+=2),[cr]}function parse_PtgRefErr3d(ar,or,lr){var cr=(ar[ar.l++]&96)>>5,ur=ar.read_shift(2),dr=4;if(lr)switch(lr.biff){case 5:dr=15;break;case 12:dr=6;break}return ar.l+=dr,[cr,ur]}var parse_PtgMemErr=parsenoop,parse_PtgMemNoMem=parsenoop,parse_PtgTbl=parsenoop;function parse_PtgElfLoc(ar,or,lr){return ar.l+=2,[parse_RgceElfLoc(ar)]}function parse_PtgElfNoop(ar){return ar.l+=6,[]}var parse_PtgElfCol=parse_PtgElfLoc,parse_PtgElfColS=parse_PtgElfNoop,parse_PtgElfColSV=parse_PtgElfNoop,parse_PtgElfColV=parse_PtgElfLoc;function parse_PtgElfLel(ar){return ar.l+=2,[parseuint16(ar),ar.read_shift(2)&1]}var parse_PtgElfRadical=parse_PtgElfLoc,parse_PtgElfRadicalLel=parse_PtgElfLel,parse_PtgElfRadicalS=parse_PtgElfNoop,parse_PtgElfRw=parse_PtgElfLoc,parse_PtgElfRwV=parse_PtgElfLoc,PtgListRT=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function parse_PtgList(ar){ar.l+=2;var or=ar.read_shift(2),lr=ar.read_shift(2),cr=ar.read_shift(4),ur=ar.read_shift(2),dr=ar.read_shift(2),hr=PtgListRT[lr>>2&31];return{ixti:or,coltype:lr&3,rt:hr,idx:cr,c:ur,C:dr}}function parse_PtgSxName(ar){return ar.l+=2,[ar.read_shift(4)]}function parse_PtgSheet(ar,or,lr){return ar.l+=5,ar.l+=2,ar.l+=lr.biff==2?1:4,["PTGSHEET"]}function parse_PtgEndSheet(ar,or,lr){return ar.l+=lr.biff==2?4:5,["PTGENDSHEET"]}function parse_PtgMemAreaN(ar){var or=ar.read_shift(1)>>>5&3,lr=ar.read_shift(2);return[or,lr]}function parse_PtgMemNoMemN(ar){var or=ar.read_shift(1)>>>5&3,lr=ar.read_shift(2);return[or,lr]}function parse_PtgAttrNoop(ar){return ar.l+=4,[0,0]}var PtgTypes={1:{n:"PtgExp",f:parse_PtgExp},2:{n:"PtgTbl",f:parse_PtgTbl},3:{n:"PtgAdd",f:parseread1},4:{n:"PtgSub",f:parseread1},5:{n:"PtgMul",f:parseread1},6:{n:"PtgDiv",f:parseread1},7:{n:"PtgPower",f:parseread1},8:{n:"PtgConcat",f:parseread1},9:{n:"PtgLt",f:parseread1},10:{n:"PtgLe",f:parseread1},11:{n:"PtgEq",f:parseread1},12:{n:"PtgGe",f:parseread1},13:{n:"PtgGt",f:parseread1},14:{n:"PtgNe",f:parseread1},15:{n:"PtgIsect",f:parseread1},16:{n:"PtgUnion",f:parseread1},17:{n:"PtgRange",f:parseread1},18:{n:"PtgUplus",f:parseread1},19:{n:"PtgUminus",f:parseread1},20:{n:"PtgPercent",f:parseread1},21:{n:"PtgParen",f:parseread1},22:{n:"PtgMissArg",f:parseread1},23:{n:"PtgStr",f:parse_PtgStr},26:{n:"PtgSheet",f:parse_PtgSheet},27:{n:"PtgEndSheet",f:parse_PtgEndSheet},28:{n:"PtgErr",f:parse_PtgErr},29:{n:"PtgBool",f:parse_PtgBool},30:{n:"PtgInt",f:parse_PtgInt},31:{n:"PtgNum",f:parse_PtgNum},32:{n:"PtgArray",f:parse_PtgArray},33:{n:"PtgFunc",f:parse_PtgFunc},34:{n:"PtgFuncVar",f:parse_PtgFuncVar},35:{n:"PtgName",f:parse_PtgName},36:{n:"PtgRef",f:parse_PtgRef},37:{n:"PtgArea",f:parse_PtgArea},38:{n:"PtgMemArea",f:parse_PtgMemArea},39:{n:"PtgMemErr",f:parse_PtgMemErr},40:{n:"PtgMemNoMem",f:parse_PtgMemNoMem},41:{n:"PtgMemFunc",f:parse_PtgMemFunc},42:{n:"PtgRefErr",f:parse_PtgRefErr},43:{n:"PtgAreaErr",f:parse_PtgAreaErr},44:{n:"PtgRefN",f:parse_PtgRefN},45:{n:"PtgAreaN",f:parse_PtgAreaN},46:{n:"PtgMemAreaN",f:parse_PtgMemAreaN},47:{n:"PtgMemNoMemN",f:parse_PtgMemNoMemN},57:{n:"PtgNameX",f:parse_PtgNameX},58:{n:"PtgRef3d",f:parse_PtgRef3d},59:{n:"PtgArea3d",f:parse_PtgArea3d},60:{n:"PtgRefErr3d",f:parse_PtgRefErr3d},61:{n:"PtgAreaErr3d",f:parse_PtgAreaErr3d},255:{}},PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Ptg18={1:{n:"PtgElfLel",f:parse_PtgElfLel},2:{n:"PtgElfRw",f:parse_PtgElfRw},3:{n:"PtgElfCol",f:parse_PtgElfCol},6:{n:"PtgElfRwV",f:parse_PtgElfRwV},7:{n:"PtgElfColV",f:parse_PtgElfColV},10:{n:"PtgElfRadical",f:parse_PtgElfRadical},11:{n:"PtgElfRadicalS",f:parse_PtgElfRadicalS},13:{n:"PtgElfColS",f:parse_PtgElfColS},15:{n:"PtgElfColSV",f:parse_PtgElfColSV},16:{n:"PtgElfRadicalLel",f:parse_PtgElfRadicalLel},25:{n:"PtgList",f:parse_PtgList},29:{n:"PtgSxName",f:parse_PtgSxName},255:{}},Ptg19={0:{n:"PtgAttrNoop",f:parse_PtgAttrNoop},1:{n:"PtgAttrSemi",f:parse_PtgAttrSemi},2:{n:"PtgAttrIf",f:parse_PtgAttrIf},4:{n:"PtgAttrChoose",f:parse_PtgAttrChoose},8:{n:"PtgAttrGoto",f:parse_PtgAttrGoto},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},33:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},64:{n:"PtgAttrSpace",f:parse_PtgAttrSpace},65:{n:"PtgAttrSpaceSemi",f:parse_PtgAttrSpaceSemi},128:{n:"PtgAttrIfError",f:parse_PtgAttrIfError},255:{}};function parse_RgbExtra(ar,or,lr,cr){if(cr.biff<8)return parsenoop(ar,or);for(var ur=ar.l+or,dr=[],hr=0;hr!==lr.length;++hr)switch(lr[hr][0]){case"PtgArray":lr[hr][1]=parse_PtgExtraArray(ar,0,cr),dr.push(lr[hr][1]);break;case"PtgMemArea":lr[hr][2]=parse_PtgExtraMem(ar,lr[hr][1],cr),dr.push(lr[hr][2]);break;case"PtgExp":cr&&cr.biff==12&&(lr[hr][1][1]=ar.read_shift(4),dr.push(lr[hr][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+lr[hr][0]}return or=ur-ar.l,or!==0&&dr.push(parsenoop(ar,or)),dr}function parse_Rgce(ar,or,lr){for(var cr=ar.l+or,ur,dr,hr=[];cr!=ar.l;)or=cr-ar.l,dr=ar[ar.l],ur=PtgTypes[dr]||PtgTypes[PtgDupes[dr]],(dr===24||dr===25)&&(ur=(dr===24?Ptg18:Ptg19)[ar[ar.l+1]]),!ur||!ur.f?parsenoop(ar,or):hr.push([ur.n,ur.f(ar,or,lr)]);return hr}function stringify_array(ar){for(var or=[],lr=0;lr<ar.length;++lr){for(var cr=ar[lr],ur=[],dr=0;dr<cr.length;++dr){var hr=cr[dr];if(hr)switch(hr[0]){case 2:ur.push('"'+hr[1].replace(/"/g,'""')+'"');break;default:ur.push(hr[1])}else ur.push("")}or.push(ur.join(","))}return or.join(";")}var PtgBinOp={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function formula_quote_sheet_name(ar,or){if(!ar&&!(or&&or.biff<=5&&or.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(ar)?"'"+ar+"'":ar}function get_ixti_raw(ar,or,lr){if(!ar)return"SH33TJSERR0";if(lr.biff>8&&(!ar.XTI||!ar.XTI[or]))return ar.SheetNames[or];if(!ar.XTI)return"SH33TJSERR6";var cr=ar.XTI[or];if(lr.biff<8)return or>1e4&&(or-=65536),or<0&&(or=-or),or==0?"":ar.XTI[or-1];if(!cr)return"SH33TJSERR1";var ur="";if(lr.biff>8)switch(ar[cr[0]][0]){case 357:return ur=cr[1]==-1?"#REF":ar.SheetNames[cr[1]],cr[1]==cr[2]?ur:ur+":"+ar.SheetNames[cr[2]];case 358:return lr.SID!=null?ar.SheetNames[lr.SID]:"SH33TJSSAME"+ar[cr[0]][0];case 355:default:return"SH33TJSSRC"+ar[cr[0]][0]}switch(ar[cr[0]][0][0]){case 1025:return ur=cr[1]==-1?"#REF":ar.SheetNames[cr[1]]||"SH33TJSERR3",cr[1]==cr[2]?ur:ur+":"+ar.SheetNames[cr[2]];case 14849:return ar[cr[0]].slice(1).map(function(dr){return dr.Name}).join(";;");default:return ar[cr[0]][0][3]?(ur=cr[1]==-1?"#REF":ar[cr[0]][0][3][cr[1]]||"SH33TJSERR4",cr[1]==cr[2]?ur:ur+":"+ar[cr[0]][0][3][cr[2]]):"SH33TJSERR2"}}function get_ixti(ar,or,lr){var cr=get_ixti_raw(ar,or,lr);return cr=="#REF"?cr:formula_quote_sheet_name(cr,lr)}function stringify_formula(ar,or,lr,cr,ur){var dr=ur&&ur.biff||8,hr={s:{c:0,r:0}},pr=[],mr,fr,xr,Er=0,vr=0,gr,yr="";if(!ar[0]||!ar[0][0])return"";for(var br=-1,_r="",jr=0,wr=ar[0].length;jr<wr;++jr){var Sr=ar[0][jr];switch(Sr[0]){case"PtgUminus":pr.push("-"+pr.pop());break;case"PtgUplus":pr.push("+"+pr.pop());break;case"PtgPercent":pr.push(pr.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(mr=pr.pop(),fr=pr.pop(),br>=0){switch(ar[0][br][1][0]){case 0:_r=fill(" ",ar[0][br][1][1]);break;case 1:_r=fill("\r",ar[0][br][1][1]);break;default:if(_r="",ur.WTF)throw new Error("Unexpected PtgAttrSpaceType "+ar[0][br][1][0])}fr=fr+_r,br=-1}pr.push(fr+PtgBinOp[Sr[0]]+mr);break;case"PtgIsect":mr=pr.pop(),fr=pr.pop(),pr.push(fr+" "+mr);break;case"PtgUnion":mr=pr.pop(),fr=pr.pop(),pr.push(fr+","+mr);break;case"PtgRange":mr=pr.pop(),fr=pr.pop(),pr.push(fr+":"+mr);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":xr=shift_cell_xls(Sr[1][1],hr,ur),pr.push(encode_cell_xls(xr,dr));break;case"PtgRefN":xr=lr?shift_cell_xls(Sr[1][1],lr,ur):Sr[1][1],pr.push(encode_cell_xls(xr,dr));break;case"PtgRef3d":Er=Sr[1][1],xr=shift_cell_xls(Sr[1][2],hr,ur),yr=get_ixti(cr,Er,ur),pr.push(yr+"!"+encode_cell_xls(xr,dr));break;case"PtgFunc":case"PtgFuncVar":var Tr=Sr[1][0],Rr=Sr[1][1];Tr||(Tr=0),Tr&=127;var Nr=Tr==0?[]:pr.slice(-Tr);pr.length-=Tr,Rr==="User"&&(Rr=Nr.shift()),pr.push(Rr+"("+Nr.join(",")+")");break;case"PtgBool":pr.push(Sr[1]?"TRUE":"FALSE");break;case"PtgInt":pr.push(Sr[1]);break;case"PtgNum":pr.push(String(Sr[1]));break;case"PtgStr":pr.push('"'+Sr[1].replace(/"/g,'""')+'"');break;case"PtgErr":pr.push(Sr[1]);break;case"PtgAreaN":gr=shift_range_xls(Sr[1][1],lr?{s:lr}:hr,ur),pr.push(encode_range_xls(gr,ur));break;case"PtgArea":gr=shift_range_xls(Sr[1][1],hr,ur),pr.push(encode_range_xls(gr,ur));break;case"PtgArea3d":Er=Sr[1][1],gr=Sr[1][2],yr=get_ixti(cr,Er,ur),pr.push(yr+"!"+encode_range_xls(gr,ur));break;case"PtgAttrSum":pr.push("SUM("+pr.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":vr=Sr[1][2];var Cr=(cr.names||[])[vr-1]||(cr[0]||[])[vr],kr=Cr?Cr.Name:"SH33TJSNAME"+String(vr);kr&&kr.slice(0,6)=="_xlfn."&&!ur.xlfn&&(kr=kr.slice(6)),pr.push(kr);break;case"PtgNameX":var Ar=Sr[1][1];vr=Sr[1][2];var Or;if(ur.biff<=5)Ar<0&&(Ar=-Ar),cr[Ar]&&(Or=cr[Ar][vr]);else{var Lr="";if(((cr[Ar]||[])[0]||[])[0]==14849||(((cr[Ar]||[])[0]||[])[0]==1025?cr[Ar][vr]&&cr[Ar][vr].itab>0&&(Lr=cr.SheetNames[cr[Ar][vr].itab-1]+"!"):Lr=cr.SheetNames[vr-1]+"!"),cr[Ar]&&cr[Ar][vr])Lr+=cr[Ar][vr].Name;else if(cr[0]&&cr[0][vr])Lr+=cr[0][vr].Name;else{var Fr=(get_ixti_raw(cr,Ar,ur)||"").split(";;");Fr[vr-1]?Lr=Fr[vr-1]:Lr+="SH33TJSERRX"}pr.push(Lr);break}Or||(Or={Name:"SH33TJSERRY"}),pr.push(Or.Name);break;case"PtgParen":var Hr="(",Kr=")";if(br>=0){switch(_r="",ar[0][br][1][0]){case 2:Hr=fill(" ",ar[0][br][1][1])+Hr;break;case 3:Hr=fill("\r",ar[0][br][1][1])+Hr;break;case 4:Kr=fill(" ",ar[0][br][1][1])+Kr;break;case 5:Kr=fill("\r",ar[0][br][1][1])+Kr;break;default:if(ur.WTF)throw new Error("Unexpected PtgAttrSpaceType "+ar[0][br][1][0])}br=-1}pr.push(Hr+pr.pop()+Kr);break;case"PtgRefErr":pr.push("#REF!");break;case"PtgRefErr3d":pr.push("#REF!");break;case"PtgExp":xr={c:Sr[1][1],r:Sr[1][0]};var Gr={c:lr.c,r:lr.r};if(cr.sharedf[encode_cell(xr)]){var Zr=cr.sharedf[encode_cell(xr)];pr.push(stringify_formula(Zr,hr,Gr,cr,ur))}else{var Jr=!1;for(mr=0;mr!=cr.arrayf.length;++mr)if(fr=cr.arrayf[mr],!(xr.c<fr[0].s.c||xr.c>fr[0].e.c)&&!(xr.r<fr[0].s.r||xr.r>fr[0].e.r)){pr.push(stringify_formula(fr[1],hr,Gr,cr,ur)),Jr=!0;break}Jr||pr.push(Sr[1])}break;case"PtgArray":pr.push("{"+stringify_array(Sr[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":br=jr;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":pr.push("");break;case"PtgAreaErr":pr.push("#REF!");break;case"PtgAreaErr3d":pr.push("#REF!");break;case"PtgList":pr.push("Table"+Sr[1].idx+"[#"+Sr[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(Sr));default:throw new Error("Unrecognized Formula Token: "+String(Sr))}var os=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(ur.biff!=3&&br>=0&&os.indexOf(ar[0][jr][0])==-1){Sr=ar[0][br];var Ur=!0;switch(Sr[1][0]){case 4:Ur=!1;case 0:_r=fill(" ",Sr[1][1]);break;case 5:Ur=!1;case 1:_r=fill("\r",Sr[1][1]);break;default:if(_r="",ur.WTF)throw new Error("Unexpected PtgAttrSpaceType "+Sr[1][0])}pr.push((Ur?_r:"")+pr.pop()+(Ur?"":_r)),br=-1}}if(pr.length>1&&ur.WTF)throw new Error("bad formula stack");return pr[0]}function write_FormulaValue(ar){if(ar==null){var or=new_buf(8);return or.write_shift(1,3),or.write_shift(1,0),or.write_shift(2,0),or.write_shift(2,0),or.write_shift(2,65535),or}else if(typeof ar=="number")return write_Xnum(ar);return write_Xnum(0)}function write_Formula(ar,or,lr,cr,ur){var dr=write_XLSCell(or,lr,ur),hr=write_FormulaValue(ar.v),pr=new_buf(6),mr=33;pr.write_shift(2,mr),pr.write_shift(4,0);for(var fr=new_buf(ar.bf.length),xr=0;xr<ar.bf.length;++xr)fr[xr]=ar.bf[xr];var Er=bconcat([dr,hr,pr,fr]);return Er}function parse_XLSBParsedFormula(ar,or,lr){var cr=ar.read_shift(4),ur=parse_Rgce(ar,cr,lr),dr=ar.read_shift(4),hr=dr>0?parse_RgbExtra(ar,dr,ur,lr):null;return[ur,hr]}var parse_XLSBArrayParsedFormula=parse_XLSBParsedFormula,parse_XLSBCellParsedFormula=parse_XLSBParsedFormula,parse_XLSBNameParsedFormula=parse_XLSBParsedFormula,parse_XLSBSharedParsedFormula=parse_XLSBParsedFormula,Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},FtabArgc={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function csf_to_ods_formula(ar){var or="of:="+ar.replace(crefregex,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return or.replace(/;/g,"|").replace(/,/g,";")}function csf_to_ods_3D(ar){return ar.replace(/\./,"!")}var browser_has_Map=typeof Map<"u";function get_sst_id(ar,or,lr){var cr=0,ur=ar.length;if(lr){if(browser_has_Map?lr.has(or):Object.prototype.hasOwnProperty.call(lr,or)){for(var dr=browser_has_Map?lr.get(or):lr[or];cr<dr.length;++cr)if(ar[dr[cr]].t===or)return ar.Count++,dr[cr]}}else for(;cr<ur;++cr)if(ar[cr].t===or)return ar.Count++,cr;return ar[ur]={t:or},ar.Count++,ar.Unique++,lr&&(browser_has_Map?(lr.has(or)||lr.set(or,[]),lr.get(or).push(ur)):(Object.prototype.hasOwnProperty.call(lr,or)||(lr[or]=[]),lr[or].push(ur))),ur}function col_obj_w(ar,or){var lr={min:ar+1,max:ar+1},cr=-1;return or.MDW&&(MDW=or.MDW),or.width!=null?lr.customWidth=1:or.wpx!=null?cr=px2char(or.wpx):or.wch!=null&&(cr=or.wch),cr>-1?(lr.width=char2width(cr),lr.customWidth=1):or.width!=null&&(lr.width=or.width),or.hidden&&(lr.hidden=!0),or.level!=null&&(lr.outlineLevel=lr.level=or.level),lr}function default_margins(ar,or){if(ar){var lr=[.7,.7,.75,.75,.3,.3];ar.left==null&&(ar.left=lr[0]),ar.right==null&&(ar.right=lr[1]),ar.top==null&&(ar.top=lr[2]),ar.bottom==null&&(ar.bottom=lr[3]),ar.header==null&&(ar.header=lr[4]),ar.footer==null&&(ar.footer=lr[5])}}function get_cell_style(ar,or,lr){var cr=lr.revssf[or.z!=null?or.z:"General"],ur=60,dr=ar.length;if(cr==null&&lr.ssf){for(;ur<392;++ur)if(lr.ssf[ur]==null){SSF_load(or.z,ur),lr.ssf[ur]=or.z,lr.revssf[or.z]=cr=ur;break}}for(ur=0;ur!=dr;++ur)if(ar[ur].numFmtId===cr)return ur;return ar[dr]={numFmtId:cr,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},dr}function check_ws(ar,or,lr){if(ar&&ar["!ref"]){var cr=safe_decode_range(ar["!ref"]);if(cr.e.c<cr.s.c||cr.e.r<cr.s.r)throw new Error("Bad range ("+lr+"): "+ar["!ref"])}}function write_ws_xml_merges(ar){if(ar.length===0)return"";for(var or='<mergeCells count="'+ar.length+'">',lr=0;lr!=ar.length;++lr)or+='<mergeCell ref="'+encode_range(ar[lr])+'"/>';return or+"</mergeCells>"}function write_ws_xml_sheetpr(ar,or,lr,cr,ur){var dr=!1,hr={},pr=null;if(cr.bookType!=="xlsx"&&or.vbaraw){var mr=or.SheetNames[lr];try{or.Workbook&&(mr=or.Workbook.Sheets[lr].CodeName||mr)}catch{}dr=!0,hr.codeName=utf8write(escapexml(mr))}if(ar&&ar["!outline"]){var fr={summaryBelow:1,summaryRight:1};ar["!outline"].above&&(fr.summaryBelow=0),ar["!outline"].left&&(fr.summaryRight=0),pr=(pr||"")+writextag("outlinePr",null,fr)}!dr&&!pr||(ur[ur.length]=writextag("sheetPr",pr,hr))}var sheetprot_deffalse=["objects","scenarios","selectLockedCells","selectUnlockedCells"],sheetprot_deftrue=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function write_ws_xml_protection(ar){var or={sheet:1};return sheetprot_deffalse.forEach(function(lr){ar[lr]!=null&&ar[lr]&&(or[lr]="1")}),sheetprot_deftrue.forEach(function(lr){ar[lr]!=null&&!ar[lr]&&(or[lr]="0")}),ar.password&&(or.password=crypto_CreatePasswordVerifier_Method1(ar.password).toString(16).toUpperCase()),writextag("sheetProtection",null,or)}function write_ws_xml_margins(ar){return default_margins(ar),writextag("pageMargins",null,ar)}function write_ws_xml_cols(ar,or){for(var lr=["<cols>"],cr,ur=0;ur!=or.length;++ur)(cr=or[ur])&&(lr[lr.length]=writextag("col",null,col_obj_w(ur,cr)));return lr[lr.length]="</cols>",lr.join("")}function write_ws_xml_autofilter(ar,or,lr,cr){var ur=typeof ar.ref=="string"?ar.ref:encode_range(ar.ref);lr.Workbook||(lr.Workbook={Sheets:[]}),lr.Workbook.Names||(lr.Workbook.Names=[]);var dr=lr.Workbook.Names,hr=decode_range(ur);hr.s.r==hr.e.r&&(hr.e.r=decode_range(or["!ref"]).e.r,ur=encode_range(hr));for(var pr=0;pr<dr.length;++pr){var mr=dr[pr];if(mr.Name=="_xlnm._FilterDatabase"&&mr.Sheet==cr){mr.Ref="'"+lr.SheetNames[cr]+"'!"+ur;break}}return pr==dr.length&&dr.push({Name:"_xlnm._FilterDatabase",Sheet:cr,Ref:"'"+lr.SheetNames[cr]+"'!"+ur}),writextag("autoFilter",null,{ref:ur})}function write_ws_xml_sheetviews(ar,or,lr,cr){var ur={workbookViewId:"0"};return(((cr||{}).Workbook||{}).Views||[])[0]&&(ur.rightToLeft=cr.Workbook.Views[0].RTL?"1":"0"),writextag("sheetViews",writextag("sheetView",null,ur),{})}function write_ws_xml_cell(ar,or,lr,cr){if(ar.c&&lr["!comments"].push([or,ar.c]),ar.v===void 0&&typeof ar.f!="string"||ar.t==="z"&&!ar.f)return"";var ur="",dr=ar.t,hr=ar.v;if(ar.t!=="z")switch(ar.t){case"b":ur=ar.v?"1":"0";break;case"n":ur=""+ar.v;break;case"e":ur=BErr[ar.v];break;case"d":cr&&cr.cellDates?ur=parseDate(ar.v,-1).toISOString():(ar=dup(ar),ar.t="n",ur=""+(ar.v=datenum(parseDate(ar.v)))),typeof ar.z>"u"&&(ar.z=table_fmt[14]);break;default:ur=ar.v;break}var pr=writetag("v",escapexml(ur)),mr={r:or},fr=get_cell_style(cr.cellXfs,ar,cr);switch(fr!==0&&(mr.s=fr),ar.t){case"n":break;case"d":mr.t="d";break;case"b":mr.t="b";break;case"e":mr.t="e";break;case"z":break;default:if(ar.v==null){delete ar.t;break}if(ar.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(cr&&cr.bookSST){pr=writetag("v",""+get_sst_id(cr.Strings,ar.v,cr.revStrings)),mr.t="s";break}mr.t="str";break}if(ar.t!=dr&&(ar.t=dr,ar.v=hr),typeof ar.f=="string"&&ar.f){var xr=ar.F&&ar.F.slice(0,or.length)==or?{t:"array",ref:ar.F}:null;pr=writextag("f",escapexml(ar.f),xr)+(ar.v!=null?pr:"")}return ar.l&&lr["!links"].push([or,ar.l]),ar.D&&(mr.cm=1),writextag("c",pr,mr)}function write_ws_xml_data(ar,or,lr,cr){var ur=[],dr=[],hr=safe_decode_range(ar["!ref"]),pr="",mr,fr="",xr=[],Er=0,vr=0,gr=ar["!rows"],yr=Array.isArray(ar),br={r:fr},_r,jr=-1;for(vr=hr.s.c;vr<=hr.e.c;++vr)xr[vr]=encode_col(vr);for(Er=hr.s.r;Er<=hr.e.r;++Er){for(dr=[],fr=encode_row(Er),vr=hr.s.c;vr<=hr.e.c;++vr){mr=xr[vr]+fr;var wr=yr?(ar[Er]||[])[vr]:ar[mr];wr!==void 0&&(pr=write_ws_xml_cell(wr,mr,ar,or))!=null&&dr.push(pr)}(dr.length>0||gr&&gr[Er])&&(br={r:fr},gr&&gr[Er]&&(_r=gr[Er],_r.hidden&&(br.hidden=1),jr=-1,_r.hpx?jr=px2pt(_r.hpx):_r.hpt&&(jr=_r.hpt),jr>-1&&(br.ht=jr,br.customHeight=1),_r.level&&(br.outlineLevel=_r.level)),ur[ur.length]=writextag("row",dr.join(""),br))}if(gr)for(;Er<gr.length;++Er)gr&&gr[Er]&&(br={r:Er+1},_r=gr[Er],_r.hidden&&(br.hidden=1),jr=-1,_r.hpx?jr=px2pt(_r.hpx):_r.hpt&&(jr=_r.hpt),jr>-1&&(br.ht=jr,br.customHeight=1),_r.level&&(br.outlineLevel=_r.level),ur[ur.length]=writextag("row","",br));return ur.join("")}function write_ws_xml(ar,or,lr,cr){var ur=[XML_HEADER,writextag("worksheet",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r})],dr=lr.SheetNames[ar],hr=0,pr="",mr=lr.Sheets[dr];mr==null&&(mr={});var fr=mr["!ref"]||"A1",xr=safe_decode_range(fr);if(xr.e.c>16383||xr.e.r>1048575){if(or.WTF)throw new Error("Range "+fr+" exceeds format limit A1:XFD1048576");xr.e.c=Math.min(xr.e.c,16383),xr.e.r=Math.min(xr.e.c,1048575),fr=encode_range(xr)}cr||(cr={}),mr["!comments"]=[];var Er=[];write_ws_xml_sheetpr(mr,lr,ar,or,ur),ur[ur.length]=writextag("dimension",null,{ref:fr}),ur[ur.length]=write_ws_xml_sheetviews(mr,or,ar,lr),or.sheetFormat&&(ur[ur.length]=writextag("sheetFormatPr",null,{defaultRowHeight:or.sheetFormat.defaultRowHeight||"16",baseColWidth:or.sheetFormat.baseColWidth||"10",outlineLevelRow:or.sheetFormat.outlineLevelRow||"7"})),mr["!cols"]!=null&&mr["!cols"].length>0&&(ur[ur.length]=write_ws_xml_cols(mr,mr["!cols"])),ur[hr=ur.length]="<sheetData/>",mr["!links"]=[],mr["!ref"]!=null&&(pr=write_ws_xml_data(mr,or),pr.length>0&&(ur[ur.length]=pr)),ur.length>hr+1&&(ur[ur.length]="</sheetData>",ur[hr]=ur[hr].replace("/>",">")),mr["!protect"]&&(ur[ur.length]=write_ws_xml_protection(mr["!protect"])),mr["!autofilter"]!=null&&(ur[ur.length]=write_ws_xml_autofilter(mr["!autofilter"],mr,lr,ar)),mr["!merges"]!=null&&mr["!merges"].length>0&&(ur[ur.length]=write_ws_xml_merges(mr["!merges"]));var vr=-1,gr,yr=-1;return mr["!links"].length>0&&(ur[ur.length]="<hyperlinks>",mr["!links"].forEach(function(br){br[1].Target&&(gr={ref:br[0]},br[1].Target.charAt(0)!="#"&&(yr=add_rels(cr,-1,escapexml(br[1].Target).replace(/#.*$/,""),RELS.HLINK),gr["r:id"]="rId"+yr),(vr=br[1].Target.indexOf("#"))>-1&&(gr.location=escapexml(br[1].Target.slice(vr+1))),br[1].Tooltip&&(gr.tooltip=escapexml(br[1].Tooltip)),ur[ur.length]=writextag("hyperlink",null,gr))}),ur[ur.length]="</hyperlinks>"),delete mr["!links"],mr["!margins"]!=null&&(ur[ur.length]=write_ws_xml_margins(mr["!margins"])),(!or||or.ignoreEC||or.ignoreEC==null)&&(ur[ur.length]=writetag("ignoredErrors",writextag("ignoredError",null,{numberStoredAsText:1,sqref:fr}))),Er.length>0&&(yr=add_rels(cr,-1,"../drawings/drawing"+(ar+1)+".xml",RELS.DRAW),ur[ur.length]=writextag("drawing",null,{"r:id":"rId"+yr}),mr["!drawing"]=Er),mr["!comments"].length>0&&(yr=add_rels(cr,-1,"../drawings/vmlDrawing"+(ar+1)+".vml",RELS.VML),ur[ur.length]=writextag("legacyDrawing",null,{"r:id":"rId"+yr}),mr["!legacy"]=yr),ur.length>1&&(ur[ur.length]="</worksheet>",ur[1]=ur[1].replace("/>",">")),ur.join("")}function parse_BrtRowHdr(ar,or){var lr={},cr=ar.l+or;lr.r=ar.read_shift(4),ar.l+=4;var ur=ar.read_shift(2);ar.l+=1;var dr=ar.read_shift(1);return ar.l=cr,dr&7&&(lr.level=dr&7),dr&16&&(lr.hidden=!0),dr&32&&(lr.hpt=ur/20),lr}function write_BrtRowHdr(ar,or,lr){var cr=new_buf(145),ur=(lr["!rows"]||[])[ar]||{};cr.write_shift(4,ar),cr.write_shift(4,0);var dr=320;ur.hpx?dr=px2pt(ur.hpx)*20:ur.hpt&&(dr=ur.hpt*20),cr.write_shift(2,dr),cr.write_shift(1,0);var hr=0;ur.level&&(hr|=ur.level),ur.hidden&&(hr|=16),(ur.hpx||ur.hpt)&&(hr|=32),cr.write_shift(1,hr),cr.write_shift(1,0);var pr=0,mr=cr.l;cr.l+=4;for(var fr={r:ar,c:0},xr=0;xr<16;++xr)if(!(or.s.c>xr+1<<10||or.e.c<xr<<10)){for(var Er=-1,vr=-1,gr=xr<<10;gr<xr+1<<10;++gr){fr.c=gr;var yr=Array.isArray(lr)?(lr[fr.r]||[])[fr.c]:lr[encode_cell(fr)];yr&&(Er<0&&(Er=gr),vr=gr)}Er<0||(++pr,cr.write_shift(4,Er),cr.write_shift(4,vr))}var br=cr.l;return cr.l=mr,cr.write_shift(4,pr),cr.l=br,cr.length>cr.l?cr.slice(0,cr.l):cr}function write_row_header(ar,or,lr,cr){var ur=write_BrtRowHdr(cr,lr,or);(ur.length>17||(or["!rows"]||[])[cr])&&write_record(ar,0,ur)}var parse_BrtWsDim=parse_UncheckedRfX,write_BrtWsDim=write_UncheckedRfX;function parse_BrtWsFmtInfo(){}function parse_BrtWsProp(ar,or){var lr={},cr=ar[ar.l];return++ar.l,lr.above=!(cr&64),lr.left=!(cr&128),ar.l+=18,lr.name=parse_XLSBCodeName(ar),lr}function write_BrtWsProp(ar,or,lr){lr==null&&(lr=new_buf(84+4*ar.length));var cr=192;or&&(or.above&&(cr&=-65),or.left&&(cr&=-129)),lr.write_shift(1,cr);for(var ur=1;ur<3;++ur)lr.write_shift(1,0);return write_BrtColor({auto:1},lr),lr.write_shift(-4,-1),lr.write_shift(-4,-1),write_XLSBCodeName(ar,lr),lr.slice(0,lr.l)}function parse_BrtCellBlank(ar){var or=parse_XLSBCell(ar);return[or]}function write_BrtCellBlank(ar,or,lr){return lr==null&&(lr=new_buf(8)),write_XLSBCell(or,lr)}function parse_BrtShortBlank(ar){var or=parse_XLSBShortCell(ar);return[or]}function write_BrtShortBlank(ar,or,lr){return lr==null&&(lr=new_buf(4)),write_XLSBShortCell(or,lr)}function parse_BrtCellBool(ar){var or=parse_XLSBCell(ar),lr=ar.read_shift(1);return[or,lr,"b"]}function write_BrtCellBool(ar,or,lr){return lr==null&&(lr=new_buf(9)),write_XLSBCell(or,lr),lr.write_shift(1,ar.v?1:0),lr}function parse_BrtShortBool(ar){var or=parse_XLSBShortCell(ar),lr=ar.read_shift(1);return[or,lr,"b"]}function write_BrtShortBool(ar,or,lr){return lr==null&&(lr=new_buf(5)),write_XLSBShortCell(or,lr),lr.write_shift(1,ar.v?1:0),lr}function parse_BrtCellError(ar){var or=parse_XLSBCell(ar),lr=ar.read_shift(1);return[or,lr,"e"]}function write_BrtCellError(ar,or,lr){return lr==null&&(lr=new_buf(9)),write_XLSBCell(or,lr),lr.write_shift(1,ar.v),lr}function parse_BrtShortError(ar){var or=parse_XLSBShortCell(ar),lr=ar.read_shift(1);return[or,lr,"e"]}function write_BrtShortError(ar,or,lr){return lr==null&&(lr=new_buf(8)),write_XLSBShortCell(or,lr),lr.write_shift(1,ar.v),lr.write_shift(2,0),lr.write_shift(1,0),lr}function parse_BrtCellIsst(ar){var or=parse_XLSBCell(ar),lr=ar.read_shift(4);return[or,lr,"s"]}function write_BrtCellIsst(ar,or,lr){return lr==null&&(lr=new_buf(12)),write_XLSBCell(or,lr),lr.write_shift(4,or.v),lr}function parse_BrtShortIsst(ar){var or=parse_XLSBShortCell(ar),lr=ar.read_shift(4);return[or,lr,"s"]}function write_BrtShortIsst(ar,or,lr){return lr==null&&(lr=new_buf(8)),write_XLSBShortCell(or,lr),lr.write_shift(4,or.v),lr}function parse_BrtCellReal(ar){var or=parse_XLSBCell(ar),lr=parse_Xnum(ar);return[or,lr,"n"]}function write_BrtCellReal(ar,or,lr){return lr==null&&(lr=new_buf(16)),write_XLSBCell(or,lr),write_Xnum(ar.v,lr),lr}function parse_BrtShortReal(ar){var or=parse_XLSBShortCell(ar),lr=parse_Xnum(ar);return[or,lr,"n"]}function write_BrtShortReal(ar,or,lr){return lr==null&&(lr=new_buf(12)),write_XLSBShortCell(or,lr),write_Xnum(ar.v,lr),lr}function parse_BrtCellRk(ar){var or=parse_XLSBCell(ar),lr=parse_RkNumber(ar);return[or,lr,"n"]}function write_BrtCellRk(ar,or,lr){return lr==null&&(lr=new_buf(12)),write_XLSBCell(or,lr),write_RkNumber(ar.v,lr),lr}function parse_BrtShortRk(ar){var or=parse_XLSBShortCell(ar),lr=parse_RkNumber(ar);return[or,lr,"n"]}function write_BrtShortRk(ar,or,lr){return lr==null&&(lr=new_buf(8)),write_XLSBShortCell(or,lr),write_RkNumber(ar.v,lr),lr}function parse_BrtCellRString(ar){var or=parse_XLSBCell(ar),lr=parse_RichStr(ar);return[or,lr,"is"]}function parse_BrtCellSt(ar){var or=parse_XLSBCell(ar),lr=parse_XLWideString(ar);return[or,lr,"str"]}function write_BrtCellSt(ar,or,lr){return lr==null&&(lr=new_buf(12+4*ar.v.length)),write_XLSBCell(or,lr),write_XLWideString(ar.v,lr),lr.length>lr.l?lr.slice(0,lr.l):lr}function parse_BrtShortSt(ar){var or=parse_XLSBShortCell(ar),lr=parse_XLWideString(ar);return[or,lr,"str"]}function write_BrtShortSt(ar,or,lr){return lr==null&&(lr=new_buf(8+4*ar.v.length)),write_XLSBShortCell(or,lr),write_XLWideString(ar.v,lr),lr.length>lr.l?lr.slice(0,lr.l):lr}function parse_BrtFmlaBool(ar,or,lr){var cr=ar.l+or,ur=parse_XLSBCell(ar);ur.r=lr["!row"];var dr=ar.read_shift(1),hr=[ur,dr,"b"];if(lr.cellFormula){ar.l+=2;var pr=parse_XLSBCellParsedFormula(ar,cr-ar.l,lr);hr[3]=stringify_formula(pr,null,ur,lr.supbooks,lr)}else ar.l=cr;return hr}function parse_BrtFmlaError(ar,or,lr){var cr=ar.l+or,ur=parse_XLSBCell(ar);ur.r=lr["!row"];var dr=ar.read_shift(1),hr=[ur,dr,"e"];if(lr.cellFormula){ar.l+=2;var pr=parse_XLSBCellParsedFormula(ar,cr-ar.l,lr);hr[3]=stringify_formula(pr,null,ur,lr.supbooks,lr)}else ar.l=cr;return hr}function parse_BrtFmlaNum(ar,or,lr){var cr=ar.l+or,ur=parse_XLSBCell(ar);ur.r=lr["!row"];var dr=parse_Xnum(ar),hr=[ur,dr,"n"];if(lr.cellFormula){ar.l+=2;var pr=parse_XLSBCellParsedFormula(ar,cr-ar.l,lr);hr[3]=stringify_formula(pr,null,ur,lr.supbooks,lr)}else ar.l=cr;return hr}function parse_BrtFmlaString(ar,or,lr){var cr=ar.l+or,ur=parse_XLSBCell(ar);ur.r=lr["!row"];var dr=parse_XLWideString(ar),hr=[ur,dr,"str"];if(lr.cellFormula){ar.l+=2;var pr=parse_XLSBCellParsedFormula(ar,cr-ar.l,lr);hr[3]=stringify_formula(pr,null,ur,lr.supbooks,lr)}else ar.l=cr;return hr}var parse_BrtMergeCell=parse_UncheckedRfX,write_BrtMergeCell=write_UncheckedRfX;function write_BrtBeginMergeCells(ar,or){return or==null&&(or=new_buf(4)),or.write_shift(4,ar),or}function parse_BrtHLink(ar,or){var lr=ar.l+or,cr=parse_UncheckedRfX(ar),ur=parse_XLNullableWideString(ar),dr=parse_XLWideString(ar),hr=parse_XLWideString(ar),pr=parse_XLWideString(ar);ar.l=lr;var mr={rfx:cr,relId:ur,loc:dr,display:pr};return hr&&(mr.Tooltip=hr),mr}function write_BrtHLink(ar,or){var lr=new_buf(50+4*(ar[1].Target.length+(ar[1].Tooltip||"").length));write_UncheckedRfX({s:decode_cell(ar[0]),e:decode_cell(ar[0])},lr),write_RelID("rId"+or,lr);var cr=ar[1].Target.indexOf("#"),ur=cr==-1?"":ar[1].Target.slice(cr+1);return write_XLWideString(ur||"",lr),write_XLWideString(ar[1].Tooltip||"",lr),write_XLWideString("",lr),lr.slice(0,lr.l)}function parse_BrtPane(){}function parse_BrtArrFmla(ar,or,lr){var cr=ar.l+or,ur=parse_RfX(ar),dr=ar.read_shift(1),hr=[ur];if(hr[2]=dr,lr.cellFormula){var pr=parse_XLSBArrayParsedFormula(ar,cr-ar.l,lr);hr[1]=pr}else ar.l=cr;return hr}function parse_BrtShrFmla(ar,or,lr){var cr=ar.l+or,ur=parse_UncheckedRfX(ar),dr=[ur];if(lr.cellFormula){var hr=parse_XLSBSharedParsedFormula(ar,cr-ar.l,lr);dr[1]=hr,ar.l=cr}else ar.l=cr;return dr}function write_BrtColInfo(ar,or,lr){lr==null&&(lr=new_buf(18));var cr=col_obj_w(ar,or);lr.write_shift(-4,ar),lr.write_shift(-4,ar),lr.write_shift(4,(cr.width||10)*256),lr.write_shift(4,0);var ur=0;return or.hidden&&(ur|=1),typeof cr.width=="number"&&(ur|=2),or.level&&(ur|=or.level<<8),lr.write_shift(2,ur),lr}var BrtMarginKeys=["left","right","top","bottom","header","footer"];function parse_BrtMargins(ar){var or={};return BrtMarginKeys.forEach(function(lr){or[lr]=parse_Xnum(ar)}),or}function write_BrtMargins(ar,or){return or==null&&(or=new_buf(6*8)),default_margins(ar),BrtMarginKeys.forEach(function(lr){write_Xnum(ar[lr],or)}),or}function parse_BrtBeginWsView(ar){var or=ar.read_shift(2);return ar.l+=28,{RTL:or&32}}function write_BrtBeginWsView(ar,or,lr){lr==null&&(lr=new_buf(30));var cr=924;return(((or||{}).Views||[])[0]||{}).RTL&&(cr|=32),lr.write_shift(2,cr),lr.write_shift(4,0),lr.write_shift(4,0),lr.write_shift(4,0),lr.write_shift(1,0),lr.write_shift(1,0),lr.write_shift(2,0),lr.write_shift(2,100),lr.write_shift(2,0),lr.write_shift(2,0),lr.write_shift(2,0),lr.write_shift(4,0),lr}function write_BrtCellIgnoreEC(ar){var or=new_buf(24);return or.write_shift(4,4),or.write_shift(4,1),write_UncheckedRfX(ar,or),or}function write_BrtSheetProtection(ar,or){return or==null&&(or=new_buf(16*4+2)),or.write_shift(2,ar.password?crypto_CreatePasswordVerifier_Method1(ar.password):0),or.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(lr){lr[1]?or.write_shift(4,ar[lr[0]]!=null&&!ar[lr[0]]?1:0):or.write_shift(4,ar[lr[0]]!=null&&ar[lr[0]]?0:1)}),or}function parse_BrtDVal(){}function parse_BrtDVal14(){}function write_ws_bin_cell(ar,or,lr,cr,ur,dr,hr){if(or.v===void 0)return!1;var pr="";switch(or.t){case"b":pr=or.v?"1":"0";break;case"d":or=dup(or),or.z=or.z||table_fmt[14],or.v=datenum(parseDate(or.v)),or.t="n";break;case"n":case"e":pr=""+or.v;break;default:pr=or.v;break}var mr={r:lr,c:cr};switch(mr.s=get_cell_style(ur.cellXfs,or,ur),or.l&&dr["!links"].push([encode_cell(mr),or.l]),or.c&&dr["!comments"].push([encode_cell(mr),or.c]),or.t){case"s":case"str":return ur.bookSST?(pr=get_sst_id(ur.Strings,or.v,ur.revStrings),mr.t="s",mr.v=pr,hr?write_record(ar,18,write_BrtShortIsst(or,mr)):write_record(ar,7,write_BrtCellIsst(or,mr))):(mr.t="str",hr?write_record(ar,17,write_BrtShortSt(or,mr)):write_record(ar,6,write_BrtCellSt(or,mr))),!0;case"n":return or.v==(or.v|0)&&or.v>-1e3&&or.v<1e3?hr?write_record(ar,13,write_BrtShortRk(or,mr)):write_record(ar,2,write_BrtCellRk(or,mr)):hr?write_record(ar,16,write_BrtShortReal(or,mr)):write_record(ar,5,write_BrtCellReal(or,mr)),!0;case"b":return mr.t="b",hr?write_record(ar,15,write_BrtShortBool(or,mr)):write_record(ar,4,write_BrtCellBool(or,mr)),!0;case"e":return mr.t="e",hr?write_record(ar,14,write_BrtShortError(or,mr)):write_record(ar,3,write_BrtCellError(or,mr)),!0}return hr?write_record(ar,12,write_BrtShortBlank(or,mr)):write_record(ar,1,write_BrtCellBlank(or,mr)),!0}function write_CELLTABLE(ar,or,lr,cr){var ur=safe_decode_range(or["!ref"]||"A1"),dr,hr="",pr=[];write_record(ar,145);var mr=Array.isArray(or),fr=ur.e.r;or["!rows"]&&(fr=Math.max(ur.e.r,or["!rows"].length-1));for(var xr=ur.s.r;xr<=fr;++xr){hr=encode_row(xr),write_row_header(ar,or,ur,xr);var Er=!1;if(xr<=ur.e.r)for(var vr=ur.s.c;vr<=ur.e.c;++vr){xr===ur.s.r&&(pr[vr]=encode_col(vr)),dr=pr[vr]+hr;var gr=mr?(or[xr]||[])[vr]:or[dr];if(!gr){Er=!1;continue}Er=write_ws_bin_cell(ar,gr,xr,vr,cr,or,Er)}}write_record(ar,146)}function write_MERGECELLS(ar,or){!or||!or["!merges"]||(write_record(ar,177,write_BrtBeginMergeCells(or["!merges"].length)),or["!merges"].forEach(function(lr){write_record(ar,176,write_BrtMergeCell(lr))}),write_record(ar,178))}function write_COLINFOS(ar,or){!or||!or["!cols"]||(write_record(ar,390),or["!cols"].forEach(function(lr,cr){lr&&write_record(ar,60,write_BrtColInfo(cr,lr))}),write_record(ar,391))}function write_IGNOREECS(ar,or){!or||!or["!ref"]||(write_record(ar,648),write_record(ar,649,write_BrtCellIgnoreEC(safe_decode_range(or["!ref"]))),write_record(ar,650))}function write_HLINKS(ar,or,lr){or["!links"].forEach(function(cr){if(cr[1].Target){var ur=add_rels(lr,-1,cr[1].Target.replace(/#.*$/,""),RELS.HLINK);write_record(ar,494,write_BrtHLink(cr,ur))}}),delete or["!links"]}function write_LEGACYDRAWING(ar,or,lr,cr){if(or["!comments"].length>0){var ur=add_rels(cr,-1,"../drawings/vmlDrawing"+(lr+1)+".vml",RELS.VML);write_record(ar,551,write_RelID("rId"+ur)),or["!legacy"]=ur}}function write_AUTOFILTER(ar,or,lr,cr){if(or["!autofilter"]){var ur=or["!autofilter"],dr=typeof ur.ref=="string"?ur.ref:encode_range(ur.ref);lr.Workbook||(lr.Workbook={Sheets:[]}),lr.Workbook.Names||(lr.Workbook.Names=[]);var hr=lr.Workbook.Names,pr=decode_range(dr);pr.s.r==pr.e.r&&(pr.e.r=decode_range(or["!ref"]).e.r,dr=encode_range(pr));for(var mr=0;mr<hr.length;++mr){var fr=hr[mr];if(fr.Name=="_xlnm._FilterDatabase"&&fr.Sheet==cr){fr.Ref="'"+lr.SheetNames[cr]+"'!"+dr;break}}mr==hr.length&&hr.push({Name:"_xlnm._FilterDatabase",Sheet:cr,Ref:"'"+lr.SheetNames[cr]+"'!"+dr}),write_record(ar,161,write_UncheckedRfX(safe_decode_range(dr))),write_record(ar,162)}}function write_WSVIEWS2(ar,or,lr){write_record(ar,133),write_record(ar,137,write_BrtBeginWsView(or,lr)),write_record(ar,138),write_record(ar,134)}function write_SHEETPROTECT(ar,or){or["!protect"]&&write_record(ar,535,write_BrtSheetProtection(or["!protect"]))}function write_ws_bin(ar,or,lr,cr){var ur=buf_array(),dr=lr.SheetNames[ar],hr=lr.Sheets[dr]||{},pr=dr;try{lr&&lr.Workbook&&(pr=lr.Workbook.Sheets[ar].CodeName||pr)}catch{}var mr=safe_decode_range(hr["!ref"]||"A1");if(mr.e.c>16383||mr.e.r>1048575){if(or.WTF)throw new Error("Range "+(hr["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");mr.e.c=Math.min(mr.e.c,16383),mr.e.r=Math.min(mr.e.c,1048575)}return hr["!links"]=[],hr["!comments"]=[],write_record(ur,129),(lr.vbaraw||hr["!outline"])&&write_record(ur,147,write_BrtWsProp(pr,hr["!outline"])),write_record(ur,148,write_BrtWsDim(mr)),write_WSVIEWS2(ur,hr,lr.Workbook),write_COLINFOS(ur,hr),write_CELLTABLE(ur,hr,ar,or),write_SHEETPROTECT(ur,hr),write_AUTOFILTER(ur,hr,lr,ar),write_MERGECELLS(ur,hr),write_HLINKS(ur,hr,cr),hr["!margins"]&&write_record(ur,476,write_BrtMargins(hr["!margins"])),(!or||or.ignoreEC||or.ignoreEC==null)&&write_IGNOREECS(ur,hr),write_LEGACYDRAWING(ur,hr,ar,cr),write_record(ur,130),ur.end()}function parse_BrtCsProp(ar,or){ar.l+=10;var lr=parse_XLWideString(ar);return{name:lr}}var WBPropsDef=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];function safe1904(ar){return!ar.Workbook||!ar.Workbook.WBProps?"false":parsexmlbool(ar.Workbook.WBProps.date1904)?"true":"false"}var badchars="][*?/\\".split("");function check_ws_name(ar,or){if(ar.length>31)throw new Error("Sheet names cannot exceed 31 chars");var lr=!0;return badchars.forEach(function(cr){if(ar.indexOf(cr)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),lr}function check_wb_names(ar,or,lr){ar.forEach(function(cr,ur){check_ws_name(cr);for(var dr=0;dr<ur;++dr)if(cr==ar[dr])throw new Error("Duplicate Sheet Name: "+cr);if(lr){var hr=or&&or[ur]&&or[ur].CodeName||cr;if(hr.charCodeAt(0)==95&&hr.length>22)throw new Error("Bad Code Name: Worksheet"+hr)}})}function check_wb(ar){if(!ar||!ar.SheetNames||!ar.Sheets)throw new Error("Invalid Workbook");if(!ar.SheetNames.length)throw new Error("Workbook is empty");var or=ar.Workbook&&ar.Workbook.Sheets||[];check_wb_names(ar.SheetNames,or,!!ar.vbaraw);for(var lr=0;lr<ar.SheetNames.length;++lr)check_ws(ar.Sheets[ar.SheetNames[lr]],ar.SheetNames[lr],lr)}function write_wb_xml(ar){var or=[XML_HEADER];or[or.length]=writextag("workbook",null,{xmlns:XMLNS_main[0],"xmlns:r":XMLNS.r});var lr=ar.Workbook&&(ar.Workbook.Names||[]).length>0,cr={codeName:"ThisWorkbook"};ar.Workbook&&ar.Workbook.WBProps&&(WBPropsDef.forEach(function(pr){ar.Workbook.WBProps[pr[0]]!=null&&ar.Workbook.WBProps[pr[0]]!=pr[1]&&(cr[pr[0]]=ar.Workbook.WBProps[pr[0]])}),ar.Workbook.WBProps.CodeName&&(cr.codeName=ar.Workbook.WBProps.CodeName,delete cr.CodeName)),or[or.length]=writextag("workbookPr",null,cr);var ur=ar.Workbook&&ar.Workbook.Sheets||[],dr=0;if(ur&&ur[0]&&ur[0].Hidden){for(or[or.length]="<bookViews>",dr=0;dr!=ar.SheetNames.length&&!(!ur[dr]||!ur[dr].Hidden);++dr);dr==ar.SheetNames.length&&(dr=0),or[or.length]='<workbookView firstSheet="'+dr+'" activeTab="'+dr+'"/>',or[or.length]="</bookViews>"}for(or[or.length]="<sheets>",dr=0;dr!=ar.SheetNames.length;++dr){var hr={name:escapexml(ar.SheetNames[dr].slice(0,31))};if(hr.sheetId=""+(dr+1),hr["r:id"]="rId"+(dr+1),ur[dr])switch(ur[dr].Hidden){case 1:hr.state="hidden";break;case 2:hr.state="veryHidden";break}or[or.length]=writextag("sheet",null,hr)}return or[or.length]="</sheets>",lr&&(or[or.length]="<definedNames>",ar.Workbook&&ar.Workbook.Names&&ar.Workbook.Names.forEach(function(pr){var mr={name:pr.Name};pr.Comment&&(mr.comment=pr.Comment),pr.Sheet!=null&&(mr.localSheetId=""+pr.Sheet),pr.Hidden&&(mr.hidden="1"),pr.Ref&&(or[or.length]=writextag("definedName",escapexml(pr.Ref),mr))}),or[or.length]="</definedNames>"),or.length>2&&(or[or.length]="</workbook>",or[1]=or[1].replace("/>",">")),or.join("")}function parse_BrtBundleSh(ar,or){var lr={};return lr.Hidden=ar.read_shift(4),lr.iTabID=ar.read_shift(4),lr.strRelID=parse_RelID(ar),lr.name=parse_XLWideString(ar),lr}function write_BrtBundleSh(ar,or){return or||(or=new_buf(127)),or.write_shift(4,ar.Hidden),or.write_shift(4,ar.iTabID),write_RelID(ar.strRelID,or),write_XLWideString(ar.name.slice(0,31),or),or.length>or.l?or.slice(0,or.l):or}function parse_BrtWbProp(ar,or){var lr={},cr=ar.read_shift(4);lr.defaultThemeVersion=ar.read_shift(4);var ur=or>8?parse_XLWideString(ar):"";return ur.length>0&&(lr.CodeName=ur),lr.autoCompressPictures=!!(cr&65536),lr.backupFile=!!(cr&64),lr.checkCompatibility=!!(cr&4096),lr.date1904=!!(cr&1),lr.filterPrivacy=!!(cr&8),lr.hidePivotFieldList=!!(cr&1024),lr.promptedSolutions=!!(cr&16),lr.publishItems=!!(cr&2048),lr.refreshAllConnections=!!(cr&262144),lr.saveExternalLinkValues=!!(cr&128),lr.showBorderUnselectedTables=!!(cr&4),lr.showInkAnnotation=!!(cr&32),lr.showObjects=["all","placeholders","none"][cr>>13&3],lr.showPivotChartFilter=!!(cr&32768),lr.updateLinks=["userSet","never","always"][cr>>8&3],lr}function write_BrtWbProp(ar,or){or||(or=new_buf(72));var lr=0;return ar&&ar.filterPrivacy&&(lr|=8),or.write_shift(4,lr),or.write_shift(4,0),write_XLSBCodeName(ar&&ar.CodeName||"ThisWorkbook",or),or.slice(0,or.l)}function parse_BrtName(ar,or,lr){var cr=ar.l+or;ar.l+=4,ar.l+=1;var ur=ar.read_shift(4),dr=parse_XLNameWideString(ar),hr=parse_XLSBNameParsedFormula(ar,0,lr),pr=parse_XLNullableWideString(ar);ar.l=cr;var mr={Name:dr,Ptg:hr};return ur<268435455&&(mr.Sheet=ur),pr&&(mr.Comment=pr),mr}function write_BUNDLESHS(ar,or){write_record(ar,143);for(var lr=0;lr!=or.SheetNames.length;++lr){var cr=or.Workbook&&or.Workbook.Sheets&&or.Workbook.Sheets[lr]&&or.Workbook.Sheets[lr].Hidden||0,ur={Hidden:cr,iTabID:lr+1,strRelID:"rId"+(lr+1),name:or.SheetNames[lr]};write_record(ar,156,write_BrtBundleSh(ur))}write_record(ar,144)}function write_BrtFileVersion(ar,or){or||(or=new_buf(127));for(var lr=0;lr!=4;++lr)or.write_shift(4,0);return write_XLWideString("SheetJS",or),write_XLWideString(XLSX.version,or),write_XLWideString(XLSX.version,or),write_XLWideString("7262",or),or.length>or.l?or.slice(0,or.l):or}function write_BrtBookView(ar,or){or||(or=new_buf(29)),or.write_shift(-4,0),or.write_shift(-4,460),or.write_shift(4,28800),or.write_shift(4,17600),or.write_shift(4,500),or.write_shift(4,ar),or.write_shift(4,ar);var lr=120;return or.write_shift(1,lr),or.length>or.l?or.slice(0,or.l):or}function write_BOOKVIEWS(ar,or){if(!(!or.Workbook||!or.Workbook.Sheets)){for(var lr=or.Workbook.Sheets,cr=0,ur=-1,dr=-1;cr<lr.length;++cr)!lr[cr]||!lr[cr].Hidden&&ur==-1?ur=cr:lr[cr].Hidden==1&&dr==-1&&(dr=cr);dr>ur||(write_record(ar,135),write_record(ar,158,write_BrtBookView(ur)),write_record(ar,136))}}function write_wb_bin(ar,or){var lr=buf_array();return write_record(lr,131),write_record(lr,128,write_BrtFileVersion()),write_record(lr,153,write_BrtWbProp(ar.Workbook&&ar.Workbook.WBProps||null)),write_BOOKVIEWS(lr,ar),write_BUNDLESHS(lr,ar),write_record(lr,132),lr.end()}function write_wb(ar,or,lr){return(or.slice(-4)===".bin"?write_wb_bin:write_wb_xml)(ar)}function write_ws(ar,or,lr,cr,ur){return(or.slice(-4)===".bin"?write_ws_bin:write_ws_xml)(ar,lr,cr,ur)}function write_sty(ar,or,lr){return(or.slice(-4)===".bin"?write_sty_bin:write_sty_xml)(ar,lr)}function write_sst(ar,or,lr){return(or.slice(-4)===".bin"?write_sst_bin:write_sst_xml)(ar,lr)}function write_cmnt(ar,or,lr){return(or.slice(-4)===".bin"?write_comments_bin:write_comments_xml)(ar)}function write_xlmeta(ar){return(ar.slice(-4)===".bin"?write_xlmeta_bin:write_xlmeta_xml)()}function write_props_xlml(ar,or){var lr=[];return ar.Props&&lr.push(xlml_write_docprops(ar.Props,or)),ar.Custprops&&lr.push(xlml_write_custprops(ar.Props,ar.Custprops)),lr.join("")}function write_wb_xlml(){return""}function write_sty_xlml(ar,or){var lr=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return or.cellXfs.forEach(function(cr,ur){var dr=[];dr.push(writextag("NumberFormat",null,{"ss:Format":escapexml(table_fmt[cr.numFmtId])}));var hr={"ss:ID":"s"+(21+ur)};lr.push(writextag("Style",dr.join(""),hr))}),writextag("Styles",lr.join(""))}function write_name_xlml(ar){return writextag("NamedRange",null,{"ss:Name":ar.Name,"ss:RefersTo":"="+a1_to_rc(ar.Ref,{r:0,c:0})})}function write_names_xlml(ar){if(!((ar||{}).Workbook||{}).Names)return"";for(var or=ar.Workbook.Names,lr=[],cr=0;cr<or.length;++cr){var ur=or[cr];ur.Sheet==null&&(ur.Name.match(/^_xlfn\./)||lr.push(write_name_xlml(ur)))}return writextag("Names",lr.join(""))}function write_ws_xlml_names(ar,or,lr,cr){if(!ar||!((cr||{}).Workbook||{}).Names)return"";for(var ur=cr.Workbook.Names,dr=[],hr=0;hr<ur.length;++hr){var pr=ur[hr];pr.Sheet==lr&&(pr.Name.match(/^_xlfn\./)||dr.push(write_name_xlml(pr)))}return dr.join("")}function write_ws_xlml_wsopts(ar,or,lr,cr){if(!ar)return"";var ur=[];if(ar["!margins"]&&(ur.push("<PageSetup>"),ar["!margins"].header&&ur.push(writextag("Header",null,{"x:Margin":ar["!margins"].header})),ar["!margins"].footer&&ur.push(writextag("Footer",null,{"x:Margin":ar["!margins"].footer})),ur.push(writextag("PageMargins",null,{"x:Bottom":ar["!margins"].bottom||"0.75","x:Left":ar["!margins"].left||"0.7","x:Right":ar["!margins"].right||"0.7","x:Top":ar["!margins"].top||"0.75"})),ur.push("</PageSetup>")),cr&&cr.Workbook&&cr.Workbook.Sheets&&cr.Workbook.Sheets[lr])if(cr.Workbook.Sheets[lr].Hidden)ur.push(writextag("Visible",cr.Workbook.Sheets[lr].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var dr=0;dr<lr&&!(cr.Workbook.Sheets[dr]&&!cr.Workbook.Sheets[dr].Hidden);++dr);dr==lr&&ur.push("<Selected/>")}return((((cr||{}).Workbook||{}).Views||[])[0]||{}).RTL&&ur.push("<DisplayRightToLeft/>"),ar["!protect"]&&(ur.push(writetag("ProtectContents","True")),ar["!protect"].objects&&ur.push(writetag("ProtectObjects","True")),ar["!protect"].scenarios&&ur.push(writetag("ProtectScenarios","True")),ar["!protect"].selectLockedCells!=null&&!ar["!protect"].selectLockedCells?ur.push(writetag("EnableSelection","NoSelection")):ar["!protect"].selectUnlockedCells!=null&&!ar["!protect"].selectUnlockedCells&&ur.push(writetag("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(hr){ar["!protect"][hr[0]]&&ur.push("<"+hr[1]+"/>")})),ur.length==0?"":writextag("WorksheetOptions",ur.join(""),{xmlns:XLMLNS.x})}function write_ws_xlml_comment(ar){return ar.map(function(or){var lr=xlml_unfixstr(or.t||""),cr=writextag("ss:Data",lr,{xmlns:"http://www.w3.org/TR/REC-html40"});return writextag("Comment",cr,{"ss:Author":or.a})}).join("")}function write_ws_xlml_cell(ar,or,lr,cr,ur,dr,hr){if(!ar||ar.v==null&&ar.f==null)return"";var pr={};if(ar.f&&(pr["ss:Formula"]="="+escapexml(a1_to_rc(ar.f,hr))),ar.F&&ar.F.slice(0,or.length)==or){var mr=decode_cell(ar.F.slice(or.length+1));pr["ss:ArrayRange"]="RC:R"+(mr.r==hr.r?"":"["+(mr.r-hr.r)+"]")+"C"+(mr.c==hr.c?"":"["+(mr.c-hr.c)+"]")}if(ar.l&&ar.l.Target&&(pr["ss:HRef"]=escapexml(ar.l.Target),ar.l.Tooltip&&(pr["x:HRefScreenTip"]=escapexml(ar.l.Tooltip))),lr["!merges"])for(var fr=lr["!merges"],xr=0;xr!=fr.length;++xr)fr[xr].s.c!=hr.c||fr[xr].s.r!=hr.r||(fr[xr].e.c>fr[xr].s.c&&(pr["ss:MergeAcross"]=fr[xr].e.c-fr[xr].s.c),fr[xr].e.r>fr[xr].s.r&&(pr["ss:MergeDown"]=fr[xr].e.r-fr[xr].s.r));var Er="",vr="";switch(ar.t){case"z":if(!cr.sheetStubs)return"";break;case"n":Er="Number",vr=String(ar.v);break;case"b":Er="Boolean",vr=ar.v?"1":"0";break;case"e":Er="Error",vr=BErr[ar.v];break;case"d":Er="DateTime",vr=new Date(ar.v).toISOString(),ar.z==null&&(ar.z=ar.z||table_fmt[14]);break;case"s":Er="String",vr=escapexlml(ar.v||"");break}var gr=get_cell_style(cr.cellXfs,ar,cr);pr["ss:StyleID"]="s"+(21+gr),pr["ss:Index"]=hr.c+1;var yr=ar.v!=null?vr:"",br=ar.t=="z"?"":'<Data ss:Type="'+Er+'">'+yr+"</Data>";return(ar.c||[]).length>0&&(br+=write_ws_xlml_comment(ar.c)),writextag("Cell",br,pr)}function write_ws_xlml_row(ar,or){var lr='<Row ss:Index="'+(ar+1)+'"';return or&&(or.hpt&&!or.hpx&&(or.hpx=pt2px(or.hpt)),or.hpx&&(lr+=' ss:AutoFitHeight="0" ss:Height="'+or.hpx+'"'),or.hidden&&(lr+=' ss:Hidden="1"')),lr+">"}function write_ws_xlml_table(ar,or,lr,cr){if(!ar["!ref"])return"";var ur=safe_decode_range(ar["!ref"]),dr=ar["!merges"]||[],hr=0,pr=[];ar["!cols"]&&ar["!cols"].forEach(function(_r,jr){process_col(_r);var wr=!!_r.width,Sr=col_obj_w(jr,_r),Tr={"ss:Index":jr+1};wr&&(Tr["ss:Width"]=width2px(Sr.width)),_r.hidden&&(Tr["ss:Hidden"]="1"),pr.push(writextag("Column",null,Tr))});for(var mr=Array.isArray(ar),fr=ur.s.r;fr<=ur.e.r;++fr){for(var xr=[write_ws_xlml_row(fr,(ar["!rows"]||[])[fr])],Er=ur.s.c;Er<=ur.e.c;++Er){var vr=!1;for(hr=0;hr!=dr.length;++hr)if(!(dr[hr].s.c>Er)&&!(dr[hr].s.r>fr)&&!(dr[hr].e.c<Er)&&!(dr[hr].e.r<fr)){(dr[hr].s.c!=Er||dr[hr].s.r!=fr)&&(vr=!0);break}if(!vr){var gr={r:fr,c:Er},yr=encode_cell(gr),br=mr?(ar[fr]||[])[Er]:ar[yr];xr.push(write_ws_xlml_cell(br,yr,ar,or,lr,cr,gr))}}xr.push("</Row>"),xr.length>2&&pr.push(xr.join(""))}return pr.join("")}function write_ws_xlml(ar,or,lr){var cr=[],ur=lr.SheetNames[ar],dr=lr.Sheets[ur],hr=dr?write_ws_xlml_names(dr,or,ar,lr):"";return hr.length>0&&cr.push("<Names>"+hr+"</Names>"),hr=dr?write_ws_xlml_table(dr,or,ar,lr):"",hr.length>0&&cr.push("<Table>"+hr+"</Table>"),cr.push(write_ws_xlml_wsopts(dr,or,ar,lr)),cr.join("")}function write_xlml(ar,or){or||(or={}),ar.SSF||(ar.SSF=dup(table_fmt)),ar.SSF&&(make_ssf(),SSF_load_table(ar.SSF),or.revssf=evert_num(ar.SSF),or.revssf[ar.SSF[65535]]=0,or.ssf=ar.SSF,or.cellXfs=[],get_cell_style(or.cellXfs,{},{revssf:{General:0}}));var lr=[];lr.push(write_props_xlml(ar,or)),lr.push(write_wb_xlml()),lr.push(""),lr.push("");for(var cr=0;cr<ar.SheetNames.length;++cr)lr.push(writextag("Worksheet",write_ws_xlml(cr,or,ar),{"ss:Name":escapexml(ar.SheetNames[cr])}));return lr[2]=write_sty_xlml(ar,or),lr[3]=write_names_xlml(ar),XML_HEADER+writextag("Workbook",lr.join(""),{xmlns:XLMLNS.ss,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:ss":XLMLNS.ss,"xmlns:dt":XLMLNS.dt,"xmlns:html":XLMLNS.html})}var PSCLSID={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function write_xls_props(ar,or){var lr=[],cr=[],ur=[],dr=0,hr,pr=evert_key(DocSummaryPIDDSI,"n"),mr=evert_key(SummaryPIDSI,"n");if(ar.Props)for(hr=keys(ar.Props),dr=0;dr<hr.length;++dr)(Object.prototype.hasOwnProperty.call(pr,hr[dr])?lr:Object.prototype.hasOwnProperty.call(mr,hr[dr])?cr:ur).push([hr[dr],ar.Props[hr[dr]]]);if(ar.Custprops)for(hr=keys(ar.Custprops),dr=0;dr<hr.length;++dr)Object.prototype.hasOwnProperty.call(ar.Props||{},hr[dr])||(Object.prototype.hasOwnProperty.call(pr,hr[dr])?lr:Object.prototype.hasOwnProperty.call(mr,hr[dr])?cr:ur).push([hr[dr],ar.Custprops[hr[dr]]]);var fr=[];for(dr=0;dr<ur.length;++dr)XLSPSSkip.indexOf(ur[dr][0])>-1||PseudoPropsPairs.indexOf(ur[dr][0])>-1||ur[dr][1]!=null&&fr.push(ur[dr]);cr.length&&CFB.utils.cfb_add(or,"/SummaryInformation",write_PropertySetStream(cr,PSCLSID.SI,mr,SummaryPIDSI)),(lr.length||fr.length)&&CFB.utils.cfb_add(or,"/DocumentSummaryInformation",write_PropertySetStream(lr,PSCLSID.DSI,pr,DocSummaryPIDDSI,fr.length?fr:null,PSCLSID.UDI))}function write_xlscfb(ar,or){var lr=or||{},cr=CFB.utils.cfb_new({root:"R"}),ur="/Workbook";switch(lr.bookType||"xls"){case"xls":lr.bookType="biff8";case"xla":lr.bookType||(lr.bookType="xla");case"biff8":ur="/Workbook",lr.biff=8;break;case"biff5":ur="/Book",lr.biff=5;break;default:throw new Error("invalid type "+lr.bookType+" for XLS CFB")}return CFB.utils.cfb_add(cr,ur,write_biff_buf(ar,lr)),lr.biff==8&&(ar.Props||ar.Custprops)&&write_xls_props(ar,cr),lr.biff==8&&ar.vbaraw&&fill_vba_xls(cr,CFB.read(ar.vbaraw,{type:typeof ar.vbaraw=="string"?"binary":"buffer"})),cr}var XLSBRecordEnum={0:{f:parse_BrtRowHdr},1:{f:parse_BrtCellBlank},2:{f:parse_BrtCellRk},3:{f:parse_BrtCellError},4:{f:parse_BrtCellBool},5:{f:parse_BrtCellReal},6:{f:parse_BrtCellSt},7:{f:parse_BrtCellIsst},8:{f:parse_BrtFmlaString},9:{f:parse_BrtFmlaNum},10:{f:parse_BrtFmlaBool},11:{f:parse_BrtFmlaError},12:{f:parse_BrtShortBlank},13:{f:parse_BrtShortRk},14:{f:parse_BrtShortError},15:{f:parse_BrtShortBool},16:{f:parse_BrtShortReal},17:{f:parse_BrtShortSt},18:{f:parse_BrtShortIsst},19:{f:parse_RichStr},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:parse_BrtName},40:{},42:{},43:{f:parse_BrtFont},44:{f:parse_BrtFmt},45:{f:parse_BrtFill},46:{f:parse_BrtBorder},47:{f:parse_BrtXF},48:{},49:{f:parse_Int32LE},50:{},51:{f:parse_BrtMdb},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:parse_ColInfo},62:{f:parse_BrtCellRString},63:{f:parse_BrtCalcChainItem$},64:{f:parse_BrtDVal},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:parsenoop,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:parse_BrtBeginWsView},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:parse_BrtWsProp},148:{f:parse_BrtWsDim,p:16},151:{f:parse_BrtPane},152:{},153:{f:parse_BrtWbProp},154:{},155:{},156:{f:parse_BrtBundleSh},157:{},158:{},159:{T:1,f:parse_BrtBeginSst},160:{T:-1},161:{T:1,f:parse_UncheckedRfX},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:parse_BrtMergeCell},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:parse_BrtMdtinfo},336:{T:-1},337:{f:parse_BrtBeginEsmdb,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:parse_RelID},357:{},358:{},359:{},360:{T:1},361:{},362:{f:parse_ExternSheet},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:parse_BrtArrFmla},427:{f:parse_BrtShrFmla},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:parse_BrtMargins},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:parse_BrtWsFmtInfo},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:parse_BrtHLink},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:parse_RelID},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:parse_BrtCommentAuthor},633:{T:1},634:{T:-1},635:{T:1,f:parse_BrtBeginComment},636:{T:-1},637:{f:parse_BrtCommentText},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:parse_BrtCsProp},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:parse_BrtDVal14},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function write_biff_rec(ar,or,lr,cr){var ur=or;if(!isNaN(ur)){var dr=cr||(lr||[]).length||0,hr=ar.next(4);hr.write_shift(2,ur),hr.write_shift(2,dr),dr>0&&is_buf(lr)&&ar.push(lr)}}function write_biff_continue(ar,or,lr,cr){var ur=(lr||[]).length||0;if(ur<=8224)return write_biff_rec(ar,or,lr,ur);var dr=or;if(!isNaN(dr)){for(var hr=lr.parts||[],pr=0,mr=0,fr=0;fr+(hr[pr]||8224)<=8224;)fr+=hr[pr]||8224,pr++;var xr=ar.next(4);for(xr.write_shift(2,dr),xr.write_shift(2,fr),ar.push(lr.slice(mr,mr+fr)),mr+=fr;mr<ur;){for(xr=ar.next(4),xr.write_shift(2,60),fr=0;fr+(hr[pr]||8224)<=8224;)fr+=hr[pr]||8224,pr++;xr.write_shift(2,fr),ar.push(lr.slice(mr,mr+fr)),mr+=fr}}}function write_BIFF2Cell(ar,or,lr){return ar||(ar=new_buf(7)),ar.write_shift(2,or),ar.write_shift(2,lr),ar.write_shift(2,0),ar.write_shift(1,0),ar}function write_BIFF2BERR(ar,or,lr,cr){var ur=new_buf(9);return write_BIFF2Cell(ur,ar,or),write_Bes(lr,cr||"b",ur),ur}function write_BIFF2LABEL(ar,or,lr){var cr=new_buf(8+2*lr.length);return write_BIFF2Cell(cr,ar,or),cr.write_shift(1,lr.length),cr.write_shift(lr.length,lr,"sbcs"),cr.l<cr.length?cr.slice(0,cr.l):cr}function write_ws_biff2_cell(ar,or,lr,cr){if(or.v!=null)switch(or.t){case"d":case"n":var ur=or.t=="d"?datenum(parseDate(or.v)):or.v;ur==(ur|0)&&ur>=0&&ur<65536?write_biff_rec(ar,2,write_BIFF2INT(lr,cr,ur)):write_biff_rec(ar,3,write_BIFF2NUM(lr,cr,ur));return;case"b":case"e":write_biff_rec(ar,5,write_BIFF2BERR(lr,cr,or.v,or.t));return;case"s":case"str":write_biff_rec(ar,4,write_BIFF2LABEL(lr,cr,(or.v||"").slice(0,255)));return}write_biff_rec(ar,1,write_BIFF2Cell(null,lr,cr))}function write_ws_biff2(ar,or,lr,cr){var ur=Array.isArray(or),dr=safe_decode_range(or["!ref"]||"A1"),hr,pr="",mr=[];if(dr.e.c>255||dr.e.r>16383){if(cr.WTF)throw new Error("Range "+(or["!ref"]||"A1")+" exceeds format limit A1:IV16384");dr.e.c=Math.min(dr.e.c,255),dr.e.r=Math.min(dr.e.c,16383),hr=encode_range(dr)}for(var fr=dr.s.r;fr<=dr.e.r;++fr){pr=encode_row(fr);for(var xr=dr.s.c;xr<=dr.e.c;++xr){fr===dr.s.r&&(mr[xr]=encode_col(xr)),hr=mr[xr]+pr;var Er=ur?(or[fr]||[])[xr]:or[hr];Er&&write_ws_biff2_cell(ar,Er,fr,xr)}}}function write_biff2_buf(ar,or){for(var lr=or||{},cr=buf_array(),ur=0,dr=0;dr<ar.SheetNames.length;++dr)ar.SheetNames[dr]==lr.sheet&&(ur=dr);if(ur==0&&lr.sheet&&ar.SheetNames[0]!=lr.sheet)throw new Error("Sheet not found: "+lr.sheet);return write_biff_rec(cr,lr.biff==4?1033:lr.biff==3?521:9,write_BOF(ar,16,lr)),write_ws_biff2(cr,ar.Sheets[ar.SheetNames[ur]],ur,lr),write_biff_rec(cr,10),cr.end()}function write_FONTS_biff8(ar,or,lr){write_biff_rec(ar,49,write_Font({sz:12,name:"Arial"},lr))}function write_FMTS_biff8(ar,or,lr){or&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(cr){for(var ur=cr[0];ur<=cr[1];++ur)or[ur]!=null&&write_biff_rec(ar,1054,write_Format(ur,or[ur],lr))})}function write_FEAT(ar,or){var lr=new_buf(19);lr.write_shift(4,2151),lr.write_shift(4,0),lr.write_shift(4,0),lr.write_shift(2,3),lr.write_shift(1,1),lr.write_shift(4,0),write_biff_rec(ar,2151,lr),lr=new_buf(39),lr.write_shift(4,2152),lr.write_shift(4,0),lr.write_shift(4,0),lr.write_shift(2,3),lr.write_shift(1,0),lr.write_shift(4,0),lr.write_shift(2,1),lr.write_shift(4,4),lr.write_shift(2,0),write_Ref8U(safe_decode_range(or["!ref"]||"A1"),lr),lr.write_shift(4,4),write_biff_rec(ar,2152,lr)}function write_CELLXFS_biff8(ar,or){for(var lr=0;lr<16;++lr)write_biff_rec(ar,224,write_XF({numFmtId:0,style:!0},0,or));or.cellXfs.forEach(function(cr){write_biff_rec(ar,224,write_XF(cr,0,or))})}function write_ws_biff8_hlinks(ar,or){for(var lr=0;lr<or["!links"].length;++lr){var cr=or["!links"][lr];write_biff_rec(ar,440,write_HLink(cr)),cr[1].Tooltip&&write_biff_rec(ar,2048,write_HLinkTooltip(cr))}delete or["!links"]}function write_ws_cols_biff8(ar,or){if(or){var lr=0;or.forEach(function(cr,ur){++lr<=256&&cr&&write_biff_rec(ar,125,write_ColInfo(col_obj_w(ur,cr),ur))})}}function write_ws_biff8_cell(ar,or,lr,cr,ur){var dr=16+get_cell_style(ur.cellXfs,or,ur);if(or.v==null&&!or.bf){write_biff_rec(ar,513,write_XLSCell(lr,cr,dr));return}if(or.bf)write_biff_rec(ar,6,write_Formula(or,lr,cr,ur,dr));else switch(or.t){case"d":case"n":var hr=or.t=="d"?datenum(parseDate(or.v)):or.v;write_biff_rec(ar,515,write_Number(lr,cr,hr,dr));break;case"b":case"e":write_biff_rec(ar,517,write_BoolErr(lr,cr,or.v,dr,ur,or.t));break;case"s":case"str":if(ur.bookSST){var pr=get_sst_id(ur.Strings,or.v,ur.revStrings);write_biff_rec(ar,253,write_LabelSst(lr,cr,pr,dr))}else write_biff_rec(ar,516,write_Label(lr,cr,(or.v||"").slice(0,255),dr,ur));break;default:write_biff_rec(ar,513,write_XLSCell(lr,cr,dr))}}function write_ws_biff8(ar,or,lr){var cr=buf_array(),ur=lr.SheetNames[ar],dr=lr.Sheets[ur]||{},hr=(lr||{}).Workbook||{},pr=(hr.Sheets||[])[ar]||{},mr=Array.isArray(dr),fr=or.biff==8,xr,Er="",vr=[],gr=safe_decode_range(dr["!ref"]||"A1"),yr=fr?65536:16384;if(gr.e.c>255||gr.e.r>=yr){if(or.WTF)throw new Error("Range "+(dr["!ref"]||"A1")+" exceeds format limit A1:IV16384");gr.e.c=Math.min(gr.e.c,255),gr.e.r=Math.min(gr.e.c,yr-1)}write_biff_rec(cr,2057,write_BOF(lr,16,or)),write_biff_rec(cr,13,writeuint16(1)),write_biff_rec(cr,12,writeuint16(100)),write_biff_rec(cr,15,writebool(!0)),write_biff_rec(cr,17,writebool(!1)),write_biff_rec(cr,16,write_Xnum(.001)),write_biff_rec(cr,95,writebool(!0)),write_biff_rec(cr,42,writebool(!1)),write_biff_rec(cr,43,writebool(!1)),write_biff_rec(cr,130,writeuint16(1)),write_biff_rec(cr,128,write_Guts()),write_biff_rec(cr,131,writebool(!1)),write_biff_rec(cr,132,writebool(!1)),fr&&write_ws_cols_biff8(cr,dr["!cols"]),write_biff_rec(cr,512,write_Dimensions(gr,or)),fr&&(dr["!links"]=[]);for(var br=gr.s.r;br<=gr.e.r;++br){Er=encode_row(br);for(var _r=gr.s.c;_r<=gr.e.c;++_r){br===gr.s.r&&(vr[_r]=encode_col(_r)),xr=vr[_r]+Er;var jr=mr?(dr[br]||[])[_r]:dr[xr];jr&&(write_ws_biff8_cell(cr,jr,br,_r,or),fr&&jr.l&&dr["!links"].push([xr,jr.l]))}}var wr=pr.CodeName||pr.name||ur;return fr&&write_biff_rec(cr,574,write_Window2((hr.Views||[])[0])),fr&&(dr["!merges"]||[]).length&&write_biff_rec(cr,229,write_MergeCells(dr["!merges"])),fr&&write_ws_biff8_hlinks(cr,dr),write_biff_rec(cr,442,write_XLUnicodeString(wr)),fr&&write_FEAT(cr,dr),write_biff_rec(cr,10),cr.end()}function write_biff8_global(ar,or,lr){var cr=buf_array(),ur=(ar||{}).Workbook||{},dr=ur.Sheets||[],hr=ur.WBProps||{},pr=lr.biff==8,mr=lr.biff==5;if(write_biff_rec(cr,2057,write_BOF(ar,5,lr)),lr.bookType=="xla"&&write_biff_rec(cr,135),write_biff_rec(cr,225,pr?writeuint16(1200):null),write_biff_rec(cr,193,writezeroes(2)),mr&&write_biff_rec(cr,191),mr&&write_biff_rec(cr,192),write_biff_rec(cr,226),write_biff_rec(cr,92,write_WriteAccess("SheetJS",lr)),write_biff_rec(cr,66,writeuint16(pr?1200:1252)),pr&&write_biff_rec(cr,353,writeuint16(0)),pr&&write_biff_rec(cr,448),write_biff_rec(cr,317,write_RRTabId(ar.SheetNames.length)),pr&&ar.vbaraw&&write_biff_rec(cr,211),pr&&ar.vbaraw){var fr=hr.CodeName||"ThisWorkbook";write_biff_rec(cr,442,write_XLUnicodeString(fr))}write_biff_rec(cr,156,writeuint16(17)),write_biff_rec(cr,25,writebool(!1)),write_biff_rec(cr,18,writebool(!1)),write_biff_rec(cr,19,writeuint16(0)),pr&&write_biff_rec(cr,431,writebool(!1)),pr&&write_biff_rec(cr,444,writeuint16(0)),write_biff_rec(cr,61,write_Window1()),write_biff_rec(cr,64,writebool(!1)),write_biff_rec(cr,141,writeuint16(0)),write_biff_rec(cr,34,writebool(safe1904(ar)=="true")),write_biff_rec(cr,14,writebool(!0)),pr&&write_biff_rec(cr,439,writebool(!1)),write_biff_rec(cr,218,writeuint16(0)),write_FONTS_biff8(cr,ar,lr),write_FMTS_biff8(cr,ar.SSF,lr),write_CELLXFS_biff8(cr,lr),pr&&write_biff_rec(cr,352,writebool(!1));var xr=cr.end(),Er=buf_array();pr&&write_biff_rec(Er,140,write_Country()),pr&&lr.Strings&&write_biff_continue(Er,252,write_SST(lr.Strings)),write_biff_rec(Er,10);var vr=Er.end(),gr=buf_array(),yr=0,br=0;for(br=0;br<ar.SheetNames.length;++br)yr+=(pr?12:11)+(pr?2:1)*ar.SheetNames[br].length;var _r=xr.length+yr+vr.length;for(br=0;br<ar.SheetNames.length;++br){var jr=dr[br]||{};write_biff_rec(gr,133,write_BoundSheet8({pos:_r,hs:jr.Hidden||0,dt:0,name:ar.SheetNames[br]},lr)),_r+=or[br].length}var wr=gr.end();if(yr!=wr.length)throw new Error("BS8 "+yr+" != "+wr.length);var Sr=[];return xr.length&&Sr.push(xr),wr.length&&Sr.push(wr),vr.length&&Sr.push(vr),bconcat(Sr)}function write_biff8_buf(ar,or){var lr=or||{},cr=[];ar&&!ar.SSF&&(ar.SSF=dup(table_fmt)),ar&&ar.SSF&&(make_ssf(),SSF_load_table(ar.SSF),lr.revssf=evert_num(ar.SSF),lr.revssf[ar.SSF[65535]]=0,lr.ssf=ar.SSF),lr.Strings=[],lr.Strings.Count=0,lr.Strings.Unique=0,fix_write_opts(lr),lr.cellXfs=[],get_cell_style(lr.cellXfs,{},{revssf:{General:0}}),ar.Props||(ar.Props={});for(var ur=0;ur<ar.SheetNames.length;++ur)cr[cr.length]=write_ws_biff8(ur,lr,ar);return cr.unshift(write_biff8_global(ar,cr,lr)),bconcat(cr)}function write_biff_buf(ar,or){for(var lr=0;lr<=ar.SheetNames.length;++lr){var cr=ar.Sheets[ar.SheetNames[lr]];if(!(!cr||!cr["!ref"])){var ur=decode_range(cr["!ref"]);ur.e.c>255&&typeof console<"u"&&console.error&&console.error("Worksheet '"+ar.SheetNames[lr]+"' extends beyond column IV (255).  Data may be lost.")}}var dr=or||{};switch(dr.biff||2){case 8:case 5:return write_biff8_buf(ar,or);case 4:case 3:case 2:return write_biff2_buf(ar,or)}throw new Error("invalid type "+dr.bookType+" for BIFF")}function make_html_row(ar,or,lr,cr){for(var ur=ar["!merges"]||[],dr=[],hr=or.s.c;hr<=or.e.c;++hr){for(var pr=0,mr=0,fr=0;fr<ur.length;++fr)if(!(ur[fr].s.r>lr||ur[fr].s.c>hr)&&!(ur[fr].e.r<lr||ur[fr].e.c<hr)){if(ur[fr].s.r<lr||ur[fr].s.c<hr){pr=-1;break}pr=ur[fr].e.r-ur[fr].s.r+1,mr=ur[fr].e.c-ur[fr].s.c+1;break}if(!(pr<0)){var xr=encode_cell({r:lr,c:hr}),Er=cr.dense?(ar[lr]||[])[hr]:ar[xr],vr=Er&&Er.v!=null&&(Er.h||escapehtml(Er.w||(format_cell(Er),Er.w)||""))||"",gr={};pr>1&&(gr.rowspan=pr),mr>1&&(gr.colspan=mr),cr.editable?vr='<span contenteditable="true">'+vr+"</span>":Er&&(gr["data-t"]=Er&&Er.t||"z",Er.v!=null&&(gr["data-v"]=Er.v),Er.z!=null&&(gr["data-z"]=Er.z),Er.l&&(Er.l.Target||"#").charAt(0)!="#"&&(vr='<a href="'+Er.l.Target+'">'+vr+"</a>")),gr.id=(cr.id||"sjs")+"-"+xr,dr.push(writextag("td",vr,gr))}}var yr="<tr>";return yr+dr.join("")+"</tr>"}var HTML_BEGIN='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',HTML_END="</body></html>";function make_html_preamble(ar,or,lr){var cr=[];return cr.join("")+"<table"+(lr&&lr.id?' id="'+lr.id+'"':"")+">"}function sheet_to_html(ar,or){var lr=or||{},cr=lr.header!=null?lr.header:HTML_BEGIN,ur=lr.footer!=null?lr.footer:HTML_END,dr=[cr],hr=decode_range(ar["!ref"]);lr.dense=Array.isArray(ar),dr.push(make_html_preamble(ar,hr,lr));for(var pr=hr.s.r;pr<=hr.e.r;++pr)dr.push(make_html_row(ar,hr,pr,lr));return dr.push("</table>"+ur),dr.join("")}function sheet_add_dom(ar,or,lr){var cr=lr||{},ur=0,dr=0;if(cr.origin!=null)if(typeof cr.origin=="number")ur=cr.origin;else{var hr=typeof cr.origin=="string"?decode_cell(cr.origin):cr.origin;ur=hr.r,dr=hr.c}var pr=or.getElementsByTagName("tr"),mr=Math.min(cr.sheetRows||1e7,pr.length),fr={s:{r:0,c:0},e:{r:ur,c:dr}};if(ar["!ref"]){var xr=decode_range(ar["!ref"]);fr.s.r=Math.min(fr.s.r,xr.s.r),fr.s.c=Math.min(fr.s.c,xr.s.c),fr.e.r=Math.max(fr.e.r,xr.e.r),fr.e.c=Math.max(fr.e.c,xr.e.c),ur==-1&&(fr.e.r=ur=xr.e.r+1)}var Er=[],vr=0,gr=ar["!rows"]||(ar["!rows"]=[]),yr=0,br=0,_r=0,jr=0,wr=0,Sr=0;for(ar["!cols"]||(ar["!cols"]=[]);yr<pr.length&&br<mr;++yr){var Tr=pr[yr];if(is_dom_element_hidden(Tr)){if(cr.display)continue;gr[br]={hidden:!0}}var Rr=Tr.children;for(_r=jr=0;_r<Rr.length;++_r){var Nr=Rr[_r];if(!(cr.display&&is_dom_element_hidden(Nr))){var Cr=Nr.hasAttribute("data-v")?Nr.getAttribute("data-v"):Nr.hasAttribute("v")?Nr.getAttribute("v"):htmldecode(Nr.innerHTML),kr=Nr.getAttribute("data-z")||Nr.getAttribute("z");for(vr=0;vr<Er.length;++vr){var Ar=Er[vr];Ar.s.c==jr+dr&&Ar.s.r<br+ur&&br+ur<=Ar.e.r&&(jr=Ar.e.c+1-dr,vr=-1)}Sr=+Nr.getAttribute("colspan")||1,((wr=+Nr.getAttribute("rowspan")||1)>1||Sr>1)&&Er.push({s:{r:br+ur,c:jr+dr},e:{r:br+ur+(wr||1)-1,c:jr+dr+(Sr||1)-1}});var Or={t:"s",v:Cr},Lr=Nr.getAttribute("data-t")||Nr.getAttribute("t")||"";Cr!=null&&(Cr.length==0?Or.t=Lr||"z":cr.raw||Cr.trim().length==0||Lr=="s"||(Cr==="TRUE"?Or={t:"b",v:!0}:Cr==="FALSE"?Or={t:"b",v:!1}:isNaN(fuzzynum(Cr))?isNaN(fuzzydate(Cr).getDate())||(Or={t:"d",v:parseDate(Cr)},cr.cellDates||(Or={t:"n",v:datenum(Or.v)}),Or.z=cr.dateNF||table_fmt[14]):Or={t:"n",v:fuzzynum(Cr)})),Or.z===void 0&&kr!=null&&(Or.z=kr);var Fr="",Hr=Nr.getElementsByTagName("A");if(Hr&&Hr.length)for(var Kr=0;Kr<Hr.length&&!(Hr[Kr].hasAttribute("href")&&(Fr=Hr[Kr].getAttribute("href"),Fr.charAt(0)!="#"));++Kr);Fr&&Fr.charAt(0)!="#"&&(Or.l={Target:Fr}),cr.dense?(ar[br+ur]||(ar[br+ur]=[]),ar[br+ur][jr+dr]=Or):ar[encode_cell({c:jr+dr,r:br+ur})]=Or,fr.e.c<jr+dr&&(fr.e.c=jr+dr),jr+=Sr}}++br}return Er.length&&(ar["!merges"]=(ar["!merges"]||[]).concat(Er)),fr.e.r=Math.max(fr.e.r,br-1+ur),ar["!ref"]=encode_range(fr),br>=mr&&(ar["!fullref"]=encode_range((fr.e.r=pr.length-yr+br-1+ur,fr))),ar}function parse_dom_table(ar,or){var lr=or||{},cr=lr.dense?[]:{};return sheet_add_dom(cr,ar,or)}function table_to_book(ar,or){return sheet_to_workbook(parse_dom_table(ar,or),or)}function is_dom_element_hidden(ar){var or="",lr=get_get_computed_style_function(ar);return lr&&(or=lr(ar).getPropertyValue("display")),or||(or=ar.style&&ar.style.display),or==="none"}function get_get_computed_style_function(ar){return ar.ownerDocument.defaultView&&typeof ar.ownerDocument.defaultView.getComputedStyle=="function"?ar.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}var write_styles_ods=function(){var ar=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),or="<office:document-styles "+wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+ar+"</office:document-styles>";return function(){return XML_HEADER+or}}(),write_content_ods=function(){var ar=function(dr){return escapexml(dr).replace(/  +/g,function(hr){return'<text:s text:c="'+hr.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},or=`          <table:table-cell />
`,lr=`          <table:covered-table-cell/>
`,cr=function(dr,hr,pr){var mr=[];mr.push('      <table:table table:name="'+escapexml(hr.SheetNames[pr])+`" table:style-name="ta1">
`);var fr=0,xr=0,Er=decode_range(dr["!ref"]||"A1"),vr=dr["!merges"]||[],gr=0,yr=Array.isArray(dr);if(dr["!cols"])for(xr=0;xr<=Er.e.c;++xr)mr.push("        <table:table-column"+(dr["!cols"][xr]?' table:style-name="co'+dr["!cols"][xr].ods+'"':"")+`></table:table-column>
`);var br="",_r=dr["!rows"]||[];for(fr=0;fr<Er.s.r;++fr)br=_r[fr]?' table:style-name="ro'+_r[fr].ods+'"':"",mr.push("        <table:table-row"+br+`></table:table-row>
`);for(;fr<=Er.e.r;++fr){for(br=_r[fr]?' table:style-name="ro'+_r[fr].ods+'"':"",mr.push("        <table:table-row"+br+`>
`),xr=0;xr<Er.s.c;++xr)mr.push(or);for(;xr<=Er.e.c;++xr){var jr=!1,wr={},Sr="";for(gr=0;gr!=vr.length;++gr)if(!(vr[gr].s.c>xr)&&!(vr[gr].s.r>fr)&&!(vr[gr].e.c<xr)&&!(vr[gr].e.r<fr)){(vr[gr].s.c!=xr||vr[gr].s.r!=fr)&&(jr=!0),wr["table:number-columns-spanned"]=vr[gr].e.c-vr[gr].s.c+1,wr["table:number-rows-spanned"]=vr[gr].e.r-vr[gr].s.r+1;break}if(jr){mr.push(lr);continue}var Tr=encode_cell({r:fr,c:xr}),Rr=yr?(dr[fr]||[])[xr]:dr[Tr];if(Rr&&Rr.f&&(wr["table:formula"]=escapexml(csf_to_ods_formula(Rr.f)),Rr.F&&Rr.F.slice(0,Tr.length)==Tr)){var Nr=decode_range(Rr.F);wr["table:number-matrix-columns-spanned"]=Nr.e.c-Nr.s.c+1,wr["table:number-matrix-rows-spanned"]=Nr.e.r-Nr.s.r+1}if(!Rr){mr.push(or);continue}switch(Rr.t){case"b":Sr=Rr.v?"TRUE":"FALSE",wr["office:value-type"]="boolean",wr["office:boolean-value"]=Rr.v?"true":"false";break;case"n":Sr=Rr.w||String(Rr.v||0),wr["office:value-type"]="float",wr["office:value"]=Rr.v||0;break;case"s":case"str":Sr=Rr.v==null?"":Rr.v,wr["office:value-type"]="string";break;case"d":Sr=Rr.w||parseDate(Rr.v).toISOString(),wr["office:value-type"]="date",wr["office:date-value"]=parseDate(Rr.v).toISOString(),wr["table:style-name"]="ce1";break;default:mr.push(or);continue}var Cr=ar(Sr);if(Rr.l&&Rr.l.Target){var kr=Rr.l.Target;kr=kr.charAt(0)=="#"?"#"+csf_to_ods_3D(kr.slice(1)):kr,kr.charAt(0)!="#"&&!kr.match(/^\w+:/)&&(kr="../"+kr),Cr=writextag("text:a",Cr,{"xlink:href":kr.replace(/&/g,"&amp;")})}mr.push("          "+writextag("table:table-cell",writextag("text:p",Cr,{}),wr)+`
`)}mr.push(`        </table:table-row>
`)}return mr.push(`      </table:table>
`),mr.join("")},ur=function(dr,hr){dr.push(` <office:automatic-styles>
`),dr.push(`  <number:date-style style:name="N37" number:automatic-order="true">
`),dr.push(`   <number:month number:style="long"/>
`),dr.push(`   <number:text>/</number:text>
`),dr.push(`   <number:day number:style="long"/>
`),dr.push(`   <number:text>/</number:text>
`),dr.push(`   <number:year/>
`),dr.push(`  </number:date-style>
`);var pr=0;hr.SheetNames.map(function(fr){return hr.Sheets[fr]}).forEach(function(fr){if(fr&&fr["!cols"]){for(var xr=0;xr<fr["!cols"].length;++xr)if(fr["!cols"][xr]){var Er=fr["!cols"][xr];if(Er.width==null&&Er.wpx==null&&Er.wch==null)continue;process_col(Er),Er.ods=pr;var vr=fr["!cols"][xr].wpx+"px";dr.push('  <style:style style:name="co'+pr+`" style:family="table-column">
`),dr.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+vr+`"/>
`),dr.push(`  </style:style>
`),++pr}}});var mr=0;hr.SheetNames.map(function(fr){return hr.Sheets[fr]}).forEach(function(fr){if(fr&&fr["!rows"]){for(var xr=0;xr<fr["!rows"].length;++xr)if(fr["!rows"][xr]){fr["!rows"][xr].ods=mr;var Er=fr["!rows"][xr].hpx+"px";dr.push('  <style:style style:name="ro'+mr+`" style:family="table-row">
`),dr.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+Er+`"/>
`),dr.push(`  </style:style>
`),++mr}}}),dr.push(`  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">
`),dr.push(`   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>
`),dr.push(`  </style:style>
`),dr.push(`  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>
`),dr.push(` </office:automatic-styles>
`)};return function(hr,pr){var mr=[XML_HEADER],fr=wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),xr=wxt_helper({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});pr.bookType=="fods"?(mr.push("<office:document"+fr+xr+`>
`),mr.push(write_meta_ods().replace(/office:document-meta/g,"office:meta"))):mr.push("<office:document-content"+fr+`>
`),ur(mr,hr),mr.push(`  <office:body>
`),mr.push(`    <office:spreadsheet>
`);for(var Er=0;Er!=hr.SheetNames.length;++Er)mr.push(cr(hr.Sheets[hr.SheetNames[Er]],hr,Er));return mr.push(`    </office:spreadsheet>
`),mr.push(`  </office:body>
`),pr.bookType=="fods"?mr.push("</office:document>"):mr.push("</office:document-content>"),mr.join("")}}();function write_ods(ar,or){if(or.bookType=="fods")return write_content_ods(ar,or);var lr=zip_new(),cr="",ur=[],dr=[];return cr="mimetype",zip_add_file(lr,cr,"application/vnd.oasis.opendocument.spreadsheet"),cr="content.xml",zip_add_file(lr,cr,write_content_ods(ar,or)),ur.push([cr,"text/xml"]),dr.push([cr,"ContentFile"]),cr="styles.xml",zip_add_file(lr,cr,write_styles_ods(ar,or)),ur.push([cr,"text/xml"]),dr.push([cr,"StylesFile"]),cr="meta.xml",zip_add_file(lr,cr,XML_HEADER+write_meta_ods()),ur.push([cr,"text/xml"]),dr.push([cr,"MetadataFile"]),cr="manifest.rdf",zip_add_file(lr,cr,write_rdf(dr)),ur.push([cr,"application/rdf+xml"]),cr="META-INF/manifest.xml",zip_add_file(lr,cr,write_manifest(ur)),lr}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function u8_to_dataview(ar){return new DataView(ar.buffer,ar.byteOffset,ar.byteLength)}function stru8(ar){return typeof TextEncoder<"u"?new TextEncoder().encode(ar):s2a(utf8write(ar))}function u8contains(ar,or){e:for(var lr=0;lr<=ar.length-or.length;++lr){for(var cr=0;cr<or.length;++cr)if(ar[lr+cr]!=or[cr])continue e;return!0}return!1}function u8concat(ar){var or=ar.reduce(function(ur,dr){return ur+dr.length},0),lr=new Uint8Array(or),cr=0;return ar.forEach(function(ur){lr.set(ur,cr),cr+=ur.length}),lr}function writeDecimal128LE(ar,or,lr){var cr=Math.floor(lr==0?0:Math.LOG10E*Math.log(Math.abs(lr)))+6176-20,ur=lr/Math.pow(10,cr-6176);ar[or+15]|=cr>>7,ar[or+14]|=(cr&127)<<1;for(var dr=0;ur>=1;++dr,ur/=256)ar[or+dr]=ur&255;ar[or+15]|=lr>=0?0:128}function parse_varint49(ar,or){var lr=or?or[0]:0,cr=ar[lr]&127;e:if(ar[lr++]>=128&&(cr|=(ar[lr]&127)<<7,ar[lr++]<128||(cr|=(ar[lr]&127)<<14,ar[lr++]<128)||(cr|=(ar[lr]&127)<<21,ar[lr++]<128)||(cr+=(ar[lr]&127)*Math.pow(2,28),++lr,ar[lr++]<128)||(cr+=(ar[lr]&127)*Math.pow(2,35),++lr,ar[lr++]<128)||(cr+=(ar[lr]&127)*Math.pow(2,42),++lr,ar[lr++]<128)))break e;return or&&(or[0]=lr),cr}function write_varint49(ar){var or=new Uint8Array(7);or[0]=ar&127;var lr=1;e:if(ar>127){if(or[lr-1]|=128,or[lr]=ar>>7&127,++lr,ar<=16383||(or[lr-1]|=128,or[lr]=ar>>14&127,++lr,ar<=2097151)||(or[lr-1]|=128,or[lr]=ar>>21&127,++lr,ar<=268435455)||(or[lr-1]|=128,or[lr]=ar/256>>>21&127,++lr,ar<=34359738367)||(or[lr-1]|=128,or[lr]=ar/65536>>>21&127,++lr,ar<=4398046511103))break e;or[lr-1]|=128,or[lr]=ar/16777216>>>21&127,++lr}return or.slice(0,lr)}function varint_to_i32(ar){var or=0,lr=ar[or]&127;e:if(ar[or++]>=128){if(lr|=(ar[or]&127)<<7,ar[or++]<128||(lr|=(ar[or]&127)<<14,ar[or++]<128)||(lr|=(ar[or]&127)<<21,ar[or++]<128))break e;lr|=(ar[or]&127)<<28}return lr}function parse_shallow(ar){for(var or=[],lr=[0];lr[0]<ar.length;){var cr=lr[0],ur=parse_varint49(ar,lr),dr=ur&7;ur=Math.floor(ur/8);var hr=0,pr;if(ur==0)break;switch(dr){case 0:{for(var mr=lr[0];ar[lr[0]++]>=128;);pr=ar.slice(mr,lr[0])}break;case 5:hr=4,pr=ar.slice(lr[0],lr[0]+hr),lr[0]+=hr;break;case 1:hr=8,pr=ar.slice(lr[0],lr[0]+hr),lr[0]+=hr;break;case 2:hr=parse_varint49(ar,lr),pr=ar.slice(lr[0],lr[0]+hr),lr[0]+=hr;break;case 3:case 4:default:throw new Error("PB Type ".concat(dr," for Field ").concat(ur," at offset ").concat(cr))}var fr={data:pr,type:dr};or[ur]==null?or[ur]=[fr]:or[ur].push(fr)}return or}function write_shallow(ar){var or=[];return ar.forEach(function(lr,cr){lr.forEach(function(ur){ur.data&&(or.push(write_varint49(cr*8+ur.type)),ur.type==2&&or.push(write_varint49(ur.data.length)),or.push(ur.data))})}),u8concat(or)}function parse_iwa_file(ar){for(var or,lr=[],cr=[0];cr[0]<ar.length;){var ur=parse_varint49(ar,cr),dr=parse_shallow(ar.slice(cr[0],cr[0]+ur));cr[0]+=ur;var hr={id:varint_to_i32(dr[1][0].data),messages:[]};dr[2].forEach(function(pr){var mr=parse_shallow(pr.data),fr=varint_to_i32(mr[3][0].data);hr.messages.push({meta:mr,data:ar.slice(cr[0],cr[0]+fr)}),cr[0]+=fr}),(or=dr[3])!=null&&or[0]&&(hr.merge=varint_to_i32(dr[3][0].data)>>>0>0),lr.push(hr)}return lr}function write_iwa_file(ar){var or=[];return ar.forEach(function(lr){var cr=[];cr[1]=[{data:write_varint49(lr.id),type:0}],cr[2]=[],lr.merge!=null&&(cr[3]=[{data:write_varint49(+!!lr.merge),type:0}]);var ur=[];lr.messages.forEach(function(hr){ur.push(hr.data),hr.meta[3]=[{type:0,data:write_varint49(hr.data.length)}],cr[2].push({data:write_shallow(hr.meta),type:2})});var dr=write_shallow(cr);or.push(write_varint49(dr.length)),or.push(dr),ur.forEach(function(hr){return or.push(hr)})}),u8concat(or)}function parse_snappy_chunk(ar,or){if(ar!=0)throw new Error("Unexpected Snappy chunk type ".concat(ar));for(var lr=[0],cr=parse_varint49(or,lr),ur=[];lr[0]<or.length;){var dr=or[lr[0]]&3;if(dr==0){var hr=or[lr[0]++]>>2;if(hr<60)++hr;else{var pr=hr-59;hr=or[lr[0]],pr>1&&(hr|=or[lr[0]+1]<<8),pr>2&&(hr|=or[lr[0]+2]<<16),pr>3&&(hr|=or[lr[0]+3]<<24),hr>>>=0,hr++,lr[0]+=pr}ur.push(or.slice(lr[0],lr[0]+hr)),lr[0]+=hr;continue}else{var mr=0,fr=0;if(dr==1?(fr=(or[lr[0]]>>2&7)+4,mr=(or[lr[0]++]&224)<<3,mr|=or[lr[0]++]):(fr=(or[lr[0]++]>>2)+1,dr==2?(mr=or[lr[0]]|or[lr[0]+1]<<8,lr[0]+=2):(mr=(or[lr[0]]|or[lr[0]+1]<<8|or[lr[0]+2]<<16|or[lr[0]+3]<<24)>>>0,lr[0]+=4)),ur=[u8concat(ur)],mr==0)throw new Error("Invalid offset 0");if(mr>ur[0].length)throw new Error("Invalid offset beyond length");if(fr>=mr)for(ur.push(ur[0].slice(-mr)),fr-=mr;fr>=ur[ur.length-1].length;)ur.push(ur[ur.length-1]),fr-=ur[ur.length-1].length;ur.push(ur[0].slice(-mr,-mr+fr))}}var xr=u8concat(ur);if(xr.length!=cr)throw new Error("Unexpected length: ".concat(xr.length," != ").concat(cr));return xr}function decompress_iwa_file(ar){for(var or=[],lr=0;lr<ar.length;){var cr=ar[lr++],ur=ar[lr]|ar[lr+1]<<8|ar[lr+2]<<16;lr+=3,or.push(parse_snappy_chunk(cr,ar.slice(lr,lr+ur))),lr+=ur}if(lr!==ar.length)throw new Error("data is not a valid framed stream!");return u8concat(or)}function compress_iwa_file(ar){for(var or=[],lr=0;lr<ar.length;){var cr=Math.min(ar.length-lr,268435455),ur=new Uint8Array(4);or.push(ur);var dr=write_varint49(cr),hr=dr.length;or.push(dr),cr<=60?(hr++,or.push(new Uint8Array([cr-1<<2]))):cr<=256?(hr+=2,or.push(new Uint8Array([240,cr-1&255]))):cr<=65536?(hr+=3,or.push(new Uint8Array([244,cr-1&255,cr-1>>8&255]))):cr<=16777216?(hr+=4,or.push(new Uint8Array([248,cr-1&255,cr-1>>8&255,cr-1>>16&255]))):cr<=4294967296&&(hr+=5,or.push(new Uint8Array([252,cr-1&255,cr-1>>8&255,cr-1>>16&255,cr-1>>>24&255]))),or.push(ar.slice(lr,lr+cr)),hr+=cr,ur[0]=0,ur[1]=hr&255,ur[2]=hr>>8&255,ur[3]=hr>>16&255,lr+=cr}return u8concat(or)}function write_new_storage(ar,or){var lr=new Uint8Array(32),cr=u8_to_dataview(lr),ur=12,dr=0;switch(lr[0]=5,ar.t){case"n":lr[1]=2,writeDecimal128LE(lr,ur,ar.v),dr|=1,ur+=16;break;case"b":lr[1]=6,cr.setFloat64(ur,ar.v?1:0,!0),dr|=2,ur+=8;break;case"s":if(or.indexOf(ar.v)==-1)throw new Error("Value ".concat(ar.v," missing from SST!"));lr[1]=3,cr.setUint32(ur,or.indexOf(ar.v),!0),dr|=8,ur+=4;break;default:throw"unsupported cell type "+ar.t}return cr.setUint32(8,dr,!0),lr.slice(0,ur)}function write_old_storage(ar,or){var lr=new Uint8Array(32),cr=u8_to_dataview(lr),ur=12,dr=0;switch(lr[0]=3,ar.t){case"n":lr[2]=2,cr.setFloat64(ur,ar.v,!0),dr|=32,ur+=8;break;case"b":lr[2]=6,cr.setFloat64(ur,ar.v?1:0,!0),dr|=32,ur+=8;break;case"s":if(or.indexOf(ar.v)==-1)throw new Error("Value ".concat(ar.v," missing from SST!"));lr[2]=3,cr.setUint32(ur,or.indexOf(ar.v),!0),dr|=16,ur+=4;break;default:throw"unsupported cell type "+ar.t}return cr.setUint32(4,dr,!0),lr.slice(0,ur)}function parse_TSP_Reference(ar){var or=parse_shallow(ar);return parse_varint49(or[1][0].data)}function write_tile_row(ar,or,lr){var cr,ur,dr,hr;if(!((cr=ar[6])!=null&&cr[0])||!((ur=ar[7])!=null&&ur[0]))throw"Mutation only works on post-BNC storages!";var pr=((hr=(dr=ar[8])==null?void 0:dr[0])==null?void 0:hr.data)&&varint_to_i32(ar[8][0].data)>0||!1;if(pr)throw"Math only works with normal offsets";for(var mr=0,fr=u8_to_dataview(ar[7][0].data),xr=0,Er=[],vr=u8_to_dataview(ar[4][0].data),gr=0,yr=[],br=0;br<or.length;++br){if(or[br]==null){fr.setUint16(br*2,65535,!0),vr.setUint16(br*2,65535);continue}fr.setUint16(br*2,xr,!0),vr.setUint16(br*2,gr,!0);var _r,jr;switch(typeof or[br]){case"string":_r=write_new_storage({t:"s",v:or[br]},lr),jr=write_old_storage({t:"s",v:or[br]},lr);break;case"number":_r=write_new_storage({t:"n",v:or[br]},lr),jr=write_old_storage({t:"n",v:or[br]},lr);break;case"boolean":_r=write_new_storage({t:"b",v:or[br]},lr),jr=write_old_storage({t:"b",v:or[br]},lr);break;default:throw new Error("Unsupported value "+or[br])}Er.push(_r),xr+=_r.length,yr.push(jr),gr+=jr.length,++mr}for(ar[2][0].data=write_varint49(mr);br<ar[7][0].data.length/2;++br)fr.setUint16(br*2,65535,!0),vr.setUint16(br*2,65535,!0);return ar[6][0].data=u8concat(Er),ar[3][0].data=u8concat(yr),mr}function write_numbers_iwa(ar,or){if(!or||!or.numbers)throw new Error("Must pass a `numbers` option -- check the README");var lr=ar.Sheets[ar.SheetNames[0]];ar.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var cr=decode_range(lr["!ref"]);cr.s.r=cr.s.c=0;var ur=!1;cr.e.c>9&&(ur=!0,cr.e.c=9),cr.e.r>49&&(ur=!0,cr.e.r=49),ur&&console.error("The Numbers writer is currently limited to ".concat(encode_range(cr)));var dr=sheet_to_json(lr,{range:cr,header:1}),hr=["~Sh33tJ5~"];dr.forEach(function(Dr){return Dr.forEach(function(Pr){typeof Pr=="string"&&hr.push(Pr)})});var pr={},mr=[],fr=CFB.read(or.numbers,{type:"base64"});fr.FileIndex.map(function(Dr,Pr){return[Dr,fr.FullPaths[Pr]]}).forEach(function(Dr){var Pr=Dr[0],Mr=Dr[1];if(Pr.type==2&&Pr.name.match(/\.iwa/)){var Br=Pr.content,Xr=decompress_iwa_file(Br),Wr=parse_iwa_file(Xr);Wr.forEach(function(ss){mr.push(ss.id),pr[ss.id]={deps:[],location:Mr,type:varint_to_i32(ss.messages[0].meta[1][0].data)}})}}),mr.sort(function(Dr,Pr){return Dr-Pr});var xr=mr.filter(function(Dr){return Dr>1}).map(function(Dr){return[Dr,write_varint49(Dr)]});fr.FileIndex.map(function(Dr,Pr){return[Dr,fr.FullPaths[Pr]]}).forEach(function(Dr){var Pr=Dr[0];if(Dr[1],!!Pr.name.match(/\.iwa/)){var Mr=parse_iwa_file(decompress_iwa_file(Pr.content));Mr.forEach(function(Br){Br.messages.forEach(function(Xr){xr.forEach(function(Wr){Br.messages.some(function(ss){return varint_to_i32(ss.meta[1][0].data)!=11006&&u8contains(ss.data,Wr[1])})&&pr[Wr[0]].deps.push(Br.id)})})})}});for(var Er=CFB.find(fr,pr[1].location),vr=parse_iwa_file(decompress_iwa_file(Er.content)),gr,yr=0;yr<vr.length;++yr){var br=vr[yr];br.id==1&&(gr=br)}var _r=parse_TSP_Reference(parse_shallow(gr.messages[0].data)[1][0].data);for(Er=CFB.find(fr,pr[_r].location),vr=parse_iwa_file(decompress_iwa_file(Er.content)),yr=0;yr<vr.length;++yr)br=vr[yr],br.id==_r&&(gr=br);for(_r=parse_TSP_Reference(parse_shallow(gr.messages[0].data)[2][0].data),Er=CFB.find(fr,pr[_r].location),vr=parse_iwa_file(decompress_iwa_file(Er.content)),yr=0;yr<vr.length;++yr)br=vr[yr],br.id==_r&&(gr=br);for(_r=parse_TSP_Reference(parse_shallow(gr.messages[0].data)[2][0].data),Er=CFB.find(fr,pr[_r].location),vr=parse_iwa_file(decompress_iwa_file(Er.content)),yr=0;yr<vr.length;++yr)br=vr[yr],br.id==_r&&(gr=br);var jr=parse_shallow(gr.messages[0].data);{jr[6][0].data=write_varint49(cr.e.r+1),jr[7][0].data=write_varint49(cr.e.c+1);var wr=parse_TSP_Reference(jr[46][0].data),Sr=CFB.find(fr,pr[wr].location),Tr=parse_iwa_file(decompress_iwa_file(Sr.content));{for(var Rr=0;Rr<Tr.length&&Tr[Rr].id!=wr;++Rr);if(Tr[Rr].id!=wr)throw"Bad ColumnRowUIDMapArchive";var Nr=parse_shallow(Tr[Rr].messages[0].data);Nr[1]=[],Nr[2]=[],Nr[3]=[];for(var Cr=0;Cr<=cr.e.c;++Cr){var kr=[];kr[1]=kr[2]=[{type:0,data:write_varint49(Cr+420690)}],Nr[1].push({type:2,data:write_shallow(kr)}),Nr[2].push({type:0,data:write_varint49(Cr)}),Nr[3].push({type:0,data:write_varint49(Cr)})}Nr[4]=[],Nr[5]=[],Nr[6]=[];for(var Ar=0;Ar<=cr.e.r;++Ar)kr=[],kr[1]=kr[2]=[{type:0,data:write_varint49(Ar+726270)}],Nr[4].push({type:2,data:write_shallow(kr)}),Nr[5].push({type:0,data:write_varint49(Ar)}),Nr[6].push({type:0,data:write_varint49(Ar)});Tr[Rr].messages[0].data=write_shallow(Nr)}Sr.content=compress_iwa_file(write_iwa_file(Tr)),Sr.size=Sr.content.length,delete jr[46];var Or=parse_shallow(jr[4][0].data);{Or[7][0].data=write_varint49(cr.e.r+1);var Lr=parse_shallow(Or[1][0].data),Fr=parse_TSP_Reference(Lr[2][0].data);Sr=CFB.find(fr,pr[Fr].location),Tr=parse_iwa_file(decompress_iwa_file(Sr.content));{if(Tr[0].id!=Fr)throw"Bad HeaderStorageBucket";var Hr=parse_shallow(Tr[0].messages[0].data);for(Ar=0;Ar<dr.length;++Ar){var Kr=parse_shallow(Hr[2][0].data);Kr[1][0].data=write_varint49(Ar),Kr[4][0].data=write_varint49(dr[Ar].length),Hr[2][Ar]={type:Hr[2][0].type,data:write_shallow(Kr)}}Tr[0].messages[0].data=write_shallow(Hr)}Sr.content=compress_iwa_file(write_iwa_file(Tr)),Sr.size=Sr.content.length;var Gr=parse_TSP_Reference(Or[2][0].data);Sr=CFB.find(fr,pr[Gr].location),Tr=parse_iwa_file(decompress_iwa_file(Sr.content));{if(Tr[0].id!=Gr)throw"Bad HeaderStorageBucket";for(Hr=parse_shallow(Tr[0].messages[0].data),Cr=0;Cr<=cr.e.c;++Cr)Kr=parse_shallow(Hr[2][0].data),Kr[1][0].data=write_varint49(Cr),Kr[4][0].data=write_varint49(cr.e.r+1),Hr[2][Cr]={type:Hr[2][0].type,data:write_shallow(Kr)};Tr[0].messages[0].data=write_shallow(Hr)}Sr.content=compress_iwa_file(write_iwa_file(Tr)),Sr.size=Sr.content.length;var Zr=parse_TSP_Reference(Or[4][0].data);(function(){for(var Dr=CFB.find(fr,pr[Zr].location),Pr=parse_iwa_file(decompress_iwa_file(Dr.content)),Mr,Br=0;Br<Pr.length;++Br){var Xr=Pr[Br];Xr.id==Zr&&(Mr=Xr)}var Wr=parse_shallow(Mr.messages[0].data);{Wr[3]=[];var ss=[];hr.forEach(function(fs,bs){ss[1]=[{type:0,data:write_varint49(bs)}],ss[2]=[{type:0,data:write_varint49(1)}],ss[3]=[{type:2,data:stru8(fs)}],Wr[3].push({type:2,data:write_shallow(ss)})})}Mr.messages[0].data=write_shallow(Wr);var ds=write_iwa_file(Pr),ns=compress_iwa_file(ds);Dr.content=ns,Dr.size=Dr.content.length})();var Jr=parse_shallow(Or[3][0].data);{var os=Jr[1][0];delete Jr[2];var Ur=parse_shallow(os.data);{var Vr=parse_TSP_Reference(Ur[2][0].data);(function(){for(var Dr=CFB.find(fr,pr[Vr].location),Pr=parse_iwa_file(decompress_iwa_file(Dr.content)),Mr,Br=0;Br<Pr.length;++Br){var Xr=Pr[Br];Xr.id==Vr&&(Mr=Xr)}var Wr=parse_shallow(Mr.messages[0].data);{delete Wr[6],delete Jr[7];var ss=new Uint8Array(Wr[5][0].data);Wr[5]=[];for(var ds=0,ns=0;ns<=cr.e.r;++ns){var fs=parse_shallow(ss);ds+=write_tile_row(fs,dr[ns],hr),fs[1][0].data=write_varint49(ns),Wr[5].push({data:write_shallow(fs),type:2})}Wr[1]=[{type:0,data:write_varint49(cr.e.c+1)}],Wr[2]=[{type:0,data:write_varint49(cr.e.r+1)}],Wr[3]=[{type:0,data:write_varint49(ds)}],Wr[4]=[{type:0,data:write_varint49(cr.e.r+1)}]}Mr.messages[0].data=write_shallow(Wr);var bs=write_iwa_file(Pr),Es=compress_iwa_file(bs);Dr.content=Es,Dr.size=Dr.content.length})()}os.data=write_shallow(Ur)}Or[3][0].data=write_shallow(Jr)}jr[4][0].data=write_shallow(Or)}gr.messages[0].data=write_shallow(jr);var es=write_iwa_file(vr),Ir=compress_iwa_file(es);return Er.content=Ir,Er.size=Er.content.length,fr}function fix_opts_func(ar){return function(lr){for(var cr=0;cr!=ar.length;++cr){var ur=ar[cr];lr[ur[0]]===void 0&&(lr[ur[0]]=ur[1]),ur[2]==="n"&&(lr[ur[0]]=Number(lr[ur[0]]))}}}function fix_write_opts(ar){fix_opts_func([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(ar)}function write_zip(ar,or){return or.bookType=="ods"?write_ods(ar,or):or.bookType=="numbers"?write_numbers_iwa(ar,or):or.bookType=="xlsb"?write_zip_xlsxb(ar,or):write_zip_xlsx(ar,or)}function write_zip_xlsxb(ar,or){_shapeid=1024,ar&&!ar.SSF&&(ar.SSF=dup(table_fmt)),ar&&ar.SSF&&(make_ssf(),SSF_load_table(ar.SSF),or.revssf=evert_num(ar.SSF),or.revssf[ar.SSF[65535]]=0,or.ssf=ar.SSF),or.rels={},or.wbrels={},or.Strings=[],or.Strings.Count=0,or.Strings.Unique=0,browser_has_Map?or.revStrings=new Map:(or.revStrings={},or.revStrings.foo=[],delete or.revStrings.foo);var lr=or.bookType=="xlsb"?"bin":"xml",cr=VBAFMTS.indexOf(or.bookType)>-1,ur=new_ct();fix_write_opts(or=or||{});var dr=zip_new(),hr="",pr=0;if(or.cellXfs=[],get_cell_style(or.cellXfs,{},{revssf:{General:0}}),ar.Props||(ar.Props={}),hr="docProps/core.xml",zip_add_file(dr,hr,write_core_props(ar.Props,or)),ur.coreprops.push(hr),add_rels(or.rels,2,hr,RELS.CORE_PROPS),hr="docProps/app.xml",!(ar.Props&&ar.Props.SheetNames))if(!ar.Workbook||!ar.Workbook.Sheets)ar.Props.SheetNames=ar.SheetNames;else{for(var mr=[],fr=0;fr<ar.SheetNames.length;++fr)(ar.Workbook.Sheets[fr]||{}).Hidden!=2&&mr.push(ar.SheetNames[fr]);ar.Props.SheetNames=mr}for(ar.Props.Worksheets=ar.Props.SheetNames.length,zip_add_file(dr,hr,write_ext_props(ar.Props)),ur.extprops.push(hr),add_rels(or.rels,3,hr,RELS.EXT_PROPS),ar.Custprops!==ar.Props&&keys(ar.Custprops||{}).length>0&&(hr="docProps/custom.xml",zip_add_file(dr,hr,write_cust_props(ar.Custprops)),ur.custprops.push(hr),add_rels(or.rels,4,hr,RELS.CUST_PROPS)),pr=1;pr<=ar.SheetNames.length;++pr){var xr={"!id":{}},Er=ar.Sheets[ar.SheetNames[pr-1]],vr=(Er||{})["!type"]||"sheet";switch(vr){case"chart":default:hr="xl/worksheets/sheet"+pr+"."+lr,zip_add_file(dr,hr,write_ws(pr-1,hr,or,ar,xr)),ur.sheets.push(hr),add_rels(or.wbrels,-1,"worksheets/sheet"+pr+"."+lr,RELS.WS[0])}if(Er){var gr=Er["!comments"],yr=!1,br="";gr&&gr.length>0&&(br="xl/comments"+pr+"."+lr,zip_add_file(dr,br,write_cmnt(gr,br)),ur.comments.push(br),add_rels(xr,-1,"../comments"+pr+"."+lr,RELS.CMNT),yr=!0),Er["!legacy"]&&yr&&zip_add_file(dr,"xl/drawings/vmlDrawing"+pr+".vml",write_comments_vml(pr,Er["!comments"])),delete Er["!comments"],delete Er["!legacy"]}xr["!id"].rId1&&zip_add_file(dr,get_rels_path(hr),write_rels(xr))}return or.Strings!=null&&or.Strings.length>0&&(hr="xl/sharedStrings."+lr,zip_add_file(dr,hr,write_sst(or.Strings,hr,or)),ur.strs.push(hr),add_rels(or.wbrels,-1,"sharedStrings."+lr,RELS.SST)),hr="xl/workbook."+lr,zip_add_file(dr,hr,write_wb(ar,hr)),ur.workbooks.push(hr),add_rels(or.rels,1,hr,RELS.WB),hr="xl/theme/theme1.xml",zip_add_file(dr,hr,write_theme(ar.Themes,or)),ur.themes.push(hr),add_rels(or.wbrels,-1,"theme/theme1.xml",RELS.THEME),hr="xl/styles."+lr,zip_add_file(dr,hr,write_sty(ar,hr,or)),ur.styles.push(hr),add_rels(or.wbrels,-1,"styles."+lr,RELS.STY),ar.vbaraw&&cr&&(hr="xl/vbaProject.bin",zip_add_file(dr,hr,ar.vbaraw),ur.vba.push(hr),add_rels(or.wbrels,-1,"vbaProject.bin",RELS.VBA)),hr="xl/metadata."+lr,zip_add_file(dr,hr,write_xlmeta(hr)),ur.metadata.push(hr),add_rels(or.wbrels,-1,"metadata."+lr,RELS.XLMETA),zip_add_file(dr,"[Content_Types].xml",write_ct(ur,or)),zip_add_file(dr,"_rels/.rels",write_rels(or.rels)),zip_add_file(dr,"xl/_rels/workbook."+lr+".rels",write_rels(or.wbrels)),delete or.revssf,delete or.ssf,dr}function write_zip_xlsx(ar,or){_shapeid=1024,ar&&!ar.SSF&&(ar.SSF=dup(table_fmt)),ar&&ar.SSF&&(make_ssf(),SSF_load_table(ar.SSF),or.revssf=evert_num(ar.SSF),or.revssf[ar.SSF[65535]]=0,or.ssf=ar.SSF),or.rels={},or.wbrels={},or.Strings=[],or.Strings.Count=0,or.Strings.Unique=0,browser_has_Map?or.revStrings=new Map:(or.revStrings={},or.revStrings.foo=[],delete or.revStrings.foo);var lr="xml",cr=VBAFMTS.indexOf(or.bookType)>-1,ur=new_ct();fix_write_opts(or=or||{});var dr=zip_new(),hr="",pr=0;if(or.cellXfs=[],get_cell_style(or.cellXfs,{},{revssf:{General:0}}),ar.Props||(ar.Props={}),hr="docProps/core.xml",zip_add_file(dr,hr,write_core_props(ar.Props,or)),ur.coreprops.push(hr),add_rels(or.rels,2,hr,RELS.CORE_PROPS),hr="docProps/app.xml",!(ar.Props&&ar.Props.SheetNames))if(!ar.Workbook||!ar.Workbook.Sheets)ar.Props.SheetNames=ar.SheetNames;else{for(var mr=[],fr=0;fr<ar.SheetNames.length;++fr)(ar.Workbook.Sheets[fr]||{}).Hidden!=2&&mr.push(ar.SheetNames[fr]);ar.Props.SheetNames=mr}ar.Props.Worksheets=ar.Props.SheetNames.length,zip_add_file(dr,hr,write_ext_props(ar.Props)),ur.extprops.push(hr),add_rels(or.rels,3,hr,RELS.EXT_PROPS),ar.Custprops!==ar.Props&&keys(ar.Custprops||{}).length>0&&(hr="docProps/custom.xml",zip_add_file(dr,hr,write_cust_props(ar.Custprops)),ur.custprops.push(hr),add_rels(or.rels,4,hr,RELS.CUST_PROPS));var xr=["SheetJ5"];for(or.tcid=0,pr=1;pr<=ar.SheetNames.length;++pr){var Er={"!id":{}},vr=ar.Sheets[ar.SheetNames[pr-1]],gr=(vr||{})["!type"]||"sheet";switch(gr){case"chart":default:hr="xl/worksheets/sheet"+pr+"."+lr,zip_add_file(dr,hr,write_ws_xml(pr-1,or,ar,Er)),ur.sheets.push(hr),add_rels(or.wbrels,-1,"worksheets/sheet"+pr+"."+lr,RELS.WS[0])}if(vr){var yr=vr["!comments"],br=!1,_r="";if(yr&&yr.length>0){var jr=!1;yr.forEach(function(wr){wr[1].forEach(function(Sr){Sr.T==!0&&(jr=!0)})}),jr&&(_r="xl/threadedComments/threadedComment"+pr+"."+lr,zip_add_file(dr,_r,write_tcmnt_xml(yr,xr,or)),ur.threadedcomments.push(_r),add_rels(Er,-1,"../threadedComments/threadedComment"+pr+"."+lr,RELS.TCMNT)),_r="xl/comments"+pr+"."+lr,zip_add_file(dr,_r,write_comments_xml(yr)),ur.comments.push(_r),add_rels(Er,-1,"../comments"+pr+"."+lr,RELS.CMNT),br=!0}vr["!legacy"]&&br&&zip_add_file(dr,"xl/drawings/vmlDrawing"+pr+".vml",write_comments_vml(pr,vr["!comments"])),delete vr["!comments"],delete vr["!legacy"]}Er["!id"].rId1&&zip_add_file(dr,get_rels_path(hr),write_rels(Er))}return or.Strings!=null&&or.Strings.length>0&&(hr="xl/sharedStrings."+lr,zip_add_file(dr,hr,write_sst_xml(or.Strings,or)),ur.strs.push(hr),add_rels(or.wbrels,-1,"sharedStrings."+lr,RELS.SST)),hr="xl/workbook."+lr,zip_add_file(dr,hr,write_wb_xml(ar)),ur.workbooks.push(hr),add_rels(or.rels,1,hr,RELS.WB),hr="xl/theme/theme1.xml",zip_add_file(dr,hr,write_theme(ar.Themes,or)),ur.themes.push(hr),add_rels(or.wbrels,-1,"theme/theme1.xml",RELS.THEME),hr="xl/styles."+lr,zip_add_file(dr,hr,write_sty_xml(ar,or)),ur.styles.push(hr),add_rels(or.wbrels,-1,"styles."+lr,RELS.STY),ar.vbaraw&&cr&&(hr="xl/vbaProject.bin",zip_add_file(dr,hr,ar.vbaraw),ur.vba.push(hr),add_rels(or.wbrels,-1,"vbaProject.bin",RELS.VBA)),hr="xl/metadata."+lr,zip_add_file(dr,hr,write_xlmeta_xml()),ur.metadata.push(hr),add_rels(or.wbrels,-1,"metadata."+lr,RELS.XLMETA),xr.length>1&&(hr="xl/persons/person.xml",zip_add_file(dr,hr,write_people_xml(xr)),ur.people.push(hr),add_rels(or.wbrels,-1,"persons/person.xml",RELS.PEOPLE)),zip_add_file(dr,"[Content_Types].xml",write_ct(ur,or)),zip_add_file(dr,"_rels/.rels",write_rels(or.rels)),zip_add_file(dr,"xl/_rels/workbook."+lr+".rels",write_rels(or.wbrels)),delete or.revssf,delete or.ssf,dr}function firstbyte(ar,or){var lr="";switch((or||{}).type||"base64"){case"buffer":return[ar[0],ar[1],ar[2],ar[3],ar[4],ar[5],ar[6],ar[7]];case"base64":lr=Base64_decode(ar.slice(0,12));break;case"binary":lr=ar;break;case"array":return[ar[0],ar[1],ar[2],ar[3],ar[4],ar[5],ar[6],ar[7]];default:throw new Error("Unrecognized type "+(or&&or.type||"undefined"))}return[lr.charCodeAt(0),lr.charCodeAt(1),lr.charCodeAt(2),lr.charCodeAt(3),lr.charCodeAt(4),lr.charCodeAt(5),lr.charCodeAt(6),lr.charCodeAt(7)]}function write_cfb_ctr(ar,or){switch(or.type){case"base64":case"binary":break;case"buffer":case"array":or.type="";break;case"file":return write_dl(or.file,CFB.write(ar,{type:has_buf?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+or.bookType+"' files");default:throw new Error("Unrecognized type "+or.type)}return CFB.write(ar,or)}function write_zip_type(ar,or){var lr=dup(or||{}),cr=write_zip(ar,lr);return write_zip_denouement(cr,lr)}function write_zip_denouement(ar,or){var lr={},cr=has_buf?"nodebuffer":typeof Uint8Array<"u"?"array":"string";if(or.compression&&(lr.compression="DEFLATE"),or.password)lr.type=cr;else switch(or.type){case"base64":lr.type="base64";break;case"binary":lr.type="string";break;case"string":throw new Error("'string' output type invalid for '"+or.bookType+"' files");case"buffer":case"file":lr.type=cr;break;default:throw new Error("Unrecognized type "+or.type)}var ur=ar.FullPaths?CFB.write(ar,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[lr.type]||lr.type,compression:!!or.compression}):ar.generate(lr);if(typeof Deno<"u"&&typeof ur=="string"){if(or.type=="binary"||or.type=="base64")return ur;ur=new Uint8Array(s2ab(ur))}return or.password&&typeof encrypt_agile<"u"?write_cfb_ctr(encrypt_agile(ur,or.password),or):or.type==="file"?write_dl(or.file,ur):or.type=="string"?utf8read(ur):ur}function write_cfb_type(ar,or){var lr=or||{},cr=write_xlscfb(ar,lr);return write_cfb_ctr(cr,lr)}function write_string_type(ar,or,lr){lr||(lr="");var cr=lr+ar;switch(or.type){case"base64":return Base64_encode(utf8write(cr));case"binary":return utf8write(cr);case"string":return ar;case"file":return write_dl(or.file,cr,"utf8");case"buffer":return has_buf?Buffer_from(cr,"utf8"):typeof TextEncoder<"u"?new TextEncoder().encode(cr):write_string_type(cr,{type:"binary"}).split("").map(function(ur){return ur.charCodeAt(0)})}throw new Error("Unrecognized type "+or.type)}function write_stxt_type(ar,or){switch(or.type){case"base64":return Base64_encode(ar);case"binary":return ar;case"string":return ar;case"file":return write_dl(or.file,ar,"binary");case"buffer":return has_buf?Buffer_from(ar,"binary"):ar.split("").map(function(lr){return lr.charCodeAt(0)})}throw new Error("Unrecognized type "+or.type)}function write_binary_type(ar,or){switch(or.type){case"string":case"base64":case"binary":for(var lr="",cr=0;cr<ar.length;++cr)lr+=String.fromCharCode(ar[cr]);return or.type=="base64"?Base64_encode(lr):or.type=="string"?utf8read(lr):lr;case"file":return write_dl(or.file,ar);case"buffer":return ar;default:throw new Error("Unrecognized type "+or.type)}}function writeSync(ar,or){reset_cp(),check_wb(ar);var lr=dup(or||{});if(lr.cellStyles&&(lr.cellNF=!0,lr.sheetStubs=!0),lr.type=="array"){lr.type="binary";var cr=writeSync(ar,lr);return lr.type="array",s2ab(cr)}var ur=0;if(lr.sheet&&(typeof lr.sheet=="number"?ur=lr.sheet:ur=ar.SheetNames.indexOf(lr.sheet),!ar.SheetNames[ur]))throw new Error("Sheet not found: "+lr.sheet+" : "+typeof lr.sheet);switch(lr.bookType||"xlsb"){case"xml":case"xlml":return write_string_type(write_xlml(ar,lr),lr);case"slk":case"sylk":return write_string_type(SYLK.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"htm":case"html":return write_string_type(sheet_to_html(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"txt":return write_stxt_type(sheet_to_txt(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"csv":return write_string_type(sheet_to_csv(ar.Sheets[ar.SheetNames[ur]],lr),lr,"\uFEFF");case"dif":return write_string_type(DIF.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"dbf":return write_binary_type(DBF.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"prn":return write_string_type(PRN.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"rtf":return write_string_type(RTF.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"eth":return write_string_type(ETH.from_sheet(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"fods":return write_string_type(write_ods(ar,lr),lr);case"wk1":return write_binary_type(WK_.sheet_to_wk1(ar.Sheets[ar.SheetNames[ur]],lr),lr);case"wk3":return write_binary_type(WK_.book_to_wk3(ar,lr),lr);case"biff2":lr.biff||(lr.biff=2);case"biff3":lr.biff||(lr.biff=3);case"biff4":return lr.biff||(lr.biff=4),write_binary_type(write_biff_buf(ar,lr),lr);case"biff5":lr.biff||(lr.biff=5);case"biff8":case"xla":case"xls":return lr.biff||(lr.biff=8),write_cfb_type(ar,lr);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return write_zip_type(ar,lr);default:throw new Error("Unrecognized bookType |"+lr.bookType+"|")}}function make_json_row(ar,or,lr,cr,ur,dr,hr,pr){var mr=encode_row(lr),fr=pr.defval,xr=pr.raw||!Object.prototype.hasOwnProperty.call(pr,"raw"),Er=!0,vr=ur===1?[]:{};if(ur!==1)if(Object.defineProperty)try{Object.defineProperty(vr,"__rowNum__",{value:lr,enumerable:!1})}catch{vr.__rowNum__=lr}else vr.__rowNum__=lr;if(!hr||ar[lr])for(var gr=or.s.c;gr<=or.e.c;++gr){var yr=hr?ar[lr][gr]:ar[cr[gr]+mr];if(yr===void 0||yr.t===void 0){if(fr===void 0)continue;dr[gr]!=null&&(vr[dr[gr]]=fr);continue}var br=yr.v;switch(yr.t){case"z":if(br==null)break;continue;case"e":br=br==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+yr.t)}if(dr[gr]!=null){if(br==null)if(yr.t=="e"&&br===null)vr[dr[gr]]=null;else if(fr!==void 0)vr[dr[gr]]=fr;else if(xr&&br===null)vr[dr[gr]]=null;else continue;else vr[dr[gr]]=xr&&(yr.t!=="n"||yr.t==="n"&&pr.rawNumbers!==!1)?br:format_cell(yr,br,pr);br!=null&&(Er=!1)}}return{row:vr,isempty:Er}}function sheet_to_json(ar,or){if(ar==null||ar["!ref"]==null)return[];var lr={t:"n",v:0},cr=0,ur=1,dr=[],hr=0,pr="",mr={s:{r:0,c:0},e:{r:0,c:0}},fr=or||{},xr=fr.range!=null?fr.range:ar["!ref"];switch(fr.header===1?cr=1:fr.header==="A"?cr=2:Array.isArray(fr.header)?cr=3:fr.header==null&&(cr=0),typeof xr){case"string":mr=safe_decode_range(xr);break;case"number":mr=safe_decode_range(ar["!ref"]),mr.s.r=xr;break;default:mr=xr}cr>0&&(ur=0);var Er=encode_row(mr.s.r),vr=[],gr=[],yr=0,br=0,_r=Array.isArray(ar),jr=mr.s.r,wr=0,Sr={};_r&&!ar[jr]&&(ar[jr]=[]);var Tr=fr.skipHidden&&ar["!cols"]||[],Rr=fr.skipHidden&&ar["!rows"]||[];for(wr=mr.s.c;wr<=mr.e.c;++wr)if(!(Tr[wr]||{}).hidden)switch(vr[wr]=encode_col(wr),lr=_r?ar[jr][wr]:ar[vr[wr]+Er],cr){case 1:dr[wr]=wr-mr.s.c;break;case 2:dr[wr]=vr[wr];break;case 3:dr[wr]=fr.header[wr-mr.s.c];break;default:if(lr==null&&(lr={w:"__EMPTY",t:"s"}),pr=hr=format_cell(lr,null,fr),br=Sr[hr]||0,!br)Sr[hr]=1;else{do pr=hr+"_"+br++;while(Sr[pr]);Sr[hr]=br,Sr[pr]=1}dr[wr]=pr}for(jr=mr.s.r+ur;jr<=mr.e.r;++jr)if(!(Rr[jr]||{}).hidden){var Nr=make_json_row(ar,mr,jr,vr,cr,dr,_r,fr);(Nr.isempty===!1||(cr===1?fr.blankrows!==!1:fr.blankrows))&&(gr[yr++]=Nr.row)}return gr.length=yr,gr}var qreg=/"/g;function make_csv_row(ar,or,lr,cr,ur,dr,hr,pr){for(var mr=!0,fr=[],xr="",Er=encode_row(lr),vr=or.s.c;vr<=or.e.c;++vr)if(cr[vr]){var gr=pr.dense?(ar[lr]||[])[vr]:ar[cr[vr]+Er];if(gr==null)xr="";else if(gr.v!=null){mr=!1,xr=""+(pr.rawNumbers&&gr.t=="n"?gr.v:format_cell(gr,null,pr));for(var yr=0,br=0;yr!==xr.length;++yr)if((br=xr.charCodeAt(yr))===ur||br===dr||br===34||pr.forceQuotes){xr='"'+xr.replace(qreg,'""')+'"';break}xr=="ID"&&(xr='"ID"')}else gr.f!=null&&!gr.F?(mr=!1,xr="="+gr.f,xr.indexOf(",")>=0&&(xr='"'+xr.replace(qreg,'""')+'"')):xr="";fr.push(xr)}return pr.blankrows===!1&&mr?null:fr.join(hr)}function sheet_to_csv(ar,or){var lr=[],cr=or??{};if(ar==null||ar["!ref"]==null)return"";var ur=safe_decode_range(ar["!ref"]),dr=cr.FS!==void 0?cr.FS:",",hr=dr.charCodeAt(0),pr=cr.RS!==void 0?cr.RS:`
`,mr=pr.charCodeAt(0),fr=new RegExp((dr=="|"?"\\|":dr)+"+$"),xr="",Er=[];cr.dense=Array.isArray(ar);for(var vr=cr.skipHidden&&ar["!cols"]||[],gr=cr.skipHidden&&ar["!rows"]||[],yr=ur.s.c;yr<=ur.e.c;++yr)(vr[yr]||{}).hidden||(Er[yr]=encode_col(yr));for(var br=0,_r=ur.s.r;_r<=ur.e.r;++_r)(gr[_r]||{}).hidden||(xr=make_csv_row(ar,ur,_r,Er,hr,mr,dr,cr),xr!=null&&(cr.strip&&(xr=xr.replace(fr,"")),(xr||cr.blankrows!==!1)&&lr.push((br++?pr:"")+xr)));return delete cr.dense,lr.join("")}function sheet_to_txt(ar,or){or||(or={}),or.FS="	",or.RS=`
`;var lr=sheet_to_csv(ar,or);return lr}function sheet_to_formulae(ar){var or="",lr,cr="";if(ar==null||ar["!ref"]==null)return[];var ur=safe_decode_range(ar["!ref"]),dr="",hr=[],pr,mr=[],fr=Array.isArray(ar);for(pr=ur.s.c;pr<=ur.e.c;++pr)hr[pr]=encode_col(pr);for(var xr=ur.s.r;xr<=ur.e.r;++xr)for(dr=encode_row(xr),pr=ur.s.c;pr<=ur.e.c;++pr)if(or=hr[pr]+dr,lr=fr?(ar[xr]||[])[pr]:ar[or],cr="",lr!==void 0){if(lr.F!=null){if(or=lr.F,!lr.f)continue;cr=lr.f,or.indexOf(":")==-1&&(or=or+":"+or)}if(lr.f!=null)cr=lr.f;else{if(lr.t=="z")continue;if(lr.t=="n"&&lr.v!=null)cr=""+lr.v;else if(lr.t=="b")cr=lr.v?"TRUE":"FALSE";else if(lr.w!==void 0)cr="'"+lr.w;else{if(lr.v===void 0)continue;lr.t=="s"?cr="'"+lr.v:cr=""+lr.v}}mr[mr.length]=or+"="+cr}return mr}function sheet_add_json(ar,or,lr){var cr=lr||{},ur=+!cr.skipHeader,dr=ar||{},hr=0,pr=0;if(dr&&cr.origin!=null)if(typeof cr.origin=="number")hr=cr.origin;else{var mr=typeof cr.origin=="string"?decode_cell(cr.origin):cr.origin;hr=mr.r,pr=mr.c}var fr,xr={s:{c:0,r:0},e:{c:pr,r:hr+or.length-1+ur}};if(dr["!ref"]){var Er=safe_decode_range(dr["!ref"]);xr.e.c=Math.max(xr.e.c,Er.e.c),xr.e.r=Math.max(xr.e.r,Er.e.r),hr==-1&&(hr=Er.e.r+1,xr.e.r=hr+or.length-1+ur)}else hr==-1&&(hr=0,xr.e.r=or.length-1+ur);var vr=cr.header||[],gr=0;or.forEach(function(br,_r){keys(br).forEach(function(jr){(gr=vr.indexOf(jr))==-1&&(vr[gr=vr.length]=jr);var wr=br[jr],Sr="z",Tr="",Rr=encode_cell({c:pr+gr,r:hr+_r+ur});fr=ws_get_cell_stub(dr,Rr),wr&&typeof wr=="object"&&!(wr instanceof Date)?dr[Rr]=wr:(typeof wr=="number"?Sr="n":typeof wr=="boolean"?Sr="b":typeof wr=="string"?Sr="s":wr instanceof Date?(Sr="d",cr.cellDates||(Sr="n",wr=datenum(wr)),Tr=cr.dateNF||table_fmt[14]):wr===null&&cr.nullError&&(Sr="e",wr=0),fr?(fr.t=Sr,fr.v=wr,delete fr.w,delete fr.R,Tr&&(fr.z=Tr)):dr[Rr]=fr={t:Sr,v:wr},Tr&&(fr.z=Tr))})}),xr.e.c=Math.max(xr.e.c,pr+vr.length-1);var yr=encode_row(hr);if(ur)for(gr=0;gr<vr.length;++gr)dr[encode_col(gr+pr)+yr]={t:"s",v:vr[gr]};return dr["!ref"]=encode_range(xr),dr}function json_to_sheet(ar,or){return sheet_add_json(null,ar,or)}function ws_get_cell_stub(ar,or,lr){if(typeof or=="string"){if(Array.isArray(ar)){var cr=decode_cell(or);return ar[cr.r]||(ar[cr.r]=[]),ar[cr.r][cr.c]||(ar[cr.r][cr.c]={t:"z"})}return ar[or]||(ar[or]={t:"z"})}return typeof or!="number"?ws_get_cell_stub(ar,encode_cell(or)):ws_get_cell_stub(ar,encode_cell({r:or,c:lr||0}))}function wb_sheet_idx(ar,or){if(typeof or=="number"){if(or>=0&&ar.SheetNames.length>or)return or;throw new Error("Cannot find sheet # "+or)}else if(typeof or=="string"){var lr=ar.SheetNames.indexOf(or);if(lr>-1)return lr;throw new Error("Cannot find sheet name |"+or+"|")}else throw new Error("Cannot find sheet |"+or+"|")}function book_new(){return{SheetNames:[],Sheets:{}}}function book_append_sheet(ar,or,lr,cr){var ur=1;if(!lr)for(;ur<=65535&&ar.SheetNames.indexOf(lr="Sheet"+ur)!=-1;++ur,lr=void 0);if(!lr||ar.SheetNames.length>=65535)throw new Error("Too many worksheets");if(cr&&ar.SheetNames.indexOf(lr)>=0){var dr=lr.match(/(^.*?)(\d+)$/);ur=dr&&+dr[2]||0;var hr=dr&&dr[1]||lr;for(++ur;ur<=65535&&ar.SheetNames.indexOf(lr=hr+ur)!=-1;++ur);}if(check_ws_name(lr),ar.SheetNames.indexOf(lr)>=0)throw new Error("Worksheet with name |"+lr+"| already exists!");return ar.SheetNames.push(lr),ar.Sheets[lr]=or,lr}function book_set_sheet_visibility(ar,or,lr){ar.Workbook||(ar.Workbook={}),ar.Workbook.Sheets||(ar.Workbook.Sheets=[]);var cr=wb_sheet_idx(ar,or);switch(ar.Workbook.Sheets[cr]||(ar.Workbook.Sheets[cr]={}),lr){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+lr)}ar.Workbook.Sheets[cr].Hidden=lr}function cell_set_number_format(ar,or){return ar.z=or,ar}function cell_set_hyperlink(ar,or,lr){return or?(ar.l={Target:or},lr&&(ar.l.Tooltip=lr)):delete ar.l,ar}function cell_set_internal_link(ar,or,lr){return cell_set_hyperlink(ar,"#"+or,lr)}function cell_add_comment(ar,or,lr){ar.c||(ar.c=[]),ar.c.push({t:or,a:lr||"SheetJS"})}function sheet_set_array_formula(ar,or,lr,cr){for(var ur=typeof or!="string"?or:safe_decode_range(or),dr=typeof or=="string"?or:encode_range(or),hr=ur.s.r;hr<=ur.e.r;++hr)for(var pr=ur.s.c;pr<=ur.e.c;++pr){var mr=ws_get_cell_stub(ar,hr,pr);mr.t="n",mr.F=dr,delete mr.v,hr==ur.s.r&&pr==ur.s.c&&(mr.f=lr,cr&&(mr.D=!0))}return ar}var utils={encode_col,encode_row,encode_cell,encode_range,decode_col,decode_row,split_cell,decode_cell,decode_range,format_cell,sheet_add_aoa,sheet_add_json,sheet_add_dom,aoa_to_sheet,json_to_sheet,table_to_sheet:parse_dom_table,table_to_book,sheet_to_csv,sheet_to_txt,sheet_to_json,sheet_to_html,sheet_to_formulae,sheet_to_row_object_array:sheet_to_json,sheet_get_cell:ws_get_cell_stub,book_new,book_append_sheet,book_set_sheet_visibility,cell_set_number_format,cell_set_hyperlink,cell_set_internal_link,cell_add_comment,sheet_set_array_formula,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function generateContinuityBiblePDF(ar,or,lr){const cr=(lr==null?void 0:lr.preparedBy)||"Hair & Makeup Department",ur=(lr==null?void 0:lr.firstShootDate)||new Date,dr=(lr==null?void 0:lr.lastShootDate)||new Date,hr=ar.characters.map(gr=>{const yr=ar.looks.filter(br=>br.characterId===gr.id);return generateCharacterSection(gr,yr,ar.scenes,or)}).join(""),pr=ar.scenes.sort((gr,yr)=>gr.sceneNumber.localeCompare(yr.sceneNumber,void 0,{numeric:!0})),mr=pr.map(gr=>generateSceneSection(gr,ar.characters,ar.looks,or)).join(""),fr=ar.characters.map(gr=>`<li><a href="#character-${gr.id}">${gr.name}</a></li>`).join(""),xr=pr.map(gr=>`<li><a href="#scene-${gr.id}">Sc ${gr.sceneNumber}  ${gr.slugline||"Untitled"}</a></li>`).join(""),Er=ar.looks.length,vr=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>${ar.name} - Continuity Bible</title>
      <style>
        @media print {
          .page-break { page-break-before: always; }
          .no-break { page-break-inside: avoid; }
          .no-print { display: none; }
          body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          padding: 0;
          max-width: 900px;
          margin: 0 auto;
          color: #2c2c2c;
          line-height: 1.5;
          font-size: 13px;
        }

        /*  Cover Page  */
        .cover-page {
          text-align: center;
          min-height: 95vh;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          padding: 60px 40px;
        }
        .cover-rule { width: 80px; height: 3px; background: #C9A962; margin: 0 auto 40px; }
        .cover-title { font-size: 38px; font-weight: 700; color: #1a1a1a; letter-spacing: -0.5px; margin-bottom: 6px; }
        .cover-subtitle { font-size: 18px; font-weight: 400; color: #C9A962; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 50px; }
        .cover-stats { display: flex; gap: 40px; justify-content: center; margin-bottom: 50px; }
        .cover-stat { text-align: center; }
        .cover-stat-value { font-size: 28px; font-weight: 700; color: #C9A962; display: block; }
        .cover-stat-label { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .cover-meta { font-size: 12px; color: #999; line-height: 1.8; }
        .cover-meta strong { color: #666; }

        /*  Section Headings  */
        .section-heading {
          font-size: 22px;
          font-weight: 700;
          color: #1a1a1a;
          margin: 0 0 6px 0;
          padding: 30px 40px 0;
        }
        .section-heading-rule { width: 50px; height: 3px; background: #C9A962; margin: 0 0 30px 40px; }

        /*  Table of Contents  */
        .toc { padding: 30px 40px; }
        .toc h2 { font-size: 22px; font-weight: 700; color: #1a1a1a; margin-bottom: 4px; }
        .toc-rule { width: 50px; height: 3px; background: #C9A962; margin-bottom: 30px; }
        .toc h3 { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: #C9A962; margin-bottom: 10px; }
        .toc ul { list-style: none; padding: 0; margin: 0 0 24px 0; }
        .toc li { padding: 3px 0; font-size: 12px; border-bottom: 1px dotted #e5e5e5; }
        .toc li:last-child { border-bottom: none; }
        .toc a { color: #444; text-decoration: none; }
        .toc a:hover { color: #C9A962; }
        .toc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .toc-scenes-list { columns: 2; column-gap: 24px; }
        .toc-scenes-list li { break-inside: avoid; }

        /*  Character Section  */
        .character-section { padding: 0 40px; margin-bottom: 20px; page-break-inside: avoid; }
        .character-header {
          background: linear-gradient(135deg, #C9A962, #B8975A);
          color: white;
          padding: 16px 20px;
          border-radius: 8px 8px 0 0;
        }
        .character-name { font-size: 20px; font-weight: 700; margin: 0; }
        .character-look-count { font-size: 12px; opacity: 0.85; margin-top: 2px; }

        /*  Look Card  */
        .look-section {
          border: 1px solid #e0e0e0;
          border-top: none;
          padding: 20px;
          margin-bottom: 0;
          page-break-inside: avoid;
        }
        .look-section:last-child { border-radius: 0 0 8px 8px; }
        .look-header {
          display: flex;
          justify-content: space-between;
          align-items: baseline;
          margin-bottom: 14px;
          padding-bottom: 10px;
          border-bottom: 1px solid #f0f0f0;
        }
        .look-name { font-size: 16px; font-weight: 600; color: #1a1a1a; }
        .look-scenes { font-size: 11px; color: #777; margin-top: 2px; }
        .look-time {
          font-size: 11px;
          color: #C9A962;
          font-weight: 500;
          white-space: nowrap;
        }

        /*  Photo Grid  */
        .photo-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 8px;
          margin: 0 0 16px;
          page-break-inside: avoid;
        }
        .photo-placeholder {
          aspect-ratio: 3/4;
          background: #fafafa;
          border: 1px dashed #d5d5d5;
          border-radius: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 10px;
          color: #bbb;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }
        .photo-img {
          width: 100%;
          aspect-ratio: 3/4;
          object-fit: cover;
          border-radius: 4px;
        }
        .master-photo {
          grid-column: span 2;
          grid-row: span 2;
        }
        .master-photo .photo-img,
        .master-photo .photo-placeholder {
          aspect-ratio: auto;
          height: 100%;
        }

        /*  Details Tables  */
        .details-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          margin-top: 16px;
        }
        .details-section h4 {
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1.5px;
          color: #C9A962;
          font-weight: 600;
          margin: 0 0 8px 0;
          padding-bottom: 6px;
          border-bottom: 1px solid #f0f0f0;
        }
        .details-table { width: 100%; font-size: 12px; border-collapse: collapse; }
        .details-table td { padding: 3px 0; vertical-align: top; }
        .details-table td:first-child { color: #888; width: 42%; }
        .details-table td:last-child { color: #2c2c2c; font-weight: 500; }

        /*  Notes  */
        .notes-section {
          margin-top: 14px;
          padding: 10px 14px;
          background: #f8f8f8;
          border-radius: 6px;
          border-left: 3px solid #C9A962;
        }
        .notes-section h4 {
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
          color: #888;
          margin: 0 0 6px 0;
        }
        .notes-section p { font-size: 12px; color: #555; margin: 0; }

        /*  Scene Section  */
        .scene-section {
          margin: 0 40px 16px;
          border: 1px solid #e0e0e0;
          border-radius: 8px;
          overflow: hidden;
          page-break-inside: avoid;
        }
        .scene-header {
          background: #f7f7f7;
          padding: 12px 16px;
          border-bottom: 1px solid #e0e0e0;
        }
        .scene-number {
          font-size: 11px;
          color: #C9A962;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 1px;
        }
        .scene-slugline { font-size: 15px; font-weight: 600; color: #1a1a1a; margin: 4px 0 0; }
        .scene-synopsis { font-size: 12px; color: #777; margin-top: 4px; }
        .scene-content { padding: 14px 16px; }
        .scene-content h4 {
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
          color: #999;
          margin: 0 0 10px;
        }
        .scene-characters { display: flex; flex-wrap: wrap; gap: 8px; }
        .scene-character-card {
          flex: 1;
          min-width: 180px;
          padding: 10px 12px;
          background: #fafafa;
          border: 1px solid #eee;
          border-radius: 6px;
        }
        .scene-character-name { font-weight: 600; font-size: 13px; color: #1a1a1a; }
        .scene-character-look { font-size: 11px; color: #777; margin-top: 2px; }

        /*  Continuity Flags  */
        .flags-list { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .flag-badge {
          padding: 3px 8px;
          border-radius: 10px;
          font-size: 10px;
          font-weight: 600;
          letter-spacing: 0.3px;
        }
        .flag-sweat { background: #e3f2fd; color: #1565c0; }
        .flag-dishevelled { background: #fff3e0; color: #ef6c00; }
        .flag-blood { background: #ffebee; color: #c62828; }
        .flag-dirt { background: #efebe9; color: #5d4037; }
        .flag-wetHair { background: #e0f7fa; color: #00838f; }
        .flag-tears { background: #e8eaf6; color: #3949ab; }

        /*  SFX  */
        .sfx-section {
          margin-top: 14px;
          padding: 10px 14px;
          background: #fffbf0;
          border: 1px solid #f0e0b0;
          border-radius: 6px;
        }
        .sfx-section h4 {
          color: #d48806;
          font-size: 10px;
          text-transform: uppercase;
          letter-spacing: 1px;
          margin: 0 0 6px 0;
        }
      </style>
    </head>
    <body>
      <!-- Cover Page -->
      <div class="cover-page">
        <div class="cover-rule"></div>
        <h1 class="cover-title">${ar.name}</h1>
        <h2 class="cover-subtitle">Continuity Bible</h2>
        <div class="cover-stats">
          <div class="cover-stat">
            <span class="cover-stat-value">${ar.scenes.length}</span>
            <span class="cover-stat-label">Scenes</span>
          </div>
          <div class="cover-stat">
            <span class="cover-stat-value">${ar.characters.length}</span>
            <span class="cover-stat-label">Characters</span>
          </div>
          <div class="cover-stat">
            <span class="cover-stat-value">${Er}</span>
            <span class="cover-stat-label">Looks</span>
          </div>
        </div>
        <div class="cover-meta">
          <p><strong>Prepared by:</strong> ${cr}</p>
          <p><strong>Production Dates:</strong> ${formatDate(ur)}  ${formatDate(dr)}</p>
          <p><strong>Exported:</strong> ${vr}</p>
        </div>
      </div>

      <div class="page-break"></div>

      <!-- Table of Contents -->
      <div class="toc">
        <h2>Contents</h2>
        <div class="toc-rule"></div>
        <div class="toc-grid">
          <div>
            <h3>Characters (${ar.characters.length})</h3>
            <ul>${fr}</ul>
          </div>
          <div>
            <h3>Scenes (${pr.length})</h3>
            <ul class="toc-scenes-list">${xr}</ul>
          </div>
        </div>
      </div>

      <div class="page-break"></div>

      <!-- Character Sections -->
      <div class="section-heading">Character Reference</div>
      <div class="section-heading-rule"></div>
      ${hr}

      <div class="page-break"></div>

      <!-- Scene Sections -->
      <div class="section-heading">Scene Index</div>
      <div class="section-heading-rule"></div>
      ${mr}
    </body>
    </html>
  `}function generateCharacterSection(ar,or,lr,cr){const ur=or.map(dr=>{var fr;const hr=lr.filter(xr=>dr.scenes.includes(xr.sceneNumber)).map(xr=>xr.sceneNumber).join(", "),pr=Object.keys(cr).find(xr=>xr.includes(ar.id)&&cr[xr].lookId===dr.id),mr=pr?cr[pr]:null;return`
      <div class="look-section">
        <div class="look-header">
          <div>
            <div class="look-name">${dr.name}</div>
            <div class="look-scenes">Scenes: ${hr||"None assigned"}</div>
          </div>
          <div class="look-time">Application Time: ~${dr.estimatedTime} min</div>
        </div>

        <!-- Photos Grid -->
        <div class="photo-grid">
          <div class="master-photo">
            ${dr.masterReference?`<img class="photo-img" src="${dr.masterReference.uri}" alt="Master Reference" />`:'<div class="photo-placeholder">Master Reference<br/>No Photo</div>'}
          </div>
          ${["front","left","right","back"].map(xr=>{const Er=mr==null?void 0:mr.photos[xr];return Er?`<img class="photo-img" src="${Er.uri}" alt="${xr}" />`:`<div class="photo-placeholder">${xr.charAt(0).toUpperCase()+xr.slice(1)}</div>`}).join("")}
        </div>

        <!-- Details -->
        <div class="details-grid">
          <div class="details-section">
            <h4>Makeup</h4>
            <table class="details-table">
              ${formatMakeupDetails(dr.makeup)}
            </table>
          </div>
          <div class="details-section">
            <h4>Hair</h4>
            <table class="details-table">
              ${formatHairDetails(dr.hair)}
            </table>
          </div>
        </div>

        ${(fr=mr==null?void 0:mr.sfxDetails)!=null&&fr.sfxRequired?`
          <div class="sfx-section">
            <h4>Special Effects</h4>
            <table class="details-table">
              ${formatSFXDetails(mr.sfxDetails)}
            </table>
          </div>
        `:""}

        ${mr!=null&&mr.notes?`
          <div class="notes-section">
            <h4>Notes</h4>
            <p>${mr.notes}</p>
          </div>
        `:""}
      </div>
    `}).join("");return`
    <div class="character-section" id="character-${ar.id}">
      <div class="character-header">
        <h3 class="character-name">${ar.name}</h3>
        <div class="character-look-count">${or.length} Look${or.length!==1?"s":""}</div>
      </div>
      ${ur}
    </div>
  `}function generateSceneSection(ar,or,lr,cr){const dr=or.filter(hr=>ar.characters.includes(hr.id)).map(hr=>{const pr=lr.find(Er=>Er.characterId===hr.id&&Er.scenes.includes(ar.sceneNumber)),mr=`${ar.id}-${hr.id}`,fr=cr[mr],xr=fr?formatContinuityFlags(fr.continuityFlags):"";return`
      <div class="scene-character-card">
        <div class="scene-character-name">${hr.name}</div>
        <div class="scene-character-look">${(pr==null?void 0:pr.name)||"No Look Assigned"}</div>
        ${xr?`<div class="flags-list">${xr}</div>`:""}
      </div>
    `}).join("");return`
    <div class="scene-section" id="scene-${ar.id}">
      <div class="scene-header">
        <div class="scene-number">SCENE ${ar.sceneNumber}</div>
        <div class="scene-slugline">${ar.intExt}. ${ar.slugline} - ${ar.timeOfDay}</div>
        ${ar.synopsis?`<div class="scene-synopsis">${ar.synopsis}</div>`:""}
      </div>
      <div class="scene-content">
        <h4 style="font-size: 12px; color: #666; margin: 0 0 10px;">Characters in Scene:</h4>
        <div class="scene-characters">
          ${dr||'<p style="color: #999; font-size: 13px;">No characters assigned</p>'}
        </div>
      </div>
    </div>
  `}const BREAKDOWN_GROUP_HEADERS=[{label:"Scene",span:4},{label:"Character",span:2},{label:"Makeup",span:7},{label:"Hair",span:5},{label:"SFX",span:1},{label:"Continuity Events",span:1},{label:"Notes & Status",span:3}],BREAKDOWN_HEADERS=["Scene #","INT/EXT","Slugline","Time of Day","Character","Look","Base","Concealer","Contour & Highlight","Blush","Brows","Eyes","Lips","Style & Parting","Products","Pieces & Pins","Accessories","Wig Details","SFX","Continuity Events","Flags","Notes","Status"];function joinParts(ar,or=", "){return ar.filter(Boolean).join(or)}function formatMakeupGroups(ar){return[joinParts([ar.foundation&&`Foundation: ${ar.foundation}`,ar.coverage&&`Coverage: ${ar.coverage}`]),joinParts([ar.concealer&&`${ar.concealer}`,ar.concealerPlacement&&`(${ar.concealerPlacement})`]," "),joinParts([ar.contour&&`Contour: ${ar.contour}`,ar.contourPlacement&&`(${ar.contourPlacement})`,ar.highlight&&`Highlight: ${ar.highlight}`,ar.highlightPlacement&&`(${ar.highlightPlacement})`]," | "),joinParts([ar.blush&&`${ar.blush}`,ar.blushPlacement&&`(${ar.blushPlacement})`]," "),joinParts([ar.browProduct&&`Product: ${ar.browProduct}`,ar.browShape&&`Shape: ${ar.browShape}`]),joinParts([ar.eyePrimer&&`Primer: ${ar.eyePrimer}`,ar.lidColour&&`Lid: ${ar.lidColour}`,ar.creaseColour&&`Crease: ${ar.creaseColour}`,ar.outerV&&`Outer V: ${ar.outerV}`,ar.liner&&`Liner: ${ar.liner}`,ar.lashes&&`Lashes: ${ar.lashes}`]),joinParts([ar.lipLiner&&`Liner: ${ar.lipLiner}`,ar.lipColour&&`Colour: ${ar.lipColour}`])]}function formatHairGroups(ar){var or;return[joinParts([ar.style,ar.parting&&`Parting: ${ar.parting}`]),ar.products||"",joinParts([ar.piecesOut&&`Pieces out: ${ar.piecesOut}`,ar.pins&&`Pins: ${ar.pins}`]),ar.accessories||"",ar.hairType==="Wig"?joinParts([ar.wigNameId&&`Name: ${ar.wigNameId}`,ar.wigType&&`Type: ${ar.wigType}`,ar.wigCapMethod&&`Cap: ${ar.wigCapMethod}`,(or=ar.wigAttachment)!=null&&or.length?`Attachment: ${ar.wigAttachment.join(", ")}`:null,ar.hairline&&`Hairline: ${ar.hairline}`,ar.laceTint&&`Lace tint: ${ar.laceTint}`,ar.edgesBabyHairs&&`Edges: ${ar.edgesBabyHairs}`]," | "):""]}function formatSFX(ar){var or;return ar.sfxRequired?joinParts([ar.sfxTypes.length?`Types: ${ar.sfxTypes.join(", ")}`:null,ar.prostheticPieces&&`Prosthetics: ${ar.prostheticPieces}`,ar.prostheticAdhesive&&`Adhesive: ${ar.prostheticAdhesive}`,(or=ar.bloodTypes)!=null&&or.length?`Blood: ${ar.bloodTypes.join(", ")}`:null,ar.bloodProducts&&`Blood products: ${ar.bloodProducts}`,ar.bloodPlacement&&`Placement: ${ar.bloodPlacement}`,ar.tattooCoverage&&`Tattoo coverage: ${ar.tattooCoverage}`,ar.temporaryTattoos&&`Temp tattoos: ${ar.temporaryTattoos}`,ar.contactLenses&&`Contacts: ${ar.contactLenses}`,ar.teeth&&`Teeth: ${ar.teeth}`,ar.agingCharacterNotes&&`Aging: ${ar.agingCharacterNotes}`]," | "):""}function formatContinuityEvents(ar,or){const lr=ar.filter(cr=>cr.scenes&&cr.scenes.includes(or)||!cr.scenes&&cr.sceneRange);return lr.length?lr.map(cr=>{const ur=[cr.type,cr.name];return cr.stage&&ur.push(`Stage: ${cr.stage}`),cr.description&&ur.push(cr.description),ur.join(" - ")}).join("; "):""}function formatFlags(ar){return Object.entries(ar).filter(([lr,cr])=>cr).map(([lr])=>lr).join(", ")}function buildBreakdownRows(ar,or){const lr=[],cr=[...ar.scenes].sort((ur,dr)=>ur.sceneNumber.localeCompare(dr.sceneNumber,void 0,{numeric:!0}));for(const ur of cr){const dr=ar.characters.filter(hr=>ur.characters.includes(hr.id));if(dr.length===0){lr.push([ur.sceneNumber,ur.intExt,ur.slugline,ur.timeOfDay,"","","","","","","","","","","","","","","","","","",ur.isComplete?"Complete":"Incomplete"]);continue}for(const hr of dr){const pr=ar.looks.find(wr=>wr.characterId===hr.id&&wr.scenes.includes(ur.sceneNumber)),mr=`${ur.id}-${hr.id}`,fr=or[mr],xr=pr?formatMakeupGroups(pr.makeup):["","","","","","",""],Er=pr?formatHairGroups(pr.hair):["","","","",""],vr=(fr==null?void 0:fr.sfxDetails)||(pr==null?void 0:pr.sfxDetails),gr=vr?formatSFX(vr):"",yr=[...(fr==null?void 0:fr.continuityEvents)||[],...(pr==null?void 0:pr.continuityEvents)||[]],br=formatContinuityEvents(yr,ur.sceneNumber),_r=fr?formatFlags(fr.continuityFlags):pr!=null&&pr.continuityFlags?formatFlags(pr.continuityFlags):"",jr=(fr==null?void 0:fr.notes)||(pr==null?void 0:pr.notes)||"";lr.push([ur.sceneNumber,ur.intExt,ur.slugline,ur.timeOfDay,hr.name,(pr==null?void 0:pr.name)||"",...xr,...Er,gr,br,_r,jr,ur.isComplete?"Complete":"Incomplete"])}}return lr}function generateSceneBreakdownCSV(ar,or){const lr=buildBreakdownRows(ar,or),cr=dr=>dr.includes(",")||dr.includes('"')||dr.includes(`
`)?`"${dr.replace(/"/g,'""')}"`:dr;return[BREAKDOWN_HEADERS.join(","),...lr.map(dr=>dr.map(cr).join(","))].join(`
`)}const GROUP_COLOURS={Scene:{fill:"2C3E50",font:"FFFFFF"},Character:{fill:"8E44AD",font:"FFFFFF"},Makeup:{fill:"E74C3C",font:"FFFFFF"},Hair:{fill:"2980B9",font:"FFFFFF"},SFX:{fill:"D35400",font:"FFFFFF"},"Continuity Events":{fill:"27AE60",font:"FFFFFF"},"Notes & Status":{fill:"7F8C8D",font:"FFFFFF"}};function generateSceneBreakdownXLSX(ar,or){var vr,gr;const lr=buildBreakdownRows(ar,or),cr=utils.book_new(),ur=[];for(const yr of BREAKDOWN_GROUP_HEADERS){ur.push(yr.label);for(let br=1;br<yr.span;br++)ur.push("")}const dr=[ur,BREAKDOWN_HEADERS,...lr],hr=utils.aoa_to_sheet(dr),pr=[];let mr=0;for(const yr of BREAKDOWN_GROUP_HEADERS)yr.span>1&&pr.push({s:{r:0,c:mr},e:{r:0,c:mr+yr.span-1}}),mr+=yr.span;hr["!merges"]=pr;const fr=BREAKDOWN_HEADERS.length,xr=[];for(let yr=0;yr<fr;yr++){const br=BREAKDOWN_HEADERS[yr];let _r=14;br==="Slugline"?_r=28:br==="Eyes"||br==="Wig Details"||br==="SFX"?_r=30:br==="Contour & Highlight"?_r=22:br==="Continuity Events"||br==="Notes"?_r=25:(br==="Scene #"||br==="INT/EXT"||br==="Status")&&(_r=10),xr.push({wch:_r})}hr["!cols"]=xr,mr=0;for(const yr of BREAKDOWN_GROUP_HEADERS){const br=utils.encode_cell({r:0,c:mr});hr[br]||(hr[br]={v:yr.label,t:"s"}),hr[br].s={fill:{fgColor:{rgb:((vr=GROUP_COLOURS[yr.label])==null?void 0:vr.fill)||"333333"}},font:{bold:!0,color:{rgb:((gr=GROUP_COLOURS[yr.label])==null?void 0:gr.font)||"FFFFFF"},sz:11},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}},mr+=yr.span}for(let yr=0;yr<fr;yr++){const br=utils.encode_cell({r:1,c:yr});hr[br]||(hr[br]={v:BREAKDOWN_HEADERS[yr],t:"s"}),hr[br].s={fill:{fgColor:{rgb:"ECF0F1"}},font:{bold:!0,sz:10},alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"BDBDBD"}},right:{style:"thin",color:{rgb:"BDBDBD"}}}}}for(let yr=0;yr<lr.length;yr++){const br=yr%2===0;for(let _r=0;_r<fr;_r++){const jr=utils.encode_cell({r:yr+2,c:_r});hr[jr]||(hr[jr]={v:lr[yr][_r]||"",t:"s"}),hr[jr].s={fill:{fgColor:{rgb:br?"FFFFFF":"F7F9FA"}},font:{sz:9},alignment:{vertical:"top",wrapText:!0},border:{top:{style:"thin",color:{rgb:"E0E0E0"}},bottom:{style:"thin",color:{rgb:"E0E0E0"}},left:{style:"thin",color:{rgb:"E0E0E0"}},right:{style:"thin",color:{rgb:"E0E0E0"}}}}}}return hr["!freeze"]={xSplit:6,ySplit:2},utils.book_append_sheet(cr,hr,"Scene Breakdown"),writeSync(cr,{bookType:"xlsx",type:"array",cellStyles:!0})}function generateCharacterLookbookPDF(ar,or,lr,cr){const ur=or.map(dr=>{const hr=lr.filter(fr=>dr.scenes.includes(fr.sceneNumber)).map(fr=>`Scene ${fr.sceneNumber}`).join(", "),pr=Object.keys(cr).find(fr=>fr.includes(ar.id)&&cr[fr].lookId===dr.id),mr=pr?cr[pr]:null;return`
      <div class="look-page">
        <div class="look-header">
          <h2>${dr.name}</h2>
          <p class="scenes-list">${hr||"No scenes assigned"}</p>
          <p class="app-time">Estimated Application: ${dr.estimatedTime} minutes</p>
        </div>

        <div class="photo-section">
          ${dr.masterReference?`<img class="master-photo" src="${dr.masterReference.uri}" alt="Master Reference" />`:'<div class="photo-placeholder master">No Master Reference</div>'}
          <div class="angle-photos">
            ${["front","left","right","back"].map(fr=>{const xr=mr==null?void 0:mr.photos[fr];return xr?`<img src="${xr.uri}" alt="${fr}" />`:`<div class="photo-placeholder">${fr}</div>`}).join("")}
          </div>
        </div>

        <div class="details-section">
          <div class="makeup-details">
            <h3>Makeup</h3>
            ${formatMakeupDetailsHTML(dr.makeup)}
          </div>
          <div class="hair-details">
            <h3>Hair</h3>
            ${formatHairDetailsHTML(dr.hair)}
          </div>
        </div>

        ${mr!=null&&mr.notes?`
          <div class="notes-section">
            <h3>Notes</h3>
            <p>${mr.notes}</p>
          </div>
        `:""}
      </div>
    `}).join('<div class="page-break"></div>');return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>${ar.name} - Lookbook</title>
      <style>
        @media print { .page-break { page-break-before: always; } }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
        .character-cover { text-align: center; padding: 100px 20px; }
        .character-name { font-size: 48px; color: #C9A962; margin-bottom: 10px; }
        .character-subtitle { font-size: 18px; color: #666; }
        .look-page { margin-bottom: 40px; }
        .look-header { margin-bottom: 20px; }
        .look-header h2 { color: #C9A962; margin: 0 0 5px; }
        .scenes-list { color: #666; font-size: 14px; margin: 0; }
        .app-time { color: #999; font-size: 12px; margin: 5px 0 0; }
        .photo-section { display: flex; gap: 20px; margin-bottom: 20px; }
        .master-photo { width: 250px; height: auto; border-radius: 8px; }
        .angle-photos { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; flex: 1; }
        .angle-photos img { width: 100%; border-radius: 4px; }
        .photo-placeholder { background: #f5f5f5; border: 1px dashed #ccc; border-radius: 4px; padding: 40px; text-align: center; color: #999; }
        .photo-placeholder.master { width: 250px; min-height: 300px; display: flex; align-items: center; justify-content: center; }
        .details-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .details-section h3 { font-size: 14px; color: #C9A962; border-bottom: 1px solid #eee; padding-bottom: 5px; margin: 0 0 10px; }
        .detail-row { display: flex; justify-content: space-between; font-size: 12px; padding: 4px 0; border-bottom: 1px solid #f5f5f5; }
        .detail-label { color: #666; }
        .detail-value { color: #333; font-weight: 500; }
        .notes-section { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; }
        .notes-section h3 { font-size: 12px; color: #666; margin: 0 0 8px; }
      </style>
    </head>
    <body>
      <div class="character-cover">
        <h1 class="character-name">${ar.name}</h1>
        <p class="character-subtitle">Hair & Makeup Lookbook</p>
        <p style="color: #999; margin-top: 20px;">${or.length} Look${or.length!==1?"s":""}</p>
      </div>
      <div class="page-break"></div>
      ${ur}
    </body>
    </html>
  `}function formatDate(ar){return new Date(ar).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})}function formatMakeupDetails(ar){return[["Foundation",ar.foundation],["Coverage",ar.coverage],["Concealer",ar.concealer],["Blush",ar.blush],["Lips",ar.lipColour],["Eyes",[ar.lidColour,ar.liner,ar.lashes].filter(Boolean).join(", ")],["Setting",ar.setting]].filter(([lr,cr])=>cr).map(([lr,cr])=>`
    <tr><td>${lr}:</td><td>${cr}</td></tr>
  `).join("")}function formatHairDetails(ar){const or=[["Style",ar.style],["Parting",ar.parting],["Products",ar.products],["Pieces Out",ar.piecesOut],["Accessories",ar.accessories],["Type",ar.hairType!=="Natural"?ar.hairType:null]].filter(([lr,cr])=>cr);return ar.hairType!=="Natural"&&(ar.wigNameId&&or.push(["Wig",ar.wigNameId]),ar.wigType&&or.push(["Wig Type",ar.wigType])),or.map(([lr,cr])=>`
    <tr><td>${lr}:</td><td>${cr}</td></tr>
  `).join("")}function formatSFXDetails(ar){return[["Types",ar.sfxTypes.join(", ")],["Prosthetics",ar.prostheticPieces],["Adhesive",ar.prostheticAdhesive],["Blood Types",ar.bloodTypes.join(", ")],["Blood Products",ar.bloodProducts],["Contact Lenses",ar.contactLenses],["Teeth",ar.teeth]].filter(([lr,cr])=>cr&&cr.length>0).map(([lr,cr])=>`
    <tr><td>${lr}:</td><td>${cr}</td></tr>
  `).join("")}function formatMakeupDetailsHTML(ar){return[["Foundation",ar.foundation],["Coverage",ar.coverage],["Concealer",ar.concealer],["Blush",ar.blush],["Lip Colour",ar.lipColour],["Lid Colour",ar.lidColour],["Liner",ar.liner],["Lashes",ar.lashes],["Setting",ar.setting]].filter(([lr,cr])=>cr).map(([lr,cr])=>`
    <div class="detail-row">
      <span class="detail-label">${lr}</span>
      <span class="detail-value">${cr}</span>
    </div>
  `).join("")}function formatHairDetailsHTML(ar){const or=[["Style",ar.style],["Parting",ar.parting],["Products",ar.products],["Pieces Out",ar.piecesOut],["Pins",ar.pins],["Accessories",ar.accessories],["Type",ar.hairType]].filter(([lr,cr])=>cr);return ar.hairType!=="Natural"&&(ar.wigNameId&&or.push(["Wig ID",ar.wigNameId]),ar.wigType&&or.push(["Wig Type",ar.wigType]),ar.hairline&&or.push(["Hairline",ar.hairline])),or.map(([lr,cr])=>`
    <div class="detail-row">
      <span class="detail-label">${lr}</span>
      <span class="detail-value">${cr}</span>
    </div>
  `).join("")}function formatContinuityFlags(ar){const or=[];return ar.sweat&&or.push('<span class="flag-badge flag-sweat">Sweat</span>'),ar.dishevelled&&or.push('<span class="flag-badge flag-dishevelled">Dishevelled</span>'),ar.blood&&or.push('<span class="flag-badge flag-blood">Blood</span>'),ar.dirt&&or.push('<span class="flag-badge flag-dirt">Dirt</span>'),ar.wetHair&&or.push('<span class="flag-badge flag-wetHair">Wet Hair</span>'),ar.tears&&or.push('<span class="flag-badge flag-tears">Tears</span>'),or.join("")}const exportUtils=Object.freeze(Object.defineProperty({__proto__:null,generateCharacterLookbookPDF,generateContinuityBiblePDF,generateSceneBreakdownCSV,generateSceneBreakdownXLSX},Symbol.toStringTag,{value:"Module"}));function SceneCharacterConfirmation({scene:ar,onClose:or,onConfirm:lr}){var Tr;const{currentProject:cr,confirmSceneCharacters:ur,addCharacterFromScene:dr}=useProjectStore(),[hr,pr]=reactExports.useState(()=>new Set(ar.characters||[])),[mr,fr]=reactExports.useState(()=>{var Cr;const Rr=new Set;return cr&&((Cr=ar.characters)==null||Cr.forEach(kr=>{const Ar=cr.characters.find(Or=>Or.id===kr);Ar&&Rr.add(Ar.name)})),(ar.suggestedCharacters||[]).forEach(kr=>Rr.add(kr)),Rr}),[xr,Er]=reactExports.useState(""),[vr,gr]=reactExports.useState(!1),yr=(cr==null?void 0:cr.characters)||[],br=reactExports.useMemo(()=>(ar.suggestedCharacters||[]).map(Nr=>{const Cr=yr.find(kr=>kr.name.toUpperCase()===Nr.toUpperCase());return{name:Nr,existingCharacter:Cr||null,isInProject:!!Cr}}),[ar.suggestedCharacters,yr]),_r=(Rr,Nr)=>{fr(Cr=>{const kr=new Set(Cr);return kr.has(Rr)?(kr.delete(Rr),Nr&&pr(Ar=>{const Or=new Set(Ar);return Or.delete(Nr.id),Or})):(kr.add(Rr),Nr&&pr(Ar=>new Set([...Ar,Nr.id]))),kr})},jr=()=>{const Rr=xr.trim().toUpperCase();if(!Rr)return;if(mr.has(Rr)){Er(""),gr(!1);return}const Nr=yr.find(Cr=>Cr.name.toUpperCase()===Rr);Nr?pr(Cr=>new Set([...Cr,Nr.id])):fr(Cr=>new Set([...Cr,Rr])),Er(""),gr(!1)},wr=()=>{const Rr=new Set(hr);mr.forEach(Nr=>{const Cr=yr.find(kr=>kr.name.toUpperCase()===Nr.toUpperCase());if(Cr)Rr.add(Cr.id);else{const kr=dr(ar.id,Nr);Rr.add(kr.id)}}),ur(ar.id,Array.from(Rr)),lr()},Sr=mr.size;return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[85vh] flex flex-col safe-bottom",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("h3",{className:"text-base font-semibold text-text-primary truncate",children:["Scene ",ar.sceneNumber]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted truncate",children:ar.slugline})]}),jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -mr-2 text-text-muted active:text-gold",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),ar.scriptContent&&jsxRuntimeExports.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-border max-h-48 overflow-y-auto shrink-0",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-secondary font-mono whitespace-pre-wrap",children:ar.scriptContent})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[ar.characters&&ar.characters.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("h4",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"CURRENT CHARACTERS"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ar.characters.map(Rr=>{const Nr=yr.find(kr=>kr.id===Rr);if(!Nr)return null;const Cr=hr.has(Rr);return jsxRuntimeExports.jsxs("div",{className:clsx("flex items-center gap-3 p-3 rounded-xl border transition-all",Cr?"border-gold bg-gold/5":"border-red-200 bg-red-50"),children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:Nr,size:"sm"}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:jsxRuntimeExports.jsx("span",{className:clsx("font-medium",Cr?"text-text-primary":"text-red-400 line-through"),children:Nr.name})}),jsxRuntimeExports.jsx("button",{onClick:()=>{pr(Ar=>{const Or=new Set(Ar);return Or.has(Rr)?Or.delete(Rr):Or.add(Rr),Or});const kr=Nr.name.toUpperCase();fr(Ar=>{const Or=new Set(Ar);return Cr?Or.delete(kr):Or.add(kr),Or})},className:clsx("p-1.5 rounded-lg transition-colors flex-shrink-0",Cr?"text-red-500 hover:bg-red-50 active:bg-red-100":"text-green-600 hover:bg-green-50 active:bg-green-100"),title:Cr?"Remove from scene":"Add back to scene",children:Cr?jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]},Rr)})})]}),br.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("h4",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"SUGGESTED CHARACTERS"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:br.map(({name:Rr,existingCharacter:Nr})=>{const Cr=mr.has(Rr);return jsxRuntimeExports.jsxs("button",{onClick:()=>_r(Rr,Nr),className:clsx("w-full flex items-center gap-3 p-3 rounded-xl border transition-all text-left",Cr?"border-gold bg-gold/5":"border-border bg-card"),children:[jsxRuntimeExports.jsx("div",{className:clsx("w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 transition-all",Cr?"border-gold bg-gold":"border-gray-300"),children:Cr&&jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}),Nr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:Nr,size:"sm"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:Nr.name}),jsxRuntimeExports.jsx("span",{className:"text-xs text-green-600 ml-2",children:"In project"})]})]}):jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:Rr}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted ml-2",children:"New character"})]})]},Rr)})})]}),ar.characterConfirmationStatus==="detecting"&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-sm mb-4 p-3 bg-gray-50 rounded-lg",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Detecting characters..."]}),ar.characterConfirmationStatus==="pending"&&!((Tr=ar.suggestedCharacters)!=null&&Tr.length)&&jsxRuntimeExports.jsx("div",{className:"text-text-muted text-sm mb-4 p-3 bg-gray-50 rounded-lg",children:"No characters detected yet. Add characters manually below."}),jsxRuntimeExports.jsx("div",{className:"mt-4",children:vr?jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:xr,onChange:Rr=>Er(Rr.target.value.toUpperCase()),placeholder:"CHARACTER NAME",className:"flex-1 px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary uppercase",autoFocus:!0,onKeyDown:Rr=>{Rr.key==="Enter"&&jr(),Rr.key==="Escape"&&gr(!1)}}),jsxRuntimeExports.jsx("button",{onClick:jr,disabled:!xr.trim(),className:"px-3 py-2 bg-gold text-white rounded-lg text-sm font-medium disabled:opacity-50",children:"Add"}),jsxRuntimeExports.jsx("button",{onClick:()=>{gr(!1),Er("")},className:"px-3 py-2 text-text-muted",children:"Cancel"})]}):jsxRuntimeExports.jsxs("button",{onClick:()=>gr(!0),className:"w-full flex items-center justify-center gap-2 p-3 rounded-xl border border-dashed border-border text-text-muted hover:border-gold hover:text-gold transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add character not detected"]})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-t border-border shrink-0",children:jsxRuntimeExports.jsxs("button",{onClick:wr,className:"w-full py-3 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform",children:["Confirm ",Sr," Character",Sr!==1?"s":""]})})]})})}function CharacterConfirmationProgress({totalScenes:ar,confirmedScenes:or}){const lr=ar>0?Math.round(or/ar*100):0;return or>=ar?null:jsxRuntimeExports.jsxs("div",{className:"mx-4 mb-3 p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-amber-700",children:"Character Confirmation"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-amber-600",children:[or," / ",ar," scenes"]})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 bg-amber-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-amber-500 rounded-full transition-all duration-300",style:{width:`${lr}%`}})}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-amber-600 mt-1.5",children:"Confirm characters in each scene to track continuity"})]})}function AmendmentReviewModal({amendmentResult:ar,onApply:or,onCancel:lr}){const[cr,ur]=reactExports.useState(!0),[dr,hr]=reactExports.useState(!0),[pr,mr]=reactExports.useState(!1),[fr,xr]=reactExports.useState(null),{newScenes:Er,modifiedScenes:vr,deletedScenes:gr,summary:yr}=ar,br=Er.length>0||vr.length>0||gr.length>0,_r=()=>{or({includeNew:cr,includeModified:dr,includeDeleted:pr})},jr=(wr,Sr)=>{const Tr=fr===wr.sceneNumber,Rr=Sr==="new"?"bg-green-50 border-green-200":Sr==="modified"?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200",Nr=Sr==="new"?"text-green-700":Sr==="modified"?"text-amber-700":"text-red-700",Cr=Sr==="new"?"bg-green-100 text-green-700":Sr==="modified"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700",kr=Sr==="new"?"NEW":Sr==="modified"?"MODIFIED":"DELETED";return jsxRuntimeExports.jsxs("div",{className:clsx("border rounded-lg overflow-hidden",Rr),children:[jsxRuntimeExports.jsxs("button",{onClick:()=>xr(Tr?null:wr.sceneNumber),className:"w-full p-3 flex items-center justify-between text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"font-semibold text-text-primary",children:["Scene ",wr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:clsx("px-1.5 py-0.5 text-[10px] font-bold rounded",Cr),children:kr})]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 text-text-muted transition-transform",Tr&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),Tr&&jsxRuntimeExports.jsxs("div",{className:"px-3 pb-3 border-t border-border/30",children:[jsxRuntimeExports.jsx("p",{className:clsx("text-xs mt-2",Nr),children:wr.changeDescription}),wr.contentSimilarity!==void 0&&jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between text-xs text-text-muted mb-1",children:[jsxRuntimeExports.jsx("span",{children:"Content similarity"}),jsxRuntimeExports.jsxs("span",{children:[wr.contentSimilarity,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:clsx("h-full rounded-full",wr.contentSimilarity>=80?"bg-green-500":wr.contentSimilarity>=50?"bg-amber-500":"bg-red-500"),style:{width:`${wr.contentSimilarity}%`}})})]}),Sr==="modified"&&wr.existingScene&&jsxRuntimeExports.jsxs("div",{className:"mt-3 p-2 bg-white/50 rounded text-xs",children:[jsxRuntimeExports.jsx("p",{className:"text-text-muted mb-1",children:"Existing data preserved:"}),jsxRuntimeExports.jsxs("ul",{className:"text-text-secondary space-y-0.5",children:[wr.existingScene.characters.length>0&&jsxRuntimeExports.jsxs("li",{children:["- ",wr.existingScene.characters.length," confirmed character(s)"]}),wr.existingScene.synopsis&&jsxRuntimeExports.jsx("li",{children:"- Scene synopsis"}),wr.existingScene.filmingStatus&&jsxRuntimeExports.jsxs("li",{children:["- Filming status: ",wr.existingScene.filmingStatus]})]})]}),wr.newScene&&jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Slugline:"}),jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-primary",children:wr.newScene.slugline})]})]})]},wr.sceneNumber)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[90vh] flex flex-col safe-bottom",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Script Amendment Detected"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:yr})]}),jsxRuntimeExports.jsx("button",{onClick:lr,className:"p-2 -mr-2 text-text-muted active:text-gold",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:br?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-700",children:"Your existing breakdown data (confirmed characters, looks, continuity photos) will be preserved for modified scenes."})}),Er.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("h4",{className:"text-xs font-bold tracking-wider uppercase text-green-700",children:["New Scenes (",Er.length,")"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:cr,onChange:wr=>ur(wr.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Include"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:Er.map(wr=>jr(wr,"new"))})]}),vr.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("h4",{className:"text-xs font-bold tracking-wider uppercase text-amber-700",children:["Modified Scenes (",vr.length,")"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:dr,onChange:wr=>hr(wr.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Include"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:vr.map(wr=>jr(wr,"modified"))})]}),gr.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("h4",{className:"text-xs font-bold tracking-wider uppercase text-red-700",children:["Deleted Scenes (",gr.length,")"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:pr,onChange:wr=>mr(wr.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Mark as deleted"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:gr.map(wr=>jr(wr,"deleted"))})]})]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsx("p",{className:"text-text-primary font-medium",children:"No Changes Detected"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-1",children:"The script appears to be identical to your current breakdown."})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-t border-border shrink-0 space-y-2",children:br?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:_r,disabled:!cr&&!dr&&!pr,className:"w-full py-3 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50",children:"Apply Selected Changes"}),jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-full py-2 text-sm text-text-muted",children:"Cancel - Keep Current Version"})]}):jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-full py-3 rounded-button bg-gray-100 text-text-primary font-semibold text-base active:scale-[0.98] transition-transform",children:"Close"})})]})})}function AmendmentBadge({status:ar,onDismiss:or}){if(!ar||ar==="unchanged")return null;const cr={new:{bg:"bg-green-100",text:"text-green-700",border:"border-green-200",label:"NEW",icon:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})},modified:{bg:"bg-amber-100",text:"text-amber-700",border:"border-amber-200",label:"AMENDED",icon:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})},deleted:{bg:"bg-red-100",text:"text-red-700",border:"border-red-200",label:"REMOVED",icon:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}}[ar];return jsxRuntimeExports.jsxs("div",{className:clsx("inline-flex items-center gap-1 px-2 py-1 rounded-full border",cr.bg,cr.border),children:[jsxRuntimeExports.jsx("span",{className:cr.text,children:cr.icon}),jsxRuntimeExports.jsx("span",{className:clsx("text-[10px] font-bold",cr.text),children:cr.label}),or&&jsxRuntimeExports.jsx("button",{onClick:ur=>{ur.stopPropagation(),or()},className:clsx("ml-1 hover:opacity-70",cr.text),children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}function FilmingStatusDropdown({scene:ar,onStatusChange:or,onNotesModalOpen:lr}){const[cr,ur]=reactExports.useState(!1),dr=reactExports.useRef(null);reactExports.useEffect(()=>{const mr=fr=>{dr.current&&!dr.current.contains(fr.target)&&ur(!1)};if(cr)return document.addEventListener("mousedown",mr),()=>document.removeEventListener("mousedown",mr)},[cr]);const hr=ar.filmingStatus?SCENE_FILMING_STATUS_CONFIG[ar.filmingStatus]:null,pr=mr=>{ur(!1),mr==="complete"?or(ar.sceneNumber,mr):lr(ar.sceneNumber,mr)};return jsxRuntimeExports.jsxs("div",{ref:dr,className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:mr=>{mr.stopPropagation(),ur(!cr)},className:clsx("flex items-center gap-1.5 px-2 py-1 text-[10px] font-semibold rounded-lg flex-shrink-0 border transition-colors",hr?[hr.bgClass,hr.textClass,ar.filmingStatus==="complete"&&"border-green-200",ar.filmingStatus==="partial"&&"border-amber-200",ar.filmingStatus==="not-filmed"&&"border-red-200"]:"bg-gray-100 text-text-muted border-gray-200 hover:border-gray-300"),children:[hr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:clsx("w-2 h-2 rounded-full",ar.filmingStatus==="complete"&&"bg-green-500",ar.filmingStatus==="partial"&&"bg-amber-500",ar.filmingStatus==="not-filmed"&&"bg-red-500")}),hr.shortLabel]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),"Set Status"]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-3 h-3 transition-transform",cr&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),cr&&jsxRuntimeExports.jsx("div",{className:"absolute right-0 top-full mt-1 z-50 bg-white rounded-lg shadow-lg border border-border overflow-hidden min-w-[140px]",children:["complete","partial","not-filmed"].map(mr=>{const fr=SCENE_FILMING_STATUS_CONFIG[mr],xr=ar.filmingStatus===mr;return jsxRuntimeExports.jsxs("button",{onClick:Er=>{Er.stopPropagation(),pr(mr)},className:clsx("w-full flex items-center gap-2 px-3 py-2 text-xs font-medium transition-colors text-left",xr?`${fr.bgClass} ${fr.textClass}`:"hover:bg-gray-50 text-text-primary"),children:[jsxRuntimeExports.jsx("span",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{backgroundColor:fr.color}}),fr.label,xr&&jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 ml-auto text-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},mr)})})]})}function FilmingNotesModal({sceneNumber:ar,status:or,onConfirm:lr,onClose:cr}){const[ur,dr]=reactExports.useState(""),hr=SCENE_FILMING_STATUS_CONFIG[or];return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:cr,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg max-h-[80vh] overflow-y-auto",onClick:pr=>pr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:hr.color}}),jsxRuntimeExports.jsxs("h2",{className:"text-lg font-semibold text-text-primary",children:["Scene ",ar," - ",hr.label]})]}),jsxRuntimeExports.jsx("button",{onClick:cr,className:"p-2 -mr-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:or==="partial"?"What still needs to be filmed?":"Why wasn't this scene filmed?"}),jsxRuntimeExports.jsx("textarea",{value:ur,onChange:pr=>dr(pr.target.value),placeholder:"e.g., Ran out of time, weather issues, actor unavailable...",className:"w-full px-3 py-2.5 text-sm border border-border rounded-lg bg-card text-text-primary resize-none focus:outline-none focus:ring-2 focus:ring-gold/50 focus:border-gold",rows:4,autoFocus:!0})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:cr,className:"flex-1 py-2.5 rounded-button border border-border text-text-muted text-sm font-medium",children:"Cancel"}),jsxRuntimeExports.jsxs("button",{onClick:()=>lr(ur),className:clsx("flex-1 py-2.5 rounded-button text-white text-sm font-medium",or==="partial"?"bg-amber-500":"bg-red-500"),children:["Mark as ",hr.label]})]})]})]})})}function Breakdown({onSceneSelect:ar}){const{currentProject:or,sceneCaptures:lr,updateSceneFilmingStatus:cr,clearSingleSceneAmendment:ur}=useProjectStore(),dr=useScheduleStore(ns=>ns.schedule),[hr,pr]=reactExports.useState("scene-number"),[mr,fr]=reactExports.useState(!1),[xr,Er]=reactExports.useState({characters:[],location:null,completionStatus:"all",filmingStatus:"all",lookId:null}),[vr,gr]=reactExports.useState(null),[yr,br]=reactExports.useState(null),[_r,jr]=reactExports.useState(null),[wr,Sr]=reactExports.useState(!1),[Tr,Rr]=reactExports.useState(!1),Nr=reactExports.useCallback((ns,fs)=>{const bs=URL.createObjectURL(ns),Es=document.createElement("a");Es.href=bs,Es.download=fs,document.body.appendChild(Es),Es.click(),document.body.removeChild(Es),URL.revokeObjectURL(bs)},[]),Cr=reactExports.useCallback(async()=>{if(!(!or||wr)){Sr(!0),Rr(!1);try{const ns=generateSceneBreakdownCSV(or,lr),fs=new Blob([ns],{type:"text/csv"});Nr(fs,`${or.name}_Scene_Breakdown.csv`)}finally{Sr(!1)}}},[or,lr,wr,Nr]),kr=reactExports.useCallback(async()=>{if(!(!or||wr)){Sr(!0),Rr(!1);try{const ns=generateSceneBreakdownXLSX(or,lr),fs=new Blob([ns],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Nr(fs,`${or.name}_Scene_Breakdown.xlsx`)}finally{Sr(!1)}}},[or,lr,wr,Nr]),Ar=reactExports.useCallback(async()=>{!or||wr||Rr(ns=>!ns)},[or,wr]),[Or,Lr]=reactExports.useState(null),Fr=(ns,fs,bs)=>{cr(ns,fs,bs)},Hr=(ns,fs)=>{Lr({sceneNumber:ns,status:fs})},Kr=ns=>{Or&&(cr(Or.sceneNumber,Or.status,ns),Lr(null))},Gr=reactExports.useMemo(()=>!yr||!or?null:or.scenes.find(ns=>ns.id===yr)||null,[yr,or]),Zr=reactExports.useMemo(()=>!_r||!or?null:or.scenes.find(ns=>ns.id===_r)||null,[_r,or]),Jr=reactExports.useMemo(()=>{if(!or)return{total:0,confirmed:0};const ns=or.scenes.length,fs=or.scenes.filter(bs=>bs.characterConfirmationStatus==="confirmed").length;return{total:ns,confirmed:fs}},[or]),os=reactExports.useMemo(()=>{if(!or)return[];const ns=new Set;return or.scenes.forEach(fs=>{const bs=fs.slugline.match(/^(?:INT|EXT)\.\s*(.+?)\s*-/);bs&&ns.add(bs[1].trim())}),Array.from(ns).sort()},[or]),Ur=reactExports.useMemo(()=>{if(!or)return[];let ns=[...or.scenes];if(xr.characters.length>0&&(ns=ns.filter(fs=>xr.characters.some(bs=>fs.characters.includes(bs)))),xr.completionStatus==="complete"?ns=ns.filter(fs=>fs.isComplete):xr.completionStatus==="incomplete"&&(ns=ns.filter(fs=>!fs.isComplete)),xr.filmingStatus!=="all"&&(ns=ns.filter(fs=>fs.filmingStatus===xr.filmingStatus)),xr.location&&(ns=ns.filter(fs=>fs.slugline.toLowerCase().includes(xr.location.toLowerCase()))),xr.lookId){const fs=or.looks.find(bs=>bs.id===xr.lookId);fs&&(ns=ns.filter(bs=>fs.scenes.includes(bs.sceneNumber)))}if(hr==="shooting-order"&&(dr!=null&&dr.days)&&dr.days.length>0){const fs=new Map;for(const bs of dr.days)for(const Es of bs.scenes){const Ds=Es.sceneNumber.replace(/\s+/g,"").toUpperCase();fs.set(Ds,{day:bs.dayNumber,order:Es.shootOrder})}return ns.sort((bs,Es)=>{const Ds=bs.sceneNumber.replace(/\s+/g,"").toUpperCase(),gs=Es.sceneNumber.replace(/\s+/g,"").toUpperCase(),as=fs.get(Ds),qr=fs.get(gs);return!as&&!qr?bs.sceneNumber.localeCompare(Es.sceneNumber,void 0,{numeric:!0}):as?qr?as.day!==qr.day?as.day-qr.day:as.order-qr.order:-1:1})}return ns.sort((fs,bs)=>fs.sceneNumber.localeCompare(bs.sceneNumber,void 0,{numeric:!0}))},[or,xr,hr,dr]),Vr=reactExports.useMemo(()=>or?new Map(or.characters.map(ns=>[ns.id,ns])):new Map,[or==null?void 0:or.characters]),es=reactExports.useMemo(()=>{if(!or)return new Map;const ns=new Map;for(const fs of or.scenes){const bs=fs.characters.map(Es=>Vr.get(Es)).filter(Es=>Es!==void 0);ns.set(fs.id,bs)}return ns},[or==null?void 0:or.scenes,Vr]),Ir=reactExports.useMemo(()=>{if(!or)return new Map;const ns=new Map;for(const fs of or.scenes){const bs=fs.characters.length;let Es=0;fs.characters.forEach(Ds=>{const gs=`${fs.id}-${Ds}`,as=lr[gs];as&&Object.keys(as.photos).length>0&&Es++}),ns.set(fs.id,{captured:Es,total:bs})}return ns},[or==null?void 0:or.scenes,lr]),Dr=reactExports.useMemo(()=>{if(!or)return new Map;const ns=new Map;for(const fs of or.looks)for(const bs of fs.scenes)ns.set(`${fs.characterId}-${bs}`,fs);return ns},[or==null?void 0:or.looks]),Pr=ns=>Ir.get(ns.id)||{captured:0,total:0},Mr=ns=>es.get(ns.id)||[],Br=(ns,fs)=>Dr.get(`${ns}-${fs}`),Xr=(ns,fs)=>lr[`${ns}-${fs}`],Wr=()=>{Er({characters:[],location:null,completionStatus:"all",filmingStatus:"all",lookId:null})},ss=xr.characters.length>0||xr.location!==null||xr.completionStatus!=="all"||xr.filmingStatus!=="all"||xr.lookId!==null,ds=!!(dr!=null&&dr.days&&dr.days.length>0);return or?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Breakdown"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[ds&&jsxRuntimeExports.jsx("button",{onClick:()=>pr(hr==="scene-number"?"shooting-order":"scene-number"),className:clsx("p-2 rounded-lg transition-colors touch-manipulation",hr==="shooting-order"?"text-gold bg-gold-100/50":"text-text-muted hover:text-gold"),title:hr==="shooting-order"?"Sorted by shooting order":"Sort by shooting order",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5-3L16.5 18m0 0L12 13.5M16.5 18V4.5"})})}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:Ar,disabled:wr,className:"p-2 rounded-lg transition-colors touch-manipulation text-text-muted hover:text-gold disabled:opacity-50",title:"Export Scene Breakdown",children:wr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),Tr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>Rr(!1)}),jsxRuntimeExports.jsxs("div",{className:"absolute right-0 top-full mt-1 z-50 bg-card border border-border rounded-lg shadow-lg overflow-hidden min-w-[180px]",children:[jsxRuntimeExports.jsxs("button",{onClick:kr,className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-background flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M10.875 12c-.621 0-1.125.504-1.125 1.125M12 12c.621 0 1.125.504 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 0v1.5c0 .621-.504 1.125-1.125 1.125M12 15.375c.621 0 1.125-.504 1.125-1.125"})}),"Excel (.xlsx)"]}),jsxRuntimeExports.jsxs("button",{onClick:Cr,className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-background flex items-center gap-2 border-t border-border",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-blue-500 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})}),"CSV (.csv)"]})]})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>fr(!0),className:clsx("p-2 rounded-lg transition-colors touch-manipulation relative",ss?"text-gold bg-gold-100/50":"text-text-muted hover:text-gold"),children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75"})}),ss&&jsxRuntimeExports.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full bg-gold"})]})]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Ur.length," scene",Ur.length!==1?"s":"",ss&&" (filtered)"]}),hr==="shooting-order"&&jsxRuntimeExports.jsx("span",{className:"text-xs text-gold font-medium",children:"Shooting Order"})]}),Jr.total>0&&Jr.confirmed<Jr.total&&jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx(CharacterConfirmationProgress,{totalScenes:Jr.total,confirmedScenes:Jr.confirmed})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 pb-4",children:Ur.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("p",{className:"text-text-muted",children:"No scenes match your filters"}),jsxRuntimeExports.jsx("button",{onClick:Wr,className:"mt-3 text-sm text-gold font-medium",children:"Clear Filters"})]}):jsxRuntimeExports.jsx(BreakdownListView,{scenes:Ur,expandedSceneId:vr,onToggleExpand:ns=>gr(vr===ns?null:ns),onSceneSelect:ar,onSynopsisClick:ns=>br(ns),getCharactersForScene:Mr,getLookForCharacter:Br,getCapture:Xr,getSceneProgress:Pr,onCharacterConfirm:ns=>jr(ns),onFilmingStatusChange:Fr,onNotesModalOpen:Hr,onDismissAmendment:ns=>ur(ns)})}),mr&&jsxRuntimeExports.jsx(FilterDrawer,{filters:xr,characters:or.characters,locations:os,looks:or.looks,onFiltersChange:Er,onClose:()=>fr(!1),onClear:Wr}),Gr&&jsxRuntimeExports.jsx(SceneScriptModal,{scene:Gr,onClose:()=>br(null)}),Zr&&jsxRuntimeExports.jsx(SceneCharacterConfirmation,{scene:Zr,onClose:()=>jr(null),onConfirm:()=>jr(null)}),Or&&jsxRuntimeExports.jsx(FilmingNotesModal,{sceneNumber:Or.sceneNumber,status:Or.status,onConfirm:Kr,onClose:()=>Lr(null)})]}):jsxRuntimeExports.jsx(EmptyState$1,{})}const getGlassOverlayClass=ar=>{if(!ar)return null;switch(ar){case"complete":return"scene-glass-complete";case"partial":return"scene-glass-partial";case"not-filmed":return"scene-glass-incomplete";default:return null}};function BreakdownListView({scenes:ar,expandedSceneId:or,onToggleExpand:lr,onSceneSelect:cr,onSynopsisClick:ur,getCharactersForScene:dr,getLookForCharacter:hr,getCapture:pr,getSceneProgress:mr,onCharacterConfirm:fr,onFilmingStatusChange:xr,onNotesModalOpen:Er,onDismissAmendment:vr}){return jsxRuntimeExports.jsx("div",{className:"space-y-2",children:ar.map(gr=>{const yr=or===gr.id,br=dr(gr),_r=mr(gr),jr=_r.total>0&&_r.captured===_r.total,wr=gr.filmingStatus?SCENE_FILMING_STATUS_CONFIG[gr.filmingStatus]:null,Sr=getGlassOverlayClass(gr.filmingStatus),Tr=()=>{if(!gr.filmingStatus)return"accent-bar-neutral";switch(gr.filmingStatus){case"complete":return"accent-bar-complete";case"partial":return"accent-bar-partial";case"not-filmed":return"accent-bar-incomplete";default:return"accent-bar-neutral"}};return jsxRuntimeExports.jsxs("div",{className:"card overflow-hidden relative",children:[Sr&&jsxRuntimeExports.jsx("div",{className:clsx("scene-glass-overlay",Sr)}),jsxRuntimeExports.jsx("div",{className:clsx("absolute left-0 top-0 bottom-0 w-1 rounded-l-card",Tr())}),jsxRuntimeExports.jsxs("button",{onClick:()=>lr(gr.id),className:"w-full flex items-center gap-3 p-3 text-left touch-manipulation",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-text-primary min-w-[2rem]",children:gr.sceneNumber}),gr.amendmentStatus&&gr.amendmentStatus!=="unchanged"&&jsxRuntimeExports.jsx(AmendmentBadge,{status:gr.amendmentStatus,notes:gr.amendmentNotes,onDismiss:()=>vr(gr.id)})]}),jsxRuntimeExports.jsx("span",{className:clsx("px-1.5 py-0.5 text-[10px] font-bold rounded flex-shrink-0",gr.intExt==="INT"?"bg-slate-100 text-slate-600":"bg-stone-100 text-stone-600"),children:gr.intExt}),jsxRuntimeExports.jsx("span",{className:"flex-1 text-sm text-text-secondary truncate",children:gr.slugline.replace(/^(INT|EXT)\.\s*/,"").replace(/\s*-\s*(DAY|NIGHT|MORNING|EVENING|CONTINUOUS)$/i,"")}),jsxRuntimeExports.jsxs("span",{className:"flex-shrink-0 flex items-center -space-x-1.5",children:[br.slice(0,3).map(Rr=>jsxRuntimeExports.jsx(CharacterAvatar,{character:Rr,size:"xs"},Rr.id)),br.length>3&&jsxRuntimeExports.jsxs("span",{className:"w-5 h-5 rounded-full bg-gray-200 flex items-center justify-center text-[9px] font-bold text-text-muted",children:["+",br.length-3]})]}),jsxRuntimeExports.jsx(FilmingStatusDropdown,{scene:gr,onStatusChange:xr,onNotesModalOpen:Er}),jr&&jsxRuntimeExports.jsx("span",{className:"text-green-500 flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),!jr&&_r.captured>0&&jsxRuntimeExports.jsx("span",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0 bg-gold"}),jsxRuntimeExports.jsx("svg",{className:clsx("w-4 h-4 text-text-light transition-transform flex-shrink-0",yr&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),jsxRuntimeExports.jsxs("div",{className:"px-3 pb-3 pt-1 border-t border-border/50",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:gr.slugline}),(gr.synopsis||gr.scriptContent)&&jsxRuntimeExports.jsxs("button",{onClick:Rr=>{Rr.stopPropagation(),ur(gr.id)},className:"w-full text-left group mt-1.5",children:[gr.synopsis&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted italic line-clamp-2 group-hover:text-gold transition-colors",children:gr.synopsis}),gr.scriptContent&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-gold flex items-center gap-1 mt-1",children:[jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Tap to view full scene"]})]}),jsxRuntimeExports.jsx("div",{className:"mt-2 pt-2 border-t border-border/30",children:jsxRuntimeExports.jsxs("button",{onClick:Rr=>{Rr.stopPropagation(),fr(gr.id)},className:"inline-flex items-center gap-1 text-xs text-gold font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),br.length>0?"Edit characters":"Add characters"]})})]}),yr&&jsxRuntimeExports.jsxs("div",{className:"border-t border-border px-3 pb-3 pt-3 space-y-3",children:[gr.filmingStatus&&jsxRuntimeExports.jsxs("div",{className:clsx("p-2.5 rounded-lg",wr==null?void 0:wr.bgClass),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(FilmingStatusIcon,{status:gr.filmingStatus}),jsxRuntimeExports.jsx("span",{className:clsx("text-sm font-medium",wr==null?void 0:wr.textClass),children:wr==null?void 0:wr.label})]}),gr.filmingNotes&&jsxRuntimeExports.jsx("p",{className:clsx("text-xs mt-1.5",wr==null?void 0:wr.textClass),children:gr.filmingNotes})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:br.map(Rr=>{const Nr=hr(Rr.id,gr.sceneNumber),Cr=pr(gr.id,Rr.id),kr=Cr&&Object.keys(Cr.photos).length>0,Ar=Cr?Object.entries(Cr.continuityFlags).filter(([Or,Lr])=>Lr).map(([Or])=>Or):[];return jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:Rr,size:"sm"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:Rr.name}),Nr&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-gold ml-2",children:[" ",Nr.name]})]}),kr&&jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),Nr&&jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[11px]",children:[Nr.makeup.foundation&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-light",children:"Makeup:"})," ",jsxRuntimeExports.jsx("span",{className:"text-text-secondary",children:Nr.makeup.foundation})]}),Nr.hair.style&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-text-light",children:"Hair:"})," ",jsxRuntimeExports.jsx("span",{className:"text-text-secondary",children:Nr.hair.style})]})]}),Ar.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Ar.map(Or=>jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[9px] font-medium rounded bg-amber-100 text-amber-700 capitalize",children:Or.replace(/([A-Z])/g," $1").trim()},Or))}),Cr&&Object.keys(Cr.photos).length>0&&jsxRuntimeExports.jsx("div",{className:"flex gap-1 mt-2",children:["front","left","right","back"].map(Or=>{const Lr=Cr.photos[Or];return jsxRuntimeExports.jsx("div",{className:clsx("w-10 h-10 rounded overflow-hidden bg-gray-200",!Lr&&"opacity-30"),children:Lr&&jsxRuntimeExports.jsx("img",{src:Lr.thumbnail||Lr.uri,alt:Or,className:"w-full h-full object-cover"})},Or)})})]},Rr.id)})}),jsxRuntimeExports.jsx("button",{onClick:()=>cr(gr.id),className:"w-full py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-[0.98] transition-transform",children:_r.captured>0?"Edit Details":"Capture Continuity"})]})]},gr.id)})})}function FilmingStatusIcon({status:ar}){const or=SCENE_FILMING_STATUS_CONFIG[ar];return ar==="complete"?jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:or.color},children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}):ar==="partial"?jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:or.color},children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}):jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center",style:{backgroundColor:or.color},children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})}function FilterDrawer({filters:ar,characters:or,locations:lr,looks:cr,onFiltersChange:ur,onClose:dr,onClear:hr}){const pr=mr=>{const fr=ar.characters.includes(mr)?ar.characters.filter(xr=>xr!==mr):[...ar.characters,mr];ur({...ar,characters:fr})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:dr,children:jsxRuntimeExports.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-80 max-w-full bg-card shadow-xl overflow-y-auto",onClick:mr=>mr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold text-text-primary",children:"Filters"}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"p-1 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-5",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"FILMING STATUS"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ur({...ar,filmingStatus:"all"}),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full transition-colors",ar.filmingStatus==="all"?"bg-gold text-white":"bg-gray-100 text-text-muted"),children:"All"}),["complete","partial","not-filmed"].map(mr=>{const fr=SCENE_FILMING_STATUS_CONFIG[mr];return jsxRuntimeExports.jsxs("button",{onClick:()=>ur({...ar,filmingStatus:mr}),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full transition-colors flex items-center gap-1.5",ar.filmingStatus===mr?`${fr.bgClass} ${fr.textClass}`:"bg-gray-100 text-text-muted"),children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:fr.color}}),fr.shortLabel]},mr)})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"CONTINUITY STATUS"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:["all","complete","incomplete"].map(mr=>jsxRuntimeExports.jsx("button",{onClick:()=>ur({...ar,completionStatus:mr}),className:clsx("px-3 py-1.5 text-xs font-medium rounded-full transition-colors",ar.completionStatus===mr?"bg-gold text-white":"bg-gray-100 text-text-muted"),children:mr==="all"?"All":mr==="complete"?"Captured":"Not Captured"},mr))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"CHARACTERS"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:or.map(mr=>jsxRuntimeExports.jsxs("button",{onClick:()=>pr(mr.id),className:clsx("flex items-center gap-1.5 px-2.5 py-1.5 rounded-full text-xs font-medium transition-colors",ar.characters.includes(mr.id)?"bg-gold text-white":"bg-gray-100 text-text-muted"),children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:mr,size:"xs"}),mr.name.split(" ")[0]]},mr.id))})]}),lr.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"LOCATION"}),jsxRuntimeExports.jsxs("select",{value:ar.location||"",onChange:mr=>ur({...ar,location:mr.target.value||null}),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary",children:[jsxRuntimeExports.jsx("option",{value:"",children:"All Locations"}),lr.map(mr=>jsxRuntimeExports.jsx("option",{value:mr,children:mr},mr))]})]}),cr.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2",children:"LOOK"}),jsxRuntimeExports.jsxs("select",{value:ar.lookId||"",onChange:mr=>ur({...ar,lookId:mr.target.value||null}),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary",children:[jsxRuntimeExports.jsx("option",{value:"",children:"All Looks"}),cr.map(mr=>{const fr=or.find(xr=>xr.id===mr.characterId);return jsxRuntimeExports.jsxs("option",{value:mr.id,children:[fr==null?void 0:fr.name.split(" ")[0]," - ",mr.name]},mr.id)})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"sticky bottom-0 bg-card border-t border-border p-4 flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:hr,className:"flex-1 py-2.5 rounded-button border border-border text-text-muted text-sm font-medium",children:"Clear All"}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"flex-1 py-2.5 rounded-button gold-gradient text-white text-sm font-medium",children:"Apply"})]})]})})}function EmptyState$1(){return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"h-14 px-4 flex items-center",children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Breakdown"})})})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125"})})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:"No Breakdown Data"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Sync from desktop or upload a script to generate scenes"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{className:"px-4 py-2.5 rounded-button border border-gold text-gold text-sm font-medium active:scale-95 transition-transform",children:"Sync Now"}),jsxRuntimeExports.jsx("button",{className:"px-4 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform",children:"Upload Script"})]})]})]})}function LookCard({look:ar,character:or,progress:lr}){const{currentProject:cr,sceneCaptures:ur,setCurrentLook:dr}=useProjectStore(),hr=lr.total>0?lr.captured/lr.total*100:0,pr=lr.captured===lr.total&&lr.total>0,fr=(()=>{if(!cr)return null;for(let xr=ar.scenes.length-1;xr>=0;xr--){const Er=ar.scenes[xr],vr=cr.scenes.find(gr=>gr.sceneNumber===Er);if(vr){const gr=`${vr.id}-${ar.characterId}`,yr=ur[gr];if(yr&&(yr.photos.front||yr.additionalPhotos.length>0))return{sceneNum:Er,capture:yr}}}return null})();return jsxRuntimeExports.jsx("div",{className:"bg-card rounded-card overflow-hidden shadow-card",children:jsxRuntimeExports.jsxs("button",{onClick:()=>dr(ar.id),className:"w-full p-4 text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-2 mb-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h4",{className:"text-[15px] font-bold text-text-primary",children:ar.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Scenes ",ar.scenes.join(", "),"  ~",ar.estimatedTime," min"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:`text-[11px] font-semibold ${pr?"text-success":"text-gold"}`,children:[lr.captured,"/",lr.total]}),jsxRuntimeExports.jsx("svg",{className:"w-[18px] h-[18px] text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]}),jsxRuntimeExports.jsx("div",{className:"mb-3",children:jsxRuntimeExports.jsx("div",{className:"h-[3px] bg-gray-100 rounded-sm overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:`h-full rounded-sm transition-all duration-300 ${pr?"bg-success":"gold-gradient"}`,style:{width:`${hr}%`}})})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-[60px] h-[60px] rounded-lg bg-input-bg border border-border flex-shrink-0 overflow-hidden flex items-center justify-center",children:ar.masterReference?jsxRuntimeExports.jsx("img",{src:ar.masterReference.thumbnail||ar.masterReference.uri,alt:"Master reference",className:"w-full h-full object-cover"}):jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),fr?jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("span",{className:"text-[9px] font-semibold tracking-wider uppercase text-text-light block mb-1.5",children:["Scene ",fr.sceneNum]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-4 gap-1",children:["front","left","right","back"].map(xr=>{const Er=fr.capture.photos[xr];return jsxRuntimeExports.jsx("div",{className:`aspect-[3/4] rounded ${Er?"bg-gray-200 border border-gold":"bg-input-bg border border-border"} flex items-center justify-center`,children:Er?jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}):jsxRuntimeExports.jsx("svg",{className:"w-2.5 h-2.5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"})})},xr)})})]}):jsxRuntimeExports.jsx("div",{className:"flex-1 bg-input-bg rounded-lg p-3 text-center",children:jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-light",children:"No captures yet"})})]})]})})}function CharacterSection({character:ar,looks:or,capturedScenes:lr,totalScenes:cr,getCaptureProgress:ur,onAddLook:dr}){const[hr,pr]=reactExports.useState(!1),[mr,fr]=reactExports.useState(!1),[xr,Er]=reactExports.useState(!1),{getCastProfile:vr,updateCastProfile:gr}=useProjectStore(),yr=vr(ar.id)||createEmptyCastProfile(ar.id),br=yr.actorName||yr.phone||yr.email||yr.allergies||yr.specialRequirements||yr.profilePhotoUri;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>pr(!hr),className:"w-full py-3 flex items-center justify-between text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[yr.profilePhotoUri?jsxRuntimeExports.jsx("img",{src:yr.profilePhotoUri,alt:ar.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-semibold flex-shrink-0",style:{background:`linear-gradient(135deg, ${ar.avatarColour||"#C9A962"} 0%, ${adjustColor(ar.avatarColour||"#C9A962",-20)} 100%)`},children:ar.actorNumber??ar.initials}),jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-[17px] font-bold text-gold truncate",children:ar.name}),ar.actorNumber&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-muted font-medium",children:["#",ar.actorNumber]})]}),yr.actorName&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-secondary truncate",children:yr.actorName}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-0.5",children:[or.length," look",or.length!==1?"s":"","  ",lr,"/",cr," scenes"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[br&&jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full bg-success",title:"Profile complete"}),yr.allergies&&jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500",title:"Has allergies"})]})]}),jsxRuntimeExports.jsx("svg",{className:`w-5 h-5 text-text-light transition-transform duration-200 flex-shrink-0 ${hr?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),jsxRuntimeExports.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${hr?"max-h-[3000px] opacity-100":"max-h-0 opacity-0"}`,children:jsxRuntimeExports.jsxs("div",{className:"pl-[52px] space-y-2.5",children:[jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-card shadow-card overflow-hidden",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>fr(!mr),className:"w-full px-4 py-3 flex items-center justify-between text-left touch-manipulation",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-text-muted uppercase tracking-wide",children:"Cast Profile"}),jsxRuntimeExports.jsx("svg",{className:`w-4 h-4 text-text-muted transition-transform ${mr?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),mr&&jsxRuntimeExports.jsxs("div",{className:"px-4 pb-4 pt-1 space-y-3 border-t border-border",children:[yr.profilePhotoUri&&jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("img",{src:yr.profilePhotoUri,alt:yr.actorName||ar.name,className:"w-20 h-20 rounded-full object-cover border-2 border-gold"})}),yr.actorName&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"ACTOR"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary mt-0.5",children:yr.actorName})]}),(yr.phone||yr.email)&&jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[yr.phone&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"PHONE"}),jsxRuntimeExports.jsx("a",{href:`tel:${yr.phone}`,className:"text-sm text-gold mt-0.5 block",children:yr.phone})]}),yr.email&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"EMAIL"}),jsxRuntimeExports.jsx("a",{href:`mailto:${yr.email}`,className:"text-sm text-gold mt-0.5 block truncate",children:yr.email})]})]}),(yr.agentName||yr.agentPhone||yr.agentEmail)&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"AGENT"}),jsxRuntimeExports.jsxs("div",{className:"mt-1 text-sm",children:[yr.agentName&&jsxRuntimeExports.jsx("p",{className:"text-text-primary",children:yr.agentName}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mt-0.5",children:[yr.agentPhone&&jsxRuntimeExports.jsx("a",{href:`tel:${yr.agentPhone}`,className:"text-gold",children:yr.agentPhone}),yr.agentEmail&&jsxRuntimeExports.jsx("a",{href:`mailto:${yr.agentEmail}`,className:"text-gold truncate",children:yr.agentEmail})]})]})]}),yr.allergies&&jsxRuntimeExports.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-red-600 uppercase tracking-wide",children:"ALLERGIES"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700 mt-0.5",children:yr.allergies})]}),yr.specialRequirements&&jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-amber-600 uppercase tracking-wide",children:"SPECIAL REQUIREMENTS"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-700 mt-0.5",children:yr.specialRequirements})]}),yr.skinType&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"SKIN TYPE"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary mt-0.5",children:yr.skinType})]}),yr.notes&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-semibold text-text-muted uppercase tracking-wide",children:"NOTES"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mt-0.5",children:yr.notes})]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",fullWidth:!0,onClick:()=>Er(!0),children:br?"Edit Profile":"Add Profile Information"})]})]}),or.length>0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[or.map(_r=>jsxRuntimeExports.jsx(LookCard,{look:_r,character:ar,progress:ur(_r)},_r.id)),jsxRuntimeExports.jsxs("button",{onClick:dr,className:"w-full py-3.5 flex items-center justify-center gap-1.5 text-[13px] font-medium text-text-muted bg-card border-2 border-dashed border-gray-200 rounded-card hover:border-gold-300 hover:text-gold transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add New Look"]})]}):jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-card p-6 text-center",children:[jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300 mx-auto mb-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253",strokeLinecap:"round",strokeLinejoin:"round"})}),jsxRuntimeExports.jsx("p",{className:"text-[13px] text-text-muted mb-1",children:"No looks defined"}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mb-3",children:"Sync from desktop or create manually"}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"px-5 py-2.5 rounded-full bg-gold-100/50 text-gold text-xs font-semibold",children:"+ Add Look"})]})]})})]}),jsxRuntimeExports.jsx(EditCastProfileModal,{isOpen:xr,onClose:()=>Er(!1),character:ar,profile:yr,onSave:_r=>{gr(ar.id,_r),Er(!1)}})]})}function EditCastProfileModal({isOpen:ar,onClose:or,character:lr,profile:cr,onSave:ur}){const[dr,hr]=reactExports.useState(cr.actorName),[pr,mr]=reactExports.useState(cr.phone),[fr,xr]=reactExports.useState(cr.email),[Er,vr]=reactExports.useState(cr.agentName),[gr,yr]=reactExports.useState(cr.agentPhone),[br,_r]=reactExports.useState(cr.agentEmail),[jr,wr]=reactExports.useState(cr.allergies),[Sr,Tr]=reactExports.useState(cr.specialRequirements),[Rr,Nr]=reactExports.useState(cr.skinType),[Cr,kr]=reactExports.useState(cr.notes),[Ar,Or]=reactExports.useState(cr.profilePhotoUri||""),Lr=reactExports.useRef(null),Fr=Kr=>{var Jr;const Gr=(Jr=Kr.target.files)==null?void 0:Jr[0];if(!Gr)return;const Zr=new FileReader;Zr.onload=()=>{const os=new Image;os.onload=()=>{const Ur=document.createElement("canvas"),Vr=256;Ur.width=Vr,Ur.height=Vr;const es=Ur.getContext("2d"),Ir=Math.min(os.width,os.height),Dr=(os.width-Ir)/2,Pr=(os.height-Ir)/2;es.drawImage(os,Dr,Pr,Ir,Ir,0,0,Vr,Vr),Or(Ur.toDataURL("image/jpeg",.8))},os.src=Zr.result},Zr.readAsDataURL(Gr),Kr.target.value=""},Hr=()=>{ur({actorName:dr,phone:pr,email:fr,agentName:Er,agentPhone:gr,agentEmail:br,allergies:jr,specialRequirements:Sr,skinType:Rr,notes:Cr,profilePhotoUri:Ar||void 0})};return jsxRuntimeExports.jsx(BottomSheet,{isOpen:ar,onClose:or,title:`${lr.name} - Cast Profile`,height:"auto",children:jsxRuntimeExports.jsxs("div",{className:"space-y-4 pb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-2",children:[jsxRuntimeExports.jsx("input",{ref:Lr,type:"file",accept:"image/*",onChange:Fr,className:"hidden"}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>{var Kr;return(Kr=Lr.current)==null?void 0:Kr.click()},className:"relative group",children:[Ar?jsxRuntimeExports.jsx("img",{src:Ar,alt:"Headshot",className:"w-20 h-20 rounded-full object-cover border-2 border-gold"}):jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-input-bg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 right-0 w-6 h-6 rounded-full bg-gold flex items-center justify-center shadow-sm",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]}),jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-muted",children:Ar?"Tap to change headshot":"Add headshot"}),Ar&&jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Or(""),className:"text-[11px] text-red-500 font-medium",children:"Remove photo"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Actor Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Input,{label:"ACTOR NAME",value:dr,onChange:Kr=>hr(Kr.target.value),placeholder:"Full name"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{label:"PHONE",value:pr,onChange:Kr=>mr(Kr.target.value),placeholder:"+44...",type:"tel"}),jsxRuntimeExports.jsx(Input,{label:"EMAIL",value:fr,onChange:Kr=>xr(Kr.target.value),placeholder:"actor@email.com",type:"email"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Agent Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Input,{label:"AGENT NAME",value:Er,onChange:Kr=>vr(Kr.target.value),placeholder:"Agent or agency name"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx(Input,{label:"AGENT PHONE",value:gr,onChange:Kr=>yr(Kr.target.value),placeholder:"+44...",type:"tel"}),jsxRuntimeExports.jsx(Input,{label:"AGENT EMAIL",value:br,onChange:Kr=>_r(Kr.target.value),placeholder:"agent@agency.com",type:"email"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-text-primary mb-2",children:"Health & Requirements"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Textarea,{label:"ALLERGIES",value:jr,onChange:Kr=>wr(Kr.target.value),placeholder:"List any allergies (latex, adhesives, specific products...)",rows:2}),jsxRuntimeExports.jsx(Textarea,{label:"SPECIAL REQUIREMENTS",value:Sr,onChange:Kr=>Tr(Kr.target.value),placeholder:"Sensitive skin, prefers certain products, etc.",rows:2}),jsxRuntimeExports.jsx(Input,{label:"SKIN TYPE",value:Rr,onChange:Kr=>Nr(Kr.target.value),placeholder:"Oily, dry, combination, sensitive..."})]})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Textarea,{label:"ADDITIONAL NOTES",value:Cr,onChange:Kr=>kr(Kr.target.value),placeholder:"Any other relevant information...",rows:3})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"lg",fullWidth:!0,onClick:or,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:Hr,children:"Save Profile"})]})]})})}function adjustColor(ar,or){const lr=parseInt(ar.replace("#",""),16),cr=Math.max(0,Math.min(255,(lr>>16)+or)),ur=Math.max(0,Math.min(255,(lr>>8&255)+or)),dr=Math.max(0,Math.min(255,(lr&255)+or));return`#${((1<<24)+(cr<<16)+(ur<<8)+dr).toString(16).slice(1)}`}function AddLookModal({isOpen:ar,onClose:or,preselectedCharacterId:lr}){const{currentProject:cr,setProject:ur}=useProjectStore(),[dr,hr]=reactExports.useState(""),[pr,mr]=reactExports.useState(""),[fr,xr]=reactExports.useState(""),[Er,vr]=reactExports.useState(""),[gr,yr]=reactExports.useState("30");reactExports.useEffect(()=>{var _r;ar&&(hr(lr||((_r=cr==null?void 0:cr.characters[0])==null?void 0:_r.id)||""),mr(""),xr(""),vr(""),yr("30"))},[ar,lr,cr]),reactExports.useEffect(()=>{if(dr&&cr){const jr=cr.looks.filter(wr=>wr.characterId===dr).length+1;mr(`Day ${jr}`)}},[dr,cr]);const br=()=>{if(!cr||!dr||!pr.trim())return;const _r=parseInt(fr,10)||1,jr=parseInt(Er,10)||_r,wr=[];for(let Rr=Math.min(_r,jr);Rr<=Math.max(_r,jr);Rr++)wr.push(String(Rr));const Sr={id:v4(),characterId:dr,name:pr.trim(),scenes:wr,estimatedTime:parseInt(gr,10)||30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()},Tr=cr.looks.map(Rr=>{if(Rr.characterId===dr&&wr.length>0){const Nr=Rr.scenes.filter(Cr=>!wr.includes(Cr));if(Nr.length!==Rr.scenes.length)return{...Rr,scenes:Nr}}return Rr});ur({...cr,looks:[...Tr,Sr],updatedAt:new Date}),or()};return reactExports.useEffect(()=>(ar?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[ar]),ar?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm animate-fadeIn",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp max-h-[85vh] overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Add New Look"}),jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -m-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"CHARACTER"}),jsxRuntimeExports.jsx("select",{value:dr,onChange:_r=>hr(_r.target.value),className:"input-field w-full",children:cr==null?void 0:cr.characters.map(_r=>jsxRuntimeExports.jsx("option",{value:_r.id,children:_r.name},_r.id))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"LOOK NAME"}),jsxRuntimeExports.jsx("input",{type:"text",value:pr,onChange:_r=>mr(_r.target.value),placeholder:"e.g., Day 1 - Professional",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:'Suggest descriptive names like "Day 1 - Office", "Post-Fight", etc.'})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"SCENE RANGE"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("input",{type:"number",value:fr,onChange:_r=>xr(_r.target.value),placeholder:"Start",min:"1",className:"input-field w-24 text-center"}),jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"to"}),jsxRuntimeExports.jsx("input",{type:"number",value:Er,onChange:_r=>vr(_r.target.value),placeholder:"End",min:"1",className:"input-field w-24 text-center"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Which scenes use this look? You can adjust later."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"ESTIMATED APPLICATION TIME"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{type:"number",value:gr,onChange:_r=>yr(_r.target.value),min:"5",step:"5",className:"input-field w-24 text-center"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-gold-50 rounded-lg p-3",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gold-dark font-medium",children:"Standalone Mode"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"You can add makeup and hair details after creating the look, or sync from desktop for full specifications."})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-border flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"flex-1 py-3 px-4 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:br,disabled:!dr||!pr.trim(),className:"flex-1 py-3 px-4 rounded-button gold-gradient text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Look"})]})]})}):null}function LookOverview({lookId:ar,onBack:or,onSceneClick:lr}){const{currentProject:cr,getCharacter:ur,sceneCaptures:dr,updateLookWithPropagation:hr,updateLook:pr}=useProjectStore(),[mr,fr]=reactExports.useState(!1),[xr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(!1),[yr,br]=reactExports.useState([]),[_r,jr]=reactExports.useState(0),[wr,Sr]=reactExports.useState(!1),[Tr,Rr]=reactExports.useState(!1),[Nr,Cr]=reactExports.useState(""),[kr,Ar]=reactExports.useState(!1),[Or,Lr]=reactExports.useState(""),Fr=reactExports.useRef(null),Hr=reactExports.useRef(null),Kr=cr==null?void 0:cr.looks.find(as=>as.id===ar),Gr=Kr?ur(Kr.characterId):void 0;if(!Kr||!Gr||!cr)return null;const Jr=cr.scenes.filter(as=>Kr.scenes.includes(as.sceneNumber)).map(as=>{const qr=`${as.id}-${Kr.characterId}`,ts=dr[qr],Yr=ts==null?void 0:ts.photos.front;return{scene:as,frontPhoto:Yr,hasCaptured:!!ts&&!!(ts.photos.front||ts.additionalPhotos.length>0)}}),os=Kr.continuityFlags||createEmptyContinuityFlags(),Ur=Kr.sfxDetails||createEmptySFXDetails(),Vr=Kr.notes||"",es=Kr.continuityEvents||[],Ir=(as=!1)=>{Sr(as),fr(!0)},Dr=async as=>{const qr=await createPhotoFromBlob(as);if(wr){const ts=Kr.sfxDetails||createEmptySFXDetails();hr(Kr.id,{sfxDetails:{...ts,sfxReferencePhotos:[...ts.sfxReferencePhotos,qr]}})}else pr(Kr.id,{masterReference:qr})},Pr=()=>{pr(Kr.id,{masterReference:void 0})},Mr=()=>{Kr.masterReference&&(br([Kr.masterReference]),jr(0),gr(!0))},Br=as=>{const qr={...os,[as]:!os[as]};hr(Kr.id,{continuityFlags:qr})},Xr=as=>{const qr={...as,id:`event-${Date.now()}`};pr(Kr.id,{continuityEvents:[...es,qr]}),Er(!1)},Wr=as=>{pr(Kr.id,{continuityEvents:es.filter(qr=>qr.id!==as)})},ss=as=>{hr(Kr.id,{sfxDetails:as})},ds=as=>{const qr=Kr.sfxDetails||createEmptySFXDetails();pr(Kr.id,{sfxDetails:{...qr,sfxReferencePhotos:qr.sfxReferencePhotos.filter(ts=>ts.id!==as)}})},ns=as=>{hr(Kr.id,{notes:as})},fs=()=>{Cr(Kr.name),Rr(!0)};reactExports.useEffect(()=>{Tr&&Fr.current&&(Fr.current.focus(),Fr.current.select())},[Tr]);const bs=()=>{const as=Nr.trim();as&&as!==Kr.name&&pr(Kr.id,{name:as}),Rr(!1)},Es=()=>{Lr(formatSceneRange(Kr.scenes)),Ar(!0)};reactExports.useEffect(()=>{kr&&Hr.current&&Hr.current.focus()},[kr]);const Ds=()=>{const as=parseSceneRange(Or);if(as.length>0){const qr=as.map(String);if(cr)if(cr.looks.filter(hs=>hs.characterId===Kr.characterId&&hs.id!==Kr.id).some(hs=>hs.scenes.some(ys=>qr.includes(ys)))){const hs=cr.looks.map(_s=>{if(_s.id===Kr.id)return{..._s,scenes:qr};if(_s.characterId===Kr.characterId){const Ss=_s.scenes.filter(vs=>!qr.includes(vs));if(Ss.length!==_s.scenes.length)return{..._s,scenes:Ss}}return _s}),{setProject:ys}=useProjectStore.getState();ys({...cr,looks:hs,updatedAt:new Date})}else pr(Kr.id,{scenes:qr})}Ar(!1)},gs=as=>{var qr;((qr=Kr.masterReference)==null?void 0:qr.id)===as&&Pr(),br(ts=>ts.filter(Yr=>Yr.id!==as))};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"w-8 h-8 flex items-center justify-center -ml-1",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-[17px] font-bold text-text-primary flex-1",children:"Look Overview"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"px-4 py-4 space-y-2.5 pb-32",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3.5",children:[jsxRuntimeExports.jsx(CharacterAvatar,{character:Gr,size:"xl"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h2",{className:"text-character-name text-gold font-bold truncate",children:Gr.name}),Tr?jsxRuntimeExports.jsx("div",{className:"mt-0.5 flex items-center gap-1.5",children:jsxRuntimeExports.jsx("input",{ref:Fr,type:"text",value:Nr,onChange:as=>Cr(as.target.value),onBlur:bs,onKeyDown:as=>{as.key==="Enter"&&bs(),as.key==="Escape"&&Rr(!1)},className:"input-field text-sm font-semibold py-1 px-2 w-full",placeholder:"Look name"})}):jsxRuntimeExports.jsxs("button",{onClick:fs,className:"flex items-center gap-1 mt-0.5 group",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-text-primary",children:Kr.name}),jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-text-light group-active:text-gold transition-colors flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})]}),kr?jsxRuntimeExports.jsxs("div",{className:"mt-1 flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted flex-shrink-0",children:"Scenes"}),jsxRuntimeExports.jsx("input",{ref:Hr,type:"text",value:Or,onChange:as=>Lr(as.target.value),onBlur:Ds,onKeyDown:as=>{as.key==="Enter"&&Ds(),as.key==="Escape"&&Ar(!1)},className:"input-field text-xs py-1 px-2 flex-1 min-w-0",placeholder:"e.g. 1-4, 6-12"})]}):jsxRuntimeExports.jsxs("button",{onClick:Es,className:"flex items-center gap-1 mt-0.5 group",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:["Scenes ",formatSceneRange(Kr.scenes)," "," ","~",formatEstimatedTime(Kr.estimatedTime)]}),jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-text-light group-active:text-gold transition-colors flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})]})]})]}),(()=>{const as=[{key:"sweat",label:"Sweat"},{key:"dishevelled",label:"Dishevelled"},{key:"blood",label:"Blood"},{key:"dirt",label:"Dirt"},{key:"wetHair",label:"Wet Hair"},{key:"tears",label:"Tears"}].filter(({key:qr})=>os[qr]);return as.length===0?null:jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:as.map(({key:qr,label:ts})=>jsxRuntimeExports.jsx("span",{className:"px-3 py-1.5 text-xs font-semibold rounded-full bg-gold text-white",children:ts},qr))})})(),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"MASTER REFERENCE"}),jsxRuntimeExports.jsx(MasterReference,{photo:Kr.masterReference,onCapture:()=>Ir(!1),onView:Mr,onRemove:Kr.masterReference?Pr:void 0}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-2",children:"This reference applies to all scenes in this look"})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"SCENE CONTINUITY"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-light",children:[Jr.filter(as=>as.hasCaptured).length,"/",Jr.length," captured"]})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-3 overflow-x-auto hide-scrollbar pb-1 -mx-1 px-1",children:Jr.map(({scene:as,frontPhoto:qr,hasCaptured:ts})=>jsxRuntimeExports.jsxs("button",{onClick:()=>lr(as.id),className:"flex-shrink-0 w-20 group",children:[jsxRuntimeExports.jsx("div",{className:`aspect-[3/4] rounded-lg overflow-hidden border-2 transition-colors ${ts?"border-gold bg-gray-100":"border-gray-200 bg-gray-50"}`,children:qr?jsxRuntimeExports.jsx("img",{src:qr.thumbnail||qr.uri,alt:`Scene ${as.sceneNumber}`,className:"w-full h-full object-cover"}):jsxRuntimeExports.jsx("div",{className:"w-full h-full flex items-center justify-center",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),jsxRuntimeExports.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),jsxRuntimeExports.jsx("path",{d:"M21 15l-5-5L5 21"})]})})}),jsxRuntimeExports.jsxs("div",{className:`text-center mt-1.5 text-[10px] font-semibold ${ts?"text-gold":"text-text-muted"}`,children:["Sc ",as.sceneNumber]})]},as.id))})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h3",{className:"section-header mb-3",children:"QUICK FLAGS"}),jsxRuntimeExports.jsx(QuickFlags,{flags:os,onToggle:Br}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-2",children:"Flags set here apply to all scenes in this look"})]}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx(ContinuityEvents,{events:es,onAddEvent:()=>Er(!0),onRemoveEvent:Wr})}),jsxRuntimeExports.jsx(Accordion,{title:"MAKEUP",count:countFilledFields(Kr.makeup),children:jsxRuntimeExports.jsx(MakeupForm,{makeup:Kr.makeup,onChange:as=>hr(Kr.id,{makeup:as})})}),jsxRuntimeExports.jsx(Accordion,{title:"HAIR",count:countHairFields(Kr.hair),children:jsxRuntimeExports.jsx(HairForm,{hair:Kr.hair,onChange:as=>hr(Kr.id,{hair:as})})}),jsxRuntimeExports.jsx(Accordion,{title:"SPECIAL EFFECTS",count:countSFXFields(Ur),badge:Ur.sfxRequired?void 0:"None",children:jsxRuntimeExports.jsx(SFXForm,{sfx:Ur,onChange:ss,onCapturePhoto:()=>Ir(!0),onRemovePhoto:ds})}),jsxRuntimeExports.jsxs(Accordion,{title:"LOOK NOTES",children:[jsxRuntimeExports.jsx(NotesForm,{notes:Vr,onChange:ns}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-2",children:"Notes set here auto-fill into all scenes for this look"})]}),jsxRuntimeExports.jsxs("div",{className:"card flex items-center gap-3.5",children:[jsxRuntimeExports.jsx("label",{className:"field-label whitespace-nowrap",children:"APPLICATION TIME"}),jsxRuntimeExports.jsx("input",{type:"number",value:Kr.estimatedTime||"",onChange:as=>pr(Kr.id,{estimatedTime:as.target.value?parseInt(as.target.value,10):0}),className:"input-field w-16 text-center font-semibold",placeholder:"--",min:"0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"minutes"})]})]})}),jsxRuntimeExports.jsx(PhotoCapture,{isOpen:mr,onClose:()=>fr(!1),onCapture:Dr,angle:"front",characterName:Gr.name,sceneNumber:Kr.scenes[0]||"",lookName:Kr.name}),jsxRuntimeExports.jsx(AddEventModal,{isOpen:xr,onClose:()=>Er(!1),onAdd:Xr,availableScenes:Kr.scenes}),jsxRuntimeExports.jsx(PhotoViewer,{isOpen:vr,photos:yr,initialIndex:_r,onClose:()=>gr(!1),onDelete:gs})]})}function SyncStatusBar(){const{status:ar,onlineMembers:or,lastSyncedAt:lr,pendingChanges:cr}=useSyncStore(),ur=useProjectStore(yr=>yr.currentProject),[dr,hr]=reactExports.useState(!1),[,pr]=reactExports.useState(0);if(reactExports.useEffect(()=>{const yr=setInterval(()=>pr(br=>br+1),3e4);return()=>clearInterval(yr)},[]),!ur)return null;const mr=async()=>{if(!(dr||ar==="syncing")){hr(!0);try{const yr=getActiveProjectId()||ur.id;await pullProjectData(yr)}catch(yr){console.error("[ManualSync] Failed:",yr)}finally{hr(!1)}}},fr=ar==="syncing"||dr,xr={idle:{color:"text-gray-400",label:"Not connected",icon:"idle"},syncing:{color:"text-warning",label:"Syncing...",icon:"syncing"},synced:{color:"text-success",label:"Synced",icon:"synced"},error:{color:"text-destructive",label:"Sync error  tap to retry",icon:"error"},offline:{color:"text-gray-400",label:"Offline",icon:"offline"}},{color:Er,label:vr}=xr[fr?"syncing":ar],gr=lr?getTimeAgo(lr):null;return jsxRuntimeExports.jsx("button",{onClick:mr,disabled:fr,className:"w-full bg-card/80 backdrop-blur-sm border-b border-border/50 active:bg-gray-50 transition-colors",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-8 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${fr?"bg-warning animate-pulse":ar==="synced"?"bg-success":ar==="error"?"bg-destructive":"bg-gray-400"}`}),jsxRuntimeExports.jsx("span",{className:`text-[11px] font-medium ${Er}`,children:fr?"Syncing...":vr}),gr&&!fr&&ar==="synced"&&jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-light",children:gr}),cr>0&&!fr&&jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-warning",children:[cr," pending"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[or>1&&jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-text-muted",children:[or," online"]}),jsxRuntimeExports.jsxs("svg",{className:`w-3.5 h-3.5 text-text-muted ${fr?"animate-spin":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("polyline",{points:"23 4 23 10 17 10"}),jsxRuntimeExports.jsx("polyline",{points:"1 20 1 14 7 14"}),jsxRuntimeExports.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})]})]})})})}function SyncStatusBanner(){const{status:ar,onlineMembers:or,lastSyncedAt:lr}=useSyncStore(),cr={idle:{color:"bg-gray-400",label:"Not connected"},syncing:{color:"bg-warning animate-pulse",label:"Syncing..."},synced:{color:"bg-success",label:"Synced"},error:{color:"bg-destructive",label:"Sync error"},offline:{color:"bg-gray-400",label:"Working offline"}},{color:ur,label:dr}=cr[ar],hr=lr?getTimeAgo(lr):null;return jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-[10px] px-4 py-3 mb-4 flex items-center justify-between shadow-card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2.5",children:[jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${ur}`}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-secondary",children:dr}),hr&&ar==="synced"&&jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:hr})]}),or>1&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("div",{className:"flex -space-x-1",children:Array.from({length:Math.min(or,3)}).map((pr,mr)=>jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-gold/20 border border-card flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[8px] text-gold font-medium",children:mr+1})},mr))}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[or," online"]})]})]})}function getTimeAgo(ar){const or=Math.floor((Date.now()-ar.getTime())/1e3);if(or<10)return"just now";if(or<60)return`${or}s ago`;const lr=Math.floor(or/60);return lr<60?`${lr}m ago`:`${Math.floor(lr/60)}h ago`}function Lookbooks(){const{currentProject:ar,sceneCaptures:or,currentLookId:lr,setCurrentLook:cr,setActiveTab:ur,setCurrentScene:dr}=useProjectStore(),{schedule:hr}=useScheduleStore(),{callSheets:pr}=useCallSheetStore(),[mr,fr]=reactExports.useState(!1),[xr,Er]=reactExports.useState(null),vr=reactExports.useMemo(()=>{const kr=new Map;for(const Ar of pr)for(const Or of Ar.scenes)if(Or.cast)for(const Lr of Or.cast){const Fr=parseInt(Lr,10);isNaN(Fr)||(kr.has(Fr)||kr.set(Fr,new Set),kr.get(Fr).add(Or.sceneNumber))}return kr},[pr]),gr=reactExports.useMemo(()=>{const kr=new Map;return ar!=null&&ar.characters&&ar.characters.forEach(Ar=>{kr.set(Ar.id,{...Ar})}),hr!=null&&hr.castList&&hr.castList.forEach(Ar=>{const Or=(Ar.character||Ar.name).toUpperCase(),Lr=ar==null?void 0:ar.characters.find(Fr=>Fr.name.toUpperCase()===Or);if(Lr){const Fr=kr.get(Lr.id);Fr&&(Fr.actorNumber=Ar.number,kr.set(Lr.id,Fr))}else{const Fr=Ar.character||Ar.name,Hr=`cast-${Ar.number}`,Kr=Fr.split(/\s+/).filter(Boolean),Gr=Kr.length>=2?`${Kr[0][0]}${Kr[Kr.length-1][0]}`.toUpperCase():Fr.substring(0,2).toUpperCase(),Zr=["#C9A962","#8B5CF6","#EC4899","#14B8A6","#F59E0B","#6366F1","#22C55E","#EF4444"],Jr=Zr[Ar.number%Zr.length];kr.set(Hr,{id:Hr,name:Fr,initials:Gr,avatarColour:Jr,actorNumber:Ar.number})}}),Array.from(kr.values()).sort((Ar,Or)=>{const Lr=Ar.actorNumber??999,Fr=Or.actorNumber??999;return Lr!==Fr?Lr-Fr:Ar.name.localeCompare(Or.name)})},[ar==null?void 0:ar.characters,hr==null?void 0:hr.castList]),yr=reactExports.useCallback(()=>{const kr=new Map;return gr.forEach(Ar=>{kr.set(Ar.id,[])}),ar!=null&&ar.looks&&ar.looks.forEach(Ar=>{const Or=kr.get(Ar.characterId)||[];kr.set(Ar.characterId,[...Or,Ar])}),kr},[ar==null?void 0:ar.looks,gr]),br=reactExports.useCallback(kr=>{if(!ar)return{captured:0,total:0};const Ar=kr.scenes.length;let Or=0;return kr.scenes.forEach(Lr=>{const Fr=ar.scenes.find(Hr=>Hr.sceneNumber===Lr);if(Fr){const Hr=`${Fr.id}-${kr.characterId}`,Kr=or[Hr];Kr&&(Kr.photos.front||Kr.additionalPhotos.length>0)&&Or++}}),{captured:Or,total:Ar}},[ar,or]),_r=kr=>gr.find(Ar=>Ar.id===kr),jr=kr=>{Er(kr||null),fr(!0)},[wr,Sr]=reactExports.useState(!1),Tr=reactExports.useCallback(async()=>{if(!(!ar||wr)){Sr(!0);try{const kr=ar.characters.filter(Hr=>ar.looks.some(Kr=>Kr.characterId===Hr.id)).map(Hr=>{const Kr=ar.looks.filter(Gr=>Gr.characterId===Hr.id);return generateCharacterLookbookPDF(Hr,Kr,ar.scenes,or)});if(kr.length===0)return;let Ar;if(kr.length===1)Ar=kr[0];else{const Hr=kr.map(Zr=>{const Jr=Zr.match(/<body>([\s\S]*?)<\/body>/);return Jr?Jr[1]:""}),Kr=kr[0].match(/<style>([\s\S]*?)<\/style>/),Gr=Kr?Kr[1]:"";Ar=`<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>${ar.name} - Lookbooks</title><style>${Gr}</style></head><body>${Hr.join('<div class="page-break"></div>')}</body></html>`}const Or=new Blob([Ar],{type:"text/html;charset=utf-8"}),Lr=URL.createObjectURL(Or),Fr=window.open(Lr,"_blank");Fr&&Fr.addEventListener("load",()=>{setTimeout(()=>Fr.print(),500)}),URL.revokeObjectURL(Lr)}finally{Sr(!1)}}},[ar,or,wr]);if(lr)return jsxRuntimeExports.jsx(LookOverview,{lookId:lr,onBack:()=>cr(null),onSceneClick:kr=>{cr(null),ur("breakdown"),dr(kr)}});if(!ar)return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx(LookbooksHeader,{}),jsxRuntimeExports.jsx(EmptyState,{onAddLook:()=>jr()})]});const Rr=yr(),Nr=gr.length>0,Cr=gr.length;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx(LookbooksHeader,{onExport:Tr,isExporting:wr}),jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"px-4 pt-4 pb-24",children:[jsxRuntimeExports.jsx(SyncStatusBanner,{}),Nr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"section-header mb-3",children:["CAST & LOOKBOOKS (",Cr,")"]}),jsxRuntimeExports.jsx("div",{className:"space-y-5",children:Array.from(Rr.entries()).map(([kr,Ar])=>{const Or=_r(kr);if(!Or)return null;let Lr=0,Fr=0;Ar.forEach(Zr=>{const Jr=br(Zr);Lr+=Jr.captured,Fr+=Jr.total});const Hr=Or.actorNumber?vr.get(Or.actorNumber):void 0,Kr=(Hr==null?void 0:Hr.size)||0,Gr=Math.max(Fr,Kr);return jsxRuntimeExports.jsx(CharacterSection,{character:Or,looks:Ar,capturedScenes:Lr,totalScenes:Gr,getCaptureProgress:br,onAddLook:()=>jr(kr)},kr)})})]}):jsxRuntimeExports.jsx(EmptyState,{onAddLook:()=>jr()})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>jr(),className:"fixed bottom-24 right-4 w-14 h-14 rounded-full gold-gradient shadow-lg flex items-center justify-center text-white z-40 active:scale-95 transition-transform","aria-label":"Add Look",children:jsxRuntimeExports.jsx("svg",{className:"w-7 h-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),jsxRuntimeExports.jsx(AddLookModal,{isOpen:mr,onClose:()=>fr(!1),preselectedCharacterId:xr})]})}function LookbooksHeader({onExport:ar,isExporting:or}){return jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:"w-9"}),jsxRuntimeExports.jsx("h1",{className:"text-[17px] font-bold text-text-primary",children:"Lookbook"}),ar?jsxRuntimeExports.jsx("button",{onClick:ar,disabled:or,className:"p-2 rounded-lg transition-colors touch-manipulation text-text-muted hover:text-gold disabled:opacity-50",title:"Export Lookbooks",children:or?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})})}):jsxRuntimeExports.jsx("div",{className:"w-9"})]})})})}function EmptyState({onAddLook:ar}){return jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-[60vh] px-8",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gold-100 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"No looks defined"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-6",children:"Sync from desktop or create looks manually"}),jsxRuntimeExports.jsxs("button",{onClick:ar,className:"inline-flex items-center gap-2 px-6 py-3 rounded-button gold-gradient text-white font-medium shadow-sm active:scale-95 transition-transform",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Look"]})]})})}function parseTimeShorthand(ar){if(!ar)return"";let or=ar.trim().toLowerCase(),lr=!1,cr=!1;/p\.?m\.?$/.test(or)||/p$/.test(or)?(lr=!0,or=or.replace(/p\.?m\.?$|p$/,"").trim()):(/a\.?m\.?$/.test(or)||/a$/.test(or))&&(cr=!0,or=or.replace(/a\.?m\.?$|a$/,"").trim());let ur,dr;if(or.includes(":")){const hr=or.split(":");ur=parseInt(hr[0],10),dr=parseInt(hr[1]||"0",10)}else{const hr=or.replace(/\D/g,"");if(!hr)return"";if(hr.length<=2)ur=parseInt(hr,10),dr=0;else if(hr.length===3)ur=parseInt(hr[0],10),dr=parseInt(hr.slice(1),10);else if(hr.length===4)ur=parseInt(hr.slice(0,2),10),dr=parseInt(hr.slice(2),10);else return""}return lr&&ur<12&&(ur+=12),cr&&ur===12&&(ur=0),isNaN(ur)||isNaN(dr)||ur<0||ur>23||dr<0||dr>59?"":`${ur.toString().padStart(2,"0")}:${dr.toString().padStart(2,"0")}`}const TIME_SLOTS=[];for(let ar=5;ar<=23;ar++)TIME_SLOTS.push(`${ar.toString().padStart(2,"0")}:00`),TIME_SLOTS.push(`${ar.toString().padStart(2,"0")}:30`);function formatSlotLabel(ar){const[or,lr]=ar.split(":"),cr=parseInt(or,10),ur=cr<12?"am":"pm";return`${cr===0?12:cr>12?cr-12:cr}:${lr}${ur}`}function SmartTimeInput({value:ar,onChange:or,placeholder:lr,className:cr,style:ur}){const[dr,hr]=reactExports.useState(ar||""),[pr,mr]=reactExports.useState(!1),[fr,xr]=reactExports.useState(!1),Er=reactExports.useRef(null),vr=reactExports.useRef(null);reactExports.useEffect(()=>{pr||hr(ar||"")},[ar,pr]),reactExports.useEffect(()=>{if(fr&&vr.current&&ar){const jr=TIME_SLOTS.indexOf(ar);if(jr>=0){const wr=vr.current.children[jr];wr==null||wr.scrollIntoView({block:"center"})}}},[fr,ar]),reactExports.useEffect(()=>{if(!fr)return;const jr=wr=>{Er.current&&!Er.current.contains(wr.target)&&xr(!1)};return document.addEventListener("mousedown",jr),()=>document.removeEventListener("mousedown",jr)},[fr]);const gr=reactExports.useCallback(()=>{const jr=parseTimeShorthand(dr);hr(jr),jr!==ar&&or(jr)},[dr,ar,or]),yr=()=>{mr(!1),gr()},br=jr=>{jr.key==="Enter"&&jr.currentTarget.blur()},_r=jr=>{hr(jr),or(jr),xr(!1)};return jsxRuntimeExports.jsxs("div",{ref:Er,className:"relative flex items-center gap-1",children:[jsxRuntimeExports.jsx("input",{type:"text",inputMode:"numeric",value:dr,onChange:jr=>hr(jr.target.value),onBlur:yr,onFocus:()=>{mr(!0),xr(!1)},onKeyDown:br,placeholder:lr||"00:00",className:cr,style:{...ur,flex:1}}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[jsxRuntimeExports.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider px-1 py-px rounded",style:{backgroundColor:"var(--color-border)",color:"var(--color-text-muted)"},children:"24hr"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:jr=>{jr.preventDefault(),xr(!fr)},className:"p-0.5 rounded",style:{color:"var(--color-text-muted)"},"aria-label":"Pick time",children:jsxRuntimeExports.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("polyline",{points:"12 6 12 12 16 14"})]})})]}),fr&&jsxRuntimeExports.jsx("div",{ref:vr,className:"absolute left-0 right-0 z-50 rounded-lg shadow-lg overflow-y-auto",style:{top:"100%",marginTop:4,maxHeight:200,backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)"},children:TIME_SLOTS.map(jr=>{const wr=jr===ar;return jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>_r(jr),className:`w-full px-3 py-2 text-left text-[13px] flex justify-between items-center ${wr?"font-bold":""}`,style:{backgroundColor:wr?"var(--color-input-bg)":"transparent",color:wr?"var(--color-gold)":"var(--color-text-primary)",borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("span",{className:"font-mono",children:jr}),jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:11},children:formatSlotLabel(jr)})]},jr)})})]})}const DAY_LABELS$1=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],DAY_TYPES=["SWD","CWD","SCWD"];function WeekView({weekStartDate:ar,onNavigate:or}){const{entries:lr,calculateEntry:cr,saveEntry:ur,getEntry:dr,rateCard:hr}=useTimesheetStore(),[pr,mr]=reactExports.useState(null),[fr,xr]=reactExports.useState(null),Er=()=>{const _r=new Date(ar),jr=new Date(addDays(ar,6)),wr=_r.getDate(),Sr=jr.getDate(),Tr=_r.toLocaleDateString("en-GB",{month:"short"}),Rr=jr.toLocaleDateString("en-GB",{month:"short"}),Nr=DAY_LABELS$1[0][0],Cr=DAY_LABELS$1[6][0];return Tr===Rr?`${Nr} ${wr} - ${Cr} ${Sr} ${Tr}`:`${Nr} ${wr} ${Tr} - ${Cr} ${Sr} ${Rr}`},vr=Array.from({length:7},(_r,jr)=>{const wr=addDays(ar,jr),Sr=lr[wr],Tr=Sr?cr(Sr):null,Rr=new Date().toISOString().split("T")[0];return{date:wr,dayLabel:DAY_LABELS$1[jr],dayNumber:new Date(wr).getDate(),entry:Sr,calc:Tr,isToday:wr===Rr,isWeekend:jr>=5}}),gr=_r=>{pr===_r?(fr&&fr.date===_r&&ur(fr),mr(null),xr(null)):(fr&&ur(fr),mr(_r),xr(dr(_r)||createEmptyTimesheetEntry(_r)))},yr=(_r,jr)=>{if(!fr)return;const wr={[_r]:jr};if(_r==="dayType"){const Tr=jr;wr.lunchTaken=getLunchDurationForDayType(Tr)}const Sr={...fr,...wr};xr(Sr),ur(Sr)},br=_r=>!(_r!=null&&_r.unitCall)||!(_r!=null&&_r.wrapOut)?null:`${_r.preCall||_r.unitCall}  ${_r.wrapOut}`;return jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>or("prev"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:Er()}),jsxRuntimeExports.jsx("button",{onClick:()=>or("next"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:vr.map(({date:_r,dayLabel:jr,dayNumber:wr,entry:Sr,calc:Tr,isToday:Rr,isWeekend:Nr})=>{const Cr=Sr&&Sr.unitCall&&Sr.wrapOut,kr=pr===_r,Ar=br(Sr),Or=[];return Cr&&(Sr.dayType!=="SWD"&&Or.push(Sr.dayType),Tr&&Tr.preCallHours>0&&Or.push(`${Tr.preCallHours.toFixed(1)}h pre`),Tr&&Tr.otHours>0&&Or.push(`${Tr.otHours.toFixed(1)}h OT`),Sr.isSixthDay&&!Sr.isSeventhDay&&Or.push("6th day"),Sr.isSeventhDay&&Or.push("7th day")),jsxRuntimeExports.jsxs("div",{className:`rounded-xl overflow-hidden border transition-all ${Rr?"border-2 border-gold":"border-border"}`,style:{backgroundColor:"var(--color-card)"},children:[jsxRuntimeExports.jsxs("div",{onClick:()=>gr(_r),className:"px-3.5 py-3 flex items-center cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 w-11 text-center mr-3",children:[jsxRuntimeExports.jsx("div",{className:`text-[10px] font-medium uppercase ${Rr||Nr?"text-gold":""}`,style:{color:Rr||Nr?void 0:"var(--color-text-muted)"},children:jr}),jsxRuntimeExports.jsx("div",{className:`text-xl font-bold ${Rr?"text-gold":""}`,style:{color:Rr?void 0:"var(--color-text-primary)"},children:wr})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-0",children:Cr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"text-[14px] font-semibold",style:{color:"var(--color-text-primary)"},children:Ar}),Or.length>0&&jsxRuntimeExports.jsx("div",{className:"text-[11px] mt-0.5 truncate",style:{color:"var(--color-text-muted)"},children:Or.join("  ")})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:`text-[14px] font-medium ${Rr?"text-gold":""}`,style:{color:Rr?void 0:"var(--color-text-muted)"},children:Rr?"Today":""}),jsxRuntimeExports.jsx("div",{className:"text-[12px] text-gold font-medium mt-0.5",children:"+ Add hours"})]})}),Tr&&Tr.totalHours>0&&jsxRuntimeExports.jsxs("div",{className:"text-right ml-3 flex-shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"text-[17px] font-bold text-gold leading-tight",children:[Tr.totalHours.toFixed(Tr.totalHours%1===0?0:1),"h"]}),Tr.totalEarnings>0&&jsxRuntimeExports.jsxs("div",{className:"text-[11px] font-medium leading-tight",style:{color:"var(--color-text-muted)"},children:["",Tr.totalEarnings.toFixed(0)]})]}),jsxRuntimeExports.jsx("svg",{className:`w-3 h-3 ml-2.5 flex-shrink-0 transition-transform ${kr?"rotate-180":""}`,style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),kr&&fr&&jsxRuntimeExports.jsx(ExpandedDayContent,{entry:fr,updateField:yr,calculation:cr(fr),rateCard:hr})]},_r)})})]})}function ExpandedDayContent({entry:ar,updateField:or,calculation:lr,rateCard:cr}){const ur=!!ar.autoFilledFrom;return jsxRuntimeExports.jsxs("div",{className:"px-4 pb-4 pt-3 space-y-3",style:{borderTop:"1px solid var(--color-border)"},onClick:dr=>dr.stopPropagation(),children:[ur&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-emerald-600 bg-emerald-50 px-3 py-2 rounded-lg",children:[jsxRuntimeExports.jsx("span",{children:""}),jsxRuntimeExports.jsxs("span",{children:["Times auto-filled from Day ",ar.productionDay," call sheet"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-[11px] uppercase tracking-wide font-medium min-w-[70px]",style:{color:"var(--color-text-muted)"},children:"Day Type"}),jsxRuntimeExports.jsx("select",{value:ar.dayType,onChange:dr=>or("dayType",dr.target.value),className:"flex-1 py-2.5 px-3 rounded-lg text-sm font-medium appearance-none bg-no-repeat",style:{backgroundColor:"var(--color-input-bg)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E")`,backgroundPosition:"right 12px center"},children:DAY_TYPES.map(dr=>jsxRuntimeExports.jsxs("option",{value:dr,children:[dr," - ",DAY_TYPE_LABELS[dr]]},dr))})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs("label",{className:`flex items-center gap-2 px-3.5 py-2.5 rounded-lg cursor-pointer border ${ar.isSixthDay?"bg-orange-50 border-orange-400":""}`,style:ar.isSixthDay?void 0:{backgroundColor:"var(--color-input-bg)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:`w-[18px] h-[18px] rounded flex items-center justify-center text-xs ${ar.isSixthDay?"bg-orange-500 border-orange-500 text-white":"border-2"}`,style:ar.isSixthDay?void 0:{borderColor:"#ccc"},children:ar.isSixthDay&&""}),jsxRuntimeExports.jsx("span",{className:"text-[13px] font-medium",style:{color:"var(--color-text-primary)"},children:"6th Day"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-orange-500",children:["(",cr.sixthDayMultiplier,"x)"]}),jsxRuntimeExports.jsx("input",{type:"checkbox",checked:ar.isSixthDay,onChange:dr=>{or("isSixthDay",dr.target.checked),dr.target.checked&&or("isSeventhDay",!1)},className:"sr-only"})]}),jsxRuntimeExports.jsxs("label",{className:`flex items-center gap-2 px-3.5 py-2.5 rounded-lg cursor-pointer border ${ar.isSeventhDay?"bg-red-50 border-red-400":""}`,style:ar.isSeventhDay?void 0:{backgroundColor:"var(--color-input-bg)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:`w-[18px] h-[18px] rounded flex items-center justify-center text-xs ${ar.isSeventhDay?"bg-red-600 border-red-600 text-white":"border-2"}`,style:ar.isSeventhDay?void 0:{borderColor:"#ccc"},children:ar.isSeventhDay&&""}),jsxRuntimeExports.jsx("span",{className:"text-[13px] font-medium",style:{color:"var(--color-text-primary)"},children:"7th Day"}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] text-red-600",children:["(",cr.seventhDayMultiplier,"x)"]}),jsxRuntimeExports.jsx("input",{type:"checkbox",checked:ar.isSeventhDay,onChange:dr=>{or("isSeventhDay",dr.target.checked),dr.target.checked&&or("isSixthDay",!1)},className:"sr-only"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[jsxRuntimeExports.jsx(TimeInputCell,{label:"Pre-Call",value:ar.preCall,onChange:dr=>or("preCall",dr),highlight:"gold",hint:`@ ${cr.preCallMultiplier}x`}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Unit Call",value:ar.unitCall,onChange:dr=>or("unitCall",dr)}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Lunch",value:ar.lunchStart||"",onChange:dr=>or("lunchStart",dr)}),jsxRuntimeExports.jsxs("div",{className:"p-2.5 rounded-lg",style:{backgroundColor:"var(--color-input-bg)",border:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:"text-[10px] uppercase tracking-wide mb-0.5",style:{color:"var(--color-text-muted)"},children:"Lunch Duration"}),jsxRuntimeExports.jsxs("select",{value:ar.lunchTaken,onChange:dr=>or("lunchTaken",parseInt(dr.target.value)),className:"text-[15px] font-semibold bg-transparent w-full appearance-none",style:{color:"var(--color-text-primary)"},children:[jsxRuntimeExports.jsx("option",{value:30,children:"30 min"}),jsxRuntimeExports.jsx("option",{value:45,children:"45 min"}),jsxRuntimeExports.jsx("option",{value:60,children:"1 hr"}),jsxRuntimeExports.jsx("option",{value:0,children:"None"})]})]}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Unit Wrap",value:ar.outOfChair,onChange:dr=>or("outOfChair",dr)}),jsxRuntimeExports.jsx(TimeInputCell,{label:"Wrap Out",value:ar.wrapOut,onChange:dr=>or("wrapOut",dr),highlight:lr.otHours>0?"orange":void 0,hint:lr.otHours>0?"OT":void 0})]}),lr.totalHours>0&&jsxRuntimeExports.jsxs("div",{className:"rounded-lg p-3.5",style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsx("div",{className:"text-[10px] uppercase tracking-wide font-medium mb-2.5",style:{color:"var(--color-text-muted)"},children:"Hours Breakdown"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1.5",children:[lr.preCallHours>0&&jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Pre-Call",hours:lr.preCallHours,rate:`@ ${cr.preCallMultiplier}x`}),jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Base Hours",hours:lr.baseHours,rate:"@ 1x"}),lr.otHours>0&&jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Overtime",hours:lr.otHours,rate:`@ ${cr.otMultiplier}x`}),lr.lateNightHours>0&&jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Late Night",hours:lr.lateNightHours,rate:`@ ${cr.lateNightMultiplier}x`}),jsxRuntimeExports.jsx(BreakdownRow$1,{label:"Lunch (unpaid)",hours:-(ar.lunchTaken/60)}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pt-2.5 mt-2.5",style:{borderTop:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold",style:{color:"var(--color-text-primary)"},children:"Total Worked"}),jsxRuntimeExports.jsxs("span",{className:"text-base font-bold",style:{color:"var(--color-text-primary)"},children:[lr.totalHours.toFixed(1)," hrs"]})]})]})]}),lr.totalEarnings>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center p-3 rounded-lg gold-gradient text-white",children:[jsxRuntimeExports.jsx("span",{className:"text-[11px] uppercase tracking-wide opacity-90",children:"Day Earnings"}),jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold",children:["",lr.totalEarnings.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"text-[10px] uppercase tracking-wide font-medium mb-1.5",style:{color:"var(--color-text-muted)"},children:["Notes / OT Reason",lr.otHours>0&&jsxRuntimeExports.jsx("span",{className:"text-orange-500 ml-1",children:"(Required for OT)"})]}),jsxRuntimeExports.jsx("textarea",{value:ar.notes,onChange:dr=>or("notes",dr.target.value),placeholder:"e.g., Extended for reshoots, rain delay...",rows:2,className:"w-full p-3 rounded-lg text-[13px] resize-none",style:{backgroundColor:"var(--color-input-bg)",border:`1px solid ${lr.otHours>0&&!ar.notes?"rgba(249, 115, 22, 0.5)":"var(--color-border)"}`,color:"var(--color-text-primary)"}})]})]})}function TimeInputCell({label:ar,value:or,onChange:lr,highlight:cr,hint:ur}){const dr=cr==="gold"?{backgroundColor:"#fffbeb",border:"1px solid var(--color-gold)"}:cr==="orange"?{backgroundColor:"#fff7ed",border:"1px solid #f97316"}:{backgroundColor:"var(--color-input-bg)",border:"1px solid var(--color-border)"};return jsxRuntimeExports.jsxs("div",{className:"p-2.5 rounded-lg relative",style:{...dr,overflow:"visible"},children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] uppercase tracking-wide",style:{color:"var(--color-text-muted)"},children:ar}),ur&&jsxRuntimeExports.jsx("span",{className:"text-[9px] font-semibold",style:{color:cr==="orange"?"#f97316":"var(--color-gold)"},children:ur})]}),jsxRuntimeExports.jsx(SmartTimeInput,{value:or,onChange:lr,className:"text-[15px] font-semibold bg-transparent outline-none min-w-0",style:{color:or?"var(--color-text-primary)":"var(--color-text-muted)"}})]})}function BreakdownRow$1({label:ar,hours:or,rate:lr}){return jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-[13px]",children:[jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1.5",style:{color:"var(--color-text-muted)"},children:[ar,lr&&jsxRuntimeExports.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:lr})]}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:[(or>0,""),or.toFixed(1)," hrs"]})]})}const DAY_LABELS=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function TimesheetDocument({weekStartDate:ar,onNavigate:or}){const{entries:lr,calculateEntry:cr,getWeekSummary:ur,getPreviousWrapOut:dr,rateCard:hr}=useTimesheetStore(),pr=ur(ar),mr=()=>{const gr=new Date(ar),yr=new Date(addDays(ar,6)),br=gr.getDate(),_r=yr.getDate(),jr=gr.toLocaleDateString("en-GB",{month:"short"}),wr=yr.toLocaleDateString("en-GB",{month:"short"}),Sr=yr.getFullYear();return jr===wr?`${br} - ${_r} ${jr} ${Sr}`:`${br} ${jr} - ${_r} ${wr} ${Sr}`},fr=Array.from({length:7},(gr,yr)=>{const br=addDays(ar,yr),_r=lr[br],jr=dr(br),wr=_r?cr(_r,jr):null,Sr=new Date().toISOString().split("T")[0];return{date:br,dayLabel:DAY_LABELS[yr],dayNumber:new Date(br).getDate(),entry:_r,calc:wr,isToday:br===Sr,hasData:!!(_r!=null&&_r.unitCall&&(_r!=null&&_r.wrapOut))}}),xr=fr.filter(gr=>gr.hasData).length,Er=gr=>gr||"",vr=gr=>{switch(gr){case"CWD":return"bg-blue-100 text-blue-700";case"SCWD":return"bg-pink-100 text-pink-700";default:return"bg-gray-100 text-gray-600"}};return jsxRuntimeExports.jsxs("div",{className:"px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>or("prev"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:mr()}),jsxRuntimeExports.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-muted)"},children:[xr," day",xr!==1?"s":""," logged"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>or("next"),className:"w-9 h-9 rounded-full flex items-center justify-center transition-colors",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-xl border overflow-hidden",style:{backgroundColor:"var(--color-card)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("div",{className:"gold-gradient px-4 py-3",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-white font-semibold text-sm",children:"WEEKLY TIMESHEET"}),jsxRuntimeExports.jsx("p",{className:"text-white/70 text-xs",children:mr()})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("div",{className:"text-white/70 text-xs",children:"Week Total"}),jsxRuntimeExports.jsxs("div",{className:"text-white font-bold text-lg",children:[pr.totalHours.toFixed(1)," hrs"]})]})]})}),jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full min-w-[600px] text-xs",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsx("th",{className:"text-left py-2 px-3 font-medium sticky left-0 z-10",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-text-muted)",minWidth:"80px"},children:""}),fr.map(gr=>jsxRuntimeExports.jsxs("th",{className:`text-center py-2 px-2 font-medium ${gr.isToday?"text-gold":""}`,style:{color:gr.isToday?void 0:"var(--color-text-muted)",minWidth:"70px"},children:[jsxRuntimeExports.jsx("div",{className:"font-semibold",children:gr.dayLabel}),jsxRuntimeExports.jsx("div",{className:`text-lg ${gr.isToday?"text-gold":""}`,style:{color:gr.isToday?void 0:"var(--color-text-primary)"},children:gr.dayNumber})]},gr.date)),jsxRuntimeExports.jsx("th",{className:"text-center py-2 px-3 font-semibold",style:{backgroundColor:"var(--color-gold-light)",color:"var(--color-gold)",minWidth:"70px"},children:"Total"})]})}),jsxRuntimeExports.jsxs("tbody",{children:[jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Day Type"}),fr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",children:(yr=gr.entry)!=null&&yr.dayType?jsxRuntimeExports.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${vr(gr.entry.dayType)}`,children:gr.entry.dayType}):jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-placeholder)"},children:""})},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("span",{className:"text-gold",children:"Pre-Call"})}),fr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",style:{color:"var(--color-text-primary)"},children:Er((yr=gr.entry)==null?void 0:yr.preCall)},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3 font-medium",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-gold)"},children:pr.preCallHours>0?`${pr.preCallHours.toFixed(1)}h`:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Unit Call"}),fr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2 font-medium",style:{color:"var(--color-text-primary)"},children:Er((yr=gr.entry)==null?void 0:yr.unitCall)},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Lunch"}),fr.map(gr=>{var yr,br;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",style:{color:"var(--color-text-muted)"},children:((yr=gr.entry)==null?void 0:yr.dayType)==="CWD"?jsxRuntimeExports.jsx("span",{className:"text-[10px]",children:"W.I.H"}):(br=gr.entry)!=null&&br.lunchTaken?`${gr.entry.lunchTaken}m`:""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Wrap Out"}),fr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2 font-medium",style:{color:"var(--color-text-primary)"},children:Er((yr=gr.entry)==null?void 0:yr.wrapOut)},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:9,className:"py-1",style:{backgroundColor:"var(--color-input-bg)"}})}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Base Hrs"}),fr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",style:{color:"var(--color-text-primary)"},children:(yr=gr.calc)!=null&&yr.baseHours?gr.calc.baseHours.toFixed(1):""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3 font-semibold",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-text-primary)"},children:pr.baseHours.toFixed(1)})]}),jsxRuntimeExports.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("span",{className:"text-orange-500",children:"Overtime"})}),fr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2 text-orange-500",children:(yr=gr.calc)!=null&&yr.otHours?`+${gr.calc.otHours.toFixed(1)}`:""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3 font-semibold text-orange-500",style:{backgroundColor:"var(--color-input-bg)"},children:pr.otHours>0?`+${pr.otHours.toFixed(1)}`:""})]}),jsxRuntimeExports.jsxs("tr",{style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3 font-semibold sticky left-0",style:{backgroundColor:"var(--color-input-bg)",color:"var(--color-text-primary)"},children:"Total Hrs"}),fr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-2 font-bold",style:{color:"var(--color-text-primary)"},children:(yr=gr.calc)!=null&&yr.totalHours?gr.calc.totalHours.toFixed(1):""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-3 font-bold text-gold",style:{backgroundColor:"var(--color-gold-light)"},children:pr.totalHours.toFixed(1)})]}),(pr.sixthDayHours>0||pr.seventhDayHours>0)&&jsxRuntimeExports.jsxs("tr",{style:{borderTop:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("td",{className:"py-2 px-3 font-medium sticky left-0",style:{backgroundColor:"var(--color-card)",color:"var(--color-text-muted)"},children:"Premium"}),fr.map(gr=>{var yr,br;return jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-2",children:(yr=gr.entry)!=null&&yr.isSeventhDay?jsxRuntimeExports.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-red-100 text-red-600",children:"7th"}):(br=gr.entry)!=null&&br.isSixthDay?jsxRuntimeExports.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-orange-100 text-orange-600",children:"6th"}):jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-placeholder)"},children:""})},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-2 px-3",style:{backgroundColor:"var(--color-input-bg)"},children:""})]}),jsxRuntimeExports.jsxs("tr",{className:"gold-gradient",children:[jsxRuntimeExports.jsx("td",{className:"py-3 px-3 font-semibold text-white sticky left-0",style:{background:"inherit"},children:"Earnings"}),fr.map(gr=>{var yr;return jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-2 text-white font-medium",children:(yr=gr.calc)!=null&&yr.totalEarnings?formatCurrency(gr.calc.totalEarnings):""},gr.date)}),jsxRuntimeExports.jsx("td",{className:"text-center py-3 px-3 font-bold text-white text-base",children:formatCurrency(pr.totalEarnings)})]})]})]})})]}),pr.totalEarnings>0&&jsxRuntimeExports.jsxs("div",{className:"mt-4 rounded-xl border p-4",style:{backgroundColor:"var(--color-card)",borderColor:"var(--color-border)"},children:[jsxRuntimeExports.jsx("h4",{className:"text-xs font-medium uppercase tracking-wide mb-3",style:{color:"var(--color-text-muted)"},children:"Earnings Breakdown"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(BreakdownRow,{label:"Base Pay",value:pr.basePay}),pr.preCallPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:`Pre-Call (${hr.preCallMultiplier}x)`,value:pr.preCallPay,highlight:"gold"}),pr.overtimePay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:`Overtime (${hr.otMultiplier}x)`,value:pr.overtimePay,highlight:"orange"}),pr.brokenLunchPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:"Broken Lunch",value:pr.brokenLunchPay,highlight:"amber"}),pr.brokenTurnaroundPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:"Broken Turnaround",value:pr.brokenTurnaroundPay,highlight:"purple"}),pr.lateNightPay>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:`Late Night (${hr.lateNightMultiplier}x)`,value:pr.lateNightPay,highlight:"red"}),pr.kitRentalTotal>0&&jsxRuntimeExports.jsx(BreakdownRow,{label:"Kit Rental",value:pr.kitRentalTotal}),jsxRuntimeExports.jsx("div",{className:"pt-2 mt-2",style:{borderTop:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:"Week Total"}),jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-gold",children:formatCurrency(pr.totalEarnings)})]})})]})]}),xr===0&&jsxRuntimeExports.jsxs("div",{className:"mt-6 text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",style:{backgroundColor:"var(--color-input-bg)"},children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8",style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),jsxRuntimeExports.jsx("h3",{className:"font-semibold mb-1",style:{color:"var(--color-text-primary)"},children:"No hours logged this week"}),jsxRuntimeExports.jsx("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:"Switch to Day view to log your hours"})]})]})}function BreakdownRow({label:ar,value:or,highlight:lr}){const cr={gold:"text-gold",orange:"text-orange-500",amber:"text-amber-500",red:"text-red-500",purple:"text-purple-500"};return jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm",children:[jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-muted)"},children:ar}),jsxRuntimeExports.jsx("span",{className:`font-medium ${lr?cr[lr]:""}`,style:lr?void 0:{color:"var(--color-text-primary)"},children:formatCurrency(or)})]})}function SummaryCard({summary:ar}){const{rateCard:or}=useTimesheetStore();return ar.entries.length>0?jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center",children:[jsxRuntimeExports.jsx(SummaryItem,{label:"Days",value:ar.entries.length.toString()}),jsxRuntimeExports.jsx(SummaryItem,{label:"Base Hrs",value:ar.baseHours.toFixed(0)}),jsxRuntimeExports.jsx(SummaryItem,{label:"Pre-Call",value:ar.preCallHours.toFixed(1),subtext:`@ ${or.preCallMultiplier}x`}),jsxRuntimeExports.jsx(SummaryItem,{label:"Overtime",value:ar.otHours.toFixed(1),subtext:`@ ${or.otMultiplier}x`,highlight:!0})]}),(ar.sixthDayHours>0||ar.seventhDayHours>0||ar.lateNightHours>0)&&jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center mt-3 pt-3",style:{borderTop:"1px solid var(--color-border)"},children:[ar.sixthDayHours>0&&jsxRuntimeExports.jsx(SummaryItem,{label:"6th Day",value:ar.sixthDayHours.toFixed(1),subtext:`@ ${or.sixthDayMultiplier}x`}),ar.seventhDayHours>0&&jsxRuntimeExports.jsx(SummaryItem,{label:"7th Day",value:ar.seventhDayHours.toFixed(1),subtext:`@ ${or.seventhDayMultiplier}x`}),ar.lateNightHours>0&&jsxRuntimeExports.jsx(SummaryItem,{label:"Late Night",value:ar.lateNightHours.toFixed(1),subtext:`@ ${or.lateNightMultiplier}x`})]}),ar.totalEarnings>0&&jsxRuntimeExports.jsxs("details",{className:"group mt-4",children:[jsxRuntimeExports.jsxs("summary",{className:"flex items-center justify-between cursor-pointer py-2",style:{borderTop:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsx("span",{className:"text-xs uppercase tracking-wide font-semibold",style:{color:"var(--color-text-muted)"},children:"Earnings Preview"}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 transition-transform group-open:rotate-180",style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),jsxRuntimeExports.jsxs("div",{className:"pt-3 space-y-2",children:[ar.kitRentalTotal>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Kit Rental"}),jsxRuntimeExports.jsxs("span",{style:{color:"var(--color-text-primary)"},children:["",ar.kitRentalTotal.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Est. Total"}),jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold text-gold",children:["",ar.totalEarnings.toLocaleString("en-GB",{minimumFractionDigits:2})]})]})]})]})]}):jsxRuntimeExports.jsxs("div",{className:"card text-center py-8",children:[jsxRuntimeExports.jsx("svg",{className:"w-12 h-12 mx-auto mb-3",style:{color:"var(--color-text-placeholder)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsx("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:"No entries this week"}),jsxRuntimeExports.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-placeholder)"},children:"Tap a day to log your hours"})]})}function SummaryItem({label:ar,value:or,subtext:lr,highlight:cr}){return jsxRuntimeExports.jsxs("div",{className:"py-2 px-1",children:[jsxRuntimeExports.jsx("div",{className:"text-[9px] uppercase tracking-wide font-medium mb-1",style:{color:"var(--color-text-placeholder)"},children:ar}),jsxRuntimeExports.jsx("div",{className:`text-lg font-bold ${cr?"text-gold":""}`,style:{color:cr?void 0:"var(--color-text-primary)"},children:or}),lr&&jsxRuntimeExports.jsx("div",{className:"text-[10px]",style:{color:"var(--color-text-placeholder)"},children:lr})]})}const useBillingStore=create()(persist((ar,or)=>({billingDetails:createEmptyBillingDetails(),isLoading:!1,isSaving:!1,lastError:null,setBillingDetails:lr=>{ar({billingDetails:{...lr,lastUpdated:new Date},lastError:null})},updatePersonalInfo:lr=>{ar(cr=>({billingDetails:{...cr.billingDetails,...lr,lastUpdated:new Date},lastError:null}))},updateBankDetails:lr=>{ar(cr=>({billingDetails:{...cr.billingDetails,bankDetails:{...cr.billingDetails.bankDetails,...lr},lastUpdated:new Date},lastError:null}))},updatePaymentTerms:lr=>{ar(cr=>({billingDetails:{...cr.billingDetails,paymentTerms:lr,lastUpdated:new Date},lastError:null}))},updateVATSettings:lr=>{ar(cr=>({billingDetails:{...cr.billingDetails,vatSettings:{...cr.billingDetails.vatSettings,...lr},lastUpdated:new Date},lastError:null}))},toggleVATRegistered:()=>{ar(lr=>({billingDetails:{...lr.billingDetails,vatSettings:{...lr.billingDetails.vatSettings,isVATRegistered:!lr.billingDetails.vatSettings.isVATRegistered},lastUpdated:new Date},lastError:null}))},resetBillingDetails:()=>{ar({billingDetails:createEmptyBillingDetails(),lastError:null})},isBillingComplete:()=>{const{billingDetails:lr}=or(),{bankDetails:cr,vatSettings:ur}=lr,dr=!!(lr.fullName&&lr.address&&lr.email),hr=!!(cr.accountName&&cr.sortCode&&cr.accountNumber),pr=!ur.isVATRegistered||!!ur.vatNumber;return dr&&hr&&pr},getValidationErrors:()=>{const{billingDetails:lr}=or(),{bankDetails:cr,vatSettings:ur}=lr,dr=[];return lr.fullName||dr.push("Full name is required"),lr.address||dr.push("Address is required"),lr.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(lr.email)||dr.push("Email format is invalid"):dr.push("Email is required"),cr.accountName||dr.push("Bank account name is required"),cr.sortCode?/^\d{2}-?\d{2}-?\d{2}$/.test(cr.sortCode.replace(/\s/g,""))||dr.push("Sort code should be 6 digits (e.g., 12-34-56)"):dr.push("Sort code is required"),cr.accountNumber?/^\d{8}$/.test(cr.accountNumber.replace(/\s/g,""))||dr.push("Account number should be 8 digits"):dr.push("Account number is required"),ur.isVATRegistered&&!ur.vatNumber&&dr.push("VAT number is required when VAT registered"),(ur.vatRate<0||ur.vatRate>100)&&dr.push("VAT rate must be between 0 and 100"),dr}}),{name:"checks-happy-billing",storage:createJSONStorage(()=>localStorage),partialize:ar=>({billingDetails:ar.billingDetails})})),formatSortCode=ar=>{const or=ar.replace(/\D/g,"");return or.length<=2?or:or.length<=4?`${or.slice(0,2)}-${or.slice(2)}`:`${or.slice(0,2)}-${or.slice(2,4)}-${or.slice(4,6)}`},formatAccountNumber=ar=>ar.replace(/\D/g,"").slice(0,8),REQUIRED_FIELDS=["productionCompany","productionAddress","productionEmail","accountsPayableContact","accountsPayableEmail"],useProductionDetailsStore=create()(persist((ar,or)=>({projectDetails:{},getDetails:lr=>or().projectDetails[lr]||createEmptyProductionInvoicingDetails(),updateDetails:(lr,cr)=>{const ur=or().projectDetails[lr]||createEmptyProductionInvoicingDetails();ar({projectDetails:{...or().projectDetails,[lr]:{...ur,...cr}}})},isComplete:lr=>{const cr=or().projectDetails[lr];return cr?REQUIRED_FIELDS.every(ur=>{const dr=cr[ur];return typeof dr=="string"?dr.trim().length>0:!!dr}):!1},getCompletionCount:lr=>{const cr=or().projectDetails[lr]||createEmptyProductionInvoicingDetails(),ur=REQUIRED_FIELDS.length;return{filled:REQUIRED_FIELDS.filter(hr=>{const pr=cr[hr];return typeof pr=="string"?pr.trim().length>0:!!pr}).length,total:ur}}}),{name:"hmk-production-details"}));function ExportModal({isOpen:ar,onClose:or,weekSummary:lr,weekStartDate:cr}){const{entries:ur,calculateEntry:dr,rateCard:hr}=useTimesheetStore(),{billingDetails:pr}=useBillingStore(),mr=useProjectStore(Fr=>{var Hr;return((Hr=Fr.currentProject)==null?void 0:Hr.id)??""}),fr=useAuthStore(Fr=>{if(mr){const Hr=Fr.projectMemberships.find(Kr=>Kr.projectId===mr);if(Hr)return Hr.projectId}return Fr.projectMemberships.length>0?Fr.projectMemberships[0].projectId:""}),xr=mr||fr,Er=useProductionDetailsStore(Fr=>Fr.getDetails(xr)),[vr,gr]=reactExports.useState("pdf"),[yr,br]=reactExports.useState(!1),[_r,jr]=reactExports.useState(!1);if(!ar)return null;const wr=()=>{const Fr=[];for(let Hr=0;Hr<7;Hr++){const Kr=addDays(cr,Hr),Gr=ur[Kr];Gr&&Fr.push({date:Kr,entry:Gr,calc:dr(Gr)})}return Fr},Sr=lr.entries.length,Rr=(()=>{let Fr=0,Hr=0,Kr=0,Gr=0,Zr=0,Jr=0,os=0,Ur=0;return lr.entries.forEach(Vr=>{const es=dr(Vr);Fr+=es.preCallHours,Hr+=es.preCallEarnings,Kr+=es.workingHours,Gr+=es.lateNightHours,Zr+=es.dailyEarnings,Jr+=es.otEarnings,os+=es.lateNightEarnings,Ur+=es.sixthDayBonus}),{preCallHours:Fr,preCallPay:Hr,workingHours:Kr,lateNightHours:Gr,basePay:Zr,otPay:Jr,lateNightPay:os,sixthDayBonus:Ur}})(),Nr=Fr=>new Date(Fr).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}),Cr=()=>{const Fr=new Date(cr),Hr=new Date(addDays(cr,6));return`${Fr.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${Hr.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}`},kr=()=>{const Fr=wr(),Hr=["Date","Day Type","Pre-Call","Unit Call","Out of Chair","Wrap Out","6th Day","Lunch (mins)","Pre-Call Hours","Working Hours","OT Hours","Late Night Hours","Total Hours","Pre-Call Pay","Base Pay","OT Pay","Late Night Pay","6th Day Bonus","Kit Rental","Total Earnings","Notes"],Kr=Fr.map(({date:Gr,entry:Zr,calc:Jr})=>[Nr(Gr),Zr.dayType,Zr.preCall||"",Zr.unitCall||"",Zr.outOfChair||"",Zr.wrapOut||"",Zr.isSixthDay?"Yes":"No",String(Zr.lunchTaken??60),Jr.preCallHours.toFixed(2),Jr.workingHours.toFixed(2),Jr.otHours.toFixed(2),Jr.lateNightHours.toFixed(2),Jr.totalHours.toFixed(2),Jr.preCallEarnings.toFixed(2),Jr.dailyEarnings.toFixed(2),Jr.otEarnings.toFixed(2),Jr.lateNightEarnings.toFixed(2),Jr.sixthDayBonus.toFixed(2),Jr.kitRental.toFixed(2),Jr.totalEarnings.toFixed(2),Zr.notes||""]);return Kr.push(["TOTAL","","","","","","","",Rr.preCallHours.toFixed(2),Rr.workingHours.toFixed(2),lr.otHours.toFixed(2),Rr.lateNightHours.toFixed(2),lr.totalHours.toFixed(2),Rr.preCallPay.toFixed(2),Rr.basePay.toFixed(2),Rr.otPay.toFixed(2),Rr.lateNightPay.toFixed(2),Rr.sixthDayBonus.toFixed(2),lr.kitRentalTotal.toFixed(2),lr.totalEarnings.toFixed(2),""]),[Hr.join(","),...Kr.map(Gr=>Gr.join(","))].join(`
`)},Ar=()=>{const Fr=wr(),Hr=hr.dailyRate/hr.baseDayHours,Kr="&pound;";return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Timesheet - ${Cr()}</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 32px; max-width: 800px; margin: 0 auto; color: #1a1a1a; font-size: 13px; line-height: 1.5; }

    .header { margin-bottom: 24px; }
    .header h1 { font-size: 22px; font-weight: 700; margin-bottom: 2px; }
    .header .period { font-size: 14px; color: #C9A962; font-weight: 600; }

    .rate-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 24px; }
    .rate-card { background: #f8f8f8; border: 1px solid #e5e5e5; border-radius: 8px; padding: 10px 12px; text-align: center; }
    .rate-card .label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 2px; }
    .rate-card .value { font-size: 15px; font-weight: 700; }

    table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
    thead th { background: #f8f8f8; padding: 10px 8px; text-align: left; font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px; color: #666; border-bottom: 2px solid #e5e5e5; }
    tbody td { padding: 10px 8px; border-bottom: 1px solid #f0f0f0; }
    tbody tr:last-child td { border-bottom: none; }
    .day-name { font-weight: 600; }
    .sixth-tag { display: inline-block; font-size: 9px; font-weight: 600; color: #C9A962; background: #faf6ed; border: 1px solid #C9A962; border-radius: 3px; padding: 1px 4px; margin-left: 4px; vertical-align: middle; }
    .amt { text-align: right; font-weight: 600; }
    .muted { color: #ccc; }
    tfoot td { border-top: 2px solid #C9A962; font-weight: 700; padding-top: 12px; }

    .summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px; }
    .summary-card { border: 1px solid #e5e5e5; border-radius: 8px; padding: 14px 12px; text-align: center; }
    .summary-card .label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 4px; }
    .summary-card .value { font-size: 20px; font-weight: 700; }
    .summary-card.gold { border-color: #C9A962; background: #faf6ed; }
    .summary-card.gold .value { color: #C9A962; }

    .sign-off { margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
    .sign-line { border-top: 1px solid #ccc; padding-top: 8px; font-size: 11px; color: #888; }

    .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #e5e5e5; font-size: 11px; color: #aaa; text-align: center; }

    @media print {
      body { padding: 16px; }
      .rate-card, .summary-card.gold, thead th { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>Timesheet</h1>
    <div class="period">${Cr()}</div>
  </div>

  <div class="rate-cards">
    <div class="rate-card">
      <div class="label">Daily Rate</div>
      <div class="value">${Kr}${hr.dailyRate.toFixed(2)}</div>
    </div>
    <div class="rate-card">
      <div class="label">Base Day</div>
      <div class="value">${hr.baseDayHours} hrs</div>
    </div>
    <div class="rate-card">
      <div class="label">Hourly Rate</div>
      <div class="value">${Kr}${Hr.toFixed(2)}</div>
    </div>
    <div class="rate-card">
      <div class="label">Kit Rental</div>
      <div class="value">${Kr}${hr.kitRental.toFixed(2)}/day</div>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Pre-Call</th>
        <th>Unit Call</th>
        <th>Wrap</th>
        <th>Hours</th>
        <th>OT</th>
        <th class="amt">Earnings</th>
      </tr>
    </thead>
    <tbody>
      ${Fr.map(({date:Gr,entry:Zr,calc:Jr})=>`
      <tr>
        <td><span class="day-name">${Nr(Gr)}</span>${Zr.isSixthDay?'<span class="sixth-tag">6th Day</span>':""}</td>
        <td>${Zr.preCall||'<span class="muted">&mdash;</span>'}</td>
        <td>${Zr.unitCall||'<span class="muted">&mdash;</span>'}</td>
        <td>${Zr.wrapOut||'<span class="muted">&mdash;</span>'}</td>
        <td>${Jr.totalHours.toFixed(1)}</td>
        <td>${Jr.otHours>0?Jr.otHours.toFixed(1):'<span class="muted">&mdash;</span>'}</td>
        <td class="amt">${Kr}${Jr.totalEarnings.toFixed(2)}</td>
      </tr>`).join("")}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4">Total (${Sr} days)</td>
        <td>${lr.totalHours.toFixed(1)}</td>
        <td>${lr.otHours>0?lr.otHours.toFixed(1):"&mdash;"}</td>
        <td class="amt">${Kr}${lr.totalEarnings.toFixed(2)}</td>
      </tr>
    </tfoot>
  </table>

  <div class="summary">
    <div class="summary-card">
      <div class="label">Days Worked</div>
      <div class="value">${Sr}</div>
    </div>
    <div class="summary-card">
      <div class="label">Total Hours</div>
      <div class="value">${lr.totalHours.toFixed(1)}</div>
    </div>
    <div class="summary-card">
      <div class="label">OT Hours</div>
      <div class="value">${lr.otHours.toFixed(1)}</div>
    </div>
    <div class="summary-card gold">
      <div class="label">Total Earnings</div>
      <div class="value">${Kr}${lr.totalEarnings.toFixed(2)}</div>
    </div>
  </div>

  <div class="sign-off">
    <div>
      <div class="sign-line">Employee Signature</div>
    </div>
    <div>
      <div class="sign-line">Date</div>
    </div>
  </div>

  <div class="footer">
    Generated by Hair &amp; Makeup Pro
  </div>

</body>
</html>`},Or=()=>{const Fr=hr.dailyRate/hr.baseDayHours,Hr=`INV-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`,Kr=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),Gr="&pound;",Zr=pr,Jr=Er,os=calculateInvoiceWithVAT(lr.totalEarnings,Zr.vatSettings),Ur=Ir=>Ir?Ir.split(`
`).map(Dr=>Dr.trim()).filter(Boolean).join("<br>"):"",Vr=Jr.invoiceAddressDifferent&&Jr.invoiceAddress?Ur(Jr.invoiceAddress):Ur(Jr.productionAddress),es=[];return Jr.poNumber&&es.push(`<strong>PO:</strong> ${Jr.poNumber}`),Jr.costCode&&es.push(`<strong>Cost Code:</strong> ${Jr.costCode}`),Jr.jobReference&&es.push(`<strong>Job Ref:</strong> ${Jr.jobReference}`),`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice ${Hr}</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; color: #1a1a1a; font-size: 14px; line-height: 1.5; }

    .inv-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 36px; padding-bottom: 20px; border-bottom: 3px solid #C9A962; }
    .inv-brand { font-size: 20px; font-weight: 700; color: #1a1a1a; }
    .inv-brand-sub { font-size: 12px; color: #888; margin-top: 2px; }
    .inv-title-block { text-align: right; }
    .inv-title { font-size: 28px; font-weight: 800; color: #C9A962; letter-spacing: 2px; }
    .inv-number { font-size: 13px; color: #666; margin-top: 2px; }

    .inv-details { display: flex; justify-content: space-between; margin-bottom: 32px; }
    .inv-col h3 { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 8px; font-weight: 600; }
    .inv-col p { font-size: 13px; color: #333; line-height: 1.7; }
    .inv-col strong { font-weight: 600; }
    .inv-placeholder { color: #bbb; font-style: italic; }

    table.inv-table { width: 100%; border-collapse: collapse; margin-bottom: 28px; }
    table.inv-table thead th { text-align: left; padding: 10px 10px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; color: #666; border-bottom: 2px solid #e5e5e5; }
    table.inv-table tbody td { padding: 14px 10px; border-bottom: 1px solid #f0f0f0; vertical-align: top; }
    table.inv-table tbody tr:last-child td { border-bottom: none; }
    table.inv-table .desc-sub { font-size: 12px; color: #888; margin-top: 2px; }
    table.inv-table .amt { text-align: right; font-weight: 600; white-space: nowrap; }

    .inv-totals { width: 280px; margin-left: auto; margin-bottom: 40px; }
    .inv-totals .row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px; }
    .inv-totals .row .lbl { color: #666; }
    .inv-totals .row .val { font-weight: 600; }
    .inv-totals .total-row { border-top: 2px solid #C9A962; padding-top: 10px; margin-top: 6px; }
    .inv-totals .total-row .lbl { font-weight: 700; font-size: 14px; color: #1a1a1a; }
    .inv-totals .total-row .val { font-weight: 800; font-size: 18px; color: #C9A962; }

    .inv-bank { background: #f8f8f8; border-radius: 8px; padding: 16px 20px; margin-bottom: 16px; font-size: 12px; color: #666; }
    .inv-bank strong { color: #333; }
    .inv-terms { background: #f8f8f8; border-radius: 8px; padding: 16px 20px; margin-bottom: 32px; font-size: 12px; color: #666; }
    .inv-terms strong { color: #333; }
    .inv-refs { font-size: 12px; color: #666; margin-bottom: 16px; }
    .inv-refs strong { color: #333; }
    .inv-notes { font-size: 12px; color: #666; font-style: italic; margin-bottom: 16px; }

    .inv-footer { padding-top: 16px; border-top: 1px solid #e5e5e5; font-size: 11px; color: #aaa; text-align: center; }

    @media print {
      body { padding: 20px; }
      .inv-header { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
</head>
<body>

  <div class="inv-header">
    <div>
      <div class="inv-brand">${Zr.businessName||Zr.fullName||'<span class="inv-placeholder">[Your Name]</span>'}</div>
      <div class="inv-brand-sub">${Zr.businessName&&Zr.fullName?Zr.fullName:"Freelance Services"}</div>
    </div>
    <div class="inv-title-block">
      <div class="inv-title">INVOICE</div>
      <div class="inv-number">${Hr}</div>
    </div>
  </div>

  <div class="inv-details">
    <div class="inv-col">
      <h3>From</h3>
      <p>
        ${Zr.fullName?`<strong>${Zr.fullName}</strong><br>`:'<span class="inv-placeholder">[Your Name]</span><br>'}
        ${Zr.address?Ur(Zr.address):'<span class="inv-placeholder">[Your Address]</span>'}
        ${Zr.phone?`<br>${Zr.phone}`:""}
        ${Zr.email?`<br>${Zr.email}`:""}
        ${os.isVATApplicable&&Zr.vatSettings.vatNumber?`<br>VAT No: ${Zr.vatSettings.vatNumber}`:""}
      </p>
    </div>
    <div class="inv-col">
      <h3>Bill To</h3>
      <p>
        ${Jr.productionCompany?`<strong>${Jr.productionCompany}</strong><br>`:'<span class="inv-placeholder">[Production Company]</span><br>'}
        ${Vr||'<span class="inv-placeholder">[Address]</span>'}
        ${Jr.accountsPayableContact?`<br>Attn: ${Jr.accountsPayableContact}`:""}
        ${Jr.accountsPayableEmail?`<br>${Jr.accountsPayableEmail}`:""}
      </p>
    </div>
    <div class="inv-col" style="text-align: right;">
      <h3>Invoice Details</h3>
      <p>
        <strong>Date:</strong> ${Kr}<br>
        <strong>Due:</strong> ${Zr.paymentTerms||"30 days from receipt"}<br>
        <strong>Period:</strong> ${Cr()}
      </p>
    </div>
  </div>

  <table class="inv-table">
    <thead>
      <tr>
        <th>Description</th>
        <th>Qty</th>
        <th>Rate</th>
        <th class="amt">Amount</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Hair &amp; Makeup Services &mdash; Base Day Rate<div class="desc-sub">${Sr} days &times; ${hr.baseDayHours} hours</div></td>
        <td>${Sr}</td>
        <td>${Gr}${hr.dailyRate.toFixed(2)}</td>
        <td class="amt">${Gr}${Rr.basePay.toFixed(2)}</td>
      </tr>
      ${Rr.preCallPay>0?`
      <tr>
        <td>Pre-Call Hours<div class="desc-sub">${Rr.preCallHours.toFixed(1)} hours at hourly rate</div></td>
        <td>${Rr.preCallHours.toFixed(1)} hrs</td>
        <td>${Gr}${Fr.toFixed(2)}</td>
        <td class="amt">${Gr}${Rr.preCallPay.toFixed(2)}</td>
      </tr>`:""}
      ${Rr.otPay>0?`
      <tr>
        <td>Overtime<div class="desc-sub">At ${hr.otMultiplier}&times; hourly rate (${Gr}${(Fr*hr.otMultiplier).toFixed(2)}/hr)</div></td>
        <td>${lr.otHours.toFixed(1)} hrs</td>
        <td>${Gr}${(Fr*hr.otMultiplier).toFixed(2)}</td>
        <td class="amt">${Gr}${Rr.otPay.toFixed(2)}</td>
      </tr>`:""}
      ${Rr.lateNightPay>0?`
      <tr>
        <td>Late Night Hours<div class="desc-sub">${Rr.lateNightHours.toFixed(1)} hours after midnight</div></td>
        <td>${Rr.lateNightHours.toFixed(1)} hrs</td>
        <td>&mdash;</td>
        <td class="amt">${Gr}${Rr.lateNightPay.toFixed(2)}</td>
      </tr>`:""}
      ${Rr.sixthDayBonus>0?`
      <tr>
        <td>6th Day Premium<div class="desc-sub">Additional 50% for 6th consecutive working day</div></td>
        <td>&mdash;</td>
        <td>&mdash;</td>
        <td class="amt">${Gr}${Rr.sixthDayBonus.toFixed(2)}</td>
      </tr>`:""}
      ${lr.kitRentalTotal>0?`
      <tr>
        <td>Kit / Box Rental<div class="desc-sub">${Sr} days at ${Gr}${hr.kitRental.toFixed(2)}/day</div></td>
        <td>${Sr}</td>
        <td>${Gr}${hr.kitRental.toFixed(2)}</td>
        <td class="amt">${Gr}${lr.kitRentalTotal.toFixed(2)}</td>
      </tr>`:""}
    </tbody>
  </table>

  <div class="inv-totals">
    <div class="row">
      <span class="lbl">Subtotal</span>
      <span class="val">${Gr}${os.subtotal.toFixed(2)}</span>
    </div>
    ${os.isVATApplicable?`
    <div class="row">
      <span class="lbl">VAT (${os.vatRate}%)</span>
      <span class="val">${Gr}${os.vatAmount.toFixed(2)}</span>
    </div>`:""}
    <div class="row total-row">
      <span class="lbl">Total Due</span>
      <span class="val">${Gr}${os.total.toFixed(2)}</span>
    </div>
  </div>

  ${Zr.bankDetails.accountName||Zr.bankDetails.sortCode||Zr.bankDetails.accountNumber?`
  <div class="inv-bank">
    <strong>Bank Details:</strong><br>
    ${Zr.bankDetails.accountName?`Account Name: ${Zr.bankDetails.accountName}<br>`:""}
    ${Zr.bankDetails.sortCode?`Sort Code: ${Zr.bankDetails.sortCode}<br>`:""}
    ${Zr.bankDetails.accountNumber?`Account Number: ${Zr.bankDetails.accountNumber}`:""}
  </div>`:""}

  ${es.length>0?`
  <div class="inv-refs">
    ${es.join(" &nbsp;|&nbsp; ")}
  </div>`:""}

  ${Jr.invoiceNotes?`
  <div class="inv-notes">
    ${Jr.invoiceNotes}
  </div>`:""}

  <div class="inv-terms">
    <strong>Payment Terms:</strong> ${Zr.paymentTerms||"Payment within 30 days"}. Please reference invoice number <strong>${Hr}</strong> with payment.
  </div>

  <div class="inv-footer">
    Generated by Checks Happy
  </div>

</body>
</html>`},Lr=async()=>{br(!0),jr(!1);try{let Fr,Hr,Kr;switch(vr){case"csv":Fr=kr(),Hr=`timesheet-${cr}.csv`,Kr="text/csv";break;case"pdf":Fr=Ar(),Hr=`timesheet-${cr}.html`,Kr="text/html";break;case"invoice":Fr=Or(),Hr=`invoice-${cr}.html`,Kr="text/html";break}const Gr=new Blob([Fr],{type:Kr==="text/html"?"text/html;charset=utf-8":Kr}),Zr=URL.createObjectURL(Gr);if(vr==="pdf"||vr==="invoice"){const Jr=window.open(Zr,"_blank");Jr&&Jr.addEventListener("load",()=>{setTimeout(()=>Jr.print(),500)})}else{const Jr=document.createElement("a");Jr.href=Zr,Jr.download=Hr,document.body.appendChild(Jr),Jr.click(),document.body.removeChild(Jr)}URL.revokeObjectURL(Zr),jr(!0),setTimeout(()=>jr(!1),2e3)}catch(Fr){console.error("Export failed:",Fr)}finally{br(!1)}};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl w-full max-w-sm overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:"Export Timesheet"}),jsxRuntimeExports.jsx("button",{onClick:or,className:"p-1 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted mb-4",children:["Week of ",Cr()]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 mb-6",children:[jsxRuntimeExports.jsx("label",{className:"field-label",children:"EXPORT FORMAT"}),jsxRuntimeExports.jsx("button",{onClick:()=>gr("pdf"),className:`w-full p-3 rounded-card border-2 text-left transition-all ${vr==="pdf"?"border-gold bg-gold-50":"border-border bg-input-bg hover:border-gold/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${vr==="pdf"?"bg-gold text-white":"bg-gray-200 text-text-muted"}`,children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-text-primary",children:"PDF Timesheet"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Print-ready document"})]})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>gr("csv"),className:`w-full p-3 rounded-card border-2 text-left transition-all ${vr==="csv"?"border-gold bg-gold-50":"border-border bg-input-bg hover:border-gold/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${vr==="csv"?"bg-gold text-white":"bg-gray-200 text-text-muted"}`,children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-text-primary",children:"CSV Spreadsheet"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"For Excel/Google Sheets"})]})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>gr("invoice"),className:`w-full p-3 rounded-card border-2 text-left transition-all ${vr==="invoice"?"border-gold bg-gold-50":"border-border bg-input-bg hover:border-gold/50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${vr==="invoice"?"bg-gold text-white":"bg-gray-200 text-text-muted"}`,children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"font-medium text-text-primary",children:"Invoice"}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Ready to send to production"})]})]})})]}),jsxRuntimeExports.jsx("div",{className:"bg-input-bg rounded-card p-3 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center text-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-text-muted text-xs",children:"Days"}),jsxRuntimeExports.jsx("div",{className:"font-semibold text-text-primary",children:Sr})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-text-muted text-xs",children:"Hours"}),jsxRuntimeExports.jsx("div",{className:"font-semibold text-text-primary",children:lr.totalHours.toFixed(1)})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-text-muted text-xs",children:"Total"}),jsxRuntimeExports.jsxs("div",{className:"font-semibold text-gold",children:["",lr.totalEarnings.toFixed(2)]})]})]})}),jsxRuntimeExports.jsx("button",{onClick:Lr,disabled:yr,className:`w-full py-3 rounded-button font-medium transition-all ${_r?"bg-success text-white":"gold-gradient text-white active:scale-[0.98]"} ${yr?"opacity-70":""}`,children:yr?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Exporting..."]}):_r?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Exported!"]}):`Export ${vr==="pdf"?"PDF":vr==="csv"?"CSV":"Invoice"}`})]})]})})}const BASE_CONTRACT_OPTIONS=[{value:"10+1",label:"10+1 (10 hours work + 1hr lunch)",hours:10},{value:"11+1",label:"11+1 (11 hours work + 1hr lunch)",hours:11}];function RateCardSettings(){const{rateCard:ar,updateRateCard:or}=useTimesheetStore(),lr=cr=>{const ur=BASE_CONTRACT_OPTIONS.find(dr=>dr.value===cr);or({baseContract:cr,baseDayHours:(ur==null?void 0:ur.hours)||11})};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"DAILY RATE"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:""}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.dailyRate||"",onChange:cr=>or({dailyRate:cr.target.value?parseFloat(cr.target.value):0}),placeholder:"0.00",min:"0",step:"0.01",className:"input-field flex-1"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Your agreed daily rate (BECTU minimum guarantee)"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"BASE CONTRACT (BECTU)"}),jsxRuntimeExports.jsx("select",{value:ar.baseContract||"11+1",onChange:cr=>lr(cr.target.value),className:"input-field w-full",children:BASE_CONTRACT_OPTIONS.map(cr=>jsxRuntimeExports.jsx("option",{value:cr.value,children:cr.label},cr.value))}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Standard UK film industry contract. Hours worked beyond this trigger overtime."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-card p-4 space-y-4",children:[jsxRuntimeExports.jsx("h4",{className:"field-label",children:"RATE MULTIPLIERS"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Pre-Call"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.preCallMultiplier,onChange:cr=>or({preCallMultiplier:parseFloat(cr.target.value)||1.5}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-1",children:"Hours before unit call"})]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Overtime (after base hours)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.otMultiplier,onChange:cr=>or({otMultiplier:parseFloat(cr.target.value)||1.5}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Late Night (after 23:00)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.lateNightMultiplier,onChange:cr=>or({lateNightMultiplier:parseFloat(cr.target.value)||2}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"6th Day"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.sixthDayMultiplier,onChange:cr=>or({sixthDayMultiplier:parseFloat(cr.target.value)||1.5}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-gold font-medium"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-1",children:"Applied to entire day's earnings"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"7th Day"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"x"}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.seventhDayMultiplier,onChange:cr=>or({seventhDayMultiplier:parseFloat(cr.target.value)||2}),min:"1",max:"5",step:"0.1",className:"input-field w-16 text-center text-orange-500 font-medium"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-light mt-1",children:"7th consecutive day worked"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"KIT / BOX RENTAL"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:""}),jsxRuntimeExports.jsx("input",{type:"number",value:ar.kitRental||"",onChange:cr=>or({kitRental:cr.target.value?parseFloat(cr.target.value):0}),placeholder:"0.00",min:"0",step:"0.01",className:"input-field flex-1"}),jsxRuntimeExports.jsx("span",{className:"text-text-muted text-sm",children:"/day"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Daily kit rental added to each working day"})]}),ar.dailyRate>0&&jsxRuntimeExports.jsxs("div",{className:"bg-gold-50 rounded-card p-4 mt-6",children:[jsxRuntimeExports.jsx("h4",{className:"field-label mb-3",children:"RATE SUMMARY"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Hourly Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(ar.dailyRate/ar.baseDayHours).toFixed(2),"/hr"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Pre-Call Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(ar.dailyRate/ar.baseDayHours*ar.preCallMultiplier).toFixed(2),"/hr"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"OT Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(ar.dailyRate/ar.baseDayHours*ar.otMultiplier).toFixed(2),"/hr"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Late Night Rate"}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary font-medium",children:["",(ar.dailyRate/ar.baseDayHours*ar.lateNightMultiplier).toFixed(2),"/hr"]})]})]})]})]})}function Timesheet(){const{viewMode:ar,setViewMode:or,selectedDate:lr,getWeekSummary:cr,rateCard:ur}=useTimesheetStore(),[dr,hr]=reactExports.useState(()=>getWeekStart(lr)),[pr,mr]=reactExports.useState(!1),[fr,xr]=reactExports.useState(!1),Er=yr=>{const br=addDays(dr,yr==="next"?7:-7);hr(br)},vr=cr(dr),gr=()=>{const yr=[];return ur.dailyRate>0&&yr.push(`${ur.dailyRate}/day`),yr.push(`${ur.baseDayHours}+1`),ur.kitRental>0&&yr.push(`Kit ${ur.kitRental}`),yr.join("  ")};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Timesheet"}),jsxRuntimeExports.jsx("button",{onClick:()=>mr(!0),className:"p-2 text-text-muted hover:text-gold transition-colors","aria-label":"Export",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 pb-3",children:jsxRuntimeExports.jsxs("div",{className:"flex bg-input-bg rounded-pill p-1 border border-border",children:[jsxRuntimeExports.jsx("button",{onClick:()=>or("week"),className:`flex-1 py-2 px-3 rounded-pill text-sm font-medium transition-all ${ar==="week"?"bg-card text-text-primary border-2 border-gold":"text-text-muted"}`,children:"Day"}),jsxRuntimeExports.jsx("button",{onClick:()=>or("sheet"),className:`flex-1 py-2 px-3 rounded-pill text-sm font-medium transition-all ${ar==="sheet"?"bg-card text-text-primary border-2 border-gold":"text-text-muted"}`,children:"Sheet"})]})})]})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsx("div",{className:"mx-4 mt-4 mb-3",children:jsxRuntimeExports.jsxs("div",{className:`rounded-xl border overflow-hidden transition-all ${fr?"border-gold":"border-border"}`,style:{backgroundColor:"var(--color-card)"},children:[jsxRuntimeExports.jsxs("div",{onClick:()=>xr(!fr),className:"px-4 py-3 flex items-center justify-between cursor-pointer",style:{backgroundColor:"var(--color-input-bg)"},children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-medium flex items-center gap-2",style:{color:"var(--color-text-muted)"},children:[jsxRuntimeExports.jsx("span",{children:""})," Rate Card"]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-xs",style:{color:"var(--color-text-placeholder)"},children:gr()}),jsxRuntimeExports.jsx("svg",{className:`w-2.5 h-2.5 transition-transform ${fr?"rotate-180":""}`,style:{color:"var(--color-text-muted)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),fr&&jsxRuntimeExports.jsx("div",{className:"px-4 py-3",style:{borderTop:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsx(RateCardSettings,{})})]})}),ar==="week"&&jsxRuntimeExports.jsx(WeekView,{weekStartDate:dr,onNavigate:Er,selectedDate:lr}),ar==="sheet"&&jsxRuntimeExports.jsx(TimesheetDocument,{weekStartDate:dr,onNavigate:Er}),jsxRuntimeExports.jsx("div",{className:"px-4 pb-24",children:jsxRuntimeExports.jsx(SummaryCard,{summary:vr})})]}),jsxRuntimeExports.jsx(ExportModal,{isOpen:pr,onClose:()=>mr(!1),weekSummary:vr,weekStartDate:dr})]})}async function extractReceiptData(ar){var or;try{const cr=(await ensureSupportedImageFormat(ar)).match(/^data:([^;]+);base64,(.+)$/);if(!cr)return{success:!1,data:null,error:"Invalid image data format"};const[,ur,dr]=cr,mr=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:[{type:"image",source:{type:"base64",media_type:ur,data:dr}},{type:"text",text:`Analyze this receipt image and extract the following information in JSON format:

{
  "vendor": "Store or supplier name",
  "amount": 123.45,
  "vat": 20.58,
  "date": "YYYY-MM-DD",
  "items": [
    { "name": "Item description", "price": 12.34 }
  ],
  "currency": "GBP",
  "confidence": "high"
}

IMPORTANT INSTRUCTIONS:
1. "vendor" - Extract the store/supplier name (e.g., "Amazon", "Catwalk Hair & Cosmetics", "Boots")
2. "amount" - The TOTAL amount paid (as a number, not string). Look for "Total", "Grand Total", "Amount Due", etc. This should be the final amount INCLUDING VAT.
3. "vat" - The VAT amount (as a number, not string). Look for "VAT", "Tax", "Sales Tax", "GST", or similar. If multiple VAT lines, sum them. If the receipt shows a VAT rate but no amount, calculate it from the subtotal. Set to null if no VAT information is visible.
4. "date" - The receipt date in YYYY-MM-DD format. Convert from any format you see (e.g., "23 November 2025"  "2025-11-23")
5. "items" - List individual items with their prices. Include product names and individual prices.
6. "currency" - Detect currency from symbols (=GBP, $=USD, =EUR) or text. Default to "GBP" if unclear.
7. "confidence" - Set to "high" if all fields are clearly visible, "medium" if some are unclear, "low" if the image is hard to read.

If a field cannot be determined, use null for that field (except items which should be an empty array).
Return ONLY the JSON object, no markdown or explanation.`}]}],system:`You are an expert receipt parser. Extract structured data from receipt images accurately.
Always return valid JSON. Be precise with numbers - do not include currency symbols in numeric fields.
For dates, always convert to YYYY-MM-DD format regardless of the source format.`,maxTokens:2e3,model:"claude-sonnet-4-20250514"})});if(!mr.ok){const yr=await mr.json().catch(()=>({}));throw new Error(((or=yr.error)==null?void 0:or.message)||yr.error||`API error: ${mr.status}`)}const fr=await mr.json();if(!fr.content||fr.content.length===0)throw new Error("Empty response from AI");const xr=fr.content[0].text;console.log("[ReceiptAI] Raw response:",xr);const Er=xr.match(/\{[\s\S]*\}/);if(!Er)throw new Error("Failed to parse receipt data from AI response");const vr=JSON.parse(Er[0]),gr={vendor:typeof vr.vendor=="string"?vr.vendor.trim():"",amount:typeof vr.amount=="number"?vr.amount:parseFloat(vr.amount)||null,vat:typeof vr.vat=="number"?vr.vat:parseFloat(vr.vat)||null,date:validateDate(vr.date),items:Array.isArray(vr.items)?vr.items.filter(yr=>yr&&typeof yr.name=="string").map(yr=>({name:yr.name.trim(),price:typeof yr.price=="number"?yr.price:parseFloat(yr.price)||0})):[],currency:typeof vr.currency=="string"?vr.currency.toUpperCase():"GBP",confidence:["high","medium","low"].includes(vr.confidence)?vr.confidence:"medium"};return console.log("[ReceiptAI] Extracted data:",gr),{success:!0,data:gr}}catch(lr){return console.error("[ReceiptAI] Extraction failed:",lr),{success:!1,data:null,error:lr instanceof Error?lr.message:"Failed to extract receipt data"}}}function validateDate(ar){if(!ar||typeof ar!="string")return null;if(/^\d{4}-\d{2}-\d{2}$/.test(ar)){const lr=new Date(ar);if(!isNaN(lr.getTime()))return ar}const or=new Date(ar);return isNaN(or.getTime())?null:or.toISOString().split("T")[0]}function buildDescriptionFromItems(ar){if(!ar||ar.length===0)return"";let lr=ar.slice(0,3).map(cr=>cr.name).join(", ");return ar.length>3&&(lr+=` +${ar.length-3} more`),lr}const EXPENSE_CATEGORIES=["Kit Supplies","Consumables","Transportation","Equipment","Other"],LEGACY_STORAGE_KEY="hairandmakeup_budget";function migrateLegacyData(){try{const ar=localStorage.getItem(LEGACY_STORAGE_KEY);if(!ar)return null;const or=JSON.parse(ar),lr={};return typeof or.budgetTotal=="number"&&(lr.budgetTotal=or.budgetTotal),typeof or.floatReceived=="number"&&(lr.floatReceived=or.floatReceived),or.currency&&(lr.currency=or.currency),Array.isArray(or.receipts)&&(lr.receipts=or.receipts),localStorage.removeItem(LEGACY_STORAGE_KEY),console.log("Migrated legacy budget data from localStorage to IndexedDB store"),lr}catch(ar){return console.error("Failed to migrate legacy budget data:",ar),null}}const useBudgetStore=create()(persist((ar,or)=>({budgetTotal:0,floatReceived:0,receipts:[],currency:DEFAULT_CURRENCY,setBudgetTotal:lr=>ar({budgetTotal:lr}),setFloatReceived:lr=>ar({floatReceived:lr}),setCurrency:lr=>ar({currency:lr}),addReceipt:lr=>{const cr={...lr,id:`r-${Date.now()}`,synced:!1};ar(ur=>({receipts:[cr,...ur.receipts]}))},updateReceipt:(lr,cr)=>{ar(ur=>({receipts:ur.receipts.map(dr=>dr.id===lr?{...dr,...cr}:dr)}))},deleteReceipt:lr=>{ar(cr=>({receipts:cr.receipts.filter(ur=>ur.id!==lr)}))},clearBudget:()=>{ar({budgetTotal:0,floatReceived:0,receipts:[],currency:DEFAULT_CURRENCY})},getTotalSpent:()=>or().receipts.reduce((lr,cr)=>lr+cr.amount,0),getTotalVat:()=>or().receipts.reduce((lr,cr)=>lr+(cr.vat||0),0),getRemaining:()=>or().budgetTotal-or().getTotalSpent(),getPercentUsed:()=>{const{budgetTotal:lr}=or();return lr>0?or().getTotalSpent()/lr*100:0},getByCategory:()=>{const lr={"Kit Supplies":0,Consumables:0,Transportation:0,Equipment:0,Other:0};return or().receipts.forEach(cr=>{lr[cr.category]+=cr.amount}),lr},getBudgetSummary:()=>({totalBudget:or().budgetTotal,totalSpent:or().getTotalSpent(),byCategory:or().getByCategory()})}),{name:"hair-makeup-budget",storage:createHybridStorage("hair-makeup-budget"),partialize:ar=>({budgetTotal:ar.budgetTotal,floatReceived:ar.floatReceived,receipts:ar.receipts,currency:ar.currency}),merge:(ar,or)=>{const lr=ar;if(!lr||!lr.receipts&&!lr.budgetTotal){const cr=migrateLegacyData();if(cr)return{...or,...cr}}return{...or,...lr||{}}}}));function Budget(){const{budgetTotal:ar,floatReceived:or,receipts:lr,currency:cr,setBudgetTotal:ur,setFloatReceived:dr,setCurrency:hr,addReceipt:pr,updateReceipt:mr,deleteReceipt:fr}=useBudgetStore(),[xr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(null),[yr,br]=reactExports.useState(!1),[_r,jr]=reactExports.useState(!1),[wr,Sr]=reactExports.useState(!1),[Tr,Rr]=reactExports.useState(!1),[Nr,Cr]=reactExports.useState(null),kr=reactExports.useRef(null),Ar=reactExports.useRef(null),{currentProject:Or}=useProjectStore(),Lr=getCurrencyByCode(cr),{totalSpent:Fr,totalVat:Hr,byCategory:Kr}=reactExports.useMemo(()=>{const Wr=lr.reduce((ns,fs)=>ns+fs.amount,0),ss=lr.reduce((ns,fs)=>ns+(fs.vat||0),0),ds={"Kit Supplies":0,Consumables:0,Transportation:0,Equipment:0,Other:0};return lr.forEach(ns=>{ds[ns.category]+=ns.amount}),{totalSpent:Wr,totalVat:ss,byCategory:ds}},[lr]),Gr=ar-Fr,Zr=ar>0?Fr/ar*100:0,Jr=()=>{jr(!0)},os=()=>{var Wr;jr(!1),(Wr=kr.current)==null||Wr.click()},Ur=()=>{var Wr;jr(!1),(Wr=Ar.current)==null||Wr.click()},Vr=Wr=>{var ds;const ss=(ds=Wr.target.files)==null?void 0:ds[0];if(ss){const ns=new FileReader;ns.onloadend=()=>{gr(ns.result),br(!0)},ns.readAsDataURL(ss)}Wr.target.value=""},es=Wr=>{pr(Wr),br(!1),gr(null)},Ir=()=>{jr(!1),gr(null),br(!0)},Dr=Wr=>{mr(Wr.id,Wr),Cr(null)},Pr=Wr=>{fr(Wr),Cr(null)},Mr=()=>{const Wr=(Or==null?void 0:Or.name)||"Production",ss=getCurrencyByCode(cr),ds=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),ns=[];return ns.push("SPENDING RECONCILIATION REPORT"),ns.push(`Project: ${Wr}`),ns.push(`Export Date: ${ds}`),ns.push(`Currency: ${cr} (${ss.symbol})`),ns.push(""),ns.push("BUDGET SUMMARY"),ns.push(`Total Budget,${ss.symbol}${ar.toFixed(2)}`),ns.push(`Float Received,${ss.symbol}${or.toFixed(2)}`),ns.push(`Total Spent,${ss.symbol}${Fr.toFixed(2)}`),ns.push(`Total VAT,${ss.symbol}${Hr.toFixed(2)}`),ns.push(`Remaining Budget,${ss.symbol}${Gr.toFixed(2)}`),ns.push(`Float Remaining,${ss.symbol}${(or-Fr).toFixed(2)}`),ns.push(`Percentage Used,${Zr.toFixed(1)}%`),ns.push(""),ns.push("SPENDING BY CATEGORY"),ns.push("Category,Amount"),EXPENSE_CATEGORIES.forEach(bs=>{Kr[bs]>0&&ns.push(`${bs},${ss.symbol}${Kr[bs].toFixed(2)}`)}),ns.push(`TOTAL,${ss.symbol}${Fr.toFixed(2)}`),ns.push(""),ns.push("RECEIPT DETAILS"),ns.push("Date,Vendor,Category,Description,Amount,VAT"),[...lr].sort((bs,Es)=>new Date(bs.date).getTime()-new Date(Es.date).getTime()).forEach(bs=>{const Es=new Date(bs.date).toLocaleDateString("en-GB"),Ds=bs.vendor.includes(",")?`"${bs.vendor}"`:bs.vendor,gs=bs.description.includes(",")?`"${bs.description}"`:bs.description,as=bs.vat>0?`${ss.symbol}${bs.vat.toFixed(2)}`:"";ns.push(`${Es},${Ds},${bs.category},${gs},${ss.symbol}${bs.amount.toFixed(2)},${as}`)}),ns.push(""),ns.push(`Total Receipts: ${lr.length}`),ns.join(`
`)},Br=Wr=>{const ss=(Or==null?void 0:Or.name)||"Production",ds=new Date().toISOString().split("T")[0];if(Wr==="csv"){const ns=Mr(),fs=new Blob([ns],{type:"text/csv"}),bs=URL.createObjectURL(fs),Es=document.createElement("a");Es.href=bs,Es.download=`spending-reconciliation-${ss.replace(/\s+/g,"-").toLowerCase()}-${ds}.csv`,document.body.appendChild(Es),Es.click(),document.body.removeChild(Es),URL.revokeObjectURL(bs)}else{const ns=Xr(),fs=new Blob([ns],{type:"text/html;charset=utf-8"}),bs=URL.createObjectURL(fs),Es=window.open(bs,"_blank");Es&&Es.addEventListener("load",()=>{setTimeout(()=>Es.print(),500)}),URL.revokeObjectURL(bs)}Rr(!1)},Xr=()=>{const Wr=(Or==null?void 0:Or.name)||"Production",ds=getCurrencyByCode(cr).symbol,ns=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),fs=[...lr].sort((Es,Ds)=>new Date(Es.date).getTime()-new Date(Ds.date).getTime()),bs=fs.filter(Es=>Es.imageUri);return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spending Reconciliation - ${Wr}</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 32px;
      max-width: 800px;
      margin: 0 auto;
      color: #1a1a1a;
      font-size: 13px;
      line-height: 1.5;
    }

    /* Header */
    .header { margin-bottom: 28px; }
    .header h1 { font-size: 22px; font-weight: 700; color: #1a1a1a; margin-bottom: 2px; }
    .header .project { font-size: 15px; color: #C9A962; font-weight: 600; margin-bottom: 4px; }
    .header .date { font-size: 12px; color: #888; }

    /* Summary Cards */
    .summary {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 28px;
    }
    .summary-card {
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 14px 12px;
      text-align: center;
    }
    .summary-card .label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 4px; }
    .summary-card .value { font-size: 20px; font-weight: 700; color: #1a1a1a; }
    .summary-card.gold { border-color: #C9A962; background: #faf6ed; }
    .summary-card.gold .value { color: #C9A962; }
    .summary-card.over .value { color: #dc3545; }

    /* Progress Bar */
    .progress-wrap { margin-bottom: 28px; }
    .progress-bar { height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 4px; background: #C9A962; }
    .progress-fill.over { background: #dc3545; }
    .progress-label { display: flex; justify-content: space-between; margin-top: 4px; font-size: 11px; color: #888; }

    /* Sections */
    .section { margin-bottom: 28px; }
    .section-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #888;
      padding-bottom: 6px;
      border-bottom: 2px solid #C9A962;
      margin-bottom: 12px;
    }

    /* Category Breakdown */
    .cat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
    .cat-row .name { color: #333; }
    .cat-row .bar-wrap { flex: 1; margin: 0 16px; display: flex; align-items: center; }
    .cat-bar { height: 6px; background: #C9A962; border-radius: 3px; opacity: 0.6; }
    .cat-row .amt { font-weight: 600; color: #1a1a1a; min-width: 80px; text-align: right; }
    .cat-total { display: flex; justify-content: space-between; padding: 10px 0; border-top: 2px solid #C9A962; font-weight: 700; margin-top: 4px; }

    /* Receipts Table */
    table.receipts { width: 100%; border-collapse: collapse; }
    table.receipts th {
      background: #f8f8f8;
      padding: 10px 8px;
      text-align: left;
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      color: #666;
      border-bottom: 2px solid #e5e5e5;
    }
    table.receipts td {
      padding: 10px 8px;
      border-bottom: 1px solid #f0f0f0;
      vertical-align: top;
    }
    table.receipts tr:last-child td { border-bottom: none; }
    table.receipts .num { text-align: center; color: #aaa; font-size: 11px; }
    table.receipts .amt { text-align: right; font-weight: 600; white-space: nowrap; }
    table.receipts .cat { font-size: 11px; color: #666; }
    table.receipts .desc { font-size: 11px; color: #999; }
    table.receipts tfoot td { border-top: 2px solid #C9A962; font-weight: 700; padding-top: 12px; }

    /* Receipt Filing */
    .filing-entry {
      page-break-inside: avoid;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .filing-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background: #f8f8f8;
      border-bottom: 1px solid #e5e5e5;
    }
    .filing-header .vendor { font-weight: 600; font-size: 14px; }
    .filing-header .amount { font-weight: 700; font-size: 14px; }
    .filing-meta {
      display: flex;
      gap: 16px;
      padding: 8px 14px;
      font-size: 11px;
      color: #666;
      border-bottom: 1px solid #f0f0f0;
    }
    .filing-meta span { display: flex; align-items: center; gap: 4px; }
    .filing-image {
      padding: 12px;
      text-align: center;
      background: #fafafa;
    }
    .filing-image img {
      max-width: 100%;
      max-height: 500px;
      object-fit: contain;
      border-radius: 4px;
    }

    /* Footer */
    .footer {
      margin-top: 32px;
      padding-top: 12px;
      border-top: 1px solid #e5e5e5;
      font-size: 11px;
      color: #aaa;
      text-align: center;
    }

    @media print {
      body { padding: 16px; }
      .summary-card.gold, table.receipts th, .filing-header {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      .filing-entry { page-break-inside: avoid; }
      .receipt-filing { page-break-before: always; }
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>Spending Reconciliation</h1>
    <div class="project">${Wr}</div>
    <div class="date">Exported ${ns}</div>
  </div>

  <div class="summary">
    <div class="summary-card">
      <div class="label">Budget</div>
      <div class="value">${ds}${ar.toFixed(2)}</div>
    </div>
    <div class="summary-card">
      <div class="label">Spent</div>
      <div class="value">${ds}${Fr.toFixed(2)}</div>
    </div>
    <div class="summary-card ${Gr>=0?"gold":"over"}">
      <div class="label">${Gr>=0?"Remaining":"Over Budget"}</div>
      <div class="value">${ds}${Math.abs(Gr).toFixed(2)}</div>
    </div>
    <div class="summary-card">
      <div class="label">Used</div>
      <div class="value">${Zr.toFixed(1)}%</div>
    </div>
  </div>

  <div class="progress-wrap">
    <div class="progress-bar">
      <div class="progress-fill ${Zr>100?"over":""}" style="width: ${Math.min(Zr,100)}%"></div>
    </div>
    <div class="progress-label">
      <span>0%</span>
      <span>Budget utilisation</span>
      <span>100%</span>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Financial Reconciliation</div>
    <table style="width:100%; border-collapse:collapse; font-size:13px;">
      <tbody>
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Total Budget</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${ds}${ar.toFixed(2)}</td>
        </tr>
        ${or>0?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Float Received</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${ds}${or.toFixed(2)}</td>
        </tr>`:""}
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Total Spent</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${ds}${Fr.toFixed(2)}</td>
        </tr>
        ${Hr>0?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Total VAT (included in spent)</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${ds}${Hr.toFixed(2)}</td>
        </tr>
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Spend excl. VAT</td>
          <td style="padding:8px 0; text-align:right; font-weight:600">${ds}${(Fr-Hr).toFixed(2)}</td>
        </tr>`:""}
        ${or>0?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Float Remaining</td>
          <td style="padding:8px 0; text-align:right; font-weight:700; color:${or-Fr>=0?"#198754":"#dc3545"}">${ds}${(or-Fr).toFixed(2)}</td>
        </tr>`:""}
        ${or>0&&or<ar?`
        <tr style="border-bottom:1px solid #f0f0f0">
          <td style="padding:8px 0; color:#666">Outstanding from Production</td>
          <td style="padding:8px 0; text-align:right; font-weight:700; color:#C9A962">${ds}${(ar-or).toFixed(2)}</td>
        </tr>`:""}
        ${or>0&&Fr>or?`
        <tr>
          <td style="padding:8px 0; color:#666">Owed by Production (overspend on float)</td>
          <td style="padding:8px 0; text-align:right; font-weight:700; color:#dc3545">${ds}${(Fr-or).toFixed(2)}</td>
        </tr>`:""}
      </tbody>
    </table>
  </div>

  <div class="section">
    <div class="section-title">Spending by Category</div>
    ${EXPENSE_CATEGORIES.filter(Es=>Kr[Es]>0).map(Es=>{const Ds=Fr>0?Kr[Es]/Fr*100:0;return`
      <div class="cat-row">
        <span class="name">${Es}</span>
        <span class="bar-wrap"><span class="cat-bar" style="width: ${Ds}%"></span></span>
        <span class="amt">${ds}${Kr[Es].toFixed(2)}</span>
      </div>`}).join("")}
    <div class="cat-total">
      <span>Total</span>
      <span>${ds}${Fr.toFixed(2)}</span>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Receipt Log (${lr.length} receipts)</div>
    <table class="receipts">
      <thead>
        <tr>
          <th style="width:30px">#</th>
          <th>Date</th>
          <th>Vendor</th>
          <th>Category</th>
          <th>Description</th>
          <th class="amt">VAT</th>
          <th class="amt">Amount</th>
        </tr>
      </thead>
      <tbody>
        ${fs.map((Es,Ds)=>`
        <tr>
          <td class="num">${Ds+1}</td>
          <td>${new Date(Es.date).toLocaleDateString("en-GB")}</td>
          <td>${Es.vendor}</td>
          <td class="cat">${Es.category}</td>
          <td class="desc">${Es.description||"&mdash;"}</td>
          <td class="amt">${Es.vat>0?`${ds}${Es.vat.toFixed(2)}`:"&mdash;"}</td>
          <td class="amt">${ds}${Es.amount.toFixed(2)}</td>
        </tr>`).join("")}
      </tbody>
      <tfoot>
        <tr>
          <td colspan="5">Total (${lr.length} receipts)</td>
          <td class="amt">${Hr>0?`${ds}${Hr.toFixed(2)}`:"&mdash;"}</td>
          <td class="amt">${ds}${Fr.toFixed(2)}</td>
        </tr>
      </tfoot>
    </table>
  </div>

  ${bs.length>0?`
  <div class="section receipt-filing">
    <div class="section-title">Receipt Filing (${bs.length} images)</div>
    ${bs.map((Es,Ds)=>`
    <div class="filing-entry">
      <div class="filing-header">
        <span class="vendor">${Ds+1}. ${Es.vendor}</span>
        <span class="amount">${ds}${Es.amount.toFixed(2)}</span>
      </div>
      <div class="filing-meta">
        <span>${new Date(Es.date).toLocaleDateString("en-GB")}</span>
        <span>${Es.category}</span>
        ${Es.description?`<span>${Es.description}</span>`:""}
      </div>
      <div class="filing-image">
        <img src="${Es.imageUri}" alt="Receipt from ${Es.vendor}">
      </div>
    </div>`).join("")}
  </div>`:""}

  <div class="footer">
    Generated by Hair &amp; Makeup Pro &middot; ${ns}
  </div>

</body>
</html>`};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Budget"}),jsxRuntimeExports.jsxs("button",{onClick:()=>Sr(!0),className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-text-muted bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:[jsxRuntimeExports.jsx("span",{children:Lr.symbol}),jsxRuntimeExports.jsx("span",{children:cr}),jsxRuntimeExports.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[lr.length>0&&jsxRuntimeExports.jsx("button",{onClick:()=>Rr(!0),className:"p-2 text-text-muted active:text-gold transition-colors",title:"Export reconciliation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})})}),jsxRuntimeExports.jsxs("button",{onClick:Jr,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-gold active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"})]}),"Scan"]})]})]})})}),jsxRuntimeExports.jsx("input",{ref:kr,type:"file",accept:"image/*",capture:"environment",onChange:Vr,className:"hidden"}),jsxRuntimeExports.jsx("input",{ref:Ar,type:"file",accept:"image/*",onChange:Vr,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"section-header",children:"SPENDING OVERVIEW"}),jsxRuntimeExports.jsxs("button",{onClick:()=>Er(!0),className:"flex items-center gap-1 text-xs text-gold font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125"})}),ar>0?"Edit Budget":"Set Budget"]})]}),jsxRuntimeExports.jsx("div",{className:"relative h-3 bg-gray-100 rounded-full overflow-hidden mb-3",children:ar>0?jsxRuntimeExports.jsx("div",{className:`absolute left-0 top-0 h-full rounded-full transition-all ${Zr>90?"bg-error":Zr>70?"bg-amber-500":"bg-gold"}`,style:{width:`${Math.min(Zr,100)}%`}}):jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-light",children:"Set a budget to track spending"})})}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-end",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-2xl font-bold text-text-primary",children:formatCurrency(Fr,cr)}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted ml-1",children:"spent"})]}),jsxRuntimeExports.jsx("div",{className:"text-right",children:ar>0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:`text-lg font-semibold ${Gr<0?"text-error":"text-green-600"}`,children:formatCurrency(Gr,cr)}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:["remaining of ",formatCurrency(ar,cr)]})]}):jsxRuntimeExports.jsx("button",{onClick:()=>Er(!0),className:"text-sm text-gold font-medium",children:"Tap to set budget"})})]}),(or>0||Hr>0)&&jsxRuntimeExports.jsxs("div",{className:"mt-3 pt-3 border-t border-border space-y-1.5",children:[or>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Float received"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:formatCurrency(or,cr)})]}),or>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Float remaining"}),jsxRuntimeExports.jsx("span",{className:`font-semibold ${or-Fr<0?"text-error":"text-green-600"}`,children:formatCurrency(or-Fr,cr)})]}),Hr>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Total VAT"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:formatCurrency(Hr,cr)})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("h2",{className:"section-header mb-3",children:"BY CATEGORY"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[EXPENSE_CATEGORIES.filter(Wr=>Kr[Wr]>0).map(Wr=>{const ss=Kr[Wr],ds=Fr>0?ss/Fr*100:0;return jsxRuntimeExports.jsx("div",{className:"flex items-center gap-3",children:jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-text-primary",children:Wr}),jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:formatCurrency(ss,cr)})]}),jsxRuntimeExports.jsx("div",{className:"h-1.5 bg-gray-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gold/60 rounded-full",style:{width:`${ds}%`}})})]})},Wr)}),Fr===0&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light text-center py-2",children:"No expenses recorded yet"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"section-header",children:"RECENT RECEIPTS"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[lr.length," total"]})]}),lr.length>0&&jsxRuntimeExports.jsx("div",{className:"space-y-2",children:lr.map(Wr=>jsxRuntimeExports.jsx("div",{className:"card cursor-pointer active:scale-[0.98] transition-transform",onClick:()=>Cr(Wr),children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary truncate",children:Wr.vendor}),!Wr.synced&&jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[9px] font-medium rounded bg-amber-100 text-amber-700",children:"Pending"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:Wr.description}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium rounded-full bg-gray-100 text-text-muted",children:Wr.category}),jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-light",children:formatShortDate(Wr.date)})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-bold text-text-primary",children:formatCurrency(Wr.amount,cr)}),Wr.vat>0&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-light block",children:["VAT ",formatCurrency(Wr.vat,cr)]})]}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})},Wr.id))})]}),jsxRuntimeExports.jsxs("button",{onClick:Jr,className:"w-full card flex items-center justify-center gap-3 py-4 border-2 border-dashed border-gold/30 hover:border-gold hover:bg-gold/5 transition-colors",children:[jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-gold",children:"Add Receipt"})]}),jsxRuntimeExports.jsx("div",{className:"text-center py-2",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light",children:"Syncs with website budget page"})})]}),wr&&jsxRuntimeExports.jsx(CurrencyPickerModal,{currentCurrency:cr,onSelect:Wr=>{hr(Wr),Sr(!1)},onClose:()=>Sr(!1)}),yr&&jsxRuntimeExports.jsx(AddReceiptModal,{imageUri:vr,currencySymbol:Lr.symbol,onAdd:es,onClose:()=>{br(!1),gr(null)}}),_r&&jsxRuntimeExports.jsx(ScanOptionsModal,{onTakePhoto:os,onChooseFromLibrary:Ur,onManualEntry:Ir,onClose:()=>jr(!1)}),xr&&jsxRuntimeExports.jsx(BudgetEditModal,{currentBudget:ar,currentFloat:or,currencySymbol:Lr.symbol,onSave:(Wr,ss)=>{ur(Wr),dr(ss),Er(!1)},onClose:()=>Er(!1)}),Tr&&jsxRuntimeExports.jsx(ExportReconciliationModal,{onExport:Br,onClose:()=>Rr(!1),receiptsCount:lr.length,totalSpent:Fr,currencySymbol:Lr.symbol}),Nr&&jsxRuntimeExports.jsx(ReceiptDetailModal,{receipt:Nr,currencySymbol:Lr.symbol,onSave:Dr,onDelete:Pr,onClose:()=>Cr(null)})]})}function CurrencyPickerModal({currentCurrency:ar,onSelect:or,onClose:lr}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:lr,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg",onClick:cr=>cr.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-3 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Select Currency"})}),jsxRuntimeExports.jsx("div",{className:"p-2 max-h-[60vh] overflow-y-auto",children:CURRENCIES.map(cr=>jsxRuntimeExports.jsxs("button",{onClick:()=>or(cr.code),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${ar===cr.code?"bg-gold/10":"hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx("span",{className:"text-xl font-medium text-text-primary w-8",children:cr.symbol}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:cr.code}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted ml-2",children:cr.name})]}),ar===cr.code&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})]},cr.code))}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border",children:jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-full px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"})})]})})}function ScanOptionsModal({onTakePhoto:ar,onChooseFromLibrary:or,onManualEntry:lr,onClose:cr}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:cr,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg animate-slideUp",onClick:ur=>ur.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Add Receipt"})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:ar,className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gold/10 hover:bg-gold/20 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-gold/20 flex items-center justify-center",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Take Photo"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Capture receipt with camera"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:or,className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Choose from Library"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Select existing photo"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:lr,className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Manual Entry"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Enter details without photo"})]})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border",children:jsxRuntimeExports.jsx("button",{onClick:cr,className:"w-full px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"})})]})})}function AddReceiptModal({imageUri:ar,currencySymbol:or,onAdd:lr,onClose:cr}){const[ur,dr]=reactExports.useState(""),[hr,pr]=reactExports.useState(""),[mr,fr]=reactExports.useState(""),[xr,Er]=reactExports.useState("Kit Supplies"),[vr,gr]=reactExports.useState(""),[yr,br]=reactExports.useState(new Date().toISOString().split("T")[0]),[_r,jr]=reactExports.useState(!1),[wr,Sr]=reactExports.useState(null),[Tr,Rr]=reactExports.useState([]);reactExports.useEffect(()=>{ar&&Nr(ar)},[ar]);const Nr=async kr=>{jr(!0),Sr(null);try{const Ar=await extractReceiptData(kr);if(Ar.success&&Ar.data){const{data:Or}=Ar;Or.vendor&&dr(Or.vendor),Or.amount!==null&&pr(Or.amount.toFixed(2)),Or.vat!==null&&Or.vat!==void 0&&fr(Or.vat.toFixed(2)),Or.date&&br(Or.date),Or.items&&Or.items.length>0&&(Rr(Or.items),gr(buildDescriptionFromItems(Or.items))),Or.confidence==="low"&&Sr("Some values may be inaccurate. Please review carefully.")}else Sr(Ar.error||"Failed to extract receipt data. Please enter manually.")}catch(Ar){console.error("Extraction error:",Ar),Sr("Failed to analyze receipt. Please enter details manually.")}finally{jr(!1)}},Cr=kr=>{kr.preventDefault(),!(!ur||!hr)&&lr({date:yr,vendor:ur,amount:parseFloat(hr),vat:parseFloat(mr)||0,category:xr,description:vr,imageUri:ar||void 0})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Add Receipt"}),jsxRuntimeExports.jsx("button",{onClick:cr,className:"p-2 -mr-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("form",{onSubmit:Cr,className:"p-4 space-y-4",children:[ar&&jsxRuntimeExports.jsxs("div",{className:"relative aspect-[4/3] rounded-lg overflow-hidden bg-gray-100",children:[jsxRuntimeExports.jsx("img",{src:ar,alt:"Receipt",className:"w-full h-full object-contain"}),_r&&jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 bg-black/60 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-3 border-white/30 border-t-white rounded-full animate-spin mb-3"}),jsxRuntimeExports.jsx("span",{className:"text-white text-sm font-medium",children:"Analyzing receipt..."})]})]}),wr&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 rounded-lg bg-amber-50 border border-amber-200",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-700",children:wr})}),!_r&&!wr&&ar&&ur&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 rounded-lg bg-green-50 border border-green-200",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-green-700",children:"Receipt data extracted. Please review and edit if needed."})}),Tr.length>0&&jsxRuntimeExports.jsxs("div",{className:"rounded-lg border border-gray-200 overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-secondary",children:"Detected Items:"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Rr([...Tr,{name:"",price:0}]),disabled:_r,className:"text-[10px] font-medium text-gold hover:text-gold-dark",children:"+ Add Item"})]}),jsxRuntimeExports.jsx("div",{className:"divide-y divide-gray-100 max-h-48 overflow-y-auto",children:Tr.map((kr,Ar)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:kr.name,onChange:Or=>{const Lr=[...Tr];Lr[Ar]={...kr,name:Or.target.value},Rr(Lr),gr(buildDescriptionFromItems(Lr))},className:"flex-1 text-xs bg-transparent border-b border-transparent focus:border-gold outline-none py-1 text-text-primary",placeholder:"Item name",disabled:_r}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:kr.price||"",onChange:Or=>{const Lr=[...Tr];Lr[Ar]={...kr,price:parseFloat(Or.target.value)||0},Rr(Lr)},className:"w-16 text-xs text-right bg-transparent border-b border-transparent focus:border-gold outline-none py-1 text-text-primary",placeholder:"0.00",disabled:_r})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{const Or=Tr.filter((Lr,Fr)=>Fr!==Ar);Rr(Or),gr(buildDescriptionFromItems(Or))},disabled:_r,className:"p-1 text-text-light hover:text-red-500 transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},Ar))}),jsxRuntimeExports.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-t border-gray-200 flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-text-secondary",children:"Items Total:"}),jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-text-primary",children:[or,Tr.reduce((kr,Ar)=>kr+(Ar.price||0),0).toFixed(2)]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Vendor / Store"}),jsxRuntimeExports.jsx("input",{type:"text",value:ur,onChange:kr=>dr(kr.target.value),className:"input-field w-full",placeholder:"e.g., Camera Ready Cosmetics",required:!0,disabled:_r})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Amount"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:hr,onChange:kr=>pr(kr.target.value),className:"input-field w-full pl-7",placeholder:"0.00",required:!0,disabled:_r})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"VAT"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:mr,onChange:kr=>fr(kr.target.value),className:"input-field w-full pl-7",placeholder:"0.00",disabled:_r})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Date"}),jsxRuntimeExports.jsx("input",{type:"date",value:yr,onChange:kr=>br(kr.target.value),className:"input-field w-full",disabled:_r})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Category"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:EXPENSE_CATEGORIES.map(kr=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Er(kr),disabled:_r,className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${xr===kr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"} ${_r?"opacity-50 cursor-not-allowed":""}`,children:kr},kr))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Description (optional)"}),jsxRuntimeExports.jsx("input",{type:"text",value:vr,onChange:kr=>gr(kr.target.value),className:"input-field w-full",placeholder:"e.g., Foundation restocks",disabled:_r})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:cr,className:"flex-1 px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",disabled:_r,children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 rounded-button gold-gradient text-white font-medium disabled:opacity-50",disabled:!ur||!hr||_r,children:_r?"Analyzing...":"Add Receipt"})]})]})]})})}function ReceiptDetailModal({receipt:ar,currencySymbol:or,onSave:lr,onDelete:cr,onClose:ur}){const[dr,hr]=reactExports.useState(!1),[pr,mr]=reactExports.useState(ar.vendor),[fr,xr]=reactExports.useState(ar.amount.toFixed(2)),[Er,vr]=reactExports.useState((ar.vat||0).toFixed(2)),[gr,yr]=reactExports.useState(ar.category),[br,_r]=reactExports.useState(ar.description),[jr,wr]=reactExports.useState(ar.date),[Sr,Tr]=reactExports.useState(!1),Rr=Nr=>{Nr.preventDefault(),!(!pr||!fr)&&lr({...ar,vendor:pr,amount:parseFloat(fr),vat:parseFloat(Er)||0,category:gr,description:br,date:jr})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:ur,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto animate-slideUp",onClick:Nr=>Nr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between z-10",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:dr?"Edit Receipt":"Receipt Details"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[!dr&&jsxRuntimeExports.jsx("button",{onClick:()=>hr(!0),className:"p-2 text-gold hover:text-gold-dark transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),jsxRuntimeExports.jsx("button",{onClick:ur,className:"p-2 -mr-2 text-text-muted hover:text-text-primary transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),ar.imageUri&&jsxRuntimeExports.jsx("div",{className:"relative aspect-[4/3] bg-gray-100",children:jsxRuntimeExports.jsx("img",{src:ar.imageUri,alt:"Receipt",className:"w-full h-full object-contain"})}),dr?jsxRuntimeExports.jsxs("form",{onSubmit:Rr,className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Vendor / Store"}),jsxRuntimeExports.jsx("input",{type:"text",value:pr,onChange:Nr=>mr(Nr.target.value),className:"input-field w-full",placeholder:"e.g., Camera Ready Cosmetics",required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Amount"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",value:fr,onChange:Nr=>xr(Nr.target.value),className:"input-field w-full pl-7",placeholder:"0.00",required:!0})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"VAT"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:or}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:Er,onChange:Nr=>vr(Nr.target.value),className:"input-field w-full pl-7",placeholder:"0.00"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Date"}),jsxRuntimeExports.jsx("input",{type:"date",value:jr,onChange:Nr=>wr(Nr.target.value),className:"input-field w-full"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Category"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:EXPENSE_CATEGORIES.map(Nr=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>yr(Nr),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all ${gr===Nr?"bg-gold text-white border-gold":"bg-white text-text-secondary border-border hover:border-gold/50"}`,children:Nr},Nr))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Description"}),jsxRuntimeExports.jsx("input",{type:"text",value:br,onChange:Nr=>_r(Nr.target.value),className:"input-field w-full",placeholder:"e.g., Foundation restocks"})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{mr(ar.vendor),xr(ar.amount.toFixed(2)),vr((ar.vat||0).toFixed(2)),yr(ar.category),_r(ar.description),wr(ar.date),hr(!1)},className:"flex-1 px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 rounded-button gold-gradient text-white font-medium disabled:opacity-50",disabled:!pr||!fr,children:"Save Changes"})]})]}):jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-text-primary",children:ar.vendor}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-0.5",children:formatShortDate(ar.date)})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("span",{className:"text-xl font-bold text-text-primary",children:[or,ar.amount.toFixed(2)]}),ar.vat>0&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:["incl. ",or,ar.vat.toFixed(2)," VAT"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[ar.vat>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"VAT"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-text-primary",children:[or,ar.vat.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Category"}),jsxRuntimeExports.jsx("span",{className:"px-2.5 py-1 text-xs font-medium rounded-full bg-gray-100 text-text-secondary",children:ar.category})]}),ar.description&&jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Description"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-primary text-right max-w-[60%]",children:ar.description})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Status"}),jsxRuntimeExports.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${ar.synced?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:ar.synced?"Synced":"Pending"})]})]}),jsxRuntimeExports.jsx("div",{className:"pt-2",children:Sr?jsxRuntimeExports.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Delete this receipt? This cannot be undone."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Tr(!1),className:"flex-1 px-4 py-2.5 rounded-button bg-white border border-border text-text-primary text-sm font-medium",children:"Keep"}),jsxRuntimeExports.jsx("button",{onClick:()=>cr(ar.id),className:"flex-1 px-4 py-2.5 rounded-button bg-red-500 text-white text-sm font-medium",children:"Delete"})]})]}):jsxRuntimeExports.jsx("button",{onClick:()=>Tr(!0),className:"w-full px-4 py-3 rounded-button text-red-500 text-sm font-medium hover:bg-red-50 transition-colors",children:"Delete Receipt"})})]})]})})}function BudgetEditModal({currentBudget:ar,currentFloat:or,currencySymbol:lr,onSave:cr,onClose:ur}){const[dr,hr]=reactExports.useState(ar>0?ar.toString():""),[pr,mr]=reactExports.useState(or>0?or.toString():""),fr=xr=>{xr.preventDefault();const Er=parseFloat(dr),vr=parseFloat(pr)||0;!isNaN(Er)&&Er>=0&&cr(Er,vr)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:ur,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg animate-slideUp",onClick:xr=>xr.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-3 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Budget Settings"})}),jsxRuntimeExports.jsxs("form",{onSubmit:fr,className:"p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Total Budget"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mb-2",children:"The overall budget allocated for this production."}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-lg",children:lr}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:dr,onChange:xr=>hr(xr.target.value),className:"input-field w-full pl-8 text-2xl font-bold",placeholder:"0.00",autoFocus:!0})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1.5",children:"Float Received"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mb-2",children:"Money received in advance from production. This could be the full budget or a partial payment."}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-lg",children:lr}),jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",min:"0",value:pr,onChange:xr=>mr(xr.target.value),className:"input-field w-full pl-8 text-xl font-bold",placeholder:"0.00"})]})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 flex gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:ur,className:"flex-1 px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 rounded-button gold-gradient text-white font-medium",children:"Save"})]})]})]})})}function ExportReconciliationModal({onExport:ar,onClose:or,receiptsCount:lr,totalSpent:cr,currencySymbol:ur}){return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",onClick:or,children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-t-2xl w-full max-w-lg animate-slideUp",onClick:dr=>dr.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-b border-border",children:jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary text-center",children:"Export Spending Report"})}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Reconciliation Summary"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[lr," receipts recorded"]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("p",{className:"text-lg font-bold text-gold",children:[ur,cr.toFixed(2)]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"total spent"})]})]})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Export a spending reconciliation report to send to production. Choose your preferred format:"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>ar("csv"),className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"Spreadsheet (CSV)"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Opens in Excel, Google Sheets"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>ar("pdf"),className:"w-full flex items-center gap-4 px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("span",{className:"text-base font-semibold text-text-primary block",children:"PDF Report"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Print-ready document"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-full px-4 py-3 rounded-button bg-gray-100 text-text-primary font-medium",children:"Cancel"})})]})})}const scriptRel="modulepreload",assetsURL=function(ar){return"/mobile/"+ar},seen={},__vitePreload=function ar(or,lr,cr){let ur=Promise.resolve();if(lr&&lr.length>0){document.getElementsByTagName("link");const hr=document.querySelector("meta[property=csp-nonce]"),pr=(hr==null?void 0:hr.nonce)||(hr==null?void 0:hr.getAttribute("nonce"));ur=Promise.allSettled(lr.map(mr=>{if(mr=assetsURL(mr),mr in seen)return;seen[mr]=!0;const fr=mr.endsWith(".css"),xr=fr?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${mr}"]${xr}`))return;const Er=document.createElement("link");if(Er.rel=fr?"stylesheet":scriptRel,fr||(Er.as="script"),Er.crossOrigin="",Er.href=mr,pr&&Er.setAttribute("nonce",pr),document.head.appendChild(Er),fr)return new Promise((vr,gr)=>{Er.addEventListener("load",vr),Er.addEventListener("error",()=>gr(new Error(`Unable to preload CSS for ${mr}`)))})}))}function dr(hr){const pr=new Event("vite:preloadError",{cancelable:!0});if(pr.payload=hr,window.dispatchEvent(pr),!pr.defaultPrevented)throw hr}return ur.then(hr=>{for(const pr of hr||[])pr.status==="rejected"&&dr(pr.reason);return or().catch(dr)})},INVOICE_TIERS=["supervisor","designer"];function ProjectExportScreen({onBack:ar,onExportComplete:or,onNavigateToBilling:lr}){var Jr,os;const{currentProject:cr,lifecycle:ur,sceneCaptures:dr}=useProjectStore(),{billingDetails:hr,isBillingComplete:pr}=useBillingStore(),mr=(cr==null?void 0:cr.id)??"",fr=useProductionDetailsStore(Ur=>Ur.getDetails(mr)),{entries:xr,calculateEntry:Er,rateCard:vr}=useTimesheetStore(),{user:gr}=useAuthStore(),[yr,br]=reactExports.useState(EXPORT_DOCUMENTS.map(Ur=>({...Ur}))),_r=gr&&INVOICE_TIERS.includes(gr.tier),jr=(Jr=yr.find(Ur=>Ur.id==="invoice_summary"))==null?void 0:Jr.selected,wr=pr(),[Sr,Tr]=reactExports.useState("download"),[Rr,Nr]=reactExports.useState({status:"idle",progress:0}),Cr=()=>{let Ur=0;return yr.filter(es=>es.selected).forEach(es=>{switch(es.id){case"continuity_bible":Ur+=2*1024*1024;break;case"scene_breakdown":Ur+=50*1024;break;case"character_lookbooks":Ur+=((cr==null?void 0:cr.characters.length)||0)*1024*1024;break;case"photo_archive":const Ir=Object.values(dr).reduce((Dr,Pr)=>{let Mr=0;return Pr.photos.front&&Mr++,Pr.photos.left&&Mr++,Pr.photos.right&&Mr++,Pr.photos.back&&Mr++,Mr+=Pr.additionalPhotos.length,Dr+Mr},0);Ur+=Ir*500*1024;break;case"timesheets":Ur+=200*1024;break;case"invoice_summary":Ur+=100*1024;break}}),Ur<1024*1024?`~${Math.round(Ur/1024)} KB`:`~${Math.round(Ur/(1024*1024))} MB`},kr=Ur=>{br(Vr=>Vr.map(es=>es.id===Ur?{...es,selected:!es.selected}:es))},Ar=()=>{const Ur=yr.every(Vr=>Vr.selected);br(Vr=>Vr.map(es=>({...es,selected:!Ur})))},Or=Ur=>{switch(Ur){case"pdf":return"bg-red-100 text-red-700";case"csv":case"excel":return"bg-green-100 text-green-700";case"zip":case"pdf_zip":return"bg-blue-100 text-blue-700";default:return"bg-gray-100 text-gray-700"}},Lr=Ur=>{switch(Ur){case"pdf":return"PDF";case"csv":return"CSV";case"excel":return"Excel";case"zip":return"ZIP";case"pdf_zip":return"PDF (zip)";default:return Ur.toUpperCase()}},Fr=async()=>{const Ur=yr.filter(Vr=>Vr.selected).map(Vr=>Vr.id);if(Ur.length!==0){Nr({status:"preparing",progress:0});try{for(let Vr=0;Vr<Ur.length;Vr++){const es=Ur[Vr];Nr({status:"generating",currentDocument:es,progress:Math.round(Vr/Ur.length*80)}),await new Promise(Ir=>setTimeout(Ir,500))}Nr({status:"packaging",progress:90}),await new Promise(Vr=>setTimeout(Vr,500)),await Hr(Ur),Nr({status:"complete",progress:100}),setTimeout(()=>{or==null||or()},1500)}catch(Vr){Nr({status:"error",progress:0,error:Vr instanceof Error?Vr.message:"Export failed"})}}},Hr=async Ur=>{const{generateContinuityBiblePDF:Vr}=await __vitePreload(async()=>{const{generateContinuityBiblePDF:Dr}=await Promise.resolve().then(()=>exportUtils);return{generateContinuityBiblePDF:Dr}},void 0),{generateSceneBreakdownCSV:es}=await __vitePreload(async()=>{const{generateSceneBreakdownCSV:Dr}=await Promise.resolve().then(()=>exportUtils);return{generateSceneBreakdownCSV:Dr}},void 0),Ir=[];if(cr){for(const Dr of Ur)switch(Dr){case"continuity_bible":const Pr=Vr(cr,dr);Ir.push({filename:`${cr.name}_Continuity_Bible.html`,content:Pr,mimeType:"text/html"});break;case"scene_breakdown":const Mr=es(cr,dr);Ir.push({filename:`${cr.name}_Scene_Breakdown.csv`,content:Mr,mimeType:"text/csv"});break;case"invoice_summary":{const Br=hr,Xr=Object.values(xr).sort((ys,_s)=>ys.date.localeCompare(_s.date));if(Xr.length===0)break;let Wr=0,ss=0,ds=0,ns=0;Xr.forEach((ys,_s)=>{const Ss=_s>0?Xr[_s-1].wrapOut:void 0,vs=Er(ys,Ss);Wr+=vs.totalHours,ss+=vs.totalEarnings,ds+=vs.otHours,ns+=vs.preCallHours});const fs=calculateInvoiceWithVAT(ss,Br.vatSettings),bs=ys=>ys?ys.split(`
`).map(_s=>_s.trim()).filter(Boolean).join("<br>"):"",Es=fr.invoiceAddressDifferent&&fr.invoiceAddress?bs(fr.invoiceAddress):bs(fr.productionAddress),Ds=[];fr.poNumber&&Ds.push(`PO: ${fr.poNumber}`),fr.costCode&&Ds.push(`Cost Code: ${fr.costCode}`),fr.jobReference&&Ds.push(`Job Ref: ${fr.jobReference}`);const gs=Xr[0].date,as=Xr[Xr.length-1].date,qr=`INV-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`,ts=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}),Yr="&pound;",hs=`<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><title>Invoice Summary  ${cr.name}</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; color: #1a1a1a; font-size: 14px; line-height: 1.5; }
  .hdr { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px; padding-bottom: 16px; border-bottom: 3px solid #C9A962; }
  .hdr h1 { font-size: 20px; font-weight: 700; } .hdr .sub { font-size: 12px; color: #888; }
  .inv-lbl { font-size: 28px; font-weight: 800; color: #C9A962; letter-spacing: 2px; }
  .inv-num { font-size: 13px; color: #666; }
  .cols { display: flex; justify-content: space-between; margin-bottom: 28px; }
  .col h3 { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 6px; }
  .col p { font-size: 13px; color: #333; line-height: 1.7; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
  thead th { text-align: left; padding: 8px 10px; font-size: 11px; font-weight: 600; text-transform: uppercase; color: #666; border-bottom: 2px solid #e5e5e5; }
  tbody td { padding: 10px; border-bottom: 1px solid #f0f0f0; }
  .amt { text-align: right; font-weight: 600; }
  .totals { width: 280px; margin-left: auto; margin-bottom: 32px; }
  .totals .r { display: flex; justify-content: space-between; padding: 5px 0; font-size: 13px; }
  .totals .r .l { color: #666; } .totals .r .v { font-weight: 600; }
  .totals .t { border-top: 2px solid #C9A962; padding-top: 8px; margin-top: 4px; }
  .totals .t .l { font-weight: 700; font-size: 14px; } .totals .t .v { font-weight: 800; font-size: 18px; color: #C9A962; }
  .box { background: #f8f8f8; border-radius: 8px; padding: 14px 18px; margin-bottom: 12px; font-size: 12px; color: #666; }
  .box strong { color: #333; }
  .ft { padding-top: 14px; border-top: 1px solid #e5e5e5; font-size: 11px; color: #aaa; text-align: center; }
  @media print { body { padding: 20px; } }
</style></head><body>
  <div class="hdr">
    <div>
      <h1>${Br.businessName||Br.fullName||cr.name}</h1>
      <div class="sub">${Br.businessName&&Br.fullName?Br.fullName:"Invoice Summary"}</div>
    </div>
    <div style="text-align:right"><div class="inv-lbl">INVOICE</div><div class="inv-num">${qr}</div></div>
  </div>
  <div class="cols">
    <div class="col"><h3>From</h3><p>${Br.fullName?`<strong>${Br.fullName}</strong><br>`:""}${bs(Br.address)||""}${Br.email?`<br>${Br.email}`:""}${fs.isVATApplicable&&Br.vatSettings.vatNumber?`<br>VAT: ${Br.vatSettings.vatNumber}`:""}</p></div>
    <div class="col"><h3>Bill To</h3><p>${fr.productionCompany?`<strong>${fr.productionCompany}</strong><br>`:""}${Es||""}${fr.accountsPayableContact?`<br>Attn: ${fr.accountsPayableContact}`:""}</p></div>
    <div class="col" style="text-align:right"><h3>Details</h3><p><strong>Date:</strong> ${ts}<br><strong>Period:</strong> ${gs}  ${as}<br><strong>Due:</strong> ${Br.paymentTerms||"Payment within 30 days"}${Ds.length?"<br>"+Ds.join(" | "):""}</p></div>
  </div>
  <table><thead><tr><th>Description</th><th>Qty</th><th>Rate</th><th class="amt">Amount</th></tr></thead><tbody>
    <tr><td>Hair &amp; Makeup Services  Day Rate</td><td>${Xr.length} days</td><td>${Yr}${vr.dailyRate.toFixed(2)}</td><td class="amt">${Yr}${(Xr.length*vr.dailyRate).toFixed(2)}</td></tr>
    ${ds>0?`<tr><td>Overtime</td><td>${ds.toFixed(1)} hrs</td><td></td><td class="amt">${Yr}${(ss-Xr.length*vr.dailyRate-Xr.length*vr.kitRental).toFixed(2)}</td></tr>`:""}
    ${vr.kitRental>0?`<tr><td>Kit / Box Rental</td><td>${Xr.length} days</td><td>${Yr}${vr.kitRental.toFixed(2)}</td><td class="amt">${Yr}${(Xr.length*vr.kitRental).toFixed(2)}</td></tr>`:""}
  </tbody></table>
  <div class="totals">
    <div class="r"><span class="l">Subtotal</span><span class="v">${Yr}${fs.subtotal.toFixed(2)}</span></div>
    ${fs.isVATApplicable?`<div class="r"><span class="l">VAT (${fs.vatRate}%)</span><span class="v">${Yr}${fs.vatAmount.toFixed(2)}</span></div>`:""}
    <div class="r t"><span class="l">Total Due</span><span class="v">${Yr}${fs.total.toFixed(2)}</span></div>
  </div>
  ${Br.bankDetails.accountName||Br.bankDetails.sortCode?`<div class="box"><strong>Bank Details:</strong><br>${Br.bankDetails.accountName?`Account: ${Br.bankDetails.accountName}<br>`:""}${Br.bankDetails.sortCode?`Sort Code: ${Br.bankDetails.sortCode}<br>`:""}${Br.bankDetails.accountNumber?`Account No: ${Br.bankDetails.accountNumber}`:""}</div>`:""}
  ${fr.invoiceNotes?`<div class="box" style="font-style:italic">${fr.invoiceNotes}</div>`:""}
  <div class="box"><strong>Payment Terms:</strong> ${Br.paymentTerms||"Payment within 30 days"}. Please reference <strong>${qr}</strong> with payment.</div>
  <div class="ft">Generated by Checks Happy</div>
</body></html>`;Ir.push({filename:`${cr.name}_Invoice_Summary.html`,content:hs,mimeType:"text/html"});break}}for(const Dr of Ir){const Pr=new Blob([Dr.content],{type:Dr.mimeType==="text/html"?"text/html;charset=utf-8":Dr.mimeType}),Mr=URL.createObjectURL(Pr);if(Dr.mimeType==="text/html"){const Br=window.open(Mr,"_blank");Br&&Br.addEventListener("load",()=>{setTimeout(()=>Br.print(),500)})}else{const Br=document.createElement("a");Br.href=Mr,Br.download=Dr.filename,document.body.appendChild(Br),Br.click(),document.body.removeChild(Br)}URL.revokeObjectURL(Mr)}}},Kr=yr.filter(Ur=>Ur.selected).length,Gr=yr.every(Ur=>Ur.selected),Zr=()=>ur.wrappedAt?new Date(ur.wrappedAt).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"}):new Date().toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});return cr?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Export Project"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[cr.name,"  Wrapped ",Zr()]})]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light",children:"SELECT DOCUMENTS"}),jsxRuntimeExports.jsx("button",{onClick:Ar,className:"text-sm font-medium text-gold active:opacity-70 transition-opacity",children:Gr?"Deselect All":"Select All"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2 mb-6",children:yr.map(Ur=>jsxRuntimeExports.jsxs("button",{onClick:()=>kr(Ur.id),className:`w-full card flex items-start gap-3 text-left transition-all ${Ur.selected?"border-2 border-gold bg-gold/5":""}`,children:[jsxRuntimeExports.jsx("div",{className:`mt-0.5 w-5 h-5 rounded flex-shrink-0 flex items-center justify-center border-2 transition-colors ${Ur.selected?"bg-gold border-gold":"border-border"}`,children:Ur.selected&&jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:Ur.name}),jsxRuntimeExports.jsx("span",{className:`px-2 py-0.5 text-[10px] font-medium rounded ${Or(Ur.format)}`,children:Lr(Ur.format)})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:Ur.description})]})]},Ur.id))}),jr&&_r&&lr&&jsxRuntimeExports.jsx("div",{className:`mb-6 p-4 rounded-xl border ${wr?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${wr?"bg-green-100":"bg-amber-100"}`,children:wr?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:`text-sm font-medium ${wr?"text-green-700":"text-amber-700"}`,children:wr?"Billing details complete":"Billing details incomplete"}),jsxRuntimeExports.jsx("p",{className:`text-xs mt-0.5 ${wr?"text-green-600":"text-amber-600"}`,children:wr?"Your personal info, bank details, and VAT settings will appear on the invoice.":"Complete your billing details to generate professional invoices."}),jsxRuntimeExports.jsx("button",{onClick:lr,className:`mt-2 text-xs font-medium ${wr?"text-green-700":"text-amber-700"} underline`,children:wr?"Edit billing details":"Complete billing details"})]})]})}),jr&&!_r&&jsxRuntimeExports.jsx("div",{className:"mb-6 p-4 rounded-xl border bg-gray-50 border-gray-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 bg-gold/10",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Supervisor Feature"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"Upgrade to Supervisor or Designer to generate professional invoices with your billing details."})]})]})}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"DELIVERY METHOD"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"download",label:"Save to Device",icon:"download"},{id:"share",label:"Share",icon:"share"}].map(Ur=>jsxRuntimeExports.jsxs("button",{onClick:()=>Tr(Ur.id),className:`p-3 rounded-xl border-2 text-center transition-all ${Sr===Ur.id?"border-gold bg-gold/5":"border-border bg-card"}`,children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 mx-auto mb-2 rounded-lg flex items-center justify-center ${Sr===Ur.id?"bg-gold text-white":"bg-gray-100 text-text-muted"}`,children:Ur.icon==="download"?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-text-primary",children:Ur.label})]},Ur.id))})]}),Rr.status!=="idle"&&jsxRuntimeExports.jsx("div",{className:"mb-6 p-4 bg-card rounded-xl border border-border",children:Rr.status==="error"?jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-red-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-error",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-error font-medium",children:Rr.error})]}):Rr.status==="complete"?jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 mx-auto mb-3 rounded-full bg-green-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary font-medium",children:"Export Complete!"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm text-text-primary font-medium",children:[Rr.status==="preparing"&&"Preparing export...",Rr.status==="generating"&&`Generating ${((os=yr.find(Ur=>Ur.id===Rr.currentDocument))==null?void 0:os.name)||""}...`,Rr.status==="packaging"&&"Packaging files..."]}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-text-muted",children:[Rr.progress,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gold rounded-full transition-all duration-300",style:{width:`${Rr.progress}%`}})})]})}),jsxRuntimeExports.jsx("button",{onClick:Fr,disabled:Kr===0||["preparing","generating","packaging"].includes(Rr.status),className:`w-full py-4 rounded-button font-semibold text-base shadow-lg transition-all ${Kr===0?"bg-gray-200 text-text-light cursor-not-allowed":["preparing","generating","packaging"].includes(Rr.status)?"bg-gold/70 text-white cursor-wait":"gold-gradient text-white active:scale-[0.98]"}`,children:["preparing","generating","packaging"].includes(Rr.status)?jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Exporting..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Export ",Kr>0?`${Kr} Selected`:"Documents",Kr>0&&jsxRuntimeExports.jsxs("span",{className:"ml-2 opacity-80",children:["(",Cr(),")"]})]})}),jsxRuntimeExports.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-xs font-semibold text-text-muted uppercase mb-3",children:"Project Summary"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold text-text-primary",children:cr.scenes.length}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Scenes"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold text-text-primary",children:cr.characters.length}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Characters"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-lg font-bold text-text-primary",children:cr.looks.length}),jsxRuntimeExports.jsx("div",{className:"text-xs text-text-muted",children:"Looks"})]})]})]})]})]}):null}function BillingDetailsScreen({onBack:ar}){const{billingDetails:or,updatePersonalInfo:lr,updateBankDetails:cr,updatePaymentTerms:ur,updateVATSettings:dr,toggleVATRegistered:hr,isBillingComplete:pr,getValidationErrors:mr}=useBillingStore(),[fr,xr]=reactExports.useState(!1),[Er,vr]=reactExports.useState(null);reactExports.useEffect(()=>{if(Er){const _r=setTimeout(()=>vr(null),2e3);return()=>clearTimeout(_r)}},[Er]);const gr=()=>{xr(!0),mr().length===0&&vr("Details saved successfully")},yr=fr?mr():[],br=pr();return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Billing Details"})]}),br&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Complete"]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:[Er&&jsxRuntimeExports.jsx("div",{className:"mb-4 px-4 py-2 bg-green-50 border border-green-200 rounded-lg text-sm text-green-700",children:Er}),yr.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-4 px-4 py-3 bg-red-50 border border-red-200 rounded-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-700 mb-2",children:"Please fix the following:"}),jsxRuntimeExports.jsx("ul",{className:"text-xs text-red-600 space-y-1",children:yr.map((_r,jr)=>jsxRuntimeExports.jsxs("li",{children:[" ",_r]},jr))})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PERSONAL / BUSINESS INFORMATION"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"FULL NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.fullName,onChange:_r=>lr({fullName:_r.target.value}),placeholder:"John Smith",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"BUSINESS NAME"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.businessName,onChange:_r=>lr({businessName:_r.target.value}),placeholder:"Optional - if trading under a business name",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"For freelancers trading under a company or trading name"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ADDRESS *"}),jsxRuntimeExports.jsx("textarea",{value:or.address,onChange:_r=>lr({address:_r.target.value}),placeholder:`123 High Street
London
SW1A 1AA`,rows:3,className:"input-field w-full resize-none"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"PHONE"}),jsxRuntimeExports.jsx("input",{type:"tel",value:or.phone,onChange:_r=>lr({phone:_r.target.value}),placeholder:"+44 7700 900000",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"EMAIL *"}),jsxRuntimeExports.jsx("input",{type:"email",value:or.email,onChange:_r=>lr({email:_r.target.value}),placeholder:"john@example.com",className:"input-field w-full"})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"BANK DETAILS FOR PAYMENT"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ACCOUNT NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.bankDetails.accountName,onChange:_r=>cr({accountName:_r.target.value}),placeholder:"John Smith",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Name as it appears on your bank account"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"SORT CODE *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.bankDetails.sortCode,onChange:_r=>{const jr=formatSortCode(_r.target.value);cr({sortCode:jr})},placeholder:"12-34-56",maxLength:8,className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ACCOUNT NUMBER *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.bankDetails.accountNumber,onChange:_r=>{const jr=formatAccountNumber(_r.target.value);cr({accountNumber:jr})},placeholder:"12345678",maxLength:8,className:"input-field w-full"})]})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PAYMENT TERMS"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"TERMS"}),jsxRuntimeExports.jsxs("select",{value:or.paymentTerms,onChange:_r=>ur(_r.target.value),className:"input-field w-full",children:[jsxRuntimeExports.jsx("option",{value:"Payment upon receipt",children:"Payment upon receipt"}),jsxRuntimeExports.jsx("option",{value:"Payment within 7 days",children:"Payment within 7 days"}),jsxRuntimeExports.jsx("option",{value:"Payment within 14 days",children:"Payment within 14 days"}),jsxRuntimeExports.jsx("option",{value:"Payment within 30 days",children:"Payment within 30 days"}),jsxRuntimeExports.jsx("option",{value:"Payment within 60 days",children:"Payment within 60 days"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-2",children:"This will appear on generated invoices"})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"VAT / TAX SETTINGS"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:"VAT Registered"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Are you registered for VAT?"})]}),jsxRuntimeExports.jsx("button",{onClick:hr,className:`relative w-12 h-7 rounded-full transition-colors ${or.vatSettings.isVATRegistered?"bg-gold":"bg-gray-200"}`,children:jsxRuntimeExports.jsx("span",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform ${or.vatSettings.isVATRegistered?"left-6":"left-1"}`})})]}),or.vatSettings.isVATRegistered&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"VAT NUMBER *"}),jsxRuntimeExports.jsx("input",{type:"text",value:or.vatSettings.vatNumber,onChange:_r=>dr({vatNumber:_r.target.value.toUpperCase()}),placeholder:"GB123456789",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"UK format: GB followed by 9 digits"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"VAT RATE (%)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("input",{type:"number",value:or.vatSettings.vatRate,onChange:_r=>dr({vatRate:parseFloat(_r.target.value)||0}),min:"0",max:"100",step:"0.1",className:"input-field w-24"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"%"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Standard UK rate is 20%"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-border",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-muted mb-2",children:"INVOICE PREVIEW"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-text-muted",children:"Subtotal (ex VAT)"}),jsxRuntimeExports.jsx("span",{className:"text-text-primary",children:"1,000.00"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsxs("span",{className:"text-text-muted",children:["VAT (",or.vatSettings.vatRate,"%)"]}),jsxRuntimeExports.jsxs("span",{className:"text-text-primary",children:["",(1e3*or.vatSettings.vatRate/100).toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between font-semibold pt-1 border-t border-border",children:[jsxRuntimeExports.jsx("span",{className:"text-text-primary",children:"Total (inc VAT)"}),jsxRuntimeExports.jsxs("span",{className:"text-gold",children:["",(1e3*(1+or.vatSettings.vatRate/100)).toFixed(2)]})]})]})]})]}),!or.vatSettings.isVATRegistered&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"If you're not VAT registered, your invoices will not include VAT calculations. You can register for VAT at any time if your taxable turnover exceeds the threshold."})]})]}),jsxRuntimeExports.jsxs("div",{className:"sticky bottom-0 bg-background pt-4 pb-safe-bottom",children:[jsxRuntimeExports.jsx("button",{onClick:gr,className:"w-full py-3 rounded-button gold-gradient text-white font-medium active:scale-98 transition-transform",children:"Save Details"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center mt-2",children:"Details are saved automatically and will appear on your invoices"})]})]})]})}function ConfirmationModal({isOpen:ar,onClose:or,onConfirm:lr,title:cr,message:ur,confirmText:dr="Confirm",cancelText:hr="Cancel",variant:pr="default",requiresTextConfirmation:mr,isLoading:fr=!1}){const[xr,Er]=reactExports.useState(""),vr=mr!==void 0&&xr.toLowerCase()!==mr.toLowerCase(),gr=()=>{Er(""),or()},yr=()=>{!vr&&!fr&&(lr(),Er(""))};return jsxRuntimeExports.jsx(Modal,{isOpen:ar,onClose:gr,title:cr,children:jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"text-sm text-text-muted",children:ur}),mr&&jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:['Type "',jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:mr}),'" to confirm:']}),jsxRuntimeExports.jsx(Input,{type:"text",value:xr,onChange:br=>Er(br.target.value),placeholder:mr,autoComplete:"off"})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 pt-2",children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:gr,fullWidth:!0,disabled:fr,children:hr}),jsxRuntimeExports.jsx(Button,{variant:pr==="danger"?"outline":"primary",onClick:yr,fullWidth:!0,disabled:vr||fr,className:pr==="danger"?"border-red-500 text-red-500 hover:bg-red-50":"",children:fr?"Loading...":dr})]})]})})}function TeamMemberCard({member:ar,isCurrentUser:or,canManage:lr,onChangeRole:cr,onRemove:ur}){const[dr,hr]=reactExports.useState(!1),[pr,mr]=reactExports.useState(!1),fr=reactExports.useRef(null),xr=wr=>new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(new Date(wr)),Er=wr=>wr.split(" ").map(Sr=>Sr[0]).join("").toUpperCase().slice(0,2),vr=wr=>{const Sr=["bg-blue-500","bg-green-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500","bg-orange-500","bg-cyan-500"];let Tr=0;for(let Rr=0;Rr<wr.length;Rr++)Tr=wr.charCodeAt(Rr)+((Tr<<5)-Tr);return Sr[Math.abs(Tr)%Sr.length]};reactExports.useEffect(()=>{const wr=Sr=>{fr.current&&!fr.current.contains(Sr.target)&&(hr(!1),mr(!1))};if(dr)return document.addEventListener("mousedown",wr),()=>document.removeEventListener("mousedown",wr)},[dr]);const gr=lr&&!ar.isOwner&&!or,yr=()=>{gr&&(hr(!0),"vibrate"in navigator&&navigator.vibrate(50))},br=reactExports.useRef(null),_r=()=>{br.current=setTimeout(yr,500)},jr=()=>{br.current&&(clearTimeout(br.current),br.current=null)};return jsxRuntimeExports.jsxs("div",{className:"relative",ref:fr,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 px-3 py-3 rounded-xl bg-card border border-border",onTouchStart:_r,onTouchEnd:jr,onTouchCancel:jr,onContextMenu:wr=>{gr&&(wr.preventDefault(),hr(!0))},children:[ar.avatarUrl?jsxRuntimeExports.jsx("img",{src:ar.avatarUrl,alt:ar.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-semibold flex-shrink-0 ${vr(ar.name)}`,children:Er(ar.name)}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-medium text-text-primary truncate",children:ar.name}),or&&jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-light",children:"(you)"})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[getTeamMemberRoleLabel(ar.role),ar.isOwner&&jsxRuntimeExports.jsx("span",{className:"text-gold font-medium",children:"  Owner"})]})]}),gr?jsxRuntimeExports.jsx("button",{onClick:()=>hr(!dr),className:"p-1.5 -mr-1 text-text-light hover:text-text-primary transition-colors rounded-lg",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}):jsxRuntimeExports.jsx("span",{className:"text-[11px] text-text-light flex-shrink-0",children:xr(ar.joinedAt)})]}),dr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>hr(!1)}),jsxRuntimeExports.jsxs("div",{className:"absolute right-2 top-full mt-1 z-50 bg-card rounded-xl shadow-lg border border-border overflow-hidden min-w-[170px]",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{hr(!1),mr(!0)},className:"w-full px-4 py-3 text-left text-sm text-text-primary hover:bg-background flex items-center gap-2.5",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Change Role"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{hr(!1),ur==null||ur(ar.userId)},className:"w-full px-4 py-3 text-left text-sm text-red-500 hover:bg-red-50 flex items-center gap-2.5 border-t border-border",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M22 10.5h-6m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 018.624 21c-1.725 0-3.364-.372-4.874-1.073 0-.13.25-.692.25-.692z"})}),"Remove"]})]})]}),pr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b border-border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Change Role"}),jsxRuntimeExports.jsx("button",{onClick:()=>mr(!1),className:"p-2 -m-2 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted mt-1",children:["Select a new role for ",ar.name]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:TEAM_MEMBER_ROLES.map(wr=>jsxRuntimeExports.jsxs("button",{onClick:()=>{cr==null||cr(ar.userId,wr.value),mr(!1)},className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${ar.role===wr.value?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${ar.role===wr.value?"text-gold":"text-text-primary"}`,children:wr.label}),ar.role===wr.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},wr.value))})})]})})]})}function TeamMemberList({members:ar,currentUserId:or,canManage:lr,onChangeRole:cr,onRemoveMember:ur}){const[dr,hr]=reactExports.useState(null),pr=groupTeamMembersByRole(ar),mr=Er=>{const vr=ar.find(gr=>gr.userId===Er);vr&&hr(vr)},fr=()=>{dr&&(ur==null||ur(dr.userId),hr(null))},xr=Er=>{const vr=Er.members.length;switch(Er.role){case"designer":return`DESIGNERS (HOD) (${vr})`;case"supervisor":return`SUPERVISORS (${vr})`;case"key":return`KEY ARTISTS (${vr})`;case"hair":return`HAIR ARTISTS (${vr})`;case"makeup":return`MAKEUP ARTISTS (${vr})`;case"sfx":return`SPECIAL EFFECTS ARTISTS (${vr})`;case"daily":return`DAILIES (${vr})`;case"trainee":return`TRAINEES (${vr})`;default:return`${Er.label.toUpperCase()} (${vr})`}};return ar.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No team members yet"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-1",children:"Share the invite code to add team members"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"space-y-5",children:pr.map(Er=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-2 px-1",children:xr(Er)}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:Er.members.map(vr=>jsxRuntimeExports.jsx(TeamMemberCard,{member:vr,isCurrentUser:vr.userId===or,canManage:lr,onChangeRole:cr,onRemove:mr},vr.userId))})]},Er.role))}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:!!dr,onClose:()=>hr(null),onConfirm:fr,title:`Remove ${dr==null?void 0:dr.name}?`,message:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("p",{children:"They will lose access to this project immediately."}),jsxRuntimeExports.jsx("p",{children:"Their contributions will remain."})]}),confirmText:"Remove",variant:"danger"})]})}function InviteCodeShare({inviteCode:ar,isOwner:or,onRegenerateCode:lr}){const[cr,ur]=reactExports.useState(null),[dr,hr]=reactExports.useState(!1),[pr,mr]=reactExports.useState(!1),[fr,xr]=reactExports.useState(ar),Er=`checkshappy.app/join/${fr}`,vr=async(br,_r)=>{try{await navigator.clipboard.writeText(br),ur(_r),setTimeout(()=>ur(null),2e3)}catch{const jr=document.createElement("textarea");jr.value=br,document.body.appendChild(jr),jr.select(),document.execCommand("copy"),document.body.removeChild(jr),ur(_r),setTimeout(()=>ur(null),2e3)}},gr=async()=>{if(navigator.share)try{await navigator.share({title:"Join my project on Checks Happy",text:`Use code ${fr} to join my production on Checks Happy!`,url:`https://${Er}`})}catch{}else vr(`https://${Er}`,"link")},yr=async()=>{if(lr){mr(!0);try{const br=await lr();xr(br),hr(!1)}finally{mr(!1)}}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-4",children:"Share this code with your team:"}),jsxRuntimeExports.jsx("div",{className:"bg-gray-50 rounded-2xl p-6 mb-4",children:jsxRuntimeExports.jsx("span",{className:"text-3xl font-bold tracking-widest text-text-primary",children:fr})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>vr(fr,"code"),fullWidth:!0,children:cr==="code"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy"]})}),jsxRuntimeExports.jsxs(Button,{variant:"primary",onClick:gr,fullWidth:!0,children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]})]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-3",children:"Or share this link:"}),jsxRuntimeExports.jsx("div",{className:"bg-gray-50 rounded-xl p-3 mb-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-primary font-mono break-all",children:Er})}),jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:()=>vr(`https://${Er}`,"link"),fullWidth:!0,children:cr==="link"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Link Copied!"]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Copy Link"]})})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 p-4 bg-gold-50/50 rounded-xl",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:"Tip:"})," Add the code to your call sheet so the whole team can join easily."]})]}),or&&lr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t border-border"}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-amber-50 rounded-xl",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-medium text-amber-800 mb-1",children:"Regenerate Code"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-amber-700 mb-3",children:"Create a new code if the current one has been shared too widely. Existing team members won't be affected."}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>hr(!0),className:"border-amber-600 text-amber-700 hover:bg-amber-100",children:"Regenerate Code"})]})]})})]})]}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:dr,onClose:()=>hr(!1),onConfirm:yr,title:"Regenerate invite code?",message:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("p",{children:["The current code (",jsxRuntimeExports.jsx("span",{className:"font-mono font-medium",children:fr}),") will stop working immediately."]}),jsxRuntimeExports.jsx("p",{children:"Team members already joined won't be affected."})]}),confirmText:"Regenerate",isLoading:pr})]})}function ProjectStatsCard({stats:ar}){const or=lr=>{if(!lr)return"No activity yet";const ur=new Date().getTime()-new Date(lr).getTime(),dr=Math.floor(ur/(1e3*60)),hr=Math.floor(ur/(1e3*60*60)),pr=Math.floor(ur/(1e3*60*60*24));return dr<1?"Just now":dr<60?`${dr} minutes ago`:hr<24?`${hr} hours ago`:pr===1?"Yesterday":pr<7?`${pr} days ago`:new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short"}).format(new Date(lr))};return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"SCRIPT"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Scenes"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.sceneCount})]}),ar.storyDays>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Shooting Days"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.storyDays})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Characters"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.characterCount})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"CONTINUITY"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Progress"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:[ar.completionPercentage,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"w-full h-3 bg-gray-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"h-full gold-gradient rounded-full transition-all duration-500",style:{width:`${ar.completionPercentage}%`}})}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-2",children:[ar.completedScenes," of ",ar.sceneCount," scenes checked"]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PHOTOS"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Total Photos"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.photoCount.toLocaleString()})]}),ar.storageUsed>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Est. Storage"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:formatStorageSize(ar.storageUsed)})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"ACTIVITY"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Team Members"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.teamMemberCount})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Last Capture"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:or(ar.lastActivity)})]}),ar.mostActiveUser&&ar.mostActiveUser.editCount>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-text-muted",children:"Scene Captures"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-semibold text-text-primary",children:ar.mostActiveUser.editCount.toLocaleString()})]})]})]})]})}function PermissionPicker({label:ar,value:or,onChange:lr,disabled:cr=!1}){var pr;const[ur,dr]=reactExports.useState(!1),hr=((pr=PERMISSION_LEVELS.find(mr=>mr.value===or))==null?void 0:pr.label)||or;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>!cr&&dr(!0),disabled:cr,className:`w-full card flex items-center justify-between ${cr?"opacity-50 cursor-not-allowed":"active:scale-[0.98] transition-transform"}`,children:[jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:ar}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:hr})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsx(BottomSheet,{isOpen:ur,onClose:()=>dr(!1),title:ar,children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:PERMISSION_LEVELS.map(mr=>jsxRuntimeExports.jsxs("button",{onClick:()=>{lr(mr.value),dr(!1)},className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${or===mr.value?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${or===mr.value?"text-gold":"text-text-primary"}`,children:mr.label}),or===mr.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},mr.value))})})]})}const PRODUCTION_TYPE_OPTIONS=[{value:"film",label:"Feature Film"},{value:"tv_series",label:"TV Series"},{value:"short_film",label:"Short Film"},{value:"commercial",label:"Commercial"},{value:"music_video",label:"Music Video"},{value:"theatre",label:"Theatre"},{value:"other",label:"Other"}];function ProductionTypeSelector({value:ar,onChange:or,disabled:lr=!1}){var hr;const[cr,ur]=reactExports.useState(!1),dr=((hr=PRODUCTION_TYPE_OPTIONS.find(pr=>pr.value===ar))==null?void 0:hr.label)||ar;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>!lr&&ur(!0),disabled:lr,className:`w-full card flex items-center justify-between ${lr?"opacity-50 cursor-not-allowed":"active:scale-[0.98] transition-transform"}`,children:[jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Production Type"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:dr})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsx(BottomSheet,{isOpen:cr,onClose:()=>ur(!1),title:"Production Type",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:PRODUCTION_TYPE_OPTIONS.map(pr=>jsxRuntimeExports.jsxs("button",{onClick:()=>{or(pr.value),ur(!1)},className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${ar===pr.value?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${ar===pr.value?"text-gold":"text-text-primary"}`,children:pr.label}),ar===pr.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},pr.value))})})]})}function ScheduleEditor({scenes:ar,onSave:or,initialDayNumber:lr=1,initialDate:cr=new Date,initialSceneIds:ur=[]}){const[dr,hr]=reactExports.useState(lr),[pr,mr]=reactExports.useState(br(cr)),[fr,xr]=reactExports.useState(new Set(ur)),[Er,vr]=reactExports.useState(""),[gr,yr]=reactExports.useState(!1);function br(Rr){return Rr.toISOString().split("T")[0]}function _r(Rr){const Nr=new Date(Rr);return new Intl.DateTimeFormat("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}).format(Nr)}const jr=reactExports.useMemo(()=>{if(!Er.trim())return ar;const Rr=Er.toLowerCase();return ar.filter(Nr=>Nr.sceneNumber.toLowerCase().includes(Rr)||Nr.slugline.toLowerCase().includes(Rr))},[ar,Er]),wr=Rr=>{const Nr=new Set(fr);Nr.has(Rr)?Nr.delete(Rr):Nr.add(Rr),xr(Nr)},Sr=async()=>{yr(!0);try{const Rr=new Date(pr);or(dr,Rr,Array.from(fr))}finally{yr(!1)}},Tr=reactExports.useMemo(()=>ar.filter(Rr=>fr.has(Rr.id)),[ar,fr]);return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"Shooting Day"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("select",{value:dr,onChange:Rr=>hr(Number(Rr.target.value)),className:"input-field w-full appearance-none pr-10",children:Array.from({length:100},(Rr,Nr)=>Nr+1).map(Rr=>jsxRuntimeExports.jsxs("option",{value:Rr,children:["Day ",Rr]},Rr))}),jsxRuntimeExports.jsx("svg",{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"Date"}),jsxRuntimeExports.jsx("input",{type:"date",value:pr,onChange:Rr=>mr(Rr.target.value),className:"input-field w-full"})]})]}),jsxRuntimeExports.jsx("div",{className:"text-center py-2 px-4 bg-gold-50 rounded-xl",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gold",children:_r(pr)})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"SELECT SCENES FOR TODAY:"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),jsxRuntimeExports.jsx(Input,{type:"text",value:Er,onChange:Rr=>vr(Rr.target.value),placeholder:"Search scenes...",className:"pl-10"})]})]}),jsxRuntimeExports.jsxs("div",{className:"max-h-[40vh] overflow-y-auto -mx-4 px-4",children:[jsxRuntimeExports.jsx("div",{className:"space-y-2",children:jr.map(Rr=>{const Nr=fr.has(Rr.id);return jsxRuntimeExports.jsxs("button",{onClick:()=>wr(Rr.id),className:`w-full px-4 py-3 rounded-xl text-left flex items-center gap-3 transition-colors ${Nr?"bg-gold-50 border border-gold":"bg-gray-50 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-md border-2 flex items-center justify-center transition-colors ${Nr?"bg-gold border-gold text-white":"border-gray-300"}`,children:Nr&&jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:["Scene ",Rr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:Rr.intExt})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted truncate",children:Rr.slugline})]}),Rr.isComplete&&jsxRuntimeExports.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium bg-green-100 text-green-600 rounded-full",children:"Complete"})]},Rr.id)})}),jr.length===0&&jsxRuntimeExports.jsx("div",{className:"text-center py-8",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No scenes found"})})]}),jsxRuntimeExports.jsx("div",{className:"py-2 border-t border-border",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted text-center",children:[fr.size," scene",fr.size!==1?"s":""," selected"]})}),Tr.length>0&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-muted mb-2",children:"Shot Order:"}),jsxRuntimeExports.jsx("div",{className:"space-y-1",children:Tr.map((Rr,Nr)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-bold text-text-muted w-5",children:[Nr+1,"."]}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-primary",children:["Scene ",Rr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate flex-1",children:Rr.slugline})]},Rr.id))}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-2 text-center",children:"Tip: Drag to reorder scenes for shot order"})]}),jsxRuntimeExports.jsx(Button,{variant:"primary",onClick:Sr,fullWidth:!0,disabled:fr.size===0||gr,children:gr?"Saving...":"Save Today's Schedule"})]})}function DangerZone({projectName:ar,photoCount:or,onArchive:lr,onDelete:cr}){const[ur,dr]=reactExports.useState(!1),[hr,pr]=reactExports.useState(!1),[mr,fr]=reactExports.useState(!1),[xr,Er]=reactExports.useState(!1),vr=async()=>{fr(!0);try{await lr(),dr(!1)}finally{fr(!1)}},gr=async()=>{Er(!0);try{await cr(),pr(!1)}finally{Er(!1)}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-red-500 mb-3",children:"DANGER ZONE"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>dr(!0),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-50 flex items-center justify-center text-amber-600",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Archive Project"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Mark as wrapped, make read-only"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>pr(!0),className:"w-full card flex items-center gap-4 border-red-200 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-50 flex items-center justify-center text-red-500",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-500",children:"Delete Project"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Permanently delete all data"})]}),jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})]})]})]}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:ur,onClose:()=>dr(!1),onConfirm:vr,title:`Archive "${ar}"?`,message:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("p",{children:"The project will become read-only."}),jsxRuntimeExports.jsx("p",{children:"Team members can still view continuity data and photos, but can't make changes."}),jsxRuntimeExports.jsx("p",{className:"font-medium",children:"You can restore it later from your Dashboard."})]}),confirmText:"Archive Project",isLoading:mr}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:hr,onClose:()=>pr(!1),onConfirm:gr,title:`Delete "${ar}"?`,message:jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:"This cannot be undone."})]}),jsxRuntimeExports.jsx("p",{children:"This will permanently delete:"}),jsxRuntimeExports.jsxs("ul",{className:"list-disc list-inside space-y-1 text-text-muted",children:[jsxRuntimeExports.jsx("li",{children:"All scenes and breakdowns"}),jsxRuntimeExports.jsx("li",{children:"All continuity notes"}),jsxRuntimeExports.jsxs("li",{children:["All ",or.toLocaleString()," photos"]}),jsxRuntimeExports.jsx("li",{children:"Team member access"})]})]}),confirmText:"Delete Forever",variant:"danger",requiresTextConfirmation:ar,isLoading:xr})]})}const mockDelay=ar=>new Promise(or=>setTimeout(or,ar)),getTeamFromCurrentUser=ar=>{const{user:or}=useAuthStore.getState();return or?[{userId:or.id,projectId:ar,name:or.name,email:or.email,avatarUrl:or.avatarUrl,role:"designer",isOwner:!0,joinedAt:or.createdAt,lastActiveAt:new Date,editCount:0}]:[]},computeProjectStats=(ar,or,lr)=>{var br;if(!ar)return{sceneCount:0,storyDays:0,characterCount:0,completedScenes:0,completionPercentage:0,photoCount:0,storageUsed:0,teamMemberCount:lr,lastActivity:null,mostActiveUser:null};const cr=ar.scenes.length,ur=ar.characters.length,dr=ar.scenes.filter(_r=>_r.isComplete).length,hr=cr>0?Math.round(dr/cr*100):0,mr=new Set(ar.scenes.filter(_r=>_r.shootingDay!=null).map(_r=>_r.shootingDay)).size;let fr=0;for(const _r of Object.values(or))_r.photos.front&&fr++,_r.photos.left&&fr++,_r.photos.right&&fr++,_r.photos.back&&fr++,fr+=_r.additionalPhotos.length,(br=_r.sfxDetails)!=null&&br.sfxReferencePhotos&&(fr+=_r.sfxDetails.sfxReferencePhotos.length);for(const _r of ar.looks)_r.masterReference&&fr++;const xr=fr*500*1024;let Er=null;for(const _r of Object.values(or)){const jr=new Date(_r.capturedAt);(!Er||jr>Er)&&(Er=jr)}const{user:vr}=useAuthStore.getState(),gr=Object.keys(or).length,yr=vr&&gr>0?{name:vr.name,editCount:gr}:null;return{sceneCount:cr,storyDays:mr,characterCount:ur,completedScenes:dr,completionPercentage:hr,photoCount:fr,storageUsed:xr,teamMemberCount:lr,lastActivity:Er,mostActiveUser:yr}},useProjectSettingsStore=create((ar,or)=>({projectSettings:null,teamMembers:[],projectStats:null,shootingDays:[],isLoading:!1,error:null,loadProjectSettings:async lr=>{const cr=or().projectSettings;if(cr&&cr.id===lr){const{projectMemberships:ur}=useAuthStore.getState(),dr=ur.find(hr=>hr.projectId===lr);dr!=null&&dr.projectCode&&dr.projectCode!==cr.inviteCode&&ar({projectSettings:{...cr,inviteCode:dr.projectCode}});return}ar({isLoading:!0,error:null});try{const{user:ur,projectMemberships:dr}=useAuthStore.getState(),{currentProject:hr,sceneCaptures:pr}=useProjectStore.getState(),mr=getTeamFromCurrentUser(lr),fr=dr.find(gr=>gr.projectId===lr),xr=(fr==null?void 0:fr.projectCode)||generateProjectCode(),Er={id:lr,name:(hr==null?void 0:hr.name)||(fr==null?void 0:fr.projectName)||lr,type:(fr==null?void 0:fr.productionType)||"film",status:"shooting",inviteCode:xr,ownerId:(ur==null?void 0:ur.id)||"",permissions:createDefaultProjectPermissions(),createdAt:(hr==null?void 0:hr.createdAt)||new Date,archivedAt:null},vr=computeProjectStats(hr,pr,mr.length);ar({projectSettings:Er,projectStats:vr,isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to load project settings"})}},updateProjectName:async lr=>{const{projectSettings:cr}=or();if(cr){ar({isLoading:!0});try{await mockDelay(300),ar({projectSettings:{...cr,name:lr},isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to update project name"})}}},updateProjectType:async lr=>{const{projectSettings:cr}=or();if(cr){ar({isLoading:!0});try{await mockDelay(300),ar({projectSettings:{...cr,type:lr},isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to update project type"})}}},updateProjectStatus:async lr=>{const{projectSettings:cr}=or();if(cr){ar({isLoading:!0});try{await mockDelay(300),ar({projectSettings:{...cr,status:lr},isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to update project status"})}}},updatePermission:async(lr,cr)=>{const{projectSettings:ur}=or();if(ur){ar({isLoading:!0});try{await mockDelay(300),ar({projectSettings:{...ur,permissions:{...ur.permissions,[lr]:cr}},isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to update permission"})}}},regenerateInviteCode:async()=>{const{projectSettings:lr}=or();if(!lr)throw new Error("No project loaded");ar({isLoading:!0});try{const{inviteCode:cr,error:ur}=await regenerateInviteCode(lr.id);if(ur||!cr)throw ur||new Error("Failed to regenerate invite code");ar({projectSettings:{...lr,inviteCode:cr},isLoading:!1});const hr=useAuthStore.getState().projectMemberships.map(pr=>pr.projectId===lr.id?{...pr,projectCode:cr}:pr);return useAuthStore.setState({projectMemberships:hr}),cr}catch{throw ar({isLoading:!1,error:"Failed to regenerate invite code"}),new Error("Failed to regenerate invite code")}},archiveProject:async()=>{const{projectSettings:lr}=or();if(lr){ar({isLoading:!0});try{await mockDelay(500),ar({projectSettings:{...lr,status:"archived",archivedAt:new Date},isLoading:!1})}catch{throw ar({isLoading:!1,error:"Failed to archive project"}),new Error("Failed to archive project")}}},deleteProject:async()=>{ar({isLoading:!0});try{await mockDelay(800),ar({projectSettings:null,teamMembers:[],projectStats:null,shootingDays:[],isLoading:!1})}catch{throw ar({isLoading:!1,error:"Failed to delete project"}),new Error("Failed to delete project")}},loadTeamMembers:async lr=>{ar({isLoading:!0,error:null});try{const{members:cr,error:ur}=await getProjectMembers(lr);if(!ur&&cr.length>0){const dr=cr.map(hr=>{var pr,mr;return{userId:hr.user_id,projectId:hr.project_id,name:((pr=hr.user)==null?void 0:pr.name)||"Unknown",email:((mr=hr.user)==null?void 0:mr.email)||"",role:hr.role,isOwner:hr.is_owner,joinedAt:new Date(hr.joined_at),lastActiveAt:new Date,editCount:0}});ar({teamMembers:dr,isLoading:!1})}else{const dr=getTeamFromCurrentUser(lr);ar({teamMembers:dr,isLoading:!1})}}catch{const cr=getTeamFromCurrentUser(lr);ar({teamMembers:cr,isLoading:!1,error:"Failed to load team members"})}},changeTeamMemberRole:async(lr,cr)=>{const{teamMembers:ur,projectSettings:dr}=or();if(dr){ar({isLoading:!0});try{const{error:hr}=await updateMemberRole(dr.id,lr,cr);if(hr)throw hr;const pr=ur.map(mr=>mr.userId===lr?{...mr,role:cr}:mr);ar({teamMembers:pr,isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to change role"})}}},removeTeamMember:async lr=>{const{teamMembers:cr,projectStats:ur,projectSettings:dr}=or();if(dr){ar({isLoading:!0});try{const{error:hr}=await removeMember(dr.id,lr);if(hr)throw hr;const pr=cr.filter(mr=>mr.userId!==lr);ar({teamMembers:pr,projectStats:ur?{...ur,teamMemberCount:pr.length}:null,isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to remove team member"})}}},refreshProjectStats:lr=>{const{currentProject:cr,sceneCaptures:ur}=useProjectStore.getState(),dr=getTeamFromCurrentUser(lr),hr=computeProjectStats(cr,ur,dr.length);ar({projectStats:hr})},saveShootingDay:async(lr,cr,ur)=>{const{shootingDays:dr,projectSettings:hr}=or();if(hr){ar({isLoading:!0});try{await mockDelay(400);const pr={id:`day-${lr}`,projectId:hr.id,dayNumber:lr,date:cr,sceneIds:ur,createdBy:"current-user",createdAt:new Date},mr=dr.findIndex(xr=>xr.dayNumber===lr),fr=mr>=0?dr.map((xr,Er)=>Er===mr?pr:xr):[...dr,pr];ar({shootingDays:fr,isLoading:!1})}catch{ar({isLoading:!1,error:"Failed to save shooting day"})}}},clearState:()=>{ar({projectSettings:null,teamMembers:[],projectStats:null,shootingDays:[],isLoading:!1,error:null})}}));function TeamScreen({projectId:ar,canManage:or,isOwner:lr,onBack:cr,onInvite:ur}){const{teamMembers:dr,isLoading:hr,loadTeamMembers:pr,changeTeamMemberRole:mr,removeTeamMember:fr}=useProjectSettingsStore(),{user:xr}=useAuthStore();reactExports.useEffect(()=>{pr(ar)},[ar,pr]);const Er=(gr,yr)=>{mr(gr,yr)},vr=gr=>{fr(gr)};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:cr,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Team"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[dr.length," ",dr.length===1?"member":"members"]})]})]}),lr&&jsxRuntimeExports.jsxs("button",{onClick:ur,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-text-muted hover:text-gold transition-colors rounded-lg",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})}),"Invite"]})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:hr&&dr.length===0?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(TeamMemberList,{members:dr,currentUserId:xr==null?void 0:xr.id,canManage:or,onChangeRole:Er,onRemoveMember:vr}),lr&&dr.length>0&&jsxRuntimeExports.jsx("div",{className:"mt-6",children:jsxRuntimeExports.jsxs("button",{onClick:ur,className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl border border-dashed border-border text-text-muted hover:border-gold hover:text-gold transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-dashed border-current flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium",children:"Invite team members"}),jsxRuntimeExports.jsx("p",{className:"text-xs opacity-70",children:"Share a code or link to join this project"})]})]})})]})})]})}function InviteScreen({inviteCode:ar,isOwner:or,onBack:lr}){const{regenerateInviteCode:cr}=useProjectSettingsStore();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:lr,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Invite Team"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-6",children:jsxRuntimeExports.jsx(InviteCodeShare,{inviteCode:ar,isOwner:or,onRegenerateCode:or?cr:void 0})})]})}function ProjectStatsScreen({projectId:ar,onBack:or}){const{projectStats:lr,isLoading:cr,refreshProjectStats:ur}=useProjectSettingsStore();return reactExports.useEffect(()=>{ur(ar)},[ar,ur]),jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Stats"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:cr&&!lr?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"})}):lr?jsxRuntimeExports.jsx(ProjectStatsCard,{stats:lr}):jsxRuntimeExports.jsx("div",{className:"text-center py-12",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No stats available"})})})]})}function ScheduleScreen({onBack:ar,onSaved:or}){const{currentProject:lr}=useProjectStore(),{saveShootingDay:cr}=useProjectSettingsStore(),ur=(lr==null?void 0:lr.scenes)||[],dr=async(hr,pr,mr)=>{await cr(hr,pr,mr),or==null||or()};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Today's Scenes"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:ur.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"No scenes available"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-1",children:"Import a script to add scenes"})]}):jsxRuntimeExports.jsx(ScheduleEditor,{scenes:ur,onSave:dr})})]})}function ProjectSettingsScreen({projectId:ar,onBack:or,onNavigateToTeam:lr,onNavigateToStats:cr,onNavigateToExport:ur,onNavigateToProductionDetails:dr,onProjectArchived:hr,onProjectDeleted:pr}){const{projectSettings:mr,projectStats:fr,isLoading:xr,loadProjectSettings:Er,updateProjectName:vr,updateProjectType:gr,updatePermission:yr,archiveProject:br,deleteProject:_r}=useProjectSettingsStore(),{currentProject:jr,lifecycle:wr,wrapProject:Sr,restoreProject:Tr,getDaysUntilDeletion:Rr}=useProjectStore(),{user:Nr}=useAuthStore(),{isComplete:Cr,getCompletionCount:kr}=useProductionDetailsStore(),Ar=Cr(ar),Or=kr(ar),Lr=Nr&&mr?Nr.id===mr.ownerId:!1,[Fr,Hr]=reactExports.useState(!1),[Kr,Gr]=reactExports.useState(""),[Zr,Jr]=reactExports.useState(!1),[os,Ur]=reactExports.useState(!1),Vr=Rr();reactExports.useEffect(()=>{Er(ar)},[ar,Er]),reactExports.useEffect(()=>{mr&&Gr(mr.name)},[mr]);const es=async()=>{Kr.trim()&&Kr!==(mr==null?void 0:mr.name)&&await vr(Kr.trim()),Hr(!1)},Ir=async()=>{await br(),hr==null||hr()},Dr=async()=>{await _r(),pr==null||pr()},Pr=()=>{Sr("manual"),Jr(!1)};return xr&&!mr?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Settings"})]})})}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-12",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-2 border-gold border-t-transparent rounded-full animate-spin"})})]}):mr?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background pb-safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -ml-2 text-text-muted hover:text-text-primary transition-colors tap-target",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Settings"})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 space-y-6",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PROJECT DETAILS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[Fr?jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1.5",children:"Production Name"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Input,{value:Kr,onChange:Mr=>Gr(Mr.target.value),autoFocus:!0,className:"flex-1"}),jsxRuntimeExports.jsx("button",{onClick:es,className:"px-3 py-2 text-sm font-medium text-gold hover:bg-gold-50 rounded-lg transition-colors",children:"Save"}),jsxRuntimeExports.jsx("button",{onClick:()=>{Gr(mr.name),Hr(!1)},className:"px-3 py-2 text-sm text-text-muted hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"})]})]}):jsxRuntimeExports.jsxs("button",{onClick:()=>Hr(!0),className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Production Name"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:mr.name})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsx(ProductionTypeSelector,{value:mr.type,onChange:gr}),jsxRuntimeExports.jsxs("button",{onClick:dr,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-emerald-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Production & Invoicing"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:Ar?"Production details complete":`${Or.filled}/${Or.total} required fields filled`})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[Ar&&jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4"})}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"TEAM"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:lr,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Team Members"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"View and manage team"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>Ur(!os),className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Share Invite Code"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Invite team members to join"})]})]}),jsxRuntimeExports.jsx("svg",{className:`w-5 h-5 text-text-light transition-transform ${os?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),os&&jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx(InviteCodeShare,{inviteCode:mr.inviteCode,isOwner:Lr})}),jsxRuntimeExports.jsxs("button",{onClick:cr,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Project Stats"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"View project statistics"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"TEAM PERMISSIONS"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(PermissionPicker,{label:"Who can add photos",value:mr.permissions.addPhotos,onChange:Mr=>yr("addPhotos",Mr)}),jsxRuntimeExports.jsx(PermissionPicker,{label:"Who can edit continuity notes",value:mr.permissions.editNotes,onChange:Mr=>yr("editNotes",Mr)}),jsxRuntimeExports.jsx(PermissionPicker,{label:"Who can mark scenes complete",value:mr.permissions.markComplete,onChange:Mr=>yr("markComplete",Mr)})]})]}),jr&&jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h3",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"EXPORT & WRAP"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:ur,className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Export Project"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Download continuity documents"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),wr.state==="active"&&jsxRuntimeExports.jsxs("button",{onClick:()=>Jr(!0),className:"w-full card flex items-center justify-between hover:bg-amber-50 active:scale-[0.98] transition-all",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-50 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.875 1.875 0 0118 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125"})})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-amber-700",children:"Mark as Wrapped"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Production complete"})]})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),wr.state==="wrapped"&&jsxRuntimeExports.jsx("div",{className:"card bg-amber-50 border border-amber-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Project Wrapped"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-amber-600",children:[Vr," days until archive"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>Tr(),className:"px-3 py-1.5 text-xs font-medium text-gold bg-white rounded-lg border border-gold",children:"Restore"})]})}),wr.state==="archived"&&jsxRuntimeExports.jsx("div",{className:"card bg-red-50 border border-red-200",children:jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-red-800",children:"Project Archived - Read Only"})})]})]}),jsxRuntimeExports.jsx(DangerZone,{projectName:mr.name,photoCount:(fr==null?void 0:fr.photoCount)||0,onArchive:Ir,onDelete:Dr})]}),Zr&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>Jr(!1)}),jsxRuntimeExports.jsxs("div",{className:"relative bg-card rounded-2xl p-6 max-w-sm w-full shadow-xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-text-primary mb-2",children:"Mark Project as Wrapped?"}),jsxRuntimeExports.jsxs("p",{className:"text-text-secondary text-sm mb-4",children:['This will mark "',mr.name,'" as wrapped. The project will be archived after ',PROJECT_RETENTION_DAYS," days."]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mb-6",children:"You can restore the project at any time before it's archived."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Jr(!1),className:"flex-1 py-2.5 px-4 rounded-button border border-border text-text-muted text-sm font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Pr,className:"flex-1 py-2.5 px-4 rounded-button bg-amber-500 text-white text-sm font-medium",children:"Wrap Project"})]})]})]})]}):null}function ProductionDetailsScreen({projectId:ar,onBack:or}){const{getDetails:lr,updateDetails:cr,isComplete:ur,getCompletionCount:dr}=useProductionDetailsStore(),hr=lr(ar),pr=ur(ar),{filled:mr,total:fr}=dr(ar),[xr,Er]=reactExports.useState(null);reactExports.useEffect(()=>{if(xr){const gr=setTimeout(()=>Er(null),2e3);return()=>clearTimeout(gr)}},[xr]);const vr=gr=>{cr(ar,gr)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Production Details"})]}),pr?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs font-medium",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Complete"]}):jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[mr,"/",fr," required"]})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:[xr&&jsxRuntimeExports.jsx("div",{className:"mb-4 px-4 py-2 bg-green-50 border border-green-200 rounded-lg text-sm text-green-700",children:xr}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mb-4",children:"Enter the production company details and invoicing information for this project. These details are specific to this job."}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"PRODUCTION COMPANY"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"COMPANY NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.productionCompany,onChange:gr=>vr({productionCompany:gr.target.value}),placeholder:"e.g. NBC Universal, BBC Studios",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ADDRESS *"}),jsxRuntimeExports.jsx("textarea",{value:hr.productionAddress,onChange:gr=>vr({productionAddress:gr.target.value}),placeholder:"Production office address",rows:3,className:"input-field w-full resize-none"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"PHONE"}),jsxRuntimeExports.jsx("input",{type:"tel",value:hr.productionPhone,onChange:gr=>vr({productionPhone:gr.target.value}),placeholder:"Production office number",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"EMAIL *"}),jsxRuntimeExports.jsx("input",{type:"email",value:hr.productionEmail,onChange:gr=>vr({productionEmail:gr.target.value}),placeholder:"production@example.com",className:"input-field w-full"})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"ACCOUNTS PAYABLE"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"CONTACT NAME *"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.accountsPayableContact,onChange:gr=>vr({accountsPayableContact:gr.target.value}),placeholder:"Accounts payable contact",className:"input-field w-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"EMAIL *"}),jsxRuntimeExports.jsx("input",{type:"email",value:hr.accountsPayableEmail,onChange:gr=>vr({accountsPayableEmail:gr.target.value}),placeholder:"accounts@production.com",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Where invoices should be sent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"PHONE"}),jsxRuntimeExports.jsx("input",{type:"tel",value:hr.accountsPayablePhone,onChange:gr=>vr({accountsPayablePhone:gr.target.value}),placeholder:"Accounts department number",className:"input-field w-full"})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"JOB & CONTRACT REFERENCES"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"PO NUMBER"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.poNumber,onChange:gr=>vr({poNumber:gr.target.value}),placeholder:"Purchase order number",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Required on most invoices  check your deal memo"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"COST CODE"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.costCode,onChange:gr=>vr({costCode:gr.target.value}),placeholder:"Department or cost code",className:"input-field w-full"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Production cost code for your department (e.g. 4001, HMU-01)"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"JOB REFERENCE"}),jsxRuntimeExports.jsx("input",{type:"text",value:hr.jobReference,onChange:gr=>vr({jobReference:gr.target.value}),placeholder:"Contract or job reference number",className:"input-field w-full"})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"INVOICE ADDRESS"}),jsxRuntimeExports.jsxs("div",{className:"card space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:"Different invoice address"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"Send invoices to a different address"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>vr({invoiceAddressDifferent:!hr.invoiceAddressDifferent}),className:`relative w-12 h-7 rounded-full transition-colors ${hr.invoiceAddressDifferent?"bg-gold":"bg-gray-200"}`,children:jsxRuntimeExports.jsx("span",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform ${hr.invoiceAddressDifferent?"left-6":"left-1"}`})})]}),hr.invoiceAddressDifferent&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"ADDRESS"}),jsxRuntimeExports.jsx("textarea",{value:hr.invoiceAddress,onChange:gr=>vr({invoiceAddress:gr.target.value}),placeholder:"Invoice delivery address",rows:3,className:"input-field w-full resize-none"})]}),!hr.invoiceAddressDifferent&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Invoices will use the production company address above."})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"SPECIAL INSTRUCTIONS"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-1",children:"INVOICE NOTES"}),jsxRuntimeExports.jsx("textarea",{value:hr.invoiceNotes,onChange:gr=>vr({invoiceNotes:gr.target.value}),placeholder:"Any special requirements for invoicing this production (e.g. 'Reference PO number on all invoices', 'Submit via portal', etc.)",rows:3,className:"input-field w-full resize-none"})]})]}),jsxRuntimeExports.jsx("div",{className:"pb-4",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center",children:"Details are saved automatically for this project"})})]})]})}pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;async function extractTextFromPDF(ar){const or=await ar.arrayBuffer(),lr=await pdfExports.getDocument({data:or}).promise;let cr="";for(let ur=1;ur<=lr.numPages;ur++){const hr=await(await lr.getPage(ur)).getTextContent(),pr=new Map;for(const fr of hr.items){if(!fr.str||fr.str.trim()==="")continue;const xr=Math.round(fr.transform[5]/2)*2,Er=fr.transform[4];pr.has(xr)||pr.set(xr,[]),pr.get(xr).push({x:Er,text:fr.str,width:fr.width||0})}const mr=Array.from(pr.keys()).sort((fr,xr)=>xr-fr);for(const fr of mr){const xr=pr.get(fr);xr.sort((yr,br)=>yr.x-br.x);let Er="",vr=0,gr=0;for(const yr of xr){const br=yr.x-(vr+gr);vr>0&&br>3&&(br>20?Er+="    ":Er+=" "),Er+=yr.text,vr=yr.x,gr=yr.width}cr+=Er.trimEnd()+`
`}cr+=`
`}return normalizeScriptText(cr)}function normalizeScriptText(ar){return ar.replace(/\b(INT|EXT)\s*\n\s*\./g,"$1.").replace(/\b(INT|EXT)\s*\n\s*\/\s*(INT|EXT)/g,"$1/$2").replace(/CONTIN\s*\n\s*UED?/gi,"CONTINUOUS").replace(/CONT['']?D/gi,"CONT'D").replace(/\(\s*V\s*\.\s*O\s*\.\s*\)/gi,"(V.O.)").replace(/\(\s*O\s*\.\s*S\s*\.\s*\)/gi,"(O.S.)").replace(/[ \t]+/g," ").replace(/\n{4,}/g,`


`).replace(/(\d+[A-Z]?)\s+\./g,"$1.").trim()}function extractTextFromFDX(ar){try{const cr=new DOMParser().parseFromString(ar,"text/xml").querySelectorAll("Paragraph");let ur="";return cr.forEach(dr=>{const hr=dr.getAttribute("Type"),pr=dr.querySelectorAll("Text");let mr="";pr.forEach(fr=>{mr+=fr.textContent||""}),hr==="Scene Heading"?ur+=`
`+mr.trim()+`
`:hr==="Character"?ur+=`
`+mr.trim().toUpperCase()+`
`:hr==="Dialogue"?ur+=mr.trim()+`
`:hr==="Action"?ur+=`
`+mr.trim()+`
`:ur+=mr.trim()+`
`}),ur}catch(or){return console.error("Error parsing FDX:",or),ar}}function normalizeTimeOfDayForScene(ar){const or=(ar||"DAY").toUpperCase();return or==="NIGHT"||or==="NIGHTMARE"?"NIGHT":or==="MORNING"||or==="DAWN"||or==="SUNRISE"?"MORNING":or==="EVENING"||or==="DUSK"||or==="SUNSET"||or==="MAGIC HOUR"||or==="GOLDEN HOUR"?"EVENING":or==="CONTINUOUS"||or==="CONT"||or==="LATER"||or==="SAME"||or==="SAME TIME"||or==="MOMENTS LATER"||or==="SIMULTANEOUS"?"CONTINUOUS":"DAY"}function normalizeCharacterName(ar){let or=ar.toUpperCase();if(or=or.replace(/\s*\(.*?\)\s*/g,""),or.includes("/")&&!or.startsWith("INT")&&!or.startsWith("EXT")){const lr=or.split("/");lr[0].length>=2&&lr[0].length<=20&&(or=lr[0].trim())}return or.replace(/\s+/g," ").trim()}function extractCharactersFromActionLine(ar){const or=[],lr=ar.trim();if(lr.length<5||/^(INT\.|EXT\.|INT\/EXT|CUT TO|FADE|DISSOLVE|CONTINUED)/i.test(lr))return or;const cr=new Set(["INT","EXT","ROAD","STREET","AVENUE","HIGHWAY","PATH","TRAIL","LANE","DAY","NIGHT","MORNING","EVENING","CONTINUOUS","LATER","SAME","CONT","DAWN","DUSK","CONTINUED","CUT","FADE","DISSOLVE","SMASH","MATCH","WIPE","THE","AND","BUT","FOR","NOT","YOU","ALL","CAN","HER","HIS","HIM","SHE","HAS","HAD","WAS","ARE","BEEN","HAVE","THEIR","WHAT","WHEN","WHERE","WHICH","WHO","THIS","THAT","WITH","FROM","INTO","ONTO","UPON","BACK","OVER","UNDER","VERY","MUCH","MORE","MOST","JUST","ONLY","ALSO","EVEN","STILL","WELL","SUCH","SOME","MANY","BOTH","EACH","OTHER","CLOSE","WIDE","ANGLE","VIEW","SHOT","POV","INSERT","FLASHBACK","DREAM","TITLE","SUPER","CHYRON","SUBTITLE","TV","DVD","VHS","USA","NYC","NYPD","FBI","CIA","NSA","TAXI","STAND","CAR","DOOR","ROOM","HOUSE","BOAT","PHONE","GUN","KNIFE","TABLE","CHAIR","PARKA","WHEELCHAIR","VEHICLE","WINDOW","WALL","FLOOR","CEILING","BED","DESK","LAMP","MOUNTAINS","MOUNTAIN","HILLS","HILLSIDES","VALLEY","RIVER","RIVERS","STREAM","STREAMS","LAKE","OCEAN","SEA","BEACH","FOREST","WOODS","TREE","TREES","SKY","SUN","MOON","CLOUDS","RAIN","SNOW","WIND","WATER","MELTWATER","WILDFLOWER","FLOWERS","GRASS","EDENIC","VERDANT","LONELY","QUIET","LOUD","DARK","BRIGHT","SMALL","LARGE","BIG","TALL","SHORT","LONG","WIDE","NARROW","THICK","THIN","HEAVY","LIGHT","HARD","SOFT","HOT","COLD","WARM","COOL","WET","DRY","CLEAN","DIRTY","NEW","OLD","FRESH","STALE","GOOD","BAD","GREAT","POOR","RICH","SIMPLE","COMPLEX","EASY","DIFFICULT","FAST","SLOW","HIGH","LOW","NEAR","FAR","CLOSE","DISTANT","OPEN","CLOSED","EMPTY","FULL","BEAUTIFUL","GORGEOUS","STUNNING","SERENE","PEACEFUL","CALM","WILD","FIERCE","RED","BLUE","GREEN","YELLOW","ORANGE","PURPLE","PINK","BLACK","WHITE","GREY","GRAY","BROWN","GOLDEN","SILVER","ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN","FIRST","SECOND","THIRD","LAST","NEXT","ANOTHER","FEW","SEVERAL"]),ur=/^[A-Z]+(ING|ED|LY|TION|SION|NESS|MENT|ABLE|IBLE|ICAL|IOUS|EOUS|ULAR|TERN|ERN|WARD|WARDS|LIKE|LESS|FUL|IC|AL|ARY|ORY|IVE|OUS|ANT|ENT)$/,dr=/^(INT|EXT)\s*[.\/]/,hr=/\b([A-Z][A-Z.'-]+(?:\s+[A-Z][A-Z.'-]+){0,2})\b/g;let pr;for(;(pr=hr.exec(lr))!==null;){const fr=pr[1].trim();if(dr.test(fr)||fr.split(/\s+/).length===1&&cr.has(fr)||cr.has(fr)||ur.test(fr))continue;const xr=fr.split(/\s+/);if(xr.some(yr=>ur.test(yr)||cr.has(yr))||/\b(TAXI|CAR|DOOR|ROOM|HOUSE|BOAT|PHONE|GUN|KNIFE|TABLE|CHAIR|STAND|PARKA|WHEELCHAIR|VEHICLE|ROAD|STREET|MOUNTAIN|RIVER|TREE)\b/i.test(fr))continue;const gr=/\b(MAN|WOMAN|PERSON|DRIVER|OFFICER|DOCTOR|NURSE|GUARD|SOLDIER|WORKER|GIRL|BOY|LADY|GUY|KID|CHILD|TEEN|TEENAGER|CLERK|WAITER|WAITRESS|COP|DETECTIVE|AGENT|STRANGER|FIGURE)\b/i;if(xr.length>=2&&gr.test(fr)){or.push(fr);continue}if(xr.length===1&&fr.length>=3&&fr.length<=15){const yr=lr.slice(pr.index+fr.length),br=/^\s*(enters|exits|walks|runs|stands|sits|looks|turns|moves|says|speaks|watches|stares|smiles|nods|shakes|reaches|grabs|holds|opens|closes|steps|crosses|approaches|leaves|arrives|appears|disappears|rises|falls|jumps|climbs|crawls|lies|kneels|bends|leans|waves|points|gestures|signals|calls|shouts|whispers|laughs|cries|sighs|groans|screams|freezes|pauses|stops|starts|continues|begins|finishes|waits|hesitates)/i.test(yr),_r=/^('s\s|'s$)/i.test(yr),jr=/^\s+and\s+[A-Z][a-z]/i.test(yr);(br||_r||jr)&&or.push(fr)}}const mr=/(?:^|[,;]\s*|\.\s+)([A-Z][a-z]+(?:\s+(?:and|&)\s+[A-Z][a-z]+)*)\s+(and\s+)?(?=enters|exits|walks|runs|stands|sits|looks|turns|moves|says|speaks|watches|stares|smiles|nods|shakes|reaches|grabs|holds|opens|closes|steps|crosses|approaches|leaves|arrives|appears|disappears|rises|falls|jumps|climbs|crawls|lies|kneels|bends|leans|waves|points|gestures|signals|calls|shouts|whispers|laughs|cries|sighs|groans|screams|freezes|pauses|stops|starts|continues|begins|finishes|waits|hesitates|[a-z])/gi;for(;(pr=mr.exec(lr))!==null;){const fr=pr[1].split(/\s+(?:and|&)\s+/i);for(const xr of fr){const Er=xr.trim().toUpperCase();Er.length>=3&&Er.length<=20&&!cr.has(Er)&&!ur.test(Er)&&!["THE","AND","BUT","FOR","NOT","THIS","THAT","WHEN","WHERE","WHILE","THEN","THERE","HERE"].includes(Er)&&or.push(Er)}}return[...new Set(or)]}function isCharacterCue(ar){const or=ar.trim();if(or!==or.toUpperCase()||or.length>50)return!1;const lr=[/^(INT\.|EXT\.|INT\/EXT|EXT\/INT|I\/E\.)/i,/^(CUT TO|FADE|DISSOLVE|SMASH|MATCH|WIPE)/i,/^(THE END|CONTINUED|MORE|\(MORE\))/i,/^\d+\s*$/,/^\s*$/,/^(TITLE:|SUPER:|CHYRON:|CARD:|INSERT:|INTERCUT)/i,/^(FLASHBACK|END FLASHBACK|FLASH BACK|DREAM SEQUENCE)/i,/^(BACK TO|RESUME|ANGLE ON|CLOSE ON|WIDE ON|POV)/i,/^(LATER|CONTINUOUS|MOMENTS LATER|SAME TIME)/i,/^(SUPERIMPOSE|SUBTITLE|CAPTION)/i];for(const hr of lr)if(hr.test(or))return!1;if(!/[A-Z]/.test(or))return!1;const cr=[/^(A |AN |THE |HE |SHE |THEY |WE |IT |HIS |HER |THEIR )/,/^(IN THE |AT THE |ON THE |FROM THE |TO THE |INTO THE )/,/^(ARRIVING|ENTERING|LEAVING|WALKING|RUNNING|STANDING|SITTING)/,/ (ENTERS|EXITS|WALKS|RUNS|STANDS|SITS|LOOKS|TURNS|MOVES)$/,/ (IS |ARE |WAS |WERE |HAS |HAVE |THE |A |AN )/,/^[A-Z]+ [A-Z]+ [A-Z]+ [A-Z]+ [A-Z]+/,/\.$/,/^\d+[A-Z]?\s+/];for(const hr of cr)if(hr.test(or))return!1;const ur=or.replace(/\s*\(.*?\)\s*/g,"").trim(),dr=ur.split(/\s+/).length;return dr>4||dr===1&&(/^[A-Z]+(ING|ED|LY|TION|SION|NESS|MENT|ABLE|IBLE|ICAL|IOUS|EOUS|ULAR|TERN|ERN|WARD|WARDS|LIKE|LESS|FUL|IC|AL|ARY|ORY|IVE|OUS|ANT|ENT)$/.test(ur)||new Set(["INT","EXT","ROAD","STREET","HOUSE","ROOM","OFFICE","BUILDING","DAY","NIGHT","MORNING","EVENING","DAWN","DUSK","LATER","CONTINUOUS","EDENIC","VERDANT","TOWERING","LONELY","BEAUTIFUL","GORGEOUS","STUNNING","SERENE","PEACEFUL","WILD","FIERCE","ANCIENT","MODERN","RUSTIC","MOUNTAINS","MOUNTAIN","HILLS","VALLEY","RIVER","STREAM","LAKE","OCEAN","FOREST","WOODS","TREE","TREES","SKY","SUN","MOON","MELTWATER","RED","BLUE","GREEN","YELLOW","ORANGE","PURPLE","BLACK","WHITE","GOLDEN","VERY","MUCH","MORE","MOST","JUST","ONLY","ALSO","EVEN","STILL","WELL","ONE","TWO","THREE","FIRST","SECOND","THIRD","LAST","NEXT","ANOTHER","CONTINUED","FADE","CUT","DISSOLVE","ANGLE","SHOT","VIEW","CLOSE","WIDE"]).has(ur))?!1:ur.length>=2&&ur.length<=35}function parseSceneHeadingLine(ar){const or=ar.trim(),lr={sceneNumber:null,intExt:"INT",location:"",timeOfDay:"DAY",rawSlugline:or,isValid:!1};if(!or||or.length<5)return lr;let cr=or.replace(/\s*\*+\s*$/,"").trim();const ur=/^(\d+[A-Z]?)\s+/i,dr=/\s+(\d+[A-Z]?)\s*$/i;let hr=null,pr=cr;const mr=pr.match(ur);mr&&(hr=mr[1].toUpperCase(),pr=pr.slice(mr[0].length).trim());const fr=pr.match(dr);if(fr){const wr=fr[1].toUpperCase();hr||(hr=wr),pr=pr.slice(0,-fr[0].length).trim()}const xr=/^(INT\.?\/EXT\.?|EXT\.?\/INT\.?|I\/E\.?|INT\.?|EXT\.?)\s*/i,Er=pr.match(xr);if(!Er)return lr;const gr=Er[1].toUpperCase().replace(/\.$/,"").startsWith("EXT")?"EXT":"INT";pr=pr.slice(Er[0].length).trim(),pr=pr.replace(/^[\.\-]\s*/,"").trim();const yr=/(?:\s*[-\.]+\s*|\s+)(DAY|NIGHT|MORNING|EVENING|AFTERNOON|DAWN|DUSK|SUNSET|SUNRISE|CONTINUOUS|CONT|LATER|SAME|SAME TIME|MOMENTS LATER|SIMULTANEOUS|MAGIC HOUR|GOLDEN HOUR|FLASHBACK|PRESENT|DREAM|FANTASY|NIGHTMARE|ESTABLISHING)(?:\s*[-]?\s*(?:FLASHBACK|PRESENT|CONT(?:'D)?)?)?$/i;let br="DAY",_r=pr;const jr=pr.match(yr);return jr&&(br=jr[1].toUpperCase(),br==="CONT"&&(br="CONTINUOUS"),_r=pr.slice(0,jr.index).trim(),_r=_r.replace(/[\s\-\.,]+$/,"").trim()),!jr&&pr.length>0&&(_r=pr.replace(/[\s\-\.,]+$/,"").trim()),!_r||_r.length<2?lr:{sceneNumber:hr,intExt:gr,location:_r,timeOfDay:br,rawSlugline:or,isValid:!0}}function convertParsedScriptToProject(ar,or){const lr=new Map,cr=or.map((dr,hr)=>{const pr=v4();lr.set(dr,pr);const mr=dr.split(" ").map(Er=>Er[0]).join("").slice(0,2),fr=["#C9A961","#8B5CF6","#EC4899","#10B981","#F59E0B","#EF4444","#3B82F6","#6366F1"],xr=fr[hr%fr.length];return{id:pr,name:dr,initials:mr,avatarColour:xr}});return{scenes:ar.scenes.map(dr=>{const hr=dr.characters.filter(pr=>lr.has(pr)).map(pr=>lr.get(pr));return{id:v4(),sceneNumber:dr.sceneNumber,slugline:`${dr.intExt}. ${dr.location} - ${dr.timeOfDay}`,intExt:dr.intExt,timeOfDay:dr.timeOfDay,synopsis:dr.synopsis,scriptContent:dr.content,characters:hr,isComplete:!1}}),characters:cr}}async function parseScenesFast(ar){const or=ar.name.toLowerCase();let lr;if(or.endsWith(".pdf"))lr=await extractTextFromPDF(ar);else if(or.endsWith(".fdx")){const xr=await ar.text();lr=extractTextFromFDX(xr)}else lr=await ar.text();const cr=lr.split(`
`),ur=[];let dr=null,hr=0,pr="";for(let xr=0;xr<cr.length;xr++){const Er=cr[xr],vr=Er.trim(),gr=parseSceneHeadingLine(vr);if(gr.isValid){dr&&(dr.scriptContent=pr.trim(),ur.push(dr)),hr++;const yr=gr.sceneNumber||String(hr),br=normalizeTimeOfDayForScene(gr.timeOfDay);dr={sceneNumber:yr,slugline:vr,intExt:gr.intExt,location:gr.location,timeOfDay:br,scriptContent:""},pr=vr+`
`;continue}dr&&(pr+=Er+`
`)}dr&&(dr.scriptContent=pr.trim(),ur.push(dr));const mr=lr.slice(0,1e3).match(/^(?:title[:\s]*)?([A-Z][A-Z\s\d\-\'\"]+)(?:\n|by)/im);return{title:mr?mr[1].trim():"Untitled Script",scenes:ur,rawText:lr}}async function detectCharactersForScene(ar,or,lr){const cr=(lr==null?void 0:lr.knownCharacters)??[],ur=[],dr=new Set;if(cr.length>0){const mr=ar.toUpperCase();for(const fr of cr){const xr=normalizeCharacterName(fr);if(xr.length<2)continue;new RegExp(`\\b${escapeRegExp(xr)}\\b`,"i").test(mr)&&!dr.has(xr)&&(dr.add(xr),ur.push(xr))}}const hr=ar.split(`
`);let pr=!1;for(let mr=0;mr<hr.length;mr++){const xr=hr[mr].trim();if(isCharacterCue(xr)){const Er=normalizeCharacterName(xr);Er.length>=2&&!dr.has(Er)&&(dr.add(Er),ur.push(Er)),pr=!0}else if(!(pr&&xr.length>0)){if(pr=!1,xr.length>10&&cr.length===0){const Er=extractCharactersFromActionLine(xr);for(const vr of Er){const gr=normalizeCharacterName(vr);gr.length>=2&&!dr.has(gr)&&(dr.add(gr),ur.push(gr))}}}}return ur}function escapeRegExp(ar){return ar.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async function detectCharactersForScenesBatch(ar,or,lr){var pr;const cr=new Map,ur=ar.length;let dr=0;const hr=5;for(let mr=0;mr<ar.length;mr+=hr){const fr=ar.slice(mr,mr+hr),xr=await Promise.all(fr.map(async Er=>{const vr=await detectCharactersForScene(Er.scriptContent,or,{knownCharacters:lr==null?void 0:lr.knownCharacters});return{sceneNumber:Er.sceneNumber,characters:vr}}));for(const Er of xr)cr.set(Er.sceneNumber,Er.characters),dr++,(pr=lr==null?void 0:lr.onProgress)==null||pr.call(lr,dr,ur)}return cr}function ScheduleAmendmentModal({amendmentResult:ar,getCastNamesForNumbers:or,onApply:lr,onCancel:cr}){const[ur,dr]=reactExports.useState(!0),[hr,pr]=reactExports.useState(!0),[mr,fr]=reactExports.useState(!0),[xr,Er]=reactExports.useState(!0),[vr,gr]=reactExports.useState(!0),[yr,br]=reactExports.useState(null),{addedScenes:_r,removedScenes:jr,movedScenes:wr,castChanges:Sr,timingChanges:Tr,addedDays:Rr,removedDays:Nr,summary:Cr,hasChanges:kr}=ar,Ar=()=>{lr({includeAddedScenes:ur,includeRemovedScenes:hr,includeMovedScenes:mr,includeCastChanges:xr,includeTimingChanges:vr})},Or=ur||hr||mr||xr||vr,Lr=Kr=>{switch(Kr){case"scene_added":case"day_added":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})});case"scene_removed":case"day_removed":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})});case"scene_moved":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})});case"cast_changed":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})})});case"timing_changed":return jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-3.5 h-3.5 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})});default:return null}},Fr=Kr=>jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2 py-2",children:[Lr(Kr.changeType),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-text-primary",children:["Sc ",Kr.sceneNumber]}),Kr.newEntry&&jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted truncate",children:Kr.newEntry.setLocation})]}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-muted mt-0.5",children:Kr.description}),Kr.changeType==="cast_changed"&&jsxRuntimeExports.jsxs("div",{className:"mt-1 space-y-0.5",children:[Kr.castAdded&&Kr.castAdded.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:or(Kr.castAdded).map((Gr,Zr)=>jsxRuntimeExports.jsxs("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded",children:["+ ",Gr]},Zr))}),Kr.castRemoved&&Kr.castRemoved.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1",children:or(Kr.castRemoved).map((Gr,Zr)=>jsxRuntimeExports.jsxs("span",{className:"text-[10px] bg-red-100 text-red-700 px-1.5 py-0.5 rounded",children:["- ",Gr]},Zr))})]})]})]},`${Kr.sceneNumber}-${Kr.changeType}`),Hr=(Kr,Gr,Zr,Jr,os,Ur,Vr="Include")=>{if(Zr.length===0)return null;const es=yr===Gr,Ir={green:{heading:"text-green-700",border:"border-green-200",bg:"bg-green-50"},red:{heading:"text-red-700",border:"border-red-200",bg:"bg-red-50"},blue:{heading:"text-blue-700",border:"border-blue-200",bg:"bg-blue-50"},purple:{heading:"text-purple-700",border:"border-purple-200",bg:"bg-purple-50"},amber:{heading:"text-amber-700",border:"border-amber-200",bg:"bg-amber-50"}},Dr=Ir[Jr]||Ir.amber;return jsxRuntimeExports.jsxs("div",{className:clsx("border rounded-lg overflow-hidden",Dr.border),children:[jsxRuntimeExports.jsx("div",{className:clsx("px-3 py-2",Dr.bg),children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>br(es?null:Gr),className:"flex items-center gap-2 flex-1 text-left",children:[jsxRuntimeExports.jsxs("h4",{className:clsx("text-xs font-bold tracking-wider uppercase",Dr.heading),children:[Kr," (",Zr.length,")"]}),jsxRuntimeExports.jsx("svg",{className:clsx("w-3.5 h-3.5 text-text-muted transition-transform",es&&"rotate-180"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:os,onChange:Pr=>Ur(Pr.target.checked),className:"w-4 h-4 rounded border-gray-300 text-gold focus:ring-gold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:Vr})]})]})}),es&&jsxRuntimeExports.jsx("div",{className:"px-3 divide-y divide-border/30",children:Zr.map(Fr)})]})};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[90vh] flex flex-col safe-bottom",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between shrink-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Schedule Changes Detected"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:Cr})]}),jsxRuntimeExports.jsx("button",{onClick:cr,className:"p-2 -mr-2 text-text-muted active:text-gold",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:kr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-blue-700",children:"Select which changes to apply. Unchecked changes will be ignored and your current data will be preserved."})}),(Rr.length>0||Nr.length>0)&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[Rr.length>0&&jsxRuntimeExports.jsx("div",{className:"flex-1 p-2 bg-green-50 border border-green-200 rounded-lg",children:jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-green-700",children:["+",Rr.length," day",Rr.length>1?"s":""]})}),Nr.length>0&&jsxRuntimeExports.jsx("div",{className:"flex-1 p-2 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsxs("span",{className:"text-xs font-semibold text-red-700",children:["-",Nr.length," day",Nr.length>1?"s":""]})})]}),Hr("Scenes Added","added",_r,"green",ur,dr),Hr("Scenes Removed","removed",jr,"red",hr,pr,"Remove"),Hr("Scenes Moved","moved",wr,"blue",mr,fr),Hr("Cast Changes","cast",Sr,"purple",xr,Er),Hr("Timing Changes","timing",Tr,"amber",vr,gr)]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-8",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),jsxRuntimeExports.jsx("p",{className:"text-text-primary font-medium",children:"No Changes Detected"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-1",children:"The new schedule appears identical to your current one."})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 border-t border-border shrink-0 space-y-2",children:kr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:Ar,disabled:!Or,className:"w-full py-3 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50",children:"Apply Selected Changes"}),jsxRuntimeExports.jsx("button",{onClick:cr,className:"w-full py-2 text-sm text-text-muted",children:"Cancel - Keep Current Schedule"})]}):jsxRuntimeExports.jsx("button",{onClick:cr,className:"w-full py-3 rounded-button bg-gray-100 text-text-primary font-semibold text-base active:scale-[0.98] transition-transform",children:"Close"})})]})})}const getSystemTheme=()=>typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",resolveTheme=ar=>ar==="system"?getSystemTheme():ar,applyTheme=ar=>{if(typeof document<"u"){const or=document.documentElement;or.classList.remove("light","dark"),or.classList.add(ar);const lr=document.querySelector('meta[name="theme-color"]');lr&&lr.setAttribute("content",ar==="dark"?"#000000":"#f5f4f2")}},useThemeStore=create()(persist(ar=>({theme:"light",resolvedTheme:"light",setTheme:or=>{const lr=resolveTheme(or);applyTheme(lr),ar({theme:or,resolvedTheme:lr})}}),{name:"hair-makeup-theme-storage",storage:createJSONStorage(()=>localStorage),onRehydrateStorage:()=>ar=>{if(ar){const or=resolveTheme(ar.theme);applyTheme(or),ar.resolvedTheme=or}}}));typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",ar=>{if(useThemeStore.getState().theme==="system"){const lr=ar.matches?"dark":"light";applyTheme(lr),useThemeStore.setState({resolvedTheme:lr})}});function UserProfileScreen({onBack:ar,onNavigateToBilling:or}){const{user:lr,signOut:cr}=useAuthStore(),{theme:ur,setTheme:dr}=useThemeStore(),[hr,pr]=reactExports.useState(!1),[mr,fr]=reactExports.useState((lr==null?void 0:lr.name)||""),[xr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(null),[yr,br]=reactExports.useState(!1),_r=[{value:"light",label:"Light",icon:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})},{value:"dark",label:"Dark",icon:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})},{value:"system",label:"System",icon:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}],jr=()=>{if(!(lr!=null&&lr.name))return"U";const Nr=lr.name.split(" ");return Nr.length>=2?`${Nr[0][0]}${Nr[1][0]}`.toUpperCase():lr.name.substring(0,2).toUpperCase()},wr=()=>"Beta Tester",Sr=async()=>{if(!mr.trim()||!lr){gr({type:"error",text:"Name cannot be empty"});return}Er(!0);try{const{error:Nr}=await updateUserProfile(lr.id,{name:mr.trim()});if(Nr)throw Nr;useAuthStore.setState({user:{...lr,name:mr.trim()}}),pr(!1),gr({type:"success",text:"Profile updated successfully"})}catch{gr({type:"error",text:"Failed to update profile"})}finally{Er(!1)}},Tr=async()=>{if(!(lr!=null&&lr.email)){gr({type:"error",text:"No email address found"});return}br(!0);try{const{error:Nr}=await supabase.auth.resetPasswordForEmail(lr.email,{redirectTo:`${window.location.origin}/reset-password`});if(Nr)throw Nr;gr({type:"success",text:"Password reset email sent! Check your inbox."})}catch{gr({type:"error",text:"Failed to send password reset email"})}finally{br(!1)}},Rr=()=>{cr()};return vr&&setTimeout(()=>gr(null),4e3),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"My Account"})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4 pb-safe-bottom",children:[vr&&jsxRuntimeExports.jsx("div",{className:`mb-4 px-4 py-2 rounded-lg text-sm ${vr.type==="success"?"bg-green-50 border border-green-200 text-green-700":"bg-red-50 border border-red-200 text-red-700"}`,children:vr.text}),jsxRuntimeExports.jsx("section",{className:"mb-6",children:jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-border mb-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gold-100 flex items-center justify-center text-gold text-xl font-bold",children:jr()}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[hr?jsxRuntimeExports.jsx("input",{type:"text",value:mr,onChange:Nr=>fr(Nr.target.value),className:"input-field w-full text-lg font-bold",autoFocus:!0}):jsxRuntimeExports.jsx("h2",{className:"text-lg font-bold text-text-primary truncate",children:(lr==null?void 0:lr.name)||"User"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted truncate",children:(lr==null?void 0:lr.email)||""}),jsxRuntimeExports.jsx("div",{className:"inline-flex items-center gap-1 mt-1 px-2 py-0.5 bg-gold-50 rounded-full",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-gold",children:wr()})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-2",children:hr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>{pr(!1),fr((lr==null?void 0:lr.name)||"")},className:"flex-1 py-2 px-4 rounded-button border border-border text-text-muted text-sm font-medium active:scale-98 transition-transform",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:Sr,disabled:xr,className:"flex-1 py-2 px-4 rounded-button gold-gradient text-white text-sm font-medium active:scale-98 transition-transform disabled:opacity-50",children:xr?"Saving...":"Save"})]}):jsxRuntimeExports.jsx("button",{onClick:()=>pr(!0),className:"flex-1 py-2 px-4 rounded-button border border-border text-text-primary text-sm font-medium active:scale-98 transition-transform",children:"Edit Profile"})})]})}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"ACCOUNT SETTINGS"}),jsxRuntimeExports.jsxs("div",{className:"card divide-y divide-border",children:[jsxRuntimeExports.jsxs("button",{onClick:Tr,disabled:yr,className:"w-full flex items-center gap-4 px-4 py-3 active:bg-gray-50 transition-colors disabled:opacity-50",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:yr?"Sending...":"Reset Password"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Send password reset email"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]}),jsxRuntimeExports.jsxs("button",{onClick:or,className:"w-full flex items-center gap-4 px-4 py-3 active:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Billing & Bank Details"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"For timesheets and invoices"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})]})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"BETA ACCESS"}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-gold-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.745 3.745 0 011.043 3.296A3.745 3.745 0 0121 12z"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Full Access Enabled"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Thank you for beta testing!"})]})]})})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"APPEARANCE"}),jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Theme"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted capitalize",children:ur})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-3 gap-2",children:_r.map(Nr=>jsxRuntimeExports.jsxs("button",{onClick:()=>dr(Nr.value),className:`flex flex-col items-center gap-2 p-3 rounded-xl border-2 transition-all ${ur===Nr.value?"border-gold bg-gold/10 text-gold":"border-border text-text-muted hover:border-gold/50"}`,children:[Nr.icon,jsxRuntimeExports.jsx("span",{className:"text-xs font-medium",children:Nr.label})]},Nr.value))})]})]}),jsxRuntimeExports.jsxs("section",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"SESSION"}),jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsxs("button",{onClick:Rr,className:"w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-red-50 active:bg-red-100 transition-colors",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-50 flex items-center justify-center text-red-500",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-red-500",children:"Sign Out"})]})})]}),jsxRuntimeExports.jsx("div",{className:"text-center text-xs text-text-muted py-4",children:jsxRuntimeExports.jsx("p",{children:"Checks Happy v1.0.0"})})]})]})}function More({onNavigateToTab:ar,onStartNewProject:or,initialView:lr,resetKey:cr,subView:ur}){const dr=()=>ur||(lr&&["script","schedule","callsheets"].includes(lr)?lr:"menu"),[hr,pr]=reactExports.useState(dr),[mr,fr]=reactExports.useState("menu"),{isEditMenuOpen:xr,closeEditMenu:Er,openEditMenu:vr}=useNavigationStore(),{projectMemberships:gr,user:yr}=useAuthStore(),{projectSettings:br,clearState:_r}=useProjectSettingsStore(),jr=useProjectStore(Or=>{var Lr;return((Lr=Or.currentProject)==null?void 0:Lr.id)??""}),wr=gr.find(Or=>Or.projectId===jr)||(gr.length>0?gr[0]:null),Sr=(wr==null?void 0:wr.role)==="owner",Tr=wr&&yr?canManageProject(yr.tier,{isOwner:Sr,role:Sr?"designer":wr.role==="supervisor"?"supervisor":"trainee"}):!1;reactExports.useEffect(()=>{ur?pr(ur):lr&&["script","schedule","callsheets"].includes(lr)?pr(lr):lr==="more"&&pr("menu")},[lr,cr,ur]);const Rr=xr?"editMenu":hr,Nr=Or=>{Or==="editMenu"?vr():pr(Or)},Cr=()=>{Er(),pr("menu")},kr=()=>{lr&&["script","schedule","callsheets"].includes(lr)?ar==null||ar("today"):pr("menu")},Ar=()=>{switch(Rr){case"script":return jsxRuntimeExports.jsx(ScriptViewer,{onBack:kr});case"schedule":return jsxRuntimeExports.jsx(ScheduleViewer,{onBack:kr});case"callsheets":return jsxRuntimeExports.jsx(CallSheetArchive,{onBack:kr});case"editMenu":return jsxRuntimeExports.jsx(EditMenuScreen,{onDone:Cr});case"export":return jsxRuntimeExports.jsx(ProjectExportScreen,{onBack:()=>pr("projectSettings"),onExportComplete:()=>pr("projectSettings"),onNavigateToBilling:()=>{fr("export"),pr("billing")}});case"archivedProjects":return jsxRuntimeExports.jsx(ArchivedProjectsScreen,{onBack:()=>pr("menu")});case"projectSettings":return jsxRuntimeExports.jsx(ProjectSettingsScreen,{projectId:jr||(wr==null?void 0:wr.projectId)||"",onBack:()=>pr("menu"),onNavigateToTeam:()=>pr("team"),onNavigateToStats:()=>pr("projectStats"),onNavigateToExport:()=>pr("export"),onNavigateToProductionDetails:()=>pr("productionDetails"),onProjectArchived:()=>{_r(),pr("menu")},onProjectDeleted:()=>{_r(),or==null||or()}});case"productionDetails":return jsxRuntimeExports.jsx(ProductionDetailsScreen,{projectId:jr||(wr==null?void 0:wr.projectId)||"",onBack:()=>pr("projectSettings")});case"team":return jsxRuntimeExports.jsx(TeamScreen,{projectId:jr||(wr==null?void 0:wr.projectId)||"",canManage:Tr,isOwner:Sr,onBack:()=>pr("projectSettings"),onInvite:()=>pr("invite")});case"invite":return jsxRuntimeExports.jsx(InviteScreen,{inviteCode:(br==null?void 0:br.inviteCode)||(wr==null?void 0:wr.projectCode)||"",isOwner:Sr,onBack:()=>pr("team")});case"projectStats":return jsxRuntimeExports.jsx(ProjectStatsScreen,{projectId:jr||(wr==null?void 0:wr.projectId)||"",onBack:()=>pr("projectSettings")});case"manualSchedule":return jsxRuntimeExports.jsx(ScheduleScreen,{onBack:()=>pr("projectSettings"),onSaved:()=>pr("projectSettings")});case"billing":return jsxRuntimeExports.jsx(BillingDetailsScreen,{onBack:()=>pr(mr),onUpgrade:()=>{useAuthStore.getState().setScreen("select-plan")}});case"userProfile":return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:()=>pr("menu"),onNavigateToBilling:()=>{fr("userProfile"),pr("billing")}});default:return jsxRuntimeExports.jsx(MoreMenu,{onNavigate:Nr,onNavigateToTab:ar,canManage:Tr})}};return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background pb-safe-bottom",children:Ar()})}function MoreMenu({onNavigate:ar,onNavigateToTab:or,canManage:lr}){const{getMoreMenuItems:cr}=useNavigationStore(),dr=cr().map(fr=>ALL_NAV_ITEMS.find(xr=>xr.id===fr)).filter(Boolean),hr=fr=>{switch(fr){case"lookbook":return"Character looks and styles";case"script":return"View script PDF with scene search";case"schedule":return"Shooting schedule day-by-day";case"callsheets":return"Upload and manage call sheets";case"today":return"Today's shooting schedule";case"breakdown":return"Scene breakdown by character";case"hours":return"Timesheet and earnings";case"budget":return"Expenses overview, scan receipts";default:return""}},pr=fr=>{["script","schedule","callsheets"].includes(fr)?ar(fr):or&&or(fr)},mr=dr.filter(fr=>fr.id!=="settings");return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsx("div",{className:"h-14 px-4 flex items-center",children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"More"})})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[mr.map(fr=>jsxRuntimeExports.jsxs("button",{onClick:()=>pr(fr.id),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold-100/50 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(NavIcon,{name:fr.iconName,className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:fr.label}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:hr(fr.id)})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},fr.id)),lr&&jsxRuntimeExports.jsxs("button",{onClick:()=>ar("projectSettings"),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gold-100/50 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(NavIcon,{name:"cog",className:"w-6 h-6"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Settings"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Project settings and management"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]}),jsxRuntimeExports.jsx("div",{className:"pt-4 border-t border-border mt-4",children:jsxRuntimeExports.jsxs("button",{onClick:()=>ar("editMenu"),className:"w-full card flex items-center gap-4 active:scale-[0.98] transition-transform",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Edit Menu"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Customize bottom navigation"})]}),jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})})]})})]})}function EditMenuScreen({onDone:ar}){var os,Ur;const{bottomNavItems:or,setBottomNavItems:lr,moveToBottomNav:cr,moveToMoreMenu:ur}=useNavigationStore(),[dr,hr]=reactExports.useState(null),[pr,mr]=reactExports.useState(null),[fr,xr]=reactExports.useState(null),[Er,vr]=reactExports.useState(!1),[gr,yr]=reactExports.useState(null),br=reactExports.useRef(null),_r=reactExports.useRef(null),jr=reactExports.useRef(new Map),wr=reactExports.useRef(null),Sr=reactExports.useRef(null),Tr=ALL_NAV_ITEMS.filter(Vr=>!or.includes(Vr.id)),Rr=or.map(Vr=>ALL_NAV_ITEMS.find(es=>es.id===Vr)).filter(Boolean),Nr=reactExports.useCallback(Vr=>{hr(Vr)},[]),Cr=reactExports.useCallback(()=>{dr&&pr!==null&&fr&&(fr==="bottom"?cr(dr,pr):fr==="more"&&ur(dr)),hr(null),mr(null),xr(null),vr(!1),yr(null)},[dr,pr,fr,cr,ur]),kr=reactExports.useCallback((Vr,es)=>{xr(Vr),mr(es)},[]),Ar=reactExports.useCallback(Vr=>{const es=wr.current,Ir=Sr.current;if(es){const Dr=es.getBoundingClientRect();if(Vr>=Dr.top&&Vr<=Dr.bottom){let Pr=Rr.length;for(let Mr=0;Mr<Rr.length;Mr++){const Br=jr.current.get(`bottom-${Rr[Mr].id}`);if(Br){const Xr=Br.getBoundingClientRect(),Wr=Xr.top+Xr.height/2;if(Vr<Wr){Pr=Mr;break}}}xr("bottom"),mr(Pr);return}}if(Ir){const Dr=Ir.getBoundingClientRect();if(Vr>=Dr.top&&Vr<=Dr.bottom){xr("more"),mr(0);return}}xr(null),mr(null)},[Rr]),Or=reactExports.useCallback((Vr,es)=>{const Ir=Vr.touches[0];br.current={x:Ir.clientX,y:Ir.clientY,item:es},_r.current=setTimeout(()=>{hr(es),vr(!0),yr({x:Ir.clientX,y:Ir.clientY}),"vibrate"in navigator&&navigator.vibrate(50)},200)},[]),Lr=reactExports.useCallback(Vr=>{const es=Vr.touches[0];if(!br.current)return;const Ir=Math.abs(es.clientX-br.current.x),Dr=Math.abs(es.clientY-br.current.y);if(!Er&&(Ir>10||Dr>10)&&_r.current){clearTimeout(_r.current),_r.current=null;return}Er&&(Vr.preventDefault(),yr({x:es.clientX,y:es.clientY}),Ar(es.clientY))},[Er,Ar]),Fr=reactExports.useCallback(()=>{_r.current&&(clearTimeout(_r.current),_r.current=null),br.current=null,Er&&Cr()},[Er,Cr]),Hr=reactExports.useCallback(()=>{_r.current&&(clearTimeout(_r.current),_r.current=null),br.current=null,hr(null),mr(null),xr(null),vr(!1),yr(null)},[]),Kr=reactExports.useCallback(Vr=>{Vr.preventDefault(),Vr.stopPropagation();const es=Vr.touches[0];yr({x:es.clientX,y:es.clientY}),Ar(es.clientY)},[Ar]),Gr=reactExports.useCallback(Vr=>{Vr.preventDefault(),Fr()},[Fr]),Zr=(Vr,es)=>{const Ir=[...or],[Dr]=Ir.splice(Vr,1);Ir.splice(es,0,Dr),lr(Ir)},Jr=reactExports.useCallback((Vr,es)=>{es?jr.current.set(Vr,es):jr.current.delete(Vr)},[]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Customize Menu"}),jsxRuntimeExports.jsx("button",{onClick:ar,className:"px-4 py-1.5 text-sm font-semibold text-gold active:opacity-70 transition-opacity",children:"Done"})]})})}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted mb-6",children:["Drag items to reorder. Up to ",MAX_BOTTOM_NAV_ITEMS," appear in bottom nav."]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",ref:wr,children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"BOTTOM NAV"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[Rr.map((Vr,es)=>jsxRuntimeExports.jsx(DraggableItem,{item:Vr,index:es,section:"bottom",isDragging:dr===Vr.id,isDragOver:fr==="bottom"&&pr===es,onDragStart:()=>Nr(Vr.id),onDragEnd:Cr,onDragOver:()=>kr("bottom",es),onTouchStart:Ir=>Or(Ir,Vr.id),onTouchMove:Lr,onTouchEnd:Fr,onTouchCancel:Hr,onMoveUp:es>0?()=>Zr(es,es-1):void 0,onMoveDown:es<Rr.length-1?()=>Zr(es,es+1):void 0,onRemove:Rr.length>1?()=>ur(Vr.id):void 0,refCallback:Ir=>Jr(`bottom-${Vr.id}`,Ir)},Vr.id)),or.length<MAX_BOTTOM_NAV_ITEMS&&jsxRuntimeExports.jsx("div",{className:`border-2 border-dashed rounded-xl p-4 text-center transition-colors ${fr==="bottom"&&pr===or.length?"border-gold bg-gold/5":"border-border"}`,onDragOver:Vr=>{Vr.preventDefault(),kr("bottom",or.length)},onDrop:Cr,children:jsxRuntimeExports.jsx("span",{className:"text-sm text-text-light",children:"Drop here to add"})})]})]}),jsxRuntimeExports.jsx("div",{className:"border-t border-border mb-6"}),jsxRuntimeExports.jsxs("div",{ref:Sr,children:[jsxRuntimeExports.jsx("h2",{className:"text-[10px] font-bold tracking-wider uppercase text-text-light mb-3",children:"MORE MENU"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[Tr.map((Vr,es)=>jsxRuntimeExports.jsx(DraggableItem,{item:Vr,index:es,section:"more",isDragging:dr===Vr.id,isDragOver:fr==="more"&&pr===es,onDragStart:()=>Nr(Vr.id),onDragEnd:Cr,onDragOver:()=>kr("more",es),onTouchStart:Ir=>Or(Ir,Vr.id),onTouchMove:Lr,onTouchEnd:Fr,onTouchCancel:Hr,onAddToNav:or.length<MAX_BOTTOM_NAV_ITEMS?()=>cr(Vr.id,or.length):void 0,refCallback:Ir=>Jr(`more-${Vr.id}`,Ir)},Vr.id)),Tr.length===0&&jsxRuntimeExports.jsx("div",{className:"text-center py-6 text-text-light text-sm",children:"All items are in the bottom nav"})]})]}),Er&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-30",style:{touchAction:"none"},onTouchMove:Kr,onTouchEnd:Gr,onTouchCancel:Hr}),Er&&gr&&dr&&jsxRuntimeExports.jsxs("div",{className:"fixed z-50 pointer-events-none",style:{left:gr.x-100,top:gr.y-30},children:[jsxRuntimeExports.jsxs("div",{className:"bg-gold text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 opacity-90",children:[jsxRuntimeExports.jsx(NavIcon,{name:((os=ALL_NAV_ITEMS.find(Vr=>Vr.id===dr))==null?void 0:os.iconName)||"ellipsis",className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:(Ur=ALL_NAV_ITEMS.find(Vr=>Vr.id===dr))==null?void 0:Ur.label})]}),jsxRuntimeExports.jsx("div",{className:"text-xs text-center mt-1 text-gold font-medium",children:fr==="bottom"?"Drop in Bottom Nav":fr==="more"?"Drop in More Menu":"Drag to reorder"})]}),jsxRuntimeExports.jsx("div",{className:"mt-6 p-3 bg-gray-50 rounded-lg",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[jsxRuntimeExports.jsx(NavIcon,{name:"ellipsis",className:"w-5 h-5"}),jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("strong",{children:"More"})," button is always last and cannot be moved."]})]})})]})]})}function DraggableItem({item:ar,isDragging:or,isDragOver:lr,onDragStart:cr,onDragEnd:ur,onDragOver:dr,onTouchStart:hr,onTouchMove:pr,onTouchEnd:mr,onTouchCancel:fr,onMoveUp:xr,onMoveDown:Er,onRemove:vr,onAddToNav:gr,refCallback:yr}){return jsxRuntimeExports.jsxs("div",{ref:yr,className:`card flex items-center gap-3 transition-all cursor-grab active:cursor-grabbing select-none ${or?"opacity-50 scale-95":""} ${lr?"ring-2 ring-gold ring-offset-2":""}`,draggable:!0,onDragStart:cr,onDragEnd:ur,onDragOver:br=>{br.preventDefault(),dr()},onTouchStart:hr,onTouchMove:pr,onTouchEnd:mr,onTouchCancel:fr,children:[jsxRuntimeExports.jsx("div",{className:"text-text-light touch-none",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{d:"M8 6a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 18a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM14 6a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM14 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM14 18a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"})})}),jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-gold-100/50 flex items-center justify-center text-gold",children:jsxRuntimeExports.jsx(NavIcon,{name:ar.iconName,className:"w-5 h-5"})}),jsxRuntimeExports.jsx("span",{className:"flex-1 text-sm font-medium text-text-primary",children:ar.label}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[xr&&jsxRuntimeExports.jsx("button",{onClick:br=>{br.stopPropagation(),xr()},className:"p-1.5 rounded-lg hover:bg-gray-100 text-text-light",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),Er&&jsxRuntimeExports.jsx("button",{onClick:br=>{br.stopPropagation(),Er()},className:"p-1.5 rounded-lg hover:bg-gray-100 text-text-light",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),vr&&jsxRuntimeExports.jsx("button",{onClick:br=>{br.stopPropagation(),vr()},className:"p-1.5 rounded-lg hover:bg-red-50 text-text-light hover:text-error",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),gr&&jsxRuntimeExports.jsx("button",{onClick:br=>{br.stopPropagation(),gr()},className:"p-1.5 rounded-lg hover:bg-green-50 text-text-light hover:text-green-600",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]})]})}function ScriptViewer({onBack:ar}){const[or,lr]=reactExports.useState(""),[cr,ur]=reactExports.useState(null),[dr,hr]=reactExports.useState("full"),{currentProject:pr,compareScriptAmendment:mr,applyScriptAmendment:fr}=useProjectStore(),xr=reactExports.useRef(new Map),Er=reactExports.useRef(null),[vr,gr]=reactExports.useState(!1),[yr,br]=reactExports.useState(null),_r=async Nr=>{var kr;const Cr=(kr=Nr.target.files)==null?void 0:kr[0];if(Cr){gr(!0);try{const Ar=await parseScenesFast(Cr),Or=mr(Ar.scenes);Or&&br(Or)}catch(Ar){console.error("Error processing revised script:",Ar),alert("Failed to process the script. Please try again.")}finally{gr(!1),Er.current&&(Er.current.value="")}}},jr=Nr=>{yr&&(fr(yr,Nr),br(null))},wr=reactExports.useMemo(()=>pr!=null&&pr.scenes?[...pr.scenes].sort((Nr,Cr)=>Nr.sceneNumber.localeCompare(Cr.sceneNumber,void 0,{numeric:!0})):[],[pr==null?void 0:pr.scenes]),Sr=wr.some(Nr=>Nr.scriptContent),Tr=reactExports.useMemo(()=>{if(!or.trim())return wr;const Nr=or.toLowerCase();return wr.filter(Cr=>{var kr,Ar;return((kr=Cr.scriptContent)==null?void 0:kr.toLowerCase().includes(Nr))||Cr.slugline.toLowerCase().includes(Nr)||((Ar=Cr.synopsis)==null?void 0:Ar.toLowerCase().includes(Nr))})},[wr,or]);reactExports.useEffect(()=>{if(cr){const Nr=xr.current.get(cr);Nr&&Nr.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>ur(null),500)}},[cr]);const Rr=(Nr,Cr)=>Cr.trim()?Nr.split(new RegExp(`(${Cr.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi")).map((Ar,Or)=>Ar.toLowerCase()===Cr.toLowerCase()?jsxRuntimeExports.jsx("mark",{className:"bg-gold/30 text-text-primary px-0.5 rounded",children:Ar},Or):Ar):Nr;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Script"}),Sr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("span",{className:"ml-auto text-xs text-text-muted",children:[wr.length," scenes"]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var Nr;return(Nr=Er.current)==null?void 0:Nr.click()},disabled:vr,className:"ml-2 px-2 py-1 text-[10px] font-medium text-gold border border-gold rounded-lg active:bg-gold/10 transition-colors disabled:opacity-50",children:vr?"Processing...":"Upload New Draft"}),jsxRuntimeExports.jsx("input",{ref:Er,type:"file",accept:".pdf,.fdx,.txt,.fountain",onChange:_r,className:"hidden"})]})]}),Sr&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"px-4 pb-3 flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>hr("full"),className:`flex-1 py-1.5 text-xs font-medium rounded-lg transition-colors ${dr==="full"?"bg-gold text-white":"bg-gray-100 text-text-muted"}`,children:"Full Script"}),jsxRuntimeExports.jsx("button",{onClick:()=>hr("pdf"),disabled:!(pr!=null&&pr.scriptPdfData),className:`flex-1 py-1.5 text-xs font-medium rounded-lg transition-colors ${dr==="pdf"?"bg-gold text-white":"bg-gray-100 text-text-muted"} ${pr!=null&&pr.scriptPdfData?"":"opacity-50 cursor-not-allowed"}`,children:"PDF Script"})]}),dr==="full"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"px-4 pb-2 flex gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 relative",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search script...",value:or,onChange:Nr=>lr(Nr.target.value),className:"w-full pl-9 pr-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary"}),or&&jsxRuntimeExports.jsx("button",{onClick:()=>lr(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-light hover:text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsxs("select",{value:cr||"",onChange:Nr=>ur(Nr.target.value||null),className:"px-3 py-2 text-sm border border-border rounded-lg bg-card text-text-primary min-w-[100px]",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Jump to..."}),wr.map(Nr=>jsxRuntimeExports.jsxs("option",{value:Nr.sceneNumber,children:["Scene ",Nr.sceneNumber]},Nr.sceneNumber))]})]}),or&&jsxRuntimeExports.jsx("div",{className:"px-4 pb-2",children:jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Tr.length," scene",Tr.length!==1?"s":""," found"]})})]})]})]})}),jsxRuntimeExports.jsx("div",{className:"mobile-container pb-safe-bottom",children:Sr?dr==="full"?jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:Tr.map(Nr=>jsxRuntimeExports.jsxs("div",{ref:Cr=>{Cr&&xr.current.set(Nr.sceneNumber,Cr)},className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-[120px] z-10 bg-gold/10 backdrop-blur-sm border-l-4 border-gold px-3 py-2 mb-2 rounded-r-lg",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-bold text-gold",children:["SCENE ",Nr.sceneNumber]}),jsxRuntimeExports.jsx("span",{className:`px-1.5 py-0.5 text-[10px] font-bold rounded ${Nr.intExt==="INT"?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-700"}`,children:Nr.intExt}),jsxRuntimeExports.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-gray-100 text-text-muted",children:Nr.timeOfDay})]}),jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-text-primary mt-1",children:Nr.slugline}),Nr.synopsis&&jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted italic mt-1",children:Rr(Nr.synopsis,or)})]}),Nr.scriptContent?jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-text-primary leading-relaxed pl-3",children:or?Rr(Nr.scriptContent,or):Nr.scriptContent}):jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted italic pl-3",children:"No script content available for this scene"})]},Nr.id))}):jsxRuntimeExports.jsx("div",{className:"h-[calc(100vh-180px)]",children:pr!=null&&pr.scriptPdfData?jsxRuntimeExports.jsx("iframe",{src:pr.scriptPdfData,className:"w-full h-full border-0",title:"Script PDF"}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full px-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No PDF Available"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center",children:"Upload a PDF script to view the original document here"})]})}):jsxRuntimeExports.jsx("div",{className:"px-4 py-8",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(NavIcon,{name:"document",className:"w-8 h-8 text-gray-300"})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Script Content"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload a script (PDF, FDX, or Fountain) to view it here"}),jsxRuntimeExports.jsx("button",{className:"px-4 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform",children:"Upload Script"})]})})}),yr&&jsxRuntimeExports.jsx(AmendmentReviewModal,{amendmentResult:yr,onApply:jr,onCancel:()=>br(null)})]})}function ScheduleViewer({onBack:ar}){const{schedule:or,isUploading:lr,uploadError:cr,uploadScheduleStage1:ur,uploadRevisionStage1:dr,startRevisionStage2Processing:hr,compareAmendment:pr,applyAmendment:mr,clearPendingSchedule:fr,clearSchedule:xr,isProcessingStage2:Er,stage2Progress:vr,stage2Error:gr,startStage2Processing:yr,getCastNamesForNumbers:br}=useScheduleStore(),{currentProject:_r,syncCastDataFromSchedule:jr}=useProjectStore(),wr=reactExports.useRef(null),Sr=reactExports.useRef(null),[Tr,Rr]=reactExports.useState(!1),[Nr,Cr]=reactExports.useState("breakdown"),[kr,Ar]=reactExports.useState(null),[Or,Lr]=reactExports.useState(null),[Fr,Hr]=reactExports.useState(!1),Kr=async Ir=>{var Pr;const Dr=(Pr=Ir.target.files)==null?void 0:Pr[0];if(Dr&&Dr.type==="application/pdf")try{await ur(Dr),Cr("breakdown"),await yr(),_r&&Vr({autoConfirm:!0})}catch(Mr){console.error("Failed to upload schedule:",Mr)}wr.current&&(wr.current.value="")},Gr=async Ir=>{var Pr;const Dr=(Pr=Ir.target.files)==null?void 0:Pr[0];if(!(!Dr||Dr.type!=="application/pdf")){try{Hr(!0),await dr(Dr),await hr();const Mr=pr();Mr&&Lr(Mr),Hr(!1)}catch(Mr){console.error("Failed to process schedule revision:",Mr),Hr(!1),fr()}Sr.current&&(Sr.current.value="")}},Zr=Ir=>{Or&&(mr(Or,Ir),Lr(null),_r&&Vr({autoConfirm:!0}))},Jr=()=>{Lr(null),fr()},os=()=>{xr(),Rr(!1),Cr("pdf")},Ur=async()=>{Cr("breakdown"),await yr(),_r&&Vr({autoConfirm:!0})},Vr=Ir=>{const Dr=useScheduleStore.getState().schedule;if(!(!Dr||!_r))try{const Pr=jr(Dr,{createMissingCharacters:(Ir==null?void 0:Ir.createMissingCharacters)??!0,overwriteExisting:(Ir==null?void 0:Ir.overwriteExisting)??!1,autoConfirm:(Ir==null?void 0:Ir.autoConfirm)??!0});Pr&&(console.log("[ScheduleViewer] Cast data synced:",{scenesUpdated:Pr.scenesUpdated,charactersCreated:Pr.charactersCreated}),Pr.errors.length>0&&console.warn("[ScheduleViewer] Sync had some errors:",Pr.errors))}catch(Pr){console.error("[ScheduleViewer] Failed to sync cast data:",Pr)}};reactExports.useEffect(()=>{or&&!Er&&!Fr&&(!or.days||or.days.length===0)&&or.rawText&&(console.log("[ScheduleViewer] Auto-starting processing for unprocessed schedule"),Ur())},[]);const es=(or==null?void 0:or.days)&&or.days.length>0;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsxs("div",{className:"mobile-container",children:[jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Schedule"})]}),or?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[es&&jsxRuntimeExports.jsx("button",{onClick:()=>{var Ir;return(Ir=Sr.current)==null?void 0:Ir.click()},disabled:lr||Er||Fr,className:"px-2 py-1 text-[10px] font-medium text-gold border border-gold rounded-lg active:bg-gold/10 transition-colors disabled:opacity-50",children:Fr?"Processing...":"Upload New Draft"}),jsxRuntimeExports.jsx("button",{onClick:()=>Rr(!0),className:"p-2 text-red-500 active:opacity-70 transition-opacity touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),jsxRuntimeExports.jsx("button",{onClick:()=>{var Ir;return(Ir=wr.current)==null?void 0:Ir.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:lr,children:lr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})})]}):jsxRuntimeExports.jsx("button",{onClick:()=>{var Ir;return(Ir=wr.current)==null?void 0:Ir.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:lr,children:lr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),or&&jsxRuntimeExports.jsxs("div",{className:"px-4 pb-3 flex gap-1 bg-card",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Cr("breakdown"),className:`flex-1 py-2 text-xs font-medium rounded-lg transition-colors ${Nr==="breakdown"?"gold-gradient text-white":"bg-gray-100 text-text-muted"}`,children:"Breakdown"}),jsxRuntimeExports.jsx("button",{onClick:()=>Cr("pdf"),className:`flex-1 py-2 text-xs font-medium rounded-lg transition-colors ${Nr==="pdf"?"gold-gradient text-white":"bg-gray-100 text-text-muted"}`,children:"PDF"})]})]})}),jsxRuntimeExports.jsx("input",{ref:wr,type:"file",accept:".pdf",onChange:Kr,className:"hidden"}),jsxRuntimeExports.jsx("input",{ref:Sr,type:"file",accept:".pdf",onChange:Gr,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[cr&&jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:cr})}),gr&&jsxRuntimeExports.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:gr}),jsxRuntimeExports.jsx("button",{onClick:Ur,className:"mt-2 text-xs text-red-700 underline",children:"Retry Processing"})]}),or?Nr==="pdf"?or.pdfUri?jsxRuntimeExports.jsx("iframe",{src:or.pdfUri,className:"w-full h-[calc(100vh-180px)] border-0 -mx-4 -mt-4",style:{width:"calc(100% + 2rem)"},title:"Schedule PDF"}):jsxRuntimeExports.jsx("div",{className:"card",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center py-4",children:"PDF preview not available"})}):jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[Er&&jsxRuntimeExports.jsxs("div",{className:"card p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin text-gold",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:vr.message||`Processing Day ${vr.current} of ${vr.total}...`}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:"You can navigate away - processing continues in the background"})]})]}),vr.total>0&&jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:jsxRuntimeExports.jsx("div",{className:"gold-gradient h-2 rounded-full transition-all duration-300",style:{width:`${vr.current/vr.total*100}%`}})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Characters will be automatically confirmed once processing completes."})]}),Fr&&jsxRuntimeExports.jsxs("div",{className:"card p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin text-gold",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary block",children:"Processing New Draft..."}),jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted",children:vr.message||(vr.total>0?`Day ${vr.current} of ${vr.total}`:"Parsing schedule PDF")})]})]}),vr.total>0&&jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:jsxRuntimeExports.jsx("div",{className:"gold-gradient h-2 rounded-full transition-all duration-300",style:{width:`${vr.current/vr.total*100}%`}})})]}),!es&&!Er&&!Fr&&or&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gold/10 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsxs("svg",{className:"w-8 h-8 text-gold animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"Processing Schedule"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6 max-w-xs",children:or.totalDays>0?`Preparing to process ${or.totalDays} shooting day${or.totalDays!==1?"s":""}...`:"Starting schedule processing..."}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center max-w-xs",children:"Characters will be automatically synced to your breakdown once processing completes."})]}),es&&or.days.map(Ir=>jsxRuntimeExports.jsxs("div",{className:"card overflow-hidden",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Ar(kr===Ir.dayNumber?null:Ir.dayNumber),className:"w-full p-3 flex items-center justify-between text-left active:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:["Day ",Ir.dayNumber]}),Ir.date&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Ir.dayOfWeek?`${Ir.dayOfWeek}, `:"",Ir.date]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[Ir.location&&jsxRuntimeExports.jsx("span",{className:"text-xs text-text-muted truncate",children:Ir.location}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-gold font-medium",children:[Ir.scenes.length," scene",Ir.scenes.length!==1?"s":""]}),Ir.totalPages&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[Ir.totalPages," pages"]})]})]}),jsxRuntimeExports.jsx("svg",{className:`w-4 h-4 text-text-muted transition-transform flex-shrink-0 ${kr===Ir.dayNumber?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),kr===Ir.dayNumber&&jsxRuntimeExports.jsxs("div",{className:"border-t border-border",children:[Ir.notes&&Ir.notes.length>0&&jsxRuntimeExports.jsx("div",{className:"px-3 py-2 bg-amber-50 border-b border-border",children:Ir.notes.map((Dr,Pr)=>jsxRuntimeExports.jsx("span",{className:"text-xs text-amber-700 block",children:Dr},Pr))}),Ir.scenes.map((Dr,Pr)=>jsxRuntimeExports.jsx("div",{className:`px-3 py-2.5 ${Pr>0?"border-t border-border/50":""}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-gray-100 flex flex-col items-center justify-center",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted leading-none",children:"Sc"}),jsxRuntimeExports.jsx("span",{className:"text-xs font-bold text-text-primary leading-tight",children:Dr.sceneNumber})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:`text-[10px] font-medium px-1 py-0.5 rounded ${Dr.intExt==="EXT"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:Dr.intExt}),jsxRuntimeExports.jsx("span",{className:`text-[10px] font-medium px-1 py-0.5 rounded ${Dr.dayNight.toLowerCase().includes("night")||Dr.dayNight.startsWith("N")?"bg-indigo-100 text-indigo-700":"bg-amber-100 text-amber-700"}`,children:Dr.dayNight}),Dr.pages&&jsxRuntimeExports.jsxs("span",{className:"text-[10px] text-text-muted",children:[Dr.pages," pgs"]}),Dr.estimatedTime&&jsxRuntimeExports.jsx("span",{className:"text-[10px] text-text-muted ml-auto",children:Dr.estimatedTime})]}),jsxRuntimeExports.jsx("p",{className:"text-xs font-medium text-text-primary mt-0.5 truncate",children:Dr.setLocation}),Dr.description&&jsxRuntimeExports.jsx("p",{className:"text-[11px] text-text-muted mt-0.5 line-clamp-2",children:Dr.description}),Dr.castNumbers.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:br(Dr.castNumbers).map((Mr,Br)=>jsxRuntimeExports.jsx("span",{className:"text-[10px] bg-gray-100 text-text-muted px-1.5 py-0.5 rounded",children:Mr},Br))})]})]})},`${Dr.sceneNumber}-${Pr}`)),Ir.scenes.length===0&&jsxRuntimeExports.jsx("div",{className:"px-3 py-4 text-center",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"No scenes extracted for this day"})})]})]},Ir.dayNumber))]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(NavIcon,{name:"schedule",className:"w-8 h-8 text-gray-300"})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Schedule Uploaded"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6 max-w-xs",children:"Upload your production schedule PDF to view it here"}),jsxRuntimeExports.jsx("button",{onClick:()=>{var Ir;return(Ir=wr.current)==null?void 0:Ir.click()},disabled:lr,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50 mb-6",children:lr?"Uploading...":"Upload Schedule PDF"}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4 max-w-xs",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-text-secondary",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Automatic Processing"}),jsxRuntimeExports.jsx("p",{children:"The schedule will process automatically in the background. Characters will be confirmed within a few minutes."})]})]})})]})]}),Tr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-xl p-4 max-w-sm w-full",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-2",children:"Delete Schedule?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-4",children:"This will remove the schedule and all cross-reference data. You can upload a new schedule at any time."}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Rr(!1),className:"flex-1 px-4 py-2.5 rounded-button text-sm font-medium text-text-primary bg-gray-100 active:bg-gray-200 transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:os,className:"flex-1 px-4 py-2.5 rounded-button text-sm font-medium text-white bg-red-500 active:bg-red-600 transition-colors",children:"Delete"})]})]})}),Or&&jsxRuntimeExports.jsx(ScheduleAmendmentModal,{amendmentResult:Or,getCastNamesForNumbers:br,onApply:Zr,onCancel:Jr})]})}function CallSheetArchive({onBack:ar}){const{callSheets:or,activeCallSheetId:lr,setActiveCallSheet:cr,uploadCallSheet:ur,deleteCallSheet:dr,isUploading:hr,uploadError:pr}=useCallSheetStore(),mr=reactExports.useRef(null),[fr,xr]=reactExports.useState(null),[Er,vr]=reactExports.useState(null),gr=async jr=>{var Sr;const wr=(Sr=jr.target.files)==null?void 0:Sr[0];if(wr&&wr.type==="application/pdf")try{await ur(wr)}catch(Tr){console.error("Failed to upload call sheet:",Tr)}mr.current&&(mr.current.value="")},yr=(jr,wr)=>{wr.stopPropagation(),cr(jr)},br=jr=>{dr(jr),vr(null)},_r=fr?or.find(jr=>jr.id===fr):null;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Call Sheets"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var jr;return(jr=mr.current)==null?void 0:jr.click()},className:"p-2 text-gold active:opacity-70 transition-opacity touch-manipulation",disabled:hr,children:hr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]})})}),jsxRuntimeExports.jsx("input",{ref:mr,type:"file",accept:".pdf",onChange:gr,className:"hidden"}),jsxRuntimeExports.jsxs("div",{className:"mobile-container px-4 py-4",children:[pr&&jsxRuntimeExports.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600",children:pr})}),or.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(NavIcon,{name:"document",className:"w-8 h-8 text-gray-300"})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Call Sheets"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center mb-6",children:"Upload your daily call sheet PDFs to track scenes and times"}),jsxRuntimeExports.jsx("button",{onClick:()=>{var jr;return(jr=mr.current)==null?void 0:jr.click()},disabled:hr,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:hr?"Uploading...":"Upload Call Sheet PDF"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"space-y-2",children:or.map(jr=>jsxRuntimeExports.jsxs("div",{onClick:()=>xr(jr.id),className:"w-full card flex items-center justify-between active:scale-[0.98] transition-transform cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${jr.id===lr?"bg-gold-100":"bg-gray-100"}`,children:jsxRuntimeExports.jsx(NavIcon,{name:"document",className:`w-5 h-5 ${jr.id===lr?"text-gold":"text-text-light"}`})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsxs("h3",{className:"text-sm font-semibold text-text-primary",children:["Day ",jr.productionDay,jr.totalProductionDays&&` of ${jr.totalProductionDays}`]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[formatShortDate(jr.date),"  ",jr.scenes.length," scene",jr.scenes.length!==1?"s":"",jr.unitCallTime&&`  Call: ${jr.unitCallTime}`]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jr.id===lr?jsxRuntimeExports.jsx("span",{className:"px-2.5 py-1 text-[10px] font-medium rounded-full bg-green-100 text-green-600",children:"Active"}):jsxRuntimeExports.jsx("button",{onClick:wr=>yr(jr.id,wr),className:"px-2.5 py-1 text-[10px] font-medium rounded-full bg-gold-100 text-gold hover:bg-gold-200 transition-colors",children:"Set Active"}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-light",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]})]},jr.id))}),jsxRuntimeExports.jsx("div",{className:"mt-6 text-center",children:jsxRuntimeExports.jsx("button",{onClick:()=>{var jr;return(jr=mr.current)==null?void 0:jr.click()},disabled:hr,className:"px-6 py-2.5 rounded-button gold-gradient text-white text-sm font-medium active:scale-95 transition-transform disabled:opacity-50",children:hr?"Uploading...":"Upload Call Sheet PDF"})})]})]}),_r&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 bg-black/90 flex flex-col",onClick:()=>xr(null),children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 bg-card border-b border-border px-4 py-3 flex items-center justify-between safe-top",onClick:jr=>jr.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-base font-semibold text-text-primary",children:["Day ",_r.productionDay," Call Sheet"]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:formatShortDate(_r.date)})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[Er===_r.id?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>vr(null),className:"px-3 py-1.5 text-xs text-text-muted",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:()=>{br(_r.id),xr(null)},className:"px-3 py-1.5 text-xs bg-red-500 text-white rounded-lg",children:"Delete"})]}):jsxRuntimeExports.jsx("button",{onClick:()=>vr(_r.id),className:"p-2 text-red-400 hover:text-red-500",title:"Delete call sheet",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}),jsxRuntimeExports.jsx("button",{onClick:()=>xr(null),className:"p-2 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-hidden",onClick:jr=>jr.stopPropagation(),children:_r.pdfUri?jsxRuntimeExports.jsx("iframe",{src:_r.pdfUri,className:"w-full h-full border-0",title:`Day ${_r.productionDay} Call Sheet`}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"PDF Not Available"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"The original PDF for this call sheet was not saved."}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500",children:["Day ",_r.productionDay,"  ",_r.scenes.length," scenes  Unit call ",_r.unitCallTime]})]})})]})]})}function ArchivedProjectsScreen({onBack:ar}){const{getArchivedProjects:or,loadArchivedProject:lr}=useProjectStore(),cr=or();return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:ar,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors touch-manipulation",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Archived Projects"})]})})}),jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-4",children:cr.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})})}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1",children:"No Archived Projects"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-text-muted",children:["Wrapped projects will appear here after ",PROJECT_RETENTION_DAYS," days."]})]}):jsxRuntimeExports.jsx("div",{className:"space-y-3",children:cr.map(ur=>jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary",children:ur.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[ur.scenesCount," scenes  ",ur.charactersCount," characters  ",ur.photosCount," photos"]})]}),jsxRuntimeExports.jsx("span",{className:`px-2 py-1 text-[10px] font-medium rounded-full ${ur.state==="wrapped"?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600"}`,children:ur.state==="wrapped"?"Wrapped":"Archived"})]}),ur.wrappedAt&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-light mb-3",children:["Wrapped ",formatShortDate(new Date(ur.wrappedAt).toISOString().split("T")[0]),ur.daysUntilDeletion>0&&`  ${ur.daysUntilDeletion} days until deletion`]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>lr(ur.id),className:"flex-1 px-3 py-2 text-sm font-medium rounded-button bg-gold/10 text-gold active:scale-[0.98] transition-transform",children:"Restore Project"}),jsxRuntimeExports.jsx("button",{className:"px-3 py-2 text-sm font-medium rounded-button bg-gray-100 text-text-secondary active:scale-[0.98] transition-transform",children:"Export"})]})]},ur.id))})})]})}function WrapPopupModal({onExport:ar}){const{currentProject:or,showWrapPopup:lr,wrapTriggerReason:cr,lifecycle:ur,wrapProject:dr,dismissWrapPopup:hr}=useProjectStore();if(!lr||!or)return null;const pr=()=>{if(ur.state==="wrapped"&&ur.deletionDate)return new Date(ur.deletionDate).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});const Er=new Date;return Er.setDate(Er.getDate()+PROJECT_RETENTION_DAYS),Er.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})},mr=()=>{switch(cr){case"all_scenes_complete":return`All scenes for "${or.name}" are marked complete.`;case"inactivity":return`"${or.name}" has been inactive for 30 days.`;case"manual":return`"${or.name}" has been marked as wrapped.`;default:return`"${or.name}" is ready to be wrapped.`}},fr=()=>{ur.state==="active"&&cr&&dr(cr),ar()},xr=()=>{ur.state==="active"&&cr&&dr(cr),hr(!0)};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"pt-8 pb-4 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.875 1.875 0 0118 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0118 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 016 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-text-primary mb-1",children:"That's a Wrap!"})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-6",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary text-center mb-4",children:mr()}),jsxRuntimeExports.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-amber-800",children:["Your project will be stored for ",PROJECT_RETENTION_DAYS," days in case of pickups, then automatically deleted."]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-900 font-medium mt-2",children:"Export your continuity documents now to keep a permanent backup."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:fr,className:"w-full py-3.5 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Export Documents"]}),jsxRuntimeExports.jsx("button",{onClick:xr,className:"w-full py-3 rounded-button bg-gray-100 text-text-secondary font-medium text-base active:scale-[0.98] transition-transform",children:"Remind Me Later"})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-light text-center mt-4",children:["Project deletion: ",pr()]})]})]})})}function LifecycleBanner({onExport:ar}){const{lifecycle:or,getLifecycleBanner:lr,restoreProject:cr}=useProjectStore(),ur=lr();if(!(ur!=null&&ur.show))return null;const dr=or.state==="wrapped",hr=or.state==="archived";return jsxRuntimeExports.jsx("div",{className:`${hr?"bg-red-50 border-b border-red-200":"bg-amber-50 border-b border-amber-200"}`,children:jsxRuntimeExports.jsx("div",{className:"mobile-container px-4 py-2",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[hr?jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-red-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}):jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-amber-600 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsx("span",{className:`text-xs font-medium truncate ${hr?"text-red-800":"text-amber-800"}`,children:ur.message})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[dr&&jsxRuntimeExports.jsx("button",{onClick:cr,className:"text-xs font-medium text-amber-700 hover:text-amber-900",children:"Restore"}),jsxRuntimeExports.jsx("button",{onClick:ar,className:`px-2 py-1 text-[10px] font-semibold rounded ${hr?"bg-red-600 text-white":"bg-amber-600 text-white"}`,children:"Export"})]})]})})})}function Home({onProjectReady:ar,onBack:or}){const[lr,cr]=reactExports.useState("upload"),[ur,dr]=reactExports.useState(""),[hr,pr]=reactExports.useState(null),[mr,fr]=reactExports.useState(null),[,xr]=reactExports.useState(null),[Er,vr]=reactExports.useState(0),[gr,yr]=reactExports.useState("Reading document..."),[br,_r]=reactExports.useState(null),[jr,wr]=reactExports.useState(new Set),[Sr,Tr]=reactExports.useState(new Map),Rr=reactExports.useRef(null),Nr=reactExports.useRef(null),{setProject:Cr,setScriptPdf:kr,currentProject:Ar}=useProjectStore(),{setSchedule:Or}=useScheduleStore(),Lr=reactExports.useCallback(async(es,Ir)=>{var Dr;try{vr(10),yr("Reading script..."),await new Promise(ns=>setTimeout(ns,200));let Pr=null;if(Ir){vr(15),yr("Processing schedule...");try{Pr=(await parseScheduleStage1(Ir)).schedule,xr(Pr),Or(Pr),console.log(`Schedule parsed: ${Pr.castList.length} cast members identified`),Pr.castList.length===0?console.warn("Schedule uploaded but no cast members extracted - character detection will use script regex fallback"):console.log("Cast list:",Pr.castList.map(fs=>`${fs.number}.${fs.name}`).join(", "))}catch(ns){console.warn("Schedule parsing failed, continuing without:",ns)}}vr(30),yr("Detecting scenes...");const Mr=await parseScenesFast(es);vr(70),yr("Creating project..."),await new Promise(ns=>setTimeout(ns,100));const Br=Mr.scenes.map(ns=>({id:v4(),sceneNumber:ns.sceneNumber,slugline:ns.slugline,intExt:ns.intExt,timeOfDay:ns.timeOfDay,scriptContent:ns.scriptContent,characters:[],isComplete:!1,characterConfirmationStatus:"pending",suggestedCharacters:void 0,shootingDay:void 0})),Xr=(Ar==null?void 0:Ar.id)||v4(),Wr=ur||(Ar==null?void 0:Ar.name)||Mr.title||es.name.replace(/\.[^/.]+$/,"").replace(/[-_]/g," ")||"Untitled Project",ss={id:Xr,name:Wr,createdAt:(Ar==null?void 0:Ar.createdAt)||new Date,updatedAt:new Date,scenes:Br,characters:(Ar==null?void 0:Ar.characters)||[],looks:(Ar==null?void 0:Ar.looks)||[],characterDetectionStatus:"idle",scenesConfirmed:0};if(vr(90),yr("Almost done..."),await new Promise(ns=>setTimeout(ns,200)),vr(100),yr("Complete!"),ss._rawText=Mr.rawText,Pr&&(ss._scheduleCastList=Pr.castList),Cr(ss),es.type==="application/pdf"){const ns=new FileReader;ns.onload=()=>{const fs=ns.result;kr(fs)},ns.readAsDataURL(es)}const ds=((Dr=Pr==null?void 0:Pr.castList)==null?void 0:Dr.map(ns=>ns.name))||[];setTimeout(()=>{Fr(ss,Mr.rawText,ds)},500),setTimeout(()=>ar(),500)}catch(Pr){console.error("Script parsing error:",Pr),alert(Pr instanceof Error?Pr.message:"Failed to parse script"),cr("upload")}},[ur,Cr,kr,Or,ar,Ar]),Fr=reactExports.useCallback(async(es,Ir,Dr=[])=>{var Pr;try{useProjectStore.getState().startCharacterDetection();const Mr=es.scenes.map(ss=>({sceneNumber:ss.sceneNumber,scriptContent:ss.scriptContent||""}));console.log(`Starting character detection for ${Mr.length} scenes`),Dr.length>0&&console.log(`Using ${Dr.length} known characters from schedule:`,Dr);const Br=await detectCharactersForScenesBatch(Mr,Ir,{useAI:!1,knownCharacters:Dr.length>0?Dr:void 0,onProgress:(ss,ds)=>{console.log(`Character detection: ${ss}/${ds}`)}}),Xr=useProjectStore.getState(),Wr=((Pr=Xr.currentProject)==null?void 0:Pr.scenes)||es.scenes;Br.forEach((ss,ds)=>{const ns=Wr.find(fs=>fs.sceneNumber===ds);ns&&Xr.updateSceneSuggestedCharacters(ns.id,ss)}),Xr.setCharacterDetectionStatus("complete")}catch(Mr){console.error("Background character detection failed:",Mr),useProjectStore.getState().setCharacterDetectionStatus("complete")}},[]),Hr=reactExports.useCallback(async(es,Ir)=>Lr(es,Ir),[Lr]),Kr=es=>{var Dr;const Ir=(Dr=es.target.files)==null?void 0:Dr[0];if(Ir){pr(Ir);const Pr=Ir.name.replace(/\.[^/.]+$/,"").replace(/[-_]/g," ");dr(Pr)}},Gr=es=>{var Dr;const Ir=(Dr=es.target.files)==null?void 0:Dr[0];Ir&&fr(Ir)},Zr=()=>{hr&&(cr("processing"),Hr(hr,mr))},Jr=()=>{if(!br){const Wr={id:v4(),name:ur||"Untitled Project",createdAt:new Date,updatedAt:new Date,scenes:[],characters:[],looks:[]};Cr(Wr),ar();return}const es=Array.from(jr).filter(Wr=>!Sr.has(Wr)),{scenes:Ir,characters:Dr}=convertParsedScriptToProject(br,es),Pr=Dr.map(Wr=>({id:v4(),characterId:Wr.id,name:"Look 1",scenes:Ir.filter(ss=>ss.characters.includes(Wr.id)).map(ss=>ss.sceneNumber),estimatedTime:30,makeup:createEmptyMakeupDetails(),hair:createEmptyHairDetails()})),Mr=(Ar==null?void 0:Ar.id)||`project-${Date.now()}`,Br=ur||(Ar==null?void 0:Ar.name)||br.title||"Untitled Project",Xr={id:Mr,name:Br,createdAt:(Ar==null?void 0:Ar.createdAt)||new Date,updatedAt:new Date,scenes:Ir,characters:Dr,looks:Pr};Cr(Xr),ar()},os=()=>{_r(null),wr(new Set),cr("setup")},Ur=es=>{wr(Ir=>{const Dr=new Set(Ir);return Dr.has(es)?Dr.delete(es):Dr.add(es),Dr})},Vr=(es,Ir)=>{Tr(Dr=>{const Pr=new Map(Dr);return es===Ir?Pr.delete(es):Pr.set(es,Ir),Pr}),wr(Dr=>{const Pr=new Set(Dr);return Pr.add(Ir),Pr})};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background safe-top safe-bottom",children:[lr==="upload"&&jsxRuntimeExports.jsx(UploadScreen,{fileInputRef:Rr,scheduleInputRef:Nr,uploadedFile:hr,uploadedScheduleFile:mr,onBack:or,onSkip:os,onStartWithFiles:Zr}),lr==="processing"&&jsxRuntimeExports.jsx(ProcessingScreen,{fileName:(hr==null?void 0:hr.name)||"",progress:Er,status:gr}),lr==="characters"&&br&&jsxRuntimeExports.jsx(CharacterSelectionScreen,{parsedScript:br,selectedCharacters:jr,mergeMap:Sr,onToggleCharacter:Ur,onMergeCharacter:Vr,onContinue:()=>cr("setup"),onBack:()=>cr("upload")}),lr==="setup"&&jsxRuntimeExports.jsx(SetupScreen,{projectName:ur,onNameChange:dr,detectedScenes:(br==null?void 0:br.scenes.length)||0,detectedCharacters:Array.from(jr).filter(es=>!Sr.has(es)),onStart:Jr,onBack:()=>cr(br?"characters":"upload")}),jsxRuntimeExports.jsx("input",{ref:Rr,type:"file",accept:".pdf,.fdx,.fountain,.txt",onChange:Kr,className:"hidden"}),jsxRuntimeExports.jsx("input",{ref:Nr,type:"file",accept:".pdf",onChange:Gr,className:"hidden"})]})}function UploadScreen({fileInputRef:ar,scheduleInputRef:or,uploadedFile:lr,uploadedScheduleFile:cr,onBack:ur,onSkip:dr,onStartWithFiles:hr}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 flex items-center gap-3 border-b border-border",children:[ur&&jsxRuntimeExports.jsx("button",{onClick:ur,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Upload Files"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Script"}),jsxRuntimeExports.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gold/10 text-gold",children:"Required"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var pr;return(pr=ar.current)==null?void 0:pr.click()},className:`w-full rounded-2xl border-2 border-dashed transition-colors p-6 ${lr?"border-green-400 bg-green-50":"border-gold/40 bg-gold/5 active:bg-gold/10"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${lr?"bg-green-100":"bg-gold/10"}`,children:lr?jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 text-left",children:lr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-green-700 truncate",children:lr.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600",children:"Tap to change"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary",children:"Tap to upload script"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"PDF, Final Draft, or Fountain"})]})})]})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Production Schedule"}),jsxRuntimeExports.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-100 text-text-muted",children:"Optional"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{var pr;return(pr=or.current)==null?void 0:pr.click()},className:`w-full rounded-2xl border-2 border-dashed transition-colors p-6 ${cr?"border-green-400 bg-green-50":"border-gray-300 bg-gray-50 active:bg-gray-100"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${cr?"bg-green-100":"bg-gray-100"}`,children:cr?jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 text-left",children:cr?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-green-700 truncate",children:cr.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600",children:"Tap to change"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-secondary",children:"Tap to upload schedule"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"PDF (strips, one-liner)"})]})})]})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light mt-2 px-2",children:"Uploading a schedule gives you accurate character assignments per scene and shooting day info"})]}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-blue-50 border border-blue-100 p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-blue-700",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Faster with Schedule"}),jsxRuntimeExports.jsx("p",{children:"The schedule contains the official cast list with character numbers. This allows instant, accurate character detection per scene without AI processing."})]})]})}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-text-secondary",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Background Processing"}),jsxRuntimeExports.jsx("p",{children:"The schedule will process automatically in the background. Character assignments will be confirmed within a few minutes - you can start using the app right away."})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-8 pt-4 border-t border-border space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:hr,disabled:!lr,className:"w-full py-4 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50 disabled:active:scale-100",children:lr?"Start Processing":"Upload a script to continue"}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"py-3 text-sm text-text-muted font-medium active:text-gold transition-colors",children:"Skip - add manually"})]})]})}function ProcessingScreen({fileName:ar,progress:or,status:lr}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen items-center justify-center px-6",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-gold/10 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx("svg",{className:"w-10 h-10 text-gold animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-text-primary mb-2",children:"Processing Script"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-6 truncate max-w-full",children:ar}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-xs",children:[jsxRuntimeExports.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden mb-2",children:jsxRuntimeExports.jsx("div",{className:"h-full bg-gold rounded-full transition-all duration-300",style:{width:`${or}%`}})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light text-center mb-4",children:lr}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted text-center leading-relaxed",children:"Detecting scenes in your script. You'll be able to confirm characters scene-by-scene."})]})]})}function CharacterSelectionScreen({parsedScript:ar,selectedCharacters:or,mergeMap:lr,onToggleCharacter:cr,onMergeCharacter:ur,onContinue:dr,onBack:hr}){const[pr,mr]=reactExports.useState(!1),[fr,xr]=reactExports.useState(null),Er=[...ar.characters].sort((gr,yr)=>yr.sceneCount-gr.sceneCount),vr=gr=>{xr(gr),mr(!0)};return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 flex items-center gap-3 border-b border-border",children:[jsxRuntimeExports.jsx("button",{onClick:hr,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Select Characters"})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-4 bg-gold/5 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-around text-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gold",children:ar.scenes.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Scenes"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gold",children:ar.characters.length}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Characters Found"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-gold",children:or.size-lr.size}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Selected"})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-6 py-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted",children:"Select the characters you want to track. Tap the merge icon to combine similar characters."})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:Er.map(gr=>{const yr=or.has(gr.name),br=lr.get(gr.name),_r=!!br;return jsxRuntimeExports.jsx("div",{className:`rounded-xl border transition-all ${_r?"border-gray-200 bg-gray-50 opacity-60":yr?"border-gold bg-gold/5":"border-border bg-card"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 p-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>!_r&&cr(gr.name),disabled:_r,className:`w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all ${_r?"border-gray-300 bg-gray-200":yr?"border-gold bg-gold":"border-gray-300"}`,children:(yr||_r)&&jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:`font-medium truncate ${_r?"text-text-muted line-through":"text-text-primary"}`,children:gr.name}),_r&&jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted",children:[" ",br]})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[gr.sceneCount," scene",gr.sceneCount!==1?"s":"",gr.variants.length>1&&`  ${gr.variants.length} variants`]})]}),!_r&&jsxRuntimeExports.jsx("button",{onClick:()=>vr(gr.name),className:"p-2 text-text-muted hover:text-gold transition-colors",title:"Merge with another character",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 16.875h3.375m0 0h3.375m-3.375 0V13.5m0 3.375v3.375M6 10.5h2.25a2.25 2.25 0 002.25-2.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v2.25A2.25 2.25 0 006 10.5zm0 9.75h2.25A2.25 2.25 0 0010.5 18v-2.25a2.25 2.25 0 00-2.25-2.25H6a2.25 2.25 0 00-2.25 2.25V18A2.25 2.25 0 006 20.25zm9.75-9.75H18a2.25 2.25 0 002.25-2.25V6A2.25 2.25 0 0018 3.75h-2.25A2.25 2.25 0 0013.5 6v2.25a2.25 2.25 0 002.25 2.25z"})})})]})},gr.name)})})}),jsxRuntimeExports.jsx("div",{className:"px-6 pb-8 pt-4 border-t border-border",children:jsxRuntimeExports.jsxs("button",{onClick:dr,disabled:or.size-lr.size===0,className:"w-full py-4 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50",children:["Continue with ",or.size-lr.size," Character",or.size-lr.size!==1?"s":""]})}),pr&&fr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"bg-card w-full max-w-lg rounded-t-3xl max-h-[70vh] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"px-6 py-4 border-b border-border flex items-center justify-between",children:[jsxRuntimeExports.jsxs("h3",{className:"text-lg font-semibold text-text-primary",children:['Merge "',fr,'" into...']}),jsxRuntimeExports.jsx("button",{onClick:()=>mr(!1),className:"p-2 text-text-muted",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[lr.has(fr)&&jsxRuntimeExports.jsxs("button",{onClick:()=>{ur(fr,fr),mr(!1)},className:"w-full p-3 text-left rounded-lg border border-red-200 bg-red-50 text-red-700",children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Remove merge"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-red-500 block",children:"Keep as separate character"})]}),Er.filter(gr=>gr.name!==fr&&!lr.has(gr.name)).map(gr=>jsxRuntimeExports.jsxs("button",{onClick:()=>{ur(fr,gr.name),mr(!1)},className:"w-full p-3 text-left rounded-lg border border-border bg-card hover:border-gold transition-colors",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-text-primary",children:gr.name}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-text-muted block",children:[gr.sceneCount," scenes"]})]},gr.name))]})})]})})]})}function SetupScreen({projectName:ar,onNameChange:or,detectedScenes:lr,detectedCharacters:cr,onStart:ur,onBack:dr}){return jsxRuntimeExports.jsxs("div",{className:"flex flex-col min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-3 flex items-center gap-3 border-b border-border",children:[jsxRuntimeExports.jsx("button",{onClick:dr,className:"p-2 -ml-2 text-text-muted active:text-gold transition-colors",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"Project Setup"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 py-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Project Name"}),jsxRuntimeExports.jsx("input",{type:"text",value:ar,onChange:hr=>or(hr.target.value),placeholder:"Enter project name",className:"input-field w-full text-base"})]}),(lr>0||cr.length>0)&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"section-header",children:"DETECTED FROM SCRIPT"}),lr>0&&jsxRuntimeExports.jsxs("div",{className:"card flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.875 1.875 0 0118 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0118 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 016 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Scenes"})]}),jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-gold",children:lr})]}),cr.length>0&&jsxRuntimeExports.jsxs("div",{className:"card",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-lg bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})})}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Characters"}),jsxRuntimeExports.jsx("span",{className:"ml-auto text-lg font-bold text-gold",children:cr.length})]}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2",children:cr.map(hr=>jsxRuntimeExports.jsx("span",{className:"px-3 py-1 text-xs font-medium rounded-full bg-gray-100 text-text-secondary",children:hr},hr))})]})]}),lr===0&&cr.length===0&&jsxRuntimeExports.jsxs("div",{className:"card text-center py-8",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-2",children:"No script uploaded"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-light",children:"You can add scenes and characters manually after setup"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 pb-8",children:jsxRuntimeExports.jsx("button",{onClick:ur,disabled:!ar.trim(),className:"w-full py-4 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform disabled:opacity-50 disabled:active:scale-100",children:"Start Project"})})]})}function ok(ar){return{success:!0,data:ar}}function fail(ar){return{success:!1,data:null,error:ar}}function normScene(ar){return ar.toString().trim().toUpperCase()}function matchCharName(ar,or){return ar.toLowerCase().includes(or.toLowerCase())}function getProject(){return useProjectStore.getState().currentProject}function flagsToStrings(ar){const or=[];return ar.sweat&&or.push("sweat"),ar.blood&&or.push("blood"),ar.dirt&&or.push("dirt"),ar.tears&&or.push("tears"),ar.wetHair&&or.push("wet hair"),ar.dishevelled&&or.push("dishevelled"),or}function photoCount(ar){var lr;let or=0;return ar.photos.front&&or++,ar.photos.left&&or++,ar.photos.right&&or++,ar.photos.back&&or++,or+=((lr=ar.additionalPhotos)==null?void 0:lr.length)??0,or}function captureToData(ar,or,lr){return{sceneNumber:or,characterName:lr,flags:flagsToStrings(ar.continuityFlags),hairNotes:"",makeupNotes:"",generalNotes:ar.notes||"",photoCount:photoCount(ar),capturedAt:ar.capturedAt?new Date(ar.capturedAt).toISOString():""}}function getSceneList(){const ar=getProject();return ar?ok(ar.scenes):fail("No project loaded")}function getCharacterList(){const ar=getProject();return ar?ok(ar.characters):fail("No project loaded")}function getCharacterScenes(ar){const or=getProject();if(!or)return fail("No project loaded");const lr=or.characters.find(ur=>matchCharName(ur.name,ar));if(!lr)return fail(`Character "${ar}" not found`);const cr=or.scenes.filter(ur=>ur.characters.includes(lr.id));return ok(cr)}function getContinuityCapture(ar,or){const lr=getProject();if(!lr)return fail("No project loaded");const cr=lr.characters.find(fr=>matchCharName(fr.name,ar));if(!cr)return fail(`Character "${ar}" not found`);const ur=normScene(or),dr=lr.scenes.find(fr=>normScene(fr.sceneNumber)===ur);if(!dr)return fail(`Scene ${or} not found`);const hr=useProjectStore.getState().sceneCaptures,pr=`${dr.id}-${cr.id}`,mr=hr[pr];return mr?ok(captureToData(mr,or,cr.name)):fail(`No capture for ${ar} in scene ${or}`)}function getCharacterCaptures(ar){const or=getProject();if(!or)return fail("No project loaded");const lr=or.characters.find(dr=>matchCharName(dr.name,ar));if(!lr)return fail(`Character "${ar}" not found`);const cr=useProjectStore.getState().sceneCaptures,ur=[];for(const dr of Object.values(cr))if(dr.characterId===lr.id){const hr=or.scenes.find(pr=>pr.id===dr.sceneId);ur.push(captureToData(dr,(hr==null?void 0:hr.sceneNumber)??"?",lr.name))}return ok(ur)}function getSceneCaptures(ar){const or=getProject();if(!or)return fail("No project loaded");const lr=normScene(ar),cr=or.scenes.find(hr=>normScene(hr.sceneNumber)===lr);if(!cr)return fail(`Scene ${ar} not found`);const ur=useProjectStore.getState().sceneCaptures,dr=[];for(const hr of Object.values(ur))if(hr.sceneId===cr.id){const pr=or.characters.find(mr=>mr.id===hr.characterId);dr.push(captureToData(hr,ar,(pr==null?void 0:pr.name)??"?"))}return ok(dr)}function getCaptureProgress(){const ar=getProject();if(!ar)return fail("No project loaded");let or=0;for(const cr of ar.scenes)or+=cr.characters.length;const lr=Object.keys(useProjectStore.getState().sceneCaptures).length;return ok({total:or,captured:lr,pending:Math.max(0,or-lr)})}function getCharacterLooks(ar){const or=getProject();if(!or)return fail("No project loaded");const lr=or.characters.find(ur=>matchCharName(ur.name,ar));if(!lr)return fail(`Character "${ar}" not found`);const cr=or.looks.filter(ur=>ur.characterId===lr.id);return ok(cr)}function formatScheduleDay(ar){return{dayNumber:ar.dayNumber,date:ar.date??"",scenes:ar.scenes.map(or=>or.sceneNumber),location:ar.location,hours:ar.hours??"",dayType:ar.dayType??"",notes:ar.notes??[]}}function getScheduleOverview(){const ar=useScheduleStore.getState().schedule;return ar?ok({totalDays:ar.totalDays,days:ar.days.map(formatScheduleDay)}):fail("No schedule uploaded")}function getShootingDay(ar){const or=useScheduleStore.getState().schedule;if(!or)return fail("No schedule uploaded");const lr=or.days.find(cr=>cr.dayNumber===ar);return lr?ok(formatScheduleDay(lr)):fail(`Day ${ar} not in schedule`)}function getShootingDayByDate(ar){const or=useScheduleStore.getState().schedule;if(!or)return fail("No schedule uploaded");const lr=or.days.find(cr=>cr.date===ar);return lr?ok(formatScheduleDay(lr)):fail(`No shooting day on ${ar}`)}function getTodaysSchedule(){const ar=new Date().toISOString().split("T")[0];return getShootingDayByDate(ar)}function getSceneShootingDay(ar){const or=useScheduleStore.getState().schedule;if(!or)return fail("No schedule uploaded");const lr=normScene(ar),cr=or.days.find(ur=>ur.scenes.some(dr=>normScene(dr.sceneNumber)===lr));return cr?ok(formatScheduleDay(cr)):fail(`Scene ${ar} not in schedule`)}function formatCallSheet(ar){return{date:ar.date,productionDay:ar.productionDay,unitCallTime:ar.unitCallTime,wrapEstimate:ar.wrapEstimate??"",sceneCount:ar.scenes.length,scenes:ar.scenes.map(or=>or.sceneNumber),castCalls:(ar.castCalls??[]).map(or=>({name:or.name,character:or.character,callTime:or.callTime})),weather:ar.weather?`${ar.weather.conditions??""} ${ar.weather.tempHigh??""}/${ar.weather.tempLow??""}`.trim():"",notes:ar.unitNotes??[]}}function getCallSheet(ar){const lr=useCallSheetStore.getState().getCallSheetByDate(ar);return lr?ok(formatCallSheet(lr)):fail(`No call sheet for ${ar}`)}function getTodaysCallSheet(){const ar=new Date().toISOString().split("T")[0];return getCallSheet(ar)}function getTimesheetSummary(){const ar=useTimesheetStore.getState(),or=Object.values(ar.entries);if(or.length===0)return ok({totalDays:0,totalHours:0,overtimeHours:0,totalEarnings:0});let lr=0,cr=0,ur=0;const dr=[...or].sort((hr,pr)=>hr.date.localeCompare(pr.date));return dr.forEach((hr,pr)=>{const mr=pr>0?dr[pr-1].wrapOut:void 0,fr=ar.calculateEntry(hr,mr);lr+=fr.totalHours,cr+=fr.otHours,ur+=fr.totalEarnings}),ok({totalDays:or.length,totalHours:Math.round(lr*10)/10,overtimeHours:Math.round(cr*10)/10,totalEarnings:Math.round(ur*100)/100})}function getDayTimesheet(ar){const or=useTimesheetStore.getState(),lr=or.entries[ar];if(!lr)return fail(`No timesheet entry for ${ar}`);const cr=or.getPreviousWrapOut(ar),ur=or.calculateEntry(lr,cr);return ok({entry:lr,hours:Math.round(ur.totalHours*10)/10,earnings:Math.round(ur.totalEarnings*100)/100})}function getBudgetSummary(){const ar=useBudgetStore.getState(),or=ar.getTotalSpent();return ok({total:ar.budgetTotal,spent:or,remaining:ar.budgetTotal-or,currency:ar.currency,receiptCount:ar.receipts.length})}function getReceipts(ar){let lr=useBudgetStore.getState().receipts;return ar&&(lr=lr.filter(cr=>cr.category.toLowerCase()===ar.toLowerCase())),ok(lr.map(cr=>({id:cr.id,date:cr.date,vendor:cr.vendor,amount:cr.amount,category:cr.category,description:cr.description})))}function getTeamMembers(){const ar=useProjectSettingsStore.getState();return ar.teamMembers.length?ok(ar.teamMembers.map(or=>({name:or.name,role:or.role,isOwner:or.isOwner}))):fail("No team data loaded")}function getProjectInfo(){const ar=getProject();return ar?ok({name:ar.name,type:"production",status:"active",sceneCount:ar.scenes.length,characterCount:ar.characters.length,lookCount:ar.looks.length,completedScenes:ar.scenes.filter(or=>or.isComplete).length}):fail("No project loaded")}function getKnownCharacters(){const ar=getCharacterList();return ar.success&&ar.data?ar.data.map(or=>or.name.toLowerCase()):[]}function getKnownSceneNumbers(){const ar=getSceneList();return ar.success&&ar.data?ar.data.map(or=>or.sceneNumber.toLowerCase()):[]}function extractSceneNumber(ar){const or=ar.match(/(?:scene|sc\.?|#)\s*(\d+[a-z]?\b)/i);if(or)return or[1].toUpperCase();const lr=getKnownSceneNumbers();for(const cr of lr)if(new RegExp(`\\b${cr}\\b`,"i").test(ar))return cr.toUpperCase()}function extractCharacterName(ar){var ur;const or=ar.toLowerCase(),cr=[...getKnownCharacters()].sort((dr,hr)=>hr.length-dr.length);for(const dr of cr)if(or.includes(dr)){const pr=(ur=getCharacterList().data)==null?void 0:ur.find(mr=>mr.name.toLowerCase()===dr);return(pr==null?void 0:pr.name)??dr}}function extractDayNumber(ar){const or=ar.match(/\bday\s*(\d+)\b/i);return or?parseInt(or[1],10):void 0}function extractDate(ar){const or=ar.match(/\b(\d{4}-\d{2}-\d{2})\b/);if(or)return or[1];const lr=ar.toLowerCase(),cr=new Date;if(lr.includes("today"))return cr.toISOString().split("T")[0];if(lr.includes("yesterday"))return cr.setDate(cr.getDate()-1),cr.toISOString().split("T")[0];if(lr.includes("tomorrow"))return cr.setDate(cr.getDate()+1),cr.toISOString().split("T")[0];const ur=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(let dr=0;dr<ur.length;dr++)if(lr.includes(ur[dr])){const hr=new Date,pr=(hr.getDay()-dr+7)%7||7;return hr.setDate(hr.getDate()-pr),hr.toISOString().split("T")[0]}}function extractCategory(ar){const or=["kit supplies","consumables","transportation","equipment"],lr=ar.toLowerCase();return or.find(cr=>lr.includes(cr))}const INTENT_PATTERNS=[{intent:"schedule_today",patterns:[/what(?:'s| is) filming today/i,/today(?:'s)? schedule/i,/what(?:'s| are)? (?:we )?shoot(?:ing)? today/i,/what(?:'s| is) on today/i]},{intent:"callsheet_today",patterns:[/today(?:'s)? call\s?sheet/i,/call\s?sheet/i,/show (?:me )?(?:the )?call\s?sheet/i]},{intent:"schedule_scene",patterns:[/when (?:do|are) we shoot(?:ing)? scene/i,/when is scene/i,/what day (?:is|do we shoot) scene/i,/scene.*(?:shooting|schedule|when)/i]},{intent:"schedule_day",patterns:[/what(?:'s| is) (?:on|filming|shooting) (?:on )?day\s?\d/i,/day\s?\d+.*schedule/i,/what(?:'s| is) (?:on|filming|shooting) (?:on )?\w+day/i]},{intent:"continuity_capture",patterns:[/continuity (?:for|of)\s/i,/what was captured for/i,/capture(?:d|s)? for/i]},{intent:"continuity_character",patterns:[/(?:all )?captures? for/i,/continuity (?:notes?|history|so far)/i]},{intent:"continuity_scene",patterns:[/scene.*captures?/i,/what(?:'s| was) captured (?:in|for) scene/i]},{intent:"capture_progress",patterns:[/capture progress/i,/how (?:much|many) (?:is|have been) captured/i,/continuity progress/i]},{intent:"character_scenes",patterns:[/what scenes (?:is|does|are)/i,/scenes? for/i,/which scenes/i]},{intent:"character_looks",patterns:[/looks? (?:for|does|of)/i,/what looks/i,/(?:need|require).*(?:makeup|hair|sfx)/i,/special (?:makeup|hair)/i,/does.*need.*(?:makeup|hair)/i]},{intent:"character_list",patterns:[/(?:list|all|show) (?:the )?characters/i,/who(?:'s| is) in (?:the|this) (?:project|production)/i]},{intent:"scene_list",patterns:[/(?:list|all|show|how many) (?:the )?scenes/i]},{intent:"timesheet_day",patterns:[/what time (?:did|do) we (?:start|wrap|call)/i,/timesheet (?:for|on)/i,/hours (?:for|on)/i]},{intent:"timesheet_summary",patterns:[/how many hours/i,/timesheet summary/i,/total (?:hours|earnings)/i,/overtime/i]},{intent:"budget_summary",patterns:[/budget/i,/how much (?:remaining|left|spent)/i,/spend(?:ing)?/i,/float/i]},{intent:"budget_receipts",patterns:[/receipts?/i,/expenses?/i,/recent (?:spend|purchases)/i]},{intent:"team_members",patterns:[/(?:who(?:'s| is)|show) (?:on )?(?:the )?team/i,/team members?/i,/crew/i]},{intent:"project_info",patterns:[/project (?:info|details|summary|overview)/i,/how many (?:scenes|characters)/i]}];function parseUserQuery(ar){const or=extractCharacterName(ar),lr=extractSceneNumber(ar),cr=extractDayNumber(ar),ur=extractDate(ar),dr=extractCategory(ar);for(const{intent:hr,patterns:pr}of INTENT_PATTERNS)if(pr.some(mr=>mr.test(ar))){let mr=hr;return hr==="continuity_capture"&&or&&!lr&&(mr="continuity_character"),hr==="character_scenes"&&!or&&lr&&(mr="continuity_scene"),{intent:mr,parameters:{characterName:or,sceneNumber:lr,dayNumber:cr,date:ur,category:dr}}}return or&&lr?{intent:"continuity_capture",parameters:{characterName:or,sceneNumber:lr}}:or?{intent:"character_looks",parameters:{characterName:or}}:lr?{intent:"continuity_scene",parameters:{sceneNumber:lr}}:{intent:"unknown",parameters:{}}}function executeQuery(ar){const{intent:or,parameters:lr}=ar;switch(or){case"schedule_today":{const ur=getTodaysCallSheet();if(ur.success&&ur.data)return`Today's call sheet (Day ${ur.data.productionDay}, ${ur.data.date}):
Call: ${ur.data.unitCallTime} | Est. wrap: ${ur.data.wrapEstimate}
Scenes: ${ur.data.scenes.join(", ")}
${ur.data.weather?`Weather: ${ur.data.weather}`:""}`.trim();const dr=getTodaysSchedule();return dr.success&&dr.data?`Today's schedule (Day ${dr.data.dayNumber}, ${dr.data.date}):
Scenes: ${dr.data.scenes.join(", ")}
Location: ${dr.data.location}
Hours: ${dr.data.hours}`:"No call sheet or schedule data for today."}case"callsheet_today":{const ur=getTodaysCallSheet();if(!ur.success||!ur.data)return"No call sheet uploaded for today.";const dr=ur.data,hr=[`Call Sheet  Day ${dr.productionDay} (${dr.date})`,`Unit call: ${dr.unitCallTime}`,dr.wrapEstimate?`Est. wrap: ${dr.wrapEstimate}`:"",`Scenes (${dr.sceneCount}): ${dr.scenes.join(", ")}`,dr.weather?`Weather: ${dr.weather}`:""];return dr.castCalls.length>0&&(hr.push("Cast calls:"),dr.castCalls.forEach(pr=>hr.push(`  ${pr.name} (${pr.character})  ${pr.callTime}`))),dr.notes.length>0&&hr.push(`Notes: ${dr.notes.join("; ")}`),hr.filter(Boolean).join(`
`)}case"schedule_scene":{if(!lr.sceneNumber)return"Please specify a scene number.";const ur=getSceneShootingDay(lr.sceneNumber);return!ur.success||!ur.data?ur.error??`Scene ${lr.sceneNumber} not found in schedule.`:`Scene ${lr.sceneNumber}  Day ${ur.data.dayNumber}${ur.data.date?` (${ur.data.date})`:""}, ${ur.data.location}`}case"schedule_day":{if(lr.dayNumber){const ur=getShootingDay(lr.dayNumber);if(!ur.success||!ur.data)return ur.error??`Day ${lr.dayNumber} not in schedule.`;const dr=ur.data;return`Day ${dr.dayNumber}${dr.date?` (${dr.date})`:""}:
Scenes: ${dr.scenes.join(", ")}
Location: ${dr.location}
Hours: ${dr.hours}`}if(lr.date){const ur=getShootingDayByDate(lr.date);if(!ur.success||!ur.data)return ur.error??`No shooting day on ${lr.date}.`;const dr=ur.data;return`Day ${dr.dayNumber} (${dr.date}):
Scenes: ${dr.scenes.join(", ")}
Location: ${dr.location}
Hours: ${dr.hours}`}return"Please specify a day number or date."}case"continuity_capture":{if(!lr.characterName||!lr.sceneNumber)return"Please specify both a character and scene number.";const ur=getContinuityCapture(lr.characterName,lr.sceneNumber);if(!ur.success||!ur.data)return ur.error??"No capture found.";const dr=ur.data;return[`Scene ${dr.sceneNumber}  ${dr.characterName}:`,dr.flags.length?`Flags: ${dr.flags.join(", ")}`:"Flags: none",dr.generalNotes?`Notes: ${dr.generalNotes}`:"Notes: none",`Photos: ${dr.photoCount} captured`].join(`
`)}case"continuity_character":{if(!lr.characterName)return"Please specify a character name.";const ur=getCharacterCaptures(lr.characterName);if(!ur.success||!ur.data)return ur.error??"No captures found.";if(ur.data.length===0)return`No continuity captured for ${lr.characterName} yet.`;const dr=[`${lr.characterName}  ${ur.data.length} capture(s):`];return ur.data.forEach(hr=>{const pr=hr.flags.length?` [${hr.flags.join(", ")}]`:"";dr.push(`  Sc ${hr.sceneNumber}: ${hr.photoCount} photos${pr}`)}),dr.join(`
`)}case"continuity_scene":{if(!lr.sceneNumber)return"Please specify a scene number.";const ur=getSceneCaptures(lr.sceneNumber);if(!ur.success||!ur.data)return ur.error??"No captures found.";if(ur.data.length===0)return`No continuity captured for scene ${lr.sceneNumber} yet.`;const dr=[`Scene ${lr.sceneNumber}  ${ur.data.length} capture(s):`];return ur.data.forEach(hr=>{const pr=hr.flags.length?` [${hr.flags.join(", ")}]`:"";dr.push(`  ${hr.characterName}: ${hr.photoCount} photos${pr}`)}),dr.join(`
`)}case"capture_progress":{const ur=getCaptureProgress();if(!ur.success||!ur.data)return ur.error??"Cannot calculate progress.";const dr=ur.data.total>0?Math.round(ur.data.captured/ur.data.total*100):0;return`Capture progress: ${ur.data.captured}/${ur.data.total} (${dr}%)  ${ur.data.pending} remaining`}case"character_scenes":{if(!lr.characterName)return"Please specify a character name.";const ur=getCharacterScenes(lr.characterName);return!ur.success||!ur.data?ur.error??"Character not found.":`${lr.characterName} appears in ${ur.data.length} scene(s): ${ur.data.map(dr=>dr.sceneNumber).join(", ")}`}case"character_looks":{if(!lr.characterName)return"Please specify a character name.";const ur=getCharacterLooks(lr.characterName);if(!ur.success||!ur.data)return ur.error??"Character not found.";if(ur.data.length===0)return`No looks defined for ${lr.characterName}.`;const dr=[`${lr.characterName}  ${ur.data.length} look(s):`];return ur.data.forEach(hr=>{var fr;const pr=hr.scenes.length>0?` (scenes: ${hr.scenes.join(", ")})`:"",mr=(fr=hr.sfxDetails)!=null&&fr.sfxRequired?" [SFX]":"";dr.push(`  "${hr.name}"  ${hr.estimatedTime}min${mr}${pr}`)}),dr.join(`
`)}case"character_list":{const ur=getCharacterList();return!ur.success||!ur.data?ur.error??"No characters.":`${ur.data.length} character(s): ${ur.data.map(dr=>dr.name).join(", ")}`}case"scene_list":{const ur=getSceneList();if(!ur.success||!ur.data)return ur.error??"No scenes.";const dr=ur.data.filter(hr=>hr.isComplete).length;return`${ur.data.length} scene(s) (${dr} complete). Numbers: ${ur.data.map(hr=>hr.sceneNumber).join(", ")}`}case"timesheet_day":{const ur=lr.date||new Date().toISOString().split("T")[0],dr=getDayTimesheet(ur);if(!dr.success||!dr.data)return dr.error??`No timesheet for ${ur}.`;const hr=dr.data.entry;return`Timesheet ${ur}:
Pre-call: ${hr.preCall||""} | Unit call: ${hr.unitCall||""} | Wrap: ${hr.wrapOut||""}
Hours: ${dr.data.hours}h | Earnings: ${dr.data.earnings}`}case"timesheet_summary":{const ur=getTimesheetSummary();if(!ur.success||!ur.data)return ur.error??"No timesheet data.";const dr=ur.data;return`Timesheet summary:
${dr.totalDays} day(s) logged | ${dr.totalHours}h total | ${dr.overtimeHours}h overtime
Total earnings: ${dr.totalEarnings}`}case"budget_summary":{const ur=getBudgetSummary();if(!ur.success||!ur.data)return ur.error??"No budget data.";const dr=ur.data;return`Budget: ${dr.currency} ${dr.total} total
Spent: ${dr.currency} ${dr.spent} across ${dr.receiptCount} receipt(s)
Remaining: ${dr.currency} ${dr.remaining}`}case"budget_receipts":{const ur=getReceipts(lr.category);if(!ur.success||!ur.data)return ur.error??"No receipts.";if(ur.data.length===0)return lr.category?`No receipts in category "${lr.category}".`:"No receipts recorded.";const dr=[`${ur.data.length} receipt(s)${lr.category?` in "${lr.category}"`:""}:`];return ur.data.slice(0,10).forEach(hr=>{dr.push(`  ${hr.date}  ${hr.vendor}: ${hr.amount} (${hr.category})`)}),ur.data.length>10&&dr.push(`  ... and ${ur.data.length-10} more`),dr.join(`
`)}case"team_members":{const ur=getTeamMembers();if(!ur.success||!ur.data)return ur.error??"No team data.";const dr=[`${ur.data.length} team member(s):`];return ur.data.forEach(hr=>{dr.push(`  ${hr.name}  ${hr.role}${hr.isOwner?" (owner)":""}`)}),dr.join(`
`)}case"project_info":{const ur=getProjectInfo();if(!ur.success||!ur.data)return ur.error??"No project loaded.";const dr=ur.data;return`Project: ${dr.name}
Scenes: ${dr.sceneCount} (${dr.completedScenes} complete)
Characters: ${dr.characterCount}
Looks: ${dr.lookCount}`}case"unknown":default:const cr=getProjectInfo();return cr.success&&cr.data?`Project: ${cr.data.name} | ${cr.data.sceneCount} scenes, ${cr.data.characterCount} characters, ${cr.data.lookCount} looks`:"No specific data matched for this query."}}let cachedContext=null,cachedAt=0;const CACHE_TTL=3e4;function getProjectContext(){var cr,ur,dr,hr,pr,mr,fr,xr;const ar=Date.now();if(cachedContext&&ar-cachedAt<CACHE_TTL)return cachedContext;const or=getProjectInfo(),lr=getScheduleOverview();return cachedContext={projectName:((cr=or.data)==null?void 0:cr.name)??"Unknown Project",productionType:((ur=or.data)==null?void 0:ur.type)??"production",status:((dr=or.data)==null?void 0:dr.status)??"active",sceneCount:((hr=or.data)==null?void 0:hr.sceneCount)??0,characterCount:((pr=or.data)==null?void 0:pr.characterCount)??0,lookCount:((mr=or.data)==null?void 0:mr.lookCount)??0,completedScenes:((fr=or.data)==null?void 0:fr.completedScenes)??0,shootingDays:((xr=lr.data)==null?void 0:xr.totalDays)??0},cachedAt=ar,cachedContext}function generateSystemPrompt(ar){return`You are the Checks Happy assistant for "${ar.projectName}".
You help the hair and makeup team answer questions about this production's schedule, continuity, timesheets, and budget.

PRODUCTION CONTEXT:
- Project: ${ar.projectName}
- Type: ${ar.productionType}
- Status: ${ar.status}
- Scenes: ${ar.sceneCount} (${ar.completedScenes} complete)
- Characters: ${ar.characterCount}
- Looks: ${ar.lookCount}
- Shooting: ${ar.shootingDays} days

AVAILABLE DATA:
You have access to query results about:
- Scene list (${ar.sceneCount} scenes)  numbers, locations, INT/EXT, characters per scene
- Character list (${ar.characterCount} characters)  names, actor names, which scenes they appear in
- Shooting schedule  what scenes shoot on which days, call times, dates
- Call sheets  daily crew calls, scene schedules, notes
- Continuity captures  photos, flags (sweat/blood/dirt/tears), hair notes, makeup notes for each character in each scene
- Character looks  defined looks with makeup/hair/SFX specifications
- Timesheets  daily call times, wrap times, hours worked, earnings
- Budget  total budget, spent, remaining, receipts by category
- Team  crew members and their roles

HOW TO RESPOND:
1. Answer directly and concisely  this is for busy on-set use
2. Always cite specific data: scene numbers, dates, character names
3. If data hasn't been captured yet, say so clearly
4. If a scene or character doesn't exist, say so
5. Keep responses short  people are reading on phones
6. Use bullet points for lists, but keep them brief

WHAT YOU CANNOT DO:
- You cannot access deep script analysis (character backstories, injury progression, emotional beats)  this feature is coming soon
- You cannot modify any data  read only
- You cannot answer questions about other productions
- You cannot make up data  only report what's actually captured

RESPONSE EXAMPLES:

Question: "What's filming today?"
Answer: "Day 9 (Thu 4 Dec)
- Scenes: 152, 100, 101, 104
- Call: 07:00 | Est. wrap: 17:30
- Location: Farmhouse"

Question: "What was captured for Peter in scene 54?"
Answer: "Scene 54  Peter:
- Flags: sweat, dirt
- Hair: dishevelled from chase
- Makeup: no notes
- Photos: 4/4 captured"

Question: "When do we shoot scene 75?"
Answer: "Scene 75  Day 2 (Tue 25 Nov)"

Question: "How much budget left?"
Answer: "500 remaining of 2,000 (1,500 spent across 12 receipts)"

If asked about something not captured:
Answer: "No continuity captured for Peter in Scene 54 yet."

If asked about deep script analysis:
Answer: "I can't access script analysis yet  that feature is coming soon. I can tell you what's been captured on set for that character/scene."`}const MAX_CONVERSATION_HISTORY=10,MAX_TOKENS=500,API_ENDPOINT="/api/ai",useChatStore=create()(persist((ar,or)=>({messages:[],isOpen:!1,isLoading:!1,error:null,toggleChat:()=>ar(lr=>({isOpen:!lr.isOpen})),openChat:()=>ar({isOpen:!0}),closeChat:()=>ar({isOpen:!1}),addMessage:(lr,cr)=>{const ur={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,role:lr,content:cr,timestamp:new Date};ar(dr=>({messages:[...dr.messages.slice(-49),ur]}))},clearMessages:()=>ar({messages:[],error:null}),setLoading:lr=>ar({isLoading:lr}),setError:lr=>ar({error:lr}),sendMessage:async lr=>{var hr,pr;const{addMessage:cr,setLoading:ur,setError:dr}=or();cr("user",lr),ur(!0),dr(null);try{const mr=parseUserQuery(lr),fr=executeQuery(mr),xr=getProjectContext(),Er=generateSystemPrompt(xr),vr=or().messages.slice(-MAX_CONVERSATION_HISTORY).map(wr=>({role:wr.role,content:wr.content})),gr=fr&&fr!=="No specific data matched for this query."?`[DATA CONTEXT]
${fr}

[USER QUESTION]
${lr}`:lr,yr=[...vr.slice(0,-1),{role:"user",content:gr}],br=await fetch(API_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:yr,system:Er,maxTokens:MAX_TOKENS,model:"claude-sonnet-4-20250514"})});if(!br.ok){const wr=await br.json().catch(()=>({}));throw new Error(wr.error||`API error: ${br.status}`)}const _r=await br.json(),jr=((pr=(hr=_r.content)==null?void 0:hr[0])==null?void 0:pr.text)||_r.completion||"Sorry, I could not generate a response.";cr("assistant",jr)}catch(mr){const fr=mr instanceof Error?mr.message:"Failed to send message";dr(fr),cr("assistant",`Sorry, I encountered an error: ${fr}`)}finally{ur(!1)}}}),{name:"hair-makeup-chat-storage",storage:createJSONStorage(()=>localStorage),partialize:ar=>({messages:ar.messages.slice(-50)})})),SUGGESTIONS=[{label:"Today's schedule",prompt:"What's filming today?"},{label:"Capture progress",prompt:"How much continuity has been captured?"},{label:"Budget status",prompt:"How much budget is remaining?"}];function ChatAssistant(){const{messages:ar,isOpen:or,isLoading:lr,error:cr,toggleChat:ur,closeChat:dr,sendMessage:hr,clearMessages:pr}=useChatStore(),[mr,fr]=reactExports.useState(""),xr=reactExports.useRef(null),Er=reactExports.useRef(null);reactExports.useEffect(()=>{or&&xr.current&&xr.current.scrollIntoView({behavior:"smooth"})},[ar,or]),reactExports.useEffect(()=>{or&&Er.current&&Er.current.focus()},[or]);const vr=async()=>{const jr=mr.trim();!jr||lr||(fr(""),await hr(jr))},gr=jr=>{hr(jr)},yr=jr=>{jr.key==="Enter"&&!jr.shiftKey&&(jr.preventDefault(),vr())},br=jr=>jr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,'<code class="bg-black/20 px-1 rounded text-sm">$1</code>').replace(/\n/g,"<br />"),_r=ar.length>0;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:ur,className:`fixed bottom-24 right-4 z-50 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all active:scale-95 ${or?"gold-gradient rotate-0":"gold-gradient"}`,style:{boxShadow:"0 4px 20px rgba(201, 169, 97, 0.4)"},"aria-label":or?"Close chat":"Open chat assistant",children:or?jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):jsxRuntimeExports.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),or&&jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-30 flex flex-col",style:{backgroundColor:"var(--color-background)"},children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 safe-top",style:{backgroundColor:"var(--color-card)",borderBottom:"1px solid var(--color-border)"},children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-success animate-pulse"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:"Claude Assistant"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:pr,className:"p-2 rounded-lg transition-colors",style:{color:"var(--color-text-muted)"},title:"Clear chat",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),jsxRuntimeExports.jsx("button",{onClick:dr,className:"p-2 rounded-lg transition-colors",style:{color:"var(--color-text-muted)"},children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:_r?jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[ar.map(jr=>jsxRuntimeExports.jsx("div",{className:`flex ${jr.role==="user"?"justify-end":"justify-start"}`,children:jsxRuntimeExports.jsx("div",{className:`max-w-[85%] rounded-2xl px-4 py-3 ${jr.role==="user"?"gold-gradient text-white rounded-br-sm":"rounded-bl-sm"}`,style:jr.role==="assistant"?{backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"}:void 0,children:jsxRuntimeExports.jsx("div",{className:"text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:br(jr.content)}})})},jr.id)),lr&&jsxRuntimeExports.jsx("div",{className:"flex justify-start",children:jsxRuntimeExports.jsx("div",{className:"rounded-2xl rounded-bl-sm px-4 py-3",style:{backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsxs("div",{className:"flex gap-1",children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"var(--color-text-muted)",animationDelay:"0ms"}}),jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"var(--color-text-muted)",animationDelay:"150ms"}}),jsxRuntimeExports.jsx("span",{className:"w-2 h-2 rounded-full animate-bounce",style:{backgroundColor:"var(--color-text-muted)",animationDelay:"300ms"}})]})})}),cr&&jsxRuntimeExports.jsx("div",{className:"text-center py-2",children:jsxRuntimeExports.jsx("span",{className:"text-sm text-error",children:cr})}),jsxRuntimeExports.jsx("div",{ref:xr})]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4",children:[jsxRuntimeExports.jsx("div",{className:"text-5xl mb-4",children:""}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--color-text-primary)"},children:"Project Assistant"}),jsxRuntimeExports.jsx("p",{className:"text-sm mb-6",style:{color:"var(--color-text-muted)"},children:"I have access to your project data including characters, looks, scenes, and timesheets. How can I help?"}),jsxRuntimeExports.jsx("div",{className:"space-y-2 w-full max-w-sm",children:SUGGESTIONS.map((jr,wr)=>jsxRuntimeExports.jsx("button",{onClick:()=>gr(jr.prompt),className:"w-full p-3 rounded-card text-left transition-all active:scale-[0.98]",style:{backgroundColor:"var(--color-card)",border:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:jr.label})},wr))})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 pt-3 pb-24",style:{backgroundColor:"var(--color-card)",borderTop:"1px solid var(--color-border)"},children:jsxRuntimeExports.jsxs("div",{className:"flex items-end gap-2",children:[jsxRuntimeExports.jsx("textarea",{ref:Er,value:mr,onChange:jr=>fr(jr.target.value),onKeyDown:yr,placeholder:"Ask about your project...",rows:1,className:"flex-1 input-field resize-none max-h-32",style:{minHeight:"44px"},disabled:lr}),jsxRuntimeExports.jsx("button",{onClick:vr,disabled:!mr.trim()||lr,className:"p-3 rounded-button gold-gradient text-white disabled:opacity-50 transition-all active:scale-95",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]})]})}class ErrorBoundary extends reactExports.Component{constructor(lr){super(lr);io(this,"handleTryAgain",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});io(this,"handleReload",()=>{window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(lr){return{hasError:!0,error:lr}}componentDidCatch(lr,cr){console.error("ErrorBoundary caught an error:",lr,cr),this.setState({errorInfo:cr})}render(){return this.state.hasError?jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md w-full text-center",children:[jsxRuntimeExports.jsx("div",{className:"mx-auto w-16 h-16 mb-6 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold text-text-primary mb-2",children:"Something went wrong"}),jsxRuntimeExports.jsx("p",{className:"text-text-muted mb-6",children:"The app encountered an unexpected error. Please try again or reload the page."}),!1,jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:this.handleTryAgain,className:"w-full py-3 px-4 rounded-button gold-gradient text-white font-semibold shadow-md active:scale-[0.98] transition-transform",children:"Try Again"}),jsxRuntimeExports.jsx("button",{onClick:this.handleReload,className:"w-full py-3 px-4 rounded-button bg-card border border-border text-text-primary font-medium hover:bg-background-secondary transition-colors",children:"Reload Page"})]})]})}):this.props.children}}const logoTick="/mobile/logo-tick.png";function WelcomeScreen(){const{setScreen:ar}=useAuthStore();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col",style:{background:"linear-gradient(180deg, #fffdfb 0%, #fefcfb 30%, #faf6f0 70%, #f5efe5 100%)"},children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-8",children:[jsxRuntimeExports.jsx("img",{src:logoTick,alt:"Checks Happy Logo",className:"w-32 h-32 mb-3 object-contain",style:{maskImage:"radial-gradient(ellipse 70% 70% at center, black 50%, transparent 100%)",WebkitMaskImage:"radial-gradient(ellipse 70% 70% at center, black 50%, transparent 100%)"}}),jsxRuntimeExports.jsx("h1",{className:"text-[34px] font-serif font-medium tracking-wide text-[#1a1a1a]",children:"CHECKS HAPPY"}),jsxRuntimeExports.jsxs("svg",{width:"280",height:"10",viewBox:"0 0 280 10",className:"mt-3 mb-8",children:[jsxRuntimeExports.jsx("defs",{children:jsxRuntimeExports.jsxs("linearGradient",{id:"underlineGold",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[jsxRuntimeExports.jsx("stop",{offset:"0%",stopColor:"#C9A962",stopOpacity:"0.3"}),jsxRuntimeExports.jsx("stop",{offset:"10%",stopColor:"#C9A962"}),jsxRuntimeExports.jsx("stop",{offset:"50%",stopColor:"#D4B86A"}),jsxRuntimeExports.jsx("stop",{offset:"90%",stopColor:"#C9A962"}),jsxRuntimeExports.jsx("stop",{offset:"100%",stopColor:"#C9A962",stopOpacity:"0.3"})]})}),jsxRuntimeExports.jsx("path",{d:`M 0 5
               Q 40 5, 70 4.25
               Q 100 3.5, 140 3
               Q 180 3.5, 210 4.25
               Q 240 5, 280 5
               Q 240 5, 210 5.75
               Q 180 6.5, 140 7
               Q 100 6.5, 70 5.75
               Q 40 5, 0 5
               Z`,fill:"url(#underlineGold)"})]}),jsxRuntimeExports.jsx("p",{className:"text-lg text-[#4a4a4a] mb-10",children:"Your personal onset assistant"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center w-full max-w-md mb-12",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center flex-1",children:[jsxRuntimeExports.jsxs("svg",{className:"w-14 h-14 mb-3",viewBox:"0 0 56 56",fill:"none",children:[jsxRuntimeExports.jsx("path",{d:"M4 18C4 15.79 5.79 14 8 14H14L18 8H38L42 14H48C50.21 14 52 15.79 52 18V44C52 46.21 50.21 48 48 48H8C5.79 48 4 46.21 4 44V18Z",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("circle",{cx:"28",cy:"30",r:"10",fill:"#fefcfb"}),jsxRuntimeExports.jsx("circle",{cx:"28",cy:"30",r:"5",fill:"#1a1a1a"})]}),jsxRuntimeExports.jsx("span",{className:"text-base font-serif text-[#1a1a1a]",children:"Capture"})]}),jsxRuntimeExports.jsx("div",{className:"w-px h-24 bg-[#c5c0b5]"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center flex-1",children:[jsxRuntimeExports.jsxs("svg",{className:"w-14 h-14 mb-3",viewBox:"0 0 56 56",fill:"none",children:[jsxRuntimeExports.jsx("path",{d:"M28 8C16.954 8 8 16.954 8 28c0 4.5 1.5 8.6 4 12",stroke:"#1a1a1a",strokeWidth:"4",strokeLinecap:"round",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M28 48c11.046 0 20-8.954 20-20 0-4.5-1.5-8.6-4-12",stroke:"#1a1a1a",strokeWidth:"4",strokeLinecap:"round",fill:"none"}),jsxRuntimeExports.jsx("polygon",{points:"4,36 14,44 16,32",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("polygon",{points:"52,20 42,12 40,24",fill:"#1a1a1a"})]}),jsxRuntimeExports.jsx("span",{className:"text-base font-serif text-[#1a1a1a]",children:"Track"})]}),jsxRuntimeExports.jsx("div",{className:"w-px h-24 bg-[#c5c0b5]"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center flex-1",children:[jsxRuntimeExports.jsxs("svg",{className:"w-14 h-14 mb-3",viewBox:"0 0 56 56",fill:"none",children:[jsxRuntimeExports.jsx("circle",{cx:"28",cy:"14",r:"8",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("path",{d:"M14 48v-10c0-7.732 6.268-14 14-14s14 6.268 14 14v10",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("circle",{cx:"10",cy:"20",r:"6",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("path",{d:"M0 48v-8c0-5.523 4.477-10 10-10 2.5 0 4.8.9 6.5 2.4",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("circle",{cx:"46",cy:"20",r:"6",fill:"#1a1a1a"}),jsxRuntimeExports.jsx("path",{d:"M56 48v-8c0-5.523-4.477-10-10-10-2.5 0-4.8.9-6.5 2.4",fill:"#1a1a1a"})]}),jsxRuntimeExports.jsx("span",{className:"text-base font-serif text-[#1a1a1a]",children:"Collaborate"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-8 pb-10 space-y-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ar("signin"),className:`w-full h-14 rounded font-semibold text-lg transition-all duration-200
            bg-gradient-to-b from-[#E2C87D] via-[#C9A962] to-[#A8893D] text-white active:scale-[0.98] shadow-md`,children:"Sign In"}),jsxRuntimeExports.jsx("button",{onClick:()=>ar("signup"),className:`w-full h-14 rounded font-semibold text-lg transition-all duration-200
            border border-[#1a1a1a] text-[#1a1a1a] bg-[#fefcfb] active:scale-[0.98]`,children:"Create Account"}),jsxRuntimeExports.jsxs("div",{className:"pt-8 flex items-center justify-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-[#c5c0b5]"}),jsxRuntimeExports.jsx("button",{className:"text-sm text-[#7a7a7a] hover:text-[#4a4a4a] transition-colors whitespace-nowrap",onClick:()=>ar("signup"),children:"Join a Team"}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-px bg-[#c5c0b5]"})]})]})]})}function SignInScreen(){const{setScreen:ar,goBack:or,signIn:lr,isLoading:cr,error:ur,clearError:dr}=useAuthStore(),[hr,pr]=reactExports.useState(""),[mr,fr]=reactExports.useState(""),[xr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(!1),[yr,br]=reactExports.useState(!1),[_r,jr]=reactExports.useState(null),wr=async Tr=>{Tr.preventDefault(),dr(),hr.trim()&&mr&&await lr(hr.trim(),mr)},Sr=hr.trim()&&mr;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Welcome back"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Sign in to access your projects"}),jsxRuntimeExports.jsxs("form",{onSubmit:wr,className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{type:"email",label:"Email",placeholder:"your@email.com",value:hr,onChange:Tr=>pr(Tr.target.value),autoComplete:"email",autoCapitalize:"none",disabled:cr}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{type:xr?"text":"password",label:"Password",placeholder:"Enter your password",value:mr,onChange:Tr=>fr(Tr.target.value),autoComplete:"current-password",disabled:cr}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Er(!xr),className:"absolute right-3 top-8 text-text-muted hover:text-text-secondary",tabIndex:-1,children:xr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"}),jsxRuntimeExports.jsx("path",{d:"M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"}),jsxRuntimeExports.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),(ur||_r)&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:ur||_r})}),jsxRuntimeExports.jsx("div",{className:"text-right",children:jsxRuntimeExports.jsx("button",{type:"button",className:"text-sm text-gold hover:underline",disabled:yr,onClick:async()=>{if(!hr.trim()){jr('Enter your email address first, then tap "Forgot password?"');return}br(!0),gr(!1),jr(null),dr();const{error:Tr}=await resetPassword(hr.trim());br(!1),Tr?jr(Tr.message):gr(!0)},children:yr?"Sending...":"Forgot password?"})}),vr&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:jsxRuntimeExports.jsxs("p",{className:"text-sm text-green-700",children:["Password reset link sent to ",hr,". Check your inbox."]})}),jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,size:"lg",disabled:!Sr||cr,children:cr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Signing in..."]}):"Sign In"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-6 pb-safe-bottom text-center",children:jsxRuntimeExports.jsxs("p",{className:"text-text-secondary",children:["Don't have an account?"," ",jsxRuntimeExports.jsx("button",{onClick:()=>ar("signup"),className:"text-gold font-medium hover:underline",children:"Sign up"})]})})]})}function SignUpScreen(){const{setScreen:ar,goBack:or,signUp:lr,isLoading:cr,error:ur,clearError:dr}=useAuthStore(),[hr,pr]=reactExports.useState(""),[mr,fr]=reactExports.useState(""),[xr,Er]=reactExports.useState(""),[vr,gr]=reactExports.useState(""),[yr,br]=reactExports.useState(!1),[_r,jr]=reactExports.useState({}),wr=()=>{const Rr={};return hr.trim()||(Rr.name="Name is required"),mr.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(mr)||(Rr.email="Please enter a valid email"):Rr.email="Email is required",xr?xr.length<8&&(Rr.password="Password must be at least 8 characters"):Rr.password="Password is required",vr?xr!==vr&&(Rr.confirmPassword="Passwords do not match"):Rr.confirmPassword="Please confirm your password",jr(Rr),Object.keys(Rr).length===0},Sr=async Rr=>{Rr.preventDefault(),dr(),wr()&&await lr(hr.trim(),mr.trim(),xr)},Tr=hr.trim()&&mr.trim()&&xr&&vr;return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4 overflow-y-auto",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Create account"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Join Checks Happy and start tracking"}),jsxRuntimeExports.jsxs("form",{onSubmit:Sr,className:"space-y-4",children:[jsxRuntimeExports.jsx(Input,{type:"text",label:"Name",placeholder:"Your name",value:hr,onChange:Rr=>{pr(Rr.target.value),_r.name&&jr(Nr=>({...Nr,name:void 0}))},autoComplete:"name",disabled:cr,error:_r.name}),jsxRuntimeExports.jsx(Input,{type:"email",label:"Email",placeholder:"your@email.com",value:mr,onChange:Rr=>{fr(Rr.target.value),_r.email&&jr(Nr=>({...Nr,email:void 0}))},autoComplete:"email",autoCapitalize:"none",disabled:cr,error:_r.email}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx(Input,{type:yr?"text":"password",label:"Password",placeholder:"At least 8 characters",value:xr,onChange:Rr=>{Er(Rr.target.value),_r.password&&jr(Nr=>({...Nr,password:void 0}))},autoComplete:"new-password",disabled:cr,error:_r.password}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>br(!yr),className:"absolute right-3 top-8 text-text-muted hover:text-text-secondary",tabIndex:-1,children:yr?jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"}),jsxRuntimeExports.jsx("path",{d:"M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"}),jsxRuntimeExports.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),jsxRuntimeExports.jsx(Input,{type:yr?"text":"password",label:"Confirm Password",placeholder:"Re-enter your password",value:vr,onChange:Rr=>{gr(Rr.target.value),_r.confirmPassword&&jr(Nr=>({...Nr,confirmPassword:void 0}))},autoComplete:"new-password",disabled:cr,error:_r.confirmPassword}),ur&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:ur})}),jsxRuntimeExports.jsx("div",{className:"pt-2",children:jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,size:"lg",disabled:!Tr||cr,children:cr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Creating account..."]}):"Create Account"})})]})]}),jsxRuntimeExports.jsx("div",{className:"px-6 py-6 pb-safe-bottom text-center",children:jsxRuntimeExports.jsxs("p",{className:"text-text-secondary",children:["Already have an account?"," ",jsxRuntimeExports.jsx("button",{onClick:()=>ar("signin"),className:"text-gold font-medium hover:underline",children:"Sign in"})]})})]})}const JOIN_POSITIONS=[{value:"designer",label:"Designer"},{value:"supervisor",label:"Supervisor"},{value:"key",label:"Artist"},{value:"floor",label:"Standby"},{value:"trainee",label:"Trainee"},{value:"daily",label:"Daily"}];function JoinProjectScreen(){const{user:ar,goBack:or,joinProject:lr,isLoading:cr,error:ur,clearError:dr}=useAuthStore(),[hr,pr]=reactExports.useState(""),[mr,fr]=reactExports.useState(!1),[xr,Er]=reactExports.useState(""),[vr,gr]=reactExports.useState(null),[yr,br]=reactExports.useState((ar==null?void 0:ar.name)||""),[_r,jr]=reactExports.useState(!1),wr=Nr=>{const Cr=formatProjectCode(Nr.target.value);pr(Cr),ur&&dr()},Sr=async()=>{if(dr(),!!isValidProjectCode(hr)){jr(!0);try{const{project:Nr,error:Cr}=await getProjectByInviteCode(hr);if(Cr||!Nr){useAuthStore.setState({error:(Cr==null?void 0:Cr.message)||"Invalid project code. Please check and try again."}),jr(!1);return}Er(Nr.name),br((ar==null?void 0:ar.name)||""),gr(null),fr(!0)}catch{useAuthStore.setState({error:"Failed to validate project code. Please try again."})}jr(!1)}},Tr=async()=>{vr&&await lr(hr,vr)},Rr=isValidProjectCode(hr);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:or,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Join a Team"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Enter the project code shared by your supervisor"}),jsxRuntimeExports.jsxs("div",{className:"mb-8",children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Project Code"}),jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsx(Input,{type:"text",placeholder:"ABC-1234",value:hr,onChange:wr,className:"text-center text-2xl tracking-[0.2em] font-mono uppercase",maxLength:8,disabled:cr||_r,autoComplete:"off",autoCapitalize:"characters"})}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-xs text-text-muted text-center",children:"Format: ABC-1234"})]}),ur&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg mb-4",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:ur})}),jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"lg",disabled:!Rr||cr||_r,onClick:Sr,children:_r?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Checking..."]}):"Join"}),jsxRuntimeExports.jsx("div",{className:"mt-8 p-4 bg-gold-50 border border-gold-200 rounded-xl",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("path",{d:"M12 16v-4"}),jsxRuntimeExports.jsx("path",{d:"M12 8h.01"})]})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("p",{className:"text-sm text-gold-800",children:"The project will be added to your hub."})})]})})]}),mr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[430px] bg-card rounded-t-2xl shadow-xl animate-slideUp safe-bottom",children:[jsxRuntimeExports.jsx("div",{className:"p-5 border-b border-border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h2",{className:"text-lg font-semibold text-text-primary",children:["Join ",xr]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mt-0.5",children:"Confirm your details"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>fr(!1),className:"p-2 -m-2 text-text-muted hover:text-text-primary",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),jsxRuntimeExports.jsxs("div",{className:"p-5 max-h-[70vh] overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"mb-5",children:[jsxRuntimeExports.jsx("label",{className:"text-xs font-medium text-text-muted uppercase tracking-wider block mb-1.5",children:"Your Name"}),jsxRuntimeExports.jsx(Input,{type:"text",value:yr,onChange:Nr=>br(Nr.target.value),placeholder:"Your name",disabled:cr})]}),jsxRuntimeExports.jsxs("div",{className:"mb-5",children:[jsxRuntimeExports.jsx("label",{className:"text-xs font-medium text-text-muted uppercase tracking-wider block mb-2",children:"Your Position"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:JOIN_POSITIONS.map(Nr=>jsxRuntimeExports.jsxs("button",{onClick:()=>gr(Nr.value),className:`w-full px-4 py-3 rounded-xl text-left flex items-center justify-between transition-colors ${vr===Nr.value?"bg-gold-50 border border-gold":"bg-gray-50 border border-transparent hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsx("span",{className:`text-sm font-medium ${vr===Nr.value?"text-gold":"text-text-primary"}`,children:Nr.label}),vr===Nr.value&&jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},Nr.value))})]}),jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"lg",disabled:!vr||!yr.trim()||cr,onClick:Tr,children:cr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Joining..."]}):"Confirm & Join"})]})]})})]})}function UpgradeModal({isOpen:ar,onClose:or,onUpgrade:lr}){return jsxRuntimeExports.jsx(Modal,{isOpen:ar,onClose:or,title:"Upgrade to Create Projects",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-gold-50 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),jsxRuntimeExports.jsxs("p",{className:"text-text-secondary mb-6",children:["Creating projects requires a"," ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-text-primary",children:"Supervisor"})," or"," ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-text-primary",children:"Designer"})," subscription."]}),jsxRuntimeExports.jsxs("div",{className:"bg-gold-50/50 rounded-lg p-4 mb-6 text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-text-primary mb-2",children:"With Supervisor or higher, you can:"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-1.5 text-sm text-text-secondary",children:[jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Create and manage projects"]}),jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Generate team invite codes"]}),jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Team management tools"]}),jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})}),"1000+ photos per project"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"lg",variant:"primary",onClick:lr,children:"Upgrade Now"}),jsxRuntimeExports.jsx("button",{onClick:or,className:"w-full py-2 text-sm text-text-muted hover:text-text-secondary",children:"Not now"})]})]})})}const formatRelativeTime=ar=>{const or=new Date,lr=new Date(ar),cr=or.getTime()-lr.getTime(),ur=Math.floor(cr/6e4),dr=Math.floor(ur/60),hr=Math.floor(dr/24);return ur<1?"Just now":ur<60?`${ur}m ago`:dr<24?`${dr}h ago`:hr===1?"Yesterday":hr<7?`${hr}d ago`:lr.toLocaleDateString()},getRoleLabel=ar=>({owner:"Owner",designer:"Designer",hod:"HOD",supervisor:"Supervisor",key:"Key",floor:"Floor",daily:"Daily",trainee:"Trainee",artist:"Artist",viewer:"Viewer"})[ar]||ar,getMembershipLabel=ar=>ar.role==="owner"?"Owner":ar.ownerName?`Synced from ${ar.ownerName}`:getRoleLabel(ar.role),formatDeletionCountdown=ar=>{const or=hoursUntilDeletion(ar);if(or<=0)return"This project is being deleted";if(or===1)return"This project will be deleted in 1 hour";if(or<=24)return`This project will be deleted in ${or} hours`;const lr=Math.ceil(or/24);return`This project will be deleted in ${lr} day${lr!==1?"s":""}`},getTypeLabel=ar=>({film:"Feature Film",tv_series:"TV Series",short_film:"Short Film",commercial:"Commercial",music_video:"Music Video",other:"Production"})[ar]||"Production";function createProjectFromMembership(ar){return{id:ar.projectId,name:ar.projectName,createdAt:ar.joinedAt,updatedAt:ar.lastAccessedAt,scenes:[],characters:[],looks:[]}}function loadDocumentsIntoStores(ar,or,lr){if(ar.length>0){const cr=ar[0];if(cr.days||cr.cast_list){const ur={id:cr.id,status:cr.status==="complete"?"complete":"pending",castList:cr.cast_list||[],days:cr.days||[],totalDays:(cr.days||[]).length,uploadedAt:new Date(cr.created_at),rawText:cr.raw_pdf_text||void 0};useScheduleStore.getState().setSchedule(ur)}}if(or.length>0){const cr=useCallSheetStore.getState();cr.clearAll();const ur=or.map(hr=>{const pr=hr.parsed_data||{};return{...pr,id:hr.id,date:hr.shoot_date,productionDay:hr.production_day,rawText:hr.raw_text||pr.rawText,pdfUri:void 0,uploadedAt:new Date(hr.created_at),scenes:pr.scenes||[]}});for(const hr of ur)useCallSheetStore.setState(pr=>({callSheets:[...pr.callSheets,hr].sort((mr,fr)=>mr.productionDay-fr.productionDay)}));const dr=ur[ur.length-1];dr&&cr.setActiveCallSheet(dr.id);for(const hr of or)hr.storage_path&&downloadDocumentAsDataUri(hr.storage_path).then(({dataUri:pr})=>{pr&&useCallSheetStore.setState(mr=>({callSheets:mr.callSheets.map(fr=>fr.id===hr.id?{...fr,pdfUri:pr}:fr)}))})}if(lr.length>0){const cr=lr[0];cr.storage_path&&downloadDocumentAsDataUri(cr.storage_path).then(({dataUri:ur})=>{ur&&useProjectStore.getState().setScriptPdf(ur)})}}function DeleteProjectModal({isOpen:ar,onClose:or,onConfirm:lr,projectName:cr,isOwner:ur,isLoading:dr,error:hr}){return ar?jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center px-4 pb-8",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:or}),jsxRuntimeExports.jsxs("div",{className:"relative bg-card rounded-2xl p-5 max-w-sm w-full shadow-xl",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary mb-1.5",children:ur?"Delete project?":"Leave project?"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mb-5",children:ur?`Team members synced to "${cr}" will have 48 hours to download any documents before it is permanently deleted.`:`You'll need a new invite code to rejoin "${cr}".`}),hr&&jsxRuntimeExports.jsx("p",{className:"text-sm text-red-600 mb-3",children:hr}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:or,disabled:dr,className:"flex-1 h-11 rounded-xl border border-border text-sm font-medium text-text-primary active:scale-[0.98] transition-transform",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:lr,disabled:dr,className:"flex-1 h-11 rounded-xl bg-red-600 text-sm font-medium text-white active:scale-[0.98] transition-transform",children:dr?"Deleting...":ur?"Delete":"Leave"})]})]})]}):null}function ProjectMenu({isOpen:ar,onClose:or,onSettings:lr,onSetCurrent:cr,onDelete:ur,isOwner:dr,isCurrent:hr,openUpward:pr}){return ar?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-40",onClick:or}),jsxRuntimeExports.jsxs("div",{className:`absolute right-0 z-50 bg-card rounded-xl shadow-lg border border-border py-1 min-w-[180px] ${pr?"bottom-full mb-1":"top-full mt-1"}`,children:[cr&&!hr&&jsxRuntimeExports.jsxs("button",{onClick:()=>{cr(),or()},className:"w-full text-left px-4 py-2.5 text-sm text-text-primary hover:bg-gray-50 transition-colors flex items-center gap-2",children:[jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),"Set as Current"]}),lr&&jsxRuntimeExports.jsx("button",{onClick:()=>{lr(),or()},className:"w-full text-left px-4 py-2.5 text-sm text-text-primary hover:bg-gray-50 transition-colors",children:"Settings"}),jsxRuntimeExports.jsx("button",{onClick:()=>{ur(),or()},className:"w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors",children:dr?"Delete project":"Leave project"})]})]}):null}function ProjectHubScreen(){const{user:ar,setScreen:or,goBack:lr,signOut:cr,projectMemberships:ur,canCreateProjects:dr,updateLastAccessed:hr,hasCompletedOnboarding:pr,deleteProject:mr,leaveProject:fr,isLoading:xr,pinnedProjectId:Er,setPinnedProject:vr,setSettingsProjectId:gr,refreshUserProjects:yr}=useAuthStore(),[br,_r]=reactExports.useState(!1),[jr,wr]=reactExports.useState(null),[Sr,Tr]=reactExports.useState(null),[Rr,Nr]=reactExports.useState(null);reactExports.useEffect(()=>{yr()},[yr]);const kr=Er&&ur.find(Gr=>Gr.projectId===Er)||null||(ur.length>0?[...ur].sort((Gr,Zr)=>new Date(Zr.lastAccessedAt).getTime()-new Date(Gr.lastAccessedAt).getTime())[0]:null),Ar=ur.filter(Gr=>Gr.projectId!==(kr==null?void 0:kr.projectId)).sort((Gr,Zr)=>new Date(Zr.joinedAt).getTime()-new Date(Gr.joinedAt).getTime()),Or=async Gr=>{var os;hr(Gr.projectId);const Zr=useProjectStore.getState();if(Zr.currentProject&&Zr.currentProject.id!==Gr.projectId&&(Zr.currentProject.scenes.length>0?Zr.saveAndClearProject():useCallSheetStore.getState().clearCallSheetsForProject()),((os=Zr.currentProject)==null?void 0:os.id)===Gr.projectId){Zr.setActiveTab("today");return}if(Zr.hasSavedProject(Gr.projectId)){Zr.restoreSavedProject(Gr.projectId),Zr.setActiveTab("today");return}useCallSheetStore.getState().clearAll(),useScheduleStore.getState().clearSchedule();try{const{scenes:Ur,characters:Vr,looks:es,sceneCharacters:Ir,lookScenes:Dr,scheduleData:Pr,callSheetData:Mr,scriptData:Br,error:Xr}=await getProjectData(Gr.projectId),Wr=!Xr&&(Ur.length>0||Vr.length>0),ss=Pr.length>0||Mr.length>0||Br.length>0;if(Wr||ss){const ds=new Map;for(const gs of Ir){const as=ds.get(gs.scene_id)||[];as.push(gs.character_id),ds.set(gs.scene_id,as)}const ns=new Map;for(const gs of Dr){const as=ns.get(gs.look_id)||[];as.push(gs.scene_number),ns.set(gs.look_id,as)}const fs=Ur.map(gs=>({id:gs.id,sceneNumber:gs.scene_number,slugline:gs.location||`Scene ${gs.scene_number}`,intExt:gs.int_ext==="EXT"?"EXT":"INT",timeOfDay:gs.time_of_day||"DAY",synopsis:gs.synopsis||void 0,characters:ds.get(gs.id)||[],isComplete:gs.is_complete,completedAt:gs.completed_at?new Date(gs.completed_at):void 0,filmingStatus:gs.filming_status,filmingNotes:gs.filming_notes||void 0,shootingDay:gs.shooting_day||void 0,characterConfirmationStatus:"confirmed"})),bs=Vr.map(gs=>({id:gs.id,name:gs.name,initials:gs.initials,avatarColour:gs.avatar_colour})),Es=es.map(gs=>({id:gs.id,characterId:gs.character_id,name:gs.name,scenes:ns.get(gs.id)||[],estimatedTime:gs.estimated_time,makeup:gs.makeup_details||createEmptyMakeupDetails(),hair:gs.hair_details||createEmptyHairDetails()})),Ds={id:Gr.projectId,name:Gr.projectName,createdAt:Gr.joinedAt,updatedAt:Gr.lastAccessedAt,scenes:fs,characters:bs,looks:Es};Zr.setProject(Ds),loadDocumentsIntoStores(Pr,Mr,Br),Zr.setActiveTab("today");return}}catch(Ur){console.error("Failed to fetch project data from server:",Ur)}const Jr=createProjectFromMembership(Gr);Gr.role==="owner"?Zr.setProjectNeedsSetup(Jr):Zr.setProject(Jr),Zr.setActiveTab("today")},Lr=()=>{dr()?or("create-project"):_r(!0)},Fr=async()=>{var Jr;if(!jr)return;Tr(null);const Zr=jr.role==="owner"?await mr(jr.projectId):await fr(jr.projectId);if(Zr.success){const os=useProjectStore.getState(),Ur=useCallSheetStore.getState();((Jr=os.currentProject)==null?void 0:Jr.id)===jr.projectId&&(os.clearProject(),Ur.clearCallSheetsForProject()),os.hasSavedProject(jr.projectId)&&os.removeSavedProject(jr.projectId),wr(null)}else Tr(Zr.error||"Something went wrong. Please try again.")},Hr=()=>{if(!(ar!=null&&ar.name))return"?";const Gr=ar.name.split(" ");return Gr.length>=2?`${Gr[0][0]}${Gr[1][0]}`.toUpperCase():ar.name.slice(0,2).toUpperCase()},Kr=Gr=>Gr==="owner"||Gr==="supervisor";return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-30 bg-card border-b border-border safe-top",children:jsxRuntimeExports.jsx("div",{className:"mobile-container",children:jsxRuntimeExports.jsxs("div",{className:"h-14 px-4 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[!pr&&jsxRuntimeExports.jsx("button",{onClick:lr,className:"w-9 h-9 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2",children:jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})}),jsxRuntimeExports.jsx("h1",{className:"text-[17px] font-bold text-text-primary",children:"Projects"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>or("profile"),className:"w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center text-gold text-xs font-bold active:scale-95 transition-transform",children:Hr()})]})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-4",children:ur.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-16 px-4",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-2xl bg-card border border-border flex items-center justify-center mb-5",children:jsxRuntimeExports.jsx("svg",{className:"w-7 h-7 text-text-muted",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-base font-semibold text-text-primary mb-1",children:"No projects yet"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted mb-8 max-w-[240px]",children:"Create a new project or join your team with an invite code."}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-[280px] space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:Lr,className:"w-full h-11 rounded-xl gold-gradient text-white text-sm font-medium active:scale-[0.98] transition-transform",children:"Create Project"}),jsxRuntimeExports.jsx("button",{onClick:()=>or("join"),className:"w-full h-11 rounded-xl border border-border text-sm font-medium text-text-primary active:scale-[0.98] transition-transform",children:"Join with Code"})]})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[kr&&jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"text-[11px] font-medium tracking-wider text-text-muted uppercase mb-2.5",children:"Current"}),jsxRuntimeExports.jsxs("button",{onClick:()=>Or(kr),className:`w-full text-left bg-card rounded-2xl p-4 shadow-sm border active:scale-[0.99] transition-transform ${kr.pendingDeletionAt?"border-red-300":"border-border"}`,children:[kr.pendingDeletionAt&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-red-50 text-red-700 text-xs font-medium px-3 py-2 rounded-lg mb-3",children:[jsxRuntimeExports.jsxs("svg",{className:"w-3.5 h-3.5 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),jsxRuntimeExports.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),formatDeletionCountdown(new Date(kr.pendingDeletionAt))]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-text-primary leading-tight pr-2",children:kr.projectName}),jsxRuntimeExports.jsxs("div",{className:"relative flex-shrink-0",onClick:Gr=>Gr.stopPropagation(),children:[jsxRuntimeExports.jsx("button",{onClick:Gr=>{Gr.stopPropagation(),Nr(Rr===kr.projectId?null:kr.projectId)},className:"w-7 h-7 flex items-center justify-center rounded-lg hover:bg-gray-100 -mr-1 -mt-0.5",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-text-muted",viewBox:"0 0 24 24",fill:"currentColor",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"5",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"19",r:"1.5"})]})}),jsxRuntimeExports.jsx(ProjectMenu,{isOpen:Rr===kr.projectId,onClose:()=>Nr(null),onSetCurrent:()=>vr(kr.projectId),isCurrent:!0,onSettings:Kr(kr.role)?()=>{gr(kr.projectId),or("project-settings")}:void 0,onDelete:()=>{Tr(null),wr(kr)},isOwner:kr.role==="owner"})]})]}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted",children:[getTypeLabel(kr.productionType),jsxRuntimeExports.jsx("span",{className:"mx-1.5 text-text-light",children:""}),getMembershipLabel(kr)]}),(kr.sceneCount>0||kr.teamMemberCount>0)&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-text-muted mt-1.5",children:[kr.sceneCount>0&&`${kr.sceneCount} scene${kr.sceneCount!==1?"s":""}`,kr.sceneCount>0&&kr.teamMemberCount>0&&jsxRuntimeExports.jsx("span",{className:"mx-1.5 text-text-light",children:""}),kr.teamMemberCount>0&&`${kr.teamMemberCount} team`]}),jsxRuntimeExports.jsxs("p",{className:"text-[11px] text-text-light mt-2",children:["Last active ",formatRelativeTime(kr.lastAccessedAt)]})]})]}),Ar.length>0&&jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("div",{className:"text-[11px] font-medium tracking-wider text-text-muted uppercase mb-2.5",children:"Other Projects"}),jsxRuntimeExports.jsx("div",{className:"bg-card rounded-2xl border border-border divide-y divide-border",children:Ar.map(Gr=>jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsxs("button",{onClick:()=>Or(Gr),className:"w-full text-left px-4 py-3.5 active:bg-gray-50 transition-colors",children:[Gr.pendingDeletionAt&&jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-red-50 text-red-700 text-xs font-medium px-2.5 py-1.5 rounded-lg mb-2",children:[jsxRuntimeExports.jsxs("svg",{className:"w-3 h-3 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"10"}),jsxRuntimeExports.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),jsxRuntimeExports.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),formatDeletionCountdown(new Date(Gr.pendingDeletionAt))]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"min-w-0 flex-1",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-medium text-text-primary truncate",children:Gr.projectName}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:getMembershipLabel(Gr)}),jsxRuntimeExports.jsxs("p",{className:"text-[11px] text-text-light mt-0.5",children:["Last active ",formatRelativeTime(Gr.lastAccessedAt)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 ml-3 flex-shrink-0",children:[jsxRuntimeExports.jsxs("div",{onClick:Zr=>Zr.stopPropagation(),className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:Zr=>{Zr.stopPropagation(),Nr(Rr===Gr.projectId?null:Gr.projectId)},className:"w-7 h-7 flex items-center justify-center rounded-lg hover:bg-gray-100",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-text-muted",viewBox:"0 0 24 24",fill:"currentColor",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"5",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"19",r:"1.5"})]})}),jsxRuntimeExports.jsx(ProjectMenu,{isOpen:Rr===Gr.projectId,onClose:()=>Nr(null),onSetCurrent:()=>vr(Gr.projectId),onSettings:Kr(Gr.role)?()=>{gr(Gr.projectId),or("project-settings")}:void 0,onDelete:()=>{Tr(null),wr(Gr)},isOwner:Gr.role==="owner",openUpward:!0})]}),jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-text-light",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:jsxRuntimeExports.jsx("path",{d:"M9 18l6-6-6-6"})})]})]})]})},Gr.projectId))})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-5 pt-2 pb-4",children:[jsxRuntimeExports.jsxs("button",{onClick:Lr,className:"flex items-center gap-1.5 text-sm font-medium text-gold active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[jsxRuntimeExports.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),jsxRuntimeExports.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Create"]}),jsxRuntimeExports.jsx("div",{className:"w-px h-4 bg-border"}),jsxRuntimeExports.jsxs("button",{onClick:()=>or("join"),className:"flex items-center gap-1.5 text-sm font-medium text-text-secondary active:opacity-70 transition-opacity",children:[jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),jsxRuntimeExports.jsx("polyline",{points:"10 17 15 12 10 7"}),jsxRuntimeExports.jsx("line",{x1:"15",y1:"12",x2:"3",y2:"12"})]}),"Join"]})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 py-3 pb-safe-bottom",children:jsxRuntimeExports.jsx("button",{onClick:cr,className:"w-full text-center text-xs text-text-muted active:opacity-70 transition-opacity",children:"Sign out"})}),jsxRuntimeExports.jsx(UpgradeModal,{isOpen:br,onClose:()=>_r(!1),onUpgrade:()=>{_r(!1),or("select-plan")}}),jsxRuntimeExports.jsx(DeleteProjectModal,{isOpen:jr!==null,onClose:()=>{wr(null),Tr(null)},onConfirm:Fr,projectName:(jr==null?void 0:jr.projectName)||"",isOwner:(jr==null?void 0:jr.role)==="owner",isLoading:xr,error:Sr})]})}const OWNER_ROLES=[{value:"designer",label:"Designer"},{value:"supervisor",label:"Supervisor"},{value:"key",label:"Artist"},{value:"floor",label:"Standby"},{value:"trainee",label:"Trainee"},{value:"daily",label:"Daily"}];function CreateProjectScreen(){const{goBack:ar,createProject:or,isLoading:lr,error:cr,clearError:ur}=useAuthStore(),[dr,hr]=reactExports.useState(""),[pr,mr]=reactExports.useState("film"),[fr,xr]=reactExports.useState("designer"),Er=async gr=>{if(gr.preventDefault(),ur(),!dr.trim())return;const yr=await or(dr.trim(),pr,fr);if(yr.success&&yr.code){const{projectMemberships:br}=useAuthStore.getState(),_r=br.find(jr=>jr.projectCode===yr.code);if(_r){const jr={id:_r.projectId,name:_r.projectName,createdAt:_r.joinedAt,updatedAt:_r.lastAccessedAt,scenes:[],characters:[],looks:[]};useProjectStore.getState().setProjectNeedsSetup(jr)}}},vr=dr.trim();return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center px-4 py-3 safe-top",children:jsxRuntimeExports.jsx("button",{onClick:ar,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-6 pt-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Create Project"}),jsxRuntimeExports.jsx("p",{className:"text-text-secondary mb-8",children:"Set up a new production for your team"}),jsxRuntimeExports.jsxs("form",{onSubmit:Er,className:"space-y-6",children:[jsxRuntimeExports.jsx(Input,{type:"text",label:"Production Name",placeholder:"e.g., The Crown S6",value:dr,onChange:gr=>hr(gr.target.value),disabled:lr,autoComplete:"off"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Production Type"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-2",children:PRODUCTION_TYPES.map(gr=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>mr(gr.value),className:`px-4 py-3 rounded-lg border text-sm font-medium transition-colors ${pr===gr.value?"border-gold bg-gold-50 text-gold":"border-border bg-card text-text-secondary hover:border-gold-300"}`,children:gr.label},gr.value))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"field-label block mb-2",children:"Your Role"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-3 gap-2",children:OWNER_ROLES.map(gr=>jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>xr(gr.value),className:`px-3 py-3 rounded-lg border text-sm font-medium transition-colors ${fr===gr.value?"border-gold bg-gold-50 text-gold":"border-border bg-card text-text-secondary hover:border-gold-300"}`,children:gr.label},gr.value))})]}),cr&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-red-700",children:cr})}),jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,size:"lg",disabled:!vr||lr,children:lr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Creating..."]}):"Create Project"})]})]})]})}function FeatureList({features:ar,variant:or="default",showCheckmarks:lr=!0}){return jsxRuntimeExports.jsx("ul",{className:clsx("space-y-2",or==="compact"&&"space-y-1.5"),children:ar.map((cr,ur)=>jsxRuntimeExports.jsxs("li",{className:clsx("flex items-start gap-2",or==="compact"?"text-xs":"text-sm","text-text-secondary"),children:[lr&&jsxRuntimeExports.jsx("span",{className:"flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsx("svg",{className:clsx("text-gold",or==="compact"?"w-3.5 h-3.5":"w-4 h-4"),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}),jsxRuntimeExports.jsx("span",{children:cr})]},ur))})}function FeatureLossList({features:ar}){return ar.length===0?null:jsxRuntimeExports.jsx("ul",{className:"space-y-2",children:ar.map((or,lr)=>jsxRuntimeExports.jsxs("li",{className:"flex items-start gap-2 text-sm text-red-600",children:[jsxRuntimeExports.jsx("span",{className:"flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),jsxRuntimeExports.jsx("span",{children:or})]},lr))})}function TierCard({tier:ar,billingPeriod:or,isSelected:lr=!1,isCurrentPlan:cr=!1,onSelect:ur,disabled:dr=!1}){const{id:hr,name:pr,description:mr,pricing:fr,featureList:xr,isPopular:Er,isPremium:vr}=ar,gr=()=>hr==="trainee"||or!=="yearly"?null:`${formatMonthlyEquivalent(fr.yearly,fr.currencySymbol)}/mo`,yr=()=>cr?"Current Plan":hr==="trainee"?"Start Free":"Subscribe",br=()=>lr||cr?"primary":"outline";return gr(),jsxRuntimeExports.jsxs("div",{className:clsx("relative rounded-xl p-4 transition-all duration-200","border-2",{"border-gold bg-gold-50/50":lr&&!cr,"border-gold bg-gold-50/30":cr,"border-gold/30 bg-gradient-to-br from-gold-50/20 to-transparent":vr&&!lr&&!cr,"border-border bg-card":!lr&&!cr&&!vr,"hover:border-gold/50":!lr&&!cr}),children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[Er&&jsxRuntimeExports.jsx(Badge,{variant:"gold",size:"md",children:"Most Popular"}),vr&&jsxRuntimeExports.jsx(Badge,{variant:"gold",size:"md",children:"Premium"}),cr&&jsxRuntimeExports.jsx(Badge,{variant:"success",size:"md",children:"Current Plan"})]}),jsxRuntimeExports.jsx("h3",{className:clsx("text-lg font-bold mb-1",vr?"gold-text-gradient":"text-text-primary"),children:pr}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary mb-4",children:mr}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-gold",children:"Beta Access"}),jsxRuntimeExports.jsx(Badge,{variant:"gold",size:"sm",children:"Free"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Full access during beta testing"})]}),jsxRuntimeExports.jsx(FeatureList,{features:xr}),jsxRuntimeExports.jsx(Button,{variant:br(),size:"md",fullWidth:!0,onClick:()=>ur(hr),disabled:dr||cr,className:"mt-4",children:yr()}),lr&&!cr&&jsxRuntimeExports.jsx("div",{className:"absolute top-3 right-3",children:jsxRuntimeExports.jsx("div",{className:"w-6 h-6 rounded-full bg-gold flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})})})]})}const COMPARISON_FEATURES=[{label:"Photos per project",trainee:"50",artist:"500",supervisor:"1,000",designer:"Unlimited"},{label:"Projects",trainee:"3",artist:"10",supervisor:"25",designer:"Unlimited"},{label:"Archived projects",trainee:"1",artist:"Unlimited",supervisor:"15",designer:"Unlimited"},{label:"Offline mode",trainee:!1,artist:!0,supervisor:!0,designer:!0},{label:"Export PDF reports",trainee:!1,artist:!0,supervisor:!0,designer:!0},{label:"Personal templates",trainee:!1,artist:!0,supervisor:!0,designer:!0},{label:"Create projects",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Team management",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Team invite codes",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Character progression",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Shooting schedule",trainee:!1,artist:!1,supervisor:!0,designer:!0},{label:"Team photo storage",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Desktop web access",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Pre-production breakdown",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Character design docs",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Production books export",trainee:!1,artist:!1,supervisor:!1,designer:!0},{label:"Budget & scheduling",trainee:!1,artist:!1,supervisor:!1,designer:!0}],tierOrder=["trainee","artist","supervisor","designer"];function CheckIcon(){return jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gold",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"20 6 9 17 4 12"})})}function CrossIcon(){return jsxRuntimeExports.jsxs("svg",{className:"w-4 h-4 text-text-muted",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function ComparisonModal({isOpen:ar,onClose:or,currentTier:lr}){const cr=SUBSCRIPTION_TIERS,ur=(dr,hr)=>typeof dr=="boolean"?dr?jsxRuntimeExports.jsx(CheckIcon,{}):jsxRuntimeExports.jsx(CrossIcon,{}):jsxRuntimeExports.jsx("span",{className:clsx("text-xs font-medium",hr===lr?"text-gold":"text-text-secondary"),children:dr});return jsxRuntimeExports.jsxs(BottomSheet,{isOpen:ar,onClose:or,title:"Compare Plans",height:"full",children:[jsxRuntimeExports.jsx("div",{className:"overflow-x-auto -mx-4 px-4",children:jsxRuntimeExports.jsxs("table",{className:"w-full min-w-[500px]",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"border-b border-border",children:[jsxRuntimeExports.jsx("th",{className:"text-left py-3 pr-4 text-xs font-semibold text-text-muted uppercase tracking-wide",children:"Feature"}),cr.map(dr=>jsxRuntimeExports.jsxs("th",{className:clsx("text-center py-3 px-2 text-xs font-bold uppercase tracking-wide",dr.id===lr?"text-gold":"text-text-primary"),children:[dr.name,dr.id===lr&&jsxRuntimeExports.jsx("div",{className:"text-[9px] text-gold font-normal mt-0.5",children:"Current"})]},dr.id))]})}),jsxRuntimeExports.jsxs("tbody",{children:[jsxRuntimeExports.jsxs("tr",{className:"border-b border-border bg-gold-50/30",children:[jsxRuntimeExports.jsx("td",{className:"py-3 pr-4 text-sm font-medium text-text-primary",children:"Beta Access"}),cr.map(dr=>jsxRuntimeExports.jsx("td",{className:clsx("text-center py-3 px-2",dr.id===lr?"bg-gold-50/50":""),children:jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-gold",children:"Free"})},dr.id))]}),COMPARISON_FEATURES.map((dr,hr)=>jsxRuntimeExports.jsxs("tr",{className:clsx("border-b border-border",hr%2===0?"bg-transparent":"bg-input-bg/30"),children:[jsxRuntimeExports.jsx("td",{className:"py-2.5 pr-4 text-sm text-text-secondary",children:dr.label}),tierOrder.map(pr=>jsxRuntimeExports.jsx("td",{className:clsx("text-center py-2.5 px-2",pr===lr?"bg-gold-50/30":""),children:jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:ur(dr[pr],pr)})},pr))]},dr.label))]})]})}),jsxRuntimeExports.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted text-center",children:"All features available during beta testing. Thank you for testing!"})})]})}function SelectPlanScreen({isOnboarding:ar=!0,currentTier:or,onSelectTier:lr,onSkip:cr,onBack:ur,isLoading:dr=!1}){const[hr,pr]=reactExports.useState(ar?null:or||null),[mr,fr]=reactExports.useState("monthly"),[xr,Er]=reactExports.useState(!1),[vr,gr]=reactExports.useState(!1),yr=or&&hr&&isTierHigher(or,hr)?getDowngradeWarnings(or,hr):[],br=Rr=>{pr(Rr),or&&isTierHigher(or,Rr)?gr(!0):gr(!1)},_r=()=>{hr&&lr&&lr(hr,mr)},jr=()=>{cr?cr():lr&&lr("trainee","monthly")},wr=hr!==null&&!dr,Sr=or&&hr&&isTierHigher(hr,or),Tr=or&&hr&&isTierHigher(or,hr);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[jsxRuntimeExports.jsxs("header",{className:"flex items-center px-4 py-3 safe-top border-b border-border bg-card",children:[ur&&jsxRuntimeExports.jsx("button",{onClick:ur,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 -ml-2","aria-label":"Go back",children:jsxRuntimeExports.jsxs("svg",{className:"w-6 h-6 text-text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M19 12H5"}),jsxRuntimeExports.jsx("path",{d:"M12 19l-7-7 7-7"})]})}),jsxRuntimeExports.jsx("div",{className:clsx("flex-1",ur?"text-center pr-10":"text-center"),children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-text-primary",children:"Choose Your Plan"})})]}),jsxRuntimeExports.jsx("div",{className:"px-6 pt-4 pb-2 text-center",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-text-secondary",children:"All features are available during beta testing. Select your preferred tier."})}),!BETA_MODE,jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4",children:[jsxRuntimeExports.jsx("div",{className:"space-y-4 max-w-md mx-auto",children:SUBSCRIPTION_TIERS.map(Rr=>jsxRuntimeExports.jsx(TierCard,{tier:Rr,billingPeriod:mr,isSelected:hr===Rr.id,isCurrentPlan:or===Rr.id,onSelect:br,disabled:dr},Rr.id))}),jsxRuntimeExports.jsx("div",{className:"text-center mt-6",children:jsxRuntimeExports.jsx("button",{onClick:()=>Er(!0),className:"text-sm text-gold font-medium hover:underline",children:"Compare all features"})}),jsxRuntimeExports.jsxs("div",{className:"mt-6 text-center space-y-1",children:[jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Full access during beta"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-text-muted",children:"Thank you for testing!"})]}),jsxRuntimeExports.jsx("button",{className:"text-xs text-gold hover:underline",children:"Questions? Contact us"})]}),vr&&yr.length>0&&jsxRuntimeExports.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg max-w-md mx-auto",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-semibold text-red-700 mb-2",children:"You'll lose access to:"}),jsxRuntimeExports.jsx(FeatureLossList,{features:yr}),jsxRuntimeExports.jsx("p",{className:"text-xs text-red-600 mt-3",children:"Changes take effect at the end of your billing period."})]})]}),jsxRuntimeExports.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 pb-safe-bottom bg-card border-t border-border",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto space-y-3",children:[jsxRuntimeExports.jsx(Button,{variant:"primary",size:"lg",fullWidth:!0,onClick:_r,disabled:!wr,children:dr?jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin w-5 h-5",viewBox:"0 0 24 24",fill:"none",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Processing..."]}):hr==="trainee"?"Start Free":Tr?"Downgrade Plan":Sr?"Upgrade Plan":hr?"Subscribe":"Select a Plan"}),ar&&jsxRuntimeExports.jsx("button",{onClick:jr,className:"w-full text-center text-sm text-text-muted hover:text-text-secondary",disabled:dr,children:"Continue with Free for now"}),!ar&&or&&or!=="trainee"&&jsxRuntimeExports.jsx("button",{className:"w-full text-center text-sm text-gold hover:underline",children:"Manage billing"})]})}),jsxRuntimeExports.jsx(ComparisonModal,{isOpen:xr,onClose:()=>Er(!1),currentTier:or})]})}initSyncSubscriptions();function ConfigurationError(){return jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:jsxRuntimeExports.jsxs("div",{className:"max-w-md text-center space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"text-6xl",children:""}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold text-foreground",children:"Configuration Required"}),jsxRuntimeExports.jsxs("p",{className:"text-muted-foreground",children:["The application is missing required environment variables. Please ensure",jsxRuntimeExports.jsx("code",{className:"mx-1 px-1.5 py-0.5 bg-muted rounded text-sm",children:"VITE_SUPABASE_URL"}),"and",jsxRuntimeExports.jsx("code",{className:"mx-1 px-1.5 py-0.5 bg-muted rounded text-sm",children:"VITE_SUPABASE_ANON_KEY"}),"are configured in your deployment environment."]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground/70",children:"If you're the administrator, check your Vercel environment variables or .env file."})]})})}function AppContent(){var ts;if(!isSupabaseConfigured)return jsxRuntimeExports.jsx(ConfigurationError,{});const{currentProject:ar,activeTab:or,setActiveTab:lr,currentSceneId:cr,currentLookId:ur,setCurrentScene:dr,setCurrentCharacter:hr,setCurrentLook:pr,checkWrapTrigger:mr,lifecycle:fr,updateActivity:xr,needsSetup:Er,clearNeedsSetup:vr}=useProjectStore(),{isAuthenticated:gr,hasCompletedOnboarding:yr,currentScreen:br,selectTier:_r,setScreen:jr,goBack:wr,user:Sr,settingsProjectId:Tr,setSettingsProjectId:Rr}=useAuthStore(),[Nr,Cr]=reactExports.useState(!1),[kr,Ar]=reactExports.useState(!1),[Or,Lr]=reactExports.useState(!1),Fr=reactExports.useRef(!1);reactExports.useEffect(()=>{if(Fr.current)return;Fr.current=!0,migrateToIndexedDB().then(({migrated:hs,errors:ys})=>{hs.length>0&&console.log("[Storage] Migrated to IndexedDB:",hs),ys.length>0&&console.warn("[Storage] Migration errors:",ys)}).catch(hs=>{console.error("[Storage] Migration failed:",hs)});const Yr=()=>{flushPendingWrites()};return window.addEventListener("beforeunload",Yr),()=>window.removeEventListener("beforeunload",Yr)},[]);const[Hr,Kr]=reactExports.useState(0),[Gr,Zr]=reactExports.useState(void 0);reactExports.useEffect(()=>{yr&&!gr&&!ar&&jr("hub")},[yr,gr,ar,jr]);const Jr=reactExports.useMemo(()=>(ar==null?void 0:ar.scenes.filter(Yr=>Yr.isComplete).length)??0,[ar==null?void 0:ar.scenes]);reactExports.useEffect(()=>{ar&&mr()},[ar,Jr,mr]),reactExports.useEffect(()=>{ar&&xr()},[ar,cr,or,xr]);const os=reactExports.useRef(null);reactExports.useEffect(()=>(ar&&ar.id!==os.current&&(os.current=ar.id,startSync(ar.id,Sr==null?void 0:Sr.id)),!ar&&os.current&&(os.current=null,stopSync()),()=>{os.current&&stopSync()}),[ar==null?void 0:ar.id,Sr==null?void 0:Sr.id]);const{schedule:Ur,isProcessingStage2:Vr,startStage2Processing:es}=useScheduleStore(),{syncCastDataFromSchedule:Ir}=useProjectStore(),Dr=reactExports.useRef(!1);reactExports.useEffect(()=>{Ur&&!Vr&&(!Ur.days||Ur.days.length===0)&&Ur.rawText&&!Dr.current&&(Dr.current=!0,console.log("[App] Starting background schedule Stage 2 processing..."),es())},[Ur,Vr,es]);const Pr=reactExports.useRef(null);reactExports.useEffect(()=>{if(Ur&&Ur.status==="complete"&&!Vr&&Ur.days&&Ur.days.length>0&&ar&&Pr.current!==Ur.id){Pr.current=Ur.id;const Yr=useScheduleStore.getState().schedule;Yr&&(console.log("[App] Schedule processing complete, auto-syncing cast data..."),Ir(Yr,{createMissingCharacters:!0,overwriteExisting:!1,autoConfirm:!0}))}},[Ur==null?void 0:Ur.status,(ts=Ur==null?void 0:Ur.days)==null?void 0:ts.length,Ur==null?void 0:Ur.id,Vr,ar,Ir]);const Mr=()=>{Cr(!1),vr(),lr("today"),Lr(!0)},Br=()=>{stopSync(),os.current=null,useProjectStore.getState().saveAndClearProject(),Cr(!1),jr("hub")},Xr=()=>{Cr(!0)},Wr=Yr=>{dr(Yr),hr(null)},ss=()=>{dr(null),hr(null)},ds=Yr=>{Yr===or&&Kr(hs=>hs+1),lr(Yr),Zr(void 0),cr&&(dr(null),hr(null)),ur&&pr(null)},[ns,fs]=reactExports.useState(!1),bs=Yr=>{ds(Yr)},Es=async(Yr,hs)=>{await _r(Yr,hs)},Ds=async()=>{await _r("trainee","monthly")};if(!yr)switch(br){case"welcome":return jsxRuntimeExports.jsx(WelcomeScreen,{});case"signin":return jsxRuntimeExports.jsx(SignInScreen,{});case"signup":return jsxRuntimeExports.jsx(SignUpScreen,{});case"hub":return jsxRuntimeExports.jsx(ProjectHubScreen,{});case"create-project":return jsxRuntimeExports.jsx(CreateProjectScreen,{});case"select-plan":return jsxRuntimeExports.jsx(SelectPlanScreen,{isOnboarding:!0,currentTier:Sr==null?void 0:Sr.tier,onSelectTier:Es,onSkip:Ds,onBack:wr});case"profile":return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:wr,onNavigateToBilling:()=>jr("select-plan")});case"project-settings":return Tr?jsxRuntimeExports.jsx(ProjectSettingsScreen,{projectId:Tr,onBack:()=>{Rr(null),jr("hub")},onProjectDeleted:()=>{Rr(null),jr("hub")},onProjectArchived:()=>{Rr(null),jr("hub")}}):jsxRuntimeExports.jsx(ProjectHubScreen,{});default:return jsxRuntimeExports.jsx(WelcomeScreen,{})}if(gr&&!ar&&!Nr)switch(br){case"hub":return jsxRuntimeExports.jsx(ProjectHubScreen,{});case"join":return jsxRuntimeExports.jsx(JoinProjectScreen,{});case"create-project":return jsxRuntimeExports.jsx(CreateProjectScreen,{});case"select-plan":return jsxRuntimeExports.jsx(SelectPlanScreen,{isOnboarding:!1,currentTier:Sr==null?void 0:Sr.tier,onSelectTier:Es,onBack:wr});case"profile":return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:wr,onNavigateToBilling:()=>jr("select-plan")});case"project-settings":return Tr?jsxRuntimeExports.jsx(ProjectSettingsScreen,{projectId:Tr,onBack:()=>{Rr(null),jr("hub")},onProjectDeleted:()=>{Rr(null),jr("hub")},onProjectArchived:()=>{Rr(null),jr("hub")}}):jsxRuntimeExports.jsx(ProjectHubScreen,{});default:return jsxRuntimeExports.jsx(ProjectHubScreen,{})}if(yr&&!gr&&!ar)return jsxRuntimeExports.jsx(ProjectHubScreen,{});const gs=()=>{Cr(!1),vr(),wr()};if(Nr||!ar||Er)return jsxRuntimeExports.jsx(Home,{onProjectReady:Mr,onBack:gs});if(kr)return jsxRuntimeExports.jsx(ProjectExportScreen,{onBack:()=>Ar(!1),onExportComplete:()=>Ar(!1)});if(ns)return jsxRuntimeExports.jsx(UserProfileScreen,{onBack:()=>fs(!1),onNavigateToBilling:()=>{fs(!1),lr("more"),Zr("billing")}});const as=()=>{if(cr&&(or==="today"||or==="breakdown"))return jsxRuntimeExports.jsx(SceneView,{sceneId:cr,onBack:ss});switch(or){case"today":return jsxRuntimeExports.jsx(Today,{onSceneSelect:Wr,onNavigateToTab:bs});case"breakdown":return jsxRuntimeExports.jsx(Breakdown,{onSceneSelect:Wr});case"lookbook":return jsxRuntimeExports.jsx(Lookbooks,{});case"hours":return jsxRuntimeExports.jsx(Timesheet,{});case"budget":return jsxRuntimeExports.jsx(Budget,{});case"script":case"schedule":case"callsheets":case"settings":case"more":return jsxRuntimeExports.jsx(More,{onNavigateToTab:bs,onStartNewProject:Xr,initialView:or,resetKey:Hr,subView:Gr});default:return jsxRuntimeExports.jsx(Today,{onSceneSelect:Wr,onNavigateToTab:bs})}},qr=!cr&&!["more","settings","script","schedule","callsheets"].includes(or);return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[ar&&jsxRuntimeExports.jsx(SyncStatusBar,{}),fr.state!=="active"&&jsxRuntimeExports.jsx(LifecycleBanner,{onExport:()=>Ar(!0)}),qr&&jsxRuntimeExports.jsx(ProjectHeader,{onSwitchProject:Br,onNavigateToProfile:()=>fs(!0)}),as(),jsxRuntimeExports.jsx(BottomNav,{activeTab:or,onTabChange:ds}),jsxRuntimeExports.jsx(ChatAssistant,{}),jsxRuntimeExports.jsx(WrapPopupModal,{onExport:()=>Ar(!0)}),Or&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-card rounded-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"pt-8 pb-4 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gold/10 flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-8 h-8 text-gold",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-text-primary mb-1",children:"You're All Set!"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-text-muted px-6",children:"Your project is ready to explore"})]}),jsxRuntimeExports.jsxs("div",{className:"px-6 pb-6",children:[jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-gold/5 border border-gold/20 p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 flex-shrink-0 mt-0.5",children:jsxRuntimeExports.jsxs("svg",{className:"w-5 h-5 text-gold animate-spin",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-text-secondary",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Schedule Processing"}),jsxRuntimeExports.jsx("p",{children:"Your schedule is being processed in the background. Character assignments will be confirmed automatically once complete."})]})]})}),jsxRuntimeExports.jsx("div",{className:"rounded-xl bg-blue-50 border border-blue-100 p-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-blue-700",children:[jsxRuntimeExports.jsx("p",{className:"font-medium mb-1",children:"Start Working Now"}),jsxRuntimeExports.jsx("p",{children:"You can browse scenes, add looks, and set up your continuity bible while the schedule finishes processing."})]})]})}),jsxRuntimeExports.jsx("button",{onClick:()=>Lr(!1),className:"w-full py-3.5 rounded-button gold-gradient text-white font-semibold text-base shadow-lg active:scale-[0.98] transition-transform",children:"Got It"})]})]})})]})}function App(){return jsxRuntimeExports.jsx(ErrorBoundary,{children:jsxRuntimeExports.jsx(AppContent,{})})}const initTheme=()=>{const or=useThemeStore.getState().theme,lr=or==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":or;document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add(lr);const cr=document.querySelector('meta[name="theme-color"]');cr&&cr.setAttribute("content",lr==="dark"?"#000000":"#f5f4f2")};initTheme();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(ar=>{console.log("SW registration failed:",ar)})});client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React$2.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
