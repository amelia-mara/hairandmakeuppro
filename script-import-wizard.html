<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script Import Wizard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0908;
            --bg-medium: rgba(18, 16, 14, 0.95);
            --card-bg: rgba(28, 25, 22, 0.8);
            --text-light: #e8e6e3;
            --text-muted: #9a8f7f;
            --accent-gold: #d4af7a;
            --accent-blue: #667eea;
            --glass-border: rgba(255, 255, 255, 0.08);
            --success: #52c186;
            --error: #ff6b6b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0908 0%, #1a1612 100%);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .wizard-container {
            max-width: 1200px;
            width: 100%;
            background: var(--bg-medium);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .wizard-header {
            padding: 24px 32px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .wizard-title {
            font-size: 1.5em;
            font-weight: 600;
        }

        .step-indicator {
            display: flex;
            gap: 12px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            font-size: 0.875em;
            color: var(--text-muted);
        }

        .step.active {
            background: var(--accent-gold);
            color: var(--bg-dark);
            font-weight: 500;
        }

        .step-number {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
        }

        .step.active .step-number {
            background: rgba(0, 0, 0, 0.2);
        }

        .wizard-body {
            display: flex;
            height: 600px;
        }

        /* Step 1: Upload */
        .upload-section {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .upload-methods {
            display: grid;
            grid-template-columns: repeat(2, 250px);
            gap: 20px;
            margin-top: 40px;
        }

        .upload-method {
            background: var(--card-bg);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-method:hover {
            border-color: var(--accent-gold);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(212, 175, 122, 0.1);
        }

        .upload-method.active {
            border-color: var(--accent-gold);
            background: rgba(212, 175, 122, 0.1);
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 12px;
        }

        .upload-title {
            font-size: 1.125em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .upload-desc {
            font-size: 0.875em;
            color: var(--text-muted);
        }

        /* Step 2: Edit/Preview */
        .edit-section {
            display: flex;
            flex: 1;
            gap: 20px;
            padding: 20px;
        }

        .editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .editor-toolbar {
            display: flex;
            gap: 8px;
            padding: 12px;
            background: var(--card-bg);
            border-radius: 8px 8px 0 0;
            border: 1px solid var(--glass-border);
            border-bottom: none;
        }

        .toolbar-btn {
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.8125em;
            transition: all 0.2s ease;
        }

        .toolbar-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .toolbar-btn.ai {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            color: white;
        }

        .script-editor {
            flex: 1;
            width: 100%;
            padding: 20px;
            background: rgba(10, 9, 8, 0.6);
            border: 1px solid var(--glass-border);
            border-radius: 0 0 8px 8px;
            color: var(--text-light);
            font-family: 'Courier New', monospace;
            font-size: 0.875em;
            line-height: 1.6;
            resize: none;
            overflow-y: auto;
        }

        .script-editor:focus {
            outline: none;
            border-color: var(--accent-gold);
        }

        .preview-panel {
            width: 400px;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-header {
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--glass-border);
            font-weight: 600;
            font-size: 0.875em;
        }

        .preview-content {
            padding: 16px;
            height: calc(100% - 44px);
            overflow-y: auto;
        }

        .preview-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            font-size: 0.875em;
        }

        .stat-label {
            color: var(--text-muted);
        }

        .stat-value {
            font-weight: 600;
            color: var(--accent-gold);
        }

        /* AI Assistant Panel */
        .ai-assistant {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 350px;
            background: var(--bg-medium);
            border: 1px solid var(--accent-blue);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.2);
            display: none;
            overflow: hidden;
        }

        .ai-assistant.active {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .ai-header {
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-body {
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
        }

        .ai-message {
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.875em;
        }

        .ai-suggestions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .suggestion-btn {
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.8125em;
            text-align: left;
            transition: all 0.2s ease;
        }

        .suggestion-btn:hover {
            border-color: var(--accent-blue);
            background: rgba(102, 126, 234, 0.1);
        }

        /* Navigation */
        .wizard-footer {
            padding: 24px 32px;
            background: var(--card-bg);
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
        }

        .nav-btn {
            padding: 10px 24px;
            background: transparent;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.875em;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .nav-btn.primary {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
            color: var(--bg-dark);
        }

        .nav-btn.primary:hover {
            background: #e0c08f;
            border-color: #e0c08f;
        }

        /* Status Messages */
        .status-message {
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.875em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-message.success {
            background: rgba(82, 193, 134, 0.1);
            border: 1px solid rgba(82, 193, 134, 0.3);
            color: var(--success);
        }

        .status-message.error {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            color: var(--error);
        }

        .status-message.info {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: var(--accent-blue);
        }

        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(212, 175, 122, 0.2);
            border-top-color: var(--accent-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <!-- Header -->
        <div class="wizard-header">
            <h1 class="wizard-title">üìÑ Script Import Wizard</h1>
            <div class="step-indicator">
                <div class="step active">
                    <span class="step-number">1</span>
                    <span>Import</span>
                </div>
                <div class="step" id="step2">
                    <span class="step-number">2</span>
                    <span>Review & Edit</span>
                </div>
                <div class="step" id="step3">
                    <span class="step-number">3</span>
                    <span>Process</span>
                </div>
            </div>
        </div>

        <!-- Body -->
        <div class="wizard-body">
            <!-- Step 1: Upload Options -->
            <div class="upload-section" id="uploadSection">
                <h2 style="font-size: 1.5em; margin-bottom: 8px;">Choose Import Method</h2>
                <p style="color: var(--text-muted); margin-bottom: 40px;">Select how you'd like to import your screenplay</p>
                
                <div class="upload-methods">
                    <div class="upload-method" onclick="selectUploadMethod('file')">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-title">Upload File</div>
                        <div class="upload-desc">PDF, TXT, Fountain, or FDX</div>
                        <input type="file" id="fileInput" accept=".pdf,.txt,.fountain,.fdx" style="display: none;">
                    </div>
                    
                    <div class="upload-method" onclick="selectUploadMethod('paste')">
                        <div class="upload-icon">üìã</div>
                        <div class="upload-title">Paste Text</div>
                        <div class="upload-desc">Copy from any source</div>
                    </div>
                    
                    <div class="upload-method" onclick="selectUploadMethod('gdrive')">
                        <div class="upload-icon">‚òÅÔ∏è</div>
                        <div class="upload-title">Google Drive</div>
                        <div class="upload-desc">Import from cloud</div>
                    </div>
                    
                    <div class="upload-method" onclick="selectUploadMethod('template')">
                        <div class="upload-icon">üìù</div>
                        <div class="upload-title">Use Template</div>
                        <div class="upload-desc">Start with example</div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Edit/Preview -->
            <div class="edit-section" id="editSection" style="display: none;">
                <div class="editor-panel">
                    <div class="editor-toolbar">
                        <button class="toolbar-btn ai" onclick="toggleAIAssistant()">
                            ü§ñ AI Assistant
                        </button>
                        <button class="toolbar-btn" onclick="formatAsScreenplay()">
                            üé¨ Auto-Format
                        </button>
                        <button class="toolbar-btn" onclick="detectScenes()">
                            üìç Detect Scenes
                        </button>
                        <button class="toolbar-btn" onclick="cleanupText()">
                            ‚ú® Clean Text
                        </button>
                        <button class="toolbar-btn" onclick="clearEditor()">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                    <textarea class="script-editor" id="scriptEditor" placeholder="Your screenplay will appear here...

You can edit it directly or use the AI Assistant to help format it properly.

Example format:
INT. COFFEE SHOP - DAY

JANE, 30s, sits alone at a corner table.

JANE
(to herself)
This better work...

She opens her laptop and begins typing."></textarea>
                </div>
                
                <div class="preview-panel">
                    <div class="preview-header">üìä Script Analysis</div>
                    <div class="preview-content">
                        <div class="preview-stats">
                            <div class="stat-item">
                                <span class="stat-label">Format Detected</span>
                                <span class="stat-value" id="formatType">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Scenes Found</span>
                                <span class="stat-value" id="sceneCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Characters</span>
                                <span class="stat-value" id="characterCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Pages (est.)</span>
                                <span class="stat-value" id="pageCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Word Count</span>
                                <span class="stat-value" id="wordCount">0</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="font-size: 0.875em; margin-bottom: 12px;">Format Issues</h4>
                            <div id="formatIssues">
                                <div class="status-message info">
                                    <span>‚ÑπÔ∏è</span>
                                    <span>Paste or upload your script to begin analysis</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="wizard-footer">
            <div id="statusArea">
                <!-- Status messages appear here -->
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="goBack()" id="backBtn" style="display: none;">Back</button>
                <button class="nav-btn" onclick="cancel()">Cancel</button>
                <button class="nav-btn primary" onclick="nextStep()" id="nextBtn">Next</button>
            </div>
        </div>
    </div>

    <!-- AI Assistant Panel -->
    <div class="ai-assistant" id="aiAssistant">
        <div class="ai-header">
            <span style="font-weight: 600;">ü§ñ AI Script Assistant</span>
            <span style="cursor: pointer;" onclick="toggleAIAssistant()">√ó</span>
        </div>
        <div class="ai-body">
            <div class="ai-message">
                I can help format your screenplay! Here are some quick fixes:
            </div>
            <div class="ai-suggestions">
                <button class="suggestion-btn" onclick="aiSuggestion('fixSceneHeadings')">
                    üé¨ Fix scene headings (INT./EXT.)
                </button>
                <button class="suggestion-btn" onclick="aiSuggestion('upperCaseCharacters')">
                    üë§ Uppercase character names
                </button>
                <button class="suggestion-btn" onclick="aiSuggestion('fixIndentation')">
                    üìê Fix dialogue indentation
                </button>
                <button class="suggestion-btn" onclick="aiSuggestion('addTransitions')">
                    ‚û°Ô∏è Add missing transitions
                </button>
                <button class="suggestion-btn" onclick="aiSuggestion('cleanPDFArtifacts')">
                    üßπ Clean PDF artifacts
                </button>
                <button class="suggestion-btn" onclick="aiSuggestion('splitByScenes')">
                    üìç Split into scenes
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script>
        let currentStep = 1;
        let selectedMethod = null;
        let scriptContent = '';
        let detectedFormat = null;

        function selectUploadMethod(method) {
            selectedMethod = method;
            document.querySelectorAll('.upload-method').forEach(el => {
                el.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            if (method === 'file') {
                document.getElementById('fileInput').click();
            } else if (method === 'paste') {
                // Go directly to edit step
                showEditSection();
                document.getElementById('scriptEditor').focus();
            } else if (method === 'template') {
                // Load sample screenplay
                loadTemplate();
            } else if (method === 'gdrive') {
                showStatus('info', 'Google Drive integration coming soon!');
            }
        }

        function loadTemplate() {
            const template = `THE MATRIX
Written by
The Wachowskis


FADE IN:

INT. HEART O' THE CITY HOTEL - NIGHT

The screen fills with green, cascading code which gives way to the title.

TRINITY (V.O.)
(whispering)
Is everything in place?

CYPHER (V.O.)
You weren't supposed to relieve me.

TRINITY (V.O.)
I know, but I felt like taking a shift.

INT. ROOM 303 - NIGHT

TRINITY, a leather-clad woman in her late 20s, watches the computer screen.

TRINITY
(into phone)
You like watching him, don't you? You like watching him.

EXT. STREET - NIGHT

A black sedan pulls up. AGENT SMITH and AGENT BROWN get out.

AGENT SMITH
(into earpiece)
We're going in.

FADE OUT.`;

            showEditSection();
            document.getElementById('scriptEditor').value = template;
            analyzeScript();
        }

        function showEditSection() {
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('editSection').style.display = 'flex';
            document.getElementById('step2').classList.add('active');
            document.getElementById('backBtn').style.display = 'block';
            analyzeScript();
        }

        function analyzeScript() {
            const text = document.getElementById('scriptEditor').value;
            const lines = text.split('\n');
            
            // Count scenes (basic detection)
            const sceneHeadings = lines.filter(line => 
                /^(INT\.|EXT\.|INT\/EXT\.)/.test(line.trim().toUpperCase())
            );
            document.getElementById('sceneCount').textContent = sceneHeadings.length;

            // Count characters (basic detection)
            const characters = new Set();
            lines.forEach((line, i) => {
                if (line.trim() && line === line.toUpperCase() && line.length < 30) {
                    // Likely a character name
                    const cleaned = line.trim().replace(/\(.*\)/, '').trim();
                    if (cleaned && !cleaned.includes('.') && !cleaned.startsWith('FADE')) {
                        characters.add(cleaned);
                    }
                }
            });
            document.getElementById('characterCount').textContent = characters.size;

            // Word count
            const wordCount = text.trim().split(/\s+/).filter(w => w).length;
            document.getElementById('wordCount').textContent = wordCount.toLocaleString();

            // Page estimate (roughly 1 page per minute, ~120-150 words)
            const pageEstimate = Math.ceil(wordCount / 130);
            document.getElementById('pageCount').textContent = pageEstimate;

            // Detect format
            if (sceneHeadings.length > 0) {
                document.getElementById('formatType').textContent = 'Screenplay';
                detectedFormat = 'screenplay';
            } else if (text.includes('[[') && text.includes(']]')) {
                document.getElementById('formatType').textContent = 'Fountain';
                detectedFormat = 'fountain';
            } else {
                document.getElementById('formatType').textContent = 'Plain Text';
                detectedFormat = 'text';
            }

            // Check for issues
            updateFormatIssues();
        }

        function updateFormatIssues() {
            const issues = [];
            const text = document.getElementById('scriptEditor').value;
            
            if (!text.trim()) {
                issues.push({ type: 'info', message: 'No content to analyze' });
            } else {
                if (detectedFormat === 'text') {
                    issues.push({ type: 'warning', message: 'No screenplay formatting detected' });
                }
                if (document.getElementById('sceneCount').textContent === '0') {
                    issues.push({ type: 'warning', message: 'No scene headings found (INT./EXT.)' });
                }
                if (text.includes('     ')) {
                    issues.push({ type: 'info', message: 'Multiple spaces detected (possible PDF artifact)' });
                }
            }

            const issuesHTML = issues.length ? issues.map(issue => `
                <div class="status-message ${issue.type}" style="margin-bottom: 8px;">
                    <span>${issue.type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
                    <span>${issue.message}</span>
                </div>
            `).join('') : `
                <div class="status-message success">
                    <span>‚úÖ</span>
                    <span>Script format looks good!</span>
                </div>
            `;

            document.getElementById('formatIssues').innerHTML = issuesHTML;
        }

        function toggleAIAssistant() {
            const assistant = document.getElementById('aiAssistant');
            assistant.classList.toggle('active');
        }

        function aiSuggestion(action) {
            const editor = document.getElementById('scriptEditor');
            let text = editor.value;

            switch(action) {
                case 'fixSceneHeadings':
                    // Fix common scene heading issues
                    text = text.replace(/^(\s*)(int\.|ext\.|int\/ext\.)/gim, '$1$2'.toUpperCase());
                    text = text.replace(/^(\s*)(INT|EXT|INT\/EXT)([^.])/gm, '$1$2. $3');
                    showStatus('success', 'Scene headings fixed!');
                    break;

                case 'upperCaseCharacters':
                    // Find and uppercase character names before dialogue
                    const lines = text.split('\n');
                    for (let i = 0; i < lines.length - 1; i++) {
                        const line = lines[i].trim();
                        const nextLine = lines[i + 1].trim();
                        if (line && !line.includes('.') && nextLine && 
                            !nextLine.startsWith('(') && line.length < 30) {
                            // Likely a character name
                            if (line !== line.toUpperCase()) {
                                lines[i] = lines[i].toUpperCase();
                            }
                        }
                    }
                    text = lines.join('\n');
                    showStatus('success', 'Character names uppercased!');
                    break;

                case 'cleanPDFArtifacts':
                    // Remove common PDF extraction issues
                    text = text.replace(/\s{2,}/g, ' '); // Multiple spaces to single
                    text = text.replace(/([a-z])([A-Z])/g, '$1 $2'); // Fix merged words
                    text = text.replace(/\n{3,}/g, '\n\n'); // Fix excessive line breaks
                    text = text.replace(/^\d+\s*$/gm, ''); // Remove page numbers
                    showStatus('success', 'PDF artifacts cleaned!');
                    break;

                case 'fixIndentation':
                    // Basic screenplay indentation
                    const formatted = text.split('\n').map(line => {
                        const trimmed = line.trim();
                        if (/^(INT\.|EXT\.|INT\/EXT\.)/.test(trimmed)) {
                            return trimmed; // Scene heading - no indent
                        } else if (trimmed === trimmed.toUpperCase() && trimmed.length < 30) {
                            return '                    ' + trimmed; // Character name
                        } else if (trimmed.startsWith('(') && trimmed.endsWith(')')) {
                            return '                ' + trimmed; // Parenthetical
                        }
                        return line;
                    });
                    text = formatted.join('\n');
                    showStatus('success', 'Indentation adjusted!');
                    break;

                default:
                    showStatus('info', 'Feature coming soon!');
            }

            editor.value = text;
            analyzeScript();
        }

        function formatAsScreenplay() {
            aiSuggestion('fixSceneHeadings');
            setTimeout(() => aiSuggestion('upperCaseCharacters'), 500);
            setTimeout(() => aiSuggestion('fixIndentation'), 1000);
        }

        function detectScenes() {
            const text = document.getElementById('scriptEditor').value;
            const scenes = text.split(/(?=^(?:INT\.|EXT\.|INT\/EXT\.)\s)/gm);
            showStatus('info', `Found ${scenes.length} potential scenes`);
            
            // Highlight scene headings
            const highlighted = text.replace(
                /^((?:INT\.|EXT\.|INT\/EXT\.).*$)/gm,
                '>>> $1 <<<'
            );
            document.getElementById('scriptEditor').value = highlighted;
        }

        function cleanupText() {
            aiSuggestion('cleanPDFArtifacts');
        }

        function clearEditor() {
            if (confirm('Clear all text?')) {
                document.getElementById('scriptEditor').value = '';
                analyzeScript();
            }
        }

        function showStatus(type, message) {
            const statusArea = document.getElementById('statusArea');
            statusArea.innerHTML = `
                <div class="status-message ${type}">
                    <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            setTimeout(() => {
                statusArea.innerHTML = '';
            }, 3000);
        }

        function nextStep() {
            const editor = document.getElementById('scriptEditor');
            
            if (currentStep === 1 && editor.value.trim()) {
                // If already have text, process it
                processScript();
            } else if (currentStep === 1) {
                showStatus('error', 'Please import or paste a script first');
            } else if (currentStep === 2) {
                processScript();
            }
        }

        function processScript() {
            const text = document.getElementById('scriptEditor').value;
            
            if (!text.trim()) {
                showStatus('error', 'No script content to process');
                return;
            }

            // Show loading
            document.getElementById('loadingOverlay').classList.add('active');
            
            // Simulate processing
            setTimeout(() => {
                // Save to localStorage
                const scriptData = {
                    content: text,
                    format: detectedFormat,
                    scenes: parseInt(document.getElementById('sceneCount').textContent),
                    characters: parseInt(document.getElementById('characterCount').textContent),
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('importedScript', JSON.stringify(scriptData));
                
                // Hide loading
                document.getElementById('loadingOverlay').classList.remove('active');
                
                // Show success and redirect
                showStatus('success', 'Script processed successfully! Redirecting...');
                
                setTimeout(() => {
                    // Return to main app
                    window.location.href = 'script-breakdown.html';
                }, 1500);
            }, 2000);
        }

        function goBack() {
            document.getElementById('uploadSection').style.display = 'flex';
            document.getElementById('editSection').style.display = 'none';
            document.getElementById('step2').classList.remove('active');
            document.getElementById('backBtn').style.display = 'none';
            currentStep = 1;
        }

        function cancel() {
            if (confirm('Cancel import? Any changes will be lost.')) {
                window.location.href = 'index.html';
            }
        }

        // File input handler
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            document.getElementById('loadingOverlay').classList.add('active');

            try {
                let content = '';
                
                if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
                    // For PDF, we'd need PDF.js
                    showStatus('info', 'PDF processing - please copy/paste text for best results');
                    content = 'Please paste your PDF content in the editor';
                } else {
                    // Text files
                    content = await file.text();
                }

                showEditSection();
                document.getElementById('scriptEditor').value = content;
                analyzeScript();
                
            } catch (error) {
                showStatus('error', 'Error reading file: ' + error.message);
            } finally {
                document.getElementById('loadingOverlay').classList.remove('active');
            }
        });

        // Auto-analyze on edit
        document.getElementById('scriptEditor').addEventListener('input', debounce(analyzeScript, 500));

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>