<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Big Race - H&MU Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/chat-assistant.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* High Contrast Liquid Glass Palette */
            --bg-dark: #050403;
            --bg-darker: #020201;
            --bg-medium: rgba(26, 22, 18, 0.85);
            --card-bg: linear-gradient(135deg, rgba(36, 32, 25, 0.7), rgba(42, 38, 31, 0.6));
            --text-primary: #f0eeeb;
            --text-secondary: #9a8f83;
            --accent-gold: #c9a961;
            --border: rgba(255, 255, 255, 0.1);
            --success: #52c186;
            --warning: #e8a87c;
            --danger: #cd5c5c;
            --glass-border: rgba(255, 255, 255, 0.12);
            --glass-shine: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.02));
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(138, 127, 115, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(138, 127, 115, 0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', sans-serif;
            background: radial-gradient(ellipse at top, #0a0908 0%, #020201 40%, #000000 100%);
            color: var(--text-primary);
            min-height: 100vh;
            font-weight: 400;
            letter-spacing: -0.01em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(201, 169, 97, 0.02) 0%, transparent 40%),
                        radial-gradient(circle at 80% 70%, rgba(201, 169, 97, 0.015) 0%, transparent 40%);
            pointer-events: none;
            z-index: 1;
        }

        /* Layout */
        .app-layout {
            display: flex;
            height: 100vh;
            position: relative;
            z-index: 2;
        }

        /* Sidebar with Liquid Glass */
        .sidebar {
            width: 260px;
            background: linear-gradient(135deg, rgba(26, 22, 18, 0.8), rgba(20, 17, 15, 0.7));
            backdrop-filter: blur(40px) saturate(120%);
            -webkit-backdrop-filter: blur(40px) saturate(120%);
            border-right: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 10;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, transparent 100%);
            pointer-events: none;
        }

        .sidebar-header {
            padding: 32px 24px 24px;
            border-bottom: 1px solid var(--glass-border);
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 20px;
            transition: color 0.2s ease;
            opacity: 0.8;
        }

        .back-btn:hover {
            color: var(--text-primary);
            opacity: 1;
        }

        .back-btn svg {
            width: 14px;
            height: 14px;
        }

        .project-info h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }

        .project-code {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            opacity: 0.7;
        }

        .nav-section {
            padding: 20px 12px;
            border-bottom: 1px solid var(--glass-border);
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-secondary);
            margin-bottom: 8px;
            padding: 0 12px;
            opacity: 0.5;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            margin-bottom: 2px;
            font-size: 14px;
            color: var(--text-secondary);
            position: relative;
        }

        .nav-item:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.08), rgba(201, 169, 97, 0.05));
            color: var(--text-primary);
            box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.05);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.12), rgba(201, 169, 97, 0.08));
            color: var(--accent-gold);
            font-weight: 500;
            box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.1),
                        0 2px 8px rgba(201, 169, 97, 0.1);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 16px;
            background: var(--accent-gold);
            border-radius: 2px;
        }

        .nav-icon {
            width: 18px;
            height: 18px;
            opacity: 0.7;
        }

        .nav-item:hover .nav-icon {
            opacity: 1;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Bar with Liquid Glass */
        .top-bar {
            height: 56px;
            background: linear-gradient(135deg, rgba(26, 22, 18, 0.85), rgba(20, 17, 15, 0.75));
            backdrop-filter: blur(40px) saturate(120%);
            -webkit-backdrop-filter: blur(40px) saturate(120%);
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            position: relative;
            z-index: 9;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
        }

        .top-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        }

        .view-tabs {
            display: flex;
            gap: 2px;
            height: 32px;
            padding: 2px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.3));
            border-radius: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .view-tab {
            padding: 0 16px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s ease;
            font-size: 13px;
            font-weight: 500;
        }

        .view-tab:hover {
            color: var(--text-primary);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
        }

        .view-tab.active {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.15), rgba(201, 169, 97, 0.1));
            color: var(--text-primary);
            box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.1),
                        0 1px 4px rgba(201, 169, 97, 0.2);
        }

        .top-bar-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .layout-btn {
            padding: 6px 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.05),
                        0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .layout-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.08), rgba(201, 169, 97, 0.04));
            box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.1),
                        0 4px 12px rgba(201, 169, 97, 0.15);
            transform: translateY(-1px);
        }

        .layout-btn svg {
            width: 14px;
            height: 14px;
        }

        /* Dashboard Grid */
        .dashboard {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 20px;
        }

        /* Enhanced Widget Styles with Liquid Glass */
        .widget {
            background: var(--card-bg);
            backdrop-filter: blur(30px) saturate(110%);
            -webkit-backdrop-filter: blur(30px) saturate(110%);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            overflow: hidden;
            cursor: move;
            transition: all 0.2s ease;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4),
                        inset 0 1px 1px rgba(255, 255, 255, 0.1);
        }

        .widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.08) 0%, transparent 100%);
            pointer-events: none;
            border-radius: 12px 12px 0 0;
        }

        .widget:hover {
            border-color: rgba(201, 169, 97, 0.3);
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5),
                        inset 0 1px 2px rgba(255, 255, 255, 0.15),
                        0 0 80px rgba(201, 169, 97, 0.03);
        }

        .widget.dragging {
            opacity: 0.5;
        }

        .widget.large {
            grid-column: span 2;
        }

        .widget-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: grab;
            background: linear-gradient(135deg, rgba(30, 26, 22, 0.5), rgba(26, 22, 18, 0.6));
            position: relative;
        }

        .widget-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }

        .widget-header:active {
            cursor: grabbing;
        }

        .widget-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .widget-icon {
            width: 16px;
            height: 16px;
            opacity: 0.6;
        }

        .widget-status {
            padding: 2px 8px;
            background: linear-gradient(135deg, rgba(82, 193, 134, 0.2), rgba(82, 193, 134, 0.15));
            border: 1px solid rgba(82, 193, 134, 0.3);
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            color: var(--success);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .widget-actions {
            display: flex;
            gap: 4px;
        }

        .widget-btn {
            width: 24px;
            height: 24px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            opacity: 0.4;
        }

        .widget-btn:hover {
            opacity: 1;
            background: rgba(201, 169, 97, 0.1);
            color: var(--accent-gold);
        }

        .widget-btn svg {
            width: 14px;
            height: 14px;
        }

        .widget-content {
            padding: 20px;
            position: relative;
        }

        .widget-content.clickable {
            cursor: pointer;
        }

        .widget-content.clickable:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.03), transparent);
        }

        /* Call Sheet Upload Widget */
        .upload-zone {
            border: 2px dashed rgba(201, 169, 97, 0.3);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            transition: all 0.2s ease;
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.02), transparent);
        }

        .upload-zone:hover {
            border-color: var(--accent-gold);
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.05), transparent);
        }

        .upload-zone.dragover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.1), rgba(201, 169, 97, 0.05));
            border-color: var(--accent-gold);
        }

        .upload-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 12px;
            opacity: 0.5;
        }

        .upload-text {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .upload-hint {
            font-size: 11px;
            color: var(--text-secondary);
            opacity: 0.6;
        }

        /* Timer Widget */
        .timer-display {
            text-align: center;
            padding: 20px 0;
        }

        .timer-time {
            font-size: 42px;
            font-weight: 300;
            color: var(--accent-gold);
            letter-spacing: -0.02em;
            margin-bottom: 8px;
            font-variant-numeric: tabular-nums;
        }

        .timer-actor {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .timer-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .timer-btn {
            padding: 10px 24px;
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.15), rgba(201, 169, 97, 0.1));
            border: 1px solid rgba(201, 169, 97, 0.3);
            border-radius: 6px;
            color: var(--accent-gold);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .timer-btn:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.2), rgba(201, 169, 97, 0.15));
            transform: translateY(-1px);
        }

        /* Cast Cards */
        .cast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
        }

        .cast-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: center;
        }

        .cast-card:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.08), rgba(201, 169, 97, 0.04));
            border-color: rgba(201, 169, 97, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .cast-photo {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-gold), #9d8247);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 20px;
            color: var(--bg-dark);
            margin: 0 auto 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4),
                        inset 0 1px 2px rgba(255, 255, 255, 0.2);
        }

        .cast-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .cast-call {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .cast-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            margin-right: 4px;
        }

        /* Quick Stats */
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .stat-value.highlight {
            color: var(--accent-gold);
        }

        /* Scene Requirements */
        .scene-item {
            padding: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.02), transparent);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .scene-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .scene-number {
            font-weight: 600;
            color: var(--accent-gold);
        }

        .scene-time {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .scene-requirements {
            font-size: 12px;
            color: var(--text-primary);
            line-height: 1.5;
        }

        /* Progress Bars */
        .progress-bar {
            height: 4px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.4));
            border-radius: 2px;
            overflow: hidden;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.5);
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-gold), rgba(201, 169, 97, 0.8));
            border-radius: 2px;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(201, 169, 97, 0.3);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .quick-action {
            padding: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .quick-action:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.08), rgba(201, 169, 97, 0.04));
            border-color: rgba(201, 169, 97, 0.3);
            transform: translateY(-1px);
        }

        .quick-action-icon {
            width: 24px;
            height: 24px;
            margin: 0 auto 8px;
            opacity: 0.7;
        }

        .quick-action-label {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Widget Library Modal */
        .widget-library-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .widget-library-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .widget-library-modal {
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            background: linear-gradient(135deg, rgba(26, 22, 18, 0.95), rgba(20, 17, 15, 0.9));
            backdrop-filter: blur(40px) saturate(120%);
            -webkit-backdrop-filter: blur(40px) saturate(120%);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6),
                        inset 0 1px 2px rgba(255, 255, 255, 0.1);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .widget-library-header {
            padding: 24px 28px;
            background: linear-gradient(135deg, rgba(30, 26, 22, 0.7), rgba(26, 22, 18, 0.8));
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .widget-library-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }

        .widget-library-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.01em;
        }

        .widget-library-close {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
        }

        .widget-library-close:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.1), rgba(201, 169, 97, 0.05));
            border-color: rgba(201, 169, 97, 0.3);
            color: var(--accent-gold);
            transform: scale(1.05);
        }

        .widget-library-content {
            padding: 24px 28px;
            max-height: calc(80vh - 120px);
            overflow-y: auto;
        }

        .widget-category {
            margin-bottom: 32px;
        }

        .widget-category-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-secondary);
            margin-bottom: 16px;
            padding-left: 4px;
            opacity: 0.6;
        }

        .widget-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .widget-option {
            background: linear-gradient(135deg, rgba(36, 32, 25, 0.6), rgba(30, 26, 22, 0.5));
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
        }

        .widget-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, transparent 100%);
            pointer-events: none;
        }

        .widget-option:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.12), rgba(201, 169, 97, 0.08));
            border-color: rgba(201, 169, 97, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4),
                        inset 0 1px 2px rgba(255, 255, 255, 0.1);
        }

        .widget-option-icon {
            width: 32px;
            height: 32px;
            margin-bottom: 12px;
            opacity: 0.6;
            color: var(--accent-gold);
        }

        .widget-option-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .widget-option-description {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.4;
            opacity: 0.8;
        }

        .widget-option.added {
            opacity: 0.5;
            pointer-events: none;
        }

        .widget-option.added::after {
            content: 'Added';
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 2px 6px;
            background: var(--success);
            color: var(--bg-dark);
            font-size: 10px;
            font-weight: 600;
            border-radius: 4px;
            text-transform: uppercase;
        }

        /* SVG Icons */
        .icon { fill: currentColor; }

        /* ═══════════════════════════════════════════════════════════════
           TODAY'S SHOOT SECTION
           ═══════════════════════════════════════════════════════════════ */
        .todays-shoot-section {
            margin-bottom: 24px;
        }

        .todays-shoot-card {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.08), rgba(201, 169, 97, 0.03));
            backdrop-filter: blur(30px) saturate(110%);
            -webkit-backdrop-filter: blur(30px) saturate(110%);
            border: 1px solid rgba(201, 169, 97, 0.2);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4),
                        inset 0 1px 1px rgba(255, 255, 255, 0.1);
        }

        .todays-shoot-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.06) 0%, transparent 100%);
            pointer-events: none;
            border-radius: 16px 16px 0 0;
        }

        .todays-shoot-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .todays-shoot-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--accent-gold);
            margin-bottom: 4px;
        }

        .todays-shoot-date {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .shoot-day-main {
            margin-bottom: 16px;
        }

        .shoot-day-label {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .shoot-day-location {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .shoot-day-details {
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            margin-bottom: 20px;
        }

        .shoot-detail {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .shoot-detail-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .shoot-detail-value {
            font-size: 14px;
            color: var(--text-primary);
        }

        .shoot-detail-value.highlight {
            color: var(--accent-gold);
            font-weight: 600;
        }

        .shoot-times {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .shoot-time-box {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.2));
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 12px 16px;
            text-align: center;
            min-width: 100px;
        }

        .shoot-time-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .shoot-time-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-gold);
            font-variant-numeric: tabular-nums;
        }

        .todays-shoot-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .shoot-action-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .shoot-action-btn:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.1), rgba(201, 169, 97, 0.05));
            border-color: rgba(201, 169, 97, 0.3);
            color: var(--accent-gold);
            transform: translateY(-1px);
        }

        .shoot-action-btn.primary {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.15), rgba(201, 169, 97, 0.1));
            border-color: rgba(201, 169, 97, 0.3);
            color: var(--accent-gold);
        }

        .shoot-action-btn.primary:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.2), rgba(201, 169, 97, 0.15));
        }

        .todays-shoot-empty {
            text-align: center;
            padding: 32px 20px;
        }

        .todays-shoot-empty-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            opacity: 0.4;
            color: var(--accent-gold);
        }

        .todays-shoot-empty-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .todays-shoot-empty-desc {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        /* ═══════════════════════════════════════════════════════════════
           ENHANCED CALL SHEET WIDGET
           ═══════════════════════════════════════════════════════════════ */
        .call-sheet-dropzone {
            border: 2px dashed rgba(201, 169, 97, 0.3);
            border-radius: 10px;
            padding: 32px 20px;
            text-align: center;
            transition: all 0.2s ease;
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.02), transparent);
            cursor: pointer;
        }

        .call-sheet-dropzone:hover,
        .call-sheet-dropzone.dragover {
            border-color: var(--accent-gold);
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.08), rgba(201, 169, 97, 0.03));
        }

        .call-sheet-dropzone-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 12px;
            opacity: 0.5;
            color: var(--accent-gold);
        }

        .call-sheet-dropzone-text {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .call-sheet-dropzone-hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .call-sheet-browse-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.12), rgba(201, 169, 97, 0.08));
            border: 1px solid rgba(201, 169, 97, 0.25);
            border-radius: 6px;
            color: var(--accent-gold);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
        }

        .call-sheet-browse-btn:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.18), rgba(201, 169, 97, 0.12));
            transform: translateY(-1px);
        }

        .call-sheet-schedule-select {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
        }

        .call-sheet-schedule-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .call-sheet-schedule-dropdown {
            width: 100%;
            padding: 10px 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 13px;
            font-family: inherit;
            cursor: pointer;
        }

        .call-sheet-schedule-dropdown:focus {
            outline: none;
            border-color: var(--accent-gold);
        }

        .call-sheet-processing {
            text-align: center;
            padding: 40px 20px;
        }

        .call-sheet-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(201, 169, 97, 0.2);
            border-top-color: var(--accent-gold);
            border-radius: 50%;
            margin: 0 auto 16px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .call-sheet-processing-text {
            font-size: 14px;
            color: var(--text-primary);
        }

        .call-sheet-uploaded {
            padding: 0;
        }

        .call-sheet-file-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(82, 193, 134, 0.08), rgba(82, 193, 134, 0.04));
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .call-sheet-file-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--success), rgba(82, 193, 134, 0.8));
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-dark);
        }

        .call-sheet-file-name {
            flex: 1;
            font-size: 13px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .call-sheet-file-date {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .call-sheet-extracted-data {
            margin-bottom: 16px;
        }

        .call-sheet-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        }

        .call-sheet-row:last-child {
            border-bottom: none;
        }

        .call-sheet-row-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .call-sheet-row-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .call-sheet-row-value.time {
            color: var(--accent-gold);
            font-variant-numeric: tabular-nums;
        }

        .call-sheet-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .call-sheet-action-btn {
            flex: 1;
            min-width: 100px;
            padding: 10px 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.02));
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
            text-align: center;
        }

        .call-sheet-action-btn:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.1), rgba(201, 169, 97, 0.05));
            border-color: rgba(201, 169, 97, 0.3);
            color: var(--accent-gold);
        }

        .call-sheet-action-btn.primary {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.15), rgba(201, 169, 97, 0.1));
            border-color: rgba(201, 169, 97, 0.3);
            color: var(--accent-gold);
        }

        /* ═══════════════════════════════════════════════════════════════
           DAILY BREAKDOWN MODAL
           ═══════════════════════════════════════════════════════════════ */
        .breakdown-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 1001;
            animation: fadeIn 0.3s ease;
        }

        .breakdown-modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .breakdown-modal {
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            background: linear-gradient(135deg, rgba(26, 22, 18, 0.98), rgba(20, 17, 15, 0.95));
            backdrop-filter: blur(40px) saturate(120%);
            -webkit-backdrop-filter: blur(40px) saturate(120%);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6),
                        inset 0 1px 2px rgba(255, 255, 255, 0.1);
            animation: slideUp 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .breakdown-modal-header {
            padding: 20px 24px;
            background: linear-gradient(135deg, rgba(30, 26, 22, 0.7), rgba(26, 22, 18, 0.8));
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .breakdown-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .breakdown-modal-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .breakdown-modal-close {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
        }

        .breakdown-modal-close:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.1), rgba(201, 169, 97, 0.05));
            border-color: rgba(201, 169, 97, 0.3);
            color: var(--accent-gold);
        }

        .breakdown-modal-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .breakdown-section {
            margin-bottom: 24px;
        }

        .breakdown-section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--accent-gold);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(201, 169, 97, 0.2);
        }

        .cast-breakdown-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .cast-breakdown-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .cast-breakdown-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .cast-breakdown-actor {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .cast-breakdown-scenes {
            font-size: 12px;
            color: var(--accent-gold);
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.12), rgba(201, 169, 97, 0.08));
            padding: 4px 10px;
            border-radius: 12px;
        }

        .cast-breakdown-times {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .cast-breakdown-time {
            color: var(--text-secondary);
        }

        .cast-breakdown-time strong {
            color: var(--text-primary);
        }

        .cast-breakdown-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .cast-breakdown-detail {
            font-size: 12px;
        }

        .cast-breakdown-detail-label {
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .cast-breakdown-detail-value {
            color: var(--text-primary);
        }

        .cast-breakdown-alert {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: linear-gradient(135deg, rgba(232, 168, 124, 0.15), rgba(232, 168, 124, 0.1));
            border: 1px solid rgba(232, 168, 124, 0.25);
            border-radius: 6px;
            font-size: 11px;
            color: var(--warning);
            margin-top: 12px;
        }

        .scene-order-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .scene-order-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.02), transparent);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .scene-order-number {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--accent-gold), rgba(201, 169, 97, 0.8));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--bg-dark);
        }

        .scene-order-info {
            flex: 1;
        }

        .scene-order-heading {
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .scene-order-cast {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .breakdown-modal-footer {
            padding: 16px 24px;
            background: linear-gradient(135deg, rgba(30, 26, 22, 0.7), rgba(26, 22, 18, 0.8));
            border-top: 1px solid var(--glass-border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .breakdown-modal-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: inherit;
        }

        .breakdown-modal-btn:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.1), rgba(201, 169, 97, 0.05));
            border-color: rgba(201, 169, 97, 0.3);
            color: var(--accent-gold);
        }

        .breakdown-modal-btn.primary {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.15), rgba(201, 169, 97, 0.1));
            border-color: rgba(201, 169, 97, 0.3);
            color: var(--accent-gold);
        }

        /* ═══════════════════════════════════════════════════════════════
           UPCOMING SHOOT DAYS
           ═══════════════════════════════════════════════════════════════ */
        .upcoming-shoot-days {
            margin-top: 24px;
        }

        .upcoming-shoot-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-secondary);
            margin-bottom: 12px;
            opacity: 0.6;
        }

        .upcoming-shoot-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .upcoming-shoot-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 16px;
            background: linear-gradient(135deg, rgba(36, 32, 25, 0.6), rgba(30, 26, 22, 0.5));
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .upcoming-shoot-item:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.08), rgba(201, 169, 97, 0.04));
            border-color: rgba(201, 169, 97, 0.2);
            transform: translateX(4px);
        }

        .upcoming-shoot-date {
            font-size: 13px;
            color: var(--text-primary);
            font-weight: 500;
            min-width: 80px;
        }

        .upcoming-shoot-day {
            font-size: 12px;
            color: var(--accent-gold);
            font-weight: 600;
            min-width: 60px;
        }

        .upcoming-shoot-location {
            flex: 1;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .upcoming-shoot-scenes {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .upcoming-shoot-cast {
            font-size: 11px;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .view-full-schedule-btn {
            display: block;
            margin-top: 12px;
            padding: 12px;
            background: transparent;
            border: 1px dashed rgba(201, 169, 97, 0.3);
            border-radius: 8px;
            color: var(--accent-gold);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: center;
            font-family: inherit;
            width: 100%;
        }

        .view-full-schedule-btn:hover {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.05), transparent);
            border-style: solid;
        }
    </style>
</head>
<body>
    <!-- Hidden SVG Icons -->
    <svg style="display: none;">
        <symbol id="icon-arrow-left" viewBox="0 0 24 24">
            <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-dashboard" viewBox="0 0 24 24">
            <rect x="3" y="3" width="7" height="7" rx="1" fill="currentColor"/>
            <rect x="14" y="3" width="7" height="7" rx="1" fill="currentColor"/>
            <rect x="14" y="14" width="7" height="7" rx="1" fill="currentColor"/>
            <rect x="3" y="14" width="7" height="7" rx="1" fill="currentColor"/>
        </symbol>
        <symbol id="icon-script" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
        </symbol>
        <symbol id="icon-generate" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-character" viewBox="0 0 24 24">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-scene" viewBox="0 0 24 24">
            <rect x="2" y="7" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M16 2l2 5M8 2l-2 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
        </symbol>
        <symbol id="icon-photo" viewBox="0 0 24 24">
            <rect x="3" y="7" width="18" height="13" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
            <circle cx="12" cy="13" r="3" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M5 7l2-3h10l2 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-calendar" viewBox="0 0 24 24">
            <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M16 2v4M8 2v4M3 10h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
        </symbol>
        <symbol id="icon-time" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
        </symbol>
        <symbol id="icon-budget" viewBox="0 0 24 24">
            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-report" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M14 2v6h6M9 15v2m3-6v6m3-4v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
        </symbol>
        <symbol id="icon-kit" viewBox="0 0 24 24">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M12 22V12M12 12L3 7M12 12l9-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/>
        </symbol>
        <symbol id="icon-upload" viewBox="0 0 24 24">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-play" viewBox="0 0 24 24">
            <polygon points="5 3 19 12 5 21 5 3" fill="currentColor"/>
        </symbol>
        <symbol id="icon-pause" viewBox="0 0 24 24">
            <rect x="6" y="4" width="4" height="16" fill="currentColor"/>
            <rect x="14" y="4" width="4" height="16" fill="currentColor"/>
        </symbol>
        <symbol id="icon-plus" viewBox="0 0 24 24">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-expand" viewBox="0 0 24 24">
            <path d="M8 3h8m0 0v8m0-8l-8 8M16 21h-8m0 0v-8m0 8l8-8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-collapse" viewBox="0 0 24 24">
            <path d="M8 7v2m0 0h2M8 9l3-3M16 7v2m0 0h-2m2 0l-3-3M16 17v-2m0 0h-2m2 0l-3 3M8 17v-2m0 0h2m-2 0l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-close" viewBox="0 0 24 24">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-resize" viewBox="0 0 24 24">
            <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
    </svg>

    <div class="app-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="back-btn">
                    <svg><use xlink:href="#icon-arrow-left"/></svg>
                    All Projects
                </a>
                <div class="project-info">
                    <h2>The Big Race</h2>
                    <p class="project-code">Hair & Makeup Department</p>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Menu</div>
                <div class="nav-item" onclick="window.location.href='script-breakdown.html'">
                    <svg class="nav-icon"><use xlink:href="#icon-script"/></svg>
                    Script
                </div>
                <div class="nav-item" onclick="window.location.href='generate-breakdown.html'">
                    <svg class="nav-icon"><use xlink:href="#icon-generate"/></svg>
                    Breakdown
                </div>
                <div class="nav-item" onclick="window.location.href='character-design.html'">
                    <svg class="nav-icon"><use xlink:href="#icon-character"/></svg>
                    Character Design
                </div>
                <div class="nav-item" onclick="window.location.href='continuity.html'">
                    <svg class="nav-icon"><use xlink:href="#icon-photo"/></svg>
                    Continuity
                </div>
                <div class="nav-item" onclick="window.location.href='dashboard.html'">
                    <svg class="nav-icon"><use xlink:href="#icon-calendar"/></svg>
                    Call Sheets
                </div>
                <div class="nav-item" onclick="window.location.href='budget-system.html'">
                    <svg class="nav-icon"><use xlink:href="#icon-budget"/></svg>
                    Budgeting
                </div>
                <div class="nav-item" onclick="window.location.href='timesheet-system.html'">
                    <svg class="nav-icon"><use xlink:href="#icon-time"/></svg>
                    Timesheets
                </div>
                <div class="nav-item" onclick="window.location.href='dashboard.html'">
                    <svg class="nav-icon"><use xlink:href="#icon-report"/></svg>
                    Reports
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="widget-title" style="font-size: 16px; font-weight: 600; color: var(--text-primary);">
                    H&MU Dashboard
                </div>
                <div class="top-bar-actions">
                    <button class="layout-btn" onclick="openWidgetLibrary()">
                        <svg><use xlink:href="#icon-plus"/></svg>
                        Add Widget
                    </button>
                </div>
            </div>

            <!-- Dashboard -->
            <div class="dashboard">
                <!-- Today's Shoot Section -->
                <div class="todays-shoot-section" id="todaysShootSection">
                    <div class="todays-shoot-card" id="todaysShootCard">
                        <!-- Empty state - shown when no call sheet -->
                        <div class="todays-shoot-empty" id="todaysShootEmpty">
                            <svg class="todays-shoot-empty-icon"><use xlink:href="#icon-calendar"/></svg>
                            <div class="todays-shoot-empty-title">No Shoot Data for Today</div>
                            <div class="todays-shoot-empty-desc">Upload a call sheet or select from your shooting schedule</div>
                            <button class="shoot-action-btn primary" onclick="document.getElementById('callSheetFileInput').click()">
                                Upload Call Sheet
                            </button>
                        </div>

                        <!-- Populated state - shown when call sheet is loaded -->
                        <div class="todays-shoot-populated" id="todaysShootPopulated" style="display: none;">
                            <div class="todays-shoot-header">
                                <div>
                                    <div class="todays-shoot-title">TODAY'S SHOOT</div>
                                    <div class="todays-shoot-date" id="todaysShootDate">Loading...</div>
                                </div>
                            </div>

                            <div class="shoot-day-main">
                                <div class="shoot-day-label" id="shootDayLabel">SHOOT DAY 1</div>
                                <div class="shoot-day-location" id="shootDayLocation">Location TBD</div>
                            </div>

                            <div class="shoot-day-details">
                                <div class="shoot-detail">
                                    <div class="shoot-detail-label">Scenes</div>
                                    <div class="shoot-detail-value" id="shootDayScenes">--</div>
                                </div>
                                <div class="shoot-detail">
                                    <div class="shoot-detail-label">Cast</div>
                                    <div class="shoot-detail-value" id="shootDayCast">--</div>
                                </div>
                            </div>

                            <div class="shoot-times">
                                <div class="shoot-time-box">
                                    <div class="shoot-time-label">H&MU Call</div>
                                    <div class="shoot-time-value" id="shootTimeHMU">--:--</div>
                                </div>
                                <div class="shoot-time-box">
                                    <div class="shoot-time-label">General Call</div>
                                    <div class="shoot-time-value" id="shootTimeGeneral">--:--</div>
                                </div>
                                <div class="shoot-time-box">
                                    <div class="shoot-time-label">First Shot</div>
                                    <div class="shoot-time-value" id="shootTimeFirst">--:--</div>
                                </div>
                            </div>

                            <div class="todays-shoot-actions">
                                <button class="shoot-action-btn primary" onclick="openDailyBreakdownModal()">View Daily Breakdown</button>
                                <button class="shoot-action-btn" onclick="openLiveContinuity()">Open Live Continuity</button>
                                <button class="shoot-action-btn" onclick="shareWithTeam()">Share with Team</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="widgets-grid" id="widgetsGrid">
                    
                    <!-- Today's Call Sheet Widget -->
                    <div class="widget" draggable="true" data-widget-type="call-sheet">
                        <div class="widget-header">
                            <div class="widget-title">
                                <svg class="widget-icon"><use xlink:href="#icon-calendar"/></svg>
                                Today's Call Sheet
                                <span class="widget-status" id="callSheetStatus">upload</span>
                            </div>
                            <div class="widget-actions">
                                <button class="widget-btn widget-btn-resize" title="Toggle size">
                                    <svg><use xlink:href="#icon-resize"/></svg>
                                </button>
                                <button class="widget-btn">
                                    <svg><use xlink:href="#icon-expand"/></svg>
                                </button>
                                <button class="widget-btn widget-btn-close">
                                    <svg><use xlink:href="#icon-close"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content" id="callSheetWidgetContent">
                            <!-- Upload State -->
                            <div id="callSheetUploadState">
                                <div class="call-sheet-dropzone" id="callSheetDropzone"
                                     ondragover="handleCallSheetDragOver(event)"
                                     ondragleave="handleCallSheetDragLeave(event)"
                                     ondrop="handleCallSheetDrop(event)">
                                    <svg class="call-sheet-dropzone-icon"><use xlink:href="#icon-upload"/></svg>
                                    <div class="call-sheet-dropzone-text">Drop call sheet here</div>
                                    <div class="call-sheet-dropzone-hint">PDF or Image from 2nd AD</div>
                                    <button class="call-sheet-browse-btn" onclick="document.getElementById('callSheetFileInput').click()">Browse Files</button>
                                </div>
                                <input type="file" id="callSheetFileInput" accept=".pdf,.jpg,.jpeg,.png" onchange="handleCallSheetUpload(event)" hidden>

                                <div class="call-sheet-schedule-select">
                                    <div class="call-sheet-schedule-label">Or select from schedule:</div>
                                    <select class="call-sheet-schedule-dropdown" id="callSheetScheduleSelect" onchange="loadFromSchedule(this.value)">
                                        <option value="">Select shoot day...</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Processing State -->
                            <div id="callSheetProcessingState" style="display: none;">
                                <div class="call-sheet-processing">
                                    <div class="call-sheet-spinner"></div>
                                    <div class="call-sheet-processing-text">Extracting call sheet data...</div>
                                </div>
                            </div>

                            <!-- Uploaded State -->
                            <div id="callSheetUploadedState" class="call-sheet-uploaded" style="display: none;">
                                <div class="call-sheet-file-info">
                                    <div class="call-sheet-file-icon">
                                        <svg width="16" height="16"><use xlink:href="#icon-script"/></svg>
                                    </div>
                                    <div>
                                        <div class="call-sheet-file-name" id="callSheetFileName">call_sheet.pdf</div>
                                        <div class="call-sheet-file-date" id="callSheetFileDate">Uploaded just now</div>
                                    </div>
                                </div>

                                <div class="call-sheet-extracted-data">
                                    <div class="call-sheet-row">
                                        <span class="call-sheet-row-label">Date</span>
                                        <span class="call-sheet-row-value" id="extractedDate">--</span>
                                    </div>
                                    <div class="call-sheet-row">
                                        <span class="call-sheet-row-label">Location</span>
                                        <span class="call-sheet-row-value" id="extractedLocation">--</span>
                                    </div>
                                    <div class="call-sheet-row">
                                        <span class="call-sheet-row-label">H&MU Call</span>
                                        <span class="call-sheet-row-value time" id="extractedHMUCall">--</span>
                                    </div>
                                    <div class="call-sheet-row">
                                        <span class="call-sheet-row-label">General Call</span>
                                        <span class="call-sheet-row-value time" id="extractedGeneralCall">--</span>
                                    </div>
                                    <div class="call-sheet-row">
                                        <span class="call-sheet-row-label">First Shot</span>
                                        <span class="call-sheet-row-value time" id="extractedFirstShot">--</span>
                                    </div>
                                    <div class="call-sheet-row">
                                        <span class="call-sheet-row-label">Scenes</span>
                                        <span class="call-sheet-row-value" id="extractedScenes">--</span>
                                    </div>
                                    <div class="call-sheet-row">
                                        <span class="call-sheet-row-label">Cast</span>
                                        <span class="call-sheet-row-value" id="extractedCast">--</span>
                                    </div>
                                </div>

                                <div class="call-sheet-actions">
                                    <button class="call-sheet-action-btn" onclick="viewOriginalCallSheet()">View Original</button>
                                    <button class="call-sheet-action-btn" onclick="reuploadCallSheet()">Re-upload</button>
                                    <button class="call-sheet-action-btn primary" onclick="generateDailyBreakdown()">Generate Breakdown</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Chair Timer Widget -->
                    <div class="widget" draggable="true" data-widget-type="chair-timer">
                        <div class="widget-header">
                            <div class="widget-title">
                                <svg class="widget-icon"><use xlink:href="#icon-time"/></svg>
                                Active Chair Timer
                            </div>
                            <div class="widget-actions">
                                <button class="widget-btn widget-btn-resize" title="Toggle size">
                                    <svg><use xlink:href="#icon-resize"/></svg>
                                </button>
                                <button class="widget-btn">
                                    <svg><use xlink:href="#icon-expand"/></svg>
                                </button>
                                <button class="widget-btn widget-btn-close">
                                    <svg><use xlink:href="#icon-close"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <div class="timer-display">
                                <div class="timer-time">00:45:23</div>
                                <div class="timer-actor">Sarah Mitchell - Lead</div>
                                <div class="timer-controls">
                                    <button class="timer-btn">Pause</button>
                                    <button class="timer-btn">Complete</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Cast Widget -->
                    <div class="widget large" draggable="true" data-widget-type="cast-today">
                        <div class="widget-header">
                            <div class="widget-title">
                                <svg class="widget-icon"><use xlink:href="#icon-character"/></svg>
                                Today's Cast
                            </div>
                            <div class="widget-actions">
                                <button class="widget-btn widget-btn-resize" title="Toggle size">
                                    <svg><use xlink:href="#icon-resize"/></svg>
                                </button>
                                <button class="widget-btn">
                                    <svg><use xlink:href="#icon-expand"/></svg>
                                </button>
                                <button class="widget-btn widget-btn-close">
                                    <svg><use xlink:href="#icon-close"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <div class="cast-grid">
                                <div class="cast-card">
                                    <div class="cast-photo">SM</div>
                                    <div class="cast-name">Sarah Mitchell</div>
                                    <div class="cast-call">
                                        <span class="cast-status"></span>5:30 AM
                                    </div>
                                </div>
                                <div class="cast-card">
                                    <div class="cast-photo">JR</div>
                                    <div class="cast-name">Jake Rivers</div>
                                    <div class="cast-call">6:00 AM</div>
                                </div>
                                <div class="cast-card">
                                    <div class="cast-photo">EW</div>
                                    <div class="cast-name">Emma White</div>
                                    <div class="cast-call">6:30 AM</div>
                                </div>
                                <div class="cast-card">
                                    <div class="cast-photo">TC</div>
                                    <div class="cast-name">Tom Chen</div>
                                    <div class="cast-call">7:00 AM</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Scenes Widget -->
                    <div class="widget" draggable="true" data-widget-type="scene-requirements">
                        <div class="widget-header">
                            <div class="widget-title">
                                <svg class="widget-icon"><use xlink:href="#icon-scene"/></svg>
                                Today's H&MU Requirements
                            </div>
                            <div class="widget-actions">
                                <button class="widget-btn widget-btn-resize" title="Toggle size">
                                    <svg><use xlink:href="#icon-resize"/></svg>
                                </button>
                                <button class="widget-btn">
                                    <svg><use xlink:href="#icon-expand"/></svg>
                                </button>
                                <button class="widget-btn widget-btn-close">
                                    <svg><use xlink:href="#icon-close"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <div class="scene-item">
                                <div class="scene-header">
                                    <span class="scene-number">Scene 24</span>
                                    <span class="scene-time">INT. DAY</span>
                                </div>
                                <div class="scene-requirements">
                                    Sarah: Running look, sweat & dirt. Jake: Fresh from shower, wet hair
                                </div>
                            </div>
                            <div class="scene-item">
                                <div class="scene-header">
                                    <span class="scene-number">Scene 25</span>
                                    <span class="scene-time">INT. DAY</span>
                                </div>
                                <div class="scene-requirements">
                                    Continuity from Sc. 24. Add bruise on Sarah's cheek
                                </div>
                            </div>
                            <div class="scene-item">
                                <div class="scene-header">
                                    <span class="scene-number">Scene 31</span>
                                    <span class="scene-time">EXT. NIGHT</span>
                                </div>
                                <div class="scene-requirements">
                                    Full glam for party scene. All principals
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Department Budget Widget -->
                    <div class="widget" draggable="true" data-widget-type="dept-budget">
                        <div class="widget-header">
                            <div class="widget-title">
                                <svg class="widget-icon"><use xlink:href="#icon-budget"/></svg>
                                H&MU Budget
                            </div>
                            <div class="widget-actions">
                                <button class="widget-btn widget-btn-resize" title="Toggle size">
                                    <svg><use xlink:href="#icon-resize"/></svg>
                                </button>
                                <button class="widget-btn">
                                    <svg><use xlink:href="#icon-expand"/></svg>
                                </button>
                                <button class="widget-btn widget-btn-close">
                                    <svg><use xlink:href="#icon-close"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <div class="stat-row">
                                <span class="stat-label">Department Budget</span>
                                <span class="stat-value">$25,000</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Spent to Date</span>
                                <span class="stat-value">$12,350</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Remaining</span>
                                <span class="stat-value highlight">$12,650</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 49.4%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions Widget -->
                    <div class="widget" draggable="true" data-widget-type="quick-actions">
                        <div class="widget-header">
                            <div class="widget-title">
                                <svg class="widget-icon"><use xlink:href="#icon-plus"/></svg>
                                Quick Actions
                            </div>
                            <div class="widget-actions">
                                <button class="widget-btn widget-btn-resize" title="Toggle size">
                                    <svg><use xlink:href="#icon-resize"/></svg>
                                </button>
                                <button class="widget-btn widget-btn-close">
                                    <svg><use xlink:href="#icon-close"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <div class="quick-actions">
                                <div class="quick-action" onclick="document.getElementById('callSheetFileInput').click()">
                                    <svg class="quick-action-icon"><use xlink:href="#icon-upload"/></svg>
                                    <div class="quick-action-label">Upload Call Sheet</div>
                                </div>
                                <div class="quick-action" onclick="openDailyBreakdownModal()">
                                    <svg class="quick-action-icon"><use xlink:href="#icon-report"/></svg>
                                    <div class="quick-action-label">Today's Breakdown</div>
                                </div>
                                <div class="quick-action" onclick="openLiveContinuity()">
                                    <svg class="quick-action-icon"><use xlink:href="#icon-photo"/></svg>
                                    <div class="quick-action-label">Live Continuity</div>
                                </div>
                                <div class="quick-action" onclick="shareWithTeam()">
                                    <svg class="quick-action-icon"><use xlink:href="#icon-character"/></svg>
                                    <div class="quick-action-label">Share with Team</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Upcoming Shoot Days Section -->
                <div class="upcoming-shoot-days" id="upcomingShootDays">
                    <div class="upcoming-shoot-title">Upcoming Shoot Days</div>
                    <div class="upcoming-shoot-list" id="upcomingShootList">
                        <!-- Populated dynamically -->
                    </div>
                    <button class="view-full-schedule-btn" onclick="window.location.href='generate-breakdown.html'">View Full Schedule</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Breakdown Modal -->
    <div class="breakdown-modal-overlay" id="dailyBreakdownModal">
        <div class="breakdown-modal">
            <div class="breakdown-modal-header">
                <div>
                    <div class="breakdown-modal-title">DAILY H&MU BREAKDOWN</div>
                    <div class="breakdown-modal-subtitle" id="breakdownModalSubtitle">Loading...</div>
                </div>
                <button class="breakdown-modal-close" onclick="closeDailyBreakdownModal()">
                    <svg width="14" height="14"><use xlink:href="#icon-close"/></svg>
                </button>
            </div>
            <div class="breakdown-modal-content" id="breakdownModalContent">
                <!-- Cast Breakdown Section -->
                <div class="breakdown-section">
                    <div class="breakdown-section-title">Cast Breakdown</div>
                    <div id="castBreakdownList">
                        <!-- Populated dynamically -->
                    </div>
                </div>

                <!-- Scene Order Section -->
                <div class="breakdown-section">
                    <div class="breakdown-section-title">Scene Order</div>
                    <div class="scene-order-list" id="sceneOrderList">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
            <div class="breakdown-modal-footer">
                <button class="breakdown-modal-btn" onclick="downloadBreakdownPDF()">Download PDF</button>
                <button class="breakdown-modal-btn" onclick="copyBreakdownLink()">Copy Link</button>
                <button class="breakdown-modal-btn" onclick="sendToTeam()">Send to Team</button>
                <button class="breakdown-modal-btn primary" onclick="printBreakdown()">Print</button>
            </div>
        </div>
    </div>

    <!-- Widget Library Modal -->
    <div class="widget-library-overlay" id="widgetLibrary">
        <div class="widget-library-modal">
            <div class="widget-library-header">
                <h2 class="widget-library-title">Widget Library</h2>
                <button class="widget-library-close" onclick="closeWidgetLibrary()">
                    <svg width="14" height="14"><use xlink:href="#icon-close"/></svg>
                </button>
            </div>
            <div class="widget-library-content">
                
                <!-- Production Documents Category -->
                <div class="widget-category">
                    <h3 class="widget-category-title">Production Documents</h3>
                    <div class="widget-options">
                        <div class="widget-option" data-widget-type="call-sheet">
                            <svg class="widget-option-icon"><use xlink:href="#icon-calendar"/></svg>
                            <div class="widget-option-name">Today's Call Sheet</div>
                            <div class="widget-option-description">Upload and view daily call sheets from 2nd AD</div>
                        </div>
                        <div class="widget-option" data-widget-type="schedule">
                            <svg class="widget-option-icon"><use xlink:href="#icon-calendar"/></svg>
                            <div class="widget-option-name">Shooting Schedule</div>
                            <div class="widget-option-description">Weekly/monthly production schedule</div>
                        </div>
                        <div class="widget-option" data-widget-type="script-sides">
                            <svg class="widget-option-icon"><use xlink:href="#icon-script"/></svg>
                            <div class="widget-option-name">Today's Sides</div>
                            <div class="widget-option-description">Script pages for today's scenes</div>
                        </div>
                        <div class="widget-option" data-widget-type="dood">
                            <svg class="widget-option-icon"><use xlink:href="#icon-calendar"/></svg>
                            <div class="widget-option-name">Day Out of Days</div>
                            <div class="widget-option-description">Cast availability schedule</div>
                        </div>
                    </div>
                </div>

                <!-- H&MU Operations Category -->
                <div class="widget-category">
                    <h3 class="widget-category-title">H&MU Operations</h3>
                    <div class="widget-options">
                        <div class="widget-option" data-widget-type="chair-timer">
                            <svg class="widget-option-icon"><use xlink:href="#icon-time"/></svg>
                            <div class="widget-option-name">Chair Timer</div>
                            <div class="widget-option-description">Track time per actor in chair</div>
                        </div>
                        <div class="widget-option" data-widget-type="actor-queue">
                            <svg class="widget-option-icon"><use xlink:href="#icon-character"/></svg>
                            <div class="widget-option-name">Actor Queue</div>
                            <div class="widget-option-description">Next up and estimated times</div>
                        </div>
                        <div class="widget-option" data-widget-type="continuity-quick">
                            <svg class="widget-option-icon"><use xlink:href="#icon-photo"/></svg>
                            <div class="widget-option-name">Continuity Upload</div>
                            <div class="widget-option-description">Quick photo upload for continuity</div>
                        </div>
                        <div class="widget-option" data-widget-type="product-tracker">
                            <svg class="widget-option-icon"><use xlink:href="#icon-kit"/></svg>
                            <div class="widget-option-name">Product Tracker</div>
                            <div class="widget-option-description">Track product usage and inventory</div>
                        </div>
                    </div>
                </div>

                <!-- Cast Management Category -->
                <div class="widget-category">
                    <h3 class="widget-category-title">Cast Management</h3>
                    <div class="widget-options">
                        <div class="widget-option" data-widget-type="cast-today">
                            <svg class="widget-option-icon"><use xlink:href="#icon-character"/></svg>
                            <div class="widget-option-name">Today's Cast</div>
                            <div class="widget-option-description">Cast members working today with call times</div>
                        </div>
                        <div class="widget-option" data-widget-type="main-cast">
                            <svg class="widget-option-icon"><use xlink:href="#icon-character"/></svg>
                            <div class="widget-option-name">Main Cast Profiles</div>
                            <div class="widget-option-description">Quick access to principal cast info</div>
                        </div>
                        <div class="widget-option" data-widget-type="cast-allergies">
                            <svg class="widget-option-icon"><use xlink:href="#icon-character"/></svg>
                            <div class="widget-option-name">Cast Sensitivities</div>
                            <div class="widget-option-description">Allergies and product preferences</div>
                        </div>
                        <div class="widget-option" data-widget-type="character-looks">
                            <svg class="widget-option-icon"><use xlink:href="#icon-character"/></svg>
                            <div class="widget-option-name">Character Looks</div>
                            <div class="widget-option-description">Approved looks gallery</div>
                        </div>
                    </div>
                </div>

                <!-- Scene & Breakdown Category -->
                <div class="widget-category">
                    <h3 class="widget-category-title">Scene & Breakdown</h3>
                    <div class="widget-options">
                        <div class="widget-option" data-widget-type="scene-requirements">
                            <svg class="widget-option-icon"><use xlink:href="#icon-scene"/></svg>
                            <div class="widget-option-name">Today's Requirements</div>
                            <div class="widget-option-description">H&MU needs for today's scenes</div>
                        </div>
                        <div class="widget-option" data-widget-type="special-fx">
                            <svg class="widget-option-icon"><use xlink:href="#icon-scene"/></svg>
                            <div class="widget-option-name">Special FX Schedule</div>
                            <div class="widget-option-description">Prosthetics and special makeup calendar</div>
                        </div>
                        <div class="widget-option" data-widget-type="breakdown-progress">
                            <svg class="widget-option-icon"><use xlink:href="#icon-script"/></svg>
                            <div class="widget-option-name">Breakdown Progress</div>
                            <div class="widget-option-description">Script breakdown completion status</div>
                        </div>
                        <div class="widget-option" data-widget-type="quick-changes">
                            <svg class="widget-option-icon"><use xlink:href="#icon-scene"/></svg>
                            <div class="widget-option-name">Quick Changes</div>
                            <div class="widget-option-description">Timeline for quick look changes</div>
                        </div>
                    </div>
                </div>

                <!-- Budget & Admin Category -->
                <div class="widget-category">
                    <h3 class="widget-category-title">Budget & Administration</h3>
                    <div class="widget-options">
                        <div class="widget-option" data-widget-type="dept-budget">
                            <svg class="widget-option-icon"><use xlink:href="#icon-budget"/></svg>
                            <div class="widget-option-name">Department Budget</div>
                            <div class="widget-option-description">H&MU budget tracking and burn rate</div>
                        </div>
                        <div class="widget-option" data-widget-type="expense-quick">
                            <svg class="widget-option-icon"><use xlink:href="#icon-budget"/></svg>
                            <div class="widget-option-name">Quick Expense</div>
                            <div class="widget-option-description">Fast expense entry for purchases</div>
                        </div>
                        <div class="widget-option" data-widget-type="timesheet-status">
                            <svg class="widget-option-icon"><use xlink:href="#icon-time"/></svg>
                            <div class="widget-option-name">Timesheet Status</div>
                            <div class="widget-option-description">Team hours and approval status</div>
                        </div>
                        <div class="widget-option" data-widget-type="team-schedule">
                            <svg class="widget-option-icon"><use xlink:href="#icon-calendar"/></svg>
                            <div class="widget-option-name">Team Schedule</div>
                            <div class="widget-option-description">Department crew call times</div>
                        </div>
                    </div>
                </div>

                <!-- Reports & Analytics Category -->
                <div class="widget-category">
                    <h3 class="widget-category-title">Reports & Analytics</h3>
                    <div class="widget-options">
                        <div class="widget-option" data-widget-type="efficiency">
                            <svg class="widget-option-icon"><use xlink:href="#icon-report"/></svg>
                            <div class="widget-option-name">Efficiency Metrics</div>
                            <div class="widget-option-description">Average chair times and delays</div>
                        </div>
                        <div class="widget-option" data-widget-type="daily-report">
                            <svg class="widget-option-icon"><use xlink:href="#icon-report"/></svg>
                            <div class="widget-option-name">Daily Report</div>
                            <div class="widget-option-description">End of day summary</div>
                        </div>
                        <div class="widget-option" data-widget-type="weekly-overview">
                            <svg class="widget-option-icon"><use xlink:href="#icon-report"/></svg>
                            <div class="widget-option-name">Weekly Overview</div>
                            <div class="widget-option-description">Week at a glance</div>
                        </div>
                        <div class="widget-option" data-widget-type="prep-list">
                            <svg class="widget-option-icon"><use xlink:href="#icon-report"/></svg>
                            <div class="widget-option-name">Tomorrow's Prep</div>
                            <div class="widget-option-description">Next day preparation list</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Tools Category -->
                <div class="widget-category">
                    <h3 class="widget-category-title">Quick Tools</h3>
                    <div class="widget-options">
                        <div class="widget-option" data-widget-type="quick-actions">
                            <svg class="widget-option-icon"><use xlink:href="#icon-plus"/></svg>
                            <div class="widget-option-name">Quick Actions</div>
                            <div class="widget-option-description">Fast access to common tasks</div>
                        </div>
                        <div class="widget-option" data-widget-type="notes">
                            <svg class="widget-option-icon"><use xlink:href="#icon-script"/></svg>
                            <div class="widget-option-name">Quick Notes</div>
                            <div class="widget-option-description">Temporary notes and reminders</div>
                        </div>
                        <div class="widget-option" data-widget-type="weather">
                            <svg class="widget-option-icon"><use xlink:href="#icon-calendar"/></svg>
                            <div class="widget-option-name">Weather</div>
                            <div class="widget-option-description">Location weather for makeup planning</div>
                        </div>
                        <div class="widget-option" data-widget-type="contacts">
                            <svg class="widget-option-icon"><use xlink:href="#icon-character"/></svg>
                            <div class="widget-option-name">Contacts</div>
                            <div class="widget-option-description">Quick department contacts</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Initialize dashboard
        let currentProject = null;
        let timerInterval = null;
        let timerSeconds = 2723; // Start at 45:23

        // Widget storage - stores removed widgets by type
        let removedWidgets = {};

        function loadProjectData() {
            const projectData = localStorage.getItem('currentProject');
            if (projectData) {
                currentProject = JSON.parse(projectData);
                updateDashboard();
            } else {
                window.location.href = 'index.html';
            }
        }

        function updateDashboard() {
            document.querySelector('.project-info h2').textContent = currentProject?.title || 'The Big Race';
        }

        // Widget Templates - Complete HTML for all widget types
        const widgetTemplates = {
            'call-sheet': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-calendar"/></svg>
                        Today's Call Sheet
                        <span class="widget-status">live</span>
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="upload-zone" id="callSheetUpload">
                        <svg class="upload-icon"><use xlink:href="#icon-upload"/></svg>
                        <div class="upload-text">Drop today's call sheet here</div>
                        <div class="upload-hint">PDF from 2nd AD</div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">General Call</span>
                        <span class="stat-value highlight">6:00 AM</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">H&MU Call</span>
                        <span class="stat-value highlight">5:30 AM</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">First Shot</span>
                        <span class="stat-value">8:00 AM</span>
                    </div>
                </div>`,

            'chair-timer': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-time"/></svg>
                        Active Chair Timer
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="timer-display">
                        <div class="timer-time">00:45:23</div>
                        <div class="timer-actor">Sarah Mitchell - Lead</div>
                        <div class="timer-controls">
                            <button class="timer-btn">Pause</button>
                            <button class="timer-btn">Complete</button>
                        </div>
                    </div>
                </div>`,

            'cast-today': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-character"/></svg>
                        Today's Cast
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="cast-grid">
                        <div class="cast-card">
                            <div class="cast-photo">SM</div>
                            <div class="cast-name">Sarah Mitchell</div>
                            <div class="cast-call">
                                <span class="cast-status"></span>5:30 AM
                            </div>
                        </div>
                        <div class="cast-card">
                            <div class="cast-photo">JR</div>
                            <div class="cast-name">Jake Rivers</div>
                            <div class="cast-call">6:00 AM</div>
                        </div>
                        <div class="cast-card">
                            <div class="cast-photo">EW</div>
                            <div class="cast-name">Emma White</div>
                            <div class="cast-call">6:30 AM</div>
                        </div>
                        <div class="cast-card">
                            <div class="cast-photo">TC</div>
                            <div class="cast-name">Tom Chen</div>
                            <div class="cast-call">7:00 AM</div>
                        </div>
                    </div>
                </div>`,

            'scene-requirements': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-scene"/></svg>
                        Today's H&MU Requirements
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="scene-item">
                        <div class="scene-header">
                            <span class="scene-number">Scene 24</span>
                            <span class="scene-time">INT. DAY</span>
                        </div>
                        <div class="scene-requirements">
                            Sarah: Running look, sweat & dirt. Jake: Fresh from shower, wet hair
                        </div>
                    </div>
                    <div class="scene-item">
                        <div class="scene-header">
                            <span class="scene-number">Scene 25</span>
                            <span class="scene-time">INT. DAY</span>
                        </div>
                        <div class="scene-requirements">
                            Continuity from Sc. 24. Add bruise on Sarah's cheek
                        </div>
                    </div>
                    <div class="scene-item">
                        <div class="scene-header">
                            <span class="scene-number">Scene 31</span>
                            <span class="scene-time">EXT. NIGHT</span>
                        </div>
                        <div class="scene-requirements">
                            Full glam for party scene. All principals
                        </div>
                    </div>
                </div>`,

            'dept-budget': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-budget"/></svg>
                        H&MU Budget
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Department Budget</span>
                        <span class="stat-value">$25,000</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Spent to Date</span>
                        <span class="stat-value">$12,350</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Remaining</span>
                        <span class="stat-value highlight">$12,650</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 49.4%"></div>
                    </div>
                </div>`,

            'quick-actions': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-plus"/></svg>
                        Quick Actions
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="quick-actions">
                        <div class="quick-action" onclick="window.location.href='continuity.html'">
                            <svg class="quick-action-icon"><use xlink:href="#icon-photo"/></svg>
                            <div class="quick-action-label">Upload Photo</div>
                        </div>
                        <div class="quick-action" onclick="startNewTimer()">
                            <svg class="quick-action-icon"><use xlink:href="#icon-time"/></svg>
                            <div class="quick-action-label">Start Timer</div>
                        </div>
                        <div class="quick-action" onclick="addExpense()">
                            <svg class="quick-action-icon"><use xlink:href="#icon-budget"/></svg>
                            <div class="quick-action-label">Add Expense</div>
                        </div>
                        <div class="quick-action" onclick="viewCharacters()">
                            <svg class="quick-action-icon"><use xlink:href="#icon-character"/></svg>
                            <div class="quick-action-label">Characters</div>
                        </div>
                    </div>
                </div>`,

            'schedule': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-calendar"/></svg>
                        Shooting Schedule
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="upload-zone">
                        <svg class="upload-icon"><use xlink:href="#icon-upload"/></svg>
                        <div class="upload-text">Upload Schedule</div>
                        <div class="upload-hint">From Production</div>
                    </div>
                </div>`,

            'actor-queue': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-character"/></svg>
                        Actor Queue
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">In Chair Now</span>
                        <span class="stat-value">Sarah Mitchell</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Next Up</span>
                        <span class="stat-value">Jake Rivers</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Third</span>
                        <span class="stat-value">Emma White</span>
                    </div>
                </div>`,

            'product-tracker': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-kit"/></svg>
                        Product Tracker
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Foundation #3</span>
                        <span class="stat-value highlight">Low</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Setting Spray</span>
                        <span class="stat-value">60%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Lash Glue</span>
                        <span class="stat-value">Full</span>
                    </div>
                </div>`,

            'efficiency': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-report"/></svg>
                        Efficiency Metrics
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Avg Chair Time</span>
                        <span class="stat-value">52 min</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Today's Delays</span>
                        <span class="stat-value highlight">+15 min</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Efficiency</span>
                        <span class="stat-value">92%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 92%"></div>
                    </div>
                </div>`,

            // Additional widget templates
            'script-sides': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-script"/></svg>
                        Today's Sides
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="upload-zone">
                        <svg class="upload-icon"><use xlink:href="#icon-upload"/></svg>
                        <div class="upload-text">Upload Today's Sides</div>
                        <div class="upload-hint">Script pages for today</div>
                    </div>
                </div>`,

            'dood': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-calendar"/></svg>
                        Day Out of Days
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Cast Available</span>
                        <span class="stat-value">12 actors</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Shoot Days</span>
                        <span class="stat-value">Day 8 of 24</span>
                    </div>
                </div>`,

            'continuity-quick': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-photo"/></svg>
                        Continuity Upload
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="upload-zone">
                        <svg class="upload-icon"><use xlink:href="#icon-photo"/></svg>
                        <div class="upload-text">Quick Photo Upload</div>
                        <div class="upload-hint">Drag photos here</div>
                    </div>
                </div>`,

            'main-cast': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-character"/></svg>
                        Main Cast Profiles
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="cast-grid">
                        <div class="cast-card">
                            <div class="cast-photo">SM</div>
                            <div class="cast-name">Sarah Mitchell</div>
                            <div class="cast-call">Lead Role</div>
                        </div>
                        <div class="cast-card">
                            <div class="cast-photo">JR</div>
                            <div class="cast-name">Jake Rivers</div>
                            <div class="cast-call">Supporting</div>
                        </div>
                    </div>
                </div>`,

            'cast-allergies': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-character"/></svg>
                        Cast Sensitivities
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Sarah M.</span>
                        <span class="stat-value highlight">Latex allergy</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Emma W.</span>
                        <span class="stat-value">Fragrance sensitive</span>
                    </div>
                </div>`,

            'character-looks': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-character"/></svg>
                        Character Looks
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                        Approved character looks gallery
                    </p>
                </div>`,

            'special-fx': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-scene"/></svg>
                        Special FX Schedule
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Upcoming FX</span>
                        <span class="stat-value">Bruise makeup - Day 12</span>
                    </div>
                </div>`,

            'breakdown-progress': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-script"/></svg>
                        Breakdown Progress
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Scenes Broken Down</span>
                        <span class="stat-value">68 of 92</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 74%"></div>
                    </div>
                </div>`,

            'quick-changes': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-scene"/></svg>
                        Quick Changes
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Scene 24 → 25</span>
                        <span class="stat-value highlight">5 min</span>
                    </div>
                </div>`,

            'expense-quick': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-budget"/></svg>
                        Quick Expense
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="quick-actions">
                        <div class="quick-action">
                            <svg class="quick-action-icon"><use xlink:href="#icon-budget"/></svg>
                            <div class="quick-action-label">Add Expense</div>
                        </div>
                    </div>
                </div>`,

            'timesheet-status': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-time"/></svg>
                        Timesheet Status
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Team Hours Today</span>
                        <span class="stat-value">42 hrs</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Pending Approval</span>
                        <span class="stat-value highlight">3 timesheets</span>
                    </div>
                </div>`,

            'team-schedule': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-calendar"/></svg>
                        Team Schedule
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Dept Call</span>
                        <span class="stat-value highlight">5:00 AM</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Team Members</span>
                        <span class="stat-value">6 crew</span>
                    </div>
                </div>`,

            'daily-report': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-report"/></svg>
                        Daily Report
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Actors Processed</span>
                        <span class="stat-value">12</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg Time</span>
                        <span class="stat-value">48 min</span>
                    </div>
                </div>`,

            'weekly-overview': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-report"/></svg>
                        Weekly Overview
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Shoot Days</span>
                        <span class="stat-value">5 of 5</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Cast Members</span>
                        <span class="stat-value">24 total</span>
                    </div>
                </div>`,

            'prep-list': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-report"/></svg>
                        Tomorrow's Prep
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="scene-item">
                        <div class="scene-requirements">
                            Check foundation stock for tomorrow's shoot
                        </div>
                    </div>
                    <div class="scene-item">
                        <div class="scene-requirements">
                            Prepare special FX materials
                        </div>
                    </div>
                </div>`,

            'notes': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-script"/></svg>
                        Quick Notes
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                        Add quick notes and reminders
                    </p>
                </div>`,

            'weather': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-calendar"/></svg>
                        Weather
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">Today</span>
                        <span class="stat-value">Sunny, 75°F</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Humidity</span>
                        <span class="stat-value highlight">65%</span>
                    </div>
                </div>`,

            'contacts': `
                <div class="widget-header">
                    <div class="widget-title">
                        <svg class="widget-icon"><use xlink:href="#icon-character"/></svg>
                        Contacts
                    </div>
                    <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                            <svg><use xlink:href="#icon-close"/></svg>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="stat-row">
                        <span class="stat-label">2nd AD</span>
                        <span class="stat-value">555-0123</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Production Office</span>
                        <span class="stat-value">555-0199</span>
                    </div>
                </div>`
        }

        // Timer functionality
        function updateTimer() {
            timerSeconds++;
            const hours = Math.floor(timerSeconds / 3600);
            const minutes = Math.floor((timerSeconds % 3600) / 60);
            const seconds = timerSeconds % 60;
            
            const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            const timerElement = document.querySelector('.timer-time');
            if (timerElement) {
                timerElement.textContent = display;
            }
        }

        // Start timer on load
        timerInterval = setInterval(updateTimer, 1000);

        // Drag and Drop for call sheets
        const uploadZone = document.getElementById('callSheetUpload');
        if (uploadZone) {
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });
            
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'application/pdf') {
                    uploadZone.innerHTML = `
                        <div class="upload-text">Call Sheet Uploaded</div>
                        <div class="upload-hint">${files[0].name}</div>
                    `;
                    // Parse call sheet data...
                }
            });
        }

        // Widget drag and drop
        let draggedElement = null;

        document.querySelectorAll('.widget').forEach(widget => {
            widget.addEventListener('dragstart', handleDragStart);
            widget.addEventListener('dragend', handleDragEnd);
            widget.addEventListener('dragover', handleDragOver);
            widget.addEventListener('drop', handleDrop);
        });

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            if (draggedElement !== this) {
                const grid = document.getElementById('widgetsGrid');
                const allWidgets = [...grid.children];
                const draggedIndex = allWidgets.indexOf(draggedElement);
                const targetIndex = allWidgets.indexOf(this);

                if (draggedIndex < targetIndex) {
                    this.parentNode.insertBefore(draggedElement, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedElement, this);
                }
            }

            return false;
        }

        // Widget controls - improved to handle expand/collapse, resize, and proper removal
        function initializeWidgetControls() {
            document.querySelectorAll('.widget-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const widget = this.closest('.widget');
                    const icon = this.querySelector('use')?.getAttribute('xlink:href');

                    if (icon === '#icon-close' || this.classList.contains('widget-btn-close')) {
                        removeWidget(widget);
                    } else if (icon === '#icon-resize' || this.classList.contains('widget-btn-resize')) {
                        toggleWidgetSize(widget);
                    } else if (icon === '#icon-collapse') {
                        const content = widget.querySelector('.widget-content');
                        content.style.display = 'none';
                        this.querySelector('use').setAttribute('xlink:href', '#icon-expand');
                    } else if (icon === '#icon-expand') {
                        const content = widget.querySelector('.widget-content');
                        if (content) {
                            content.style.display = 'block';
                            this.querySelector('use').setAttribute('xlink:href', '#icon-collapse');
                        }
                    }
                });
            });
        }

        // Toggle widget size between normal and large (2x wide)
        function toggleWidgetSize(widget) {
            widget.classList.toggle('large');

            // Animate the transition
            widget.style.transition = 'all 0.3s ease';
        }

        // Remove widget and store its HTML for later restoration
        function removeWidget(widget) {
            const widgetType = widget.getAttribute('data-widget-type');

            if (widgetType) {
                // Store the widget's current HTML
                removedWidgets[widgetType] = widget.outerHTML;
            }

            // Animate out
            widget.style.transition = 'all 0.3s ease';
            widget.style.transform = 'scale(0.8)';
            widget.style.opacity = '0';

            setTimeout(() => {
                widget.remove();
                updateWidgetLibrary();
            }, 300);
        }

        // Update widget library to reflect available/added widgets
        function updateWidgetLibrary() {
            const currentWidgets = document.querySelectorAll('.widget');
            const addedTypes = [];

            currentWidgets.forEach(widget => {
                const type = widget.getAttribute('data-widget-type');
                if (type) addedTypes.push(type);
            });

            // Update widget options to show which are already added
            document.querySelectorAll('.widget-option').forEach(option => {
                const type = option.getAttribute('data-widget-type');
                if (addedTypes.includes(type)) {
                    option.classList.add('added');
                } else {
                    option.classList.remove('added');
                }
            });
        }

        // Initialize widget controls on page load
        initializeWidgetControls();

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            if (!item.onclick) {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            }
        });

        // View tabs
        document.querySelectorAll('.view-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.view-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Quick action functions
        function openWidgetLibrary() {
            const library = document.getElementById('widgetLibrary');
            library.classList.add('active');
            updateWidgetLibrary();
        }

        function closeWidgetLibrary() {
            const library = document.getElementById('widgetLibrary');
            library.classList.remove('active');
        }

        // Click outside to close
        document.getElementById('widgetLibrary').addEventListener('click', function(e) {
            if (e.target === this) {
                closeWidgetLibrary();
            }
        });

        // Add widget functionality
        document.querySelectorAll('.widget-option').forEach(option => {
            option.addEventListener('click', function() {
                if (this.classList.contains('added')) return;
                
                const widgetType = this.getAttribute('data-widget-type');
                const widgetName = this.querySelector('.widget-option-name').textContent;
                
                addWidgetToDashboard(widgetType, widgetName);
                this.classList.add('added');
                
                // Close modal after adding
                setTimeout(() => {
                    closeWidgetLibrary();
                }, 300);
            });
        });

        function addWidgetToDashboard(type, name) {
            const widgetsGrid = document.getElementById('widgetsGrid');

            let widget;

            // Check if we have a stored widget of this type (from previous removal)
            if (removedWidgets[type]) {
                // Restore the previously removed widget with its original content
                const temp = document.createElement('div');
                temp.innerHTML = removedWidgets[type];
                widget = temp.firstElementChild;

                // Clear from storage since we're restoring it
                delete removedWidgets[type];
            } else {
                // Create new widget from template
                widget = createWidget(type, name);
            }

            // Add to grid with animation
            widget.style.opacity = '0';
            widget.style.transform = 'scale(0.9)';
            widgetsGrid.appendChild(widget);

            // Animate in
            setTimeout(() => {
                widget.style.transition = 'all 0.3s ease';
                widget.style.opacity = '1';
                widget.style.transform = 'scale(1)';
            }, 50);

            // Make it draggable
            widget.addEventListener('dragstart', handleDragStart);
            widget.addEventListener('dragend', handleDragEnd);
            widget.addEventListener('dragover', handleDragOver);
            widget.addEventListener('drop', handleDrop);

            // Re-initialize controls for this widget
            initializeWidgetControlsForElement(widget);

            // Initialize navigation for this widget
            const widgetType = widget.getAttribute('data-widget-type');
            const targetPage = widgetPageMap[widgetType];
            if (targetPage) {
                widget.querySelector('.widget-content')?.addEventListener('click', function(e) {
                    if (!e.target.closest('button, input, textarea, select, a')) {
                        window.location.href = targetPage;
                    }
                });
                widget.querySelector('.widget-content')?.classList.add('clickable');
            }

            // Update widget library status
            updateWidgetLibrary();
        }

        function createWidget(type, name) {
            const widget = document.createElement('div');
            widget.className = 'widget';
            widget.setAttribute('draggable', 'true');
            widget.setAttribute('data-widget-type', type);

            // Check if type is 'cast-today' to add 'large' class
            if (type === 'cast-today') {
                widget.classList.add('large');
            }

            // Get template content from widgetTemplates object
            const template = widgetTemplates[type];

            if (template) {
                widget.innerHTML = template;
            } else {
                // Fallback for widgets without defined templates
                widget.innerHTML = `
                    <div class="widget-header">
                        <div class="widget-title">
                            <svg class="widget-icon"><use xlink:href="#icon-dashboard"/></svg>
                            ${name}
                        </div>
                        <div class="widget-actions">
                        <button class="widget-btn widget-btn-resize" title="Toggle size">
                            <svg><use xlink:href="#icon-resize"/></svg>
                        </button>
                        <button class="widget-btn">
                            <svg><use xlink:href="#icon-expand"/></svg>
                        </button>
                        <button class="widget-btn widget-btn-close">
                                <svg><use xlink:href="#icon-close"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="widget-content">
                        <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            Widget content for ${name}
                        </p>
                    </div>`;
            }

            return widget;
        }

        // Initialize widget controls for a specific element (used when adding new widgets)
        function initializeWidgetControlsForElement(widget) {
            widget.querySelectorAll('.widget-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const widget = this.closest('.widget');
                    const icon = this.querySelector('use')?.getAttribute('xlink:href');

                    if (icon === '#icon-close' || this.classList.contains('widget-btn-close')) {
                        removeWidget(widget);
                    } else if (icon === '#icon-resize' || this.classList.contains('widget-btn-resize')) {
                        toggleWidgetSize(widget);
                    } else if (icon === '#icon-collapse') {
                        const content = widget.querySelector('.widget-content');
                        content.style.display = 'none';
                        this.querySelector('use').setAttribute('xlink:href', '#icon-expand');
                    } else if (icon === '#icon-expand') {
                        const content = widget.querySelector('.widget-content');
                        if (content) {
                            content.style.display = 'block';
                            this.querySelector('use').setAttribute('xlink:href', '#icon-collapse');
                        }
                    }
                });
            });
        }

        function saveLayout() {
            const widgets = [];
            document.querySelectorAll('.widget').forEach(widget => {
                const type = widget.getAttribute('data-widget-type');
                const title = widget.querySelector('.widget-title')?.textContent.trim();
                if (type) {
                    widgets.push({ type, title });
                }
            });
            
            localStorage.setItem('dashboardLayout', JSON.stringify(widgets));
            
            // Show confirmation
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'Layout Saved!';
            btn.style.background = 'linear-gradient(135deg, rgba(82, 193, 134, 0.15), rgba(82, 193, 134, 0.1))';
            btn.style.borderColor = 'var(--success)';
            btn.style.color = 'var(--success)';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
                btn.style.borderColor = '';
                btn.style.color = '';
            }, 2000);
        }

        function startNewTimer() {
            alert('Select cast member to start timing');
        }

        function addExpense() {
            window.location.href = 'budget-system.html';
        }

        function viewCharacters() {
            window.location.href = 'character-design.html';
        }

        // Widget navigation - map widget types to their corresponding pages
        const widgetPageMap = {
            'call-sheet': 'dashboard.html',
            'chair-timer': null, // Interactive widget, stays on dashboard
            'cast-today': 'character-design.html',
            'scene-requirements': 'generate-breakdown.html',
            'dept-budget': 'budget-system.html',
            'quick-actions': null, // Has its own internal links
            'schedule': 'dashboard.html',
            'script-sides': 'script-breakdown.html',
            'dood': 'dashboard.html',
            'actor-queue': 'characters.html',
            'continuity-quick': 'continuity.html',
            'product-tracker': 'budget-system.html',
            'main-cast': 'characters.html',
            'cast-allergies': 'characters.html',
            'character-looks': 'characters.html',
            'special-fx': 'generate-breakdown.html',
            'breakdown-progress': 'generate-breakdown.html',
            'quick-changes': 'generate-breakdown.html',
            'expense-quick': 'budget-system.html',
            'timesheet-status': 'timesheet-system.html',
            'team-schedule': 'dashboard.html',
            'efficiency': 'dashboard.html',
            'daily-report': 'dashboard.html',
            'weekly-overview': 'dashboard.html',
            'prep-list': 'dashboard.html',
            'notes': null,
            'weather': null,
            'contacts': null
        };

        // Make widgets clickable to navigate to their corresponding pages
        function initializeWidgetNavigation() {
            document.querySelectorAll('.widget').forEach(widget => {
                const widgetType = widget.getAttribute('data-widget-type');
                const targetPage = widgetPageMap[widgetType];

                if (targetPage) {
                    // Make widget content clickable (but not the header buttons)
                    widget.querySelector('.widget-content')?.addEventListener('click', function(e) {
                        // Don't navigate if clicking on interactive elements
                        if (!e.target.closest('button, input, textarea, select, a')) {
                            window.location.href = targetPage;
                        }
                    });

                    // Add hover effect to indicate clickability
                    widget.querySelector('.widget-content')?.classList.add('clickable');
                }
            });
        }

        // Initialize
        loadProjectData();

        // Initialize widget navigation after a short delay to ensure DOM is ready
        setTimeout(initializeWidgetNavigation, 100);

        // ============================================================================
        // CALL SHEET & DAILY BREAKDOWN INTEGRATION
        // ============================================================================

        // State for today's call sheet data
        let todaysCallSheet = null;
        let todaysDailyBreakdown = null;

        // Initialize call sheet data on page load
        function initializeCallSheetData() {
            // Try to load from localStorage
            const todayKey = getTodayDateKey();
            const stored = localStorage.getItem(`callSheet_${todayKey}`);

            if (stored) {
                todaysCallSheet = JSON.parse(stored);
                showUploadedState();
                updateTodaysShootSection();
            }

            // Populate schedule dropdown
            populateScheduleDropdown();

            // Populate upcoming shoot days
            populateUpcomingShootDays();
        }

        function getTodayDateKey() {
            const now = new Date();
            return now.toISOString().split('T')[0];
        }

        function formatDateDisplay(dateStr) {
            if (!dateStr) return '--';
            const date = new Date(dateStr);
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // ============================================================================
        // CALL SHEET UPLOAD HANDLING
        // ============================================================================
        function handleCallSheetDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleCallSheetDragLeave(e) {
            e.currentTarget.classList.remove('dragover');
        }

        function handleCallSheetDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processCallSheetFile(files[0]);
            }
        }

        function handleCallSheetUpload(event) {
            const file = event.target.files?.[0];
            if (file) {
                processCallSheetFile(file);
            }
        }

        function processCallSheetFile(file) {
            const validTypes = ['.pdf', '.jpg', '.jpeg', '.png'];
            const ext = '.' + file.name.split('.').pop().toLowerCase();

            if (!validTypes.includes(ext)) {
                alert('Please upload a PDF or image file');
                return;
            }

            // Show processing state
            showProcessingState();

            // Store file name
            const fileName = file.name;

            // Simulate AI extraction (in real app, this would call an API)
            setTimeout(() => {
                // Simulated extraction result
                const extractedData = simulateAIExtraction(fileName);

                // Store the call sheet data
                todaysCallSheet = {
                    id: `cs-${getTodayDateKey()}`,
                    date: getTodayDateKey(),
                    uploadedAt: new Date().toISOString(),
                    fileName: fileName,
                    extracted: extractedData
                };

                // Save to localStorage
                localStorage.setItem(`callSheet_${getTodayDateKey()}`, JSON.stringify(todaysCallSheet));

                // Update UI
                showUploadedState();
                updateTodaysShootSection();
            }, 2000);
        }

        function simulateAIExtraction(fileName) {
            // Simulated extraction - in production this would use AI
            const today = new Date();
            const dayNum = Math.floor(Math.random() * 20) + 1;

            return {
                date: today.toISOString().split('T')[0],
                dayOfDays: `Day ${dayNum} of 24`,
                location: 'Forensics Tent / Car Park',
                generalCall: '06:00',
                hmCall: '05:30',
                firstShot: '08:00',
                scenes: ['7', '8', '9'],
                cast: [
                    { name: 'Sarah Jones', character: 'JOANNA', callTime: '05:30' },
                    { name: 'Tom Hardy', character: 'MATT', callTime: '06:00' },
                    { name: 'Emma Stone', character: 'EMMA', callTime: '06:30' }
                ],
                notes: ''
            };
        }

        function showProcessingState() {
            document.getElementById('callSheetUploadState').style.display = 'none';
            document.getElementById('callSheetProcessingState').style.display = 'block';
            document.getElementById('callSheetUploadedState').style.display = 'none';
            document.getElementById('callSheetStatus').textContent = 'processing';
        }

        function showUploadedState() {
            if (!todaysCallSheet) return;

            document.getElementById('callSheetUploadState').style.display = 'none';
            document.getElementById('callSheetProcessingState').style.display = 'none';
            document.getElementById('callSheetUploadedState').style.display = 'block';
            document.getElementById('callSheetStatus').textContent = 'live';

            const ext = todaysCallSheet.extracted;

            // Update extracted data display
            document.getElementById('callSheetFileName').textContent = todaysCallSheet.fileName || 'call_sheet.pdf';
            document.getElementById('callSheetFileDate').textContent = 'Uploaded ' + formatTimeAgo(todaysCallSheet.uploadedAt);
            document.getElementById('extractedDate').textContent = formatDateDisplay(ext.date);
            document.getElementById('extractedLocation').textContent = ext.location || '--';
            document.getElementById('extractedHMUCall').textContent = ext.hmCall || '--';
            document.getElementById('extractedGeneralCall').textContent = ext.generalCall || '--';
            document.getElementById('extractedFirstShot').textContent = ext.firstShot || '--';
            document.getElementById('extractedScenes').textContent = (ext.scenes || []).join(', ') || '--';
            document.getElementById('extractedCast').textContent = (ext.cast || []).map(c => c.character).join(', ') || '--';
        }

        function showUploadState() {
            document.getElementById('callSheetUploadState').style.display = 'block';
            document.getElementById('callSheetProcessingState').style.display = 'none';
            document.getElementById('callSheetUploadedState').style.display = 'none';
            document.getElementById('callSheetStatus').textContent = 'upload';
        }

        function formatTimeAgo(dateStr) {
            if (!dateStr) return 'recently';
            const date = new Date(dateStr);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);

            if (diffMins < 1) return 'just now';
            if (diffMins < 60) return `${diffMins} min ago`;

            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;

            return formatDateDisplay(dateStr);
        }

        function reuploadCallSheet() {
            todaysCallSheet = null;
            localStorage.removeItem(`callSheet_${getTodayDateKey()}`);
            showUploadState();
            updateTodaysShootSection();
        }

        function viewOriginalCallSheet() {
            alert('Original call sheet viewing would open the uploaded PDF/image');
        }

        // ============================================================================
        // TODAY'S SHOOT SECTION
        // ============================================================================
        function updateTodaysShootSection() {
            const emptyState = document.getElementById('todaysShootEmpty');
            const populatedState = document.getElementById('todaysShootPopulated');

            if (!todaysCallSheet) {
                emptyState.style.display = 'block';
                populatedState.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            populatedState.style.display = 'block';

            const ext = todaysCallSheet.extracted;

            document.getElementById('todaysShootDate').textContent = formatDateDisplay(ext.date);
            document.getElementById('shootDayLabel').textContent = ext.dayOfDays || 'SHOOT DAY';
            document.getElementById('shootDayLocation').textContent = ext.location || 'Location TBD';
            document.getElementById('shootDayScenes').textContent = (ext.scenes || []).join(', ') || '--';
            document.getElementById('shootDayCast').textContent = (ext.cast || []).map(c => c.character).join(', ') || '--';
            document.getElementById('shootTimeHMU').textContent = ext.hmCall || '--:--';
            document.getElementById('shootTimeGeneral').textContent = ext.generalCall || '--:--';
            document.getElementById('shootTimeFirst').textContent = ext.firstShot || '--:--';
        }

        // ============================================================================
        // SCHEDULE DROPDOWN
        // ============================================================================
        function populateScheduleDropdown() {
            const select = document.getElementById('callSheetScheduleSelect');
            if (!select) return;

            // Try to get shoot days from currentProject
            const projectData = localStorage.getItem('currentProject');
            if (!projectData) return;

            try {
                const project = JSON.parse(projectData);
                const schedule = project.shootingSchedule || {};
                const shootDays = schedule.shootDays || [];

                let options = '<option value="">Select shoot day...</option>';

                shootDays.forEach((day, index) => {
                    const dateStr = day.date ? ` (${day.date})` : '';
                    options += `<option value="${index}">Day ${day.number || index + 1}${dateStr} - ${day.location || 'TBD'}</option>`;
                });

                select.innerHTML = options;
            } catch (e) {
                console.error('Error loading schedule:', e);
            }
        }

        function loadFromSchedule(dayIndex) {
            if (!dayIndex && dayIndex !== 0) return;

            const projectData = localStorage.getItem('currentProject');
            if (!projectData) return;

            try {
                const project = JSON.parse(projectData);
                const schedule = project.shootingSchedule || {};
                const shootDays = schedule.shootDays || [];
                const day = shootDays[dayIndex];

                if (!day) return;

                // Build extracted data from schedule
                const scenes = [];
                const sceneToShootDay = schedule.sceneToShootDay || {};
                const projectScenes = project.scenes || [];

                Object.entries(sceneToShootDay).forEach(([sceneIdx, shootDayIdx]) => {
                    if (parseInt(shootDayIdx) === parseInt(dayIndex)) {
                        const scene = projectScenes[parseInt(sceneIdx)];
                        scenes.push(scene?.number || (parseInt(sceneIdx) + 1).toString());
                    }
                });

                // Get cast from scene breakdowns
                const cast = [];
                const breakdowns = project.sceneBreakdowns || {};
                const castSet = new Set();

                Object.entries(sceneToShootDay).forEach(([sceneIdx, shootDayIdx]) => {
                    if (parseInt(shootDayIdx) === parseInt(dayIndex)) {
                        const breakdown = breakdowns[sceneIdx] || {};
                        (breakdown.cast || []).forEach(c => castSet.add(c));
                    }
                });

                castSet.forEach(charName => {
                    cast.push({ character: charName, name: charName, callTime: '06:00' });
                });

                todaysCallSheet = {
                    id: `cs-${getTodayDateKey()}`,
                    date: getTodayDateKey(),
                    uploadedAt: new Date().toISOString(),
                    fileName: `Day ${day.number || dayIndex + 1} from schedule`,
                    fromSchedule: true,
                    extracted: {
                        date: day.date || getTodayDateKey(),
                        dayOfDays: `Day ${day.number || dayIndex + 1}`,
                        location: day.location || 'TBD',
                        generalCall: '06:00',
                        hmCall: '05:30',
                        firstShot: '08:00',
                        scenes: scenes,
                        cast: cast,
                        notes: day.notes || ''
                    }
                };

                localStorage.setItem(`callSheet_${getTodayDateKey()}`, JSON.stringify(todaysCallSheet));
                showUploadedState();
                updateTodaysShootSection();

            } catch (e) {
                console.error('Error loading from schedule:', e);
            }
        }

        // ============================================================================
        // UPCOMING SHOOT DAYS
        // ============================================================================
        function populateUpcomingShootDays() {
            const list = document.getElementById('upcomingShootList');
            if (!list) return;

            const projectData = localStorage.getItem('currentProject');
            if (!projectData) {
                list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No schedule loaded</div>';
                return;
            }

            try {
                const project = JSON.parse(projectData);
                const schedule = project.shootingSchedule || {};
                const shootDays = schedule.shootDays || [];

                if (shootDays.length === 0) {
                    list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No shoot days scheduled</div>';
                    return;
                }

                // Get upcoming days (next 3)
                const upcoming = shootDays.slice(0, 3);

                let html = '';
                upcoming.forEach((day, index) => {
                    const sceneCount = getSceneCountForDay(project, index);
                    const castList = getCastForDay(project, index);

                    html += `
                        <div class="upcoming-shoot-item" onclick="loadFromSchedule(${index})">
                            <span class="upcoming-shoot-date">${day.date || 'TBD'}</span>
                            <span class="upcoming-shoot-day">Day ${day.number || index + 1}</span>
                            <span class="upcoming-shoot-location">${day.location || 'Location TBD'}</span>
                            <span class="upcoming-shoot-scenes">${sceneCount} scene${sceneCount !== 1 ? 's' : ''}</span>
                        </div>
                    `;
                });

                list.innerHTML = html;

            } catch (e) {
                console.error('Error loading upcoming days:', e);
                list.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Error loading schedule</div>';
            }
        }

        function getSceneCountForDay(project, dayIndex) {
            const sceneToShootDay = project.shootingSchedule?.sceneToShootDay || {};
            let count = 0;
            Object.values(sceneToShootDay).forEach(idx => {
                if (parseInt(idx) === dayIndex) count++;
            });
            return count;
        }

        function getCastForDay(project, dayIndex) {
            const sceneToShootDay = project.shootingSchedule?.sceneToShootDay || {};
            const breakdowns = project.sceneBreakdowns || {};
            const castSet = new Set();

            Object.entries(sceneToShootDay).forEach(([sceneIdx, shootDayIdx]) => {
                if (parseInt(shootDayIdx) === dayIndex) {
                    const breakdown = breakdowns[sceneIdx] || {};
                    (breakdown.cast || []).forEach(c => castSet.add(c));
                }
            });

            return Array.from(castSet);
        }

        // ============================================================================
        // DAILY BREAKDOWN GENERATION
        // ============================================================================
        function generateDailyBreakdown() {
            if (!todaysCallSheet) {
                alert('Please upload a call sheet first');
                return;
            }

            // Generate breakdown data
            todaysDailyBreakdown = generateBreakdownFromCallSheet(todaysCallSheet);

            // Save to localStorage
            localStorage.setItem(`dailyBreakdown_${getTodayDateKey()}`, JSON.stringify(todaysDailyBreakdown));

            // Open the modal
            openDailyBreakdownModal();
        }

        function generateBreakdownFromCallSheet(callSheet) {
            const ext = callSheet.extracted;
            const projectData = localStorage.getItem('currentProject');
            let project = null;

            try {
                project = projectData ? JSON.parse(projectData) : null;
            } catch (e) {
                console.error('Error parsing project:', e);
            }

            // Build cast breakdowns
            const castBreakdowns = [];

            (ext.cast || []).forEach(castMember => {
                const charName = castMember.character;

                // Try to get character data from project
                let hair = 'As established';
                let makeup = 'Natural, clean';
                let allergies = null;
                let continuity = [];

                if (project) {
                    // Get character states from project
                    const charStates = project.characterStates || {};
                    const characters = project.characters || {};
                    const charData = characters[charName] || {};

                    // Look for looks in scene breakdowns
                    const breakdowns = project.sceneBreakdowns || {};
                    ext.scenes.forEach(sceneNum => {
                        // Find scene by number
                        const sceneIndex = (project.scenes || []).findIndex(s =>
                            (s.number || '').toString() === sceneNum.toString()
                        );
                        if (sceneIndex >= 0) {
                            const state = charStates[sceneIndex]?.[charName];
                            if (state) {
                                if (state.enterHair) hair = state.enterHair;
                                if (state.enterMakeup) makeup = state.enterMakeup;
                            }
                        }
                    });

                    // Get continuity events
                    const events = project.continuityEvents?.[charName] || [];
                    events.forEach(event => {
                        if (event.active) {
                            continuity.push(event.name || event.eventName);
                        }
                    });
                }

                castBreakdowns.push({
                    character: charName,
                    actor: castMember.name,
                    callTime: castMember.callTime || '06:00',
                    readyTime: calculateReadyTime(castMember.callTime),
                    scenes: ext.scenes,
                    hair: hair,
                    makeup: makeup,
                    allergies: allergies,
                    continuity: continuity,
                    estimatedTime: '45 mins'
                });
            });

            // Build scene order
            const sceneOrder = ext.scenes.map((sceneNum, index) => {
                let heading = `Scene ${sceneNum}`;
                let cast = [];

                if (project) {
                    const sceneIndex = (project.scenes || []).findIndex(s =>
                        (s.number || '').toString() === sceneNum.toString()
                    );
                    if (sceneIndex >= 0) {
                        const scene = project.scenes[sceneIndex];
                        heading = `SC ${sceneNum} - ${scene.heading || 'Scene'}`;

                        const breakdown = project.sceneBreakdowns?.[sceneIndex];
                        if (breakdown) {
                            cast = breakdown.cast || [];
                        }
                    }
                }

                return {
                    order: index + 1,
                    sceneNumber: sceneNum,
                    heading: heading,
                    cast: cast
                };
            });

            return {
                generatedAt: new Date().toISOString(),
                date: ext.date,
                dayOfDays: ext.dayOfDays,
                location: ext.location,
                times: {
                    hmCall: ext.hmCall,
                    generalCall: ext.generalCall,
                    firstShot: ext.firstShot
                },
                castBreakdowns: castBreakdowns,
                sceneOrder: sceneOrder
            };
        }

        function calculateReadyTime(callTime) {
            if (!callTime) return '--:--';
            const [hours, mins] = callTime.split(':').map(Number);
            const totalMins = hours * 60 + mins + 90; // Add 90 minutes
            const readyHours = Math.floor(totalMins / 60) % 24;
            const readyMins = totalMins % 60;
            return `${readyHours.toString().padStart(2, '0')}:${readyMins.toString().padStart(2, '0')}`;
        }

        // ============================================================================
        // DAILY BREAKDOWN MODAL
        // ============================================================================
        function openDailyBreakdownModal() {
            // Check if we have breakdown data
            if (!todaysDailyBreakdown) {
                // Try to load from localStorage
                const stored = localStorage.getItem(`dailyBreakdown_${getTodayDateKey()}`);
                if (stored) {
                    todaysDailyBreakdown = JSON.parse(stored);
                } else if (todaysCallSheet) {
                    // Generate on the fly
                    todaysDailyBreakdown = generateBreakdownFromCallSheet(todaysCallSheet);
                } else {
                    alert('No breakdown data available. Please upload a call sheet first.');
                    return;
                }
            }

            // Populate modal
            populateBreakdownModal(todaysDailyBreakdown);

            // Show modal
            document.getElementById('dailyBreakdownModal').classList.add('active');
        }

        function closeDailyBreakdownModal() {
            document.getElementById('dailyBreakdownModal').classList.remove('active');
        }

        function populateBreakdownModal(breakdown) {
            // Update subtitle
            document.getElementById('breakdownModalSubtitle').textContent =
                `${breakdown.dayOfDays || 'Shoot Day'} - ${formatDateDisplay(breakdown.date)}`;

            // Populate cast breakdown list
            const castList = document.getElementById('castBreakdownList');
            let castHtml = '';

            (breakdown.castBreakdowns || []).forEach(cast => {
                castHtml += `
                    <div class="cast-breakdown-item">
                        <div class="cast-breakdown-header">
                            <div>
                                <div class="cast-breakdown-name">${escapeHtml(cast.character)}</div>
                                <div class="cast-breakdown-actor">${escapeHtml(cast.actor || 'TBD')}</div>
                            </div>
                            <span class="cast-breakdown-scenes">Scenes ${(cast.scenes || []).join(', ')}</span>
                        </div>
                        <div class="cast-breakdown-times">
                            <span class="cast-breakdown-time">Call: <strong>${cast.callTime || '--:--'}</strong></span>
                            <span class="cast-breakdown-time">Ready: <strong>${cast.readyTime || '--:--'}</strong></span>
                            <span class="cast-breakdown-time">Est. Time: <strong>${cast.estimatedTime || '45 mins'}</strong></span>
                        </div>
                        <div class="cast-breakdown-details">
                            <div class="cast-breakdown-detail">
                                <div class="cast-breakdown-detail-label">Hair</div>
                                <div class="cast-breakdown-detail-value">${escapeHtml(cast.hair || 'As established')}</div>
                            </div>
                            <div class="cast-breakdown-detail">
                                <div class="cast-breakdown-detail-label">Makeup</div>
                                <div class="cast-breakdown-detail-value">${escapeHtml(cast.makeup || 'Natural')}</div>
                            </div>
                        </div>
                        ${cast.continuity && cast.continuity.length > 0 ? `
                            <div class="cast-breakdown-detail" style="margin-top: 8px;">
                                <div class="cast-breakdown-detail-label">Continuity</div>
                                <div class="cast-breakdown-detail-value">${escapeHtml(cast.continuity.join(', '))}</div>
                            </div>
                        ` : ''}
                        ${cast.allergies ? `
                            <div class="cast-breakdown-alert">
                                Allergy Alert: ${escapeHtml(cast.allergies)}
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            castList.innerHTML = castHtml || '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No cast data</div>';

            // Populate scene order list
            const sceneList = document.getElementById('sceneOrderList');
            let sceneHtml = '';

            (breakdown.sceneOrder || []).forEach(scene => {
                sceneHtml += `
                    <div class="scene-order-item">
                        <span class="scene-order-number">${scene.order}</span>
                        <div class="scene-order-info">
                            <div class="scene-order-heading">${escapeHtml(scene.heading)}</div>
                            <div class="scene-order-cast">${(scene.cast || []).join(', ') || 'Cast TBD'}</div>
                        </div>
                    </div>
                `;
            });

            sceneList.innerHTML = sceneHtml || '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No scene data</div>';
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================================================
        // EXPORT & SHARE FUNCTIONS
        // ============================================================================
        function downloadBreakdownPDF() {
            // In a real app, this would use jsPDF or html2pdf
            alert('PDF download feature - would generate a formatted PDF of the daily breakdown');

            // Simulate download
            const breakdownText = generateBreakdownText();
            const blob = new Blob([breakdownText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `daily_breakdown_${getTodayDateKey()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function generateBreakdownText() {
            if (!todaysDailyBreakdown) return 'No breakdown data';

            let text = '='.repeat(60) + '\n';
            text += 'DAILY H&MU BREAKDOWN\n';
            text += `${todaysDailyBreakdown.dayOfDays || 'Shoot Day'}\n`;
            text += `Date: ${formatDateDisplay(todaysDailyBreakdown.date)}\n`;
            text += `Location: ${todaysDailyBreakdown.location || 'TBD'}\n`;
            text += '='.repeat(60) + '\n\n';

            text += 'CALL TIMES\n';
            text += '-'.repeat(30) + '\n';
            text += `H&MU Call: ${todaysDailyBreakdown.times?.hmCall || '--:--'}\n`;
            text += `General Call: ${todaysDailyBreakdown.times?.generalCall || '--:--'}\n`;
            text += `First Shot: ${todaysDailyBreakdown.times?.firstShot || '--:--'}\n\n`;

            text += 'CAST BREAKDOWN\n';
            text += '-'.repeat(30) + '\n';
            (todaysDailyBreakdown.castBreakdowns || []).forEach(cast => {
                text += `\n${cast.character} (${cast.actor || 'TBD'})\n`;
                text += `  Call: ${cast.callTime} | Ready: ${cast.readyTime}\n`;
                text += `  Hair: ${cast.hair || 'As established'}\n`;
                text += `  Makeup: ${cast.makeup || 'Natural'}\n`;
                text += `  Scenes: ${(cast.scenes || []).join(', ')}\n`;
            });

            text += '\n\nSCENE ORDER\n';
            text += '-'.repeat(30) + '\n';
            (todaysDailyBreakdown.sceneOrder || []).forEach(scene => {
                text += `${scene.order}. ${scene.heading}\n`;
                text += `   Cast: ${(scene.cast || []).join(', ')}\n`;
            });

            text += '\n\nGenerated by Hair & Makeup Pro\n';

            return text;
        }

        function copyBreakdownLink() {
            // In a real app, this would copy a shareable link
            const link = `${window.location.origin}/breakdown/${getTodayDateKey()}`;
            navigator.clipboard.writeText(link).then(() => {
                alert('Link copied to clipboard!');
            }).catch(() => {
                alert('Could not copy link');
            });
        }

        function sendToTeam() {
            alert('Send to Team feature - would open email/message composer with breakdown attached');
        }

        function printBreakdown() {
            window.print();
        }

        function shareWithTeam() {
            if (todaysDailyBreakdown) {
                openDailyBreakdownModal();
            } else if (todaysCallSheet) {
                generateDailyBreakdown();
            } else {
                alert('Please upload a call sheet first to generate a breakdown to share.');
            }
        }

        // ============================================================================
        // LIVE CONTINUITY INTEGRATION
        // ============================================================================
        function openLiveContinuity() {
            const dateParam = getTodayDateKey();
            window.location.href = `continuity.html?date=${dateParam}`;
        }

        // ============================================================================
        // INITIALIZE ON PAGE LOAD
        // ============================================================================
        // Initialize call sheet features after DOM is ready
        setTimeout(initializeCallSheetData, 200);

        // Click outside to close breakdown modal
        document.getElementById('dailyBreakdownModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeDailyBreakdownModal();
            }
        });
    </script>

    <!-- Chat Assistant -->
    <script src="/js/chat-assistant.js"></script>
</body>
</html>
